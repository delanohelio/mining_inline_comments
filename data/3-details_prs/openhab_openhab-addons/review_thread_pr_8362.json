{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc1ODIwNTIx", "number": 8362, "reviewThreads": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwNjozNzowOFrOEeLaoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQxODoxNTo0MVrOEguHcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMDc5Nzc3OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromBindingConstants.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwNjozNzowOFrOHJsM5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwNjozNzowOFrOHJsM5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTkyMzQyOA==", "bodyText": "Can you add the unit:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static final int DEFAULT_WAIT_BEFORE_INITIAL_REFRESH = 10;\n          \n          \n            \n                public static final int DEFAULT_WAIT_BEFORE_INITIAL_REFRESH_SECONDS = 10;", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r479923428", "createdAt": "2020-08-31T06:37:08Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromBindingConstants.java", "diffHunk": "@@ -0,0 +1,39 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+\n+/**\n+ * The {@link MyStromBindingConstants} class defines common constants, which are\n+ * used across the whole binding.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromBindingConstants {\n+\n+    public static final int DEFAULT_WAIT_BEFORE_INITIAL_REFRESH = 10;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b592c4d44d88978f5be5f41bbb212bb6d598d3eb"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMDc5ODU5OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromBindingConstants.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwNjozNzozMFrOHJsNaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwNjozNzozMFrOHJsNaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTkyMzU2MA==", "bodyText": "Same here:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static final int DEFAULT_REFRESH_RATE = 10;\n          \n          \n            \n                public static final int DEFAULT_REFRESH_RATE_SECONDS = 10;", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r479923560", "createdAt": "2020-08-31T06:37:30Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromBindingConstants.java", "diffHunk": "@@ -0,0 +1,39 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+\n+/**\n+ * The {@link MyStromBindingConstants} class defines common constants, which are\n+ * used across the whole binding.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromBindingConstants {\n+\n+    public static final int DEFAULT_WAIT_BEFORE_INITIAL_REFRESH = 10;\n+    public static final int DEFAULT_REFRESH_RATE = 10;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b592c4d44d88978f5be5f41bbb212bb6d598d3eb"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMDgwMzc5OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwNjozOToyOVrOHJsQWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwNjozOToyOVrOHJsQWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTkyNDMxMw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @Nullable\n          \n          \n            \n                private ScheduledFuture<?> pollingJob;\n          \n          \n            \n                private @Nullable ScheduledFuture<?> pollingJob;", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r479924313", "createdAt": "2020-08-31T06:39:29Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,163 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.DEFAULT_WAIT_BEFORE_INITIAL_REFRESH;\n+\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import com.google.gson.Gson;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to myStrom: \";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private @Nullable MyStromConfiguration config;\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    @Nullable\n+    private ScheduledFuture<?> pollingJob;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b592c4d44d88978f5be5f41bbb212bb6d598d3eb"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMDgyNTU4OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwNjo0NToxM1rOHJscuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwNjo0NToxM1rOHJscuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTkyNzQ4Mw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                scheduler.schedule(() -> {\n          \n          \n            \n                                    pollDevice();\n          \n          \n            \n                                }, 500, TimeUnit.MILLISECONDS);\n          \n          \n            \n                                scheduler.schedule(this::pollDevice, 500, TimeUnit.MILLISECONDS);", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r479927483", "createdAt": "2020-08-31T06:45:13Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,163 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.DEFAULT_WAIT_BEFORE_INITIAL_REFRESH;\n+\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import com.google.gson.Gson;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to myStrom: \";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private @Nullable MyStromConfiguration config;\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    @Nullable\n+    private ScheduledFuture<?> pollingJob;\n+\n+    private final Gson gson = new Gson();\n+\n+    public MyStromHandler(Thing thing, HttpClient httpClient) {\n+        super(thing);\n+        this.httpClient = httpClient;\n+    }\n+\n+    private static class MyStromReport {\n+\n+        public float power;\n+        public boolean relay;\n+        public float temperature;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        try {\n+            if (command instanceof RefreshType) {\n+                pollDevice();\n+            } else {\n+                if (command instanceof OnOffType && CHANNEL_SWITCH.equals(channelUID.getId())) {\n+                    sendHttpGet(\"relay?state=\" + (command == OnOffType.ON ? \"1\" : \"0\"));\n+                    scheduler.schedule(() -> {\n+                        pollDevice();\n+                    }, 500, TimeUnit.MILLISECONDS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b592c4d44d88978f5be5f41bbb212bb6d598d3eb"}, "originalPosition": 90}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMDgzNzEwOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwNjo0ODowN1rOHJsjOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxODoyNDowOVrOHKDpGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTkyOTE0NA==", "bodyText": "Please log this to warn. See documentation about what to log: https://www.openhab.org/docs/developer/guidelines.html#f-logging", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r479929144", "createdAt": "2020-08-31T06:48:07Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,163 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.DEFAULT_WAIT_BEFORE_INITIAL_REFRESH;\n+\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import com.google.gson.Gson;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to myStrom: \";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private @Nullable MyStromConfiguration config;\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    @Nullable\n+    private ScheduledFuture<?> pollingJob;\n+\n+    private final Gson gson = new Gson();\n+\n+    public MyStromHandler(Thing thing, HttpClient httpClient) {\n+        super(thing);\n+        this.httpClient = httpClient;\n+    }\n+\n+    private static class MyStromReport {\n+\n+        public float power;\n+        public boolean relay;\n+        public float temperature;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        try {\n+            if (command instanceof RefreshType) {\n+                pollDevice();\n+            } else {\n+                if (command instanceof OnOffType && CHANNEL_SWITCH.equals(channelUID.getId())) {\n+                    sendHttpGet(\"relay?state=\" + (command == OnOffType.ON ? \"1\" : \"0\"));\n+                    scheduler.schedule(() -> {\n+                        pollDevice();\n+                    }, 500, TimeUnit.MILLISECONDS);\n+                }\n+\n+            }\n+        } catch (MyStromException e) {\n+            logger.error(COMMUNICATION_ERROR, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b592c4d44d88978f5be5f41bbb212bb6d598d3eb"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMwNzQ4Mw==", "bodyText": "changed to warn", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r480307483", "createdAt": "2020-08-31T18:24:09Z", "author": {"login": "pail23"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,163 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.DEFAULT_WAIT_BEFORE_INITIAL_REFRESH;\n+\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import com.google.gson.Gson;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to myStrom: \";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private @Nullable MyStromConfiguration config;\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    @Nullable\n+    private ScheduledFuture<?> pollingJob;\n+\n+    private final Gson gson = new Gson();\n+\n+    public MyStromHandler(Thing thing, HttpClient httpClient) {\n+        super(thing);\n+        this.httpClient = httpClient;\n+    }\n+\n+    private static class MyStromReport {\n+\n+        public float power;\n+        public boolean relay;\n+        public float temperature;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        try {\n+            if (command instanceof RefreshType) {\n+                pollDevice();\n+            } else {\n+                if (command instanceof OnOffType && CHANNEL_SWITCH.equals(channelUID.getId())) {\n+                    sendHttpGet(\"relay?state=\" + (command == OnOffType.ON ? \"1\" : \"0\"));\n+                    scheduler.schedule(() -> {\n+                        pollDevice();\n+                    }, 500, TimeUnit.MILLISECONDS);\n+                }\n+\n+            }\n+        } catch (MyStromException e) {\n+            logger.error(COMMUNICATION_ERROR, e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTkyOTE0NA=="}, "originalCommit": {"oid": "b592c4d44d88978f5be5f41bbb212bb6d598d3eb"}, "originalPosition": 95}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMDgzODU3OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwNjo0ODo0MlrOHJskIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxODoyNDoyMlrOHKDpig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTkyOTM3Nw==", "bodyText": "This should be debug log as it already also set the state", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r479929377", "createdAt": "2020-08-31T06:48:42Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,163 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.DEFAULT_WAIT_BEFORE_INITIAL_REFRESH;\n+\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import com.google.gson.Gson;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to myStrom: \";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private @Nullable MyStromConfiguration config;\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    @Nullable\n+    private ScheduledFuture<?> pollingJob;\n+\n+    private final Gson gson = new Gson();\n+\n+    public MyStromHandler(Thing thing, HttpClient httpClient) {\n+        super(thing);\n+        this.httpClient = httpClient;\n+    }\n+\n+    private static class MyStromReport {\n+\n+        public float power;\n+        public boolean relay;\n+        public float temperature;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        try {\n+            if (command instanceof RefreshType) {\n+                pollDevice();\n+            } else {\n+                if (command instanceof OnOffType && CHANNEL_SWITCH.equals(channelUID.getId())) {\n+                    sendHttpGet(\"relay?state=\" + (command == OnOffType.ON ? \"1\" : \"0\"));\n+                    scheduler.schedule(() -> {\n+                        pollDevice();\n+                    }, 500, TimeUnit.MILLISECONDS);\n+                }\n+\n+            }\n+        } catch (MyStromException e) {\n+            logger.error(COMMUNICATION_ERROR, e);\n+        }\n+    }\n+\n+    private void pollDevice() {\n+        try {\n+            String returnContent = sendHttpGet(\"report\");\n+            MyStromReport report = gson.fromJson(returnContent, MyStromReport.class);\n+            updateState(CHANNEL_SWITCH, report.relay ? OnOffType.ON : OnOffType.OFF);\n+            updateState(CHANNEL_POWER, QuantityType.valueOf(report.power, WATT));\n+            updateState(CHANNEL_TEMPERATURE, QuantityType.valueOf(report.temperature, CELSIUS));\n+            updateStatus(ThingStatus.ONLINE);\n+        } catch (MyStromException e) {\n+            logger.error(COMMUNICATION_ERROR, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b592c4d44d88978f5be5f41bbb212bb6d598d3eb"}, "originalPosition": 108}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMwNzU5NA==", "bodyText": "changed to debug", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r480307594", "createdAt": "2020-08-31T18:24:22Z", "author": {"login": "pail23"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,163 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.DEFAULT_WAIT_BEFORE_INITIAL_REFRESH;\n+\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import com.google.gson.Gson;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to myStrom: \";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private @Nullable MyStromConfiguration config;\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    @Nullable\n+    private ScheduledFuture<?> pollingJob;\n+\n+    private final Gson gson = new Gson();\n+\n+    public MyStromHandler(Thing thing, HttpClient httpClient) {\n+        super(thing);\n+        this.httpClient = httpClient;\n+    }\n+\n+    private static class MyStromReport {\n+\n+        public float power;\n+        public boolean relay;\n+        public float temperature;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        try {\n+            if (command instanceof RefreshType) {\n+                pollDevice();\n+            } else {\n+                if (command instanceof OnOffType && CHANNEL_SWITCH.equals(channelUID.getId())) {\n+                    sendHttpGet(\"relay?state=\" + (command == OnOffType.ON ? \"1\" : \"0\"));\n+                    scheduler.schedule(() -> {\n+                        pollDevice();\n+                    }, 500, TimeUnit.MILLISECONDS);\n+                }\n+\n+            }\n+        } catch (MyStromException e) {\n+            logger.error(COMMUNICATION_ERROR, e);\n+        }\n+    }\n+\n+    private void pollDevice() {\n+        try {\n+            String returnContent = sendHttpGet(\"report\");\n+            MyStromReport report = gson.fromJson(returnContent, MyStromReport.class);\n+            updateState(CHANNEL_SWITCH, report.relay ? OnOffType.ON : OnOffType.OFF);\n+            updateState(CHANNEL_POWER, QuantityType.valueOf(report.power, WATT));\n+            updateState(CHANNEL_TEMPERATURE, QuantityType.valueOf(report.temperature, CELSIUS));\n+            updateStatus(ThingStatus.ONLINE);\n+        } catch (MyStromException e) {\n+            logger.error(COMMUNICATION_ERROR, e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTkyOTM3Nw=="}, "originalCommit": {"oid": "b592c4d44d88978f5be5f41bbb212bb6d598d3eb"}, "originalPosition": 108}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMDg0MDE1OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwNjo0OToyMFrOHJslDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwNjo0OToyMFrOHJslDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTkyOTYxNA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        updateStatus(ThingStatus.OFFLINE);\n          \n          \n            \n                        updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, COMMUNICATION_ERROR);\n          \n      \n    \n    \n  \n\nor\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        updateStatus(ThingStatus.OFFLINE);\n          \n          \n            \n                        updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, e.getMessage());", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r479929614", "createdAt": "2020-08-31T06:49:20Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,163 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.DEFAULT_WAIT_BEFORE_INITIAL_REFRESH;\n+\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import com.google.gson.Gson;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to myStrom: \";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private @Nullable MyStromConfiguration config;\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    @Nullable\n+    private ScheduledFuture<?> pollingJob;\n+\n+    private final Gson gson = new Gson();\n+\n+    public MyStromHandler(Thing thing, HttpClient httpClient) {\n+        super(thing);\n+        this.httpClient = httpClient;\n+    }\n+\n+    private static class MyStromReport {\n+\n+        public float power;\n+        public boolean relay;\n+        public float temperature;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        try {\n+            if (command instanceof RefreshType) {\n+                pollDevice();\n+            } else {\n+                if (command instanceof OnOffType && CHANNEL_SWITCH.equals(channelUID.getId())) {\n+                    sendHttpGet(\"relay?state=\" + (command == OnOffType.ON ? \"1\" : \"0\"));\n+                    scheduler.schedule(() -> {\n+                        pollDevice();\n+                    }, 500, TimeUnit.MILLISECONDS);\n+                }\n+\n+            }\n+        } catch (MyStromException e) {\n+            logger.error(COMMUNICATION_ERROR, e);\n+        }\n+    }\n+\n+    private void pollDevice() {\n+        try {\n+            String returnContent = sendHttpGet(\"report\");\n+            MyStromReport report = gson.fromJson(returnContent, MyStromReport.class);\n+            updateState(CHANNEL_SWITCH, report.relay ? OnOffType.ON : OnOffType.OFF);\n+            updateState(CHANNEL_POWER, QuantityType.valueOf(report.power, WATT));\n+            updateState(CHANNEL_TEMPERATURE, QuantityType.valueOf(report.temperature, CELSIUS));\n+            updateStatus(ThingStatus.ONLINE);\n+        } catch (MyStromException e) {\n+            logger.error(COMMUNICATION_ERROR, e);\n+            updateStatus(ThingStatus.OFFLINE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b592c4d44d88978f5be5f41bbb212bb6d598d3eb"}, "originalPosition": 109}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMDg0NzkyOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwNjo1MjowMVrOHJspcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxODoyNTowMVrOHKDq-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTkzMDczNg==", "bodyText": "The polling job is started with a delay, but here it's started directly. Why not just start the scheduled job with 0 seconds delay?", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r479930736", "createdAt": "2020-08-31T06:52:01Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,163 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.DEFAULT_WAIT_BEFORE_INITIAL_REFRESH;\n+\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import com.google.gson.Gson;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to myStrom: \";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private @Nullable MyStromConfiguration config;\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    @Nullable\n+    private ScheduledFuture<?> pollingJob;\n+\n+    private final Gson gson = new Gson();\n+\n+    public MyStromHandler(Thing thing, HttpClient httpClient) {\n+        super(thing);\n+        this.httpClient = httpClient;\n+    }\n+\n+    private static class MyStromReport {\n+\n+        public float power;\n+        public boolean relay;\n+        public float temperature;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        try {\n+            if (command instanceof RefreshType) {\n+                pollDevice();\n+            } else {\n+                if (command instanceof OnOffType && CHANNEL_SWITCH.equals(channelUID.getId())) {\n+                    sendHttpGet(\"relay?state=\" + (command == OnOffType.ON ? \"1\" : \"0\"));\n+                    scheduler.schedule(() -> {\n+                        pollDevice();\n+                    }, 500, TimeUnit.MILLISECONDS);\n+                }\n+\n+            }\n+        } catch (MyStromException e) {\n+            logger.error(COMMUNICATION_ERROR, e);\n+        }\n+    }\n+\n+    private void pollDevice() {\n+        try {\n+            String returnContent = sendHttpGet(\"report\");\n+            MyStromReport report = gson.fromJson(returnContent, MyStromReport.class);\n+            updateState(CHANNEL_SWITCH, report.relay ? OnOffType.ON : OnOffType.OFF);\n+            updateState(CHANNEL_POWER, QuantityType.valueOf(report.power, WATT));\n+            updateState(CHANNEL_TEMPERATURE, QuantityType.valueOf(report.temperature, CELSIUS));\n+            updateStatus(ThingStatus.ONLINE);\n+        } catch (MyStromException e) {\n+            logger.error(COMMUNICATION_ERROR, e);\n+            updateStatus(ThingStatus.OFFLINE);\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Start initializing!\");\n+        config = getConfigAs(MyStromConfiguration.class);\n+        hostname = config.hostname;\n+\n+        pollingJob = scheduler.scheduleWithFixedDelay(this::pollDevice, DEFAULT_WAIT_BEFORE_INITIAL_REFRESH,\n+                config.refresh, TimeUnit.SECONDS);\n+\n+        updateStatus(ThingStatus.UNKNOWN);\n+\n+        scheduler.execute(this::pollDevice);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b592c4d44d88978f5be5f41bbb212bb6d598d3eb"}, "originalPosition": 124}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMwNzk2Mg==", "bodyText": "removed this line and change to 0 delay in the previous call", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r480307962", "createdAt": "2020-08-31T18:25:01Z", "author": {"login": "pail23"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,163 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.DEFAULT_WAIT_BEFORE_INITIAL_REFRESH;\n+\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import com.google.gson.Gson;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to myStrom: \";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private @Nullable MyStromConfiguration config;\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    @Nullable\n+    private ScheduledFuture<?> pollingJob;\n+\n+    private final Gson gson = new Gson();\n+\n+    public MyStromHandler(Thing thing, HttpClient httpClient) {\n+        super(thing);\n+        this.httpClient = httpClient;\n+    }\n+\n+    private static class MyStromReport {\n+\n+        public float power;\n+        public boolean relay;\n+        public float temperature;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        try {\n+            if (command instanceof RefreshType) {\n+                pollDevice();\n+            } else {\n+                if (command instanceof OnOffType && CHANNEL_SWITCH.equals(channelUID.getId())) {\n+                    sendHttpGet(\"relay?state=\" + (command == OnOffType.ON ? \"1\" : \"0\"));\n+                    scheduler.schedule(() -> {\n+                        pollDevice();\n+                    }, 500, TimeUnit.MILLISECONDS);\n+                }\n+\n+            }\n+        } catch (MyStromException e) {\n+            logger.error(COMMUNICATION_ERROR, e);\n+        }\n+    }\n+\n+    private void pollDevice() {\n+        try {\n+            String returnContent = sendHttpGet(\"report\");\n+            MyStromReport report = gson.fromJson(returnContent, MyStromReport.class);\n+            updateState(CHANNEL_SWITCH, report.relay ? OnOffType.ON : OnOffType.OFF);\n+            updateState(CHANNEL_POWER, QuantityType.valueOf(report.power, WATT));\n+            updateState(CHANNEL_TEMPERATURE, QuantityType.valueOf(report.temperature, CELSIUS));\n+            updateStatus(ThingStatus.ONLINE);\n+        } catch (MyStromException e) {\n+            logger.error(COMMUNICATION_ERROR, e);\n+            updateStatus(ThingStatus.OFFLINE);\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Start initializing!\");\n+        config = getConfigAs(MyStromConfiguration.class);\n+        hostname = config.hostname;\n+\n+        pollingJob = scheduler.scheduleWithFixedDelay(this::pollDevice, DEFAULT_WAIT_BEFORE_INITIAL_REFRESH,\n+                config.refresh, TimeUnit.SECONDS);\n+\n+        updateStatus(ThingStatus.UNKNOWN);\n+\n+        scheduler.execute(this::pollDevice);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTkzMDczNg=="}, "originalCommit": {"oid": "b592c4d44d88978f5be5f41bbb212bb6d598d3eb"}, "originalPosition": 124}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMDg1MjIzOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.mystrom/src/main/resources/ESH-INF/thing/thing-types.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwNjo1MzozOFrOHJssBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxODoyNTowNlrOHKDrMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTkzMTM5Nw==", "bodyText": "Remove sample text", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r479931397", "createdAt": "2020-08-31T06:53:38Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.mystrom/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -0,0 +1,53 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"mystrom\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<!-- Sample Thing Type -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b592c4d44d88978f5be5f41bbb212bb6d598d3eb"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMwODAxOA==", "bodyText": "done", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r480308018", "createdAt": "2020-08-31T18:25:06Z", "author": {"login": "pail23"}, "path": "bundles/org.openhab.binding.mystrom/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -0,0 +1,53 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"mystrom\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<!-- Sample Thing Type -->", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTkzMTM5Nw=="}, "originalCommit": {"oid": "b592c4d44d88978f5be5f41bbb212bb6d598d3eb"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMDg1NDA2OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwNjo1NDoxOVrOHJstKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxODoyNToxN1rOHKDrlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTkzMTY4OQ==", "bodyText": "Put inner classes at the top or bottom of this class.", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r479931689", "createdAt": "2020-08-31T06:54:19Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,163 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.DEFAULT_WAIT_BEFORE_INITIAL_REFRESH;\n+\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import com.google.gson.Gson;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to myStrom: \";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private @Nullable MyStromConfiguration config;\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    @Nullable\n+    private ScheduledFuture<?> pollingJob;\n+\n+    private final Gson gson = new Gson();\n+\n+    public MyStromHandler(Thing thing, HttpClient httpClient) {\n+        super(thing);\n+        this.httpClient = httpClient;\n+    }\n+\n+    private static class MyStromReport {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b592c4d44d88978f5be5f41bbb212bb6d598d3eb"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMwODExNg==", "bodyText": "Moved the class to the top", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r480308116", "createdAt": "2020-08-31T18:25:17Z", "author": {"login": "pail23"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,163 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.DEFAULT_WAIT_BEFORE_INITIAL_REFRESH;\n+\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import com.google.gson.Gson;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to myStrom: \";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private @Nullable MyStromConfiguration config;\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    @Nullable\n+    private ScheduledFuture<?> pollingJob;\n+\n+    private final Gson gson = new Gson();\n+\n+    public MyStromHandler(Thing thing, HttpClient httpClient) {\n+        super(thing);\n+        this.httpClient = httpClient;\n+    }\n+\n+    private static class MyStromReport {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTkzMTY4OQ=="}, "originalCommit": {"oid": "b592c4d44d88978f5be5f41bbb212bb6d598d3eb"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMDg2OTI1OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwNjo1OTozNFrOHJs17Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxODoyNToyOVrOHKDsEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTkzMzkzMw==", "bodyText": "refresh is called for each channel. So if you have 3 items linked to channels. This is called 3 times. It's also called in a different thread as the polling job, so they might be called at the same time. A solution is to use ExpiringCache from openHAB core. You can use MyStromReport as the data to manager and for example use a timeout of 3 seconds. So if the data is requested within 3 seconds it returns the cached data.", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r479933933", "createdAt": "2020-08-31T06:59:34Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,163 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.DEFAULT_WAIT_BEFORE_INITIAL_REFRESH;\n+\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import com.google.gson.Gson;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to myStrom: \";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private @Nullable MyStromConfiguration config;\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    @Nullable\n+    private ScheduledFuture<?> pollingJob;\n+\n+    private final Gson gson = new Gson();\n+\n+    public MyStromHandler(Thing thing, HttpClient httpClient) {\n+        super(thing);\n+        this.httpClient = httpClient;\n+    }\n+\n+    private static class MyStromReport {\n+\n+        public float power;\n+        public boolean relay;\n+        public float temperature;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        try {\n+            if (command instanceof RefreshType) {\n+                pollDevice();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b592c4d44d88978f5be5f41bbb212bb6d598d3eb"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMwODI0MQ==", "bodyText": "Added the expiry cache", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r480308241", "createdAt": "2020-08-31T18:25:29Z", "author": {"login": "pail23"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,163 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.DEFAULT_WAIT_BEFORE_INITIAL_REFRESH;\n+\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import com.google.gson.Gson;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to myStrom: \";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private @Nullable MyStromConfiguration config;\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    @Nullable\n+    private ScheduledFuture<?> pollingJob;\n+\n+    private final Gson gson = new Gson();\n+\n+    public MyStromHandler(Thing thing, HttpClient httpClient) {\n+        super(thing);\n+        this.httpClient = httpClient;\n+    }\n+\n+    private static class MyStromReport {\n+\n+        public float power;\n+        public boolean relay;\n+        public float temperature;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        try {\n+            if (command instanceof RefreshType) {\n+                pollDevice();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTkzMzkzMw=="}, "originalCommit": {"oid": "b592c4d44d88978f5be5f41bbb212bb6d598d3eb"}, "originalPosition": 84}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNjA2MzA4OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNVQwOTozNDo0N1rOHNg6bQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQwOToxMzo1NFrOHNnvEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzMjc4MQ==", "bodyText": "It seems a bit unreasonable logging the stack trace when the network fails. You could simply log the exception's message.", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r483932781", "createdAt": "2020-09-05T09:34:47Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,169 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+\n+import java.time.Duration;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import com.google.gson.Gson;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.cache.ExpiringCache;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static class MyStromReport {\n+\n+        public float power;\n+        public boolean relay;\n+        public float temperature;\n+    }\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to myStrom: \";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private @Nullable MyStromConfiguration config;\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    private @Nullable ScheduledFuture<?> pollingJob;\n+    private ExpiringCache<MyStromReport> cache = new ExpiringCache<>(Duration.ofSeconds(3), this::getReport);\n+    private final Gson gson = new Gson();\n+\n+    public MyStromHandler(Thing thing, HttpClient httpClient) {\n+        super(thing);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        try {\n+            if (command instanceof RefreshType) {\n+                pollDevice();\n+            } else {\n+                if (command instanceof OnOffType && CHANNEL_SWITCH.equals(channelUID.getId())) {\n+                    sendHttpGet(\"relay?state=\" + (command == OnOffType.ON ? \"1\" : \"0\"));\n+                    scheduler.schedule(this::pollDevice, 500, TimeUnit.MILLISECONDS);\n+                }\n+\n+            }\n+        } catch (MyStromException e) {\n+            logger.warn(COMMUNICATION_ERROR, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ec98e91c1ab9ba9531efeb1d4e4d0e8362591f9"}, "originalPosition": 94}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDA0NDU2Mw==", "bodyText": "changed to exception message", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r484044563", "createdAt": "2020-09-06T09:13:54Z", "author": {"login": "pail23"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,169 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+\n+import java.time.Duration;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import com.google.gson.Gson;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.cache.ExpiringCache;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static class MyStromReport {\n+\n+        public float power;\n+        public boolean relay;\n+        public float temperature;\n+    }\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to myStrom: \";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private @Nullable MyStromConfiguration config;\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    private @Nullable ScheduledFuture<?> pollingJob;\n+    private ExpiringCache<MyStromReport> cache = new ExpiringCache<>(Duration.ofSeconds(3), this::getReport);\n+    private final Gson gson = new Gson();\n+\n+    public MyStromHandler(Thing thing, HttpClient httpClient) {\n+        super(thing);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        try {\n+            if (command instanceof RefreshType) {\n+                pollDevice();\n+            } else {\n+                if (command instanceof OnOffType && CHANNEL_SWITCH.equals(channelUID.getId())) {\n+                    sendHttpGet(\"relay?state=\" + (command == OnOffType.ON ? \"1\" : \"0\"));\n+                    scheduler.schedule(this::pollDevice, 500, TimeUnit.MILLISECONDS);\n+                }\n+\n+            }\n+        } catch (MyStromException e) {\n+            logger.warn(COMMUNICATION_ERROR, e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzMjc4MQ=="}, "originalCommit": {"oid": "4ec98e91c1ab9ba9531efeb1d4e4d0e8362591f9"}, "originalPosition": 94}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNjA2NTA0OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNVQwOTozNzoxN1rOHNg7Tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQwOToxNDowNlrOHNnvJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzMzAwNw==", "bodyText": "You could use the exception's message to fill the last argument of updateStatus(). The log message would be obsolete, then, as the status update is already logged.", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r483933007", "createdAt": "2020-09-05T09:37:17Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,169 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+\n+import java.time.Duration;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import com.google.gson.Gson;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.cache.ExpiringCache;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static class MyStromReport {\n+\n+        public float power;\n+        public boolean relay;\n+        public float temperature;\n+    }\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to myStrom: \";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private @Nullable MyStromConfiguration config;\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    private @Nullable ScheduledFuture<?> pollingJob;\n+    private ExpiringCache<MyStromReport> cache = new ExpiringCache<>(Duration.ofSeconds(3), this::getReport);\n+    private final Gson gson = new Gson();\n+\n+    public MyStromHandler(Thing thing, HttpClient httpClient) {\n+        super(thing);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        try {\n+            if (command instanceof RefreshType) {\n+                pollDevice();\n+            } else {\n+                if (command instanceof OnOffType && CHANNEL_SWITCH.equals(channelUID.getId())) {\n+                    sendHttpGet(\"relay?state=\" + (command == OnOffType.ON ? \"1\" : \"0\"));\n+                    scheduler.schedule(this::pollDevice, 500, TimeUnit.MILLISECONDS);\n+                }\n+\n+            }\n+        } catch (MyStromException e) {\n+            logger.warn(COMMUNICATION_ERROR, e);\n+        }\n+    }\n+\n+    private @Nullable MyStromReport getReport() {\n+        try {\n+            String returnContent = sendHttpGet(\"report\");\n+            MyStromReport report = gson.fromJson(returnContent, MyStromReport.class);\n+            updateStatus(ThingStatus.ONLINE);\n+            return report;\n+        } catch (MyStromException e) {\n+            logger.debug(COMMUNICATION_ERROR, e);\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, COMMUNICATION_ERROR);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ec98e91c1ab9ba9531efeb1d4e4d0e8362591f9"}, "originalPosition": 106}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDA0NDU4Mg==", "bodyText": "done", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r484044582", "createdAt": "2020-09-06T09:14:06Z", "author": {"login": "pail23"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,169 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+\n+import java.time.Duration;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import com.google.gson.Gson;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.cache.ExpiringCache;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static class MyStromReport {\n+\n+        public float power;\n+        public boolean relay;\n+        public float temperature;\n+    }\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to myStrom: \";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private @Nullable MyStromConfiguration config;\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    private @Nullable ScheduledFuture<?> pollingJob;\n+    private ExpiringCache<MyStromReport> cache = new ExpiringCache<>(Duration.ofSeconds(3), this::getReport);\n+    private final Gson gson = new Gson();\n+\n+    public MyStromHandler(Thing thing, HttpClient httpClient) {\n+        super(thing);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        try {\n+            if (command instanceof RefreshType) {\n+                pollDevice();\n+            } else {\n+                if (command instanceof OnOffType && CHANNEL_SWITCH.equals(channelUID.getId())) {\n+                    sendHttpGet(\"relay?state=\" + (command == OnOffType.ON ? \"1\" : \"0\"));\n+                    scheduler.schedule(this::pollDevice, 500, TimeUnit.MILLISECONDS);\n+                }\n+\n+            }\n+        } catch (MyStromException e) {\n+            logger.warn(COMMUNICATION_ERROR, e);\n+        }\n+    }\n+\n+    private @Nullable MyStromReport getReport() {\n+        try {\n+            String returnContent = sendHttpGet(\"report\");\n+            MyStromReport report = gson.fromJson(returnContent, MyStromReport.class);\n+            updateStatus(ThingStatus.ONLINE);\n+            return report;\n+        } catch (MyStromException e) {\n+            logger.debug(COMMUNICATION_ERROR, e);\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, COMMUNICATION_ERROR);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzMzAwNw=="}, "originalCommit": {"oid": "4ec98e91c1ab9ba9531efeb1d4e4d0e8362591f9"}, "originalPosition": 106}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNjA2NTM1OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNVQwOTozNzo0OFrOHNg7ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQwOToxNDoyMFrOHNnvPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzMzA1MQ==", "bodyText": "Can this message be replaced by using the debugger or by increasing the framework's log level? See point 4 https://www.openhab.org/docs/developer/guidelines.html#f-logging", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r483933051", "createdAt": "2020-09-05T09:37:48Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,169 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+\n+import java.time.Duration;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import com.google.gson.Gson;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.cache.ExpiringCache;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static class MyStromReport {\n+\n+        public float power;\n+        public boolean relay;\n+        public float temperature;\n+    }\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to myStrom: \";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private @Nullable MyStromConfiguration config;\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    private @Nullable ScheduledFuture<?> pollingJob;\n+    private ExpiringCache<MyStromReport> cache = new ExpiringCache<>(Duration.ofSeconds(3), this::getReport);\n+    private final Gson gson = new Gson();\n+\n+    public MyStromHandler(Thing thing, HttpClient httpClient) {\n+        super(thing);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        try {\n+            if (command instanceof RefreshType) {\n+                pollDevice();\n+            } else {\n+                if (command instanceof OnOffType && CHANNEL_SWITCH.equals(channelUID.getId())) {\n+                    sendHttpGet(\"relay?state=\" + (command == OnOffType.ON ? \"1\" : \"0\"));\n+                    scheduler.schedule(this::pollDevice, 500, TimeUnit.MILLISECONDS);\n+                }\n+\n+            }\n+        } catch (MyStromException e) {\n+            logger.warn(COMMUNICATION_ERROR, e);\n+        }\n+    }\n+\n+    private @Nullable MyStromReport getReport() {\n+        try {\n+            String returnContent = sendHttpGet(\"report\");\n+            MyStromReport report = gson.fromJson(returnContent, MyStromReport.class);\n+            updateStatus(ThingStatus.ONLINE);\n+            return report;\n+        } catch (MyStromException e) {\n+            logger.debug(COMMUNICATION_ERROR, e);\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, COMMUNICATION_ERROR);\n+            return null;\n+        }\n+    }\n+\n+    private void pollDevice() {\n+        MyStromReport report = cache.getValue();\n+        if (report != null) {\n+            updateState(CHANNEL_SWITCH, report.relay ? OnOffType.ON : OnOffType.OFF);\n+            updateState(CHANNEL_POWER, QuantityType.valueOf(report.power, WATT));\n+            updateState(CHANNEL_TEMPERATURE, QuantityType.valueOf(report.temperature, CELSIUS));\n+            updateStatus(ThingStatus.ONLINE);\n+        } else {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, COMMUNICATION_ERROR);\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Start initializing!\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ec98e91c1ab9ba9531efeb1d4e4d0e8362591f9"}, "originalPosition": 125}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDA0NDYwNA==", "bodyText": "removed the log entry", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r484044604", "createdAt": "2020-09-06T09:14:20Z", "author": {"login": "pail23"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,169 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+\n+import java.time.Duration;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import com.google.gson.Gson;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.cache.ExpiringCache;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static class MyStromReport {\n+\n+        public float power;\n+        public boolean relay;\n+        public float temperature;\n+    }\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to myStrom: \";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private @Nullable MyStromConfiguration config;\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    private @Nullable ScheduledFuture<?> pollingJob;\n+    private ExpiringCache<MyStromReport> cache = new ExpiringCache<>(Duration.ofSeconds(3), this::getReport);\n+    private final Gson gson = new Gson();\n+\n+    public MyStromHandler(Thing thing, HttpClient httpClient) {\n+        super(thing);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        try {\n+            if (command instanceof RefreshType) {\n+                pollDevice();\n+            } else {\n+                if (command instanceof OnOffType && CHANNEL_SWITCH.equals(channelUID.getId())) {\n+                    sendHttpGet(\"relay?state=\" + (command == OnOffType.ON ? \"1\" : \"0\"));\n+                    scheduler.schedule(this::pollDevice, 500, TimeUnit.MILLISECONDS);\n+                }\n+\n+            }\n+        } catch (MyStromException e) {\n+            logger.warn(COMMUNICATION_ERROR, e);\n+        }\n+    }\n+\n+    private @Nullable MyStromReport getReport() {\n+        try {\n+            String returnContent = sendHttpGet(\"report\");\n+            MyStromReport report = gson.fromJson(returnContent, MyStromReport.class);\n+            updateStatus(ThingStatus.ONLINE);\n+            return report;\n+        } catch (MyStromException e) {\n+            logger.debug(COMMUNICATION_ERROR, e);\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, COMMUNICATION_ERROR);\n+            return null;\n+        }\n+    }\n+\n+    private void pollDevice() {\n+        MyStromReport report = cache.getValue();\n+        if (report != null) {\n+            updateState(CHANNEL_SWITCH, report.relay ? OnOffType.ON : OnOffType.OFF);\n+            updateState(CHANNEL_POWER, QuantityType.valueOf(report.power, WATT));\n+            updateState(CHANNEL_TEMPERATURE, QuantityType.valueOf(report.temperature, CELSIUS));\n+            updateStatus(ThingStatus.ONLINE);\n+        } else {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, COMMUNICATION_ERROR);\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Start initializing!\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzMzA1MQ=="}, "originalCommit": {"oid": "4ec98e91c1ab9ba9531efeb1d4e4d0e8362591f9"}, "originalPosition": 125}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNjA2NTkzOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNVQwOTozODo0NFrOHNg7yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQwOToxNDoyNlrOHNnvSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzMzEzMA==", "bodyText": "If you make config a local variable, the compiler warning would be gone.", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r483933130", "createdAt": "2020-09-05T09:38:44Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,169 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+\n+import java.time.Duration;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import com.google.gson.Gson;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.cache.ExpiringCache;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static class MyStromReport {\n+\n+        public float power;\n+        public boolean relay;\n+        public float temperature;\n+    }\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to myStrom: \";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private @Nullable MyStromConfiguration config;\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    private @Nullable ScheduledFuture<?> pollingJob;\n+    private ExpiringCache<MyStromReport> cache = new ExpiringCache<>(Duration.ofSeconds(3), this::getReport);\n+    private final Gson gson = new Gson();\n+\n+    public MyStromHandler(Thing thing, HttpClient httpClient) {\n+        super(thing);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        try {\n+            if (command instanceof RefreshType) {\n+                pollDevice();\n+            } else {\n+                if (command instanceof OnOffType && CHANNEL_SWITCH.equals(channelUID.getId())) {\n+                    sendHttpGet(\"relay?state=\" + (command == OnOffType.ON ? \"1\" : \"0\"));\n+                    scheduler.schedule(this::pollDevice, 500, TimeUnit.MILLISECONDS);\n+                }\n+\n+            }\n+        } catch (MyStromException e) {\n+            logger.warn(COMMUNICATION_ERROR, e);\n+        }\n+    }\n+\n+    private @Nullable MyStromReport getReport() {\n+        try {\n+            String returnContent = sendHttpGet(\"report\");\n+            MyStromReport report = gson.fromJson(returnContent, MyStromReport.class);\n+            updateStatus(ThingStatus.ONLINE);\n+            return report;\n+        } catch (MyStromException e) {\n+            logger.debug(COMMUNICATION_ERROR, e);\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, COMMUNICATION_ERROR);\n+            return null;\n+        }\n+    }\n+\n+    private void pollDevice() {\n+        MyStromReport report = cache.getValue();\n+        if (report != null) {\n+            updateState(CHANNEL_SWITCH, report.relay ? OnOffType.ON : OnOffType.OFF);\n+            updateState(CHANNEL_POWER, QuantityType.valueOf(report.power, WATT));\n+            updateState(CHANNEL_TEMPERATURE, QuantityType.valueOf(report.temperature, CELSIUS));\n+            updateStatus(ThingStatus.ONLINE);\n+        } else {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, COMMUNICATION_ERROR);\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Start initializing!\");\n+        config = getConfigAs(MyStromConfiguration.class);\n+        hostname = config.hostname;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ec98e91c1ab9ba9531efeb1d4e4d0e8362591f9"}, "originalPosition": 127}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDA0NDYxNw==", "bodyText": "done", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r484044617", "createdAt": "2020-09-06T09:14:26Z", "author": {"login": "pail23"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,169 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+\n+import java.time.Duration;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import com.google.gson.Gson;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.cache.ExpiringCache;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static class MyStromReport {\n+\n+        public float power;\n+        public boolean relay;\n+        public float temperature;\n+    }\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to myStrom: \";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private @Nullable MyStromConfiguration config;\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    private @Nullable ScheduledFuture<?> pollingJob;\n+    private ExpiringCache<MyStromReport> cache = new ExpiringCache<>(Duration.ofSeconds(3), this::getReport);\n+    private final Gson gson = new Gson();\n+\n+    public MyStromHandler(Thing thing, HttpClient httpClient) {\n+        super(thing);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        try {\n+            if (command instanceof RefreshType) {\n+                pollDevice();\n+            } else {\n+                if (command instanceof OnOffType && CHANNEL_SWITCH.equals(channelUID.getId())) {\n+                    sendHttpGet(\"relay?state=\" + (command == OnOffType.ON ? \"1\" : \"0\"));\n+                    scheduler.schedule(this::pollDevice, 500, TimeUnit.MILLISECONDS);\n+                }\n+\n+            }\n+        } catch (MyStromException e) {\n+            logger.warn(COMMUNICATION_ERROR, e);\n+        }\n+    }\n+\n+    private @Nullable MyStromReport getReport() {\n+        try {\n+            String returnContent = sendHttpGet(\"report\");\n+            MyStromReport report = gson.fromJson(returnContent, MyStromReport.class);\n+            updateStatus(ThingStatus.ONLINE);\n+            return report;\n+        } catch (MyStromException e) {\n+            logger.debug(COMMUNICATION_ERROR, e);\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, COMMUNICATION_ERROR);\n+            return null;\n+        }\n+    }\n+\n+    private void pollDevice() {\n+        MyStromReport report = cache.getValue();\n+        if (report != null) {\n+            updateState(CHANNEL_SWITCH, report.relay ? OnOffType.ON : OnOffType.OFF);\n+            updateState(CHANNEL_POWER, QuantityType.valueOf(report.power, WATT));\n+            updateState(CHANNEL_TEMPERATURE, QuantityType.valueOf(report.temperature, CELSIUS));\n+            updateStatus(ThingStatus.ONLINE);\n+        } else {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, COMMUNICATION_ERROR);\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Start initializing!\");\n+        config = getConfigAs(MyStromConfiguration.class);\n+        hostname = config.hostname;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzMzEzMA=="}, "originalCommit": {"oid": "4ec98e91c1ab9ba9531efeb1d4e4d0e8362591f9"}, "originalPosition": 127}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNjA2NjI2OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNVQwOTozOToxMlrOHNg79A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQwOToxNDozNFrOHNnvTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzMzE3Mg==", "bodyText": "Can this message be replaced by using the debugger or by increasing the framework's log level?", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r483933172", "createdAt": "2020-09-05T09:39:12Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,169 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+\n+import java.time.Duration;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import com.google.gson.Gson;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.cache.ExpiringCache;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static class MyStromReport {\n+\n+        public float power;\n+        public boolean relay;\n+        public float temperature;\n+    }\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to myStrom: \";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private @Nullable MyStromConfiguration config;\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    private @Nullable ScheduledFuture<?> pollingJob;\n+    private ExpiringCache<MyStromReport> cache = new ExpiringCache<>(Duration.ofSeconds(3), this::getReport);\n+    private final Gson gson = new Gson();\n+\n+    public MyStromHandler(Thing thing, HttpClient httpClient) {\n+        super(thing);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        try {\n+            if (command instanceof RefreshType) {\n+                pollDevice();\n+            } else {\n+                if (command instanceof OnOffType && CHANNEL_SWITCH.equals(channelUID.getId())) {\n+                    sendHttpGet(\"relay?state=\" + (command == OnOffType.ON ? \"1\" : \"0\"));\n+                    scheduler.schedule(this::pollDevice, 500, TimeUnit.MILLISECONDS);\n+                }\n+\n+            }\n+        } catch (MyStromException e) {\n+            logger.warn(COMMUNICATION_ERROR, e);\n+        }\n+    }\n+\n+    private @Nullable MyStromReport getReport() {\n+        try {\n+            String returnContent = sendHttpGet(\"report\");\n+            MyStromReport report = gson.fromJson(returnContent, MyStromReport.class);\n+            updateStatus(ThingStatus.ONLINE);\n+            return report;\n+        } catch (MyStromException e) {\n+            logger.debug(COMMUNICATION_ERROR, e);\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, COMMUNICATION_ERROR);\n+            return null;\n+        }\n+    }\n+\n+    private void pollDevice() {\n+        MyStromReport report = cache.getValue();\n+        if (report != null) {\n+            updateState(CHANNEL_SWITCH, report.relay ? OnOffType.ON : OnOffType.OFF);\n+            updateState(CHANNEL_POWER, QuantityType.valueOf(report.power, WATT));\n+            updateState(CHANNEL_TEMPERATURE, QuantityType.valueOf(report.temperature, CELSIUS));\n+            updateStatus(ThingStatus.ONLINE);\n+        } else {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, COMMUNICATION_ERROR);\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Start initializing!\");\n+        config = getConfigAs(MyStromConfiguration.class);\n+        hostname = config.hostname;\n+\n+        updateStatus(ThingStatus.UNKNOWN);\n+        pollingJob = scheduler.scheduleWithFixedDelay(this::pollDevice, 0, config.refresh, TimeUnit.SECONDS);\n+\n+        logger.debug(\"Finished initializing!\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ec98e91c1ab9ba9531efeb1d4e4d0e8362591f9"}, "originalPosition": 132}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDA0NDYyMg==", "bodyText": "removed the log entry", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r484044622", "createdAt": "2020-09-06T09:14:34Z", "author": {"login": "pail23"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,169 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+\n+import java.time.Duration;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import com.google.gson.Gson;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.cache.ExpiringCache;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static class MyStromReport {\n+\n+        public float power;\n+        public boolean relay;\n+        public float temperature;\n+    }\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to myStrom: \";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private @Nullable MyStromConfiguration config;\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    private @Nullable ScheduledFuture<?> pollingJob;\n+    private ExpiringCache<MyStromReport> cache = new ExpiringCache<>(Duration.ofSeconds(3), this::getReport);\n+    private final Gson gson = new Gson();\n+\n+    public MyStromHandler(Thing thing, HttpClient httpClient) {\n+        super(thing);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        try {\n+            if (command instanceof RefreshType) {\n+                pollDevice();\n+            } else {\n+                if (command instanceof OnOffType && CHANNEL_SWITCH.equals(channelUID.getId())) {\n+                    sendHttpGet(\"relay?state=\" + (command == OnOffType.ON ? \"1\" : \"0\"));\n+                    scheduler.schedule(this::pollDevice, 500, TimeUnit.MILLISECONDS);\n+                }\n+\n+            }\n+        } catch (MyStromException e) {\n+            logger.warn(COMMUNICATION_ERROR, e);\n+        }\n+    }\n+\n+    private @Nullable MyStromReport getReport() {\n+        try {\n+            String returnContent = sendHttpGet(\"report\");\n+            MyStromReport report = gson.fromJson(returnContent, MyStromReport.class);\n+            updateStatus(ThingStatus.ONLINE);\n+            return report;\n+        } catch (MyStromException e) {\n+            logger.debug(COMMUNICATION_ERROR, e);\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, COMMUNICATION_ERROR);\n+            return null;\n+        }\n+    }\n+\n+    private void pollDevice() {\n+        MyStromReport report = cache.getValue();\n+        if (report != null) {\n+            updateState(CHANNEL_SWITCH, report.relay ? OnOffType.ON : OnOffType.OFF);\n+            updateState(CHANNEL_POWER, QuantityType.valueOf(report.power, WATT));\n+            updateState(CHANNEL_TEMPERATURE, QuantityType.valueOf(report.temperature, CELSIUS));\n+            updateStatus(ThingStatus.ONLINE);\n+        } else {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, COMMUNICATION_ERROR);\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Start initializing!\");\n+        config = getConfigAs(MyStromConfiguration.class);\n+        hostname = config.hostname;\n+\n+        updateStatus(ThingStatus.UNKNOWN);\n+        pollingJob = scheduler.scheduleWithFixedDelay(this::pollDevice, 0, config.refresh, TimeUnit.SECONDS);\n+\n+        logger.debug(\"Finished initializing!\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzMzE3Mg=="}, "originalCommit": {"oid": "4ec98e91c1ab9ba9531efeb1d4e4d0e8362591f9"}, "originalPosition": 132}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNjA2NjYzOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNVQwOTozOTo0NVrOHNg8KA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQwOToxNDo0NVrOHNnvZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzMzIyNA==", "bodyText": "Please add a reasonable timeout like 10 sec.", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r483933224", "createdAt": "2020-09-05T09:39:45Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,169 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+\n+import java.time.Duration;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import com.google.gson.Gson;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.cache.ExpiringCache;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static class MyStromReport {\n+\n+        public float power;\n+        public boolean relay;\n+        public float temperature;\n+    }\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to myStrom: \";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private @Nullable MyStromConfiguration config;\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    private @Nullable ScheduledFuture<?> pollingJob;\n+    private ExpiringCache<MyStromReport> cache = new ExpiringCache<>(Duration.ofSeconds(3), this::getReport);\n+    private final Gson gson = new Gson();\n+\n+    public MyStromHandler(Thing thing, HttpClient httpClient) {\n+        super(thing);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        try {\n+            if (command instanceof RefreshType) {\n+                pollDevice();\n+            } else {\n+                if (command instanceof OnOffType && CHANNEL_SWITCH.equals(channelUID.getId())) {\n+                    sendHttpGet(\"relay?state=\" + (command == OnOffType.ON ? \"1\" : \"0\"));\n+                    scheduler.schedule(this::pollDevice, 500, TimeUnit.MILLISECONDS);\n+                }\n+\n+            }\n+        } catch (MyStromException e) {\n+            logger.warn(COMMUNICATION_ERROR, e);\n+        }\n+    }\n+\n+    private @Nullable MyStromReport getReport() {\n+        try {\n+            String returnContent = sendHttpGet(\"report\");\n+            MyStromReport report = gson.fromJson(returnContent, MyStromReport.class);\n+            updateStatus(ThingStatus.ONLINE);\n+            return report;\n+        } catch (MyStromException e) {\n+            logger.debug(COMMUNICATION_ERROR, e);\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, COMMUNICATION_ERROR);\n+            return null;\n+        }\n+    }\n+\n+    private void pollDevice() {\n+        MyStromReport report = cache.getValue();\n+        if (report != null) {\n+            updateState(CHANNEL_SWITCH, report.relay ? OnOffType.ON : OnOffType.OFF);\n+            updateState(CHANNEL_POWER, QuantityType.valueOf(report.power, WATT));\n+            updateState(CHANNEL_TEMPERATURE, QuantityType.valueOf(report.temperature, CELSIUS));\n+            updateStatus(ThingStatus.ONLINE);\n+        } else {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, COMMUNICATION_ERROR);\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Start initializing!\");\n+        config = getConfigAs(MyStromConfiguration.class);\n+        hostname = config.hostname;\n+\n+        updateStatus(ThingStatus.UNKNOWN);\n+        pollingJob = scheduler.scheduleWithFixedDelay(this::pollDevice, 0, config.refresh, TimeUnit.SECONDS);\n+\n+        logger.debug(\"Finished initializing!\");\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        super.dispose();\n+\n+        if (pollingJob != null) {\n+            pollingJob.cancel(true);\n+            pollingJob = null;\n+        }\n+    }\n+\n+    /**\n+     * Given a URL and a set parameters, send a HTTP GET request to the URL location\n+     * created by the URL and parameters.\n+     *\n+     * @param url The URL to send a GET request to.\n+     * @return String contents of the response for the GET request.\n+     * @throws Exception\n+     */\n+    public String sendHttpGet(String action) throws MyStromException {\n+\n+        String url = \"http://\" + hostname + \"/\" + action;\n+        ContentResponse response = null;\n+        try {\n+            response = httpClient.newRequest(url).method(HttpMethod.GET).send();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ec98e91c1ab9ba9531efeb1d4e4d0e8362591f9"}, "originalPosition": 158}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDA0NDY0NA==", "bodyText": "added a 10 sec timeout", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r484044644", "createdAt": "2020-09-06T09:14:45Z", "author": {"login": "pail23"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,169 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+\n+import java.time.Duration;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import com.google.gson.Gson;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.cache.ExpiringCache;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static class MyStromReport {\n+\n+        public float power;\n+        public boolean relay;\n+        public float temperature;\n+    }\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to myStrom: \";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private @Nullable MyStromConfiguration config;\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    private @Nullable ScheduledFuture<?> pollingJob;\n+    private ExpiringCache<MyStromReport> cache = new ExpiringCache<>(Duration.ofSeconds(3), this::getReport);\n+    private final Gson gson = new Gson();\n+\n+    public MyStromHandler(Thing thing, HttpClient httpClient) {\n+        super(thing);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        try {\n+            if (command instanceof RefreshType) {\n+                pollDevice();\n+            } else {\n+                if (command instanceof OnOffType && CHANNEL_SWITCH.equals(channelUID.getId())) {\n+                    sendHttpGet(\"relay?state=\" + (command == OnOffType.ON ? \"1\" : \"0\"));\n+                    scheduler.schedule(this::pollDevice, 500, TimeUnit.MILLISECONDS);\n+                }\n+\n+            }\n+        } catch (MyStromException e) {\n+            logger.warn(COMMUNICATION_ERROR, e);\n+        }\n+    }\n+\n+    private @Nullable MyStromReport getReport() {\n+        try {\n+            String returnContent = sendHttpGet(\"report\");\n+            MyStromReport report = gson.fromJson(returnContent, MyStromReport.class);\n+            updateStatus(ThingStatus.ONLINE);\n+            return report;\n+        } catch (MyStromException e) {\n+            logger.debug(COMMUNICATION_ERROR, e);\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, COMMUNICATION_ERROR);\n+            return null;\n+        }\n+    }\n+\n+    private void pollDevice() {\n+        MyStromReport report = cache.getValue();\n+        if (report != null) {\n+            updateState(CHANNEL_SWITCH, report.relay ? OnOffType.ON : OnOffType.OFF);\n+            updateState(CHANNEL_POWER, QuantityType.valueOf(report.power, WATT));\n+            updateState(CHANNEL_TEMPERATURE, QuantityType.valueOf(report.temperature, CELSIUS));\n+            updateStatus(ThingStatus.ONLINE);\n+        } else {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, COMMUNICATION_ERROR);\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Start initializing!\");\n+        config = getConfigAs(MyStromConfiguration.class);\n+        hostname = config.hostname;\n+\n+        updateStatus(ThingStatus.UNKNOWN);\n+        pollingJob = scheduler.scheduleWithFixedDelay(this::pollDevice, 0, config.refresh, TimeUnit.SECONDS);\n+\n+        logger.debug(\"Finished initializing!\");\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        super.dispose();\n+\n+        if (pollingJob != null) {\n+            pollingJob.cancel(true);\n+            pollingJob = null;\n+        }\n+    }\n+\n+    /**\n+     * Given a URL and a set parameters, send a HTTP GET request to the URL location\n+     * created by the URL and parameters.\n+     *\n+     * @param url The URL to send a GET request to.\n+     * @return String contents of the response for the GET request.\n+     * @throws Exception\n+     */\n+    public String sendHttpGet(String action) throws MyStromException {\n+\n+        String url = \"http://\" + hostname + \"/\" + action;\n+        ContentResponse response = null;\n+        try {\n+            response = httpClient.newRequest(url).method(HttpMethod.GET).send();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzMzIyNA=="}, "originalCommit": {"oid": "4ec98e91c1ab9ba9531efeb1d4e4d0e8362591f9"}, "originalPosition": 158}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNjA2ODY2OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.mystrom/src/main/resources/ESH-INF/thing/thing-types.xml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNVQwOTo0Mjo0M1rOHNg9KA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQwOToxNDo1M1rOHNnvfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzMzQ4MA==", "bodyText": "Is there a reason why you don't use https by default? You could remove the protocol here and add <context>network-address</context> to get a free validation, then.", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r483933480", "createdAt": "2020-09-05T09:42:43Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.mystrom/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -0,0 +1,53 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"mystrom\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<thing-type id=\"mystromplug\">\n+\t\t<label>myStrom Smart Plug</label>\n+\t\t<description>Controls the myStrom smart plug</description>\n+\n+\t\t<channels>\n+\t\t\t<channel id=\"switch\" typeId=\"switch-channel\"/>\n+\t\t\t<channel id=\"power\" typeId=\"power-channel\"/>\n+\t\t\t<channel id=\"temperature\" typeId=\"temperature-channel\"/>\n+\t\t</channels>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"hostname\" type=\"text\">\n+\t\t\t\t<label>Hostname</label>\n+\t\t\t\t<description>The host name or IP address of the mystrom plug. It may or may not start with the\n+\t\t\t\t\tprotocol, e.g. in\n+\t\t\t\t\torder to use https:// instead of the default http://.</description>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ec98e91c1ab9ba9531efeb1d4e4d0e8362591f9"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDA0NDY2OQ==", "bodyText": "done", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r484044669", "createdAt": "2020-09-06T09:14:53Z", "author": {"login": "pail23"}, "path": "bundles/org.openhab.binding.mystrom/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -0,0 +1,53 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"mystrom\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<thing-type id=\"mystromplug\">\n+\t\t<label>myStrom Smart Plug</label>\n+\t\t<description>Controls the myStrom smart plug</description>\n+\n+\t\t<channels>\n+\t\t\t<channel id=\"switch\" typeId=\"switch-channel\"/>\n+\t\t\t<channel id=\"power\" typeId=\"power-channel\"/>\n+\t\t\t<channel id=\"temperature\" typeId=\"temperature-channel\"/>\n+\t\t</channels>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"hostname\" type=\"text\">\n+\t\t\t\t<label>Hostname</label>\n+\t\t\t\t<description>The host name or IP address of the mystrom plug. It may or may not start with the\n+\t\t\t\t\tprotocol, e.g. in\n+\t\t\t\t\torder to use https:// instead of the default http://.</description>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzMzQ4MA=="}, "originalCommit": {"oid": "4ec98e91c1ab9ba9531efeb1d4e4d0e8362591f9"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNjA2OTE5OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.mystrom/src/main/resources/ESH-INF/thing/thing-types.xml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNVQwOTo0Mzo1M1rOHNg9cQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQwOToxNTowMFrOHNnvnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzMzU1Mw==", "bodyText": "You might want to specify a reasonable min value (e.g. 1). If the user specifys a 0 or a negative value, your code will crash.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t<parameter name=\"refresh\" type=\"integer\">\n          \n          \n            \n            \t\t\t<parameter name=\"refresh\" type=\"integer\" unit=\"s\">", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r483933553", "createdAt": "2020-09-05T09:43:53Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.mystrom/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -0,0 +1,53 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"mystrom\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<thing-type id=\"mystromplug\">\n+\t\t<label>myStrom Smart Plug</label>\n+\t\t<description>Controls the myStrom smart plug</description>\n+\n+\t\t<channels>\n+\t\t\t<channel id=\"switch\" typeId=\"switch-channel\"/>\n+\t\t\t<channel id=\"power\" typeId=\"power-channel\"/>\n+\t\t\t<channel id=\"temperature\" typeId=\"temperature-channel\"/>\n+\t\t</channels>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"hostname\" type=\"text\">\n+\t\t\t\t<label>Hostname</label>\n+\t\t\t\t<description>The host name or IP address of the mystrom plug. It may or may not start with the\n+\t\t\t\t\tprotocol, e.g. in\n+\t\t\t\t\torder to use https:// instead of the default http://.</description>\n+\t\t\t\t<default>localhost</default>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"refresh\" type=\"integer\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ec98e91c1ab9ba9531efeb1d4e4d0e8362591f9"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDA0NDcwMQ==", "bodyText": "done", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r484044701", "createdAt": "2020-09-06T09:15:00Z", "author": {"login": "pail23"}, "path": "bundles/org.openhab.binding.mystrom/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -0,0 +1,53 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"mystrom\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<thing-type id=\"mystromplug\">\n+\t\t<label>myStrom Smart Plug</label>\n+\t\t<description>Controls the myStrom smart plug</description>\n+\n+\t\t<channels>\n+\t\t\t<channel id=\"switch\" typeId=\"switch-channel\"/>\n+\t\t\t<channel id=\"power\" typeId=\"power-channel\"/>\n+\t\t\t<channel id=\"temperature\" typeId=\"temperature-channel\"/>\n+\t\t</channels>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"hostname\" type=\"text\">\n+\t\t\t\t<label>Hostname</label>\n+\t\t\t\t<description>The host name or IP address of the mystrom plug. It may or may not start with the\n+\t\t\t\t\tprotocol, e.g. in\n+\t\t\t\t\torder to use https:// instead of the default http://.</description>\n+\t\t\t\t<default>localhost</default>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"refresh\" type=\"integer\">", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzMzU1Mw=="}, "originalCommit": {"oid": "4ec98e91c1ab9ba9531efeb1d4e4d0e8362591f9"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNjA3MDQwOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.mystrom/src/main/resources/ESH-INF/thing/thing-types.xml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNVQwOTo0NToyN1rOHNg-Aw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQwOToxNTowN1rOHNnvsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzMzY5OQ==", "bodyText": "You could use the system type. Then, you don't need to specify your own Channel type.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t<channel id=\"switch\" typeId=\"switch-channel\"/>\n          \n          \n            \n            \t\t\t<channel id=\"switch\" typeId=\"system.power\"/>", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r483933699", "createdAt": "2020-09-05T09:45:27Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.mystrom/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -0,0 +1,53 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"mystrom\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<thing-type id=\"mystromplug\">\n+\t\t<label>myStrom Smart Plug</label>\n+\t\t<description>Controls the myStrom smart plug</description>\n+\n+\t\t<channels>\n+\t\t\t<channel id=\"switch\" typeId=\"switch-channel\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ec98e91c1ab9ba9531efeb1d4e4d0e8362591f9"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDA0NDcyMQ==", "bodyText": "done", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r484044721", "createdAt": "2020-09-06T09:15:07Z", "author": {"login": "pail23"}, "path": "bundles/org.openhab.binding.mystrom/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -0,0 +1,53 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"mystrom\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<thing-type id=\"mystromplug\">\n+\t\t<label>myStrom Smart Plug</label>\n+\t\t<description>Controls the myStrom smart plug</description>\n+\n+\t\t<channels>\n+\t\t\t<channel id=\"switch\" typeId=\"switch-channel\"/>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzMzY5OQ=="}, "originalCommit": {"oid": "4ec98e91c1ab9ba9531efeb1d4e4d0e8362591f9"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNzQwMzY4OnYy", "diffSide": "RIGHT", "path": "bundles/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQxNzowNzozM1rOHNqsWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQxNzowNzozM1rOHNqsWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDA5MzAxOA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                <module>org.openhab.binding.mystrom</module>    \n          \n          \n            \n                <module>org.openhab.binding.mystrom</module>", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r484093018", "createdAt": "2020-09-06T17:07:33Z", "author": {"login": "Hilbrand"}, "path": "bundles/pom.xml", "diffHunk": "@@ -173,6 +173,7 @@\n     <module>org.openhab.binding.mqtt.generic</module>\n     <module>org.openhab.binding.mqtt.homeassistant</module>\n     <module>org.openhab.binding.mqtt.homie</module>\n+    <module>org.openhab.binding.mystrom</module>    ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "247dd57b571bfe25a5560fc0a460dc6a4a061866"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNzQ1MjAwOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.mystrom/.project", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQxODoxMjoyNlrOHNrDWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQyMDowODoyOFrOHNrqpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDA5ODkwNQ==", "bodyText": "Can this be removed?", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r484098905", "createdAt": "2020-09-06T18:12:26Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.mystrom/.project", "diffHunk": "@@ -0,0 +1,28 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<projectDescription>\n+\t<name>org.openhab.binding.mystrom</name>\n+\t<comment></comment>\n+\t<projects>\n+\t</projects>\n+\t<buildSpec>\n+\t\t<buildCommand>\n+\t\t\t<name>org.eclipse.m2e.core.maven2Builder</name>\n+\t\t\t<arguments>\n+\t\t\t</arguments>\n+\t\t</buildCommand>\n+\t</buildSpec>\n+\t<natures>\n+\t\t<nature>org.eclipse.m2e.core.maven2Nature</nature>\n+\t</natures>\n+\t<filteredResources>\n+\t\t<filter>\n+\t\t\t<id>1599248758658</id>\n+\t\t\t<name></name>\n+\t\t\t<type>30</type>\n+\t\t\t<matcher>\n+\t\t\t\t<id>org.eclipse.core.resources.regexFilterMatcher</id>\n+\t\t\t\t<arguments>node_modules|.git|__CREATED_BY_JAVA_LANGUAGE_SERVER__</arguments>\n+\t\t\t</matcher>\n+\t\t</filter>\n+\t</filteredResources>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2d8c7dacd83a4b9065f330f1e517bd3d6035b5a"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDEwODk2NA==", "bodyText": "done", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r484108964", "createdAt": "2020-09-06T20:08:28Z", "author": {"login": "pail23"}, "path": "bundles/org.openhab.binding.mystrom/.project", "diffHunk": "@@ -0,0 +1,28 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<projectDescription>\n+\t<name>org.openhab.binding.mystrom</name>\n+\t<comment></comment>\n+\t<projects>\n+\t</projects>\n+\t<buildSpec>\n+\t\t<buildCommand>\n+\t\t\t<name>org.eclipse.m2e.core.maven2Builder</name>\n+\t\t\t<arguments>\n+\t\t\t</arguments>\n+\t\t</buildCommand>\n+\t</buildSpec>\n+\t<natures>\n+\t\t<nature>org.eclipse.m2e.core.maven2Nature</nature>\n+\t</natures>\n+\t<filteredResources>\n+\t\t<filter>\n+\t\t\t<id>1599248758658</id>\n+\t\t\t<name></name>\n+\t\t\t<type>30</type>\n+\t\t\t<matcher>\n+\t\t\t\t<id>org.eclipse.core.resources.regexFilterMatcher</id>\n+\t\t\t\t<arguments>node_modules|.git|__CREATED_BY_JAVA_LANGUAGE_SERVER__</arguments>\n+\t\t\t</matcher>\n+\t\t</filter>\n+\t</filteredResources>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDA5ODkwNQ=="}, "originalCommit": {"oid": "e2d8c7dacd83a4b9065f330f1e517bd3d6035b5a"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNzQ1Mzk2OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQxODoxNDo1M1rOHNrESQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQyMDoxNTo1NlrOHNrtEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDA5OTE0NQ==", "bodyText": "Can this if be removed, then?", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r484099145", "createdAt": "2020-09-06T18:14:53Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,166 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+\n+import java.time.Duration;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.cache.ExpiringCache;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static class MyStromReport {\n+\n+        public float power;\n+        public boolean relay;\n+        public float temperature;\n+    }\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to the myStrom plug: \";\n+    private static final String HTTP_REQUEST_URL_PREFIX = \"http://\";\n+    private static final String HTTPS_REQUEST_URL_PREFIX = \"https://\";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    private @Nullable ScheduledFuture<?> pollingJob;\n+    private ExpiringCache<MyStromReport> cache = new ExpiringCache<>(Duration.ofSeconds(3), this::getReport);\n+    private final Gson gson = new Gson();\n+\n+    public MyStromHandler(Thing thing, HttpClient httpClient) {\n+        super(thing);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        try {\n+            if (command instanceof RefreshType) {\n+                pollDevice();\n+            } else {\n+                if (command instanceof OnOffType && CHANNEL_SWITCH.equals(channelUID.getId())) {\n+                    sendHttpGet(\"relay?state=\" + (command == OnOffType.ON ? \"1\" : \"0\"));\n+                    scheduler.schedule(this::pollDevice, 500, TimeUnit.MILLISECONDS);\n+                }\n+            }\n+        } catch (MyStromException e) {\n+            logger.warn(\"Error while handling command {}\", e.getMessage());\n+        }\n+    }\n+\n+    private @Nullable MyStromReport getReport() {\n+        try {\n+            String returnContent = sendHttpGet(\"report\");\n+            MyStromReport report = gson.fromJson(returnContent, MyStromReport.class);\n+            updateStatus(ThingStatus.ONLINE);\n+            return report;\n+        } catch (MyStromException e) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, e.getMessage());\n+            return null;\n+        }\n+    }\n+\n+    private void pollDevice() {\n+        MyStromReport report = cache.getValue();\n+        if (report != null) {\n+            updateState(CHANNEL_SWITCH, report.relay ? OnOffType.ON : OnOffType.OFF);\n+            updateState(CHANNEL_POWER, QuantityType.valueOf(report.power, WATT));\n+            updateState(CHANNEL_TEMPERATURE, QuantityType.valueOf(report.temperature, CELSIUS));\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        MyStromConfiguration config = getConfigAs(MyStromConfiguration.class);\n+        if (config.hostname.startsWith(HTTP_REQUEST_URL_PREFIX)\n+                || config.hostname.startsWith(HTTPS_REQUEST_URL_PREFIX)) {\n+            this.hostname = config.hostname;\n+        } else {\n+            this.hostname = HTTP_REQUEST_URL_PREFIX + config.hostname;\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2d8c7dacd83a4b9065f330f1e517bd3d6035b5a"}, "originalPosition": 127}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDEwODQzOA==", "bodyText": "Why would you remove this? And how would you handle the prefix? Always use http?", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r484108438", "createdAt": "2020-09-06T20:02:44Z", "author": {"login": "pail23"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,166 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+\n+import java.time.Duration;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.cache.ExpiringCache;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static class MyStromReport {\n+\n+        public float power;\n+        public boolean relay;\n+        public float temperature;\n+    }\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to the myStrom plug: \";\n+    private static final String HTTP_REQUEST_URL_PREFIX = \"http://\";\n+    private static final String HTTPS_REQUEST_URL_PREFIX = \"https://\";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    private @Nullable ScheduledFuture<?> pollingJob;\n+    private ExpiringCache<MyStromReport> cache = new ExpiringCache<>(Duration.ofSeconds(3), this::getReport);\n+    private final Gson gson = new Gson();\n+\n+    public MyStromHandler(Thing thing, HttpClient httpClient) {\n+        super(thing);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        try {\n+            if (command instanceof RefreshType) {\n+                pollDevice();\n+            } else {\n+                if (command instanceof OnOffType && CHANNEL_SWITCH.equals(channelUID.getId())) {\n+                    sendHttpGet(\"relay?state=\" + (command == OnOffType.ON ? \"1\" : \"0\"));\n+                    scheduler.schedule(this::pollDevice, 500, TimeUnit.MILLISECONDS);\n+                }\n+            }\n+        } catch (MyStromException e) {\n+            logger.warn(\"Error while handling command {}\", e.getMessage());\n+        }\n+    }\n+\n+    private @Nullable MyStromReport getReport() {\n+        try {\n+            String returnContent = sendHttpGet(\"report\");\n+            MyStromReport report = gson.fromJson(returnContent, MyStromReport.class);\n+            updateStatus(ThingStatus.ONLINE);\n+            return report;\n+        } catch (MyStromException e) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, e.getMessage());\n+            return null;\n+        }\n+    }\n+\n+    private void pollDevice() {\n+        MyStromReport report = cache.getValue();\n+        if (report != null) {\n+            updateState(CHANNEL_SWITCH, report.relay ? OnOffType.ON : OnOffType.OFF);\n+            updateState(CHANNEL_POWER, QuantityType.valueOf(report.power, WATT));\n+            updateState(CHANNEL_TEMPERATURE, QuantityType.valueOf(report.temperature, CELSIUS));\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        MyStromConfiguration config = getConfigAs(MyStromConfiguration.class);\n+        if (config.hostname.startsWith(HTTP_REQUEST_URL_PREFIX)\n+                || config.hostname.startsWith(HTTPS_REQUEST_URL_PREFIX)) {\n+            this.hostname = config.hostname;\n+        } else {\n+            this.hostname = HTTP_REQUEST_URL_PREFIX + config.hostname;\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDA5OTE0NQ=="}, "originalCommit": {"oid": "e2d8c7dacd83a4b9065f330f1e517bd3d6035b5a"}, "originalPosition": 127}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDEwODgwNw==", "bodyText": "As you defined <context>network-address</context> the user cannot enter an URL anymore, but a network address. So, the protocol should be suffixed always with your current implementation.", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r484108807", "createdAt": "2020-09-06T20:06:54Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,166 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+\n+import java.time.Duration;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.cache.ExpiringCache;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static class MyStromReport {\n+\n+        public float power;\n+        public boolean relay;\n+        public float temperature;\n+    }\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to the myStrom plug: \";\n+    private static final String HTTP_REQUEST_URL_PREFIX = \"http://\";\n+    private static final String HTTPS_REQUEST_URL_PREFIX = \"https://\";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    private @Nullable ScheduledFuture<?> pollingJob;\n+    private ExpiringCache<MyStromReport> cache = new ExpiringCache<>(Duration.ofSeconds(3), this::getReport);\n+    private final Gson gson = new Gson();\n+\n+    public MyStromHandler(Thing thing, HttpClient httpClient) {\n+        super(thing);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        try {\n+            if (command instanceof RefreshType) {\n+                pollDevice();\n+            } else {\n+                if (command instanceof OnOffType && CHANNEL_SWITCH.equals(channelUID.getId())) {\n+                    sendHttpGet(\"relay?state=\" + (command == OnOffType.ON ? \"1\" : \"0\"));\n+                    scheduler.schedule(this::pollDevice, 500, TimeUnit.MILLISECONDS);\n+                }\n+            }\n+        } catch (MyStromException e) {\n+            logger.warn(\"Error while handling command {}\", e.getMessage());\n+        }\n+    }\n+\n+    private @Nullable MyStromReport getReport() {\n+        try {\n+            String returnContent = sendHttpGet(\"report\");\n+            MyStromReport report = gson.fromJson(returnContent, MyStromReport.class);\n+            updateStatus(ThingStatus.ONLINE);\n+            return report;\n+        } catch (MyStromException e) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, e.getMessage());\n+            return null;\n+        }\n+    }\n+\n+    private void pollDevice() {\n+        MyStromReport report = cache.getValue();\n+        if (report != null) {\n+            updateState(CHANNEL_SWITCH, report.relay ? OnOffType.ON : OnOffType.OFF);\n+            updateState(CHANNEL_POWER, QuantityType.valueOf(report.power, WATT));\n+            updateState(CHANNEL_TEMPERATURE, QuantityType.valueOf(report.temperature, CELSIUS));\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        MyStromConfiguration config = getConfigAs(MyStromConfiguration.class);\n+        if (config.hostname.startsWith(HTTP_REQUEST_URL_PREFIX)\n+                || config.hostname.startsWith(HTTPS_REQUEST_URL_PREFIX)) {\n+            this.hostname = config.hostname;\n+        } else {\n+            this.hostname = HTTP_REQUEST_URL_PREFIX + config.hostname;\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDA5OTE0NQ=="}, "originalCommit": {"oid": "e2d8c7dacd83a4b9065f330f1e517bd3d6035b5a"}, "originalPosition": 127}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDEwOTU4NA==", "bodyText": "OK, I have adapted the code accordingly", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r484109584", "createdAt": "2020-09-06T20:15:56Z", "author": {"login": "pail23"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,166 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+\n+import java.time.Duration;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.cache.ExpiringCache;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static class MyStromReport {\n+\n+        public float power;\n+        public boolean relay;\n+        public float temperature;\n+    }\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to the myStrom plug: \";\n+    private static final String HTTP_REQUEST_URL_PREFIX = \"http://\";\n+    private static final String HTTPS_REQUEST_URL_PREFIX = \"https://\";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    private @Nullable ScheduledFuture<?> pollingJob;\n+    private ExpiringCache<MyStromReport> cache = new ExpiringCache<>(Duration.ofSeconds(3), this::getReport);\n+    private final Gson gson = new Gson();\n+\n+    public MyStromHandler(Thing thing, HttpClient httpClient) {\n+        super(thing);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        try {\n+            if (command instanceof RefreshType) {\n+                pollDevice();\n+            } else {\n+                if (command instanceof OnOffType && CHANNEL_SWITCH.equals(channelUID.getId())) {\n+                    sendHttpGet(\"relay?state=\" + (command == OnOffType.ON ? \"1\" : \"0\"));\n+                    scheduler.schedule(this::pollDevice, 500, TimeUnit.MILLISECONDS);\n+                }\n+            }\n+        } catch (MyStromException e) {\n+            logger.warn(\"Error while handling command {}\", e.getMessage());\n+        }\n+    }\n+\n+    private @Nullable MyStromReport getReport() {\n+        try {\n+            String returnContent = sendHttpGet(\"report\");\n+            MyStromReport report = gson.fromJson(returnContent, MyStromReport.class);\n+            updateStatus(ThingStatus.ONLINE);\n+            return report;\n+        } catch (MyStromException e) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, e.getMessage());\n+            return null;\n+        }\n+    }\n+\n+    private void pollDevice() {\n+        MyStromReport report = cache.getValue();\n+        if (report != null) {\n+            updateState(CHANNEL_SWITCH, report.relay ? OnOffType.ON : OnOffType.OFF);\n+            updateState(CHANNEL_POWER, QuantityType.valueOf(report.power, WATT));\n+            updateState(CHANNEL_TEMPERATURE, QuantityType.valueOf(report.temperature, CELSIUS));\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        MyStromConfiguration config = getConfigAs(MyStromConfiguration.class);\n+        if (config.hostname.startsWith(HTTP_REQUEST_URL_PREFIX)\n+                || config.hostname.startsWith(HTTPS_REQUEST_URL_PREFIX)) {\n+            this.hostname = config.hostname;\n+        } else {\n+            this.hostname = HTTP_REQUEST_URL_PREFIX + config.hostname;\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDA5OTE0NQ=="}, "originalCommit": {"oid": "e2d8c7dacd83a4b9065f330f1e517bd3d6035b5a"}, "originalPosition": 127}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNzQ1NDU2OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQxODoxNTo0MVrOHNrEkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQyMDowMjo1M1rOHNroqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDA5OTIxNg==", "bodyText": "Base class destructors should be called at the end of the implementing destructors.", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r484099216", "createdAt": "2020-09-06T18:15:41Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,166 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+\n+import java.time.Duration;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.cache.ExpiringCache;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static class MyStromReport {\n+\n+        public float power;\n+        public boolean relay;\n+        public float temperature;\n+    }\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to the myStrom plug: \";\n+    private static final String HTTP_REQUEST_URL_PREFIX = \"http://\";\n+    private static final String HTTPS_REQUEST_URL_PREFIX = \"https://\";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    private @Nullable ScheduledFuture<?> pollingJob;\n+    private ExpiringCache<MyStromReport> cache = new ExpiringCache<>(Duration.ofSeconds(3), this::getReport);\n+    private final Gson gson = new Gson();\n+\n+    public MyStromHandler(Thing thing, HttpClient httpClient) {\n+        super(thing);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        try {\n+            if (command instanceof RefreshType) {\n+                pollDevice();\n+            } else {\n+                if (command instanceof OnOffType && CHANNEL_SWITCH.equals(channelUID.getId())) {\n+                    sendHttpGet(\"relay?state=\" + (command == OnOffType.ON ? \"1\" : \"0\"));\n+                    scheduler.schedule(this::pollDevice, 500, TimeUnit.MILLISECONDS);\n+                }\n+            }\n+        } catch (MyStromException e) {\n+            logger.warn(\"Error while handling command {}\", e.getMessage());\n+        }\n+    }\n+\n+    private @Nullable MyStromReport getReport() {\n+        try {\n+            String returnContent = sendHttpGet(\"report\");\n+            MyStromReport report = gson.fromJson(returnContent, MyStromReport.class);\n+            updateStatus(ThingStatus.ONLINE);\n+            return report;\n+        } catch (MyStromException e) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, e.getMessage());\n+            return null;\n+        }\n+    }\n+\n+    private void pollDevice() {\n+        MyStromReport report = cache.getValue();\n+        if (report != null) {\n+            updateState(CHANNEL_SWITCH, report.relay ? OnOffType.ON : OnOffType.OFF);\n+            updateState(CHANNEL_POWER, QuantityType.valueOf(report.power, WATT));\n+            updateState(CHANNEL_TEMPERATURE, QuantityType.valueOf(report.temperature, CELSIUS));\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        MyStromConfiguration config = getConfigAs(MyStromConfiguration.class);\n+        if (config.hostname.startsWith(HTTP_REQUEST_URL_PREFIX)\n+                || config.hostname.startsWith(HTTPS_REQUEST_URL_PREFIX)) {\n+            this.hostname = config.hostname;\n+        } else {\n+            this.hostname = HTTP_REQUEST_URL_PREFIX + config.hostname;\n+        }\n+\n+        updateStatus(ThingStatus.UNKNOWN);\n+        pollingJob = scheduler.scheduleWithFixedDelay(this::pollDevice, 0, config.refresh, TimeUnit.SECONDS);\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        super.dispose();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2d8c7dacd83a4b9065f330f1e517bd3d6035b5a"}, "originalPosition": 135}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDEwODQ1Ng==", "bodyText": "done", "url": "https://github.com/openhab/openhab-addons/pull/8362#discussion_r484108456", "createdAt": "2020-09-06T20:02:53Z", "author": {"login": "pail23"}, "path": "bundles/org.openhab.binding.mystrom/src/main/java/org/openhab/binding/mystrom/internal/MyStromHandler.java", "diffHunk": "@@ -0,0 +1,166 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.mystrom.internal;\n+\n+import static org.eclipse.smarthome.core.library.unit.SIUnits.CELSIUS;\n+import static org.eclipse.smarthome.core.library.unit.SmartHomeUnits.WATT;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_POWER;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_SWITCH;\n+import static org.openhab.binding.mystrom.internal.MyStromBindingConstants.CHANNEL_TEMPERATURE;\n+\n+import java.time.Duration;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.smarthome.core.cache.ExpiringCache;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+\n+/**\n+ * The {@link MyStromHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Paul Frank - Initial contribution\n+ */\n+@NonNullByDefault\n+public class MyStromHandler extends BaseThingHandler {\n+\n+    private static class MyStromReport {\n+\n+        public float power;\n+        public boolean relay;\n+        public float temperature;\n+    }\n+\n+    private static final int HTTP_OK_CODE = 200;\n+    private static final String COMMUNICATION_ERROR = \"Error while communicating to the myStrom plug: \";\n+    private static final String HTTP_REQUEST_URL_PREFIX = \"http://\";\n+    private static final String HTTPS_REQUEST_URL_PREFIX = \"https://\";\n+\n+    private final Logger logger = LoggerFactory.getLogger(MyStromHandler.class);\n+\n+    private HttpClient httpClient;\n+    private String hostname = \"\";\n+\n+    private @Nullable ScheduledFuture<?> pollingJob;\n+    private ExpiringCache<MyStromReport> cache = new ExpiringCache<>(Duration.ofSeconds(3), this::getReport);\n+    private final Gson gson = new Gson();\n+\n+    public MyStromHandler(Thing thing, HttpClient httpClient) {\n+        super(thing);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        try {\n+            if (command instanceof RefreshType) {\n+                pollDevice();\n+            } else {\n+                if (command instanceof OnOffType && CHANNEL_SWITCH.equals(channelUID.getId())) {\n+                    sendHttpGet(\"relay?state=\" + (command == OnOffType.ON ? \"1\" : \"0\"));\n+                    scheduler.schedule(this::pollDevice, 500, TimeUnit.MILLISECONDS);\n+                }\n+            }\n+        } catch (MyStromException e) {\n+            logger.warn(\"Error while handling command {}\", e.getMessage());\n+        }\n+    }\n+\n+    private @Nullable MyStromReport getReport() {\n+        try {\n+            String returnContent = sendHttpGet(\"report\");\n+            MyStromReport report = gson.fromJson(returnContent, MyStromReport.class);\n+            updateStatus(ThingStatus.ONLINE);\n+            return report;\n+        } catch (MyStromException e) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, e.getMessage());\n+            return null;\n+        }\n+    }\n+\n+    private void pollDevice() {\n+        MyStromReport report = cache.getValue();\n+        if (report != null) {\n+            updateState(CHANNEL_SWITCH, report.relay ? OnOffType.ON : OnOffType.OFF);\n+            updateState(CHANNEL_POWER, QuantityType.valueOf(report.power, WATT));\n+            updateState(CHANNEL_TEMPERATURE, QuantityType.valueOf(report.temperature, CELSIUS));\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        MyStromConfiguration config = getConfigAs(MyStromConfiguration.class);\n+        if (config.hostname.startsWith(HTTP_REQUEST_URL_PREFIX)\n+                || config.hostname.startsWith(HTTPS_REQUEST_URL_PREFIX)) {\n+            this.hostname = config.hostname;\n+        } else {\n+            this.hostname = HTTP_REQUEST_URL_PREFIX + config.hostname;\n+        }\n+\n+        updateStatus(ThingStatus.UNKNOWN);\n+        pollingJob = scheduler.scheduleWithFixedDelay(this::pollDevice, 0, config.refresh, TimeUnit.SECONDS);\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        super.dispose();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDA5OTIxNg=="}, "originalCommit": {"oid": "e2d8c7dacd83a4b9065f330f1e517bd3d6035b5a"}, "originalPosition": 135}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4407, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}