{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5NDA0Mjcz", "number": 8685, "title": "[haywardomnilogic] Replacement for Hayward Omnilogic Pool Automation Binding", "bodyText": "This PR is a replacement for PR #8338 , which was submitted against the 2.5.x branch. The 2.5.x version of the binding has been reviewed by @Hilbrand and @fwolter . There are still a couple open issues and changes that are awaiting review by @Hilbrand .\nBackground\nHayward Omnilogic binding initial contribution\nThe Hayward Omnilogic binding integrates the Hayward Omnilogic pool controller using the Hayward API.\nForum discussion can be found here.\nSigned-off-by: Matt Myers mmyers75@icloud.com", "createdAt": "2020-10-07T17:24:12Z", "url": "https://github.com/openhab/openhab-addons/pull/8685", "merged": true, "mergeCommit": {"oid": "ab290c54641fe0ff7106f44eeb29f449843c536e"}, "closed": true, "closedAt": "2021-01-22T22:32:53Z", "author": {"login": "matchews"}, "timelineItems": {"totalCount": 60, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXbP7uAFqTUwOTk1OTUwNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdyw5s3gFqTU3NDY3MTEyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5OTU5NTA0", "url": "https://github.com/openhab/openhab-addons/pull/8685#pullrequestreview-509959504", "createdAt": "2020-10-16T01:51:41Z", "commit": {"oid": "37ddd0c1b2b24734272871f168bed6cb9fb77fda"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwMTo1MTo0MVrOHiiVKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwMDowMDowMlrOHqyxJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTk3NjEwNA==", "bodyText": "Please add @NonNullByDefault", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r505976104", "createdAt": "2020-10-16T01:51:41Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/HaywardTypeToRequest.java", "diffHunk": "@@ -0,0 +1,32 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal;\n+\n+/**\n+ * The type to request.\n+ *\n+ * @author Matt Myers - Initial Contribution\n+ */\n+public enum HaywardTypeToRequest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37ddd0c1b2b24734272871f168bed6cb9fb77fda"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTk3NjIyNw==", "bodyText": "Please add @NonNullByDefault", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r505976227", "createdAt": "2020-10-16T01:51:54Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/HaywardThingHandler.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+\n+package org.openhab.binding.haywardomnilogic.internal;\n+\n+import org.eclipse.jdt.annotation.NonNull;\n+import org.openhab.core.library.types.DecimalType;\n+import org.openhab.core.library.types.OnOffType;\n+import org.openhab.core.library.types.QuantityType;\n+import org.openhab.core.library.types.StringType;\n+import org.openhab.core.thing.Channel;\n+import org.openhab.core.thing.ChannelUID;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.ThingStatus;\n+import org.openhab.core.thing.binding.BaseThingHandler;\n+import org.openhab.core.types.Command;\n+import org.openhab.core.types.State;\n+\n+/**\n+ * The {@link HaywarThingHandler} is a subclass of the BaseThingHandler and a Super\n+ * Class to each Hayward Thing Handler\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+public class HaywardThingHandler extends BaseThingHandler {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37ddd0c1b2b24734272871f168bed6cb9fb77fda"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYxNDkyOA==", "bodyText": "The formatting is messed up here.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r514614928", "createdAt": "2020-10-29T22:59:20Z", "author": {"login": "cpmeister"}, "path": "bom/openhab-addons/pom.xml", "diffHunk": "@@ -396,7 +396,12 @@\n       <artifactId>org.openhab.binding.harmonyhub</artifactId>\n       <version>${project.version}</version>\n     </dependency>\n-    <dependency>\n+     <dependency>\n+      <groupId>org.openhab.addons.bundles</groupId>\n+      <artifactId>org.openhab.binding.haywardomnilogic</artifactId>\n+      <version>${project.version}</version>\n+    </dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37ddd0c1b2b24734272871f168bed6cb9fb77fda"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYxNzE1OA==", "bodyText": "Please format the readme tables so that they are readable in plain text.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r514617158", "createdAt": "2020-10-29T23:06:06Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/README.md", "diffHunk": "@@ -0,0 +1,258 @@\n+# Hayward Omnilogic Binding\n+\n+The Hayward Omnilogic binding integrates the Omnilogic pool controller using the Hayward API.\n+\n+The Hayward Omnilogic API interacts with Hayward's cloud server requiring a connection with the Internet for sending and receiving information.\n+\n+## Supported Things\n+\n+The table below lists the Hayward OmniLogic binding thing types:\n+\n+| Things                                  | Description                                                                                                  | Thing Type     |\n+|-----------------------------------------|--------------------------------------------------------------------------------------------------------------|----------------|\n+| Hayward OmniLogix Connection            | Connection to Hayward's Server                                                                               | bridge         |\n+| Backyard                                | Backyard                                                                                                     | backyard       |\n+| Body of Water                           | Body of Water                                                                                                | bow            |\n+| Chlorinator                             | Chlorinator\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t | chlorinator    |\n+| Colorlogic Light                        | Colorlogic Light                                                                                             | colorlogic     |\n+| Chlorine Sense and Dispense             | CSAD/ORP Control (under development)                                                                         | csad           |\n+| Filter                                  | Filter control                                                                                               | filter         |\n+| Heater Equipment                        | Actual heater (i.e. gas, solar, electric)                                                                    | heater         |\n+| Pump                                    | Auxillary pump control (i.e. spillover)                                                                      | pump           |\n+| Relay                                   | Accessory relay control (deck jet sprinklers, lights, etc.)                                                  | relay          |\n+| Virtaul Heater                          | A Virtual Heater that can control all of the heater equipment based on priority                              | virtualHeater  |\n+\n+## Discovery\n+\n+The binding will automatically discover the Omnilogic pool things from the cloud server using your Hayward Omnilogic credentials.\n+\n+## Thing Configuration\n+\n+Hayward OmniLogic Connection Parameters:\n+\n+| Property\t\t\t    | Default\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t| Required \t| Description \t\t\t\t\t\t\t\t|\n+|-----------------------|-------------------------------------------------------------------|-----------|:-----------------------------------------:|\n+| Host Name      \t\t| https://app1.haywardomnilogic.com/HAAPI/HomeAutomation/API.ashx\t| Yes\t\t| Host name of the Hayward API server \t\t|\n+| User Name       \t\t| None    \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t| Yes\t\t| Your Hayward User Name (not email address)|\n+| Password \t\t\t\t| None\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t| Yes\t\t| Your Hayward User Password\t\t\t\t|\n+| Telemetry Poll Delay  | 12    \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t| Yes\t\t| Telemetry Poll Delay (seconds)\t\t\t|\n+| Alarm Poll Delay    \t| 60    \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t| Yes\t\t| Alarm Poll Delay (seconds)\t\t\t\t|\n+| Command Poll Delay\t| 12    \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t| Yes\t\t| Command Poll Delay (seconds)\t\t\t\t|", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37ddd0c1b2b24734272871f168bed6cb9fb77fda"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYxODIwNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t<property name=\"maxPumpSPeed\"></property>\n          \n          \n            \n            \t\t\t<property name=\"maxPumpSpeed\"></property>", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r514618207", "createdAt": "2020-10-29T23:09:20Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/resources/OH-INF/thing/pump.xml", "diffHunk": "@@ -0,0 +1,37 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"haywardomnilogic\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<thing-type id=\"pump\" listed=\"false\">\n+\t\t<supported-bridge-type-refs>\n+\t\t\t<bridge-type-ref id=\"bridge\"/>\n+\t\t</supported-bridge-type-refs>\n+\n+\t\t<label>Pump</label>\n+\t\t<description>Pump</description>\n+\t\t<channels>\n+\t\t\t<channel id=\"pumpEnable\" typeId=\"system.power\"/>\n+\t\t\t<channel id=\"pumpSpeed\" typeId=\"pumpSpeed\"/>\n+\t\t</channels>\n+\n+\t\t<properties>\n+\t\t\t<property name=\"vendor\">Hayward</property>\n+\t\t\t<property name=\"minPumpSpeed\"></property>\n+\t\t\t<property name=\"maxPumpSPeed\"></property>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37ddd0c1b2b24734272871f168bed6cb9fb77fda"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYxODUyOA==", "bodyText": "is the pump rpm not available as a channel?", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r514618528", "createdAt": "2020-10-29T23:10:14Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/resources/OH-INF/thing/pump.xml", "diffHunk": "@@ -0,0 +1,37 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"haywardomnilogic\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<thing-type id=\"pump\" listed=\"false\">\n+\t\t<supported-bridge-type-refs>\n+\t\t\t<bridge-type-ref id=\"bridge\"/>\n+\t\t</supported-bridge-type-refs>\n+\n+\t\t<label>Pump</label>\n+\t\t<description>Pump</description>\n+\t\t<channels>\n+\t\t\t<channel id=\"pumpEnable\" typeId=\"system.power\"/>\n+\t\t\t<channel id=\"pumpSpeed\" typeId=\"pumpSpeed\"/>\n+\t\t</channels>\n+\n+\t\t<properties>\n+\t\t\t<property name=\"vendor\">Hayward</property>\n+\t\t\t<property name=\"minPumpSpeed\"></property>\n+\t\t\t<property name=\"maxPumpSPeed\"></property>\n+\t\t\t<property name=\"minPumpRPM\"></property>\n+\t\t\t<property name=\"maxPumpRPM\"></property>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37ddd0c1b2b24734272871f168bed6cb9fb77fda"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYxOTMwMQ==", "bodyText": "It looks like the input is percentage based. Do you think it would be better to use Dimmer as the channel type instead?", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r514619301", "createdAt": "2020-10-29T23:12:28Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/resources/OH-INF/thing/pump.xml", "diffHunk": "@@ -0,0 +1,37 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"haywardomnilogic\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<thing-type id=\"pump\" listed=\"false\">\n+\t\t<supported-bridge-type-refs>\n+\t\t\t<bridge-type-ref id=\"bridge\"/>\n+\t\t</supported-bridge-type-refs>\n+\n+\t\t<label>Pump</label>\n+\t\t<description>Pump</description>\n+\t\t<channels>\n+\t\t\t<channel id=\"pumpEnable\" typeId=\"system.power\"/>\n+\t\t\t<channel id=\"pumpSpeed\" typeId=\"pumpSpeed\"/>\n+\t\t</channels>\n+\n+\t\t<properties>\n+\t\t\t<property name=\"vendor\">Hayward</property>\n+\t\t\t<property name=\"minPumpSpeed\"></property>\n+\t\t\t<property name=\"maxPumpSPeed\"></property>\n+\t\t\t<property name=\"minPumpRPM\"></property>\n+\t\t\t<property name=\"maxPumpRPM\"></property>\n+\t\t</properties>\n+\t\t<representation-property>systemID</representation-property>\n+\n+\t</thing-type>\n+\n+\t<channel-type id=\"pumpSpeed\">\n+\t\t<item-type>Number:Dimensionless</item-type>\n+\t\t<label>Pump Speed</label>\n+\t\t<description>Pump Speed</description>\n+\t\t<state min=\"0\" max=\"100\" step=\"1.0\" pattern=\"%1f\" readOnly=\"false\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37ddd0c1b2b24734272871f168bed6cb9fb77fda"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYxOTU4NA==", "bodyText": "Please apply openHab's Units of Measurement framework wherever applicable. This allows user interfaces greater flexibility when it comes to rendering data from your binding.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t<item-type>Number</item-type>\n          \n          \n            \n            \t\t<item-type>Number:Temperature</item-type>", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r514619584", "createdAt": "2020-10-29T23:13:18Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/resources/OH-INF/thing/virtualHeater.xml", "diffHunk": "@@ -0,0 +1,34 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"haywardomnilogic\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<thing-type id=\"virtualHeater\" listed=\"false\">\n+\t\t<supported-bridge-type-refs>\n+\t\t\t<bridge-type-ref id=\"bridge\"/>\n+\t\t</supported-bridge-type-refs>\n+\n+\t\t<label>Virtual Heater</label>\n+\t\t<description>Virtual Heater</description>\n+\n+\t\t<channels>\n+\t\t\t<channel id=\"virtualHeaterEnable\" typeId=\"system.power\"/>\n+\t\t\t<channel id=\"virtualHeaterCurrentSetpoint\" typeId=\"currentSetpoint\"/>\n+\t\t</channels>\n+\n+\t\t<properties>\n+\t\t\t<property name=\"vendor\">Hayward</property>\n+\t\t</properties>\n+\t\t<representation-property>systemID</representation-property>\n+\t</thing-type>\n+\n+\t<channel-type id=\"currentSetpoint\">\n+\t\t<item-type>Number</item-type>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37ddd0c1b2b24734272871f168bed6cb9fb77fda"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYyMDIxOA==", "bodyText": "Maybe you can add to this description how \"Body of Water\" relates to a number.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r514620218", "createdAt": "2020-10-29T23:15:11Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/resources/OH-INF/thing/sensor.xml", "diffHunk": "@@ -0,0 +1,39 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"haywardomnilogic\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<thing-type id=\"sensor\" listed=\"false\">\n+\t\t<supported-bridge-type-refs>\n+\t\t\t<bridge-type-ref id=\"bridge\"/>\n+\t\t</supported-bridge-type-refs>\n+\n+\t\t<label>Sensor</label>\n+\t\t<description>Sensor</description>\n+\t\t<channels>\n+\t\t\t<channel id=\"sensorData\" typeId=\"data\"/>\n+\t\t</channels>\n+\n+\t\t<properties>\n+\t\t\t<property name=\"vendor\">Hayward</property>\n+\t\t</properties>\n+\t\t<representation-property>systemID</representation-property>\n+\n+\t</thing-type>\n+\n+\t<channel-type id=\"bow\">\n+\t\t<item-type>Number</item-type>\n+\t\t<label>Body of Water</label>\n+\t\t<description>The Body of Water</description>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37ddd0c1b2b24734272871f168bed6cb9fb77fda"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYyMDY0OQ==", "bodyText": "Please apply openHab's Units of Measurement framework wherever applicable. This allows user interfaces greater flexibility when it comes to rendering data from your binding.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r514620649", "createdAt": "2020-10-29T23:16:28Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/resources/OH-INF/thing/chlorinator.xml", "diffHunk": "@@ -0,0 +1,103 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"haywardomnilogic\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<thing-type id=\"chlorinator\" listed=\"false\">\n+\t\t<supported-bridge-type-refs>\n+\t\t\t<bridge-type-ref id=\"bridge\"/>\n+\t\t</supported-bridge-type-refs>\n+\n+\t\t<label>Chlorinator</label>\n+\t\t<description>Chlorinator</description>\n+\t\t<channels>\n+\t\t\t<channel id=\"chlorEnable\" typeId=\"system.power\"/>\n+\t\t\t<channel id=\"chlorOperatingMode\" typeId=\"chlorOperatingMode\"/>\n+\t\t\t<channel id=\"chlorTimedPercent\" typeId=\"timedPercent\"/>\n+\t\t\t<channel id=\"chlorScMode\" typeId=\"scMode\"/>\n+\t\t\t<channel id=\"chlorError\" typeId=\"chlorError\"/>\n+\t\t\t<channel id=\"chlorAlert\" typeId=\"chlorAlert\"/>\n+\t\t\t<channel id=\"chlorAvgSaltLevel\" typeId=\"avgSaltLevel\"/>\n+\t\t\t<channel id=\"chlorInstantSaltLevel\" typeId=\"instantSaltLevel\"/>\n+\t\t\t<channel id=\"chlorStatus\" typeId=\"status\"/>\n+\t\t</channels>\n+\n+\t\t<properties>\n+\t\t\t<property name=\"vendor\">Hayward</property>\n+\t\t</properties>\n+\t\t<representation-property>systemID</representation-property>\n+\n+\t</thing-type>\n+\n+\t<channel-type id=\"chlorOperatingMode\">\n+\t\t<item-type>String</item-type>\n+\t\t<label>Operating Mode</label>\n+\t\t<description>Operating Mode</description>\n+\t\t<state readOnly=\"true\">\n+\t\t\t<options>\n+\t\t\t\t<option value=\"0\">Off</option>\n+\t\t\t\t<option value=\"1\">Timed Percent</option>\n+\t\t\t\t<option value=\"2\">ORP Autosense</option>\n+\t\t\t</options>\n+\t\t</state>\n+\t</channel-type>\n+\n+\t<channel-type id=\"timedPercent\">\n+\t\t<item-type>Number:Dimensionless</item-type>\n+\t\t<label>Salt Output (%)</label>\n+\t\t<description>Current salt output setting for the chlorinator (%).</description>\n+\t\t<state min=\"0\" max=\"100\" step=\"1.0\" pattern=\"%1f\" readOnly=\"false\"/>\n+\t</channel-type>\n+\n+\t<channel-type id=\"scMode\">\n+\t\t<item-type>String</item-type>\n+\t\t<label>scMode</label>\n+\t\t<description>scMode</description>\n+\t\t<state readOnly=\"true\">\n+\t\t\t<options>\n+\t\t\t\t<option value=\"0\">Off</option>\n+\t\t\t\t<option value=\"1\">Super Chlorinating</option>\n+\t\t\t</options>\n+\t\t</state>\n+\t</channel-type>\n+\n+\t<channel-type id=\"chlorError\">\n+\t\t<item-type>Number</item-type>\n+\t\t<label>Chlorinator Error</label>\n+\t\t<state readOnly=\"true\"/>\n+\t</channel-type>\n+\n+\t<channel-type id=\"chlorAlert\">\n+\t\t<item-type>String</item-type>\n+\t\t<label>Chlorinator Alert</label>\n+\t\t<description>Chlorinator Alert</description>\n+\t\t<state readOnly=\"true\">\n+\t\t\t<options>\n+\t\t\t\t<option value=\"0\">None</option>\n+\t\t\t\t<option value=\"16\">Low T-Cell Temperature</option>\n+\t\t\t</options>\n+\t\t</state>\n+\t</channel-type>\n+\n+\t<channel-type id=\"avgSaltLevel\">\n+\t\t<item-type>Number</item-type>\n+\t\t<label>Average Salt Level</label>\n+\t\t<description>Average Salt Level</description>\n+\t\t<state readOnly=\"true\"/>\n+\t</channel-type>\n+\n+\t<channel-type id=\"instantSaltLevel\">\n+\t\t<item-type>Number</item-type>\n+\t\t<label>Instant Salt Level (ppm)</label>\n+\t\t<description>Instant Salt Level (ppm)</description>\n+\t\t<state readOnly=\"true\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37ddd0c1b2b24734272871f168bed6cb9fb77fda"}, "originalPosition": 94}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYyMDc4Ng==", "bodyText": "here too", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r514620786", "createdAt": "2020-10-29T23:16:52Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/resources/OH-INF/thing/chlorinator.xml", "diffHunk": "@@ -0,0 +1,103 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"haywardomnilogic\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<thing-type id=\"chlorinator\" listed=\"false\">\n+\t\t<supported-bridge-type-refs>\n+\t\t\t<bridge-type-ref id=\"bridge\"/>\n+\t\t</supported-bridge-type-refs>\n+\n+\t\t<label>Chlorinator</label>\n+\t\t<description>Chlorinator</description>\n+\t\t<channels>\n+\t\t\t<channel id=\"chlorEnable\" typeId=\"system.power\"/>\n+\t\t\t<channel id=\"chlorOperatingMode\" typeId=\"chlorOperatingMode\"/>\n+\t\t\t<channel id=\"chlorTimedPercent\" typeId=\"timedPercent\"/>\n+\t\t\t<channel id=\"chlorScMode\" typeId=\"scMode\"/>\n+\t\t\t<channel id=\"chlorError\" typeId=\"chlorError\"/>\n+\t\t\t<channel id=\"chlorAlert\" typeId=\"chlorAlert\"/>\n+\t\t\t<channel id=\"chlorAvgSaltLevel\" typeId=\"avgSaltLevel\"/>\n+\t\t\t<channel id=\"chlorInstantSaltLevel\" typeId=\"instantSaltLevel\"/>\n+\t\t\t<channel id=\"chlorStatus\" typeId=\"status\"/>\n+\t\t</channels>\n+\n+\t\t<properties>\n+\t\t\t<property name=\"vendor\">Hayward</property>\n+\t\t</properties>\n+\t\t<representation-property>systemID</representation-property>\n+\n+\t</thing-type>\n+\n+\t<channel-type id=\"chlorOperatingMode\">\n+\t\t<item-type>String</item-type>\n+\t\t<label>Operating Mode</label>\n+\t\t<description>Operating Mode</description>\n+\t\t<state readOnly=\"true\">\n+\t\t\t<options>\n+\t\t\t\t<option value=\"0\">Off</option>\n+\t\t\t\t<option value=\"1\">Timed Percent</option>\n+\t\t\t\t<option value=\"2\">ORP Autosense</option>\n+\t\t\t</options>\n+\t\t</state>\n+\t</channel-type>\n+\n+\t<channel-type id=\"timedPercent\">\n+\t\t<item-type>Number:Dimensionless</item-type>\n+\t\t<label>Salt Output (%)</label>\n+\t\t<description>Current salt output setting for the chlorinator (%).</description>\n+\t\t<state min=\"0\" max=\"100\" step=\"1.0\" pattern=\"%1f\" readOnly=\"false\"/>\n+\t</channel-type>\n+\n+\t<channel-type id=\"scMode\">\n+\t\t<item-type>String</item-type>\n+\t\t<label>scMode</label>\n+\t\t<description>scMode</description>\n+\t\t<state readOnly=\"true\">\n+\t\t\t<options>\n+\t\t\t\t<option value=\"0\">Off</option>\n+\t\t\t\t<option value=\"1\">Super Chlorinating</option>\n+\t\t\t</options>\n+\t\t</state>\n+\t</channel-type>\n+\n+\t<channel-type id=\"chlorError\">\n+\t\t<item-type>Number</item-type>\n+\t\t<label>Chlorinator Error</label>\n+\t\t<state readOnly=\"true\"/>\n+\t</channel-type>\n+\n+\t<channel-type id=\"chlorAlert\">\n+\t\t<item-type>String</item-type>\n+\t\t<label>Chlorinator Alert</label>\n+\t\t<description>Chlorinator Alert</description>\n+\t\t<state readOnly=\"true\">\n+\t\t\t<options>\n+\t\t\t\t<option value=\"0\">None</option>\n+\t\t\t\t<option value=\"16\">Low T-Cell Temperature</option>\n+\t\t\t</options>\n+\t\t</state>\n+\t</channel-type>\n+\n+\t<channel-type id=\"avgSaltLevel\">\n+\t\t<item-type>Number</item-type>\n+\t\t<label>Average Salt Level</label>\n+\t\t<description>Average Salt Level</description>\n+\t\t<state readOnly=\"true\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37ddd0c1b2b24734272871f168bed6cb9fb77fda"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYyMjAxOQ==", "bodyText": "Maybe it would be better to name this config endpointUrl", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r514622019", "createdAt": "2020-10-29T23:20:26Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/resources/OH-INF/thing/bridge.xml", "diffHunk": "@@ -0,0 +1,41 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"haywardomnilogic\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<!-- The bridge to communicate with Hayward's server -->\n+\t<bridge-type id=\"bridge\">\n+\t\t<label>Hayward OmniLogix Connection</label>\n+\t\t<description>Connection to Hayward's Server</description>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"hostname\" type=\"text\" required=\"true\">\n+\t\t\t\t<context>url</context>\n+\t\t\t\t<label>Host Name</label>\n+\t\t\t\t<!-- API Hostname -->\n+\t\t\t\t<default>https://app1.haywardomnilogic.com/HAAPI/HomeAutomation/API.ashx</default>\n+\t\t\t\t<description>The host name of the server.</description>\n+\t\t\t</parameter>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37ddd0c1b2b24734272871f168bed6cb9fb77fda"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYyMzMzNA==", "bodyText": "Why are you retrieving this from the properties instead of from the thing configuration?", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r514623334", "createdAt": "2020-10-29T23:24:35Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/handler/HaywardSensorHandler.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.handler;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingHandler;\n+import org.openhab.core.thing.Thing;\n+\n+/**\n+ * The Sensor Handler\n+ *\n+ * @author Matt Myers - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class HaywardSensorHandler extends HaywardThingHandler {\n+\n+    public HaywardSensorHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    @Override\n+    public void getTelemetry(String xmlResponse) throws Exception {\n+        List<String> data = new ArrayList<>();\n+        List<String> systemIDs = new ArrayList<>();\n+\n+        @SuppressWarnings(\"null\")\n+        HaywardBridgeHandler bridgehandler = (HaywardBridgeHandler) getBridge().getHandler();\n+        if (bridgehandler != null) {\n+            systemIDs = bridgehandler.evaluateXPath(\"//Sensor/@systemId\", xmlResponse);\n+            data = bridgehandler.evaluateXPath(\"//Sensor/@relayState\", xmlResponse);\n+            String thingSystemID = getThing().getProperties().get(HaywardBindingConstants.PROPERTY_SYSTEM_ID);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37ddd0c1b2b24734272871f168bed6cb9fb77fda"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYyMzQwNQ==", "bodyText": "The error logging level should be reserved for issues catastrophic enough to threaten the operation of openHab itself. An error in a binding shouldn't qualify for this. Please read the openHab coding guidelines for expected use of logging in bindings.\nMy general rule for logging levels is:\n\ntrace - used for normal expected execution paths\ndebug - used for unexepected execution paths, but well within normal operation\ninfo - used for notable points in an execution path, like a milestone. (in openhab we try reserve this logging level for the core, so bindings should rarely ever call this.)\nwarn - used for notable unexpected execution paths that a regular user (not just a developer) should be notified of. Warnings should be used to indicate that something not-normal occurred and user intervention is required to resolve. Warnings do not indicate a failure to operate merely an abnormal condition of operation that can still be handled by the binding. Failures in binding operation should be indicated by changing the thing status to offline.\nerror - used to indicate catastrophic program failure. This should be used to indicate a catastrophic failure in openhab's ability to operate. A failure in a binding would never cause openhab as a whole to fail so a failure in a bindings should never log an error. Instead that failure should be indicated by changing the thing status.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r514623405", "createdAt": "2020-10-29T23:24:48Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/handler/HaywardRelayHandler.java", "diffHunk": "@@ -0,0 +1,109 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.handler;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingHandler;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingProperties;\n+import org.openhab.core.thing.ChannelUID;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.types.Command;\n+import org.openhab.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The Relay Handler\n+ *\n+ * @author Matt Myers - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class HaywardRelayHandler extends HaywardThingHandler {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardRelayHandler.class);\n+\n+    HaywardThingProperties prop = getConfig().as(HaywardThingProperties.class);\n+\n+    public HaywardRelayHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    @Override\n+    public void getTelemetry(String xmlResponse) throws Exception {\n+        List<String> data = new ArrayList<>();\n+        List<String> systemIDs = new ArrayList<>();\n+\n+        @SuppressWarnings(\"null\")\n+        HaywardBridgeHandler bridgehandler = (HaywardBridgeHandler) getBridge().getHandler();\n+        if (bridgehandler != null) {\n+            systemIDs = bridgehandler.evaluateXPath(\"//Relay/@systemId\", xmlResponse);\n+            data = bridgehandler.evaluateXPath(\"//Relay/@relayState\", xmlResponse);\n+            String thingSystemID = getThing().getProperties().get(HaywardBindingConstants.PROPERTY_SYSTEM_ID);\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                if (systemIDs.get(i).equals(thingSystemID)) {\n+                    updateData(HaywardBindingConstants.CHANNEL_RELAY_STATE, data.get(i));\n+                }\n+            }\n+        }\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if ((command instanceof RefreshType)) {\n+            return;\n+        }\n+\n+        prop.systemID = getThing().getProperties().get(HaywardBindingConstants.PROPERTY_SYSTEM_ID);\n+        prop.poolID = getThing().getProperties().get(HaywardBindingConstants.PROPERTY_BOWID);\n+\n+        @SuppressWarnings(\"null\")\n+        HaywardBridgeHandler bridgehandler = (HaywardBridgeHandler) getBridge().getHandler();\n+        if (bridgehandler != null) {\n+            String cmdString = this.cmdToString(command);\n+            String cmdURL = null;\n+            try {\n+                switch (channelUID.getId()) {\n+                    case HaywardBindingConstants.CHANNEL_RELAY_STATE:\n+                        cmdURL = HaywardBindingConstants.COMMAND_PARAMETERS\n+                                + \"<Name>SetUIEquipmentCmd</Name><Parameters>\"\n+                                + \"<Parameter name=\\\"Token\\\" dataType=\\\"String\\\">\" + bridgehandler.account.token\n+                                + \"</Parameter>\" + \"<Parameter name=\\\"MspSystemID\\\" dataType=\\\"int\\\">\"\n+                                + bridgehandler.account.mspSystemID + \"</Parameter>\"\n+                                + \"<Parameter name=\\\"PoolID\\\" dataType=\\\"int\\\">\" + prop.poolID + \"</Parameter>\"\n+                                + \"<Parameter name=\\\"EquipmentID\\\" dataType=\\\"int\\\">\" + prop.systemID + \"</Parameter>\"\n+                                + \"<Parameter name=\\\"IsOn\\\" dataType=\\\"int\\\">\" + cmdString + \"</Parameter>\"\n+                                + HaywardBindingConstants.COMMAND_SCHEDULE + \"</Parameters></Request>\";\n+                        break;\n+                    default:\n+                        logger.error(\"haywardCommand Unsupported type {}\", channelUID);\n+                        return;\n+                }\n+\n+                // *****Send Command to Hayward server\n+                String xmlResponse = bridgehandler.httpXmlResponse(cmdURL);\n+                String status = bridgehandler.evaluateXPath(\"//Parameter[@name='Status']/text()\", xmlResponse).get(0);\n+\n+                if (!(status.equals(\"0\"))) {\n+                    logger.error(\"haywardCommand XML response: {}\", xmlResponse);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37ddd0c1b2b24734272871f168bed6cb9fb77fda"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYyNTY4Nw==", "bodyText": "Can you ever have more than one heater with the same systemId? Or are systemIds unique for every device on the network?", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r514625687", "createdAt": "2020-10-29T23:32:04Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/handler/HaywardHeaterHandler.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.handler;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingHandler;\n+import org.openhab.binding.haywardomnilogic.internal.config.HaywardConfig;\n+import org.openhab.core.thing.Thing;\n+\n+/**\n+ * The Heater Handler\n+ *\n+ * @author Matt Myers - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class HaywardHeaterHandler extends HaywardThingHandler {\n+\n+    HaywardConfig config = getConfig().as(HaywardConfig.class);\n+\n+    public HaywardHeaterHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    @Override\n+    public void getTelemetry(String xmlResponse) throws Exception {\n+        List<String> data = new ArrayList<>();\n+        List<String> systemIDs = new ArrayList<>();\n+\n+        @SuppressWarnings(\"null\")\n+        HaywardBridgeHandler bridgehandler = (HaywardBridgeHandler) getBridge().getHandler();\n+        if (bridgehandler != null) {\n+            systemIDs = bridgehandler.evaluateXPath(\"//Heater/@systemId\", xmlResponse);\n+            String thingSystemID = getThing().getProperties().get(HaywardBindingConstants.PROPERTY_SYSTEM_ID);\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                if (systemIDs.get(i).equals(thingSystemID)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37ddd0c1b2b24734272871f168bed6cb9fb77fda"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYyNTk2MA==", "bodyText": "Heater doesn't have a chlorinator channel listed in the xml.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r514625960", "createdAt": "2020-10-29T23:32:57Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/handler/HaywardHeaterHandler.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.handler;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingHandler;\n+import org.openhab.binding.haywardomnilogic.internal.config.HaywardConfig;\n+import org.openhab.core.thing.Thing;\n+\n+/**\n+ * The Heater Handler\n+ *\n+ * @author Matt Myers - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class HaywardHeaterHandler extends HaywardThingHandler {\n+\n+    HaywardConfig config = getConfig().as(HaywardConfig.class);\n+\n+    public HaywardHeaterHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    @Override\n+    public void getTelemetry(String xmlResponse) throws Exception {\n+        List<String> data = new ArrayList<>();\n+        List<String> systemIDs = new ArrayList<>();\n+\n+        @SuppressWarnings(\"null\")\n+        HaywardBridgeHandler bridgehandler = (HaywardBridgeHandler) getBridge().getHandler();\n+        if (bridgehandler != null) {\n+            systemIDs = bridgehandler.evaluateXPath(\"//Heater/@systemId\", xmlResponse);\n+            String thingSystemID = getThing().getProperties().get(HaywardBindingConstants.PROPERTY_SYSTEM_ID);\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                if (systemIDs.get(i).equals(thingSystemID)) {\n+                    // Operating Mode\n+                    data = bridgehandler.evaluateXPath(\"//Chlorinator/@operatingMode\", xmlResponse);\n+                    updateData(HaywardBindingConstants.CHANNEL_CHLORINATOR_OPERATINGMODE, data.get(0));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37ddd0c1b2b24734272871f168bed6cb9fb77fda"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYyNjQ1OQ==", "bodyText": "How do you know you are parsing the data for the correct heater at this point? You seem to always choose the one at index 0.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r514626459", "createdAt": "2020-10-29T23:34:34Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/handler/HaywardHeaterHandler.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.handler;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingHandler;\n+import org.openhab.binding.haywardomnilogic.internal.config.HaywardConfig;\n+import org.openhab.core.thing.Thing;\n+\n+/**\n+ * The Heater Handler\n+ *\n+ * @author Matt Myers - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class HaywardHeaterHandler extends HaywardThingHandler {\n+\n+    HaywardConfig config = getConfig().as(HaywardConfig.class);\n+\n+    public HaywardHeaterHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    @Override\n+    public void getTelemetry(String xmlResponse) throws Exception {\n+        List<String> data = new ArrayList<>();\n+        List<String> systemIDs = new ArrayList<>();\n+\n+        @SuppressWarnings(\"null\")\n+        HaywardBridgeHandler bridgehandler = (HaywardBridgeHandler) getBridge().getHandler();\n+        if (bridgehandler != null) {\n+            systemIDs = bridgehandler.evaluateXPath(\"//Heater/@systemId\", xmlResponse);\n+            String thingSystemID = getThing().getProperties().get(HaywardBindingConstants.PROPERTY_SYSTEM_ID);\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                if (systemIDs.get(i).equals(thingSystemID)) {\n+                    // Operating Mode\n+                    data = bridgehandler.evaluateXPath(\"//Chlorinator/@operatingMode\", xmlResponse);\n+                    updateData(HaywardBindingConstants.CHANNEL_CHLORINATOR_OPERATINGMODE, data.get(0));\n+\n+                    // State\n+                    data = bridgehandler.evaluateXPath(\"//Heater/@heaterState\", xmlResponse);\n+                    updateData(HaywardBindingConstants.CHANNEL_HEATER_STATE, data.get(0));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37ddd0c1b2b24734272871f168bed6cb9fb77fda"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYyNzA1Mg==", "bodyText": "You should be returning a QuantityType here instead.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r514627052", "createdAt": "2020-10-29T23:36:28Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/HaywardThingHandler.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+\n+package org.openhab.binding.haywardomnilogic.internal;\n+\n+import org.eclipse.jdt.annotation.NonNull;\n+import org.openhab.core.library.types.DecimalType;\n+import org.openhab.core.library.types.OnOffType;\n+import org.openhab.core.library.types.QuantityType;\n+import org.openhab.core.library.types.StringType;\n+import org.openhab.core.thing.Channel;\n+import org.openhab.core.thing.ChannelUID;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.ThingStatus;\n+import org.openhab.core.thing.binding.BaseThingHandler;\n+import org.openhab.core.types.Command;\n+import org.openhab.core.types.State;\n+\n+/**\n+ * The {@link HaywarThingHandler} is a subclass of the BaseThingHandler and a Super\n+ * Class to each Hayward Thing Handler\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+public class HaywardThingHandler extends BaseThingHandler {\n+    protected Thing thing;\n+\n+    public HaywardThingHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        updateStatus(ThingStatus.ONLINE);\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+    }\n+\n+    public void getTelemetry(@NonNull String xmlResponse) throws Exception {\n+    }\n+\n+    public State toState(String type, String value) throws NumberFormatException {\n+        if (\"Number\".equals(type)) {\n+            return new DecimalType(value);\n+        } else if (\"Switch\".equals(type)) {\n+            return Integer.parseInt(value) > 0 ? OnOffType.ON : OnOffType.OFF;\n+        } else if (\"system.power\".equals(type)) {\n+            return Integer.parseInt(value) > 0 ? OnOffType.ON : OnOffType.OFF;\n+        } else if (\"Number:Dimensionless\".equals(type)) {\n+            return new DecimalType(value);\n+        } else if (\"Number:Temperature\".equals(type)) {\n+            return new DecimalType(value);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37ddd0c1b2b24734272871f168bed6cb9fb77fda"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYyNzA5OA==", "bodyText": "Same here. But since you don't really know what type of Dimensionless unit you should be using here, you need to either pass that in to your function as well or make sure that you are only using Dimensionless for a certain type of unit (i.e. Percentage).", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r514627098", "createdAt": "2020-10-29T23:36:37Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/HaywardThingHandler.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+\n+package org.openhab.binding.haywardomnilogic.internal;\n+\n+import org.eclipse.jdt.annotation.NonNull;\n+import org.openhab.core.library.types.DecimalType;\n+import org.openhab.core.library.types.OnOffType;\n+import org.openhab.core.library.types.QuantityType;\n+import org.openhab.core.library.types.StringType;\n+import org.openhab.core.thing.Channel;\n+import org.openhab.core.thing.ChannelUID;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.ThingStatus;\n+import org.openhab.core.thing.binding.BaseThingHandler;\n+import org.openhab.core.types.Command;\n+import org.openhab.core.types.State;\n+\n+/**\n+ * The {@link HaywarThingHandler} is a subclass of the BaseThingHandler and a Super\n+ * Class to each Hayward Thing Handler\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+public class HaywardThingHandler extends BaseThingHandler {\n+    protected Thing thing;\n+\n+    public HaywardThingHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        updateStatus(ThingStatus.ONLINE);\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+    }\n+\n+    public void getTelemetry(@NonNull String xmlResponse) throws Exception {\n+    }\n+\n+    public State toState(String type, String value) throws NumberFormatException {\n+        if (\"Number\".equals(type)) {\n+            return new DecimalType(value);\n+        } else if (\"Switch\".equals(type)) {\n+            return Integer.parseInt(value) > 0 ? OnOffType.ON : OnOffType.OFF;\n+        } else if (\"system.power\".equals(type)) {\n+            return Integer.parseInt(value) > 0 ? OnOffType.ON : OnOffType.OFF;\n+        } else if (\"Number:Dimensionless\".equals(type)) {\n+            return new DecimalType(value);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37ddd0c1b2b24734272871f168bed6cb9fb77fda"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYzMDk5OA==", "bodyText": "If pumps, heaters, relays, etc. are implicitly mapped to bodies of water, why not just make bodies of water a bridge type as well? That way you can more naturally represent the thing hierarchy as well as make it closer to how the omnilogic system represents them.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r514630998", "createdAt": "2020-10-29T23:49:40Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/discovery/HaywardDiscoveryService.java", "diffHunk": "@@ -0,0 +1,411 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.discovery;\n+\n+import static org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants.THING_TYPES_UIDS;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.config.discovery.AbstractDiscoveryService;\n+import org.openhab.core.config.discovery.DiscoveryResult;\n+import org.openhab.core.config.discovery.DiscoveryResultBuilder;\n+import org.openhab.core.config.discovery.DiscoveryService;\n+import org.openhab.core.thing.ThingUID;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Sets up the discovery results and details\n+ *\n+ * @author Matt Myers - Initial Contribution\n+ */\n+\n+// public class HaywardDiscoveryService extends AbstractDiscoveryService implements HaywardHandlerListener {\n+@NonNullByDefault\n+public class HaywardDiscoveryService extends AbstractDiscoveryService implements DiscoveryService, ThingHandlerService {\n+\n+    private final Logger logger = LoggerFactory.getLogger(HaywardDiscoveryService.class);\n+    private @Nullable HaywardBridgeHandler handler;\n+\n+    public HaywardDiscoveryService() {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    /**\n+     * Constructs a zone discovery service.\n+     * Registers this zone discovery service programmatically.\n+     * Call {@link ZoneDiscoveryService#destroy()} to unregister the service after use.\n+     */\n+    public HaywardDiscoveryService(HaywardBridgeHandler bridge) throws IllegalArgumentException {\n+        super(THING_TYPES_UIDS, 0, false);\n+        // this.bridge = bridge;\n+    }\n+\n+    @Override\n+    public void activate() {\n+        super.activate(null);\n+    }\n+\n+    @Override\n+    public void deactivate() {\n+        super.deactivate();\n+    }\n+\n+    @Override\n+    protected void startScan() {\n+        try {\n+            String xmlResults = handler.getMspConfig();\n+            mspConfigDiscovery(xmlResults);\n+        } catch (Exception e) {\n+            logger.debug(\"Exception during discovery scan\", e);\n+        }\n+    }\n+\n+    public synchronized boolean mspConfigDiscovery(String xmlResponse) throws Exception {\n+        List<String> systemIDs = new ArrayList<>();\n+        List<String> names = new ArrayList<>();\n+        List<String> bowName = new ArrayList<>();\n+        List<String> bowID = new ArrayList<>();\n+        List<String> property1 = new ArrayList<>();\n+        List<String> property2 = new ArrayList<>();\n+        List<String> property3 = new ArrayList<>();\n+        List<String> property4 = new ArrayList<>();\n+\n+        // Find Backyard\n+        names = handler.evaluateXPath(\"//Backyard/Name/text()\", xmlResponse);\n+\n+        for (String name : names) {\n+            onBackyardDiscovered(Integer.parseInt(handler.account.mspSystemID), name);\n+        }\n+\n+        // Find Bodies of Water\n+        systemIDs = handler.evaluateXPath(\"//Body-of-water/System-Id/text()\", xmlResponse);\n+        names = handler.evaluateXPath(\"//Body-of-water/Name/text()\", xmlResponse);\n+\n+        for (int i = 0; i < systemIDs.size(); i++) {\n+            onBOWDiscovered(Integer.parseInt(systemIDs.get(i)), names.get(i));\n+        }\n+\n+        // Find Chlorinators\n+        systemIDs = handler.evaluateXPath(\"//Chlorinator/System-Id/text()\", xmlResponse);\n+        names = handler.evaluateXPath(\"//Chlorinator/Name/text()\", xmlResponse);\n+\n+        for (int i = 0; i < systemIDs.size(); i++) {\n+            // get Body of Water for each item\n+            bowID = handler.evaluateXPath(\n+                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+            bowName = handler.evaluateXPath(\"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\",\n+                    xmlResponse);\n+            onChlorinatorDiscovered(Integer.parseInt(systemIDs.get(i)), names.get(i), bowID.get(0), bowName.get(0));\n+        }\n+\n+        // Find ColorLogic Lights\n+        systemIDs = handler.evaluateXPath(\"//ColorLogic-Light/System-Id/text()\", xmlResponse);\n+        names = handler.evaluateXPath(\"//ColorLogic-Light/Name/text()\", xmlResponse);\n+\n+        for (int i = 0; i < systemIDs.size(); i++) {\n+            // get Body of Water for each item\n+            bowID = handler.evaluateXPath(\n+                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+            bowName = handler.evaluateXPath(\"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\",\n+                    xmlResponse);\n+            onColorLogicDiscovered(Integer.parseInt(systemIDs.get(i)), names.get(i), bowID.get(0), bowName.get(0));\n+        }\n+\n+        // Find Filters\n+        systemIDs = handler.evaluateXPath(\"//Filter/System-Id/text()\", xmlResponse);\n+        names = handler.evaluateXPath(\"//Filter/Name/text()\", xmlResponse);\n+        property1 = handler.evaluateXPath(\"//Filter/Min-Pump-Speed/text()\", xmlResponse);\n+        property2 = handler.evaluateXPath(\"//Filter/Max-Pump-Speed/text()\", xmlResponse);\n+        property3 = handler.evaluateXPath(\"//Filter/Min-Pump-RPM/text()\", xmlResponse);\n+        property4 = handler.evaluateXPath(\"//Filter/Max-Pump-RPM/text()\", xmlResponse);\n+        for (int i = 0; i < systemIDs.size(); i++) {\n+            // get Body of Water for each item\n+            bowID = handler.evaluateXPath(\n+                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+            bowName = handler.evaluateXPath(\"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\",\n+                    xmlResponse);\n+            onFilterDiscovered(Integer.parseInt(systemIDs.get(i)), names.get(i), bowID.get(0), bowName.get(0),\n+                    property1.get(i), property2.get(i), property3.get(i), property4.get(i));\n+        }\n+\n+        // Find Heaters\n+        systemIDs = handler.evaluateXPath(\"//Heater-Equipment/System-Id/text()\", xmlResponse);\n+        names = handler.evaluateXPath(\"//Heater-Equipment/Name/text()\", xmlResponse);\n+\n+        for (int i = 0; i < systemIDs.size(); i++) {\n+            // get Body of Water for each item\n+            bowID = handler.evaluateXPath(\n+                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/System-Id/text()\", xmlResponse);\n+            bowName = handler.evaluateXPath(\n+                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/Name/text()\", xmlResponse);\n+            onHeaterDiscovered(Integer.parseInt(systemIDs.get(i)), names.get(i), bowID.get(0), bowName.get(0));\n+        }\n+\n+        // Find Pumps\n+        systemIDs = handler.evaluateXPath(\"//Pump/System-Id/text()\", xmlResponse);\n+        names = handler.evaluateXPath(\"//Pump/Name/text()\", xmlResponse);\n+        names = handler.evaluateXPath(\"//Filter/Name/text()\", xmlResponse);\n+        property1 = handler.evaluateXPath(\"//Filter/Min-Pump-Speed/text()\", xmlResponse);\n+        property2 = handler.evaluateXPath(\"//Filter/Max-Pump-Speed/text()\", xmlResponse);\n+        property3 = handler.evaluateXPath(\"//Filter/Min-Pump-RPM/text()\", xmlResponse);\n+        property4 = handler.evaluateXPath(\"//Filter/Max-Pump-RPM/text()\", xmlResponse);\n+\n+        for (int i = 0; i < systemIDs.size(); i++) {\n+            // get Body of Water for each item\n+            bowID = handler.evaluateXPath(\n+                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/System-Id/text()\", xmlResponse);\n+            bowName = handler.evaluateXPath(\n+                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/Name/text()\", xmlResponse);\n+            onPumpDiscovered(Integer.parseInt(systemIDs.get(i)), names.get(i), bowID.get(0), bowName.get(0),\n+                    property1.get(i), property2.get(i), property3.get(i), property4.get(i));\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37ddd0c1b2b24734272871f168bed6cb9fb77fda"}, "originalPosition": 182}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYzMzU4MA==", "bodyText": "remove this", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r514633580", "createdAt": "2020-10-29T23:58:30Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/discovery/HaywardDiscoveryService.java", "diffHunk": "@@ -0,0 +1,411 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.discovery;\n+\n+import static org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants.THING_TYPES_UIDS;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.config.discovery.AbstractDiscoveryService;\n+import org.openhab.core.config.discovery.DiscoveryResult;\n+import org.openhab.core.config.discovery.DiscoveryResultBuilder;\n+import org.openhab.core.config.discovery.DiscoveryService;\n+import org.openhab.core.thing.ThingUID;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Sets up the discovery results and details\n+ *\n+ * @author Matt Myers - Initial Contribution\n+ */\n+\n+// public class HaywardDiscoveryService extends AbstractDiscoveryService implements HaywardHandlerListener {\n+@NonNullByDefault\n+public class HaywardDiscoveryService extends AbstractDiscoveryService implements DiscoveryService, ThingHandlerService {\n+\n+    private final Logger logger = LoggerFactory.getLogger(HaywardDiscoveryService.class);\n+    private @Nullable HaywardBridgeHandler handler;\n+\n+    public HaywardDiscoveryService() {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    /**\n+     * Constructs a zone discovery service.\n+     * Registers this zone discovery service programmatically.\n+     * Call {@link ZoneDiscoveryService#destroy()} to unregister the service after use.\n+     */\n+    public HaywardDiscoveryService(HaywardBridgeHandler bridge) throws IllegalArgumentException {\n+        super(THING_TYPES_UIDS, 0, false);\n+        // this.bridge = bridge;\n+    }\n+\n+    @Override\n+    public void activate() {\n+        super.activate(null);\n+    }\n+\n+    @Override\n+    public void deactivate() {\n+        super.deactivate();\n+    }\n+\n+    @Override\n+    protected void startScan() {\n+        try {\n+            String xmlResults = handler.getMspConfig();\n+            mspConfigDiscovery(xmlResults);\n+        } catch (Exception e) {\n+            logger.debug(\"Exception during discovery scan\", e);\n+        }\n+    }\n+\n+    public synchronized boolean mspConfigDiscovery(String xmlResponse) throws Exception {\n+        List<String> systemIDs = new ArrayList<>();\n+        List<String> names = new ArrayList<>();\n+        List<String> bowName = new ArrayList<>();\n+        List<String> bowID = new ArrayList<>();\n+        List<String> property1 = new ArrayList<>();\n+        List<String> property2 = new ArrayList<>();\n+        List<String> property3 = new ArrayList<>();\n+        List<String> property4 = new ArrayList<>();\n+\n+        // Find Backyard\n+        names = handler.evaluateXPath(\"//Backyard/Name/text()\", xmlResponse);\n+\n+        for (String name : names) {\n+            onBackyardDiscovered(Integer.parseInt(handler.account.mspSystemID), name);\n+        }\n+\n+        // Find Bodies of Water\n+        systemIDs = handler.evaluateXPath(\"//Body-of-water/System-Id/text()\", xmlResponse);\n+        names = handler.evaluateXPath(\"//Body-of-water/Name/text()\", xmlResponse);\n+\n+        for (int i = 0; i < systemIDs.size(); i++) {\n+            onBOWDiscovered(Integer.parseInt(systemIDs.get(i)), names.get(i));\n+        }\n+\n+        // Find Chlorinators\n+        systemIDs = handler.evaluateXPath(\"//Chlorinator/System-Id/text()\", xmlResponse);\n+        names = handler.evaluateXPath(\"//Chlorinator/Name/text()\", xmlResponse);\n+\n+        for (int i = 0; i < systemIDs.size(); i++) {\n+            // get Body of Water for each item\n+            bowID = handler.evaluateXPath(\n+                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+            bowName = handler.evaluateXPath(\"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\",\n+                    xmlResponse);\n+            onChlorinatorDiscovered(Integer.parseInt(systemIDs.get(i)), names.get(i), bowID.get(0), bowName.get(0));\n+        }\n+\n+        // Find ColorLogic Lights\n+        systemIDs = handler.evaluateXPath(\"//ColorLogic-Light/System-Id/text()\", xmlResponse);\n+        names = handler.evaluateXPath(\"//ColorLogic-Light/Name/text()\", xmlResponse);\n+\n+        for (int i = 0; i < systemIDs.size(); i++) {\n+            // get Body of Water for each item\n+            bowID = handler.evaluateXPath(\n+                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+            bowName = handler.evaluateXPath(\"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\",\n+                    xmlResponse);\n+            onColorLogicDiscovered(Integer.parseInt(systemIDs.get(i)), names.get(i), bowID.get(0), bowName.get(0));\n+        }\n+\n+        // Find Filters\n+        systemIDs = handler.evaluateXPath(\"//Filter/System-Id/text()\", xmlResponse);\n+        names = handler.evaluateXPath(\"//Filter/Name/text()\", xmlResponse);\n+        property1 = handler.evaluateXPath(\"//Filter/Min-Pump-Speed/text()\", xmlResponse);\n+        property2 = handler.evaluateXPath(\"//Filter/Max-Pump-Speed/text()\", xmlResponse);\n+        property3 = handler.evaluateXPath(\"//Filter/Min-Pump-RPM/text()\", xmlResponse);\n+        property4 = handler.evaluateXPath(\"//Filter/Max-Pump-RPM/text()\", xmlResponse);\n+        for (int i = 0; i < systemIDs.size(); i++) {\n+            // get Body of Water for each item\n+            bowID = handler.evaluateXPath(\n+                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+            bowName = handler.evaluateXPath(\"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\",\n+                    xmlResponse);\n+            onFilterDiscovered(Integer.parseInt(systemIDs.get(i)), names.get(i), bowID.get(0), bowName.get(0),\n+                    property1.get(i), property2.get(i), property3.get(i), property4.get(i));\n+        }\n+\n+        // Find Heaters\n+        systemIDs = handler.evaluateXPath(\"//Heater-Equipment/System-Id/text()\", xmlResponse);\n+        names = handler.evaluateXPath(\"//Heater-Equipment/Name/text()\", xmlResponse);\n+\n+        for (int i = 0; i < systemIDs.size(); i++) {\n+            // get Body of Water for each item\n+            bowID = handler.evaluateXPath(\n+                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/System-Id/text()\", xmlResponse);\n+            bowName = handler.evaluateXPath(\n+                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/Name/text()\", xmlResponse);\n+            onHeaterDiscovered(Integer.parseInt(systemIDs.get(i)), names.get(i), bowID.get(0), bowName.get(0));\n+        }\n+\n+        // Find Pumps\n+        systemIDs = handler.evaluateXPath(\"//Pump/System-Id/text()\", xmlResponse);\n+        names = handler.evaluateXPath(\"//Pump/Name/text()\", xmlResponse);\n+        names = handler.evaluateXPath(\"//Filter/Name/text()\", xmlResponse);\n+        property1 = handler.evaluateXPath(\"//Filter/Min-Pump-Speed/text()\", xmlResponse);\n+        property2 = handler.evaluateXPath(\"//Filter/Max-Pump-Speed/text()\", xmlResponse);\n+        property3 = handler.evaluateXPath(\"//Filter/Min-Pump-RPM/text()\", xmlResponse);\n+        property4 = handler.evaluateXPath(\"//Filter/Max-Pump-RPM/text()\", xmlResponse);\n+\n+        for (int i = 0; i < systemIDs.size(); i++) {\n+            // get Body of Water for each item\n+            bowID = handler.evaluateXPath(\n+                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/System-Id/text()\", xmlResponse);\n+            bowName = handler.evaluateXPath(\n+                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/Name/text()\", xmlResponse);\n+            onPumpDiscovered(Integer.parseInt(systemIDs.get(i)), names.get(i), bowID.get(0), bowName.get(0),\n+                    property1.get(i), property2.get(i), property3.get(i), property4.get(i));\n+        }\n+\n+        // Find Relays\n+        systemIDs = handler.evaluateXPath(\"//Relay/System-Id/text()\", xmlResponse);\n+        names = handler.evaluateXPath(\"//Relay/Name/text()\", xmlResponse);\n+\n+        for (int i = 0; i < systemIDs.size(); i++) {\n+            // get Body of Water for each item\n+            bowID = handler.evaluateXPath(\n+                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+            bowName = handler.evaluateXPath(\"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\",\n+                    xmlResponse);\n+            if (!(bowID.isEmpty())) {\n+                onRelayDiscovered(Integer.parseInt(systemIDs.get(i)), names.get(i), bowID.get(0), bowName.get(0));\n+            } else {\n+                onRelayDiscovered(Integer.parseInt(systemIDs.get(i)), names.get(i), \"\", \"\");\n+            }\n+\n+        }\n+\n+        // Find Virtual Heaters\n+        systemIDs = handler.evaluateXPath(\"//Heater/System-Id/text()\", xmlResponse);\n+\n+        for (int i = 0; i < systemIDs.size(); i++) {\n+            // get Body of Water for each item\n+            bowID = handler.evaluateXPath(\n+                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+            bowName = handler.evaluateXPath(\"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\",\n+                    xmlResponse);\n+            onVirtualHeaterDiscovered(Integer.parseInt(systemIDs.get(i)), \"Virtual Heater\", bowID.get(0),\n+                    bowName.get(0));\n+        }\n+\n+        // Find Sensors\n+        // Flow and water temp sensor aren't showing up in telemetry. Need example to determine how to differentiate\n+        // \"system\" sensors\n+        // that are reported in the BOW water temp, Filter flow switch, ORP, etc.\n+        systemIDs = handler.evaluateXPath(\"//Sensor/System-Id/text()\", xmlResponse);\n+        names = handler.evaluateXPath(\"//Sensor/Name/text()\", xmlResponse);\n+        for (int i = 0; i < systemIDs.size(); i++) {\n+            // get Body of Water for each item\n+            bowID = handler.evaluateXPath(\n+                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+            bowName = handler.evaluateXPath(\"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\",\n+                    xmlResponse);\n+            // Do not add backyard sensors that do not exist in the BOW thus bowID is null\n+            if (!(bowID.isEmpty())) {\n+                onSensorDiscovered(Integer.parseInt(systemIDs.get(i)), names.get(i), bowID.get(0), bowName.get(0));\n+            }\n+        }\n+        return true;\n+    }\n+\n+    public void onBackyardDiscovered(int systemID, String label) {\n+        logger.debug(\"Hayward Backyard {} Discovered: {}\", systemID, label);\n+        ThingUID thingUID = new ThingUID(HaywardBindingConstants.THING_TYPE_BACKYARD, handler.getThing().getUID(),\n+                Integer.toString(systemID));\n+        Map<String, Object> properties = new HashMap<>();\n+        properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, String.valueOf(systemID));\n+        properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BACKYARD);\n+        DiscoveryResult result = DiscoveryResultBuilder.create(thingUID).withBridge(handler.getThing().getUID())\n+                .withRepresentationProperty(HaywardBindingConstants.PROPERTY_SYSTEM_ID).withLabel(\"Hayward \" + label)\n+                .withProperties(properties).build();\n+        thingDiscovered(result);\n+    }\n+\n+    public void onBOWDiscovered(int systemID, String label) {\n+        logger.debug(\"Hayward BOW {} Discovered: {}\", systemID, label);\n+        ThingUID thingUID = new ThingUID(HaywardBindingConstants.THING_TYPE_BOW, handler.getThing().getUID(),\n+                Integer.toString(systemID));\n+        Map<String, Object> properties = new HashMap<>();\n+        properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, String.valueOf(systemID));\n+        properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BOW);\n+        DiscoveryResult result = DiscoveryResultBuilder.create(thingUID).withBridge(handler.getThing().getUID())\n+                .withRepresentationProperty(HaywardBindingConstants.PROPERTY_SYSTEM_ID).withLabel(\"Hayward \" + label)\n+                .withProperties(properties).build();\n+        thingDiscovered(result);\n+    }\n+\n+    public void onChlorinatorDiscovered(int systemID, String label, String bowID, String bowName) {\n+        logger.debug(\"Hayward Chlorinator {} Discovered: {}\", systemID, label);\n+        ThingUID thingUID = new ThingUID(HaywardBindingConstants.THING_TYPE_CHLORINATOR, handler.getThing().getUID(),\n+                Integer.toString(systemID));\n+        Map<String, Object> properties = new HashMap<>();\n+        properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, String.valueOf(systemID));\n+        properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.CHLORINATOR);\n+        properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID);\n+        properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName);\n+        DiscoveryResult result = DiscoveryResultBuilder.create(thingUID).withBridge(handler.getThing().getUID())\n+                .withRepresentationProperty(HaywardBindingConstants.PROPERTY_SYSTEM_ID).withLabel(\"Hayward \" + label)\n+                .withProperties(properties).build();\n+        thingDiscovered(result);\n+    }\n+\n+    public void onColorLogicDiscovered(int systemID, String label, String bowID, String bowName) {\n+        logger.debug(\"Hayward Color Logic Light {} Discovered: {}\", systemID, label);\n+        ThingUID thingUID = new ThingUID(HaywardBindingConstants.THING_TYPE_COLORLOGIC, handler.getThing().getUID(),\n+                Integer.toString(systemID));\n+        Map<String, Object> properties = new HashMap<>();\n+        properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, String.valueOf(systemID));\n+        properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.COLORLOGIC);\n+        properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID);\n+        properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName);\n+        DiscoveryResult result = DiscoveryResultBuilder.create(thingUID).withBridge(handler.getThing().getUID())\n+                .withRepresentationProperty(HaywardBindingConstants.PROPERTY_SYSTEM_ID).withLabel(\"Hayward \" + label)\n+                .withProperties(properties).build();\n+        thingDiscovered(result);\n+    }\n+\n+    public void onFilterDiscovered(int systemID, String label, String bowID, String bowName, String minPumpSpeed,\n+            String maxPumpSpeed, String minPumpRpm, String maxPumpRpm) {\n+        logger.debug(\"Hayward Filter {} Discovered: {}\", systemID, label);\n+        ThingUID thingUID = new ThingUID(HaywardBindingConstants.THING_TYPE_FILTER, handler.getThing().getUID(),\n+                Integer.toString(systemID));\n+        Map<String, Object> properties = new HashMap<>();\n+        properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, String.valueOf(systemID));\n+        properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.FILTER);\n+        properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID);\n+        properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName);\n+        properties.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPSPEED, minPumpSpeed);\n+        properties.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPSPEED, maxPumpSpeed);\n+        properties.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPRPM, minPumpRpm);\n+        properties.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPRPM, maxPumpRpm);\n+        DiscoveryResult result = DiscoveryResultBuilder.create(thingUID).withBridge(handler.getThing().getUID())\n+                .withRepresentationProperty(HaywardBindingConstants.PROPERTY_SYSTEM_ID).withLabel(\"Hayward \" + label)\n+                .withProperties(properties).build();\n+        thingDiscovered(result);\n+    }\n+\n+    public void onHeaterDiscovered(int systemID, String label, String bowID, String bowName) {\n+        logger.debug(\"Hayward Heater {} Discovered: {}\", systemID, label);\n+        ThingUID thingUID = new ThingUID(HaywardBindingConstants.THING_TYPE_HEATER, handler.getThing().getUID(),\n+                Integer.toString(systemID));\n+        Map<String, Object> properties = new HashMap<>();\n+        properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, String.valueOf(systemID));\n+        properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.HEATER);\n+        properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID);\n+        properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName);\n+        DiscoveryResult result = DiscoveryResultBuilder.create(thingUID).withBridge(handler.getThing().getUID())\n+                .withRepresentationProperty(HaywardBindingConstants.PROPERTY_SYSTEM_ID).withLabel(\"Hayward \" + label)\n+                .withProperties(properties).build();\n+        thingDiscovered(result);\n+    }\n+\n+    public void onPumpDiscovered(int systemID, String label, String bowID, String bowName, String property1,\n+            String property2, String property3, String property4) {\n+        logger.debug(\"Hayward Pump {} Discovered: {}\", systemID, label);\n+        ThingUID thingUID = new ThingUID(HaywardBindingConstants.THING_TYPE_PUMP, handler.getThing().getUID(),\n+                Integer.toString(systemID));\n+        Map<String, Object> properties = new HashMap<>();\n+        properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, String.valueOf(systemID));\n+        properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.PUMP);\n+        properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID);\n+        properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName);\n+        properties.put(HaywardBindingConstants.PROPERTY_PUMP_MINPUMPSPEED, property1);\n+        properties.put(HaywardBindingConstants.PROPERTY_PUMP_MAXPUMPSPEED, property2);\n+        properties.put(HaywardBindingConstants.PROPERTY_PUMP_MINPUMPRPM, property3);\n+        properties.put(HaywardBindingConstants.PROPERTY_PUMP_MAXPUMPRPM, property4);\n+        DiscoveryResult result = DiscoveryResultBuilder.create(thingUID).withBridge(handler.getThing().getUID())\n+                .withRepresentationProperty(HaywardBindingConstants.PROPERTY_SYSTEM_ID).withLabel(\"Hayward \" + label)\n+                .withProperties(properties).build();\n+        thingDiscovered(result);\n+    }\n+\n+    public void onRelayDiscovered(int systemID, String label, String bowID, String bowName) {\n+        logger.debug(\"Hayward Relay {} Discovered: {}\", systemID, label);\n+        ThingUID thingUID = new ThingUID(HaywardBindingConstants.THING_TYPE_RELAY, handler.getThing().getUID(),\n+                Integer.toString(systemID));\n+        Map<String, Object> properties = new HashMap<>();\n+        properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, String.valueOf(systemID));\n+        properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.RELAY);\n+        properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID);\n+        properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName);\n+        DiscoveryResult result = DiscoveryResultBuilder.create(thingUID).withBridge(handler.getThing().getUID())\n+                .withRepresentationProperty(HaywardBindingConstants.PROPERTY_SYSTEM_ID).withLabel(\"Hayward \" + label)\n+                .withProperties(properties).build();\n+        thingDiscovered(result);\n+    }\n+\n+    public void onSensorDiscovered(int systemID, String label, String bowID, String bowName) {\n+        logger.debug(\"Hayward Sensor {} Discovered: {}\", systemID, label);\n+        ThingUID thingUID = new ThingUID(HaywardBindingConstants.THING_TYPE_SENSOR, handler.getThing().getUID(),\n+                Integer.toString(systemID));\n+        Map<String, Object> properties = new HashMap<>();\n+        properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, String.valueOf(systemID));\n+        properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.SENSOR);\n+        properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID);\n+        properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName);\n+        DiscoveryResult result = DiscoveryResultBuilder.create(thingUID).withBridge(handler.getThing().getUID())\n+                .withRepresentationProperty(HaywardBindingConstants.PROPERTY_SYSTEM_ID).withLabel(\"Hayward \" + label)\n+                .withProperties(properties).build();\n+        thingDiscovered(result);\n+    }\n+\n+    public void onVirtualHeaterDiscovered(int systemID, String label, String bowID, String bowName) {\n+        logger.debug(\"Hayward Virtual Heater {} Discovered: {}\", systemID, label);\n+        ThingUID thingUID = new ThingUID(HaywardBindingConstants.THING_TYPE_VIRTUALHEATER, handler.getThing().getUID(),\n+                Integer.toString(systemID));\n+        Map<String, Object> properties = new HashMap<>();\n+        properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, String.valueOf(systemID));\n+        properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.VIRTUALHEATER.toString());\n+        properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID);\n+        properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName);\n+        DiscoveryResult result = DiscoveryResultBuilder.create(thingUID).withBridge(handler.getThing().getUID())\n+                .withRepresentationProperty(HaywardBindingConstants.PROPERTY_SYSTEM_ID).withLabel(\"Hayward \" + label)\n+                .withProperties(properties).build();\n+        thingDiscovered(result);\n+    }\n+\n+    @Override\n+    public void setThingHandler(@Nullable ThingHandler handler) {\n+        if (handler instanceof HaywardBridgeHandler) {\n+            this.handler = (HaywardBridgeHandler) handler;\n+            this.handler.setHaywardDiscoveryService(this);\n+        }\n+    }\n+\n+    // @Override\n+    // public void setThingHandler(@Nullable ThingHandler handler) {\n+    // if (handler instanceof YamahaBridgeHandler) {\n+    // this.handler = (YamahaBridgeHandler) handler;\n+    // this.handler.setZoneDiscoveryService(this);\n+    // }\n+    // }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37ddd0c1b2b24734272871f168bed6cb9fb77fda"}, "originalPosition": 405}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYzMzYzNQ==", "bodyText": "remove this line", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r514633635", "createdAt": "2020-10-29T23:58:43Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/discovery/HaywardDiscoveryService.java", "diffHunk": "@@ -0,0 +1,411 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.discovery;\n+\n+import static org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants.THING_TYPES_UIDS;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.config.discovery.AbstractDiscoveryService;\n+import org.openhab.core.config.discovery.DiscoveryResult;\n+import org.openhab.core.config.discovery.DiscoveryResultBuilder;\n+import org.openhab.core.config.discovery.DiscoveryService;\n+import org.openhab.core.thing.ThingUID;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Sets up the discovery results and details\n+ *\n+ * @author Matt Myers - Initial Contribution\n+ */\n+\n+// public class HaywardDiscoveryService extends AbstractDiscoveryService implements HaywardHandlerListener {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37ddd0c1b2b24734272871f168bed6cb9fb77fda"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYzNDAyMw==", "bodyText": "use it or lose it", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r514634023", "createdAt": "2020-10-30T00:00:02Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/HaywardBindingConstants.java", "diffHunk": "@@ -0,0 +1,149 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+\n+package org.openhab.binding.haywardomnilogic.internal;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.openhab.core.thing.ThingTypeUID;\n+\n+/**\n+ * The {@link HaywardBindingConstants} class defines common constants, which are\n+ * used across the whole binding.\n+ *\n+ * @author Matt Myers - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class HaywardBindingConstants {\n+\n+    private static final String BINDING_ID = \"haywardomnilogic\";\n+\n+    // List of all Thing Type UIDs\n+    public static final ThingTypeUID THING_TYPE_BACKYARD = new ThingTypeUID(BINDING_ID, \"backyard\");\n+    public static final ThingTypeUID THING_TYPE_BOW = new ThingTypeUID(BINDING_ID, \"bow\");\n+    public static final ThingTypeUID THING_TYPE_BRIDGE = new ThingTypeUID(BINDING_ID, \"bridge\");\n+    public static final ThingTypeUID THING_TYPE_CHLORINATOR = new ThingTypeUID(BINDING_ID, \"chlorinator\");\n+    public static final ThingTypeUID THING_TYPE_COLORLOGIC = new ThingTypeUID(BINDING_ID, \"colorlogic\");\n+    public static final ThingTypeUID THING_TYPE_FILTER = new ThingTypeUID(BINDING_ID, \"filter\");\n+    public static final ThingTypeUID THING_TYPE_HEATER = new ThingTypeUID(BINDING_ID, \"heater\");\n+    public static final ThingTypeUID THING_TYPE_PUMP = new ThingTypeUID(BINDING_ID, \"pump\");\n+    public static final ThingTypeUID THING_TYPE_RELAY = new ThingTypeUID(BINDING_ID, \"relay\");\n+    public static final ThingTypeUID THING_TYPE_SENSOR = new ThingTypeUID(BINDING_ID, \"sensor\");\n+    public static final ThingTypeUID THING_TYPE_VIRTUALHEATER = new ThingTypeUID(BINDING_ID, \"virtualHeater\");\n+\n+    public static final Set<ThingTypeUID> BRIDGE_THING_TYPES_UIDS = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    // public static final Set<ThingTypeUID> ZONE_THING_TYPES_UIDS = Collections.singleton(ZONE_THING_TYPE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37ddd0c1b2b24734272871f168bed6cb9fb77fda"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4ODM1MDQ1", "url": "https://github.com/openhab/openhab-addons/pull/8685#pullrequestreview-538835045", "createdAt": "2020-11-25T20:44:40Z", "commit": {"oid": "d57d0a19025e25837b033566436cc5d865a7bb54"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQyMDo0NDo0MFrOH6DUuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwMTo0OTo1OVrOH-9L1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDYzMzkxMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static final Set<ThingTypeUID> THING_TYPES_UIDS = new HashSet<ThingTypeUID>(\n          \n          \n            \n                        Arrays.asList(HaywardBindingConstants.THING_TYPE_BACKYARD, HaywardBindingConstants.THING_TYPE_BOW,\n          \n          \n            \n                                HaywardBindingConstants.THING_TYPE_BRIDGE, HaywardBindingConstants.THING_TYPE_CHLORINATOR,\n          \n          \n            \n                                HaywardBindingConstants.THING_TYPE_COLORLOGIC, HaywardBindingConstants.THING_TYPE_FILTER,\n          \n          \n            \n                                HaywardBindingConstants.THING_TYPE_HEATER, HaywardBindingConstants.THING_TYPE_PUMP,\n          \n          \n            \n                                HaywardBindingConstants.THING_TYPE_RELAY, HaywardBindingConstants.THING_TYPE_SENSOR,\n          \n          \n            \n                                HaywardBindingConstants.THING_TYPE_VIRTUALHEATER));\n          \n          \n            \n                public static final Set<ThingTypeUID> THING_TYPES_UIDS = Set.of(HaywardBindingConstants.THING_TYPE_BACKYARD, HaywardBindingConstants.THING_TYPE_BOW,\n          \n          \n            \n                                HaywardBindingConstants.THING_TYPE_BRIDGE, HaywardBindingConstants.THING_TYPE_CHLORINATOR,\n          \n          \n            \n                                HaywardBindingConstants.THING_TYPE_COLORLOGIC, HaywardBindingConstants.THING_TYPE_FILTER,\n          \n          \n            \n                                HaywardBindingConstants.THING_TYPE_HEATER, HaywardBindingConstants.THING_TYPE_PUMP,\n          \n          \n            \n                                HaywardBindingConstants.THING_TYPE_RELAY, HaywardBindingConstants.THING_TYPE_SENSOR,\n          \n          \n            \n                                HaywardBindingConstants.THING_TYPE_VIRTUALHEATER);", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r530633912", "createdAt": "2020-11-25T20:44:40Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/HaywardBindingConstants.java", "diffHunk": "@@ -0,0 +1,147 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+\n+package org.openhab.binding.haywardomnilogic.internal;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.openhab.core.thing.ThingTypeUID;\n+\n+/**\n+ * The {@link HaywardBindingConstants} class defines common constants, which are\n+ * used across the whole binding.\n+ *\n+ * @author Matt Myers - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class HaywardBindingConstants {\n+\n+    private static final String BINDING_ID = \"haywardomnilogic\";\n+\n+    // List of all Thing Type UIDs\n+    public static final ThingTypeUID THING_TYPE_BACKYARD = new ThingTypeUID(BINDING_ID, \"backyard\");\n+    public static final ThingTypeUID THING_TYPE_BOW = new ThingTypeUID(BINDING_ID, \"bow\");\n+    public static final ThingTypeUID THING_TYPE_BRIDGE = new ThingTypeUID(BINDING_ID, \"bridge\");\n+    public static final ThingTypeUID THING_TYPE_CHLORINATOR = new ThingTypeUID(BINDING_ID, \"chlorinator\");\n+    public static final ThingTypeUID THING_TYPE_COLORLOGIC = new ThingTypeUID(BINDING_ID, \"colorlogic\");\n+    public static final ThingTypeUID THING_TYPE_FILTER = new ThingTypeUID(BINDING_ID, \"filter\");\n+    public static final ThingTypeUID THING_TYPE_HEATER = new ThingTypeUID(BINDING_ID, \"heater\");\n+    public static final ThingTypeUID THING_TYPE_PUMP = new ThingTypeUID(BINDING_ID, \"pump\");\n+    public static final ThingTypeUID THING_TYPE_RELAY = new ThingTypeUID(BINDING_ID, \"relay\");\n+    public static final ThingTypeUID THING_TYPE_SENSOR = new ThingTypeUID(BINDING_ID, \"sensor\");\n+    public static final ThingTypeUID THING_TYPE_VIRTUALHEATER = new ThingTypeUID(BINDING_ID, \"virtualHeater\");\n+\n+    public static final Set<ThingTypeUID> BRIDGE_THING_TYPES_UIDS = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    public static final Set<ThingTypeUID> THING_TYPES_UIDS = new HashSet<ThingTypeUID>(\n+            Arrays.asList(HaywardBindingConstants.THING_TYPE_BACKYARD, HaywardBindingConstants.THING_TYPE_BOW,\n+                    HaywardBindingConstants.THING_TYPE_BRIDGE, HaywardBindingConstants.THING_TYPE_CHLORINATOR,\n+                    HaywardBindingConstants.THING_TYPE_COLORLOGIC, HaywardBindingConstants.THING_TYPE_FILTER,\n+                    HaywardBindingConstants.THING_TYPE_HEATER, HaywardBindingConstants.THING_TYPE_PUMP,\n+                    HaywardBindingConstants.THING_TYPE_RELAY, HaywardBindingConstants.THING_TYPE_SENSOR,\n+                    HaywardBindingConstants.THING_TYPE_VIRTUALHEATER));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d57d0a19025e25837b033566436cc5d865a7bb54"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDYzNDAwOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static final Set<ThingTypeUID> BRIDGE_THING_TYPES_UIDS = Collections.singleton(THING_TYPE_BRIDGE);\n          \n          \n            \n                public static final Set<ThingTypeUID> BRIDGE_THING_TYPES_UIDS = Set.of(THING_TYPE_BRIDGE);", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r530634008", "createdAt": "2020-11-25T20:44:54Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/HaywardBindingConstants.java", "diffHunk": "@@ -0,0 +1,147 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+\n+package org.openhab.binding.haywardomnilogic.internal;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.openhab.core.thing.ThingTypeUID;\n+\n+/**\n+ * The {@link HaywardBindingConstants} class defines common constants, which are\n+ * used across the whole binding.\n+ *\n+ * @author Matt Myers - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class HaywardBindingConstants {\n+\n+    private static final String BINDING_ID = \"haywardomnilogic\";\n+\n+    // List of all Thing Type UIDs\n+    public static final ThingTypeUID THING_TYPE_BACKYARD = new ThingTypeUID(BINDING_ID, \"backyard\");\n+    public static final ThingTypeUID THING_TYPE_BOW = new ThingTypeUID(BINDING_ID, \"bow\");\n+    public static final ThingTypeUID THING_TYPE_BRIDGE = new ThingTypeUID(BINDING_ID, \"bridge\");\n+    public static final ThingTypeUID THING_TYPE_CHLORINATOR = new ThingTypeUID(BINDING_ID, \"chlorinator\");\n+    public static final ThingTypeUID THING_TYPE_COLORLOGIC = new ThingTypeUID(BINDING_ID, \"colorlogic\");\n+    public static final ThingTypeUID THING_TYPE_FILTER = new ThingTypeUID(BINDING_ID, \"filter\");\n+    public static final ThingTypeUID THING_TYPE_HEATER = new ThingTypeUID(BINDING_ID, \"heater\");\n+    public static final ThingTypeUID THING_TYPE_PUMP = new ThingTypeUID(BINDING_ID, \"pump\");\n+    public static final ThingTypeUID THING_TYPE_RELAY = new ThingTypeUID(BINDING_ID, \"relay\");\n+    public static final ThingTypeUID THING_TYPE_SENSOR = new ThingTypeUID(BINDING_ID, \"sensor\");\n+    public static final ThingTypeUID THING_TYPE_VIRTUALHEATER = new ThingTypeUID(BINDING_ID, \"virtualHeater\");\n+\n+    public static final Set<ThingTypeUID> BRIDGE_THING_TYPES_UIDS = Collections.singleton(THING_TYPE_BRIDGE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d57d0a19025e25837b033566436cc5d865a7bb54"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTc3NDE2OQ==", "bodyText": "Please include the exception message in the log.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r535774169", "createdAt": "2020-12-04T01:44:19Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/handler/HaywardVirtualHeaterHandler.java", "diffHunk": "@@ -0,0 +1,135 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.handler;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingHandler;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingProperties;\n+import org.openhab.core.library.types.OnOffType;\n+import org.openhab.core.thing.ChannelUID;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.types.Command;\n+import org.openhab.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The Virtual Heater Handler\n+ *\n+ * @author Matt Myers - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class HaywardVirtualHeaterHandler extends HaywardThingHandler {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardVirtualHeaterHandler.class);\n+\n+    HaywardThingProperties prop = getConfig().as(HaywardThingProperties.class);\n+\n+    public HaywardVirtualHeaterHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    @Override\n+    public void getTelemetry(String xmlResponse) throws Exception {\n+        List<String> systemIDs = new ArrayList<>();\n+        List<String> data = new ArrayList<>();\n+        List<String> currentSetpoint = new ArrayList<>();\n+\n+        @SuppressWarnings(\"null\")\n+        HaywardBridgeHandler bridgehandler = (HaywardBridgeHandler) getBridge().getHandler();\n+        if (bridgehandler != null) {\n+            systemIDs = bridgehandler.evaluateXPath(\"//VirtualHeater/@systemId\", xmlResponse);\n+            String thingSystemID = getThing().getUID().getId();\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                if (systemIDs.get(i).equals(thingSystemID)) {\n+                    data = bridgehandler.evaluateXPath(\"//VirtualHeater/@Current-Set-Point\", xmlResponse);\n+                    updateData(HaywardBindingConstants.CHANNEL_VIRTUALHEATER_CURRENTSETPOINT, data.get(i));\n+\n+                    data = bridgehandler.evaluateXPath(\"//VirtualHeater/@enable\", xmlResponse);\n+                    if (data.get(i).equals(\"yes\")) {\n+                        updateData(HaywardBindingConstants.CHANNEL_VIRTUALHEATER_ENABLE, \"1\");\n+                    } else if (data.get(i).equals(\"no\")) {\n+                        updateData(HaywardBindingConstants.CHANNEL_VIRTUALHEATER_ENABLE, \"0\");\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if ((command instanceof RefreshType)) {\n+            return;\n+        }\n+\n+        prop.systemID = getThing().getProperties().get(HaywardBindingConstants.PROPERTY_SYSTEM_ID);\n+        prop.poolID = getThing().getProperties().get(HaywardBindingConstants.PROPERTY_BOWID);\n+\n+        @SuppressWarnings(\"null\")\n+        HaywardBridgeHandler bridgehandler = (HaywardBridgeHandler) getBridge().getHandler();\n+        if (bridgehandler != null) {\n+            String cmdString = this.cmdToString(command);\n+            String cmdURL = null;\n+\n+            if (command == OnOffType.ON) {\n+                cmdString = \"True\";\n+            } else if (command == OnOffType.OFF) {\n+                cmdString = \"False\";\n+            }\n+\n+            try {\n+                switch (channelUID.getId()) {\n+                    case HaywardBindingConstants.CHANNEL_VIRTUALHEATER_ENABLE:\n+                        cmdURL = HaywardBindingConstants.COMMAND_PARAMETERS + \"<Name>SetHeaterEnable</Name><Parameters>\"\n+                                + \"<Parameter name=\\\"Token\\\" dataType=\\\"String\\\">\" + bridgehandler.account.token\n+                                + \"</Parameter>\" + \"<Parameter name=\\\"MspSystemID\\\" dataType=\\\"int\\\">\"\n+                                + bridgehandler.account.mspSystemID + \"</Parameter>\"\n+                                + \"<Parameter name=\\\"PoolID\\\" dataType=\\\"int\\\">\" + prop.poolID + \"</Parameter>\"\n+                                + \"<Parameter name=\\\"HeaterID\\\" dataType=\\\"int\\\">\" + prop.systemID + \"</Parameter>\"\n+                                + \"<Parameter name=\\\"Enabled\\\" dataType=\\\"bool\\\">\" + cmdString + \"</Parameter>\"\n+                                + \"</Parameters></Request>\";\n+                        break;\n+\n+                    case HaywardBindingConstants.CHANNEL_VIRTUALHEATER_CURRENTSETPOINT:\n+                        cmdURL = HaywardBindingConstants.COMMAND_PARAMETERS + \"<Name>SetUIHeaterCmd</Name><Parameters>\"\n+                                + \"<Parameter name=\\\"Token\\\" dataType=\\\"String\\\">\" + bridgehandler.account.token\n+                                + \"</Parameter>\" + \"<Parameter name=\\\"MspSystemID\\\" dataType=\\\"int\\\">\"\n+                                + bridgehandler.account.mspSystemID + \"</Parameter>\"\n+                                + \"<Parameter name=\\\"PoolID\\\" dataType=\\\"int\\\">\" + prop.poolID + \"</Parameter>\"\n+                                + \"<Parameter name=\\\"HeaterID\\\" dataType=\\\"int\\\">\" + prop.systemID + \"</Parameter>\"\n+                                + \"<Parameter name=\\\"Temp\\\" dataType=\\\"int\\\">\" + cmdString + \"</Parameter>\"\n+                                + \"</Parameters></Request>\";\n+                        break;\n+                    default:\n+                        logger.warn(\"haywardCommand Unsupported type {}\", channelUID);\n+                        return;\n+                }\n+\n+                // *****Send Command to Hayward server\n+                String xmlResponse = bridgehandler.httpXmlResponse(cmdURL);\n+                String status = bridgehandler.evaluateXPath(\"//Parameter[@name='Status']/text()\", xmlResponse).get(0);\n+\n+                if (!(status.equals(\"0\"))) {\n+                    logger.debug(\"haywardCommand XML response: {}\", xmlResponse);\n+                    return;\n+                }\n+            } catch (Exception e) {\n+                logger.debug(\"Unable to send command to Hayward's server {}:{}\", bridgehandler.config.endpointUrl,\n+                        bridgehandler.config.username);\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d57d0a19025e25837b033566436cc5d865a7bb54"}, "originalPosition": 132}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTc3NTExNQ==", "bodyText": "Are these used?", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r535775115", "createdAt": "2020-12-04T01:46:55Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/HaywardBindingConstants.java", "diffHunk": "@@ -0,0 +1,147 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+\n+package org.openhab.binding.haywardomnilogic.internal;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.openhab.core.thing.ThingTypeUID;\n+\n+/**\n+ * The {@link HaywardBindingConstants} class defines common constants, which are\n+ * used across the whole binding.\n+ *\n+ * @author Matt Myers - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class HaywardBindingConstants {\n+\n+    private static final String BINDING_ID = \"haywardomnilogic\";\n+\n+    // List of all Thing Type UIDs\n+    public static final ThingTypeUID THING_TYPE_BACKYARD = new ThingTypeUID(BINDING_ID, \"backyard\");\n+    public static final ThingTypeUID THING_TYPE_BOW = new ThingTypeUID(BINDING_ID, \"bow\");\n+    public static final ThingTypeUID THING_TYPE_BRIDGE = new ThingTypeUID(BINDING_ID, \"bridge\");\n+    public static final ThingTypeUID THING_TYPE_CHLORINATOR = new ThingTypeUID(BINDING_ID, \"chlorinator\");\n+    public static final ThingTypeUID THING_TYPE_COLORLOGIC = new ThingTypeUID(BINDING_ID, \"colorlogic\");\n+    public static final ThingTypeUID THING_TYPE_FILTER = new ThingTypeUID(BINDING_ID, \"filter\");\n+    public static final ThingTypeUID THING_TYPE_HEATER = new ThingTypeUID(BINDING_ID, \"heater\");\n+    public static final ThingTypeUID THING_TYPE_PUMP = new ThingTypeUID(BINDING_ID, \"pump\");\n+    public static final ThingTypeUID THING_TYPE_RELAY = new ThingTypeUID(BINDING_ID, \"relay\");\n+    public static final ThingTypeUID THING_TYPE_SENSOR = new ThingTypeUID(BINDING_ID, \"sensor\");\n+    public static final ThingTypeUID THING_TYPE_VIRTUALHEATER = new ThingTypeUID(BINDING_ID, \"virtualHeater\");\n+\n+    public static final Set<ThingTypeUID> BRIDGE_THING_TYPES_UIDS = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    public static final Set<ThingTypeUID> THING_TYPES_UIDS = new HashSet<ThingTypeUID>(\n+            Arrays.asList(HaywardBindingConstants.THING_TYPE_BACKYARD, HaywardBindingConstants.THING_TYPE_BOW,\n+                    HaywardBindingConstants.THING_TYPE_BRIDGE, HaywardBindingConstants.THING_TYPE_CHLORINATOR,\n+                    HaywardBindingConstants.THING_TYPE_COLORLOGIC, HaywardBindingConstants.THING_TYPE_FILTER,\n+                    HaywardBindingConstants.THING_TYPE_HEATER, HaywardBindingConstants.THING_TYPE_PUMP,\n+                    HaywardBindingConstants.THING_TYPE_RELAY, HaywardBindingConstants.THING_TYPE_SENSOR,\n+                    HaywardBindingConstants.THING_TYPE_VIRTUALHEATER));\n+\n+    // List of all Channel ids (bridge)\n+    // No Channels\n+\n+    // List of all Channel ids (backyard)\n+    public static final String CHANNEL_BACKYARD_AIRTEMP = \"backyardAirTemp\";\n+    public static final String CHANNEL_BACKYARD_STATUS = \"backyardStatus\";\n+    public static final String CHANNEL_BACKYARD_STATE = \"backyardState\";\n+    public static final String CHANNEL_BACKYARD_ALARM1 = \"backyardAlarm1\";\n+    public static final String CHANNEL_BACKYARD_ALARM2 = \"backyardAlarm2\";\n+    public static final String CHANNEL_BACKYARD_ALARM3 = \"backyardAlarm3\";\n+    public static final String CHANNEL_BACKYARD_ALARM4 = \"backyardAlarm4\";\n+    public static final String CHANNEL_BACKYARD_ALARM5 = \"backyardAlarm5\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d57d0a19025e25837b033566436cc5d865a7bb54"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTc3NjIxNA==", "bodyText": "This if statement is redundant since the code above would return if !(status.equals(\"0\")", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r535776214", "createdAt": "2020-12-04T01:49:59Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/handler/HaywardBackyardHandler.java", "diffHunk": "@@ -0,0 +1,117 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.handler;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingHandler;\n+import org.openhab.core.thing.Thing;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The Backyard Handler\n+ *\n+ * @author Matt Myers - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class HaywardBackyardHandler extends HaywardThingHandler {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardBackyardHandler.class);\n+\n+    public HaywardBackyardHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    @Override\n+    public void getTelemetry(String xmlResponse) throws Exception {\n+        List<String> data = new ArrayList<>();\n+        List<String> systemIDs = new ArrayList<>();\n+\n+        @SuppressWarnings(\"null\")\n+        HaywardBridgeHandler bridgehandler = (HaywardBridgeHandler) getBridge().getHandler();\n+        if (bridgehandler != null) {\n+            systemIDs = bridgehandler.evaluateXPath(\"//Backyard/@systemId\", xmlResponse);\n+            String thingSystemID = getThing().getUID().getId();\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                if (systemIDs.get(i).equals(thingSystemID)) {\n+                    // Air temp\n+                    data = bridgehandler.evaluateXPath(\"//Backyard/@airTemp\", xmlResponse);\n+                    updateData(HaywardBindingConstants.CHANNEL_BACKYARD_AIRTEMP, data.get(0));\n+\n+                    // Status\n+                    data = bridgehandler.evaluateXPath(\"//Backyard/@status\", xmlResponse);\n+                    updateData(HaywardBindingConstants.CHANNEL_BACKYARD_STATUS, data.get(0));\n+\n+                    // State\n+                    data = bridgehandler.evaluateXPath(\"//Backyard/@state\", xmlResponse);\n+                    updateData(HaywardBindingConstants.CHANNEL_BACKYARD_STATE, data.get(0));\n+                }\n+            }\n+        }\n+    }\n+\n+    public boolean getAlarmList(String systemID) throws Exception {\n+        List<String> bowID = new ArrayList<>();\n+        List<String> parameter1 = new ArrayList<>();\n+        List<String> message = new ArrayList<>();\n+        String alarmStr;\n+\n+        @SuppressWarnings(\"null\")\n+        HaywardBridgeHandler bridgehandler = (HaywardBridgeHandler) getBridge().getHandler();\n+\n+        // *****Request Alarm List from Hayward server\n+        @SuppressWarnings(\"null\")\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request><Name>GetAlarmList</Name><Parameters>\"\n+                + \"<Parameter name=\\\"Token\\\" dataType=\\\"String\\\">\" + bridgehandler.account.token + \"</Parameter>\"\n+                + \"<Parameter name=\\\"MspSystemID\\\" dataType=\\\"int\\\">\" + bridgehandler.account.mspSystemID\n+                + \"</Parameter>\"\n+                + \"<Parameter name=\\\"CultureInfoName\\\" dataType=\\\"String\\\">en-us</Parameter></Parameters></Request>\";\n+\n+        String xmlResponse = bridgehandler.httpXmlResponse(urlParameters);\n+\n+        if (xmlResponse.isEmpty()) {\n+            logger.debug(\"Hayward getAlarmList XML response was empty\");\n+            return false;\n+        }\n+\n+        String status = bridgehandler\n+                .evaluateXPath(\"/Response/Parameters//Parameter[@name='Status']/text()\", xmlResponse).get(0);\n+\n+        if (!(status.equals(\"0\"))) {\n+            logger.trace(\"Hayward getAlarm XML response: {}\", xmlResponse);\n+            return false;\n+        }\n+\n+        if (status.equals(\"0\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d57d0a19025e25837b033566436cc5d865a7bb54"}, "originalPosition": 98}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1OTUzNDc5", "url": "https://github.com/openhab/openhab-addons/pull/8685#pullrequestreview-555953479", "createdAt": "2020-12-19T16:40:15Z", "commit": {"oid": "1a3e02205380a2b0ab8d6862592f8ad84944c448"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQxNjo0MDoxNlrOII87CA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQxNjo1MzoyMlrOII8_2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI1NzY3Mg==", "bodyText": "Can this be removed?", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r546257672", "createdAt": "2020-12-19T16:40:16Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/discovery/HaywardDiscoveryService.java", "diffHunk": "@@ -0,0 +1,410 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.discovery;\n+\n+import static org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants.THING_TYPES_UIDS;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.config.discovery.AbstractDiscoveryService;\n+import org.openhab.core.config.discovery.DiscoveryResult;\n+import org.openhab.core.config.discovery.DiscoveryResultBuilder;\n+import org.openhab.core.config.discovery.DiscoveryService;\n+import org.openhab.core.thing.ThingUID;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Sets up the discovery results and details\n+ *\n+ * @author Matt Myers - Initial Contribution\n+ */\n+\n+@NonNullByDefault\n+public class HaywardDiscoveryService extends AbstractDiscoveryService implements DiscoveryService, ThingHandlerService {\n+\n+    private final Logger logger = LoggerFactory.getLogger(HaywardDiscoveryService.class);\n+    private @Nullable HaywardBridgeHandler handler;\n+\n+    public HaywardDiscoveryService() {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    /**\n+     * Constructs a zone discovery service.\n+     * Registers this zone discovery service programmatically.\n+     * Call {@link ZoneDiscoveryService#destroy()} to unregister the service after use.\n+     */\n+    public HaywardDiscoveryService(HaywardBridgeHandler bridge) throws IllegalArgumentException {\n+        super(THING_TYPES_UIDS, 0, false);\n+        // this.bridge = bridge;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a3e02205380a2b0ab8d6862592f8ad84944c448"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI1Nzc0Mw==", "bodyText": "Can you fix the compiler warning about null value?", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r546257743", "createdAt": "2020-12-19T16:41:17Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/discovery/HaywardDiscoveryService.java", "diffHunk": "@@ -0,0 +1,410 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.discovery;\n+\n+import static org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants.THING_TYPES_UIDS;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.config.discovery.AbstractDiscoveryService;\n+import org.openhab.core.config.discovery.DiscoveryResult;\n+import org.openhab.core.config.discovery.DiscoveryResultBuilder;\n+import org.openhab.core.config.discovery.DiscoveryService;\n+import org.openhab.core.thing.ThingUID;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Sets up the discovery results and details\n+ *\n+ * @author Matt Myers - Initial Contribution\n+ */\n+\n+@NonNullByDefault\n+public class HaywardDiscoveryService extends AbstractDiscoveryService implements DiscoveryService, ThingHandlerService {\n+\n+    private final Logger logger = LoggerFactory.getLogger(HaywardDiscoveryService.class);\n+    private @Nullable HaywardBridgeHandler handler;\n+\n+    public HaywardDiscoveryService() {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    /**\n+     * Constructs a zone discovery service.\n+     * Registers this zone discovery service programmatically.\n+     * Call {@link ZoneDiscoveryService#destroy()} to unregister the service after use.\n+     */\n+    public HaywardDiscoveryService(HaywardBridgeHandler bridge) throws IllegalArgumentException {\n+        super(THING_TYPES_UIDS, 0, false);\n+        // this.bridge = bridge;\n+    }\n+\n+    @Override\n+    public void activate() {\n+        super.activate(null);\n+    }\n+\n+    @Override\n+    public void deactivate() {\n+        super.deactivate();\n+    }\n+\n+    @Override\n+    protected void startScan() {\n+        try {\n+            String xmlResults = handler.getMspConfig();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a3e02205380a2b0ab8d6862592f8ad84944c448"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI1NzgyOQ==", "bodyText": "Better create a custom exception for this as Exception catches also all RuntimeExceptions. Please check all try-catch blocks.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r546257829", "createdAt": "2020-12-19T16:42:29Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/discovery/HaywardDiscoveryService.java", "diffHunk": "@@ -0,0 +1,410 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.discovery;\n+\n+import static org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants.THING_TYPES_UIDS;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.config.discovery.AbstractDiscoveryService;\n+import org.openhab.core.config.discovery.DiscoveryResult;\n+import org.openhab.core.config.discovery.DiscoveryResultBuilder;\n+import org.openhab.core.config.discovery.DiscoveryService;\n+import org.openhab.core.thing.ThingUID;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Sets up the discovery results and details\n+ *\n+ * @author Matt Myers - Initial Contribution\n+ */\n+\n+@NonNullByDefault\n+public class HaywardDiscoveryService extends AbstractDiscoveryService implements DiscoveryService, ThingHandlerService {\n+\n+    private final Logger logger = LoggerFactory.getLogger(HaywardDiscoveryService.class);\n+    private @Nullable HaywardBridgeHandler handler;\n+\n+    public HaywardDiscoveryService() {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    /**\n+     * Constructs a zone discovery service.\n+     * Registers this zone discovery service programmatically.\n+     * Call {@link ZoneDiscoveryService#destroy()} to unregister the service after use.\n+     */\n+    public HaywardDiscoveryService(HaywardBridgeHandler bridge) throws IllegalArgumentException {\n+        super(THING_TYPES_UIDS, 0, false);\n+        // this.bridge = bridge;\n+    }\n+\n+    @Override\n+    public void activate() {\n+        super.activate(null);\n+    }\n+\n+    @Override\n+    public void deactivate() {\n+        super.deactivate();\n+    }\n+\n+    @Override\n+    protected void startScan() {\n+        try {\n+            String xmlResults = handler.getMspConfig();\n+            mspConfigDiscovery(xmlResults);\n+        } catch (Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a3e02205380a2b0ab8d6862592f8ad84944c448"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI1Nzg2OA==", "bodyText": "Are you logging the stack trace by intention? Please check all.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r546257868", "createdAt": "2020-12-19T16:42:48Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/discovery/HaywardDiscoveryService.java", "diffHunk": "@@ -0,0 +1,410 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.discovery;\n+\n+import static org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants.THING_TYPES_UIDS;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.config.discovery.AbstractDiscoveryService;\n+import org.openhab.core.config.discovery.DiscoveryResult;\n+import org.openhab.core.config.discovery.DiscoveryResultBuilder;\n+import org.openhab.core.config.discovery.DiscoveryService;\n+import org.openhab.core.thing.ThingUID;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Sets up the discovery results and details\n+ *\n+ * @author Matt Myers - Initial Contribution\n+ */\n+\n+@NonNullByDefault\n+public class HaywardDiscoveryService extends AbstractDiscoveryService implements DiscoveryService, ThingHandlerService {\n+\n+    private final Logger logger = LoggerFactory.getLogger(HaywardDiscoveryService.class);\n+    private @Nullable HaywardBridgeHandler handler;\n+\n+    public HaywardDiscoveryService() {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    /**\n+     * Constructs a zone discovery service.\n+     * Registers this zone discovery service programmatically.\n+     * Call {@link ZoneDiscoveryService#destroy()} to unregister the service after use.\n+     */\n+    public HaywardDiscoveryService(HaywardBridgeHandler bridge) throws IllegalArgumentException {\n+        super(THING_TYPES_UIDS, 0, false);\n+        // this.bridge = bridge;\n+    }\n+\n+    @Override\n+    public void activate() {\n+        super.activate(null);\n+    }\n+\n+    @Override\n+    public void deactivate() {\n+        super.deactivate();\n+    }\n+\n+    @Override\n+    protected void startScan() {\n+        try {\n+            String xmlResults = handler.getMspConfig();\n+            mspConfigDiscovery(xmlResults);\n+        } catch (Exception e) {\n+            logger.warn(\"Exception during discovery scan\", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a3e02205380a2b0ab8d6862592f8ad84944c448"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI1ODE0NA==", "bodyText": "You might want to include the exception's message in the details message.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r546258144", "createdAt": "2020-12-19T16:45:23Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/handler/HaywardBridgeHandler.java", "diffHunk": "@@ -0,0 +1,453 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.handler;\n+\n+import java.io.StringReader;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import javax.xml.xpath.XPath;\n+import javax.xml.xpath.XPathConstants;\n+import javax.xml.xpath.XPathExpressionException;\n+import javax.xml.xpath.XPathFactory;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.util.StringContentProvider;\n+import org.eclipse.jetty.http.HttpHeader;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.http.HttpVersion;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardAccount;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingHandler;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.config.HaywardConfig;\n+import org.openhab.binding.haywardomnilogic.internal.discovery.HaywardDiscoveryService;\n+import org.openhab.core.library.types.OnOffType;\n+import org.openhab.core.thing.Bridge;\n+import org.openhab.core.thing.ChannelUID;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.ThingStatus;\n+import org.openhab.core.thing.ThingStatusDetail;\n+import org.openhab.core.thing.binding.BaseBridgeHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.openhab.core.types.Command;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.w3c.dom.NodeList;\n+import org.xml.sax.InputSource;\n+\n+/**\n+ * The {@link HaywardBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+@NonNullByDefault\n+public class HaywardBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardBridgeHandler.class);\n+    private final HttpClient httpClient;\n+    private @Nullable ScheduledFuture<?> initializeFuture;\n+    private @Nullable ScheduledFuture<?> pollTelemetryFuture;\n+    private @Nullable ScheduledFuture<?> pollAlarmsFuture;\n+    private int commFailureCount;\n+    private @Nullable HaywardDiscoveryService haywardDiscoveryService;\n+\n+    public HaywardConfig config = getConfig().as(HaywardConfig.class);\n+    public HaywardAccount account = getConfig().as(HaywardAccount.class);\n+\n+    @Override\n+    public Collection<Class<? extends ThingHandlerService>> getServices() {\n+        return Collections.singleton(HaywardDiscoveryService.class);\n+    }\n+\n+    public HaywardBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    /**\n+     * Called by the zone discovery service to let this handler have a reference.\n+     */\n+    public void setHaywardDiscoveryService(HaywardDiscoveryService s) {\n+        this.haywardDiscoveryService = s;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        clearPolling(initializeFuture);\n+        clearPolling(pollTelemetryFuture);\n+        clearPolling(pollAlarmsFuture);\n+        logger.trace(\"Hayward polling cancelled\");\n+        super.dispose();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        updateStatus(ThingStatus.UNKNOWN);\n+        initializeFuture = scheduler.schedule(this::scheduledInitialize, 1, TimeUnit.SECONDS);\n+        return;\n+    }\n+\n+    public void scheduledInitialize() {\n+        config = getConfigAs(HaywardConfig.class);\n+\n+        try {\n+            clearPolling(pollTelemetryFuture);\n+            clearPolling(pollAlarmsFuture);\n+\n+            if (!(login())) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"Unable to Login to Hayward's server\");\n+                clearPolling(pollTelemetryFuture);\n+                clearPolling(pollAlarmsFuture);\n+                commFailureCount = 50;\n+                initPolling(60);\n+                return;\n+            }\n+\n+            if (!(getSiteList())) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"Unable to getMSP from Hayward's server\");\n+                clearPolling(pollTelemetryFuture);\n+                clearPolling(pollAlarmsFuture);\n+                commFailureCount = 50;\n+                initPolling(60);\n+                return;\n+            }\n+\n+            updateStatus(ThingStatus.ONLINE);\n+            logger.debug(\"Succesfully opened connection to Hayward's server: {} Username:{}\", config.endpointUrl,\n+                    config.username);\n+\n+            initPolling(0);\n+            logger.trace(\"Hayward Telemetry polling scheduled\");\n+\n+            if (config.alarmPollTime > 0) {\n+                initAlarmPolling(1);\n+                logger.trace(\"Hayward Alarm polling scheduled\");\n+            } else {\n+                logger.trace(\"Hayward Alarm polling disabled\");\n+            }\n+        } catch (Exception e) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.HANDLER_INITIALIZING_ERROR,\n+                    \"scheduledInitialize exception\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a3e02205380a2b0ab8d6862592f8ad84944c448"}, "originalPosition": 158}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI1ODE2Ng==", "bodyText": "The log message could be removed, as the status update is already logged by the framework.\nThe state change originated by updateStatus() is logged to events.log. Including the status detail message.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r546258166", "createdAt": "2020-12-19T16:45:32Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/handler/HaywardBridgeHandler.java", "diffHunk": "@@ -0,0 +1,453 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.handler;\n+\n+import java.io.StringReader;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import javax.xml.xpath.XPath;\n+import javax.xml.xpath.XPathConstants;\n+import javax.xml.xpath.XPathExpressionException;\n+import javax.xml.xpath.XPathFactory;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.util.StringContentProvider;\n+import org.eclipse.jetty.http.HttpHeader;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.http.HttpVersion;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardAccount;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingHandler;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.config.HaywardConfig;\n+import org.openhab.binding.haywardomnilogic.internal.discovery.HaywardDiscoveryService;\n+import org.openhab.core.library.types.OnOffType;\n+import org.openhab.core.thing.Bridge;\n+import org.openhab.core.thing.ChannelUID;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.ThingStatus;\n+import org.openhab.core.thing.ThingStatusDetail;\n+import org.openhab.core.thing.binding.BaseBridgeHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.openhab.core.types.Command;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.w3c.dom.NodeList;\n+import org.xml.sax.InputSource;\n+\n+/**\n+ * The {@link HaywardBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+@NonNullByDefault\n+public class HaywardBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardBridgeHandler.class);\n+    private final HttpClient httpClient;\n+    private @Nullable ScheduledFuture<?> initializeFuture;\n+    private @Nullable ScheduledFuture<?> pollTelemetryFuture;\n+    private @Nullable ScheduledFuture<?> pollAlarmsFuture;\n+    private int commFailureCount;\n+    private @Nullable HaywardDiscoveryService haywardDiscoveryService;\n+\n+    public HaywardConfig config = getConfig().as(HaywardConfig.class);\n+    public HaywardAccount account = getConfig().as(HaywardAccount.class);\n+\n+    @Override\n+    public Collection<Class<? extends ThingHandlerService>> getServices() {\n+        return Collections.singleton(HaywardDiscoveryService.class);\n+    }\n+\n+    public HaywardBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    /**\n+     * Called by the zone discovery service to let this handler have a reference.\n+     */\n+    public void setHaywardDiscoveryService(HaywardDiscoveryService s) {\n+        this.haywardDiscoveryService = s;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        clearPolling(initializeFuture);\n+        clearPolling(pollTelemetryFuture);\n+        clearPolling(pollAlarmsFuture);\n+        logger.trace(\"Hayward polling cancelled\");\n+        super.dispose();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        updateStatus(ThingStatus.UNKNOWN);\n+        initializeFuture = scheduler.schedule(this::scheduledInitialize, 1, TimeUnit.SECONDS);\n+        return;\n+    }\n+\n+    public void scheduledInitialize() {\n+        config = getConfigAs(HaywardConfig.class);\n+\n+        try {\n+            clearPolling(pollTelemetryFuture);\n+            clearPolling(pollAlarmsFuture);\n+\n+            if (!(login())) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"Unable to Login to Hayward's server\");\n+                clearPolling(pollTelemetryFuture);\n+                clearPolling(pollAlarmsFuture);\n+                commFailureCount = 50;\n+                initPolling(60);\n+                return;\n+            }\n+\n+            if (!(getSiteList())) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"Unable to getMSP from Hayward's server\");\n+                clearPolling(pollTelemetryFuture);\n+                clearPolling(pollAlarmsFuture);\n+                commFailureCount = 50;\n+                initPolling(60);\n+                return;\n+            }\n+\n+            updateStatus(ThingStatus.ONLINE);\n+            logger.debug(\"Succesfully opened connection to Hayward's server: {} Username:{}\", config.endpointUrl,\n+                    config.username);\n+\n+            initPolling(0);\n+            logger.trace(\"Hayward Telemetry polling scheduled\");\n+\n+            if (config.alarmPollTime > 0) {\n+                initAlarmPolling(1);\n+                logger.trace(\"Hayward Alarm polling scheduled\");\n+            } else {\n+                logger.trace(\"Hayward Alarm polling disabled\");\n+            }\n+        } catch (Exception e) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.HANDLER_INITIALIZING_ERROR,\n+                    \"scheduledInitialize exception\");\n+            logger.debug(\"Hayward Connection thing: Unable to open connection to Hayward Server: {} Username: {}\",\n+                    config.endpointUrl, config.username, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a3e02205380a2b0ab8d6862592f8ad84944c448"}, "originalPosition": 160}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI1ODM5NQ==", "bodyText": "getBridge() returns null if the user configured the Thing via textual configuration and forgot to specify the bridge. You could set the Thing OFFLINE with an appropriate error message in this case. Please check all.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r546258395", "createdAt": "2020-12-19T16:47:36Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/handler/HaywardChlorinatorHandler.java", "diffHunk": "@@ -0,0 +1,172 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.handler;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingHandler;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingProperties;\n+import org.openhab.core.thing.ChannelUID;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.types.Command;\n+import org.openhab.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The Chlorinator Handler\n+ *\n+ * @author Matt Myers - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class HaywardChlorinatorHandler extends HaywardThingHandler {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardChlorinatorHandler.class);\n+    public String chlorTimedPercent = \"\";\n+    public String chlorState = \"\";\n+\n+    HaywardThingProperties prop = getConfig().as(HaywardThingProperties.class);\n+\n+    public HaywardChlorinatorHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    @Override\n+    public void getTelemetry(String xmlResponse) throws Exception {\n+        List<String> systemIDs = new ArrayList<>();\n+        List<String> data = new ArrayList<>();\n+\n+        @SuppressWarnings(\"null\")\n+        HaywardBridgeHandler bridgehandler = (HaywardBridgeHandler) getBridge().getHandler();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a3e02205380a2b0ab8d6862592f8ad84944c448"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI1ODY1MQ==", "bodyText": "The author tag is deprecated and should therefore be removed. See openhab/openhab-core#1844.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r546258651", "createdAt": "2020-12-19T16:49:50Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/resources/OH-INF/binding/binding.xml", "diffHunk": "@@ -0,0 +1,9 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<binding:binding id=\"haywardomnilogic\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:binding=\"https://openhab.org/schemas/binding/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/binding/v1.0.0 https://openhab.org/schemas/binding-1.0.0.xsd\">\n+\n+\t<name>Hayward OmniLogix Binding</name>\n+\t<description>Binding for the Hayward OmniLogix swimming pool automation controller.</description>\n+\t<author>Matt Myers</author>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a3e02205380a2b0ab8d6862592f8ad84944c448"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI1ODcwNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t<parameter name=\"alarmPollTime\" type=\"integer\" min=\"0\" max=\"120\" required=\"true\">\n          \n          \n            \n            \t\t\t<parameter name=\"alarmPollTime\" type=\"integer\" min=\"0\" max=\"120\" unit=\"s\" required=\"true\">", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r546258704", "createdAt": "2020-12-19T16:50:47Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/resources/OH-INF/thing/bridge.xml", "diffHunk": "@@ -0,0 +1,40 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"haywardomnilogic\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<!-- The bridge to communicate with Hayward's server -->\n+\t<bridge-type id=\"bridge\">\n+\t\t<label>Hayward OmniLogix Connection</label>\n+\t\t<description>Connection to Hayward's Server</description>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"endpointUrl\" type=\"text\" required=\"true\">\n+\t\t\t\t<context>url</context>\n+\t\t\t\t<label>Endpoint URL</label>\n+\t\t\t\t<default>https://app1.haywardomnilogic.com/HAAPI/HomeAutomation/API.ashx</default>\n+\t\t\t\t<description>The URL of the Hayward API Server</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"username\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>User Name</label>\n+\t\t\t\t<description>The username to connect to the server.</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"password\" type=\"text\" required=\"true\">\n+\t\t\t\t<context>password</context>\n+\t\t\t\t<label>Password</label>\n+\t\t\t\t<description>The password to connect to the server.</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"telemetryPollTime\" type=\"integer\" min=\"10\" max=\"60\" unit=\"s\" required=\"true\">\n+\t\t\t\t<label>Telemetry Poll Delay</label>\n+\t\t\t\t<default>12</default>\n+\t\t\t\t<description>How often to request telemetry data from Hayward Server</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"alarmPollTime\" type=\"integer\" min=\"0\" max=\"120\" required=\"true\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a3e02205380a2b0ab8d6862592f8ad84944c448"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI1ODkwNA==", "bodyText": "This will render into two rows.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r546258904", "createdAt": "2020-12-19T16:53:22Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.haywardomnilogic/README.md", "diffHunk": "@@ -0,0 +1,256 @@\n+# Hayward Omnilogic Binding\n+\n+The Hayward Omnilogic binding integrates the Omnilogic pool controller using the Hayward API.\n+\n+The Hayward Omnilogic API interacts with Hayward's cloud server requiring a connection with the Internet for sending and receiving information.\n+\n+## Supported Things\n+\n+The table below lists the Hayward OmniLogic binding thing types:\n+\n+| Things                                  | Description                                                                     | Thing Type     |\n+|-----------------------------------------|---------------------------------------------------------------------------------|----------------|\n+| Hayward OmniLogix Connection            | Connection to Hayward's Server                                                  | bridge         |\n+| Backyard                                | Backyard                                                                        | backyard       |\n+| Body of Water                           | Body of Water                                                                   | bow            |\n+| Chlorinator                             | Chlorinator\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t| chlorinator    |\n+| Colorlogic Light                        | Colorlogic Light                                                                | colorlogic     |\n+| Chlorine Sense and Dispense             | CSAD/ORP Control (under development)                                            | csad           |\n+| Filter                                  | Filter control                                                                  | filter         |\n+| Heater Equipment                        | Actual heater (i.e. gas, solar, electric)                                       | heater         |\n+| Pump                                    | Auxillary pump control (i.e. spillover)                                         | pump           |\n+| Relay                                   | Accessory relay control (deck jet sprinklers, lights, etc.)                     | relay          |\n+| Virtaul Heater                          | A Virtual Heater that can control all of the heater equipment based on priority | virtualHeater  |\n+\n+## Discovery\n+\n+The binding will automatically discover the Omnilogic pool things from the cloud server using your Hayward Omnilogic credentials.\n+\n+## Thing Configuration\n+\n+Hayward OmniLogic Connection Parameters:\n+\n+| Property\t\t\t    | Default\t\t\t\t\t\t\t\t\t\t\t\t      | Required | Description \t\t\t\t\t\t\t\t |\n+|-----------------------|-------------------------------------------------------------|----------|-------------------------------------------|\n+| Host Name      \t\t| https://app1.haywardomnilogic.com/HAAPI/\t                  | Yes\t\t | Host name of the Hayward API server \t\t |\n+|                       | HomeAutomation/API.ashx                                     |          |                                           |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a3e02205380a2b0ab8d6862592f8ad84944c448"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4ODU1MDA5", "url": "https://github.com/openhab/openhab-addons/pull/8685#pullrequestreview-558855009", "createdAt": "2020-12-26T09:28:32Z", "commit": {"oid": "a53ef86837158a08255f309b17e9ccde9c587f69"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNlQwOToyODozM1rOILiFiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNlQwOToyODozM1rOILiFiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODk2MzcyMA==", "bodyText": "To make the binding compile, you need to rebase your branch and set the version to the upcoming openHAB version: 3.1.0-SNAPSHOT.\nHere are the commands for rebasing your branch:\nIf not already done, add the upstream openHAB addon repo as a remote to your local repo and fetch it:\ngit remote add upstream https://github.com/openhab/openhab-addons.git\ngit fetch upstream\n\nThen, you can rebase your PR's branch onto main:\ngit rebase upstream/main\n\nFinally force-push the rebased branch to this PR's branch:\ngit push origin [your branch name of this PR] --force-with-lease", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r548963720", "createdAt": "2020-12-26T09:28:33Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.haywardomnilogic/pom.xml", "diffHunk": "@@ -0,0 +1,17 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+  xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\">\n+\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <parent>\n+    <groupId>org.openhab.addons.bundles</groupId>\n+    <artifactId>org.openhab.addons.reactor.bundles</artifactId>\n+    <version>3.0.0-SNAPSHOT</version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a53ef86837158a08255f309b17e9ccde9c587f69"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5NzE3MDM0", "url": "https://github.com/openhab/openhab-addons/pull/8685#pullrequestreview-559717034", "createdAt": "2020-12-29T21:59:59Z", "commit": {"oid": "c49b10f7fe3c218245d11ec9b290562da810a7e2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQyMTo1OTo1OVrOIMZCFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQyMjo0NDoyMlrOIMZ2bA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTg2Mzk1Nw==", "bodyText": "Please put all fields at the top of the class.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r549863957", "createdAt": "2020-12-29T21:59:59Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/HaywardHandlerFactory.java", "diffHunk": "@@ -0,0 +1,109 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal;\n+\n+import static org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants.*;\n+\n+import java.util.Collections;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBackyardHandler;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBowHandler;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardChlorinatorHandler;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardColorLogicHandler;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardFilterHandler;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardHeaterHandler;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardRelayHandler;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardSensorHandler;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardVirtualHeaterHandler;\n+import org.openhab.core.io.net.http.HttpClientFactory;\n+import org.openhab.core.thing.Bridge;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.ThingTypeUID;\n+import org.openhab.core.thing.binding.BaseThingHandlerFactory;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerFactory;\n+import org.osgi.service.component.annotations.Activate;\n+import org.osgi.service.component.annotations.Component;\n+import org.osgi.service.component.annotations.Reference;\n+\n+/**\n+ * The {@link HaywardHandlerFactory} is responsible for creating things and thing\n+ * handlers.\n+ */\n+\n+@Component(service = ThingHandlerFactory.class, configurationPid = \"binding.haywardomnilogic\")\n+@NonNullByDefault\n+public class HaywardHandlerFactory extends BaseThingHandlerFactory {\n+\n+    private static final Set<ThingTypeUID> SUPPORTED_THING_TYPES_UIDS = Collections.unmodifiableSet(\n+            Stream.concat(BRIDGE_THING_TYPES_UIDS.stream(), THING_TYPES_UIDS.stream()).collect(Collectors.toSet()));\n+\n+    @Override\n+    public boolean supportsThingType(ThingTypeUID thingTypeUID) {\n+        return SUPPORTED_THING_TYPES_UIDS.contains(thingTypeUID);\n+    }\n+\n+    private final HttpClient httpClient;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c49b10f7fe3c218245d11ec9b290562da810a7e2"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTg3MzY5Mg==", "bodyText": "You could make this method abstract to avoid confusion why there's an empty method. By declaring it abstract everybody knows that it's supposed to be overriden.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r549873692", "createdAt": "2020-12-29T22:26:17Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/HaywardThingHandler.java", "diffHunk": "@@ -0,0 +1,112 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+\n+package org.openhab.binding.haywardomnilogic.internal;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.library.types.DecimalType;\n+import org.openhab.core.library.types.OnOffType;\n+import org.openhab.core.library.types.QuantityType;\n+import org.openhab.core.library.types.StringType;\n+import org.openhab.core.library.unit.ImperialUnits;\n+import org.openhab.core.library.unit.SIUnits;\n+import org.openhab.core.library.unit.Units;\n+import org.openhab.core.thing.Channel;\n+import org.openhab.core.thing.ChannelUID;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.ThingStatus;\n+import org.openhab.core.thing.binding.BaseThingHandler;\n+import org.openhab.core.types.Command;\n+import org.openhab.core.types.State;\n+\n+/**\n+ * The {@link HaywarThingHandler} is a subclass of the BaseThingHandler and a Super\n+ * Class to each Hayward Thing Handler\n+ */\n+\n+@NonNullByDefault\n+public class HaywardThingHandler extends BaseThingHandler {\n+\n+    public HaywardThingHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        updateStatus(ThingStatus.ONLINE);\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+    }\n+\n+    public void getTelemetry(String xmlResponse) throws HaywardException {\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c49b10f7fe3c218245d11ec9b290562da810a7e2"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTg3Mzk1MQ==", "bodyText": "You could store a local reference (variable) to getBridge() and do a null check on that to get rid of the compiler warning.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r549873951", "createdAt": "2020-12-29T22:27:26Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/HaywardThingHandler.java", "diffHunk": "@@ -0,0 +1,112 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+\n+package org.openhab.binding.haywardomnilogic.internal;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.library.types.DecimalType;\n+import org.openhab.core.library.types.OnOffType;\n+import org.openhab.core.library.types.QuantityType;\n+import org.openhab.core.library.types.StringType;\n+import org.openhab.core.library.unit.ImperialUnits;\n+import org.openhab.core.library.unit.SIUnits;\n+import org.openhab.core.library.unit.Units;\n+import org.openhab.core.thing.Channel;\n+import org.openhab.core.thing.ChannelUID;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.ThingStatus;\n+import org.openhab.core.thing.binding.BaseThingHandler;\n+import org.openhab.core.types.Command;\n+import org.openhab.core.types.State;\n+\n+/**\n+ * The {@link HaywarThingHandler} is a subclass of the BaseThingHandler and a Super\n+ * Class to each Hayward Thing Handler\n+ */\n+\n+@NonNullByDefault\n+public class HaywardThingHandler extends BaseThingHandler {\n+\n+    public HaywardThingHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        updateStatus(ThingStatus.ONLINE);\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+    }\n+\n+    public void getTelemetry(String xmlResponse) throws HaywardException {\n+    }\n+\n+    public State toState(String type, String channelID, String value) throws NumberFormatException {\n+        HaywardBridgeHandler bridgehandler = (HaywardBridgeHandler) getBridge().getHandler();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c49b10f7fe3c218245d11ec9b290562da810a7e2"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTg3NDEyMQ==", "bodyText": "You could do a null check on bridgehandler to get rid of the compiler warning.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r549874121", "createdAt": "2020-12-29T22:28:12Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/HaywardThingHandler.java", "diffHunk": "@@ -0,0 +1,112 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+\n+package org.openhab.binding.haywardomnilogic.internal;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.library.types.DecimalType;\n+import org.openhab.core.library.types.OnOffType;\n+import org.openhab.core.library.types.QuantityType;\n+import org.openhab.core.library.types.StringType;\n+import org.openhab.core.library.unit.ImperialUnits;\n+import org.openhab.core.library.unit.SIUnits;\n+import org.openhab.core.library.unit.Units;\n+import org.openhab.core.thing.Channel;\n+import org.openhab.core.thing.ChannelUID;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.ThingStatus;\n+import org.openhab.core.thing.binding.BaseThingHandler;\n+import org.openhab.core.types.Command;\n+import org.openhab.core.types.State;\n+\n+/**\n+ * The {@link HaywarThingHandler} is a subclass of the BaseThingHandler and a Super\n+ * Class to each Hayward Thing Handler\n+ */\n+\n+@NonNullByDefault\n+public class HaywardThingHandler extends BaseThingHandler {\n+\n+    public HaywardThingHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        updateStatus(ThingStatus.ONLINE);\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+    }\n+\n+    public void getTelemetry(String xmlResponse) throws HaywardException {\n+    }\n+\n+    public State toState(String type, String channelID, String value) throws NumberFormatException {\n+        HaywardBridgeHandler bridgehandler = (HaywardBridgeHandler) getBridge().getHandler();\n+\n+        switch (type) {\n+            case \"Number\":\n+                return new DecimalType(value);\n+            case \"Switch\":\n+                return Integer.parseInt(value) > 0 ? OnOffType.ON : OnOffType.OFF;\n+            case \"system.power\":\n+                return Integer.parseInt(value) > 0 ? OnOffType.ON : OnOffType.OFF;\n+            case \"Number:Dimensionless\":\n+                switch (channelID) {\n+                    case \"chlorTimedPercent\":\n+                    case \"filterSpeed\":\n+                    case \"pumpSpeed\":\n+                        return new QuantityType<>(Integer.parseInt(value), Units.PERCENT);\n+                    case \"chlorAvgSaltLevel\":\n+                    case \"chlorInstantSaltLevel\":\n+                        return new QuantityType<>(Integer.parseInt(value), Units.PARTS_PER_MILLION);\n+                }\n+            case \"Number:Temperature\":\n+                if (bridgehandler.account.units.equals(\"Standard\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c49b10f7fe3c218245d11ec9b290562da810a7e2"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTg3NDQwMA==", "bodyText": "You could store bridgeHandler to a local variable and do the null check on that. Then, you can remove the null suppression on the class. Same for below.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r549874400", "createdAt": "2020-12-29T22:29:30Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/discovery/HaywardDiscoveryService.java", "diffHunk": "@@ -0,0 +1,418 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.discovery;\n+\n+import static org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants.THING_TYPES_UIDS;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.config.discovery.AbstractDiscoveryService;\n+import org.openhab.core.config.discovery.DiscoveryResult;\n+import org.openhab.core.config.discovery.DiscoveryResultBuilder;\n+import org.openhab.core.config.discovery.DiscoveryService;\n+import org.openhab.core.thing.ThingUID;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Sets up the discovery results and details\n+ */\n+\n+@NonNullByDefault\n+@SuppressWarnings(\"null\")\n+public class HaywardDiscoveryService extends AbstractDiscoveryService implements DiscoveryService, ThingHandlerService {\n+\n+    private final Logger logger = LoggerFactory.getLogger(HaywardDiscoveryService.class);\n+    private @Nullable HaywardBridgeHandler bridgehandler;\n+\n+    public HaywardDiscoveryService() {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    /**\n+     * Constructs a zone discovery service.\n+     * Registers this zone discovery service programmatically.\n+     * Call {@link ZoneDiscoveryService#destroy()} to unregister the service after use.\n+     */\n+    public HaywardDiscoveryService(HaywardBridgeHandler bridge) throws IllegalArgumentException {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    @Override\n+    public void activate() {\n+        super.activate(null);\n+    }\n+\n+    @Override\n+    public void deactivate() {\n+        super.deactivate();\n+    }\n+\n+    @Override\n+    protected void startScan() {\n+        try {\n+            if (bridgehandler != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c49b10f7fe3c218245d11ec9b290562da810a7e2"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTg3NDYwOA==", "bodyText": "Can these messages be replaced by using the debugger or by increasing the framework's log level? See point 4 https://www.openhab.org/docs/developer/guidelines.html#f-logging", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r549874608", "createdAt": "2020-12-29T22:30:31Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/handler/HaywardBridgeHandler.java", "diffHunk": "@@ -0,0 +1,458 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.handler;\n+\n+import java.io.StringReader;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import javax.xml.xpath.XPath;\n+import javax.xml.xpath.XPathConstants;\n+import javax.xml.xpath.XPathExpressionException;\n+import javax.xml.xpath.XPathFactory;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.util.StringContentProvider;\n+import org.eclipse.jetty.http.HttpHeader;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.http.HttpVersion;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardAccount;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingHandler;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.config.HaywardConfig;\n+import org.openhab.binding.haywardomnilogic.internal.discovery.HaywardDiscoveryService;\n+import org.openhab.core.library.types.OnOffType;\n+import org.openhab.core.thing.Bridge;\n+import org.openhab.core.thing.ChannelUID;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.ThingStatus;\n+import org.openhab.core.thing.ThingStatusDetail;\n+import org.openhab.core.thing.binding.BaseBridgeHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.openhab.core.types.Command;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.w3c.dom.NodeList;\n+import org.xml.sax.InputSource;\n+\n+/**\n+ * The {@link HaywardBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ */\n+\n+@NonNullByDefault\n+public class HaywardBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardBridgeHandler.class);\n+    private final HttpClient httpClient;\n+    private @Nullable ScheduledFuture<?> initializeFuture;\n+    private @Nullable ScheduledFuture<?> pollTelemetryFuture;\n+    private @Nullable ScheduledFuture<?> pollAlarmsFuture;\n+    private int commFailureCount;\n+    private @Nullable HaywardDiscoveryService haywardDiscoveryService;\n+\n+    public HaywardConfig config = getConfig().as(HaywardConfig.class);\n+    public HaywardAccount account = getConfig().as(HaywardAccount.class);\n+\n+    @Override\n+    public Collection<Class<? extends ThingHandlerService>> getServices() {\n+        return Collections.singleton(HaywardDiscoveryService.class);\n+    }\n+\n+    public HaywardBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    /**\n+     * Called by the zone discovery service to let this handler have a reference.\n+     */\n+    public void setHaywardDiscoveryService(HaywardDiscoveryService s) {\n+        this.haywardDiscoveryService = s;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        clearPolling(initializeFuture);\n+        clearPolling(pollTelemetryFuture);\n+        clearPolling(pollAlarmsFuture);\n+        logger.trace(\"Hayward polling cancelled\");\n+        super.dispose();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        updateStatus(ThingStatus.UNKNOWN);\n+        initializeFuture = scheduler.schedule(this::scheduledInitialize, 1, TimeUnit.SECONDS);\n+        return;\n+    }\n+\n+    public void scheduledInitialize() {\n+        config = getConfigAs(HaywardConfig.class);\n+\n+        try {\n+            clearPolling(pollTelemetryFuture);\n+            clearPolling(pollAlarmsFuture);\n+\n+            if (!(login())) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"Unable to Login to Hayward's server\");\n+                clearPolling(pollTelemetryFuture);\n+                clearPolling(pollAlarmsFuture);\n+                commFailureCount = 50;\n+                initPolling(60);\n+                return;\n+            }\n+\n+            if (!(getSiteList())) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"Unable to getMSP from Hayward's server\");\n+                clearPolling(pollTelemetryFuture);\n+                clearPolling(pollAlarmsFuture);\n+                commFailureCount = 50;\n+                initPolling(60);\n+                return;\n+            }\n+\n+            updateStatus(ThingStatus.ONLINE);\n+            logger.debug(\"Succesfully opened connection to Hayward's server: {} Username:{}\", config.endpointUrl,\n+                    config.username);\n+\n+            initPolling(0);\n+            logger.trace(\"Hayward Telemetry polling scheduled\");\n+\n+            if (config.alarmPollTime > 0) {\n+                initAlarmPolling(1);\n+                logger.trace(\"Hayward Alarm polling scheduled\");\n+            } else {\n+                logger.trace(\"Hayward Alarm polling disabled\");\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c49b10f7fe3c218245d11ec9b290562da810a7e2"}, "originalPosition": 155}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTg3NDkzMQ==", "bodyText": "If you make login() and getSiteList() throw HaywardException instead of Exception, you could catch HaywardException here. Catching only Exception would catch also all RuntimeExceptions.\nPlease check all.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r549874931", "createdAt": "2020-12-29T22:32:14Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/handler/HaywardBridgeHandler.java", "diffHunk": "@@ -0,0 +1,458 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.handler;\n+\n+import java.io.StringReader;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import javax.xml.xpath.XPath;\n+import javax.xml.xpath.XPathConstants;\n+import javax.xml.xpath.XPathExpressionException;\n+import javax.xml.xpath.XPathFactory;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.util.StringContentProvider;\n+import org.eclipse.jetty.http.HttpHeader;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.http.HttpVersion;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardAccount;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingHandler;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.config.HaywardConfig;\n+import org.openhab.binding.haywardomnilogic.internal.discovery.HaywardDiscoveryService;\n+import org.openhab.core.library.types.OnOffType;\n+import org.openhab.core.thing.Bridge;\n+import org.openhab.core.thing.ChannelUID;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.ThingStatus;\n+import org.openhab.core.thing.ThingStatusDetail;\n+import org.openhab.core.thing.binding.BaseBridgeHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.openhab.core.types.Command;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.w3c.dom.NodeList;\n+import org.xml.sax.InputSource;\n+\n+/**\n+ * The {@link HaywardBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ */\n+\n+@NonNullByDefault\n+public class HaywardBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardBridgeHandler.class);\n+    private final HttpClient httpClient;\n+    private @Nullable ScheduledFuture<?> initializeFuture;\n+    private @Nullable ScheduledFuture<?> pollTelemetryFuture;\n+    private @Nullable ScheduledFuture<?> pollAlarmsFuture;\n+    private int commFailureCount;\n+    private @Nullable HaywardDiscoveryService haywardDiscoveryService;\n+\n+    public HaywardConfig config = getConfig().as(HaywardConfig.class);\n+    public HaywardAccount account = getConfig().as(HaywardAccount.class);\n+\n+    @Override\n+    public Collection<Class<? extends ThingHandlerService>> getServices() {\n+        return Collections.singleton(HaywardDiscoveryService.class);\n+    }\n+\n+    public HaywardBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    /**\n+     * Called by the zone discovery service to let this handler have a reference.\n+     */\n+    public void setHaywardDiscoveryService(HaywardDiscoveryService s) {\n+        this.haywardDiscoveryService = s;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        clearPolling(initializeFuture);\n+        clearPolling(pollTelemetryFuture);\n+        clearPolling(pollAlarmsFuture);\n+        logger.trace(\"Hayward polling cancelled\");\n+        super.dispose();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        updateStatus(ThingStatus.UNKNOWN);\n+        initializeFuture = scheduler.schedule(this::scheduledInitialize, 1, TimeUnit.SECONDS);\n+        return;\n+    }\n+\n+    public void scheduledInitialize() {\n+        config = getConfigAs(HaywardConfig.class);\n+\n+        try {\n+            clearPolling(pollTelemetryFuture);\n+            clearPolling(pollAlarmsFuture);\n+\n+            if (!(login())) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"Unable to Login to Hayward's server\");\n+                clearPolling(pollTelemetryFuture);\n+                clearPolling(pollAlarmsFuture);\n+                commFailureCount = 50;\n+                initPolling(60);\n+                return;\n+            }\n+\n+            if (!(getSiteList())) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"Unable to getMSP from Hayward's server\");\n+                clearPolling(pollTelemetryFuture);\n+                clearPolling(pollAlarmsFuture);\n+                commFailureCount = 50;\n+                initPolling(60);\n+                return;\n+            }\n+\n+            updateStatus(ThingStatus.ONLINE);\n+            logger.debug(\"Succesfully opened connection to Hayward's server: {} Username:{}\", config.endpointUrl,\n+                    config.username);\n+\n+            initPolling(0);\n+            logger.trace(\"Hayward Telemetry polling scheduled\");\n+\n+            if (config.alarmPollTime > 0) {\n+                initAlarmPolling(1);\n+                logger.trace(\"Hayward Alarm polling scheduled\");\n+            } else {\n+                logger.trace(\"Hayward Alarm polling disabled\");\n+            }\n+        } catch (Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c49b10f7fe3c218245d11ec9b290562da810a7e2"}, "originalPosition": 156}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTg3NTU0OQ==", "bodyText": "If you swap these, you avoid any null error.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if (properties.get(HaywardBindingConstants.PROPERTY_TYPE).equals(\"BACKYARD\")) {\n          \n          \n            \n                        if (\"BACKYARD\".equals(properties.get(HaywardBindingConstants.PROPERTY_TYPE))) {", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r549875549", "createdAt": "2020-12-29T22:35:14Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/handler/HaywardBridgeHandler.java", "diffHunk": "@@ -0,0 +1,458 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.handler;\n+\n+import java.io.StringReader;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import javax.xml.xpath.XPath;\n+import javax.xml.xpath.XPathConstants;\n+import javax.xml.xpath.XPathExpressionException;\n+import javax.xml.xpath.XPathFactory;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.util.StringContentProvider;\n+import org.eclipse.jetty.http.HttpHeader;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.http.HttpVersion;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardAccount;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingHandler;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.config.HaywardConfig;\n+import org.openhab.binding.haywardomnilogic.internal.discovery.HaywardDiscoveryService;\n+import org.openhab.core.library.types.OnOffType;\n+import org.openhab.core.thing.Bridge;\n+import org.openhab.core.thing.ChannelUID;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.ThingStatus;\n+import org.openhab.core.thing.ThingStatusDetail;\n+import org.openhab.core.thing.binding.BaseBridgeHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.openhab.core.types.Command;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.w3c.dom.NodeList;\n+import org.xml.sax.InputSource;\n+\n+/**\n+ * The {@link HaywardBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ */\n+\n+@NonNullByDefault\n+public class HaywardBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardBridgeHandler.class);\n+    private final HttpClient httpClient;\n+    private @Nullable ScheduledFuture<?> initializeFuture;\n+    private @Nullable ScheduledFuture<?> pollTelemetryFuture;\n+    private @Nullable ScheduledFuture<?> pollAlarmsFuture;\n+    private int commFailureCount;\n+    private @Nullable HaywardDiscoveryService haywardDiscoveryService;\n+\n+    public HaywardConfig config = getConfig().as(HaywardConfig.class);\n+    public HaywardAccount account = getConfig().as(HaywardAccount.class);\n+\n+    @Override\n+    public Collection<Class<? extends ThingHandlerService>> getServices() {\n+        return Collections.singleton(HaywardDiscoveryService.class);\n+    }\n+\n+    public HaywardBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    /**\n+     * Called by the zone discovery service to let this handler have a reference.\n+     */\n+    public void setHaywardDiscoveryService(HaywardDiscoveryService s) {\n+        this.haywardDiscoveryService = s;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        clearPolling(initializeFuture);\n+        clearPolling(pollTelemetryFuture);\n+        clearPolling(pollAlarmsFuture);\n+        logger.trace(\"Hayward polling cancelled\");\n+        super.dispose();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        updateStatus(ThingStatus.UNKNOWN);\n+        initializeFuture = scheduler.schedule(this::scheduledInitialize, 1, TimeUnit.SECONDS);\n+        return;\n+    }\n+\n+    public void scheduledInitialize() {\n+        config = getConfigAs(HaywardConfig.class);\n+\n+        try {\n+            clearPolling(pollTelemetryFuture);\n+            clearPolling(pollAlarmsFuture);\n+\n+            if (!(login())) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"Unable to Login to Hayward's server\");\n+                clearPolling(pollTelemetryFuture);\n+                clearPolling(pollAlarmsFuture);\n+                commFailureCount = 50;\n+                initPolling(60);\n+                return;\n+            }\n+\n+            if (!(getSiteList())) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"Unable to getMSP from Hayward's server\");\n+                clearPolling(pollTelemetryFuture);\n+                clearPolling(pollAlarmsFuture);\n+                commFailureCount = 50;\n+                initPolling(60);\n+                return;\n+            }\n+\n+            updateStatus(ThingStatus.ONLINE);\n+            logger.debug(\"Succesfully opened connection to Hayward's server: {} Username:{}\", config.endpointUrl,\n+                    config.username);\n+\n+            initPolling(0);\n+            logger.trace(\"Hayward Telemetry polling scheduled\");\n+\n+            if (config.alarmPollTime > 0) {\n+                initAlarmPolling(1);\n+                logger.trace(\"Hayward Alarm polling scheduled\");\n+            } else {\n+                logger.trace(\"Hayward Alarm polling disabled\");\n+            }\n+        } catch (Exception e) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.HANDLER_INITIALIZING_ERROR,\n+                    \"scheduledInitialize exception: \" + e.getMessage());\n+            clearPolling(pollTelemetryFuture);\n+            clearPolling(pollAlarmsFuture);\n+            commFailureCount = 50;\n+            initPolling(60);\n+            return;\n+        }\n+    }\n+\n+    public synchronized boolean login() throws Exception {\n+        String xmlResponse;\n+        String status;\n+\n+        // *****Login to Hayward server\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request>\" + \"<Name>Login</Name><Parameters>\"\n+                + \"<Parameter name=\\\"UserName\\\" dataType=\\\"String\\\">\" + config.username + \"</Parameter>\"\n+                + \"<Parameter name=\\\"Password\\\" dataType=\\\"String\\\">\" + config.password + \"</Parameter>\"\n+                + \"</Parameters></Request>\";\n+\n+        xmlResponse = httpXmlResponse(urlParameters);\n+\n+        if (xmlResponse.isEmpty()) {\n+            return false;\n+        }\n+\n+        status = evaluateXPath(\"/Response/Parameters//Parameter[@name='Status']/text()\", xmlResponse).get(0);\n+\n+        if (!(status.equals(\"0\"))) {\n+            logger.debug(\"Hayward Connection thing: Login XML response: {}\", xmlResponse);\n+            return false;\n+        }\n+\n+        account.token = evaluateXPath(\"/Response/Parameters//Parameter[@name='Token']/text()\", xmlResponse).get(0);\n+        account.userID = evaluateXPath(\"/Response/Parameters//Parameter[@name='UserID']/text()\", xmlResponse).get(0);\n+        return true;\n+    }\n+\n+    public synchronized boolean getApiDef() throws Exception {\n+        String xmlResponse;\n+\n+        // *****getConfig from Hayward server\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request><Name>GetAPIDef</Name><Parameters>\"\n+                + \"<Parameter name=\\\"Token\\\" dataType=\\\"String\\\">\" + account.token + \"</Parameter>\"\n+                + \"<Parameter name=\\\"MspSystemID\\\" dataType=\\\"int\\\">\" + account.mspSystemID + \"</Parameter>;\"\n+                + \"<Parameter name=\\\"Version\\\" dataType=\\\"string\\\">0.4</Parameter >\\r\\n\"\n+                + \"<Parameter name=\\\"Language\\\" dataType=\\\"string\\\">en</Parameter >\\r\\n\" + \"</Parameters></Request>\";\n+\n+        xmlResponse = httpXmlResponse(urlParameters);\n+\n+        if (xmlResponse.isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: Login XML response was null\");\n+            return false;\n+        }\n+        return true;\n+    }\n+\n+    public synchronized boolean getSiteList() throws Exception {\n+        String xmlResponse;\n+        String status;\n+\n+        // *****Get MSP\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request><Name>GetSiteList</Name><Parameters>\"\n+                + \"<Parameter name=\\\"Token\\\" dataType=\\\"String\\\">\" + account.token\n+                + \"</Parameter><Parameter name=\\\"UserID\\\" dataType=\\\"String\\\">\" + account.userID\n+                + \"</Parameter></Parameters></Request>\";\n+\n+        xmlResponse = httpXmlResponse(urlParameters);\n+\n+        if (xmlResponse.isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: getSiteList XML response was null\");\n+            return false;\n+        }\n+\n+        status = evaluateXPath(\"/Response/Parameters//Parameter[@name='Status']/text()\", xmlResponse).get(0);\n+\n+        if (!(status.equals(\"0\"))) {\n+            logger.debug(\"Hayward Connection thing: getSiteList XML response: {}\", xmlResponse);\n+            return false;\n+        }\n+\n+        account.mspSystemID = evaluateXPath(\"/Response/Parameters/Parameter/Item//Property[@name='MspSystemID']/text()\",\n+                xmlResponse).get(0);\n+        account.backyardName = evaluateXPath(\n+                \"/Response/Parameters/Parameter/Item//Property[@name='BackyardName']/text()\", xmlResponse).get(0);\n+        account.address = evaluateXPath(\"/Response/Parameters/Parameter/Item//Property[@name='Address']/text()\",\n+                xmlResponse).get(0);\n+        return true;\n+    }\n+\n+    public synchronized String getMspConfig() throws HaywardException {\n+        // *****getMspConfig from Hayward server\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request><Name>GetMspConfigFile</Name><Parameters>\"\n+                + \"<Parameter name=\\\"Token\\\" dataType=\\\"String\\\">\" + account.token + \"</Parameter>\"\n+                + \"<Parameter name=\\\"MspSystemID\\\" dataType=\\\"int\\\">\" + account.mspSystemID\n+                + \"</Parameter><Parameter name=\\\"Version\\\" dataType=\\\"string\\\">0</Parameter>\\r\\n\"\n+                + \"</Parameters></Request>\";\n+\n+        String xmlResponse = httpXmlResponse(urlParameters);\n+\n+        // Debug: Inject xml file for testing\n+        // String path =\n+        // \"C:/Users/Controls/openhab-2-5-x/git/openhab-addons/bundles/org.openhab.binding.haywardomnilogic/getConfig.xml\";\n+        // xmlResponse = new String(Files.readAllBytes(Paths.get(path)));\n+\n+        if (xmlResponse.isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: requestConfig XML response was null\");\n+            return \"Fail\";\n+        }\n+\n+        if (evaluateXPath(\"//Backyard/Name/text()\", xmlResponse).isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: requestConfiguration XML response: {}\", xmlResponse);\n+            return \"Fail\";\n+        }\n+        return xmlResponse;\n+    }\n+\n+    public synchronized boolean getTelemetryData() throws HaywardException {\n+        // *****getTelemetry from Hayward server\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request><Name>GetTelemetryData</Name><Parameters>\"\n+                + \"<Parameter name=\\\"Token\\\" dataType=\\\"String\\\">\" + account.token + \"</Parameter>\"\n+                + \"<Parameter name=\\\"MspSystemID\\\" dataType=\\\"int\\\">\" + account.mspSystemID\n+                + \"</Parameter></Parameters></Request>\";\n+\n+        String xmlResponse = httpXmlResponse(urlParameters);\n+\n+        if (xmlResponse.isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: getTelemetry XML response was null\");\n+            return false;\n+        }\n+\n+        if (!evaluateXPath(\"/Response/Parameters//Parameter[@name='StatusMessage']/text()\", xmlResponse).isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: getTelemetry XML response: {}\", xmlResponse);\n+            return false;\n+        }\n+\n+        for (Thing thing : getThing().getThings()) {\n+            if (thing.getHandler() instanceof HaywardThingHandler) {\n+                HaywardThingHandler handler = (HaywardThingHandler) thing.getHandler();\n+                if (handler != null) {\n+                    handler.getTelemetry(xmlResponse);\n+                }\n+            }\n+        }\n+        return true;\n+    }\n+\n+    public synchronized boolean getAlarmList() throws Exception {\n+        for (Thing thing : getThing().getThings()) {\n+            Map<String, String> properties = thing.getProperties();\n+            if (properties.get(HaywardBindingConstants.PROPERTY_TYPE).equals(\"BACKYARD\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c49b10f7fe3c218245d11ec9b290562da810a7e2"}, "originalPosition": 307}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTg3NTczMQ==", "bodyText": "You could add a null suppression to this class to prevent this null warning.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r549875731", "createdAt": "2020-12-29T22:35:57Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/handler/HaywardBridgeHandler.java", "diffHunk": "@@ -0,0 +1,458 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.handler;\n+\n+import java.io.StringReader;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import javax.xml.xpath.XPath;\n+import javax.xml.xpath.XPathConstants;\n+import javax.xml.xpath.XPathExpressionException;\n+import javax.xml.xpath.XPathFactory;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.util.StringContentProvider;\n+import org.eclipse.jetty.http.HttpHeader;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.http.HttpVersion;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardAccount;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingHandler;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.config.HaywardConfig;\n+import org.openhab.binding.haywardomnilogic.internal.discovery.HaywardDiscoveryService;\n+import org.openhab.core.library.types.OnOffType;\n+import org.openhab.core.thing.Bridge;\n+import org.openhab.core.thing.ChannelUID;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.ThingStatus;\n+import org.openhab.core.thing.ThingStatusDetail;\n+import org.openhab.core.thing.binding.BaseBridgeHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.openhab.core.types.Command;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.w3c.dom.NodeList;\n+import org.xml.sax.InputSource;\n+\n+/**\n+ * The {@link HaywardBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ */\n+\n+@NonNullByDefault\n+public class HaywardBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardBridgeHandler.class);\n+    private final HttpClient httpClient;\n+    private @Nullable ScheduledFuture<?> initializeFuture;\n+    private @Nullable ScheduledFuture<?> pollTelemetryFuture;\n+    private @Nullable ScheduledFuture<?> pollAlarmsFuture;\n+    private int commFailureCount;\n+    private @Nullable HaywardDiscoveryService haywardDiscoveryService;\n+\n+    public HaywardConfig config = getConfig().as(HaywardConfig.class);\n+    public HaywardAccount account = getConfig().as(HaywardAccount.class);\n+\n+    @Override\n+    public Collection<Class<? extends ThingHandlerService>> getServices() {\n+        return Collections.singleton(HaywardDiscoveryService.class);\n+    }\n+\n+    public HaywardBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    /**\n+     * Called by the zone discovery service to let this handler have a reference.\n+     */\n+    public void setHaywardDiscoveryService(HaywardDiscoveryService s) {\n+        this.haywardDiscoveryService = s;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        clearPolling(initializeFuture);\n+        clearPolling(pollTelemetryFuture);\n+        clearPolling(pollAlarmsFuture);\n+        logger.trace(\"Hayward polling cancelled\");\n+        super.dispose();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        updateStatus(ThingStatus.UNKNOWN);\n+        initializeFuture = scheduler.schedule(this::scheduledInitialize, 1, TimeUnit.SECONDS);\n+        return;\n+    }\n+\n+    public void scheduledInitialize() {\n+        config = getConfigAs(HaywardConfig.class);\n+\n+        try {\n+            clearPolling(pollTelemetryFuture);\n+            clearPolling(pollAlarmsFuture);\n+\n+            if (!(login())) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"Unable to Login to Hayward's server\");\n+                clearPolling(pollTelemetryFuture);\n+                clearPolling(pollAlarmsFuture);\n+                commFailureCount = 50;\n+                initPolling(60);\n+                return;\n+            }\n+\n+            if (!(getSiteList())) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"Unable to getMSP from Hayward's server\");\n+                clearPolling(pollTelemetryFuture);\n+                clearPolling(pollAlarmsFuture);\n+                commFailureCount = 50;\n+                initPolling(60);\n+                return;\n+            }\n+\n+            updateStatus(ThingStatus.ONLINE);\n+            logger.debug(\"Succesfully opened connection to Hayward's server: {} Username:{}\", config.endpointUrl,\n+                    config.username);\n+\n+            initPolling(0);\n+            logger.trace(\"Hayward Telemetry polling scheduled\");\n+\n+            if (config.alarmPollTime > 0) {\n+                initAlarmPolling(1);\n+                logger.trace(\"Hayward Alarm polling scheduled\");\n+            } else {\n+                logger.trace(\"Hayward Alarm polling disabled\");\n+            }\n+        } catch (Exception e) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.HANDLER_INITIALIZING_ERROR,\n+                    \"scheduledInitialize exception: \" + e.getMessage());\n+            clearPolling(pollTelemetryFuture);\n+            clearPolling(pollAlarmsFuture);\n+            commFailureCount = 50;\n+            initPolling(60);\n+            return;\n+        }\n+    }\n+\n+    public synchronized boolean login() throws Exception {\n+        String xmlResponse;\n+        String status;\n+\n+        // *****Login to Hayward server\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request>\" + \"<Name>Login</Name><Parameters>\"\n+                + \"<Parameter name=\\\"UserName\\\" dataType=\\\"String\\\">\" + config.username + \"</Parameter>\"\n+                + \"<Parameter name=\\\"Password\\\" dataType=\\\"String\\\">\" + config.password + \"</Parameter>\"\n+                + \"</Parameters></Request>\";\n+\n+        xmlResponse = httpXmlResponse(urlParameters);\n+\n+        if (xmlResponse.isEmpty()) {\n+            return false;\n+        }\n+\n+        status = evaluateXPath(\"/Response/Parameters//Parameter[@name='Status']/text()\", xmlResponse).get(0);\n+\n+        if (!(status.equals(\"0\"))) {\n+            logger.debug(\"Hayward Connection thing: Login XML response: {}\", xmlResponse);\n+            return false;\n+        }\n+\n+        account.token = evaluateXPath(\"/Response/Parameters//Parameter[@name='Token']/text()\", xmlResponse).get(0);\n+        account.userID = evaluateXPath(\"/Response/Parameters//Parameter[@name='UserID']/text()\", xmlResponse).get(0);\n+        return true;\n+    }\n+\n+    public synchronized boolean getApiDef() throws Exception {\n+        String xmlResponse;\n+\n+        // *****getConfig from Hayward server\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request><Name>GetAPIDef</Name><Parameters>\"\n+                + \"<Parameter name=\\\"Token\\\" dataType=\\\"String\\\">\" + account.token + \"</Parameter>\"\n+                + \"<Parameter name=\\\"MspSystemID\\\" dataType=\\\"int\\\">\" + account.mspSystemID + \"</Parameter>;\"\n+                + \"<Parameter name=\\\"Version\\\" dataType=\\\"string\\\">0.4</Parameter >\\r\\n\"\n+                + \"<Parameter name=\\\"Language\\\" dataType=\\\"string\\\">en</Parameter >\\r\\n\" + \"</Parameters></Request>\";\n+\n+        xmlResponse = httpXmlResponse(urlParameters);\n+\n+        if (xmlResponse.isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: Login XML response was null\");\n+            return false;\n+        }\n+        return true;\n+    }\n+\n+    public synchronized boolean getSiteList() throws Exception {\n+        String xmlResponse;\n+        String status;\n+\n+        // *****Get MSP\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request><Name>GetSiteList</Name><Parameters>\"\n+                + \"<Parameter name=\\\"Token\\\" dataType=\\\"String\\\">\" + account.token\n+                + \"</Parameter><Parameter name=\\\"UserID\\\" dataType=\\\"String\\\">\" + account.userID\n+                + \"</Parameter></Parameters></Request>\";\n+\n+        xmlResponse = httpXmlResponse(urlParameters);\n+\n+        if (xmlResponse.isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: getSiteList XML response was null\");\n+            return false;\n+        }\n+\n+        status = evaluateXPath(\"/Response/Parameters//Parameter[@name='Status']/text()\", xmlResponse).get(0);\n+\n+        if (!(status.equals(\"0\"))) {\n+            logger.debug(\"Hayward Connection thing: getSiteList XML response: {}\", xmlResponse);\n+            return false;\n+        }\n+\n+        account.mspSystemID = evaluateXPath(\"/Response/Parameters/Parameter/Item//Property[@name='MspSystemID']/text()\",\n+                xmlResponse).get(0);\n+        account.backyardName = evaluateXPath(\n+                \"/Response/Parameters/Parameter/Item//Property[@name='BackyardName']/text()\", xmlResponse).get(0);\n+        account.address = evaluateXPath(\"/Response/Parameters/Parameter/Item//Property[@name='Address']/text()\",\n+                xmlResponse).get(0);\n+        return true;\n+    }\n+\n+    public synchronized String getMspConfig() throws HaywardException {\n+        // *****getMspConfig from Hayward server\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request><Name>GetMspConfigFile</Name><Parameters>\"\n+                + \"<Parameter name=\\\"Token\\\" dataType=\\\"String\\\">\" + account.token + \"</Parameter>\"\n+                + \"<Parameter name=\\\"MspSystemID\\\" dataType=\\\"int\\\">\" + account.mspSystemID\n+                + \"</Parameter><Parameter name=\\\"Version\\\" dataType=\\\"string\\\">0</Parameter>\\r\\n\"\n+                + \"</Parameters></Request>\";\n+\n+        String xmlResponse = httpXmlResponse(urlParameters);\n+\n+        // Debug: Inject xml file for testing\n+        // String path =\n+        // \"C:/Users/Controls/openhab-2-5-x/git/openhab-addons/bundles/org.openhab.binding.haywardomnilogic/getConfig.xml\";\n+        // xmlResponse = new String(Files.readAllBytes(Paths.get(path)));\n+\n+        if (xmlResponse.isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: requestConfig XML response was null\");\n+            return \"Fail\";\n+        }\n+\n+        if (evaluateXPath(\"//Backyard/Name/text()\", xmlResponse).isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: requestConfiguration XML response: {}\", xmlResponse);\n+            return \"Fail\";\n+        }\n+        return xmlResponse;\n+    }\n+\n+    public synchronized boolean getTelemetryData() throws HaywardException {\n+        // *****getTelemetry from Hayward server\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request><Name>GetTelemetryData</Name><Parameters>\"\n+                + \"<Parameter name=\\\"Token\\\" dataType=\\\"String\\\">\" + account.token + \"</Parameter>\"\n+                + \"<Parameter name=\\\"MspSystemID\\\" dataType=\\\"int\\\">\" + account.mspSystemID\n+                + \"</Parameter></Parameters></Request>\";\n+\n+        String xmlResponse = httpXmlResponse(urlParameters);\n+\n+        if (xmlResponse.isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: getTelemetry XML response was null\");\n+            return false;\n+        }\n+\n+        if (!evaluateXPath(\"/Response/Parameters//Parameter[@name='StatusMessage']/text()\", xmlResponse).isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: getTelemetry XML response: {}\", xmlResponse);\n+            return false;\n+        }\n+\n+        for (Thing thing : getThing().getThings()) {\n+            if (thing.getHandler() instanceof HaywardThingHandler) {\n+                HaywardThingHandler handler = (HaywardThingHandler) thing.getHandler();\n+                if (handler != null) {\n+                    handler.getTelemetry(xmlResponse);\n+                }\n+            }\n+        }\n+        return true;\n+    }\n+\n+    public synchronized boolean getAlarmList() throws Exception {\n+        for (Thing thing : getThing().getThings()) {\n+            Map<String, String> properties = thing.getProperties();\n+            if (properties.get(HaywardBindingConstants.PROPERTY_TYPE).equals(\"BACKYARD\")) {\n+                HaywardBackyardHandler handler = (HaywardBackyardHandler) thing.getHandler();\n+                if (handler != null) {\n+                    String systemID = properties.get(HaywardBindingConstants.PROPERTY_SYSTEM_ID);\n+                    if (systemID != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c49b10f7fe3c218245d11ec9b290562da810a7e2"}, "originalPosition": 311}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTg3NjAyNg==", "bodyText": "Are you sure these properties are always set? What happens if the user adds the Thing manually?", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r549876026", "createdAt": "2020-12-29T22:37:17Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/handler/HaywardBridgeHandler.java", "diffHunk": "@@ -0,0 +1,458 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.handler;\n+\n+import java.io.StringReader;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import javax.xml.xpath.XPath;\n+import javax.xml.xpath.XPathConstants;\n+import javax.xml.xpath.XPathExpressionException;\n+import javax.xml.xpath.XPathFactory;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.util.StringContentProvider;\n+import org.eclipse.jetty.http.HttpHeader;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.http.HttpVersion;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardAccount;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingHandler;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.config.HaywardConfig;\n+import org.openhab.binding.haywardomnilogic.internal.discovery.HaywardDiscoveryService;\n+import org.openhab.core.library.types.OnOffType;\n+import org.openhab.core.thing.Bridge;\n+import org.openhab.core.thing.ChannelUID;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.ThingStatus;\n+import org.openhab.core.thing.ThingStatusDetail;\n+import org.openhab.core.thing.binding.BaseBridgeHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.openhab.core.types.Command;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.w3c.dom.NodeList;\n+import org.xml.sax.InputSource;\n+\n+/**\n+ * The {@link HaywardBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ */\n+\n+@NonNullByDefault\n+public class HaywardBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardBridgeHandler.class);\n+    private final HttpClient httpClient;\n+    private @Nullable ScheduledFuture<?> initializeFuture;\n+    private @Nullable ScheduledFuture<?> pollTelemetryFuture;\n+    private @Nullable ScheduledFuture<?> pollAlarmsFuture;\n+    private int commFailureCount;\n+    private @Nullable HaywardDiscoveryService haywardDiscoveryService;\n+\n+    public HaywardConfig config = getConfig().as(HaywardConfig.class);\n+    public HaywardAccount account = getConfig().as(HaywardAccount.class);\n+\n+    @Override\n+    public Collection<Class<? extends ThingHandlerService>> getServices() {\n+        return Collections.singleton(HaywardDiscoveryService.class);\n+    }\n+\n+    public HaywardBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    /**\n+     * Called by the zone discovery service to let this handler have a reference.\n+     */\n+    public void setHaywardDiscoveryService(HaywardDiscoveryService s) {\n+        this.haywardDiscoveryService = s;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        clearPolling(initializeFuture);\n+        clearPolling(pollTelemetryFuture);\n+        clearPolling(pollAlarmsFuture);\n+        logger.trace(\"Hayward polling cancelled\");\n+        super.dispose();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        updateStatus(ThingStatus.UNKNOWN);\n+        initializeFuture = scheduler.schedule(this::scheduledInitialize, 1, TimeUnit.SECONDS);\n+        return;\n+    }\n+\n+    public void scheduledInitialize() {\n+        config = getConfigAs(HaywardConfig.class);\n+\n+        try {\n+            clearPolling(pollTelemetryFuture);\n+            clearPolling(pollAlarmsFuture);\n+\n+            if (!(login())) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"Unable to Login to Hayward's server\");\n+                clearPolling(pollTelemetryFuture);\n+                clearPolling(pollAlarmsFuture);\n+                commFailureCount = 50;\n+                initPolling(60);\n+                return;\n+            }\n+\n+            if (!(getSiteList())) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"Unable to getMSP from Hayward's server\");\n+                clearPolling(pollTelemetryFuture);\n+                clearPolling(pollAlarmsFuture);\n+                commFailureCount = 50;\n+                initPolling(60);\n+                return;\n+            }\n+\n+            updateStatus(ThingStatus.ONLINE);\n+            logger.debug(\"Succesfully opened connection to Hayward's server: {} Username:{}\", config.endpointUrl,\n+                    config.username);\n+\n+            initPolling(0);\n+            logger.trace(\"Hayward Telemetry polling scheduled\");\n+\n+            if (config.alarmPollTime > 0) {\n+                initAlarmPolling(1);\n+                logger.trace(\"Hayward Alarm polling scheduled\");\n+            } else {\n+                logger.trace(\"Hayward Alarm polling disabled\");\n+            }\n+        } catch (Exception e) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.HANDLER_INITIALIZING_ERROR,\n+                    \"scheduledInitialize exception: \" + e.getMessage());\n+            clearPolling(pollTelemetryFuture);\n+            clearPolling(pollAlarmsFuture);\n+            commFailureCount = 50;\n+            initPolling(60);\n+            return;\n+        }\n+    }\n+\n+    public synchronized boolean login() throws Exception {\n+        String xmlResponse;\n+        String status;\n+\n+        // *****Login to Hayward server\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request>\" + \"<Name>Login</Name><Parameters>\"\n+                + \"<Parameter name=\\\"UserName\\\" dataType=\\\"String\\\">\" + config.username + \"</Parameter>\"\n+                + \"<Parameter name=\\\"Password\\\" dataType=\\\"String\\\">\" + config.password + \"</Parameter>\"\n+                + \"</Parameters></Request>\";\n+\n+        xmlResponse = httpXmlResponse(urlParameters);\n+\n+        if (xmlResponse.isEmpty()) {\n+            return false;\n+        }\n+\n+        status = evaluateXPath(\"/Response/Parameters//Parameter[@name='Status']/text()\", xmlResponse).get(0);\n+\n+        if (!(status.equals(\"0\"))) {\n+            logger.debug(\"Hayward Connection thing: Login XML response: {}\", xmlResponse);\n+            return false;\n+        }\n+\n+        account.token = evaluateXPath(\"/Response/Parameters//Parameter[@name='Token']/text()\", xmlResponse).get(0);\n+        account.userID = evaluateXPath(\"/Response/Parameters//Parameter[@name='UserID']/text()\", xmlResponse).get(0);\n+        return true;\n+    }\n+\n+    public synchronized boolean getApiDef() throws Exception {\n+        String xmlResponse;\n+\n+        // *****getConfig from Hayward server\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request><Name>GetAPIDef</Name><Parameters>\"\n+                + \"<Parameter name=\\\"Token\\\" dataType=\\\"String\\\">\" + account.token + \"</Parameter>\"\n+                + \"<Parameter name=\\\"MspSystemID\\\" dataType=\\\"int\\\">\" + account.mspSystemID + \"</Parameter>;\"\n+                + \"<Parameter name=\\\"Version\\\" dataType=\\\"string\\\">0.4</Parameter >\\r\\n\"\n+                + \"<Parameter name=\\\"Language\\\" dataType=\\\"string\\\">en</Parameter >\\r\\n\" + \"</Parameters></Request>\";\n+\n+        xmlResponse = httpXmlResponse(urlParameters);\n+\n+        if (xmlResponse.isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: Login XML response was null\");\n+            return false;\n+        }\n+        return true;\n+    }\n+\n+    public synchronized boolean getSiteList() throws Exception {\n+        String xmlResponse;\n+        String status;\n+\n+        // *****Get MSP\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request><Name>GetSiteList</Name><Parameters>\"\n+                + \"<Parameter name=\\\"Token\\\" dataType=\\\"String\\\">\" + account.token\n+                + \"</Parameter><Parameter name=\\\"UserID\\\" dataType=\\\"String\\\">\" + account.userID\n+                + \"</Parameter></Parameters></Request>\";\n+\n+        xmlResponse = httpXmlResponse(urlParameters);\n+\n+        if (xmlResponse.isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: getSiteList XML response was null\");\n+            return false;\n+        }\n+\n+        status = evaluateXPath(\"/Response/Parameters//Parameter[@name='Status']/text()\", xmlResponse).get(0);\n+\n+        if (!(status.equals(\"0\"))) {\n+            logger.debug(\"Hayward Connection thing: getSiteList XML response: {}\", xmlResponse);\n+            return false;\n+        }\n+\n+        account.mspSystemID = evaluateXPath(\"/Response/Parameters/Parameter/Item//Property[@name='MspSystemID']/text()\",\n+                xmlResponse).get(0);\n+        account.backyardName = evaluateXPath(\n+                \"/Response/Parameters/Parameter/Item//Property[@name='BackyardName']/text()\", xmlResponse).get(0);\n+        account.address = evaluateXPath(\"/Response/Parameters/Parameter/Item//Property[@name='Address']/text()\",\n+                xmlResponse).get(0);\n+        return true;\n+    }\n+\n+    public synchronized String getMspConfig() throws HaywardException {\n+        // *****getMspConfig from Hayward server\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request><Name>GetMspConfigFile</Name><Parameters>\"\n+                + \"<Parameter name=\\\"Token\\\" dataType=\\\"String\\\">\" + account.token + \"</Parameter>\"\n+                + \"<Parameter name=\\\"MspSystemID\\\" dataType=\\\"int\\\">\" + account.mspSystemID\n+                + \"</Parameter><Parameter name=\\\"Version\\\" dataType=\\\"string\\\">0</Parameter>\\r\\n\"\n+                + \"</Parameters></Request>\";\n+\n+        String xmlResponse = httpXmlResponse(urlParameters);\n+\n+        // Debug: Inject xml file for testing\n+        // String path =\n+        // \"C:/Users/Controls/openhab-2-5-x/git/openhab-addons/bundles/org.openhab.binding.haywardomnilogic/getConfig.xml\";\n+        // xmlResponse = new String(Files.readAllBytes(Paths.get(path)));\n+\n+        if (xmlResponse.isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: requestConfig XML response was null\");\n+            return \"Fail\";\n+        }\n+\n+        if (evaluateXPath(\"//Backyard/Name/text()\", xmlResponse).isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: requestConfiguration XML response: {}\", xmlResponse);\n+            return \"Fail\";\n+        }\n+        return xmlResponse;\n+    }\n+\n+    public synchronized boolean getTelemetryData() throws HaywardException {\n+        // *****getTelemetry from Hayward server\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request><Name>GetTelemetryData</Name><Parameters>\"\n+                + \"<Parameter name=\\\"Token\\\" dataType=\\\"String\\\">\" + account.token + \"</Parameter>\"\n+                + \"<Parameter name=\\\"MspSystemID\\\" dataType=\\\"int\\\">\" + account.mspSystemID\n+                + \"</Parameter></Parameters></Request>\";\n+\n+        String xmlResponse = httpXmlResponse(urlParameters);\n+\n+        if (xmlResponse.isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: getTelemetry XML response was null\");\n+            return false;\n+        }\n+\n+        if (!evaluateXPath(\"/Response/Parameters//Parameter[@name='StatusMessage']/text()\", xmlResponse).isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: getTelemetry XML response: {}\", xmlResponse);\n+            return false;\n+        }\n+\n+        for (Thing thing : getThing().getThings()) {\n+            if (thing.getHandler() instanceof HaywardThingHandler) {\n+                HaywardThingHandler handler = (HaywardThingHandler) thing.getHandler();\n+                if (handler != null) {\n+                    handler.getTelemetry(xmlResponse);\n+                }\n+            }\n+        }\n+        return true;\n+    }\n+\n+    public synchronized boolean getAlarmList() throws Exception {\n+        for (Thing thing : getThing().getThings()) {\n+            Map<String, String> properties = thing.getProperties();\n+            if (properties.get(HaywardBindingConstants.PROPERTY_TYPE).equals(\"BACKYARD\")) {\n+                HaywardBackyardHandler handler = (HaywardBackyardHandler) thing.getHandler();\n+                if (handler != null) {\n+                    String systemID = properties.get(HaywardBindingConstants.PROPERTY_SYSTEM_ID);\n+                    if (systemID != null) {\n+                        return handler.getAlarmList(systemID);\n+                    }\n+                }\n+            }\n+        }\n+        return false;\n+    }\n+\n+    private synchronized void initPolling(int initalDelay) {\n+        pollTelemetryFuture = scheduler.scheduleWithFixedDelay(() -> {\n+            try {\n+                if (commFailureCount >= 5) {\n+                    commFailureCount = 0;\n+                    clearPolling(pollTelemetryFuture);\n+                    clearPolling(pollAlarmsFuture);\n+                    initialize();\n+                    return;\n+                }\n+                if (!(getTelemetryData())) {\n+                    commFailureCount++;\n+                    return;\n+                }\n+            } catch (Exception e) {\n+                logger.debug(\"Hayward Connection thing: Exception during poll: {}\", e.getMessage());\n+            }\n+        }, initalDelay, config.telemetryPollTime, TimeUnit.SECONDS);\n+        return;\n+    }\n+\n+    private synchronized void initAlarmPolling(int initalDelay) {\n+        pollAlarmsFuture = scheduler.scheduleWithFixedDelay(() -> {\n+            try {\n+                getAlarmList();\n+            } catch (Exception e) {\n+                logger.debug(\"Hayward Connection thing: Exception during poll: {}\", e.getMessage());\n+            }\n+        }, initalDelay, config.alarmPollTime, TimeUnit.SECONDS);\n+    }\n+\n+    private void clearPolling(@Nullable ScheduledFuture<?> pollJob) {\n+        if (pollJob != null) {\n+            pollJob.cancel(false);\n+        }\n+    }\n+\n+    @Nullable\n+    Thing getThingForType(HaywardTypeToRequest type, int num) {\n+        for (Thing thing : getThing().getThings()) {\n+            Map<String, String> properties = thing.getProperties();\n+            if (properties.get(HaywardBindingConstants.PROPERTY_SYSTEM_ID).equals(Integer.toString(num))) {\n+                if (properties.get(HaywardBindingConstants.PROPERTY_TYPE).equals(type.toString())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c49b10f7fe3c218245d11ec9b290562da810a7e2"}, "originalPosition": 362}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTg3Njc5Ng==", "bodyText": "This exception is thrown when OH is shut-down. That means the current operation should be finished as fast as possible and no further operations should be done. You can achieve this by not catching the exception here but throw the InterruptedException and catch it at the highest level you can.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r549876796", "createdAt": "2020-12-29T22:41:27Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/handler/HaywardBridgeHandler.java", "diffHunk": "@@ -0,0 +1,458 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.handler;\n+\n+import java.io.StringReader;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import javax.xml.xpath.XPath;\n+import javax.xml.xpath.XPathConstants;\n+import javax.xml.xpath.XPathExpressionException;\n+import javax.xml.xpath.XPathFactory;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.util.StringContentProvider;\n+import org.eclipse.jetty.http.HttpHeader;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.http.HttpVersion;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardAccount;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingHandler;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.config.HaywardConfig;\n+import org.openhab.binding.haywardomnilogic.internal.discovery.HaywardDiscoveryService;\n+import org.openhab.core.library.types.OnOffType;\n+import org.openhab.core.thing.Bridge;\n+import org.openhab.core.thing.ChannelUID;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.ThingStatus;\n+import org.openhab.core.thing.ThingStatusDetail;\n+import org.openhab.core.thing.binding.BaseBridgeHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.openhab.core.types.Command;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.w3c.dom.NodeList;\n+import org.xml.sax.InputSource;\n+\n+/**\n+ * The {@link HaywardBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ */\n+\n+@NonNullByDefault\n+public class HaywardBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardBridgeHandler.class);\n+    private final HttpClient httpClient;\n+    private @Nullable ScheduledFuture<?> initializeFuture;\n+    private @Nullable ScheduledFuture<?> pollTelemetryFuture;\n+    private @Nullable ScheduledFuture<?> pollAlarmsFuture;\n+    private int commFailureCount;\n+    private @Nullable HaywardDiscoveryService haywardDiscoveryService;\n+\n+    public HaywardConfig config = getConfig().as(HaywardConfig.class);\n+    public HaywardAccount account = getConfig().as(HaywardAccount.class);\n+\n+    @Override\n+    public Collection<Class<? extends ThingHandlerService>> getServices() {\n+        return Collections.singleton(HaywardDiscoveryService.class);\n+    }\n+\n+    public HaywardBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    /**\n+     * Called by the zone discovery service to let this handler have a reference.\n+     */\n+    public void setHaywardDiscoveryService(HaywardDiscoveryService s) {\n+        this.haywardDiscoveryService = s;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        clearPolling(initializeFuture);\n+        clearPolling(pollTelemetryFuture);\n+        clearPolling(pollAlarmsFuture);\n+        logger.trace(\"Hayward polling cancelled\");\n+        super.dispose();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        updateStatus(ThingStatus.UNKNOWN);\n+        initializeFuture = scheduler.schedule(this::scheduledInitialize, 1, TimeUnit.SECONDS);\n+        return;\n+    }\n+\n+    public void scheduledInitialize() {\n+        config = getConfigAs(HaywardConfig.class);\n+\n+        try {\n+            clearPolling(pollTelemetryFuture);\n+            clearPolling(pollAlarmsFuture);\n+\n+            if (!(login())) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"Unable to Login to Hayward's server\");\n+                clearPolling(pollTelemetryFuture);\n+                clearPolling(pollAlarmsFuture);\n+                commFailureCount = 50;\n+                initPolling(60);\n+                return;\n+            }\n+\n+            if (!(getSiteList())) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"Unable to getMSP from Hayward's server\");\n+                clearPolling(pollTelemetryFuture);\n+                clearPolling(pollAlarmsFuture);\n+                commFailureCount = 50;\n+                initPolling(60);\n+                return;\n+            }\n+\n+            updateStatus(ThingStatus.ONLINE);\n+            logger.debug(\"Succesfully opened connection to Hayward's server: {} Username:{}\", config.endpointUrl,\n+                    config.username);\n+\n+            initPolling(0);\n+            logger.trace(\"Hayward Telemetry polling scheduled\");\n+\n+            if (config.alarmPollTime > 0) {\n+                initAlarmPolling(1);\n+                logger.trace(\"Hayward Alarm polling scheduled\");\n+            } else {\n+                logger.trace(\"Hayward Alarm polling disabled\");\n+            }\n+        } catch (Exception e) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.HANDLER_INITIALIZING_ERROR,\n+                    \"scheduledInitialize exception: \" + e.getMessage());\n+            clearPolling(pollTelemetryFuture);\n+            clearPolling(pollAlarmsFuture);\n+            commFailureCount = 50;\n+            initPolling(60);\n+            return;\n+        }\n+    }\n+\n+    public synchronized boolean login() throws Exception {\n+        String xmlResponse;\n+        String status;\n+\n+        // *****Login to Hayward server\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request>\" + \"<Name>Login</Name><Parameters>\"\n+                + \"<Parameter name=\\\"UserName\\\" dataType=\\\"String\\\">\" + config.username + \"</Parameter>\"\n+                + \"<Parameter name=\\\"Password\\\" dataType=\\\"String\\\">\" + config.password + \"</Parameter>\"\n+                + \"</Parameters></Request>\";\n+\n+        xmlResponse = httpXmlResponse(urlParameters);\n+\n+        if (xmlResponse.isEmpty()) {\n+            return false;\n+        }\n+\n+        status = evaluateXPath(\"/Response/Parameters//Parameter[@name='Status']/text()\", xmlResponse).get(0);\n+\n+        if (!(status.equals(\"0\"))) {\n+            logger.debug(\"Hayward Connection thing: Login XML response: {}\", xmlResponse);\n+            return false;\n+        }\n+\n+        account.token = evaluateXPath(\"/Response/Parameters//Parameter[@name='Token']/text()\", xmlResponse).get(0);\n+        account.userID = evaluateXPath(\"/Response/Parameters//Parameter[@name='UserID']/text()\", xmlResponse).get(0);\n+        return true;\n+    }\n+\n+    public synchronized boolean getApiDef() throws Exception {\n+        String xmlResponse;\n+\n+        // *****getConfig from Hayward server\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request><Name>GetAPIDef</Name><Parameters>\"\n+                + \"<Parameter name=\\\"Token\\\" dataType=\\\"String\\\">\" + account.token + \"</Parameter>\"\n+                + \"<Parameter name=\\\"MspSystemID\\\" dataType=\\\"int\\\">\" + account.mspSystemID + \"</Parameter>;\"\n+                + \"<Parameter name=\\\"Version\\\" dataType=\\\"string\\\">0.4</Parameter >\\r\\n\"\n+                + \"<Parameter name=\\\"Language\\\" dataType=\\\"string\\\">en</Parameter >\\r\\n\" + \"</Parameters></Request>\";\n+\n+        xmlResponse = httpXmlResponse(urlParameters);\n+\n+        if (xmlResponse.isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: Login XML response was null\");\n+            return false;\n+        }\n+        return true;\n+    }\n+\n+    public synchronized boolean getSiteList() throws Exception {\n+        String xmlResponse;\n+        String status;\n+\n+        // *****Get MSP\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request><Name>GetSiteList</Name><Parameters>\"\n+                + \"<Parameter name=\\\"Token\\\" dataType=\\\"String\\\">\" + account.token\n+                + \"</Parameter><Parameter name=\\\"UserID\\\" dataType=\\\"String\\\">\" + account.userID\n+                + \"</Parameter></Parameters></Request>\";\n+\n+        xmlResponse = httpXmlResponse(urlParameters);\n+\n+        if (xmlResponse.isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: getSiteList XML response was null\");\n+            return false;\n+        }\n+\n+        status = evaluateXPath(\"/Response/Parameters//Parameter[@name='Status']/text()\", xmlResponse).get(0);\n+\n+        if (!(status.equals(\"0\"))) {\n+            logger.debug(\"Hayward Connection thing: getSiteList XML response: {}\", xmlResponse);\n+            return false;\n+        }\n+\n+        account.mspSystemID = evaluateXPath(\"/Response/Parameters/Parameter/Item//Property[@name='MspSystemID']/text()\",\n+                xmlResponse).get(0);\n+        account.backyardName = evaluateXPath(\n+                \"/Response/Parameters/Parameter/Item//Property[@name='BackyardName']/text()\", xmlResponse).get(0);\n+        account.address = evaluateXPath(\"/Response/Parameters/Parameter/Item//Property[@name='Address']/text()\",\n+                xmlResponse).get(0);\n+        return true;\n+    }\n+\n+    public synchronized String getMspConfig() throws HaywardException {\n+        // *****getMspConfig from Hayward server\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request><Name>GetMspConfigFile</Name><Parameters>\"\n+                + \"<Parameter name=\\\"Token\\\" dataType=\\\"String\\\">\" + account.token + \"</Parameter>\"\n+                + \"<Parameter name=\\\"MspSystemID\\\" dataType=\\\"int\\\">\" + account.mspSystemID\n+                + \"</Parameter><Parameter name=\\\"Version\\\" dataType=\\\"string\\\">0</Parameter>\\r\\n\"\n+                + \"</Parameters></Request>\";\n+\n+        String xmlResponse = httpXmlResponse(urlParameters);\n+\n+        // Debug: Inject xml file for testing\n+        // String path =\n+        // \"C:/Users/Controls/openhab-2-5-x/git/openhab-addons/bundles/org.openhab.binding.haywardomnilogic/getConfig.xml\";\n+        // xmlResponse = new String(Files.readAllBytes(Paths.get(path)));\n+\n+        if (xmlResponse.isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: requestConfig XML response was null\");\n+            return \"Fail\";\n+        }\n+\n+        if (evaluateXPath(\"//Backyard/Name/text()\", xmlResponse).isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: requestConfiguration XML response: {}\", xmlResponse);\n+            return \"Fail\";\n+        }\n+        return xmlResponse;\n+    }\n+\n+    public synchronized boolean getTelemetryData() throws HaywardException {\n+        // *****getTelemetry from Hayward server\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request><Name>GetTelemetryData</Name><Parameters>\"\n+                + \"<Parameter name=\\\"Token\\\" dataType=\\\"String\\\">\" + account.token + \"</Parameter>\"\n+                + \"<Parameter name=\\\"MspSystemID\\\" dataType=\\\"int\\\">\" + account.mspSystemID\n+                + \"</Parameter></Parameters></Request>\";\n+\n+        String xmlResponse = httpXmlResponse(urlParameters);\n+\n+        if (xmlResponse.isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: getTelemetry XML response was null\");\n+            return false;\n+        }\n+\n+        if (!evaluateXPath(\"/Response/Parameters//Parameter[@name='StatusMessage']/text()\", xmlResponse).isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: getTelemetry XML response: {}\", xmlResponse);\n+            return false;\n+        }\n+\n+        for (Thing thing : getThing().getThings()) {\n+            if (thing.getHandler() instanceof HaywardThingHandler) {\n+                HaywardThingHandler handler = (HaywardThingHandler) thing.getHandler();\n+                if (handler != null) {\n+                    handler.getTelemetry(xmlResponse);\n+                }\n+            }\n+        }\n+        return true;\n+    }\n+\n+    public synchronized boolean getAlarmList() throws Exception {\n+        for (Thing thing : getThing().getThings()) {\n+            Map<String, String> properties = thing.getProperties();\n+            if (properties.get(HaywardBindingConstants.PROPERTY_TYPE).equals(\"BACKYARD\")) {\n+                HaywardBackyardHandler handler = (HaywardBackyardHandler) thing.getHandler();\n+                if (handler != null) {\n+                    String systemID = properties.get(HaywardBindingConstants.PROPERTY_SYSTEM_ID);\n+                    if (systemID != null) {\n+                        return handler.getAlarmList(systemID);\n+                    }\n+                }\n+            }\n+        }\n+        return false;\n+    }\n+\n+    private synchronized void initPolling(int initalDelay) {\n+        pollTelemetryFuture = scheduler.scheduleWithFixedDelay(() -> {\n+            try {\n+                if (commFailureCount >= 5) {\n+                    commFailureCount = 0;\n+                    clearPolling(pollTelemetryFuture);\n+                    clearPolling(pollAlarmsFuture);\n+                    initialize();\n+                    return;\n+                }\n+                if (!(getTelemetryData())) {\n+                    commFailureCount++;\n+                    return;\n+                }\n+            } catch (Exception e) {\n+                logger.debug(\"Hayward Connection thing: Exception during poll: {}\", e.getMessage());\n+            }\n+        }, initalDelay, config.telemetryPollTime, TimeUnit.SECONDS);\n+        return;\n+    }\n+\n+    private synchronized void initAlarmPolling(int initalDelay) {\n+        pollAlarmsFuture = scheduler.scheduleWithFixedDelay(() -> {\n+            try {\n+                getAlarmList();\n+            } catch (Exception e) {\n+                logger.debug(\"Hayward Connection thing: Exception during poll: {}\", e.getMessage());\n+            }\n+        }, initalDelay, config.alarmPollTime, TimeUnit.SECONDS);\n+    }\n+\n+    private void clearPolling(@Nullable ScheduledFuture<?> pollJob) {\n+        if (pollJob != null) {\n+            pollJob.cancel(false);\n+        }\n+    }\n+\n+    @Nullable\n+    Thing getThingForType(HaywardTypeToRequest type, int num) {\n+        for (Thing thing : getThing().getThings()) {\n+            Map<String, String> properties = thing.getProperties();\n+            if (properties.get(HaywardBindingConstants.PROPERTY_SYSTEM_ID).equals(Integer.toString(num))) {\n+                if (properties.get(HaywardBindingConstants.PROPERTY_TYPE).equals(type.toString())) {\n+                    return thing;\n+                }\n+            }\n+        }\n+        return null;\n+    }\n+\n+    public List<String> evaluateXPath(String xpathExp, String xmlResponse) throws HaywardException {\n+        List<String> values = new ArrayList<>();\n+        try {\n+            InputSource inputXML = new InputSource(new StringReader(xmlResponse));\n+            XPath xPath = XPathFactory.newInstance().newXPath();\n+            NodeList nodes = (NodeList) xPath.evaluate(xpathExp, inputXML, XPathConstants.NODESET);\n+\n+            for (int i = 0; i < nodes.getLength(); i++) {\n+                values.add(nodes.item(i).getNodeValue());\n+            }\n+        } catch (XPathExpressionException e) {\n+            logger.warn(\"XPathExpression exception: {}\", e.getMessage());\n+        }\n+        return values;\n+    }\n+\n+    private Request sendRequestBuilder(String url, HttpMethod method) {\n+        return this.httpClient.newRequest(url).agent(\"NextGenForIPhone/16565 CFNetwork/887 Darwin/17.0.0\")\n+                .method(method).header(HttpHeader.ACCEPT_LANGUAGE, \"en-us\").header(HttpHeader.ACCEPT, \"*/*\")\n+                .header(HttpHeader.ACCEPT_ENCODING, \"gzip, deflate\").version(HttpVersion.HTTP_1_1)\n+                .header(HttpHeader.CONNECTION, \"keep-alive\").header(HttpHeader.HOST, \"www.haywardomnilogic.com:80\")\n+                .timeout(10, TimeUnit.SECONDS);\n+    }\n+\n+    public synchronized String httpXmlResponse(String urlParameters) throws HaywardException {\n+        String urlParameterslength = Integer.toString(urlParameters.length());\n+        String statusMessage;\n+\n+        try {\n+            ContentResponse httpResponse = sendRequestBuilder(config.endpointUrl, HttpMethod.POST)\n+                    .content(new StringContentProvider(urlParameters), \"text/xml; charset=utf-8\")\n+                    .header(HttpHeader.CONTENT_LENGTH, urlParameterslength).send();\n+\n+            int status = httpResponse.getStatus();\n+            String xmlResponse = httpResponse.getContentAsString();\n+\n+            List<String> statusMessages = evaluateXPath(\"/Response/Parameters//Parameter[@name='StatusMessage']/text()\",\n+                    xmlResponse);\n+            if (!(statusMessages.isEmpty())) {\n+                statusMessage = statusMessages.get(0);\n+            } else {\n+                statusMessage = httpResponse.getReason();\n+            }\n+\n+            if (status == 200) {\n+                if (logger.isTraceEnabled()) {\n+                    logger.trace(\"Hayward Connection thing:  {} Hayward http command: {}\", getCallingMethod(),\n+                            urlParameters);\n+                    logger.trace(\"Hayward Connection thing:  {} Hayward http response: {} {}\", getCallingMethod(),\n+                            statusMessage, xmlResponse);\n+                }\n+                return xmlResponse;\n+            } else {\n+                if (logger.isDebugEnabled()) {\n+                    logger.debug(\"Hayward Connection thing:  {} Hayward http command: {}\", getCallingMethod(),\n+                            urlParameters);\n+                    logger.debug(\"Hayward Connection thing:  {} Hayward http response: {}\", getCallingMethod(), status);\n+                }\n+                return \"\";\n+            }\n+        } catch (ExecutionException e) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                    \"Unable to resolve host.  Check Hayward hostname and your internet connection.\");\n+            return \"\";\n+        } catch (TimeoutException e) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                    \"Connection Timeout.  Check Hayward hostname and your internet connection.\");\n+            return \"\";\n+        } catch (InterruptedException e) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                    \"Connection Timeout.  Check Hayward hostname and your internet connection.\");\n+            return \"\";\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c49b10f7fe3c218245d11ec9b290562da810a7e2"}, "originalPosition": 442}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTg3Njg5NA==", "bodyText": "This exception is never thrown.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public List<String> evaluateXPath(String xpathExp, String xmlResponse) throws HaywardException {\n          \n          \n            \n                public List<String> evaluateXPath(String xpathExp, String xmlResponse) {", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r549876894", "createdAt": "2020-12-29T22:41:57Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/handler/HaywardBridgeHandler.java", "diffHunk": "@@ -0,0 +1,458 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.handler;\n+\n+import java.io.StringReader;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import javax.xml.xpath.XPath;\n+import javax.xml.xpath.XPathConstants;\n+import javax.xml.xpath.XPathExpressionException;\n+import javax.xml.xpath.XPathFactory;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.util.StringContentProvider;\n+import org.eclipse.jetty.http.HttpHeader;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.http.HttpVersion;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardAccount;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingHandler;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.config.HaywardConfig;\n+import org.openhab.binding.haywardomnilogic.internal.discovery.HaywardDiscoveryService;\n+import org.openhab.core.library.types.OnOffType;\n+import org.openhab.core.thing.Bridge;\n+import org.openhab.core.thing.ChannelUID;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.ThingStatus;\n+import org.openhab.core.thing.ThingStatusDetail;\n+import org.openhab.core.thing.binding.BaseBridgeHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.openhab.core.types.Command;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.w3c.dom.NodeList;\n+import org.xml.sax.InputSource;\n+\n+/**\n+ * The {@link HaywardBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ */\n+\n+@NonNullByDefault\n+public class HaywardBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardBridgeHandler.class);\n+    private final HttpClient httpClient;\n+    private @Nullable ScheduledFuture<?> initializeFuture;\n+    private @Nullable ScheduledFuture<?> pollTelemetryFuture;\n+    private @Nullable ScheduledFuture<?> pollAlarmsFuture;\n+    private int commFailureCount;\n+    private @Nullable HaywardDiscoveryService haywardDiscoveryService;\n+\n+    public HaywardConfig config = getConfig().as(HaywardConfig.class);\n+    public HaywardAccount account = getConfig().as(HaywardAccount.class);\n+\n+    @Override\n+    public Collection<Class<? extends ThingHandlerService>> getServices() {\n+        return Collections.singleton(HaywardDiscoveryService.class);\n+    }\n+\n+    public HaywardBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    /**\n+     * Called by the zone discovery service to let this handler have a reference.\n+     */\n+    public void setHaywardDiscoveryService(HaywardDiscoveryService s) {\n+        this.haywardDiscoveryService = s;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        clearPolling(initializeFuture);\n+        clearPolling(pollTelemetryFuture);\n+        clearPolling(pollAlarmsFuture);\n+        logger.trace(\"Hayward polling cancelled\");\n+        super.dispose();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        updateStatus(ThingStatus.UNKNOWN);\n+        initializeFuture = scheduler.schedule(this::scheduledInitialize, 1, TimeUnit.SECONDS);\n+        return;\n+    }\n+\n+    public void scheduledInitialize() {\n+        config = getConfigAs(HaywardConfig.class);\n+\n+        try {\n+            clearPolling(pollTelemetryFuture);\n+            clearPolling(pollAlarmsFuture);\n+\n+            if (!(login())) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"Unable to Login to Hayward's server\");\n+                clearPolling(pollTelemetryFuture);\n+                clearPolling(pollAlarmsFuture);\n+                commFailureCount = 50;\n+                initPolling(60);\n+                return;\n+            }\n+\n+            if (!(getSiteList())) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"Unable to getMSP from Hayward's server\");\n+                clearPolling(pollTelemetryFuture);\n+                clearPolling(pollAlarmsFuture);\n+                commFailureCount = 50;\n+                initPolling(60);\n+                return;\n+            }\n+\n+            updateStatus(ThingStatus.ONLINE);\n+            logger.debug(\"Succesfully opened connection to Hayward's server: {} Username:{}\", config.endpointUrl,\n+                    config.username);\n+\n+            initPolling(0);\n+            logger.trace(\"Hayward Telemetry polling scheduled\");\n+\n+            if (config.alarmPollTime > 0) {\n+                initAlarmPolling(1);\n+                logger.trace(\"Hayward Alarm polling scheduled\");\n+            } else {\n+                logger.trace(\"Hayward Alarm polling disabled\");\n+            }\n+        } catch (Exception e) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.HANDLER_INITIALIZING_ERROR,\n+                    \"scheduledInitialize exception: \" + e.getMessage());\n+            clearPolling(pollTelemetryFuture);\n+            clearPolling(pollAlarmsFuture);\n+            commFailureCount = 50;\n+            initPolling(60);\n+            return;\n+        }\n+    }\n+\n+    public synchronized boolean login() throws Exception {\n+        String xmlResponse;\n+        String status;\n+\n+        // *****Login to Hayward server\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request>\" + \"<Name>Login</Name><Parameters>\"\n+                + \"<Parameter name=\\\"UserName\\\" dataType=\\\"String\\\">\" + config.username + \"</Parameter>\"\n+                + \"<Parameter name=\\\"Password\\\" dataType=\\\"String\\\">\" + config.password + \"</Parameter>\"\n+                + \"</Parameters></Request>\";\n+\n+        xmlResponse = httpXmlResponse(urlParameters);\n+\n+        if (xmlResponse.isEmpty()) {\n+            return false;\n+        }\n+\n+        status = evaluateXPath(\"/Response/Parameters//Parameter[@name='Status']/text()\", xmlResponse).get(0);\n+\n+        if (!(status.equals(\"0\"))) {\n+            logger.debug(\"Hayward Connection thing: Login XML response: {}\", xmlResponse);\n+            return false;\n+        }\n+\n+        account.token = evaluateXPath(\"/Response/Parameters//Parameter[@name='Token']/text()\", xmlResponse).get(0);\n+        account.userID = evaluateXPath(\"/Response/Parameters//Parameter[@name='UserID']/text()\", xmlResponse).get(0);\n+        return true;\n+    }\n+\n+    public synchronized boolean getApiDef() throws Exception {\n+        String xmlResponse;\n+\n+        // *****getConfig from Hayward server\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request><Name>GetAPIDef</Name><Parameters>\"\n+                + \"<Parameter name=\\\"Token\\\" dataType=\\\"String\\\">\" + account.token + \"</Parameter>\"\n+                + \"<Parameter name=\\\"MspSystemID\\\" dataType=\\\"int\\\">\" + account.mspSystemID + \"</Parameter>;\"\n+                + \"<Parameter name=\\\"Version\\\" dataType=\\\"string\\\">0.4</Parameter >\\r\\n\"\n+                + \"<Parameter name=\\\"Language\\\" dataType=\\\"string\\\">en</Parameter >\\r\\n\" + \"</Parameters></Request>\";\n+\n+        xmlResponse = httpXmlResponse(urlParameters);\n+\n+        if (xmlResponse.isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: Login XML response was null\");\n+            return false;\n+        }\n+        return true;\n+    }\n+\n+    public synchronized boolean getSiteList() throws Exception {\n+        String xmlResponse;\n+        String status;\n+\n+        // *****Get MSP\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request><Name>GetSiteList</Name><Parameters>\"\n+                + \"<Parameter name=\\\"Token\\\" dataType=\\\"String\\\">\" + account.token\n+                + \"</Parameter><Parameter name=\\\"UserID\\\" dataType=\\\"String\\\">\" + account.userID\n+                + \"</Parameter></Parameters></Request>\";\n+\n+        xmlResponse = httpXmlResponse(urlParameters);\n+\n+        if (xmlResponse.isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: getSiteList XML response was null\");\n+            return false;\n+        }\n+\n+        status = evaluateXPath(\"/Response/Parameters//Parameter[@name='Status']/text()\", xmlResponse).get(0);\n+\n+        if (!(status.equals(\"0\"))) {\n+            logger.debug(\"Hayward Connection thing: getSiteList XML response: {}\", xmlResponse);\n+            return false;\n+        }\n+\n+        account.mspSystemID = evaluateXPath(\"/Response/Parameters/Parameter/Item//Property[@name='MspSystemID']/text()\",\n+                xmlResponse).get(0);\n+        account.backyardName = evaluateXPath(\n+                \"/Response/Parameters/Parameter/Item//Property[@name='BackyardName']/text()\", xmlResponse).get(0);\n+        account.address = evaluateXPath(\"/Response/Parameters/Parameter/Item//Property[@name='Address']/text()\",\n+                xmlResponse).get(0);\n+        return true;\n+    }\n+\n+    public synchronized String getMspConfig() throws HaywardException {\n+        // *****getMspConfig from Hayward server\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request><Name>GetMspConfigFile</Name><Parameters>\"\n+                + \"<Parameter name=\\\"Token\\\" dataType=\\\"String\\\">\" + account.token + \"</Parameter>\"\n+                + \"<Parameter name=\\\"MspSystemID\\\" dataType=\\\"int\\\">\" + account.mspSystemID\n+                + \"</Parameter><Parameter name=\\\"Version\\\" dataType=\\\"string\\\">0</Parameter>\\r\\n\"\n+                + \"</Parameters></Request>\";\n+\n+        String xmlResponse = httpXmlResponse(urlParameters);\n+\n+        // Debug: Inject xml file for testing\n+        // String path =\n+        // \"C:/Users/Controls/openhab-2-5-x/git/openhab-addons/bundles/org.openhab.binding.haywardomnilogic/getConfig.xml\";\n+        // xmlResponse = new String(Files.readAllBytes(Paths.get(path)));\n+\n+        if (xmlResponse.isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: requestConfig XML response was null\");\n+            return \"Fail\";\n+        }\n+\n+        if (evaluateXPath(\"//Backyard/Name/text()\", xmlResponse).isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: requestConfiguration XML response: {}\", xmlResponse);\n+            return \"Fail\";\n+        }\n+        return xmlResponse;\n+    }\n+\n+    public synchronized boolean getTelemetryData() throws HaywardException {\n+        // *****getTelemetry from Hayward server\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request><Name>GetTelemetryData</Name><Parameters>\"\n+                + \"<Parameter name=\\\"Token\\\" dataType=\\\"String\\\">\" + account.token + \"</Parameter>\"\n+                + \"<Parameter name=\\\"MspSystemID\\\" dataType=\\\"int\\\">\" + account.mspSystemID\n+                + \"</Parameter></Parameters></Request>\";\n+\n+        String xmlResponse = httpXmlResponse(urlParameters);\n+\n+        if (xmlResponse.isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: getTelemetry XML response was null\");\n+            return false;\n+        }\n+\n+        if (!evaluateXPath(\"/Response/Parameters//Parameter[@name='StatusMessage']/text()\", xmlResponse).isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: getTelemetry XML response: {}\", xmlResponse);\n+            return false;\n+        }\n+\n+        for (Thing thing : getThing().getThings()) {\n+            if (thing.getHandler() instanceof HaywardThingHandler) {\n+                HaywardThingHandler handler = (HaywardThingHandler) thing.getHandler();\n+                if (handler != null) {\n+                    handler.getTelemetry(xmlResponse);\n+                }\n+            }\n+        }\n+        return true;\n+    }\n+\n+    public synchronized boolean getAlarmList() throws Exception {\n+        for (Thing thing : getThing().getThings()) {\n+            Map<String, String> properties = thing.getProperties();\n+            if (properties.get(HaywardBindingConstants.PROPERTY_TYPE).equals(\"BACKYARD\")) {\n+                HaywardBackyardHandler handler = (HaywardBackyardHandler) thing.getHandler();\n+                if (handler != null) {\n+                    String systemID = properties.get(HaywardBindingConstants.PROPERTY_SYSTEM_ID);\n+                    if (systemID != null) {\n+                        return handler.getAlarmList(systemID);\n+                    }\n+                }\n+            }\n+        }\n+        return false;\n+    }\n+\n+    private synchronized void initPolling(int initalDelay) {\n+        pollTelemetryFuture = scheduler.scheduleWithFixedDelay(() -> {\n+            try {\n+                if (commFailureCount >= 5) {\n+                    commFailureCount = 0;\n+                    clearPolling(pollTelemetryFuture);\n+                    clearPolling(pollAlarmsFuture);\n+                    initialize();\n+                    return;\n+                }\n+                if (!(getTelemetryData())) {\n+                    commFailureCount++;\n+                    return;\n+                }\n+            } catch (Exception e) {\n+                logger.debug(\"Hayward Connection thing: Exception during poll: {}\", e.getMessage());\n+            }\n+        }, initalDelay, config.telemetryPollTime, TimeUnit.SECONDS);\n+        return;\n+    }\n+\n+    private synchronized void initAlarmPolling(int initalDelay) {\n+        pollAlarmsFuture = scheduler.scheduleWithFixedDelay(() -> {\n+            try {\n+                getAlarmList();\n+            } catch (Exception e) {\n+                logger.debug(\"Hayward Connection thing: Exception during poll: {}\", e.getMessage());\n+            }\n+        }, initalDelay, config.alarmPollTime, TimeUnit.SECONDS);\n+    }\n+\n+    private void clearPolling(@Nullable ScheduledFuture<?> pollJob) {\n+        if (pollJob != null) {\n+            pollJob.cancel(false);\n+        }\n+    }\n+\n+    @Nullable\n+    Thing getThingForType(HaywardTypeToRequest type, int num) {\n+        for (Thing thing : getThing().getThings()) {\n+            Map<String, String> properties = thing.getProperties();\n+            if (properties.get(HaywardBindingConstants.PROPERTY_SYSTEM_ID).equals(Integer.toString(num))) {\n+                if (properties.get(HaywardBindingConstants.PROPERTY_TYPE).equals(type.toString())) {\n+                    return thing;\n+                }\n+            }\n+        }\n+        return null;\n+    }\n+\n+    public List<String> evaluateXPath(String xpathExp, String xmlResponse) throws HaywardException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c49b10f7fe3c218245d11ec9b290562da810a7e2"}, "originalPosition": 370}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTg3NzE4Nw==", "bodyText": "Please do a null check instead of suppressing the compiler warning. Please check all.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r549877187", "createdAt": "2020-12-29T22:43:31Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/handler/HaywardChlorinatorHandler.java", "diffHunk": "@@ -0,0 +1,172 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.handler;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingHandler;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingProperties;\n+import org.openhab.core.thing.ChannelUID;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.types.Command;\n+import org.openhab.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The Chlorinator Handler\n+ *\n+ * @author Matt Myers - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class HaywardChlorinatorHandler extends HaywardThingHandler {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardChlorinatorHandler.class);\n+    public String chlorTimedPercent = \"\";\n+    public String chlorState = \"\";\n+\n+    HaywardThingProperties prop = getConfig().as(HaywardThingProperties.class);\n+\n+    public HaywardChlorinatorHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    @Override\n+    public void getTelemetry(String xmlResponse) throws Exception {\n+        List<String> systemIDs = new ArrayList<>();\n+        List<String> data = new ArrayList<>();\n+\n+        @SuppressWarnings(\"null\")\n+        HaywardBridgeHandler bridgehandler = (HaywardBridgeHandler) getBridge().getHandler();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI1ODM5NQ=="}, "originalCommit": {"oid": "1a3e02205380a2b0ab8d6862592f8ad84944c448"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTg3NzM1Ng==", "bodyText": "See above. Catching HaywardException. Please check all.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r549877356", "createdAt": "2020-12-29T22:44:22Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/handler/HaywardChlorinatorHandler.java", "diffHunk": "@@ -0,0 +1,186 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.handler;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingHandler;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingProperties;\n+import org.openhab.core.thing.ChannelUID;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.ThingStatus;\n+import org.openhab.core.thing.ThingStatusDetail;\n+import org.openhab.core.types.Command;\n+import org.openhab.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The Chlorinator Handler\n+ */\n+@NonNullByDefault\n+public class HaywardChlorinatorHandler extends HaywardThingHandler {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardChlorinatorHandler.class);\n+    public String chlorTimedPercent = \"\";\n+    public String chlorState = \"\";\n+\n+    HaywardThingProperties prop = getConfig().as(HaywardThingProperties.class);\n+\n+    public HaywardChlorinatorHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    @Override\n+    public void getTelemetry(String xmlResponse) throws HaywardException {\n+        List<String> systemIDs = new ArrayList<>();\n+        List<String> data = new ArrayList<>();\n+\n+        @SuppressWarnings(\"null\")\n+        HaywardBridgeHandler bridgehandler = (HaywardBridgeHandler) getBridge().getHandler();\n+        if (bridgehandler != null) {\n+            systemIDs = bridgehandler.evaluateXPath(\"//Chlorinator/@systemId\", xmlResponse);\n+            String thingSystemID = getThing().getUID().getId();\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                if (systemIDs.get(i).equals(thingSystemID)) {\n+                    // Operating Mode\n+                    data = bridgehandler.evaluateXPath(\"//Chlorinator/@operatingMode\", xmlResponse);\n+                    updateData(HaywardBindingConstants.CHANNEL_CHLORINATOR_OPERATINGMODE, data.get(i));\n+\n+                    // Timed Percent\n+                    data = bridgehandler.evaluateXPath(\"//Chlorinator/@Timed-Percent\", xmlResponse);\n+                    updateData(HaywardBindingConstants.CHANNEL_CHLORINATOR_TIMEDPERCENT, data.get(i));\n+                    this.chlorTimedPercent = data.get(0);\n+\n+                    // scMode\n+                    data = bridgehandler.evaluateXPath(\"//Chlorinator/@scMode\", xmlResponse);\n+                    updateData(HaywardBindingConstants.CHANNEL_CHLORINATOR_SCMODE, data.get(i));\n+\n+                    // Error\n+                    data = bridgehandler.evaluateXPath(\"//Chlorinator/@chlrError\", xmlResponse);\n+                    updateData(HaywardBindingConstants.CHANNEL_CHLORINATOR_ERROR, data.get(i));\n+\n+                    // Alert\n+                    data = bridgehandler.evaluateXPath(\"//Chlorinator/@chlrAlert\", xmlResponse);\n+                    updateData(HaywardBindingConstants.CHANNEL_CHLORINATOR_ALERT, data.get(i));\n+\n+                    // Average Salt Level\n+                    data = bridgehandler.evaluateXPath(\"//Chlorinator/@avgSaltLevel\", xmlResponse);\n+                    updateData(HaywardBindingConstants.CHANNEL_CHLORINATOR_AVGSALTLEVEL, data.get(i));\n+\n+                    // Instant Salt Level\n+                    data = bridgehandler.evaluateXPath(\"//Chlorinator/@instantSaltLevel\", xmlResponse);\n+                    updateData(HaywardBindingConstants.CHANNEL_CHLORINATOR_INSTANTSALTLEVEL, data.get(i));\n+\n+                    // Status\n+                    data = bridgehandler.evaluateXPath(\"//Chlorinator/@status\", xmlResponse);\n+                    updateData(HaywardBindingConstants.CHANNEL_CHLORINATOR_STATUS, data.get(i));\n+\n+                    if (data.get(i).equals(\"0\")) {\n+                        updateData(HaywardBindingConstants.CHANNEL_CHLORINATOR_ENABLE, \"0\");\n+                        // chlorState is used to set the chlorinator cfgState in the timedPercent command\n+                        this.chlorState = \"2\";\n+                    } else {\n+                        updateData(HaywardBindingConstants.CHANNEL_CHLORINATOR_ENABLE, \"1\");\n+                        // chlorState is used to set the chlorinator cfgState in the timedPercent command\n+                        this.chlorState = \"3\";\n+                    }\n+                }\n+            }\n+            this.updateStatus(ThingStatus.ONLINE);\n+        } else {\n+            this.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if ((command instanceof RefreshType)) {\n+            return;\n+        }\n+\n+        String chlorCfgState = null;\n+        String chlorTimedPercent = \"0\";\n+\n+        String systemID = getThing().getProperties().get(HaywardBindingConstants.PROPERTY_SYSTEM_ID);\n+        if (systemID != null) {\n+            prop.systemID = systemID;\n+        }\n+\n+        String poolID = getThing().getProperties().get(HaywardBindingConstants.PROPERTY_BOWID);\n+        if (poolID != null) {\n+            prop.poolID = poolID;\n+        }\n+\n+        @SuppressWarnings(\"null\")\n+        HaywardBridgeHandler bridgehandler = (HaywardBridgeHandler) getBridge().getHandler();\n+        if (bridgehandler != null) {\n+            String cmdString = this.cmdToString(command);\n+            try {\n+                switch (channelUID.getId()) {\n+                    case HaywardBindingConstants.CHANNEL_CHLORINATOR_ENABLE:\n+                        if (cmdString.equals(\"1\")) {\n+                            chlorCfgState = \"3\";\n+                            chlorTimedPercent = this.chlorTimedPercent;\n+                        } else {\n+                            chlorCfgState = \"2\";\n+                            chlorTimedPercent = this.chlorTimedPercent;\n+                        }\n+                        break;\n+                    case HaywardBindingConstants.CHANNEL_CHLORINATOR_TIMEDPERCENT:\n+                        chlorCfgState = this.chlorState;\n+                        chlorTimedPercent = cmdString;\n+                        break;\n+                    default:\n+                        logger.warn(\"haywardCommand Unsupported type {}\", channelUID);\n+                        return;\n+                }\n+\n+                String cmdURL = HaywardBindingConstants.COMMAND_PARAMETERS + \"<Name>SetCHLORParams</Name><Parameters>\"\n+                        + \"<Parameter name=\\\"Token\\\" dataType=\\\"String\\\">\" + bridgehandler.account.token\n+                        + \"</Parameter>\" + \"<Parameter name=\\\"MspSystemID\\\" dataType=\\\"int\\\">\"\n+                        + bridgehandler.account.mspSystemID + \"</Parameter>\"\n+                        + \"<Parameter name=\\\"PoolID\\\" dataType=\\\"int\\\">\" + prop.poolID + \"</Parameter>\"\n+                        + \"<Parameter name=\\\"ChlorID\\\" dataType=\\\"int\\\" alias=\\\"EquipmentID\\\">\" + prop.systemID\n+                        + \"</Parameter>\" + \"<Parameter name=\\\"CfgState\\\" dataType=\\\"byte\\\" alias=\\\"Data1\\\">\"\n+                        + chlorCfgState + \"</Parameter>\"\n+                        + \"<Parameter name=\\\"OpMode\\\" dataType=\\\"byte\\\" alias=\\\"Data2\\\">1</Parameter>\"\n+                        + \"<Parameter name=\\\"BOWType\\\" dataType=\\\"byte\\\" alias=\\\"Data3\\\">1</Parameter>\"\n+                        + \"<Parameter name=\\\"CellType\\\" dataType=\\\"byte\\\" alias=\\\"Data4\\\">4</Parameter>\"\n+                        + \"<Parameter name=\\\"TimedPercent\\\" dataType=\\\"byte\\\" alias=\\\"Data5\\\">\" + chlorTimedPercent\n+                        + \"</Parameter>\"\n+                        + \"<Parameter name=\\\"SCTimeout\\\" dataType=\\\"byte\\\" unit=\\\"hour\\\" alias=\\\"Data6\\\">24</Parameter>\"\n+                        + \"<Parameter name=\\\"ORPTimout\\\" dataType=\\\"byte\\\" unit=\\\"hour\\\" alias=\\\"Data7\\\">24</Parameter>\"\n+                        + \"</Parameters></Request>\";\n+\n+                // *****Send Command to Hayward server\n+                String xmlResponse = bridgehandler.httpXmlResponse(cmdURL);\n+                String status = bridgehandler.evaluateXPath(\"//Parameter[@name='Status']/text()\", xmlResponse).get(0);\n+\n+                if (!(status.equals(\"0\"))) {\n+                    logger.debug(\"haywardCommand XML response: {}\", xmlResponse);\n+                    return;\n+                }\n+            } catch (Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c49b10f7fe3c218245d11ec9b290562da810a7e2"}, "originalPosition": 177}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMzY4NzY3", "url": "https://github.com/openhab/openhab-addons/pull/8685#pullrequestreview-561368767", "createdAt": "2021-01-04T21:48:00Z", "commit": {"oid": "6e6a0143bb8561ddabc46d3dbbddb041e68919f5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQyMTo0ODowMFrOIOCPug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQyMTo0ODowMFrOIOCPug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTU4Nzc3MA==", "bodyText": "This is never used.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r551587770", "createdAt": "2021-01-04T21:48:00Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/handler/HaywardBridgeHandler.java", "diffHunk": "@@ -0,0 +1,456 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.handler;\n+\n+import java.io.StringReader;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import javax.xml.xpath.XPath;\n+import javax.xml.xpath.XPathConstants;\n+import javax.xml.xpath.XPathExpressionException;\n+import javax.xml.xpath.XPathFactory;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.util.StringContentProvider;\n+import org.eclipse.jetty.http.HttpHeader;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.http.HttpVersion;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardAccount;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingHandler;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.config.HaywardConfig;\n+import org.openhab.binding.haywardomnilogic.internal.discovery.HaywardDiscoveryService;\n+import org.openhab.core.library.types.OnOffType;\n+import org.openhab.core.thing.Bridge;\n+import org.openhab.core.thing.ChannelUID;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.ThingStatus;\n+import org.openhab.core.thing.ThingStatusDetail;\n+import org.openhab.core.thing.binding.BaseBridgeHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.openhab.core.types.Command;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.w3c.dom.NodeList;\n+import org.xml.sax.InputSource;\n+\n+/**\n+ * The {@link HaywardBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+@NonNullByDefault\n+public class HaywardBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardBridgeHandler.class);\n+    private final HttpClient httpClient;\n+    private @Nullable ScheduledFuture<?> initializeFuture;\n+    private @Nullable ScheduledFuture<?> pollTelemetryFuture;\n+    private @Nullable ScheduledFuture<?> pollAlarmsFuture;\n+    private int commFailureCount;\n+    private @Nullable HaywardDiscoveryService haywardDiscoveryService;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e6a0143bb8561ddabc46d3dbbddb041e68919f5"}, "originalPosition": 76}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYyOTgyNjg3", "url": "https://github.com/openhab/openhab-addons/pull/8685#pullrequestreview-562982687", "createdAt": "2021-01-06T19:27:34Z", "commit": {"oid": "a51cf9e006c05da2f88d901304ae05f5ad3d930b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNlQxOToyNzozNFrOIPTeFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNlQxOTozNjoxNlrOIPTt2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjkxODU0OA==", "bodyText": "This exception is never thrown.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public synchronized boolean mspConfigDiscovery(String xmlResponse) throws HaywardException {\n          \n          \n            \n                public synchronized boolean mspConfigDiscovery(String xmlResponse) {", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r552918548", "createdAt": "2021-01-06T19:27:34Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/discovery/HaywardDiscoveryService.java", "diffHunk": "@@ -0,0 +1,454 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.discovery;\n+\n+import static org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants.THING_TYPES_UIDS;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.config.discovery.AbstractDiscoveryService;\n+import org.openhab.core.config.discovery.DiscoveryResult;\n+import org.openhab.core.config.discovery.DiscoveryResultBuilder;\n+import org.openhab.core.config.discovery.DiscoveryService;\n+import org.openhab.core.thing.ThingUID;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Sets up the discovery results and details\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+@NonNullByDefault\n+public class HaywardDiscoveryService extends AbstractDiscoveryService implements DiscoveryService, ThingHandlerService {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardDiscoveryService.class);\n+    private @Nullable HaywardBridgeHandler discoveryBridgehandler;\n+\n+    public HaywardDiscoveryService() {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    /**\n+     * Constructs a zone discovery service.\n+     * Registers this zone discovery service programmatically.\n+     * Call {@link ZoneDiscoveryService#destroy()} to unregister the service after use.\n+     */\n+    public HaywardDiscoveryService(HaywardBridgeHandler bridge) throws IllegalArgumentException {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    @Override\n+    public void activate() {\n+        super.activate(null);\n+    }\n+\n+    @Override\n+    public void deactivate() {\n+        super.deactivate();\n+    }\n+\n+    @Override\n+    protected void startScan() {\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        try {\n+            if (bridgehandler != null) {\n+                String xmlResults = bridgehandler.getMspConfig();\n+                mspConfigDiscovery(xmlResults);\n+            }\n+        } catch (HaywardException e) {\n+            logger.warn(\"Exception during discovery scan: {}\", e.getMessage());\n+        } catch (InterruptedException e) {\n+            return;\n+        }\n+    }\n+\n+    public synchronized boolean mspConfigDiscovery(String xmlResponse) throws HaywardException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a51cf9e006c05da2f88d901304ae05f5ad3d930b"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjkyMjU4Nw==", "bodyText": "This assignment doesn't have any effect as haywardDiscoveryService is never read.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r552922587", "createdAt": "2021-01-06T19:36:16Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/handler/HaywardBridgeHandler.java", "diffHunk": "@@ -0,0 +1,483 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.handler;\n+\n+import java.io.StringReader;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import javax.xml.xpath.XPath;\n+import javax.xml.xpath.XPathConstants;\n+import javax.xml.xpath.XPathExpressionException;\n+import javax.xml.xpath.XPathFactory;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.util.StringContentProvider;\n+import org.eclipse.jetty.http.HttpHeader;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.http.HttpVersion;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardAccount;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingHandler;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.config.HaywardConfig;\n+import org.openhab.binding.haywardomnilogic.internal.discovery.HaywardDiscoveryService;\n+import org.openhab.core.library.types.OnOffType;\n+import org.openhab.core.thing.Bridge;\n+import org.openhab.core.thing.ChannelUID;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.ThingStatus;\n+import org.openhab.core.thing.ThingStatusDetail;\n+import org.openhab.core.thing.binding.BaseBridgeHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.openhab.core.types.Command;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.w3c.dom.NodeList;\n+import org.xml.sax.InputSource;\n+\n+/**\n+ * The {@link HaywardBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+@NonNullByDefault\n+public class HaywardBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardBridgeHandler.class);\n+    private final HttpClient httpClient;\n+    private @Nullable ScheduledFuture<?> initializeFuture;\n+    private @Nullable ScheduledFuture<?> pollTelemetryFuture;\n+    private @Nullable ScheduledFuture<?> pollAlarmsFuture;\n+    private int commFailureCount;\n+    private @Nullable HaywardDiscoveryService haywardDiscoveryService;\n+    public HaywardConfig config = getConfig().as(HaywardConfig.class);\n+    public HaywardAccount account = getConfig().as(HaywardAccount.class);\n+\n+    @Override\n+    public Collection<Class<? extends ThingHandlerService>> getServices() {\n+        return Collections.singleton(HaywardDiscoveryService.class);\n+    }\n+\n+    public HaywardBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    /**\n+     * Called by the zone discovery service to let this handler have a reference.\n+     */\n+    public void setHaywardDiscoveryService(HaywardDiscoveryService s) {\n+        haywardDiscoveryService = s;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a51cf9e006c05da2f88d901304ae05f5ad3d930b"}, "originalPosition": 94}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY0NjA4NjE4", "url": "https://github.com/openhab/openhab-addons/pull/8685#pullrequestreview-564608618", "createdAt": "2021-01-08T21:50:20Z", "commit": {"oid": "0c92ed95362793a7782521d1c7c83333b583ad36"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY1NzM4Mzk2", "url": "https://github.com/openhab/openhab-addons/pull/8685#pullrequestreview-565738396", "createdAt": "2021-01-11T21:06:06Z", "commit": {"oid": "0c92ed95362793a7782521d1c7c83333b583ad36"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQyMTowNjowNlrOIRnPfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQyMToxMTo1M1rOIRnavw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTMzOTY0NQ==", "bodyText": "Please remove this line.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r555339645", "createdAt": "2021-01-11T21:06:06Z", "author": {"login": "Confectrician"}, "path": "bundles/org.openhab.binding.haywardomnilogic/README.md", "diffHunk": "@@ -0,0 +1,255 @@\n+# Hayward Omnilogic Binding\n+\n+The Hayward Omnilogic binding integrates the Omnilogic pool controller using the Hayward API.\n+\n+The Hayward Omnilogic API interacts with Hayward's cloud server requiring a connection with the Internet for sending and receiving information.\n+\n+## Supported Things\n+\n+The table below lists the Hayward OmniLogic binding thing types:\n+\n+| Things                                  | Description                                                                     | Thing Type     |\n+|-----------------------------------------|---------------------------------------------------------------------------------|----------------|\n+| Hayward OmniLogix Connection            | Connection to Hayward's Server                                                  | bridge         |\n+| Backyard                                | Backyard                                                                        | backyard       |\n+| Body of Water                           | Body of Water                                                                   | bow            |\n+| Chlorinator                             | Chlorinator\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t| chlorinator    |\n+| Colorlogic Light                        | Colorlogic Light                                                                | colorlogic     |\n+| Chlorine Sense and Dispense             | CSAD/ORP Control (under development)                                            | csad           |\n+| Filter                                  | Filter control                                                                  | filter         |\n+| Heater Equipment                        | Actual heater (i.e. gas, solar, electric)                                       | heater         |\n+| Pump                                    | Auxillary pump control (i.e. spillover)                                         | pump           |\n+| Relay                                   | Accessory relay control (deck jet sprinklers, lights, etc.)                     | relay          |\n+| Virtaul Heater                          | A Virtual Heater that can control all of the heater equipment based on priority | virtualHeater  |\n+\n+## Discovery\n+\n+The binding will automatically discover the Omnilogic pool things from the cloud server using your Hayward Omnilogic credentials.\n+\n+## Thing Configuration\n+\n+Hayward OmniLogic Connection Parameters:\n+\n+| Property\t\t\t    | Default\t\t\t\t\t\t\t\t\t\t\t\t      | Required | Description \t\t\t\t\t\t\t\t |\n+|-----------------------|-------------------------------------------------------------|----------|-------------------------------------------|\n+| Host Name      \t\t| https://app1.haywardomnilogic.com/HAAPI/HomeAutomation/API.ash  | Yes\t\t | Host name of the Hayward API server \t\t |\n+| User Name       \t\t| None    \t\t\t\t\t\t\t\t\t\t\t\t\t  | Yes\t\t | Your Hayward User Name (not email address)|\n+| Password \t\t\t\t| None\t\t\t\t\t\t\t\t\t\t\t\t\t      | Yes\t\t | Your Hayward User Password\t\t\t\t |\n+| Telemetry Poll Delay  | 12    \t\t\t\t\t\t\t\t\t\t\t\t\t  | Yes\t\t | Telemetry Poll Delay (seconds)\t\t\t |\n+| Alarm Poll Delay    \t| 60    \t\t\t\t\t\t\t\t\t\t\t\t\t  | Yes\t\t | Alarm Poll Delay (seconds)\t\t\t\t |\n+| Command Poll Delay\t| 12    \t\t\t\t\t\t\t\t\t\t\t\t\t  | Yes\t\t | Command Poll Delay (seconds)\t\t\t\t |\n+\n+## Channels\n+\n+### Backyard Channels\n+\n+| Channel Type ID       \t\t| Item Type \t\t\t| Description                                                   | Read Write |\n+|-------------------------------|-----------------------|---------------------------------------------------------------|:----------:|\n+| backyardAirTemp       \t\t| Number:Temperature\t| Backyard air temp sensor reading\t\t\t\t\t\t\t\t|      R     |\n+| backyardStatus       \t\t\t| String    \t\t\t| Backyard status\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| backyardState \t\t\t\t| String\t\t\t\t| Backyard state\t\t\t\t\t\t\t\t                |      R     |\n+| backyardAlarm1        \t\t| String    \t\t\t| Backyard alarm #1\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| backyardAlarm2    \t\t\t| String    \t\t\t| Backyard alarm #2\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| backyardAlarm3     \t\t\t| String    \t\t\t| Backyard alarm #3\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| backyardAlarm4        \t\t| String    \t\t\t| Backyard alarm #4\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| backyardAlarm5        \t\t| String    \t\t\t| Backyard alarm #5\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+\n+\n+### Body of Water Channels\n+\n+| Channel Type ID       \t\t| Item Type \t\t\t| Description                                                   | Read Write |\n+|-------------------------------|-----------------------|---------------------------------------------------------------|:----------:|\n+| bowFlow       \t\t\t\t| Number    \t\t\t| Body of Water flow sensor feedback\t\t\t\t\t\t    |      R     |\n+| bowWaterTemp       \t\t\t| Number:Temperature    | Body of Water temperature  \t\t\t\t\t\t\t\t    |      R     |\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c92ed95362793a7782521d1c7c83333b583ad36"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTMzOTc5Mw==", "bodyText": "Please remove this line.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r555339793", "createdAt": "2021-01-11T21:06:23Z", "author": {"login": "Confectrician"}, "path": "bundles/org.openhab.binding.haywardomnilogic/README.md", "diffHunk": "@@ -0,0 +1,255 @@\n+# Hayward Omnilogic Binding\n+\n+The Hayward Omnilogic binding integrates the Omnilogic pool controller using the Hayward API.\n+\n+The Hayward Omnilogic API interacts with Hayward's cloud server requiring a connection with the Internet for sending and receiving information.\n+\n+## Supported Things\n+\n+The table below lists the Hayward OmniLogic binding thing types:\n+\n+| Things                                  | Description                                                                     | Thing Type     |\n+|-----------------------------------------|---------------------------------------------------------------------------------|----------------|\n+| Hayward OmniLogix Connection            | Connection to Hayward's Server                                                  | bridge         |\n+| Backyard                                | Backyard                                                                        | backyard       |\n+| Body of Water                           | Body of Water                                                                   | bow            |\n+| Chlorinator                             | Chlorinator\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t| chlorinator    |\n+| Colorlogic Light                        | Colorlogic Light                                                                | colorlogic     |\n+| Chlorine Sense and Dispense             | CSAD/ORP Control (under development)                                            | csad           |\n+| Filter                                  | Filter control                                                                  | filter         |\n+| Heater Equipment                        | Actual heater (i.e. gas, solar, electric)                                       | heater         |\n+| Pump                                    | Auxillary pump control (i.e. spillover)                                         | pump           |\n+| Relay                                   | Accessory relay control (deck jet sprinklers, lights, etc.)                     | relay          |\n+| Virtaul Heater                          | A Virtual Heater that can control all of the heater equipment based on priority | virtualHeater  |\n+\n+## Discovery\n+\n+The binding will automatically discover the Omnilogic pool things from the cloud server using your Hayward Omnilogic credentials.\n+\n+## Thing Configuration\n+\n+Hayward OmniLogic Connection Parameters:\n+\n+| Property\t\t\t    | Default\t\t\t\t\t\t\t\t\t\t\t\t      | Required | Description \t\t\t\t\t\t\t\t |\n+|-----------------------|-------------------------------------------------------------|----------|-------------------------------------------|\n+| Host Name      \t\t| https://app1.haywardomnilogic.com/HAAPI/HomeAutomation/API.ash  | Yes\t\t | Host name of the Hayward API server \t\t |\n+| User Name       \t\t| None    \t\t\t\t\t\t\t\t\t\t\t\t\t  | Yes\t\t | Your Hayward User Name (not email address)|\n+| Password \t\t\t\t| None\t\t\t\t\t\t\t\t\t\t\t\t\t      | Yes\t\t | Your Hayward User Password\t\t\t\t |\n+| Telemetry Poll Delay  | 12    \t\t\t\t\t\t\t\t\t\t\t\t\t  | Yes\t\t | Telemetry Poll Delay (seconds)\t\t\t |\n+| Alarm Poll Delay    \t| 60    \t\t\t\t\t\t\t\t\t\t\t\t\t  | Yes\t\t | Alarm Poll Delay (seconds)\t\t\t\t |\n+| Command Poll Delay\t| 12    \t\t\t\t\t\t\t\t\t\t\t\t\t  | Yes\t\t | Command Poll Delay (seconds)\t\t\t\t |\n+\n+## Channels\n+\n+### Backyard Channels\n+\n+| Channel Type ID       \t\t| Item Type \t\t\t| Description                                                   | Read Write |\n+|-------------------------------|-----------------------|---------------------------------------------------------------|:----------:|\n+| backyardAirTemp       \t\t| Number:Temperature\t| Backyard air temp sensor reading\t\t\t\t\t\t\t\t|      R     |\n+| backyardStatus       \t\t\t| String    \t\t\t| Backyard status\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| backyardState \t\t\t\t| String\t\t\t\t| Backyard state\t\t\t\t\t\t\t\t                |      R     |\n+| backyardAlarm1        \t\t| String    \t\t\t| Backyard alarm #1\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| backyardAlarm2    \t\t\t| String    \t\t\t| Backyard alarm #2\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| backyardAlarm3     \t\t\t| String    \t\t\t| Backyard alarm #3\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| backyardAlarm4        \t\t| String    \t\t\t| Backyard alarm #4\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| backyardAlarm5        \t\t| String    \t\t\t| Backyard alarm #5\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+\n+\n+### Body of Water Channels\n+\n+| Channel Type ID       \t\t| Item Type \t\t\t| Description                                                   | Read Write |\n+|-------------------------------|-----------------------|---------------------------------------------------------------|:----------:|\n+| bowFlow       \t\t\t\t| Number    \t\t\t| Body of Water flow sensor feedback\t\t\t\t\t\t    |      R     |\n+| bowWaterTemp       \t\t\t| Number:Temperature    | Body of Water temperature  \t\t\t\t\t\t\t\t    |      R     |\n+\n+\n+### Chlorinator Channels\n+\n+| Channel Type ID       \t\t| Item Type \t\t\t| Description                                                   | Read Write |\n+|-------------------------------|-----------\t\t\t|---------------------------------------------------------------|:----------:|\n+| chlorEnable       \t\t\t| Switch    \t\t\t| Chlorinator enable\t\t\t\t\t\t\t\t\t\t\t|     R/W    |\n+| chlorOperatingMode    \t\t| String     \t\t\t| Chlorinator operating mode\t\t\t\t\t\t\t\t\t|      R     |\n+| chlorTimedPercent \t\t\t| Number:Dimensionless\t| Chlorinator timed percent\t\t\t\t\t                    |     R/W    |\n+| chlorOperatingState   \t\t| Number    \t\t\t| Chlorinator operating state\t\t\t\t\t\t\t\t\t|      R     |\n+ chlorScMode    \t\t\t\t| String    \t\t\t| Chlorinator mode\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| chlorError     \t\t\t\t| Number    \t\t\t| Chlorinator error\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| chlorAlert        \t\t\t| String    \t\t\t| Chlorinator alert\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| chlorAvgSaltLevel     \t\t| Number:Dimensionless  | Chlorinator average salt level in Part per Million (ppm)\t\t|      R     |\n+| chlorInstantSaltLevel \t\t| Number:Dimensionless  | Chlorinator instant salt level in Part per Million (ppm)    \t|      R     |\n+| chlorStatus     \t\t\t\t| Number    \t\t\t| Chlorinator K1/K2 relay status      \t\t\t\t\t\t\t|      R     |\n+\n+### Colorlogic Light Channels\n+\n+| Channel Type ID       \t\t| Item Type | Description                                                               | Read Write |\n+|-------------------------------|-----------|---------------------------------------------------------------------------|:----------:|\n+| colorLogicLightEnable       \t| Switch    | Colorlogic Light enable\t\t\t\t\t\t\t\t\t\t\t\t\t|     R/W    |\n+| colorLogicLightState    \t\t| Number    | Colorlogic Light state\t\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| colorLogicLightCurrentShow \t| Number\t| Colorlogic Light current show\t\t\t\t\t                            |     R/W    |\n+\n+### Filter Channels\n+\n+| Channel Type ID       \t\t| Item Type | Description                                                               | Read Write |\n+|-------------------------------|-----------|---------------------------------------------------------------------------|:----------:|\n+| filterEnable\t    \t\t\t| Switch    | Filter enable\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|     R/W    |\n+| filterValvePosition    \t\t| Number    | Filter valve position\t\t\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| filterSpeed \t\t\t\t\t| Dimmer\t| Filter speed\t\t\t\t\t\t\t\t                                |     R/W    |\n+| filterState   \t\t\t\t| Number    | Filter state\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| filterLastSpeed       \t\t| Number    | Filter last speed\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+\n+### Heater Channels\n+\n+| Channel Type ID               | Item Type \t\t\t| Description                                                   | Read Write |\n+|-------------------------------|-----------------------|---------------------------------------------------------------|:----------:|\n+| heaterState                   | Number    \t\t\t| Heater state                                                  |      R     |\n+| heaterTemp                    | Number:Temperature\t| Heater temperature                                            |      R     |\n+| heaterEnable                  | Number    \t\t\t| Heater enable                                                 |      R     |\n+| heaterPriority                | Number    \t\t\t| Heater priority                                               |      R     |\n+| heaterMaintainFor             | Number    \t\t\t| Heater maintain for                                           |      R     |\n+\n+### Pump Channels\n+\n+| Channel Type ID               | Item Type | Description                                                               | Read Write |\n+|-------------------------------|-----------|---------------------------------------------------------------------------|:----------:|\n+| pumpEnable                    | Switch    | Pump enable                                                               |      R     |\n+| pumpSpeed                     | Dimmer    | Pump speed                                                                |      R     |\n+\n+### Relay Channels\n+\n+| Channel Type ID       \t\t| Item Type | Description                                                               | Read Write |\n+|-------------------------------|-----------|---------------------------------------------------------------------------|:----------:|\n+| relayState\t    \t\t\t| Switch    | Relay state\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|     R/W    |\n+\n+### Virtual Heater Channels\n+\n+| Channel Type ID               | Item Type | Description                                                               | Read Write |\n+|-------------------------------|-----------|---------------------------------------------------------------------------|:----------:|\n+| heaterState                   | Number    | Heater state                                                              |      R     |\n+| heaterEnable                  | Number    | Heater enable                                                             |      R     |\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c92ed95362793a7782521d1c7c83333b583ad36"}, "originalPosition": 128}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTMzOTg1MQ==", "bodyText": "Please remove this line.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r555339851", "createdAt": "2021-01-11T21:06:32Z", "author": {"login": "Confectrician"}, "path": "bundles/org.openhab.binding.haywardomnilogic/README.md", "diffHunk": "@@ -0,0 +1,255 @@\n+# Hayward Omnilogic Binding\n+\n+The Hayward Omnilogic binding integrates the Omnilogic pool controller using the Hayward API.\n+\n+The Hayward Omnilogic API interacts with Hayward's cloud server requiring a connection with the Internet for sending and receiving information.\n+\n+## Supported Things\n+\n+The table below lists the Hayward OmniLogic binding thing types:\n+\n+| Things                                  | Description                                                                     | Thing Type     |\n+|-----------------------------------------|---------------------------------------------------------------------------------|----------------|\n+| Hayward OmniLogix Connection            | Connection to Hayward's Server                                                  | bridge         |\n+| Backyard                                | Backyard                                                                        | backyard       |\n+| Body of Water                           | Body of Water                                                                   | bow            |\n+| Chlorinator                             | Chlorinator\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t| chlorinator    |\n+| Colorlogic Light                        | Colorlogic Light                                                                | colorlogic     |\n+| Chlorine Sense and Dispense             | CSAD/ORP Control (under development)                                            | csad           |\n+| Filter                                  | Filter control                                                                  | filter         |\n+| Heater Equipment                        | Actual heater (i.e. gas, solar, electric)                                       | heater         |\n+| Pump                                    | Auxillary pump control (i.e. spillover)                                         | pump           |\n+| Relay                                   | Accessory relay control (deck jet sprinklers, lights, etc.)                     | relay          |\n+| Virtaul Heater                          | A Virtual Heater that can control all of the heater equipment based on priority | virtualHeater  |\n+\n+## Discovery\n+\n+The binding will automatically discover the Omnilogic pool things from the cloud server using your Hayward Omnilogic credentials.\n+\n+## Thing Configuration\n+\n+Hayward OmniLogic Connection Parameters:\n+\n+| Property\t\t\t    | Default\t\t\t\t\t\t\t\t\t\t\t\t      | Required | Description \t\t\t\t\t\t\t\t |\n+|-----------------------|-------------------------------------------------------------|----------|-------------------------------------------|\n+| Host Name      \t\t| https://app1.haywardomnilogic.com/HAAPI/HomeAutomation/API.ash  | Yes\t\t | Host name of the Hayward API server \t\t |\n+| User Name       \t\t| None    \t\t\t\t\t\t\t\t\t\t\t\t\t  | Yes\t\t | Your Hayward User Name (not email address)|\n+| Password \t\t\t\t| None\t\t\t\t\t\t\t\t\t\t\t\t\t      | Yes\t\t | Your Hayward User Password\t\t\t\t |\n+| Telemetry Poll Delay  | 12    \t\t\t\t\t\t\t\t\t\t\t\t\t  | Yes\t\t | Telemetry Poll Delay (seconds)\t\t\t |\n+| Alarm Poll Delay    \t| 60    \t\t\t\t\t\t\t\t\t\t\t\t\t  | Yes\t\t | Alarm Poll Delay (seconds)\t\t\t\t |\n+| Command Poll Delay\t| 12    \t\t\t\t\t\t\t\t\t\t\t\t\t  | Yes\t\t | Command Poll Delay (seconds)\t\t\t\t |\n+\n+## Channels\n+\n+### Backyard Channels\n+\n+| Channel Type ID       \t\t| Item Type \t\t\t| Description                                                   | Read Write |\n+|-------------------------------|-----------------------|---------------------------------------------------------------|:----------:|\n+| backyardAirTemp       \t\t| Number:Temperature\t| Backyard air temp sensor reading\t\t\t\t\t\t\t\t|      R     |\n+| backyardStatus       \t\t\t| String    \t\t\t| Backyard status\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| backyardState \t\t\t\t| String\t\t\t\t| Backyard state\t\t\t\t\t\t\t\t                |      R     |\n+| backyardAlarm1        \t\t| String    \t\t\t| Backyard alarm #1\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| backyardAlarm2    \t\t\t| String    \t\t\t| Backyard alarm #2\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| backyardAlarm3     \t\t\t| String    \t\t\t| Backyard alarm #3\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| backyardAlarm4        \t\t| String    \t\t\t| Backyard alarm #4\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| backyardAlarm5        \t\t| String    \t\t\t| Backyard alarm #5\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+\n+\n+### Body of Water Channels\n+\n+| Channel Type ID       \t\t| Item Type \t\t\t| Description                                                   | Read Write |\n+|-------------------------------|-----------------------|---------------------------------------------------------------|:----------:|\n+| bowFlow       \t\t\t\t| Number    \t\t\t| Body of Water flow sensor feedback\t\t\t\t\t\t    |      R     |\n+| bowWaterTemp       \t\t\t| Number:Temperature    | Body of Water temperature  \t\t\t\t\t\t\t\t    |      R     |\n+\n+\n+### Chlorinator Channels\n+\n+| Channel Type ID       \t\t| Item Type \t\t\t| Description                                                   | Read Write |\n+|-------------------------------|-----------\t\t\t|---------------------------------------------------------------|:----------:|\n+| chlorEnable       \t\t\t| Switch    \t\t\t| Chlorinator enable\t\t\t\t\t\t\t\t\t\t\t|     R/W    |\n+| chlorOperatingMode    \t\t| String     \t\t\t| Chlorinator operating mode\t\t\t\t\t\t\t\t\t|      R     |\n+| chlorTimedPercent \t\t\t| Number:Dimensionless\t| Chlorinator timed percent\t\t\t\t\t                    |     R/W    |\n+| chlorOperatingState   \t\t| Number    \t\t\t| Chlorinator operating state\t\t\t\t\t\t\t\t\t|      R     |\n+ chlorScMode    \t\t\t\t| String    \t\t\t| Chlorinator mode\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| chlorError     \t\t\t\t| Number    \t\t\t| Chlorinator error\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| chlorAlert        \t\t\t| String    \t\t\t| Chlorinator alert\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| chlorAvgSaltLevel     \t\t| Number:Dimensionless  | Chlorinator average salt level in Part per Million (ppm)\t\t|      R     |\n+| chlorInstantSaltLevel \t\t| Number:Dimensionless  | Chlorinator instant salt level in Part per Million (ppm)    \t|      R     |\n+| chlorStatus     \t\t\t\t| Number    \t\t\t| Chlorinator K1/K2 relay status      \t\t\t\t\t\t\t|      R     |\n+\n+### Colorlogic Light Channels\n+\n+| Channel Type ID       \t\t| Item Type | Description                                                               | Read Write |\n+|-------------------------------|-----------|---------------------------------------------------------------------------|:----------:|\n+| colorLogicLightEnable       \t| Switch    | Colorlogic Light enable\t\t\t\t\t\t\t\t\t\t\t\t\t|     R/W    |\n+| colorLogicLightState    \t\t| Number    | Colorlogic Light state\t\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| colorLogicLightCurrentShow \t| Number\t| Colorlogic Light current show\t\t\t\t\t                            |     R/W    |\n+\n+### Filter Channels\n+\n+| Channel Type ID       \t\t| Item Type | Description                                                               | Read Write |\n+|-------------------------------|-----------|---------------------------------------------------------------------------|:----------:|\n+| filterEnable\t    \t\t\t| Switch    | Filter enable\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|     R/W    |\n+| filterValvePosition    \t\t| Number    | Filter valve position\t\t\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| filterSpeed \t\t\t\t\t| Dimmer\t| Filter speed\t\t\t\t\t\t\t\t                                |     R/W    |\n+| filterState   \t\t\t\t| Number    | Filter state\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| filterLastSpeed       \t\t| Number    | Filter last speed\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+\n+### Heater Channels\n+\n+| Channel Type ID               | Item Type \t\t\t| Description                                                   | Read Write |\n+|-------------------------------|-----------------------|---------------------------------------------------------------|:----------:|\n+| heaterState                   | Number    \t\t\t| Heater state                                                  |      R     |\n+| heaterTemp                    | Number:Temperature\t| Heater temperature                                            |      R     |\n+| heaterEnable                  | Number    \t\t\t| Heater enable                                                 |      R     |\n+| heaterPriority                | Number    \t\t\t| Heater priority                                               |      R     |\n+| heaterMaintainFor             | Number    \t\t\t| Heater maintain for                                           |      R     |\n+\n+### Pump Channels\n+\n+| Channel Type ID               | Item Type | Description                                                               | Read Write |\n+|-------------------------------|-----------|---------------------------------------------------------------------------|:----------:|\n+| pumpEnable                    | Switch    | Pump enable                                                               |      R     |\n+| pumpSpeed                     | Dimmer    | Pump speed                                                                |      R     |\n+\n+### Relay Channels\n+\n+| Channel Type ID       \t\t| Item Type | Description                                                               | Read Write |\n+|-------------------------------|-----------|---------------------------------------------------------------------------|:----------:|\n+| relayState\t    \t\t\t| Switch    | Relay state\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|     R/W    |\n+\n+### Virtual Heater Channels\n+\n+| Channel Type ID               | Item Type | Description                                                               | Read Write |\n+|-------------------------------|-----------|---------------------------------------------------------------------------|:----------:|\n+| heaterState                   | Number    | Heater state                                                              |      R     |\n+| heaterEnable                  | Number    | Heater enable                                                             |      R     |\n+\n+\n+## Full Example\n+\n+After installing the binding, you will need to manually add the Hayward Connection thing and enter your credentials.\n+All pool items will then be automatically discovered.\n+Goto the inbox and add the things.\n+\n+### demo.items:\n+\n+```\n+Number:Temperature   PoolBackyardAirTemp \"Air Temp [%1.0f \u00b0F]\"                  { channel = \"haywardomnilogic:backyard:2ee76053:35940:backyardAirTemp\"}\n+String   PoolBackyardStatus \"Status [%s]\"                                       { channel = \"haywardomnilogic:backyard:2ee76053:35940:backyardStatus\"}\n+String   PoolBackyardState \"State [%s]\"                                         { channel = \"haywardomnilogic:backyard:2ee76053:35940:backyardState\"}\n+String   PoolBackyardAlarm1 \"Alarm #1 [%s]\"                                     { channel = \"haywardomnilogic:backyard:2ee76053:35940:backyardAlarm1\"}\n+String   PoolBackyardAlarm2 \"Alarm #2 [%s]\"                                     { channel = \"haywardomnilogic:backyard:2ee76053:35940:backyardAlarm2\"}\n+String   PoolBackyardAlarm3 \"Alarm #3 [%s]\"                                     { channel = \"haywardomnilogic:backyard:2ee76053:35940:backyardAlarm3\"}\n+String   PoolBackyardAlarm4 \"Alarm #4 [%s]\"                                     { channel = \"haywardomnilogic:backyard:2ee76053:35940:backyardAlarm4\"}\n+String   PoolBackyardAlarm5 \"Alarm #5 [%s]\"                                     { channel = \"haywardomnilogic:backyard:2ee76053:35940:backyardAlarm5\"}\n+  \n+Number   PoolBOWFlow \"Flow Switch\"                      \t\t\t\t\t\t{ channel = \"haywardomnilogic:bow:2ee76053:30:bowFlow\"}\n+Number:Temperature   PoolBOWWaterTemp \"Water Temp [%1.0f \u00b0F]\"                   { channel = \"haywardomnilogic:bow:2ee76053:30:bowWaterTemp\"}\n+ \n+Switch   PoolChlorEnable \"Enable\"                                               { channel = \"haywardomnilogic:chlorinator:2ee76053:34:chlorEnable\"}\n+String   PoolChlorOperatingMode \"Operating Mode [%s]\"                           { channel = \"haywardomnilogic:chlorinator:2ee76053:34:chlorOperatingMode\"}\n+Number   PoolChlorSaltOutput \"Salt Output [%1.0f %%]\"           \t\t\t\t{ channel = \"haywardomnilogic:chlorinator:2ee76053:34:chlorTimedPercent\"}\n+String   PoolChlorOperatingState \"Operating State [%s]\"                         { channel = \"haywardomnilogic:chlorinator:2ee76053:34:chlorOperatingState\"}\n+String   PoolChlorScMode \"SC Mode [%s]\"                                         { channel = \"haywardomnilogic:chlorinator:2ee76053:34:chlorScMode\"}\n+Number   PoolChlorError \"Error [%s]\"                                            { channel = \"haywardomnilogic:chlorinator:2ee76053:34:chlorError\"}\n+String   PoolChlorAlert \"Alert\"             \t\t\t\t\t\t\t\t\t{ channel = \"haywardomnilogic:chlorinator:2ee76053:34:chlorAlert\"}\n+Number   PoolChlorAverageSalt \"Average Salt[%1.0f ppm]\"                         { channel = \"haywardomnilogic:chlorinator:2ee76053:34:chlorAvgSaltLevel\"}\n+Number   PoolChlorInstantSalt \"Instant Salt [%1.0f ppm]\"                        { channel = \"haywardomnilogic:chlorinator:2ee76053:34:chlorInstantSaltLevel\"}\n+Number   PoolChlorStatus \"K1/K2 Relay Status\"                                   { channel = \"haywardomnilogic:chlorinator:2ee76053:34:chlorStatus\"}\n+\n+Number   PoolHeaterState \"State [%s]\"                                           { channel = \"haywardomnilogic:heater:2ee76053:33:heaterState\"}\n+Number   PoolHeaterEnable \"Power [%s]\"                                          { channel = \"haywardomnilogic:heater:2ee76053:33:heaterEnable\"}\n+\n+Switch   PoolLightEnable \"Enable\"                                               { channel = \"haywardomnilogic:colorlogic:2ee76053:38:colorLogicLightEnable\"}\n+String   PoolLightState \"State\"                   \t\t\t\t\t\t\t\t{ channel = \"haywardomnilogic:colorlogic:2ee76053:38:colorLogicLightState\"}\n+String   PoolLightCurrentShow \"Show\"                                            { channel = \"haywardomnilogic:colorlogic:2ee76053:38:colorLogicLightCurrentShow\"}\n+\n+Switch   PoolFilterEnable \"Power\"                                               { channel = \"haywardomnilogic:filter:2ee76053:31:filterPowerSwitch\"}\n+Number   PoolFilterValve \"Valve Position [%s]\"                                  { channel = \"haywardomnilogic:filter:2ee76053:31:filterValvePosition\"}\n+Number   PoolFilterSpeed \"Speed[%1.0f %%]\"                                      { channel = \"haywardomnilogic:filter:2ee76053:31:filterSpeed\"}\n+Number   PoolFilterState \"State\"                 \t\t\t\t\t\t\t\t{ channel = \"haywardomnilogic:filter:2ee76053:31:filterState\"}\n+Number   PoolFilterLastSpeed \"Speed[%1.0f %%]\"                                  { channel = \"haywardomnilogic:filter:2ee76053:31:filterLastSpeed\"}\n+\n+Switch   PoolVirtualHeaterEnable \"Power\"                                        { channel = \"haywardomnilogic:virtualHeater:2ee76053:32:virtualHeaterEnable\"}\n+Number:Temperature   PoolVirtualHeaterTemp \"Temp [%1.0f \u00b0F]\"                    { channel = \"haywardomnilogic:virtualHeater:2ee76053:32:virtualHeaterCurrentSetpoint\"}\n+  \n+Switch   PoolRelay1 \"Deck Jets\"                                                 { channel = \"haywardomnilogic:relay:2ee76053:37:relayState\"}\n+Switch   PoolRelay2 \"Vacuum\"                                                    { channel = \"haywardomnilogic:relay:2ee76053:36:relayState\"}\n+```\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c92ed95362793a7782521d1c7c83333b583ad36"}, "originalPosition": 181}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTM0MjIxOQ==", "bodyText": "```text\nMarkdown linting would want a language.\nMostly text is fine, since we are changing that anyway during website builds.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r555342219", "createdAt": "2021-01-11T21:11:13Z", "author": {"login": "Confectrician"}, "path": "bundles/org.openhab.binding.haywardomnilogic/README.md", "diffHunk": "@@ -0,0 +1,255 @@\n+# Hayward Omnilogic Binding\n+\n+The Hayward Omnilogic binding integrates the Omnilogic pool controller using the Hayward API.\n+\n+The Hayward Omnilogic API interacts with Hayward's cloud server requiring a connection with the Internet for sending and receiving information.\n+\n+## Supported Things\n+\n+The table below lists the Hayward OmniLogic binding thing types:\n+\n+| Things                                  | Description                                                                     | Thing Type     |\n+|-----------------------------------------|---------------------------------------------------------------------------------|----------------|\n+| Hayward OmniLogix Connection            | Connection to Hayward's Server                                                  | bridge         |\n+| Backyard                                | Backyard                                                                        | backyard       |\n+| Body of Water                           | Body of Water                                                                   | bow            |\n+| Chlorinator                             | Chlorinator\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t| chlorinator    |\n+| Colorlogic Light                        | Colorlogic Light                                                                | colorlogic     |\n+| Chlorine Sense and Dispense             | CSAD/ORP Control (under development)                                            | csad           |\n+| Filter                                  | Filter control                                                                  | filter         |\n+| Heater Equipment                        | Actual heater (i.e. gas, solar, electric)                                       | heater         |\n+| Pump                                    | Auxillary pump control (i.e. spillover)                                         | pump           |\n+| Relay                                   | Accessory relay control (deck jet sprinklers, lights, etc.)                     | relay          |\n+| Virtaul Heater                          | A Virtual Heater that can control all of the heater equipment based on priority | virtualHeater  |\n+\n+## Discovery\n+\n+The binding will automatically discover the Omnilogic pool things from the cloud server using your Hayward Omnilogic credentials.\n+\n+## Thing Configuration\n+\n+Hayward OmniLogic Connection Parameters:\n+\n+| Property\t\t\t    | Default\t\t\t\t\t\t\t\t\t\t\t\t      | Required | Description \t\t\t\t\t\t\t\t |\n+|-----------------------|-------------------------------------------------------------|----------|-------------------------------------------|\n+| Host Name      \t\t| https://app1.haywardomnilogic.com/HAAPI/HomeAutomation/API.ash  | Yes\t\t | Host name of the Hayward API server \t\t |\n+| User Name       \t\t| None    \t\t\t\t\t\t\t\t\t\t\t\t\t  | Yes\t\t | Your Hayward User Name (not email address)|\n+| Password \t\t\t\t| None\t\t\t\t\t\t\t\t\t\t\t\t\t      | Yes\t\t | Your Hayward User Password\t\t\t\t |\n+| Telemetry Poll Delay  | 12    \t\t\t\t\t\t\t\t\t\t\t\t\t  | Yes\t\t | Telemetry Poll Delay (seconds)\t\t\t |\n+| Alarm Poll Delay    \t| 60    \t\t\t\t\t\t\t\t\t\t\t\t\t  | Yes\t\t | Alarm Poll Delay (seconds)\t\t\t\t |\n+| Command Poll Delay\t| 12    \t\t\t\t\t\t\t\t\t\t\t\t\t  | Yes\t\t | Command Poll Delay (seconds)\t\t\t\t |\n+\n+## Channels\n+\n+### Backyard Channels\n+\n+| Channel Type ID       \t\t| Item Type \t\t\t| Description                                                   | Read Write |\n+|-------------------------------|-----------------------|---------------------------------------------------------------|:----------:|\n+| backyardAirTemp       \t\t| Number:Temperature\t| Backyard air temp sensor reading\t\t\t\t\t\t\t\t|      R     |\n+| backyardStatus       \t\t\t| String    \t\t\t| Backyard status\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| backyardState \t\t\t\t| String\t\t\t\t| Backyard state\t\t\t\t\t\t\t\t                |      R     |\n+| backyardAlarm1        \t\t| String    \t\t\t| Backyard alarm #1\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| backyardAlarm2    \t\t\t| String    \t\t\t| Backyard alarm #2\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| backyardAlarm3     \t\t\t| String    \t\t\t| Backyard alarm #3\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| backyardAlarm4        \t\t| String    \t\t\t| Backyard alarm #4\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| backyardAlarm5        \t\t| String    \t\t\t| Backyard alarm #5\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+\n+\n+### Body of Water Channels\n+\n+| Channel Type ID       \t\t| Item Type \t\t\t| Description                                                   | Read Write |\n+|-------------------------------|-----------------------|---------------------------------------------------------------|:----------:|\n+| bowFlow       \t\t\t\t| Number    \t\t\t| Body of Water flow sensor feedback\t\t\t\t\t\t    |      R     |\n+| bowWaterTemp       \t\t\t| Number:Temperature    | Body of Water temperature  \t\t\t\t\t\t\t\t    |      R     |\n+\n+\n+### Chlorinator Channels\n+\n+| Channel Type ID       \t\t| Item Type \t\t\t| Description                                                   | Read Write |\n+|-------------------------------|-----------\t\t\t|---------------------------------------------------------------|:----------:|\n+| chlorEnable       \t\t\t| Switch    \t\t\t| Chlorinator enable\t\t\t\t\t\t\t\t\t\t\t|     R/W    |\n+| chlorOperatingMode    \t\t| String     \t\t\t| Chlorinator operating mode\t\t\t\t\t\t\t\t\t|      R     |\n+| chlorTimedPercent \t\t\t| Number:Dimensionless\t| Chlorinator timed percent\t\t\t\t\t                    |     R/W    |\n+| chlorOperatingState   \t\t| Number    \t\t\t| Chlorinator operating state\t\t\t\t\t\t\t\t\t|      R     |\n+ chlorScMode    \t\t\t\t| String    \t\t\t| Chlorinator mode\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| chlorError     \t\t\t\t| Number    \t\t\t| Chlorinator error\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| chlorAlert        \t\t\t| String    \t\t\t| Chlorinator alert\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| chlorAvgSaltLevel     \t\t| Number:Dimensionless  | Chlorinator average salt level in Part per Million (ppm)\t\t|      R     |\n+| chlorInstantSaltLevel \t\t| Number:Dimensionless  | Chlorinator instant salt level in Part per Million (ppm)    \t|      R     |\n+| chlorStatus     \t\t\t\t| Number    \t\t\t| Chlorinator K1/K2 relay status      \t\t\t\t\t\t\t|      R     |\n+\n+### Colorlogic Light Channels\n+\n+| Channel Type ID       \t\t| Item Type | Description                                                               | Read Write |\n+|-------------------------------|-----------|---------------------------------------------------------------------------|:----------:|\n+| colorLogicLightEnable       \t| Switch    | Colorlogic Light enable\t\t\t\t\t\t\t\t\t\t\t\t\t|     R/W    |\n+| colorLogicLightState    \t\t| Number    | Colorlogic Light state\t\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| colorLogicLightCurrentShow \t| Number\t| Colorlogic Light current show\t\t\t\t\t                            |     R/W    |\n+\n+### Filter Channels\n+\n+| Channel Type ID       \t\t| Item Type | Description                                                               | Read Write |\n+|-------------------------------|-----------|---------------------------------------------------------------------------|:----------:|\n+| filterEnable\t    \t\t\t| Switch    | Filter enable\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|     R/W    |\n+| filterValvePosition    \t\t| Number    | Filter valve position\t\t\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| filterSpeed \t\t\t\t\t| Dimmer\t| Filter speed\t\t\t\t\t\t\t\t                                |     R/W    |\n+| filterState   \t\t\t\t| Number    | Filter state\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| filterLastSpeed       \t\t| Number    | Filter last speed\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+\n+### Heater Channels\n+\n+| Channel Type ID               | Item Type \t\t\t| Description                                                   | Read Write |\n+|-------------------------------|-----------------------|---------------------------------------------------------------|:----------:|\n+| heaterState                   | Number    \t\t\t| Heater state                                                  |      R     |\n+| heaterTemp                    | Number:Temperature\t| Heater temperature                                            |      R     |\n+| heaterEnable                  | Number    \t\t\t| Heater enable                                                 |      R     |\n+| heaterPriority                | Number    \t\t\t| Heater priority                                               |      R     |\n+| heaterMaintainFor             | Number    \t\t\t| Heater maintain for                                           |      R     |\n+\n+### Pump Channels\n+\n+| Channel Type ID               | Item Type | Description                                                               | Read Write |\n+|-------------------------------|-----------|---------------------------------------------------------------------------|:----------:|\n+| pumpEnable                    | Switch    | Pump enable                                                               |      R     |\n+| pumpSpeed                     | Dimmer    | Pump speed                                                                |      R     |\n+\n+### Relay Channels\n+\n+| Channel Type ID       \t\t| Item Type | Description                                                               | Read Write |\n+|-------------------------------|-----------|---------------------------------------------------------------------------|:----------:|\n+| relayState\t    \t\t\t| Switch    | Relay state\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|     R/W    |\n+\n+### Virtual Heater Channels\n+\n+| Channel Type ID               | Item Type | Description                                                               | Read Write |\n+|-------------------------------|-----------|---------------------------------------------------------------------------|:----------:|\n+| heaterState                   | Number    | Heater state                                                              |      R     |\n+| heaterEnable                  | Number    | Heater enable                                                             |      R     |\n+\n+\n+## Full Example\n+\n+After installing the binding, you will need to manually add the Hayward Connection thing and enter your credentials.\n+All pool items will then be automatically discovered.\n+Goto the inbox and add the things.\n+\n+### demo.items:\n+\n+```\n+Number:Temperature   PoolBackyardAirTemp \"Air Temp [%1.0f \u00b0F]\"                  { channel = \"haywardomnilogic:backyard:2ee76053:35940:backyardAirTemp\"}\n+String   PoolBackyardStatus \"Status [%s]\"                                       { channel = \"haywardomnilogic:backyard:2ee76053:35940:backyardStatus\"}\n+String   PoolBackyardState \"State [%s]\"                                         { channel = \"haywardomnilogic:backyard:2ee76053:35940:backyardState\"}\n+String   PoolBackyardAlarm1 \"Alarm #1 [%s]\"                                     { channel = \"haywardomnilogic:backyard:2ee76053:35940:backyardAlarm1\"}\n+String   PoolBackyardAlarm2 \"Alarm #2 [%s]\"                                     { channel = \"haywardomnilogic:backyard:2ee76053:35940:backyardAlarm2\"}\n+String   PoolBackyardAlarm3 \"Alarm #3 [%s]\"                                     { channel = \"haywardomnilogic:backyard:2ee76053:35940:backyardAlarm3\"}\n+String   PoolBackyardAlarm4 \"Alarm #4 [%s]\"                                     { channel = \"haywardomnilogic:backyard:2ee76053:35940:backyardAlarm4\"}\n+String   PoolBackyardAlarm5 \"Alarm #5 [%s]\"                                     { channel = \"haywardomnilogic:backyard:2ee76053:35940:backyardAlarm5\"}\n+  \n+Number   PoolBOWFlow \"Flow Switch\"                      \t\t\t\t\t\t{ channel = \"haywardomnilogic:bow:2ee76053:30:bowFlow\"}\n+Number:Temperature   PoolBOWWaterTemp \"Water Temp [%1.0f \u00b0F]\"                   { channel = \"haywardomnilogic:bow:2ee76053:30:bowWaterTemp\"}\n+ \n+Switch   PoolChlorEnable \"Enable\"                                               { channel = \"haywardomnilogic:chlorinator:2ee76053:34:chlorEnable\"}\n+String   PoolChlorOperatingMode \"Operating Mode [%s]\"                           { channel = \"haywardomnilogic:chlorinator:2ee76053:34:chlorOperatingMode\"}\n+Number   PoolChlorSaltOutput \"Salt Output [%1.0f %%]\"           \t\t\t\t{ channel = \"haywardomnilogic:chlorinator:2ee76053:34:chlorTimedPercent\"}\n+String   PoolChlorOperatingState \"Operating State [%s]\"                         { channel = \"haywardomnilogic:chlorinator:2ee76053:34:chlorOperatingState\"}\n+String   PoolChlorScMode \"SC Mode [%s]\"                                         { channel = \"haywardomnilogic:chlorinator:2ee76053:34:chlorScMode\"}\n+Number   PoolChlorError \"Error [%s]\"                                            { channel = \"haywardomnilogic:chlorinator:2ee76053:34:chlorError\"}\n+String   PoolChlorAlert \"Alert\"             \t\t\t\t\t\t\t\t\t{ channel = \"haywardomnilogic:chlorinator:2ee76053:34:chlorAlert\"}\n+Number   PoolChlorAverageSalt \"Average Salt[%1.0f ppm]\"                         { channel = \"haywardomnilogic:chlorinator:2ee76053:34:chlorAvgSaltLevel\"}\n+Number   PoolChlorInstantSalt \"Instant Salt [%1.0f ppm]\"                        { channel = \"haywardomnilogic:chlorinator:2ee76053:34:chlorInstantSaltLevel\"}\n+Number   PoolChlorStatus \"K1/K2 Relay Status\"                                   { channel = \"haywardomnilogic:chlorinator:2ee76053:34:chlorStatus\"}\n+\n+Number   PoolHeaterState \"State [%s]\"                                           { channel = \"haywardomnilogic:heater:2ee76053:33:heaterState\"}\n+Number   PoolHeaterEnable \"Power [%s]\"                                          { channel = \"haywardomnilogic:heater:2ee76053:33:heaterEnable\"}\n+\n+Switch   PoolLightEnable \"Enable\"                                               { channel = \"haywardomnilogic:colorlogic:2ee76053:38:colorLogicLightEnable\"}\n+String   PoolLightState \"State\"                   \t\t\t\t\t\t\t\t{ channel = \"haywardomnilogic:colorlogic:2ee76053:38:colorLogicLightState\"}\n+String   PoolLightCurrentShow \"Show\"                                            { channel = \"haywardomnilogic:colorlogic:2ee76053:38:colorLogicLightCurrentShow\"}\n+\n+Switch   PoolFilterEnable \"Power\"                                               { channel = \"haywardomnilogic:filter:2ee76053:31:filterPowerSwitch\"}\n+Number   PoolFilterValve \"Valve Position [%s]\"                                  { channel = \"haywardomnilogic:filter:2ee76053:31:filterValvePosition\"}\n+Number   PoolFilterSpeed \"Speed[%1.0f %%]\"                                      { channel = \"haywardomnilogic:filter:2ee76053:31:filterSpeed\"}\n+Number   PoolFilterState \"State\"                 \t\t\t\t\t\t\t\t{ channel = \"haywardomnilogic:filter:2ee76053:31:filterState\"}\n+Number   PoolFilterLastSpeed \"Speed[%1.0f %%]\"                                  { channel = \"haywardomnilogic:filter:2ee76053:31:filterLastSpeed\"}\n+\n+Switch   PoolVirtualHeaterEnable \"Power\"                                        { channel = \"haywardomnilogic:virtualHeater:2ee76053:32:virtualHeaterEnable\"}\n+Number:Temperature   PoolVirtualHeaterTemp \"Temp [%1.0f \u00b0F]\"                    { channel = \"haywardomnilogic:virtualHeater:2ee76053:32:virtualHeaterCurrentSetpoint\"}\n+  \n+Switch   PoolRelay1 \"Deck Jets\"                                                 { channel = \"haywardomnilogic:relay:2ee76053:37:relayState\"}\n+Switch   PoolRelay2 \"Vacuum\"                                                    { channel = \"haywardomnilogic:relay:2ee76053:36:relayState\"}\n+```\n+\n+\n+### demo.sitemap:\n+\n+```", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c92ed95362793a7782521d1c7c83333b583ad36"}, "originalPosition": 185}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTM0MjUyNw==", "bodyText": "```text\nMarkdown linting would want a language.\nMostly text is fine, since we are changing that anyway during website builds.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r555342527", "createdAt": "2021-01-11T21:11:53Z", "author": {"login": "Confectrician"}, "path": "bundles/org.openhab.binding.haywardomnilogic/README.md", "diffHunk": "@@ -0,0 +1,255 @@\n+# Hayward Omnilogic Binding\n+\n+The Hayward Omnilogic binding integrates the Omnilogic pool controller using the Hayward API.\n+\n+The Hayward Omnilogic API interacts with Hayward's cloud server requiring a connection with the Internet for sending and receiving information.\n+\n+## Supported Things\n+\n+The table below lists the Hayward OmniLogic binding thing types:\n+\n+| Things                                  | Description                                                                     | Thing Type     |\n+|-----------------------------------------|---------------------------------------------------------------------------------|----------------|\n+| Hayward OmniLogix Connection            | Connection to Hayward's Server                                                  | bridge         |\n+| Backyard                                | Backyard                                                                        | backyard       |\n+| Body of Water                           | Body of Water                                                                   | bow            |\n+| Chlorinator                             | Chlorinator\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t| chlorinator    |\n+| Colorlogic Light                        | Colorlogic Light                                                                | colorlogic     |\n+| Chlorine Sense and Dispense             | CSAD/ORP Control (under development)                                            | csad           |\n+| Filter                                  | Filter control                                                                  | filter         |\n+| Heater Equipment                        | Actual heater (i.e. gas, solar, electric)                                       | heater         |\n+| Pump                                    | Auxillary pump control (i.e. spillover)                                         | pump           |\n+| Relay                                   | Accessory relay control (deck jet sprinklers, lights, etc.)                     | relay          |\n+| Virtaul Heater                          | A Virtual Heater that can control all of the heater equipment based on priority | virtualHeater  |\n+\n+## Discovery\n+\n+The binding will automatically discover the Omnilogic pool things from the cloud server using your Hayward Omnilogic credentials.\n+\n+## Thing Configuration\n+\n+Hayward OmniLogic Connection Parameters:\n+\n+| Property\t\t\t    | Default\t\t\t\t\t\t\t\t\t\t\t\t      | Required | Description \t\t\t\t\t\t\t\t |\n+|-----------------------|-------------------------------------------------------------|----------|-------------------------------------------|\n+| Host Name      \t\t| https://app1.haywardomnilogic.com/HAAPI/HomeAutomation/API.ash  | Yes\t\t | Host name of the Hayward API server \t\t |\n+| User Name       \t\t| None    \t\t\t\t\t\t\t\t\t\t\t\t\t  | Yes\t\t | Your Hayward User Name (not email address)|\n+| Password \t\t\t\t| None\t\t\t\t\t\t\t\t\t\t\t\t\t      | Yes\t\t | Your Hayward User Password\t\t\t\t |\n+| Telemetry Poll Delay  | 12    \t\t\t\t\t\t\t\t\t\t\t\t\t  | Yes\t\t | Telemetry Poll Delay (seconds)\t\t\t |\n+| Alarm Poll Delay    \t| 60    \t\t\t\t\t\t\t\t\t\t\t\t\t  | Yes\t\t | Alarm Poll Delay (seconds)\t\t\t\t |\n+| Command Poll Delay\t| 12    \t\t\t\t\t\t\t\t\t\t\t\t\t  | Yes\t\t | Command Poll Delay (seconds)\t\t\t\t |\n+\n+## Channels\n+\n+### Backyard Channels\n+\n+| Channel Type ID       \t\t| Item Type \t\t\t| Description                                                   | Read Write |\n+|-------------------------------|-----------------------|---------------------------------------------------------------|:----------:|\n+| backyardAirTemp       \t\t| Number:Temperature\t| Backyard air temp sensor reading\t\t\t\t\t\t\t\t|      R     |\n+| backyardStatus       \t\t\t| String    \t\t\t| Backyard status\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| backyardState \t\t\t\t| String\t\t\t\t| Backyard state\t\t\t\t\t\t\t\t                |      R     |\n+| backyardAlarm1        \t\t| String    \t\t\t| Backyard alarm #1\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| backyardAlarm2    \t\t\t| String    \t\t\t| Backyard alarm #2\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| backyardAlarm3     \t\t\t| String    \t\t\t| Backyard alarm #3\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| backyardAlarm4        \t\t| String    \t\t\t| Backyard alarm #4\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| backyardAlarm5        \t\t| String    \t\t\t| Backyard alarm #5\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+\n+\n+### Body of Water Channels\n+\n+| Channel Type ID       \t\t| Item Type \t\t\t| Description                                                   | Read Write |\n+|-------------------------------|-----------------------|---------------------------------------------------------------|:----------:|\n+| bowFlow       \t\t\t\t| Number    \t\t\t| Body of Water flow sensor feedback\t\t\t\t\t\t    |      R     |\n+| bowWaterTemp       \t\t\t| Number:Temperature    | Body of Water temperature  \t\t\t\t\t\t\t\t    |      R     |\n+\n+\n+### Chlorinator Channels\n+\n+| Channel Type ID       \t\t| Item Type \t\t\t| Description                                                   | Read Write |\n+|-------------------------------|-----------\t\t\t|---------------------------------------------------------------|:----------:|\n+| chlorEnable       \t\t\t| Switch    \t\t\t| Chlorinator enable\t\t\t\t\t\t\t\t\t\t\t|     R/W    |\n+| chlorOperatingMode    \t\t| String     \t\t\t| Chlorinator operating mode\t\t\t\t\t\t\t\t\t|      R     |\n+| chlorTimedPercent \t\t\t| Number:Dimensionless\t| Chlorinator timed percent\t\t\t\t\t                    |     R/W    |\n+| chlorOperatingState   \t\t| Number    \t\t\t| Chlorinator operating state\t\t\t\t\t\t\t\t\t|      R     |\n+ chlorScMode    \t\t\t\t| String    \t\t\t| Chlorinator mode\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| chlorError     \t\t\t\t| Number    \t\t\t| Chlorinator error\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| chlorAlert        \t\t\t| String    \t\t\t| Chlorinator alert\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| chlorAvgSaltLevel     \t\t| Number:Dimensionless  | Chlorinator average salt level in Part per Million (ppm)\t\t|      R     |\n+| chlorInstantSaltLevel \t\t| Number:Dimensionless  | Chlorinator instant salt level in Part per Million (ppm)    \t|      R     |\n+| chlorStatus     \t\t\t\t| Number    \t\t\t| Chlorinator K1/K2 relay status      \t\t\t\t\t\t\t|      R     |\n+\n+### Colorlogic Light Channels\n+\n+| Channel Type ID       \t\t| Item Type | Description                                                               | Read Write |\n+|-------------------------------|-----------|---------------------------------------------------------------------------|:----------:|\n+| colorLogicLightEnable       \t| Switch    | Colorlogic Light enable\t\t\t\t\t\t\t\t\t\t\t\t\t|     R/W    |\n+| colorLogicLightState    \t\t| Number    | Colorlogic Light state\t\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| colorLogicLightCurrentShow \t| Number\t| Colorlogic Light current show\t\t\t\t\t                            |     R/W    |\n+\n+### Filter Channels\n+\n+| Channel Type ID       \t\t| Item Type | Description                                                               | Read Write |\n+|-------------------------------|-----------|---------------------------------------------------------------------------|:----------:|\n+| filterEnable\t    \t\t\t| Switch    | Filter enable\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|     R/W    |\n+| filterValvePosition    \t\t| Number    | Filter valve position\t\t\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| filterSpeed \t\t\t\t\t| Dimmer\t| Filter speed\t\t\t\t\t\t\t\t                                |     R/W    |\n+| filterState   \t\t\t\t| Number    | Filter state\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+| filterLastSpeed       \t\t| Number    | Filter last speed\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|      R     |\n+\n+### Heater Channels\n+\n+| Channel Type ID               | Item Type \t\t\t| Description                                                   | Read Write |\n+|-------------------------------|-----------------------|---------------------------------------------------------------|:----------:|\n+| heaterState                   | Number    \t\t\t| Heater state                                                  |      R     |\n+| heaterTemp                    | Number:Temperature\t| Heater temperature                                            |      R     |\n+| heaterEnable                  | Number    \t\t\t| Heater enable                                                 |      R     |\n+| heaterPriority                | Number    \t\t\t| Heater priority                                               |      R     |\n+| heaterMaintainFor             | Number    \t\t\t| Heater maintain for                                           |      R     |\n+\n+### Pump Channels\n+\n+| Channel Type ID               | Item Type | Description                                                               | Read Write |\n+|-------------------------------|-----------|---------------------------------------------------------------------------|:----------:|\n+| pumpEnable                    | Switch    | Pump enable                                                               |      R     |\n+| pumpSpeed                     | Dimmer    | Pump speed                                                                |      R     |\n+\n+### Relay Channels\n+\n+| Channel Type ID       \t\t| Item Type | Description                                                               | Read Write |\n+|-------------------------------|-----------|---------------------------------------------------------------------------|:----------:|\n+| relayState\t    \t\t\t| Switch    | Relay state\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|     R/W    |\n+\n+### Virtual Heater Channels\n+\n+| Channel Type ID               | Item Type | Description                                                               | Read Write |\n+|-------------------------------|-----------|---------------------------------------------------------------------------|:----------:|\n+| heaterState                   | Number    | Heater state                                                              |      R     |\n+| heaterEnable                  | Number    | Heater enable                                                             |      R     |\n+\n+\n+## Full Example\n+\n+After installing the binding, you will need to manually add the Hayward Connection thing and enter your credentials.\n+All pool items will then be automatically discovered.\n+Goto the inbox and add the things.\n+\n+### demo.items:\n+\n+```", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c92ed95362793a7782521d1c7c83333b583ad36"}, "originalPosition": 138}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY3NDM4NTQz", "url": "https://github.com/openhab/openhab-addons/pull/8685#pullrequestreview-567438543", "createdAt": "2021-01-13T17:06:37Z", "commit": {"oid": "b20b1e5ee2c03923b779602511e4fd1df354c11f"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTcwMDk3MjM4", "url": "https://github.com/openhab/openhab-addons/pull/8685#pullrequestreview-570097238", "createdAt": "2021-01-17T21:44:50Z", "commit": {"oid": "ad68cd938c3737c40854faf9111c4dec6cf34376"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xN1QyMTo0NDo1MFrOIVVeUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xN1QyMjowMDowN1rOIVVlqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTI0MjgzMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        case \"Switch\":\n          \n          \n            \n                            return Integer.parseInt(value) > 0 ? OnOffType.ON : OnOffType.OFF;\n          \n          \n            \n                        case \"system.power\":\n          \n          \n            \n                            return Integer.parseInt(value) > 0 ? OnOffType.ON : OnOffType.OFF;\n          \n          \n            \n                        case \"Switch\":\n          \n          \n            \n                        case \"system.power\":\n          \n          \n            \n                            return Integer.parseInt(value) > 0 ? OnOffType.ON : OnOffType.OFF;", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r559242832", "createdAt": "2021-01-17T21:44:50Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/HaywardThingHandler.java", "diffHunk": "@@ -0,0 +1,122 @@\n+/**\n+ * Copyright (c) 2010-2021 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+\n+package org.openhab.binding.haywardomnilogic.internal;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.library.types.DecimalType;\n+import org.openhab.core.library.types.OnOffType;\n+import org.openhab.core.library.types.QuantityType;\n+import org.openhab.core.library.types.StringType;\n+import org.openhab.core.library.unit.ImperialUnits;\n+import org.openhab.core.library.unit.SIUnits;\n+import org.openhab.core.library.unit.Units;\n+import org.openhab.core.thing.Bridge;\n+import org.openhab.core.thing.Channel;\n+import org.openhab.core.thing.ChannelUID;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.ThingStatus;\n+import org.openhab.core.thing.binding.BaseThingHandler;\n+import org.openhab.core.types.Command;\n+import org.openhab.core.types.State;\n+\n+/**\n+ * The {@link HaywarThingHandler} is a subclass of the BaseThingHandler and a Super\n+ * Class to each Hayward Thing Handler\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+@NonNullByDefault\n+public abstract class HaywardThingHandler extends BaseThingHandler {\n+\n+    public HaywardThingHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        updateStatus(ThingStatus.ONLINE);\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+    }\n+\n+    public abstract void getTelemetry(String xmlResponse) throws HaywardException;\n+\n+    public State toState(String type, String channelID, String value) throws NumberFormatException {\n+        switch (type) {\n+            case \"Number\":\n+                return new DecimalType(value);\n+            case \"Switch\":\n+                return Integer.parseInt(value) > 0 ? OnOffType.ON : OnOffType.OFF;\n+            case \"system.power\":\n+                return Integer.parseInt(value) > 0 ? OnOffType.ON : OnOffType.OFF;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad68cd938c3737c40854faf9111c4dec6cf34376"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTI0Mjg3OQ==", "bodyText": "Is this fall-through intentional?", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r559242879", "createdAt": "2021-01-17T21:45:18Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/HaywardThingHandler.java", "diffHunk": "@@ -0,0 +1,122 @@\n+/**\n+ * Copyright (c) 2010-2021 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+\n+package org.openhab.binding.haywardomnilogic.internal;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.library.types.DecimalType;\n+import org.openhab.core.library.types.OnOffType;\n+import org.openhab.core.library.types.QuantityType;\n+import org.openhab.core.library.types.StringType;\n+import org.openhab.core.library.unit.ImperialUnits;\n+import org.openhab.core.library.unit.SIUnits;\n+import org.openhab.core.library.unit.Units;\n+import org.openhab.core.thing.Bridge;\n+import org.openhab.core.thing.Channel;\n+import org.openhab.core.thing.ChannelUID;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.ThingStatus;\n+import org.openhab.core.thing.binding.BaseThingHandler;\n+import org.openhab.core.types.Command;\n+import org.openhab.core.types.State;\n+\n+/**\n+ * The {@link HaywarThingHandler} is a subclass of the BaseThingHandler and a Super\n+ * Class to each Hayward Thing Handler\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+@NonNullByDefault\n+public abstract class HaywardThingHandler extends BaseThingHandler {\n+\n+    public HaywardThingHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        updateStatus(ThingStatus.ONLINE);\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+    }\n+\n+    public abstract void getTelemetry(String xmlResponse) throws HaywardException;\n+\n+    public State toState(String type, String channelID, String value) throws NumberFormatException {\n+        switch (type) {\n+            case \"Number\":\n+                return new DecimalType(value);\n+            case \"Switch\":\n+                return Integer.parseInt(value) > 0 ? OnOffType.ON : OnOffType.OFF;\n+            case \"system.power\":\n+                return Integer.parseInt(value) > 0 ? OnOffType.ON : OnOffType.OFF;\n+            case \"Number:Dimensionless\":\n+                switch (channelID) {\n+                    case \"chlorTimedPercent\":\n+                    case \"filterSpeed\":\n+                    case \"pumpSpeed\":\n+                    case \"filterLastSpeed\":\n+                        return new QuantityType<>(Integer.parseInt(value), Units.PERCENT);\n+                    case \"chlorAvgSaltLevel\":\n+                    case \"chlorInstantSaltLevel\":\n+                        return new QuantityType<>(Integer.parseInt(value), Units.PARTS_PER_MILLION);\n+                }\n+            case \"Number:Temperature\":", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad68cd938c3737c40854faf9111c4dec6cf34376"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTI0MzY5MQ==", "bodyText": "This should be initialized during initialize() since the config may not be available at the time the handler is constructor.\nBut more importantly, the prop field don't seem to be needed since you can always pull the data from getThing().getProperties() as needed. There is no reason to cache it.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r559243691", "createdAt": "2021-01-17T21:51:16Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/handler/HaywardRelayHandler.java", "diffHunk": "@@ -0,0 +1,134 @@\n+/**\n+ * Copyright (c) 2010-2021 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.handler;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingHandler;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingProperties;\n+import org.openhab.core.thing.Bridge;\n+import org.openhab.core.thing.ChannelUID;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.ThingStatus;\n+import org.openhab.core.thing.ThingStatusDetail;\n+import org.openhab.core.types.Command;\n+import org.openhab.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The Relay Handler\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+@NonNullByDefault\n+public class HaywardRelayHandler extends HaywardThingHandler {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardRelayHandler.class);\n+\n+    HaywardThingProperties prop = getConfig().as(HaywardThingProperties.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad68cd938c3737c40854faf9111c4dec6cf34376"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTI0Mzc0Mw==", "bodyText": "see earlier comment.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r559243743", "createdAt": "2021-01-17T21:51:58Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/handler/HaywardFilterHandler.java", "diffHunk": "@@ -0,0 +1,169 @@\n+/**\n+ * Copyright (c) 2010-2021 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.handler;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingHandler;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingProperties;\n+import org.openhab.core.library.types.OnOffType;\n+import org.openhab.core.thing.Bridge;\n+import org.openhab.core.thing.ChannelUID;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.ThingStatus;\n+import org.openhab.core.thing.ThingStatusDetail;\n+import org.openhab.core.types.Command;\n+import org.openhab.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The Filter Handler\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+@NonNullByDefault\n+public class HaywardFilterHandler extends HaywardThingHandler {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardFilterHandler.class);\n+\n+    HaywardThingProperties prop = getConfig().as(HaywardThingProperties.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad68cd938c3737c40854faf9111c4dec6cf34376"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTI0Mzc4Mw==", "bodyText": "Please fix this wherever else it occurs.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r559243783", "createdAt": "2021-01-17T21:52:14Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/handler/HaywardColorLogicHandler.java", "diffHunk": "@@ -0,0 +1,165 @@\n+/**\n+ * Copyright (c) 2010-2021 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.handler;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingHandler;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingProperties;\n+import org.openhab.core.library.types.OnOffType;\n+import org.openhab.core.thing.Bridge;\n+import org.openhab.core.thing.ChannelUID;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.ThingStatus;\n+import org.openhab.core.thing.ThingStatusDetail;\n+import org.openhab.core.types.Command;\n+import org.openhab.core.types.RefreshType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The ColorLogic Handler\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+@NonNullByDefault\n+public class HaywardColorLogicHandler extends HaywardThingHandler {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardColorLogicHandler.class);\n+\n+    HaywardThingProperties prop = getConfig().as(HaywardThingProperties.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad68cd938c3737c40854faf9111c4dec6cf34376"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTI0NDM4Mg==", "bodyText": "You should also include the exception message with the offline status so that users have better idea as to what went wrong.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r559244382", "createdAt": "2021-01-17T21:57:28Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/handler/HaywardBridgeHandler.java", "diffHunk": "@@ -0,0 +1,475 @@\n+/**\n+ * Copyright (c) 2010-2021 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.handler;\n+\n+import java.io.StringReader;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import javax.xml.xpath.XPath;\n+import javax.xml.xpath.XPathConstants;\n+import javax.xml.xpath.XPathExpressionException;\n+import javax.xml.xpath.XPathFactory;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.util.StringContentProvider;\n+import org.eclipse.jetty.http.HttpHeader;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.http.HttpVersion;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardAccount;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardThingHandler;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.config.HaywardConfig;\n+import org.openhab.binding.haywardomnilogic.internal.discovery.HaywardDiscoveryService;\n+import org.openhab.core.library.types.OnOffType;\n+import org.openhab.core.thing.Bridge;\n+import org.openhab.core.thing.ChannelUID;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.ThingStatus;\n+import org.openhab.core.thing.ThingStatusDetail;\n+import org.openhab.core.thing.binding.BaseBridgeHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.openhab.core.types.Command;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.w3c.dom.NodeList;\n+import org.xml.sax.InputSource;\n+\n+/**\n+ * The {@link HaywardBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+@NonNullByDefault\n+public class HaywardBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardBridgeHandler.class);\n+    private final HttpClient httpClient;\n+    private @Nullable ScheduledFuture<?> initializeFuture;\n+    private @Nullable ScheduledFuture<?> pollTelemetryFuture;\n+    private @Nullable ScheduledFuture<?> pollAlarmsFuture;\n+    private int commFailureCount;\n+    public HaywardConfig config = getConfig().as(HaywardConfig.class);\n+    public HaywardAccount account = getConfig().as(HaywardAccount.class);\n+\n+    @Override\n+    public Collection<Class<? extends ThingHandlerService>> getServices() {\n+        return Collections.singleton(HaywardDiscoveryService.class);\n+    }\n+\n+    public HaywardBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        clearPolling(initializeFuture);\n+        clearPolling(pollTelemetryFuture);\n+        clearPolling(pollAlarmsFuture);\n+        logger.trace(\"Hayward polling cancelled\");\n+        super.dispose();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        updateStatus(ThingStatus.UNKNOWN);\n+        initializeFuture = scheduler.schedule(this::scheduledInitialize, 1, TimeUnit.SECONDS);\n+        return;\n+    }\n+\n+    public void scheduledInitialize() {\n+        config = getConfigAs(HaywardConfig.class);\n+\n+        try {\n+            clearPolling(pollTelemetryFuture);\n+            clearPolling(pollAlarmsFuture);\n+\n+            if (!(login())) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"Unable to Login to Hayward's server\");\n+                clearPolling(pollTelemetryFuture);\n+                clearPolling(pollAlarmsFuture);\n+                commFailureCount = 50;\n+                initPolling(60);\n+                return;\n+            }\n+\n+            if (!(getSiteList())) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"Unable to getMSP from Hayward's server\");\n+                clearPolling(pollTelemetryFuture);\n+                clearPolling(pollAlarmsFuture);\n+                commFailureCount = 50;\n+                initPolling(60);\n+                return;\n+            }\n+\n+            if (!(mspConfigUnits())) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"Unable to getMSPConfigUnits from Hayward's server\");\n+                clearPolling(pollTelemetryFuture);\n+                clearPolling(pollAlarmsFuture);\n+                commFailureCount = 50;\n+                initPolling(60);\n+                return;\n+            }\n+\n+            updateStatus(ThingStatus.ONLINE);\n+            logger.debug(\"Succesfully opened connection to Hayward's server: {} Username:{}\", config.endpointUrl,\n+                    config.username);\n+\n+            initPolling(0);\n+            logger.trace(\"Hayward Telemetry polling scheduled\");\n+\n+            if (config.alarmPollTime > 0) {\n+                initAlarmPolling(1);\n+            }\n+        } catch (HaywardException e) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.HANDLER_INITIALIZING_ERROR,\n+                    \"scheduledInitialize exception: \" + e.getMessage());\n+            clearPolling(pollTelemetryFuture);\n+            clearPolling(pollAlarmsFuture);\n+            commFailureCount = 50;\n+            initPolling(60);\n+            return;\n+        } catch (InterruptedException e) {\n+            return;\n+        }\n+    }\n+\n+    public synchronized boolean login() throws HaywardException, InterruptedException {\n+        String xmlResponse;\n+        String status;\n+\n+        // *****Login to Hayward server\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request>\" + \"<Name>Login</Name><Parameters>\"\n+                + \"<Parameter name=\\\"UserName\\\" dataType=\\\"String\\\">\" + config.username + \"</Parameter>\"\n+                + \"<Parameter name=\\\"Password\\\" dataType=\\\"String\\\">\" + config.password + \"</Parameter>\"\n+                + \"</Parameters></Request>\";\n+\n+        xmlResponse = httpXmlResponse(urlParameters);\n+\n+        if (xmlResponse.isEmpty()) {\n+            return false;\n+        }\n+\n+        status = evaluateXPath(\"/Response/Parameters//Parameter[@name='Status']/text()\", xmlResponse).get(0);\n+\n+        if (!(status.equals(\"0\"))) {\n+            logger.debug(\"Hayward Connection thing: Login XML response: {}\", xmlResponse);\n+            return false;\n+        }\n+\n+        account.token = evaluateXPath(\"/Response/Parameters//Parameter[@name='Token']/text()\", xmlResponse).get(0);\n+        account.userID = evaluateXPath(\"/Response/Parameters//Parameter[@name='UserID']/text()\", xmlResponse).get(0);\n+        return true;\n+    }\n+\n+    public synchronized boolean getApiDef() throws HaywardException, InterruptedException {\n+        String xmlResponse;\n+\n+        // *****getConfig from Hayward server\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request><Name>GetAPIDef</Name><Parameters>\"\n+                + \"<Parameter name=\\\"Token\\\" dataType=\\\"String\\\">\" + account.token + \"</Parameter>\"\n+                + \"<Parameter name=\\\"MspSystemID\\\" dataType=\\\"int\\\">\" + account.mspSystemID + \"</Parameter>;\"\n+                + \"<Parameter name=\\\"Version\\\" dataType=\\\"string\\\">0.4</Parameter >\\r\\n\"\n+                + \"<Parameter name=\\\"Language\\\" dataType=\\\"string\\\">en</Parameter >\\r\\n\" + \"</Parameters></Request>\";\n+\n+        xmlResponse = httpXmlResponse(urlParameters);\n+\n+        if (xmlResponse.isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: Login XML response was null\");\n+            return false;\n+        }\n+        return true;\n+    }\n+\n+    public synchronized boolean getSiteList() throws HaywardException, InterruptedException {\n+        String xmlResponse;\n+        String status;\n+\n+        // *****Get MSP\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request><Name>GetSiteList</Name><Parameters>\"\n+                + \"<Parameter name=\\\"Token\\\" dataType=\\\"String\\\">\" + account.token\n+                + \"</Parameter><Parameter name=\\\"UserID\\\" dataType=\\\"String\\\">\" + account.userID\n+                + \"</Parameter></Parameters></Request>\";\n+\n+        xmlResponse = httpXmlResponse(urlParameters);\n+\n+        if (xmlResponse.isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: getSiteList XML response was null\");\n+            return false;\n+        }\n+\n+        status = evaluateXPath(\"/Response/Parameters//Parameter[@name='Status']/text()\", xmlResponse).get(0);\n+\n+        if (!(status.equals(\"0\"))) {\n+            logger.debug(\"Hayward Connection thing: getSiteList XML response: {}\", xmlResponse);\n+            return false;\n+        }\n+\n+        account.mspSystemID = evaluateXPath(\"/Response/Parameters/Parameter/Item//Property[@name='MspSystemID']/text()\",\n+                xmlResponse).get(0);\n+        account.backyardName = evaluateXPath(\n+                \"/Response/Parameters/Parameter/Item//Property[@name='BackyardName']/text()\", xmlResponse).get(0);\n+        account.address = evaluateXPath(\"/Response/Parameters/Parameter/Item//Property[@name='Address']/text()\",\n+                xmlResponse).get(0);\n+        return true;\n+    }\n+\n+    public synchronized String getMspConfig() throws HaywardException, InterruptedException {\n+        // *****getMspConfig from Hayward server\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request><Name>GetMspConfigFile</Name><Parameters>\"\n+                + \"<Parameter name=\\\"Token\\\" dataType=\\\"String\\\">\" + account.token + \"</Parameter>\"\n+                + \"<Parameter name=\\\"MspSystemID\\\" dataType=\\\"int\\\">\" + account.mspSystemID\n+                + \"</Parameter><Parameter name=\\\"Version\\\" dataType=\\\"string\\\">0</Parameter>\\r\\n\"\n+                + \"</Parameters></Request>\";\n+\n+        String xmlResponse = httpXmlResponse(urlParameters);\n+\n+        // Debug: Inject xml file for testing\n+        // String path =\n+        // \"C:/Users/Controls/openhab-2-5-x/git/openhab-addons/bundles/org.openhab.binding.haywardomnilogic/getConfig.xml\";\n+        // xmlResponse = new String(Files.readAllBytes(Paths.get(path)));\n+\n+        if (xmlResponse.isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: requestConfig XML response was null\");\n+            return \"Fail\";\n+        }\n+\n+        if (evaluateXPath(\"//Backyard/Name/text()\", xmlResponse).isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: requestConfiguration XML response: {}\", xmlResponse);\n+            return \"Fail\";\n+        }\n+        return xmlResponse;\n+    }\n+\n+    public synchronized boolean mspConfigUnits() throws HaywardException, InterruptedException {\n+        List<String> property1 = new ArrayList<>();\n+        List<String> property2 = new ArrayList<>();\n+\n+        String xmlResponse = getMspConfig();\n+\n+        // Get Units (Standard, Metric)\n+        property1 = evaluateXPath(\"//System/Units/text()\", xmlResponse);\n+        account.units = property1.get(0);\n+\n+        // Get Variable Speed Pump Units (percent, RPM)\n+        property2 = evaluateXPath(\"//System/Msp-Vsp-Speed-Format/text()\", xmlResponse);\n+        account.vspSpeedFormat = property2.get(0);\n+\n+        return true;\n+    }\n+\n+    public synchronized boolean getTelemetryData() throws HaywardException, InterruptedException {\n+        // *****getTelemetry from Hayward server\n+        String urlParameters = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><Request><Name>GetTelemetryData</Name><Parameters>\"\n+                + \"<Parameter name=\\\"Token\\\" dataType=\\\"String\\\">\" + account.token + \"</Parameter>\"\n+                + \"<Parameter name=\\\"MspSystemID\\\" dataType=\\\"int\\\">\" + account.mspSystemID\n+                + \"</Parameter></Parameters></Request>\";\n+\n+        String xmlResponse = httpXmlResponse(urlParameters);\n+\n+        if (xmlResponse.isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: getTelemetry XML response was null\");\n+            return false;\n+        }\n+\n+        if (!evaluateXPath(\"/Response/Parameters//Parameter[@name='StatusMessage']/text()\", xmlResponse).isEmpty()) {\n+            logger.debug(\"Hayward Connection thing: getTelemetry XML response: {}\", xmlResponse);\n+            return false;\n+        }\n+\n+        for (Thing thing : getThing().getThings()) {\n+            if (thing.getHandler() instanceof HaywardThingHandler) {\n+                HaywardThingHandler handler = (HaywardThingHandler) thing.getHandler();\n+                if (handler != null) {\n+                    handler.getTelemetry(xmlResponse);\n+                }\n+            }\n+        }\n+        return true;\n+    }\n+\n+    public synchronized boolean getAlarmList() throws HaywardException {\n+        for (Thing thing : getThing().getThings()) {\n+            Map<String, String> properties = thing.getProperties();\n+            if (\"BACKYARD\".equals(properties.get(HaywardBindingConstants.PROPERTY_TYPE))) {\n+                HaywardBackyardHandler handler = (HaywardBackyardHandler) thing.getHandler();\n+                if (handler != null) {\n+                    String systemID = properties.get(HaywardBindingConstants.PROPERTY_SYSTEM_ID);\n+                    if (systemID != null) {\n+                        return handler.getAlarmList(systemID);\n+                    }\n+                }\n+            }\n+        }\n+        return false;\n+    }\n+\n+    private synchronized void initPolling(int initalDelay) {\n+        pollTelemetryFuture = scheduler.scheduleWithFixedDelay(() -> {\n+            try {\n+                if (commFailureCount >= 5) {\n+                    commFailureCount = 0;\n+                    clearPolling(pollTelemetryFuture);\n+                    clearPolling(pollAlarmsFuture);\n+                    initialize();\n+                    return;\n+                }\n+                if (!(getTelemetryData())) {\n+                    commFailureCount++;\n+                    return;\n+                }\n+            } catch (HaywardException e) {\n+                logger.debug(\"Hayward Connection thing: Exception during poll: {}\", e.getMessage());\n+            } catch (InterruptedException e) {\n+                return;\n+            }\n+        }, initalDelay, config.telemetryPollTime, TimeUnit.SECONDS);\n+        return;\n+    }\n+\n+    private synchronized void initAlarmPolling(int initalDelay) {\n+        pollAlarmsFuture = scheduler.scheduleWithFixedDelay(() -> {\n+            try {\n+                getAlarmList();\n+            } catch (HaywardException e) {\n+                logger.debug(\"Hayward Connection thing: Exception during poll: {}\", e.getMessage());\n+            }\n+        }, initalDelay, config.alarmPollTime, TimeUnit.SECONDS);\n+    }\n+\n+    private void clearPolling(@Nullable ScheduledFuture<?> pollJob) {\n+        if (pollJob != null) {\n+            pollJob.cancel(false);\n+        }\n+    }\n+\n+    @Nullable\n+    Thing getThingForType(HaywardTypeToRequest type, int num) {\n+        for (Thing thing : getThing().getThings()) {\n+            Map<String, String> properties = thing.getProperties();\n+            if (Integer.toString(num).equals(properties.get(HaywardBindingConstants.PROPERTY_SYSTEM_ID))) {\n+                if (type.toString().equals(properties.get(HaywardBindingConstants.PROPERTY_TYPE))) {\n+                    return thing;\n+                }\n+            }\n+        }\n+        return null;\n+    }\n+\n+    public List<String> evaluateXPath(String xpathExp, String xmlResponse) {\n+        List<String> values = new ArrayList<>();\n+        try {\n+            InputSource inputXML = new InputSource(new StringReader(xmlResponse));\n+            XPath xPath = XPathFactory.newInstance().newXPath();\n+            NodeList nodes = (NodeList) xPath.evaluate(xpathExp, inputXML, XPathConstants.NODESET);\n+\n+            for (int i = 0; i < nodes.getLength(); i++) {\n+                values.add(nodes.item(i).getNodeValue());\n+            }\n+        } catch (XPathExpressionException e) {\n+            logger.warn(\"XPathExpression exception: {}\", e.getMessage());\n+        }\n+        return values;\n+    }\n+\n+    private Request sendRequestBuilder(String url, HttpMethod method) {\n+        return this.httpClient.newRequest(url).agent(\"NextGenForIPhone/16565 CFNetwork/887 Darwin/17.0.0\")\n+                .method(method).header(HttpHeader.ACCEPT_LANGUAGE, \"en-us\").header(HttpHeader.ACCEPT, \"*/*\")\n+                .header(HttpHeader.ACCEPT_ENCODING, \"gzip, deflate\").version(HttpVersion.HTTP_1_1)\n+                .header(HttpHeader.CONNECTION, \"keep-alive\").header(HttpHeader.HOST, \"www.haywardomnilogic.com:80\")\n+                .timeout(10, TimeUnit.SECONDS);\n+    }\n+\n+    public synchronized String httpXmlResponse(String urlParameters) throws HaywardException, InterruptedException {\n+        String urlParameterslength = Integer.toString(urlParameters.length());\n+        String statusMessage;\n+\n+        try {\n+            ContentResponse httpResponse = sendRequestBuilder(config.endpointUrl, HttpMethod.POST)\n+                    .content(new StringContentProvider(urlParameters), \"text/xml; charset=utf-8\")\n+                    .header(HttpHeader.CONTENT_LENGTH, urlParameterslength).send();\n+\n+            int status = httpResponse.getStatus();\n+            String xmlResponse = httpResponse.getContentAsString();\n+\n+            List<String> statusMessages = evaluateXPath(\"/Response/Parameters//Parameter[@name='StatusMessage']/text()\",\n+                    xmlResponse);\n+            if (!(statusMessages.isEmpty())) {\n+                statusMessage = statusMessages.get(0);\n+            } else {\n+                statusMessage = httpResponse.getReason();\n+            }\n+\n+            if (status == 200) {\n+                if (logger.isTraceEnabled()) {\n+                    logger.trace(\"Hayward Connection thing:  {} Hayward http command: {}\", getCallingMethod(),\n+                            urlParameters);\n+                    logger.trace(\"Hayward Connection thing:  {} Hayward http response: {} {}\", getCallingMethod(),\n+                            statusMessage, xmlResponse);\n+                }\n+                return xmlResponse;\n+            } else {\n+                if (logger.isDebugEnabled()) {\n+                    logger.debug(\"Hayward Connection thing:  {} Hayward http command: {}\", getCallingMethod(),\n+                            urlParameters);\n+                    logger.debug(\"Hayward Connection thing:  {} Hayward http response: {}\", getCallingMethod(), status);\n+                }\n+                return \"\";\n+            }\n+        } catch (ExecutionException e) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                    \"Unable to resolve host.  Check Hayward hostname and your internet connection.\");\n+            return \"\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad68cd938c3737c40854faf9111c4dec6cf34376"}, "originalPosition": 454}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTI0NDcxNQ==", "bodyText": "You don't need to cast to call toString().\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        return ((StringType) command).toString();\n          \n          \n            \n                        return command.toString();", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r559244715", "createdAt": "2021-01-17T22:00:07Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/HaywardThingHandler.java", "diffHunk": "@@ -0,0 +1,122 @@\n+/**\n+ * Copyright (c) 2010-2021 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+\n+package org.openhab.binding.haywardomnilogic.internal;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.library.types.DecimalType;\n+import org.openhab.core.library.types.OnOffType;\n+import org.openhab.core.library.types.QuantityType;\n+import org.openhab.core.library.types.StringType;\n+import org.openhab.core.library.unit.ImperialUnits;\n+import org.openhab.core.library.unit.SIUnits;\n+import org.openhab.core.library.unit.Units;\n+import org.openhab.core.thing.Bridge;\n+import org.openhab.core.thing.Channel;\n+import org.openhab.core.thing.ChannelUID;\n+import org.openhab.core.thing.Thing;\n+import org.openhab.core.thing.ThingStatus;\n+import org.openhab.core.thing.binding.BaseThingHandler;\n+import org.openhab.core.types.Command;\n+import org.openhab.core.types.State;\n+\n+/**\n+ * The {@link HaywarThingHandler} is a subclass of the BaseThingHandler and a Super\n+ * Class to each Hayward Thing Handler\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+@NonNullByDefault\n+public abstract class HaywardThingHandler extends BaseThingHandler {\n+\n+    public HaywardThingHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        updateStatus(ThingStatus.ONLINE);\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+    }\n+\n+    public abstract void getTelemetry(String xmlResponse) throws HaywardException;\n+\n+    public State toState(String type, String channelID, String value) throws NumberFormatException {\n+        switch (type) {\n+            case \"Number\":\n+                return new DecimalType(value);\n+            case \"Switch\":\n+                return Integer.parseInt(value) > 0 ? OnOffType.ON : OnOffType.OFF;\n+            case \"system.power\":\n+                return Integer.parseInt(value) > 0 ? OnOffType.ON : OnOffType.OFF;\n+            case \"Number:Dimensionless\":\n+                switch (channelID) {\n+                    case \"chlorTimedPercent\":\n+                    case \"filterSpeed\":\n+                    case \"pumpSpeed\":\n+                    case \"filterLastSpeed\":\n+                        return new QuantityType<>(Integer.parseInt(value), Units.PERCENT);\n+                    case \"chlorAvgSaltLevel\":\n+                    case \"chlorInstantSaltLevel\":\n+                        return new QuantityType<>(Integer.parseInt(value), Units.PARTS_PER_MILLION);\n+                }\n+            case \"Number:Temperature\":\n+                Bridge bridge = getBridge();\n+                if (bridge != null) {\n+                    HaywardBridgeHandler bridgehandler = (HaywardBridgeHandler) bridge.getHandler();\n+                    if (bridgehandler != null) {\n+                        if (bridgehandler.account.units.equals(\"Standard\")) {\n+                            return new QuantityType<>(Integer.parseInt(value), ImperialUnits.FAHRENHEIT);\n+                        } else {\n+                            return new QuantityType<>(Integer.parseInt(value), SIUnits.CELSIUS);\n+                        }\n+                    } else {\n+                        // default to imperial if no bridge\n+                        return new QuantityType<>(Integer.parseInt(value), ImperialUnits.FAHRENHEIT);\n+                    }\n+                }\n+            default:\n+                return StringType.valueOf(value);\n+        }\n+    }\n+\n+    public String cmdToString(Command command) {\n+        if (command == OnOffType.OFF) {\n+            return \"0\";\n+        } else if (command == OnOffType.ON) {\n+            return \"1\";\n+        } else if (command instanceof DecimalType) {\n+            return ((DecimalType) command).toString();\n+        } else if (command instanceof QuantityType) {\n+            return ((QuantityType<?>) command).format(\"%1.0f\");\n+        } else {\n+            return ((StringType) command).toString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad68cd938c3737c40854faf9111c4dec6cf34376"}, "originalPosition": 108}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTcwNzU2ODIy", "url": "https://github.com/openhab/openhab-addons/pull/8685#pullrequestreview-570756822", "createdAt": "2021-01-18T20:13:45Z", "commit": {"oid": "fdec9c4b0288ca02d1867f833b8ed7667bd110f6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOFQyMDoxMzo0NlrOIV2Grg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOFQyMDoxMzo0NlrOIV2Grg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTc3NzQ1NA==", "bodyText": "Similar code appears in many other places in this class. Please refactor the code into a separate function.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r559777454", "createdAt": "2021-01-18T20:13:46Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/discovery/HaywardDiscoveryService.java", "diffHunk": "@@ -0,0 +1,452 @@\n+/**\n+ * Copyright (c) 2010-2021 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.discovery;\n+\n+import static org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants.THING_TYPES_UIDS;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.config.discovery.AbstractDiscoveryService;\n+import org.openhab.core.config.discovery.DiscoveryResult;\n+import org.openhab.core.config.discovery.DiscoveryResultBuilder;\n+import org.openhab.core.config.discovery.DiscoveryService;\n+import org.openhab.core.thing.ThingUID;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Sets up the discovery results and details\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+@NonNullByDefault\n+public class HaywardDiscoveryService extends AbstractDiscoveryService implements DiscoveryService, ThingHandlerService {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardDiscoveryService.class);\n+    private @Nullable HaywardBridgeHandler discoveryBridgehandler;\n+\n+    public HaywardDiscoveryService() {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    /**\n+     * Constructs a zone discovery service.\n+     * Registers this zone discovery service programmatically.\n+     * Call {@link ZoneDiscoveryService#destroy()} to unregister the service after use.\n+     */\n+    public HaywardDiscoveryService(HaywardBridgeHandler bridge) throws IllegalArgumentException {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    @Override\n+    public void activate() {\n+        super.activate(null);\n+    }\n+\n+    @Override\n+    public void deactivate() {\n+        super.deactivate();\n+    }\n+\n+    @Override\n+    protected void startScan() {\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        try {\n+            if (bridgehandler != null) {\n+                String xmlResults = bridgehandler.getMspConfig();\n+                mspConfigDiscovery(xmlResults);\n+            }\n+        } catch (HaywardException e) {\n+            logger.warn(\"Exception during discovery scan: {}\", e.getMessage());\n+        } catch (InterruptedException e) {\n+            return;\n+        }\n+    }\n+\n+    public synchronized boolean mspConfigDiscovery(String xmlResponse) {\n+        List<String> systemIDs = new ArrayList<>();\n+        List<String> names = new ArrayList<>();\n+        List<String> bowName = new ArrayList<>();\n+        List<String> bowID = new ArrayList<>();\n+        List<String> property1 = new ArrayList<>();\n+        List<String> property2 = new ArrayList<>();\n+        List<String> property3 = new ArrayList<>();\n+        List<String> property4 = new ArrayList<>();\n+\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+\n+        if (bridgehandler != null) {\n+            // Find Backyard\n+            names = bridgehandler.evaluateXPath(\"//Backyard/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < names.size(); i++) {\n+                onBackyardDiscovered(Integer.parseInt(bridgehandler.account.mspSystemID), names.get(i));\n+            }\n+\n+            // Find Bodies of Water\n+            systemIDs = bridgehandler.evaluateXPath(\"//Body-of-water/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Body-of-water/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                onBOWDiscovered(Integer.parseInt(systemIDs.get(i)), names.get(i));\n+            }\n+\n+            // Find Chlorinators\n+            systemIDs = bridgehandler.evaluateXPath(\"//Chlorinator/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Chlorinator/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+                onChlorinatorDiscovered(Integer.parseInt(systemIDs.get(i)), names.get(i), bowID.get(0), bowName.get(0));\n+            }\n+\n+            // Find ColorLogic Lights\n+            systemIDs = bridgehandler.evaluateXPath(\"//ColorLogic-Light/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//ColorLogic-Light/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+                onColorLogicDiscovered(Integer.parseInt(systemIDs.get(i)), names.get(i), bowID.get(0), bowName.get(0));\n+            }\n+\n+            // Find Filters\n+            systemIDs = bridgehandler.evaluateXPath(\"//Filter/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Filter/Name/text()\", xmlResponse);\n+            property1 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-Speed/text()\", xmlResponse);\n+            property2 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-Speed/text()\", xmlResponse);\n+            property3 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-RPM/text()\", xmlResponse);\n+            property4 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-RPM/text()\", xmlResponse);\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+                onFilterDiscovered(Integer.parseInt(systemIDs.get(i)), names.get(i), bowID.get(0), bowName.get(0),\n+                        property1.get(i), property2.get(i), property3.get(i), property4.get(i));\n+            }\n+\n+            // Find Heaters\n+            systemIDs = bridgehandler.evaluateXPath(\"//Heater-Equipment/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Heater-Equipment/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/System-Id/text()\",\n+                        xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/Name/text()\", xmlResponse);\n+                onHeaterDiscovered(Integer.parseInt(systemIDs.get(i)), names.get(i), bowID.get(0), bowName.get(0));\n+            }\n+\n+            // Find Pumps\n+            systemIDs = bridgehandler.evaluateXPath(\"//Pump/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Pump/Name/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Filter/Name/text()\", xmlResponse);\n+            property1 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-Speed/text()\", xmlResponse);\n+            property2 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-Speed/text()\", xmlResponse);\n+            property3 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-RPM/text()\", xmlResponse);\n+            property4 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-RPM/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/System-Id/text()\",\n+                        xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/Name/text()\", xmlResponse);\n+                onPumpDiscovered(Integer.parseInt(systemIDs.get(i)), names.get(i), bowID.get(0), bowName.get(0),\n+                        property1.get(i), property2.get(i), property3.get(i), property4.get(i));\n+            }\n+\n+            // Find Relays\n+            systemIDs = bridgehandler.evaluateXPath(\"//Relay/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Relay/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+                if (!(bowID.isEmpty())) {\n+                    onRelayDiscovered(Integer.parseInt(systemIDs.get(i)), names.get(i), bowID.get(0), bowName.get(0));\n+                } else {\n+                    onRelayDiscovered(Integer.parseInt(systemIDs.get(i)), names.get(i), \"\", \"\");\n+                }\n+\n+            }\n+\n+            // Find Virtual Heaters\n+            systemIDs = bridgehandler.evaluateXPath(\"//Heater/System-Id/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+                onVirtualHeaterDiscovered(Integer.parseInt(systemIDs.get(i)), \"Virtual Heater\", bowID.get(0),\n+                        bowName.get(0));\n+            }\n+\n+            // Find Sensors\n+            // Flow and water temp sensor aren't showing up in telemetry. Need example to determine how to differentiate\n+            // \"system\" sensors\n+            // that are reported in the BOW water temp, Filter flow switch, ORP, etc.\n+            systemIDs = bridgehandler.evaluateXPath(\"//Sensor/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Sensor/Name/text()\", xmlResponse);\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+                // Do not add backyard sensors that do not exist in the BOW thus bowID is null\n+                if (!(bowID.isEmpty())) {\n+                    onSensorDiscovered(Integer.parseInt(systemIDs.get(i)), names.get(i), bowID.get(0), bowName.get(0));\n+                }\n+            }\n+        }\n+        return true;\n+    }\n+\n+    public void onBackyardDiscovered(int systemID, String label) {\n+        logger.trace(\"Hayward Backyard {} Discovered: {}\", systemID, label);\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        if (bridgehandler != null) {\n+            ThingUID thingUID = new ThingUID(HaywardBindingConstants.THING_TYPE_BACKYARD,\n+                    bridgehandler.getThing().getUID(), Integer.toString(systemID));\n+            Map<String, Object> properties = new HashMap<>();\n+            properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, String.valueOf(systemID));\n+            properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BACKYARD);\n+            DiscoveryResult result = DiscoveryResultBuilder.create(thingUID)\n+                    .withBridge(bridgehandler.getThing().getUID())\n+                    .withRepresentationProperty(HaywardBindingConstants.PROPERTY_SYSTEM_ID)\n+                    .withLabel(\"Hayward \" + label).withProperties(properties).build();\n+            thingDiscovered(result);\n+        }\n+    }\n+\n+    public void onBOWDiscovered(int systemID, String label) {\n+        logger.trace(\"Hayward BOW {} Discovered: {}\", systemID, label);\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        if (bridgehandler != null) {\n+            ThingUID thingUID = new ThingUID(HaywardBindingConstants.THING_TYPE_BOW, bridgehandler.getThing().getUID(),\n+                    Integer.toString(systemID));\n+            Map<String, Object> properties = new HashMap<>();\n+            properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, String.valueOf(systemID));\n+            properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BOW);\n+            DiscoveryResult result = DiscoveryResultBuilder.create(thingUID)\n+                    .withBridge(bridgehandler.getThing().getUID())\n+                    .withRepresentationProperty(HaywardBindingConstants.PROPERTY_SYSTEM_ID)\n+                    .withLabel(\"Hayward \" + label).withProperties(properties).build();\n+            thingDiscovered(result);\n+        }\n+    }\n+\n+    public void onChlorinatorDiscovered(int systemID, String label, String bowID, String bowName) {\n+        logger.trace(\"Hayward Chlorinator {} Discovered: {}\", systemID, label);\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        if (bridgehandler != null) {\n+            ThingUID thingUID = new ThingUID(HaywardBindingConstants.THING_TYPE_CHLORINATOR,\n+                    bridgehandler.getThing().getUID(), Integer.toString(systemID));\n+            Map<String, Object> properties = new HashMap<>();\n+            properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, String.valueOf(systemID));\n+            properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.CHLORINATOR);\n+            properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID);\n+            properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName);\n+            DiscoveryResult result = DiscoveryResultBuilder.create(thingUID)\n+                    .withBridge(bridgehandler.getThing().getUID())\n+                    .withRepresentationProperty(HaywardBindingConstants.PROPERTY_SYSTEM_ID)\n+                    .withLabel(\"Hayward \" + label).withProperties(properties).build();\n+            thingDiscovered(result);\n+        }\n+    }\n+\n+    public void onColorLogicDiscovered(int systemID, String label, String bowID, String bowName) {\n+        logger.trace(\"Hayward Color Logic Light {} Discovered: {}\", systemID, label);\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        if (bridgehandler != null) {\n+            ThingUID thingUID = new ThingUID(HaywardBindingConstants.THING_TYPE_COLORLOGIC,\n+                    bridgehandler.getThing().getUID(), Integer.toString(systemID));\n+            Map<String, Object> properties = new HashMap<>();\n+            properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, String.valueOf(systemID));\n+            properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.COLORLOGIC);\n+            properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID);\n+            properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName);\n+            DiscoveryResult result = DiscoveryResultBuilder.create(thingUID)\n+                    .withBridge(bridgehandler.getThing().getUID())\n+                    .withRepresentationProperty(HaywardBindingConstants.PROPERTY_SYSTEM_ID)\n+                    .withLabel(\"Hayward \" + label).withProperties(properties).build();\n+            thingDiscovered(result);\n+        }\n+    }\n+\n+    public void onFilterDiscovered(int systemID, String label, String bowID, String bowName, String minPumpSpeed,\n+            String maxPumpSpeed, String minPumpRpm, String maxPumpRpm) {\n+        logger.trace(\"Hayward Filter {} Discovered: {}\", systemID, label);\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        if (bridgehandler != null) {\n+            ThingUID thingUID = new ThingUID(HaywardBindingConstants.THING_TYPE_FILTER,\n+                    bridgehandler.getThing().getUID(), Integer.toString(systemID));\n+            Map<String, Object> properties = new HashMap<>();\n+            properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, String.valueOf(systemID));\n+            properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.FILTER);\n+            properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID);\n+            properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName);\n+            properties.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPSPEED, minPumpSpeed);\n+            properties.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPSPEED, maxPumpSpeed);\n+            properties.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPRPM, minPumpRpm);\n+            properties.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPRPM, maxPumpRpm);\n+            DiscoveryResult result = DiscoveryResultBuilder.create(thingUID)\n+                    .withBridge(bridgehandler.getThing().getUID())\n+                    .withRepresentationProperty(HaywardBindingConstants.PROPERTY_SYSTEM_ID)\n+                    .withLabel(\"Hayward \" + label).withProperties(properties).build();\n+            thingDiscovered(result);\n+        }\n+    }\n+\n+    public void onHeaterDiscovered(int systemID, String label, String bowID, String bowName) {\n+        logger.trace(\"Hayward Heater {} Discovered: {}\", systemID, label);\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        if (bridgehandler != null) {\n+            ThingUID thingUID = new ThingUID(HaywardBindingConstants.THING_TYPE_HEATER,\n+                    bridgehandler.getThing().getUID(), Integer.toString(systemID));\n+            Map<String, Object> properties = new HashMap<>();\n+            properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, String.valueOf(systemID));\n+            properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.HEATER);\n+            properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID);\n+            properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName);\n+            DiscoveryResult result = DiscoveryResultBuilder.create(thingUID)\n+                    .withBridge(bridgehandler.getThing().getUID())\n+                    .withRepresentationProperty(HaywardBindingConstants.PROPERTY_SYSTEM_ID)\n+                    .withLabel(\"Hayward \" + label).withProperties(properties).build();\n+            thingDiscovered(result);\n+        }\n+    }\n+\n+    public void onPumpDiscovered(int systemID, String label, String bowID, String bowName, String property1,\n+            String property2, String property3, String property4) {\n+        logger.trace(\"Hayward Pump {} Discovered: {}\", systemID, label);\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        if (bridgehandler != null) {\n+            ThingUID thingUID = new ThingUID(HaywardBindingConstants.THING_TYPE_PUMP, bridgehandler.getThing().getUID(),\n+                    Integer.toString(systemID));\n+            Map<String, Object> properties = new HashMap<>();\n+            properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, String.valueOf(systemID));\n+            properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.PUMP);\n+            properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID);\n+            properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName);\n+            properties.put(HaywardBindingConstants.PROPERTY_PUMP_MINPUMPSPEED, property1);\n+            properties.put(HaywardBindingConstants.PROPERTY_PUMP_MAXPUMPSPEED, property2);\n+            properties.put(HaywardBindingConstants.PROPERTY_PUMP_MINPUMPRPM, property3);\n+            properties.put(HaywardBindingConstants.PROPERTY_PUMP_MAXPUMPRPM, property4);\n+            DiscoveryResult result = DiscoveryResultBuilder.create(thingUID)\n+                    .withBridge(bridgehandler.getThing().getUID())\n+                    .withRepresentationProperty(HaywardBindingConstants.PROPERTY_SYSTEM_ID)\n+                    .withLabel(\"Hayward \" + label).withProperties(properties).build();\n+            thingDiscovered(result);\n+        }\n+    }\n+\n+    public void onRelayDiscovered(int systemID, String label, String bowID, String bowName) {\n+        logger.trace(\"Hayward Relay {} Discovered: {}\", systemID, label);\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        if (bridgehandler != null) {\n+            ThingUID thingUID = new ThingUID(HaywardBindingConstants.THING_TYPE_RELAY,\n+                    bridgehandler.getThing().getUID(), Integer.toString(systemID));\n+            Map<String, Object> properties = new HashMap<>();\n+            properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, String.valueOf(systemID));\n+            properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.RELAY);\n+            properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID);\n+            properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName);\n+            DiscoveryResult result = DiscoveryResultBuilder.create(thingUID)\n+                    .withBridge(bridgehandler.getThing().getUID())\n+                    .withRepresentationProperty(HaywardBindingConstants.PROPERTY_SYSTEM_ID)\n+                    .withLabel(\"Hayward \" + label).withProperties(properties).build();\n+            thingDiscovered(result);\n+        }\n+    }\n+\n+    public void onSensorDiscovered(int systemID, String label, String bowID, String bowName) {\n+        logger.trace(\"Hayward Sensor {} Discovered: {}\", systemID, label);\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        if (bridgehandler != null) {\n+            ThingUID thingUID = new ThingUID(HaywardBindingConstants.THING_TYPE_SENSOR,\n+                    bridgehandler.getThing().getUID(), Integer.toString(systemID));\n+            Map<String, Object> properties = new HashMap<>();\n+            properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, String.valueOf(systemID));\n+            properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.SENSOR);\n+            properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID);\n+            properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName);\n+            DiscoveryResult result = DiscoveryResultBuilder.create(thingUID)\n+                    .withBridge(bridgehandler.getThing().getUID())\n+                    .withRepresentationProperty(HaywardBindingConstants.PROPERTY_SYSTEM_ID)\n+                    .withLabel(\"Hayward \" + label).withProperties(properties).build();\n+            thingDiscovered(result);\n+        }\n+    }\n+\n+    public void onVirtualHeaterDiscovered(int systemID, String label, String bowID, String bowName) {\n+        logger.trace(\"Hayward Virtual Heater {} Discovered: {}\", systemID, label);\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        if (bridgehandler != null) {\n+            ThingUID thingUID = new ThingUID(HaywardBindingConstants.THING_TYPE_VIRTUALHEATER,\n+                    bridgehandler.getThing().getUID(), Integer.toString(systemID));\n+            Map<String, Object> properties = new HashMap<>();\n+            properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, String.valueOf(systemID));\n+            properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.VIRTUALHEATER.toString());\n+            properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID);\n+            properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName);\n+            DiscoveryResult result = DiscoveryResultBuilder.create(thingUID)\n+                    .withBridge(bridgehandler.getThing().getUID())\n+                    .withRepresentationProperty(HaywardBindingConstants.PROPERTY_SYSTEM_ID)\n+                    .withLabel(\"Hayward \" + label).withProperties(properties).build();\n+            thingDiscovered(result);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fdec9c4b0288ca02d1867f833b8ed7667bd110f6"}, "originalPosition": 437}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTcyNTU4NDQ4", "url": "https://github.com/openhab/openhab-addons/pull/8685#pullrequestreview-572558448", "createdAt": "2021-01-20T19:28:45Z", "commit": {"oid": "d9bd8cd567e43404322b13b7ca7ee0ab5a3f8c13"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQxOToyODo0NVrOIXOQew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQyMDoyMzoxMlrOIXQt3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTIyMTc1NQ==", "bodyText": "I'm not sure if the core makes a copy of the properties each time you create a discovery result. So rather than making assumptions I think it would be safer to create a new HashMap each time instead of reusing it.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r561221755", "createdAt": "2021-01-20T19:28:45Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/discovery/HaywardDiscoveryService.java", "diffHunk": "@@ -93,6 +94,7 @@ public synchronized boolean mspConfigDiscovery(String xmlResponse) {\n         List<String> property2 = new ArrayList<>();\n         List<String> property3 = new ArrayList<>();\n         List<String> property4 = new ArrayList<>();\n+        Map<String, Object> properties = new HashMap<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9bd8cd567e43404322b13b7ca7ee0ab5a3f8c13"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTIyMzMxNA==", "bodyText": "The previous code used to always get the values from index 0. Is getting the values from index i now a fix?", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r561223314", "createdAt": "2021-01-20T19:31:24Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/discovery/HaywardDiscoveryService.java", "diffHunk": "@@ -216,8 +265,14 @@ public synchronized boolean mspConfigDiscovery(String xmlResponse) {\n                         \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n                 bowName = bridgehandler.evaluateXPath(\n                         \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n-                onVirtualHeaterDiscovered(Integer.parseInt(systemIDs.get(i)), \"Virtual Heater\", bowID.get(0),\n-                        bowName.get(0));\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.VIRTUALHEATER);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9bd8cd567e43404322b13b7ca7ee0ab5a3f8c13"}, "originalPosition": 159}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTIzNzY5MQ==", "bodyText": "Most of your devices seem to use the same discovery logic. I suggest refactoring the logic into a single configurable utility method.\nprivate void discoverDevices(HaywardBridgeHandler bridgehandler, String xmlResponse, List<String> names, List<String> systemIDs, String type, ThingTypeUID thingType, boolean useZeroForBowIndex, @Nullable BiConsumer<Map<String, Object>,Integer> additionalPropertyConsumer){\n           for (int i = 0; i < systemIDs.size(); i++) {\n                // get Body of Water for each item\n                bowID = bridgehandler.evaluateXPath(\n                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/System-Id/text()\", xmlResponse);\n                bowName = bridgehandler.evaluateXPath(\n                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/Name/text()\", xmlResponse);\n\n                Map<String, Object> properties = new HashMap<>();\n                properties.put(HaywardBindingConstants.PROPERTY_TYPE, type);\n                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n                int bowIndex = useZeroForBowIndex ? 0 : i;\n                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(bowIndex));\n                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(bowIndex));\n                if(additionalPropertyConsumer != null){\n                    additionalPropertyConsumer.accept(properties, i);\n                }\n                onDeviceDiscovered(thingType, names.get(i), properties);\n            }\n}\n\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        for (int i = 0; i < systemIDs.size(); i++) {\n          \n          \n            \n                            // get Body of Water for each item\n          \n          \n            \n                            bowID = bridgehandler.evaluateXPath(\n          \n          \n            \n                                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n          \n          \n            \n                            bowName = bridgehandler.evaluateXPath(\n          \n          \n            \n                                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n          \n          \n            \n            \n          \n          \n            \n                            properties.clear();\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.CHLORINATOR);\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n          \n          \n            \n            \n          \n          \n            \n                            onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_CHLORINATOR, names.get(i), properties);\n          \n          \n            \n                        }\n          \n          \n            \n                        discoverDevices(bridgehandler, xmlResponse, names, systemIDs, HaywardTypeToRequest.CHLORINATOR, HaywardBindingConstants.THING_TYPE_CHLORINATOR, false, null);\n          \n      \n    \n    \n  \n\nI did notice that some of other xpath searches use parent instead of ancestor so I'll leave it up to you to make corrections and adjustments.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r561237691", "createdAt": "2021-01-20T19:55:54Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/discovery/HaywardDiscoveryService.java", "diffHunk": "@@ -0,0 +1,332 @@\n+/**\n+ * Copyright (c) 2010-2021 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.discovery;\n+\n+import static org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants.THING_TYPES_UIDS;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.config.discovery.AbstractDiscoveryService;\n+import org.openhab.core.config.discovery.DiscoveryResult;\n+import org.openhab.core.config.discovery.DiscoveryResultBuilder;\n+import org.openhab.core.config.discovery.DiscoveryService;\n+import org.openhab.core.thing.ThingTypeUID;\n+import org.openhab.core.thing.ThingUID;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Sets up the discovery results and details\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+@NonNullByDefault\n+public class HaywardDiscoveryService extends AbstractDiscoveryService implements DiscoveryService, ThingHandlerService {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardDiscoveryService.class);\n+    private @Nullable HaywardBridgeHandler discoveryBridgehandler;\n+\n+    public HaywardDiscoveryService() {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    /**\n+     * Constructs a zone discovery service.\n+     * Registers this zone discovery service programmatically.\n+     * Call {@link ZoneDiscoveryService#destroy()} to unregister the service after use.\n+     */\n+    public HaywardDiscoveryService(HaywardBridgeHandler bridge) throws IllegalArgumentException {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    @Override\n+    public void activate() {\n+        super.activate(null);\n+    }\n+\n+    @Override\n+    public void deactivate() {\n+        super.deactivate();\n+    }\n+\n+    @Override\n+    protected void startScan() {\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        try {\n+            if (bridgehandler != null) {\n+                String xmlResults = bridgehandler.getMspConfig();\n+                mspConfigDiscovery(xmlResults);\n+            }\n+        } catch (HaywardException e) {\n+            logger.warn(\"Exception during discovery scan: {}\", e.getMessage());\n+        } catch (InterruptedException e) {\n+            return;\n+        }\n+    }\n+\n+    public synchronized boolean mspConfigDiscovery(String xmlResponse) {\n+        List<String> systemIDs = new ArrayList<>();\n+        List<String> names = new ArrayList<>();\n+        List<String> bowName = new ArrayList<>();\n+        List<String> bowID = new ArrayList<>();\n+        List<String> property1 = new ArrayList<>();\n+        List<String> property2 = new ArrayList<>();\n+        List<String> property3 = new ArrayList<>();\n+        List<String> property4 = new ArrayList<>();\n+        Map<String, Object> properties = new HashMap<>();\n+\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+\n+        if (bridgehandler != null) {\n+            // Find Backyard\n+            names = bridgehandler.evaluateXPath(\"//Backyard/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < names.size(); i++) {\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BACKYARD);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, bridgehandler.account.mspSystemID);\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BACKYARD, names.get(i), properties);\n+            }\n+\n+            // Find Bodies of Water\n+            systemIDs = bridgehandler.evaluateXPath(\"//Body-of-water/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Body-of-water/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BOW);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BOW, names.get(i), properties);\n+            }\n+\n+            // Find Chlorinators\n+            systemIDs = bridgehandler.evaluateXPath(\"//Chlorinator/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Chlorinator/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.CHLORINATOR);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_CHLORINATOR, names.get(i), properties);\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9bd8cd567e43404322b13b7ca7ee0ab5a3f8c13"}, "originalPosition": 143}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTIzOTAwMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        for (int i = 0; i < systemIDs.size(); i++) {\n          \n          \n            \n                            // get Body of Water for each item\n          \n          \n            \n                            bowID = bridgehandler.evaluateXPath(\n          \n          \n            \n                                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n          \n          \n            \n                            bowName = bridgehandler.evaluateXPath(\n          \n          \n            \n                                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n          \n          \n            \n            \n          \n          \n            \n                            properties.clear();\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.COLORLOGIC);\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n          \n          \n            \n            \n          \n          \n            \n                            onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_CHLORINATOR, names.get(i), properties);\n          \n          \n            \n                        }\n          \n          \n            \n                        discoverDevices(bridgehandler, xmlResponse, names, systemIDs, HaywardTypeToRequest.COLORLOGIC, HaywardBindingConstants.THING_TYPE_COLORLOGIC, false, null);", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r561239000", "createdAt": "2021-01-20T19:58:01Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/discovery/HaywardDiscoveryService.java", "diffHunk": "@@ -0,0 +1,332 @@\n+/**\n+ * Copyright (c) 2010-2021 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.discovery;\n+\n+import static org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants.THING_TYPES_UIDS;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.config.discovery.AbstractDiscoveryService;\n+import org.openhab.core.config.discovery.DiscoveryResult;\n+import org.openhab.core.config.discovery.DiscoveryResultBuilder;\n+import org.openhab.core.config.discovery.DiscoveryService;\n+import org.openhab.core.thing.ThingTypeUID;\n+import org.openhab.core.thing.ThingUID;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Sets up the discovery results and details\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+@NonNullByDefault\n+public class HaywardDiscoveryService extends AbstractDiscoveryService implements DiscoveryService, ThingHandlerService {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardDiscoveryService.class);\n+    private @Nullable HaywardBridgeHandler discoveryBridgehandler;\n+\n+    public HaywardDiscoveryService() {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    /**\n+     * Constructs a zone discovery service.\n+     * Registers this zone discovery service programmatically.\n+     * Call {@link ZoneDiscoveryService#destroy()} to unregister the service after use.\n+     */\n+    public HaywardDiscoveryService(HaywardBridgeHandler bridge) throws IllegalArgumentException {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    @Override\n+    public void activate() {\n+        super.activate(null);\n+    }\n+\n+    @Override\n+    public void deactivate() {\n+        super.deactivate();\n+    }\n+\n+    @Override\n+    protected void startScan() {\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        try {\n+            if (bridgehandler != null) {\n+                String xmlResults = bridgehandler.getMspConfig();\n+                mspConfigDiscovery(xmlResults);\n+            }\n+        } catch (HaywardException e) {\n+            logger.warn(\"Exception during discovery scan: {}\", e.getMessage());\n+        } catch (InterruptedException e) {\n+            return;\n+        }\n+    }\n+\n+    public synchronized boolean mspConfigDiscovery(String xmlResponse) {\n+        List<String> systemIDs = new ArrayList<>();\n+        List<String> names = new ArrayList<>();\n+        List<String> bowName = new ArrayList<>();\n+        List<String> bowID = new ArrayList<>();\n+        List<String> property1 = new ArrayList<>();\n+        List<String> property2 = new ArrayList<>();\n+        List<String> property3 = new ArrayList<>();\n+        List<String> property4 = new ArrayList<>();\n+        Map<String, Object> properties = new HashMap<>();\n+\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+\n+        if (bridgehandler != null) {\n+            // Find Backyard\n+            names = bridgehandler.evaluateXPath(\"//Backyard/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < names.size(); i++) {\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BACKYARD);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, bridgehandler.account.mspSystemID);\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BACKYARD, names.get(i), properties);\n+            }\n+\n+            // Find Bodies of Water\n+            systemIDs = bridgehandler.evaluateXPath(\"//Body-of-water/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Body-of-water/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BOW);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BOW, names.get(i), properties);\n+            }\n+\n+            // Find Chlorinators\n+            systemIDs = bridgehandler.evaluateXPath(\"//Chlorinator/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Chlorinator/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.CHLORINATOR);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_CHLORINATOR, names.get(i), properties);\n+            }\n+\n+            // Find ColorLogic Lights\n+            systemIDs = bridgehandler.evaluateXPath(\"//ColorLogic-Light/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//ColorLogic-Light/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.COLORLOGIC);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_CHLORINATOR, names.get(i), properties);\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9bd8cd567e43404322b13b7ca7ee0ab5a3f8c13"}, "originalPosition": 163}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTIzOTk0OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        for (int i = 0; i < systemIDs.size(); i++) {\n          \n          \n            \n                            // get Body of Water for each item\n          \n          \n            \n                            bowID = bridgehandler.evaluateXPath(\n          \n          \n            \n                                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n          \n          \n            \n                            bowName = bridgehandler.evaluateXPath(\n          \n          \n            \n                                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n          \n          \n            \n            \n          \n          \n            \n                            properties.clear();\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.FILTER);\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPSPEED, property1.get(i));\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPSPEED, property2.get(i));\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPRPM, property3.get(i));\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPRPM, property4.get(i));\n          \n          \n            \n            \n          \n          \n            \n                            onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_FILTER, names.get(i), properties);\n          \n          \n            \n                        }\n          \n          \n            \n                        discoverDevices(bridgehandler, xmlResponse, names, systemIDs, HaywardTypeToRequest.FILTER, HaywardBindingConstants.THING_TYPE_FILTER, false, (props, i) -> {\n          \n          \n            \n                            props.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPSPEED, property1.get(i));\n          \n          \n            \n                            props.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPSPEED, property2.get(i));\n          \n          \n            \n                            props.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPRPM, property3.get(i));\n          \n          \n            \n                            props.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPRPM, property4.get(i));\n          \n          \n            \n                        });", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r561239948", "createdAt": "2021-01-20T19:59:43Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/discovery/HaywardDiscoveryService.java", "diffHunk": "@@ -0,0 +1,332 @@\n+/**\n+ * Copyright (c) 2010-2021 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.discovery;\n+\n+import static org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants.THING_TYPES_UIDS;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.config.discovery.AbstractDiscoveryService;\n+import org.openhab.core.config.discovery.DiscoveryResult;\n+import org.openhab.core.config.discovery.DiscoveryResultBuilder;\n+import org.openhab.core.config.discovery.DiscoveryService;\n+import org.openhab.core.thing.ThingTypeUID;\n+import org.openhab.core.thing.ThingUID;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Sets up the discovery results and details\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+@NonNullByDefault\n+public class HaywardDiscoveryService extends AbstractDiscoveryService implements DiscoveryService, ThingHandlerService {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardDiscoveryService.class);\n+    private @Nullable HaywardBridgeHandler discoveryBridgehandler;\n+\n+    public HaywardDiscoveryService() {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    /**\n+     * Constructs a zone discovery service.\n+     * Registers this zone discovery service programmatically.\n+     * Call {@link ZoneDiscoveryService#destroy()} to unregister the service after use.\n+     */\n+    public HaywardDiscoveryService(HaywardBridgeHandler bridge) throws IllegalArgumentException {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    @Override\n+    public void activate() {\n+        super.activate(null);\n+    }\n+\n+    @Override\n+    public void deactivate() {\n+        super.deactivate();\n+    }\n+\n+    @Override\n+    protected void startScan() {\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        try {\n+            if (bridgehandler != null) {\n+                String xmlResults = bridgehandler.getMspConfig();\n+                mspConfigDiscovery(xmlResults);\n+            }\n+        } catch (HaywardException e) {\n+            logger.warn(\"Exception during discovery scan: {}\", e.getMessage());\n+        } catch (InterruptedException e) {\n+            return;\n+        }\n+    }\n+\n+    public synchronized boolean mspConfigDiscovery(String xmlResponse) {\n+        List<String> systemIDs = new ArrayList<>();\n+        List<String> names = new ArrayList<>();\n+        List<String> bowName = new ArrayList<>();\n+        List<String> bowID = new ArrayList<>();\n+        List<String> property1 = new ArrayList<>();\n+        List<String> property2 = new ArrayList<>();\n+        List<String> property3 = new ArrayList<>();\n+        List<String> property4 = new ArrayList<>();\n+        Map<String, Object> properties = new HashMap<>();\n+\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+\n+        if (bridgehandler != null) {\n+            // Find Backyard\n+            names = bridgehandler.evaluateXPath(\"//Backyard/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < names.size(); i++) {\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BACKYARD);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, bridgehandler.account.mspSystemID);\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BACKYARD, names.get(i), properties);\n+            }\n+\n+            // Find Bodies of Water\n+            systemIDs = bridgehandler.evaluateXPath(\"//Body-of-water/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Body-of-water/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BOW);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BOW, names.get(i), properties);\n+            }\n+\n+            // Find Chlorinators\n+            systemIDs = bridgehandler.evaluateXPath(\"//Chlorinator/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Chlorinator/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.CHLORINATOR);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_CHLORINATOR, names.get(i), properties);\n+            }\n+\n+            // Find ColorLogic Lights\n+            systemIDs = bridgehandler.evaluateXPath(\"//ColorLogic-Light/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//ColorLogic-Light/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.COLORLOGIC);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_CHLORINATOR, names.get(i), properties);\n+            }\n+\n+            // Find Filters\n+            systemIDs = bridgehandler.evaluateXPath(\"//Filter/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Filter/Name/text()\", xmlResponse);\n+            property1 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-Speed/text()\", xmlResponse);\n+            property2 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-Speed/text()\", xmlResponse);\n+            property3 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-RPM/text()\", xmlResponse);\n+            property4 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-RPM/text()\", xmlResponse);\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.FILTER);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPSPEED, property1.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPSPEED, property2.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPRPM, property3.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPRPM, property4.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_FILTER, names.get(i), properties);\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9bd8cd567e43404322b13b7ca7ee0ab5a3f8c13"}, "originalPosition": 190}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTI0MDY1MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        for (int i = 0; i < systemIDs.size(); i++) {\n          \n          \n            \n                            // get Body of Water for each item\n          \n          \n            \n                            bowID = bridgehandler.evaluateXPath(\n          \n          \n            \n                                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/System-Id/text()\",\n          \n          \n            \n                                    xmlResponse);\n          \n          \n            \n                            bowName = bridgehandler.evaluateXPath(\n          \n          \n            \n                                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/Name/text()\", xmlResponse);\n          \n          \n            \n            \n          \n          \n            \n                            properties.clear();\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.HEATER);\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n          \n          \n            \n            \n          \n          \n            \n                            onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_HEATER, names.get(i), properties);\n          \n          \n            \n                        }\n          \n          \n            \n                        discoverDevices(bridgehandler, xmlResponse, names, systemIDs, HaywardTypeToRequest.HEATER, HaywardBindingConstants.THING_TYPE_HEATER, false, null);", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r561240650", "createdAt": "2021-01-20T20:00:45Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/discovery/HaywardDiscoveryService.java", "diffHunk": "@@ -0,0 +1,332 @@\n+/**\n+ * Copyright (c) 2010-2021 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.discovery;\n+\n+import static org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants.THING_TYPES_UIDS;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.config.discovery.AbstractDiscoveryService;\n+import org.openhab.core.config.discovery.DiscoveryResult;\n+import org.openhab.core.config.discovery.DiscoveryResultBuilder;\n+import org.openhab.core.config.discovery.DiscoveryService;\n+import org.openhab.core.thing.ThingTypeUID;\n+import org.openhab.core.thing.ThingUID;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Sets up the discovery results and details\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+@NonNullByDefault\n+public class HaywardDiscoveryService extends AbstractDiscoveryService implements DiscoveryService, ThingHandlerService {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardDiscoveryService.class);\n+    private @Nullable HaywardBridgeHandler discoveryBridgehandler;\n+\n+    public HaywardDiscoveryService() {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    /**\n+     * Constructs a zone discovery service.\n+     * Registers this zone discovery service programmatically.\n+     * Call {@link ZoneDiscoveryService#destroy()} to unregister the service after use.\n+     */\n+    public HaywardDiscoveryService(HaywardBridgeHandler bridge) throws IllegalArgumentException {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    @Override\n+    public void activate() {\n+        super.activate(null);\n+    }\n+\n+    @Override\n+    public void deactivate() {\n+        super.deactivate();\n+    }\n+\n+    @Override\n+    protected void startScan() {\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        try {\n+            if (bridgehandler != null) {\n+                String xmlResults = bridgehandler.getMspConfig();\n+                mspConfigDiscovery(xmlResults);\n+            }\n+        } catch (HaywardException e) {\n+            logger.warn(\"Exception during discovery scan: {}\", e.getMessage());\n+        } catch (InterruptedException e) {\n+            return;\n+        }\n+    }\n+\n+    public synchronized boolean mspConfigDiscovery(String xmlResponse) {\n+        List<String> systemIDs = new ArrayList<>();\n+        List<String> names = new ArrayList<>();\n+        List<String> bowName = new ArrayList<>();\n+        List<String> bowID = new ArrayList<>();\n+        List<String> property1 = new ArrayList<>();\n+        List<String> property2 = new ArrayList<>();\n+        List<String> property3 = new ArrayList<>();\n+        List<String> property4 = new ArrayList<>();\n+        Map<String, Object> properties = new HashMap<>();\n+\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+\n+        if (bridgehandler != null) {\n+            // Find Backyard\n+            names = bridgehandler.evaluateXPath(\"//Backyard/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < names.size(); i++) {\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BACKYARD);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, bridgehandler.account.mspSystemID);\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BACKYARD, names.get(i), properties);\n+            }\n+\n+            // Find Bodies of Water\n+            systemIDs = bridgehandler.evaluateXPath(\"//Body-of-water/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Body-of-water/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BOW);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BOW, names.get(i), properties);\n+            }\n+\n+            // Find Chlorinators\n+            systemIDs = bridgehandler.evaluateXPath(\"//Chlorinator/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Chlorinator/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.CHLORINATOR);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_CHLORINATOR, names.get(i), properties);\n+            }\n+\n+            // Find ColorLogic Lights\n+            systemIDs = bridgehandler.evaluateXPath(\"//ColorLogic-Light/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//ColorLogic-Light/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.COLORLOGIC);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_CHLORINATOR, names.get(i), properties);\n+            }\n+\n+            // Find Filters\n+            systemIDs = bridgehandler.evaluateXPath(\"//Filter/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Filter/Name/text()\", xmlResponse);\n+            property1 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-Speed/text()\", xmlResponse);\n+            property2 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-Speed/text()\", xmlResponse);\n+            property3 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-RPM/text()\", xmlResponse);\n+            property4 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-RPM/text()\", xmlResponse);\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.FILTER);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPSPEED, property1.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPSPEED, property2.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPRPM, property3.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPRPM, property4.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_FILTER, names.get(i), properties);\n+            }\n+\n+            // Find Heaters\n+            systemIDs = bridgehandler.evaluateXPath(\"//Heater-Equipment/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Heater-Equipment/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/System-Id/text()\",\n+                        xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.HEATER);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_HEATER, names.get(i), properties);\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9bd8cd567e43404322b13b7ca7ee0ab5a3f8c13"}, "originalPosition": 211}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTI0MTI2MQ==", "bodyText": "I assume this code was left accidentally.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        names = bridgehandler.evaluateXPath(\"//Filter/Name/text()\", xmlResponse);\n          \n          \n            \n                        property1 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-Speed/text()\", xmlResponse);\n          \n          \n            \n                        property2 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-Speed/text()\", xmlResponse);\n          \n          \n            \n                        property3 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-RPM/text()\", xmlResponse);\n          \n          \n            \n                        property4 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-RPM/text()\", xmlResponse);", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r561241261", "createdAt": "2021-01-20T20:01:50Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/discovery/HaywardDiscoveryService.java", "diffHunk": "@@ -0,0 +1,332 @@\n+/**\n+ * Copyright (c) 2010-2021 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.discovery;\n+\n+import static org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants.THING_TYPES_UIDS;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.config.discovery.AbstractDiscoveryService;\n+import org.openhab.core.config.discovery.DiscoveryResult;\n+import org.openhab.core.config.discovery.DiscoveryResultBuilder;\n+import org.openhab.core.config.discovery.DiscoveryService;\n+import org.openhab.core.thing.ThingTypeUID;\n+import org.openhab.core.thing.ThingUID;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Sets up the discovery results and details\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+@NonNullByDefault\n+public class HaywardDiscoveryService extends AbstractDiscoveryService implements DiscoveryService, ThingHandlerService {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardDiscoveryService.class);\n+    private @Nullable HaywardBridgeHandler discoveryBridgehandler;\n+\n+    public HaywardDiscoveryService() {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    /**\n+     * Constructs a zone discovery service.\n+     * Registers this zone discovery service programmatically.\n+     * Call {@link ZoneDiscoveryService#destroy()} to unregister the service after use.\n+     */\n+    public HaywardDiscoveryService(HaywardBridgeHandler bridge) throws IllegalArgumentException {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    @Override\n+    public void activate() {\n+        super.activate(null);\n+    }\n+\n+    @Override\n+    public void deactivate() {\n+        super.deactivate();\n+    }\n+\n+    @Override\n+    protected void startScan() {\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        try {\n+            if (bridgehandler != null) {\n+                String xmlResults = bridgehandler.getMspConfig();\n+                mspConfigDiscovery(xmlResults);\n+            }\n+        } catch (HaywardException e) {\n+            logger.warn(\"Exception during discovery scan: {}\", e.getMessage());\n+        } catch (InterruptedException e) {\n+            return;\n+        }\n+    }\n+\n+    public synchronized boolean mspConfigDiscovery(String xmlResponse) {\n+        List<String> systemIDs = new ArrayList<>();\n+        List<String> names = new ArrayList<>();\n+        List<String> bowName = new ArrayList<>();\n+        List<String> bowID = new ArrayList<>();\n+        List<String> property1 = new ArrayList<>();\n+        List<String> property2 = new ArrayList<>();\n+        List<String> property3 = new ArrayList<>();\n+        List<String> property4 = new ArrayList<>();\n+        Map<String, Object> properties = new HashMap<>();\n+\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+\n+        if (bridgehandler != null) {\n+            // Find Backyard\n+            names = bridgehandler.evaluateXPath(\"//Backyard/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < names.size(); i++) {\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BACKYARD);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, bridgehandler.account.mspSystemID);\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BACKYARD, names.get(i), properties);\n+            }\n+\n+            // Find Bodies of Water\n+            systemIDs = bridgehandler.evaluateXPath(\"//Body-of-water/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Body-of-water/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BOW);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BOW, names.get(i), properties);\n+            }\n+\n+            // Find Chlorinators\n+            systemIDs = bridgehandler.evaluateXPath(\"//Chlorinator/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Chlorinator/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.CHLORINATOR);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_CHLORINATOR, names.get(i), properties);\n+            }\n+\n+            // Find ColorLogic Lights\n+            systemIDs = bridgehandler.evaluateXPath(\"//ColorLogic-Light/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//ColorLogic-Light/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.COLORLOGIC);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_CHLORINATOR, names.get(i), properties);\n+            }\n+\n+            // Find Filters\n+            systemIDs = bridgehandler.evaluateXPath(\"//Filter/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Filter/Name/text()\", xmlResponse);\n+            property1 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-Speed/text()\", xmlResponse);\n+            property2 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-Speed/text()\", xmlResponse);\n+            property3 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-RPM/text()\", xmlResponse);\n+            property4 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-RPM/text()\", xmlResponse);\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.FILTER);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPSPEED, property1.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPSPEED, property2.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPRPM, property3.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPRPM, property4.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_FILTER, names.get(i), properties);\n+            }\n+\n+            // Find Heaters\n+            systemIDs = bridgehandler.evaluateXPath(\"//Heater-Equipment/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Heater-Equipment/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/System-Id/text()\",\n+                        xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.HEATER);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_HEATER, names.get(i), properties);\n+            }\n+\n+            // Find Pumps\n+            systemIDs = bridgehandler.evaluateXPath(\"//Pump/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Pump/Name/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Filter/Name/text()\", xmlResponse);\n+            property1 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-Speed/text()\", xmlResponse);\n+            property2 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-Speed/text()\", xmlResponse);\n+            property3 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-RPM/text()\", xmlResponse);\n+            property4 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-RPM/text()\", xmlResponse);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9bd8cd567e43404322b13b7ca7ee0ab5a3f8c13"}, "originalPosition": 220}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTI0MTU5MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        for (int i = 0; i < systemIDs.size(); i++) {\n          \n          \n            \n                            // get Body of Water for each item\n          \n          \n            \n                            bowID = bridgehandler.evaluateXPath(\n          \n          \n            \n                                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/System-Id/text()\",\n          \n          \n            \n                                    xmlResponse);\n          \n          \n            \n                            bowName = bridgehandler.evaluateXPath(\n          \n          \n            \n                                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/Name/text()\", xmlResponse);\n          \n          \n            \n            \n          \n          \n            \n                            properties.clear();\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.PUMP);\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n          \n          \n            \n            \n          \n          \n            \n                            onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_PUMP, names.get(i), properties);\n          \n          \n            \n                        }\n          \n          \n            \n                        discoverDevices(bridgehandler, xmlResponse, names, systemIDs, HaywardTypeToRequest.PUMP, HaywardBindingConstants.THING_TYPE_PUMP, false, null);", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r561241590", "createdAt": "2021-01-20T20:02:27Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/discovery/HaywardDiscoveryService.java", "diffHunk": "@@ -0,0 +1,332 @@\n+/**\n+ * Copyright (c) 2010-2021 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.discovery;\n+\n+import static org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants.THING_TYPES_UIDS;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.config.discovery.AbstractDiscoveryService;\n+import org.openhab.core.config.discovery.DiscoveryResult;\n+import org.openhab.core.config.discovery.DiscoveryResultBuilder;\n+import org.openhab.core.config.discovery.DiscoveryService;\n+import org.openhab.core.thing.ThingTypeUID;\n+import org.openhab.core.thing.ThingUID;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Sets up the discovery results and details\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+@NonNullByDefault\n+public class HaywardDiscoveryService extends AbstractDiscoveryService implements DiscoveryService, ThingHandlerService {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardDiscoveryService.class);\n+    private @Nullable HaywardBridgeHandler discoveryBridgehandler;\n+\n+    public HaywardDiscoveryService() {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    /**\n+     * Constructs a zone discovery service.\n+     * Registers this zone discovery service programmatically.\n+     * Call {@link ZoneDiscoveryService#destroy()} to unregister the service after use.\n+     */\n+    public HaywardDiscoveryService(HaywardBridgeHandler bridge) throws IllegalArgumentException {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    @Override\n+    public void activate() {\n+        super.activate(null);\n+    }\n+\n+    @Override\n+    public void deactivate() {\n+        super.deactivate();\n+    }\n+\n+    @Override\n+    protected void startScan() {\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        try {\n+            if (bridgehandler != null) {\n+                String xmlResults = bridgehandler.getMspConfig();\n+                mspConfigDiscovery(xmlResults);\n+            }\n+        } catch (HaywardException e) {\n+            logger.warn(\"Exception during discovery scan: {}\", e.getMessage());\n+        } catch (InterruptedException e) {\n+            return;\n+        }\n+    }\n+\n+    public synchronized boolean mspConfigDiscovery(String xmlResponse) {\n+        List<String> systemIDs = new ArrayList<>();\n+        List<String> names = new ArrayList<>();\n+        List<String> bowName = new ArrayList<>();\n+        List<String> bowID = new ArrayList<>();\n+        List<String> property1 = new ArrayList<>();\n+        List<String> property2 = new ArrayList<>();\n+        List<String> property3 = new ArrayList<>();\n+        List<String> property4 = new ArrayList<>();\n+        Map<String, Object> properties = new HashMap<>();\n+\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+\n+        if (bridgehandler != null) {\n+            // Find Backyard\n+            names = bridgehandler.evaluateXPath(\"//Backyard/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < names.size(); i++) {\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BACKYARD);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, bridgehandler.account.mspSystemID);\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BACKYARD, names.get(i), properties);\n+            }\n+\n+            // Find Bodies of Water\n+            systemIDs = bridgehandler.evaluateXPath(\"//Body-of-water/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Body-of-water/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BOW);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BOW, names.get(i), properties);\n+            }\n+\n+            // Find Chlorinators\n+            systemIDs = bridgehandler.evaluateXPath(\"//Chlorinator/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Chlorinator/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.CHLORINATOR);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_CHLORINATOR, names.get(i), properties);\n+            }\n+\n+            // Find ColorLogic Lights\n+            systemIDs = bridgehandler.evaluateXPath(\"//ColorLogic-Light/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//ColorLogic-Light/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.COLORLOGIC);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_CHLORINATOR, names.get(i), properties);\n+            }\n+\n+            // Find Filters\n+            systemIDs = bridgehandler.evaluateXPath(\"//Filter/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Filter/Name/text()\", xmlResponse);\n+            property1 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-Speed/text()\", xmlResponse);\n+            property2 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-Speed/text()\", xmlResponse);\n+            property3 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-RPM/text()\", xmlResponse);\n+            property4 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-RPM/text()\", xmlResponse);\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.FILTER);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPSPEED, property1.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPSPEED, property2.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPRPM, property3.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPRPM, property4.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_FILTER, names.get(i), properties);\n+            }\n+\n+            // Find Heaters\n+            systemIDs = bridgehandler.evaluateXPath(\"//Heater-Equipment/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Heater-Equipment/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/System-Id/text()\",\n+                        xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.HEATER);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_HEATER, names.get(i), properties);\n+            }\n+\n+            // Find Pumps\n+            systemIDs = bridgehandler.evaluateXPath(\"//Pump/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Pump/Name/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Filter/Name/text()\", xmlResponse);\n+            property1 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-Speed/text()\", xmlResponse);\n+            property2 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-Speed/text()\", xmlResponse);\n+            property3 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-RPM/text()\", xmlResponse);\n+            property4 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-RPM/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/System-Id/text()\",\n+                        xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.PUMP);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_PUMP, names.get(i), properties);\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9bd8cd567e43404322b13b7ca7ee0ab5a3f8c13"}, "originalPosition": 237}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTI0MjAzNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        for (int i = 0; i < systemIDs.size(); i++) {\n          \n          \n            \n                            // get Body of Water for each item\n          \n          \n            \n                            bowID = bridgehandler.evaluateXPath(\n          \n          \n            \n                                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n          \n          \n            \n                            bowName = bridgehandler.evaluateXPath(\n          \n          \n            \n                                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n          \n          \n            \n            \n          \n          \n            \n                            properties.clear();\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.RELAY);\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(0));\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(0));\n          \n          \n            \n            \n          \n          \n            \n                            onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_RELAY, names.get(i), properties);\n          \n          \n            \n                        }\n          \n          \n            \n                        discoverDevices(bridgehandler, xmlResponse, names, systemIDs, HaywardTypeToRequest.RELAY, HaywardBindingConstants.THING_TYPE_RELAY, true, null);", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r561242037", "createdAt": "2021-01-20T20:03:18Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/discovery/HaywardDiscoveryService.java", "diffHunk": "@@ -0,0 +1,332 @@\n+/**\n+ * Copyright (c) 2010-2021 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.discovery;\n+\n+import static org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants.THING_TYPES_UIDS;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.config.discovery.AbstractDiscoveryService;\n+import org.openhab.core.config.discovery.DiscoveryResult;\n+import org.openhab.core.config.discovery.DiscoveryResultBuilder;\n+import org.openhab.core.config.discovery.DiscoveryService;\n+import org.openhab.core.thing.ThingTypeUID;\n+import org.openhab.core.thing.ThingUID;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Sets up the discovery results and details\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+@NonNullByDefault\n+public class HaywardDiscoveryService extends AbstractDiscoveryService implements DiscoveryService, ThingHandlerService {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardDiscoveryService.class);\n+    private @Nullable HaywardBridgeHandler discoveryBridgehandler;\n+\n+    public HaywardDiscoveryService() {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    /**\n+     * Constructs a zone discovery service.\n+     * Registers this zone discovery service programmatically.\n+     * Call {@link ZoneDiscoveryService#destroy()} to unregister the service after use.\n+     */\n+    public HaywardDiscoveryService(HaywardBridgeHandler bridge) throws IllegalArgumentException {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    @Override\n+    public void activate() {\n+        super.activate(null);\n+    }\n+\n+    @Override\n+    public void deactivate() {\n+        super.deactivate();\n+    }\n+\n+    @Override\n+    protected void startScan() {\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        try {\n+            if (bridgehandler != null) {\n+                String xmlResults = bridgehandler.getMspConfig();\n+                mspConfigDiscovery(xmlResults);\n+            }\n+        } catch (HaywardException e) {\n+            logger.warn(\"Exception during discovery scan: {}\", e.getMessage());\n+        } catch (InterruptedException e) {\n+            return;\n+        }\n+    }\n+\n+    public synchronized boolean mspConfigDiscovery(String xmlResponse) {\n+        List<String> systemIDs = new ArrayList<>();\n+        List<String> names = new ArrayList<>();\n+        List<String> bowName = new ArrayList<>();\n+        List<String> bowID = new ArrayList<>();\n+        List<String> property1 = new ArrayList<>();\n+        List<String> property2 = new ArrayList<>();\n+        List<String> property3 = new ArrayList<>();\n+        List<String> property4 = new ArrayList<>();\n+        Map<String, Object> properties = new HashMap<>();\n+\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+\n+        if (bridgehandler != null) {\n+            // Find Backyard\n+            names = bridgehandler.evaluateXPath(\"//Backyard/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < names.size(); i++) {\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BACKYARD);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, bridgehandler.account.mspSystemID);\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BACKYARD, names.get(i), properties);\n+            }\n+\n+            // Find Bodies of Water\n+            systemIDs = bridgehandler.evaluateXPath(\"//Body-of-water/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Body-of-water/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BOW);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BOW, names.get(i), properties);\n+            }\n+\n+            // Find Chlorinators\n+            systemIDs = bridgehandler.evaluateXPath(\"//Chlorinator/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Chlorinator/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.CHLORINATOR);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_CHLORINATOR, names.get(i), properties);\n+            }\n+\n+            // Find ColorLogic Lights\n+            systemIDs = bridgehandler.evaluateXPath(\"//ColorLogic-Light/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//ColorLogic-Light/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.COLORLOGIC);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_CHLORINATOR, names.get(i), properties);\n+            }\n+\n+            // Find Filters\n+            systemIDs = bridgehandler.evaluateXPath(\"//Filter/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Filter/Name/text()\", xmlResponse);\n+            property1 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-Speed/text()\", xmlResponse);\n+            property2 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-Speed/text()\", xmlResponse);\n+            property3 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-RPM/text()\", xmlResponse);\n+            property4 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-RPM/text()\", xmlResponse);\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.FILTER);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPSPEED, property1.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPSPEED, property2.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPRPM, property3.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPRPM, property4.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_FILTER, names.get(i), properties);\n+            }\n+\n+            // Find Heaters\n+            systemIDs = bridgehandler.evaluateXPath(\"//Heater-Equipment/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Heater-Equipment/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/System-Id/text()\",\n+                        xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.HEATER);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_HEATER, names.get(i), properties);\n+            }\n+\n+            // Find Pumps\n+            systemIDs = bridgehandler.evaluateXPath(\"//Pump/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Pump/Name/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Filter/Name/text()\", xmlResponse);\n+            property1 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-Speed/text()\", xmlResponse);\n+            property2 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-Speed/text()\", xmlResponse);\n+            property3 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-RPM/text()\", xmlResponse);\n+            property4 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-RPM/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/System-Id/text()\",\n+                        xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.PUMP);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_PUMP, names.get(i), properties);\n+            }\n+\n+            // Find Relays\n+            systemIDs = bridgehandler.evaluateXPath(\"//Relay/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Relay/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.RELAY);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(0));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(0));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_RELAY, names.get(i), properties);\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9bd8cd567e43404322b13b7ca7ee0ab5a3f8c13"}, "originalPosition": 257}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTI0NTQ2MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        systemIDs = bridgehandler.evaluateXPath(\"//Heater/System-Id/text()\", xmlResponse);\n          \n          \n            \n                        systemIDs = bridgehandler.evaluateXPath(\"//Heater/System-Id/text()\", xmlResponse);\n          \n          \n            \n                        //all virtual heaters have the same name.\n          \n          \n            \n                        names = new ArrayList<>(systemIDs);\n          \n          \n            \n                        Collections.fill(names, \"Heater\");", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r561245460", "createdAt": "2021-01-20T20:09:16Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/discovery/HaywardDiscoveryService.java", "diffHunk": "@@ -0,0 +1,332 @@\n+/**\n+ * Copyright (c) 2010-2021 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.discovery;\n+\n+import static org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants.THING_TYPES_UIDS;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.config.discovery.AbstractDiscoveryService;\n+import org.openhab.core.config.discovery.DiscoveryResult;\n+import org.openhab.core.config.discovery.DiscoveryResultBuilder;\n+import org.openhab.core.config.discovery.DiscoveryService;\n+import org.openhab.core.thing.ThingTypeUID;\n+import org.openhab.core.thing.ThingUID;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Sets up the discovery results and details\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+@NonNullByDefault\n+public class HaywardDiscoveryService extends AbstractDiscoveryService implements DiscoveryService, ThingHandlerService {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardDiscoveryService.class);\n+    private @Nullable HaywardBridgeHandler discoveryBridgehandler;\n+\n+    public HaywardDiscoveryService() {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    /**\n+     * Constructs a zone discovery service.\n+     * Registers this zone discovery service programmatically.\n+     * Call {@link ZoneDiscoveryService#destroy()} to unregister the service after use.\n+     */\n+    public HaywardDiscoveryService(HaywardBridgeHandler bridge) throws IllegalArgumentException {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    @Override\n+    public void activate() {\n+        super.activate(null);\n+    }\n+\n+    @Override\n+    public void deactivate() {\n+        super.deactivate();\n+    }\n+\n+    @Override\n+    protected void startScan() {\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        try {\n+            if (bridgehandler != null) {\n+                String xmlResults = bridgehandler.getMspConfig();\n+                mspConfigDiscovery(xmlResults);\n+            }\n+        } catch (HaywardException e) {\n+            logger.warn(\"Exception during discovery scan: {}\", e.getMessage());\n+        } catch (InterruptedException e) {\n+            return;\n+        }\n+    }\n+\n+    public synchronized boolean mspConfigDiscovery(String xmlResponse) {\n+        List<String> systemIDs = new ArrayList<>();\n+        List<String> names = new ArrayList<>();\n+        List<String> bowName = new ArrayList<>();\n+        List<String> bowID = new ArrayList<>();\n+        List<String> property1 = new ArrayList<>();\n+        List<String> property2 = new ArrayList<>();\n+        List<String> property3 = new ArrayList<>();\n+        List<String> property4 = new ArrayList<>();\n+        Map<String, Object> properties = new HashMap<>();\n+\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+\n+        if (bridgehandler != null) {\n+            // Find Backyard\n+            names = bridgehandler.evaluateXPath(\"//Backyard/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < names.size(); i++) {\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BACKYARD);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, bridgehandler.account.mspSystemID);\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BACKYARD, names.get(i), properties);\n+            }\n+\n+            // Find Bodies of Water\n+            systemIDs = bridgehandler.evaluateXPath(\"//Body-of-water/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Body-of-water/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BOW);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BOW, names.get(i), properties);\n+            }\n+\n+            // Find Chlorinators\n+            systemIDs = bridgehandler.evaluateXPath(\"//Chlorinator/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Chlorinator/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.CHLORINATOR);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_CHLORINATOR, names.get(i), properties);\n+            }\n+\n+            // Find ColorLogic Lights\n+            systemIDs = bridgehandler.evaluateXPath(\"//ColorLogic-Light/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//ColorLogic-Light/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.COLORLOGIC);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_CHLORINATOR, names.get(i), properties);\n+            }\n+\n+            // Find Filters\n+            systemIDs = bridgehandler.evaluateXPath(\"//Filter/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Filter/Name/text()\", xmlResponse);\n+            property1 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-Speed/text()\", xmlResponse);\n+            property2 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-Speed/text()\", xmlResponse);\n+            property3 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-RPM/text()\", xmlResponse);\n+            property4 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-RPM/text()\", xmlResponse);\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.FILTER);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPSPEED, property1.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPSPEED, property2.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPRPM, property3.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPRPM, property4.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_FILTER, names.get(i), properties);\n+            }\n+\n+            // Find Heaters\n+            systemIDs = bridgehandler.evaluateXPath(\"//Heater-Equipment/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Heater-Equipment/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/System-Id/text()\",\n+                        xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.HEATER);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_HEATER, names.get(i), properties);\n+            }\n+\n+            // Find Pumps\n+            systemIDs = bridgehandler.evaluateXPath(\"//Pump/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Pump/Name/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Filter/Name/text()\", xmlResponse);\n+            property1 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-Speed/text()\", xmlResponse);\n+            property2 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-Speed/text()\", xmlResponse);\n+            property3 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-RPM/text()\", xmlResponse);\n+            property4 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-RPM/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/System-Id/text()\",\n+                        xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.PUMP);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_PUMP, names.get(i), properties);\n+            }\n+\n+            // Find Relays\n+            systemIDs = bridgehandler.evaluateXPath(\"//Relay/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Relay/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.RELAY);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(0));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(0));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_RELAY, names.get(i), properties);\n+            }\n+\n+            // Find Virtual Heaters\n+            systemIDs = bridgehandler.evaluateXPath(\"//Heater/System-Id/text()\", xmlResponse);\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9bd8cd567e43404322b13b7ca7ee0ab5a3f8c13"}, "originalPosition": 261}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTI0Njk2MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        for (int i = 0; i < systemIDs.size(); i++) {\n          \n          \n            \n                            // get Body of Water for each item\n          \n          \n            \n                            bowID = bridgehandler.evaluateXPath(\n          \n          \n            \n                                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n          \n          \n            \n                            bowName = bridgehandler.evaluateXPath(\n          \n          \n            \n                                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n          \n          \n            \n            \n          \n          \n            \n                            properties.clear();\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.VIRTUALHEATER);\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n          \n          \n            \n                            properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n          \n          \n            \n            \n          \n          \n            \n                            onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_VIRTUALHEATER, \"Heater\", properties);\n          \n          \n            \n                        }\n          \n          \n            \n                        discoverDevices(bridgehandler, xmlResponse, names, systemIDs, HaywardTypeToRequest.VIRTUALHEATER, HaywardBindingConstants.THING_TYPE_VIRTUALHEATER, false, null);", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r561246960", "createdAt": "2021-01-20T20:10:59Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/discovery/HaywardDiscoveryService.java", "diffHunk": "@@ -0,0 +1,332 @@\n+/**\n+ * Copyright (c) 2010-2021 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.discovery;\n+\n+import static org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants.THING_TYPES_UIDS;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.config.discovery.AbstractDiscoveryService;\n+import org.openhab.core.config.discovery.DiscoveryResult;\n+import org.openhab.core.config.discovery.DiscoveryResultBuilder;\n+import org.openhab.core.config.discovery.DiscoveryService;\n+import org.openhab.core.thing.ThingTypeUID;\n+import org.openhab.core.thing.ThingUID;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Sets up the discovery results and details\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+@NonNullByDefault\n+public class HaywardDiscoveryService extends AbstractDiscoveryService implements DiscoveryService, ThingHandlerService {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardDiscoveryService.class);\n+    private @Nullable HaywardBridgeHandler discoveryBridgehandler;\n+\n+    public HaywardDiscoveryService() {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    /**\n+     * Constructs a zone discovery service.\n+     * Registers this zone discovery service programmatically.\n+     * Call {@link ZoneDiscoveryService#destroy()} to unregister the service after use.\n+     */\n+    public HaywardDiscoveryService(HaywardBridgeHandler bridge) throws IllegalArgumentException {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    @Override\n+    public void activate() {\n+        super.activate(null);\n+    }\n+\n+    @Override\n+    public void deactivate() {\n+        super.deactivate();\n+    }\n+\n+    @Override\n+    protected void startScan() {\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        try {\n+            if (bridgehandler != null) {\n+                String xmlResults = bridgehandler.getMspConfig();\n+                mspConfigDiscovery(xmlResults);\n+            }\n+        } catch (HaywardException e) {\n+            logger.warn(\"Exception during discovery scan: {}\", e.getMessage());\n+        } catch (InterruptedException e) {\n+            return;\n+        }\n+    }\n+\n+    public synchronized boolean mspConfigDiscovery(String xmlResponse) {\n+        List<String> systemIDs = new ArrayList<>();\n+        List<String> names = new ArrayList<>();\n+        List<String> bowName = new ArrayList<>();\n+        List<String> bowID = new ArrayList<>();\n+        List<String> property1 = new ArrayList<>();\n+        List<String> property2 = new ArrayList<>();\n+        List<String> property3 = new ArrayList<>();\n+        List<String> property4 = new ArrayList<>();\n+        Map<String, Object> properties = new HashMap<>();\n+\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+\n+        if (bridgehandler != null) {\n+            // Find Backyard\n+            names = bridgehandler.evaluateXPath(\"//Backyard/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < names.size(); i++) {\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BACKYARD);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, bridgehandler.account.mspSystemID);\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BACKYARD, names.get(i), properties);\n+            }\n+\n+            // Find Bodies of Water\n+            systemIDs = bridgehandler.evaluateXPath(\"//Body-of-water/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Body-of-water/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BOW);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BOW, names.get(i), properties);\n+            }\n+\n+            // Find Chlorinators\n+            systemIDs = bridgehandler.evaluateXPath(\"//Chlorinator/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Chlorinator/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.CHLORINATOR);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_CHLORINATOR, names.get(i), properties);\n+            }\n+\n+            // Find ColorLogic Lights\n+            systemIDs = bridgehandler.evaluateXPath(\"//ColorLogic-Light/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//ColorLogic-Light/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.COLORLOGIC);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_CHLORINATOR, names.get(i), properties);\n+            }\n+\n+            // Find Filters\n+            systemIDs = bridgehandler.evaluateXPath(\"//Filter/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Filter/Name/text()\", xmlResponse);\n+            property1 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-Speed/text()\", xmlResponse);\n+            property2 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-Speed/text()\", xmlResponse);\n+            property3 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-RPM/text()\", xmlResponse);\n+            property4 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-RPM/text()\", xmlResponse);\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.FILTER);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPSPEED, property1.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPSPEED, property2.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPRPM, property3.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPRPM, property4.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_FILTER, names.get(i), properties);\n+            }\n+\n+            // Find Heaters\n+            systemIDs = bridgehandler.evaluateXPath(\"//Heater-Equipment/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Heater-Equipment/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/System-Id/text()\",\n+                        xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.HEATER);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_HEATER, names.get(i), properties);\n+            }\n+\n+            // Find Pumps\n+            systemIDs = bridgehandler.evaluateXPath(\"//Pump/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Pump/Name/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Filter/Name/text()\", xmlResponse);\n+            property1 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-Speed/text()\", xmlResponse);\n+            property2 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-Speed/text()\", xmlResponse);\n+            property3 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-RPM/text()\", xmlResponse);\n+            property4 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-RPM/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/System-Id/text()\",\n+                        xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.PUMP);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_PUMP, names.get(i), properties);\n+            }\n+\n+            // Find Relays\n+            systemIDs = bridgehandler.evaluateXPath(\"//Relay/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Relay/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.RELAY);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(0));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(0));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_RELAY, names.get(i), properties);\n+            }\n+\n+            // Find Virtual Heaters\n+            systemIDs = bridgehandler.evaluateXPath(\"//Heater/System-Id/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.VIRTUALHEATER);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_VIRTUALHEATER, \"Heater\", properties);\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9bd8cd567e43404322b13b7ca7ee0ab5a3f8c13"}, "originalPosition": 276}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTI0ODIzMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        for (int i = 0; i < systemIDs.size(); i++) {\n          \n          \n            \n                            // get Body of Water for each item\n          \n          \n            \n                            bowID = bridgehandler.evaluateXPath(\n          \n          \n            \n                                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n          \n          \n            \n                            bowName = bridgehandler.evaluateXPath(\n          \n          \n            \n                                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n          \n          \n            \n                            // Do not add backyard sensors that do not exist in the BOW thus bowID is null\n          \n          \n            \n                            if (!(bowID.isEmpty())) {\n          \n          \n            \n                                properties.clear();\n          \n          \n            \n                                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.SENSOR);\n          \n          \n            \n                                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n          \n          \n            \n                                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(0));\n          \n          \n            \n                                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(0));\n          \n          \n            \n            \n          \n          \n            \n                                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_SENSOR, names.get(i), properties);\n          \n          \n            \n                            }\n          \n          \n            \n                        }\n          \n          \n            \n                        discoverDevices(bridgehandler, xmlResponse, names, systemIDs, HaywardTypeToRequest.SENSOR, HaywardBindingConstants.THING_TYPE_SENSOR, true, null);", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r561248232", "createdAt": "2021-01-20T20:12:02Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/discovery/HaywardDiscoveryService.java", "diffHunk": "@@ -0,0 +1,332 @@\n+/**\n+ * Copyright (c) 2010-2021 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.discovery;\n+\n+import static org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants.THING_TYPES_UIDS;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.config.discovery.AbstractDiscoveryService;\n+import org.openhab.core.config.discovery.DiscoveryResult;\n+import org.openhab.core.config.discovery.DiscoveryResultBuilder;\n+import org.openhab.core.config.discovery.DiscoveryService;\n+import org.openhab.core.thing.ThingTypeUID;\n+import org.openhab.core.thing.ThingUID;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Sets up the discovery results and details\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+@NonNullByDefault\n+public class HaywardDiscoveryService extends AbstractDiscoveryService implements DiscoveryService, ThingHandlerService {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardDiscoveryService.class);\n+    private @Nullable HaywardBridgeHandler discoveryBridgehandler;\n+\n+    public HaywardDiscoveryService() {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    /**\n+     * Constructs a zone discovery service.\n+     * Registers this zone discovery service programmatically.\n+     * Call {@link ZoneDiscoveryService#destroy()} to unregister the service after use.\n+     */\n+    public HaywardDiscoveryService(HaywardBridgeHandler bridge) throws IllegalArgumentException {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    @Override\n+    public void activate() {\n+        super.activate(null);\n+    }\n+\n+    @Override\n+    public void deactivate() {\n+        super.deactivate();\n+    }\n+\n+    @Override\n+    protected void startScan() {\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        try {\n+            if (bridgehandler != null) {\n+                String xmlResults = bridgehandler.getMspConfig();\n+                mspConfigDiscovery(xmlResults);\n+            }\n+        } catch (HaywardException e) {\n+            logger.warn(\"Exception during discovery scan: {}\", e.getMessage());\n+        } catch (InterruptedException e) {\n+            return;\n+        }\n+    }\n+\n+    public synchronized boolean mspConfigDiscovery(String xmlResponse) {\n+        List<String> systemIDs = new ArrayList<>();\n+        List<String> names = new ArrayList<>();\n+        List<String> bowName = new ArrayList<>();\n+        List<String> bowID = new ArrayList<>();\n+        List<String> property1 = new ArrayList<>();\n+        List<String> property2 = new ArrayList<>();\n+        List<String> property3 = new ArrayList<>();\n+        List<String> property4 = new ArrayList<>();\n+        Map<String, Object> properties = new HashMap<>();\n+\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+\n+        if (bridgehandler != null) {\n+            // Find Backyard\n+            names = bridgehandler.evaluateXPath(\"//Backyard/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < names.size(); i++) {\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BACKYARD);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, bridgehandler.account.mspSystemID);\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BACKYARD, names.get(i), properties);\n+            }\n+\n+            // Find Bodies of Water\n+            systemIDs = bridgehandler.evaluateXPath(\"//Body-of-water/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Body-of-water/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BOW);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BOW, names.get(i), properties);\n+            }\n+\n+            // Find Chlorinators\n+            systemIDs = bridgehandler.evaluateXPath(\"//Chlorinator/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Chlorinator/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.CHLORINATOR);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_CHLORINATOR, names.get(i), properties);\n+            }\n+\n+            // Find ColorLogic Lights\n+            systemIDs = bridgehandler.evaluateXPath(\"//ColorLogic-Light/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//ColorLogic-Light/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.COLORLOGIC);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_CHLORINATOR, names.get(i), properties);\n+            }\n+\n+            // Find Filters\n+            systemIDs = bridgehandler.evaluateXPath(\"//Filter/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Filter/Name/text()\", xmlResponse);\n+            property1 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-Speed/text()\", xmlResponse);\n+            property2 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-Speed/text()\", xmlResponse);\n+            property3 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-RPM/text()\", xmlResponse);\n+            property4 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-RPM/text()\", xmlResponse);\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.FILTER);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPSPEED, property1.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPSPEED, property2.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPRPM, property3.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPRPM, property4.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_FILTER, names.get(i), properties);\n+            }\n+\n+            // Find Heaters\n+            systemIDs = bridgehandler.evaluateXPath(\"//Heater-Equipment/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Heater-Equipment/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/System-Id/text()\",\n+                        xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.HEATER);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_HEATER, names.get(i), properties);\n+            }\n+\n+            // Find Pumps\n+            systemIDs = bridgehandler.evaluateXPath(\"//Pump/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Pump/Name/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Filter/Name/text()\", xmlResponse);\n+            property1 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-Speed/text()\", xmlResponse);\n+            property2 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-Speed/text()\", xmlResponse);\n+            property3 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-RPM/text()\", xmlResponse);\n+            property4 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-RPM/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/System-Id/text()\",\n+                        xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.PUMP);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_PUMP, names.get(i), properties);\n+            }\n+\n+            // Find Relays\n+            systemIDs = bridgehandler.evaluateXPath(\"//Relay/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Relay/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.RELAY);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(0));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(0));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_RELAY, names.get(i), properties);\n+            }\n+\n+            // Find Virtual Heaters\n+            systemIDs = bridgehandler.evaluateXPath(\"//Heater/System-Id/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.VIRTUALHEATER);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_VIRTUALHEATER, \"Heater\", properties);\n+            }\n+\n+            // Find Sensors\n+            // Flow and water temp sensor aren't showing up in telemetry. Need example to determine how to differentiate\n+            // \"system\" sensors\n+            // that are reported in the BOW water temp, Filter flow switch, ORP, etc.\n+            systemIDs = bridgehandler.evaluateXPath(\"//Sensor/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Sensor/Name/text()\", xmlResponse);\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+                // Do not add backyard sensors that do not exist in the BOW thus bowID is null\n+                if (!(bowID.isEmpty())) {\n+                    properties.clear();\n+                    properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.SENSOR);\n+                    properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                    properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(0));\n+                    properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(0));\n+\n+                    onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_SENSOR, names.get(i), properties);\n+                }\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9bd8cd567e43404322b13b7ca7ee0ab5a3f8c13"}, "originalPosition": 300}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTI1NDg4MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n          \n          \n            \n                    return bridgehandler;\n          \n          \n            \n                    return discoveryBridgehandler;", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r561254880", "createdAt": "2021-01-20T20:17:22Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/discovery/HaywardDiscoveryService.java", "diffHunk": "@@ -0,0 +1,332 @@\n+/**\n+ * Copyright (c) 2010-2021 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.discovery;\n+\n+import static org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants.THING_TYPES_UIDS;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.config.discovery.AbstractDiscoveryService;\n+import org.openhab.core.config.discovery.DiscoveryResult;\n+import org.openhab.core.config.discovery.DiscoveryResultBuilder;\n+import org.openhab.core.config.discovery.DiscoveryService;\n+import org.openhab.core.thing.ThingTypeUID;\n+import org.openhab.core.thing.ThingUID;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Sets up the discovery results and details\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+@NonNullByDefault\n+public class HaywardDiscoveryService extends AbstractDiscoveryService implements DiscoveryService, ThingHandlerService {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardDiscoveryService.class);\n+    private @Nullable HaywardBridgeHandler discoveryBridgehandler;\n+\n+    public HaywardDiscoveryService() {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    /**\n+     * Constructs a zone discovery service.\n+     * Registers this zone discovery service programmatically.\n+     * Call {@link ZoneDiscoveryService#destroy()} to unregister the service after use.\n+     */\n+    public HaywardDiscoveryService(HaywardBridgeHandler bridge) throws IllegalArgumentException {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    @Override\n+    public void activate() {\n+        super.activate(null);\n+    }\n+\n+    @Override\n+    public void deactivate() {\n+        super.deactivate();\n+    }\n+\n+    @Override\n+    protected void startScan() {\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        try {\n+            if (bridgehandler != null) {\n+                String xmlResults = bridgehandler.getMspConfig();\n+                mspConfigDiscovery(xmlResults);\n+            }\n+        } catch (HaywardException e) {\n+            logger.warn(\"Exception during discovery scan: {}\", e.getMessage());\n+        } catch (InterruptedException e) {\n+            return;\n+        }\n+    }\n+\n+    public synchronized boolean mspConfigDiscovery(String xmlResponse) {\n+        List<String> systemIDs = new ArrayList<>();\n+        List<String> names = new ArrayList<>();\n+        List<String> bowName = new ArrayList<>();\n+        List<String> bowID = new ArrayList<>();\n+        List<String> property1 = new ArrayList<>();\n+        List<String> property2 = new ArrayList<>();\n+        List<String> property3 = new ArrayList<>();\n+        List<String> property4 = new ArrayList<>();\n+        Map<String, Object> properties = new HashMap<>();\n+\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+\n+        if (bridgehandler != null) {\n+            // Find Backyard\n+            names = bridgehandler.evaluateXPath(\"//Backyard/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < names.size(); i++) {\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BACKYARD);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, bridgehandler.account.mspSystemID);\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BACKYARD, names.get(i), properties);\n+            }\n+\n+            // Find Bodies of Water\n+            systemIDs = bridgehandler.evaluateXPath(\"//Body-of-water/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Body-of-water/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BOW);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BOW, names.get(i), properties);\n+            }\n+\n+            // Find Chlorinators\n+            systemIDs = bridgehandler.evaluateXPath(\"//Chlorinator/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Chlorinator/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.CHLORINATOR);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_CHLORINATOR, names.get(i), properties);\n+            }\n+\n+            // Find ColorLogic Lights\n+            systemIDs = bridgehandler.evaluateXPath(\"//ColorLogic-Light/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//ColorLogic-Light/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.COLORLOGIC);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_CHLORINATOR, names.get(i), properties);\n+            }\n+\n+            // Find Filters\n+            systemIDs = bridgehandler.evaluateXPath(\"//Filter/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Filter/Name/text()\", xmlResponse);\n+            property1 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-Speed/text()\", xmlResponse);\n+            property2 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-Speed/text()\", xmlResponse);\n+            property3 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-RPM/text()\", xmlResponse);\n+            property4 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-RPM/text()\", xmlResponse);\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.FILTER);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPSPEED, property1.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPSPEED, property2.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPRPM, property3.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPRPM, property4.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_FILTER, names.get(i), properties);\n+            }\n+\n+            // Find Heaters\n+            systemIDs = bridgehandler.evaluateXPath(\"//Heater-Equipment/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Heater-Equipment/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/System-Id/text()\",\n+                        xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.HEATER);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_HEATER, names.get(i), properties);\n+            }\n+\n+            // Find Pumps\n+            systemIDs = bridgehandler.evaluateXPath(\"//Pump/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Pump/Name/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Filter/Name/text()\", xmlResponse);\n+            property1 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-Speed/text()\", xmlResponse);\n+            property2 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-Speed/text()\", xmlResponse);\n+            property3 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-RPM/text()\", xmlResponse);\n+            property4 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-RPM/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/System-Id/text()\",\n+                        xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.PUMP);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_PUMP, names.get(i), properties);\n+            }\n+\n+            // Find Relays\n+            systemIDs = bridgehandler.evaluateXPath(\"//Relay/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Relay/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.RELAY);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(0));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(0));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_RELAY, names.get(i), properties);\n+            }\n+\n+            // Find Virtual Heaters\n+            systemIDs = bridgehandler.evaluateXPath(\"//Heater/System-Id/text()\", xmlResponse);\n+\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.VIRTUALHEATER);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(i));\n+                properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(i));\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_VIRTUALHEATER, \"Heater\", properties);\n+            }\n+\n+            // Find Sensors\n+            // Flow and water temp sensor aren't showing up in telemetry. Need example to determine how to differentiate\n+            // \"system\" sensors\n+            // that are reported in the BOW water temp, Filter flow switch, ORP, etc.\n+            systemIDs = bridgehandler.evaluateXPath(\"//Sensor/System-Id/text()\", xmlResponse);\n+            names = bridgehandler.evaluateXPath(\"//Sensor/Name/text()\", xmlResponse);\n+            for (int i = 0; i < systemIDs.size(); i++) {\n+                // get Body of Water for each item\n+                bowID = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/System-Id/text()\", xmlResponse);\n+                bowName = bridgehandler.evaluateXPath(\n+                        \"//*[System-Id=\" + systemIDs.get(i) + \"]/parent::Body-of-water/Name/text()\", xmlResponse);\n+                // Do not add backyard sensors that do not exist in the BOW thus bowID is null\n+                if (!(bowID.isEmpty())) {\n+                    properties.clear();\n+                    properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.SENSOR);\n+                    properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+                    properties.put(HaywardBindingConstants.PROPERTY_BOWID, bowID.get(0));\n+                    properties.put(HaywardBindingConstants.PROPERTY_BOWNAME, bowName.get(0));\n+\n+                    onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_SENSOR, names.get(i), properties);\n+                }\n+            }\n+        }\n+        return true;\n+    }\n+\n+    public void onDeviceDiscovered(ThingTypeUID thingType, String label, Map<String, Object> properties) {\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        String systemID = (String) properties.get(HaywardBindingConstants.PROPERTY_SYSTEM_ID);\n+        if (bridgehandler != null) {\n+            if (systemID != null) {\n+                ThingUID thingUID = new ThingUID(thingType, bridgehandler.getThing().getUID(), systemID);\n+                DiscoveryResult result = DiscoveryResultBuilder.create(thingUID)\n+                        .withBridge(bridgehandler.getThing().getUID())\n+                        .withRepresentationProperty(HaywardBindingConstants.PROPERTY_SYSTEM_ID)\n+                        .withLabel(\"Hayward \" + label).withProperties(properties).build();\n+                thingDiscovered(result);\n+            }\n+        }\n+    }\n+\n+    @Override\n+    public void setThingHandler(@Nullable ThingHandler handler) {\n+        if (handler instanceof HaywardBridgeHandler) {\n+            this.discoveryBridgehandler = (HaywardBridgeHandler) handler;\n+        }\n+    }\n+\n+    @Override\n+    public @Nullable ThingHandler getThingHandler() {\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        return bridgehandler;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9bd8cd567e43404322b13b7ca7ee0ab5a3f8c13"}, "originalPosition": 330}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTI1ODI2MA==", "bodyText": "If system id is your representation property for a backyard, then this code would only be able to discover a single backyard since all backyard things would be assigned the same system id.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r561258260", "createdAt": "2021-01-20T20:20:06Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/discovery/HaywardDiscoveryService.java", "diffHunk": "@@ -0,0 +1,332 @@\n+/**\n+ * Copyright (c) 2010-2021 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.discovery;\n+\n+import static org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants.THING_TYPES_UIDS;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.config.discovery.AbstractDiscoveryService;\n+import org.openhab.core.config.discovery.DiscoveryResult;\n+import org.openhab.core.config.discovery.DiscoveryResultBuilder;\n+import org.openhab.core.config.discovery.DiscoveryService;\n+import org.openhab.core.thing.ThingTypeUID;\n+import org.openhab.core.thing.ThingUID;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Sets up the discovery results and details\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+@NonNullByDefault\n+public class HaywardDiscoveryService extends AbstractDiscoveryService implements DiscoveryService, ThingHandlerService {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardDiscoveryService.class);\n+    private @Nullable HaywardBridgeHandler discoveryBridgehandler;\n+\n+    public HaywardDiscoveryService() {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    /**\n+     * Constructs a zone discovery service.\n+     * Registers this zone discovery service programmatically.\n+     * Call {@link ZoneDiscoveryService#destroy()} to unregister the service after use.\n+     */\n+    public HaywardDiscoveryService(HaywardBridgeHandler bridge) throws IllegalArgumentException {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    @Override\n+    public void activate() {\n+        super.activate(null);\n+    }\n+\n+    @Override\n+    public void deactivate() {\n+        super.deactivate();\n+    }\n+\n+    @Override\n+    protected void startScan() {\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        try {\n+            if (bridgehandler != null) {\n+                String xmlResults = bridgehandler.getMspConfig();\n+                mspConfigDiscovery(xmlResults);\n+            }\n+        } catch (HaywardException e) {\n+            logger.warn(\"Exception during discovery scan: {}\", e.getMessage());\n+        } catch (InterruptedException e) {\n+            return;\n+        }\n+    }\n+\n+    public synchronized boolean mspConfigDiscovery(String xmlResponse) {\n+        List<String> systemIDs = new ArrayList<>();\n+        List<String> names = new ArrayList<>();\n+        List<String> bowName = new ArrayList<>();\n+        List<String> bowID = new ArrayList<>();\n+        List<String> property1 = new ArrayList<>();\n+        List<String> property2 = new ArrayList<>();\n+        List<String> property3 = new ArrayList<>();\n+        List<String> property4 = new ArrayList<>();\n+        Map<String, Object> properties = new HashMap<>();\n+\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+\n+        if (bridgehandler != null) {\n+            // Find Backyard\n+            names = bridgehandler.evaluateXPath(\"//Backyard/Name/text()\", xmlResponse);\n+\n+            for (int i = 0; i < names.size(); i++) {\n+                properties.clear();\n+                properties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BACKYARD);\n+                properties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, bridgehandler.account.mspSystemID);\n+\n+                onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BACKYARD, names.get(i), properties);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9bd8cd567e43404322b13b7ca7ee0ab5a3f8c13"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTI2MDM2NQ==", "bodyText": "Rather than have all of your code get nested in an if block, you might consider just returning early instead.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n          \n          \n            \n            \n          \n          \n            \n                    if (bridgehandler != null) {\n          \n          \n            \n                        // Find Backyard\n          \n          \n            \n                    HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n          \n          \n            \n            \n          \n          \n            \n                    if (bridgehandler == null) {\n          \n          \n            \n                        return;\n          \n          \n            \n                    }", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r561260365", "createdAt": "2021-01-20T20:21:51Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/discovery/HaywardDiscoveryService.java", "diffHunk": "@@ -0,0 +1,332 @@\n+/**\n+ * Copyright (c) 2010-2021 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.discovery;\n+\n+import static org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants.THING_TYPES_UIDS;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.config.discovery.AbstractDiscoveryService;\n+import org.openhab.core.config.discovery.DiscoveryResult;\n+import org.openhab.core.config.discovery.DiscoveryResultBuilder;\n+import org.openhab.core.config.discovery.DiscoveryService;\n+import org.openhab.core.thing.ThingTypeUID;\n+import org.openhab.core.thing.ThingUID;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Sets up the discovery results and details\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+@NonNullByDefault\n+public class HaywardDiscoveryService extends AbstractDiscoveryService implements DiscoveryService, ThingHandlerService {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardDiscoveryService.class);\n+    private @Nullable HaywardBridgeHandler discoveryBridgehandler;\n+\n+    public HaywardDiscoveryService() {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    /**\n+     * Constructs a zone discovery service.\n+     * Registers this zone discovery service programmatically.\n+     * Call {@link ZoneDiscoveryService#destroy()} to unregister the service after use.\n+     */\n+    public HaywardDiscoveryService(HaywardBridgeHandler bridge) throws IllegalArgumentException {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    @Override\n+    public void activate() {\n+        super.activate(null);\n+    }\n+\n+    @Override\n+    public void deactivate() {\n+        super.deactivate();\n+    }\n+\n+    @Override\n+    protected void startScan() {\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        try {\n+            if (bridgehandler != null) {\n+                String xmlResults = bridgehandler.getMspConfig();\n+                mspConfigDiscovery(xmlResults);\n+            }\n+        } catch (HaywardException e) {\n+            logger.warn(\"Exception during discovery scan: {}\", e.getMessage());\n+        } catch (InterruptedException e) {\n+            return;\n+        }\n+    }\n+\n+    public synchronized boolean mspConfigDiscovery(String xmlResponse) {\n+        List<String> systemIDs = new ArrayList<>();\n+        List<String> names = new ArrayList<>();\n+        List<String> bowName = new ArrayList<>();\n+        List<String> bowID = new ArrayList<>();\n+        List<String> property1 = new ArrayList<>();\n+        List<String> property2 = new ArrayList<>();\n+        List<String> property3 = new ArrayList<>();\n+        List<String> property4 = new ArrayList<>();\n+        Map<String, Object> properties = new HashMap<>();\n+\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+\n+        if (bridgehandler != null) {\n+            // Find Backyard", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9bd8cd567e43404322b13b7ca7ee0ab5a3f8c13"}, "originalPosition": 102}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTI2MjA0NQ==", "bodyText": "Is this constructor used? It doesn't seem you are using the parameter that is passed in.", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r561262045", "createdAt": "2021-01-20T20:23:12Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/discovery/HaywardDiscoveryService.java", "diffHunk": "@@ -0,0 +1,332 @@\n+/**\n+ * Copyright (c) 2010-2021 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.discovery;\n+\n+import static org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants.THING_TYPES_UIDS;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.config.discovery.AbstractDiscoveryService;\n+import org.openhab.core.config.discovery.DiscoveryResult;\n+import org.openhab.core.config.discovery.DiscoveryResultBuilder;\n+import org.openhab.core.config.discovery.DiscoveryService;\n+import org.openhab.core.thing.ThingTypeUID;\n+import org.openhab.core.thing.ThingUID;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Sets up the discovery results and details\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+@NonNullByDefault\n+public class HaywardDiscoveryService extends AbstractDiscoveryService implements DiscoveryService, ThingHandlerService {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardDiscoveryService.class);\n+    private @Nullable HaywardBridgeHandler discoveryBridgehandler;\n+\n+    public HaywardDiscoveryService() {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    /**\n+     * Constructs a zone discovery service.\n+     * Registers this zone discovery service programmatically.\n+     * Call {@link ZoneDiscoveryService#destroy()} to unregister the service after use.\n+     */\n+    public HaywardDiscoveryService(HaywardBridgeHandler bridge) throws IllegalArgumentException {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9bd8cd567e43404322b13b7ca7ee0ab5a3f8c13"}, "originalPosition": 61}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTczODkwNjc3", "url": "https://github.com/openhab/openhab-addons/pull/8685#pullrequestreview-573890677", "createdAt": "2021-01-22T01:55:50Z", "commit": {"oid": "1ac14b0332ed101f0a7e571414ce466fe1aa63bb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMlQwMTo1NTo1MFrOIYRKXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMlQwMTo1NzoyNlrOIYRMYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjMxNzkxNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        List<String> bowName = new ArrayList<>();\n          \n          \n            \n                        List<String> bowID = new ArrayList<>();\n          \n          \n            \n            \n          \n          \n            \n                        // get Body of Water for each item\n          \n          \n            \n                        bowID = bridgehandler.evaluateXPath(\n          \n          \n            \n                                \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/System-Id/text()\", xmlResponse);\n          \n          \n            \n                        bowName = bridgehandler.evaluateXPath(\n          \n          \n            \n                                \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/Name/text()\", xmlResponse);\n          \n          \n            \n                        // get Body of Water for each item\n          \n          \n            \n                        List<String> bowID = bridgehandler.evaluateXPath(\n          \n          \n            \n                                \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/System-Id/text()\", xmlResponse);\n          \n          \n            \n                        List<String> bowName = bridgehandler.evaluateXPath(\n          \n          \n            \n                                \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/Name/text()\", xmlResponse);", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r562317916", "createdAt": "2021-01-22T01:55:50Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/discovery/HaywardDiscoveryService.java", "diffHunk": "@@ -0,0 +1,238 @@\n+/**\n+ * Copyright (c) 2010-2021 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.discovery;\n+\n+import static org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants.THING_TYPES_UIDS;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.function.BiConsumer;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.config.discovery.AbstractDiscoveryService;\n+import org.openhab.core.config.discovery.DiscoveryResult;\n+import org.openhab.core.config.discovery.DiscoveryResultBuilder;\n+import org.openhab.core.config.discovery.DiscoveryService;\n+import org.openhab.core.thing.ThingTypeUID;\n+import org.openhab.core.thing.ThingUID;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Sets up the discovery results and details\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+@NonNullByDefault\n+public class HaywardDiscoveryService extends AbstractDiscoveryService implements DiscoveryService, ThingHandlerService {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardDiscoveryService.class);\n+    private @Nullable HaywardBridgeHandler discoveryBridgehandler;\n+\n+    public HaywardDiscoveryService() {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    @Override\n+    public void activate() {\n+        super.activate(null);\n+    }\n+\n+    @Override\n+    public void deactivate() {\n+        super.deactivate();\n+    }\n+\n+    @Override\n+    protected void startScan() {\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        try {\n+            if (bridgehandler != null) {\n+                String xmlResults = bridgehandler.getMspConfig();\n+                mspConfigDiscovery(xmlResults);\n+            }\n+        } catch (HaywardException e) {\n+            logger.warn(\"Exception during discovery scan: {}\", e.getMessage());\n+        } catch (InterruptedException e) {\n+            return;\n+        }\n+    }\n+\n+    public synchronized void mspConfigDiscovery(String xmlResponse) {\n+        List<String> systemIDs = new ArrayList<>();\n+        List<String> names = new ArrayList<>();\n+        Map<String, Object> backyardProperties = new HashMap<>();\n+        Map<String, Object> bowProperties = new HashMap<>();\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+\n+        if (bridgehandler == null) {\n+            return;\n+        }\n+\n+        // Find Backyard\n+        names = bridgehandler.evaluateXPath(\"//Backyard/Name/text()\", xmlResponse);\n+\n+        for (int i = 0; i < names.size(); i++) {\n+            backyardProperties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BACKYARD);\n+            backyardProperties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, bridgehandler.account.mspSystemID);\n+\n+            onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BACKYARD, names.get(i), backyardProperties);\n+        }\n+\n+        // Find Bodies of Water\n+        systemIDs = bridgehandler.evaluateXPath(\"//Body-of-water/System-Id/text()\", xmlResponse);\n+        names = bridgehandler.evaluateXPath(\"//Body-of-water/Name/text()\", xmlResponse);\n+\n+        for (int i = 0; i < systemIDs.size(); i++) {\n+            bowProperties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BOW);\n+            bowProperties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+\n+            onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BOW, names.get(i), bowProperties);\n+        }\n+\n+        // Find Chlorinators\n+        discoverDevices(bridgehandler, xmlResponse, \"Chlorinator\", HaywardTypeToRequest.CHLORINATOR,\n+                HaywardBindingConstants.THING_TYPE_CHLORINATOR, null);\n+\n+        // Find ColorLogic Lights\n+        discoverDevices(bridgehandler, xmlResponse, \"ColorLogic-Light\", HaywardTypeToRequest.COLORLOGIC,\n+                HaywardBindingConstants.THING_TYPE_COLORLOGIC, null);\n+\n+        // Find Filters\n+        final List<String> filterProperty1 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-Speed/text()\", xmlResponse);\n+        final List<String> filterProperty2 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-Speed/text()\", xmlResponse);\n+        final List<String> filterProperty3 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-RPM/text()\", xmlResponse);\n+        final List<String> filterProperty4 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-RPM/text()\", xmlResponse);\n+\n+        discoverDevices(bridgehandler, xmlResponse, \"Filter\", HaywardTypeToRequest.FILTER,\n+                HaywardBindingConstants.THING_TYPE_FILTER, (props, i) -> {\n+                    props.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPSPEED, filterProperty1.get(i));\n+                    props.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPSPEED, filterProperty2.get(i));\n+                    props.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPRPM, filterProperty3.get(i));\n+                    props.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPRPM, filterProperty4.get(i));\n+                });\n+\n+        // Find Heaters\n+        discoverDevices(bridgehandler, xmlResponse, \"Heater-Equipment\", HaywardTypeToRequest.HEATER,\n+                HaywardBindingConstants.THING_TYPE_HEATER, null);\n+\n+        // Find Pumps\n+        systemIDs = bridgehandler.evaluateXPath(\"//Pump/System-Id/text()\", xmlResponse);\n+        names = bridgehandler.evaluateXPath(\"//Pump/Name/text()\", xmlResponse);\n+        final List<String> pumpProperty1 = bridgehandler.evaluateXPath(\"//Pump/Min-Pump-Speed/text()\", xmlResponse);\n+        final List<String> pumpProperty2 = bridgehandler.evaluateXPath(\"//Pump/Max-Pump-Speed/text()\", xmlResponse);\n+        final List<String> pumpProperty3 = bridgehandler.evaluateXPath(\"//Pump/Min-Pump-RPM/text()\", xmlResponse);\n+        final List<String> pumpProperty4 = bridgehandler.evaluateXPath(\"//Pump/Max-Pump-RPM/text()\", xmlResponse);\n+\n+        discoverDevices(bridgehandler, xmlResponse, \"Pump\", HaywardTypeToRequest.PUMP,\n+                HaywardBindingConstants.THING_TYPE_FILTER, (props, i) -> {\n+                    props.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPSPEED, pumpProperty1.get(i));\n+                    props.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPSPEED, pumpProperty2.get(i));\n+                    props.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPRPM, pumpProperty3.get(i));\n+                    props.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPRPM, pumpProperty4.get(i));\n+                });\n+\n+        // Find Relays\n+        discoverDevices(bridgehandler, xmlResponse, \"Relay\", HaywardTypeToRequest.RELAY,\n+                HaywardBindingConstants.THING_TYPE_RELAY, null);\n+\n+        // Find Virtual Heaters\n+        discoverDevices(bridgehandler, xmlResponse, \"Heater\", HaywardTypeToRequest.VIRTUALHEATER,\n+                HaywardBindingConstants.THING_TYPE_VIRTUALHEATER, null);\n+\n+        // Find Sensors\n+        discoverDevices(bridgehandler, xmlResponse, \"Sensor\", HaywardTypeToRequest.SENSOR,\n+                HaywardBindingConstants.THING_TYPE_SENSOR, null);\n+        return;\n+    }\n+\n+    private void discoverDevices(HaywardBridgeHandler bridgehandler, String xmlResponse, String xmlSearchTerm,\n+            HaywardTypeToRequest type, ThingTypeUID thingType,\n+            @Nullable BiConsumer<Map<String, Object>, Integer> additionalPropertyConsumer) {\n+        List<String> systemIDs = new ArrayList<>();\n+        List<String> names = new ArrayList<>();\n+\n+        systemIDs = bridgehandler.evaluateXPath(\"//\" + xmlSearchTerm + \"/System-Id/text()\", xmlResponse);\n+\n+        // Set Virtual Heater Name\n+        if (thingType == HaywardBindingConstants.THING_TYPE_VIRTUALHEATER) {\n+            names = new ArrayList<>(systemIDs);\n+            Collections.fill(names, \"Heater\");\n+        } else {\n+            names = bridgehandler.evaluateXPath(\"//\" + xmlSearchTerm + \"/Name/text()\", xmlResponse);\n+        }\n+\n+        for (int i = 0; i < systemIDs.size(); i++) {\n+            List<String> bowName = new ArrayList<>();\n+            List<String> bowID = new ArrayList<>();\n+\n+            // get Body of Water for each item\n+            bowID = bridgehandler.evaluateXPath(\n+                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/System-Id/text()\", xmlResponse);\n+            bowName = bridgehandler.evaluateXPath(\n+                    \"//*[System-Id=\" + systemIDs.get(i) + \"]/ancestor::Body-of-water/Name/text()\", xmlResponse);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ac14b0332ed101f0a7e571414ce466fe1aa63bb"}, "originalPosition": 193}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjMxODE1Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    List<String> systemIDs = new ArrayList<>();\n          \n          \n            \n                    List<String> names = new ArrayList<>();\n          \n          \n            \n            \n          \n          \n            \n                    systemIDs = bridgehandler.evaluateXPath(\"//\" + xmlSearchTerm + \"/System-Id/text()\", xmlResponse);\n          \n          \n            \n                    List<String> systemIDs = bridgehandler.evaluateXPath(\"//\" + xmlSearchTerm + \"/System-Id/text()\", xmlResponse);\n          \n          \n            \n                    List<String> names;", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r562318153", "createdAt": "2021-01-22T01:56:31Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/discovery/HaywardDiscoveryService.java", "diffHunk": "@@ -0,0 +1,238 @@\n+/**\n+ * Copyright (c) 2010-2021 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.discovery;\n+\n+import static org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants.THING_TYPES_UIDS;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.function.BiConsumer;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.config.discovery.AbstractDiscoveryService;\n+import org.openhab.core.config.discovery.DiscoveryResult;\n+import org.openhab.core.config.discovery.DiscoveryResultBuilder;\n+import org.openhab.core.config.discovery.DiscoveryService;\n+import org.openhab.core.thing.ThingTypeUID;\n+import org.openhab.core.thing.ThingUID;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Sets up the discovery results and details\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+@NonNullByDefault\n+public class HaywardDiscoveryService extends AbstractDiscoveryService implements DiscoveryService, ThingHandlerService {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardDiscoveryService.class);\n+    private @Nullable HaywardBridgeHandler discoveryBridgehandler;\n+\n+    public HaywardDiscoveryService() {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    @Override\n+    public void activate() {\n+        super.activate(null);\n+    }\n+\n+    @Override\n+    public void deactivate() {\n+        super.deactivate();\n+    }\n+\n+    @Override\n+    protected void startScan() {\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        try {\n+            if (bridgehandler != null) {\n+                String xmlResults = bridgehandler.getMspConfig();\n+                mspConfigDiscovery(xmlResults);\n+            }\n+        } catch (HaywardException e) {\n+            logger.warn(\"Exception during discovery scan: {}\", e.getMessage());\n+        } catch (InterruptedException e) {\n+            return;\n+        }\n+    }\n+\n+    public synchronized void mspConfigDiscovery(String xmlResponse) {\n+        List<String> systemIDs = new ArrayList<>();\n+        List<String> names = new ArrayList<>();\n+        Map<String, Object> backyardProperties = new HashMap<>();\n+        Map<String, Object> bowProperties = new HashMap<>();\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+\n+        if (bridgehandler == null) {\n+            return;\n+        }\n+\n+        // Find Backyard\n+        names = bridgehandler.evaluateXPath(\"//Backyard/Name/text()\", xmlResponse);\n+\n+        for (int i = 0; i < names.size(); i++) {\n+            backyardProperties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BACKYARD);\n+            backyardProperties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, bridgehandler.account.mspSystemID);\n+\n+            onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BACKYARD, names.get(i), backyardProperties);\n+        }\n+\n+        // Find Bodies of Water\n+        systemIDs = bridgehandler.evaluateXPath(\"//Body-of-water/System-Id/text()\", xmlResponse);\n+        names = bridgehandler.evaluateXPath(\"//Body-of-water/Name/text()\", xmlResponse);\n+\n+        for (int i = 0; i < systemIDs.size(); i++) {\n+            bowProperties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BOW);\n+            bowProperties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+\n+            onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BOW, names.get(i), bowProperties);\n+        }\n+\n+        // Find Chlorinators\n+        discoverDevices(bridgehandler, xmlResponse, \"Chlorinator\", HaywardTypeToRequest.CHLORINATOR,\n+                HaywardBindingConstants.THING_TYPE_CHLORINATOR, null);\n+\n+        // Find ColorLogic Lights\n+        discoverDevices(bridgehandler, xmlResponse, \"ColorLogic-Light\", HaywardTypeToRequest.COLORLOGIC,\n+                HaywardBindingConstants.THING_TYPE_COLORLOGIC, null);\n+\n+        // Find Filters\n+        final List<String> filterProperty1 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-Speed/text()\", xmlResponse);\n+        final List<String> filterProperty2 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-Speed/text()\", xmlResponse);\n+        final List<String> filterProperty3 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-RPM/text()\", xmlResponse);\n+        final List<String> filterProperty4 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-RPM/text()\", xmlResponse);\n+\n+        discoverDevices(bridgehandler, xmlResponse, \"Filter\", HaywardTypeToRequest.FILTER,\n+                HaywardBindingConstants.THING_TYPE_FILTER, (props, i) -> {\n+                    props.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPSPEED, filterProperty1.get(i));\n+                    props.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPSPEED, filterProperty2.get(i));\n+                    props.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPRPM, filterProperty3.get(i));\n+                    props.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPRPM, filterProperty4.get(i));\n+                });\n+\n+        // Find Heaters\n+        discoverDevices(bridgehandler, xmlResponse, \"Heater-Equipment\", HaywardTypeToRequest.HEATER,\n+                HaywardBindingConstants.THING_TYPE_HEATER, null);\n+\n+        // Find Pumps\n+        systemIDs = bridgehandler.evaluateXPath(\"//Pump/System-Id/text()\", xmlResponse);\n+        names = bridgehandler.evaluateXPath(\"//Pump/Name/text()\", xmlResponse);\n+        final List<String> pumpProperty1 = bridgehandler.evaluateXPath(\"//Pump/Min-Pump-Speed/text()\", xmlResponse);\n+        final List<String> pumpProperty2 = bridgehandler.evaluateXPath(\"//Pump/Max-Pump-Speed/text()\", xmlResponse);\n+        final List<String> pumpProperty3 = bridgehandler.evaluateXPath(\"//Pump/Min-Pump-RPM/text()\", xmlResponse);\n+        final List<String> pumpProperty4 = bridgehandler.evaluateXPath(\"//Pump/Max-Pump-RPM/text()\", xmlResponse);\n+\n+        discoverDevices(bridgehandler, xmlResponse, \"Pump\", HaywardTypeToRequest.PUMP,\n+                HaywardBindingConstants.THING_TYPE_FILTER, (props, i) -> {\n+                    props.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPSPEED, pumpProperty1.get(i));\n+                    props.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPSPEED, pumpProperty2.get(i));\n+                    props.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPRPM, pumpProperty3.get(i));\n+                    props.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPRPM, pumpProperty4.get(i));\n+                });\n+\n+        // Find Relays\n+        discoverDevices(bridgehandler, xmlResponse, \"Relay\", HaywardTypeToRequest.RELAY,\n+                HaywardBindingConstants.THING_TYPE_RELAY, null);\n+\n+        // Find Virtual Heaters\n+        discoverDevices(bridgehandler, xmlResponse, \"Heater\", HaywardTypeToRequest.VIRTUALHEATER,\n+                HaywardBindingConstants.THING_TYPE_VIRTUALHEATER, null);\n+\n+        // Find Sensors\n+        discoverDevices(bridgehandler, xmlResponse, \"Sensor\", HaywardTypeToRequest.SENSOR,\n+                HaywardBindingConstants.THING_TYPE_SENSOR, null);\n+        return;\n+    }\n+\n+    private void discoverDevices(HaywardBridgeHandler bridgehandler, String xmlResponse, String xmlSearchTerm,\n+            HaywardTypeToRequest type, ThingTypeUID thingType,\n+            @Nullable BiConsumer<Map<String, Object>, Integer> additionalPropertyConsumer) {\n+        List<String> systemIDs = new ArrayList<>();\n+        List<String> names = new ArrayList<>();\n+\n+        systemIDs = bridgehandler.evaluateXPath(\"//\" + xmlSearchTerm + \"/System-Id/text()\", xmlResponse);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ac14b0332ed101f0a7e571414ce466fe1aa63bb"}, "originalPosition": 175}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjMxODMxNg==", "bodyText": "These variable assignments are not used in the rest of the method, so it is safe to remove them.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    systemIDs = bridgehandler.evaluateXPath(\"//Pump/System-Id/text()\", xmlResponse);\n          \n          \n            \n                    names = bridgehandler.evaluateXPath(\"//Pump/Name/text()\", xmlResponse);", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r562318316", "createdAt": "2021-01-22T01:57:04Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/discovery/HaywardDiscoveryService.java", "diffHunk": "@@ -0,0 +1,238 @@\n+/**\n+ * Copyright (c) 2010-2021 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.discovery;\n+\n+import static org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants.THING_TYPES_UIDS;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.function.BiConsumer;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.config.discovery.AbstractDiscoveryService;\n+import org.openhab.core.config.discovery.DiscoveryResult;\n+import org.openhab.core.config.discovery.DiscoveryResultBuilder;\n+import org.openhab.core.config.discovery.DiscoveryService;\n+import org.openhab.core.thing.ThingTypeUID;\n+import org.openhab.core.thing.ThingUID;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Sets up the discovery results and details\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+@NonNullByDefault\n+public class HaywardDiscoveryService extends AbstractDiscoveryService implements DiscoveryService, ThingHandlerService {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardDiscoveryService.class);\n+    private @Nullable HaywardBridgeHandler discoveryBridgehandler;\n+\n+    public HaywardDiscoveryService() {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    @Override\n+    public void activate() {\n+        super.activate(null);\n+    }\n+\n+    @Override\n+    public void deactivate() {\n+        super.deactivate();\n+    }\n+\n+    @Override\n+    protected void startScan() {\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        try {\n+            if (bridgehandler != null) {\n+                String xmlResults = bridgehandler.getMspConfig();\n+                mspConfigDiscovery(xmlResults);\n+            }\n+        } catch (HaywardException e) {\n+            logger.warn(\"Exception during discovery scan: {}\", e.getMessage());\n+        } catch (InterruptedException e) {\n+            return;\n+        }\n+    }\n+\n+    public synchronized void mspConfigDiscovery(String xmlResponse) {\n+        List<String> systemIDs = new ArrayList<>();\n+        List<String> names = new ArrayList<>();\n+        Map<String, Object> backyardProperties = new HashMap<>();\n+        Map<String, Object> bowProperties = new HashMap<>();\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+\n+        if (bridgehandler == null) {\n+            return;\n+        }\n+\n+        // Find Backyard\n+        names = bridgehandler.evaluateXPath(\"//Backyard/Name/text()\", xmlResponse);\n+\n+        for (int i = 0; i < names.size(); i++) {\n+            backyardProperties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BACKYARD);\n+            backyardProperties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, bridgehandler.account.mspSystemID);\n+\n+            onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BACKYARD, names.get(i), backyardProperties);\n+        }\n+\n+        // Find Bodies of Water\n+        systemIDs = bridgehandler.evaluateXPath(\"//Body-of-water/System-Id/text()\", xmlResponse);\n+        names = bridgehandler.evaluateXPath(\"//Body-of-water/Name/text()\", xmlResponse);\n+\n+        for (int i = 0; i < systemIDs.size(); i++) {\n+            bowProperties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BOW);\n+            bowProperties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+\n+            onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BOW, names.get(i), bowProperties);\n+        }\n+\n+        // Find Chlorinators\n+        discoverDevices(bridgehandler, xmlResponse, \"Chlorinator\", HaywardTypeToRequest.CHLORINATOR,\n+                HaywardBindingConstants.THING_TYPE_CHLORINATOR, null);\n+\n+        // Find ColorLogic Lights\n+        discoverDevices(bridgehandler, xmlResponse, \"ColorLogic-Light\", HaywardTypeToRequest.COLORLOGIC,\n+                HaywardBindingConstants.THING_TYPE_COLORLOGIC, null);\n+\n+        // Find Filters\n+        final List<String> filterProperty1 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-Speed/text()\", xmlResponse);\n+        final List<String> filterProperty2 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-Speed/text()\", xmlResponse);\n+        final List<String> filterProperty3 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-RPM/text()\", xmlResponse);\n+        final List<String> filterProperty4 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-RPM/text()\", xmlResponse);\n+\n+        discoverDevices(bridgehandler, xmlResponse, \"Filter\", HaywardTypeToRequest.FILTER,\n+                HaywardBindingConstants.THING_TYPE_FILTER, (props, i) -> {\n+                    props.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPSPEED, filterProperty1.get(i));\n+                    props.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPSPEED, filterProperty2.get(i));\n+                    props.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPRPM, filterProperty3.get(i));\n+                    props.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPRPM, filterProperty4.get(i));\n+                });\n+\n+        // Find Heaters\n+        discoverDevices(bridgehandler, xmlResponse, \"Heater-Equipment\", HaywardTypeToRequest.HEATER,\n+                HaywardBindingConstants.THING_TYPE_HEATER, null);\n+\n+        // Find Pumps\n+        systemIDs = bridgehandler.evaluateXPath(\"//Pump/System-Id/text()\", xmlResponse);\n+        names = bridgehandler.evaluateXPath(\"//Pump/Name/text()\", xmlResponse);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ac14b0332ed101f0a7e571414ce466fe1aa63bb"}, "originalPosition": 141}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjMxODQzMg==", "bodyText": "This return isn't necessary.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return;", "url": "https://github.com/openhab/openhab-addons/pull/8685#discussion_r562318432", "createdAt": "2021-01-22T01:57:26Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.haywardomnilogic/src/main/java/org/openhab/binding/haywardomnilogic/internal/discovery/HaywardDiscoveryService.java", "diffHunk": "@@ -0,0 +1,238 @@\n+/**\n+ * Copyright (c) 2010-2021 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.haywardomnilogic.internal.discovery;\n+\n+import static org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants.THING_TYPES_UIDS;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.function.BiConsumer;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardBindingConstants;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardException;\n+import org.openhab.binding.haywardomnilogic.internal.HaywardTypeToRequest;\n+import org.openhab.binding.haywardomnilogic.internal.handler.HaywardBridgeHandler;\n+import org.openhab.core.config.discovery.AbstractDiscoveryService;\n+import org.openhab.core.config.discovery.DiscoveryResult;\n+import org.openhab.core.config.discovery.DiscoveryResultBuilder;\n+import org.openhab.core.config.discovery.DiscoveryService;\n+import org.openhab.core.thing.ThingTypeUID;\n+import org.openhab.core.thing.ThingUID;\n+import org.openhab.core.thing.binding.ThingHandler;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Sets up the discovery results and details\n+ *\n+ * @author Matt Myers - Initial contribution\n+ */\n+\n+@NonNullByDefault\n+public class HaywardDiscoveryService extends AbstractDiscoveryService implements DiscoveryService, ThingHandlerService {\n+    private final Logger logger = LoggerFactory.getLogger(HaywardDiscoveryService.class);\n+    private @Nullable HaywardBridgeHandler discoveryBridgehandler;\n+\n+    public HaywardDiscoveryService() {\n+        super(THING_TYPES_UIDS, 0, false);\n+    }\n+\n+    @Override\n+    public void activate() {\n+        super.activate(null);\n+    }\n+\n+    @Override\n+    public void deactivate() {\n+        super.deactivate();\n+    }\n+\n+    @Override\n+    protected void startScan() {\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+        try {\n+            if (bridgehandler != null) {\n+                String xmlResults = bridgehandler.getMspConfig();\n+                mspConfigDiscovery(xmlResults);\n+            }\n+        } catch (HaywardException e) {\n+            logger.warn(\"Exception during discovery scan: {}\", e.getMessage());\n+        } catch (InterruptedException e) {\n+            return;\n+        }\n+    }\n+\n+    public synchronized void mspConfigDiscovery(String xmlResponse) {\n+        List<String> systemIDs = new ArrayList<>();\n+        List<String> names = new ArrayList<>();\n+        Map<String, Object> backyardProperties = new HashMap<>();\n+        Map<String, Object> bowProperties = new HashMap<>();\n+        HaywardBridgeHandler bridgehandler = discoveryBridgehandler;\n+\n+        if (bridgehandler == null) {\n+            return;\n+        }\n+\n+        // Find Backyard\n+        names = bridgehandler.evaluateXPath(\"//Backyard/Name/text()\", xmlResponse);\n+\n+        for (int i = 0; i < names.size(); i++) {\n+            backyardProperties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BACKYARD);\n+            backyardProperties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, bridgehandler.account.mspSystemID);\n+\n+            onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BACKYARD, names.get(i), backyardProperties);\n+        }\n+\n+        // Find Bodies of Water\n+        systemIDs = bridgehandler.evaluateXPath(\"//Body-of-water/System-Id/text()\", xmlResponse);\n+        names = bridgehandler.evaluateXPath(\"//Body-of-water/Name/text()\", xmlResponse);\n+\n+        for (int i = 0; i < systemIDs.size(); i++) {\n+            bowProperties.put(HaywardBindingConstants.PROPERTY_TYPE, HaywardTypeToRequest.BOW);\n+            bowProperties.put(HaywardBindingConstants.PROPERTY_SYSTEM_ID, systemIDs.get(i));\n+\n+            onDeviceDiscovered(HaywardBindingConstants.THING_TYPE_BOW, names.get(i), bowProperties);\n+        }\n+\n+        // Find Chlorinators\n+        discoverDevices(bridgehandler, xmlResponse, \"Chlorinator\", HaywardTypeToRequest.CHLORINATOR,\n+                HaywardBindingConstants.THING_TYPE_CHLORINATOR, null);\n+\n+        // Find ColorLogic Lights\n+        discoverDevices(bridgehandler, xmlResponse, \"ColorLogic-Light\", HaywardTypeToRequest.COLORLOGIC,\n+                HaywardBindingConstants.THING_TYPE_COLORLOGIC, null);\n+\n+        // Find Filters\n+        final List<String> filterProperty1 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-Speed/text()\", xmlResponse);\n+        final List<String> filterProperty2 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-Speed/text()\", xmlResponse);\n+        final List<String> filterProperty3 = bridgehandler.evaluateXPath(\"//Filter/Min-Pump-RPM/text()\", xmlResponse);\n+        final List<String> filterProperty4 = bridgehandler.evaluateXPath(\"//Filter/Max-Pump-RPM/text()\", xmlResponse);\n+\n+        discoverDevices(bridgehandler, xmlResponse, \"Filter\", HaywardTypeToRequest.FILTER,\n+                HaywardBindingConstants.THING_TYPE_FILTER, (props, i) -> {\n+                    props.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPSPEED, filterProperty1.get(i));\n+                    props.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPSPEED, filterProperty2.get(i));\n+                    props.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPRPM, filterProperty3.get(i));\n+                    props.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPRPM, filterProperty4.get(i));\n+                });\n+\n+        // Find Heaters\n+        discoverDevices(bridgehandler, xmlResponse, \"Heater-Equipment\", HaywardTypeToRequest.HEATER,\n+                HaywardBindingConstants.THING_TYPE_HEATER, null);\n+\n+        // Find Pumps\n+        systemIDs = bridgehandler.evaluateXPath(\"//Pump/System-Id/text()\", xmlResponse);\n+        names = bridgehandler.evaluateXPath(\"//Pump/Name/text()\", xmlResponse);\n+        final List<String> pumpProperty1 = bridgehandler.evaluateXPath(\"//Pump/Min-Pump-Speed/text()\", xmlResponse);\n+        final List<String> pumpProperty2 = bridgehandler.evaluateXPath(\"//Pump/Max-Pump-Speed/text()\", xmlResponse);\n+        final List<String> pumpProperty3 = bridgehandler.evaluateXPath(\"//Pump/Min-Pump-RPM/text()\", xmlResponse);\n+        final List<String> pumpProperty4 = bridgehandler.evaluateXPath(\"//Pump/Max-Pump-RPM/text()\", xmlResponse);\n+\n+        discoverDevices(bridgehandler, xmlResponse, \"Pump\", HaywardTypeToRequest.PUMP,\n+                HaywardBindingConstants.THING_TYPE_FILTER, (props, i) -> {\n+                    props.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPSPEED, pumpProperty1.get(i));\n+                    props.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPSPEED, pumpProperty2.get(i));\n+                    props.put(HaywardBindingConstants.PROPERTY_FILTER_MINPUMPRPM, pumpProperty3.get(i));\n+                    props.put(HaywardBindingConstants.PROPERTY_FILTER_MAXPUMPRPM, pumpProperty4.get(i));\n+                });\n+\n+        // Find Relays\n+        discoverDevices(bridgehandler, xmlResponse, \"Relay\", HaywardTypeToRequest.RELAY,\n+                HaywardBindingConstants.THING_TYPE_RELAY, null);\n+\n+        // Find Virtual Heaters\n+        discoverDevices(bridgehandler, xmlResponse, \"Heater\", HaywardTypeToRequest.VIRTUALHEATER,\n+                HaywardBindingConstants.THING_TYPE_VIRTUALHEATER, null);\n+\n+        // Find Sensors\n+        discoverDevices(bridgehandler, xmlResponse, \"Sensor\", HaywardTypeToRequest.SENSOR,\n+                HaywardBindingConstants.THING_TYPE_SENSOR, null);\n+        return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ac14b0332ed101f0a7e571414ce466fe1aa63bb"}, "originalPosition": 166}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ad7d6c40f640e72795c52e20f60d1e0cfa806d3", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/7ad7d6c40f640e72795c52e20f60d1e0cfa806d3", "committedDate": "2021-01-22T02:43:05Z", "message": "Converted to OH3\n\nSigned-off-by: Matt Myers <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c729ec60eae32f0c83ada7c488d436e929ba91e8", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/c729ec60eae32f0c83ada7c488d436e929ba91e8", "committedDate": "2021-01-22T02:43:05Z", "message": "Signing\n\nSigned-off-by: Matt Myers <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4a818f49ac38a400514bce3be64a254989dd04c", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/c4a818f49ac38a400514bce3be64a254989dd04c", "committedDate": "2021-01-22T02:43:05Z", "message": "Added backyardsate option value 0 = \"Powered Off\"\n\nSigned-off-by: Matt Myers <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77dac20ebeac07fb17222dc7a1105f46587c8ca8", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/77dac20ebeac07fb17222dc7a1105f46587c8ca8", "committedDate": "2021-01-22T02:43:05Z", "message": "Add @NonNullByDefault to HaywardTypeToRequest\n\nSigned-off-by: Matt Myers <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84cf350583be1f2f8015eef34b328fa48f8945ce", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/84cf350583be1f2f8015eef34b328fa48f8945ce", "committedDate": "2021-01-22T02:43:05Z", "message": "Add @NonNullByDefault to HaywardThingHandler\n\nSigned-off-by: Matt Myers <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34411b48f9c278f9e950b2ec17df16dc6188f544", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/34411b48f9c278f9e950b2ec17df16dc6188f544", "committedDate": "2021-01-22T02:43:05Z", "message": "Fix formatting in bom/openhab-addons/pom.xml\n\nSigned-off-by: Matt Myers <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8335a0bd4b827b1d0cb3fbee5947ebd796fb5e2", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/a8335a0bd4b827b1d0cb3fbee5947ebd796fb5e2", "committedDate": "2021-01-22T02:43:05Z", "message": "shorter line lengths in readme file to make more readable in text editor\n\nSigned-off-by: Matt Myers <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19855a25f45cdc821776e51a127a42a3d8d51fb9", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/19855a25f45cdc821776e51a127a42a3d8d51fb9", "committedDate": "2021-01-22T02:43:05Z", "message": "Fixed pump.xml typo\n\nSigned-off-by: Matt Myers <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0359f0e74de8089c2906c1b00e06dc0d95a5e6a7", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/0359f0e74de8089c2906c1b00e06dc0d95a5e6a7", "committedDate": "2021-01-22T02:43:05Z", "message": "Updating units on a number of things\n\nSigned-off-by: Matt Myers <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d3e6f3724ea0fd193a306fd5a43bbdd07f32e03", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/8d3e6f3724ea0fd193a306fd5a43bbdd07f32e03", "committedDate": "2021-01-22T02:43:05Z", "message": "remove commented/unused code\n\nSigned-off-by: Matt Myers <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4225e47fbc56aa13bfd92dd34a19ff5c44debce8", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/4225e47fbc56aa13bfd92dd34a19ff5c44debce8", "committedDate": "2021-01-22T02:43:05Z", "message": "Update sensor.xml BOW description\n\nSigned-off-by: Matt Myers <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4eebbbb399e26a304db177dc9b354f8733337d58", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/4eebbbb399e26a304db177dc9b354f8733337d58", "committedDate": "2021-01-22T02:43:05Z", "message": "remove PPM units from description\n\nSigned-off-by: Matt Myers <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d12af5a6c98563506b1cef9fbac780bd11521187", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/d12af5a6c98563506b1cef9fbac780bd11521187", "committedDate": "2021-01-22T02:43:05Z", "message": "Update API config.hostname to config.endpointUrl\n\nSigned-off-by: Matt Myers <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d612a6f712983d933a0f5c47aac31ed29b023bf", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/5d612a6f712983d933a0f5c47aac31ed29b023bf", "committedDate": "2021-01-22T02:43:05Z", "message": "Updated handlers to parse data for multiple things\n\nSigned-off-by: Matt Myers <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db231df270b27d82d423123ae17d273426917d16", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/db231df270b27d82d423123ae17d273426917d16", "committedDate": "2021-01-22T02:43:06Z", "message": "Removed eroneous chlorinator code from heater handler\n\nSigned-off-by: Matt Myers <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b067d589c9988fd0dba47404717e4c939eea3e0", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/1b067d589c9988fd0dba47404717e4c939eea3e0", "committedDate": "2021-01-22T02:43:06Z", "message": "Update logging levels\n\nSigned-off-by: Matt Myers <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ba7d126869af1e4c2d08b7af4d66f3d7ede014f", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/7ba7d126869af1e4c2d08b7af4d66f3d7ede014f", "committedDate": "2021-01-22T02:43:06Z", "message": "Sign off\n\nSigned-off-by: Matt Myers <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "855b77fe1f488b338f0a5e8f4ca98a0195e8be38", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/855b77fe1f488b338f0a5e8f4ca98a0195e8be38", "committedDate": "2021-01-22T02:43:06Z", "message": "Updating units on a number of things\n\nSigned-off-by: Matt Myers <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1659b9a382188ae7f6d3879a7a0954396b76c02e", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/1659b9a382188ae7f6d3879a7a0954396b76c02e", "committedDate": "2021-01-22T02:43:06Z", "message": "remove PPM units from description\n\nSigned-off-by: Matt Myers <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "638ff822a8770b50f22d5099f92fc4536cc0233e", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/638ff822a8770b50f22d5099f92fc4536cc0233e", "committedDate": "2021-01-22T02:43:06Z", "message": "Sign off\n\nSigned-off-by: Matt Myers <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de0f4292a06ff8b24fef8941638a5d87c68669e2", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/de0f4292a06ff8b24fef8941638a5d87c68669e2", "committedDate": "2021-01-22T02:43:06Z", "message": "Added support for metric units. Cleaned up thing.xml's\n\nSigned-off-by: Matt Myers <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93d50f32fc50c7c13983d0e38b491e34f4e11e2f", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/93d50f32fc50c7c13983d0e38b491e34f4e11e2f", "committedDate": "2021-01-22T02:43:06Z", "message": "Corrected all items except parsing from last review\n\nSigned-off-by: Matt Myers <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd1d1646acdf503981a7dc8043cb91578c60bb17", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/bd1d1646acdf503981a7dc8043cb91578c60bb17", "committedDate": "2021-01-22T02:43:06Z", "message": "Misc changes requested by fwolter\n\nSigned-off-by: Matt Myers <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19e13612d36e2e6843398700564039b4d5c15193", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/19e13612d36e2e6843398700564039b4d5c15193", "committedDate": "2021-01-22T02:43:06Z", "message": "Add online status update to all things\n\nSigned-off-by: Matt Myers <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c91e907feffca5df0a1b9e48069d9250d7b4dd1", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/8c91e907feffca5df0a1b9e48069d9250d7b4dd1", "committedDate": "2021-01-22T02:43:06Z", "message": "Clean up exception handling\n\nSigned-off-by: Matt Myers <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a909d5d8363ee4b31f87de323e31d9b5bd9a3f9", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/4a909d5d8363ee4b31f87de323e31d9b5bd9a3f9", "committedDate": "2021-01-22T02:43:06Z", "message": "added null handling\n\nSigned-off-by: matchews <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d0d6d3c70518f96807649ef8c95c1e3cdfef706", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/5d0d6d3c70518f96807649ef8c95c1e3cdfef706", "committedDate": "2021-01-22T02:43:07Z", "message": "Add backyard properties (units, VSP SPeed Format)\n\nSigned-off-by: matchews <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ede044e6fc1a941d875a39af1cf15d34411bd991", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/ede044e6fc1a941d875a39af1cf15d34411bd991", "committedDate": "2021-01-22T02:43:07Z", "message": "Removed unused constants\n\nSigned-off-by: matchews <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2140885f3e4d9a66b737004c6b9f127fb66b3112", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/2140885f3e4d9a66b737004c6b9f127fb66b3112", "committedDate": "2021-01-22T02:43:07Z", "message": "Move fields to top of classes\n\nSigned-off-by: matchews <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb99b871c328accaab23d74dfd702d05c9468a13", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/fb99b871c328accaab23d74dfd702d05c9468a13", "committedDate": "2021-01-22T02:43:07Z", "message": "Added Author tags back in\n\nSigned-off-by: matchews <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94e2d43f94960252a640db5fa897246261343eea", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/94e2d43f94960252a640db5fa897246261343eea", "committedDate": "2021-01-22T02:43:07Z", "message": "ThingHandler & getTelemetry are now abstract\n\nSigned-off-by: matchews <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf62cb2a658d6e2cc183fe7390915f568125e1a6", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/cf62cb2a658d6e2cc183fe7390915f568125e1a6", "committedDate": "2021-01-22T02:43:07Z", "message": "Adding Null Checks\n\nSigned-off-by: matchews <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58518ffe68108fe93fa6a1a7ce92b2b8d1802aea", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/58518ffe68108fe93fa6a1a7ce92b2b8d1802aea", "committedDate": "2021-01-22T02:43:07Z", "message": "Clean up exception handling\n\nSigned-off-by: matchews <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5e32688c99b0c13a1dd0037b72bd2467db9dec0", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/f5e32688c99b0c13a1dd0037b72bd2467db9dec0", "committedDate": "2021-01-22T02:43:07Z", "message": "Updated InterruptedException handling\n\nSigned-off-by: matchews <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e94b556fa0aea87780f79d07b3135fc719d7d769", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/e94b556fa0aea87780f79d07b3135fc719d7d769", "committedDate": "2021-01-22T02:43:07Z", "message": "Removed compiler warning\n\nSigned-off-by: matchews <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1aeffd7ae2641f8722a3dd67bf707e0e5cebe478", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/1aeffd7ae2641f8722a3dd67bf707e0e5cebe478", "committedDate": "2021-01-22T02:43:07Z", "message": "Added mspConfigUnits to pull units from Hayward, updated xml unit definitions\n\nSigned-off-by: matchews <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43a76222d46a6f2ecd09977d280951d39646384e", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/43a76222d46a6f2ecd09977d280951d39646384e", "committedDate": "2021-01-22T02:43:07Z", "message": "Removed unused haywardDiscoveryService assignment from bridgehandler and HaywardException from mspConfigDiscovery\n\nSigned-off-by: matchews <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2fe9147d05f204e843e3bd59f2f3d4e84e444ef8", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/2fe9147d05f204e843e3bd59f2f3d4e84e444ef8", "committedDate": "2021-01-22T02:43:07Z", "message": "updated readme\n\nSigned-off-by: matchews <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7af05395c5b9166e9a314baf63648267d9878d61", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/7af05395c5b9166e9a314baf63648267d9878d61", "committedDate": "2021-01-22T02:43:07Z", "message": "update headers 2021\n\nSigned-off-by: matchews <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f66754263671a3082371a81d9286ffa52a350bf", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/8f66754263671a3082371a81d9286ffa52a350bf", "committedDate": "2021-01-22T02:43:08Z", "message": "cpmeister requested changes 1/17/21\n\nSigned-off-by: matchews <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "792a1fd908ce2c9b8d40cdb387a6d297a9fc7a76", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/792a1fd908ce2c9b8d40cdb387a6d297a9fc7a76", "committedDate": "2021-01-22T02:43:08Z", "message": "Refactor DiscoveryHandler\n\nSigned-off-by: matchews <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38204b1b5ab3fd1b0f212e7c43f9999932d9cceb", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/38204b1b5ab3fd1b0f212e7c43f9999932d9cceb", "committedDate": "2021-01-22T02:43:08Z", "message": "Refactor DiscoveryService\n\nSigned-off-by: matchews <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01a107b9509e2f843ddf24968bd8703b3570e199", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/01a107b9509e2f843ddf24968bd8703b3570e199", "committedDate": "2021-01-22T02:43:08Z", "message": "Eliminated HawardDiscoveryService.discoverDevices useZeroForBowIndex parameter\n\nSigned-off-by: matchews <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d48f64bf2b285f8d99716a48cb034e6a37cfe41f", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/d48f64bf2b285f8d99716a48cb034e6a37cfe41f", "committedDate": "2021-01-22T02:43:08Z", "message": "Final cleanup\n\nSigned-off-by: matchews <mmyers75@icloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b99461f86d7c1ccb3efb327707ab954babb5328", "author": {"user": {"login": "matchews", "name": "Matt"}}, "url": "https://github.com/openhab/openhab-addons/commit/6b99461f86d7c1ccb3efb327707ab954babb5328", "committedDate": "2021-01-22T02:46:20Z", "message": "Code check fix\n\nSigned-off-by: matchews <mmyers75@icloud.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc0NjcxMTI3", "url": "https://github.com/openhab/openhab-addons/pull/8685#pullrequestreview-574671127", "createdAt": "2021-01-22T22:31:55Z", "commit": {"oid": "6b99461f86d7c1ccb3efb327707ab954babb5328"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4516, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}