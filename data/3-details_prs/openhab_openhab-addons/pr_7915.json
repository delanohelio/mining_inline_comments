{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM0MDE4OTA2", "number": 7915, "title": "[somfytahoma] improved silent mode control", "bodyText": "This PR improves silent mode control of the Silent Roller Shutter thing.\nNow it moves the roller shutter silently even if the UP or DOWN command received.\nConfirmed to be working\nhttps://community.openhab.org/t/re-tahoma-binding-compatible-with-oh2/100430/10", "createdAt": "2020-06-13T15:18:03Z", "url": "https://github.com/openhab/openhab-addons/pull/7915", "merged": true, "mergeCommit": {"oid": "4bc66acc236d8b6a2b12542977b91769ebcee74b"}, "closed": true, "closedAt": "2020-06-13T22:40:50Z", "author": {"login": "octa22"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqUfXqAH2gAyNDM0MDE4OTA2OmZkZGEyYWQ4NGM0YTE2NjEyNDIxNmJjZTNmY2UwYjhkNTQyMTBhNzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcq_VhtAFqTQzMDE3MjIzNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fdda2ad84c4a166124216bce3fce0b8d54210a74", "author": {"user": {"login": "octa22", "name": "Ondrej Pecta"}}, "url": "https://github.com/openhab/openhab-addons/commit/fdda2ad84c4a166124216bce3fce0b8d54210a74", "committedDate": "2020-06-11T20:43:16Z", "message": "[somfytahoma] improved silent mode control\n\nSigned-off-by: Ondrej Pecta <opecta@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMTYwOTg0", "url": "https://github.com/openhab/openhab-addons/pull/7915#pullrequestreview-430160984", "createdAt": "2020-06-13T19:31:27Z", "commit": {"oid": "fdda2ad84c4a166124216bce3fce0b8d54210a74"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxOTozMToyN1rOGjZBbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxOTozNTowOFrOGjZCTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc2MzMxMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            default:\n          \n          \n            \n                                if (CONTROL_SILENT.equals(channelUID.getId()) && (COMMAND_UP.equals(cmd) || COMMAND_DOWN.equals(cmd))) {\n          \n          \n            \n                                    // move the roller shutter to the specific position at low speed\n          \n          \n            \n                                    String param = \"[\" + (COMMAND_UP.equals(cmd) ? 0 : 100) + \", \\\"lowspeed\\\"]\";\n          \n          \n            \n                                    sendCommand(COMMAND_SET_CLOSURESPEED, param);\n          \n          \n            \n                                } else {\n          \n          \n            \n                                    sendCommand(cmd);\n          \n          \n            \n                                }\n          \n          \n            \n                            case COMMAND_UP:\n          \n          \n            \n                            case COMMAND_DOWN:\n          \n          \n            \n                                if (CONTROL_SILENT.equals(channelUID.getId())) {\n          \n          \n            \n                                    // move the roller shutter to the specific position at low speed\n          \n          \n            \n                                    String param = \"[\" + (COMMAND_UP.equals(cmd) ? 0 : 100) + \", \\\"lowspeed\\\"]\";\n          \n          \n            \n                                    sendCommand(COMMAND_SET_CLOSURESPEED, param);\n          \n          \n            \n                                    break;\n          \n          \n            \n                                }\n          \n          \n            \n                                //fall through\n          \n          \n            \n                            default:\n          \n          \n            \n                                sendCommand(cmd);", "url": "https://github.com/openhab/openhab-addons/pull/7915#discussion_r439763310", "createdAt": "2020-06-13T19:31:27Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaSilentRollerShutterHandler.java", "diffHunk": "@@ -45,25 +45,37 @@ public void handleCommand(ChannelUID channelUID, Command command) {\n             return;\n         } else {\n             String cmd = getTahomaCommand(command.toString());\n-            if (COMMAND_MY.equals(cmd)) {\n-                sendCommand(COMMAND_MY);\n-            } else if (COMMAND_STOP.equals(cmd)) {\n-                String executionId = getCurrentExecutions();\n-                if (executionId != null) {\n-                    // Check if the roller shutter is moving and STOP is sent => STOP it\n-                    cancelExecution(executionId);\n-                } else {\n+            switch (cmd) {\n+                case COMMAND_MY:\n                     sendCommand(COMMAND_MY);\n-                }\n-            } else {\n-                if (CONTROL_SILENT.equals(channelUID.getId()) && COMMAND_SET_CLOSURE.equals(cmd)) {\n-                    // move the roller shutter to the specific position at low speed\n-                    String param = \"[\" + command.toString() + \", \\\"lowspeed\\\"]\";\n-                    sendCommand(COMMAND_SET_CLOSURESPEED, param);\n-                } else {\n-                    String param = COMMAND_SET_CLOSURE.equals(cmd) ? \"[\" + toInteger(command) + \"]\" : \"[]\";\n-                    sendCommand(cmd, param);\n-                }\n+                    break;\n+                case COMMAND_STOP:\n+                    String executionId = getCurrentExecutions();\n+                    if (executionId != null) {\n+                        // Check if the roller shutter is moving and STOP is sent => STOP it\n+                        cancelExecution(executionId);\n+                    } else {\n+                        sendCommand(COMMAND_MY);\n+                    }\n+                    break;\n+                case COMMAND_SET_CLOSURE:\n+                    if (CONTROL_SILENT.equals(channelUID.getId())) {\n+                        // move the roller shutter to the specific position at low speed\n+                        String param = \"[\" + toInteger(command) + \", \\\"lowspeed\\\"]\";\n+                        sendCommand(COMMAND_SET_CLOSURESPEED, param);\n+                    } else {\n+                        String param = \"[\" + toInteger(command) + \"]\";\n+                        sendCommand(cmd, param);\n+                    }\n+                    break;\n+                default:\n+                    if (CONTROL_SILENT.equals(channelUID.getId()) && (COMMAND_UP.equals(cmd) || COMMAND_DOWN.equals(cmd))) {\n+                        // move the roller shutter to the specific position at low speed\n+                        String param = \"[\" + (COMMAND_UP.equals(cmd) ? 0 : 100) + \", \\\"lowspeed\\\"]\";\n+                        sendCommand(COMMAND_SET_CLOSURESPEED, param);\n+                    } else {\n+                        sendCommand(cmd);\n+                    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fdda2ad84c4a166124216bce3fce0b8d54210a74"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc2MzUzMg==", "bodyText": "You can do similar fall through shenanigans here as well by moving the COMMAND_MY case around.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            case COMMAND_STOP:\n          \n          \n            \n                                String executionId = getCurrentExecutions();\n          \n          \n            \n                                if (executionId != null) {\n          \n          \n            \n                                    // Check if the roller shutter is moving and STOP is sent => STOP it\n          \n          \n            \n                                    cancelExecution(executionId);\n          \n          \n            \n                                } else {\n          \n          \n            \n                                    sendCommand(COMMAND_MY);\n          \n          \n            \n                                }\n          \n          \n            \n                                break;\n          \n          \n            \n                            case COMMAND_STOP:\n          \n          \n            \n                                String executionId = getCurrentExecutions();\n          \n          \n            \n                                if (executionId != null) {\n          \n          \n            \n                                    // Check if the roller shutter is moving and STOP is sent => STOP it\n          \n          \n            \n                                    cancelExecution(executionId);\n          \n          \n            \n                                    break;\n          \n          \n            \n                                }\n          \n          \n            \n                                //fall through\n          \n          \n            \n                            case COMMAND_MY:\n          \n          \n            \n                                sendCommand(COMMAND_MY);\n          \n          \n            \n                                break;", "url": "https://github.com/openhab/openhab-addons/pull/7915#discussion_r439763532", "createdAt": "2020-06-13T19:35:08Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaSilentRollerShutterHandler.java", "diffHunk": "@@ -45,25 +45,37 @@ public void handleCommand(ChannelUID channelUID, Command command) {\n             return;\n         } else {\n             String cmd = getTahomaCommand(command.toString());\n-            if (COMMAND_MY.equals(cmd)) {\n-                sendCommand(COMMAND_MY);\n-            } else if (COMMAND_STOP.equals(cmd)) {\n-                String executionId = getCurrentExecutions();\n-                if (executionId != null) {\n-                    // Check if the roller shutter is moving and STOP is sent => STOP it\n-                    cancelExecution(executionId);\n-                } else {\n+            switch (cmd) {\n+                case COMMAND_MY:\n                     sendCommand(COMMAND_MY);\n-                }\n-            } else {\n-                if (CONTROL_SILENT.equals(channelUID.getId()) && COMMAND_SET_CLOSURE.equals(cmd)) {\n-                    // move the roller shutter to the specific position at low speed\n-                    String param = \"[\" + command.toString() + \", \\\"lowspeed\\\"]\";\n-                    sendCommand(COMMAND_SET_CLOSURESPEED, param);\n-                } else {\n-                    String param = COMMAND_SET_CLOSURE.equals(cmd) ? \"[\" + toInteger(command) + \"]\" : \"[]\";\n-                    sendCommand(cmd, param);\n-                }\n+                    break;\n+                case COMMAND_STOP:\n+                    String executionId = getCurrentExecutions();\n+                    if (executionId != null) {\n+                        // Check if the roller shutter is moving and STOP is sent => STOP it\n+                        cancelExecution(executionId);\n+                    } else {\n+                        sendCommand(COMMAND_MY);\n+                    }\n+                    break;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fdda2ad84c4a166124216bce3fce0b8d54210a74"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24536e4bc72793c2747b9b230cb142fc926d362d", "author": {"user": {"login": "octa22", "name": "Ondrej Pecta"}}, "url": "https://github.com/openhab/openhab-addons/commit/24536e4bc72793c2747b9b230cb142fc926d362d", "committedDate": "2020-06-13T21:13:53Z", "message": "[somfytahoma] implemented suggested changes from the code review\n\nSigned-off-by: Ondrej Pecta <opecta@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMTcyMjM2", "url": "https://github.com/openhab/openhab-addons/pull/7915#pullrequestreview-430172236", "createdAt": "2020-06-13T22:38:26Z", "commit": {"oid": "24536e4bc72793c2747b9b230cb142fc926d362d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 266, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}