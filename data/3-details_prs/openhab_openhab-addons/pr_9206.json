{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxMzQ3NTIx", "number": 9206, "title": "[openthermgateway] Fix for #9205 incorrect control setpoint override", "bodyText": "Bugfix and improvement for issue reported in #9205.\nGoal is to accurately report control setpoint at boiler, and enable access to requested and overridden values to allow intelligent rules to be implemented.\nThis has been discussed with the initial implementer of this binding @ArjenKorevaar in this community thread https://community.openhab.org/t/opentherm-gateway-binding/39160\nReadme has been updated, changes are believed to follow guidelines, no new static analysis issues have been introduced, and work has been signed off.", "createdAt": "2020-12-02T23:12:37Z", "url": "https://github.com/openhab/openhab-addons/pull/9206", "merged": true, "mergeCommit": {"oid": "20e03c257a792d6f61344a59551ba6bd510f2154"}, "closed": true, "closedAt": "2020-12-08T01:03:41Z", "author": {"login": "jamesmelville"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdiByzDgH2gAyNTMxMzQ3NTIxOmE4ZTcxMDUyZjhkMjRlYzgyOGZjMGU3OWZhOTE1YmViN2I0NTgyYjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdj9iQwgFqTU0NjYwMjQ0NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a8e71052f8d24ec828fc0e79fa915beb7b4582b1", "author": {"user": {"login": "jamesmelville", "name": "James Melville"}}, "url": "https://github.com/openhab/openhab-addons/commit/a8e71052f8d24ec828fc0e79fa915beb7b4582b1", "committedDate": "2020-12-01T22:36:03Z", "message": "Initial attempt to resolve issue with flickering statuses when override\npresent on OTGW\n\nSigned-off-by: James Melville <jamesmelville@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2a0392f6a1141541da2b8eb39ceb9e10055e1ea", "author": {"user": {"login": "jamesmelville", "name": "James Melville"}}, "url": "https://github.com/openhab/openhab-addons/commit/b2a0392f6a1141541da2b8eb39ceb9e10055e1ea", "committedDate": "2020-12-01T22:36:52Z", "message": "apply spotless, fix enum usage\n\nSigned-off-by: James Melville <jamesmelville@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7193dbd90bec29dac9b8e229642850d2edd316dc", "author": {"user": {"login": "jamesmelville", "name": "James Melville"}}, "url": "https://github.com/openhab/openhab-addons/commit/7193dbd90bec29dac9b8e229642850d2edd316dc", "committedDate": "2020-12-02T23:12:23Z", "message": "Update readme\n\nSigned-off-by: James Melville <jamesmelville@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0NjI0ODEz", "url": "https://github.com/openhab/openhab-addons/pull/9206#pullrequestreview-544624813", "createdAt": "2020-12-04T03:06:09Z", "commit": {"oid": "7193dbd90bec29dac9b8e229642850d2edd316dc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwMzowNjowOVrOH--wTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwMzowNjowOVrOH--wTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTgwMTkzMw==", "bodyText": "Can you give these enum value more verbose names?", "url": "https://github.com/openhab/openhab-addons/pull/9206#discussion_r535801933", "createdAt": "2020-12-04T03:06:09Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.openthermgateway/src/main/java/org/openhab/binding/openthermgateway/internal/CodeType.java", "diffHunk": "@@ -0,0 +1,49 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.openthermgateway.internal;\n+\n+/**\n+ * The {@link CodeType} field is not part of OpenTherm specification, but added by OpenTherm Gateway.\n+ * It can be any of the following:\n+ *\n+ * T: Message received from the thermostat\n+ * B: Message received from the boiler\n+ * R: Request sent to the boiler\n+ * A: Response returned to the thermostat\n+ * E: Parity or stop bit error\n+ *\n+ * @author Arjen Korevaar - Initial contribution\n+ * @author James Melville - Introduced code filtering functionality\n+ */\n+public enum CodeType {\n+    /**\n+     * Message received from the thermostat\n+     */\n+    T,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7193dbd90bec29dac9b8e229642850d2edd316dc"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MjExNzU4", "url": "https://github.com/openhab/openhab-addons/pull/9206#pullrequestreview-545211758", "createdAt": "2020-12-04T18:47:28Z", "commit": {"oid": "7193dbd90bec29dac9b8e229642850d2edd316dc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxODo0NzoyOFrOH_dffQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxODo0OTo1MlrOH_dkqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjMwNTUzMw==", "bodyText": "It is possible for CodeType.valueOf(code); to throw an exception if the given code isn't one of the enum values. Since a constructor isn't really a suitable place to do exception handling I think is would be better if you changed the code parameter from String to CodeType so that you push the burden of exception handling to the caller instead.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public Message(String code, MessageType messageType, int id, String data) {\n          \n          \n            \n                public Message(CodeType code, MessageType messageType, int id, String data) {", "url": "https://github.com/openhab/openhab-addons/pull/9206#discussion_r536305533", "createdAt": "2020-12-04T18:47:28Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.openthermgateway/src/main/java/org/openhab/binding/openthermgateway/internal/Message.java", "diffHunk": "@@ -149,7 +139,7 @@ public String toString() {\n     }\n \n     public Message(String code, MessageType messageType, int id, String data) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7193dbd90bec29dac9b8e229642850d2edd316dc"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjMwNjg1Ng==", "bodyText": "Enum comparisons are one of the few instances in which reference comparing is safe.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            && (CodeType.R.equals(this.getCode()) || CodeType.A.equals(this.getCode()));\n          \n          \n            \n                            && (this.code == CodeType.R || this.code == CodeType.A);", "url": "https://github.com/openhab/openhab-addons/pull/9206#discussion_r536306856", "createdAt": "2020-12-04T18:49:52Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.openthermgateway/src/main/java/org/openhab/binding/openthermgateway/internal/Message.java", "diffHunk": "@@ -140,7 +130,7 @@ public boolean overrides(@Nullable Message other) {\n         // thermostat, and it's ID is equal to the previous message, then this is an\n         // override sent by the OpenTherm Gateway\n         return other != null && this.getID() == other.getID()\n-                && (\"R\".equals(this.getCode()) || \"A\".equals(this.getCode()));\n+                && (CodeType.R.equals(this.getCode()) || CodeType.A.equals(this.getCode()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7193dbd90bec29dac9b8e229642850d2edd316dc"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd5a2dba16c079ff4230e5a3b9e86a045fd9ba05", "author": {"user": {"login": "jamesmelville", "name": "James Melville"}}, "url": "https://github.com/openhab/openhab-addons/commit/dd5a2dba16c079ff4230e5a3b9e86a045fd9ba05", "committedDate": "2020-12-04T21:55:25Z", "message": "Refactor use of CodeType enum\n\nSigned-off-by: James Melville <jamesmelville@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MzI5ODcz", "url": "https://github.com/openhab/openhab-addons/pull/9206#pullrequestreview-545329873", "createdAt": "2020-12-04T22:06:01Z", "commit": {"oid": "dd5a2dba16c079ff4230e5a3b9e86a045fd9ba05"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQyMjowNjowMVrOH_j8KA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQyMjowODozNFrOH_kAlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQxMTE3Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t<state readOnly=\"true\" pattern=\"%.1f %unit%\"></state>\n          \n          \n            \n            \t\t<state readOnly=\"true\" pattern=\"%.1f %unit%\" />", "url": "https://github.com/openhab/openhab-addons/pull/9206#discussion_r536411176", "createdAt": "2020-12-04T22:06:01Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.openthermgateway/src/main/resources/OH-INF/thing/channels.xml", "diffHunk": "@@ -39,11 +39,27 @@\n \t<channel-type id=\"controlsetpoint\">\n \t\t<item-type>Number:Temperature</item-type>\n \t\t<label>Control Setpoint</label>\n-\t\t<description>Central heating water setpoint</description>\n+\t\t<description>Central heating water setpoint set at boiler</description>\n \t\t<category>Temperature</category>\n \t\t<state readOnly=\"true\" pattern=\"%.1f %unit%\"></state>\n \t</channel-type>\n \n+\t<channel-type id=\"controlsetpointrequested\">\n+\t\t<item-type>Number:Temperature</item-type>\n+\t\t<label>Control Setpoint Requested</label>\n+\t\t<description>Central heating water setpoint requested by Thermostat</description>\n+\t\t<category>Temperature</category>\n+\t\t<state readOnly=\"true\" pattern=\"%.1f %unit%\"></state>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd5a2dba16c079ff4230e5a3b9e86a045fd9ba05"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQxMTI0Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t<state pattern=\"%.1f %unit%\"></state>\n          \n          \n            \n            \t\t<state pattern=\"%.1f %unit%\" />", "url": "https://github.com/openhab/openhab-addons/pull/9206#discussion_r536411243", "createdAt": "2020-12-04T22:06:11Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.openthermgateway/src/main/resources/OH-INF/thing/channels.xml", "diffHunk": "@@ -39,11 +39,27 @@\n \t<channel-type id=\"controlsetpoint\">\n \t\t<item-type>Number:Temperature</item-type>\n \t\t<label>Control Setpoint</label>\n-\t\t<description>Central heating water setpoint</description>\n+\t\t<description>Central heating water setpoint set at boiler</description>\n \t\t<category>Temperature</category>\n \t\t<state readOnly=\"true\" pattern=\"%.1f %unit%\"></state>\n \t</channel-type>\n \n+\t<channel-type id=\"controlsetpointrequested\">\n+\t\t<item-type>Number:Temperature</item-type>\n+\t\t<label>Control Setpoint Requested</label>\n+\t\t<description>Central heating water setpoint requested by Thermostat</description>\n+\t\t<category>Temperature</category>\n+\t\t<state readOnly=\"true\" pattern=\"%.1f %unit%\"></state>\n+\t</channel-type>\n+\n+\t<channel-type id=\"controlsetpointoverride\">\n+\t\t<item-type>Number:Temperature</item-type>\n+\t\t<label>Control Setpoint Override</label>\n+\t\t<description>Central heating water setpoint configured on OTGW</description>\n+\t\t<category>Temperature</category>\n+\t\t<state pattern=\"%.1f %unit%\"></state>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd5a2dba16c079ff4230e5a3b9e86a045fd9ba05"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQxMTgxMw==", "bodyText": "Should ControlSetpointOverride be a Setpoint?", "url": "https://github.com/openhab/openhab-addons/pull/9206#discussion_r536411813", "createdAt": "2020-12-04T22:07:23Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.openthermgateway/README.md", "diffHunk": "@@ -114,6 +122,8 @@ sitemap demo label=\"Main Menu\" {\n         Setpoint item=\"TemporaryRoomSetpointOverride\" icon=\"temperature\" label=\"Temporary room setpoint override [%.1f \u00b0C]\" minValue=\"0\" maxValue=\"30\" step=\"0.1\"\n         Setpoint item=\"ConstantRoomSetpointOverride\" icon=\"temperature\" label=\"Constant room setpoint override [%.1f \u00b0C]\" minValue=\"0\" maxValue=\"30\" step=\"0.1\"\n         Text item=\"ControlSetpoint\" icon=\"temperature\" label=\"Control setpoint [%.1f \u00b0C]\"\n+        Text item=\"ControlSetpointRequested\" icon=\"temperature\" label=\"Control setpoint requested [%.1f \u00b0C]\"\n+        Text item=\"ControlSetpointOverride\" icon=\"temperature\" label=\"Control setpoint override [%.1f \u00b0C]\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd5a2dba16c079ff4230e5a3b9e86a045fd9ba05"}, "originalPosition": 94}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQxMjMxMA==", "bodyText": "All of these temperature channels should have their item type listed as Number:Temperature.", "url": "https://github.com/openhab/openhab-addons/pull/9206#discussion_r536412310", "createdAt": "2020-12-04T22:08:34Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.openthermgateway/README.md", "diffHunk": "@@ -32,36 +32,40 @@ The configuration settings for the thing are Hostname/IP address and Port, which\n \n The OpenTherm Gateway binding supports the following channels:\n \n-| Channel Type ID      | Item Type | Description                                              | Read Only |\n-|----------------------|-----------|----------------------------------------------------------|-----------|\n-| roomtemp             | Number    | Current sensed room temperature                          | yes       |\n-| roomsetpoint         | Number    | Current room temperature setpoint                        | yes       |\n-| temperaturetemporary | Number    | Temporary override room temperature setpoint             | no        |\n-| temperatureconstant  | Number    | Constant override room temperature setpoint              | no        |\n-| controlsetpoint      | Number    | Central heating water setpoint                           | yes       |\n-| dhwtemp              | Number    | Domestic hot water temperature                           | yes       |\n-| tdhwset              | Number    | Domestic hot water temperature setpoint                  | yes       |\n-| overridedhwsetpoint  | Number    | Domestic hot water temperature setpoint override         | no        |\n-| flowtemp             | Number    | Boiler water temperature                                 | yes       |\n-| returntemp           | Number    | Return water temperature                                 | yes       |\n-| outsidetemp          | Number    | Outside temperature                                      | no        |\n-| waterpressure        | Number    | Central heating water pressure                           | yes       |\n-| ch_enable            | Switch    | Central heating enabled                                  | yes       |\n-| ch_mode              | Switch    | Central heating active                                   | yes       |\n-| dhw_enable           | Switch    | Domestic hot water enabled                               | yes       |\n-| dhw_mode             | Switch    | Domestic hot water active                                | yes       |\n-| flame                | Switch    | Burner active                                            | yes       |\n-| modulevel            | Number    | Relative modulation level                                | yes       |\n-| maxrelmdulevel       | Number    | Maximum relative modulation level                        | yes       |\n-| fault                | Switch    | Fault indication                                         | yes       |\n-| servicerequest       | Switch    | Service required                                         | yes       |\n-| lockout-reset        | Switch    | Lockout-reset enabled                                    | yes       |\n-| lowwaterpress        | Switch    | Low water pressure fault                                 | yes       |\n-| gasflamefault        | Switch    | Gas or flame fault                                       | yes       |\n-| airpressfault        | Switch    | Air pressure fault                                       | yes       |\n-| waterovtemp          | Switch    | Water over-temperature fault                             | yes       |\n-| oemfaultcode         | Switch    | OEM fault code                                           | yes       |\n-| sendcommand          | Text      | Channel to send commands to the OpenTherm Gateway device | no        |\n+| Channel Type ID          | Item Type | Description                                              | Read Only |\n+|--------------------------|-----------|----------------------------------------------------------|-----------|\n+| roomtemp                 | Number    | Current sensed room temperature                          | yes       |\n+| roomsetpoint             | Number    | Current room temperature setpoint                        | yes       |\n+| temperaturetemporary     | Number    | Temporary override room temperature setpoint             | no        |\n+| temperatureconstant      | Number    | Constant override room temperature setpoint              | no        |\n+| controlsetpoint          | Number    | Central heating water setpoint set at boiler             | yes       |\n+| controlsetpointrequested | Number    | Central heating water setpoint requested by thermostat   | yes       |\n+| controlsetpointoverride  | Number    | Central heating water setpoint configured at gateway     | yes       |\n+| dhwtemp                  | Number    | Domestic hot water temperature                           | yes       |\n+| tdhwset                  | Number    | Domestic hot water temperature setpoint                  | yes       |\n+| overridedhwsetpoint      | Number    | Domestic hot water temperature setpoint override         | no        |\n+| flowtemp                 | Number    | Boiler water temperature                                 | yes       |\n+| returntemp               | Number    | Return water temperature                                 | yes       |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd5a2dba16c079ff4230e5a3b9e86a045fd9ba05"}, "originalPosition": 47}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c47f416b576fb27ff7e93f1a5c929c1f7a601fbf", "author": {"user": {"login": "jamesmelville", "name": "James Melville"}}, "url": "https://github.com/openhab/openhab-addons/commit/c47f416b576fb27ff7e93f1a5c929c1f7a601fbf", "committedDate": "2020-12-06T21:09:07Z", "message": "Update from review comments\n\nSigned-off-by: James Melville <jamesmelville@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1ODQyODMy", "url": "https://github.com/openhab/openhab-addons/pull/9206#pullrequestreview-545842832", "createdAt": "2020-12-07T05:38:21Z", "commit": {"oid": "c47f416b576fb27ff7e93f1a5c929c1f7a601fbf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d8597ae1e2089041eb127eacac1b0511cdd55ea", "author": {"user": {"login": "jamesmelville", "name": "James Melville"}}, "url": "https://github.com/openhab/openhab-addons/commit/7d8597ae1e2089041eb127eacac1b0511cdd55ea", "committedDate": "2020-12-07T21:09:37Z", "message": "Update Units\n\nSigned-off-by: James Melville <jamesmelville@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NjAyNDQ1", "url": "https://github.com/openhab/openhab-addons/pull/9206#pullrequestreview-546602445", "createdAt": "2020-12-07T22:46:13Z", "commit": {"oid": "7d8597ae1e2089041eb127eacac1b0511cdd55ea"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3971, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}