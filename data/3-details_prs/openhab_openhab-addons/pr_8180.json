{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU1ODgxNjQ0", "number": 8180, "title": "[telegram] Added support for long polling", "bodyText": "This PL closes #7043\nI added a new parameter for long polling. There is a new parameter with default value 25 seconds. The Telegram WebApp uses 25 seconds. Maximal value is 50 seconds. After this time the telegram api interups the connection.\nAdditional i fixed some warnings.", "createdAt": "2020-07-23T18:27:48Z", "url": "https://github.com/openhab/openhab-addons/pull/8180", "merged": true, "mergeCommit": {"oid": "95a47fa17dbecd442897b88fa1bf1ada3d736f56"}, "closed": true, "closedAt": "2020-07-29T20:42:06Z", "author": {"login": "EvilPingu"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc49GTUAFqTQ1NTUzNjMyOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5wgJHgFqTQ1NzgzNzk4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1NTM2MzI4", "url": "https://github.com/openhab/openhab-addons/pull/8180#pullrequestreview-455536328", "createdAt": "2020-07-27T07:31:38Z", "commit": {"oid": "307feb149b7364d0c3363171ea7ece0d44b8b3e5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QwNzozMTozOFrOG3Ww3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QwNzo0NTo1NVrOG3XM4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY5NzgyMA==", "bodyText": "Why is the parameter set to \"required\"? I don't think this is necessary (since we also have a default value) and I think we would have issues with backward compatibility (an update of the Telegram component would break an existing configuration).", "url": "https://github.com/openhab/openhab-addons/pull/8180#discussion_r460697820", "createdAt": "2020-07-27T07:31:38Z", "author": {"login": "ZzetT"}, "path": "bundles/org.openhab.binding.telegram/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -55,6 +56,11 @@\n \t\t\t\t<default>SOCKS5</default>\n \t\t\t\t<description>Enter your proxy type. Default: SOCKS5</description>\n \t\t\t</parameter>\n+\t\t\t<parameter name=\"longPollingTime\" type=\"integer\" required=\"true\" min=\"0\" max=\"50\" unit=\"s\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "307feb149b7364d0c3363171ea7ece0d44b8b3e5"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY5ODY1Mw==", "bodyText": "Do these line brakes happen when you run make or are they related to your editor? (same with pom.xml)", "url": "https://github.com/openhab/openhab-addons/pull/8180#discussion_r460698653", "createdAt": "2020-07-27T07:33:22Z", "author": {"login": "ZzetT"}, "path": "bundles/org.openhab.binding.telegram/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -25,7 +25,8 @@\n \t\t\t</parameter>\n \t\t\t<parameter name=\"chatIds\" type=\"text\" required=\"true\" multiple=\"true\">\n \t\t\t\t<label>Chat Id(s)</label>\n-\t\t\t\t<description>One or more chat id(s). Access modifiers (\"&lt;\" for inbound only, \"&gt;\" for outbound only) can be used as prefix (optional).</description>\n+\t\t\t\t<description>One or more chat id(s). Access modifiers (\"&lt;\" for inbound only, \"&gt;\" for outbound only) can be\n+\t\t\t\t\tused as prefix (optional).</description>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "307feb149b7364d0c3363171ea7ece0d44b8b3e5"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcwNDk5Mg==", "bodyText": "It's a good idea to move code blocks to a new separate methods. The only thing that I don't like now is that this method has side effects (adding elements to a list which is a class members). Whereas for the initialize method it is quite clear that it's only called once or if it is called more often, the lists are cleared beforehand. Now, you need a very implicit knowledge on that new method at what point in time this method shall be called and how often.\nThe best way would be to remove the side effect, make it static and to just return the result. However, returning two lists is also a bit ugly (e.g. using the Pair<> class).\nOr maybe we should at least move the authorizedSenderChatId.clear(); receiverChatId.clear(); to that method too so that the result of the method is always the same (no matter when and how often it is called). What is your opinion?", "url": "https://github.com/openhab/openhab-addons/pull/8180#discussion_r460704992", "createdAt": "2020-07-27T07:45:55Z", "author": {"login": "ZzetT"}, "path": "bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/internal/TelegramHandler.java", "diffHunk": "@@ -196,7 +183,34 @@ public void initialize() {\n         updateStatus(ThingStatus.UNKNOWN);\n         delayThingOnlineStatus();\n         TelegramBot localBot = bot = new TelegramBot.Builder(botToken).okHttpClient(botLibClient).build();\n-        localBot.setUpdatesListener(this::handleUpdates, this::handleExceptions);\n+        localBot.setUpdatesListener(this::handleUpdates, this::handleExceptions,\n+                getGetUpdatesRequest(config.getLongPollingTime()));\n+    }\n+\n+    private void createReceiverChatIdsAndAuthorizedSenderChatIds(List<String> chatIds) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "307feb149b7364d0c3363171ea7ece0d44b8b3e5"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2NDIxNzk5", "url": "https://github.com/openhab/openhab-addons/pull/8180#pullrequestreview-456421799", "createdAt": "2020-07-28T08:39:26Z", "commit": {"oid": "84a57b952525b20f5e463a988d082b21c620a974"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NDYxMzg3", "url": "https://github.com/openhab/openhab-addons/pull/8180#pullrequestreview-457461387", "createdAt": "2020-07-29T12:15:05Z", "commit": {"oid": "84a57b952525b20f5e463a988d082b21c620a974"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMjoxNTowNVrOG41qLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMjoxNTowNVrOG41qLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjI1MjU5MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            | `longPollingTime`       |  25     | No       | TimeSpan for long polling the telegram API                                                   |\n          \n          \n            \n            | `longPollingTime`       |  25     | No       | Timespan for long polling the telegram API                                                   |", "url": "https://github.com/openhab/openhab-addons/pull/8180#discussion_r462252590", "createdAt": "2020-07-29T12:15:05Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.telegram/README.md", "diffHunk": "@@ -61,11 +62,14 @@ In order to send a message, an action must be used instead.\n | `proxyHost`             |  None   | No       | Proxy host for telegram binding.                                                             |\n | `proxyPort`             |  None   | No       | Proxy port for telegram binding.                                                             |\n | `proxyType`             |  SOCKS5 | No       | Type of proxy server for telegram binding (SOCKS5 or HTTP). Default: SOCKS5                  |\n+| `longPollingTime`       |  25     | No       | TimeSpan for long polling the telegram API                                                   |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84a57b952525b20f5e463a988d082b21c620a974"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7d85877b335497d62dee9f2ff42410149b7f680", "author": {"user": {"login": "EvilPingu", "name": "Christian Kittel"}}, "url": "https://github.com/openhab/openhab-addons/commit/f7d85877b335497d62dee9f2ff42410149b7f680", "committedDate": "2020-07-29T17:30:17Z", "message": "add long polling\n\nSigned-off-by: Christian Kittel <ckittel@gmx.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3ODM3OTg5", "url": "https://github.com/openhab/openhab-addons/pull/8180#pullrequestreview-457837989", "createdAt": "2020-07-29T19:50:19Z", "commit": {"oid": "f7d85877b335497d62dee9f2ff42410149b7f680"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 210, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}