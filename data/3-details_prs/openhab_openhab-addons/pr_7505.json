{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDExMTA5OTg2", "number": 7505, "title": "[coolmasternet] Fix buffer handling (fixes #7333)", "bodyText": "A more detailed discussion is in the bug report, but in summary:\n\nGracefully handle unsolicited socket opening prompt\nSink existing socket buffers in a deterministic manner\nPrevent socket close due to try-with-resources cleanup\nSend LF (nor CRLF) as per CoolMasterNet PRM\n\nTested locally including monitoring air conditioner state changes (using the manual control panel and also the CoolRemote mobile application) and sending commands (ie power, fan speed, mode, set temperature).", "createdAt": "2020-04-30T03:52:23Z", "url": "https://github.com/openhab/openhab-addons/pull/7505", "merged": true, "mergeCommit": {"oid": "a0f7c4d77df9158bd591d95f8243b66b2ede910d"}, "closed": true, "closedAt": "2020-05-01T15:53:36Z", "author": {"login": "benalexau"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccxzRpgFqTQwMzc3MjgwMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcc8ZZEAFqTQwNDA0OTE0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzNzcyODAy", "url": "https://github.com/openhab/openhab-addons/pull/7505#pullrequestreview-403772802", "createdAt": "2020-04-30T18:27:38Z", "commit": {"oid": "4356e59af432fdc7d774d4897d52a4ad800c6baf"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxODoyNzozOVrOGO1T8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxODo1NTozOVrOGO2Oxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODIwNjcwNg==", "bodyText": "If the stream isn't meant to be closed, there is no reason to use a try-with-resources.", "url": "https://github.com/openhab/openhab-addons/pull/7505#discussion_r418206706", "createdAt": "2020-04-30T18:27:39Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.coolmasternet/src/main/java/org/openhab/binding/coolmasternet/internal/ControllerHandler.java", "diffHunk": "@@ -146,9 +151,10 @@ public boolean isConnected() {\n                 logger.trace(\"Sending command '{}'\", command);\n                 OutputStream out = localSocket.getOutputStream();\n                 out.write(command.getBytes());\n-                out.write(\"\\r\\n\".getBytes());\n+                out.write(\"\\n\".getBytes());\n \n-                try (Reader isr = new InputStreamReader(localSocket.getInputStream());\n+                try (InputStream uis = new UncloseableInputStream(localSocket.getInputStream());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4356e59af432fdc7d774d4897d52a4ad800c6baf"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODIyMDY3Mg==", "bodyText": "The charset should be specified here.", "url": "https://github.com/openhab/openhab-addons/pull/7505#discussion_r418220672", "createdAt": "2020-04-30T18:53:37Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.coolmasternet/src/main/java/org/openhab/binding/coolmasternet/internal/ControllerHandler.java", "diffHunk": "@@ -146,9 +151,10 @@ public boolean isConnected() {\n                 logger.trace(\"Sending command '{}'\", command);\n                 OutputStream out = localSocket.getOutputStream();\n                 out.write(command.getBytes());\n-                out.write(\"\\r\\n\".getBytes());\n+                out.write(\"\\n\".getBytes());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4356e59af432fdc7d774d4897d52a4ad800c6baf"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODIyMTc2Nw==", "bodyText": "This will busy-loop if there is no input available.", "url": "https://github.com/openhab/openhab-addons/pull/7505#discussion_r418221767", "createdAt": "2020-04-30T18:55:39Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.coolmasternet/src/main/java/org/openhab/binding/coolmasternet/internal/ControllerHandler.java", "diffHunk": "@@ -205,21 +211,35 @@ private void checkConnection() throws CoolMasterClientError {\n                 }\n \n                 InputStream in = localSocket.getInputStream();\n-                /* Flush anything pending in the input stream */\n-                while (in.available() > 0) {\n-                    in.read();\n+\n+                // Sink (clear) buffer until earlier of the SINK_TIMEOUT or > prompt\n+                long deadline = System.currentTimeMillis() + SINK_TIMEOUT;\n+                while (System.currentTimeMillis() < deadline) {\n+                    if (in.available() > 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4356e59af432fdc7d774d4897d52a4ad800c6baf"}, "originalPosition": 50}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4356e59af432fdc7d774d4897d52a4ad800c6baf", "author": {"user": {"login": "benalexau", "name": "Ben Alex"}}, "url": "https://github.com/openhab/openhab-addons/commit/4356e59af432fdc7d774d4897d52a4ad800c6baf", "committedDate": "2020-04-30T03:28:34Z", "message": "[coolmasternet] Fix buffer handling (fixes #7333)\n\nA more detailed discussion is in the bug report, but in summary:\n\n* Gracefully handle unsolicited socket opening prompt\n* Sink existing socket buffers in a deterministic manner\n* Prevent socket close due to try-with-resources cleanup\n* Send LF (nor CRLF) as per CoolMasterNet PRM [1]\n\nTested locally including monitoring air conditioner state\nchanges (using the manual control panel and also the CoolRemote mobile\napplication) and sending commands (ie power, fan speed, mode, set\ntemperature).\n\n[1] https://coolautomation.com/wp-content/uploads/sites/2/2019/11/CMN5-PRM.pdf\n\nSigned-off-by: Ben Alex <ben.alex@acegi.com.au>"}, "afterCommit": {"oid": "fccd724b66bcabedc5b51cd2198bac210942ae12", "author": {"user": {"login": "benalexau", "name": "Ben Alex"}}, "url": "https://github.com/openhab/openhab-addons/commit/fccd724b66bcabedc5b51cd2198bac210942ae12", "committedDate": "2020-05-01T00:17:50Z", "message": "[coolmasternet] Fix buffer handling (fixes #7333)\n\nA more detailed discussion is in the bug report, but in summary:\n\n* Gracefully handle unsolicited socket opening prompt\n* Sink existing socket buffers in a deterministic manner\n* Prevent socket close due to try-with-resources cleanup\n* Send LF (nor CRLF) as per CoolMasterNet PRM [1]\n\nTested locally including monitoring air conditioner state\nchanges (using the manual control panel and also the CoolRemote mobile\napplication) and sending commands (ie power, fan speed, mode, set\ntemperature).\n\n[1] https://coolautomation.com/wp-content/uploads/sites/2/2019/11/CMN5-PRM.pdf\n\nSigned-off-by: Ben Alex <ben.alex@acegi.com.au>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzOTY1MTE2", "url": "https://github.com/openhab/openhab-addons/pull/7505#pullrequestreview-403965116", "createdAt": "2020-05-01T00:33:52Z", "commit": {"oid": "fccd724b66bcabedc5b51cd2198bac210942ae12"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwMDozMzo1MlrOGO-4JQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwMDozMzo1MlrOGO-4JQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM2MzQyOQ==", "bodyText": "in.readLine() will return null if the end of stream is reached. If that happens your code here will go into an infinite loop.", "url": "https://github.com/openhab/openhab-addons/pull/7505#discussion_r418363429", "createdAt": "2020-05-01T00:33:52Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.coolmasternet/src/main/java/org/openhab/binding/coolmasternet/internal/ControllerHandler.java", "diffHunk": "@@ -146,25 +151,19 @@ public boolean isConnected() {\n                 logger.trace(\"Sending command '{}'\", command);\n                 OutputStream out = localSocket.getOutputStream();\n                 out.write(command.getBytes());\n-                out.write(\"\\r\\n\".getBytes());\n+                out.write(LF);\n \n-                try (Reader isr = new InputStreamReader(localSocket.getInputStream());\n-                        BufferedReader in = new BufferedReader(isr)) {\n-                    while (true) {\n-                        String line = in.readLine();\n-                        logger.trace(\"Read result '{}'\", line);\n-                        if (\"OK\".equals(line)) {\n-                            return response.toString();\n-                        }\n-                        response.append(line);\n-                        if (response.length() > 100) {\n-                            /*\n-                             * Usually this loop times out on errors, but in the case that we just keep getting\n-                             * data we should also fail with an error.\n-                             */\n-                            throw new CoolMasterClientError(\n-                                    String.format(\"Got gibberish response to command %s\", command));\n-                        }\n+                final Reader isr = new InputStreamReader(localSocket.getInputStream());\n+                final BufferedReader in = new BufferedReader(isr);\n+                while (true) {\n+                    String line = in.readLine();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fccd724b66bcabedc5b51cd2198bac210942ae12"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzOTcyMTYw", "url": "https://github.com/openhab/openhab-addons/pull/7505#pullrequestreview-403972160", "createdAt": "2020-05-01T01:00:44Z", "commit": {"oid": "fccd724b66bcabedc5b51cd2198bac210942ae12"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwMTowMDo0NFrOGO_SUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwMTowMDo0NFrOGO_SUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM3MDEzMA==", "bodyText": "Shouldn't the character encoding be specified here as well?", "url": "https://github.com/openhab/openhab-addons/pull/7505#discussion_r418370130", "createdAt": "2020-05-01T01:00:44Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.coolmasternet/src/main/java/org/openhab/binding/coolmasternet/internal/ControllerHandler.java", "diffHunk": "@@ -146,25 +151,19 @@ public boolean isConnected() {\n                 logger.trace(\"Sending command '{}'\", command);\n                 OutputStream out = localSocket.getOutputStream();\n                 out.write(command.getBytes());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fccd724b66bcabedc5b51cd2198bac210942ae12"}, "originalPosition": 22}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fccd724b66bcabedc5b51cd2198bac210942ae12", "author": {"user": {"login": "benalexau", "name": "Ben Alex"}}, "url": "https://github.com/openhab/openhab-addons/commit/fccd724b66bcabedc5b51cd2198bac210942ae12", "committedDate": "2020-05-01T00:17:50Z", "message": "[coolmasternet] Fix buffer handling (fixes #7333)\n\nA more detailed discussion is in the bug report, but in summary:\n\n* Gracefully handle unsolicited socket opening prompt\n* Sink existing socket buffers in a deterministic manner\n* Prevent socket close due to try-with-resources cleanup\n* Send LF (nor CRLF) as per CoolMasterNet PRM [1]\n\nTested locally including monitoring air conditioner state\nchanges (using the manual control panel and also the CoolRemote mobile\napplication) and sending commands (ie power, fan speed, mode, set\ntemperature).\n\n[1] https://coolautomation.com/wp-content/uploads/sites/2/2019/11/CMN5-PRM.pdf\n\nSigned-off-by: Ben Alex <ben.alex@acegi.com.au>"}, "afterCommit": {"oid": "f3df0027499b797ccb6d3bdc97d631f4ab39a182", "author": {"user": {"login": "benalexau", "name": "Ben Alex"}}, "url": "https://github.com/openhab/openhab-addons/commit/f3df0027499b797ccb6d3bdc97d631f4ab39a182", "committedDate": "2020-05-01T01:08:37Z", "message": "[coolmasternet] Fix buffer handling (fixes #7333)\n\nA more detailed discussion is in the bug report, but in summary:\n\n* Gracefully handle unsolicited socket opening prompt\n* Sink existing socket buffers in a deterministic manner\n* Prevent socket close due to try-with-resources cleanup\n* Send LF (nor CRLF) as per CoolMasterNet PRM [1]\n\nTested locally including monitoring air conditioner state\nchanges (using the manual control panel and also the CoolRemote mobile\napplication) and sending commands (ie power, fan speed, mode, set\ntemperature).\n\n[1] https://coolautomation.com/wp-content/uploads/sites/2/2019/11/CMN5-PRM.pdf\n\nSigned-off-by: Ben Alex <ben.alex@acegi.com.au>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzOTg4OTUz", "url": "https://github.com/openhab/openhab-addons/pull/7505#pullrequestreview-403988953", "createdAt": "2020-05-01T02:09:01Z", "commit": {"oid": "f3df0027499b797ccb6d3bdc97d631f4ab39a182"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwMjowOTowMlrOGPAOlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwMjowOTowMlrOGPAOlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM4NTU1Ng==", "bodyText": "please format this, this has the wrong indentation.", "url": "https://github.com/openhab/openhab-addons/pull/7505#discussion_r418385556", "createdAt": "2020-05-01T02:09:02Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.coolmasternet/src/main/java/org/openhab/binding/coolmasternet/internal/ControllerHandler.java", "diffHunk": "@@ -205,21 +204,41 @@ private void checkConnection() throws CoolMasterClientError {\n                 }\n \n                 InputStream in = localSocket.getInputStream();\n-                /* Flush anything pending in the input stream */\n-                while (in.available() > 0) {\n-                    in.read();\n+\n+                // Sink (clear) buffer until earlier of the SINK_TIMEOUT or > prompt\n+                try {\n+                    localSocket.setSoTimeout(SINK_TIMEOUT);\n+                    while (true) {\n+                        int b = in.read();\n+                        if (b == -1) {\n+                          break;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3df0027499b797ccb6d3bdc97d631f4ab39a182"}, "originalPosition": 73}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzOTg5MzE3", "url": "https://github.com/openhab/openhab-addons/pull/7505#pullrequestreview-403989317", "createdAt": "2020-05-01T02:10:41Z", "commit": {"oid": "f3df0027499b797ccb6d3bdc97d631f4ab39a182"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwMjoxMDo0MVrOGPAP4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwMjoxMDo0MVrOGPAP4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM4NTg5MA==", "bodyText": "Shouldn't a charset be specified for this reader?", "url": "https://github.com/openhab/openhab-addons/pull/7505#discussion_r418385890", "createdAt": "2020-05-01T02:10:41Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.coolmasternet/src/main/java/org/openhab/binding/coolmasternet/internal/ControllerHandler.java", "diffHunk": "@@ -145,26 +150,20 @@ public boolean isConnected() {\n \n                 logger.trace(\"Sending command '{}'\", command);\n                 OutputStream out = localSocket.getOutputStream();\n-                out.write(command.getBytes());\n-                out.write(\"\\r\\n\".getBytes());\n+                out.write(command.getBytes(StandardCharsets.US_ASCII));\n+                out.write(LF);\n \n-                try (Reader isr = new InputStreamReader(localSocket.getInputStream());\n-                        BufferedReader in = new BufferedReader(isr)) {\n-                    while (true) {\n-                        String line = in.readLine();\n-                        logger.trace(\"Read result '{}'\", line);\n-                        if (\"OK\".equals(line)) {\n-                            return response.toString();\n-                        }\n-                        response.append(line);\n-                        if (response.length() > 100) {\n-                            /*\n-                             * Usually this loop times out on errors, but in the case that we just keep getting\n-                             * data we should also fail with an error.\n-                             */\n-                            throw new CoolMasterClientError(\n-                                    String.format(\"Got gibberish response to command %s\", command));\n-                        }\n+                final Reader isr = new InputStreamReader(localSocket.getInputStream());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3df0027499b797ccb6d3bdc97d631f4ab39a182"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzOTg5NTY1", "url": "https://github.com/openhab/openhab-addons/pull/7505#pullrequestreview-403989565", "createdAt": "2020-05-01T02:11:54Z", "commit": {"oid": "f3df0027499b797ccb6d3bdc97d631f4ab39a182"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwMjoxMTo1NFrOGPAQ4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwMjoxMTo1NFrOGPAQ4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM4NjE0Ng==", "bodyText": "please log this anyway, you can log it as DEBUG", "url": "https://github.com/openhab/openhab-addons/pull/7505#discussion_r418386146", "createdAt": "2020-05-01T02:11:54Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.coolmasternet/src/main/java/org/openhab/binding/coolmasternet/internal/ControllerHandler.java", "diffHunk": "@@ -205,21 +204,41 @@ private void checkConnection() throws CoolMasterClientError {\n                 }\n \n                 InputStream in = localSocket.getInputStream();\n-                /* Flush anything pending in the input stream */\n-                while (in.available() > 0) {\n-                    in.read();\n+\n+                // Sink (clear) buffer until earlier of the SINK_TIMEOUT or > prompt\n+                try {\n+                    localSocket.setSoTimeout(SINK_TIMEOUT);\n+                    while (true) {\n+                        int b = in.read();\n+                        if (b == -1) {\n+                          break;\n+                        }\n+                        if (b == PROMPT) {\n+                            if (in.available() > 0) {\n+                                throw new IOException(\"Unexpected data following prompt\");\n+                            }\n+                            logger.trace(\"Buffer empty following unsolicited > prompt\");\n+                            return;\n+                        }\n+                    }\n+                } catch (final IOException ignoredAsLikelySocketTimeout) {\n+                } finally {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3df0027499b797ccb6d3bdc97d631f4ab39a182"}, "originalPosition": 84}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f3df0027499b797ccb6d3bdc97d631f4ab39a182", "author": {"user": {"login": "benalexau", "name": "Ben Alex"}}, "url": "https://github.com/openhab/openhab-addons/commit/f3df0027499b797ccb6d3bdc97d631f4ab39a182", "committedDate": "2020-05-01T01:08:37Z", "message": "[coolmasternet] Fix buffer handling (fixes #7333)\n\nA more detailed discussion is in the bug report, but in summary:\n\n* Gracefully handle unsolicited socket opening prompt\n* Sink existing socket buffers in a deterministic manner\n* Prevent socket close due to try-with-resources cleanup\n* Send LF (nor CRLF) as per CoolMasterNet PRM [1]\n\nTested locally including monitoring air conditioner state\nchanges (using the manual control panel and also the CoolRemote mobile\napplication) and sending commands (ie power, fan speed, mode, set\ntemperature).\n\n[1] https://coolautomation.com/wp-content/uploads/sites/2/2019/11/CMN5-PRM.pdf\n\nSigned-off-by: Ben Alex <ben.alex@acegi.com.au>"}, "afterCommit": {"oid": "4804db5dc006e045b1242d1a0d47ed20cedd6947", "author": {"user": {"login": "benalexau", "name": "Ben Alex"}}, "url": "https://github.com/openhab/openhab-addons/commit/4804db5dc006e045b1242d1a0d47ed20cedd6947", "committedDate": "2020-05-01T06:45:32Z", "message": "[coolmasternet] Fix buffer handling (fixes #7333)\n\nA more detailed discussion is in the bug report, but in summary:\n\n* Gracefully handle unsolicited socket opening prompt\n* Sink existing socket buffers in a deterministic manner\n* Prevent socket close due to try-with-resources cleanup\n* Send LF (nor CRLF) as per CoolMasterNet PRM [1]\n\nTested locally including monitoring air conditioner state\nchanges (using the manual control panel and also the CoolRemote mobile\napplication) and sending commands (ie power, fan speed, mode, set\ntemperature).\n\n[1] https://coolautomation.com/wp-content/uploads/sites/2/2019/11/CMN5-PRM.pdf\n\nSigned-off-by: Ben Alex <ben.alex@acegi.com.au>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4804db5dc006e045b1242d1a0d47ed20cedd6947", "author": {"user": {"login": "benalexau", "name": "Ben Alex"}}, "url": "https://github.com/openhab/openhab-addons/commit/4804db5dc006e045b1242d1a0d47ed20cedd6947", "committedDate": "2020-05-01T06:45:32Z", "message": "[coolmasternet] Fix buffer handling (fixes #7333)\n\nA more detailed discussion is in the bug report, but in summary:\n\n* Gracefully handle unsolicited socket opening prompt\n* Sink existing socket buffers in a deterministic manner\n* Prevent socket close due to try-with-resources cleanup\n* Send LF (nor CRLF) as per CoolMasterNet PRM [1]\n\nTested locally including monitoring air conditioner state\nchanges (using the manual control panel and also the CoolRemote mobile\napplication) and sending commands (ie power, fan speed, mode, set\ntemperature).\n\n[1] https://coolautomation.com/wp-content/uploads/sites/2/2019/11/CMN5-PRM.pdf\n\nSigned-off-by: Ben Alex <ben.alex@acegi.com.au>"}, "afterCommit": {"oid": "175fcaac20af82e13e8887b16f3bbd7900433dc5", "author": {"user": {"login": "benalexau", "name": "Ben Alex"}}, "url": "https://github.com/openhab/openhab-addons/commit/175fcaac20af82e13e8887b16f3bbd7900433dc5", "committedDate": "2020-05-01T06:59:02Z", "message": "[coolmasternet] Fix buffer handling (fixes #7333)\n\nA more detailed discussion is in the bug report, but in summary:\n\n* Gracefully handle unsolicited socket opening prompt\n* Sink existing socket buffers in a deterministic manner\n* Prevent socket close due to try-with-resources cleanup\n* Send LF (nor CRLF) as per CoolMasterNet PRM [1]\n\nTested locally including monitoring air conditioner state\nchanges (using the manual control panel and also the CoolRemote mobile\napplication) and sending commands (ie power, fan speed, mode, set\ntemperature).\n\n[1] https://coolautomation.com/wp-content/uploads/sites/2/2019/11/CMN5-PRM.pdf\n\nSigned-off-by: Ben Alex <ben.alex@acegi.com.au>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2a49e6218626fc4889f71cb1f77e66d782b2df7", "author": {"user": {"login": "benalexau", "name": "Ben Alex"}}, "url": "https://github.com/openhab/openhab-addons/commit/e2a49e6218626fc4889f71cb1f77e66d782b2df7", "committedDate": "2020-05-01T07:02:29Z", "message": "[coolmasternet] Fix buffer handling (fixes #7333)\n\nA more detailed discussion is in the bug report, but in summary:\n\n* Gracefully handle unsolicited socket opening prompt\n* Sink existing socket buffers in a deterministic manner\n* Prevent socket close due to try-with-resources cleanup\n* Send LF (nor CRLF) as per CoolMasterNet PRM [1]\n\nTested locally including monitoring air conditioner state\nchanges (using the manual control panel and also the CoolRemote mobile\napplication) and sending commands (ie power, fan speed, mode, set\ntemperature).\n\n[1] https://coolautomation.com/wp-content/uploads/sites/2/2019/11/CMN5-PRM.pdf\n\nSigned-off-by: Ben Alex <ben.alex@acegi.com.au>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "175fcaac20af82e13e8887b16f3bbd7900433dc5", "author": {"user": {"login": "benalexau", "name": "Ben Alex"}}, "url": "https://github.com/openhab/openhab-addons/commit/175fcaac20af82e13e8887b16f3bbd7900433dc5", "committedDate": "2020-05-01T06:59:02Z", "message": "[coolmasternet] Fix buffer handling (fixes #7333)\n\nA more detailed discussion is in the bug report, but in summary:\n\n* Gracefully handle unsolicited socket opening prompt\n* Sink existing socket buffers in a deterministic manner\n* Prevent socket close due to try-with-resources cleanup\n* Send LF (nor CRLF) as per CoolMasterNet PRM [1]\n\nTested locally including monitoring air conditioner state\nchanges (using the manual control panel and also the CoolRemote mobile\napplication) and sending commands (ie power, fan speed, mode, set\ntemperature).\n\n[1] https://coolautomation.com/wp-content/uploads/sites/2/2019/11/CMN5-PRM.pdf\n\nSigned-off-by: Ben Alex <ben.alex@acegi.com.au>"}, "afterCommit": {"oid": "e2a49e6218626fc4889f71cb1f77e66d782b2df7", "author": {"user": {"login": "benalexau", "name": "Ben Alex"}}, "url": "https://github.com/openhab/openhab-addons/commit/e2a49e6218626fc4889f71cb1f77e66d782b2df7", "committedDate": "2020-05-01T07:02:29Z", "message": "[coolmasternet] Fix buffer handling (fixes #7333)\n\nA more detailed discussion is in the bug report, but in summary:\n\n* Gracefully handle unsolicited socket opening prompt\n* Sink existing socket buffers in a deterministic manner\n* Prevent socket close due to try-with-resources cleanup\n* Send LF (nor CRLF) as per CoolMasterNet PRM [1]\n\nTested locally including monitoring air conditioner state\nchanges (using the manual control panel and also the CoolRemote mobile\napplication) and sending commands (ie power, fan speed, mode, set\ntemperature).\n\n[1] https://coolautomation.com/wp-content/uploads/sites/2/2019/11/CMN5-PRM.pdf\n\nSigned-off-by: Ben Alex <ben.alex@acegi.com.au>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MDQ5MTQ2", "url": "https://github.com/openhab/openhab-addons/pull/7505#pullrequestreview-404049146", "createdAt": "2020-05-01T07:18:00Z", "commit": {"oid": "e2a49e6218626fc4889f71cb1f77e66d782b2df7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 947, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}