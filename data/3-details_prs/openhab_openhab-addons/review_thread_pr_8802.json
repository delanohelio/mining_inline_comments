{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA1ODc1Mzcw", "number": 8802, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQxOTozODoxOVrOE2i7Tg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yN1QxNToxMToyNVrOFrOB_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1NjMwNzk4OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQxOTozODoxOVrOHvZzEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yNVQxNDoyMzo0NlrOIr3s7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ2Nzc5Mw==", "bodyText": "As you don't do anything with the AutomowerCommand in case the command is a refresh I would fetch the command in the else clause of the refresh check...", "url": "https://github.com/openhab/openhab-addons/pull/8802#discussion_r519467793", "createdAt": "2020-11-08T19:38:19Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -89,9 +110,24 @@ public AutomowerHandler(Thing thing) {\n \n     @Override\n     public void handleCommand(ChannelUID channelUID, Command command) {\n-        if (command instanceof RefreshType) {\n+        Optional<AutomowerCommand> commandName = AutomowerCommand.fromChannelUID(channelUID);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c14957e725b14132e7f2a9289d8848454706d637"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE3MTk0MA==", "bodyText": "@marcinczeczko can you comment on this?", "url": "https://github.com/openhab/openhab-addons/pull/8802#discussion_r527171940", "createdAt": "2020-11-19T20:18:51Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -89,9 +110,24 @@ public AutomowerHandler(Thing thing) {\n \n     @Override\n     public void handleCommand(ChannelUID channelUID, Command command) {\n-        if (command instanceof RefreshType) {\n+        Optional<AutomowerCommand> commandName = AutomowerCommand.fromChannelUID(channelUID);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ2Nzc5Mw=="}, "originalCommit": {"oid": "c14957e725b14132e7f2a9289d8848454706d637"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4Mjg3MTY2MA==", "bodyText": "Yep, it's a good idea. Will fix that", "url": "https://github.com/openhab/openhab-addons/pull/8802#discussion_r582871660", "createdAt": "2021-02-25T14:22:59Z", "author": {"login": "marcinczeczko"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -89,9 +110,24 @@ public AutomowerHandler(Thing thing) {\n \n     @Override\n     public void handleCommand(ChannelUID channelUID, Command command) {\n-        if (command instanceof RefreshType) {\n+        Optional<AutomowerCommand> commandName = AutomowerCommand.fromChannelUID(channelUID);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ2Nzc5Mw=="}, "originalCommit": {"oid": "c14957e725b14132e7f2a9289d8848454706d637"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4Mjg3MjMwMA==", "bodyText": "Good point. Will update", "url": "https://github.com/openhab/openhab-addons/pull/8802#discussion_r582872300", "createdAt": "2021-02-25T14:23:46Z", "author": {"login": "marcinczeczko"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -89,9 +110,24 @@ public AutomowerHandler(Thing thing) {\n \n     @Override\n     public void handleCommand(ChannelUID channelUID, Command command) {\n-        if (command instanceof RefreshType) {\n+        Optional<AutomowerCommand> commandName = AutomowerCommand.fromChannelUID(channelUID);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ2Nzc5Mw=="}, "originalCommit": {"oid": "c14957e725b14132e7f2a9289d8848454706d637"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1NjMxMDA2OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQxOTo0MDozNFrOHvZ0Dg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yNVQxNDoyMTo0MFrOIr3mmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ2ODA0Ng==", "bodyText": "Thanks for fixing the problem with the error timestamp :-)", "url": "https://github.com/openhab/openhab-addons/pull/8802#discussion_r519468046", "createdAt": "2020-11-08T19:40:34Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -243,26 +279,48 @@ public void sendAutomowerCommand(AutomowerCommand command, long commandDurationM\n         updateAutomowerState();\n     }\n \n+    private String restrictedState(RestrictedReason reason) {\n+        return \"RESTRICTED_\" + reason.name();\n+    }\n+\n     private void updateChannelState(Mower mower) {\n         if (isValidResult(mower)) {\n-            updateState(CHANNEL_MOWER_NAME, new StringType(mower.getAttributes().getSystem().getName()));\n-\n             updateState(CHANNEL_STATUS_MODE, new StringType(mower.getAttributes().getMower().getMode().name()));\n             updateState(CHANNEL_STATUS_ACTIVITY, new StringType(mower.getAttributes().getMower().getActivity().name()));\n-            updateState(CHANNEL_STATUS_STATE, new StringType(mower.getAttributes().getMower().getState().name()));\n \n-            Instant statusTimestamp = Instant.ofEpochMilli(mower.getAttributes().getMetadata().getStatusTimestamp());\n+            if (mower.getAttributes().getMower().getState() != State.RESTRICTED) {\n+                updateState(CHANNEL_STATUS_STATE, new StringType(mower.getAttributes().getMower().getState().name()));\n+            } else {\n+                updateState(CHANNEL_STATUS_STATE,\n+                        new StringType(restrictedState(mower.getAttributes().getPlanner().getRestrictedReason())));\n+            }\n+\n             updateState(CHANNEL_STATUS_LAST_UPDATE,\n-                    new DateTimeType(ZonedDateTime.ofInstant(statusTimestamp, ZoneId.systemDefault())));\n+                    new DateTimeType(toZonedDateTime(mower.getAttributes().getMetadata().getStatusTimestamp())));\n             updateState(CHANNEL_STATUS_BATTERY, new QuantityType<Dimensionless>(\n                     mower.getAttributes().getBattery().getBatteryPercent(), SmartHomeUnits.PERCENT));\n \n             updateState(CHANNEL_STATUS_ERROR_CODE, new DecimalType(mower.getAttributes().getMower().getErrorCode()));\n \n-            Instant errorCodeTimestamp = Instant.ofEpochMilli(mower.getAttributes().getMower().getErrorCodeTimestamp());\n-            updateState(CHANNEL_STATUS_ERROR_TIMESTAMP,\n-                    new DateTimeType(ZonedDateTime.ofInstant(errorCodeTimestamp, ZoneId.systemDefault())));\n+            long errorCodeTimestamp = mower.getAttributes().getMower().getErrorCodeTimestamp();\n+            if (errorCodeTimestamp == 0L) {\n+                updateState(CHANNEL_STATUS_ERROR_TIMESTAMP, UnDefType.NULL);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c14957e725b14132e7f2a9289d8848454706d637"}, "originalPosition": 145}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4Mjg3MDY4Mg==", "bodyText": "No problem :)", "url": "https://github.com/openhab/openhab-addons/pull/8802#discussion_r582870682", "createdAt": "2021-02-25T14:21:40Z", "author": {"login": "marcinczeczko"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -243,26 +279,48 @@ public void sendAutomowerCommand(AutomowerCommand command, long commandDurationM\n         updateAutomowerState();\n     }\n \n+    private String restrictedState(RestrictedReason reason) {\n+        return \"RESTRICTED_\" + reason.name();\n+    }\n+\n     private void updateChannelState(Mower mower) {\n         if (isValidResult(mower)) {\n-            updateState(CHANNEL_MOWER_NAME, new StringType(mower.getAttributes().getSystem().getName()));\n-\n             updateState(CHANNEL_STATUS_MODE, new StringType(mower.getAttributes().getMower().getMode().name()));\n             updateState(CHANNEL_STATUS_ACTIVITY, new StringType(mower.getAttributes().getMower().getActivity().name()));\n-            updateState(CHANNEL_STATUS_STATE, new StringType(mower.getAttributes().getMower().getState().name()));\n \n-            Instant statusTimestamp = Instant.ofEpochMilli(mower.getAttributes().getMetadata().getStatusTimestamp());\n+            if (mower.getAttributes().getMower().getState() != State.RESTRICTED) {\n+                updateState(CHANNEL_STATUS_STATE, new StringType(mower.getAttributes().getMower().getState().name()));\n+            } else {\n+                updateState(CHANNEL_STATUS_STATE,\n+                        new StringType(restrictedState(mower.getAttributes().getPlanner().getRestrictedReason())));\n+            }\n+\n             updateState(CHANNEL_STATUS_LAST_UPDATE,\n-                    new DateTimeType(ZonedDateTime.ofInstant(statusTimestamp, ZoneId.systemDefault())));\n+                    new DateTimeType(toZonedDateTime(mower.getAttributes().getMetadata().getStatusTimestamp())));\n             updateState(CHANNEL_STATUS_BATTERY, new QuantityType<Dimensionless>(\n                     mower.getAttributes().getBattery().getBatteryPercent(), SmartHomeUnits.PERCENT));\n \n             updateState(CHANNEL_STATUS_ERROR_CODE, new DecimalType(mower.getAttributes().getMower().getErrorCode()));\n \n-            Instant errorCodeTimestamp = Instant.ofEpochMilli(mower.getAttributes().getMower().getErrorCodeTimestamp());\n-            updateState(CHANNEL_STATUS_ERROR_TIMESTAMP,\n-                    new DateTimeType(ZonedDateTime.ofInstant(errorCodeTimestamp, ZoneId.systemDefault())));\n+            long errorCodeTimestamp = mower.getAttributes().getMower().getErrorCodeTimestamp();\n+            if (errorCodeTimestamp == 0L) {\n+                updateState(CHANNEL_STATUS_ERROR_TIMESTAMP, UnDefType.NULL);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ2ODA0Ng=="}, "originalCommit": {"oid": "c14957e725b14132e7f2a9289d8848454706d637"}, "originalPosition": 145}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1NjMxMTk3OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/README.md", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQxOTo0MzoyN1rOHvZ1BQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQxOTo0MzoyN1rOHvZ1BQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ2ODI5Mw==", "bodyText": "Cool, I like the new command channels. I tried to also do command channels in my initial contribution but they were rejected. But probably because of the way that I implemented them, they didn't fit well and were more like a workaround because I wanted to use actions.", "url": "https://github.com/openhab/openhab-addons/pull/8802#discussion_r519468293", "createdAt": "2020-11-08T19:43:27Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/README.md", "diffHunk": "@@ -34,23 +34,31 @@ With the default value of 1h this would mean ~720 requests per month for the bri\n - mowerId (mandatory): The Id of an automower as used by the Automower Connect Api to identify a mower. This is automatically filled when the thing is discovered\n - pollingInterval (optional): How often the current automower state should be polled in seconds. Default is 10min (600s)\n \n-Keep in mind that the status of the automowers should not be queried too often.\n-According to the Husqvarna documentation not more than 10000 requests per month and application key are allowed.\n-With the default value of 10min this would mean ~4300 requests per month per automower\n+Keep in mind that the status of the Automowers should not be queried too often.\n+According to the Husqvarna documentation, no more than 10000 requests per month and application key are allowed.\n+With the default value of 10min this would mean ~4300 requests per month per single Automower\n \n ## Channels\n \n \n-| channel         | type     | description                                                                                                                                                                 |\n-|-----------------|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n-| name            | String   | (readonly) The name of the Automower                                                                                                                                        |\n-| mode            | String   | (readonly) The current mode (MAIN_AREA, SECONDARY_AREA, HOME, DEMO, UNKNOWN)                                                                                                |\n-| activity        | String   | (readonly) The current activity (UNKNOWN, NOT_APPLICABLE, MOWING, GOING_HOME, CHARGING, LEAVING, PARKED_IN_CS, STOPPED_IN_GARDEN)                                           |\n-| state           | String   | (readonly) The current state (UNKNOWN, NOT_APPLICABLE, PAUSED, IN_OPERATION, WAIT_UPDATING, WAIT_POWER_UP, RESTRICTED, OFF, STOPPED, ERROR, FATAL_ERROR, ERROR_AT_POWER_UP) |\n-| last-update     | DateTime | (readonly) The time when the automower updated its states                                                                                                                   |\n-| battery         | Number   | (readonly) The battery state of charge in percent                                                                                                                           |\n-| error-code      | Number   | (readonly) The current error code                                                                                                                                           |\n-| error-timestamp | DateTime | (readonly) The timestamp when the current error occurred                                                                                                                    |\n+| channel                 | type     | access mode | description                                                                                                                                                                 |\n+|-------------------------|----------|-------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n+| mower-status#mode                     | String   | R | The current mode (MAIN_AREA, SECONDARY_AREA, HOME, DEMO, UNKNOWN)                                                                                                |\n+| mower-status#activity                 | String   | R | The current activity (UNKNOWN, NOT_APPLICABLE, MOWING, GOING_HOME, CHARGING, LEAVING, PARKED_IN_CS, STOPPED_IN_GARDEN)                                           |\n+| mower-status#state                   | String   | R | The current state (UNKNOWN, NOT_APPLICABLE, PAUSED, IN_OPERATION, WAIT_UPDATING, WAIT_POWER_UP, RESTRICTED_NONE, RESTRICTED_WEEK_SCHEDULE, RESTRICTED_PARK_OVERRIDE, RESTRICTED_SENSOR, RESTRICTED_DAILY_LIMIT, OFF, STOPPED, ERROR, FATAL_ERROR, ERROR_AT_POWER_UP)  |\n+| mower-status#last-update              | DateTime | R | The time when the automower updated its states                                                                                                                   |\n+| mower-status#battery                  | Number   | R | The battery state of charge in percent                                                                                                                           |\n+| mower-status#error-code               | Number   | R | The current error code                                                                                                                                           |\n+| mower-status#error-timestamp         | DateTime | R | The timestamp when the current error occurred                                                                                                                    |\n+| mower-status#planner-next-start      | DateTime | R | The time for the next auto start. If the mower is charging then the value is the estimated time when it will be leaving the charging station. If the mower is about to start now, the value is NULL.                                                                  |\n+| mower-status#planner-override-action | String   | R | The action that overrides current planner operation.                                                                                                                                                                                                                  |\n+| mower-status#calendar-tasks          | String   | R | The JSON with the information about Automower planner.                                                                                                    |\n+| mower#start                       | Number   | W | Starts the automower for a duration                     |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c14957e725b14132e7f2a9289d8848454706d637"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwNTQxMjE0OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/resources/OH-INF/thing/thing-types.xml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQyMDoyNzoxOFrOH2wTvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yNVQxNDoyMDo0MlrOIr3jrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE3NjYzNg==", "bodyText": "The grouping of the Channels makes the binding incompatible with current configurations. That means existing users need to remove their mower Thing, re-add it and adjust their Items configuration. Although this breaking change is allowed during the OH 2.5.x -> 3.0.0 release, I think it would annoy users. Is this change really worth it?\nAdding new Channels without touching existing ones is okay.", "url": "https://github.com/openhab/openhab-addons/pull/8802#discussion_r527176636", "createdAt": "2020-11-19T20:27:18Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/OH-INF/thing/thing-types.xml", "diffHunk": "@@ -42,16 +44,10 @@\n \t\t<label>Automower</label>\n \t\t<description>An automatic lawn mower</description>\n \n-\t\t<channels>\n-\t\t\t<channel id=\"name\" typeId=\"nameType\"/>\n-\t\t\t<channel id=\"mode\" typeId=\"modeType\"/>\n-\t\t\t<channel id=\"activity\" typeId=\"activityType\"/>\n-\t\t\t<channel id=\"state\" typeId=\"stateType\"/>\n-\t\t\t<channel id=\"last-update\" typeId=\"lastUpdateType\"/>\n-\t\t\t<channel id=\"battery\" typeId=\"batteryType\"/>\n-\t\t\t<channel id=\"error-code\" typeId=\"errorCodeType\"/>\n-\t\t\t<channel id=\"error-timestamp\" typeId=\"errorTimestampType\"/>\n-\t\t</channels>\n+\t\t<channel-groups>\n+\t\t\t<channel-group id=\"mower-status\" typeId=\"mowerStatus\"/>\n+\t\t\t<channel-group id=\"mower\" typeId=\"mowerCommands\"/>\n+\t\t</channel-groups>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c14957e725b14132e7f2a9289d8848454706d637"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4Mjg2OTkzMg==", "bodyText": "Thanks for that comment. I absolutely agree with that. Will update it accordingly", "url": "https://github.com/openhab/openhab-addons/pull/8802#discussion_r582869932", "createdAt": "2021-02-25T14:20:42Z", "author": {"login": "marcinczeczko"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/OH-INF/thing/thing-types.xml", "diffHunk": "@@ -42,16 +44,10 @@\n \t\t<label>Automower</label>\n \t\t<description>An automatic lawn mower</description>\n \n-\t\t<channels>\n-\t\t\t<channel id=\"name\" typeId=\"nameType\"/>\n-\t\t\t<channel id=\"mode\" typeId=\"modeType\"/>\n-\t\t\t<channel id=\"activity\" typeId=\"activityType\"/>\n-\t\t\t<channel id=\"state\" typeId=\"stateType\"/>\n-\t\t\t<channel id=\"last-update\" typeId=\"lastUpdateType\"/>\n-\t\t\t<channel id=\"battery\" typeId=\"batteryType\"/>\n-\t\t\t<channel id=\"error-code\" typeId=\"errorCodeType\"/>\n-\t\t\t<channel id=\"error-timestamp\" typeId=\"errorTimestampType\"/>\n-\t\t</channels>\n+\t\t<channel-groups>\n+\t\t\t<channel-group id=\"mower-status\" typeId=\"mowerStatus\"/>\n+\t\t\t<channel-group id=\"mower\" typeId=\"mowerCommands\"/>\n+\t\t</channel-groups>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE3NjYzNg=="}, "originalCommit": {"oid": "c14957e725b14132e7f2a9289d8848454706d637"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwNTQyMDA5OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/resources/OH-INF/thing/thing-types.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQyMDoyOTozOFrOH2wYrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQyMDoyOTozOFrOH2wYrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE3NzkwMA==", "bodyText": "Labels should be concise as possible. Also, words in labels should be capitalized (except prepositions and so on). See https://www.openhab.org/docs/developer/bindings/thing-xml.html#formatting-labels-and-descriptions\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t<label>The time for the next auto start</label>\n          \n          \n            \n            \t\t<label>Next Auto Start</label>", "url": "https://github.com/openhab/openhab-addons/pull/8802#discussion_r527177900", "createdAt": "2020-11-19T20:29:38Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/OH-INF/thing/thing-types.xml", "diffHunk": "@@ -164,4 +181,77 @@\n \t\t<state readOnly=\"true\"/>\n \t</channel-type>\n \n+\t<channel-type id=\"plannerNextStartTimestampType\">\n+\t\t<item-type>DateTime</item-type>\n+\t\t<label>The time for the next auto start</label>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c14957e725b14132e7f2a9289d8848454706d637"}, "originalPosition": 77}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzY5NzA3OTgzOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0wMlQyMToxOToyNFrOIuxi-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0wM1QwOTowMDo1MlrOIvE0mQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTkxNzE3OQ==", "bodyText": "The user can set an individual timezone in OH's settings. You can obtain it by injecting TimeZoneProvider.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    ZonedDateTime gmt = ZonedDateTime.ofInstant(Instant.ofEpochMilli(timestamp), ZoneOffset.UTC);\n          \n          \n            \n                    return ZonedDateTime.of(gmt.getYear(), gmt.getMonthValue(), gmt.getDayOfMonth(), gmt.getHour(), gmt.getMinute(),\n          \n          \n            \n                            gmt.getSecond(), gmt.getNano(), ZoneId.systemDefault());\n          \n          \n            \n                    LocalDateTime local = LocalDateTime.ofInstant(Instant.ofEpochMilli(timestamp), ZoneOffset.UTC);\n          \n          \n            \n                    return ZonedDateTime.of(local, timeZoneProvider.getTimeZone());", "url": "https://github.com/openhab/openhab-addons/pull/8802#discussion_r585917179", "createdAt": "2021-03-02T21:19:24Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -280,4 +337,19 @@ private void initializeProperties(Mower mower) {\n \n         updateProperties(properties);\n     }\n+\n+    /**\n+     * Converts timestamp returned by the Automower API into local time-zone.\n+     * Timestamp returned by the API doesn't have offset and it always in the current time zone - it can be treated as\n+     * UTC.\n+     * Method builds a ZonedDateTime with same hour value but in the current system timezone.\n+     * \n+     * @param timestamp - Automower API timestamp\n+     * @return ZonedDateTime in system timezone\n+     */\n+    private ZonedDateTime toZonedDateTime(long timestamp) {\n+        ZonedDateTime gmt = ZonedDateTime.ofInstant(Instant.ofEpochMilli(timestamp), ZoneOffset.UTC);\n+        return ZonedDateTime.of(gmt.getYear(), gmt.getMonthValue(), gmt.getDayOfMonth(), gmt.getHour(), gmt.getMinute(),\n+                gmt.getSecond(), gmt.getNano(), ZoneId.systemDefault());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b03627265628654315ffed21d9b3f26b2cbc62cf"}, "originalPosition": 181}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NjIzMjk4NQ==", "bodyText": "fixed", "url": "https://github.com/openhab/openhab-addons/pull/8802#discussion_r586232985", "createdAt": "2021-03-03T09:00:52Z", "author": {"login": "marcinczeczko"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -280,4 +337,19 @@ private void initializeProperties(Mower mower) {\n \n         updateProperties(properties);\n     }\n+\n+    /**\n+     * Converts timestamp returned by the Automower API into local time-zone.\n+     * Timestamp returned by the API doesn't have offset and it always in the current time zone - it can be treated as\n+     * UTC.\n+     * Method builds a ZonedDateTime with same hour value but in the current system timezone.\n+     * \n+     * @param timestamp - Automower API timestamp\n+     * @return ZonedDateTime in system timezone\n+     */\n+    private ZonedDateTime toZonedDateTime(long timestamp) {\n+        ZonedDateTime gmt = ZonedDateTime.ofInstant(Instant.ofEpochMilli(timestamp), ZoneOffset.UTC);\n+        return ZonedDateTime.of(gmt.getYear(), gmt.getMonthValue(), gmt.getDayOfMonth(), gmt.getHour(), gmt.getMinute(),\n+                gmt.getSecond(), gmt.getNano(), ZoneId.systemDefault());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTkxNzE3OQ=="}, "originalCommit": {"oid": "b03627265628654315ffed21d9b3f26b2cbc62cf"}, "originalPosition": 181}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzY5NzA4Mzg4OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/resources/OH-INF/thing/thing-types.xml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0wMlQyMToyMDoyMlrOIuxlaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0wM1QwOTowMTowNlrOIvE1KA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTkxNzgwMQ==", "bodyText": "Words in labels should be capitalized (except prepositions and so on). See https://www.openhab.org/docs/developer/bindings/thing-xml.html#formatting-labels-and-descriptions\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t<label>The override action</label>\n          \n          \n            \n            \t\t<label>Override Action</label>", "url": "https://github.com/openhab/openhab-addons/pull/8802#discussion_r585917801", "createdAt": "2021-03-02T21:20:22Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/OH-INF/thing/thing-types.xml", "diffHunk": "@@ -164,4 +179,64 @@\n \t\t<state readOnly=\"true\"/>\n \t</channel-type>\n \n+\t<channel-type id=\"plannerNextStartTimestampType\">\n+\t\t<item-type>DateTime</item-type>\n+\t\t<label>Next Auto Start</label>\n+\t\t<description>The channel providing the time for the next auto start. If the mower is charging then the value is the\n+\t\t\testimated time when it will be leaving the charging station. If the mower is about to start now, the value is NULL.</description>\n+\t\t<state readOnly=\"true\"/>\n+\t</channel-type>\n+\n+\t<channel-type id=\"plannerOverrideActionType\">\n+\t\t<item-type>String</item-type>\n+\t\t<label>The override action</label>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b03627265628654315ffed21d9b3f26b2cbc62cf"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NjIzMzEyOA==", "bodyText": "fixed labels", "url": "https://github.com/openhab/openhab-addons/pull/8802#discussion_r586233128", "createdAt": "2021-03-03T09:01:06Z", "author": {"login": "marcinczeczko"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/OH-INF/thing/thing-types.xml", "diffHunk": "@@ -164,4 +179,64 @@\n \t\t<state readOnly=\"true\"/>\n \t</channel-type>\n \n+\t<channel-type id=\"plannerNextStartTimestampType\">\n+\t\t<item-type>DateTime</item-type>\n+\t\t<label>Next Auto Start</label>\n+\t\t<description>The channel providing the time for the next auto start. If the mower is charging then the value is the\n+\t\t\testimated time when it will be leaving the charging station. If the mower is about to start now, the value is NULL.</description>\n+\t\t<state readOnly=\"true\"/>\n+\t</channel-type>\n+\n+\t<channel-type id=\"plannerOverrideActionType\">\n+\t\t<item-type>String</item-type>\n+\t\t<label>The override action</label>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTkxNzgwMQ=="}, "originalCommit": {"oid": "b03627265628654315ffed21d9b3f26b2cbc62cf"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzY5NzA4NTk2OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/resources/OH-INF/thing/thing-types.xml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0wMlQyMToyMDo1MFrOIuxmqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0wM1QwOTowMToxMlrOIvE1ag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTkxODEyMg==", "bodyText": "Labels are expected to be as short as possible. Guideline is 2-3 words with max 20-25 chars. See https://www.openhab.org/docs/developer/bindings/thing-xml.html#formatting-labels-and-descriptions", "url": "https://github.com/openhab/openhab-addons/pull/8802#discussion_r585918122", "createdAt": "2021-03-02T21:20:50Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/OH-INF/thing/thing-types.xml", "diffHunk": "@@ -164,4 +179,64 @@\n \t\t<state readOnly=\"true\"/>\n \t</channel-type>\n \n+\t<channel-type id=\"plannerNextStartTimestampType\">\n+\t\t<item-type>DateTime</item-type>\n+\t\t<label>Next Auto Start</label>\n+\t\t<description>The channel providing the time for the next auto start. If the mower is charging then the value is the\n+\t\t\testimated time when it will be leaving the charging station. If the mower is about to start now, the value is NULL.</description>\n+\t\t<state readOnly=\"true\"/>\n+\t</channel-type>\n+\n+\t<channel-type id=\"plannerOverrideActionType\">\n+\t\t<item-type>String</item-type>\n+\t\t<label>The override action</label>\n+\t\t<description>The channel providing an action that overrides current planner operation.</description>\n+\t\t<state readOnly=\"true\"/>\n+\t</channel-type>\n+\n+\t<channel-type id=\"calendarTasksType\">\n+\t\t<item-type>String</item-type>\n+\t\t<label>The information about the planner as JSON</label>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b03627265628654315ffed21d9b3f26b2cbc62cf"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NjIzMzE5NA==", "bodyText": "done", "url": "https://github.com/openhab/openhab-addons/pull/8802#discussion_r586233194", "createdAt": "2021-03-03T09:01:12Z", "author": {"login": "marcinczeczko"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/OH-INF/thing/thing-types.xml", "diffHunk": "@@ -164,4 +179,64 @@\n \t\t<state readOnly=\"true\"/>\n \t</channel-type>\n \n+\t<channel-type id=\"plannerNextStartTimestampType\">\n+\t\t<item-type>DateTime</item-type>\n+\t\t<label>Next Auto Start</label>\n+\t\t<description>The channel providing the time for the next auto start. If the mower is charging then the value is the\n+\t\t\testimated time when it will be leaving the charging station. If the mower is about to start now, the value is NULL.</description>\n+\t\t<state readOnly=\"true\"/>\n+\t</channel-type>\n+\n+\t<channel-type id=\"plannerOverrideActionType\">\n+\t\t<item-type>String</item-type>\n+\t\t<label>The override action</label>\n+\t\t<description>The channel providing an action that overrides current planner operation.</description>\n+\t\t<state readOnly=\"true\"/>\n+\t</channel-type>\n+\n+\t<channel-type id=\"calendarTasksType\">\n+\t\t<item-type>String</item-type>\n+\t\t<label>The information about the planner as JSON</label>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTkxODEyMg=="}, "originalCommit": {"oid": "b03627265628654315ffed21d9b3f26b2cbc62cf"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzgwODYyOTczOnYy", "diffSide": "LEFT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yN1QxNToxMToyNVrOI-zwLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0zMFQyMjoxNDo1NFrOJAdtcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjczMDU0Mw==", "bodyText": "Did you remove this by intention?", "url": "https://github.com/openhab/openhab-addons/pull/8802#discussion_r602730543", "createdAt": "2021-03-27T15:11:25Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -51,29 +53,39 @@\n import org.openhab.core.thing.binding.ThingHandlerService;\n import org.openhab.core.types.Command;\n import org.openhab.core.types.RefreshType;\n+import org.openhab.core.types.Type;\n+import org.openhab.core.types.UnDefType;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n+import com.google.gson.Gson;\n+\n /**\n  * The {@link AutomowerHandler} is responsible for handling commands, which are\n  * sent to one of the channels.\n  *\n  * @author Markus Pfleger - Initial contribution\n+ * @author Marcin Czeczko - Added support for planner & calendar data\n  */\n-@NonNullByDefault", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75303ff9bd8cbbbfcdf06c7bedbff9e61e6209a3"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNDQ2NjU0Ng==", "bodyText": "I think I did it intentionally that time due to the new class field mowerState but apparently I forgot to clean it up. Already fixed it.", "url": "https://github.com/openhab/openhab-addons/pull/8802#discussion_r604466546", "createdAt": "2021-03-30T22:14:54Z", "author": {"login": "marcinczeczko"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -51,29 +53,39 @@\n import org.openhab.core.thing.binding.ThingHandlerService;\n import org.openhab.core.types.Command;\n import org.openhab.core.types.RefreshType;\n+import org.openhab.core.types.Type;\n+import org.openhab.core.types.UnDefType;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n+import com.google.gson.Gson;\n+\n /**\n  * The {@link AutomowerHandler} is responsible for handling commands, which are\n  * sent to one of the channels.\n  *\n  * @author Markus Pfleger - Initial contribution\n+ * @author Marcin Czeczko - Added support for planner & calendar data\n  */\n-@NonNullByDefault", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjczMDU0Mw=="}, "originalCommit": {"oid": "75303ff9bd8cbbbfcdf06c7bedbff9e61e6209a3"}, "originalPosition": 52}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4104, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}