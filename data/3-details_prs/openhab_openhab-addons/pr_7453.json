{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3ODEzNDU3", "number": 7453, "title": "[VolvoOnCall] Correcting NPE on certain models", "bodyText": "Signed-off-by: clinique gael@lhopital.org", "createdAt": "2020-04-23T10:07:44Z", "url": "https://github.com/openhab/openhab-addons/pull/7453", "merged": true, "mergeCommit": {"oid": "0c04596d121d32e943993256834310e1ae67e8ce"}, "closed": true, "closedAt": "2020-05-12T23:29:06Z", "author": {"login": "clinique"}, "timelineItems": {"totalCount": 29, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABca0hxiAFqTQwMDEwMDA0Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgs3VHgFqTQxMDQ5MTQ0OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMTAwMDQ2", "url": "https://github.com/openhab/openhab-addons/pull/7453#pullrequestreview-400100046", "createdAt": "2020-04-24T16:33:32Z", "commit": {"oid": "961f81ed6251a85025cae1c73e1f0d053c4e27a3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxNjozMzozMlrOGLfz_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxNjo0MDoxNVrOGLgEpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDcwODczNA==", "bodyText": "This seems to be wrong. The annotation says \"I know for sure that whenever this field is accessed, it is non-null and that is assured by the framework\". If that would be true, you don't need an Optional later on.", "url": "https://github.com/openhab/openhab-addons/pull/7453#discussion_r414708734", "createdAt": "2020-04-24T16:33:32Z", "author": {"login": "J-N-K"}, "path": "bundles/org.openhab.binding.volvooncall/src/main/java/org/openhab/binding/volvooncall/internal/dto/Status.java", "diffHunk": "@@ -40,14 +40,33 @@\n     public @NonNullByDefault({}) OnOffType engineRunning;\n     public @NonNullByDefault({}) String brakeFluid;\n     public @NonNullByDefault({}) String washerFluidLevel;\n-    public @Nullable WindowsStatus windows;\n-    public @Nullable DoorsStatus doors;\n-    public @Nullable TyrePressure tyrePressure;\n-    public @Nullable HvBattery hvBattery;\n-    public @Nullable Heater heater;\n-\n+    private @NonNullByDefault({}) WindowsStatus windows;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "961f81ed6251a85025cae1c73e1f0d053c4e27a3"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDcwOTY2NA==", "bodyText": "This will not work but throw a NoSuchElementException. You need to check for presence and return null if it is not present. But I must admit, that I don't see the benefit of this refactoring, checking isPresent is not better than checking  != null.", "url": "https://github.com/openhab/openhab-addons/pull/7453#discussion_r414709664", "createdAt": "2020-04-24T16:35:00Z", "author": {"login": "J-N-K"}, "path": "bundles/org.openhab.binding.volvooncall/src/main/java/org/openhab/binding/volvooncall/internal/action/VolvoOnCallActions.java", "diffHunk": "@@ -44,20 +46,20 @@ public VolvoOnCallActions() {\n     @Override\n     public void setThingHandler(@Nullable ThingHandler handler) {\n         if (handler instanceof VehicleHandler) {\n-            this.handler = (VehicleHandler) handler;\n+            this.handler = Optional.of((VehicleHandler) handler);\n         }\n     }\n \n     @Override\n     public @Nullable ThingHandler getThingHandler() {\n-        return this.handler;\n+        return handler.get();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "961f81ed6251a85025cae1c73e1f0d053c4e27a3"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDcwOTgzMQ==", "bodyText": "see above", "url": "https://github.com/openhab/openhab-addons/pull/7453#discussion_r414709831", "createdAt": "2020-04-24T16:35:18Z", "author": {"login": "J-N-K"}, "path": "bundles/org.openhab.binding.volvooncall/src/main/java/org/openhab/binding/volvooncall/internal/dto/TripDetail.java", "diffHunk": "@@ -31,9 +32,9 @@\n  */\n @NonNullByDefault\n public class TripDetail {\n-    public @Nullable Integer fuelConsumption;\n-    public @Nullable Integer electricalConsumption;\n-    public @Nullable Integer electricalRegeneration;\n+    private @NonNullByDefault({}) Integer fuelConsumption;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "961f81ed6251a85025cae1c73e1f0d053c4e27a3"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDcxMDUyNA==", "bodyText": "We always use @Nullable for the jobs in all bindings. I think it would be better to stay with that.", "url": "https://github.com/openhab/openhab-addons/pull/7453#discussion_r414710524", "createdAt": "2020-04-24T16:36:15Z", "author": {"login": "J-N-K"}, "path": "bundles/org.openhab.binding.volvooncall/src/main/java/org/openhab/binding/volvooncall/internal/handler/VehicleHandler.java", "diffHunk": "@@ -143,9 +149,9 @@ public void initialize() {\n      * @param refresh : refresh frequency in minutes\n      */\n     private void startAutomaticRefresh(int refresh) {\n-        if (refreshJob == null || refreshJob.isCancelled()) {\n-            refreshJob = scheduler.scheduleWithFixedDelay(this::queryApiAndUpdateChannels, 10, refresh,\n-                    TimeUnit.MINUTES);\n+        if (!refreshJob.isPresent() || refreshJob.get().isCancelled()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "961f81ed6251a85025cae1c73e1f0d053c4e27a3"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDcxMjk5Nw==", "bodyText": "This will throw NoSuchElementException if the Optional is empty", "url": "https://github.com/openhab/openhab-addons/pull/7453#discussion_r414712997", "createdAt": "2020-04-24T16:40:15Z", "author": {"login": "J-N-K"}, "path": "bundles/org.openhab.binding.volvooncall/src/main/java/org/openhab/binding/volvooncall/internal/handler/VehicleHandler.java", "diffHunk": "@@ -159,15 +165,17 @@ private void queryApiAndUpdateChannels() {\n                 getThing().getChannels().stream().map(Channel::getUID)\n                         .filter(channelUID -> isLinked(channelUID) && !LAST_TRIP_GROUP.equals(channelUID.getGroupId()))\n                         .forEach(channelUID -> {\n-                            State state = getValue(channelUID.getIdWithoutGroup(), vehicleStatus, vehiclePosition);\n+                            State state = getValue(channelUID.getGroupId(), channelUID.getIdWithoutGroup(),\n+                                    vehicleStatus, vehiclePosition);\n \n                             updateState(channelUID, state);\n                         });\n                 updateTrips(bridgeHandler);\n             } catch (JsonSyntaxException | IOException e) {\n                 logger.warn(\"Exception occurred during execution: {}\", e.getMessage(), e);\n                 updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR, e.getMessage());\n-                refreshJob = null;\n+                refreshJob.get().cancel(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "961f81ed6251a85025cae1c73e1f0d053c4e27a3"}, "originalPosition": 63}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMzA1Njgy", "url": "https://github.com/openhab/openhab-addons/pull/7453#pullrequestreview-401305682", "createdAt": "2020-04-27T20:35:15Z", "commit": {"oid": "76234835bf4e6ec17696f73656f879df92d57e07"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QyMDozNToxNVrOGM2iDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QyMDozNToxNVrOGM2iDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjEyOTU1MQ==", "bodyText": "Wouldn't this work?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (fuelConsumption != null) {\n          \n          \n            \n                        return Optional.of(fuelConsumption);\n          \n          \n            \n                    }\n          \n          \n            \n                    return Optional.empty();\n          \n          \n            \n                    return Optional.ofNullable(fuelConsumption);\n          \n      \n    \n    \n  \n\nIf not, then this would work for sure, though I prefer the first option if it works.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (fuelConsumption != null) {\n          \n          \n            \n                        return Optional.of(fuelConsumption);\n          \n          \n            \n                    }\n          \n          \n            \n                    return Optional.empty();\n          \n          \n            \n                    Integer fuelConsumption = this.fuelConsumption\n          \n          \n            \n                    if (fuelConsumption != null) {\n          \n          \n            \n                        return Optional.of(fuelConsumption);\n          \n          \n            \n                    }\n          \n          \n            \n                    return Optional.empty();", "url": "https://github.com/openhab/openhab-addons/pull/7453#discussion_r416129551", "createdAt": "2020-04-27T20:35:15Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.volvooncall/src/main/java/org/openhab/binding/volvooncall/internal/dto/TripDetail.java", "diffHunk": "@@ -75,4 +75,25 @@ public long getDurationInMinutes() {\n         return Duration.between(startTime, endTime).toMinutes();\n     }\n \n+    public Optional<Integer> getFuelConsumption() {\n+        if (fuelConsumption != null) {\n+            return Optional.of(fuelConsumption);\n+        }\n+        return Optional.empty();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76234835bf4e6ec17696f73656f879df92d57e07"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e52049458e5d7269d8eb78a152f5b88e9796abe8", "author": {"user": {"login": "clinique", "name": "Ga\u00ebl L'hopital"}}, "url": "https://github.com/openhab/openhab-addons/commit/e52049458e5d7269d8eb78a152f5b88e9796abe8", "committedDate": "2020-04-28T11:40:24Z", "message": "Correcting NPE on certain models\n\nSigned-off-by: clinique <gael@lhopital.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef07de6b4a79249bee1a391e5f27bad0724b7733", "author": {"user": {"login": "clinique", "name": "Ga\u00ebl L'hopital"}}, "url": "https://github.com/openhab/openhab-addons/commit/ef07de6b4a79249bee1a391e5f27bad0724b7733", "committedDate": "2020-04-28T11:40:27Z", "message": "Correcting @Nullable problems\n\nSigned-off-by: clinique <gael@lhopital.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7cf8dfcab35ab3ead4dfd4451c156ca389e99168", "author": {"user": {"login": "clinique", "name": "Ga\u00ebl L'hopital"}}, "url": "https://github.com/openhab/openhab-addons/commit/7cf8dfcab35ab3ead4dfd4451c156ca389e99168", "committedDate": "2020-04-28T11:42:43Z", "message": "Code review corrections\n\nSigned-off-by: clinique <gael@lhopital.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "732f339c355c3b8bb574ded855d08643495163c3", "author": {"user": {"login": "clinique", "name": "Ga\u00ebl L'hopital"}}, "url": "https://github.com/openhab/openhab-addons/commit/732f339c355c3b8bb574ded855d08643495163c3", "committedDate": "2020-04-28T11:42:45Z", "message": "Code review corrections\n\nSigned-off-by: clinique <gael@lhopital.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1b94bf9eb0f82b7f925c0ef6e580b05d1f5284e", "author": {"user": {"login": "clinique", "name": "Ga\u00ebl L'hopital"}}, "url": "https://github.com/openhab/openhab-addons/commit/b1b94bf9eb0f82b7f925c0ef6e580b05d1f5284e", "committedDate": "2020-04-28T11:42:46Z", "message": "Added missing corrections\n\nSigned-off-by: clinique <gael@lhopital.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4446facbe630bc00f31d68bb231f9dd5f6701ff", "author": {"user": {"login": "clinique", "name": "Ga\u00ebl L'hopital"}}, "url": "https://github.com/openhab/openhab-addons/commit/a4446facbe630bc00f31d68bb231f9dd5f6701ff", "committedDate": "2020-04-28T11:42:48Z", "message": "Correcting nullable conflicts\n\nSigned-off-by: clinique <gael@lhopital.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fddf46f716830e89ef2f904f61ce76b866dccc8d", "author": {"user": {"login": "clinique", "name": "Ga\u00ebl L'hopital"}}, "url": "https://github.com/openhab/openhab-addons/commit/fddf46f716830e89ef2f904f61ce76b866dccc8d", "committedDate": "2020-04-28T11:42:50Z", "message": "Trying to solve nullable\n\nSigned-off-by: clinique <gael@lhopital.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77e1f855a726a4931217f0afe175949fdb704631", "author": {"user": {"login": "clinique", "name": "Ga\u00ebl L'hopital"}}, "url": "https://github.com/openhab/openhab-addons/commit/77e1f855a726a4931217f0afe175949fdb704631", "committedDate": "2020-04-28T11:51:32Z", "message": "Correcting weird conflict\n\nConflicts:\n\tbundles/org.openhab.binding.volvooncall/src/main/java/org/openhab/binding/volvooncall/internal/dto/TripDetail.java\n\nSigned-off-by: clinique <gael@lhopital.org>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4e9f4fc094f9d4f6c52304758919a84ad2f911c2", "author": {"user": {"login": "clinique", "name": "Ga\u00ebl L'hopital"}}, "url": "https://github.com/openhab/openhab-addons/commit/4e9f4fc094f9d4f6c52304758919a84ad2f911c2", "committedDate": "2020-04-28T11:01:22Z", "message": "Trying to solve nullable\n\nSigned-off-by: clinique <gael@lhopital.org>"}, "afterCommit": {"oid": "77e1f855a726a4931217f0afe175949fdb704631", "author": {"user": {"login": "clinique", "name": "Ga\u00ebl L'hopital"}}, "url": "https://github.com/openhab/openhab-addons/commit/77e1f855a726a4931217f0afe175949fdb704631", "committedDate": "2020-04-28T11:51:32Z", "message": "Correcting weird conflict\n\nConflicts:\n\tbundles/org.openhab.binding.volvooncall/src/main/java/org/openhab/binding/volvooncall/internal/dto/TripDetail.java\n\nSigned-off-by: clinique <gael@lhopital.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a94b22c3811dc72502a13155639b87565b9ecb6", "author": {"user": {"login": "clinique", "name": "Ga\u00ebl L'hopital"}}, "url": "https://github.com/openhab/openhab-addons/commit/5a94b22c3811dc72502a13155639b87565b9ecb6", "committedDate": "2020-04-28T12:00:12Z", "message": "Correcting warnings\n\nSigned-off-by: clinique <gael@lhopital.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5de0481a14ad48417c59bf7aefb2b2abb90c9398", "author": {"user": {"login": "clinique", "name": "Ga\u00ebl L'hopital"}}, "url": "https://github.com/openhab/openhab-addons/commit/5de0481a14ad48417c59bf7aefb2b2abb90c9398", "committedDate": "2020-04-28T12:14:49Z", "message": "Still some warnings\n\nSigned-off-by: clinique <gael@lhopital.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "821938fea14c5b463612dbcd57bc5dbe040e00d8", "author": {"user": {"login": "clinique", "name": "Ga\u00ebl L'hopital"}}, "url": "https://github.com/openhab/openhab-addons/commit/821938fea14c5b463612dbcd57bc5dbe040e00d8", "committedDate": "2020-04-28T12:35:37Z", "message": "Still some warnings\n\nSigned-off-by: clinique <gael@lhopital.org>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzOTU1OTgx", "url": "https://github.com/openhab/openhab-addons/pull/7453#pullrequestreview-403955981", "createdAt": "2020-05-01T00:04:02Z", "commit": {"oid": "821938fea14c5b463612dbcd57bc5dbe040e00d8"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwMDowNDowMlrOGO-YHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwMDowNDowMlrOGO-YHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM1NTIzMQ==", "bodyText": "You should take advantage of having optionals available:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            if (tripDetails.getFuelConsumption().isPresent()) {\n          \n          \n            \n                                return new QuantityType<>(tripDetails.getFuelConsumption().get().floatValue() / 100,\n          \n          \n            \n                                        SmartHomeUnits.LITRE);\n          \n          \n            \n                            } else {\n          \n          \n            \n                                return UnDefType.UNDEF;\n          \n          \n            \n                            }\n          \n          \n            \n                            return tripDetails.getFuelConsumption().map(value -> new QuantityType<>(value.floatValue() / 100,\n          \n          \n            \n                                        SmartHomeUnits.LITRE).orElse(UnDefType.UNDEF);", "url": "https://github.com/openhab/openhab-addons/pull/7453#discussion_r418355231", "createdAt": "2020-05-01T00:04:02Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.volvooncall/src/main/java/org/openhab/binding/volvooncall/internal/handler/VehicleHandler.java", "diffHunk": "@@ -230,8 +241,9 @@ public void handleCommand(ChannelUID channelUID, Command command) {\n     private State getTripValue(String channelId, TripDetail tripDetails) {\n         switch (channelId) {\n             case TRIP_CONSUMPTION:\n-                if (tripDetails.fuelConsumption != null) {\n-                    return new QuantityType<>(tripDetails.fuelConsumption.floatValue() / 100, SmartHomeUnits.LITRE);\n+                if (tripDetails.getFuelConsumption().isPresent()) {\n+                    return new QuantityType<>(tripDetails.getFuelConsumption().get().floatValue() / 100,\n+                            SmartHomeUnits.LITRE);\n                 } else {\n                     return UnDefType.UNDEF;\n                 }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "821938fea14c5b463612dbcd57bc5dbe040e00d8"}, "originalPosition": 60}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16a8ebaebd01fff60df89429cbf370e5ea26ea0e", "author": {"user": {"login": "clinique", "name": "Ga\u00ebl L'hopital"}}, "url": "https://github.com/openhab/openhab-addons/commit/16a8ebaebd01fff60df89429cbf370e5ea26ea0e", "committedDate": "2020-05-04T16:04:32Z", "message": "Code review and some enhancements\n\nSigned-off-by: clinique <gael@lhopital.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ace42c92ac9be426602135c8f8b68805841a0c8d", "author": {"user": {"login": "clinique", "name": "Ga\u00ebl L'hopital"}}, "url": "https://github.com/openhab/openhab-addons/commit/ace42c92ac9be426602135c8f8b68805841a0c8d", "committedDate": "2020-05-05T13:09:51Z", "message": "Enhanced usage of Optional, corrected header composition\n\nSigned-off-by: clinique <gael@lhopital.org>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1OTkyNjUz", "url": "https://github.com/openhab/openhab-addons/pull/7453#pullrequestreview-405992653", "createdAt": "2020-05-05T17:13:38Z", "commit": {"oid": "ace42c92ac9be426602135c8f8b68805841a0c8d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNzoxMzozOFrOGQzchw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNzo0NTo0MVrOGQ0qbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI3MzI4Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public Optional<ZonedDateTime> getTimestamp() {\n          \n          \n            \n                    ZonedDateTime timestamp = this.timestamp;\n          \n          \n            \n                    if (timestamp != null) {\n          \n          \n            \n                        return Optional.of(timestamp);\n          \n          \n            \n                    }\n          \n          \n            \n                    return Optional.empty();\n          \n          \n            \n                }\n          \n          \n            \n                public Optional<ZonedDateTime> getTimestamp() {\n          \n          \n            \n                    return Optional.ofNullable(timestamp);\n          \n          \n            \n                }", "url": "https://github.com/openhab/openhab-addons/pull/7453#discussion_r420273287", "createdAt": "2020-05-05T17:13:38Z", "author": {"login": "J-N-K"}, "path": "bundles/org.openhab.binding.volvooncall/src/main/java/org/openhab/binding/volvooncall/internal/dto/PositionData.java", "diffHunk": "@@ -28,14 +29,21 @@\n public class PositionData {\n     public @Nullable Double longitude;\n     public @Nullable Double latitude;\n-    public @Nullable ZonedDateTime timestamp;\n+    private @Nullable ZonedDateTime timestamp;\n     public @Nullable String speed;\n     private @Nullable String heading;\n \n     public Boolean isHeading() {\n         return \"true\".equalsIgnoreCase(heading);\n     }\n \n+    public Optional<ZonedDateTime> getTimestamp() {\n+        ZonedDateTime timestamp = this.timestamp;\n+        if (timestamp != null) {\n+            return Optional.of(timestamp);\n+        }\n+        return Optional.empty();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ace42c92ac9be426602135c8f8b68805841a0c8d"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI3MzgyOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public Optional<WindowsStatus> getWindows() {\n          \n          \n            \n                    WindowsStatus windows = this.windows;\n          \n          \n            \n                    if (windows != null) {\n          \n          \n            \n                        return Optional.of(windows);\n          \n          \n            \n                    }\n          \n          \n            \n                    return Optional.empty();\n          \n          \n            \n                }\n          \n          \n            \n                public Optional<WindowsStatus> getWindows() {\n          \n          \n            \n                    return Optional.ofNullable(windows);\n          \n          \n            \n                }\n          \n      \n    \n    \n  \n\nalso below", "url": "https://github.com/openhab/openhab-addons/pull/7453#discussion_r420273828", "createdAt": "2020-05-05T17:14:23Z", "author": {"login": "J-N-K"}, "path": "bundles/org.openhab.binding.volvooncall/src/main/java/org/openhab/binding/volvooncall/internal/dto/Status.java", "diffHunk": "@@ -36,17 +37,72 @@\n     public int tripMeter1 = UNDEFINED;\n     public int tripMeter2 = UNDEFINED;\n \n-    public @NonNullByDefault({}) OnOffType carLocked;\n-    public @NonNullByDefault({}) OnOffType engineRunning;\n-    public @NonNullByDefault({}) String brakeFluid;\n-    public @NonNullByDefault({}) String washerFluidLevel;\n-    public @Nullable WindowsStatus windows;\n-    public @Nullable DoorsStatus doors;\n-    public @Nullable TyrePressure tyrePressure;\n-    public @Nullable HvBattery hvBattery;\n-    public @Nullable Heater heater;\n+    private @Nullable OnOffType carLocked;\n+    private @Nullable OnOffType engineRunning;\n+    public String brakeFluid = \"\";\n+    public String washerFluidLevel = \"\";\n+    private @Nullable WindowsStatus windows;\n+    private @Nullable DoorsStatus doors;\n+    private @Nullable TyrePressure tyrePressure;\n+    private @Nullable HvBattery hvBattery;\n+    private @Nullable Heater heater;\n+    public String serviceWarningStatus = \"\";\n+\n+    public Optional<WindowsStatus> getWindows() {\n+        WindowsStatus windows = this.windows;\n+        if (windows != null) {\n+            return Optional.of(windows);\n+        }\n+        return Optional.empty();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ace42c92ac9be426602135c8f8b68805841a0c8d"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI5MzIyOA==", "bodyText": "This is really hard to read. Since we only have JDK8 available, maybe something like this\nZonedDateTime dt = vehicle.position.getTimestamp().orElse(vehicle.calculatedPosition.getTimestamp().orElse(null));\nreturn dt != null ? new DateTimeType(dt.withZoneSameInstant(ZoneId.systemDefault()) : UnDefType.NULL;", "url": "https://github.com/openhab/openhab-addons/pull/7453#discussion_r420293228", "createdAt": "2020-05-05T17:45:41Z", "author": {"login": "J-N-K"}, "path": "bundles/org.openhab.binding.volvooncall/src/main/java/org/openhab/binding/volvooncall/internal/wrapper/VehiclePositionWrapper.java", "diffHunk": "@@ -81,11 +77,11 @@ public State isHeading() {\n     }\n \n     public State getTimestamp() {\n-        return vehicle.position.timestamp != null\n-                ? new DateTimeType(vehicle.position.timestamp.withZoneSameInstant(ZoneId.systemDefault()))\n-                : vehicle.calculatedPosition.timestamp != null\n-                        ? new DateTimeType(\n-                                vehicle.calculatedPosition.timestamp.withZoneSameInstant(ZoneId.systemDefault()))\n+        return vehicle.position.getTimestamp().isPresent()\n+                ? new DateTimeType(vehicle.position.getTimestamp().get().withZoneSameInstant(ZoneId.systemDefault()))\n+                : vehicle.calculatedPosition.getTimestamp().isPresent()\n+                        ? new DateTimeType(vehicle.calculatedPosition.getTimestamp().get()\n+                                .withZoneSameInstant(ZoneId.systemDefault()))\n                         : UnDefType.NULL;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ace42c92ac9be426602135c8f8b68805841a0c8d"}, "originalPosition": 45}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c565500ea7ea3738a325b381c6866fe00625567", "author": {"user": {"login": "clinique", "name": "Ga\u00ebl L'hopital"}}, "url": "https://github.com/openhab/openhab-addons/commit/1c565500ea7ea3738a325b381c6866fe00625567", "committedDate": "2020-05-05T22:06:48Z", "message": "Enhancing Optional usage\n\nSigned-off-by: clinique <gael@lhopital.org>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MjYyODI4", "url": "https://github.com/openhab/openhab-addons/pull/7453#pullrequestreview-406262828", "createdAt": "2020-05-06T01:52:23Z", "commit": {"oid": "1c565500ea7ea3738a325b381c6866fe00625567"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwMTo1MjoyM1rOGRBmWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwMTo1NzozMVrOGRBrSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDUwNTE3OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return position.map(pos -> pos.getTimestamp()\n          \n          \n            \n                            .map(dt -> (State) new DateTimeType(dt.withZoneSameInstant(ZoneId.systemDefault())))\n          \n          \n            \n                            .orElse(UnDefType.NULL)).orElse(UnDefType.UNDEF);\n          \n          \n            \n                    return position.flatMap(pos -> pos.getTimestamp())\n          \n          \n            \n                            .map(dt -> (State) new DateTimeType(dt.withZoneSameInstant(ZoneId.systemDefault())))\n          \n          \n            \n                            .orElse(UnDefType.NULL);", "url": "https://github.com/openhab/openhab-addons/pull/7453#discussion_r420505178", "createdAt": "2020-05-06T01:52:23Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.volvooncall/src/main/java/org/openhab/binding/volvooncall/internal/wrapper/VehiclePositionWrapper.java", "diffHunk": "@@ -69,19 +73,16 @@ public State getPosition() {\n     }\n \n     public State isCalculated() {\n-        return vehicle.calculatedPosition.latitude != null ? OnOffType.ON : OnOffType.OFF;\n+        return position.map(pos -> isCalculated ? (State) OnOffType.ON : OnOffType.OFF).orElse(UnDefType.UNDEF);\n     }\n \n     public State isHeading() {\n-        return (vehicle.position.isHeading() || vehicle.calculatedPosition.isHeading()) ? OnOffType.ON : OnOffType.OFF;\n+        return position.map(pos -> pos.isHeading() ? (State) OnOffType.ON : OnOffType.OFF).orElse(UnDefType.UNDEF);\n     }\n \n     public State getTimestamp() {\n-        return vehicle.position.getTimestamp().isPresent()\n-                ? new DateTimeType(vehicle.position.getTimestamp().get().withZoneSameInstant(ZoneId.systemDefault()))\n-                : vehicle.calculatedPosition.getTimestamp().isPresent()\n-                        ? new DateTimeType(vehicle.calculatedPosition.getTimestamp().get()\n-                                .withZoneSameInstant(ZoneId.systemDefault()))\n-                        : UnDefType.NULL;\n+        return position.map(pos -> pos.getTimestamp()\n+                .map(dt -> (State) new DateTimeType(dt.withZoneSameInstant(ZoneId.systemDefault())))\n+                .orElse(UnDefType.NULL)).orElse(UnDefType.UNDEF);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c565500ea7ea3738a325b381c6866fe00625567"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDUwNjQ0MQ==", "bodyText": "Isn't this equivalent?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (getPosition() != UnDefType.UNDEF) {\n          \n          \n            \n                   if (position.isPresent()) {", "url": "https://github.com/openhab/openhab-addons/pull/7453#discussion_r420506441", "createdAt": "2020-05-06T01:57:31Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.volvooncall/src/main/java/org/openhab/binding/volvooncall/internal/wrapper/VehiclePositionWrapper.java", "diffHunk": "@@ -46,21 +56,15 @@ private State getPositionAsState(PositionData details) {\n     }\n \n     public State getPosition() {\n-        if (vehicle.position.latitude != null) {\n-            return getPositionAsState(vehicle.position);\n-        } else if (vehicle.calculatedPosition.latitude != null) {\n-            return getPositionAsState(vehicle.calculatedPosition);\n-        }\n-        return UnDefType.NULL;\n+        return position.map(pos -> getPositionAsState(pos)).orElse(UnDefType.UNDEF);\n     }\n \n     public @Nullable String getPositionAsJSon() {\n-        PositionData details = vehicle.position;\n-        if (details != null && details.latitude != null && details.longitude != null) {\n+        if (getPosition() != UnDefType.UNDEF) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c565500ea7ea3738a325b381c6866fe00625567"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "061e000ca209b736b49870f9a5d5a8402bc04c45", "author": {"user": {"login": "clinique", "name": "Ga\u00ebl L'hopital"}}, "url": "https://github.com/openhab/openhab-addons/commit/061e000ca209b736b49870f9a5d5a8402bc04c45", "committedDate": "2020-05-06T09:28:29Z", "message": "Review correction and some enhancements\n\nSigned-off-by: clinique <gael@lhopital.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9c137c1367c5aade9f20df548d5a22dc54567bf", "author": {"user": {"login": "clinique", "name": "Ga\u00ebl L'hopital"}}, "url": "https://github.com/openhab/openhab-addons/commit/f9c137c1367c5aade9f20df548d5a22dc54567bf", "committedDate": "2020-05-07T13:55:53Z", "message": "Correcting issue #7378\n\nSigned-off-by: clinique <gael@lhopital.org>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4MDI0MjQw", "url": "https://github.com/openhab/openhab-addons/pull/7453#pullrequestreview-408024240", "createdAt": "2020-05-08T06:26:31Z", "commit": {"oid": "f9c137c1367c5aade9f20df548d5a22dc54567bf"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwNjoyNjozMVrOGSaopg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwNjoyNjozMVrOGSaopg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk2Mzk0Mg==", "bodyText": "This should be put into its own method so it can be called during dispose as well.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            ScheduledFuture<?> refreshJob = this.refreshJob;\n          \n          \n            \n                            if (refreshJob != null) {\n          \n          \n            \n                                refreshJob.cancel(true);\n          \n          \n            \n                                refreshJob = null;\n          \n          \n            \n                            }\n          \n          \n            \n                            ScheduledFuture<?> refreshJob = this.refreshJob;\n          \n          \n            \n                            if (refreshJob != null) {\n          \n          \n            \n                                refreshJob.cancel(true);\n          \n          \n            \n                                this.refreshJob = null;\n          \n          \n            \n                            }", "url": "https://github.com/openhab/openhab-addons/pull/7453#discussion_r421963942", "createdAt": "2020-05-08T06:26:31Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.volvooncall/src/main/java/org/openhab/binding/volvooncall/internal/handler/VehicleHandler.java", "diffHunk": "@@ -153,21 +158,26 @@ private void queryApiAndUpdateChannels() {\n         VolvoOnCallBridgeHandler bridgeHandler = getBridgeHandler();\n         if (bridgeHandler != null) {\n             try {\n-                vehicleStatus = bridgeHandler.getURL(Status.class, configuration.vin);\n+                vehicleStatus = bridgeHandler.getURL(vehicle.statusURL, Status.class);\n                 vehiclePosition = new VehiclePositionWrapper(bridgeHandler.getURL(Position.class, configuration.vin));\n                 // Update all channels from the updated data\n                 getThing().getChannels().stream().map(Channel::getUID)\n                         .filter(channelUID -> isLinked(channelUID) && !LAST_TRIP_GROUP.equals(channelUID.getGroupId()))\n                         .forEach(channelUID -> {\n-                            State state = getValue(channelUID.getIdWithoutGroup(), vehicleStatus, vehiclePosition);\n+                            State state = getValue(channelUID.getGroupId(), channelUID.getIdWithoutGroup(),\n+                                    vehicleStatus, vehiclePosition);\n \n                             updateState(channelUID, state);\n                         });\n                 updateTrips(bridgeHandler);\n             } catch (JsonSyntaxException | IOException e) {\n                 logger.warn(\"Exception occurred during execution: {}\", e.getMessage(), e);\n                 updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR, e.getMessage());\n-                refreshJob = null;\n+                ScheduledFuture<?> refreshJob = this.refreshJob;\n+                if (refreshJob != null) {\n+                    refreshJob.cancel(true);\n+                    refreshJob = null;\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9c137c1367c5aade9f20df548d5a22dc54567bf"}, "originalPosition": 108}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99382a9d1d880bce9ae3abbb90f2ac1d37337540", "author": {"user": {"login": "clinique", "name": "Ga\u00ebl L'hopital"}}, "url": "https://github.com/openhab/openhab-addons/commit/99382a9d1d880bce9ae3abbb90f2ac1d37337540", "committedDate": "2020-05-08T07:23:06Z", "message": "Dispose refreshJob reviewed\n\nSigned-off-by: clinique <gael@lhopital.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a76dd1ddd59a60d0fbfb1749270d04eafcedc663", "author": {"user": {"login": "clinique", "name": "Ga\u00ebl L'hopital"}}, "url": "https://github.com/openhab/openhab-addons/commit/a76dd1ddd59a60d0fbfb1749270d04eafcedc663", "committedDate": "2020-05-08T08:21:43Z", "message": "Enhancing webservice error handling\n\nSigned-off-by: clinique <gael@lhopital.org>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4NTQxMTA4", "url": "https://github.com/openhab/openhab-addons/pull/7453#pullrequestreview-408541108", "createdAt": "2020-05-08T21:34:06Z", "commit": {"oid": "99382a9d1d880bce9ae3abbb90f2ac1d37337540"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQyMTozNDowNlrOGS0azA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQyMTozNDowNlrOGS0azA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjM4NjM4MA==", "bodyText": "As a general rule, super.dispose() should go last.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    super.dispose();\n          \n          \n            \n                    freeRefreshJob();\n          \n          \n            \n                    freeRefreshJob();\n          \n          \n            \n                    super.dispose();", "url": "https://github.com/openhab/openhab-addons/pull/7453#discussion_r422386380", "createdAt": "2020-05-08T21:34:06Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.volvooncall/src/main/java/org/openhab/binding/volvooncall/internal/handler/VehicleHandler.java", "diffHunk": "@@ -173,16 +173,26 @@ private void queryApiAndUpdateChannels() {\n             } catch (JsonSyntaxException | IOException e) {\n                 logger.warn(\"Exception occurred during execution: {}\", e.getMessage(), e);\n                 updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR, e.getMessage());\n-                ScheduledFuture<?> refreshJob = this.refreshJob;\n-                if (refreshJob != null) {\n-                    refreshJob.cancel(true);\n-                    refreshJob = null;\n-                }\n+                freeRefreshJob();\n                 startAutomaticRefresh(configuration.refresh);\n             }\n         }\n     }\n \n+    private void freeRefreshJob() {\n+        ScheduledFuture<?> refreshJob = this.refreshJob;\n+        if (refreshJob != null) {\n+            refreshJob.cancel(true);\n+            this.refreshJob = null;\n+        }\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        super.dispose();\n+        freeRefreshJob();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99382a9d1d880bce9ae3abbb90f2ac1d37337540"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e93764990218010be63ce747d8cf46856b2966e9", "author": {"user": {"login": "clinique", "name": "Ga\u00ebl L'hopital"}}, "url": "https://github.com/openhab/openhab-addons/commit/e93764990218010be63ce747d8cf46856b2966e9", "committedDate": "2020-05-09T07:12:08Z", "message": "Enhancing error handling\n\nSigned-off-by: clinique <gael@lhopital.org>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4NjcwNzU4", "url": "https://github.com/openhab/openhab-addons/pull/7453#pullrequestreview-408670758", "createdAt": "2020-05-09T17:49:03Z", "commit": {"oid": "99382a9d1d880bce9ae3abbb90f2ac1d37337540"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNDkxNDQ5", "url": "https://github.com/openhab/openhab-addons/pull/7453#pullrequestreview-410491449", "createdAt": "2020-05-12T23:27:55Z", "commit": {"oid": "e93764990218010be63ce747d8cf46856b2966e9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 888, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}