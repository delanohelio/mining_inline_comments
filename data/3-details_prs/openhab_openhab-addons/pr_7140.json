{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1OTMxNDk2", "number": 7140, "title": "[itests mqtt.homeassistant] Fixed itests for mqtt.homeassistant", "bodyText": "While I have been making a few small bugfixes to binding.mqtt.homeassistant, it is unsatisfying not to see the green checkmark on the Travis integration tests :).  I have made the following updates to allow the integration tests to run.\nFixed the script buildci.sh.  The sed pattern for CHANGED_ITEST_DIR was not quite correct, if two directories were changed in the same test, then a build of all was forced.  With my change, with this current pull request everything will be built for the CI tests, but if someone approves this pull request, in future pull requests just for the tests, only the modified test will build and be tested.\nBigger overall change, changed the settings for bnd-testing-maven-plugin in itests/pom.xml to do OSGi resolution on the Travis machine before running the tests.  With this change, the -runbundles section in the itest.bndrun files are effectively ignored, and automatically regenerated before the test runs.  This change appears to take care of errors due to different environments between dev systems and the CI system.  Along with this change, the settings for bnd-export-maven-plugin in openhab-addons/pom.xml were changed as not to fail if the OSGi resolution on the CI machine computes different dependencies than are listed in the itest.bndrun files.\nTo make sure that all of the dependencies are available for the OSGi resolution, the buildci.sh script now also builds the  bom/*-index projects before building the tests.\nAdded missing dependencies for com.google.dagger to the three mqtt related itests.\nAdded biz.aQute.tester to itests.bndrun for mqtt.homeassistant.tests.  With this change, the integration tests can easily be run and debugged in Eclipse.\nChanged the version of bndtools in openhab-addons/pom.xml to grab the latest 5.0.0 version.  This showed fewer errors in my testing.\nWith the changes in this pull request.  org.openhab.binding.mqtt.homeassistant.tests successfully builds and runs.  The other MQTT related tests successfully launch now, but the tests fail in execution, I did not debug those so I left them commented out in the openhab-addons/itests/pom.xml file.", "createdAt": "2020-03-10T04:30:36Z", "url": "https://github.com/openhab/openhab-addons/pull/7140", "merged": true, "mergeCommit": {"oid": "15555c039bc1aabeeeb9b9fc1d6d2a5e4258dc13"}, "closed": true, "closedAt": "2020-03-11T16:43:05Z", "author": {"login": "mehoekstra"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcK5rOyAH2gAyMzg1OTMxNDk2OjliZmIyOGJmNTcyMTVmZWFiMmVjM2RlNTk2MGU5ODFiNmMxZjM5NmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMp5GbgFqTM3MjkzNTg4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9bfb28bf57215feab2ec3de5960e981b6c1f396d", "author": {"user": {"login": "mehoekstra", "name": "Matt Hoekstra"}}, "url": "https://github.com/openhab/openhab-addons/commit/9bfb28bf57215feab2ec3de5960e981b6c1f396d", "committedDate": "2020-03-06T05:57:08Z", "message": "mqtt.homeassistant integration test now runs, and can be debugged in eclipse\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ce3256b0047efb5084b12194f0c3ece305ae829", "author": {"user": {"login": "mehoekstra", "name": "Matt Hoekstra"}}, "url": "https://github.com/openhab/openhab-addons/commit/9ce3256b0047efb5084b12194f0c3ece305ae829", "committedDate": "2020-03-08T05:07:19Z", "message": "Fixed detection of changes to itests\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04482e6240eec368024e58b207cc777f5fac3dd2", "author": {"user": {"login": "mehoekstra", "name": "Matt Hoekstra"}}, "url": "https://github.com/openhab/openhab-addons/commit/04482e6240eec368024e58b207cc777f5fac3dd2", "committedDate": "2020-03-08T19:24:52Z", "message": "updated bndrun with latest bundles\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f3a1179d5bd641641ae4460d94fdcbc8c5ed597", "author": {"user": {"login": "mehoekstra", "name": "Matt Hoekstra"}}, "url": "https://github.com/openhab/openhab-addons/commit/7f3a1179d5bd641641ae4460d94fdcbc8c5ed597", "committedDate": "2020-03-10T01:35:40Z", "message": "adding latest pom changes, may back out\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38fbae599813d97a586ae4f041757362523fcd4e", "author": {"user": {"login": "mehoekstra", "name": "Matt Hoekstra"}}, "url": "https://github.com/openhab/openhab-addons/commit/38fbae599813d97a586ae4f041757362523fcd4e", "committedDate": "2020-03-10T02:12:11Z", "message": "minimized pom changes\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc365d814badd1321e1d635d472c4a1b4189de6a", "author": {"user": {"login": "mehoekstra", "name": "Matt Hoekstra"}}, "url": "https://github.com/openhab/openhab-addons/commit/dc365d814badd1321e1d635d472c4a1b4189de6a", "committedDate": "2020-03-10T03:24:47Z", "message": "now runs homeassistant itests, and allows debugging in eclipse\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d5ba6cc0a6b6e06ee29e2702923e23d2f4c0ce9", "author": {"user": {"login": "mehoekstra", "name": "Matt Hoekstra"}}, "url": "https://github.com/openhab/openhab-addons/commit/9d5ba6cc0a6b6e06ee29e2702923e23d2f4c0ce9", "committedDate": "2020-03-10T04:05:29Z", "message": "mqtt.homie and mqttembeddedbroker tests now execute, still fail though\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ee194deee3b77c2719cd85b4ef2fdb9c8176145", "author": {"user": {"login": "mehoekstra", "name": "Matt Hoekstra"}}, "url": "https://github.com/openhab/openhab-addons/commit/2ee194deee3b77c2719cd85b4ef2fdb9c8176145", "committedDate": "2020-03-10T05:16:39Z", "message": "commenting out Hue emulation test since failing in JDK11\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf3967a693e83e10d345e98ad07073edc9d834e6", "author": {"user": {"login": "mehoekstra", "name": "Matt Hoekstra"}}, "url": "https://github.com/openhab/openhab-addons/commit/bf3967a693e83e10d345e98ad07073edc9d834e6", "committedDate": "2020-03-10T05:46:04Z", "message": "increased timeout waiting for discovery\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxOTI5Mzgy", "url": "https://github.com/openhab/openhab-addons/pull/7140#pullrequestreview-371929382", "createdAt": "2020-03-10T13:03:35Z", "commit": {"oid": "bf3967a693e83e10d345e98ad07073edc9d834e6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxMzowMzozNlrOF0Ny2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxMzowMzozNlrOF0Ny2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI5NjI4MQ==", "bodyText": "Can you extracting the build commands to a function instead of duplicating them 4x?", "url": "https://github.com/openhab/openhab-addons/pull/7140#discussion_r390296281", "createdAt": "2020-03-10T13:03:36Z", "author": {"login": "wborn"}, "path": "buildci.sh", "diffHunk": "@@ -62,11 +62,45 @@ if [[ ! -z \"$CHANGED_DIR\" ]] && [[ -e \"bundles/$CHANGED_DIR\" ]]; then\n     # add the postfix to make sure we actually find the correct itest\n     if [[ -e \"itests/$CHANGED_DIR.tests\" ]]; then\n         echo \"Single addon pull request: Building itest $CHANGED_DIR\"\n-        cd \"itests/$CHANGED_DIR.tests\"\n+        # build the core index project so the OSGI index.xml file is generated in the target directory\n+        # needed for resolving the OSGI bundle wiring later\n+        cd \"bom/openhab-core-index\"\n         mvn clean install -B 2>&1 |\n-\t      stdbuf -o0 grep -vE \"Download(ed|ing) from [a-z.]+: https:\" | # Filter out Download(s)\n-\t      stdbuf -o0 grep -v \"target/code-analysis\" | # filter out some debug code from reporting utility\n-\t      tee -a ${CDIR}/.build.log\n+          stdbuf -o0 grep -vE \"Download(ed|ing) from [a-z.]+: https:\" | # Filter out Download(s)\n+          stdbuf -o0 grep -v \"target/code-analysis\" | # filter out some debug code from reporting utility\n+          tee -a ${CDIR}/.build.log\n+        if [[ $? -ne 0 ]]; then\n+            exit 1\n+        fi\n+         \n+        # build the runtime index project so the OSGI index.xml file is generated in the target directory\n+        # needed for resolving the OSGI bundle wiring later\n+        cd \"../runtime-index\"\n+        mvn clean install -B 2>&1 |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf3967a693e83e10d345e98ad07073edc9d834e6"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34f7d79dbbcf12f076455ece0e2a17b34dbba99a", "author": {"user": null}, "url": "https://github.com/openhab/openhab-addons/commit/34f7d79dbbcf12f076455ece0e2a17b34dbba99a", "committedDate": "2020-03-10T17:10:06Z", "message": "simplified building of *-index projects\n\nSigned-off-by: Ubuntu <ubuntu@ip-172-26-13-6.us-west-2.compute.internal>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d4193d3c6d8fb4fe6637cf64dedeb2406601cf7", "author": {"user": null}, "url": "https://github.com/openhab/openhab-addons/commit/7d4193d3c6d8fb4fe6637cf64dedeb2406601cf7", "committedDate": "2020-03-10T17:24:50Z", "message": "forgot to include clean step in last update to buildci.sh\n\nSigned-off-by: Ubuntu <ubuntu@ip-172-26-13-6.us-west-2.compute.internal>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11f6e70258d90a75b4644386966c4679dc69260e", "author": {"user": {"login": "mehoekstra", "name": "Matt Hoekstra"}}, "url": "https://github.com/openhab/openhab-addons/commit/11f6e70258d90a75b4644386966c4679dc69260e", "committedDate": "2020-03-10T17:40:11Z", "message": "Increasing another timeout a bit more\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "43c992f5888f2405a2d2c813ef3c79b3be2d57ca", "author": {"user": {"login": "mehoekstra", "name": "Matt Hoekstra"}}, "url": "https://github.com/openhab/openhab-addons/commit/43c992f5888f2405a2d2c813ef3c79b3be2d57ca", "committedDate": "2020-03-10T17:34:19Z", "message": "Increasing another timeout a bit more\n\nSigned-off-by: Matthew Hoekstra <matthew.e.hoekstra@gmail.com>"}, "afterCommit": {"oid": "11f6e70258d90a75b4644386966c4679dc69260e", "author": {"user": {"login": "mehoekstra", "name": "Matt Hoekstra"}}, "url": "https://github.com/openhab/openhab-addons/commit/11f6e70258d90a75b4644386966c4679dc69260e", "committedDate": "2020-03-10T17:40:11Z", "message": "Increasing another timeout a bit more\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e9c8fd51166e723097b4405ecb97514e0fa65b1", "author": {"user": {"login": "mehoekstra", "name": "Matt Hoekstra"}}, "url": "https://github.com/openhab/openhab-addons/commit/5e9c8fd51166e723097b4405ecb97514e0fa65b1", "committedDate": "2020-03-10T20:31:11Z", "message": "Integration tests should pass before they are included as modules\nin the itests/pom.xml file.  This change allows integration tests to\nbe run before they are added to itests/pom.xml, or after they have\nbeen commented out from itests/pom.xml\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyOTM1ODgz", "url": "https://github.com/openhab/openhab-addons/pull/7140#pullrequestreview-372935883", "createdAt": "2020-03-11T16:41:39Z", "commit": {"oid": "5e9c8fd51166e723097b4405ecb97514e0fa65b1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1142, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}