{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyMzA5NzYy", "number": 8050, "reviewThreads": {"totalCount": 84, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMDozNDowMlrOENC-OQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwNzozNzoyOVrOEexiVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTE1NjQxOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/README.md", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMDozNDowMlrOGvg0UA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxODoyMjowNFrOGw0Y5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ3MzkzNg==", "bodyText": "Above you mention \"single\" robot. Are there one or several robots per bridge?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452473936", "createdAt": "2020-07-09T20:34:02Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/README.md", "diffHunk": "@@ -0,0 +1,80 @@\n+# Automower Binding\n+\n+This binding communicates to the Husqvarna Automower Connect API in order to send commands and query the state of Husqvarna Automower robots.\n+\n+## Supported Things\n+\n+bridge: The bridge needs to be configured with credentials and an application key that allows communicating with the Automower Connect Api\n+automower: A single Husqvarna Automower robot\n+\n+Basically all Husqvarna Automower models with \"Automower Connect\" support should be supported. It was tested only with a Husqvarna Automower 450X\n+\n+\n+## Discovery\n+\n+Once the bridge is created and configured, registered automowers will be discovered automatically", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2Mzc0NQ==", "bodyText": "Exactly, the \"automower\" represents a single automower robot. The bridge supports communicating to multiple such automower robots. This should be in line with the rest apis / the husqvarna app where one registered user can have multiple robots.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453163745", "createdAt": "2020-07-11T06:39:49Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/README.md", "diffHunk": "@@ -0,0 +1,80 @@\n+# Automower Binding\n+\n+This binding communicates to the Husqvarna Automower Connect API in order to send commands and query the state of Husqvarna Automower robots.\n+\n+## Supported Things\n+\n+bridge: The bridge needs to be configured with credentials and an application key that allows communicating with the Automower Connect Api\n+automower: A single Husqvarna Automower robot\n+\n+Basically all Husqvarna Automower models with \"Automower Connect\" support should be supported. It was tested only with a Husqvarna Automower 450X\n+\n+\n+## Discovery\n+\n+Once the bridge is created and configured, registered automowers will be discovered automatically", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ3MzkzNg=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE3Nzc3Nw==", "bodyText": "Ok, can you add a linebreak, since this formatting is a bit misleading:", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453177777", "createdAt": "2020-07-11T09:43:22Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/README.md", "diffHunk": "@@ -0,0 +1,80 @@\n+# Automower Binding\n+\n+This binding communicates to the Husqvarna Automower Connect API in order to send commands and query the state of Husqvarna Automower robots.\n+\n+## Supported Things\n+\n+bridge: The bridge needs to be configured with credentials and an application key that allows communicating with the Automower Connect Api\n+automower: A single Husqvarna Automower robot\n+\n+Basically all Husqvarna Automower models with \"Automower Connect\" support should be supported. It was tested only with a Husqvarna Automower 450X\n+\n+\n+## Discovery\n+\n+Once the bridge is created and configured, registered automowers will be discovered automatically", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ3MzkzNg=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg0MzE3NA==", "bodyText": "sure, there should be a line break. I will change the formulation a bit.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453843174", "createdAt": "2020-07-13T18:22:04Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/README.md", "diffHunk": "@@ -0,0 +1,80 @@\n+# Automower Binding\n+\n+This binding communicates to the Husqvarna Automower Connect API in order to send commands and query the state of Husqvarna Automower robots.\n+\n+## Supported Things\n+\n+bridge: The bridge needs to be configured with credentials and an application key that allows communicating with the Automower Connect Api\n+automower: A single Husqvarna Automower robot\n+\n+Basically all Husqvarna Automower models with \"Automower Connect\" support should be supported. It was tested only with a Husqvarna Automower 450X\n+\n+\n+## Discovery\n+\n+Once the bridge is created and configured, registered automowers will be discovered automatically", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ3MzkzNg=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTE2MDY4OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/README.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMDozNToxOVrOGvg29w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNjo0MTowNVrOGwK7aA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ3NDYxNQ==", "bodyText": "You could use backticks to highlight this as the Thing Type ID.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            bridge:\n          \n          \n            \n            `bridge`:", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452474615", "createdAt": "2020-07-09T20:35:19Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/README.md", "diffHunk": "@@ -0,0 +1,80 @@\n+# Automower Binding\n+\n+This binding communicates to the Husqvarna Automower Connect API in order to send commands and query the state of Husqvarna Automower robots.\n+\n+## Supported Things\n+\n+bridge: The bridge needs to be configured with credentials and an application key that allows communicating with the Automower Connect Api\n+automower: A single Husqvarna Automower robot\n+\n+Basically all Husqvarna Automower models with \"Automower Connect\" support should be supported. It was tested only with a Husqvarna Automower 450X\n+\n+\n+## Discovery\n+\n+Once the bridge is created and configured, registered automowers will be discovered automatically\n+\n+\n+## Thing Configuration\n+\n+bridge:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2Mzg4MA==", "bodyText": "will do", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453163880", "createdAt": "2020-07-11T06:41:05Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/README.md", "diffHunk": "@@ -0,0 +1,80 @@\n+# Automower Binding\n+\n+This binding communicates to the Husqvarna Automower Connect API in order to send commands and query the state of Husqvarna Automower robots.\n+\n+## Supported Things\n+\n+bridge: The bridge needs to be configured with credentials and an application key that allows communicating with the Automower Connect Api\n+automower: A single Husqvarna Automower robot\n+\n+Basically all Husqvarna Automower models with \"Automower Connect\" support should be supported. It was tested only with a Husqvarna Automower 450X\n+\n+\n+## Discovery\n+\n+Once the bridge is created and configured, registered automowers will be discovered automatically\n+\n+\n+## Thing Configuration\n+\n+bridge:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ3NDYxNQ=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTE2NDg5OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/README.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMDozNjozNVrOGvg5nQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNjo0MjowOFrOGwK7zA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ3NTI5Mw==", "bodyText": "Can you fix this?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452475293", "createdAt": "2020-07-09T20:36:35Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/README.md", "diffHunk": "@@ -0,0 +1,80 @@\n+# Automower Binding\n+\n+This binding communicates to the Husqvarna Automower Connect API in order to send commands and query the state of Husqvarna Automower robots.\n+\n+## Supported Things\n+\n+bridge: The bridge needs to be configured with credentials and an application key that allows communicating with the Automower Connect Api\n+automower: A single Husqvarna Automower robot\n+\n+Basically all Husqvarna Automower models with \"Automower Connect\" support should be supported. It was tested only with a Husqvarna Automower 450X\n+\n+\n+## Discovery\n+\n+Once the bridge is created and configured, registered automowers will be discovered automatically\n+\n+\n+## Thing Configuration\n+\n+bridge:\n+- appKey (mandatory): The Application Key is required to communication with the Automower Connect Api. It can be obtained by registering an Application on the Husqvarna Website. This application also needs to be connected to the \"Authentication API\" and the \"Automower Connect API\"\n+- userName (mandatory): The user name for which the application key has been issued\n+- password (mandatory): The password for the given user\n+- pollingInterval (optional): How often the available automowers should be queried in seconds. Default is 1h (3600s)\n+\n+automower:\n+- mowerId (mandatory): The Id of an automower as used by the Automower Connect Api to identify a mower. This is automatically filled when the thing is discovered\n+- pollingInterval (optional): How often the current automower state should be polled in seconds. Default is 5min (300s)\n+\n+Keep in mind that the status of the automowers should not be queried too often. According to the Husqvarna documentation not more than 10000 requests per month and application key are allowed\n+\n+## Channels\n+\n+_Here you should provide information about available channel types, what their meaning is and how they can be used._\n+\n+_Note that it is planned to generate some part of this based on the XML files within ```src/main/resources/ESH-INF/thing``` of your binding._", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2Mzk4MA==", "bodyText": "sure", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453163980", "createdAt": "2020-07-11T06:42:08Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/README.md", "diffHunk": "@@ -0,0 +1,80 @@\n+# Automower Binding\n+\n+This binding communicates to the Husqvarna Automower Connect API in order to send commands and query the state of Husqvarna Automower robots.\n+\n+## Supported Things\n+\n+bridge: The bridge needs to be configured with credentials and an application key that allows communicating with the Automower Connect Api\n+automower: A single Husqvarna Automower robot\n+\n+Basically all Husqvarna Automower models with \"Automower Connect\" support should be supported. It was tested only with a Husqvarna Automower 450X\n+\n+\n+## Discovery\n+\n+Once the bridge is created and configured, registered automowers will be discovered automatically\n+\n+\n+## Thing Configuration\n+\n+bridge:\n+- appKey (mandatory): The Application Key is required to communication with the Automower Connect Api. It can be obtained by registering an Application on the Husqvarna Website. This application also needs to be connected to the \"Authentication API\" and the \"Automower Connect API\"\n+- userName (mandatory): The user name for which the application key has been issued\n+- password (mandatory): The password for the given user\n+- pollingInterval (optional): How often the available automowers should be queried in seconds. Default is 1h (3600s)\n+\n+automower:\n+- mowerId (mandatory): The Id of an automower as used by the Automower Connect Api to identify a mower. This is automatically filled when the thing is discovered\n+- pollingInterval (optional): How often the current automower state should be polled in seconds. Default is 5min (300s)\n+\n+Keep in mind that the status of the automowers should not be queried too often. According to the Husqvarna documentation not more than 10000 requests per month and application key are allowed\n+\n+## Channels\n+\n+_Here you should provide information about available channel types, what their meaning is and how they can be used._\n+\n+_Note that it is planned to generate some part of this based on the XML files within ```src/main/resources/ESH-INF/thing``` of your binding._", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ3NTI5Mw=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTE2OTA2OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/README.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMDozODowOFrOGvg8QQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwODowODoyMVrOGwLU5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ3NTk2OQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            | battery  | Number | (readonly) A value between 0 and 100  |\n          \n          \n            \n            | battery  | Number | (readonly) The battery state of charge in percent  |", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452475969", "createdAt": "2020-07-09T20:38:08Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/README.md", "diffHunk": "@@ -0,0 +1,80 @@\n+# Automower Binding\n+\n+This binding communicates to the Husqvarna Automower Connect API in order to send commands and query the state of Husqvarna Automower robots.\n+\n+## Supported Things\n+\n+bridge: The bridge needs to be configured with credentials and an application key that allows communicating with the Automower Connect Api\n+automower: A single Husqvarna Automower robot\n+\n+Basically all Husqvarna Automower models with \"Automower Connect\" support should be supported. It was tested only with a Husqvarna Automower 450X\n+\n+\n+## Discovery\n+\n+Once the bridge is created and configured, registered automowers will be discovered automatically\n+\n+\n+## Thing Configuration\n+\n+bridge:\n+- appKey (mandatory): The Application Key is required to communication with the Automower Connect Api. It can be obtained by registering an Application on the Husqvarna Website. This application also needs to be connected to the \"Authentication API\" and the \"Automower Connect API\"\n+- userName (mandatory): The user name for which the application key has been issued\n+- password (mandatory): The password for the given user\n+- pollingInterval (optional): How often the available automowers should be queried in seconds. Default is 1h (3600s)\n+\n+automower:\n+- mowerId (mandatory): The Id of an automower as used by the Automower Connect Api to identify a mower. This is automatically filled when the thing is discovered\n+- pollingInterval (optional): How often the current automower state should be polled in seconds. Default is 5min (300s)\n+\n+Keep in mind that the status of the automowers should not be queried too often. According to the Husqvarna documentation not more than 10000 requests per month and application key are allowed\n+\n+## Channels\n+\n+_Here you should provide information about available channel types, what their meaning is and how they can be used._\n+\n+_Note that it is planned to generate some part of this based on the XML files within ```src/main/resources/ESH-INF/thing``` of your binding._\n+\n+| channel  | type   | description                  |\n+|----------|--------|------------------------------|\n+| name  | String | (readonly) The name of the Automower  |\n+| mode  | String | (readonly) The current mode (MAIN_AREA, SECONDARY_AREA, HOME, DEMO, UNKNOWN)  |\n+| activity  | String | (readonly) The current activity (UNKNOWN, NOT_APPLICABLE, MOWING, GOING_HOME, CHARGING, LEAVING, PARKED_IN_CS, STOPPED_IN_GARDEN)  |\n+| state  | String | (readonly) The current state (UNKNOWN, NOT_APPLICABLE, PAUSED, IN_OPERATION, WAIT_UPDATING, WAIT_POWER_UP, RESTRICTED, OFF, STOPPED, ERROR, FATAL_ERROR, ERROR_AT_POWER_UP)  |\n+| last-update  | DateTime | (readonly) The time when the automower updated its states  |\n+| battery  | Number | (readonly) A value between 0 and 100  |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE3MDQwNw==", "bodyText": "ok", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453170407", "createdAt": "2020-07-11T08:08:21Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/README.md", "diffHunk": "@@ -0,0 +1,80 @@\n+# Automower Binding\n+\n+This binding communicates to the Husqvarna Automower Connect API in order to send commands and query the state of Husqvarna Automower robots.\n+\n+## Supported Things\n+\n+bridge: The bridge needs to be configured with credentials and an application key that allows communicating with the Automower Connect Api\n+automower: A single Husqvarna Automower robot\n+\n+Basically all Husqvarna Automower models with \"Automower Connect\" support should be supported. It was tested only with a Husqvarna Automower 450X\n+\n+\n+## Discovery\n+\n+Once the bridge is created and configured, registered automowers will be discovered automatically\n+\n+\n+## Thing Configuration\n+\n+bridge:\n+- appKey (mandatory): The Application Key is required to communication with the Automower Connect Api. It can be obtained by registering an Application on the Husqvarna Website. This application also needs to be connected to the \"Authentication API\" and the \"Automower Connect API\"\n+- userName (mandatory): The user name for which the application key has been issued\n+- password (mandatory): The password for the given user\n+- pollingInterval (optional): How often the available automowers should be queried in seconds. Default is 1h (3600s)\n+\n+automower:\n+- mowerId (mandatory): The Id of an automower as used by the Automower Connect Api to identify a mower. This is automatically filled when the thing is discovered\n+- pollingInterval (optional): How often the current automower state should be polled in seconds. Default is 5min (300s)\n+\n+Keep in mind that the status of the automowers should not be queried too often. According to the Husqvarna documentation not more than 10000 requests per month and application key are allowed\n+\n+## Channels\n+\n+_Here you should provide information about available channel types, what their meaning is and how they can be used._\n+\n+_Note that it is planned to generate some part of this based on the XML files within ```src/main/resources/ESH-INF/thing``` of your binding._\n+\n+| channel  | type   | description                  |\n+|----------|--------|------------------------------|\n+| name  | String | (readonly) The name of the Automower  |\n+| mode  | String | (readonly) The current mode (MAIN_AREA, SECONDARY_AREA, HOME, DEMO, UNKNOWN)  |\n+| activity  | String | (readonly) The current activity (UNKNOWN, NOT_APPLICABLE, MOWING, GOING_HOME, CHARGING, LEAVING, PARKED_IN_CS, STOPPED_IN_GARDEN)  |\n+| state  | String | (readonly) The current state (UNKNOWN, NOT_APPLICABLE, PAUSED, IN_OPERATION, WAIT_UPDATING, WAIT_POWER_UP, RESTRICTED, OFF, STOPPED, ERROR, FATAL_ERROR, ERROR_AT_POWER_UP)  |\n+| last-update  | DateTime | (readonly) The time when the automower updated its states  |\n+| battery  | Number | (readonly) A value between 0 and 100  |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ3NTk2OQ=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTE3OTA5OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/README.md", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMDo0MToyMVrOGvhCdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxOTo1NDoxOFrOGw3hiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ3NzU1OQ==", "bodyText": "These Channels should better be Thing Actions, since they don't have any state. Then, you could use the duration as a parameter, too. See https://www.openhab.org/docs/developer/bindings/#actions-bound-to-a-thing", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452477559", "createdAt": "2020-07-09T20:41:21Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/README.md", "diffHunk": "@@ -0,0 +1,80 @@\n+# Automower Binding\n+\n+This binding communicates to the Husqvarna Automower Connect API in order to send commands and query the state of Husqvarna Automower robots.\n+\n+## Supported Things\n+\n+bridge: The bridge needs to be configured with credentials and an application key that allows communicating with the Automower Connect Api\n+automower: A single Husqvarna Automower robot\n+\n+Basically all Husqvarna Automower models with \"Automower Connect\" support should be supported. It was tested only with a Husqvarna Automower 450X\n+\n+\n+## Discovery\n+\n+Once the bridge is created and configured, registered automowers will be discovered automatically\n+\n+\n+## Thing Configuration\n+\n+bridge:\n+- appKey (mandatory): The Application Key is required to communication with the Automower Connect Api. It can be obtained by registering an Application on the Husqvarna Website. This application also needs to be connected to the \"Authentication API\" and the \"Automower Connect API\"\n+- userName (mandatory): The user name for which the application key has been issued\n+- password (mandatory): The password for the given user\n+- pollingInterval (optional): How often the available automowers should be queried in seconds. Default is 1h (3600s)\n+\n+automower:\n+- mowerId (mandatory): The Id of an automower as used by the Automower Connect Api to identify a mower. This is automatically filled when the thing is discovered\n+- pollingInterval (optional): How often the current automower state should be polled in seconds. Default is 5min (300s)\n+\n+Keep in mind that the status of the automowers should not be queried too often. According to the Husqvarna documentation not more than 10000 requests per month and application key are allowed\n+\n+## Channels\n+\n+_Here you should provide information about available channel types, what their meaning is and how they can be used._\n+\n+_Note that it is planned to generate some part of this based on the XML files within ```src/main/resources/ESH-INF/thing``` of your binding._\n+\n+| channel  | type   | description                  |\n+|----------|--------|------------------------------|\n+| name  | String | (readonly) The name of the Automower  |\n+| mode  | String | (readonly) The current mode (MAIN_AREA, SECONDARY_AREA, HOME, DEMO, UNKNOWN)  |\n+| activity  | String | (readonly) The current activity (UNKNOWN, NOT_APPLICABLE, MOWING, GOING_HOME, CHARGING, LEAVING, PARKED_IN_CS, STOPPED_IN_GARDEN)  |\n+| state  | String | (readonly) The current state (UNKNOWN, NOT_APPLICABLE, PAUSED, IN_OPERATION, WAIT_UPDATING, WAIT_POWER_UP, RESTRICTED, OFF, STOPPED, ERROR, FATAL_ERROR, ERROR_AT_POWER_UP)  |\n+| last-update  | DateTime | (readonly) The time when the automower updated its states  |\n+| battery  | Number | (readonly) A value between 0 and 100  |\n+| error-code  | Number | (readonly) The current error code  |\n+| error-timestamp  | DateTime | (readonly) The timestamp when the current error occurred  |\n+| command  | String | A command that is sent to the automower. Supported commands: \"Start\", \"ResumeSchedule\", \"Pause\", \"Park\", \"ParkUntilNextSchedule\", \"ParkUntilFurtherNotice\". Be aware that \"Start\" and \"Park\" use the value of channel command-duration as the duration of the command   |\n+| command-duration  | String | The duration that should be used for commands sent to the automower. Only \"Start\" and \"Park\" commands support a duration  |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2NDA1NQ==", "bodyText": "Thanks for the link. Makes sense!", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453164055", "createdAt": "2020-07-11T06:43:12Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/README.md", "diffHunk": "@@ -0,0 +1,80 @@\n+# Automower Binding\n+\n+This binding communicates to the Husqvarna Automower Connect API in order to send commands and query the state of Husqvarna Automower robots.\n+\n+## Supported Things\n+\n+bridge: The bridge needs to be configured with credentials and an application key that allows communicating with the Automower Connect Api\n+automower: A single Husqvarna Automower robot\n+\n+Basically all Husqvarna Automower models with \"Automower Connect\" support should be supported. It was tested only with a Husqvarna Automower 450X\n+\n+\n+## Discovery\n+\n+Once the bridge is created and configured, registered automowers will be discovered automatically\n+\n+\n+## Thing Configuration\n+\n+bridge:\n+- appKey (mandatory): The Application Key is required to communication with the Automower Connect Api. It can be obtained by registering an Application on the Husqvarna Website. This application also needs to be connected to the \"Authentication API\" and the \"Automower Connect API\"\n+- userName (mandatory): The user name for which the application key has been issued\n+- password (mandatory): The password for the given user\n+- pollingInterval (optional): How often the available automowers should be queried in seconds. Default is 1h (3600s)\n+\n+automower:\n+- mowerId (mandatory): The Id of an automower as used by the Automower Connect Api to identify a mower. This is automatically filled when the thing is discovered\n+- pollingInterval (optional): How often the current automower state should be polled in seconds. Default is 5min (300s)\n+\n+Keep in mind that the status of the automowers should not be queried too often. According to the Husqvarna documentation not more than 10000 requests per month and application key are allowed\n+\n+## Channels\n+\n+_Here you should provide information about available channel types, what their meaning is and how they can be used._\n+\n+_Note that it is planned to generate some part of this based on the XML files within ```src/main/resources/ESH-INF/thing``` of your binding._\n+\n+| channel  | type   | description                  |\n+|----------|--------|------------------------------|\n+| name  | String | (readonly) The name of the Automower  |\n+| mode  | String | (readonly) The current mode (MAIN_AREA, SECONDARY_AREA, HOME, DEMO, UNKNOWN)  |\n+| activity  | String | (readonly) The current activity (UNKNOWN, NOT_APPLICABLE, MOWING, GOING_HOME, CHARGING, LEAVING, PARKED_IN_CS, STOPPED_IN_GARDEN)  |\n+| state  | String | (readonly) The current state (UNKNOWN, NOT_APPLICABLE, PAUSED, IN_OPERATION, WAIT_UPDATING, WAIT_POWER_UP, RESTRICTED, OFF, STOPPED, ERROR, FATAL_ERROR, ERROR_AT_POWER_UP)  |\n+| last-update  | DateTime | (readonly) The time when the automower updated its states  |\n+| battery  | Number | (readonly) A value between 0 and 100  |\n+| error-code  | Number | (readonly) The current error code  |\n+| error-timestamp  | DateTime | (readonly) The timestamp when the current error occurred  |\n+| command  | String | A command that is sent to the automower. Supported commands: \"Start\", \"ResumeSchedule\", \"Pause\", \"Park\", \"ParkUntilNextSchedule\", \"ParkUntilFurtherNotice\". Be aware that \"Start\" and \"Park\" use the value of channel command-duration as the duration of the command   |\n+| command-duration  | String | The duration that should be used for commands sent to the automower. Only \"Start\" and \"Park\" commands support a duration  |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ3NzU1OQ=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg3NDIwOQ==", "bodyText": "One question regarding that. I just changed the implementation and was wondering how/if such actions should be documented in the readme file. There is no section for that in the template, and at least some bindings seem to not document them there...?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453874209", "createdAt": "2020-07-13T19:16:14Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/README.md", "diffHunk": "@@ -0,0 +1,80 @@\n+# Automower Binding\n+\n+This binding communicates to the Husqvarna Automower Connect API in order to send commands and query the state of Husqvarna Automower robots.\n+\n+## Supported Things\n+\n+bridge: The bridge needs to be configured with credentials and an application key that allows communicating with the Automower Connect Api\n+automower: A single Husqvarna Automower robot\n+\n+Basically all Husqvarna Automower models with \"Automower Connect\" support should be supported. It was tested only with a Husqvarna Automower 450X\n+\n+\n+## Discovery\n+\n+Once the bridge is created and configured, registered automowers will be discovered automatically\n+\n+\n+## Thing Configuration\n+\n+bridge:\n+- appKey (mandatory): The Application Key is required to communication with the Automower Connect Api. It can be obtained by registering an Application on the Husqvarna Website. This application also needs to be connected to the \"Authentication API\" and the \"Automower Connect API\"\n+- userName (mandatory): The user name for which the application key has been issued\n+- password (mandatory): The password for the given user\n+- pollingInterval (optional): How often the available automowers should be queried in seconds. Default is 1h (3600s)\n+\n+automower:\n+- mowerId (mandatory): The Id of an automower as used by the Automower Connect Api to identify a mower. This is automatically filled when the thing is discovered\n+- pollingInterval (optional): How often the current automower state should be polled in seconds. Default is 5min (300s)\n+\n+Keep in mind that the status of the automowers should not be queried too often. According to the Husqvarna documentation not more than 10000 requests per month and application key are allowed\n+\n+## Channels\n+\n+_Here you should provide information about available channel types, what their meaning is and how they can be used._\n+\n+_Note that it is planned to generate some part of this based on the XML files within ```src/main/resources/ESH-INF/thing``` of your binding._\n+\n+| channel  | type   | description                  |\n+|----------|--------|------------------------------|\n+| name  | String | (readonly) The name of the Automower  |\n+| mode  | String | (readonly) The current mode (MAIN_AREA, SECONDARY_AREA, HOME, DEMO, UNKNOWN)  |\n+| activity  | String | (readonly) The current activity (UNKNOWN, NOT_APPLICABLE, MOWING, GOING_HOME, CHARGING, LEAVING, PARKED_IN_CS, STOPPED_IN_GARDEN)  |\n+| state  | String | (readonly) The current state (UNKNOWN, NOT_APPLICABLE, PAUSED, IN_OPERATION, WAIT_UPDATING, WAIT_POWER_UP, RESTRICTED, OFF, STOPPED, ERROR, FATAL_ERROR, ERROR_AT_POWER_UP)  |\n+| last-update  | DateTime | (readonly) The time when the automower updated its states  |\n+| battery  | Number | (readonly) A value between 0 and 100  |\n+| error-code  | Number | (readonly) The current error code  |\n+| error-timestamp  | DateTime | (readonly) The timestamp when the current error occurred  |\n+| command  | String | A command that is sent to the automower. Supported commands: \"Start\", \"ResumeSchedule\", \"Pause\", \"Park\", \"ParkUntilNextSchedule\", \"ParkUntilFurtherNotice\". Be aware that \"Start\" and \"Park\" use the value of channel command-duration as the duration of the command   |\n+| command-duration  | String | The duration that should be used for commands sent to the automower. Only \"Start\" and \"Park\" commands support a duration  |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ3NzU1OQ=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg5NDUzNg==", "bodyText": "It's not specified how to document this. You could create dedicated chapter for that. Here is a list of bindings using Actions: #8116 Maybe you can copy some parts from them.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453894536", "createdAt": "2020-07-13T19:54:18Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/README.md", "diffHunk": "@@ -0,0 +1,80 @@\n+# Automower Binding\n+\n+This binding communicates to the Husqvarna Automower Connect API in order to send commands and query the state of Husqvarna Automower robots.\n+\n+## Supported Things\n+\n+bridge: The bridge needs to be configured with credentials and an application key that allows communicating with the Automower Connect Api\n+automower: A single Husqvarna Automower robot\n+\n+Basically all Husqvarna Automower models with \"Automower Connect\" support should be supported. It was tested only with a Husqvarna Automower 450X\n+\n+\n+## Discovery\n+\n+Once the bridge is created and configured, registered automowers will be discovered automatically\n+\n+\n+## Thing Configuration\n+\n+bridge:\n+- appKey (mandatory): The Application Key is required to communication with the Automower Connect Api. It can be obtained by registering an Application on the Husqvarna Website. This application also needs to be connected to the \"Authentication API\" and the \"Automower Connect API\"\n+- userName (mandatory): The user name for which the application key has been issued\n+- password (mandatory): The password for the given user\n+- pollingInterval (optional): How often the available automowers should be queried in seconds. Default is 1h (3600s)\n+\n+automower:\n+- mowerId (mandatory): The Id of an automower as used by the Automower Connect Api to identify a mower. This is automatically filled when the thing is discovered\n+- pollingInterval (optional): How often the current automower state should be polled in seconds. Default is 5min (300s)\n+\n+Keep in mind that the status of the automowers should not be queried too often. According to the Husqvarna documentation not more than 10000 requests per month and application key are allowed\n+\n+## Channels\n+\n+_Here you should provide information about available channel types, what their meaning is and how they can be used._\n+\n+_Note that it is planned to generate some part of this based on the XML files within ```src/main/resources/ESH-INF/thing``` of your binding._\n+\n+| channel  | type   | description                  |\n+|----------|--------|------------------------------|\n+| name  | String | (readonly) The name of the Automower  |\n+| mode  | String | (readonly) The current mode (MAIN_AREA, SECONDARY_AREA, HOME, DEMO, UNKNOWN)  |\n+| activity  | String | (readonly) The current activity (UNKNOWN, NOT_APPLICABLE, MOWING, GOING_HOME, CHARGING, LEAVING, PARKED_IN_CS, STOPPED_IN_GARDEN)  |\n+| state  | String | (readonly) The current state (UNKNOWN, NOT_APPLICABLE, PAUSED, IN_OPERATION, WAIT_UPDATING, WAIT_POWER_UP, RESTRICTED, OFF, STOPPED, ERROR, FATAL_ERROR, ERROR_AT_POWER_UP)  |\n+| last-update  | DateTime | (readonly) The time when the automower updated its states  |\n+| battery  | Number | (readonly) A value between 0 and 100  |\n+| error-code  | Number | (readonly) The current error code  |\n+| error-timestamp  | DateTime | (readonly) The timestamp when the current error occurred  |\n+| command  | String | A command that is sent to the automower. Supported commands: \"Start\", \"ResumeSchedule\", \"Pause\", \"Park\", \"ParkUntilNextSchedule\", \"ParkUntilFurtherNotice\". Be aware that \"Start\" and \"Park\" use the value of channel command-duration as the duration of the command   |\n+| command-duration  | String | The duration that should be used for commands sent to the automower. Only \"Start\" and \"Park\" commands support a duration  |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ3NzU1OQ=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTE4NDIyOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/README.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMDo0Mjo0NlrOGvhFjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNjo0NDo1NVrOGwK8fQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ3ODM1MQ==", "bodyText": "You could use a code block for the config files by adding three backticks to the start and end in a single line. Same for below.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452478351", "createdAt": "2020-07-09T20:42:46Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/README.md", "diffHunk": "@@ -0,0 +1,80 @@\n+# Automower Binding\n+\n+This binding communicates to the Husqvarna Automower Connect API in order to send commands and query the state of Husqvarna Automower robots.\n+\n+## Supported Things\n+\n+bridge: The bridge needs to be configured with credentials and an application key that allows communicating with the Automower Connect Api\n+automower: A single Husqvarna Automower robot\n+\n+Basically all Husqvarna Automower models with \"Automower Connect\" support should be supported. It was tested only with a Husqvarna Automower 450X\n+\n+\n+## Discovery\n+\n+Once the bridge is created and configured, registered automowers will be discovered automatically\n+\n+\n+## Thing Configuration\n+\n+bridge:\n+- appKey (mandatory): The Application Key is required to communication with the Automower Connect Api. It can be obtained by registering an Application on the Husqvarna Website. This application also needs to be connected to the \"Authentication API\" and the \"Automower Connect API\"\n+- userName (mandatory): The user name for which the application key has been issued\n+- password (mandatory): The password for the given user\n+- pollingInterval (optional): How often the available automowers should be queried in seconds. Default is 1h (3600s)\n+\n+automower:\n+- mowerId (mandatory): The Id of an automower as used by the Automower Connect Api to identify a mower. This is automatically filled when the thing is discovered\n+- pollingInterval (optional): How often the current automower state should be polled in seconds. Default is 5min (300s)\n+\n+Keep in mind that the status of the automowers should not be queried too often. According to the Husqvarna documentation not more than 10000 requests per month and application key are allowed\n+\n+## Channels\n+\n+_Here you should provide information about available channel types, what their meaning is and how they can be used._\n+\n+_Note that it is planned to generate some part of this based on the XML files within ```src/main/resources/ESH-INF/thing``` of your binding._\n+\n+| channel  | type   | description                  |\n+|----------|--------|------------------------------|\n+| name  | String | (readonly) The name of the Automower  |\n+| mode  | String | (readonly) The current mode (MAIN_AREA, SECONDARY_AREA, HOME, DEMO, UNKNOWN)  |\n+| activity  | String | (readonly) The current activity (UNKNOWN, NOT_APPLICABLE, MOWING, GOING_HOME, CHARGING, LEAVING, PARKED_IN_CS, STOPPED_IN_GARDEN)  |\n+| state  | String | (readonly) The current state (UNKNOWN, NOT_APPLICABLE, PAUSED, IN_OPERATION, WAIT_UPDATING, WAIT_POWER_UP, RESTRICTED, OFF, STOPPED, ERROR, FATAL_ERROR, ERROR_AT_POWER_UP)  |\n+| last-update  | DateTime | (readonly) The time when the automower updated its states  |\n+| battery  | Number | (readonly) A value between 0 and 100  |\n+| error-code  | Number | (readonly) The current error code  |\n+| error-timestamp  | DateTime | (readonly) The timestamp when the current error occurred  |\n+| command  | String | A command that is sent to the automower. Supported commands: \"Start\", \"ResumeSchedule\", \"Pause\", \"Park\", \"ParkUntilNextSchedule\", \"ParkUntilFurtherNotice\". Be aware that \"Start\" and \"Park\" use the value of channel command-duration as the duration of the command   |\n+| command-duration  | String | The duration that should be used for commands sent to the automower. Only \"Start\" and \"Park\" commands support a duration  |\n+| command-response  | String | The response received when the last command was sent to the automower  |\n+\n+## Full Example\n+\n+### automower.thing\n+\n+Bridge automower:bridge:mybridge [ appKey=\"<your_private_application_key>\", userName=\"<your_username>\", password=\"<your_password>\" ] {\n+\tThing automower myAutomower [ mowerId=\"<your_id_received_from_discovery>\", pollingInterval=3600] {\n+    }\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2NDE1Nw==", "bodyText": "Already saw that and changed it locally", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453164157", "createdAt": "2020-07-11T06:44:55Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/README.md", "diffHunk": "@@ -0,0 +1,80 @@\n+# Automower Binding\n+\n+This binding communicates to the Husqvarna Automower Connect API in order to send commands and query the state of Husqvarna Automower robots.\n+\n+## Supported Things\n+\n+bridge: The bridge needs to be configured with credentials and an application key that allows communicating with the Automower Connect Api\n+automower: A single Husqvarna Automower robot\n+\n+Basically all Husqvarna Automower models with \"Automower Connect\" support should be supported. It was tested only with a Husqvarna Automower 450X\n+\n+\n+## Discovery\n+\n+Once the bridge is created and configured, registered automowers will be discovered automatically\n+\n+\n+## Thing Configuration\n+\n+bridge:\n+- appKey (mandatory): The Application Key is required to communication with the Automower Connect Api. It can be obtained by registering an Application on the Husqvarna Website. This application also needs to be connected to the \"Authentication API\" and the \"Automower Connect API\"\n+- userName (mandatory): The user name for which the application key has been issued\n+- password (mandatory): The password for the given user\n+- pollingInterval (optional): How often the available automowers should be queried in seconds. Default is 1h (3600s)\n+\n+automower:\n+- mowerId (mandatory): The Id of an automower as used by the Automower Connect Api to identify a mower. This is automatically filled when the thing is discovered\n+- pollingInterval (optional): How often the current automower state should be polled in seconds. Default is 5min (300s)\n+\n+Keep in mind that the status of the automowers should not be queried too often. According to the Husqvarna documentation not more than 10000 requests per month and application key are allowed\n+\n+## Channels\n+\n+_Here you should provide information about available channel types, what their meaning is and how they can be used._\n+\n+_Note that it is planned to generate some part of this based on the XML files within ```src/main/resources/ESH-INF/thing``` of your binding._\n+\n+| channel  | type   | description                  |\n+|----------|--------|------------------------------|\n+| name  | String | (readonly) The name of the Automower  |\n+| mode  | String | (readonly) The current mode (MAIN_AREA, SECONDARY_AREA, HOME, DEMO, UNKNOWN)  |\n+| activity  | String | (readonly) The current activity (UNKNOWN, NOT_APPLICABLE, MOWING, GOING_HOME, CHARGING, LEAVING, PARKED_IN_CS, STOPPED_IN_GARDEN)  |\n+| state  | String | (readonly) The current state (UNKNOWN, NOT_APPLICABLE, PAUSED, IN_OPERATION, WAIT_UPDATING, WAIT_POWER_UP, RESTRICTED, OFF, STOPPED, ERROR, FATAL_ERROR, ERROR_AT_POWER_UP)  |\n+| last-update  | DateTime | (readonly) The time when the automower updated its states  |\n+| battery  | Number | (readonly) A value between 0 and 100  |\n+| error-code  | Number | (readonly) The current error code  |\n+| error-timestamp  | DateTime | (readonly) The timestamp when the current error occurred  |\n+| command  | String | A command that is sent to the automower. Supported commands: \"Start\", \"ResumeSchedule\", \"Pause\", \"Park\", \"ParkUntilNextSchedule\", \"ParkUntilFurtherNotice\". Be aware that \"Start\" and \"Park\" use the value of channel command-duration as the duration of the command   |\n+| command-duration  | String | The duration that should be used for commands sent to the automower. Only \"Start\" and \"Park\" commands support a duration  |\n+| command-response  | String | The response received when the last command was sent to the automower  |\n+\n+## Full Example\n+\n+### automower.thing\n+\n+Bridge automower:bridge:mybridge [ appKey=\"<your_private_application_key>\", userName=\"<your_username>\", password=\"<your_password>\" ] {\n+\tThing automower myAutomower [ mowerId=\"<your_id_received_from_discovery>\", pollingInterval=3600] {\n+    }\n+}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ3ODM1MQ=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTE4NzEzOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/README.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMDo0Mzo0OVrOGvhHbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQyMToyNjo1N1rOGxl96A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ3ODgzMA==", "bodyText": "Can you add a sitemap example?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452478830", "createdAt": "2020-07-09T20:43:49Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/README.md", "diffHunk": "@@ -0,0 +1,80 @@\n+# Automower Binding\n+\n+This binding communicates to the Husqvarna Automower Connect API in order to send commands and query the state of Husqvarna Automower robots.\n+\n+## Supported Things\n+\n+bridge: The bridge needs to be configured with credentials and an application key that allows communicating with the Automower Connect Api\n+automower: A single Husqvarna Automower robot\n+\n+Basically all Husqvarna Automower models with \"Automower Connect\" support should be supported. It was tested only with a Husqvarna Automower 450X\n+\n+\n+## Discovery\n+\n+Once the bridge is created and configured, registered automowers will be discovered automatically\n+\n+\n+## Thing Configuration\n+\n+bridge:\n+- appKey (mandatory): The Application Key is required to communication with the Automower Connect Api. It can be obtained by registering an Application on the Husqvarna Website. This application also needs to be connected to the \"Authentication API\" and the \"Automower Connect API\"\n+- userName (mandatory): The user name for which the application key has been issued\n+- password (mandatory): The password for the given user\n+- pollingInterval (optional): How often the available automowers should be queried in seconds. Default is 1h (3600s)\n+\n+automower:\n+- mowerId (mandatory): The Id of an automower as used by the Automower Connect Api to identify a mower. This is automatically filled when the thing is discovered\n+- pollingInterval (optional): How often the current automower state should be polled in seconds. Default is 5min (300s)\n+\n+Keep in mind that the status of the automowers should not be queried too often. According to the Husqvarna documentation not more than 10000 requests per month and application key are allowed\n+\n+## Channels\n+\n+_Here you should provide information about available channel types, what their meaning is and how they can be used._\n+\n+_Note that it is planned to generate some part of this based on the XML files within ```src/main/resources/ESH-INF/thing``` of your binding._\n+\n+| channel  | type   | description                  |\n+|----------|--------|------------------------------|\n+| name  | String | (readonly) The name of the Automower  |\n+| mode  | String | (readonly) The current mode (MAIN_AREA, SECONDARY_AREA, HOME, DEMO, UNKNOWN)  |\n+| activity  | String | (readonly) The current activity (UNKNOWN, NOT_APPLICABLE, MOWING, GOING_HOME, CHARGING, LEAVING, PARKED_IN_CS, STOPPED_IN_GARDEN)  |\n+| state  | String | (readonly) The current state (UNKNOWN, NOT_APPLICABLE, PAUSED, IN_OPERATION, WAIT_UPDATING, WAIT_POWER_UP, RESTRICTED, OFF, STOPPED, ERROR, FATAL_ERROR, ERROR_AT_POWER_UP)  |\n+| last-update  | DateTime | (readonly) The time when the automower updated its states  |\n+| battery  | Number | (readonly) A value between 0 and 100  |\n+| error-code  | Number | (readonly) The current error code  |\n+| error-timestamp  | DateTime | (readonly) The timestamp when the current error occurred  |\n+| command  | String | A command that is sent to the automower. Supported commands: \"Start\", \"ResumeSchedule\", \"Pause\", \"Park\", \"ParkUntilNextSchedule\", \"ParkUntilFurtherNotice\". Be aware that \"Start\" and \"Park\" use the value of channel command-duration as the duration of the command   |\n+| command-duration  | String | The duration that should be used for commands sent to the automower. Only \"Start\" and \"Park\" commands support a duration  |\n+| command-response  | String | The response received when the last command was sent to the automower  |\n+\n+## Full Example\n+\n+### automower.thing\n+\n+Bridge automower:bridge:mybridge [ appKey=\"<your_private_application_key>\", userName=\"<your_username>\", password=\"<your_password>\" ] {\n+\tThing automower myAutomower [ mowerId=\"<your_id_received_from_discovery>\", pollingInterval=3600] {\n+    }\n+}\n+\n+\n+### automower.items\n+\n+String Automower_Name               \"Name\"                   { channel=\"automower:automower:mybridge:myAutomower:name\" }\n+String Automower_Mode               \"Mode\"                   { channel=\"automower:automower:mybridge:myAutomower:mode\" }\n+String Automower_Activity           \"Activity\"         \t     { channel=\"automower:automower:mybridge:myAutomower:activity\" }\n+String Automower_State              \"State\"            \t     { channel=\"automower:automower:mybridge:myAutomower:state\" }\n+DateTime Automower_Last_Update      \"Last Update\"    \t     { channel=\"automower:automower:mybridge:myAutomower:last-update\" }\n+Number Automower_Battery            \"Battery\"                { channel=\"automower:automower:mybridge:myAutomower:battery\" }\n+Number Automower_Error_Code         \"Error Code\"             { channel=\"automower:automower:mybridge:myAutomower:error-code\" }\n+DateTime Automower_Error_Time       \"Error Time\"             { channel=\"automower:automower:mybridge:myAutomower:error-timestamp\" }\n+\n+\n+String Automower_Command            \"Command\"          \t     { channel=\"automower:automower:mybridge:myAutomower:command\" }\n+Number Automower_Command_Duration   \"Command Duration\"       { channel=\"automower:automower:mybridge:myAutomower:command-duration\" }\n+String Automower_Command_Response   \"Command Response\"       { channel=\"automower:automower:mybridge:myAutomower:command-response\" }\n+\n+### automower.sitemap\n+\n+TODO", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY1NTQ2NA==", "bodyText": "Sure", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r454655464", "createdAt": "2020-07-14T21:26:57Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/README.md", "diffHunk": "@@ -0,0 +1,80 @@\n+# Automower Binding\n+\n+This binding communicates to the Husqvarna Automower Connect API in order to send commands and query the state of Husqvarna Automower robots.\n+\n+## Supported Things\n+\n+bridge: The bridge needs to be configured with credentials and an application key that allows communicating with the Automower Connect Api\n+automower: A single Husqvarna Automower robot\n+\n+Basically all Husqvarna Automower models with \"Automower Connect\" support should be supported. It was tested only with a Husqvarna Automower 450X\n+\n+\n+## Discovery\n+\n+Once the bridge is created and configured, registered automowers will be discovered automatically\n+\n+\n+## Thing Configuration\n+\n+bridge:\n+- appKey (mandatory): The Application Key is required to communication with the Automower Connect Api. It can be obtained by registering an Application on the Husqvarna Website. This application also needs to be connected to the \"Authentication API\" and the \"Automower Connect API\"\n+- userName (mandatory): The user name for which the application key has been issued\n+- password (mandatory): The password for the given user\n+- pollingInterval (optional): How often the available automowers should be queried in seconds. Default is 1h (3600s)\n+\n+automower:\n+- mowerId (mandatory): The Id of an automower as used by the Automower Connect Api to identify a mower. This is automatically filled when the thing is discovered\n+- pollingInterval (optional): How often the current automower state should be polled in seconds. Default is 5min (300s)\n+\n+Keep in mind that the status of the automowers should not be queried too often. According to the Husqvarna documentation not more than 10000 requests per month and application key are allowed\n+\n+## Channels\n+\n+_Here you should provide information about available channel types, what their meaning is and how they can be used._\n+\n+_Note that it is planned to generate some part of this based on the XML files within ```src/main/resources/ESH-INF/thing``` of your binding._\n+\n+| channel  | type   | description                  |\n+|----------|--------|------------------------------|\n+| name  | String | (readonly) The name of the Automower  |\n+| mode  | String | (readonly) The current mode (MAIN_AREA, SECONDARY_AREA, HOME, DEMO, UNKNOWN)  |\n+| activity  | String | (readonly) The current activity (UNKNOWN, NOT_APPLICABLE, MOWING, GOING_HOME, CHARGING, LEAVING, PARKED_IN_CS, STOPPED_IN_GARDEN)  |\n+| state  | String | (readonly) The current state (UNKNOWN, NOT_APPLICABLE, PAUSED, IN_OPERATION, WAIT_UPDATING, WAIT_POWER_UP, RESTRICTED, OFF, STOPPED, ERROR, FATAL_ERROR, ERROR_AT_POWER_UP)  |\n+| last-update  | DateTime | (readonly) The time when the automower updated its states  |\n+| battery  | Number | (readonly) A value between 0 and 100  |\n+| error-code  | Number | (readonly) The current error code  |\n+| error-timestamp  | DateTime | (readonly) The timestamp when the current error occurred  |\n+| command  | String | A command that is sent to the automower. Supported commands: \"Start\", \"ResumeSchedule\", \"Pause\", \"Park\", \"ParkUntilNextSchedule\", \"ParkUntilFurtherNotice\". Be aware that \"Start\" and \"Park\" use the value of channel command-duration as the duration of the command   |\n+| command-duration  | String | The duration that should be used for commands sent to the automower. Only \"Start\" and \"Park\" commands support a duration  |\n+| command-response  | String | The response received when the last command was sent to the automower  |\n+\n+## Full Example\n+\n+### automower.thing\n+\n+Bridge automower:bridge:mybridge [ appKey=\"<your_private_application_key>\", userName=\"<your_username>\", password=\"<your_password>\" ] {\n+\tThing automower myAutomower [ mowerId=\"<your_id_received_from_discovery>\", pollingInterval=3600] {\n+    }\n+}\n+\n+\n+### automower.items\n+\n+String Automower_Name               \"Name\"                   { channel=\"automower:automower:mybridge:myAutomower:name\" }\n+String Automower_Mode               \"Mode\"                   { channel=\"automower:automower:mybridge:myAutomower:mode\" }\n+String Automower_Activity           \"Activity\"         \t     { channel=\"automower:automower:mybridge:myAutomower:activity\" }\n+String Automower_State              \"State\"            \t     { channel=\"automower:automower:mybridge:myAutomower:state\" }\n+DateTime Automower_Last_Update      \"Last Update\"    \t     { channel=\"automower:automower:mybridge:myAutomower:last-update\" }\n+Number Automower_Battery            \"Battery\"                { channel=\"automower:automower:mybridge:myAutomower:battery\" }\n+Number Automower_Error_Code         \"Error Code\"             { channel=\"automower:automower:mybridge:myAutomower:error-code\" }\n+DateTime Automower_Error_Time       \"Error Time\"             { channel=\"automower:automower:mybridge:myAutomower:error-timestamp\" }\n+\n+\n+String Automower_Command            \"Command\"          \t     { channel=\"automower:automower:mybridge:myAutomower:command\" }\n+Number Automower_Command_Duration   \"Command Duration\"       { channel=\"automower:automower:mybridge:myAutomower:command-duration\" }\n+String Automower_Command_Response   \"Command Response\"       { channel=\"automower:automower:mybridge:myAutomower:command-response\" }\n+\n+### automower.sitemap\n+\n+TODO", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ3ODgzMA=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 80}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTIwMDkxOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridge.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMDo0ODoyOFrOGvhP9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNjo0ODoxNVrOGwK9eQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4MTAxMg==", "bodyText": "You could store authResponse to a local variable and check that for null to remove the suppression.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452481012", "createdAt": "2020-07-09T20:48:28Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridge.java", "diffHunk": "@@ -0,0 +1,144 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import java.util.concurrent.ScheduledExecutorService;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.openhab.binding.automower.internal.rest.api.authentication.AuthenticationApi;\n+import org.openhab.binding.automower.internal.rest.api.authentication.dto.PostOAuth2Response;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.AutomowerConnectApi;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerCommand;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerCommandAttributes;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerCommandRequest;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.openhab.binding.automower.internal.rest.exceptions.UnauthorizedException;\n+\n+/**\n+ * The {@link AutomowerBridge} allows the communication to the various Husqvarna rest apis like the\n+ * AutomowerConnectApi or the AuthenticationApi\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridge {\n+\n+    private final String appKey;\n+    private final String userName;\n+    private final String password;\n+\n+    private @Nullable PostOAuth2Response authResponse;\n+    private final AutomowerConnectApi automowerApi;\n+    private final AuthenticationApi authApi;\n+\n+    public AutomowerBridge(String appKey, String userName, String password, HttpClient httpClient,\n+            ScheduledExecutorService scheduler) {\n+        this.appKey = appKey;\n+        this.userName = userName;\n+        this.password = password;\n+\n+        this.automowerApi = new AutomowerConnectApi(httpClient);\n+        this.authApi = new AuthenticationApi(httpClient);\n+    }\n+\n+    private PostOAuth2Response authenticate() throws AutomowerCommunicationException {\n+        PostOAuth2Response result = authResponse;\n+        if (result == null) {\n+            result = authApi.loginOAuth2(appKey, userName, password);\n+            authResponse = result;\n+        }\n+        return result;\n+    }\n+\n+    private PostOAuth2Response refreshAuthentication() throws AutomowerCommunicationException {\n+        if (authResponse == null) {\n+            throw new AutomowerCommunicationException(\"Unable to refresh authentication. Initial authentication has not been performed\");\n+        } else {\n+            @SuppressWarnings(\"null\")\n+            PostOAuth2Response result = authApi.loginWithRefreshToken(appKey, authResponse.getRefresh_token());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2NDQwOQ==", "bodyText": "Don't like such workarounds for a situation that clearly cannot happen (in the else branch of the null check). Still as it is nicer to work with the local variable compared to querying the same field multipe times, so it makes sense.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453164409", "createdAt": "2020-07-11T06:48:15Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridge.java", "diffHunk": "@@ -0,0 +1,144 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import java.util.concurrent.ScheduledExecutorService;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.openhab.binding.automower.internal.rest.api.authentication.AuthenticationApi;\n+import org.openhab.binding.automower.internal.rest.api.authentication.dto.PostOAuth2Response;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.AutomowerConnectApi;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerCommand;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerCommandAttributes;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerCommandRequest;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.openhab.binding.automower.internal.rest.exceptions.UnauthorizedException;\n+\n+/**\n+ * The {@link AutomowerBridge} allows the communication to the various Husqvarna rest apis like the\n+ * AutomowerConnectApi or the AuthenticationApi\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridge {\n+\n+    private final String appKey;\n+    private final String userName;\n+    private final String password;\n+\n+    private @Nullable PostOAuth2Response authResponse;\n+    private final AutomowerConnectApi automowerApi;\n+    private final AuthenticationApi authApi;\n+\n+    public AutomowerBridge(String appKey, String userName, String password, HttpClient httpClient,\n+            ScheduledExecutorService scheduler) {\n+        this.appKey = appKey;\n+        this.userName = userName;\n+        this.password = password;\n+\n+        this.automowerApi = new AutomowerConnectApi(httpClient);\n+        this.authApi = new AuthenticationApi(httpClient);\n+    }\n+\n+    private PostOAuth2Response authenticate() throws AutomowerCommunicationException {\n+        PostOAuth2Response result = authResponse;\n+        if (result == null) {\n+            result = authApi.loginOAuth2(appKey, userName, password);\n+            authResponse = result;\n+        }\n+        return result;\n+    }\n+\n+    private PostOAuth2Response refreshAuthentication() throws AutomowerCommunicationException {\n+        if (authResponse == null) {\n+            throw new AutomowerCommunicationException(\"Unable to refresh authentication. Initial authentication has not been performed\");\n+        } else {\n+            @SuppressWarnings(\"null\")\n+            PostOAuth2Response result = authApi.loginWithRefreshToken(appKey, authResponse.getRefresh_token());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4MTAxMg=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 72}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTIyMTU4OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMDo1NDozOVrOGvhcqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNjo0OTo1N1rOGwK96g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4NDI2Nw==", "bodyText": "The default mentioned in the readme is 1h.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452484267", "createdAt": "2020-07-09T20:54:39Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2NDUyMg==", "bodyText": "Wow, you really took a detailed look! Thanks a lot. Will fix that", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453164522", "createdAt": "2020-07-11T06:49:57Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4NDI2Nw=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTIyMzgzOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMDo1NToxNlrOGvhd_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxODoyNDo0N1rOGw0exQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4NDYwNw==", "bodyText": "Inner classes don't need to be annotated with NonNullByDefault.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452484607", "createdAt": "2020-07-09T20:55:16Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2NDc4OQ==", "bodyText": "Thats an interesting one:\nEclipse: Shows a warning when I do this annotation on the inner class as you say\nBuild: Shows a warning (code analysis report) if I don't add this annotation to the inner class...\nI decided to go for the solution that has no build warning... How should I sove it?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453164789", "createdAt": "2020-07-11T06:53:37Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4NDYwNw=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE3OTc5Nw==", "bodyText": "There has been a bug around in the static code analysis. It was fixed, but this repo still uses the unfixed version. You can remove the annotation, which will generate the false positive.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453179797", "createdAt": "2020-07-11T10:09:54Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4NDYwNw=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg0NDY3Nw==", "bodyText": "ok, will do that", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453844677", "createdAt": "2020-07-13T18:24:47Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4NDYwNw=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTIyNzc5OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMDo1NjoyOFrOGvhgeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNjo1NDoyOFrOGwK_Jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4NTI0MQ==", "bodyText": "Logging to info should be used rarely. This could be debug.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452485241", "createdAt": "2020-07-09T20:56:28Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.info(\"Found {} automowers\", automowers.getData().size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2NDgzOA==", "bodyText": "ok", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453164838", "createdAt": "2020-07-11T06:54:28Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.info(\"Found {} automowers\", automowers.getData().size());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4NTI0MQ=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTIzMTMyOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMDo1NzoyOVrOGvhirg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxODoyNjo1MlrOGw0jjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4NTgwNg==", "bodyText": "Do you log the stack trace by intention? Would logging the message suffice?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            logger.warn(\"Unable to fetch automowers\", e);\n          \n          \n            \n                            logger.warn(\"Unable to fetch automowers: {}\", e.getMessage());", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452485806", "createdAt": "2020-07-09T20:57:29Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.info(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers\", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2NTEyNA==", "bodyText": "Actually yes. The bridge.getAutomowers() might need to do authentication, refresh the authentication token and queries the actual api. The message alone might not give me enough information to distinguish that... But maybe I could log the stacktrace with level debug. What do you think?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453165124", "createdAt": "2020-07-11T06:57:24Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.info(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers\", e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4NTgwNg=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE4MTQyMg==", "bodyText": "From the usability perspective the message should be meaningful by itself, so that the user don't need to read the stacktrace to tackle the problem. Also, it seems a bit unreasonable to log a stacktrace when the credentials are incorrect.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453181422", "createdAt": "2020-07-11T10:30:43Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.info(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers\", e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4NTgwNg=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg0NTkwMQ==", "bodyText": "makes sense", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453845901", "createdAt": "2020-07-13T18:26:52Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.info(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers\", e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4NTgwNg=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 80}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTIzMjk0OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMDo1Nzo1OVrOGvhjpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNjo1ODo0MVrOGwLAhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4NjA1Mw==", "bodyText": "Can this message be replaced by using the debugger or by increasing the framework's log level? See point 4 https://www.openhab.org/docs/developer/guidelines.html#f-logging", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452486053", "createdAt": "2020-07-09T20:57:59Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.info(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers\", e);\n+            }\n+        }\n+    }\n+\n+    public AutomowerBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2NTE5MA==", "bodyText": "sure", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453165190", "createdAt": "2020-07-11T06:58:41Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.info(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers\", e);\n+            }\n+        }\n+    }\n+\n+    public AutomowerBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4NjA1Mw=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 92}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTIzMzQwOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMDo1ODowNlrOGvhj5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwODowOTowN1rOGwLVEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4NjExOA==", "bodyText": "Can this message be replaced by using the debugger or by increasing the framework's log level? See point 4 https://www.openhab.org/docs/developer/guidelines.html#f-logging", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452486118", "createdAt": "2020-07-09T20:58:06Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.info(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers\", e);\n+            }\n+        }\n+    }\n+\n+    public AutomowerBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (bridge != null) {\n+            stopAutomowerBridgePolling(bridge);\n+            bridge = null;\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Initializing automower bridge handler.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE3MDQ1MA==", "bodyText": "Yes, I think I don't need it", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453170450", "createdAt": "2020-07-11T08:09:07Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.info(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers\", e);\n+            }\n+        }\n+    }\n+\n+    public AutomowerBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (bridge != null) {\n+            stopAutomowerBridgePolling(bridge);\n+            bridge = null;\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Initializing automower bridge handler.\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4NjExOA=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 101}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTIzODIzOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMDo1OTozN1rOGvhm3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxODoyNzoxNVrOGw0kgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4Njg3Ng==", "bodyText": "After the thing status is set to unknown, the framework starts to work with this Thing: handleCommand() and dispose() can be invoked (concurrently). You might want to move it to the end of the method.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452486876", "createdAt": "2020-07-09T20:59:37Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.info(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers\", e);\n+            }\n+        }\n+    }\n+\n+    public AutomowerBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (bridge != null) {\n+            stopAutomowerBridgePolling(bridge);\n+            bridge = null;\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Initializing automower bridge handler.\");\n+        bridgeConfiguration = getConfigAs(AutomowerBridgeConfiguration.class);\n+\n+        final String appKey = bridgeConfiguration.getAppKey();\n+        final String userName = bridgeConfiguration.getUserName();\n+        final String password = bridgeConfiguration.getPassword();\n+        if (appKey == null || appKey.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-app-key\");\n+        } else if (userName == null || userName.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-username\");\n+        } else if (password == null || password.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-password\");\n+        } else {\n+            updateStatus(ThingStatus.UNKNOWN);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 114}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2NTQ3NA==", "bodyText": "Is this enough to move it to the end of the method or should the handler methods be synchronized?\nBecause when multiple threads interact with the object and members might be updated from different threads I guess we would need some synchronization to ensure memory visibility accross threads?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453165474", "createdAt": "2020-07-11T07:02:38Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.info(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers\", e);\n+            }\n+        }\n+    }\n+\n+    public AutomowerBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (bridge != null) {\n+            stopAutomowerBridgePolling(bridge);\n+            bridge = null;\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Initializing automower bridge handler.\");\n+        bridgeConfiguration = getConfigAs(AutomowerBridgeConfiguration.class);\n+\n+        final String appKey = bridgeConfiguration.getAppKey();\n+        final String userName = bridgeConfiguration.getUserName();\n+        final String password = bridgeConfiguration.getPassword();\n+        if (appKey == null || appKey.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-app-key\");\n+        } else if (userName == null || userName.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-username\");\n+        } else if (password == null || password.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-password\");\n+        } else {\n+            updateStatus(ThingStatus.UNKNOWN);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4Njg3Ng=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 114}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE4MTgxMA==", "bodyText": "It's enough to move it to the end. The framework takes care of thread-safety until setting it to unknown. The handlers shouldn't be synchronized but the code within should be thread-safe. I.e. using synchronized Lists, ConcurrentHashMap etc. if they can be updated concurrently.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453181810", "createdAt": "2020-07-11T10:36:03Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.info(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers\", e);\n+            }\n+        }\n+    }\n+\n+    public AutomowerBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (bridge != null) {\n+            stopAutomowerBridgePolling(bridge);\n+            bridge = null;\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Initializing automower bridge handler.\");\n+        bridgeConfiguration = getConfigAs(AutomowerBridgeConfiguration.class);\n+\n+        final String appKey = bridgeConfiguration.getAppKey();\n+        final String userName = bridgeConfiguration.getUserName();\n+        final String password = bridgeConfiguration.getPassword();\n+        if (appKey == null || appKey.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-app-key\");\n+        } else if (userName == null || userName.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-username\");\n+        } else if (password == null || password.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-password\");\n+        } else {\n+            updateStatus(ThingStatus.UNKNOWN);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4Njg3Ng=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 114}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg0NjE0NQ==", "bodyText": "ok", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453846145", "createdAt": "2020-07-13T18:27:15Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.info(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers\", e);\n+            }\n+        }\n+    }\n+\n+    public AutomowerBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (bridge != null) {\n+            stopAutomowerBridgePolling(bridge);\n+            bridge = null;\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Initializing automower bridge handler.\");\n+        bridgeConfiguration = getConfigAs(AutomowerBridgeConfiguration.class);\n+\n+        final String appKey = bridgeConfiguration.getAppKey();\n+        final String userName = bridgeConfiguration.getUserName();\n+        final String password = bridgeConfiguration.getPassword();\n+        if (appKey == null || appKey.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-app-key\");\n+        } else if (userName == null || userName.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-username\");\n+        } else if (password == null || password.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-password\");\n+        } else {\n+            updateStatus(ThingStatus.UNKNOWN);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4Njg3Ng=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 114}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTIzOTExOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMDo1OTo1NVrOGvhncg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNzowMjo1NFrOGwLBtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4NzAyNg==", "bodyText": "Can this be removed?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452487026", "createdAt": "2020-07-09T20:59:55Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.info(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers\", e);\n+            }\n+        }\n+    }\n+\n+    public AutomowerBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (bridge != null) {\n+            stopAutomowerBridgePolling(bridge);\n+            bridge = null;\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Initializing automower bridge handler.\");\n+        bridgeConfiguration = getConfigAs(AutomowerBridgeConfiguration.class);\n+\n+        final String appKey = bridgeConfiguration.getAppKey();\n+        final String userName = bridgeConfiguration.getUserName();\n+        final String password = bridgeConfiguration.getPassword();\n+        if (appKey == null || appKey.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-app-key\");\n+        } else if (userName == null || userName.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-username\");\n+        } else if (password == null || password.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-password\");\n+        } else {\n+            updateStatus(ThingStatus.UNKNOWN);\n+            if (bridge == null) {\n+                bridge = new AutomowerBridge(appKey, userName, password, httpClient, scheduler);\n+                // bridge.setTimeout(5000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 117}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2NTQ5Mg==", "bodyText": "yes", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453165492", "createdAt": "2020-07-11T07:02:54Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.info(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers\", e);\n+            }\n+        }\n+    }\n+\n+    public AutomowerBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (bridge != null) {\n+            stopAutomowerBridgePolling(bridge);\n+            bridge = null;\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Initializing automower bridge handler.\");\n+        bridgeConfiguration = getConfigAs(AutomowerBridgeConfiguration.class);\n+\n+        final String appKey = bridgeConfiguration.getAppKey();\n+        final String userName = bridgeConfiguration.getUserName();\n+        final String password = bridgeConfiguration.getPassword();\n+        if (appKey == null || appKey.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-app-key\");\n+        } else if (userName == null || userName.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-username\");\n+        } else if (password == null || password.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-password\");\n+        } else {\n+            updateStatus(ThingStatus.UNKNOWN);\n+            if (bridge == null) {\n+                bridge = new AutomowerBridge(appKey, userName, password, httpClient, scheduler);\n+                // bridge.setTimeout(5000);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4NzAyNg=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 117}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTIzOTY0OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMTowMDowNVrOGvhnvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNzowNDozNlrOGwLCHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4NzEwMw==", "bodyText": "No harm in canceling a task that is already cancelled. Same for below.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452487103", "createdAt": "2020-07-09T21:00:05Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.info(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers\", e);\n+            }\n+        }\n+    }\n+\n+    public AutomowerBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (bridge != null) {\n+            stopAutomowerBridgePolling(bridge);\n+            bridge = null;\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Initializing automower bridge handler.\");\n+        bridgeConfiguration = getConfigAs(AutomowerBridgeConfiguration.class);\n+\n+        final String appKey = bridgeConfiguration.getAppKey();\n+        final String userName = bridgeConfiguration.getUserName();\n+        final String password = bridgeConfiguration.getPassword();\n+        if (appKey == null || appKey.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-app-key\");\n+        } else if (userName == null || userName.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-username\");\n+        } else if (password == null || password.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-password\");\n+        } else {\n+            updateStatus(ThingStatus.UNKNOWN);\n+            if (bridge == null) {\n+                bridge = new AutomowerBridge(appKey, userName, password, httpClient, scheduler);\n+                // bridge.setTimeout(5000);\n+\n+                startAutomowerBridgePolling(bridge);\n+            }\n+        }\n+    }\n+\n+    private void startAutomowerBridgePolling(AutomowerBridge bridge) {\n+        if (automowerBridgePollingJob == null || automowerBridgePollingJob.isCancelled()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 125}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2NTU5Nw==", "bodyText": "will do that", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453165597", "createdAt": "2020-07-11T07:04:36Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.info(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers\", e);\n+            }\n+        }\n+    }\n+\n+    public AutomowerBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (bridge != null) {\n+            stopAutomowerBridgePolling(bridge);\n+            bridge = null;\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Initializing automower bridge handler.\");\n+        bridgeConfiguration = getConfigAs(AutomowerBridgeConfiguration.class);\n+\n+        final String appKey = bridgeConfiguration.getAppKey();\n+        final String userName = bridgeConfiguration.getUserName();\n+        final String password = bridgeConfiguration.getPassword();\n+        if (appKey == null || appKey.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-app-key\");\n+        } else if (userName == null || userName.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-username\");\n+        } else if (password == null || password.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-password\");\n+        } else {\n+            updateStatus(ThingStatus.UNKNOWN);\n+            if (bridge == null) {\n+                bridge = new AutomowerBridge(appKey, userName, password, httpClient, scheduler);\n+                // bridge.setTimeout(5000);\n+\n+                startAutomowerBridgePolling(bridge);\n+            }\n+        }\n+    }\n+\n+    private void startAutomowerBridgePolling(AutomowerBridge bridge) {\n+        if (automowerBridgePollingJob == null || automowerBridgePollingJob.isCancelled()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4NzEwMw=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 125}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTI0NjUzOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMTowMjoyMVrOGvhr8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNzowNToxMVrOGwLCYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4ODE3Ng==", "bodyText": "You can eliminate the compiler warning by assigning the field to a local variable. See above.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452488176", "createdAt": "2020-07-09T21:02:21Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.info(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers\", e);\n+            }\n+        }\n+    }\n+\n+    public AutomowerBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (bridge != null) {\n+            stopAutomowerBridgePolling(bridge);\n+            bridge = null;\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Initializing automower bridge handler.\");\n+        bridgeConfiguration = getConfigAs(AutomowerBridgeConfiguration.class);\n+\n+        final String appKey = bridgeConfiguration.getAppKey();\n+        final String userName = bridgeConfiguration.getUserName();\n+        final String password = bridgeConfiguration.getPassword();\n+        if (appKey == null || appKey.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-app-key\");\n+        } else if (userName == null || userName.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-username\");\n+        } else if (password == null || password.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-password\");\n+        } else {\n+            updateStatus(ThingStatus.UNKNOWN);\n+            if (bridge == null) {\n+                bridge = new AutomowerBridge(appKey, userName, password, httpClient, scheduler);\n+                // bridge.setTimeout(5000);\n+\n+                startAutomowerBridgePolling(bridge);\n+            }\n+        }\n+    }\n+\n+    private void startAutomowerBridgePolling(AutomowerBridge bridge) {\n+        if (automowerBridgePollingJob == null || automowerBridgePollingJob.isCancelled()) {\n+            if (bridgeConfiguration.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);\n+            } else {\n+                automowerPollingIntervalS = bridgeConfiguration.getPollingInterval();\n+            }\n+            automowerBridgePollingJob = scheduler.scheduleWithFixedDelay(\n+                    new AutomowerBridgePollingRunnable(this, bridge), 1, automowerPollingIntervalS, TimeUnit.SECONDS);\n+        }\n+    }\n+\n+    private void stopAutomowerBridgePolling(AutomowerBridge bridge) {\n+        if (automowerBridgePollingJob != null && !automowerBridgePollingJob.isCancelled()) {\n+            automowerBridgePollingJob.cancel(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 138}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2NTY2Nw==", "bodyText": "Will do that", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453165667", "createdAt": "2020-07-11T07:05:11Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.info(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers\", e);\n+            }\n+        }\n+    }\n+\n+    public AutomowerBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (bridge != null) {\n+            stopAutomowerBridgePolling(bridge);\n+            bridge = null;\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Initializing automower bridge handler.\");\n+        bridgeConfiguration = getConfigAs(AutomowerBridgeConfiguration.class);\n+\n+        final String appKey = bridgeConfiguration.getAppKey();\n+        final String userName = bridgeConfiguration.getUserName();\n+        final String password = bridgeConfiguration.getPassword();\n+        if (appKey == null || appKey.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-app-key\");\n+        } else if (userName == null || userName.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-username\");\n+        } else if (password == null || password.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-password\");\n+        } else {\n+            updateStatus(ThingStatus.UNKNOWN);\n+            if (bridge == null) {\n+                bridge = new AutomowerBridge(appKey, userName, password, httpClient, scheduler);\n+                // bridge.setTimeout(5000);\n+\n+                startAutomowerBridgePolling(bridge);\n+            }\n+        }\n+    }\n+\n+    private void startAutomowerBridgePolling(AutomowerBridge bridge) {\n+        if (automowerBridgePollingJob == null || automowerBridgePollingJob.isCancelled()) {\n+            if (bridgeConfiguration.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);\n+            } else {\n+                automowerPollingIntervalS = bridgeConfiguration.getPollingInterval();\n+            }\n+            automowerBridgePollingJob = scheduler.scheduleWithFixedDelay(\n+                    new AutomowerBridgePollingRunnable(this, bridge), 1, automowerPollingIntervalS, TimeUnit.SECONDS);\n+        }\n+    }\n+\n+    private void stopAutomowerBridgePolling(AutomowerBridge bridge) {\n+        if (automowerBridgePollingJob != null && !automowerBridgePollingJob.isCancelled()) {\n+            automowerBridgePollingJob.cancel(true);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4ODE3Ng=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 138}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTI1MDAzOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMTowMzoxOFrOGvht3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNzowNjoxNlrOGwLCnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4ODY3MA==", "bodyText": "Catching Exception catches also all RuntimeExceptions. Better specify the concrete type.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452488670", "createdAt": "2020-07-09T21:03:18Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.info(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers\", e);\n+            }\n+        }\n+    }\n+\n+    public AutomowerBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (bridge != null) {\n+            stopAutomowerBridgePolling(bridge);\n+            bridge = null;\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Initializing automower bridge handler.\");\n+        bridgeConfiguration = getConfigAs(AutomowerBridgeConfiguration.class);\n+\n+        final String appKey = bridgeConfiguration.getAppKey();\n+        final String userName = bridgeConfiguration.getUserName();\n+        final String password = bridgeConfiguration.getPassword();\n+        if (appKey == null || appKey.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-app-key\");\n+        } else if (userName == null || userName.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-username\");\n+        } else if (password == null || password.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-password\");\n+        } else {\n+            updateStatus(ThingStatus.UNKNOWN);\n+            if (bridge == null) {\n+                bridge = new AutomowerBridge(appKey, userName, password, httpClient, scheduler);\n+                // bridge.setTimeout(5000);\n+\n+                startAutomowerBridgePolling(bridge);\n+            }\n+        }\n+    }\n+\n+    private void startAutomowerBridgePolling(AutomowerBridge bridge) {\n+        if (automowerBridgePollingJob == null || automowerBridgePollingJob.isCancelled()) {\n+            if (bridgeConfiguration.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);\n+            } else {\n+                automowerPollingIntervalS = bridgeConfiguration.getPollingInterval();\n+            }\n+            automowerBridgePollingJob = scheduler.scheduleWithFixedDelay(\n+                    new AutomowerBridgePollingRunnable(this, bridge), 1, automowerPollingIntervalS, TimeUnit.SECONDS);\n+        }\n+    }\n+\n+    private void stopAutomowerBridgePolling(AutomowerBridge bridge) {\n+        if (automowerBridgePollingJob != null && !automowerBridgePollingJob.isCancelled()) {\n+            automowerBridgePollingJob.cancel(true);\n+            automowerBridgePollingJob = null;\n+        }\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+\n+    }\n+\n+    public AutomowerBridge getAutomowerBridge() {\n+        return bridge;\n+    }\n+\n+    public Optional<MowerListResult> getAutomowers() {\n+        try {\n+            return Optional.of(bridge.getAutomowers());\n+        } catch (Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 155}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2NTcyNw==", "bodyText": "Makes sense", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453165727", "createdAt": "2020-07-11T07:06:16Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.info(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers\", e);\n+            }\n+        }\n+    }\n+\n+    public AutomowerBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (bridge != null) {\n+            stopAutomowerBridgePolling(bridge);\n+            bridge = null;\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Initializing automower bridge handler.\");\n+        bridgeConfiguration = getConfigAs(AutomowerBridgeConfiguration.class);\n+\n+        final String appKey = bridgeConfiguration.getAppKey();\n+        final String userName = bridgeConfiguration.getUserName();\n+        final String password = bridgeConfiguration.getPassword();\n+        if (appKey == null || appKey.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-app-key\");\n+        } else if (userName == null || userName.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-username\");\n+        } else if (password == null || password.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-password\");\n+        } else {\n+            updateStatus(ThingStatus.UNKNOWN);\n+            if (bridge == null) {\n+                bridge = new AutomowerBridge(appKey, userName, password, httpClient, scheduler);\n+                // bridge.setTimeout(5000);\n+\n+                startAutomowerBridgePolling(bridge);\n+            }\n+        }\n+    }\n+\n+    private void startAutomowerBridgePolling(AutomowerBridge bridge) {\n+        if (automowerBridgePollingJob == null || automowerBridgePollingJob.isCancelled()) {\n+            if (bridgeConfiguration.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);\n+            } else {\n+                automowerPollingIntervalS = bridgeConfiguration.getPollingInterval();\n+            }\n+            automowerBridgePollingJob = scheduler.scheduleWithFixedDelay(\n+                    new AutomowerBridgePollingRunnable(this, bridge), 1, automowerPollingIntervalS, TimeUnit.SECONDS);\n+        }\n+    }\n+\n+    private void stopAutomowerBridgePolling(AutomowerBridge bridge) {\n+        if (automowerBridgePollingJob != null && !automowerBridgePollingJob.isCancelled()) {\n+            automowerBridgePollingJob.cancel(true);\n+            automowerBridgePollingJob = null;\n+        }\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+\n+    }\n+\n+    public AutomowerBridge getAutomowerBridge() {\n+        return bridge;\n+    }\n+\n+    public Optional<MowerListResult> getAutomowers() {\n+        try {\n+            return Optional.of(bridge.getAutomowers());\n+        } catch (Exception e) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4ODY3MA=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 155}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTI1MzYzOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/discovery/AutomowerDiscoveryService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMTowNDozNVrOGvhwQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwODowOToyOFrOGwLVMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4OTI4Mg==", "bodyText": "Please add the NonNullByDefault annotation.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452489282", "createdAt": "2020-07-09T21:04:35Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/discovery/AutomowerDiscoveryService.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.discovery;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_AUTOMOWER;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import org.eclipse.smarthome.config.discovery.AbstractDiscoveryService;\n+import org.eclipse.smarthome.config.discovery.DiscoveryResult;\n+import org.eclipse.smarthome.config.discovery.DiscoveryResultBuilder;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.ThingUID;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+\n+/**\n+ * The {@link AutomowerDiscoveryService} is responsible for discovering new mowers available for the\n+ * configured app key.\n+ * \n+ * @author Markus Pfleger - Initial contribution\n+ */\n+public class AutomowerDiscoveryService extends AbstractDiscoveryService {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE3MDQ4MA==", "bodyText": "yes", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453170480", "createdAt": "2020-07-11T08:09:28Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/discovery/AutomowerDiscoveryService.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.discovery;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_AUTOMOWER;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import org.eclipse.smarthome.config.discovery.AbstractDiscoveryService;\n+import org.eclipse.smarthome.config.discovery.DiscoveryResult;\n+import org.eclipse.smarthome.config.discovery.DiscoveryResultBuilder;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.ThingUID;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+\n+/**\n+ * The {@link AutomowerDiscoveryService} is responsible for discovering new mowers available for the\n+ * configured app key.\n+ * \n+ * @author Markus Pfleger - Initial contribution\n+ */\n+public class AutomowerDiscoveryService extends AbstractDiscoveryService {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4OTI4Mg=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTI1NjY2OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/discovery/AutomowerDiscoveryService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMTowNTozMlrOGvhyHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNzo0OTo0NFrOGwLPSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4OTc1OA==", "bodyText": "Syntactical sugar\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (registeredMowers.isPresent()) {\n          \n          \n            \n            \n          \n          \n            \n                        for (Mower mower : registeredMowers.get().getData()) {\n          \n          \n            \n                    registeredMowers.ifPresent(mowers -> {\n          \n          \n            \n                        for (Mower mower : mowers.getData()) {", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452489758", "createdAt": "2020-07-09T21:05:32Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/discovery/AutomowerDiscoveryService.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.discovery;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_AUTOMOWER;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import org.eclipse.smarthome.config.discovery.AbstractDiscoveryService;\n+import org.eclipse.smarthome.config.discovery.DiscoveryResult;\n+import org.eclipse.smarthome.config.discovery.DiscoveryResultBuilder;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.ThingUID;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+\n+/**\n+ * The {@link AutomowerDiscoveryService} is responsible for discovering new mowers available for the\n+ * configured app key.\n+ * \n+ * @author Markus Pfleger - Initial contribution\n+ */\n+public class AutomowerDiscoveryService extends AbstractDiscoveryService {\n+\n+    private final AutomowerBridgeHandler bridgeHandler;\n+\n+    public AutomowerDiscoveryService(AutomowerBridgeHandler bridgeHandler) {\n+        super(Collections.singleton(THING_TYPE_AUTOMOWER), 10, false);\n+        this.bridgeHandler = bridgeHandler;\n+    }\n+\n+    @Override\n+    protected void startScan() {\n+        Optional<MowerListResult> registeredMowers = bridgeHandler.getAutomowers();\n+        if (registeredMowers.isPresent()) {\n+\n+            for (Mower mower : registeredMowers.get().getData()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2ODk2OA==", "bodyText": "will change it", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453168968", "createdAt": "2020-07-11T07:49:44Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/discovery/AutomowerDiscoveryService.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.discovery;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_AUTOMOWER;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import org.eclipse.smarthome.config.discovery.AbstractDiscoveryService;\n+import org.eclipse.smarthome.config.discovery.DiscoveryResult;\n+import org.eclipse.smarthome.config.discovery.DiscoveryResultBuilder;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.ThingUID;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+\n+/**\n+ * The {@link AutomowerDiscoveryService} is responsible for discovering new mowers available for the\n+ * configured app key.\n+ * \n+ * @author Markus Pfleger - Initial contribution\n+ */\n+public class AutomowerDiscoveryService extends AbstractDiscoveryService {\n+\n+    private final AutomowerBridgeHandler bridgeHandler;\n+\n+    public AutomowerDiscoveryService(AutomowerBridgeHandler bridgeHandler) {\n+        super(Collections.singleton(THING_TYPE_AUTOMOWER), 10, false);\n+        this.bridgeHandler = bridgeHandler;\n+    }\n+\n+    @Override\n+    protected void startScan() {\n+        Optional<MowerListResult> registeredMowers = bridgeHandler.getAutomowers();\n+        if (registeredMowers.isPresent()) {\n+\n+            for (Mower mower : registeredMowers.get().getData()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4OTc1OA=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTI2NDczOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/authentication/AuthenticationApi.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMTowODowNVrOGvh29Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQxMDo0Nzo1MFrOGwMFTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ5MDk5Nw==", "bodyText": "See above and below.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    } catch (Exception e) {\n          \n          \n            \n                    } catch (InterruptedException | TimeoutException | ExecutionException e) {", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452490997", "createdAt": "2020-07-09T21:08:05Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/authentication/AuthenticationApi.java", "diffHunk": "@@ -0,0 +1,119 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.rest.api.authentication;\n+\n+import org.apache.commons.httpclient.HttpStatus;\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.util.FormContentProvider;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.util.Fields;\n+import org.openhab.binding.automower.internal.rest.api.HusqvarnaApi;\n+import org.openhab.binding.automower.internal.rest.api.authentication.dto.PostOAuth2Response;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.openhab.binding.automower.internal.rest.exceptions.UnauthorizedException;\n+\n+import com.google.gson.JsonSyntaxException;\n+\n+/**\n+ * Gives access to the Husqvarna authentication api\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AuthenticationApi extends HusqvarnaApi {\n+\n+    public AuthenticationApi(HttpClient httpClient) {\n+        super(httpClient);\n+    }\n+\n+    @Override\n+    public String getBaseUrl() {\n+        return \"https://api.authentication.husqvarnagroup.dev/v1\";\n+    }\n+\n+    public PostOAuth2Response loginOAuth2(String appKey, String username, String password)\n+            throws AutomowerCommunicationException {\n+        final Request request = getHttpClient().newRequest(getBaseUrl() + \"/oauth2/token\");\n+        request.method(HttpMethod.POST);\n+\n+        Fields fields = new Fields();\n+        fields.put(\"grant_type\", \"password\");\n+        fields.put(\"client_id\", appKey);\n+        fields.put(\"username\", username);\n+        fields.put(\"password\", password);\n+\n+        request.content(new FormContentProvider(fields));\n+\n+        ContentResponse response;\n+\n+        try {\n+            response = request.send();\n+        } catch (Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE3MDcxMw==", "bodyText": "Will change that. I tried to do this to have a defined exception even when the 3rd party lib would throw something unexpected (null pointer or whatever). Probably the framework has some handling of such runtime exceptions and keeps my thing/bridge in a consistent state, so I will change that.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453170713", "createdAt": "2020-07-11T08:12:31Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/authentication/AuthenticationApi.java", "diffHunk": "@@ -0,0 +1,119 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.rest.api.authentication;\n+\n+import org.apache.commons.httpclient.HttpStatus;\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.util.FormContentProvider;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.util.Fields;\n+import org.openhab.binding.automower.internal.rest.api.HusqvarnaApi;\n+import org.openhab.binding.automower.internal.rest.api.authentication.dto.PostOAuth2Response;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.openhab.binding.automower.internal.rest.exceptions.UnauthorizedException;\n+\n+import com.google.gson.JsonSyntaxException;\n+\n+/**\n+ * Gives access to the Husqvarna authentication api\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AuthenticationApi extends HusqvarnaApi {\n+\n+    public AuthenticationApi(HttpClient httpClient) {\n+        super(httpClient);\n+    }\n+\n+    @Override\n+    public String getBaseUrl() {\n+        return \"https://api.authentication.husqvarnagroup.dev/v1\";\n+    }\n+\n+    public PostOAuth2Response loginOAuth2(String appKey, String username, String password)\n+            throws AutomowerCommunicationException {\n+        final Request request = getHttpClient().newRequest(getBaseUrl() + \"/oauth2/token\");\n+        request.method(HttpMethod.POST);\n+\n+        Fields fields = new Fields();\n+        fields.put(\"grant_type\", \"password\");\n+        fields.put(\"client_id\", appKey);\n+        fields.put(\"username\", username);\n+        fields.put(\"password\", password);\n+\n+        request.content(new FormContentProvider(fields));\n+\n+        ContentResponse response;\n+\n+        try {\n+            response = request.send();\n+        } catch (Exception e) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ5MDk5Nw=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE4Mjc5OA==", "bodyText": "The framework will log any uncatched exceptions. Since this would be a bug in you binding or a third-party lib, it's good to fail hard. The framework takes care that this doesn't affect itself or any other bindings.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453182798", "createdAt": "2020-07-11T10:47:50Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/authentication/AuthenticationApi.java", "diffHunk": "@@ -0,0 +1,119 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.rest.api.authentication;\n+\n+import org.apache.commons.httpclient.HttpStatus;\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.util.FormContentProvider;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.util.Fields;\n+import org.openhab.binding.automower.internal.rest.api.HusqvarnaApi;\n+import org.openhab.binding.automower.internal.rest.api.authentication.dto.PostOAuth2Response;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.openhab.binding.automower.internal.rest.exceptions.UnauthorizedException;\n+\n+import com.google.gson.JsonSyntaxException;\n+\n+/**\n+ * Gives access to the Husqvarna authentication api\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AuthenticationApi extends HusqvarnaApi {\n+\n+    public AuthenticationApi(HttpClient httpClient) {\n+        super(httpClient);\n+    }\n+\n+    @Override\n+    public String getBaseUrl() {\n+        return \"https://api.authentication.husqvarnagroup.dev/v1\";\n+    }\n+\n+    public PostOAuth2Response loginOAuth2(String appKey, String username, String password)\n+            throws AutomowerCommunicationException {\n+        final Request request = getHttpClient().newRequest(getBaseUrl() + \"/oauth2/token\");\n+        request.method(HttpMethod.POST);\n+\n+        Fields fields = new Fields();\n+        fields.put(\"grant_type\", \"password\");\n+        fields.put(\"client_id\", appKey);\n+        fields.put(\"username\", username);\n+        fields.put(\"password\", password);\n+\n+        request.content(new FormContentProvider(fields));\n+\n+        ContentResponse response;\n+\n+        try {\n+            response = request.send();\n+        } catch (Exception e) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ5MDk5Nw=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTI3NzcyOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/authentication/dto/PostOAuth2Response.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMToxMjoyN1rOGvh-tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNzo1MDowMlrOGwLPaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ5Mjk4Mw==", "bodyText": "Can you specify the SerializedName annotation and use camel case instead?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private String access_token;\n          \n          \n            \n                private String accessToken;", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452492983", "createdAt": "2020-07-09T21:12:27Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/authentication/dto/PostOAuth2Response.java", "diffHunk": "@@ -0,0 +1,85 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.rest.api.authentication.dto;\n+\n+/**\n+ * Authentication response\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+public class PostOAuth2Response {\n+    private String access_token;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2OTAwMw==", "bodyText": "Yes, will do that", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453169003", "createdAt": "2020-07-11T07:50:02Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/authentication/dto/PostOAuth2Response.java", "diffHunk": "@@ -0,0 +1,85 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.rest.api.authentication.dto;\n+\n+/**\n+ * Authentication response\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+public class PostOAuth2Response {\n+    private String access_token;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ5Mjk4Mw=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTI5MTY0OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMToxNjozN1rOGviG0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNzo1MDo1MVrOGwLPzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ5NTA1Ng==", "bodyText": "It's good practice to append the unit to the field name e.g. commandDurationMin", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452495056", "createdAt": "2020-07-09T21:16:37Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2OTEwMg==", "bodyText": "yes", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453169102", "createdAt": "2020-07-11T07:50:51Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ5NTA1Ng=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTI5OTIxOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMToxOToyMFrOGviLsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNzo1MToxN1rOGwLP6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ5NjMwNQ==", "bodyText": "Can you put the static final fields together?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452496305", "createdAt": "2020-07-09T21:19:20Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2OTEyOA==", "bodyText": "yes", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453169128", "createdAt": "2020-07-11T07:51:17Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ5NjMwNQ=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTMwMDEyOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMToxOTozNVrOGviMRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxODoxMDo1NVrOG5EQEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ5NjQ1Mg==", "bodyText": "See above.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452496452", "createdAt": "2020-07-09T21:19:35Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE3MDc1OQ==", "bodyText": "yes", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453170759", "createdAt": "2020-07-11T08:13:15Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ5NjQ1Mg=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ5MTY2NA==", "bodyText": "Can you change it? E.g. lastQueryTimeMs", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r462491664", "createdAt": "2020-07-29T18:10:55Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ5NjQ1Mg=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTMwNDI0OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMToyMTowMVrOGviO1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNzo1Nzo1NFrOGwLR6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ5NzExMQ==", "bodyText": "The default mentioned in the readme is 5min.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452497111", "createdAt": "2020-07-09T21:21:01Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2OTY0MA==", "bodyText": "Thx", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453169640", "createdAt": "2020-07-11T07:57:54Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ5NzExMQ=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 70}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTMxMjc5OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMToyNDowMFrOGviUFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNzo1ODozMlrOGwLSEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ5ODQ1Mw==", "bodyText": "Is this used anywhere?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452498453", "createdAt": "2020-07-09T21:24:00Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2OTY4MA==", "bodyText": "Not anymore, thx", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453169680", "createdAt": "2020-07-11T07:58:32Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ5ODQ1Mw=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 74}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTMyMzE3OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMToyNzoxM1rOGviaMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQyMToyNzoyMFrOGxl-rA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMDAxNw==", "bodyText": "Can this be removed?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452500017", "createdAt": "2020-07-09T21:27:13Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+\n+        }\n+\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        } else {\n+            sendCommand(channelUID, command);\n+        }\n+    }\n+\n+    private void sendCommand(ChannelUID channelUID, Command command) {\n+        switch (channelUID.getId()) {\n+            case CHANNEL_COMMAND_DURATION:\n+                if (command instanceof DecimalType) {\n+                    commandDuration.set(((DecimalType) command).longValue());\n+                    updateState(CHANNEL_COMMAND_DURATION, new DecimalType(commandDuration.get()));\n+                }\n+                break;\n+\n+            case CHANNEL_COMMAND:\n+                if (command instanceof StringType) {\n+                    sendAutomowerCommand(command);\n+                } else {\n+                    logger.debug(\"Received command of type {} but StringType is expected.\",\n+                            command.getClass().getName());\n+                }\n+                break;\n+\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            config = getConfigAs(AutomowerConfiguration.class);\n+\n+            final String configMowerId = config.getMowerId();\n+            if (configMowerId != null) {\n+                automowerId.set(configMowerId);\n+\n+                // bridgeHandler.registerLightStatusListener(this);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 139}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2OTc5Ng==", "bodyText": "Yes, one question. Do you know, when the bridge would go down (state offline), would the things automatically become offline as well or would i have to listen for the state of the bridge and  adapt the things state accordingly?\nBecause I would have assumed that this is framework functionality (if a thing requires a bridge for communication it would not be reachable when the bridge goes down). Other bindings seem to do this manually though...", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453169796", "createdAt": "2020-07-11T08:00:04Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+\n+        }\n+\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        } else {\n+            sendCommand(channelUID, command);\n+        }\n+    }\n+\n+    private void sendCommand(ChannelUID channelUID, Command command) {\n+        switch (channelUID.getId()) {\n+            case CHANNEL_COMMAND_DURATION:\n+                if (command instanceof DecimalType) {\n+                    commandDuration.set(((DecimalType) command).longValue());\n+                    updateState(CHANNEL_COMMAND_DURATION, new DecimalType(commandDuration.get()));\n+                }\n+                break;\n+\n+            case CHANNEL_COMMAND:\n+                if (command instanceof StringType) {\n+                    sendAutomowerCommand(command);\n+                } else {\n+                    logger.debug(\"Received command of type {} but StringType is expected.\",\n+                            command.getClass().getName());\n+                }\n+                break;\n+\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            config = getConfigAs(AutomowerConfiguration.class);\n+\n+            final String configMowerId = config.getMowerId();\n+            if (configMowerId != null) {\n+                automowerId.set(configMowerId);\n+\n+                // bridgeHandler.registerLightStatusListener(this);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMDAxNw=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 139}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE4MjE0OQ==", "bodyText": "The child Things are set to offline with the detail BRIDGE_OFFLINE, when the bridge goes offline. Setting the child Things offline is not necessary.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453182149", "createdAt": "2020-07-11T10:39:38Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+\n+        }\n+\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        } else {\n+            sendCommand(channelUID, command);\n+        }\n+    }\n+\n+    private void sendCommand(ChannelUID channelUID, Command command) {\n+        switch (channelUID.getId()) {\n+            case CHANNEL_COMMAND_DURATION:\n+                if (command instanceof DecimalType) {\n+                    commandDuration.set(((DecimalType) command).longValue());\n+                    updateState(CHANNEL_COMMAND_DURATION, new DecimalType(commandDuration.get()));\n+                }\n+                break;\n+\n+            case CHANNEL_COMMAND:\n+                if (command instanceof StringType) {\n+                    sendAutomowerCommand(command);\n+                } else {\n+                    logger.debug(\"Received command of type {} but StringType is expected.\",\n+                            command.getClass().getName());\n+                }\n+                break;\n+\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            config = getConfigAs(AutomowerConfiguration.class);\n+\n+            final String configMowerId = config.getMowerId();\n+            if (configMowerId != null) {\n+                automowerId.set(configMowerId);\n+\n+                // bridgeHandler.registerLightStatusListener(this);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMDAxNw=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 139}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY1NTY2MA==", "bodyText": "Perfect, thanks", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r454655660", "createdAt": "2020-07-14T21:27:20Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+\n+        }\n+\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        } else {\n+            sendCommand(channelUID, command);\n+        }\n+    }\n+\n+    private void sendCommand(ChannelUID channelUID, Command command) {\n+        switch (channelUID.getId()) {\n+            case CHANNEL_COMMAND_DURATION:\n+                if (command instanceof DecimalType) {\n+                    commandDuration.set(((DecimalType) command).longValue());\n+                    updateState(CHANNEL_COMMAND_DURATION, new DecimalType(commandDuration.get()));\n+                }\n+                break;\n+\n+            case CHANNEL_COMMAND:\n+                if (command instanceof StringType) {\n+                    sendAutomowerCommand(command);\n+                } else {\n+                    logger.debug(\"Received command of type {} but StringType is expected.\",\n+                            command.getClass().getName());\n+                }\n+                break;\n+\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            config = getConfigAs(AutomowerConfiguration.class);\n+\n+            final String configMowerId = config.getMowerId();\n+            if (configMowerId != null) {\n+                automowerId.set(configMowerId);\n+\n+                // bridgeHandler.registerLightStatusListener(this);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMDAxNw=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 139}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTMyNzM5OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMToyODo0OFrOGvic5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwODowMToxOFrOGwLS8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMDcwOA==", "bodyText": "See above", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452500708", "createdAt": "2020-07-09T21:28:48Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+\n+        }\n+\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        } else {\n+            sendCommand(channelUID, command);\n+        }\n+    }\n+\n+    private void sendCommand(ChannelUID channelUID, Command command) {\n+        switch (channelUID.getId()) {\n+            case CHANNEL_COMMAND_DURATION:\n+                if (command instanceof DecimalType) {\n+                    commandDuration.set(((DecimalType) command).longValue());\n+                    updateState(CHANNEL_COMMAND_DURATION, new DecimalType(commandDuration.get()));\n+                }\n+                break;\n+\n+            case CHANNEL_COMMAND:\n+                if (command instanceof StringType) {\n+                    sendAutomowerCommand(command);\n+                } else {\n+                    logger.debug(\"Received command of type {} but StringType is expected.\",\n+                            command.getClass().getName());\n+                }\n+                break;\n+\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            config = getConfigAs(AutomowerConfiguration.class);\n+\n+            final String configMowerId = config.getMowerId();\n+            if (configMowerId != null) {\n+                automowerId.set(configMowerId);\n+\n+                // bridgeHandler.registerLightStatusListener(this);\n+                startAutomowerPolling();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            }\n+\n+        } else {\n+\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 168}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2OTkwNQ==", "bodyText": "thx", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453169905", "createdAt": "2020-07-11T08:01:18Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+\n+        }\n+\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        } else {\n+            sendCommand(channelUID, command);\n+        }\n+    }\n+\n+    private void sendCommand(ChannelUID channelUID, Command command) {\n+        switch (channelUID.getId()) {\n+            case CHANNEL_COMMAND_DURATION:\n+                if (command instanceof DecimalType) {\n+                    commandDuration.set(((DecimalType) command).longValue());\n+                    updateState(CHANNEL_COMMAND_DURATION, new DecimalType(commandDuration.get()));\n+                }\n+                break;\n+\n+            case CHANNEL_COMMAND:\n+                if (command instanceof StringType) {\n+                    sendAutomowerCommand(command);\n+                } else {\n+                    logger.debug(\"Received command of type {} but StringType is expected.\",\n+                            command.getClass().getName());\n+                }\n+                break;\n+\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            config = getConfigAs(AutomowerConfiguration.class);\n+\n+            final String configMowerId = config.getMowerId();\n+            if (configMowerId != null) {\n+                automowerId.set(configMowerId);\n+\n+                // bridgeHandler.registerLightStatusListener(this);\n+                startAutomowerPolling();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            }\n+\n+        } else {\n+\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMDcwOA=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 168}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTMyNzkxOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMToyOTowMVrOGvidQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwODoxNTozNVrOGwLXDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMDgwMQ==", "bodyText": "Can this be removed?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452500801", "createdAt": "2020-07-09T21:29:01Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+\n+        }\n+\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        } else {\n+            sendCommand(channelUID, command);\n+        }\n+    }\n+\n+    private void sendCommand(ChannelUID channelUID, Command command) {\n+        switch (channelUID.getId()) {\n+            case CHANNEL_COMMAND_DURATION:\n+                if (command instanceof DecimalType) {\n+                    commandDuration.set(((DecimalType) command).longValue());\n+                    updateState(CHANNEL_COMMAND_DURATION, new DecimalType(commandDuration.get()));\n+                }\n+                break;\n+\n+            case CHANNEL_COMMAND:\n+                if (command instanceof StringType) {\n+                    sendAutomowerCommand(command);\n+                } else {\n+                    logger.debug(\"Received command of type {} but StringType is expected.\",\n+                            command.getClass().getName());\n+                }\n+                break;\n+\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            config = getConfigAs(AutomowerConfiguration.class);\n+\n+            final String configMowerId = config.getMowerId();\n+            if (configMowerId != null) {\n+                automowerId.set(configMowerId);\n+\n+                // bridgeHandler.registerLightStatusListener(this);\n+                startAutomowerPolling();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            }\n+\n+        } else {\n+\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (!automowerId.get().equals(NO_ID)) {\n+            // bridgeHandler.unregisterLightStatusListener(this);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 170}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE3MDk1Nw==", "bodyText": "yes", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453170957", "createdAt": "2020-07-11T08:15:35Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+\n+        }\n+\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        } else {\n+            sendCommand(channelUID, command);\n+        }\n+    }\n+\n+    private void sendCommand(ChannelUID channelUID, Command command) {\n+        switch (channelUID.getId()) {\n+            case CHANNEL_COMMAND_DURATION:\n+                if (command instanceof DecimalType) {\n+                    commandDuration.set(((DecimalType) command).longValue());\n+                    updateState(CHANNEL_COMMAND_DURATION, new DecimalType(commandDuration.get()));\n+                }\n+                break;\n+\n+            case CHANNEL_COMMAND:\n+                if (command instanceof StringType) {\n+                    sendAutomowerCommand(command);\n+                } else {\n+                    logger.debug(\"Received command of type {} but StringType is expected.\",\n+                            command.getClass().getName());\n+                }\n+                break;\n+\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            config = getConfigAs(AutomowerConfiguration.class);\n+\n+            final String configMowerId = config.getMowerId();\n+            if (configMowerId != null) {\n+                automowerId.set(configMowerId);\n+\n+                // bridgeHandler.registerLightStatusListener(this);\n+                startAutomowerPolling();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            }\n+\n+        } else {\n+\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (!automowerId.get().equals(NO_ID)) {\n+            // bridgeHandler.unregisterLightStatusListener(this);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMDgwMQ=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 170}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTMyODc1OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMToyOToxOFrOGviduQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwODowMzowNVrOGwLTdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMDkyMQ==", "bodyText": "See above and below: Canceling and null check", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452500921", "createdAt": "2020-07-09T21:29:18Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+\n+        }\n+\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        } else {\n+            sendCommand(channelUID, command);\n+        }\n+    }\n+\n+    private void sendCommand(ChannelUID channelUID, Command command) {\n+        switch (channelUID.getId()) {\n+            case CHANNEL_COMMAND_DURATION:\n+                if (command instanceof DecimalType) {\n+                    commandDuration.set(((DecimalType) command).longValue());\n+                    updateState(CHANNEL_COMMAND_DURATION, new DecimalType(commandDuration.get()));\n+                }\n+                break;\n+\n+            case CHANNEL_COMMAND:\n+                if (command instanceof StringType) {\n+                    sendAutomowerCommand(command);\n+                } else {\n+                    logger.debug(\"Received command of type {} but StringType is expected.\",\n+                            command.getClass().getName());\n+                }\n+                break;\n+\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            config = getConfigAs(AutomowerConfiguration.class);\n+\n+            final String configMowerId = config.getMowerId();\n+            if (configMowerId != null) {\n+                automowerId.set(configMowerId);\n+\n+                // bridgeHandler.registerLightStatusListener(this);\n+                startAutomowerPolling();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            }\n+\n+        } else {\n+\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (!automowerId.get().equals(NO_ID)) {\n+            // bridgeHandler.unregisterLightStatusListener(this);\n+            stopAutomowerPolling();\n+            automowerId.set(NO_ID);\n+        }\n+    }\n+\n+    private void startAutomowerPolling() {\n+        if (automowerPollingJob == null || automowerPollingJob.isCancelled()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 177}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE3MDAzNg==", "bodyText": "ok", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453170036", "createdAt": "2020-07-11T08:03:05Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+\n+        }\n+\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        } else {\n+            sendCommand(channelUID, command);\n+        }\n+    }\n+\n+    private void sendCommand(ChannelUID channelUID, Command command) {\n+        switch (channelUID.getId()) {\n+            case CHANNEL_COMMAND_DURATION:\n+                if (command instanceof DecimalType) {\n+                    commandDuration.set(((DecimalType) command).longValue());\n+                    updateState(CHANNEL_COMMAND_DURATION, new DecimalType(commandDuration.get()));\n+                }\n+                break;\n+\n+            case CHANNEL_COMMAND:\n+                if (command instanceof StringType) {\n+                    sendAutomowerCommand(command);\n+                } else {\n+                    logger.debug(\"Received command of type {} but StringType is expected.\",\n+                            command.getClass().getName());\n+                }\n+                break;\n+\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            config = getConfigAs(AutomowerConfiguration.class);\n+\n+            final String configMowerId = config.getMowerId();\n+            if (configMowerId != null) {\n+                automowerId.set(configMowerId);\n+\n+                // bridgeHandler.registerLightStatusListener(this);\n+                startAutomowerPolling();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            }\n+\n+        } else {\n+\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (!automowerId.get().equals(NO_ID)) {\n+            // bridgeHandler.unregisterLightStatusListener(this);\n+            stopAutomowerPolling();\n+            automowerId.set(NO_ID);\n+        }\n+    }\n+\n+    private void startAutomowerPolling() {\n+        if (automowerPollingJob == null || automowerPollingJob.isCancelled()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMDkyMQ=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 177}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTMzNTEwOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMTozMToyNFrOGvihjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwODowNDo1MVrOGwLT1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMTkwMg==", "bodyText": "mower cannot be null at this point. You could remove the null check.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (mower != null && mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n          \n          \n            \n                            && mower.getAttributes().getMetadata().isConnected()) {\n          \n          \n            \n                        return true;\n          \n          \n            \n                    }\n          \n          \n            \n                    return false;\n          \n          \n            \n                    return mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n          \n          \n            \n                            && mower.getAttributes().getMetadata().isConnected();", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452501902", "createdAt": "2020-07-09T21:31:24Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+\n+        }\n+\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        } else {\n+            sendCommand(channelUID, command);\n+        }\n+    }\n+\n+    private void sendCommand(ChannelUID channelUID, Command command) {\n+        switch (channelUID.getId()) {\n+            case CHANNEL_COMMAND_DURATION:\n+                if (command instanceof DecimalType) {\n+                    commandDuration.set(((DecimalType) command).longValue());\n+                    updateState(CHANNEL_COMMAND_DURATION, new DecimalType(commandDuration.get()));\n+                }\n+                break;\n+\n+            case CHANNEL_COMMAND:\n+                if (command instanceof StringType) {\n+                    sendAutomowerCommand(command);\n+                } else {\n+                    logger.debug(\"Received command of type {} but StringType is expected.\",\n+                            command.getClass().getName());\n+                }\n+                break;\n+\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            config = getConfigAs(AutomowerConfiguration.class);\n+\n+            final String configMowerId = config.getMowerId();\n+            if (configMowerId != null) {\n+                automowerId.set(configMowerId);\n+\n+                // bridgeHandler.registerLightStatusListener(this);\n+                startAutomowerPolling();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            }\n+\n+        } else {\n+\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (!automowerId.get().equals(NO_ID)) {\n+            // bridgeHandler.unregisterLightStatusListener(this);\n+            stopAutomowerPolling();\n+            automowerId.set(NO_ID);\n+        }\n+    }\n+\n+    private void startAutomowerPolling() {\n+        if (automowerPollingJob == null || automowerPollingJob.isCancelled()) {\n+            if (config.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);\n+            } else {\n+                automowerPollingIntervalS = config.getPollingInterval();\n+            }\n+            automowerPollingJob = scheduler.scheduleWithFixedDelay(new AutomowerPollingRunnable(), 1,\n+                    automowerPollingIntervalS, TimeUnit.SECONDS);\n+        }\n+    }\n+\n+    private void stopAutomowerPolling() {\n+        if (automowerPollingJob != null && !automowerPollingJob.isCancelled()) {\n+            automowerPollingJob.cancel(true);\n+            automowerPollingJob = null;\n+        }\n+    }\n+\n+    private boolean isValidResult(Mower mower) {\n+        return mower != null && mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getBattery() != null && mower.getAttributes().getSystem() != null;\n+    }\n+\n+    private boolean isConnected(Mower mower) {\n+        if (mower != null && mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getMetadata().isConnected()) {\n+            return true;\n+        }\n+        return false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 205}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE3MDEzNQ==", "bodyText": "thx", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453170135", "createdAt": "2020-07-11T08:04:51Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+\n+        }\n+\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        } else {\n+            sendCommand(channelUID, command);\n+        }\n+    }\n+\n+    private void sendCommand(ChannelUID channelUID, Command command) {\n+        switch (channelUID.getId()) {\n+            case CHANNEL_COMMAND_DURATION:\n+                if (command instanceof DecimalType) {\n+                    commandDuration.set(((DecimalType) command).longValue());\n+                    updateState(CHANNEL_COMMAND_DURATION, new DecimalType(commandDuration.get()));\n+                }\n+                break;\n+\n+            case CHANNEL_COMMAND:\n+                if (command instanceof StringType) {\n+                    sendAutomowerCommand(command);\n+                } else {\n+                    logger.debug(\"Received command of type {} but StringType is expected.\",\n+                            command.getClass().getName());\n+                }\n+                break;\n+\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            config = getConfigAs(AutomowerConfiguration.class);\n+\n+            final String configMowerId = config.getMowerId();\n+            if (configMowerId != null) {\n+                automowerId.set(configMowerId);\n+\n+                // bridgeHandler.registerLightStatusListener(this);\n+                startAutomowerPolling();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            }\n+\n+        } else {\n+\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (!automowerId.get().equals(NO_ID)) {\n+            // bridgeHandler.unregisterLightStatusListener(this);\n+            stopAutomowerPolling();\n+            automowerId.set(NO_ID);\n+        }\n+    }\n+\n+    private void startAutomowerPolling() {\n+        if (automowerPollingJob == null || automowerPollingJob.isCancelled()) {\n+            if (config.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);\n+            } else {\n+                automowerPollingIntervalS = config.getPollingInterval();\n+            }\n+            automowerPollingJob = scheduler.scheduleWithFixedDelay(new AutomowerPollingRunnable(), 1,\n+                    automowerPollingIntervalS, TimeUnit.SECONDS);\n+        }\n+    }\n+\n+    private void stopAutomowerPolling() {\n+        if (automowerPollingJob != null && !automowerPollingJob.isCancelled()) {\n+            automowerPollingJob.cancel(true);\n+            automowerPollingJob = null;\n+        }\n+    }\n+\n+    private boolean isValidResult(Mower mower) {\n+        return mower != null && mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getBattery() != null && mower.getAttributes().getSystem() != null;\n+    }\n+\n+    private boolean isConnected(Mower mower) {\n+        if (mower != null && mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getMetadata().isConnected()) {\n+            return true;\n+        }\n+        return false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMTkwMg=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 205}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTMzODEyOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMTozMjozMVrOGvijeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwODoxNjozMFrOGwLXZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMjM5NA==", "bodyText": "getAutomowerBridge() can return null. Better add a null check. Same for below.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452502394", "createdAt": "2020-07-09T21:32:31Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+\n+        }\n+\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        } else {\n+            sendCommand(channelUID, command);\n+        }\n+    }\n+\n+    private void sendCommand(ChannelUID channelUID, Command command) {\n+        switch (channelUID.getId()) {\n+            case CHANNEL_COMMAND_DURATION:\n+                if (command instanceof DecimalType) {\n+                    commandDuration.set(((DecimalType) command).longValue());\n+                    updateState(CHANNEL_COMMAND_DURATION, new DecimalType(commandDuration.get()));\n+                }\n+                break;\n+\n+            case CHANNEL_COMMAND:\n+                if (command instanceof StringType) {\n+                    sendAutomowerCommand(command);\n+                } else {\n+                    logger.debug(\"Received command of type {} but StringType is expected.\",\n+                            command.getClass().getName());\n+                }\n+                break;\n+\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            config = getConfigAs(AutomowerConfiguration.class);\n+\n+            final String configMowerId = config.getMowerId();\n+            if (configMowerId != null) {\n+                automowerId.set(configMowerId);\n+\n+                // bridgeHandler.registerLightStatusListener(this);\n+                startAutomowerPolling();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            }\n+\n+        } else {\n+\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (!automowerId.get().equals(NO_ID)) {\n+            // bridgeHandler.unregisterLightStatusListener(this);\n+            stopAutomowerPolling();\n+            automowerId.set(NO_ID);\n+        }\n+    }\n+\n+    private void startAutomowerPolling() {\n+        if (automowerPollingJob == null || automowerPollingJob.isCancelled()) {\n+            if (config.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);\n+            } else {\n+                automowerPollingIntervalS = config.getPollingInterval();\n+            }\n+            automowerPollingJob = scheduler.scheduleWithFixedDelay(new AutomowerPollingRunnable(), 1,\n+                    automowerPollingIntervalS, TimeUnit.SECONDS);\n+        }\n+    }\n+\n+    private void stopAutomowerPolling() {\n+        if (automowerPollingJob != null && !automowerPollingJob.isCancelled()) {\n+            automowerPollingJob.cancel(true);\n+            automowerPollingJob = null;\n+        }\n+    }\n+\n+    private boolean isValidResult(Mower mower) {\n+        return mower != null && mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getBattery() != null && mower.getAttributes().getSystem() != null;\n+    }\n+\n+    private boolean isConnected(Mower mower) {\n+        if (mower != null && mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getMetadata().isConnected()) {\n+            return true;\n+        }\n+        return false;\n+    }\n+\n+    private synchronized void updateAutomowerState() {\n+        if (System.nanoTime() - lastQueryTime > maxQueryFrequencyNanos) {\n+            lastQueryTime = System.nanoTime();\n+            String id = automowerId.get();\n+            try {\n+                Mower mower = getAutomowerBridge().getAutomowerStatus(id);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 213}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE3MTA0NQ==", "bodyText": "yes", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453171045", "createdAt": "2020-07-11T08:16:30Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+\n+        }\n+\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        } else {\n+            sendCommand(channelUID, command);\n+        }\n+    }\n+\n+    private void sendCommand(ChannelUID channelUID, Command command) {\n+        switch (channelUID.getId()) {\n+            case CHANNEL_COMMAND_DURATION:\n+                if (command instanceof DecimalType) {\n+                    commandDuration.set(((DecimalType) command).longValue());\n+                    updateState(CHANNEL_COMMAND_DURATION, new DecimalType(commandDuration.get()));\n+                }\n+                break;\n+\n+            case CHANNEL_COMMAND:\n+                if (command instanceof StringType) {\n+                    sendAutomowerCommand(command);\n+                } else {\n+                    logger.debug(\"Received command of type {} but StringType is expected.\",\n+                            command.getClass().getName());\n+                }\n+                break;\n+\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            config = getConfigAs(AutomowerConfiguration.class);\n+\n+            final String configMowerId = config.getMowerId();\n+            if (configMowerId != null) {\n+                automowerId.set(configMowerId);\n+\n+                // bridgeHandler.registerLightStatusListener(this);\n+                startAutomowerPolling();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            }\n+\n+        } else {\n+\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (!automowerId.get().equals(NO_ID)) {\n+            // bridgeHandler.unregisterLightStatusListener(this);\n+            stopAutomowerPolling();\n+            automowerId.set(NO_ID);\n+        }\n+    }\n+\n+    private void startAutomowerPolling() {\n+        if (automowerPollingJob == null || automowerPollingJob.isCancelled()) {\n+            if (config.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);\n+            } else {\n+                automowerPollingIntervalS = config.getPollingInterval();\n+            }\n+            automowerPollingJob = scheduler.scheduleWithFixedDelay(new AutomowerPollingRunnable(), 1,\n+                    automowerPollingIntervalS, TimeUnit.SECONDS);\n+        }\n+    }\n+\n+    private void stopAutomowerPolling() {\n+        if (automowerPollingJob != null && !automowerPollingJob.isCancelled()) {\n+            automowerPollingJob.cancel(true);\n+            automowerPollingJob = null;\n+        }\n+    }\n+\n+    private boolean isValidResult(Mower mower) {\n+        return mower != null && mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getBattery() != null && mower.getAttributes().getSystem() != null;\n+    }\n+\n+    private boolean isConnected(Mower mower) {\n+        if (mower != null && mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getMetadata().isConnected()) {\n+            return true;\n+        }\n+        return false;\n+    }\n+\n+    private synchronized void updateAutomowerState() {\n+        if (System.nanoTime() - lastQueryTime > maxQueryFrequencyNanos) {\n+            lastQueryTime = System.nanoTime();\n+            String id = automowerId.get();\n+            try {\n+                Mower mower = getAutomowerBridge().getAutomowerStatus(id);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMjM5NA=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 213}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTM0MDA4OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMTozMzoxNVrOGvikow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQyMToyODoyNVrOGxmAuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMjY5MQ==", "bodyText": "See above: logging stack trace", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452502691", "createdAt": "2020-07-09T21:33:15Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+\n+        }\n+\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        } else {\n+            sendCommand(channelUID, command);\n+        }\n+    }\n+\n+    private void sendCommand(ChannelUID channelUID, Command command) {\n+        switch (channelUID.getId()) {\n+            case CHANNEL_COMMAND_DURATION:\n+                if (command instanceof DecimalType) {\n+                    commandDuration.set(((DecimalType) command).longValue());\n+                    updateState(CHANNEL_COMMAND_DURATION, new DecimalType(commandDuration.get()));\n+                }\n+                break;\n+\n+            case CHANNEL_COMMAND:\n+                if (command instanceof StringType) {\n+                    sendAutomowerCommand(command);\n+                } else {\n+                    logger.debug(\"Received command of type {} but StringType is expected.\",\n+                            command.getClass().getName());\n+                }\n+                break;\n+\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            config = getConfigAs(AutomowerConfiguration.class);\n+\n+            final String configMowerId = config.getMowerId();\n+            if (configMowerId != null) {\n+                automowerId.set(configMowerId);\n+\n+                // bridgeHandler.registerLightStatusListener(this);\n+                startAutomowerPolling();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            }\n+\n+        } else {\n+\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (!automowerId.get().equals(NO_ID)) {\n+            // bridgeHandler.unregisterLightStatusListener(this);\n+            stopAutomowerPolling();\n+            automowerId.set(NO_ID);\n+        }\n+    }\n+\n+    private void startAutomowerPolling() {\n+        if (automowerPollingJob == null || automowerPollingJob.isCancelled()) {\n+            if (config.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);\n+            } else {\n+                automowerPollingIntervalS = config.getPollingInterval();\n+            }\n+            automowerPollingJob = scheduler.scheduleWithFixedDelay(new AutomowerPollingRunnable(), 1,\n+                    automowerPollingIntervalS, TimeUnit.SECONDS);\n+        }\n+    }\n+\n+    private void stopAutomowerPolling() {\n+        if (automowerPollingJob != null && !automowerPollingJob.isCancelled()) {\n+            automowerPollingJob.cancel(true);\n+            automowerPollingJob = null;\n+        }\n+    }\n+\n+    private boolean isValidResult(Mower mower) {\n+        return mower != null && mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getBattery() != null && mower.getAttributes().getSystem() != null;\n+    }\n+\n+    private boolean isConnected(Mower mower) {\n+        if (mower != null && mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getMetadata().isConnected()) {\n+            return true;\n+        }\n+        return false;\n+    }\n+\n+    private synchronized void updateAutomowerState() {\n+        if (System.nanoTime() - lastQueryTime > maxQueryFrequencyNanos) {\n+            lastQueryTime = System.nanoTime();\n+            String id = automowerId.get();\n+            try {\n+                Mower mower = getAutomowerBridge().getAutomowerStatus(id);\n+\n+                if (isValidResult(mower)) {\n+                    initializeProperties(mower);\n+\n+                    updateChannelState(mower);\n+\n+                    if (isConnected(mower)) {\n+                        updateStatus(ThingStatus.ONLINE);\n+                    } else {\n+                        updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                                \"@text/comm-error-mower-not-connected-to-cloud\");\n+                    }\n+                } else {\n+                    updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                            \"@text/comm-error-query-mower-failed\");\n+                }\n+            } catch (AutomowerCommunicationException e) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mower-failed\");\n+                logger.warn(\"Unable to query automower status for:  {}\", id, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 233}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY1NjE4NQ==", "bodyText": "ok", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r454656185", "createdAt": "2020-07-14T21:28:25Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+\n+        }\n+\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        } else {\n+            sendCommand(channelUID, command);\n+        }\n+    }\n+\n+    private void sendCommand(ChannelUID channelUID, Command command) {\n+        switch (channelUID.getId()) {\n+            case CHANNEL_COMMAND_DURATION:\n+                if (command instanceof DecimalType) {\n+                    commandDuration.set(((DecimalType) command).longValue());\n+                    updateState(CHANNEL_COMMAND_DURATION, new DecimalType(commandDuration.get()));\n+                }\n+                break;\n+\n+            case CHANNEL_COMMAND:\n+                if (command instanceof StringType) {\n+                    sendAutomowerCommand(command);\n+                } else {\n+                    logger.debug(\"Received command of type {} but StringType is expected.\",\n+                            command.getClass().getName());\n+                }\n+                break;\n+\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            config = getConfigAs(AutomowerConfiguration.class);\n+\n+            final String configMowerId = config.getMowerId();\n+            if (configMowerId != null) {\n+                automowerId.set(configMowerId);\n+\n+                // bridgeHandler.registerLightStatusListener(this);\n+                startAutomowerPolling();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            }\n+\n+        } else {\n+\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (!automowerId.get().equals(NO_ID)) {\n+            // bridgeHandler.unregisterLightStatusListener(this);\n+            stopAutomowerPolling();\n+            automowerId.set(NO_ID);\n+        }\n+    }\n+\n+    private void startAutomowerPolling() {\n+        if (automowerPollingJob == null || automowerPollingJob.isCancelled()) {\n+            if (config.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);\n+            } else {\n+                automowerPollingIntervalS = config.getPollingInterval();\n+            }\n+            automowerPollingJob = scheduler.scheduleWithFixedDelay(new AutomowerPollingRunnable(), 1,\n+                    automowerPollingIntervalS, TimeUnit.SECONDS);\n+        }\n+    }\n+\n+    private void stopAutomowerPolling() {\n+        if (automowerPollingJob != null && !automowerPollingJob.isCancelled()) {\n+            automowerPollingJob.cancel(true);\n+            automowerPollingJob = null;\n+        }\n+    }\n+\n+    private boolean isValidResult(Mower mower) {\n+        return mower != null && mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getBattery() != null && mower.getAttributes().getSystem() != null;\n+    }\n+\n+    private boolean isConnected(Mower mower) {\n+        if (mower != null && mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getMetadata().isConnected()) {\n+            return true;\n+        }\n+        return false;\n+    }\n+\n+    private synchronized void updateAutomowerState() {\n+        if (System.nanoTime() - lastQueryTime > maxQueryFrequencyNanos) {\n+            lastQueryTime = System.nanoTime();\n+            String id = automowerId.get();\n+            try {\n+                Mower mower = getAutomowerBridge().getAutomowerStatus(id);\n+\n+                if (isValidResult(mower)) {\n+                    initializeProperties(mower);\n+\n+                    updateChannelState(mower);\n+\n+                    if (isConnected(mower)) {\n+                        updateStatus(ThingStatus.ONLINE);\n+                    } else {\n+                        updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                                \"@text/comm-error-mower-not-connected-to-cloud\");\n+                    }\n+                } else {\n+                    updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                            \"@text/comm-error-query-mower-failed\");\n+                }\n+            } catch (AutomowerCommunicationException e) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mower-failed\");\n+                logger.warn(\"Unable to query automower status for:  {}\", id, e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMjY5MQ=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 233}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTM0NTU5OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMTozNToxMlrOGvin_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQyMTozMDoxOVrOGxmESg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMzU1MA==", "bodyText": "Is there a reason why you feed the result back into a Channel instead of logging it?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452503550", "createdAt": "2020-07-09T21:35:12Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+\n+        }\n+\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        } else {\n+            sendCommand(channelUID, command);\n+        }\n+    }\n+\n+    private void sendCommand(ChannelUID channelUID, Command command) {\n+        switch (channelUID.getId()) {\n+            case CHANNEL_COMMAND_DURATION:\n+                if (command instanceof DecimalType) {\n+                    commandDuration.set(((DecimalType) command).longValue());\n+                    updateState(CHANNEL_COMMAND_DURATION, new DecimalType(commandDuration.get()));\n+                }\n+                break;\n+\n+            case CHANNEL_COMMAND:\n+                if (command instanceof StringType) {\n+                    sendAutomowerCommand(command);\n+                } else {\n+                    logger.debug(\"Received command of type {} but StringType is expected.\",\n+                            command.getClass().getName());\n+                }\n+                break;\n+\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            config = getConfigAs(AutomowerConfiguration.class);\n+\n+            final String configMowerId = config.getMowerId();\n+            if (configMowerId != null) {\n+                automowerId.set(configMowerId);\n+\n+                // bridgeHandler.registerLightStatusListener(this);\n+                startAutomowerPolling();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            }\n+\n+        } else {\n+\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (!automowerId.get().equals(NO_ID)) {\n+            // bridgeHandler.unregisterLightStatusListener(this);\n+            stopAutomowerPolling();\n+            automowerId.set(NO_ID);\n+        }\n+    }\n+\n+    private void startAutomowerPolling() {\n+        if (automowerPollingJob == null || automowerPollingJob.isCancelled()) {\n+            if (config.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);\n+            } else {\n+                automowerPollingIntervalS = config.getPollingInterval();\n+            }\n+            automowerPollingJob = scheduler.scheduleWithFixedDelay(new AutomowerPollingRunnable(), 1,\n+                    automowerPollingIntervalS, TimeUnit.SECONDS);\n+        }\n+    }\n+\n+    private void stopAutomowerPolling() {\n+        if (automowerPollingJob != null && !automowerPollingJob.isCancelled()) {\n+            automowerPollingJob.cancel(true);\n+            automowerPollingJob = null;\n+        }\n+    }\n+\n+    private boolean isValidResult(Mower mower) {\n+        return mower != null && mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getBattery() != null && mower.getAttributes().getSystem() != null;\n+    }\n+\n+    private boolean isConnected(Mower mower) {\n+        if (mower != null && mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getMetadata().isConnected()) {\n+            return true;\n+        }\n+        return false;\n+    }\n+\n+    private synchronized void updateAutomowerState() {\n+        if (System.nanoTime() - lastQueryTime > maxQueryFrequencyNanos) {\n+            lastQueryTime = System.nanoTime();\n+            String id = automowerId.get();\n+            try {\n+                Mower mower = getAutomowerBridge().getAutomowerStatus(id);\n+\n+                if (isValidResult(mower)) {\n+                    initializeProperties(mower);\n+\n+                    updateChannelState(mower);\n+\n+                    if (isConnected(mower)) {\n+                        updateStatus(ThingStatus.ONLINE);\n+                    } else {\n+                        updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                                \"@text/comm-error-mower-not-connected-to-cloud\");\n+                    }\n+                } else {\n+                    updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                            \"@text/comm-error-query-mower-failed\");\n+                }\n+            } catch (AutomowerCommunicationException e) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mower-failed\");\n+                logger.warn(\"Unable to query automower status for:  {}\", id, e);\n+            }\n+        }\n+    }\n+\n+    private synchronized void sendAutomowerCommand(Command command) {\n+        String id = automowerId.get();\n+        try {\n+            if (getAutomowerBridge().sendAutomowerCommand(id, command.toString(), commandDuration.get())) {\n+                updateState(CHANNEL_COMMAND_RESPONSE,\n+                        new StringType(\"Successfully sent command \" + command.toString()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 243}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE3MTIzNg==", "bodyText": "So I can create an item where I can view the response to my command in the app... Basically you are right, it is for debugging mostly, because my command should have an affect on some other channels (mower action,...). If I send a command and nothing would change I am interested in that.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453171236", "createdAt": "2020-07-11T08:19:02Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+\n+        }\n+\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        } else {\n+            sendCommand(channelUID, command);\n+        }\n+    }\n+\n+    private void sendCommand(ChannelUID channelUID, Command command) {\n+        switch (channelUID.getId()) {\n+            case CHANNEL_COMMAND_DURATION:\n+                if (command instanceof DecimalType) {\n+                    commandDuration.set(((DecimalType) command).longValue());\n+                    updateState(CHANNEL_COMMAND_DURATION, new DecimalType(commandDuration.get()));\n+                }\n+                break;\n+\n+            case CHANNEL_COMMAND:\n+                if (command instanceof StringType) {\n+                    sendAutomowerCommand(command);\n+                } else {\n+                    logger.debug(\"Received command of type {} but StringType is expected.\",\n+                            command.getClass().getName());\n+                }\n+                break;\n+\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            config = getConfigAs(AutomowerConfiguration.class);\n+\n+            final String configMowerId = config.getMowerId();\n+            if (configMowerId != null) {\n+                automowerId.set(configMowerId);\n+\n+                // bridgeHandler.registerLightStatusListener(this);\n+                startAutomowerPolling();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            }\n+\n+        } else {\n+\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (!automowerId.get().equals(NO_ID)) {\n+            // bridgeHandler.unregisterLightStatusListener(this);\n+            stopAutomowerPolling();\n+            automowerId.set(NO_ID);\n+        }\n+    }\n+\n+    private void startAutomowerPolling() {\n+        if (automowerPollingJob == null || automowerPollingJob.isCancelled()) {\n+            if (config.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);\n+            } else {\n+                automowerPollingIntervalS = config.getPollingInterval();\n+            }\n+            automowerPollingJob = scheduler.scheduleWithFixedDelay(new AutomowerPollingRunnable(), 1,\n+                    automowerPollingIntervalS, TimeUnit.SECONDS);\n+        }\n+    }\n+\n+    private void stopAutomowerPolling() {\n+        if (automowerPollingJob != null && !automowerPollingJob.isCancelled()) {\n+            automowerPollingJob.cancel(true);\n+            automowerPollingJob = null;\n+        }\n+    }\n+\n+    private boolean isValidResult(Mower mower) {\n+        return mower != null && mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getBattery() != null && mower.getAttributes().getSystem() != null;\n+    }\n+\n+    private boolean isConnected(Mower mower) {\n+        if (mower != null && mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getMetadata().isConnected()) {\n+            return true;\n+        }\n+        return false;\n+    }\n+\n+    private synchronized void updateAutomowerState() {\n+        if (System.nanoTime() - lastQueryTime > maxQueryFrequencyNanos) {\n+            lastQueryTime = System.nanoTime();\n+            String id = automowerId.get();\n+            try {\n+                Mower mower = getAutomowerBridge().getAutomowerStatus(id);\n+\n+                if (isValidResult(mower)) {\n+                    initializeProperties(mower);\n+\n+                    updateChannelState(mower);\n+\n+                    if (isConnected(mower)) {\n+                        updateStatus(ThingStatus.ONLINE);\n+                    } else {\n+                        updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                                \"@text/comm-error-mower-not-connected-to-cloud\");\n+                    }\n+                } else {\n+                    updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                            \"@text/comm-error-query-mower-failed\");\n+                }\n+            } catch (AutomowerCommunicationException e) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mower-failed\");\n+                logger.warn(\"Unable to query automower status for:  {}\", id, e);\n+            }\n+        }\n+    }\n+\n+    private synchronized void sendAutomowerCommand(Command command) {\n+        String id = automowerId.get();\n+        try {\n+            if (getAutomowerBridge().sendAutomowerCommand(id, command.toString(), commandDuration.get())) {\n+                updateState(CHANNEL_COMMAND_RESPONSE,\n+                        new StringType(\"Successfully sent command \" + command.toString()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMzU1MA=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 243}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE4MzM5MQ==", "bodyText": "It should be logged if the command could not be executed, because of a communication problem or bug. But if this is expected to fail e.g. because the mower is in a state where the command is rejected, I don't see any better solution to feedback via a Channel.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453183391", "createdAt": "2020-07-11T10:55:51Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+\n+        }\n+\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        } else {\n+            sendCommand(channelUID, command);\n+        }\n+    }\n+\n+    private void sendCommand(ChannelUID channelUID, Command command) {\n+        switch (channelUID.getId()) {\n+            case CHANNEL_COMMAND_DURATION:\n+                if (command instanceof DecimalType) {\n+                    commandDuration.set(((DecimalType) command).longValue());\n+                    updateState(CHANNEL_COMMAND_DURATION, new DecimalType(commandDuration.get()));\n+                }\n+                break;\n+\n+            case CHANNEL_COMMAND:\n+                if (command instanceof StringType) {\n+                    sendAutomowerCommand(command);\n+                } else {\n+                    logger.debug(\"Received command of type {} but StringType is expected.\",\n+                            command.getClass().getName());\n+                }\n+                break;\n+\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            config = getConfigAs(AutomowerConfiguration.class);\n+\n+            final String configMowerId = config.getMowerId();\n+            if (configMowerId != null) {\n+                automowerId.set(configMowerId);\n+\n+                // bridgeHandler.registerLightStatusListener(this);\n+                startAutomowerPolling();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            }\n+\n+        } else {\n+\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (!automowerId.get().equals(NO_ID)) {\n+            // bridgeHandler.unregisterLightStatusListener(this);\n+            stopAutomowerPolling();\n+            automowerId.set(NO_ID);\n+        }\n+    }\n+\n+    private void startAutomowerPolling() {\n+        if (automowerPollingJob == null || automowerPollingJob.isCancelled()) {\n+            if (config.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);\n+            } else {\n+                automowerPollingIntervalS = config.getPollingInterval();\n+            }\n+            automowerPollingJob = scheduler.scheduleWithFixedDelay(new AutomowerPollingRunnable(), 1,\n+                    automowerPollingIntervalS, TimeUnit.SECONDS);\n+        }\n+    }\n+\n+    private void stopAutomowerPolling() {\n+        if (automowerPollingJob != null && !automowerPollingJob.isCancelled()) {\n+            automowerPollingJob.cancel(true);\n+            automowerPollingJob = null;\n+        }\n+    }\n+\n+    private boolean isValidResult(Mower mower) {\n+        return mower != null && mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getBattery() != null && mower.getAttributes().getSystem() != null;\n+    }\n+\n+    private boolean isConnected(Mower mower) {\n+        if (mower != null && mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getMetadata().isConnected()) {\n+            return true;\n+        }\n+        return false;\n+    }\n+\n+    private synchronized void updateAutomowerState() {\n+        if (System.nanoTime() - lastQueryTime > maxQueryFrequencyNanos) {\n+            lastQueryTime = System.nanoTime();\n+            String id = automowerId.get();\n+            try {\n+                Mower mower = getAutomowerBridge().getAutomowerStatus(id);\n+\n+                if (isValidResult(mower)) {\n+                    initializeProperties(mower);\n+\n+                    updateChannelState(mower);\n+\n+                    if (isConnected(mower)) {\n+                        updateStatus(ThingStatus.ONLINE);\n+                    } else {\n+                        updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                                \"@text/comm-error-mower-not-connected-to-cloud\");\n+                    }\n+                } else {\n+                    updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                            \"@text/comm-error-query-mower-failed\");\n+                }\n+            } catch (AutomowerCommunicationException e) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mower-failed\");\n+                logger.warn(\"Unable to query automower status for:  {}\", id, e);\n+            }\n+        }\n+    }\n+\n+    private synchronized void sendAutomowerCommand(Command command) {\n+        String id = automowerId.get();\n+        try {\n+            if (getAutomowerBridge().sendAutomowerCommand(id, command.toString(), commandDuration.get())) {\n+                updateState(CHANNEL_COMMAND_RESPONSE,\n+                        new StringType(\"Successfully sent command \" + command.toString()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMzU1MA=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 243}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY1NzA5OA==", "bodyText": "Ok, thanks. I still removed it. As I changed the whole command sending to actions instead of channels I also dropped the feedback through the channel. Usually the command will reflect in a change of the mower state, so you should see if it works.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r454657098", "createdAt": "2020-07-14T21:30:19Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+\n+        }\n+\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        } else {\n+            sendCommand(channelUID, command);\n+        }\n+    }\n+\n+    private void sendCommand(ChannelUID channelUID, Command command) {\n+        switch (channelUID.getId()) {\n+            case CHANNEL_COMMAND_DURATION:\n+                if (command instanceof DecimalType) {\n+                    commandDuration.set(((DecimalType) command).longValue());\n+                    updateState(CHANNEL_COMMAND_DURATION, new DecimalType(commandDuration.get()));\n+                }\n+                break;\n+\n+            case CHANNEL_COMMAND:\n+                if (command instanceof StringType) {\n+                    sendAutomowerCommand(command);\n+                } else {\n+                    logger.debug(\"Received command of type {} but StringType is expected.\",\n+                            command.getClass().getName());\n+                }\n+                break;\n+\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            config = getConfigAs(AutomowerConfiguration.class);\n+\n+            final String configMowerId = config.getMowerId();\n+            if (configMowerId != null) {\n+                automowerId.set(configMowerId);\n+\n+                // bridgeHandler.registerLightStatusListener(this);\n+                startAutomowerPolling();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            }\n+\n+        } else {\n+\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (!automowerId.get().equals(NO_ID)) {\n+            // bridgeHandler.unregisterLightStatusListener(this);\n+            stopAutomowerPolling();\n+            automowerId.set(NO_ID);\n+        }\n+    }\n+\n+    private void startAutomowerPolling() {\n+        if (automowerPollingJob == null || automowerPollingJob.isCancelled()) {\n+            if (config.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);\n+            } else {\n+                automowerPollingIntervalS = config.getPollingInterval();\n+            }\n+            automowerPollingJob = scheduler.scheduleWithFixedDelay(new AutomowerPollingRunnable(), 1,\n+                    automowerPollingIntervalS, TimeUnit.SECONDS);\n+        }\n+    }\n+\n+    private void stopAutomowerPolling() {\n+        if (automowerPollingJob != null && !automowerPollingJob.isCancelled()) {\n+            automowerPollingJob.cancel(true);\n+            automowerPollingJob = null;\n+        }\n+    }\n+\n+    private boolean isValidResult(Mower mower) {\n+        return mower != null && mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getBattery() != null && mower.getAttributes().getSystem() != null;\n+    }\n+\n+    private boolean isConnected(Mower mower) {\n+        if (mower != null && mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getMetadata().isConnected()) {\n+            return true;\n+        }\n+        return false;\n+    }\n+\n+    private synchronized void updateAutomowerState() {\n+        if (System.nanoTime() - lastQueryTime > maxQueryFrequencyNanos) {\n+            lastQueryTime = System.nanoTime();\n+            String id = automowerId.get();\n+            try {\n+                Mower mower = getAutomowerBridge().getAutomowerStatus(id);\n+\n+                if (isValidResult(mower)) {\n+                    initializeProperties(mower);\n+\n+                    updateChannelState(mower);\n+\n+                    if (isConnected(mower)) {\n+                        updateStatus(ThingStatus.ONLINE);\n+                    } else {\n+                        updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                                \"@text/comm-error-mower-not-connected-to-cloud\");\n+                    }\n+                } else {\n+                    updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                            \"@text/comm-error-query-mower-failed\");\n+                }\n+            } catch (AutomowerCommunicationException e) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mower-failed\");\n+                logger.warn(\"Unable to query automower status for:  {}\", id, e);\n+            }\n+        }\n+    }\n+\n+    private synchronized void sendAutomowerCommand(Command command) {\n+        String id = automowerId.get();\n+        try {\n+            if (getAutomowerBridge().sendAutomowerCommand(id, command.toString(), commandDuration.get())) {\n+                updateState(CHANNEL_COMMAND_RESPONSE,\n+                        new StringType(\"Successfully sent command \" + command.toString()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMzU1MA=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 243}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTM0NjQxOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMTozNTozMFrOGviohQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQyMTozMToxMVrOGxmGQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMzY4NQ==", "bodyText": "See above", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452503685", "createdAt": "2020-07-09T21:35:30Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+\n+        }\n+\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        } else {\n+            sendCommand(channelUID, command);\n+        }\n+    }\n+\n+    private void sendCommand(ChannelUID channelUID, Command command) {\n+        switch (channelUID.getId()) {\n+            case CHANNEL_COMMAND_DURATION:\n+                if (command instanceof DecimalType) {\n+                    commandDuration.set(((DecimalType) command).longValue());\n+                    updateState(CHANNEL_COMMAND_DURATION, new DecimalType(commandDuration.get()));\n+                }\n+                break;\n+\n+            case CHANNEL_COMMAND:\n+                if (command instanceof StringType) {\n+                    sendAutomowerCommand(command);\n+                } else {\n+                    logger.debug(\"Received command of type {} but StringType is expected.\",\n+                            command.getClass().getName());\n+                }\n+                break;\n+\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            config = getConfigAs(AutomowerConfiguration.class);\n+\n+            final String configMowerId = config.getMowerId();\n+            if (configMowerId != null) {\n+                automowerId.set(configMowerId);\n+\n+                // bridgeHandler.registerLightStatusListener(this);\n+                startAutomowerPolling();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            }\n+\n+        } else {\n+\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (!automowerId.get().equals(NO_ID)) {\n+            // bridgeHandler.unregisterLightStatusListener(this);\n+            stopAutomowerPolling();\n+            automowerId.set(NO_ID);\n+        }\n+    }\n+\n+    private void startAutomowerPolling() {\n+        if (automowerPollingJob == null || automowerPollingJob.isCancelled()) {\n+            if (config.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);\n+            } else {\n+                automowerPollingIntervalS = config.getPollingInterval();\n+            }\n+            automowerPollingJob = scheduler.scheduleWithFixedDelay(new AutomowerPollingRunnable(), 1,\n+                    automowerPollingIntervalS, TimeUnit.SECONDS);\n+        }\n+    }\n+\n+    private void stopAutomowerPolling() {\n+        if (automowerPollingJob != null && !automowerPollingJob.isCancelled()) {\n+            automowerPollingJob.cancel(true);\n+            automowerPollingJob = null;\n+        }\n+    }\n+\n+    private boolean isValidResult(Mower mower) {\n+        return mower != null && mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getBattery() != null && mower.getAttributes().getSystem() != null;\n+    }\n+\n+    private boolean isConnected(Mower mower) {\n+        if (mower != null && mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getMetadata().isConnected()) {\n+            return true;\n+        }\n+        return false;\n+    }\n+\n+    private synchronized void updateAutomowerState() {\n+        if (System.nanoTime() - lastQueryTime > maxQueryFrequencyNanos) {\n+            lastQueryTime = System.nanoTime();\n+            String id = automowerId.get();\n+            try {\n+                Mower mower = getAutomowerBridge().getAutomowerStatus(id);\n+\n+                if (isValidResult(mower)) {\n+                    initializeProperties(mower);\n+\n+                    updateChannelState(mower);\n+\n+                    if (isConnected(mower)) {\n+                        updateStatus(ThingStatus.ONLINE);\n+                    } else {\n+                        updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                                \"@text/comm-error-mower-not-connected-to-cloud\");\n+                    }\n+                } else {\n+                    updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                            \"@text/comm-error-query-mower-failed\");\n+                }\n+            } catch (AutomowerCommunicationException e) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mower-failed\");\n+                logger.warn(\"Unable to query automower status for:  {}\", id, e);\n+            }\n+        }\n+    }\n+\n+    private synchronized void sendAutomowerCommand(Command command) {\n+        String id = automowerId.get();\n+        try {\n+            if (getAutomowerBridge().sendAutomowerCommand(id, command.toString(), commandDuration.get())) {\n+                updateState(CHANNEL_COMMAND_RESPONSE,\n+                        new StringType(\"Successfully sent command \" + command.toString()));\n+            } else {\n+                updateState(CHANNEL_COMMAND_RESPONSE, new StringType(\"Unable to send command \" + command.toString()));\n+            }\n+        } catch (AutomowerCommunicationException e) {\n+            updateState(CHANNEL_COMMAND_RESPONSE,\n+                    new StringType(\"Unable to send command \" + command.toString() + \": \" + e.getMessage()));\n+\n+            logger.warn(\"Unable to send command to automower: {}\", id, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 251}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY1NzYwMA==", "bodyText": "ok", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r454657600", "createdAt": "2020-07-14T21:31:11Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+\n+        }\n+\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        } else {\n+            sendCommand(channelUID, command);\n+        }\n+    }\n+\n+    private void sendCommand(ChannelUID channelUID, Command command) {\n+        switch (channelUID.getId()) {\n+            case CHANNEL_COMMAND_DURATION:\n+                if (command instanceof DecimalType) {\n+                    commandDuration.set(((DecimalType) command).longValue());\n+                    updateState(CHANNEL_COMMAND_DURATION, new DecimalType(commandDuration.get()));\n+                }\n+                break;\n+\n+            case CHANNEL_COMMAND:\n+                if (command instanceof StringType) {\n+                    sendAutomowerCommand(command);\n+                } else {\n+                    logger.debug(\"Received command of type {} but StringType is expected.\",\n+                            command.getClass().getName());\n+                }\n+                break;\n+\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            config = getConfigAs(AutomowerConfiguration.class);\n+\n+            final String configMowerId = config.getMowerId();\n+            if (configMowerId != null) {\n+                automowerId.set(configMowerId);\n+\n+                // bridgeHandler.registerLightStatusListener(this);\n+                startAutomowerPolling();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            }\n+\n+        } else {\n+\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (!automowerId.get().equals(NO_ID)) {\n+            // bridgeHandler.unregisterLightStatusListener(this);\n+            stopAutomowerPolling();\n+            automowerId.set(NO_ID);\n+        }\n+    }\n+\n+    private void startAutomowerPolling() {\n+        if (automowerPollingJob == null || automowerPollingJob.isCancelled()) {\n+            if (config.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);\n+            } else {\n+                automowerPollingIntervalS = config.getPollingInterval();\n+            }\n+            automowerPollingJob = scheduler.scheduleWithFixedDelay(new AutomowerPollingRunnable(), 1,\n+                    automowerPollingIntervalS, TimeUnit.SECONDS);\n+        }\n+    }\n+\n+    private void stopAutomowerPolling() {\n+        if (automowerPollingJob != null && !automowerPollingJob.isCancelled()) {\n+            automowerPollingJob.cancel(true);\n+            automowerPollingJob = null;\n+        }\n+    }\n+\n+    private boolean isValidResult(Mower mower) {\n+        return mower != null && mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getBattery() != null && mower.getAttributes().getSystem() != null;\n+    }\n+\n+    private boolean isConnected(Mower mower) {\n+        if (mower != null && mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getMetadata().isConnected()) {\n+            return true;\n+        }\n+        return false;\n+    }\n+\n+    private synchronized void updateAutomowerState() {\n+        if (System.nanoTime() - lastQueryTime > maxQueryFrequencyNanos) {\n+            lastQueryTime = System.nanoTime();\n+            String id = automowerId.get();\n+            try {\n+                Mower mower = getAutomowerBridge().getAutomowerStatus(id);\n+\n+                if (isValidResult(mower)) {\n+                    initializeProperties(mower);\n+\n+                    updateChannelState(mower);\n+\n+                    if (isConnected(mower)) {\n+                        updateStatus(ThingStatus.ONLINE);\n+                    } else {\n+                        updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                                \"@text/comm-error-mower-not-connected-to-cloud\");\n+                    }\n+                } else {\n+                    updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                            \"@text/comm-error-query-mower-failed\");\n+                }\n+            } catch (AutomowerCommunicationException e) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mower-failed\");\n+                logger.warn(\"Unable to query automower status for:  {}\", id, e);\n+            }\n+        }\n+    }\n+\n+    private synchronized void sendAutomowerCommand(Command command) {\n+        String id = automowerId.get();\n+        try {\n+            if (getAutomowerBridge().sendAutomowerCommand(id, command.toString(), commandDuration.get())) {\n+                updateState(CHANNEL_COMMAND_RESPONSE,\n+                        new StringType(\"Successfully sent command \" + command.toString()));\n+            } else {\n+                updateState(CHANNEL_COMMAND_RESPONSE, new StringType(\"Unable to send command \" + command.toString()));\n+            }\n+        } catch (AutomowerCommunicationException e) {\n+            updateState(CHANNEL_COMMAND_RESPONSE,\n+                    new StringType(\"Unable to send command \" + command.toString() + \": \" + e.getMessage()));\n+\n+            logger.warn(\"Unable to send command to automower: {}\", id, e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMzY4NQ=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 251}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTM0NzAwOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMTozNTo0NlrOGvio7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwODoyMDoxNFrOGwLYmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMzc5MQ==", "bodyText": "Can this be removed?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452503791", "createdAt": "2020-07-09T21:35:46Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+\n+        }\n+\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        } else {\n+            sendCommand(channelUID, command);\n+        }\n+    }\n+\n+    private void sendCommand(ChannelUID channelUID, Command command) {\n+        switch (channelUID.getId()) {\n+            case CHANNEL_COMMAND_DURATION:\n+                if (command instanceof DecimalType) {\n+                    commandDuration.set(((DecimalType) command).longValue());\n+                    updateState(CHANNEL_COMMAND_DURATION, new DecimalType(commandDuration.get()));\n+                }\n+                break;\n+\n+            case CHANNEL_COMMAND:\n+                if (command instanceof StringType) {\n+                    sendAutomowerCommand(command);\n+                } else {\n+                    logger.debug(\"Received command of type {} but StringType is expected.\",\n+                            command.getClass().getName());\n+                }\n+                break;\n+\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            config = getConfigAs(AutomowerConfiguration.class);\n+\n+            final String configMowerId = config.getMowerId();\n+            if (configMowerId != null) {\n+                automowerId.set(configMowerId);\n+\n+                // bridgeHandler.registerLightStatusListener(this);\n+                startAutomowerPolling();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            }\n+\n+        } else {\n+\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (!automowerId.get().equals(NO_ID)) {\n+            // bridgeHandler.unregisterLightStatusListener(this);\n+            stopAutomowerPolling();\n+            automowerId.set(NO_ID);\n+        }\n+    }\n+\n+    private void startAutomowerPolling() {\n+        if (automowerPollingJob == null || automowerPollingJob.isCancelled()) {\n+            if (config.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);\n+            } else {\n+                automowerPollingIntervalS = config.getPollingInterval();\n+            }\n+            automowerPollingJob = scheduler.scheduleWithFixedDelay(new AutomowerPollingRunnable(), 1,\n+                    automowerPollingIntervalS, TimeUnit.SECONDS);\n+        }\n+    }\n+\n+    private void stopAutomowerPolling() {\n+        if (automowerPollingJob != null && !automowerPollingJob.isCancelled()) {\n+            automowerPollingJob.cancel(true);\n+            automowerPollingJob = null;\n+        }\n+    }\n+\n+    private boolean isValidResult(Mower mower) {\n+        return mower != null && mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getBattery() != null && mower.getAttributes().getSystem() != null;\n+    }\n+\n+    private boolean isConnected(Mower mower) {\n+        if (mower != null && mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getMetadata().isConnected()) {\n+            return true;\n+        }\n+        return false;\n+    }\n+\n+    private synchronized void updateAutomowerState() {\n+        if (System.nanoTime() - lastQueryTime > maxQueryFrequencyNanos) {\n+            lastQueryTime = System.nanoTime();\n+            String id = automowerId.get();\n+            try {\n+                Mower mower = getAutomowerBridge().getAutomowerStatus(id);\n+\n+                if (isValidResult(mower)) {\n+                    initializeProperties(mower);\n+\n+                    updateChannelState(mower);\n+\n+                    if (isConnected(mower)) {\n+                        updateStatus(ThingStatus.ONLINE);\n+                    } else {\n+                        updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                                \"@text/comm-error-mower-not-connected-to-cloud\");\n+                    }\n+                } else {\n+                    updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                            \"@text/comm-error-query-mower-failed\");\n+                }\n+            } catch (AutomowerCommunicationException e) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mower-failed\");\n+                logger.warn(\"Unable to query automower status for:  {}\", id, e);\n+            }\n+        }\n+    }\n+\n+    private synchronized void sendAutomowerCommand(Command command) {\n+        String id = automowerId.get();\n+        try {\n+            if (getAutomowerBridge().sendAutomowerCommand(id, command.toString(), commandDuration.get())) {\n+                updateState(CHANNEL_COMMAND_RESPONSE,\n+                        new StringType(\"Successfully sent command \" + command.toString()));\n+            } else {\n+                updateState(CHANNEL_COMMAND_RESPONSE, new StringType(\"Unable to send command \" + command.toString()));\n+            }\n+        } catch (AutomowerCommunicationException e) {\n+            updateState(CHANNEL_COMMAND_RESPONSE,\n+                    new StringType(\"Unable to send command \" + command.toString() + \": \" + e.getMessage()));\n+\n+            logger.warn(\"Unable to send command to automower: {}\", id, e);\n+        }\n+\n+        updateAutomowerState();\n+    }\n+\n+    private void updateChannelState(Mower mower) {\n+        if (isValidResult(mower)) {\n+            /*\n+             * if (info.getError() != null) {\n+             * updateErrorInfo(info.getError());\n+             * refreshLastErrorInfo();\n+             * } else {\n+             * clearErrorInfo();\n+             * }\n+             */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 266}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE3MTM1NQ==", "bodyText": "yes", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453171355", "createdAt": "2020-07-11T08:20:14Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+\n+        }\n+\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        } else {\n+            sendCommand(channelUID, command);\n+        }\n+    }\n+\n+    private void sendCommand(ChannelUID channelUID, Command command) {\n+        switch (channelUID.getId()) {\n+            case CHANNEL_COMMAND_DURATION:\n+                if (command instanceof DecimalType) {\n+                    commandDuration.set(((DecimalType) command).longValue());\n+                    updateState(CHANNEL_COMMAND_DURATION, new DecimalType(commandDuration.get()));\n+                }\n+                break;\n+\n+            case CHANNEL_COMMAND:\n+                if (command instanceof StringType) {\n+                    sendAutomowerCommand(command);\n+                } else {\n+                    logger.debug(\"Received command of type {} but StringType is expected.\",\n+                            command.getClass().getName());\n+                }\n+                break;\n+\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            config = getConfigAs(AutomowerConfiguration.class);\n+\n+            final String configMowerId = config.getMowerId();\n+            if (configMowerId != null) {\n+                automowerId.set(configMowerId);\n+\n+                // bridgeHandler.registerLightStatusListener(this);\n+                startAutomowerPolling();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            }\n+\n+        } else {\n+\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (!automowerId.get().equals(NO_ID)) {\n+            // bridgeHandler.unregisterLightStatusListener(this);\n+            stopAutomowerPolling();\n+            automowerId.set(NO_ID);\n+        }\n+    }\n+\n+    private void startAutomowerPolling() {\n+        if (automowerPollingJob == null || automowerPollingJob.isCancelled()) {\n+            if (config.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);\n+            } else {\n+                automowerPollingIntervalS = config.getPollingInterval();\n+            }\n+            automowerPollingJob = scheduler.scheduleWithFixedDelay(new AutomowerPollingRunnable(), 1,\n+                    automowerPollingIntervalS, TimeUnit.SECONDS);\n+        }\n+    }\n+\n+    private void stopAutomowerPolling() {\n+        if (automowerPollingJob != null && !automowerPollingJob.isCancelled()) {\n+            automowerPollingJob.cancel(true);\n+            automowerPollingJob = null;\n+        }\n+    }\n+\n+    private boolean isValidResult(Mower mower) {\n+        return mower != null && mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getBattery() != null && mower.getAttributes().getSystem() != null;\n+    }\n+\n+    private boolean isConnected(Mower mower) {\n+        if (mower != null && mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getMetadata().isConnected()) {\n+            return true;\n+        }\n+        return false;\n+    }\n+\n+    private synchronized void updateAutomowerState() {\n+        if (System.nanoTime() - lastQueryTime > maxQueryFrequencyNanos) {\n+            lastQueryTime = System.nanoTime();\n+            String id = automowerId.get();\n+            try {\n+                Mower mower = getAutomowerBridge().getAutomowerStatus(id);\n+\n+                if (isValidResult(mower)) {\n+                    initializeProperties(mower);\n+\n+                    updateChannelState(mower);\n+\n+                    if (isConnected(mower)) {\n+                        updateStatus(ThingStatus.ONLINE);\n+                    } else {\n+                        updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                                \"@text/comm-error-mower-not-connected-to-cloud\");\n+                    }\n+                } else {\n+                    updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                            \"@text/comm-error-query-mower-failed\");\n+                }\n+            } catch (AutomowerCommunicationException e) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mower-failed\");\n+                logger.warn(\"Unable to query automower status for:  {}\", id, e);\n+            }\n+        }\n+    }\n+\n+    private synchronized void sendAutomowerCommand(Command command) {\n+        String id = automowerId.get();\n+        try {\n+            if (getAutomowerBridge().sendAutomowerCommand(id, command.toString(), commandDuration.get())) {\n+                updateState(CHANNEL_COMMAND_RESPONSE,\n+                        new StringType(\"Successfully sent command \" + command.toString()));\n+            } else {\n+                updateState(CHANNEL_COMMAND_RESPONSE, new StringType(\"Unable to send command \" + command.toString()));\n+            }\n+        } catch (AutomowerCommunicationException e) {\n+            updateState(CHANNEL_COMMAND_RESPONSE,\n+                    new StringType(\"Unable to send command \" + command.toString() + \": \" + e.getMessage()));\n+\n+            logger.warn(\"Unable to send command to automower: {}\", id, e);\n+        }\n+\n+        updateAutomowerState();\n+    }\n+\n+    private void updateChannelState(Mower mower) {\n+        if (isValidResult(mower)) {\n+            /*\n+             * if (info.getError() != null) {\n+             * updateErrorInfo(info.getError());\n+             * refreshLastErrorInfo();\n+             * } else {\n+             * clearErrorInfo();\n+             * }\n+             */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMzc5MQ=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 266}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTM1MTc3OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/i18n/automower.properties", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMTozNzozNFrOGvir7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQyMTozMTo1M1rOGxmHew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwNDU1Nw==", "bodyText": "Can this be removed?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452504557", "createdAt": "2020-07-09T21:37:34Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/i18n/automower.properties", "diffHunk": "@@ -0,0 +1,46 @@\n+# FIXME: please substitute the xx_XX with a proper locale, ie. de_DE\n+# FIXME: please do not add the file to the repo if you add or change no content", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY1NzkxNQ==", "bodyText": "yes", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r454657915", "createdAt": "2020-07-14T21:31:53Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/i18n/automower.properties", "diffHunk": "@@ -0,0 +1,46 @@\n+# FIXME: please substitute the xx_XX with a proper locale, ie. de_DE\n+# FIXME: please do not add the file to the repo if you add or change no content", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwNDU1Nw=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTM1Mjk2OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/i18n/automower.properties", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMTozNzo1N1rOGvisnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxODoxNzoyMlrOG5EfUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwNDczMg==", "bodyText": "Can this be removed?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452504732", "createdAt": "2020-07-09T21:37:57Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/i18n/automower.properties", "diffHunk": "@@ -0,0 +1,46 @@\n+# FIXME: please substitute the xx_XX with a proper locale, ie. de_DE\n+# FIXME: please do not add the file to the repo if you add or change no content\n+# binding\n+binding.automower.name = Automower\n+binding.automower.description = This binding allows to interact with Husqvarna Automower robots\n+\n+\n+# automower parameters    \n+thing-type.config.automower.automower.mowerId.label = ID\n+thing-type.config.automower.automower.mowerName.label = Name\n+thing-type.config.automower.automower.mowerModel.label = Model\n+thing-type.config.automower.automower.mowerId.mowerSerialNumber = Serial Number\n+thing-type.config.automower.automower.connected.label = Connected\n+thing-type.config.automower.automower.timestamp.label = Last State Update\n+thing-type.config.automower.automower.batteryPct.label = Battery Percentage\n+\n+\n+# thing type config description\n+thing-type.config.automower.sample.config1.label = <Your localized config parameter label>\n+thing-type.config.automower.sample.config1.description = <Your localized config parameter description>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY1Nzc1MQ==", "bodyText": "sure", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r454657751", "createdAt": "2020-07-14T21:31:32Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/i18n/automower.properties", "diffHunk": "@@ -0,0 +1,46 @@\n+# FIXME: please substitute the xx_XX with a proper locale, ie. de_DE\n+# FIXME: please do not add the file to the repo if you add or change no content\n+# binding\n+binding.automower.name = Automower\n+binding.automower.description = This binding allows to interact with Husqvarna Automower robots\n+\n+\n+# automower parameters    \n+thing-type.config.automower.automower.mowerId.label = ID\n+thing-type.config.automower.automower.mowerName.label = Name\n+thing-type.config.automower.automower.mowerModel.label = Model\n+thing-type.config.automower.automower.mowerId.mowerSerialNumber = Serial Number\n+thing-type.config.automower.automower.connected.label = Connected\n+thing-type.config.automower.automower.timestamp.label = Last State Update\n+thing-type.config.automower.automower.batteryPct.label = Battery Percentage\n+\n+\n+# thing type config description\n+thing-type.config.automower.sample.config1.label = <Your localized config parameter label>\n+thing-type.config.automower.sample.config1.description = <Your localized config parameter description>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwNDczMg=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ5NTU2OA==", "bodyText": "Are you going to remove it?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r462495568", "createdAt": "2020-07-29T18:17:22Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/i18n/automower.properties", "diffHunk": "@@ -0,0 +1,46 @@\n+# FIXME: please substitute the xx_XX with a proper locale, ie. de_DE\n+# FIXME: please do not add the file to the repo if you add or change no content\n+# binding\n+binding.automower.name = Automower\n+binding.automower.description = This binding allows to interact with Husqvarna Automower robots\n+\n+\n+# automower parameters    \n+thing-type.config.automower.automower.mowerId.label = ID\n+thing-type.config.automower.automower.mowerName.label = Name\n+thing-type.config.automower.automower.mowerModel.label = Model\n+thing-type.config.automower.automower.mowerId.mowerSerialNumber = Serial Number\n+thing-type.config.automower.automower.connected.label = Connected\n+thing-type.config.automower.automower.timestamp.label = Last State Update\n+thing-type.config.automower.automower.batteryPct.label = Battery Percentage\n+\n+\n+# thing type config description\n+thing-type.config.automower.sample.config1.label = <Your localized config parameter label>\n+thing-type.config.automower.sample.config1.description = <Your localized config parameter description>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwNDczMg=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTM1OTgxOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/i18n/automower_de.properties", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMTo0MDozNlrOGviwxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwODoyMTo1OVrOGwLZMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwNTc5Ng==", "bodyText": "You might want to add the default value.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452505796", "createdAt": "2020-07-09T21:40:36Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/i18n/automower_de.properties", "diffHunk": "@@ -0,0 +1,28 @@\n+binding.automower.name = Automower Binding\n+binding.automower.description = Das Automower Binding erlaubt die Interaktion mit Husqvarna Automower M\ufffdhrobotern mit Automower Connect Unterst\ufffdtzung.\n+\n+thing-type.automower.bridge.label = Automower Connect Bridge\n+thing-type.automower.bridge.description = Erlaubt die Kommunikation mit der Husqvarna Automower Connect API\n+\n+thing-type.config.automower.bridge.appKey.label = Application Key\n+thing-type.config.automower.bridge.appKey.description = Der Application Key wird f\ufffdr die Kommunication mit der Automower Connect API ben\ufffdtigt. Um diesen zu erhalten muss eine Anwendung auf der Husqvarna Website registriert werden. Diese Anwendung muss mit der \"Authentication API\" und der \"Automower Connect API\" verkn\ufffdpft werden.\n+\n+thing-type.config.automower.bridge.userName.label = Benutzername\n+thing-type.config.automower.bridge.userName.description = Der Benutzername f\ufffdr den der Application Key ausgestellt wurde.\n+\n+thing-type.config.automower.bridge.password.label = Passwort\n+thing-type.config.automower.bridge.password.description = Das Passwort f\ufffdr den angegebenen Benutzer.\n+\n+thing-type.config.automower.bridge.pollingInterval.label = Polling Intervall\n+thing-type.config.automower.bridge.pollingInterval.description = Das Intervall in dem die Verbindung mit dem Automower Connect API \ufffdberpr\ufffdft werden soll", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE3MTUwNg==", "bodyText": "yes", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453171506", "createdAt": "2020-07-11T08:21:59Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/i18n/automower_de.properties", "diffHunk": "@@ -0,0 +1,28 @@\n+binding.automower.name = Automower Binding\n+binding.automower.description = Das Automower Binding erlaubt die Interaktion mit Husqvarna Automower M\ufffdhrobotern mit Automower Connect Unterst\ufffdtzung.\n+\n+thing-type.automower.bridge.label = Automower Connect Bridge\n+thing-type.automower.bridge.description = Erlaubt die Kommunikation mit der Husqvarna Automower Connect API\n+\n+thing-type.config.automower.bridge.appKey.label = Application Key\n+thing-type.config.automower.bridge.appKey.description = Der Application Key wird f\ufffdr die Kommunication mit der Automower Connect API ben\ufffdtigt. Um diesen zu erhalten muss eine Anwendung auf der Husqvarna Website registriert werden. Diese Anwendung muss mit der \"Authentication API\" und der \"Automower Connect API\" verkn\ufffdpft werden.\n+\n+thing-type.config.automower.bridge.userName.label = Benutzername\n+thing-type.config.automower.bridge.userName.description = Der Benutzername f\ufffdr den der Application Key ausgestellt wurde.\n+\n+thing-type.config.automower.bridge.password.label = Passwort\n+thing-type.config.automower.bridge.password.description = Das Passwort f\ufffdr den angegebenen Benutzer.\n+\n+thing-type.config.automower.bridge.pollingInterval.label = Polling Intervall\n+thing-type.config.automower.bridge.pollingInterval.description = Das Intervall in dem die Verbindung mit dem Automower Connect API \ufffdberpr\ufffdft werden soll", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwNTc5Ng=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTM2MjA1OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/i18n/automower_de.properties", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMTo0MTozMVrOGviyMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwODoyMjozMFrOGwLZUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwNjE2MQ==", "bodyText": "The unit is defined via the XML file and displayed separately in the UI. So, it can be removed here.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452506161", "createdAt": "2020-07-09T21:41:31Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/i18n/automower_de.properties", "diffHunk": "@@ -0,0 +1,28 @@\n+binding.automower.name = Automower Binding\n+binding.automower.description = Das Automower Binding erlaubt die Interaktion mit Husqvarna Automower M\ufffdhrobotern mit Automower Connect Unterst\ufffdtzung.\n+\n+thing-type.automower.bridge.label = Automower Connect Bridge\n+thing-type.automower.bridge.description = Erlaubt die Kommunikation mit der Husqvarna Automower Connect API\n+\n+thing-type.config.automower.bridge.appKey.label = Application Key\n+thing-type.config.automower.bridge.appKey.description = Der Application Key wird f\ufffdr die Kommunication mit der Automower Connect API ben\ufffdtigt. Um diesen zu erhalten muss eine Anwendung auf der Husqvarna Website registriert werden. Diese Anwendung muss mit der \"Authentication API\" und der \"Automower Connect API\" verkn\ufffdpft werden.\n+\n+thing-type.config.automower.bridge.userName.label = Benutzername\n+thing-type.config.automower.bridge.userName.description = Der Benutzername f\ufffdr den der Application Key ausgestellt wurde.\n+\n+thing-type.config.automower.bridge.password.label = Passwort\n+thing-type.config.automower.bridge.password.description = Das Passwort f\ufffdr den angegebenen Benutzer.\n+\n+thing-type.config.automower.bridge.pollingInterval.label = Polling Intervall\n+thing-type.config.automower.bridge.pollingInterval.description = Das Intervall in dem die Verbindung mit dem Automower Connect API \ufffdberpr\ufffdft werden soll\n+\n+\n+thing-type.automower.automower.label = Automower\n+thing-type.automower.automower.description = Ein Husqvarna Automower\n+\n+thing-type.config.automower.automower.mowerId.label = Automower Id\n+thing-type.config.automower.automower.mowerId.label = Die interne ID des Automowers die von der Automower Connect API benutzt wird um einen Automower zu identifizieren\n+\n+thing-type.config.automower.automower.pollingInterval.label = Polling Intervall\n+thing-type.config.automower.automower.pollingInterval.label = Das Intervall in dem der Status des Automowers abgefragt werden soll (in Sekunden). Der Standardwert ist 300s (5min) ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE3MTUzNw==", "bodyText": "ok", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453171537", "createdAt": "2020-07-11T08:22:30Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/i18n/automower_de.properties", "diffHunk": "@@ -0,0 +1,28 @@\n+binding.automower.name = Automower Binding\n+binding.automower.description = Das Automower Binding erlaubt die Interaktion mit Husqvarna Automower M\ufffdhrobotern mit Automower Connect Unterst\ufffdtzung.\n+\n+thing-type.automower.bridge.label = Automower Connect Bridge\n+thing-type.automower.bridge.description = Erlaubt die Kommunikation mit der Husqvarna Automower Connect API\n+\n+thing-type.config.automower.bridge.appKey.label = Application Key\n+thing-type.config.automower.bridge.appKey.description = Der Application Key wird f\ufffdr die Kommunication mit der Automower Connect API ben\ufffdtigt. Um diesen zu erhalten muss eine Anwendung auf der Husqvarna Website registriert werden. Diese Anwendung muss mit der \"Authentication API\" und der \"Automower Connect API\" verkn\ufffdpft werden.\n+\n+thing-type.config.automower.bridge.userName.label = Benutzername\n+thing-type.config.automower.bridge.userName.description = Der Benutzername f\ufffdr den der Application Key ausgestellt wurde.\n+\n+thing-type.config.automower.bridge.password.label = Passwort\n+thing-type.config.automower.bridge.password.description = Das Passwort f\ufffdr den angegebenen Benutzer.\n+\n+thing-type.config.automower.bridge.pollingInterval.label = Polling Intervall\n+thing-type.config.automower.bridge.pollingInterval.description = Das Intervall in dem die Verbindung mit dem Automower Connect API \ufffdberpr\ufffdft werden soll\n+\n+\n+thing-type.automower.automower.label = Automower\n+thing-type.automower.automower.description = Ein Husqvarna Automower\n+\n+thing-type.config.automower.automower.mowerId.label = Automower Id\n+thing-type.config.automower.automower.mowerId.label = Die interne ID des Automowers die von der Automower Connect API benutzt wird um einen Automower zu identifizieren\n+\n+thing-type.config.automower.automower.pollingInterval.label = Polling Intervall\n+thing-type.config.automower.automower.pollingInterval.label = Das Intervall in dem der Status des Automowers abgefragt werden soll (in Sekunden). Der Standardwert ist 300s (5min) ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwNjE2MQ=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTM2MzMwOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/thing/thing-types.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMTo0MjowMVrOGviy_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwODoyMjo1NlrOGwLZeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwNjM2Nw==", "bodyText": "Words in labels should be capitalized. See https://www.openhab.org/docs/developer/bindings/thing-xml.html#formatting-labels-and-descriptions", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452506367", "createdAt": "2020-07-09T21:42:01Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -0,0 +1,193 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"automower\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<!-- Automower Bridge Thing Type -->\n+\t<bridge-type id=\"bridge\">\n+\t\t<label>Automower Connect Bridge</label>\n+\t\t<description>The bridge to communicate with the Automower Connect API</description>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"appKey\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Application Key</label>\n+\t\t\t\t<description>The Application Key is required to communication with the Automower Connect Api. It can be obtained by registering an Application on the Husqvarna Website. This application also needs to be connected to the \"Authentication API\" and the \"Automower Connect API\"</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"userName\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>User name</label>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE3MTU3Ng==", "bodyText": "ok", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453171576", "createdAt": "2020-07-11T08:22:56Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -0,0 +1,193 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"automower\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<!-- Automower Bridge Thing Type -->\n+\t<bridge-type id=\"bridge\">\n+\t\t<label>Automower Connect Bridge</label>\n+\t\t<description>The bridge to communicate with the Automower Connect API</description>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"appKey\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Application Key</label>\n+\t\t\t\t<description>The Application Key is required to communication with the Automower Connect Api. It can be obtained by registering an Application on the Husqvarna Website. This application also needs to be connected to the \"Authentication API\" and the \"Automower Connect API\"</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"userName\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>User name</label>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwNjM2Nw=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTM2NTMzOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/thing/thing-types.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMTo0Mjo0MlrOGvi0Hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQyMTozMjozMVrOGxmIiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwNjY1NA==", "bodyText": "You could add <context>password</context> to hide the password in the UI.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452506654", "createdAt": "2020-07-09T21:42:42Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -0,0 +1,193 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"automower\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<!-- Automower Bridge Thing Type -->\n+\t<bridge-type id=\"bridge\">\n+\t\t<label>Automower Connect Bridge</label>\n+\t\t<description>The bridge to communicate with the Automower Connect API</description>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"appKey\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Application Key</label>\n+\t\t\t\t<description>The Application Key is required to communication with the Automower Connect Api. It can be obtained by registering an Application on the Husqvarna Website. This application also needs to be connected to the \"Authentication API\" and the \"Automower Connect API\"</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"userName\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>User name</label>\n+\t\t\t\t<description>The user name for which the application key has been issued</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"password\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Password</label>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY1ODE4NQ==", "bodyText": "perfect, thanks", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r454658185", "createdAt": "2020-07-14T21:32:31Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -0,0 +1,193 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"automower\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<!-- Automower Bridge Thing Type -->\n+\t<bridge-type id=\"bridge\">\n+\t\t<label>Automower Connect Bridge</label>\n+\t\t<description>The bridge to communicate with the Automower Connect API</description>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"appKey\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Application Key</label>\n+\t\t\t\t<description>The Application Key is required to communication with the Automower Connect Api. It can be obtained by registering an Application on the Husqvarna Website. This application also needs to be connected to the \"Authentication API\" and the \"Automower Connect API\"</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"userName\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>User name</label>\n+\t\t\t\t<description>The user name for which the application key has been issued</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"password\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Password</label>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwNjY1NA=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTM2NjU4OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/thing/thing-types.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMTo0MzoxM1rOGvi06A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwODoyNDoyN1rOGwLZ3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwNjg1Ng==", "bodyText": "You might want to add the unit, min/max values and <default>3600</default>.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t<parameter name=\"pollingInterval\" type=\"integer\" required=\"false\">\n          \n          \n            \n            \t\t\t<parameter name=\"pollingInterval\" type=\"integer\" required=\"false\" unit=\"s\" min=\"10\">", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452506856", "createdAt": "2020-07-09T21:43:13Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -0,0 +1,193 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"automower\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<!-- Automower Bridge Thing Type -->\n+\t<bridge-type id=\"bridge\">\n+\t\t<label>Automower Connect Bridge</label>\n+\t\t<description>The bridge to communicate with the Automower Connect API</description>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"appKey\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Application Key</label>\n+\t\t\t\t<description>The Application Key is required to communication with the Automower Connect Api. It can be obtained by registering an Application on the Husqvarna Website. This application also needs to be connected to the \"Authentication API\" and the \"Automower Connect API\"</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"userName\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>User name</label>\n+\t\t\t\t<description>The user name for which the application key has been issued</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"password\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Password</label>\n+\t\t\t\t<description>The password for the given user</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"pollingInterval\" type=\"integer\" required=\"false\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE3MTY3OQ==", "bodyText": "yes", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453171679", "createdAt": "2020-07-11T08:24:27Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -0,0 +1,193 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"automower\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<!-- Automower Bridge Thing Type -->\n+\t<bridge-type id=\"bridge\">\n+\t\t<label>Automower Connect Bridge</label>\n+\t\t<description>The bridge to communicate with the Automower Connect API</description>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"appKey\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Application Key</label>\n+\t\t\t\t<description>The Application Key is required to communication with the Automower Connect Api. It can be obtained by registering an Application on the Husqvarna Website. This application also needs to be connected to the \"Authentication API\" and the \"Automower Connect API\"</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"userName\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>User name</label>\n+\t\t\t\t<description>The user name for which the application key has been issued</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"password\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Password</label>\n+\t\t\t\t<description>The password for the given user</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"pollingInterval\" type=\"integer\" required=\"false\">", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwNjg1Ng=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTM3MDIwOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/thing/thing-types.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMTo0NDoxMVrOGvi23g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwODoyNDozNFrOGwLZ5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwNzM1OA==", "bodyText": "See above", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452507358", "createdAt": "2020-07-09T21:44:11Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -0,0 +1,193 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"automower\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<!-- Automower Bridge Thing Type -->\n+\t<bridge-type id=\"bridge\">\n+\t\t<label>Automower Connect Bridge</label>\n+\t\t<description>The bridge to communicate with the Automower Connect API</description>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"appKey\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Application Key</label>\n+\t\t\t\t<description>The Application Key is required to communication with the Automower Connect Api. It can be obtained by registering an Application on the Husqvarna Website. This application also needs to be connected to the \"Authentication API\" and the \"Automower Connect API\"</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"userName\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>User name</label>\n+\t\t\t\t<description>The user name for which the application key has been issued</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"password\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Password</label>\n+\t\t\t\t<description>The password for the given user</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"pollingInterval\" type=\"integer\" required=\"false\">\n+\t\t\t\t<label>Polling Interval</label>\n+\t\t\t\t<description>How often the available automowers should be queried in seconds. Default is 1h (3600s)</description>\n+\t\t\t</parameter>\n+\t\t</config-description>\n+\n+\t</bridge-type>\n+\n+\t<!-- Automower Thing Type -->\n+\t<thing-type id=\"automower\">\n+\t\t<label>Automower</label>\n+\t\t<description>An automatic lawn mower</description>\n+\n+\t\t<channels>\n+\t\t\t<channel id=\"name\" typeId=\"nameType\" />\n+\t\t\t<channel id=\"mode\" typeId=\"modeType\" />\n+\t\t\t<channel id=\"activity\" typeId=\"activityType\" />\n+\t\t\t<channel id=\"state\" typeId=\"stateType\" />\n+\t\t\t<channel id=\"last-update\" typeId=\"lastUpdateType\" />\n+\t\t\t<channel id=\"battery\" typeId=\"batteryType\" />\n+\t\t\t<channel id=\"error-code\" typeId=\"errorCodeType\" />\n+\t\t\t<channel id=\"error-timestamp\" typeId=\"errorTimestampType\" />\n+\n+\t\t\t<channel id=\"command\" typeId=\"commandType\" />\n+\t\t\t<channel id=\"command-duration\" typeId=\"commandDurationType\" />\n+\t\t\t<channel id=\"command-response\" typeId=\"commandResponseType\" />\n+\t\t</channels>\n+\n+\t\t<properties>\n+\t\t\t<property name=\"mowerId\">N/A</property>\n+\t\t\t<property name=\"mowerName\">N/A</property>\n+\t\t\t<property name=\"mowerModel\">N/A</property>\n+\t\t\t<property name=\"mowerSerialNumber\">N/A</property>\n+\t\t</properties>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"mowerId\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Automower Id</label>\n+\t\t\t\t<description>The Id of an automower as used by the Automower Connect Api to identify a mower</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"pollingInterval\" type=\"integer\" required=\"false\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE3MTY4NA==", "bodyText": "ok", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453171684", "createdAt": "2020-07-11T08:24:34Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -0,0 +1,193 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"automower\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<!-- Automower Bridge Thing Type -->\n+\t<bridge-type id=\"bridge\">\n+\t\t<label>Automower Connect Bridge</label>\n+\t\t<description>The bridge to communicate with the Automower Connect API</description>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"appKey\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Application Key</label>\n+\t\t\t\t<description>The Application Key is required to communication with the Automower Connect Api. It can be obtained by registering an Application on the Husqvarna Website. This application also needs to be connected to the \"Authentication API\" and the \"Automower Connect API\"</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"userName\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>User name</label>\n+\t\t\t\t<description>The user name for which the application key has been issued</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"password\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Password</label>\n+\t\t\t\t<description>The password for the given user</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"pollingInterval\" type=\"integer\" required=\"false\">\n+\t\t\t\t<label>Polling Interval</label>\n+\t\t\t\t<description>How often the available automowers should be queried in seconds. Default is 1h (3600s)</description>\n+\t\t\t</parameter>\n+\t\t</config-description>\n+\n+\t</bridge-type>\n+\n+\t<!-- Automower Thing Type -->\n+\t<thing-type id=\"automower\">\n+\t\t<label>Automower</label>\n+\t\t<description>An automatic lawn mower</description>\n+\n+\t\t<channels>\n+\t\t\t<channel id=\"name\" typeId=\"nameType\" />\n+\t\t\t<channel id=\"mode\" typeId=\"modeType\" />\n+\t\t\t<channel id=\"activity\" typeId=\"activityType\" />\n+\t\t\t<channel id=\"state\" typeId=\"stateType\" />\n+\t\t\t<channel id=\"last-update\" typeId=\"lastUpdateType\" />\n+\t\t\t<channel id=\"battery\" typeId=\"batteryType\" />\n+\t\t\t<channel id=\"error-code\" typeId=\"errorCodeType\" />\n+\t\t\t<channel id=\"error-timestamp\" typeId=\"errorTimestampType\" />\n+\n+\t\t\t<channel id=\"command\" typeId=\"commandType\" />\n+\t\t\t<channel id=\"command-duration\" typeId=\"commandDurationType\" />\n+\t\t\t<channel id=\"command-response\" typeId=\"commandResponseType\" />\n+\t\t</channels>\n+\n+\t\t<properties>\n+\t\t\t<property name=\"mowerId\">N/A</property>\n+\t\t\t<property name=\"mowerName\">N/A</property>\n+\t\t\t<property name=\"mowerModel\">N/A</property>\n+\t\t\t<property name=\"mowerSerialNumber\">N/A</property>\n+\t\t</properties>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"mowerId\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Automower Id</label>\n+\t\t\t\t<description>The Id of an automower as used by the Automower Connect Api to identify a mower</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"pollingInterval\" type=\"integer\" required=\"false\">", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwNzM1OA=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTM3NTI5OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/thing/thing-types.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMTo0NTo0M1rOGvi55Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwODoyNDo1MFrOGwLZ6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwODEzMw==", "bodyText": "Can this be removed?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452508133", "createdAt": "2020-07-09T21:45:43Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -0,0 +1,193 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"automower\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<!-- Automower Bridge Thing Type -->\n+\t<bridge-type id=\"bridge\">\n+\t\t<label>Automower Connect Bridge</label>\n+\t\t<description>The bridge to communicate with the Automower Connect API</description>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"appKey\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Application Key</label>\n+\t\t\t\t<description>The Application Key is required to communication with the Automower Connect Api. It can be obtained by registering an Application on the Husqvarna Website. This application also needs to be connected to the \"Authentication API\" and the \"Automower Connect API\"</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"userName\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>User name</label>\n+\t\t\t\t<description>The user name for which the application key has been issued</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"password\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Password</label>\n+\t\t\t\t<description>The password for the given user</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"pollingInterval\" type=\"integer\" required=\"false\">\n+\t\t\t\t<label>Polling Interval</label>\n+\t\t\t\t<description>How often the available automowers should be queried in seconds. Default is 1h (3600s)</description>\n+\t\t\t</parameter>\n+\t\t</config-description>\n+\n+\t</bridge-type>\n+\n+\t<!-- Automower Thing Type -->\n+\t<thing-type id=\"automower\">\n+\t\t<label>Automower</label>\n+\t\t<description>An automatic lawn mower</description>\n+\n+\t\t<channels>\n+\t\t\t<channel id=\"name\" typeId=\"nameType\" />\n+\t\t\t<channel id=\"mode\" typeId=\"modeType\" />\n+\t\t\t<channel id=\"activity\" typeId=\"activityType\" />\n+\t\t\t<channel id=\"state\" typeId=\"stateType\" />\n+\t\t\t<channel id=\"last-update\" typeId=\"lastUpdateType\" />\n+\t\t\t<channel id=\"battery\" typeId=\"batteryType\" />\n+\t\t\t<channel id=\"error-code\" typeId=\"errorCodeType\" />\n+\t\t\t<channel id=\"error-timestamp\" typeId=\"errorTimestampType\" />\n+\n+\t\t\t<channel id=\"command\" typeId=\"commandType\" />\n+\t\t\t<channel id=\"command-duration\" typeId=\"commandDurationType\" />\n+\t\t\t<channel id=\"command-response\" typeId=\"commandResponseType\" />\n+\t\t</channels>\n+\n+\t\t<properties>\n+\t\t\t<property name=\"mowerId\">N/A</property>\n+\t\t\t<property name=\"mowerName\">N/A</property>\n+\t\t\t<property name=\"mowerModel\">N/A</property>\n+\t\t\t<property name=\"mowerSerialNumber\">N/A</property>\n+\t\t</properties>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"mowerId\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Automower Id</label>\n+\t\t\t\t<description>The Id of an automower as used by the Automower Connect Api to identify a mower</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"pollingInterval\" type=\"integer\" required=\"false\">\n+\t\t\t\t<label>Polling Interval</label>\n+\t\t\t\t<description>How often the current automower state should be polled in seconds. Default is 5min (300s)</description>\n+\t\t\t</parameter>\n+\t\t</config-description>\n+\n+\t</thing-type>\n+\n+\t<!-- Sample Channel Type -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE3MTY5MQ==", "bodyText": "sure", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453171691", "createdAt": "2020-07-11T08:24:50Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -0,0 +1,193 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"automower\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<!-- Automower Bridge Thing Type -->\n+\t<bridge-type id=\"bridge\">\n+\t\t<label>Automower Connect Bridge</label>\n+\t\t<description>The bridge to communicate with the Automower Connect API</description>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"appKey\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Application Key</label>\n+\t\t\t\t<description>The Application Key is required to communication with the Automower Connect Api. It can be obtained by registering an Application on the Husqvarna Website. This application also needs to be connected to the \"Authentication API\" and the \"Automower Connect API\"</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"userName\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>User name</label>\n+\t\t\t\t<description>The user name for which the application key has been issued</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"password\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Password</label>\n+\t\t\t\t<description>The password for the given user</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"pollingInterval\" type=\"integer\" required=\"false\">\n+\t\t\t\t<label>Polling Interval</label>\n+\t\t\t\t<description>How often the available automowers should be queried in seconds. Default is 1h (3600s)</description>\n+\t\t\t</parameter>\n+\t\t</config-description>\n+\n+\t</bridge-type>\n+\n+\t<!-- Automower Thing Type -->\n+\t<thing-type id=\"automower\">\n+\t\t<label>Automower</label>\n+\t\t<description>An automatic lawn mower</description>\n+\n+\t\t<channels>\n+\t\t\t<channel id=\"name\" typeId=\"nameType\" />\n+\t\t\t<channel id=\"mode\" typeId=\"modeType\" />\n+\t\t\t<channel id=\"activity\" typeId=\"activityType\" />\n+\t\t\t<channel id=\"state\" typeId=\"stateType\" />\n+\t\t\t<channel id=\"last-update\" typeId=\"lastUpdateType\" />\n+\t\t\t<channel id=\"battery\" typeId=\"batteryType\" />\n+\t\t\t<channel id=\"error-code\" typeId=\"errorCodeType\" />\n+\t\t\t<channel id=\"error-timestamp\" typeId=\"errorTimestampType\" />\n+\n+\t\t\t<channel id=\"command\" typeId=\"commandType\" />\n+\t\t\t<channel id=\"command-duration\" typeId=\"commandDurationType\" />\n+\t\t\t<channel id=\"command-response\" typeId=\"commandResponseType\" />\n+\t\t</channels>\n+\n+\t\t<properties>\n+\t\t\t<property name=\"mowerId\">N/A</property>\n+\t\t\t<property name=\"mowerName\">N/A</property>\n+\t\t\t<property name=\"mowerModel\">N/A</property>\n+\t\t\t<property name=\"mowerSerialNumber\">N/A</property>\n+\t\t</properties>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"mowerId\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Automower Id</label>\n+\t\t\t\t<description>The Id of an automower as used by the Automower Connect Api to identify a mower</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"pollingInterval\" type=\"integer\" required=\"false\">\n+\t\t\t\t<label>Polling Interval</label>\n+\t\t\t\t<description>How often the current automower state should be polled in seconds. Default is 5min (300s)</description>\n+\t\t\t</parameter>\n+\t\t</config-description>\n+\n+\t</thing-type>\n+\n+\t<!-- Sample Channel Type -->", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwODEzMw=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTM5NjM1OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "isResolved": true, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMTo1MzowOVrOGvjGjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxOTo1NzoyM1rOG5H5LQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUxMTM3NQ==", "bodyText": "See above", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452511375", "createdAt": "2020-07-09T21:53:09Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.info(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers\", e);\n+            }\n+        }\n+    }\n+\n+    public AutomowerBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (bridge != null) {\n+            stopAutomowerBridgePolling(bridge);\n+            bridge = null;\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Initializing automower bridge handler.\");\n+        bridgeConfiguration = getConfigAs(AutomowerBridgeConfiguration.class);\n+\n+        final String appKey = bridgeConfiguration.getAppKey();\n+        final String userName = bridgeConfiguration.getUserName();\n+        final String password = bridgeConfiguration.getPassword();\n+        if (appKey == null || appKey.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-app-key\");\n+        } else if (userName == null || userName.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-username\");\n+        } else if (password == null || password.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-password\");\n+        } else {\n+            updateStatus(ThingStatus.UNKNOWN);\n+            if (bridge == null) {\n+                bridge = new AutomowerBridge(appKey, userName, password, httpClient, scheduler);\n+                // bridge.setTimeout(5000);\n+\n+                startAutomowerBridgePolling(bridge);\n+            }\n+        }\n+    }\n+\n+    private void startAutomowerBridgePolling(AutomowerBridge bridge) {\n+        if (automowerBridgePollingJob == null || automowerBridgePollingJob.isCancelled()) {\n+            if (bridgeConfiguration.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 127}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY1ODM0MA==", "bodyText": "ok", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r454658340", "createdAt": "2020-07-14T21:32:52Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.info(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers\", e);\n+            }\n+        }\n+    }\n+\n+    public AutomowerBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (bridge != null) {\n+            stopAutomowerBridgePolling(bridge);\n+            bridge = null;\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Initializing automower bridge handler.\");\n+        bridgeConfiguration = getConfigAs(AutomowerBridgeConfiguration.class);\n+\n+        final String appKey = bridgeConfiguration.getAppKey();\n+        final String userName = bridgeConfiguration.getUserName();\n+        final String password = bridgeConfiguration.getPassword();\n+        if (appKey == null || appKey.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-app-key\");\n+        } else if (userName == null || userName.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-username\");\n+        } else if (password == null || password.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-password\");\n+        } else {\n+            updateStatus(ThingStatus.UNKNOWN);\n+            if (bridge == null) {\n+                bridge = new AutomowerBridge(appKey, userName, password, httpClient, scheduler);\n+                // bridge.setTimeout(5000);\n+\n+                startAutomowerBridgePolling(bridge);\n+            }\n+        }\n+    }\n+\n+    private void startAutomowerBridgePolling(AutomowerBridge bridge) {\n+        if (automowerBridgePollingJob == null || automowerBridgePollingJob.isCancelled()) {\n+            if (bridgeConfiguration.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUxMTM3NQ=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 127}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg4NjcyOA==", "bodyText": "Logging to info should be used rarely. This could be debug.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r456886728", "createdAt": "2020-07-19T09:46:06Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.info(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers\", e);\n+            }\n+        }\n+    }\n+\n+    public AutomowerBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (bridge != null) {\n+            stopAutomowerBridgePolling(bridge);\n+            bridge = null;\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Initializing automower bridge handler.\");\n+        bridgeConfiguration = getConfigAs(AutomowerBridgeConfiguration.class);\n+\n+        final String appKey = bridgeConfiguration.getAppKey();\n+        final String userName = bridgeConfiguration.getUserName();\n+        final String password = bridgeConfiguration.getPassword();\n+        if (appKey == null || appKey.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-app-key\");\n+        } else if (userName == null || userName.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-username\");\n+        } else if (password == null || password.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-password\");\n+        } else {\n+            updateStatus(ThingStatus.UNKNOWN);\n+            if (bridge == null) {\n+                bridge = new AutomowerBridge(appKey, userName, password, httpClient, scheduler);\n+                // bridge.setTimeout(5000);\n+\n+                startAutomowerBridgePolling(bridge);\n+            }\n+        }\n+    }\n+\n+    private void startAutomowerBridgePolling(AutomowerBridge bridge) {\n+        if (automowerBridgePollingJob == null || automowerBridgePollingJob.isCancelled()) {\n+            if (bridgeConfiguration.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUxMTM3NQ=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 127}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ4NzU1NA==", "bodyText": "Can you change it or comment on this?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r462487554", "createdAt": "2020-07-29T18:03:46Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.info(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers\", e);\n+            }\n+        }\n+    }\n+\n+    public AutomowerBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (bridge != null) {\n+            stopAutomowerBridgePolling(bridge);\n+            bridge = null;\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Initializing automower bridge handler.\");\n+        bridgeConfiguration = getConfigAs(AutomowerBridgeConfiguration.class);\n+\n+        final String appKey = bridgeConfiguration.getAppKey();\n+        final String userName = bridgeConfiguration.getUserName();\n+        final String password = bridgeConfiguration.getPassword();\n+        if (appKey == null || appKey.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-app-key\");\n+        } else if (userName == null || userName.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-username\");\n+        } else if (password == null || password.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-password\");\n+        } else {\n+            updateStatus(ThingStatus.UNKNOWN);\n+            if (bridge == null) {\n+                bridge = new AutomowerBridge(appKey, userName, password, httpClient, scheduler);\n+                // bridge.setTimeout(5000);\n+\n+                startAutomowerBridgePolling(bridge);\n+            }\n+        }\n+    }\n+\n+    private void startAutomowerBridgePolling(AutomowerBridge bridge) {\n+        if (automowerBridgePollingJob == null || automowerBridgePollingJob.isCancelled()) {\n+            if (bridgeConfiguration.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUxMTM3NQ=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 127}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjU0NTA0MQ==", "bodyText": "Hm, and how should a user of the plugin be informed about such a misconfiguration? When I use a binding and configure a value that is not used by the binding I definitely would expect that to be logged.\nFor me this would be a very rare log. It logs one line when the binding is loaded and when it was configured with wrong values.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r462545041", "createdAt": "2020-07-29T19:45:20Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.info(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers\", e);\n+            }\n+        }\n+    }\n+\n+    public AutomowerBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (bridge != null) {\n+            stopAutomowerBridgePolling(bridge);\n+            bridge = null;\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Initializing automower bridge handler.\");\n+        bridgeConfiguration = getConfigAs(AutomowerBridgeConfiguration.class);\n+\n+        final String appKey = bridgeConfiguration.getAppKey();\n+        final String userName = bridgeConfiguration.getUserName();\n+        final String password = bridgeConfiguration.getPassword();\n+        if (appKey == null || appKey.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-app-key\");\n+        } else if (userName == null || userName.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-username\");\n+        } else if (password == null || password.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-password\");\n+        } else {\n+            updateStatus(ThingStatus.UNKNOWN);\n+            if (bridge == null) {\n+                bridge = new AutomowerBridge(appKey, userName, password, httpClient, scheduler);\n+                // bridge.setTimeout(5000);\n+\n+                startAutomowerBridgePolling(bridge);\n+            }\n+        }\n+    }\n+\n+    private void startAutomowerBridgePolling(AutomowerBridge bridge) {\n+        if (automowerBridgePollingJob == null || automowerBridgePollingJob.isCancelled()) {\n+            if (bridgeConfiguration.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUxMTM3NQ=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 127}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjU0NzQ5OQ==", "bodyText": "Best way would be to set the thing OFFLINE with the detail CONFIGURATION_ERROR and an appropriate message as a third parameter, which will be displayed in PaperUI.\nYou can log this to debug or warn.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r462547499", "createdAt": "2020-07-29T19:50:14Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.info(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers\", e);\n+            }\n+        }\n+    }\n+\n+    public AutomowerBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (bridge != null) {\n+            stopAutomowerBridgePolling(bridge);\n+            bridge = null;\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Initializing automower bridge handler.\");\n+        bridgeConfiguration = getConfigAs(AutomowerBridgeConfiguration.class);\n+\n+        final String appKey = bridgeConfiguration.getAppKey();\n+        final String userName = bridgeConfiguration.getUserName();\n+        final String password = bridgeConfiguration.getPassword();\n+        if (appKey == null || appKey.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-app-key\");\n+        } else if (userName == null || userName.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-username\");\n+        } else if (password == null || password.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-password\");\n+        } else {\n+            updateStatus(ThingStatus.UNKNOWN);\n+            if (bridge == null) {\n+                bridge = new AutomowerBridge(appKey, userName, password, httpClient, scheduler);\n+                // bridge.setTimeout(5000);\n+\n+                startAutomowerBridgePolling(bridge);\n+            }\n+        }\n+    }\n+\n+    private void startAutomowerBridgePolling(AutomowerBridge bridge) {\n+        if (automowerBridgePollingJob == null || automowerBridgePollingJob.isCancelled()) {\n+            if (bridgeConfiguration.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUxMTM3NQ=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 127}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjU1MTM0MQ==", "bodyText": "Ok, that makes sense. Then I will completely get rid of the log. If it is visible in the status message I think this should be enough", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r462551341", "createdAt": "2020-07-29T19:57:23Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(2);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    @NonNullByDefault\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.info(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers\", e);\n+            }\n+        }\n+    }\n+\n+    public AutomowerBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (bridge != null) {\n+            stopAutomowerBridgePolling(bridge);\n+            bridge = null;\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.debug(\"Initializing automower bridge handler.\");\n+        bridgeConfiguration = getConfigAs(AutomowerBridgeConfiguration.class);\n+\n+        final String appKey = bridgeConfiguration.getAppKey();\n+        final String userName = bridgeConfiguration.getUserName();\n+        final String password = bridgeConfiguration.getPassword();\n+        if (appKey == null || appKey.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-app-key\");\n+        } else if (userName == null || userName.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-username\");\n+        } else if (password == null || password.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-password\");\n+        } else {\n+            updateStatus(ThingStatus.UNKNOWN);\n+            if (bridge == null) {\n+                bridge = new AutomowerBridge(appKey, userName, password, httpClient, scheduler);\n+                // bridge.setTimeout(5000);\n+\n+                startAutomowerBridgePolling(bridge);\n+            }\n+        }\n+    }\n+\n+    private void startAutomowerBridgePolling(AutomowerBridge bridge) {\n+        if (automowerBridgePollingJob == null || automowerBridgePollingJob.isCancelled()) {\n+            if (bridgeConfiguration.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUxMTM3NQ=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 127}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTM5Nzg0OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMTo1Mzo0NVrOGvjHdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMDoxMDoyOVrOG5IWZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUxMTYwNQ==", "bodyText": "See above", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r452511605", "createdAt": "2020-07-09T21:53:45Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+\n+        }\n+\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        } else {\n+            sendCommand(channelUID, command);\n+        }\n+    }\n+\n+    private void sendCommand(ChannelUID channelUID, Command command) {\n+        switch (channelUID.getId()) {\n+            case CHANNEL_COMMAND_DURATION:\n+                if (command instanceof DecimalType) {\n+                    commandDuration.set(((DecimalType) command).longValue());\n+                    updateState(CHANNEL_COMMAND_DURATION, new DecimalType(commandDuration.get()));\n+                }\n+                break;\n+\n+            case CHANNEL_COMMAND:\n+                if (command instanceof StringType) {\n+                    sendAutomowerCommand(command);\n+                } else {\n+                    logger.debug(\"Received command of type {} but StringType is expected.\",\n+                            command.getClass().getName());\n+                }\n+                break;\n+\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            config = getConfigAs(AutomowerConfiguration.class);\n+\n+            final String configMowerId = config.getMowerId();\n+            if (configMowerId != null) {\n+                automowerId.set(configMowerId);\n+\n+                // bridgeHandler.registerLightStatusListener(this);\n+                startAutomowerPolling();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            }\n+\n+        } else {\n+\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (!automowerId.get().equals(NO_ID)) {\n+            // bridgeHandler.unregisterLightStatusListener(this);\n+            stopAutomowerPolling();\n+            automowerId.set(NO_ID);\n+        }\n+    }\n+\n+    private void startAutomowerPolling() {\n+        if (automowerPollingJob == null || automowerPollingJob.isCancelled()) {\n+            if (config.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 179}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg0NDMxMw==", "bodyText": "ok", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r453844313", "createdAt": "2020-07-13T18:24:12Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+\n+        }\n+\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        } else {\n+            sendCommand(channelUID, command);\n+        }\n+    }\n+\n+    private void sendCommand(ChannelUID channelUID, Command command) {\n+        switch (channelUID.getId()) {\n+            case CHANNEL_COMMAND_DURATION:\n+                if (command instanceof DecimalType) {\n+                    commandDuration.set(((DecimalType) command).longValue());\n+                    updateState(CHANNEL_COMMAND_DURATION, new DecimalType(commandDuration.get()));\n+                }\n+                break;\n+\n+            case CHANNEL_COMMAND:\n+                if (command instanceof StringType) {\n+                    sendAutomowerCommand(command);\n+                } else {\n+                    logger.debug(\"Received command of type {} but StringType is expected.\",\n+                            command.getClass().getName());\n+                }\n+                break;\n+\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            config = getConfigAs(AutomowerConfiguration.class);\n+\n+            final String configMowerId = config.getMowerId();\n+            if (configMowerId != null) {\n+                automowerId.set(configMowerId);\n+\n+                // bridgeHandler.registerLightStatusListener(this);\n+                startAutomowerPolling();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            }\n+\n+        } else {\n+\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (!automowerId.get().equals(NO_ID)) {\n+            // bridgeHandler.unregisterLightStatusListener(this);\n+            stopAutomowerPolling();\n+            automowerId.set(NO_ID);\n+        }\n+    }\n+\n+    private void startAutomowerPolling() {\n+        if (automowerPollingJob == null || automowerPollingJob.isCancelled()) {\n+            if (config.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUxMTYwNQ=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 179}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY1ODQ0MA==", "bodyText": "ok", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r454658440", "createdAt": "2020-07-14T21:33:02Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+\n+        }\n+\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        } else {\n+            sendCommand(channelUID, command);\n+        }\n+    }\n+\n+    private void sendCommand(ChannelUID channelUID, Command command) {\n+        switch (channelUID.getId()) {\n+            case CHANNEL_COMMAND_DURATION:\n+                if (command instanceof DecimalType) {\n+                    commandDuration.set(((DecimalType) command).longValue());\n+                    updateState(CHANNEL_COMMAND_DURATION, new DecimalType(commandDuration.get()));\n+                }\n+                break;\n+\n+            case CHANNEL_COMMAND:\n+                if (command instanceof StringType) {\n+                    sendAutomowerCommand(command);\n+                } else {\n+                    logger.debug(\"Received command of type {} but StringType is expected.\",\n+                            command.getClass().getName());\n+                }\n+                break;\n+\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            config = getConfigAs(AutomowerConfiguration.class);\n+\n+            final String configMowerId = config.getMowerId();\n+            if (configMowerId != null) {\n+                automowerId.set(configMowerId);\n+\n+                // bridgeHandler.registerLightStatusListener(this);\n+                startAutomowerPolling();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            }\n+\n+        } else {\n+\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (!automowerId.get().equals(NO_ID)) {\n+            // bridgeHandler.unregisterLightStatusListener(this);\n+            stopAutomowerPolling();\n+            automowerId.set(NO_ID);\n+        }\n+    }\n+\n+    private void startAutomowerPolling() {\n+        if (automowerPollingJob == null || automowerPollingJob.isCancelled()) {\n+            if (config.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUxMTYwNQ=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 179}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ5Mjc5OA==", "bodyText": "Can you change it? Logging to info should be used rarely. This could be debug.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r462492798", "createdAt": "2020-07-29T18:12:55Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+\n+        }\n+\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        } else {\n+            sendCommand(channelUID, command);\n+        }\n+    }\n+\n+    private void sendCommand(ChannelUID channelUID, Command command) {\n+        switch (channelUID.getId()) {\n+            case CHANNEL_COMMAND_DURATION:\n+                if (command instanceof DecimalType) {\n+                    commandDuration.set(((DecimalType) command).longValue());\n+                    updateState(CHANNEL_COMMAND_DURATION, new DecimalType(commandDuration.get()));\n+                }\n+                break;\n+\n+            case CHANNEL_COMMAND:\n+                if (command instanceof StringType) {\n+                    sendAutomowerCommand(command);\n+                } else {\n+                    logger.debug(\"Received command of type {} but StringType is expected.\",\n+                            command.getClass().getName());\n+                }\n+                break;\n+\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            config = getConfigAs(AutomowerConfiguration.class);\n+\n+            final String configMowerId = config.getMowerId();\n+            if (configMowerId != null) {\n+                automowerId.set(configMowerId);\n+\n+                // bridgeHandler.registerLightStatusListener(this);\n+                startAutomowerPolling();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            }\n+\n+        } else {\n+\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (!automowerId.get().equals(NO_ID)) {\n+            // bridgeHandler.unregisterLightStatusListener(this);\n+            stopAutomowerPolling();\n+            automowerId.set(NO_ID);\n+        }\n+    }\n+\n+    private void startAutomowerPolling() {\n+        if (automowerPollingJob == null || automowerPollingJob.isCancelled()) {\n+            if (config.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUxMTYwNQ=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 179}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjU0NTI2NQ==", "bodyText": "Same question as above: Hm, and how should a user of the plugin be informed about such a misconfiguration? When I use a binding and configure a value that is not used by the binding I definitely would expect that to be logged.\nFor me this would be a very rare log. It logs one line when the binding is loaded and when it was configured with wrong values.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r462545265", "createdAt": "2020-07-29T19:45:47Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+\n+        }\n+\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        } else {\n+            sendCommand(channelUID, command);\n+        }\n+    }\n+\n+    private void sendCommand(ChannelUID channelUID, Command command) {\n+        switch (channelUID.getId()) {\n+            case CHANNEL_COMMAND_DURATION:\n+                if (command instanceof DecimalType) {\n+                    commandDuration.set(((DecimalType) command).longValue());\n+                    updateState(CHANNEL_COMMAND_DURATION, new DecimalType(commandDuration.get()));\n+                }\n+                break;\n+\n+            case CHANNEL_COMMAND:\n+                if (command instanceof StringType) {\n+                    sendAutomowerCommand(command);\n+                } else {\n+                    logger.debug(\"Received command of type {} but StringType is expected.\",\n+                            command.getClass().getName());\n+                }\n+                break;\n+\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            config = getConfigAs(AutomowerConfiguration.class);\n+\n+            final String configMowerId = config.getMowerId();\n+            if (configMowerId != null) {\n+                automowerId.set(configMowerId);\n+\n+                // bridgeHandler.registerLightStatusListener(this);\n+                startAutomowerPolling();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            }\n+\n+        } else {\n+\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (!automowerId.get().equals(NO_ID)) {\n+            // bridgeHandler.unregisterLightStatusListener(this);\n+            stopAutomowerPolling();\n+            automowerId.set(NO_ID);\n+        }\n+    }\n+\n+    private void startAutomowerPolling() {\n+        if (automowerPollingJob == null || automowerPollingJob.isCancelled()) {\n+            if (config.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUxMTYwNQ=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 179}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjU1ODgyMA==", "bodyText": "will also use the offline state", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r462558820", "createdAt": "2020-07-29T20:10:29Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,301 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.text.DateFormat;\n+import java.util.Collections;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    private static final String NO_ID = \"NO_ID\";\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+\n+    private @Nullable AutomowerConfiguration config;\n+\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private AtomicLong commandDuration = new AtomicLong(60); // 60min default\n+    private long lastQueryTime = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    DateFormat df = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG,\n+            new Locale(System.getProperty(\"user.language\")));\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+\n+        }\n+\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        } else {\n+            sendCommand(channelUID, command);\n+        }\n+    }\n+\n+    private void sendCommand(ChannelUID channelUID, Command command) {\n+        switch (channelUID.getId()) {\n+            case CHANNEL_COMMAND_DURATION:\n+                if (command instanceof DecimalType) {\n+                    commandDuration.set(((DecimalType) command).longValue());\n+                    updateState(CHANNEL_COMMAND_DURATION, new DecimalType(commandDuration.get()));\n+                }\n+                break;\n+\n+            case CHANNEL_COMMAND:\n+                if (command instanceof StringType) {\n+                    sendAutomowerCommand(command);\n+                } else {\n+                    logger.debug(\"Received command of type {} but StringType is expected.\",\n+                            command.getClass().getName());\n+                }\n+                break;\n+\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            config = getConfigAs(AutomowerConfiguration.class);\n+\n+            final String configMowerId = config.getMowerId();\n+            if (configMowerId != null) {\n+                automowerId.set(configMowerId);\n+\n+                // bridgeHandler.registerLightStatusListener(this);\n+                startAutomowerPolling();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            }\n+\n+        } else {\n+\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        logger.debug(\"Handler disposed.\");\n+        if (!automowerId.get().equals(NO_ID)) {\n+            // bridgeHandler.unregisterLightStatusListener(this);\n+            stopAutomowerPolling();\n+            automowerId.set(NO_ID);\n+        }\n+    }\n+\n+    private void startAutomowerPolling() {\n+        if (automowerPollingJob == null || automowerPollingJob.isCancelled()) {\n+            if (config.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUxMTYwNQ=="}, "originalCommit": {"oid": "3b14293a303082555d98b6002f974458272ff139"}, "originalPosition": 179}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1MDQwMzc3OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/README.md", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQwOToxMjoyMlrOGzt9JQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxOTowMzowNFrOG0bZRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg4MzQ5Mw==", "bodyText": "These could be trigger Channels, since they don't have a state, but send events when an error raised.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r456883493", "createdAt": "2020-07-19T09:12:22Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/README.md", "diffHunk": "@@ -0,0 +1,123 @@\n+# Automower Binding\n+\n+This binding communicates to the Husqvarna Automower Connect API in order to send commands and query the state of Husqvarna Automower robots.\n+\n+## Supported Things\n+\n+`bridge:` The bridge needs to be configured with credentials and an application key that allows communicating with the Automower Connect Api\n+\n+`automower:` A single Husqvarna Automower robot\n+\n+Basically all Husqvarna Automower models with \"Automower Connect\" support should be supported. It was tested only with a Husqvarna Automower 450X\n+\n+\n+## Discovery\n+\n+Once the bridge is created and configured, registered automowers will be discovered automatically\n+\n+\n+## Thing Configuration\n+\n+`bridge:`\n+\n+- appKey (mandatory): The Application Key is required to communication with the Automower Connect Api. It can be obtained by registering an Application on the Husqvarna Website. This application also needs to be connected to the \"Authentication API\" and the \"Automower Connect API\"\n+- userName (mandatory): The user name for which the application key has been issued\n+- password (mandatory): The password for the given user\n+- pollingInterval (optional): How often the bridge state should be queried in seconds. Default is 1h (3600s)\n+\n+Keep in mind that the status of the bridge should not be queried too often. According to the Husqvarna documentation not more than 10000 requests per month and application key are allowed. With the default value of 1h this would mean ~720 requests per month for the bridge state\n+\n+`automower:`\n+\n+- mowerId (mandatory): The Id of an automower as used by the Automower Connect Api to identify a mower. This is automatically filled when the thing is discovered\n+- pollingInterval (optional): How often the current automower state should be polled in seconds. Default is 10min (600s)\n+\n+Keep in mind that the status of the automowers should not be queried too often. According to the Husqvarna documentation not more than 10000 requests per month and application key are allowed. With the default value of 10min this would mean ~4300 requests per month per automower\n+\n+## Channels\n+\n+\n+| channel  | type   | description                  |\n+|----------|--------|------------------------------|\n+| name  | String | (readonly) The name of the Automower  |\n+| mode  | String | (readonly) The current mode (MAIN_AREA, SECONDARY_AREA, HOME, DEMO, UNKNOWN)  |\n+| activity  | String | (readonly) The current activity (UNKNOWN, NOT_APPLICABLE, MOWING, GOING_HOME, CHARGING, LEAVING, PARKED_IN_CS, STOPPED_IN_GARDEN)  |\n+| state  | String | (readonly) The current state (UNKNOWN, NOT_APPLICABLE, PAUSED, IN_OPERATION, WAIT_UPDATING, WAIT_POWER_UP, RESTRICTED, OFF, STOPPED, ERROR, FATAL_ERROR, ERROR_AT_POWER_UP)  |\n+| last-update  | DateTime | (readonly) The time when the automower updated its states  |\n+| battery  | Number | (readonly) The battery state of charge in percent  |\n+| error-code  | Number | (readonly) The current error code  |\n+| error-timestamp  | DateTime | (readonly) The timestamp when the current error occurred  |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84942d411a6d7df8f5935f6b9a9e594205c173ab"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzYxOTg1MA==", "bodyText": "Ok, I did not see those channels as trigger channels. I changed the command channels, but the error code reflects the error code that is reported by the mower in case it is in an error state.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r457619850", "createdAt": "2020-07-20T18:48:34Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/README.md", "diffHunk": "@@ -0,0 +1,123 @@\n+# Automower Binding\n+\n+This binding communicates to the Husqvarna Automower Connect API in order to send commands and query the state of Husqvarna Automower robots.\n+\n+## Supported Things\n+\n+`bridge:` The bridge needs to be configured with credentials and an application key that allows communicating with the Automower Connect Api\n+\n+`automower:` A single Husqvarna Automower robot\n+\n+Basically all Husqvarna Automower models with \"Automower Connect\" support should be supported. It was tested only with a Husqvarna Automower 450X\n+\n+\n+## Discovery\n+\n+Once the bridge is created and configured, registered automowers will be discovered automatically\n+\n+\n+## Thing Configuration\n+\n+`bridge:`\n+\n+- appKey (mandatory): The Application Key is required to communication with the Automower Connect Api. It can be obtained by registering an Application on the Husqvarna Website. This application also needs to be connected to the \"Authentication API\" and the \"Automower Connect API\"\n+- userName (mandatory): The user name for which the application key has been issued\n+- password (mandatory): The password for the given user\n+- pollingInterval (optional): How often the bridge state should be queried in seconds. Default is 1h (3600s)\n+\n+Keep in mind that the status of the bridge should not be queried too often. According to the Husqvarna documentation not more than 10000 requests per month and application key are allowed. With the default value of 1h this would mean ~720 requests per month for the bridge state\n+\n+`automower:`\n+\n+- mowerId (mandatory): The Id of an automower as used by the Automower Connect Api to identify a mower. This is automatically filled when the thing is discovered\n+- pollingInterval (optional): How often the current automower state should be polled in seconds. Default is 10min (600s)\n+\n+Keep in mind that the status of the automowers should not be queried too often. According to the Husqvarna documentation not more than 10000 requests per month and application key are allowed. With the default value of 10min this would mean ~4300 requests per month per automower\n+\n+## Channels\n+\n+\n+| channel  | type   | description                  |\n+|----------|--------|------------------------------|\n+| name  | String | (readonly) The name of the Automower  |\n+| mode  | String | (readonly) The current mode (MAIN_AREA, SECONDARY_AREA, HOME, DEMO, UNKNOWN)  |\n+| activity  | String | (readonly) The current activity (UNKNOWN, NOT_APPLICABLE, MOWING, GOING_HOME, CHARGING, LEAVING, PARKED_IN_CS, STOPPED_IN_GARDEN)  |\n+| state  | String | (readonly) The current state (UNKNOWN, NOT_APPLICABLE, PAUSED, IN_OPERATION, WAIT_UPDATING, WAIT_POWER_UP, RESTRICTED, OFF, STOPPED, ERROR, FATAL_ERROR, ERROR_AT_POWER_UP)  |\n+| last-update  | DateTime | (readonly) The time when the automower updated its states  |\n+| battery  | Number | (readonly) The battery state of charge in percent  |\n+| error-code  | Number | (readonly) The current error code  |\n+| error-timestamp  | DateTime | (readonly) The timestamp when the current error occurred  |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg4MzQ5Mw=="}, "originalCommit": {"oid": "84942d411a6d7df8f5935f6b9a9e594205c173ab"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzYyNzk3NQ==", "bodyText": "After thinking about it again, I agree with you, that it is a state if the mower has an error.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r457627975", "createdAt": "2020-07-20T19:03:04Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/README.md", "diffHunk": "@@ -0,0 +1,123 @@\n+# Automower Binding\n+\n+This binding communicates to the Husqvarna Automower Connect API in order to send commands and query the state of Husqvarna Automower robots.\n+\n+## Supported Things\n+\n+`bridge:` The bridge needs to be configured with credentials and an application key that allows communicating with the Automower Connect Api\n+\n+`automower:` A single Husqvarna Automower robot\n+\n+Basically all Husqvarna Automower models with \"Automower Connect\" support should be supported. It was tested only with a Husqvarna Automower 450X\n+\n+\n+## Discovery\n+\n+Once the bridge is created and configured, registered automowers will be discovered automatically\n+\n+\n+## Thing Configuration\n+\n+`bridge:`\n+\n+- appKey (mandatory): The Application Key is required to communication with the Automower Connect Api. It can be obtained by registering an Application on the Husqvarna Website. This application also needs to be connected to the \"Authentication API\" and the \"Automower Connect API\"\n+- userName (mandatory): The user name for which the application key has been issued\n+- password (mandatory): The password for the given user\n+- pollingInterval (optional): How often the bridge state should be queried in seconds. Default is 1h (3600s)\n+\n+Keep in mind that the status of the bridge should not be queried too often. According to the Husqvarna documentation not more than 10000 requests per month and application key are allowed. With the default value of 1h this would mean ~720 requests per month for the bridge state\n+\n+`automower:`\n+\n+- mowerId (mandatory): The Id of an automower as used by the Automower Connect Api to identify a mower. This is automatically filled when the thing is discovered\n+- pollingInterval (optional): How often the current automower state should be polled in seconds. Default is 10min (600s)\n+\n+Keep in mind that the status of the automowers should not be queried too often. According to the Husqvarna documentation not more than 10000 requests per month and application key are allowed. With the default value of 10min this would mean ~4300 requests per month per automower\n+\n+## Channels\n+\n+\n+| channel  | type   | description                  |\n+|----------|--------|------------------------------|\n+| name  | String | (readonly) The name of the Automower  |\n+| mode  | String | (readonly) The current mode (MAIN_AREA, SECONDARY_AREA, HOME, DEMO, UNKNOWN)  |\n+| activity  | String | (readonly) The current activity (UNKNOWN, NOT_APPLICABLE, MOWING, GOING_HOME, CHARGING, LEAVING, PARKED_IN_CS, STOPPED_IN_GARDEN)  |\n+| state  | String | (readonly) The current state (UNKNOWN, NOT_APPLICABLE, PAUSED, IN_OPERATION, WAIT_UPDATING, WAIT_POWER_UP, RESTRICTED, OFF, STOPPED, ERROR, FATAL_ERROR, ERROR_AT_POWER_UP)  |\n+| last-update  | DateTime | (readonly) The time when the automower updated its states  |\n+| battery  | Number | (readonly) The battery state of charge in percent  |\n+| error-code  | Number | (readonly) The current error code  |\n+| error-timestamp  | DateTime | (readonly) The timestamp when the current error occurred  |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg4MzQ5Mw=="}, "originalCommit": {"oid": "84942d411a6d7df8f5935f6b9a9e594205c173ab"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1MDQwODM3OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/actions/AutomowerActions.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQwOToxODo1MlrOGzt_gQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxOToxNzowMlrOG0b2Ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg4NDA5Nw==", "bodyText": "Can you add the workaround for the bug discussed in #8116?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r456884097", "createdAt": "2020-07-19T09:18:52Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/actions/AutomowerActions.java", "diffHunk": "@@ -0,0 +1,155 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.actions;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.thing.binding.ThingActions;\n+import org.eclipse.smarthome.core.thing.binding.ThingActionsScope;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.openhab.binding.automower.internal.things.AutomowerCommand;\n+import org.openhab.binding.automower.internal.things.AutomowerHandler;\n+import org.openhab.core.automation.annotation.ActionInput;\n+import org.openhab.core.automation.annotation.RuleAction;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@ThingActionsScope(name = \"automower\")\n+@NonNullByDefault\n+public class AutomowerActions implements ThingActions {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerActions.class);\n+    private @Nullable AutomowerHandler handler;\n+\n+    @Override\n+    public void setThingHandler(@Nullable ThingHandler handler) {\n+        this.handler = (AutomowerHandler) handler;\n+    }\n+\n+    @Override\n+    public @Nullable AutomowerHandler getThingHandler() {\n+        return handler;\n+    }\n+\n+    @RuleAction(label = \"@text/action-start-label\", description = \"@text/action-start-desc\")\n+    public void start(\n+            @ActionInput(name = \"duration\", label = \"@text/action-input-duration-label\", description = \"@text/action-input-duration-desc\") int durationMin) {\n+        AutomowerHandler automowerHandler = handler;\n+        if (automowerHandler == null) {\n+            logger.warn(\"Automower Action service ThingHandler is null!\");\n+        } else {\n+            automowerHandler.sendAutomowerCommand(AutomowerCommand.START, durationMin);\n+        }\n+    }\n+\n+    public static void start(@Nullable ThingActions actions, int durationMin) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84942d411a6d7df8f5935f6b9a9e594205c173ab"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzYyNjQ5OQ==", "bodyText": "Hm, not sure. I think this is a really ugly workaround (if you mean the invokeMethodOf stuff)...\nIsn't there another solution? Can't I wait for a workaround in the framework and document that the binding suffers from this problem?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r457626499", "createdAt": "2020-07-20T19:00:21Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/actions/AutomowerActions.java", "diffHunk": "@@ -0,0 +1,155 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.actions;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.thing.binding.ThingActions;\n+import org.eclipse.smarthome.core.thing.binding.ThingActionsScope;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.openhab.binding.automower.internal.things.AutomowerCommand;\n+import org.openhab.binding.automower.internal.things.AutomowerHandler;\n+import org.openhab.core.automation.annotation.ActionInput;\n+import org.openhab.core.automation.annotation.RuleAction;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@ThingActionsScope(name = \"automower\")\n+@NonNullByDefault\n+public class AutomowerActions implements ThingActions {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerActions.class);\n+    private @Nullable AutomowerHandler handler;\n+\n+    @Override\n+    public void setThingHandler(@Nullable ThingHandler handler) {\n+        this.handler = (AutomowerHandler) handler;\n+    }\n+\n+    @Override\n+    public @Nullable AutomowerHandler getThingHandler() {\n+        return handler;\n+    }\n+\n+    @RuleAction(label = \"@text/action-start-label\", description = \"@text/action-start-desc\")\n+    public void start(\n+            @ActionInput(name = \"duration\", label = \"@text/action-input-duration-label\", description = \"@text/action-input-duration-desc\") int durationMin) {\n+        AutomowerHandler automowerHandler = handler;\n+        if (automowerHandler == null) {\n+            logger.warn(\"Automower Action service ThingHandler is null!\");\n+        } else {\n+            automowerHandler.sendAutomowerCommand(AutomowerCommand.START, durationMin);\n+        }\n+    }\n+\n+    public static void start(@Nullable ThingActions actions, int durationMin) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg4NDA5Nw=="}, "originalCommit": {"oid": "84942d411a6d7df8f5935f6b9a9e594205c173ab"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzYyODg0OA==", "bodyText": "Since this will only be fixed in OH3, this workaround is getting implemented in all bindings, currently.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r457628848", "createdAt": "2020-07-20T19:04:49Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/actions/AutomowerActions.java", "diffHunk": "@@ -0,0 +1,155 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.actions;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.thing.binding.ThingActions;\n+import org.eclipse.smarthome.core.thing.binding.ThingActionsScope;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.openhab.binding.automower.internal.things.AutomowerCommand;\n+import org.openhab.binding.automower.internal.things.AutomowerHandler;\n+import org.openhab.core.automation.annotation.ActionInput;\n+import org.openhab.core.automation.annotation.RuleAction;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@ThingActionsScope(name = \"automower\")\n+@NonNullByDefault\n+public class AutomowerActions implements ThingActions {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerActions.class);\n+    private @Nullable AutomowerHandler handler;\n+\n+    @Override\n+    public void setThingHandler(@Nullable ThingHandler handler) {\n+        this.handler = (AutomowerHandler) handler;\n+    }\n+\n+    @Override\n+    public @Nullable AutomowerHandler getThingHandler() {\n+        return handler;\n+    }\n+\n+    @RuleAction(label = \"@text/action-start-label\", description = \"@text/action-start-desc\")\n+    public void start(\n+            @ActionInput(name = \"duration\", label = \"@text/action-input-duration-label\", description = \"@text/action-input-duration-desc\") int durationMin) {\n+        AutomowerHandler automowerHandler = handler;\n+        if (automowerHandler == null) {\n+            logger.warn(\"Automower Action service ThingHandler is null!\");\n+        } else {\n+            automowerHandler.sendAutomowerCommand(AutomowerCommand.START, durationMin);\n+        }\n+    }\n+\n+    public static void start(@Nullable ThingActions actions, int durationMin) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg4NDA5Nw=="}, "originalCommit": {"oid": "84942d411a6d7df8f5935f6b9a9e594205c173ab"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzYzMDAzOQ==", "bodyText": "Ok. Btw. how is the workflow of bringing bindings to openhab 3. Should this be done short before the release? Or asap and then merge all fixes/changes to two branches?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r457630039", "createdAt": "2020-07-20T19:06:54Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/actions/AutomowerActions.java", "diffHunk": "@@ -0,0 +1,155 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.actions;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.thing.binding.ThingActions;\n+import org.eclipse.smarthome.core.thing.binding.ThingActionsScope;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.openhab.binding.automower.internal.things.AutomowerCommand;\n+import org.openhab.binding.automower.internal.things.AutomowerHandler;\n+import org.openhab.core.automation.annotation.ActionInput;\n+import org.openhab.core.automation.annotation.RuleAction;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@ThingActionsScope(name = \"automower\")\n+@NonNullByDefault\n+public class AutomowerActions implements ThingActions {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerActions.class);\n+    private @Nullable AutomowerHandler handler;\n+\n+    @Override\n+    public void setThingHandler(@Nullable ThingHandler handler) {\n+        this.handler = (AutomowerHandler) handler;\n+    }\n+\n+    @Override\n+    public @Nullable AutomowerHandler getThingHandler() {\n+        return handler;\n+    }\n+\n+    @RuleAction(label = \"@text/action-start-label\", description = \"@text/action-start-desc\")\n+    public void start(\n+            @ActionInput(name = \"duration\", label = \"@text/action-input-duration-label\", description = \"@text/action-input-duration-desc\") int durationMin) {\n+        AutomowerHandler automowerHandler = handler;\n+        if (automowerHandler == null) {\n+            logger.warn(\"Automower Action service ThingHandler is null!\");\n+        } else {\n+            automowerHandler.sendAutomowerCommand(AutomowerCommand.START, durationMin);\n+        }\n+    }\n+\n+    public static void start(@Nullable ThingActions actions, int durationMin) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg4NDA5Nw=="}, "originalCommit": {"oid": "84942d411a6d7df8f5935f6b9a9e594205c173ab"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzYzMTc2Mw==", "bodyText": "Actually OH2 bindings should be compatible with OH3. The hack can be removed when OH3 has been released, I guess.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r457631763", "createdAt": "2020-07-20T19:10:02Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/actions/AutomowerActions.java", "diffHunk": "@@ -0,0 +1,155 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.actions;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.thing.binding.ThingActions;\n+import org.eclipse.smarthome.core.thing.binding.ThingActionsScope;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.openhab.binding.automower.internal.things.AutomowerCommand;\n+import org.openhab.binding.automower.internal.things.AutomowerHandler;\n+import org.openhab.core.automation.annotation.ActionInput;\n+import org.openhab.core.automation.annotation.RuleAction;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@ThingActionsScope(name = \"automower\")\n+@NonNullByDefault\n+public class AutomowerActions implements ThingActions {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerActions.class);\n+    private @Nullable AutomowerHandler handler;\n+\n+    @Override\n+    public void setThingHandler(@Nullable ThingHandler handler) {\n+        this.handler = (AutomowerHandler) handler;\n+    }\n+\n+    @Override\n+    public @Nullable AutomowerHandler getThingHandler() {\n+        return handler;\n+    }\n+\n+    @RuleAction(label = \"@text/action-start-label\", description = \"@text/action-start-desc\")\n+    public void start(\n+            @ActionInput(name = \"duration\", label = \"@text/action-input-duration-label\", description = \"@text/action-input-duration-desc\") int durationMin) {\n+        AutomowerHandler automowerHandler = handler;\n+        if (automowerHandler == null) {\n+            logger.warn(\"Automower Action service ThingHandler is null!\");\n+        } else {\n+            automowerHandler.sendAutomowerCommand(AutomowerCommand.START, durationMin);\n+        }\n+    }\n+\n+    public static void start(@Nullable ThingActions actions, int durationMin) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg4NDA5Nw=="}, "originalCommit": {"oid": "84942d411a6d7df8f5935f6b9a9e594205c173ab"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzYzNTM2Mg==", "bodyText": "Thx, workaround will be applied in next update to the PR", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r457635362", "createdAt": "2020-07-20T19:17:02Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/actions/AutomowerActions.java", "diffHunk": "@@ -0,0 +1,155 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.actions;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.thing.binding.ThingActions;\n+import org.eclipse.smarthome.core.thing.binding.ThingActionsScope;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.openhab.binding.automower.internal.things.AutomowerCommand;\n+import org.openhab.binding.automower.internal.things.AutomowerHandler;\n+import org.openhab.core.automation.annotation.ActionInput;\n+import org.openhab.core.automation.annotation.RuleAction;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@ThingActionsScope(name = \"automower\")\n+@NonNullByDefault\n+public class AutomowerActions implements ThingActions {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerActions.class);\n+    private @Nullable AutomowerHandler handler;\n+\n+    @Override\n+    public void setThingHandler(@Nullable ThingHandler handler) {\n+        this.handler = (AutomowerHandler) handler;\n+    }\n+\n+    @Override\n+    public @Nullable AutomowerHandler getThingHandler() {\n+        return handler;\n+    }\n+\n+    @RuleAction(label = \"@text/action-start-label\", description = \"@text/action-start-desc\")\n+    public void start(\n+            @ActionInput(name = \"duration\", label = \"@text/action-input-duration-label\", description = \"@text/action-input-duration-desc\") int durationMin) {\n+        AutomowerHandler automowerHandler = handler;\n+        if (automowerHandler == null) {\n+            logger.warn(\"Automower Action service ThingHandler is null!\");\n+        } else {\n+            automowerHandler.sendAutomowerCommand(AutomowerCommand.START, durationMin);\n+        }\n+    }\n+\n+    public static void start(@Nullable ThingActions actions, int durationMin) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg4NDA5Nw=="}, "originalCommit": {"oid": "84942d411a6d7df8f5935f6b9a9e594205c173ab"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1MDQzMDkxOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/automowerconnect/AutomowerConnectApi.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQwOTo0OTo0MFrOGzuK5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxODo1Mjo1MVrOG0bCpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg4NzAxMw==", "bodyText": "This will also catch RuntimeExceptions. Better specify the concrete execeptions. Same for below.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    } catch (Exception e) {\n          \n          \n            \n                        } catch (InterruptedException | TimeoutException | ExecutionException e) {", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r456887013", "createdAt": "2020-07-19T09:49:40Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/automowerconnect/AutomowerConnectApi.java", "diffHunk": "@@ -0,0 +1,138 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.rest.api.automowerconnect;\n+\n+import org.apache.commons.httpclient.HttpStatus;\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.util.StringContentProvider;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.openhab.binding.automower.internal.rest.api.HusqvarnaApi;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerCommandRequest;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.openhab.binding.automower.internal.rest.exceptions.UnauthorizedException;\n+\n+import com.google.gson.JsonSyntaxException;\n+\n+/**\n+ * Allows access to the AutomowerConnectApi\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerConnectApi extends HusqvarnaApi {\n+\n+    public AutomowerConnectApi(HttpClient httpClient) {\n+        super(httpClient);\n+    }\n+\n+    @Override\n+    public String getBaseUrl() {\n+        return \"https://api.amc.husqvarna.dev/v1\";\n+    }\n+\n+    public MowerListResult getMowers(String appKey, String token) throws AutomowerCommunicationException {\n+        final Request request = getHttpClient().newRequest(getBaseUrl() + \"/mowers\");\n+        request.method(HttpMethod.GET);\n+\n+        request.header(\"Authorization-Provider\", \"husqvarna\");\n+        request.header(\"Authorization\", \"Bearer \" + token);\n+        request.header(\"X-Api-Key\", appKey);\n+        request.header(\"Content-Type\", \"application/vnd.api+json\");\n+\n+        ContentResponse response;\n+        try {\n+            response = request.send();\n+        } catch (Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84942d411a6d7df8f5935f6b9a9e594205c173ab"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzYyMjE4Mw==", "bodyText": "yes", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r457622183", "createdAt": "2020-07-20T18:52:51Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/automowerconnect/AutomowerConnectApi.java", "diffHunk": "@@ -0,0 +1,138 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.rest.api.automowerconnect;\n+\n+import org.apache.commons.httpclient.HttpStatus;\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.util.StringContentProvider;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.openhab.binding.automower.internal.rest.api.HusqvarnaApi;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerCommandRequest;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.openhab.binding.automower.internal.rest.exceptions.UnauthorizedException;\n+\n+import com.google.gson.JsonSyntaxException;\n+\n+/**\n+ * Allows access to the AutomowerConnectApi\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerConnectApi extends HusqvarnaApi {\n+\n+    public AutomowerConnectApi(HttpClient httpClient) {\n+        super(httpClient);\n+    }\n+\n+    @Override\n+    public String getBaseUrl() {\n+        return \"https://api.amc.husqvarna.dev/v1\";\n+    }\n+\n+    public MowerListResult getMowers(String appKey, String token) throws AutomowerCommunicationException {\n+        final Request request = getHttpClient().newRequest(getBaseUrl() + \"/mowers\");\n+        request.method(HttpMethod.GET);\n+\n+        request.header(\"Authorization-Provider\", \"husqvarna\");\n+        request.header(\"Authorization\", \"Bearer \" + token);\n+        request.header(\"X-Api-Key\", appKey);\n+        request.header(\"Content-Type\", \"application/vnd.api+json\");\n+\n+        ContentResponse response;\n+        try {\n+            response = request.send();\n+        } catch (Exception e) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg4NzAxMw=="}, "originalCommit": {"oid": "84942d411a6d7df8f5935f6b9a9e594205c173ab"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NzQyNDAzOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxODowMjo1NFrOG5D-OA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxOTo0MDo0NVrOG5HXUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ4NzA5Ng==", "bodyText": "Can you make this @Nullable?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r462487096", "createdAt": "2020-07-29T18:02:54Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,156 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a87ebbfcc7f4c38923f43aaac0d554112d65bd5"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjU0MjY3Mg==", "bodyText": "yes", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r462542672", "createdAt": "2020-07-29T19:40:45Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,156 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ4NzA5Ng=="}, "originalCommit": {"oid": "8a87ebbfcc7f4c38923f43aaac0d554112d65bd5"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NzQzMzcyOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxODowNTozOVrOG5EEVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxOTo0NzowNVrOG5Hj7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ4ODY2Mw==", "bodyText": "Do you log the stack trace by intention?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r462488663", "createdAt": "2020-07-29T18:05:39Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,156 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.debug(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers: {}\", e.getMessage());\n+            }\n+        }\n+    }\n+\n+    public AutomowerBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        if (bridge != null) {\n+            stopAutomowerBridgePolling(bridge);\n+            bridge = null;\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        bridgeConfiguration = getConfigAs(AutomowerBridgeConfiguration.class);\n+\n+        final String appKey = bridgeConfiguration.getAppKey();\n+        final String userName = bridgeConfiguration.getUserName();\n+        final String password = bridgeConfiguration.getPassword();\n+        if (appKey == null || appKey.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-app-key\");\n+        } else if (userName == null || userName.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-username\");\n+        } else if (password == null || password.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-password\");\n+        } else {\n+            if (bridge == null) {\n+                bridge = new AutomowerBridge(appKey, userName, password, httpClient, scheduler);\n+                startAutomowerBridgePolling(bridge);\n+            }\n+            updateStatus(ThingStatus.UNKNOWN);\n+        }\n+    }\n+\n+    private void startAutomowerBridgePolling(AutomowerBridge bridge) {\n+        ScheduledFuture<?> currentPollingJob = automowerBridgePollingJob;\n+        if (currentPollingJob == null) {\n+            if (bridgeConfiguration.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);\n+            } else {\n+                automowerPollingIntervalS = bridgeConfiguration.getPollingInterval();\n+            }\n+            automowerBridgePollingJob = scheduler.scheduleWithFixedDelay(\n+                    new AutomowerBridgePollingRunnable(this, bridge), 1, automowerPollingIntervalS, TimeUnit.SECONDS);\n+        }\n+    }\n+\n+    private void stopAutomowerBridgePolling(AutomowerBridge bridge) {\n+        ScheduledFuture<?> currentPollingJob = automowerBridgePollingJob;\n+        if (currentPollingJob != null) {\n+            currentPollingJob.cancel(true);\n+            automowerBridgePollingJob = null;\n+        }\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+    }\n+\n+    public AutomowerBridge getAutomowerBridge() {\n+        return bridge;\n+    }\n+\n+    public Optional<MowerListResult> getAutomowers() {\n+        try {\n+            return Optional.of(bridge.getAutomowers());\n+        } catch (AutomowerCommunicationException e) {\n+            logger.debug(\"Bridge cannot get list of available automowers\", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a87ebbfcc7f4c38923f43aaac0d554112d65bd5"}, "originalPosition": 152}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjU0NTkwMA==", "bodyText": "no", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r462545900", "createdAt": "2020-07-29T19:47:05Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,156 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+    private long automowerPollingIntervalS = TimeUnit.HOURS.toSeconds(1);\n+\n+    private @NonNullByDefault({}) AutomowerBridge bridge;\n+    private @NonNullByDefault({}) AutomowerBridgeConfiguration bridgeConfiguration;\n+\n+    private final HttpClient httpClient;\n+\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.debug(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers: {}\", e.getMessage());\n+            }\n+        }\n+    }\n+\n+    public AutomowerBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        if (bridge != null) {\n+            stopAutomowerBridgePolling(bridge);\n+            bridge = null;\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        bridgeConfiguration = getConfigAs(AutomowerBridgeConfiguration.class);\n+\n+        final String appKey = bridgeConfiguration.getAppKey();\n+        final String userName = bridgeConfiguration.getUserName();\n+        final String password = bridgeConfiguration.getPassword();\n+        if (appKey == null || appKey.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-app-key\");\n+        } else if (userName == null || userName.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-username\");\n+        } else if (password == null || password.isEmpty()) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"@text/conf-error-no-password\");\n+        } else {\n+            if (bridge == null) {\n+                bridge = new AutomowerBridge(appKey, userName, password, httpClient, scheduler);\n+                startAutomowerBridgePolling(bridge);\n+            }\n+            updateStatus(ThingStatus.UNKNOWN);\n+        }\n+    }\n+\n+    private void startAutomowerBridgePolling(AutomowerBridge bridge) {\n+        ScheduledFuture<?> currentPollingJob = automowerBridgePollingJob;\n+        if (currentPollingJob == null) {\n+            if (bridgeConfiguration.getPollingInterval() < 1) {\n+                logger.info(\"No valid polling interval specified. Using default value: {}s\", automowerPollingIntervalS);\n+            } else {\n+                automowerPollingIntervalS = bridgeConfiguration.getPollingInterval();\n+            }\n+            automowerBridgePollingJob = scheduler.scheduleWithFixedDelay(\n+                    new AutomowerBridgePollingRunnable(this, bridge), 1, automowerPollingIntervalS, TimeUnit.SECONDS);\n+        }\n+    }\n+\n+    private void stopAutomowerBridgePolling(AutomowerBridge bridge) {\n+        ScheduledFuture<?> currentPollingJob = automowerBridgePollingJob;\n+        if (currentPollingJob != null) {\n+            currentPollingJob.cancel(true);\n+            automowerBridgePollingJob = null;\n+        }\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+    }\n+\n+    public AutomowerBridge getAutomowerBridge() {\n+        return bridge;\n+    }\n+\n+    public Optional<MowerListResult> getAutomowers() {\n+        try {\n+            return Optional.of(bridge.getAutomowers());\n+        } catch (AutomowerCommunicationException e) {\n+            logger.debug(\"Bridge cannot get list of available automowers\", e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ4ODY2Mw=="}, "originalCommit": {"oid": "8a87ebbfcc7f4c38923f43aaac0d554112d65bd5"}, "originalPosition": 152}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NzQ0MDE1OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/HusqvarnaApi.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxODowNzozM1rOG5EIaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMDo0MTo1N1rOG5JYgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ4OTcwNw==", "bodyText": "Did you encounter a case where the HTTP client is not running?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r462489707", "createdAt": "2020-07-29T18:07:33Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/HusqvarnaApi.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.rest.api;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+\n+/**\n+ * Base class for the Husqvarna apis\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public abstract class HusqvarnaApi {\n+\n+    private final HttpClient httpClient;\n+    protected final Gson gson;\n+\n+    protected HusqvarnaApi(HttpClient httpClient) {\n+        this.httpClient = httpClient;\n+\n+        GsonBuilder gsonBuilder = new GsonBuilder();\n+        gson = gsonBuilder.create();\n+    }\n+\n+    protected abstract String getBaseUrl();\n+\n+    protected HttpClient getHttpClient() throws AutomowerCommunicationException {\n+        if (!httpClient.isRunning()) {\n+            try {\n+                httpClient.start();\n+            } catch (Exception e) {\n+                throw new AutomowerCommunicationException(\"Exception while trying to start http client\", e);\n+            }\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a87ebbfcc7f4c38923f43aaac0d554112d65bd5"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjU0ODc1Ng==", "bodyText": "I was not sure about the status of the httpclient that I get. To avoid starting it multiple times, or having it not started at all, I added the isRunning check. I am not sure if it is already started or not as I get the httpClient from the framework...\nDo you think it is not required at all to start it?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r462548756", "createdAt": "2020-07-29T19:52:31Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/HusqvarnaApi.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.rest.api;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+\n+/**\n+ * Base class for the Husqvarna apis\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public abstract class HusqvarnaApi {\n+\n+    private final HttpClient httpClient;\n+    protected final Gson gson;\n+\n+    protected HusqvarnaApi(HttpClient httpClient) {\n+        this.httpClient = httpClient;\n+\n+        GsonBuilder gsonBuilder = new GsonBuilder();\n+        gson = gsonBuilder.create();\n+    }\n+\n+    protected abstract String getBaseUrl();\n+\n+    protected HttpClient getHttpClient() throws AutomowerCommunicationException {\n+        if (!httpClient.isRunning()) {\n+            try {\n+                httpClient.start();\n+            } catch (Exception e) {\n+                throw new AutomowerCommunicationException(\"Exception while trying to start http client\", e);\n+            }\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ4OTcwNw=="}, "originalCommit": {"oid": "8a87ebbfcc7f4c38923f43aaac0d554112d65bd5"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjU1MDg4OQ==", "bodyText": "I think the framework takes care of starting it. I didn't see it in other bindings. But I can't give a definite answer. Let's wait for the opinion of the second reviewer.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r462550889", "createdAt": "2020-07-29T19:56:30Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/HusqvarnaApi.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.rest.api;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+\n+/**\n+ * Base class for the Husqvarna apis\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public abstract class HusqvarnaApi {\n+\n+    private final HttpClient httpClient;\n+    protected final Gson gson;\n+\n+    protected HusqvarnaApi(HttpClient httpClient) {\n+        this.httpClient = httpClient;\n+\n+        GsonBuilder gsonBuilder = new GsonBuilder();\n+        gson = gsonBuilder.create();\n+    }\n+\n+    protected abstract String getBaseUrl();\n+\n+    protected HttpClient getHttpClient() throws AutomowerCommunicationException {\n+        if (!httpClient.isRunning()) {\n+            try {\n+                httpClient.start();\n+            } catch (Exception e) {\n+                throw new AutomowerCommunicationException(\"Exception while trying to start http client\", e);\n+            }\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ4OTcwNw=="}, "originalCommit": {"oid": "8a87ebbfcc7f4c38923f43aaac0d554112d65bd5"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjU1OTc3OQ==", "bodyText": "I will try without starting it explicitly. I think you are probably right, would be strange to get an httpclient injected that would need to be started. If the binding would be required to start it would also be required to stop it, I guess the client will be shared between bindings...", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r462559779", "createdAt": "2020-07-29T20:12:25Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/HusqvarnaApi.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.rest.api;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+\n+/**\n+ * Base class for the Husqvarna apis\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public abstract class HusqvarnaApi {\n+\n+    private final HttpClient httpClient;\n+    protected final Gson gson;\n+\n+    protected HusqvarnaApi(HttpClient httpClient) {\n+        this.httpClient = httpClient;\n+\n+        GsonBuilder gsonBuilder = new GsonBuilder();\n+        gson = gsonBuilder.create();\n+    }\n+\n+    protected abstract String getBaseUrl();\n+\n+    protected HttpClient getHttpClient() throws AutomowerCommunicationException {\n+        if (!httpClient.isRunning()) {\n+            try {\n+                httpClient.start();\n+            } catch (Exception e) {\n+                throw new AutomowerCommunicationException(\"Exception while trying to start http client\", e);\n+            }\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ4OTcwNw=="}, "originalCommit": {"oid": "8a87ebbfcc7f4c38923f43aaac0d554112d65bd5"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjU3NTc0NQ==", "bodyText": "Ok, seems to work, I completely removed this block", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r462575745", "createdAt": "2020-07-29T20:41:57Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/HusqvarnaApi.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.rest.api;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+\n+/**\n+ * Base class for the Husqvarna apis\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public abstract class HusqvarnaApi {\n+\n+    private final HttpClient httpClient;\n+    protected final Gson gson;\n+\n+    protected HusqvarnaApi(HttpClient httpClient) {\n+        this.httpClient = httpClient;\n+\n+        GsonBuilder gsonBuilder = new GsonBuilder();\n+        gson = gsonBuilder.create();\n+    }\n+\n+    protected abstract String getBaseUrl();\n+\n+    protected HttpClient getHttpClient() throws AutomowerCommunicationException {\n+        if (!httpClient.isRunning()) {\n+            try {\n+                httpClient.start();\n+            } catch (Exception e) {\n+                throw new AutomowerCommunicationException(\"Exception while trying to start http client\", e);\n+            }\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ4OTcwNw=="}, "originalCommit": {"oid": "8a87ebbfcc7f4c38923f43aaac0d554112d65bd5"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NzQ2NjkwOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxODoxNDozMlrOG5EYvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxOTo1MzozOFrOG5HxWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ5Mzg4NQ==", "bodyText": "This field is never read.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r462493885", "createdAt": "2020-07-29T18:14:32Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,283 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandlerService;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.actions.AutomowerActions;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+    private static final String NO_ID = \"NO_ID\";\n+    private static final long DEFAULT_COMMAND_DURATION_MIN = 60;\n+\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+\n+    private @Nullable AutomowerConfiguration config;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a87ebbfcc7f4c38923f43aaac0d554112d65bd5"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjU0OTMzNg==", "bodyText": "yes", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r462549336", "createdAt": "2020-07-29T19:53:38Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,283 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandlerService;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.actions.AutomowerActions;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+    private static final String NO_ID = \"NO_ID\";\n+    private static final long DEFAULT_COMMAND_DURATION_MIN = 60;\n+\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+\n+    private @Nullable AutomowerConfiguration config;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ5Mzg4NQ=="}, "originalCommit": {"oid": "8a87ebbfcc7f4c38923f43aaac0d554112d65bd5"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NzQ5Njg0OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/thing/thing-types.xml", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxODoyMjozM1rOG5ErOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMDoxMzozOFrOG5IcmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ5ODYxNw==", "bodyText": "You could reference the bridge type here, to eliminate the checkstyle warning.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r462498617", "createdAt": "2020-07-29T18:22:33Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -0,0 +1,163 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"automower\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<!-- Automower Bridge Thing Type -->\n+\t<bridge-type id=\"bridge\">\n+\t\t<label>Automower Connect Bridge</label>\n+\t\t<description>The bridge to communicate with the Automower Connect API</description>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"appKey\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Application Key</label>\n+\t\t\t\t<description>The Application Key is required to communication with the Automower Connect Api. It can be obtained by\n+\t\t\t\t\tregistering an Application on the Husqvarna Website. This application also needs to be connected to the\n+\t\t\t\t\t\"Authentication API\" and the \"Automower Connect API\"</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"userName\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>User Name</label>\n+\t\t\t\t<description>The user name for which the application key has been issued</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"password\" type=\"text\" required=\"true\">\n+\t\t\t\t<context>Password</context>\n+\t\t\t\t<description>The password for the given user</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"pollingInterval\" type=\"integer\" required=\"false\" unit=\"s\">\n+\t\t\t\t<label>Polling Interval</label>\n+\t\t\t\t<default>3600</default>\n+\t\t\t\t<description>How often the available automowers should be queried in seconds</description>\n+\t\t\t</parameter>\n+\t\t</config-description>\n+\n+\t</bridge-type>\n+\n+\t<!-- Automower Thing Type -->\n+\t<thing-type id=\"automower\">\n+\t\t<label>Automower</label>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a87ebbfcc7f4c38923f43aaac0d554112d65bd5"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjU1MDI2Ng==", "bodyText": "How would I do this?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r462550266", "createdAt": "2020-07-29T19:55:24Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -0,0 +1,163 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"automower\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<!-- Automower Bridge Thing Type -->\n+\t<bridge-type id=\"bridge\">\n+\t\t<label>Automower Connect Bridge</label>\n+\t\t<description>The bridge to communicate with the Automower Connect API</description>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"appKey\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Application Key</label>\n+\t\t\t\t<description>The Application Key is required to communication with the Automower Connect Api. It can be obtained by\n+\t\t\t\t\tregistering an Application on the Husqvarna Website. This application also needs to be connected to the\n+\t\t\t\t\t\"Authentication API\" and the \"Automower Connect API\"</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"userName\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>User Name</label>\n+\t\t\t\t<description>The user name for which the application key has been issued</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"password\" type=\"text\" required=\"true\">\n+\t\t\t\t<context>Password</context>\n+\t\t\t\t<description>The password for the given user</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"pollingInterval\" type=\"integer\" required=\"false\" unit=\"s\">\n+\t\t\t\t<label>Polling Interval</label>\n+\t\t\t\t<default>3600</default>\n+\t\t\t\t<description>How often the available automowers should be queried in seconds</description>\n+\t\t\t</parameter>\n+\t\t</config-description>\n+\n+\t</bridge-type>\n+\n+\t<!-- Automower Thing Type -->\n+\t<thing-type id=\"automower\">\n+\t\t<label>Automower</label>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ5ODYxNw=="}, "originalCommit": {"oid": "8a87ebbfcc7f4c38923f43aaac0d554112d65bd5"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjU1MTU4NQ==", "bodyText": "With\n\t\t<supported-bridge-type-refs>\n\t\t\t<bridge-type-ref id=\"yourBridgeId\"/>\n\t\t</supported-bridge-type-refs>", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r462551585", "createdAt": "2020-07-29T19:57:51Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -0,0 +1,163 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"automower\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<!-- Automower Bridge Thing Type -->\n+\t<bridge-type id=\"bridge\">\n+\t\t<label>Automower Connect Bridge</label>\n+\t\t<description>The bridge to communicate with the Automower Connect API</description>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"appKey\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Application Key</label>\n+\t\t\t\t<description>The Application Key is required to communication with the Automower Connect Api. It can be obtained by\n+\t\t\t\t\tregistering an Application on the Husqvarna Website. This application also needs to be connected to the\n+\t\t\t\t\t\"Authentication API\" and the \"Automower Connect API\"</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"userName\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>User Name</label>\n+\t\t\t\t<description>The user name for which the application key has been issued</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"password\" type=\"text\" required=\"true\">\n+\t\t\t\t<context>Password</context>\n+\t\t\t\t<description>The password for the given user</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"pollingInterval\" type=\"integer\" required=\"false\" unit=\"s\">\n+\t\t\t\t<label>Polling Interval</label>\n+\t\t\t\t<default>3600</default>\n+\t\t\t\t<description>How often the available automowers should be queried in seconds</description>\n+\t\t\t</parameter>\n+\t\t</config-description>\n+\n+\t</bridge-type>\n+\n+\t<!-- Automower Thing Type -->\n+\t<thing-type id=\"automower\">\n+\t\t<label>Automower</label>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ5ODYxNw=="}, "originalCommit": {"oid": "8a87ebbfcc7f4c38923f43aaac0d554112d65bd5"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjU2MDQwOQ==", "bodyText": "Thanks!", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r462560409", "createdAt": "2020-07-29T20:13:38Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -0,0 +1,163 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"automower\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<!-- Automower Bridge Thing Type -->\n+\t<bridge-type id=\"bridge\">\n+\t\t<label>Automower Connect Bridge</label>\n+\t\t<description>The bridge to communicate with the Automower Connect API</description>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"appKey\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Application Key</label>\n+\t\t\t\t<description>The Application Key is required to communication with the Automower Connect Api. It can be obtained by\n+\t\t\t\t\tregistering an Application on the Husqvarna Website. This application also needs to be connected to the\n+\t\t\t\t\t\"Authentication API\" and the \"Automower Connect API\"</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"userName\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>User Name</label>\n+\t\t\t\t<description>The user name for which the application key has been issued</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"password\" type=\"text\" required=\"true\">\n+\t\t\t\t<context>Password</context>\n+\t\t\t\t<description>The password for the given user</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"pollingInterval\" type=\"integer\" required=\"false\" unit=\"s\">\n+\t\t\t\t<label>Polling Interval</label>\n+\t\t\t\t<default>3600</default>\n+\t\t\t\t<description>How often the available automowers should be queried in seconds</description>\n+\t\t\t</parameter>\n+\t\t</config-description>\n+\n+\t</bridge-type>\n+\n+\t<!-- Automower Thing Type -->\n+\t<thing-type id=\"automower\">\n+\t\t<label>Automower</label>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ5ODYxNw=="}, "originalCommit": {"oid": "8a87ebbfcc7f4c38923f43aaac0d554112d65bd5"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NzUwMzA1OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/actions/IAutomowerActions.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxODoyNDoyNlrOG5EvZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxOTo1NTo1NFrOG5H2TQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ5OTY4NA==", "bodyText": "Please add the @NonnullByDefault annotation.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r462499684", "createdAt": "2020-07-29T18:24:26Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/actions/IAutomowerActions.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.actions;\n+\n+/**\n+ * Actions that can be executed for an automower\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+public interface IAutomowerActions {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a87ebbfcc7f4c38923f43aaac0d554112d65bd5"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjU1MDYwNQ==", "bodyText": "yes", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r462550605", "createdAt": "2020-07-29T19:55:54Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/actions/IAutomowerActions.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.actions;\n+\n+/**\n+ * Actions that can be executed for an automower\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+public interface IAutomowerActions {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ5OTY4NA=="}, "originalCommit": {"oid": "8a87ebbfcc7f4c38923f43aaac0d554112d65bd5"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4ODE2NzQyOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/HusqvarnaApi.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMTozODo1MVrOG5LLRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQyMDo1ODoxMVrOG5zlog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjYwNTEyNQ==", "bodyText": "This throws declaration can be removed, then.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r462605125", "createdAt": "2020-07-29T21:38:51Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/HusqvarnaApi.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.rest.api;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+\n+/**\n+ * Base class for the Husqvarna apis\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public abstract class HusqvarnaApi {\n+\n+    private final HttpClient httpClient;\n+    protected final Gson gson;\n+\n+    protected HusqvarnaApi(HttpClient httpClient) {\n+        this.httpClient = httpClient;\n+\n+        GsonBuilder gsonBuilder = new GsonBuilder();\n+        gson = gsonBuilder.create();\n+    }\n+\n+    protected abstract String getBaseUrl();\n+\n+    protected HttpClient getHttpClient() throws AutomowerCommunicationException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfe079491133704addb653e14296cbd797d2bc72"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI2NzIzNA==", "bodyText": "yes", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r463267234", "createdAt": "2020-07-30T20:58:11Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/HusqvarnaApi.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.rest.api;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+\n+/**\n+ * Base class for the Husqvarna apis\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public abstract class HusqvarnaApi {\n+\n+    private final HttpClient httpClient;\n+    protected final Gson gson;\n+\n+    protected HusqvarnaApi(HttpClient httpClient) {\n+        this.httpClient = httpClient;\n+\n+        GsonBuilder gsonBuilder = new GsonBuilder();\n+        gson = gsonBuilder.create();\n+    }\n+\n+    protected abstract String getBaseUrl();\n+\n+    protected HttpClient getHttpClient() throws AutomowerCommunicationException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjYwNTEyNQ=="}, "originalCommit": {"oid": "dfe079491133704addb653e14296cbd797d2bc72"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4ODE3MjYzOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/exceptions/AutomowerCommunicationException.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMTo0MDoyM1rOG5LOYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQyMDo1ODo1NFrOG5znHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjYwNTkyMQ==", "bodyText": "Can you handle the serializable compiler warnings in the exception classes?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r462605921", "createdAt": "2020-07-29T21:40:23Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/exceptions/AutomowerCommunicationException.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.rest.exceptions;\n+\n+import java.io.IOException;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+\n+/**\n+ * An exception that occurred while communicating with an automower or an automower bridge\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerCommunicationException extends IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfe079491133704addb653e14296cbd797d2bc72"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI2NzYxMw==", "bodyText": "yes", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r463267613", "createdAt": "2020-07-30T20:58:54Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/exceptions/AutomowerCommunicationException.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.rest.exceptions;\n+\n+import java.io.IOException;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+\n+/**\n+ * An exception that occurred while communicating with an automower or an automower bridge\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerCommunicationException extends IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjYwNTkyMQ=="}, "originalCommit": {"oid": "dfe079491133704addb653e14296cbd797d2bc72"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4ODE3OTc5OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMTo0MzowMFrOG5LSzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQyMTowMDoxNFrOG5zqGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjYwNzA1Mg==", "bodyText": "bridge should be stored to a local variable before doing the null check. That fixes the compiler error.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r462607052", "createdAt": "2020-07-29T21:43:00Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+    private static final long DEFAULT_POLLING_INTERVAL_S = TimeUnit.HOURS.toSeconds(1);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+\n+    private @Nullable AutomowerBridge bridge;\n+    private final HttpClient httpClient;\n+\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.debug(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers: {}\", e.getMessage());\n+            }\n+        }\n+    }\n+\n+    public AutomowerBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        if (bridge != null) {\n+            stopAutomowerBridgePolling(bridge);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfe079491133704addb653e14296cbd797d2bc72"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI2ODM3OA==", "bodyText": "ok", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r463268378", "createdAt": "2020-07-30T21:00:14Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+    private static final long DEFAULT_POLLING_INTERVAL_S = TimeUnit.HOURS.toSeconds(1);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+\n+    private @Nullable AutomowerBridge bridge;\n+    private final HttpClient httpClient;\n+\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.debug(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers: {}\", e.getMessage());\n+            }\n+        }\n+    }\n+\n+    public AutomowerBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        if (bridge != null) {\n+            stopAutomowerBridgePolling(bridge);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjYwNzA1Mg=="}, "originalCommit": {"oid": "dfe079491133704addb653e14296cbd797d2bc72"}, "originalPosition": 90}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NzAxMDAzOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMVQxMDo1OTo1NlrOG6dT-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMVQyMTozMDozOFrOG6gcaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk1MDg0Mg==", "bodyText": "You might want to set bridge to null.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r463950842", "createdAt": "2020-08-01T10:59:56Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -86,9 +86,10 @@ public AutomowerBridgeHandler(Bridge bridge, HttpClient httpClient) {\n \n     @Override\n     public void dispose() {\n-        if (bridge != null) {\n-            stopAutomowerBridgePolling(bridge);\n-            bridge = null;\n+        AutomowerBridge currentBridge = bridge;\n+        if (currentBridge != null) {\n+            stopAutomowerBridgePolling(currentBridge);\n+            currentBridge = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "412933faee7635dcd90bcaff827e3203ddcdc9a1"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDAwMjE1NQ==", "bodyText": "yes", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r464002155", "createdAt": "2020-08-01T21:30:38Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -86,9 +86,10 @@ public AutomowerBridgeHandler(Bridge bridge, HttpClient httpClient) {\n \n     @Override\n     public void dispose() {\n-        if (bridge != null) {\n-            stopAutomowerBridgePolling(bridge);\n-            bridge = null;\n+        AutomowerBridge currentBridge = bridge;\n+        if (currentBridge != null) {\n+            stopAutomowerBridgePolling(currentBridge);\n+            currentBridge = null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk1MDg0Mg=="}, "originalCommit": {"oid": "412933faee7635dcd90bcaff827e3203ddcdc9a1"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4NDA2ODE1OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/README.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMzo0NzowN1rOHHM5ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxOTowOToyNlrOHQ-paw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMxMzQzOA==", "bodyText": "Can you format the table. You can use: http://markdowntable.com/", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r477313438", "createdAt": "2020-08-26T13:47:07Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.automower/README.md", "diffHunk": "@@ -0,0 +1,123 @@\n+# Automower Binding\n+\n+This binding communicates to the Husqvarna Automower Connect API in order to send commands and query the state of Husqvarna Automower robots.\n+\n+## Supported Things\n+\n+`bridge:` The bridge needs to be configured with credentials and an application key that allows communicating with the Automower Connect Api\n+\n+`automower:` A single Husqvarna Automower robot\n+\n+Basically all Husqvarna Automower models with \"Automower Connect\" support should be supported. It was tested only with a Husqvarna Automower 450X\n+\n+\n+## Discovery\n+\n+Once the bridge is created and configured, registered automowers will be discovered automatically\n+\n+\n+## Thing Configuration\n+\n+`bridge:`\n+\n+- appKey (mandatory): The Application Key is required to communication with the Automower Connect Api. It can be obtained by registering an Application on the Husqvarna Website. This application also needs to be connected to the \"Authentication API\" and the \"Automower Connect API\"\n+- userName (mandatory): The user name for which the application key has been issued\n+- password (mandatory): The password for the given user\n+- pollingInterval (optional): How often the bridge state should be queried in seconds. Default is 1h (3600s)\n+\n+Keep in mind that the status of the bridge should not be queried too often. According to the Husqvarna documentation not more than 10000 requests per month and application key are allowed. With the default value of 1h this would mean ~720 requests per month for the bridge state\n+\n+`automower:`\n+\n+- mowerId (mandatory): The Id of an automower as used by the Automower Connect Api to identify a mower. This is automatically filled when the thing is discovered\n+- pollingInterval (optional): How often the current automower state should be polled in seconds. Default is 10min (600s)\n+\n+Keep in mind that the status of the automowers should not be queried too often. According to the Husqvarna documentation not more than 10000 requests per month and application key are allowed. With the default value of 10min this would mean ~4300 requests per month per automower\n+\n+## Channels\n+\n+\n+| channel  | type   | description                  |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU2NTY3NQ==", "bodyText": "Yes, thanks for th link!", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r487565675", "createdAt": "2020-09-13T19:09:26Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/README.md", "diffHunk": "@@ -0,0 +1,123 @@\n+# Automower Binding\n+\n+This binding communicates to the Husqvarna Automower Connect API in order to send commands and query the state of Husqvarna Automower robots.\n+\n+## Supported Things\n+\n+`bridge:` The bridge needs to be configured with credentials and an application key that allows communicating with the Automower Connect Api\n+\n+`automower:` A single Husqvarna Automower robot\n+\n+Basically all Husqvarna Automower models with \"Automower Connect\" support should be supported. It was tested only with a Husqvarna Automower 450X\n+\n+\n+## Discovery\n+\n+Once the bridge is created and configured, registered automowers will be discovered automatically\n+\n+\n+## Thing Configuration\n+\n+`bridge:`\n+\n+- appKey (mandatory): The Application Key is required to communication with the Automower Connect Api. It can be obtained by registering an Application on the Husqvarna Website. This application also needs to be connected to the \"Authentication API\" and the \"Automower Connect API\"\n+- userName (mandatory): The user name for which the application key has been issued\n+- password (mandatory): The password for the given user\n+- pollingInterval (optional): How often the bridge state should be queried in seconds. Default is 1h (3600s)\n+\n+Keep in mind that the status of the bridge should not be queried too often. According to the Husqvarna documentation not more than 10000 requests per month and application key are allowed. With the default value of 1h this would mean ~720 requests per month for the bridge state\n+\n+`automower:`\n+\n+- mowerId (mandatory): The Id of an automower as used by the Automower Connect Api to identify a mower. This is automatically filled when the thing is discovered\n+- pollingInterval (optional): How often the current automower state should be polled in seconds. Default is 10min (600s)\n+\n+Keep in mind that the status of the automowers should not be queried too often. According to the Husqvarna documentation not more than 10000 requests per month and application key are allowed. With the default value of 10min this would mean ~4300 requests per month per automower\n+\n+## Channels\n+\n+\n+| channel  | type   | description                  |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMxMzQzOA=="}, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4NDA3ODMyOnYy", "diffSide": "RIGHT", "path": "bundles/pom.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMzo0OTowNVrOHHM_vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxOToxMDozMVrOHQ-p6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMxNTAwNg==", "bodyText": "Indentation.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r477315006", "createdAt": "2020-08-26T13:49:05Z", "author": {"login": "Hilbrand"}, "path": "bundles/pom.xml", "diffHunk": "@@ -48,6 +48,7 @@\n     <module>org.openhab.binding.astro</module>\n     <module>org.openhab.binding.atlona</module>\n     <module>org.openhab.binding.autelis</module>\n+\t<module>org.openhab.binding.automower</module>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU2NTgwMw==", "bodyText": "yes", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r487565803", "createdAt": "2020-09-13T19:10:31Z", "author": {"login": "maxpg"}, "path": "bundles/pom.xml", "diffHunk": "@@ -48,6 +48,7 @@\n     <module>org.openhab.binding.astro</module>\n     <module>org.openhab.binding.atlona</module>\n     <module>org.openhab.binding.autelis</module>\n+\t<module>org.openhab.binding.automower</module>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMxNTAwNg=="}, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4NDA4MjMzOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/thing/thing-types.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMzo0OTo0NFrOHHNB8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxOToxMzoyNVrOHQ-rJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMxNTU3MA==", "bodyText": "Either add description text or leave out empty elements.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r477315570", "createdAt": "2020-08-26T13:49:44Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -0,0 +1,167 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"automower\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<!-- Automower Bridge Thing Type -->\n+\t<bridge-type id=\"bridge\">\n+\t\t<label>Automower Connect Bridge</label>\n+\t\t<description>The bridge to communicate with the Automower Connect API</description>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"appKey\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Application Key</label>\n+\t\t\t\t<description>The Application Key is required to communication with the Automower Connect Api. It can be obtained by\n+\t\t\t\t\tregistering an Application on the Husqvarna Website. This application also needs to be connected to the\n+\t\t\t\t\t\"Authentication API\" and the \"Automower Connect API\"</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"userName\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>User Name</label>\n+\t\t\t\t<description>The user name for which the application key has been issued</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"password\" type=\"text\" required=\"true\">\n+\t\t\t\t<context>Password</context>\n+\t\t\t\t<description>The password for the given user</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"pollingInterval\" type=\"integer\" required=\"false\" unit=\"s\">\n+\t\t\t\t<label>Polling Interval</label>\n+\t\t\t\t<default>3600</default>\n+\t\t\t\t<description>How often the available automowers should be queried in seconds</description>\n+\t\t\t</parameter>\n+\t\t</config-description>\n+\n+\t</bridge-type>\n+\n+\t<!-- Automower Thing Type -->\n+\t<thing-type id=\"automower\">\n+\t\t<supported-bridge-type-refs>\n+\t\t\t<bridge-type-ref id=\"bridge\"/>\n+\t\t</supported-bridge-type-refs>\n+\n+\t\t<label>Automower</label>\n+\t\t<description>An automatic lawn mower</description>\n+\n+\t\t<channels>\n+\t\t\t<channel id=\"name\" typeId=\"nameType\"/>\n+\t\t\t<channel id=\"mode\" typeId=\"modeType\"/>\n+\t\t\t<channel id=\"activity\" typeId=\"activityType\"/>\n+\t\t\t<channel id=\"state\" typeId=\"stateType\"/>\n+\t\t\t<channel id=\"last-update\" typeId=\"lastUpdateType\"/>\n+\t\t\t<channel id=\"battery\" typeId=\"batteryType\"/>\n+\t\t\t<channel id=\"error-code\" typeId=\"errorCodeType\"/>\n+\t\t\t<channel id=\"error-timestamp\" typeId=\"errorTimestampType\"/>\n+\t\t</channels>\n+\n+\t\t<properties>\n+\t\t\t<property name=\"mowerId\">N/A</property>\n+\t\t\t<property name=\"mowerName\">N/A</property>\n+\t\t\t<property name=\"mowerModel\">N/A</property>\n+\t\t\t<property name=\"mowerSerialNumber\">N/A</property>\n+\t\t</properties>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"mowerId\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Automower Id</label>\n+\t\t\t\t<description>The Id of an automower as used by the Automower Connect Api to identify a mower</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"pollingInterval\" type=\"integer\" required=\"false\" unit=\"s\">\n+\t\t\t\t<label>Polling Interval</label>\n+\t\t\t\t<default>600</default>\n+\t\t\t\t<description>How often the current automower state should be polled in seconds</description>\n+\t\t\t</parameter>\n+\t\t</config-description>\n+\n+\t</thing-type>\n+\n+\t<channel-type id=\"nameType\">\n+\t\t<item-type>String</item-type>\n+\t\t<label>Automower Name</label>\n+\t\t<description>The channel providing the automower name</description>\n+\t\t<state readOnly=\"true\"/>\n+\t</channel-type>\n+\n+\t<channel-type id=\"modeType\">\n+\t\t<item-type>String</item-type>\n+\t\t<label>Mode</label>\n+\t\t<description>The current mode</description>\n+\t\t<state readOnly=\"true\">\n+\t\t\t<options>\n+\t\t\t\t<option value=\"MAIN_AREA\">Main Area</option>\n+\t\t\t\t<option value=\"SECONDARY_AREA\">Secondary Area</option>\n+\t\t\t\t<option value=\"HOME\">Home</option>\n+\t\t\t\t<option value=\"DEMO\">Demo</option>\n+\t\t\t\t<option value=\"UNKNOWN\">Unknown</option>\n+\t\t\t</options>\n+\t\t</state>\n+\t</channel-type>\n+\n+\t<channel-type id=\"activityType\">\n+\t\t<item-type>String</item-type>\n+\t\t<label>Activity</label>\n+\t\t<description>The current activity</description>\n+\t\t<state readOnly=\"true\">\n+\t\t\t<options>\n+\t\t\t\t<option value=\"UNKNOWN\">Unknown</option>\n+\t\t\t\t<option value=\"NOT_APPLICABLE\">N/A</option>\n+\t\t\t\t<option value=\"MOWING\">Mowing</option>\n+\t\t\t\t<option value=\"GOING_HOME\">Returning to charging station</option>\n+\t\t\t\t<option value=\"CHARGING\">Charging</option>\n+\t\t\t\t<option value=\"LEAVING\">Leaving charging station</option>\n+\t\t\t\t<option value=\"PARKED_IN_CS\">Parked in charging station</option>\n+\t\t\t\t<option value=\"STOPPED_IN_GARDEN\">Stopped in garden</option>\n+\t\t\t</options>\n+\t\t</state>\n+\t</channel-type>\n+\n+\t<channel-type id=\"stateType\">\n+\t\t<item-type>String</item-type>\n+\t\t<label>State</label>\n+\t\t<description>The current state</description>\n+\t\t<state readOnly=\"true\">\n+\t\t\t<options>\n+\t\t\t\t<option value=\"UNKNOWN\">Unknown</option>\n+\t\t\t\t<option value=\"NOT_APPLICABLE\">N/A</option>\n+\t\t\t\t<option value=\"PAUSED\">Paused by user</option>\n+\t\t\t\t<option value=\"IN_OPERATION\">Working</option>\n+\t\t\t\t<option value=\"WAIT_UPDATING\">Downloading new firmware</option>\n+\t\t\t\t<option value=\"WAIT_POWER_UP\">Booting mower</option>\n+\t\t\t\t<option value=\"RESTRICTED\">Waiting</option>\n+\t\t\t\t<option value=\"OFF\">Off</option>\n+\t\t\t\t<option value=\"STOPPED\">Stopped- Manual intervention required</option>\n+\t\t\t\t<option value=\"ERROR\">Error</option>\n+\t\t\t\t<option value=\"FATAL_ERROR\">Fatal error</option>\n+\t\t\t\t<option value=\"ERROR_AT_POWER_UP\">Boot error</option>\n+\t\t\t</options>\n+\t\t</state>\n+\t</channel-type>\n+\n+\t<channel-type id=\"lastUpdateType\">\n+\t\t<item-type>DateTime</item-type>\n+\t\t<label>Last Update</label>\n+\t\t<description></description>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 142}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU2NjExNw==", "bodyText": "yes", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r487566117", "createdAt": "2020-09-13T19:13:25Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -0,0 +1,167 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"automower\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<!-- Automower Bridge Thing Type -->\n+\t<bridge-type id=\"bridge\">\n+\t\t<label>Automower Connect Bridge</label>\n+\t\t<description>The bridge to communicate with the Automower Connect API</description>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"appKey\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Application Key</label>\n+\t\t\t\t<description>The Application Key is required to communication with the Automower Connect Api. It can be obtained by\n+\t\t\t\t\tregistering an Application on the Husqvarna Website. This application also needs to be connected to the\n+\t\t\t\t\t\"Authentication API\" and the \"Automower Connect API\"</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"userName\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>User Name</label>\n+\t\t\t\t<description>The user name for which the application key has been issued</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"password\" type=\"text\" required=\"true\">\n+\t\t\t\t<context>Password</context>\n+\t\t\t\t<description>The password for the given user</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"pollingInterval\" type=\"integer\" required=\"false\" unit=\"s\">\n+\t\t\t\t<label>Polling Interval</label>\n+\t\t\t\t<default>3600</default>\n+\t\t\t\t<description>How often the available automowers should be queried in seconds</description>\n+\t\t\t</parameter>\n+\t\t</config-description>\n+\n+\t</bridge-type>\n+\n+\t<!-- Automower Thing Type -->\n+\t<thing-type id=\"automower\">\n+\t\t<supported-bridge-type-refs>\n+\t\t\t<bridge-type-ref id=\"bridge\"/>\n+\t\t</supported-bridge-type-refs>\n+\n+\t\t<label>Automower</label>\n+\t\t<description>An automatic lawn mower</description>\n+\n+\t\t<channels>\n+\t\t\t<channel id=\"name\" typeId=\"nameType\"/>\n+\t\t\t<channel id=\"mode\" typeId=\"modeType\"/>\n+\t\t\t<channel id=\"activity\" typeId=\"activityType\"/>\n+\t\t\t<channel id=\"state\" typeId=\"stateType\"/>\n+\t\t\t<channel id=\"last-update\" typeId=\"lastUpdateType\"/>\n+\t\t\t<channel id=\"battery\" typeId=\"batteryType\"/>\n+\t\t\t<channel id=\"error-code\" typeId=\"errorCodeType\"/>\n+\t\t\t<channel id=\"error-timestamp\" typeId=\"errorTimestampType\"/>\n+\t\t</channels>\n+\n+\t\t<properties>\n+\t\t\t<property name=\"mowerId\">N/A</property>\n+\t\t\t<property name=\"mowerName\">N/A</property>\n+\t\t\t<property name=\"mowerModel\">N/A</property>\n+\t\t\t<property name=\"mowerSerialNumber\">N/A</property>\n+\t\t</properties>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"mowerId\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Automower Id</label>\n+\t\t\t\t<description>The Id of an automower as used by the Automower Connect Api to identify a mower</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"pollingInterval\" type=\"integer\" required=\"false\" unit=\"s\">\n+\t\t\t\t<label>Polling Interval</label>\n+\t\t\t\t<default>600</default>\n+\t\t\t\t<description>How often the current automower state should be polled in seconds</description>\n+\t\t\t</parameter>\n+\t\t</config-description>\n+\n+\t</thing-type>\n+\n+\t<channel-type id=\"nameType\">\n+\t\t<item-type>String</item-type>\n+\t\t<label>Automower Name</label>\n+\t\t<description>The channel providing the automower name</description>\n+\t\t<state readOnly=\"true\"/>\n+\t</channel-type>\n+\n+\t<channel-type id=\"modeType\">\n+\t\t<item-type>String</item-type>\n+\t\t<label>Mode</label>\n+\t\t<description>The current mode</description>\n+\t\t<state readOnly=\"true\">\n+\t\t\t<options>\n+\t\t\t\t<option value=\"MAIN_AREA\">Main Area</option>\n+\t\t\t\t<option value=\"SECONDARY_AREA\">Secondary Area</option>\n+\t\t\t\t<option value=\"HOME\">Home</option>\n+\t\t\t\t<option value=\"DEMO\">Demo</option>\n+\t\t\t\t<option value=\"UNKNOWN\">Unknown</option>\n+\t\t\t</options>\n+\t\t</state>\n+\t</channel-type>\n+\n+\t<channel-type id=\"activityType\">\n+\t\t<item-type>String</item-type>\n+\t\t<label>Activity</label>\n+\t\t<description>The current activity</description>\n+\t\t<state readOnly=\"true\">\n+\t\t\t<options>\n+\t\t\t\t<option value=\"UNKNOWN\">Unknown</option>\n+\t\t\t\t<option value=\"NOT_APPLICABLE\">N/A</option>\n+\t\t\t\t<option value=\"MOWING\">Mowing</option>\n+\t\t\t\t<option value=\"GOING_HOME\">Returning to charging station</option>\n+\t\t\t\t<option value=\"CHARGING\">Charging</option>\n+\t\t\t\t<option value=\"LEAVING\">Leaving charging station</option>\n+\t\t\t\t<option value=\"PARKED_IN_CS\">Parked in charging station</option>\n+\t\t\t\t<option value=\"STOPPED_IN_GARDEN\">Stopped in garden</option>\n+\t\t\t</options>\n+\t\t</state>\n+\t</channel-type>\n+\n+\t<channel-type id=\"stateType\">\n+\t\t<item-type>String</item-type>\n+\t\t<label>State</label>\n+\t\t<description>The current state</description>\n+\t\t<state readOnly=\"true\">\n+\t\t\t<options>\n+\t\t\t\t<option value=\"UNKNOWN\">Unknown</option>\n+\t\t\t\t<option value=\"NOT_APPLICABLE\">N/A</option>\n+\t\t\t\t<option value=\"PAUSED\">Paused by user</option>\n+\t\t\t\t<option value=\"IN_OPERATION\">Working</option>\n+\t\t\t\t<option value=\"WAIT_UPDATING\">Downloading new firmware</option>\n+\t\t\t\t<option value=\"WAIT_POWER_UP\">Booting mower</option>\n+\t\t\t\t<option value=\"RESTRICTED\">Waiting</option>\n+\t\t\t\t<option value=\"OFF\">Off</option>\n+\t\t\t\t<option value=\"STOPPED\">Stopped- Manual intervention required</option>\n+\t\t\t\t<option value=\"ERROR\">Error</option>\n+\t\t\t\t<option value=\"FATAL_ERROR\">Fatal error</option>\n+\t\t\t\t<option value=\"ERROR_AT_POWER_UP\">Boot error</option>\n+\t\t\t</options>\n+\t\t</state>\n+\t</channel-type>\n+\n+\t<channel-type id=\"lastUpdateType\">\n+\t\t<item-type>DateTime</item-type>\n+\t\t<label>Last Update</label>\n+\t\t<description></description>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMxNTU3MA=="}, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 142}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4NDA5MjAxOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMzo1MTo0MFrOHHNHqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxOToyMjowM1rOHQ-ufw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMxNzAzNQ==", "bodyText": "command param duplicated in JavaDoc", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r477317035", "createdAt": "2020-08-26T13:51:40Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,285 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.time.Instant;\n+import java.time.ZoneId;\n+import java.time.ZonedDateTime;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandlerService;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.actions.AutomowerActions;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+    private static final String NO_ID = \"NO_ID\";\n+    private static final long DEFAULT_COMMAND_DURATION_MIN = 60;\n+    private static final long DEFAULT_POLLING_INTERVAL_S = TimeUnit.MINUTES.toSeconds(10);\n+\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private long lastQueryTimeMs = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+        }\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public Collection<Class<? extends ThingHandlerService>> getServices() {\n+        return Collections.singleton(AutomowerActions.class);\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            AutomowerConfiguration currentConfig = getConfigAs(AutomowerConfiguration.class);\n+            final String configMowerId = currentConfig.getMowerId();\n+            final Integer pollingIntervalS = currentConfig.getPollingInterval();\n+\n+            if (configMowerId == null) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            } else if (pollingIntervalS != null && pollingIntervalS < 1) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-invalid-polling-interval\");\n+            } else {\n+                automowerId.set(configMowerId);\n+                startAutomowerPolling(pollingIntervalS);\n+            }\n+\n+        } else {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        if (!automowerId.get().equals(NO_ID)) {\n+            stopAutomowerPolling();\n+            automowerId.set(NO_ID);\n+        }\n+    }\n+\n+    private void startAutomowerPolling(@Nullable Integer pollingIntervalS) {\n+        if (automowerPollingJob == null) {\n+            final long pollingIntervalToUse = pollingIntervalS == null ? DEFAULT_POLLING_INTERVAL_S : pollingIntervalS;\n+            automowerPollingJob = scheduler.scheduleWithFixedDelay(new AutomowerPollingRunnable(), 1,\n+                    pollingIntervalToUse, TimeUnit.SECONDS);\n+        }\n+    }\n+\n+    private void stopAutomowerPolling() {\n+        if (automowerPollingJob != null) {\n+            automowerPollingJob.cancel(true);\n+            automowerPollingJob = null;\n+        }\n+    }\n+\n+    private boolean isValidResult(Mower mower) {\n+        return mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getBattery() != null && mower.getAttributes().getSystem() != null;\n+    }\n+\n+    private boolean isConnected(Mower mower) {\n+        return mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getMetadata().isConnected();\n+    }\n+\n+    private synchronized void updateAutomowerState() {\n+        if (System.nanoTime() - lastQueryTimeMs > maxQueryFrequencyNanos) {\n+            lastQueryTimeMs = System.nanoTime();\n+            String id = automowerId.get();\n+            try {\n+                AutomowerBridge automowerBridge = getAutomowerBridge();\n+                if (automowerBridge != null) {\n+                    Mower mower = automowerBridge.getAutomowerStatus(id);\n+\n+                    if (isValidResult(mower)) {\n+                        initializeProperties(mower);\n+\n+                        updateChannelState(mower);\n+\n+                        if (isConnected(mower)) {\n+                            updateStatus(ThingStatus.ONLINE);\n+                        } else {\n+                            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                                    \"@text/comm-error-mower-not-connected-to-cloud\");\n+                        }\n+                    } else {\n+                        updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                                \"@text/comm-error-query-mower-failed\");\n+                    }\n+                } else {\n+                    updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                            \"@text/conf-error-no-bridge\");\n+                }\n+            } catch (AutomowerCommunicationException e) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mower-failed\");\n+                logger.warn(\"Unable to query automower status for:  {}. Error: {}\", id, e.getMessage());\n+            }\n+        }\n+    }\n+\n+    /**\n+     * Sends a command to the automower with the default duration of 60min\n+     *\n+     * @param command The command that should be sent. Valid values are: \"Start\", \"ResumeSchedule\", \"Pause\", \"Park\",\n+     *            \"ParkUntilNextSchedule\", \"ParkUntilFurtherNotice\"\n+     *\n+     * @param command", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 218}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU2Njk3NQ==", "bodyText": "thx", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r487566975", "createdAt": "2020-09-13T19:22:03Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,285 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.time.Instant;\n+import java.time.ZoneId;\n+import java.time.ZonedDateTime;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandlerService;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.actions.AutomowerActions;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+    private static final String NO_ID = \"NO_ID\";\n+    private static final long DEFAULT_COMMAND_DURATION_MIN = 60;\n+    private static final long DEFAULT_POLLING_INTERVAL_S = TimeUnit.MINUTES.toSeconds(10);\n+\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private long lastQueryTimeMs = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+        }\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public Collection<Class<? extends ThingHandlerService>> getServices() {\n+        return Collections.singleton(AutomowerActions.class);\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            AutomowerConfiguration currentConfig = getConfigAs(AutomowerConfiguration.class);\n+            final String configMowerId = currentConfig.getMowerId();\n+            final Integer pollingIntervalS = currentConfig.getPollingInterval();\n+\n+            if (configMowerId == null) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            } else if (pollingIntervalS != null && pollingIntervalS < 1) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-invalid-polling-interval\");\n+            } else {\n+                automowerId.set(configMowerId);\n+                startAutomowerPolling(pollingIntervalS);\n+            }\n+\n+        } else {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        if (!automowerId.get().equals(NO_ID)) {\n+            stopAutomowerPolling();\n+            automowerId.set(NO_ID);\n+        }\n+    }\n+\n+    private void startAutomowerPolling(@Nullable Integer pollingIntervalS) {\n+        if (automowerPollingJob == null) {\n+            final long pollingIntervalToUse = pollingIntervalS == null ? DEFAULT_POLLING_INTERVAL_S : pollingIntervalS;\n+            automowerPollingJob = scheduler.scheduleWithFixedDelay(new AutomowerPollingRunnable(), 1,\n+                    pollingIntervalToUse, TimeUnit.SECONDS);\n+        }\n+    }\n+\n+    private void stopAutomowerPolling() {\n+        if (automowerPollingJob != null) {\n+            automowerPollingJob.cancel(true);\n+            automowerPollingJob = null;\n+        }\n+    }\n+\n+    private boolean isValidResult(Mower mower) {\n+        return mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getBattery() != null && mower.getAttributes().getSystem() != null;\n+    }\n+\n+    private boolean isConnected(Mower mower) {\n+        return mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getMetadata().isConnected();\n+    }\n+\n+    private synchronized void updateAutomowerState() {\n+        if (System.nanoTime() - lastQueryTimeMs > maxQueryFrequencyNanos) {\n+            lastQueryTimeMs = System.nanoTime();\n+            String id = automowerId.get();\n+            try {\n+                AutomowerBridge automowerBridge = getAutomowerBridge();\n+                if (automowerBridge != null) {\n+                    Mower mower = automowerBridge.getAutomowerStatus(id);\n+\n+                    if (isValidResult(mower)) {\n+                        initializeProperties(mower);\n+\n+                        updateChannelState(mower);\n+\n+                        if (isConnected(mower)) {\n+                            updateStatus(ThingStatus.ONLINE);\n+                        } else {\n+                            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                                    \"@text/comm-error-mower-not-connected-to-cloud\");\n+                        }\n+                    } else {\n+                        updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                                \"@text/comm-error-query-mower-failed\");\n+                    }\n+                } else {\n+                    updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                            \"@text/conf-error-no-bridge\");\n+                }\n+            } catch (AutomowerCommunicationException e) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mower-failed\");\n+                logger.warn(\"Unable to query automower status for:  {}. Error: {}\", id, e.getMessage());\n+            }\n+        }\n+    }\n+\n+    /**\n+     * Sends a command to the automower with the default duration of 60min\n+     *\n+     * @param command The command that should be sent. Valid values are: \"Start\", \"ResumeSchedule\", \"Pause\", \"Park\",\n+     *            \"ParkUntilNextSchedule\", \"ParkUntilFurtherNotice\"\n+     *\n+     * @param command", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMxNzAzNQ=="}, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 218}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4NDExMzY1OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMzo1NTo0MVrOHHNUkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOVQyMTo0MjozMFrOHUx5ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMyMDMzNw==", "bodyText": "We have a class org.eclipse.smarthome.core.cache.ExpiringCache that is generally used for these kind of use cases. So you don't have to do the time calculation yourself.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r477320337", "createdAt": "2020-08-26T13:55:41Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,285 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.time.Instant;\n+import java.time.ZoneId;\n+import java.time.ZonedDateTime;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandlerService;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.actions.AutomowerActions;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+    private static final String NO_ID = \"NO_ID\";\n+    private static final long DEFAULT_COMMAND_DURATION_MIN = 60;\n+    private static final long DEFAULT_POLLING_INTERVAL_S = TimeUnit.MINUTES.toSeconds(10);\n+\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private long lastQueryTimeMs = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+        }\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public Collection<Class<? extends ThingHandlerService>> getServices() {\n+        return Collections.singleton(AutomowerActions.class);\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            AutomowerConfiguration currentConfig = getConfigAs(AutomowerConfiguration.class);\n+            final String configMowerId = currentConfig.getMowerId();\n+            final Integer pollingIntervalS = currentConfig.getPollingInterval();\n+\n+            if (configMowerId == null) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            } else if (pollingIntervalS != null && pollingIntervalS < 1) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-invalid-polling-interval\");\n+            } else {\n+                automowerId.set(configMowerId);\n+                startAutomowerPolling(pollingIntervalS);\n+            }\n+\n+        } else {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        if (!automowerId.get().equals(NO_ID)) {\n+            stopAutomowerPolling();\n+            automowerId.set(NO_ID);\n+        }\n+    }\n+\n+    private void startAutomowerPolling(@Nullable Integer pollingIntervalS) {\n+        if (automowerPollingJob == null) {\n+            final long pollingIntervalToUse = pollingIntervalS == null ? DEFAULT_POLLING_INTERVAL_S : pollingIntervalS;\n+            automowerPollingJob = scheduler.scheduleWithFixedDelay(new AutomowerPollingRunnable(), 1,\n+                    pollingIntervalToUse, TimeUnit.SECONDS);\n+        }\n+    }\n+\n+    private void stopAutomowerPolling() {\n+        if (automowerPollingJob != null) {\n+            automowerPollingJob.cancel(true);\n+            automowerPollingJob = null;\n+        }\n+    }\n+\n+    private boolean isValidResult(Mower mower) {\n+        return mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getBattery() != null && mower.getAttributes().getSystem() != null;\n+    }\n+\n+    private boolean isConnected(Mower mower) {\n+        return mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getMetadata().isConnected();\n+    }\n+\n+    private synchronized void updateAutomowerState() {\n+        if (System.nanoTime() - lastQueryTimeMs > maxQueryFrequencyNanos) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 177}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU2NjQwMQ==", "bodyText": "So you already have a mechanism in the framework that makes sure when I query various values that a cached item is used so there are not multiple rest calls executed (of course this makes sense)?\nSo I can just do the query when I get a refreshChannels?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r487566401", "createdAt": "2020-09-13T19:16:05Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,285 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.time.Instant;\n+import java.time.ZoneId;\n+import java.time.ZonedDateTime;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandlerService;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.actions.AutomowerActions;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+    private static final String NO_ID = \"NO_ID\";\n+    private static final long DEFAULT_COMMAND_DURATION_MIN = 60;\n+    private static final long DEFAULT_POLLING_INTERVAL_S = TimeUnit.MINUTES.toSeconds(10);\n+\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private long lastQueryTimeMs = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+        }\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public Collection<Class<? extends ThingHandlerService>> getServices() {\n+        return Collections.singleton(AutomowerActions.class);\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            AutomowerConfiguration currentConfig = getConfigAs(AutomowerConfiguration.class);\n+            final String configMowerId = currentConfig.getMowerId();\n+            final Integer pollingIntervalS = currentConfig.getPollingInterval();\n+\n+            if (configMowerId == null) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            } else if (pollingIntervalS != null && pollingIntervalS < 1) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-invalid-polling-interval\");\n+            } else {\n+                automowerId.set(configMowerId);\n+                startAutomowerPolling(pollingIntervalS);\n+            }\n+\n+        } else {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        if (!automowerId.get().equals(NO_ID)) {\n+            stopAutomowerPolling();\n+            automowerId.set(NO_ID);\n+        }\n+    }\n+\n+    private void startAutomowerPolling(@Nullable Integer pollingIntervalS) {\n+        if (automowerPollingJob == null) {\n+            final long pollingIntervalToUse = pollingIntervalS == null ? DEFAULT_POLLING_INTERVAL_S : pollingIntervalS;\n+            automowerPollingJob = scheduler.scheduleWithFixedDelay(new AutomowerPollingRunnable(), 1,\n+                    pollingIntervalToUse, TimeUnit.SECONDS);\n+        }\n+    }\n+\n+    private void stopAutomowerPolling() {\n+        if (automowerPollingJob != null) {\n+            automowerPollingJob.cancel(true);\n+            automowerPollingJob = null;\n+        }\n+    }\n+\n+    private boolean isValidResult(Mower mower) {\n+        return mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getBattery() != null && mower.getAttributes().getSystem() != null;\n+    }\n+\n+    private boolean isConnected(Mower mower) {\n+        return mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getMetadata().isConnected();\n+    }\n+\n+    private synchronized void updateAutomowerState() {\n+        if (System.nanoTime() - lastQueryTimeMs > maxQueryFrequencyNanos) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMyMDMzNw=="}, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 177}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTQ4NTIwNA==", "bodyText": "Please have a look at my question. So you are basically saying that there is a mechanism in the framework that assures that refreshChannels is not called too often? I can remove my check completely?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r491485204", "createdAt": "2020-09-19T19:23:43Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,285 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.time.Instant;\n+import java.time.ZoneId;\n+import java.time.ZonedDateTime;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandlerService;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.actions.AutomowerActions;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+    private static final String NO_ID = \"NO_ID\";\n+    private static final long DEFAULT_COMMAND_DURATION_MIN = 60;\n+    private static final long DEFAULT_POLLING_INTERVAL_S = TimeUnit.MINUTES.toSeconds(10);\n+\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private long lastQueryTimeMs = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+        }\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public Collection<Class<? extends ThingHandlerService>> getServices() {\n+        return Collections.singleton(AutomowerActions.class);\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            AutomowerConfiguration currentConfig = getConfigAs(AutomowerConfiguration.class);\n+            final String configMowerId = currentConfig.getMowerId();\n+            final Integer pollingIntervalS = currentConfig.getPollingInterval();\n+\n+            if (configMowerId == null) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            } else if (pollingIntervalS != null && pollingIntervalS < 1) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-invalid-polling-interval\");\n+            } else {\n+                automowerId.set(configMowerId);\n+                startAutomowerPolling(pollingIntervalS);\n+            }\n+\n+        } else {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        if (!automowerId.get().equals(NO_ID)) {\n+            stopAutomowerPolling();\n+            automowerId.set(NO_ID);\n+        }\n+    }\n+\n+    private void startAutomowerPolling(@Nullable Integer pollingIntervalS) {\n+        if (automowerPollingJob == null) {\n+            final long pollingIntervalToUse = pollingIntervalS == null ? DEFAULT_POLLING_INTERVAL_S : pollingIntervalS;\n+            automowerPollingJob = scheduler.scheduleWithFixedDelay(new AutomowerPollingRunnable(), 1,\n+                    pollingIntervalToUse, TimeUnit.SECONDS);\n+        }\n+    }\n+\n+    private void stopAutomowerPolling() {\n+        if (automowerPollingJob != null) {\n+            automowerPollingJob.cancel(true);\n+            automowerPollingJob = null;\n+        }\n+    }\n+\n+    private boolean isValidResult(Mower mower) {\n+        return mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getBattery() != null && mower.getAttributes().getSystem() != null;\n+    }\n+\n+    private boolean isConnected(Mower mower) {\n+        return mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getMetadata().isConnected();\n+    }\n+\n+    private synchronized void updateAutomowerState() {\n+        if (System.nanoTime() - lastQueryTimeMs > maxQueryFrequencyNanos) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMyMDMzNw=="}, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 177}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTU1MTEzNA==", "bodyText": "The expire class keeps track of the timeout and get a function as parameter. When the timeout exceeds it will call the function. So you can use it by simply calling getValue() it returns the value cached, when the time is exceeded. So it's not something the framework does. But it provides a class you can use to implement the timout functionallity you implemented here. Like not having to reinvent the wheel principle.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r491551134", "createdAt": "2020-09-19T21:42:30Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,285 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.time.Instant;\n+import java.time.ZoneId;\n+import java.time.ZonedDateTime;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandlerService;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.actions.AutomowerActions;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+    private static final String NO_ID = \"NO_ID\";\n+    private static final long DEFAULT_COMMAND_DURATION_MIN = 60;\n+    private static final long DEFAULT_POLLING_INTERVAL_S = TimeUnit.MINUTES.toSeconds(10);\n+\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private long lastQueryTimeMs = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+        }\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public Collection<Class<? extends ThingHandlerService>> getServices() {\n+        return Collections.singleton(AutomowerActions.class);\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            AutomowerConfiguration currentConfig = getConfigAs(AutomowerConfiguration.class);\n+            final String configMowerId = currentConfig.getMowerId();\n+            final Integer pollingIntervalS = currentConfig.getPollingInterval();\n+\n+            if (configMowerId == null) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            } else if (pollingIntervalS != null && pollingIntervalS < 1) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-invalid-polling-interval\");\n+            } else {\n+                automowerId.set(configMowerId);\n+                startAutomowerPolling(pollingIntervalS);\n+            }\n+\n+        } else {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        if (!automowerId.get().equals(NO_ID)) {\n+            stopAutomowerPolling();\n+            automowerId.set(NO_ID);\n+        }\n+    }\n+\n+    private void startAutomowerPolling(@Nullable Integer pollingIntervalS) {\n+        if (automowerPollingJob == null) {\n+            final long pollingIntervalToUse = pollingIntervalS == null ? DEFAULT_POLLING_INTERVAL_S : pollingIntervalS;\n+            automowerPollingJob = scheduler.scheduleWithFixedDelay(new AutomowerPollingRunnable(), 1,\n+                    pollingIntervalToUse, TimeUnit.SECONDS);\n+        }\n+    }\n+\n+    private void stopAutomowerPolling() {\n+        if (automowerPollingJob != null) {\n+            automowerPollingJob.cancel(true);\n+            automowerPollingJob = null;\n+        }\n+    }\n+\n+    private boolean isValidResult(Mower mower) {\n+        return mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getBattery() != null && mower.getAttributes().getSystem() != null;\n+    }\n+\n+    private boolean isConnected(Mower mower) {\n+        return mower.getAttributes() != null && mower.getAttributes().getMetadata() != null\n+                && mower.getAttributes().getMetadata().isConnected();\n+    }\n+\n+    private synchronized void updateAutomowerState() {\n+        if (System.nanoTime() - lastQueryTimeMs > maxQueryFrequencyNanos) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMyMDMzNw=="}, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 177}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4NDExNjk4OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerConfiguration.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMzo1NjoxN1rOHHNWbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxOToxNzoxN1rOHQ-srw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMyMDgxNQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @Nullable\n          \n          \n            \n                public String mowerId;\n          \n          \n            \n                public @Nullable String mowerId;", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r477320815", "createdAt": "2020-08-26T13:56:17Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerConfiguration.java", "diffHunk": "@@ -0,0 +1,48 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+/**\n+ * The {@link AutomowerConfiguration} class contains fields mapping thing configuration parameters.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerConfiguration {\n+\n+    @Nullable\n+    public String mowerId;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU2NjUxMQ==", "bodyText": "ok", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r487566511", "createdAt": "2020-09-13T19:17:17Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerConfiguration.java", "diffHunk": "@@ -0,0 +1,48 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+/**\n+ * The {@link AutomowerConfiguration} class contains fields mapping thing configuration parameters.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerConfiguration {\n+\n+    @Nullable\n+    public String mowerId;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMyMDgxNQ=="}, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4NDExODc0OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerCommand.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMzo1NjozNlrOHHNXcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxOToxNzo0OFrOHQ-s1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMyMTA3NQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n                private String command;\n          \n          \n            \n            \n          \n          \n            \n                private final String command;", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r477321075", "createdAt": "2020-08-26T13:56:36Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerCommand.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+/**\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+public enum AutomowerCommand {\n+\n+    START(\"Start\"),\n+    RESUME_SCHEDULE(\"ResumeSchedule\"),\n+    PAUSE(\"Pause\"),\n+    PARK(\"Park\"),\n+    PARK_UNTIL_NEXT_SCHEDULE(\"ParkUntilNextSchedule\"),\n+    PARK_UNTIL_FURTHER_NOTICE(\"ParkUntilFurtherNotice\");\n+\n+    private String command;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU2NjU1MQ==", "bodyText": "ok", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r487566551", "createdAt": "2020-09-13T19:17:48Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerCommand.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+/**\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+public enum AutomowerCommand {\n+\n+    START(\"Start\"),\n+    RESUME_SCHEDULE(\"ResumeSchedule\"),\n+    PAUSE(\"Pause\"),\n+    PARK(\"Park\"),\n+    PARK_UNTIL_NEXT_SCHEDULE(\"ParkUntilNextSchedule\"),\n+    PARK_UNTIL_FURTHER_NOTICE(\"ParkUntilFurtherNotice\");\n+\n+    private String command;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMyMTA3NQ=="}, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4OTgyNTg3OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/AutomowerHandlerFactory.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwOToxMTo0OVrOHIHdHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxOToxODo0NlrOHQ-tLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI3Mjc5Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        .flatMap(i -> i).collect(Collectors.toSet()));\n          \n          \n            \n                        .flatMap(Function.identity()).collect(Collectors.toSet()));", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r478272797", "createdAt": "2020-08-27T09:11:49Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/AutomowerHandlerFactory.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal;\n+\n+import java.util.Collections;\n+import java.util.Hashtable;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.config.discovery.DiscoveryService;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandlerFactory;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandlerFactory;\n+import org.eclipse.smarthome.io.net.http.HttpClientFactory;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.discovery.AutomowerDiscoveryService;\n+import org.openhab.binding.automower.internal.things.AutomowerHandler;\n+import org.osgi.framework.ServiceRegistration;\n+import org.osgi.service.component.annotations.Component;\n+import org.osgi.service.component.annotations.Reference;\n+\n+/**\n+ * The {@link AutomowerHandlerFactory} is responsible for creating things and thing\n+ * handlers.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+@Component(configurationPid = \"binding.automower\", service = ThingHandlerFactory.class)\n+public class AutomowerHandlerFactory extends BaseThingHandlerFactory {\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.unmodifiableSet(Stream\n+            .of(AutomowerBridgeHandler.SUPPORTED_THING_TYPES.stream(), AutomowerHandler.SUPPORTED_THING_TYPES.stream())\n+            .flatMap(i -> i).collect(Collectors.toSet()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU2NjYzOA==", "bodyText": "yes", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r487566638", "createdAt": "2020-09-13T19:18:46Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/AutomowerHandlerFactory.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal;\n+\n+import java.util.Collections;\n+import java.util.Hashtable;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.config.discovery.DiscoveryService;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandlerFactory;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandlerFactory;\n+import org.eclipse.smarthome.io.net.http.HttpClientFactory;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.discovery.AutomowerDiscoveryService;\n+import org.openhab.binding.automower.internal.things.AutomowerHandler;\n+import org.osgi.framework.ServiceRegistration;\n+import org.osgi.service.component.annotations.Component;\n+import org.osgi.service.component.annotations.Reference;\n+\n+/**\n+ * The {@link AutomowerHandlerFactory} is responsible for creating things and thing\n+ * handlers.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+@Component(configurationPid = \"binding.automower\", service = ThingHandlerFactory.class)\n+public class AutomowerHandlerFactory extends BaseThingHandlerFactory {\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.unmodifiableSet(Stream\n+            .of(AutomowerBridgeHandler.SUPPORTED_THING_TYPES.stream(), AutomowerHandler.SUPPORTED_THING_TYPES.stream())\n+            .flatMap(i -> i).collect(Collectors.toSet()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI3Mjc5Nw=="}, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4OTgzMTY0OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/AutomowerHandlerFactory.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwOToxMzoyNlrOHIHgpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxOToyMToyNVrOHQ-uOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI3MzcwMg==", "bodyText": "Please inject the factory in the constructor:\n@Activate\npublic AutomowerHandlerFactory(@Reference HttpClientFactory httpClientFactory) {\n...\n\nThis allows you to make httpClient also a final field.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r478273702", "createdAt": "2020-08-27T09:13:26Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/AutomowerHandlerFactory.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal;\n+\n+import java.util.Collections;\n+import java.util.Hashtable;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.config.discovery.DiscoveryService;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandlerFactory;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandlerFactory;\n+import org.eclipse.smarthome.io.net.http.HttpClientFactory;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.discovery.AutomowerDiscoveryService;\n+import org.openhab.binding.automower.internal.things.AutomowerHandler;\n+import org.osgi.framework.ServiceRegistration;\n+import org.osgi.service.component.annotations.Component;\n+import org.osgi.service.component.annotations.Reference;\n+\n+/**\n+ * The {@link AutomowerHandlerFactory} is responsible for creating things and thing\n+ * handlers.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+@Component(configurationPid = \"binding.automower\", service = ThingHandlerFactory.class)\n+public class AutomowerHandlerFactory extends BaseThingHandlerFactory {\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.unmodifiableSet(Stream\n+            .of(AutomowerBridgeHandler.SUPPORTED_THING_TYPES.stream(), AutomowerHandler.SUPPORTED_THING_TYPES.stream())\n+            .flatMap(i -> i).collect(Collectors.toSet()));\n+\n+    protected @NonNullByDefault({}) HttpClient httpClient;\n+    private @Nullable ServiceRegistration<?> automowerDiscoveryServiceRegistration;\n+\n+    @Override\n+    public boolean supportsThingType(ThingTypeUID thingTypeUID) {\n+        return SUPPORTED_THING_TYPES.contains(thingTypeUID);\n+    }\n+\n+    @Override\n+    protected @Nullable ThingHandler createHandler(Thing thing) {\n+        if (AutomowerBridgeHandler.SUPPORTED_THING_TYPES.contains(thing.getThingTypeUID())) {\n+            AutomowerBridgeHandler handler = new AutomowerBridgeHandler((Bridge) thing, httpClient);\n+            registerAutomowerDiscoveryService(handler);\n+            return handler;\n+        }\n+\n+        if (AutomowerHandler.SUPPORTED_THING_TYPES.contains(thing.getThingTypeUID())) {\n+            return new AutomowerHandler(thing);\n+        }\n+\n+        return null;\n+    }\n+\n+    @Override\n+    protected synchronized void removeHandler(ThingHandler thingHandler) {\n+        if (thingHandler instanceof AutomowerBridgeHandler) {\n+            if (automowerDiscoveryServiceRegistration != null) {\n+                // remove discovery service, if bridge handler is removed\n+                automowerDiscoveryServiceRegistration.unregister();\n+            }\n+        }\n+    }\n+\n+    private void registerAutomowerDiscoveryService(AutomowerBridgeHandler handler) {\n+        AutomowerDiscoveryService discoveryService = new AutomowerDiscoveryService(handler);\n+        this.automowerDiscoveryServiceRegistration = bundleContext.registerService(DiscoveryService.class.getName(),\n+                discoveryService, new Hashtable<>());\n+    }\n+\n+    @Reference\n+    protected void setHttpClientFactory(HttpClientFactory httpClientFactory) {\n+        this.httpClient = httpClientFactory.getCommonHttpClient();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU2NjkwNA==", "bodyText": "cool", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r487566904", "createdAt": "2020-09-13T19:21:25Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/AutomowerHandlerFactory.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal;\n+\n+import java.util.Collections;\n+import java.util.Hashtable;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.config.discovery.DiscoveryService;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandlerFactory;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandlerFactory;\n+import org.eclipse.smarthome.io.net.http.HttpClientFactory;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.discovery.AutomowerDiscoveryService;\n+import org.openhab.binding.automower.internal.things.AutomowerHandler;\n+import org.osgi.framework.ServiceRegistration;\n+import org.osgi.service.component.annotations.Component;\n+import org.osgi.service.component.annotations.Reference;\n+\n+/**\n+ * The {@link AutomowerHandlerFactory} is responsible for creating things and thing\n+ * handlers.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+@Component(configurationPid = \"binding.automower\", service = ThingHandlerFactory.class)\n+public class AutomowerHandlerFactory extends BaseThingHandlerFactory {\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.unmodifiableSet(Stream\n+            .of(AutomowerBridgeHandler.SUPPORTED_THING_TYPES.stream(), AutomowerHandler.SUPPORTED_THING_TYPES.stream())\n+            .flatMap(i -> i).collect(Collectors.toSet()));\n+\n+    protected @NonNullByDefault({}) HttpClient httpClient;\n+    private @Nullable ServiceRegistration<?> automowerDiscoveryServiceRegistration;\n+\n+    @Override\n+    public boolean supportsThingType(ThingTypeUID thingTypeUID) {\n+        return SUPPORTED_THING_TYPES.contains(thingTypeUID);\n+    }\n+\n+    @Override\n+    protected @Nullable ThingHandler createHandler(Thing thing) {\n+        if (AutomowerBridgeHandler.SUPPORTED_THING_TYPES.contains(thing.getThingTypeUID())) {\n+            AutomowerBridgeHandler handler = new AutomowerBridgeHandler((Bridge) thing, httpClient);\n+            registerAutomowerDiscoveryService(handler);\n+            return handler;\n+        }\n+\n+        if (AutomowerHandler.SUPPORTED_THING_TYPES.contains(thing.getThingTypeUID())) {\n+            return new AutomowerHandler(thing);\n+        }\n+\n+        return null;\n+    }\n+\n+    @Override\n+    protected synchronized void removeHandler(ThingHandler thingHandler) {\n+        if (thingHandler instanceof AutomowerBridgeHandler) {\n+            if (automowerDiscoveryServiceRegistration != null) {\n+                // remove discovery service, if bridge handler is removed\n+                automowerDiscoveryServiceRegistration.unregister();\n+            }\n+        }\n+    }\n+\n+    private void registerAutomowerDiscoveryService(AutomowerBridgeHandler handler) {\n+        AutomowerDiscoveryService discoveryService = new AutomowerDiscoveryService(handler);\n+        this.automowerDiscoveryServiceRegistration = bundleContext.registerService(DiscoveryService.class.getName(),\n+                discoveryService, new Hashtable<>());\n+    }\n+\n+    @Reference\n+    protected void setHttpClientFactory(HttpClientFactory httpClientFactory) {\n+        this.httpClient = httpClientFactory.getCommonHttpClient();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI3MzcwMg=="}, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 93}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNDI2OTI0OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/README.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMjo1OTozMVrOHKMrRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxODo0MjoxN1rOHQ-dfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQ1NTQ5Mg==", "bodyText": "Please put each sentence on its own line.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Keep in mind that the status of the bridge should not be queried too often. According to the Husqvarna documentation not more than 10000 requests per month and application key are allowed. With the default value of 1h this would mean ~720 requests per month for the bridge state\n          \n          \n            \n            Keep in mind that the status of the bridge should not be queried too often.\n          \n          \n            \n            According to the Husqvarna documentation not more than 10000 requests per month and application key are allowed.\n          \n          \n            \n            With the default value of 1h this would mean ~720 requests per month for the bridge state\n          \n      \n    \n    \n  \n\nPlease make the same changes to this Readme elsewhere where appropriate.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r480455492", "createdAt": "2020-08-31T22:59:31Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.automower/README.md", "diffHunk": "@@ -0,0 +1,123 @@\n+# Automower Binding\n+\n+This binding communicates to the Husqvarna Automower Connect API in order to send commands and query the state of Husqvarna Automower robots.\n+\n+## Supported Things\n+\n+`bridge:` The bridge needs to be configured with credentials and an application key that allows communicating with the Automower Connect Api\n+\n+`automower:` A single Husqvarna Automower robot\n+\n+Basically all Husqvarna Automower models with \"Automower Connect\" support should be supported. It was tested only with a Husqvarna Automower 450X\n+\n+\n+## Discovery\n+\n+Once the bridge is created and configured, registered automowers will be discovered automatically\n+\n+\n+## Thing Configuration\n+\n+`bridge:`\n+\n+- appKey (mandatory): The Application Key is required to communication with the Automower Connect Api. It can be obtained by registering an Application on the Husqvarna Website. This application also needs to be connected to the \"Authentication API\" and the \"Automower Connect API\"\n+- userName (mandatory): The user name for which the application key has been issued\n+- password (mandatory): The password for the given user\n+- pollingInterval (optional): How often the bridge state should be queried in seconds. Default is 1h (3600s)\n+\n+Keep in mind that the status of the bridge should not be queried too often. According to the Husqvarna documentation not more than 10000 requests per month and application key are allowed. With the default value of 1h this would mean ~720 requests per month for the bridge state", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU2MjYyMQ==", "bodyText": "will do", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r487562621", "createdAt": "2020-09-13T18:42:17Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/README.md", "diffHunk": "@@ -0,0 +1,123 @@\n+# Automower Binding\n+\n+This binding communicates to the Husqvarna Automower Connect API in order to send commands and query the state of Husqvarna Automower robots.\n+\n+## Supported Things\n+\n+`bridge:` The bridge needs to be configured with credentials and an application key that allows communicating with the Automower Connect Api\n+\n+`automower:` A single Husqvarna Automower robot\n+\n+Basically all Husqvarna Automower models with \"Automower Connect\" support should be supported. It was tested only with a Husqvarna Automower 450X\n+\n+\n+## Discovery\n+\n+Once the bridge is created and configured, registered automowers will be discovered automatically\n+\n+\n+## Thing Configuration\n+\n+`bridge:`\n+\n+- appKey (mandatory): The Application Key is required to communication with the Automower Connect Api. It can be obtained by registering an Application on the Husqvarna Website. This application also needs to be connected to the \"Authentication API\" and the \"Automower Connect API\"\n+- userName (mandatory): The user name for which the application key has been issued\n+- password (mandatory): The password for the given user\n+- pollingInterval (optional): How often the bridge state should be queried in seconds. Default is 1h (3600s)\n+\n+Keep in mind that the status of the bridge should not be queried too often. According to the Husqvarna documentation not more than 10000 requests per month and application key are allowed. With the default value of 1h this would mean ~720 requests per month for the bridge state", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQ1NTQ5Mg=="}, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNDI3MDU5OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/pom.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMjo1OTo1MFrOHKMsDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxOTozOToyNVrOHQ-1nQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQ1NTY5Mw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                <version>2.5.8-SNAPSHOT</version>\n          \n          \n            \n                <version>2.5.9-SNAPSHOT</version>", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r480455693", "createdAt": "2020-08-31T22:59:50Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.automower/pom.xml", "diffHunk": "@@ -0,0 +1,17 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+  xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <parent>\n+    <groupId>org.openhab.addons.bundles</groupId>\n+    <artifactId>org.openhab.addons.reactor.bundles</artifactId>\n+    <version>2.5.8-SNAPSHOT</version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU2ODc5Nw==", "bodyText": "done", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r487568797", "createdAt": "2020-09-13T19:39:25Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/pom.xml", "diffHunk": "@@ -0,0 +1,17 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+  xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <parent>\n+    <groupId>org.openhab.addons.bundles</groupId>\n+    <artifactId>org.openhab.addons.reactor.bundles</artifactId>\n+    <version>2.5.8-SNAPSHOT</version>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQ1NTY5Mw=="}, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNDMxODY5OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/automowerconnect/dto/Calendar.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMzoxMDozMlrOHKNHAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxODo0NToyMlrOHQ-e4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQ2MjU5NQ==", "bodyText": "Is this class used?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r480462595", "createdAt": "2020-08-31T23:10:32Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/automowerconnect/dto/Calendar.java", "diffHunk": "@@ -0,0 +1,20 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.rest.api.automowerconnect.dto;\n+\n+/**\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+public class Calendar {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU2Mjk3OQ==", "bodyText": "Not yet. I created the MowerData DTO according to the api specification. I always created either:\n\nfull dto with all members\nno members, so a placeholder to add fuctionality later\n\nThe MowerData is in use and Calendar is a part of it. Calendar itself is not used yet. Of course I can remove Calendar from the MowerData until it is needed. I just thought it would be a simpler change later on to just add to the calendar class when needed.\nWhatever you prefer.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r487562979", "createdAt": "2020-09-13T18:45:22Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/automowerconnect/dto/Calendar.java", "diffHunk": "@@ -0,0 +1,20 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.rest.api.automowerconnect.dto;\n+\n+/**\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+public class Calendar {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQ2MjU5NQ=="}, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNDMyNjUzOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/automowerconnect/dto/Planner.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMzoxMjoyMVrOHKNLlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxODo0NTozM1rOHQ-e9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQ2Mzc2Nw==", "bodyText": "Same question.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r480463767", "createdAt": "2020-08-31T23:12:21Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/automowerconnect/dto/Planner.java", "diffHunk": "@@ -0,0 +1,20 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.rest.api.automowerconnect.dto;\n+\n+/**\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+public class Planner {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU2Mjk5OQ==", "bodyText": "Same answer ;-)", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r487562999", "createdAt": "2020-09-13T18:45:33Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/automowerconnect/dto/Planner.java", "diffHunk": "@@ -0,0 +1,20 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.rest.api.automowerconnect.dto;\n+\n+/**\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+public class Planner {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQ2Mzc2Nw=="}, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNDMzNjQ5OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMzoxNDozMFrOHKNRFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxODo1MDoxNlrOHQ-g8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQ2NTE3NA==", "bodyText": "Instead of a nested class, could you just make AutomowerPollingRunnable a lambda instead?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r480465174", "createdAt": "2020-08-31T23:14:30Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,285 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.time.Instant;\n+import java.time.ZoneId;\n+import java.time.ZonedDateTime;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandlerService;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.actions.AutomowerActions;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+    private static final String NO_ID = \"NO_ID\";\n+    private static final long DEFAULT_COMMAND_DURATION_MIN = 60;\n+    private static final long DEFAULT_POLLING_INTERVAL_S = TimeUnit.MINUTES.toSeconds(10);\n+\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private long lastQueryTimeMs = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+        }\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public Collection<Class<? extends ThingHandlerService>> getServices() {\n+        return Collections.singleton(AutomowerActions.class);\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            AutomowerConfiguration currentConfig = getConfigAs(AutomowerConfiguration.class);\n+            final String configMowerId = currentConfig.getMowerId();\n+            final Integer pollingIntervalS = currentConfig.getPollingInterval();\n+\n+            if (configMowerId == null) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            } else if (pollingIntervalS != null && pollingIntervalS < 1) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-invalid-polling-interval\");\n+            } else {\n+                automowerId.set(configMowerId);\n+                startAutomowerPolling(pollingIntervalS);\n+            }\n+\n+        } else {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        if (!automowerId.get().equals(NO_ID)) {\n+            stopAutomowerPolling();\n+            automowerId.set(NO_ID);\n+        }\n+    }\n+\n+    private void startAutomowerPolling(@Nullable Integer pollingIntervalS) {\n+        if (automowerPollingJob == null) {\n+            final long pollingIntervalToUse = pollingIntervalS == null ? DEFAULT_POLLING_INTERVAL_S : pollingIntervalS;\n+            automowerPollingJob = scheduler.scheduleWithFixedDelay(new AutomowerPollingRunnable(), 1,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 154}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU2MzUwNA==", "bodyText": "yes", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r487563504", "createdAt": "2020-09-13T18:50:16Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,285 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.time.Instant;\n+import java.time.ZoneId;\n+import java.time.ZonedDateTime;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandlerService;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.actions.AutomowerActions;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+    private static final String NO_ID = \"NO_ID\";\n+    private static final long DEFAULT_COMMAND_DURATION_MIN = 60;\n+    private static final long DEFAULT_POLLING_INTERVAL_S = TimeUnit.MINUTES.toSeconds(10);\n+\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);\n+    private long lastQueryTimeMs = 0L;\n+\n+    private @Nullable ScheduledFuture<?> automowerPollingJob;\n+    private long maxQueryFrequencyNanos = TimeUnit.MINUTES.toNanos(1);\n+\n+    public AutomowerHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    class AutomowerPollingRunnable implements Runnable {\n+\n+        @Override\n+        public void run() {\n+            Bridge bridge = getBridge();\n+            if (bridge != null && bridge.getStatus() == ThingStatus.ONLINE) {\n+                updateAutomowerState();\n+            } else {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+            }\n+        }\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            refreshChannels(channelUID);\n+        }\n+    }\n+\n+    private void refreshChannels(ChannelUID channelUID) {\n+        updateAutomowerState();\n+    }\n+\n+    @Override\n+    public Collection<Class<? extends ThingHandlerService>> getServices() {\n+        return Collections.singleton(AutomowerActions.class);\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            AutomowerConfiguration currentConfig = getConfigAs(AutomowerConfiguration.class);\n+            final String configMowerId = currentConfig.getMowerId();\n+            final Integer pollingIntervalS = currentConfig.getPollingInterval();\n+\n+            if (configMowerId == null) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-no-mower-id\");\n+            } else if (pollingIntervalS != null && pollingIntervalS < 1) {\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                        \"@text/conf-error-invalid-polling-interval\");\n+            } else {\n+                automowerId.set(configMowerId);\n+                startAutomowerPolling(pollingIntervalS);\n+            }\n+\n+        } else {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_UNINITIALIZED);\n+        }\n+    }\n+\n+    @Nullable\n+    private AutomowerBridge getAutomowerBridge() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            ThingHandler handler = bridge.getHandler();\n+            if (handler instanceof AutomowerBridgeHandler) {\n+                AutomowerBridgeHandler bridgeHandler = (AutomowerBridgeHandler) handler;\n+                return bridgeHandler.getAutomowerBridge();\n+            }\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        if (!automowerId.get().equals(NO_ID)) {\n+            stopAutomowerPolling();\n+            automowerId.set(NO_ID);\n+        }\n+    }\n+\n+    private void startAutomowerPolling(@Nullable Integer pollingIntervalS) {\n+        if (automowerPollingJob == null) {\n+            final long pollingIntervalToUse = pollingIntervalS == null ? DEFAULT_POLLING_INTERVAL_S : pollingIntervalS;\n+            automowerPollingJob = scheduler.scheduleWithFixedDelay(new AutomowerPollingRunnable(), 1,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQ2NTE3NA=="}, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 154}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNDM2MTczOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/thing/thing-types.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMzoyMDowOFrOHKNfTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxOTowMjoxMlrOHQ-mRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQ2ODgxNQ==", "bodyText": "If this number is supposed to be a percentage then you should change this a Number:Dimensionless and then use QuantityType and percentage units.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r480468815", "createdAt": "2020-08-31T23:20:08Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -0,0 +1,167 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"automower\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<!-- Automower Bridge Thing Type -->\n+\t<bridge-type id=\"bridge\">\n+\t\t<label>Automower Connect Bridge</label>\n+\t\t<description>The bridge to communicate with the Automower Connect API</description>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"appKey\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Application Key</label>\n+\t\t\t\t<description>The Application Key is required to communication with the Automower Connect Api. It can be obtained by\n+\t\t\t\t\tregistering an Application on the Husqvarna Website. This application also needs to be connected to the\n+\t\t\t\t\t\"Authentication API\" and the \"Automower Connect API\"</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"userName\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>User Name</label>\n+\t\t\t\t<description>The user name for which the application key has been issued</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"password\" type=\"text\" required=\"true\">\n+\t\t\t\t<context>Password</context>\n+\t\t\t\t<description>The password for the given user</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"pollingInterval\" type=\"integer\" required=\"false\" unit=\"s\">\n+\t\t\t\t<label>Polling Interval</label>\n+\t\t\t\t<default>3600</default>\n+\t\t\t\t<description>How often the available automowers should be queried in seconds</description>\n+\t\t\t</parameter>\n+\t\t</config-description>\n+\n+\t</bridge-type>\n+\n+\t<!-- Automower Thing Type -->\n+\t<thing-type id=\"automower\">\n+\t\t<supported-bridge-type-refs>\n+\t\t\t<bridge-type-ref id=\"bridge\"/>\n+\t\t</supported-bridge-type-refs>\n+\n+\t\t<label>Automower</label>\n+\t\t<description>An automatic lawn mower</description>\n+\n+\t\t<channels>\n+\t\t\t<channel id=\"name\" typeId=\"nameType\"/>\n+\t\t\t<channel id=\"mode\" typeId=\"modeType\"/>\n+\t\t\t<channel id=\"activity\" typeId=\"activityType\"/>\n+\t\t\t<channel id=\"state\" typeId=\"stateType\"/>\n+\t\t\t<channel id=\"last-update\" typeId=\"lastUpdateType\"/>\n+\t\t\t<channel id=\"battery\" typeId=\"batteryType\"/>\n+\t\t\t<channel id=\"error-code\" typeId=\"errorCodeType\"/>\n+\t\t\t<channel id=\"error-timestamp\" typeId=\"errorTimestampType\"/>\n+\t\t</channels>\n+\n+\t\t<properties>\n+\t\t\t<property name=\"mowerId\">N/A</property>\n+\t\t\t<property name=\"mowerName\">N/A</property>\n+\t\t\t<property name=\"mowerModel\">N/A</property>\n+\t\t\t<property name=\"mowerSerialNumber\">N/A</property>\n+\t\t</properties>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"mowerId\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Automower Id</label>\n+\t\t\t\t<description>The Id of an automower as used by the Automower Connect Api to identify a mower</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"pollingInterval\" type=\"integer\" required=\"false\" unit=\"s\">\n+\t\t\t\t<label>Polling Interval</label>\n+\t\t\t\t<default>600</default>\n+\t\t\t\t<description>How often the current automower state should be polled in seconds</description>\n+\t\t\t</parameter>\n+\t\t</config-description>\n+\n+\t</thing-type>\n+\n+\t<channel-type id=\"nameType\">\n+\t\t<item-type>String</item-type>\n+\t\t<label>Automower Name</label>\n+\t\t<description>The channel providing the automower name</description>\n+\t\t<state readOnly=\"true\"/>\n+\t</channel-type>\n+\n+\t<channel-type id=\"modeType\">\n+\t\t<item-type>String</item-type>\n+\t\t<label>Mode</label>\n+\t\t<description>The current mode</description>\n+\t\t<state readOnly=\"true\">\n+\t\t\t<options>\n+\t\t\t\t<option value=\"MAIN_AREA\">Main Area</option>\n+\t\t\t\t<option value=\"SECONDARY_AREA\">Secondary Area</option>\n+\t\t\t\t<option value=\"HOME\">Home</option>\n+\t\t\t\t<option value=\"DEMO\">Demo</option>\n+\t\t\t\t<option value=\"UNKNOWN\">Unknown</option>\n+\t\t\t</options>\n+\t\t</state>\n+\t</channel-type>\n+\n+\t<channel-type id=\"activityType\">\n+\t\t<item-type>String</item-type>\n+\t\t<label>Activity</label>\n+\t\t<description>The current activity</description>\n+\t\t<state readOnly=\"true\">\n+\t\t\t<options>\n+\t\t\t\t<option value=\"UNKNOWN\">Unknown</option>\n+\t\t\t\t<option value=\"NOT_APPLICABLE\">N/A</option>\n+\t\t\t\t<option value=\"MOWING\">Mowing</option>\n+\t\t\t\t<option value=\"GOING_HOME\">Returning to charging station</option>\n+\t\t\t\t<option value=\"CHARGING\">Charging</option>\n+\t\t\t\t<option value=\"LEAVING\">Leaving charging station</option>\n+\t\t\t\t<option value=\"PARKED_IN_CS\">Parked in charging station</option>\n+\t\t\t\t<option value=\"STOPPED_IN_GARDEN\">Stopped in garden</option>\n+\t\t\t</options>\n+\t\t</state>\n+\t</channel-type>\n+\n+\t<channel-type id=\"stateType\">\n+\t\t<item-type>String</item-type>\n+\t\t<label>State</label>\n+\t\t<description>The current state</description>\n+\t\t<state readOnly=\"true\">\n+\t\t\t<options>\n+\t\t\t\t<option value=\"UNKNOWN\">Unknown</option>\n+\t\t\t\t<option value=\"NOT_APPLICABLE\">N/A</option>\n+\t\t\t\t<option value=\"PAUSED\">Paused by user</option>\n+\t\t\t\t<option value=\"IN_OPERATION\">Working</option>\n+\t\t\t\t<option value=\"WAIT_UPDATING\">Downloading new firmware</option>\n+\t\t\t\t<option value=\"WAIT_POWER_UP\">Booting mower</option>\n+\t\t\t\t<option value=\"RESTRICTED\">Waiting</option>\n+\t\t\t\t<option value=\"OFF\">Off</option>\n+\t\t\t\t<option value=\"STOPPED\">Stopped- Manual intervention required</option>\n+\t\t\t\t<option value=\"ERROR\">Error</option>\n+\t\t\t\t<option value=\"FATAL_ERROR\">Fatal error</option>\n+\t\t\t\t<option value=\"ERROR_AT_POWER_UP\">Boot error</option>\n+\t\t\t</options>\n+\t\t</state>\n+\t</channel-type>\n+\n+\t<channel-type id=\"lastUpdateType\">\n+\t\t<item-type>DateTime</item-type>\n+\t\t<label>Last Update</label>\n+\t\t<description></description>\n+\t\t<state readOnly=\"true\"/>\n+\t</channel-type>\n+\n+\t<channel-type id=\"batteryType\">\n+\t\t<item-type>Number</item-type>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 147}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU2NDg3MA==", "bodyText": "Sure", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r487564870", "createdAt": "2020-09-13T19:02:12Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -0,0 +1,167 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<thing:thing-descriptions bindingId=\"automower\"\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+\txmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n+\n+\t<!-- Automower Bridge Thing Type -->\n+\t<bridge-type id=\"bridge\">\n+\t\t<label>Automower Connect Bridge</label>\n+\t\t<description>The bridge to communicate with the Automower Connect API</description>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"appKey\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Application Key</label>\n+\t\t\t\t<description>The Application Key is required to communication with the Automower Connect Api. It can be obtained by\n+\t\t\t\t\tregistering an Application on the Husqvarna Website. This application also needs to be connected to the\n+\t\t\t\t\t\"Authentication API\" and the \"Automower Connect API\"</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"userName\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>User Name</label>\n+\t\t\t\t<description>The user name for which the application key has been issued</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"password\" type=\"text\" required=\"true\">\n+\t\t\t\t<context>Password</context>\n+\t\t\t\t<description>The password for the given user</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"pollingInterval\" type=\"integer\" required=\"false\" unit=\"s\">\n+\t\t\t\t<label>Polling Interval</label>\n+\t\t\t\t<default>3600</default>\n+\t\t\t\t<description>How often the available automowers should be queried in seconds</description>\n+\t\t\t</parameter>\n+\t\t</config-description>\n+\n+\t</bridge-type>\n+\n+\t<!-- Automower Thing Type -->\n+\t<thing-type id=\"automower\">\n+\t\t<supported-bridge-type-refs>\n+\t\t\t<bridge-type-ref id=\"bridge\"/>\n+\t\t</supported-bridge-type-refs>\n+\n+\t\t<label>Automower</label>\n+\t\t<description>An automatic lawn mower</description>\n+\n+\t\t<channels>\n+\t\t\t<channel id=\"name\" typeId=\"nameType\"/>\n+\t\t\t<channel id=\"mode\" typeId=\"modeType\"/>\n+\t\t\t<channel id=\"activity\" typeId=\"activityType\"/>\n+\t\t\t<channel id=\"state\" typeId=\"stateType\"/>\n+\t\t\t<channel id=\"last-update\" typeId=\"lastUpdateType\"/>\n+\t\t\t<channel id=\"battery\" typeId=\"batteryType\"/>\n+\t\t\t<channel id=\"error-code\" typeId=\"errorCodeType\"/>\n+\t\t\t<channel id=\"error-timestamp\" typeId=\"errorTimestampType\"/>\n+\t\t</channels>\n+\n+\t\t<properties>\n+\t\t\t<property name=\"mowerId\">N/A</property>\n+\t\t\t<property name=\"mowerName\">N/A</property>\n+\t\t\t<property name=\"mowerModel\">N/A</property>\n+\t\t\t<property name=\"mowerSerialNumber\">N/A</property>\n+\t\t</properties>\n+\n+\t\t<config-description>\n+\t\t\t<parameter name=\"mowerId\" type=\"text\" required=\"true\">\n+\t\t\t\t<label>Automower Id</label>\n+\t\t\t\t<description>The Id of an automower as used by the Automower Connect Api to identify a mower</description>\n+\t\t\t</parameter>\n+\t\t\t<parameter name=\"pollingInterval\" type=\"integer\" required=\"false\" unit=\"s\">\n+\t\t\t\t<label>Polling Interval</label>\n+\t\t\t\t<default>600</default>\n+\t\t\t\t<description>How often the current automower state should be polled in seconds</description>\n+\t\t\t</parameter>\n+\t\t</config-description>\n+\n+\t</thing-type>\n+\n+\t<channel-type id=\"nameType\">\n+\t\t<item-type>String</item-type>\n+\t\t<label>Automower Name</label>\n+\t\t<description>The channel providing the automower name</description>\n+\t\t<state readOnly=\"true\"/>\n+\t</channel-type>\n+\n+\t<channel-type id=\"modeType\">\n+\t\t<item-type>String</item-type>\n+\t\t<label>Mode</label>\n+\t\t<description>The current mode</description>\n+\t\t<state readOnly=\"true\">\n+\t\t\t<options>\n+\t\t\t\t<option value=\"MAIN_AREA\">Main Area</option>\n+\t\t\t\t<option value=\"SECONDARY_AREA\">Secondary Area</option>\n+\t\t\t\t<option value=\"HOME\">Home</option>\n+\t\t\t\t<option value=\"DEMO\">Demo</option>\n+\t\t\t\t<option value=\"UNKNOWN\">Unknown</option>\n+\t\t\t</options>\n+\t\t</state>\n+\t</channel-type>\n+\n+\t<channel-type id=\"activityType\">\n+\t\t<item-type>String</item-type>\n+\t\t<label>Activity</label>\n+\t\t<description>The current activity</description>\n+\t\t<state readOnly=\"true\">\n+\t\t\t<options>\n+\t\t\t\t<option value=\"UNKNOWN\">Unknown</option>\n+\t\t\t\t<option value=\"NOT_APPLICABLE\">N/A</option>\n+\t\t\t\t<option value=\"MOWING\">Mowing</option>\n+\t\t\t\t<option value=\"GOING_HOME\">Returning to charging station</option>\n+\t\t\t\t<option value=\"CHARGING\">Charging</option>\n+\t\t\t\t<option value=\"LEAVING\">Leaving charging station</option>\n+\t\t\t\t<option value=\"PARKED_IN_CS\">Parked in charging station</option>\n+\t\t\t\t<option value=\"STOPPED_IN_GARDEN\">Stopped in garden</option>\n+\t\t\t</options>\n+\t\t</state>\n+\t</channel-type>\n+\n+\t<channel-type id=\"stateType\">\n+\t\t<item-type>String</item-type>\n+\t\t<label>State</label>\n+\t\t<description>The current state</description>\n+\t\t<state readOnly=\"true\">\n+\t\t\t<options>\n+\t\t\t\t<option value=\"UNKNOWN\">Unknown</option>\n+\t\t\t\t<option value=\"NOT_APPLICABLE\">N/A</option>\n+\t\t\t\t<option value=\"PAUSED\">Paused by user</option>\n+\t\t\t\t<option value=\"IN_OPERATION\">Working</option>\n+\t\t\t\t<option value=\"WAIT_UPDATING\">Downloading new firmware</option>\n+\t\t\t\t<option value=\"WAIT_POWER_UP\">Booting mower</option>\n+\t\t\t\t<option value=\"RESTRICTED\">Waiting</option>\n+\t\t\t\t<option value=\"OFF\">Off</option>\n+\t\t\t\t<option value=\"STOPPED\">Stopped- Manual intervention required</option>\n+\t\t\t\t<option value=\"ERROR\">Error</option>\n+\t\t\t\t<option value=\"FATAL_ERROR\">Fatal error</option>\n+\t\t\t\t<option value=\"ERROR_AT_POWER_UP\">Boot error</option>\n+\t\t\t</options>\n+\t\t</state>\n+\t</channel-type>\n+\n+\t<channel-type id=\"lastUpdateType\">\n+\t\t<item-type>DateTime</item-type>\n+\t\t<label>Last Update</label>\n+\t\t<description></description>\n+\t\t<state readOnly=\"true\"/>\n+\t</channel-type>\n+\n+\t<channel-type id=\"batteryType\">\n+\t\t<item-type>Number</item-type>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQ2ODgxNQ=="}, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 147}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNDM2NzY4OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMzoyMzowNFrOHKNizg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxOTowNzowMlrOHQ-oiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQ2OTcxMA==", "bodyText": "This is only updated during initialization, why do you need it to be atomic?", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r480469710", "createdAt": "2020-08-31T23:23:04Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,285 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.time.Instant;\n+import java.time.ZoneId;\n+import java.time.ZonedDateTime;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandlerService;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.actions.AutomowerActions;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+    private static final String NO_ID = \"NO_ID\";\n+    private static final long DEFAULT_COMMAND_DURATION_MIN = 60;\n+    private static final long DEFAULT_POLLING_INTERVAL_S = TimeUnit.MINUTES.toSeconds(10);\n+\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU2NTQ0OQ==", "bodyText": "Probably because I am not familiar how the framework works from a threading perspective. As I was not sure if the initialize and dispose methods are called by the same thread I assumed they might not.\nTo make sure a different thread would see the most recent value of the variable I would need some kind of synchronization. Volatile would be sufficient in that case but I thought using an AtomicReference would be nicer and would not hurt.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r487565449", "createdAt": "2020-09-13T19:07:02Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/things/AutomowerHandler.java", "diffHunk": "@@ -0,0 +1,285 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.things;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.*;\n+\n+import java.time.Instant;\n+import java.time.ZoneId;\n+import java.time.ZonedDateTime;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandlerService;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.openhab.binding.automower.internal.AutomowerBindingConstants;\n+import org.openhab.binding.automower.internal.actions.AutomowerActions;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridge;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.Mower;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerHandler extends BaseThingHandler {\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_AUTOMOWER);\n+    private static final String NO_ID = \"NO_ID\";\n+    private static final long DEFAULT_COMMAND_DURATION_MIN = 60;\n+    private static final long DEFAULT_POLLING_INTERVAL_S = TimeUnit.MINUTES.toSeconds(10);\n+\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerHandler.class);\n+    private AtomicReference<String> automowerId = new AtomicReference<String>(NO_ID);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQ2OTcxMA=="}, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNjkyMzIwOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/AutomowerHandlerFactory.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwNzoxMzoyOVrOHKoJgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwNzoxMzoyOVrOHKoJgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDkwNTYwMQ==", "bodyText": "Please implement the registration of the discovery service as a ThingHandlerService. I've a pr on the documentation that explains how to implement it. This is a link to the preview documentation: https://deploy-preview-1262--openhab-docs-preview.netlify.app/docs/developer/bindings/#discovery-that-is-bound-to-a-thing", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r480905601", "createdAt": "2020-09-01T07:13:29Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/AutomowerHandlerFactory.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal;\n+\n+import java.util.Collections;\n+import java.util.Hashtable;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.config.discovery.DiscoveryService;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandlerFactory;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandlerFactory;\n+import org.eclipse.smarthome.io.net.http.HttpClientFactory;\n+import org.openhab.binding.automower.internal.bridge.AutomowerBridgeHandler;\n+import org.openhab.binding.automower.internal.discovery.AutomowerDiscoveryService;\n+import org.openhab.binding.automower.internal.things.AutomowerHandler;\n+import org.osgi.framework.ServiceRegistration;\n+import org.osgi.service.component.annotations.Component;\n+import org.osgi.service.component.annotations.Reference;\n+\n+/**\n+ * The {@link AutomowerHandlerFactory} is responsible for creating things and thing\n+ * handlers.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+@Component(configurationPid = \"binding.automower\", service = ThingHandlerFactory.class)\n+public class AutomowerHandlerFactory extends BaseThingHandlerFactory {\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.unmodifiableSet(Stream\n+            .of(AutomowerBridgeHandler.SUPPORTED_THING_TYPES.stream(), AutomowerHandler.SUPPORTED_THING_TYPES.stream())\n+            .flatMap(i -> i).collect(Collectors.toSet()));\n+\n+    protected @NonNullByDefault({}) HttpClient httpClient;\n+    private @Nullable ServiceRegistration<?> automowerDiscoveryServiceRegistration;\n+\n+    @Override\n+    public boolean supportsThingType(ThingTypeUID thingTypeUID) {\n+        return SUPPORTED_THING_TYPES.contains(thingTypeUID);\n+    }\n+\n+    @Override\n+    protected @Nullable ThingHandler createHandler(Thing thing) {\n+        if (AutomowerBridgeHandler.SUPPORTED_THING_TYPES.contains(thing.getThingTypeUID())) {\n+            AutomowerBridgeHandler handler = new AutomowerBridgeHandler((Bridge) thing, httpClient);\n+            registerAutomowerDiscoveryService(handler);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNjk4MzE4OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/automowerconnect/AutomowerConnectApi.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwNzoyNTozOFrOHKov6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxOToyNTozOVrOHQ-wDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDkxNTQzMg==", "bodyText": "You can put this in a separate method (except for the content call here) and then call that method from the 3 other methods to make the code simpler.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r480915432", "createdAt": "2020-09-01T07:25:38Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/automowerconnect/AutomowerConnectApi.java", "diffHunk": "@@ -0,0 +1,141 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.rest.api.automowerconnect;\n+\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.TimeoutException;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.util.StringContentProvider;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.http.HttpStatus;\n+import org.openhab.binding.automower.internal.rest.api.HusqvarnaApi;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerCommandRequest;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.openhab.binding.automower.internal.rest.exceptions.UnauthorizedException;\n+\n+import com.google.gson.JsonSyntaxException;\n+\n+/**\n+ * Allows access to the AutomowerConnectApi\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerConnectApi extends HusqvarnaApi {\n+\n+    public AutomowerConnectApi(HttpClient httpClient) {\n+        super(httpClient);\n+    }\n+\n+    @Override\n+    public String getBaseUrl() {\n+        return \"https://api.amc.husqvarna.dev/v1\";\n+    }\n+\n+    public MowerListResult getMowers(String appKey, String token) throws AutomowerCommunicationException {\n+        final Request request = getHttpClient().newRequest(getBaseUrl() + \"/mowers\");\n+        request.method(HttpMethod.GET);\n+\n+        request.header(\"Authorization-Provider\", \"husqvarna\");\n+        request.header(\"Authorization\", \"Bearer \" + token);\n+        request.header(\"X-Api-Key\", appKey);\n+        request.header(\"Content-Type\", \"application/vnd.api+json\");\n+\n+        ContentResponse response;\n+        try {\n+            response = request.send();\n+        } catch (InterruptedException | TimeoutException | ExecutionException e) {\n+            throw new AutomowerCommunicationException(e);\n+        }\n+\n+        return parseResponse(response, MowerListResult.class);\n+    }\n+\n+    public MowerResult getMower(String appKey, String token, String mowerId) throws AutomowerCommunicationException {\n+        final Request request = getHttpClient().newRequest(getBaseUrl() + \"/mowers/\" + mowerId);\n+        request.method(HttpMethod.GET);\n+\n+        request.header(\"Authorization-Provider\", \"husqvarna\");\n+        request.header(\"Authorization\", \"Bearer \" + token);\n+        request.header(\"X-Api-Key\", appKey);\n+        request.header(\"Content-Type\", \"application/vnd.api+json\");\n+\n+        ContentResponse response;\n+        try {\n+            response = request.send();\n+        } catch (InterruptedException | TimeoutException | ExecutionException e) {\n+            throw new AutomowerCommunicationException(e);\n+        }\n+\n+        return parseResponse(response, MowerResult.class);\n+    }\n+\n+    public void sendCommand(String appKey, String token, String id, MowerCommandRequest command)\n+            throws AutomowerCommunicationException {\n+        final Request request = getHttpClient().newRequest(getBaseUrl() + \"/mowers/\" + id + \"/actions\");\n+        request.method(HttpMethod.POST);\n+\n+        request.header(\"Authorization-Provider\", \"husqvarna\");\n+        request.header(\"Authorization\", \"Bearer \" + token);\n+        request.header(\"X-Api-Key\", appKey);\n+        request.header(\"Content-Type\", \"application/vnd.api+json\");\n+\n+        request.content(new StringContentProvider(gson.toJson(command)));\n+\n+        ContentResponse response;\n+        try {\n+            response = request.send();\n+        } catch (InterruptedException | TimeoutException | ExecutionException e) {\n+            throw new AutomowerCommunicationException(e);\n+        }\n+\n+        checkForError(response, response.getStatus());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 108}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU2NzM3NQ==", "bodyText": "yes, makes sense", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r487567375", "createdAt": "2020-09-13T19:25:39Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/automowerconnect/AutomowerConnectApi.java", "diffHunk": "@@ -0,0 +1,141 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.rest.api.automowerconnect;\n+\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.TimeoutException;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.util.StringContentProvider;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.http.HttpStatus;\n+import org.openhab.binding.automower.internal.rest.api.HusqvarnaApi;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerCommandRequest;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.openhab.binding.automower.internal.rest.exceptions.UnauthorizedException;\n+\n+import com.google.gson.JsonSyntaxException;\n+\n+/**\n+ * Allows access to the AutomowerConnectApi\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerConnectApi extends HusqvarnaApi {\n+\n+    public AutomowerConnectApi(HttpClient httpClient) {\n+        super(httpClient);\n+    }\n+\n+    @Override\n+    public String getBaseUrl() {\n+        return \"https://api.amc.husqvarna.dev/v1\";\n+    }\n+\n+    public MowerListResult getMowers(String appKey, String token) throws AutomowerCommunicationException {\n+        final Request request = getHttpClient().newRequest(getBaseUrl() + \"/mowers\");\n+        request.method(HttpMethod.GET);\n+\n+        request.header(\"Authorization-Provider\", \"husqvarna\");\n+        request.header(\"Authorization\", \"Bearer \" + token);\n+        request.header(\"X-Api-Key\", appKey);\n+        request.header(\"Content-Type\", \"application/vnd.api+json\");\n+\n+        ContentResponse response;\n+        try {\n+            response = request.send();\n+        } catch (InterruptedException | TimeoutException | ExecutionException e) {\n+            throw new AutomowerCommunicationException(e);\n+        }\n+\n+        return parseResponse(response, MowerListResult.class);\n+    }\n+\n+    public MowerResult getMower(String appKey, String token, String mowerId) throws AutomowerCommunicationException {\n+        final Request request = getHttpClient().newRequest(getBaseUrl() + \"/mowers/\" + mowerId);\n+        request.method(HttpMethod.GET);\n+\n+        request.header(\"Authorization-Provider\", \"husqvarna\");\n+        request.header(\"Authorization\", \"Bearer \" + token);\n+        request.header(\"X-Api-Key\", appKey);\n+        request.header(\"Content-Type\", \"application/vnd.api+json\");\n+\n+        ContentResponse response;\n+        try {\n+            response = request.send();\n+        } catch (InterruptedException | TimeoutException | ExecutionException e) {\n+            throw new AutomowerCommunicationException(e);\n+        }\n+\n+        return parseResponse(response, MowerResult.class);\n+    }\n+\n+    public void sendCommand(String appKey, String token, String id, MowerCommandRequest command)\n+            throws AutomowerCommunicationException {\n+        final Request request = getHttpClient().newRequest(getBaseUrl() + \"/mowers/\" + id + \"/actions\");\n+        request.method(HttpMethod.POST);\n+\n+        request.header(\"Authorization-Provider\", \"husqvarna\");\n+        request.header(\"Authorization\", \"Bearer \" + token);\n+        request.header(\"X-Api-Key\", appKey);\n+        request.header(\"Content-Type\", \"application/vnd.api+json\");\n+\n+        request.content(new StringContentProvider(gson.toJson(command)));\n+\n+        ContentResponse response;\n+        try {\n+            response = request.send();\n+        } catch (InterruptedException | TimeoutException | ExecutionException e) {\n+            throw new AutomowerCommunicationException(e);\n+        }\n+\n+        checkForError(response, response.getStatus());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDkxNTQzMg=="}, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 108}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNjk4ODc2OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/automowerconnect/AutomowerConnectApi.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwNzoyNjo0M1rOHKozYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxOToyOTowNVrOHQ-xMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDkxNjMyMg==", "bodyText": "You need to add a timeout to the request. This can be set in the method I described in the other comment so you don't have to set it only in 1 place.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r480916322", "createdAt": "2020-09-01T07:26:43Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/automowerconnect/AutomowerConnectApi.java", "diffHunk": "@@ -0,0 +1,141 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.rest.api.automowerconnect;\n+\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.TimeoutException;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.util.StringContentProvider;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.http.HttpStatus;\n+import org.openhab.binding.automower.internal.rest.api.HusqvarnaApi;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerCommandRequest;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.openhab.binding.automower.internal.rest.exceptions.UnauthorizedException;\n+\n+import com.google.gson.JsonSyntaxException;\n+\n+/**\n+ * Allows access to the AutomowerConnectApi\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerConnectApi extends HusqvarnaApi {\n+\n+    public AutomowerConnectApi(HttpClient httpClient) {\n+        super(httpClient);\n+    }\n+\n+    @Override\n+    public String getBaseUrl() {\n+        return \"https://api.amc.husqvarna.dev/v1\";\n+    }\n+\n+    public MowerListResult getMowers(String appKey, String token) throws AutomowerCommunicationException {\n+        final Request request = getHttpClient().newRequest(getBaseUrl() + \"/mowers\");\n+        request.method(HttpMethod.GET);\n+\n+        request.header(\"Authorization-Provider\", \"husqvarna\");\n+        request.header(\"Authorization\", \"Bearer \" + token);\n+        request.header(\"X-Api-Key\", appKey);\n+        request.header(\"Content-Type\", \"application/vnd.api+json\");\n+\n+        ContentResponse response;\n+        try {\n+            response = request.send();\n+        } catch (InterruptedException | TimeoutException | ExecutionException e) {\n+            throw new AutomowerCommunicationException(e);\n+        }\n+\n+        return parseResponse(response, MowerListResult.class);\n+    }\n+\n+    public MowerResult getMower(String appKey, String token, String mowerId) throws AutomowerCommunicationException {\n+        final Request request = getHttpClient().newRequest(getBaseUrl() + \"/mowers/\" + mowerId);\n+        request.method(HttpMethod.GET);\n+\n+        request.header(\"Authorization-Provider\", \"husqvarna\");\n+        request.header(\"Authorization\", \"Bearer \" + token);\n+        request.header(\"X-Api-Key\", appKey);\n+        request.header(\"Content-Type\", \"application/vnd.api+json\");\n+\n+        ContentResponse response;\n+        try {\n+            response = request.send();\n+        } catch (InterruptedException | TimeoutException | ExecutionException e) {\n+            throw new AutomowerCommunicationException(e);\n+        }\n+\n+        return parseResponse(response, MowerResult.class);\n+    }\n+\n+    public void sendCommand(String appKey, String token, String id, MowerCommandRequest command)\n+            throws AutomowerCommunicationException {\n+        final Request request = getHttpClient().newRequest(getBaseUrl() + \"/mowers/\" + id + \"/actions\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU2NzY2NA==", "bodyText": "Ok, I thought there would be a proper default timeout. I will use 10 seconds...", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r487567664", "createdAt": "2020-09-13T19:29:05Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/automowerconnect/AutomowerConnectApi.java", "diffHunk": "@@ -0,0 +1,141 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.rest.api.automowerconnect;\n+\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.TimeoutException;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.util.StringContentProvider;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.http.HttpStatus;\n+import org.openhab.binding.automower.internal.rest.api.HusqvarnaApi;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerCommandRequest;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.openhab.binding.automower.internal.rest.exceptions.UnauthorizedException;\n+\n+import com.google.gson.JsonSyntaxException;\n+\n+/**\n+ * Allows access to the AutomowerConnectApi\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerConnectApi extends HusqvarnaApi {\n+\n+    public AutomowerConnectApi(HttpClient httpClient) {\n+        super(httpClient);\n+    }\n+\n+    @Override\n+    public String getBaseUrl() {\n+        return \"https://api.amc.husqvarna.dev/v1\";\n+    }\n+\n+    public MowerListResult getMowers(String appKey, String token) throws AutomowerCommunicationException {\n+        final Request request = getHttpClient().newRequest(getBaseUrl() + \"/mowers\");\n+        request.method(HttpMethod.GET);\n+\n+        request.header(\"Authorization-Provider\", \"husqvarna\");\n+        request.header(\"Authorization\", \"Bearer \" + token);\n+        request.header(\"X-Api-Key\", appKey);\n+        request.header(\"Content-Type\", \"application/vnd.api+json\");\n+\n+        ContentResponse response;\n+        try {\n+            response = request.send();\n+        } catch (InterruptedException | TimeoutException | ExecutionException e) {\n+            throw new AutomowerCommunicationException(e);\n+        }\n+\n+        return parseResponse(response, MowerListResult.class);\n+    }\n+\n+    public MowerResult getMower(String appKey, String token, String mowerId) throws AutomowerCommunicationException {\n+        final Request request = getHttpClient().newRequest(getBaseUrl() + \"/mowers/\" + mowerId);\n+        request.method(HttpMethod.GET);\n+\n+        request.header(\"Authorization-Provider\", \"husqvarna\");\n+        request.header(\"Authorization\", \"Bearer \" + token);\n+        request.header(\"X-Api-Key\", appKey);\n+        request.header(\"Content-Type\", \"application/vnd.api+json\");\n+\n+        ContentResponse response;\n+        try {\n+            response = request.send();\n+        } catch (InterruptedException | TimeoutException | ExecutionException e) {\n+            throw new AutomowerCommunicationException(e);\n+        }\n+\n+        return parseResponse(response, MowerResult.class);\n+    }\n+\n+    public void sendCommand(String appKey, String token, String id, MowerCommandRequest command)\n+            throws AutomowerCommunicationException {\n+        final Request request = getHttpClient().newRequest(getBaseUrl() + \"/mowers/\" + id + \"/actions\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDkxNjMyMg=="}, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 91}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNzAwNDgwOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/authentication/AuthenticationApi.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwNzoyOTo1OFrOHKo92Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOVQxOToyMjozNlrOHUt3wA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDkxOTAwMQ==", "bodyText": "This looks like a OAuth2 authentication process. Although I miss the callback part. Where normally the service authenticated calls back on a specific url. But that doesn't seem to be done here.\nIn openHAB we have a service for handling OAuth2 authentication. You can get the service via OAuthFactory. See for example the Spotify binding for how that works. It also persists the refresh key and access key. This means you don't have to implement your own. Can you have a look at it. We would prefer if you use it if this is a OAuth2 compatible process.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r480919001", "createdAt": "2020-09-01T07:29:58Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/authentication/AuthenticationApi.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.rest.api.authentication;\n+\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.TimeoutException;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.util.FormContentProvider;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.http.HttpStatus;\n+import org.eclipse.jetty.util.Fields;\n+import org.openhab.binding.automower.internal.rest.api.HusqvarnaApi;\n+import org.openhab.binding.automower.internal.rest.api.authentication.dto.PostOAuth2Response;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.openhab.binding.automower.internal.rest.exceptions.UnauthorizedException;\n+\n+import com.google.gson.JsonSyntaxException;\n+\n+/**\n+ * Gives access to the Husqvarna authentication api\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AuthenticationApi extends HusqvarnaApi {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU2Nzg2NA==", "bodyText": "Yes, it is OAuth2. For sure I will use the existing functionality. Thanks for the hint.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r487567864", "createdAt": "2020-09-13T19:30:42Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/authentication/AuthenticationApi.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.rest.api.authentication;\n+\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.TimeoutException;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.util.FormContentProvider;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.http.HttpStatus;\n+import org.eclipse.jetty.util.Fields;\n+import org.openhab.binding.automower.internal.rest.api.HusqvarnaApi;\n+import org.openhab.binding.automower.internal.rest.api.authentication.dto.PostOAuth2Response;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.openhab.binding.automower.internal.rest.exceptions.UnauthorizedException;\n+\n+import com.google.gson.JsonSyntaxException;\n+\n+/**\n+ * Gives access to the Husqvarna authentication api\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AuthenticationApi extends HusqvarnaApi {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDkxOTAwMQ=="}, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU3ODYxMQ==", "bodyText": "Hm, had a look at the Husqvarna documentation: https://developer.husqvarnagroup.cloud/apis/Authentication+API#/readme\nI did not work with oauth before. What I implemented was the \"Password Grant\" which allows a login by username and password.\nLooking at the OAuthFactory I guess this uses the \"Authorization Code Grant\" workflow. I am not sure how this redirect part works exactly, this is why I implemented the password grant.\nIn the OAuthFactory 2 urls are needed. tokenUrl and authorizationUrl. I have one where I get the token from, but not sure about the second...", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r487578611", "createdAt": "2020-09-13T21:19:14Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/authentication/AuthenticationApi.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.rest.api.authentication;\n+\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.TimeoutException;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.util.FormContentProvider;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.http.HttpStatus;\n+import org.eclipse.jetty.util.Fields;\n+import org.openhab.binding.automower.internal.rest.api.HusqvarnaApi;\n+import org.openhab.binding.automower.internal.rest.api.authentication.dto.PostOAuth2Response;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.openhab.binding.automower.internal.rest.exceptions.UnauthorizedException;\n+\n+import com.google.gson.JsonSyntaxException;\n+\n+/**\n+ * Gives access to the Husqvarna authentication api\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AuthenticationApi extends HusqvarnaApi {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDkxOTAwMQ=="}, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcwOTMyOA==", "bodyText": "In this case you can pass null for the authorizationUrl and call getAccessTokenByResourceOwnerPasswordCredentials on the OAuthClientService to get an AccessTokenResponse with the refresh/accesstoken. Then with getAccessTokenResponse() you get the token when you make a call. If the token is expired this method will first get a new token with the refreshtoken. You can also build in a fallback in case you make a call and the token turns out to be expired. You can call refreshToken() to force a refresh.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r487709328", "createdAt": "2020-09-14T07:37:40Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/authentication/AuthenticationApi.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.rest.api.authentication;\n+\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.TimeoutException;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.util.FormContentProvider;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.http.HttpStatus;\n+import org.eclipse.jetty.util.Fields;\n+import org.openhab.binding.automower.internal.rest.api.HusqvarnaApi;\n+import org.openhab.binding.automower.internal.rest.api.authentication.dto.PostOAuth2Response;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.openhab.binding.automower.internal.rest.exceptions.UnauthorizedException;\n+\n+import com.google.gson.JsonSyntaxException;\n+\n+/**\n+ * Gives access to the Husqvarna authentication api\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AuthenticationApi extends HusqvarnaApi {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDkxOTAwMQ=="}, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg4MDI5NQ==", "bodyText": "Thx, will try that", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r488880295", "createdAt": "2020-09-15T18:34:45Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/authentication/AuthenticationApi.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.rest.api.authentication;\n+\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.TimeoutException;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.util.FormContentProvider;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.http.HttpStatus;\n+import org.eclipse.jetty.util.Fields;\n+import org.openhab.binding.automower.internal.rest.api.HusqvarnaApi;\n+import org.openhab.binding.automower.internal.rest.api.authentication.dto.PostOAuth2Response;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.openhab.binding.automower.internal.rest.exceptions.UnauthorizedException;\n+\n+import com.google.gson.JsonSyntaxException;\n+\n+/**\n+ * Gives access to the Husqvarna authentication api\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AuthenticationApi extends HusqvarnaApi {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDkxOTAwMQ=="}, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTQ4NTEyMA==", "bodyText": "Thanks for the hint. Works very well. Was able to remove quite some code...", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r491485120", "createdAt": "2020-09-19T19:22:36Z", "author": {"login": "maxpg"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/rest/api/authentication/AuthenticationApi.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.rest.api.authentication;\n+\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.TimeoutException;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.util.FormContentProvider;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.http.HttpStatus;\n+import org.eclipse.jetty.util.Fields;\n+import org.openhab.binding.automower.internal.rest.api.HusqvarnaApi;\n+import org.openhab.binding.automower.internal.rest.api.authentication.dto.PostOAuth2Response;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.openhab.binding.automower.internal.rest.exceptions.UnauthorizedException;\n+\n+import com.google.gson.JsonSyntaxException;\n+\n+/**\n+ * Gives access to the Husqvarna authentication api\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AuthenticationApi extends HusqvarnaApi {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDkxOTAwMQ=="}, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNzAxNTA3OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwNzozMTo1M1rOHKpEbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwNzozMTo1M1rOHKpEbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDkyMDY4Ng==", "bodyText": "You can simple make this with a method in this class and call the method as this::poller in the scheduleWithFixedDelay call. (overlaps a bit with the other comment about making it a lambda)", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r480920686", "createdAt": "2020-09-01T07:31:53Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.automower/src/main/java/org/openhab/binding/automower/internal/bridge/AutomowerBridgeHandler.java", "diffHunk": "@@ -0,0 +1,162 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.automower.internal.bridge;\n+\n+import static org.openhab.binding.automower.internal.AutomowerBindingConstants.THING_TYPE_BRIDGE;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.automower.internal.rest.api.automowerconnect.dto.MowerListResult;\n+import org.openhab.binding.automower.internal.rest.exceptions.AutomowerCommunicationException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AutomowerBridgeHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Markus Pfleger - Initial contribution\n+ */\n+@NonNullByDefault\n+public class AutomowerBridgeHandler extends BaseBridgeHandler {\n+    private final Logger logger = LoggerFactory.getLogger(AutomowerBridgeHandler.class);\n+\n+    public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES = Collections.singleton(THING_TYPE_BRIDGE);\n+    private static final long DEFAULT_POLLING_INTERVAL_S = TimeUnit.HOURS.toSeconds(1);\n+\n+    private @Nullable ScheduledFuture<?> automowerBridgePollingJob;\n+\n+    private @Nullable AutomowerBridge bridge;\n+    private final HttpClient httpClient;\n+\n+    private static class AutomowerBridgePollingRunnable implements Runnable {\n+        private final Logger logger = LoggerFactory.getLogger(AutomowerBridgePollingRunnable.class);\n+\n+        private final AutomowerBridgeHandler handler;\n+        private final AutomowerBridge bridge;\n+\n+        private AutomowerBridgePollingRunnable(AutomowerBridgeHandler handler, AutomowerBridge bridge) {\n+            this.handler = handler;\n+            this.bridge = bridge;\n+        }\n+\n+        @Override\n+        public void run() {\n+            MowerListResult automowers;\n+            try {\n+                automowers = bridge.getAutomowers();\n+                handler.updateStatus(ThingStatus.ONLINE);\n+                logger.debug(\"Found {} automowers\", automowers.getData().size());\n+            } catch (AutomowerCommunicationException e) {\n+                handler.updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                        \"@text/comm-error-query-mowers-failed\");\n+                logger.warn(\"Unable to fetch automowers: {}\", e.getMessage());\n+            }\n+        }\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 80}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNzA0MzQxOnYy", "diffSide": "RIGHT", "path": "bom/openhab-addons/pom.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwNzozNzoyOVrOHKpWsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxOTozMzo0OVrOHQ-zLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDkyNTM2MA==", "bodyText": "Indentation.", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r480925360", "createdAt": "2020-09-01T07:37:29Z", "author": {"login": "Hilbrand"}, "path": "bom/openhab-addons/pom.xml", "diffHunk": "@@ -68,6 +68,11 @@\n       <groupId>org.openhab.addons.bundles</groupId>\n       <artifactId>org.openhab.binding.autelis</artifactId>\n       <version>${project.version}</version>\n+    </dependency>\n+\t<dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU2ODE3Mg==", "bodyText": "ok", "url": "https://github.com/openhab/openhab-addons/pull/8050#discussion_r487568172", "createdAt": "2020-09-13T19:33:49Z", "author": {"login": "maxpg"}, "path": "bom/openhab-addons/pom.xml", "diffHunk": "@@ -68,6 +68,11 @@\n       <groupId>org.openhab.addons.bundles</groupId>\n       <artifactId>org.openhab.binding.autelis</artifactId>\n       <version>${project.version}</version>\n+    </dependency>\n+\t<dependency>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDkyNTM2MA=="}, "originalCommit": {"oid": "a551e342a81d945cdf2a7cb2e0e509d954aec1ff"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4686, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}