{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzNzM2MTM2", "number": 8055, "title": "[deconz] Add dynamic state descriptions and fix property updates", "bodyText": "This fixes the wrong ctmin/ctmax values for manually added things (both managed and unmanaged) and provides proper state descriptions for the color temperature.\nSigned-off-by: Jan N. Klug jan.n.klug@rub.de", "createdAt": "2020-07-02T20:50:41Z", "url": "https://github.com/openhab/openhab-addons/pull/8055", "merged": true, "mergeCommit": {"oid": "3523c75d7f677b8d1a0e4c0f355843c9c9b435f5"}, "closed": true, "closedAt": "2020-07-08T04:14:11Z", "author": {"login": "J-N-K"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcxE0oqgH2gAyNDQzNzM2MTM2OmRhOTdhMGMyZGEzN2QyOGMyYjBmNTgxNjRhNTdlMzhiNWUxYWJhNzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcyyghIAFqTQ0NDQwMDAwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "da97a0c2da37d28c2b0f58164a57e38b5e1aba77", "author": {"user": {"login": "J-N-K", "name": null}}, "url": "https://github.com/openhab/openhab-addons/commit/da97a0c2da37d28c2b0f58164a57e38b5e1aba77", "committedDate": "2020-07-02T20:25:29Z", "message": "add dynamic state descriptions and fix property updates\n\nSigned-off-by: Jan N. Klug <jan.n.klug@rub.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31dfecc902cbc5ba76599cb782611441ee2e374a", "author": {"user": {"login": "J-N-K", "name": null}}, "url": "https://github.com/openhab/openhab-addons/commit/31dfecc902cbc5ba76599cb782611441ee2e374a", "committedDate": "2020-07-05T10:29:35Z", "message": "fixes and improvements\n\nSigned-off-by: Jan N. Klug <jan.n.klug@rub.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MTg3NjUw", "url": "https://github.com/openhab/openhab-addons/pull/8055#pullrequestreview-444187650", "createdAt": "2020-07-07T19:29:46Z", "commit": {"oid": "31dfecc902cbc5ba76599cb782611441ee2e374a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxOToyOTo0NlrOGuMl4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxOToyOTo0NlrOGuMl4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA5Mzk4NQ==", "bodyText": "Would there ever be a circumstance in which a thing would contain CT_MIN and CT_MAX properties without the thingtype being THING_TYPE_COLOR_TEMPERATURE_LIGHT or THING_TYPE_EXTENDED_COLOR_LIGHT. Would it be possible to do away with the thingtype check here and only check for the presence of the properties instead?", "url": "https://github.com/openhab/openhab-addons/pull/8055#discussion_r451093985", "createdAt": "2020-07-07T19:29:46Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.deconz/src/main/java/org/openhab/binding/deconz/internal/handler/LightThingHandler.java", "diffHunk": "@@ -70,21 +77,51 @@\n \n     private final Logger logger = LoggerFactory.getLogger(LightThingHandler.class);\n \n+    private final StateDescriptionProvider stateDescriptionProvider;\n+\n     private long lastCommandExpireTimestamp = 0;\n+    private boolean needsPropertyUpdate = false;\n \n     /**\n      * The light state. Contains all possible fields for all supported lights\n      */\n     private LightState lightStateCache = new LightState();\n     private LightState lastCommand = new LightState();\n \n-    private final int ct_max;\n-    private final int ct_min;\n+    // set defaults, we can override them later if we receive better values\n+    private int ctMax = ZCL_CT_MAX;\n+    private int ctMin = ZCL_CT_MIN;\n \n-    public LightThingHandler(Thing thing, Gson gson) {\n+    public LightThingHandler(Thing thing, Gson gson, StateDescriptionProvider stateDescriptionProvider) {\n         super(thing, gson);\n-        ct_max = parseIntWithFallback(thing.getProperties().get(PROPERTY_CT_MAX), ZCL_CT_MAX);\n-        ct_min = parseIntWithFallback(thing.getProperties().get(PROPERTY_CT_MIN), ZCL_CT_MIN);\n+\n+        this.stateDescriptionProvider = stateDescriptionProvider;\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        if (thing.getThingTypeUID().equals(THING_TYPE_COLOR_TEMPERATURE_LIGHT)\n+                || thing.getThingTypeUID().equals(THING_TYPE_EXTENDED_COLOR_LIGHT)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31dfecc902cbc5ba76599cb782611441ee2e374a"}, "originalPosition": 54}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0NDAwMDA2", "url": "https://github.com/openhab/openhab-addons/pull/8055#pullrequestreview-444400006", "createdAt": "2020-07-08T04:13:04Z", "commit": {"oid": "31dfecc902cbc5ba76599cb782611441ee2e374a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 85, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}