{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyODY5Mzk4", "number": 6838, "title": "[mqtt] renenable outgoing formatting and address #6831", "bodyText": "I am a bit confused...\nfor one thing, I seemed to have a bigger problem handling multiple PRs in parallel. With my last PR I undid the one before :-(\nSo this PR redoes #6755 .\nI was not able to reproduce the described problems with the code versions I found.\nBefore #6755, the dimmer would always use BigDecimal.toString() and ignore the format altogether.\nWith #6755, dimmer would replace %s with %.0f for integer values....\nNow the PercentValue will utilize the DecimalType.format() function.\nAlso a unit test is added.", "createdAt": "2020-01-14T22:29:47Z", "url": "https://github.com/openhab/openhab-addons/pull/6838", "merged": true, "mergeCommit": {"oid": "17b7b39acb9395bcdb0d55ace6d0e3b9de4eb0c8"}, "closed": true, "closedAt": "2020-01-20T09:19:28Z", "author": {"login": "jochen314"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb6YEcrgH2gAyMzYyODY5Mzk4OjI2NWEzYjM4MDUxNjdmNmRhNDk2MDA0NjJiMmRkMzlmMzlmNjk0NDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb8I_aEgFqTM0NTE2NzQ4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "265a3b3805167f6da49600462b2dd39f39f69447", "author": {"user": {"login": "jochen314", "name": "Jochen Klein"}}, "url": "https://github.com/openhab/openhab-addons/commit/265a3b3805167f6da49600462b2dd39f39f69447", "committedDate": "2020-01-14T21:45:07Z", "message": "redo outgoing format\n\nSigned-off-by: Jochen Klein <git@jochen.susca.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92ce13ed6d9f8a04bec165a89b7aba4f2330fe81", "author": {"user": {"login": "jochen314", "name": "Jochen Klein"}}, "url": "https://github.com/openhab/openhab-addons/commit/92ce13ed6d9f8a04bec165a89b7aba4f2330fe81", "committedDate": "2020-01-14T22:13:57Z", "message": "Fix scientific notation for percent type\n\nSigned-off-by: Jochen Klein <git@jochen.susca.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzNDI1OTI1", "url": "https://github.com/openhab/openhab-addons/pull/6838#pullrequestreview-343425925", "createdAt": "2020-01-15T18:22:56Z", "commit": {"oid": "92ce13ed6d9f8a04bec165a89b7aba4f2330fe81"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxODoyMjo1NlrOFeB9WA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxODoyMjo1NlrOFeB9WA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzAzMzY4OA==", "bodyText": "This is the part, which is changed against the original PR.\nUse of the DecimalType.format to do the real work.", "url": "https://github.com/openhab/openhab-addons/pull/6838#discussion_r367033688", "createdAt": "2020-01-15T18:22:56Z", "author": {"login": "jochen314"}, "path": "bundles/org.openhab.binding.mqtt.generic/src/main/java/org/openhab/binding/mqtt/generic/values/PercentageValue.java", "diffHunk": "@@ -131,20 +134,27 @@ public void update(Command command) throws IllegalArgumentException {\n     }\n \n     @Override\n-    public String getMQTTpublishValue() {\n+    public String getMQTTpublishValue(@Nullable String pattern) {\n         if (state == UnDefType.UNDEF) {\n             return \"\";\n         }\n-        // Formular: From percentage to custom min/max: value*span/100+min\n+        // Formula: From percentage to custom min/max: value*span/100+min\n         // Calculation need to happen with big decimals to either return a straight integer or a decimal depending on\n         // the value.\n-        return ((PercentType) state).toBigDecimal().multiply(BigDecimal.valueOf(span)).divide(BigDecimal.valueOf(100))\n-                .add(BigDecimal.valueOf(min)).toString();\n+        BigDecimal value = ((PercentType) state).toBigDecimal().multiply(span).divide(DB100, MathContext.DECIMAL128)\n+                .add(min).stripTrailingZeros();\n+\n+        String formatPattern = pattern;\n+        if (formatPattern == null) {\n+            formatPattern = \"%s\";\n+        }\n+\n+        return new DecimalType(value).format(formatPattern);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "92ce13ed6d9f8a04bec165a89b7aba4f2330fe81"}, "originalPosition": 131}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzNDk1NzA1", "url": "https://github.com/openhab/openhab-addons/pull/6838#pullrequestreview-343495705", "createdAt": "2020-01-15T20:20:41Z", "commit": {"oid": "92ce13ed6d9f8a04bec165a89b7aba4f2330fe81"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQyMDoyMDo0MVrOFeFPVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQyMDoyMzowOFrOFeFTcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzA4NzQ0Ng==", "bodyText": "I think HUNDRED would make more sense and/or you turned the letters of BigDecimal around", "url": "https://github.com/openhab/openhab-addons/pull/6838#discussion_r367087446", "createdAt": "2020-01-15T20:20:41Z", "author": {"login": "martinvw"}, "path": "bundles/org.openhab.binding.mqtt.generic/src/main/java/org/openhab/binding/mqtt/generic/values/PercentageValue.java", "diffHunk": "@@ -47,10 +48,11 @@\n  */\n @NonNullByDefault\n public class PercentageValue extends Value {\n-    private final double min;\n-    private final double max;\n-    private final double span;\n-    private final double step;\n+    private static final BigDecimal DB100 = BigDecimal.valueOf(100);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "92ce13ed6d9f8a04bec165a89b7aba4f2330fe81"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzA4ODQ5Ng==", "bodyText": "Why?", "url": "https://github.com/openhab/openhab-addons/pull/6838#discussion_r367088496", "createdAt": "2020-01-15T20:23:08Z", "author": {"login": "martinvw"}, "path": "bundles/org.openhab.binding.mqtt.generic/src/main/java/org/openhab/binding/mqtt/generic/values/NumberValue.java", "diffHunk": "@@ -56,7 +56,7 @@ public NumberValue(@Nullable BigDecimal min, @Nullable BigDecimal max, @Nullable\n                 .collect(Collectors.toList()));\n         this.min = min;\n         this.max = max;\n-        this.step = step == null ? BigDecimal.ONE : step;\n+        this.step = step == null ? new BigDecimal(1.0) : step;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "92ce13ed6d9f8a04bec165a89b7aba4f2330fe81"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78eb48fa1f43fdb81aecdcb6a1a212f06213dd34", "author": {"user": {"login": "jochen314", "name": "Jochen Klein"}}, "url": "https://github.com/openhab/openhab-addons/commit/78eb48fa1f43fdb81aecdcb6a1a212f06213dd34", "committedDate": "2020-01-16T19:35:19Z", "message": "review comments\n\nSigned-off-by: Jochen Klein <git@jochen.susca.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0Njk3MDc1", "url": "https://github.com/openhab/openhab-addons/pull/6838#pullrequestreview-344697075", "createdAt": "2020-01-17T16:31:46Z", "commit": {"oid": "78eb48fa1f43fdb81aecdcb6a1a212f06213dd34"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1MTY3NDg4", "url": "https://github.com/openhab/openhab-addons/pull/6838#pullrequestreview-345167488", "createdAt": "2020-01-20T09:18:53Z", "commit": {"oid": "78eb48fa1f43fdb81aecdcb6a1a212f06213dd34"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1660, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}