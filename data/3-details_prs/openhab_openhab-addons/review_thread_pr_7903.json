{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzNTU0Mzk1", "number": 7903, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQyMjo0NTozOVrOEFNPEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QyMDozMDoyNVrOEFRkSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczODk1MTg1OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.robonect/src/main/java/org/openhab/binding/robonect/internal/handler/RobonectHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQyMjo0NTozOVrOGjTWhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QwODo1MTo1MFrOGjWihw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3MDQwNw==", "bodyText": "This will throw an NPE if timeZoneString is null.", "url": "https://github.com/openhab/openhab-addons/pull/7903#discussion_r439670407", "createdAt": "2020-06-12T22:45:39Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.robonect/src/main/java/org/openhab/binding/robonect/internal/handler/RobonectHandler.java", "diffHunk": "@@ -329,6 +345,16 @@ public void initialize() {\n         RobonectConfig robonectConfig = getConfigAs(RobonectConfig.class);\n         RobonectEndpoint endpoint = new RobonectEndpoint(robonectConfig.getHost(), robonectConfig.getUser(),\n                 robonectConfig.getPassword());\n+\n+        String timeZoneString = robonectConfig.getTimezone();\n+        try {\n+            timeZone = ZoneId.of(timeZoneString);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ced56692ae29397b0cb8897a7fc8ffc00c48d94"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTcyMjYzMQ==", "bodyText": "Thanks, good catch!\nI have fixed it.", "url": "https://github.com/openhab/openhab-addons/pull/7903#discussion_r439722631", "createdAt": "2020-06-13T08:51:50Z", "author": {"login": "t2000"}, "path": "bundles/org.openhab.binding.robonect/src/main/java/org/openhab/binding/robonect/internal/handler/RobonectHandler.java", "diffHunk": "@@ -329,6 +345,16 @@ public void initialize() {\n         RobonectConfig robonectConfig = getConfigAs(RobonectConfig.class);\n         RobonectEndpoint endpoint = new RobonectEndpoint(robonectConfig.getHost(), robonectConfig.getUser(),\n                 robonectConfig.getPassword());\n+\n+        String timeZoneString = robonectConfig.getTimezone();\n+        try {\n+            timeZone = ZoneId.of(timeZoneString);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3MDQwNw=="}, "originalCommit": {"oid": "7ced56692ae29397b0cb8897a7fc8ffc00c48d94"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTY2MTU1OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.robonect/src/main/java/org/openhab/binding/robonect/internal/handler/RobonectHandler.java", "isResolved": false, "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QyMDozMDoyNVrOGjZQYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNToxNDoxMVrOGlKomA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc2NzEzOQ==", "bodyText": "I think instead of caching this value in a field, you might consider dynamically creating it every time since its value should fall back to the timeZoneProvider timezone whenever it isn't specified by the config.\nThe problem I see is that the value returned by timeZoneProvider might change over time if the user changes settings in runtime.\nSo any value returned by timeZoneProvider should never be cached since it might change at any time, without notification.", "url": "https://github.com/openhab/openhab-addons/pull/7903#discussion_r439767139", "createdAt": "2020-06-13T20:30:25Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.robonect/src/main/java/org/openhab/binding/robonect/internal/handler/RobonectHandler.java", "diffHunk": "@@ -71,12 +74,16 @@\n     private ScheduledFuture<?> pollingJob;\n \n     private HttpClient httpClient;\n+    private TimeZoneProvider timeZoneProvider;\n+\n+    private ZoneId timeZone = ZoneId.of(\"Europe/Berlin\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "beb09bf852be0fb88cd2f31a92f51a5543ae2cfb"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc3NzMzNw==", "bodyText": "My suggestion is to more or less replace uses of timeZone with a new method getTimeZone().", "url": "https://github.com/openhab/openhab-addons/pull/7903#discussion_r439777337", "createdAt": "2020-06-13T23:25:49Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.robonect/src/main/java/org/openhab/binding/robonect/internal/handler/RobonectHandler.java", "diffHunk": "@@ -71,12 +74,16 @@\n     private ScheduledFuture<?> pollingJob;\n \n     private HttpClient httpClient;\n+    private TimeZoneProvider timeZoneProvider;\n+\n+    private ZoneId timeZone = ZoneId.of(\"Europe/Berlin\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc2NzEzOQ=="}, "originalCommit": {"oid": "beb09bf852be0fb88cd2f31a92f51a5543ae2cfb"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgxMjk3Mg==", "bodyText": "I haven't thought about this. thanks for pointing it out!\nI have added a commit to change this.", "url": "https://github.com/openhab/openhab-addons/pull/7903#discussion_r439812972", "createdAt": "2020-06-14T10:08:09Z", "author": {"login": "t2000"}, "path": "bundles/org.openhab.binding.robonect/src/main/java/org/openhab/binding/robonect/internal/handler/RobonectHandler.java", "diffHunk": "@@ -71,12 +74,16 @@\n     private ScheduledFuture<?> pollingJob;\n \n     private HttpClient httpClient;\n+    private TimeZoneProvider timeZoneProvider;\n+\n+    private ZoneId timeZone = ZoneId.of(\"Europe/Berlin\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc2NzEzOQ=="}, "originalCommit": {"oid": "beb09bf852be0fb88cd2f31a92f51a5543ae2cfb"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDI4MTAzOQ==", "bodyText": "I thought about this again and noticed that if you change the configuration of the thing, the handler gets restarted anyway, because it doesn't overwrite handleConfigurationUpdate and thus the BaseThingHandler#handleConfigurationUpdate will call dispose() and initialize(), so my previous implementation would also read the changed value within initialize().\nI leave it up to you, to include the commit with the change or to drop it during merge.", "url": "https://github.com/openhab/openhab-addons/pull/7903#discussion_r440281039", "createdAt": "2020-06-15T15:59:07Z", "author": {"login": "t2000"}, "path": "bundles/org.openhab.binding.robonect/src/main/java/org/openhab/binding/robonect/internal/handler/RobonectHandler.java", "diffHunk": "@@ -71,12 +74,16 @@\n     private ScheduledFuture<?> pollingJob;\n \n     private HttpClient httpClient;\n+    private TimeZoneProvider timeZoneProvider;\n+\n+    private ZoneId timeZone = ZoneId.of(\"Europe/Berlin\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc2NzEzOQ=="}, "originalCommit": {"oid": "beb09bf852be0fb88cd2f31a92f51a5543ae2cfb"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDI4NDU1NA==", "bodyText": "Edit: I decided to drop my commit because it was difficult to fix the tests (accessing the config ran into an NPE).", "url": "https://github.com/openhab/openhab-addons/pull/7903#discussion_r440284554", "createdAt": "2020-06-15T16:04:36Z", "author": {"login": "t2000"}, "path": "bundles/org.openhab.binding.robonect/src/main/java/org/openhab/binding/robonect/internal/handler/RobonectHandler.java", "diffHunk": "@@ -71,12 +74,16 @@\n     private ScheduledFuture<?> pollingJob;\n \n     private HttpClient httpClient;\n+    private TimeZoneProvider timeZoneProvider;\n+\n+    private ZoneId timeZone = ZoneId.of(\"Europe/Berlin\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc2NzEzOQ=="}, "originalCommit": {"oid": "beb09bf852be0fb88cd2f31a92f51a5543ae2cfb"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDM4Mjk4NQ==", "bodyText": "I was referring to the return value of timeZoneProvider changing during runtime. A change in the return value wouldn't notify the handler and it wouldn't restart the handler or binding in any way. The binding shouldn't save what timeZoneProvider return into a field.", "url": "https://github.com/openhab/openhab-addons/pull/7903#discussion_r440382985", "createdAt": "2020-06-15T19:00:19Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.robonect/src/main/java/org/openhab/binding/robonect/internal/handler/RobonectHandler.java", "diffHunk": "@@ -71,12 +74,16 @@\n     private ScheduledFuture<?> pollingJob;\n \n     private HttpClient httpClient;\n+    private TimeZoneProvider timeZoneProvider;\n+\n+    private ZoneId timeZone = ZoneId.of(\"Europe/Berlin\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc2NzEzOQ=="}, "originalCommit": {"oid": "beb09bf852be0fb88cd2f31a92f51a5543ae2cfb"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDYwNDU4MQ==", "bodyText": "Hmm, I think we are talking about two different things here:\n\nThe timezone of the thing and its fallbacks.\nThe timezone as it should be presented to the user.\n\nFor point 2 I am always using the currently configured time in convertUnitToDateTimeType()\n// we provide the time in the format as configured in the openHAB settings\n ZonedDateTime zdt = adjustedInstant.atZone(timeZoneProvider.getTimeZone());\n\nas its always requested from the timeZoneProvider.\nFor point 1. the information from the timeZoneProvider acts as a fallback only for the lifetime of the Thinghandler, or until someone sets the correct time on the thing (because then dispose and initialize will be called anyway.\nSo do you want me to change this, even if its just a fallback and even a warning is printed to the user to make him aware of that he should add the correct zone to his Thing configuration? I am fine with doing so, if you think its better. I just wanted to clarify things and see if I have understood you correctly.", "url": "https://github.com/openhab/openhab-addons/pull/7903#discussion_r440604581", "createdAt": "2020-06-16T06:03:11Z", "author": {"login": "t2000"}, "path": "bundles/org.openhab.binding.robonect/src/main/java/org/openhab/binding/robonect/internal/handler/RobonectHandler.java", "diffHunk": "@@ -71,12 +74,16 @@\n     private ScheduledFuture<?> pollingJob;\n \n     private HttpClient httpClient;\n+    private TimeZoneProvider timeZoneProvider;\n+\n+    private ZoneId timeZone = ZoneId.of(\"Europe/Berlin\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc2NzEzOQ=="}, "originalCommit": {"oid": "beb09bf852be0fb88cd2f31a92f51a5543ae2cfb"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA1NTM3OA==", "bodyText": "I am fine with doing so, if you think its better. I just wanted to clarify things and see if I have understood you correctly.\n\nYep you have understood me correctly.", "url": "https://github.com/openhab/openhab-addons/pull/7903#discussion_r441055378", "createdAt": "2020-06-16T18:23:09Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.robonect/src/main/java/org/openhab/binding/robonect/internal/handler/RobonectHandler.java", "diffHunk": "@@ -71,12 +74,16 @@\n     private ScheduledFuture<?> pollingJob;\n \n     private HttpClient httpClient;\n+    private TimeZoneProvider timeZoneProvider;\n+\n+    private ZoneId timeZone = ZoneId.of(\"Europe/Berlin\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc2NzEzOQ=="}, "originalCommit": {"oid": "beb09bf852be0fb88cd2f31a92f51a5543ae2cfb"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYyNDcyOA==", "bodyText": "Great :)\ni have now changed it in a way that the warning about the not set timezone on the thing will only be printed once on the startup of the handler and if it is not set, I get it from the timezoneProvider at runtime for every call.", "url": "https://github.com/openhab/openhab-addons/pull/7903#discussion_r441624728", "createdAt": "2020-06-17T15:14:11Z", "author": {"login": "t2000"}, "path": "bundles/org.openhab.binding.robonect/src/main/java/org/openhab/binding/robonect/internal/handler/RobonectHandler.java", "diffHunk": "@@ -71,12 +74,16 @@\n     private ScheduledFuture<?> pollingJob;\n \n     private HttpClient httpClient;\n+    private TimeZoneProvider timeZoneProvider;\n+\n+    private ZoneId timeZone = ZoneId.of(\"Europe/Berlin\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc2NzEzOQ=="}, "originalCommit": {"oid": "beb09bf852be0fb88cd2f31a92f51a5543ae2cfb"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4778, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}