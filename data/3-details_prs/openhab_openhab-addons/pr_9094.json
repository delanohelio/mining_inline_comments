{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI1MTg0OTcx", "number": 9094, "title": "[yioremote] Make the Binding compatible to new firmware version of YIO Dock", "bodyText": "Sign Off Michael Loercher michaelloercher@web.de\nMake the binding compatible to the new firmware\n\nMake the binding compatible to the new firmware\n\nMake the binding compatible to the new firmware\n\nTested with my setup", "createdAt": "2020-11-21T20:20:59Z", "url": "https://github.com/openhab/openhab-addons/pull/9094", "merged": true, "mergeCommit": {"oid": "3fb0b8698980f34618043365ec3be94bfffc6377"}, "closed": true, "closedAt": "2020-11-26T22:47:08Z", "author": {"login": "miloit"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdex_gwgH2gAyNTI1MTg0OTcxOjU5NmU4MzA4ZTQzNjU0NjVkN2I4ZDc0ZTM0YmQyOTc0ZjdmYzU5MTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdga8iaAFqTUzOTU3MDczNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "596e8308e4365465d7b8d74e34bd2974f7fc5916", "author": {"user": {"login": "miloit", "name": null}}, "url": "https://github.com/openhab/openhab-addons/commit/596e8308e4365465d7b8d74e34bd2974f7fc5916", "committedDate": "2020-11-21T20:29:41Z", "message": "Make the Binding compatible to new firmware version of YIO Dock\n\nSign Off Michael Loercher <michaelloercher\n\nSigned-off-by: Michael Loercher <MichaelLoercher@web.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d6917ea31a85c520ec071ffd8a580534e83b8c0", "author": {"user": {"login": "miloit", "name": null}}, "url": "https://github.com/openhab/openhab-addons/commit/7d6917ea31a85c520ec071ffd8a580534e83b8c0", "committedDate": "2020-11-21T21:26:44Z", "message": "removed senseles debug\n\nSigned-off-by: Michael Loercher<MichaelLoercher@web.de>\nSigned-off-by: Michael Loercher <MichaelLoercher@web.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MDExNjM2", "url": "https://github.com/openhab/openhab-addons/pull/9094#pullrequestreview-536011636", "createdAt": "2020-11-21T21:59:33Z", "commit": {"oid": "7d6917ea31a85c520ec071ffd8a580534e83b8c0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQyMTo1OTozM1rOH3xrQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQyMTo1OTozM1rOH3xrQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODI0NzYxNg==", "bodyText": "Why is this file changed?", "url": "https://github.com/openhab/openhab-addons/pull/9094#discussion_r528247616", "createdAt": "2020-11-21T21:59:33Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.teleinfo/src/test/resources/cbetm-base-option-1.raw", "diffHunk": "@@ -1,19 +1,19 @@\n-MOTDETAT 000000 B\n-\u0003\u0002\n-ADCO XXXXXXXXXXXX 7\n-OPTARIF BASE 0\n-ISOUSC 20 8\n-BASE 001181243 _\n-PTEC TH.. $\n-IINST1 000 H\n-IINST2 002 K\n-IINST3 000 J\n-IMAX1 026 8\n-IMAX2 018 :\n-IMAX3 027 ;\n-PMAX 07990 ?\n-PAPP 00540 *\n-MOTDETAT 400000 F\n-PPOT 00 #\u0002\n-\u0003\u0002\n+MOTDETAT 000000 B\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d6917ea31a85c520ec071ffd8a580534e83b8c0"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MDExNjYx", "url": "https://github.com/openhab/openhab-addons/pull/9094#pullrequestreview-536011661", "createdAt": "2020-11-21T21:59:56Z", "commit": {"oid": "7d6917ea31a85c520ec071ffd8a580534e83b8c0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQyMTo1OTo1N1rOH3xraw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQyMTo1OTo1N1rOH3xraw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODI0NzY1OQ==", "bodyText": "this one too", "url": "https://github.com/openhab/openhab-addons/pull/9094#discussion_r528247659", "createdAt": "2020-11-21T21:59:57Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.teleinfo/src/test/resources/cbetm-ejp-option-1.raw", "diffHunk": "@@ -1,20 +1,20 @@\n-MOTDETAT 000000 B\n-\u0003\u0002\n-ADCO XXXXXXXXXX G\n-OPTARIF EJP. \"\n-ISOUSC 30 9\n-EJPHN 001111111 ,\n-EJPHPM 002222222 B\n-PTEC HN.. ^\n-IINST1 010 I\n-IINST2 005 N\n-IINST3 008 R\n-IMAX1 038 ;\n-IMAX2 042 7\n-IMAX3 044 :\n-PMAX 17480 :\n-PAPP 05800 .\n-MOTDETAT 000000 B\n-PPOT 00 #\u0002\n-\u0003\u0002\n+MOTDETAT 000000 B\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d6917ea31a85c520ec071ffd8a580534e83b8c0"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MDE2MTg3", "url": "https://github.com/openhab/openhab-addons/pull/9094#pullrequestreview-536016187", "createdAt": "2020-11-21T23:28:44Z", "commit": {"oid": "64aaca92bced592e65b0c2aa995338437bba872e"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2ODA2MTEw", "url": "https://github.com/openhab/openhab-addons/pull/9094#pullrequestreview-536806110", "createdAt": "2020-11-23T20:05:42Z", "commit": {"oid": "64aaca92bced592e65b0c2aa995338437bba872e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QyMDowNTo0MlrOH4ddfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QyMDoxMDo0NlrOH4dnkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk2NDk4OA==", "bodyText": "Please remove this file from this PR.", "url": "https://github.com/openhab/openhab-addons/pull/9094#discussion_r528964988", "createdAt": "2020-11-23T20:05:42Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.yioremote/.classpath", "diffHunk": "@@ -0,0 +1,28 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<classpath>\n+\t<classpathentry kind=\"src\" output=\"target/classes\" path=\"src/main/java\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64aaca92bced592e65b0c2aa995338437bba872e"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk2NjAwMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    JsonObject pingMessage = new JsonObject();\n          \n          \n            \n                    pingMessage.addProperty(\"type\", type);\n          \n          \n            \n                    pingMessage.addProperty(\"command\", command);\n          \n          \n            \n                    return pingMessage.toString();\n          \n          \n            \n                    return getPingMessageJsonObject().toString();", "url": "https://github.com/openhab/openhab-addons/pull/9094#discussion_r528966003", "createdAt": "2020-11-23T20:07:44Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.yioremote/src/main/java/org/openhab/binding/yioremote/internal/dto/PingMessage.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.yioremote.internal.dto;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+\n+import com.google.gson.JsonObject;\n+\n+/**\n+ * The {@link PingMessage} the AuthenticationMessage DTO\n+ *\n+ *\n+ * @author Michael Loercher - Initial contribution\n+ */\n+@NonNullByDefault\n+public class PingMessage {\n+    private String type = \"dock\";\n+    private String command = \"ping\";\n+\n+    public String getType() {\n+        return type;\n+    }\n+\n+    public String getcommand() {\n+        return command;\n+    }\n+\n+    public void setToken(String command) {\n+        this.command = command;\n+    }\n+\n+    public JsonObject getPingMessageJsonObject() {\n+        JsonObject pingMessage = new JsonObject();\n+        pingMessage.addProperty(\"type\", type);\n+        pingMessage.addProperty(\"command\", command);\n+        return pingMessage;\n+    }\n+\n+    public String getPingMessageString() {\n+        JsonObject pingMessage = new JsonObject();\n+        pingMessage.addProperty(\"type\", type);\n+        pingMessage.addProperty(\"command\", command);\n+        return pingMessage.toString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64aaca92bced592e65b0c2aa995338437bba872e"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk2NzU2OQ==", "bodyText": "resetHeartbeat() always returns true now, so this code will never get called anymore...", "url": "https://github.com/openhab/openhab-addons/pull/9094#discussion_r528967569", "createdAt": "2020-11-23T20:10:46Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.yioremote/src/main/java/org/openhab/binding/yioremote/internal/YIOremoteDockHandler.java", "diffHunk": "@@ -337,11 +337,30 @@ private void disposeWebsocketPollingJob() {\n     private void pollingWebsocketJob() {\n         switch (yioRemoteDockActualStatus) {\n             case AUTHENTICATION_COMPLETE:\n-                if (getAndResetHeartbeat()) {\n-                    updateChannelString(GROUP_OUTPUT, STATUS_STRING_CHANNEL,\n-                            irCodeReceivedHandler.getCode() + irCodeReceivedHandler.getFormat());\n-                    logger.debug(\"heartBeat ok\");\n+                if (resetHeartbeat()) {\n                     sendMessage(YioRemoteMessages.HEARTBEAT_MESSAGE, \"\");\n+                    yioRemoteDockActualStatus = YioRemoteDockHandleStatus.CHECK_PONG;\n+                } else {\n+                    yioRemoteDockActualStatus = YioRemoteDockHandleStatus.COMMUNICATION_ERROR;\n+                }\n+                break;\n+            case SEND_PING:\n+                if (resetHeartbeat()) {\n+                    sendMessage(YioRemoteMessages.HEARTBEAT_MESSAGE, \"\");\n+                    yioRemoteDockActualStatus = YioRemoteDockHandleStatus.CHECK_PONG;\n+                } else {\n+                    yioRemoteDockActualStatus = YioRemoteDockHandleStatus.COMMUNICATION_ERROR;\n+                    updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                            \"Connection lost no ping from YIO DOCK\");\n+                    disposeWebsocketPollingJob();\n+                    reconnectWebsocket();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64aaca92bced592e65b0c2aa995338437bba872e"}, "originalPosition": 92}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c88b9c1b02b0382c69f60e60b1ac689c68b1c462", "author": {"user": {"login": "miloit", "name": null}}, "url": "https://github.com/openhab/openhab-addons/commit/c88b9c1b02b0382c69f60e60b1ac689c68b1c462", "committedDate": "2020-11-23T20:38:17Z", "message": "revert files to origin\n\nSigned-off-by: Michael Loercher <michaelloercher@web.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "295d0ffdbd3fa45af068cafde7f3462f42b7d1b3", "author": {"user": {"login": "miloit", "name": null}}, "url": "https://github.com/openhab/openhab-addons/commit/295d0ffdbd3fa45af068cafde7f3462f42b7d1b3", "committedDate": "2020-11-23T20:50:03Z", "message": "changed\n\nSigned-off-by: Michael Loercher <michaelloercher@web.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eab1d1f638183e3175ed2251a85f6dbddec06fb9", "author": {"user": {"login": "miloit", "name": null}}, "url": "https://github.com/openhab/openhab-addons/commit/eab1d1f638183e3175ed2251a85f6dbddec06fb9", "committedDate": "2020-11-23T20:58:40Z", "message": "Delete .classpath\n\nSigned-off-by: Michael Loercher <michaelloercher@web.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fce356a362d2092289717693e256e1826765186c", "author": {"user": {"login": "miloit", "name": null}}, "url": "https://github.com/openhab/openhab-addons/commit/fce356a362d2092289717693e256e1826765186c", "committedDate": "2020-11-23T21:03:31Z", "message": "changes for easier read\n\nSigned-off-by: Michael Loercher<michaelloercher@web.de>\nSigned-off-by: Michael Loercher <MichaelLoercher@web.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9abb4d31dd0193b50c4acb83b141cdb60e1d1c9a", "author": {"user": {"login": "miloit", "name": null}}, "url": "https://github.com/openhab/openhab-addons/commit/9abb4d31dd0193b50c4acb83b141cdb60e1d1c9a", "committedDate": "2020-11-25T20:44:15Z", "message": "Update of code\n\nSigned-off-by: Michael Loercher<michaelloercher@web.de>\nSigned-off-by: Michael Loercher <MichaelLoercher@web.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ceed1a49d77fc06d2d8abcad89cfa9235c39f763", "author": {"user": {"login": "miloit", "name": null}}, "url": "https://github.com/openhab/openhab-addons/commit/ceed1a49d77fc06d2d8abcad89cfa9235c39f763", "committedDate": "2020-11-25T20:54:37Z", "message": "code updates\n\nSigned-off-by: Michael Loercher<michaelloercher@web.de>\nSigned-off-by: Michael Loercher <MichaelLoercher@web.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5NTcwNzM3", "url": "https://github.com/openhab/openhab-addons/pull/9094#pullrequestreview-539570737", "createdAt": "2020-11-26T22:46:28Z", "commit": {"oid": "ceed1a49d77fc06d2d8abcad89cfa9235c39f763"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4161, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}