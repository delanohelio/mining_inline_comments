{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQxMzg3NTkw", "number": 9401, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQyMzo0NTo0N1rOFIVekA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQyMzo0NTo0N1rOFIVekA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0Mjg0ODE2OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.comfoair/src/main/java/org/openhab/binding/comfoair/internal/ComfoAirHandler.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQyMzo0NTo0N1rOIKMcYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNFQwMDo1NDozNVrOIK7vAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU2MDU0NQ==", "bodyText": "Why are you updating states while the handler is getting disposed? Disposal usually indicates that openHAB is shutting down so you shouldn't delay it by creating new events.", "url": "https://github.com/openhab/openhab-addons/pull/9401#discussion_r547560545", "createdAt": "2020-12-22T23:45:47Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.comfoair/src/main/java/org/openhab/binding/comfoair/internal/ComfoAirHandler.java", "diffHunk": "@@ -140,6 +152,8 @@ public void dispose() {\n             comfoAirConnector.close();\n         }\n \n+        updateState(ACTIVATE_CHANNEL_ID, OnOffType.OFF);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1bb3b54f8d8d0bfef826f10ea776d1b3e4e55c73"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzg4NzA4Mg==", "bodyText": "I added these (also in the connect() method) to ensure that it is reflected in the item/channel state that the control is handed back to the external controller by comfoAirConnector.close()\n\n  \n    \n      openhab-addons/bundles/org.openhab.binding.comfoair/src/main/java/org/openhab/binding/comfoair/internal/ComfoAirSerialConnector.java\n    \n    \n        Lines 114 to 121\n      in\n      1bb3b54\n    \n    \n    \n    \n\n        \n          \n           ComfoAirCommand command = ComfoAirCommandType.getChangeCommand(ComfoAirCommandType.ACTIVATE.getKey(), \n        \n\n        \n          \n                   OnOffType.OFF); \n        \n\n        \n          \n            \n        \n\n        \n          \n           if (command != null) { \n        \n\n        \n          \n               sendCommand(command, ComfoAirCommandType.Constants.EMPTY_INT_ARRAY); \n        \n\n        \n          \n           } else { \n        \n\n        \n          \n               logger.debug(\"Failure while creating COMMAND: {}\", command); \n        \n\n        \n          \n           } \n        \n    \n  \n\n\nI admit that I'm not quite sure if this is necessary (if openHAB is shut down probably not, but what if the thing is just deactivated?). Thus, I'm fine with removing it here, if you think it's overkill.", "url": "https://github.com/openhab/openhab-addons/pull/9401#discussion_r547887082", "createdAt": "2020-12-23T10:25:21Z", "author": {"login": "boehan"}, "path": "bundles/org.openhab.binding.comfoair/src/main/java/org/openhab/binding/comfoair/internal/ComfoAirHandler.java", "diffHunk": "@@ -140,6 +152,8 @@ public void dispose() {\n             comfoAirConnector.close();\n         }\n \n+        updateState(ACTIVATE_CHANNEL_ID, OnOffType.OFF);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU2MDU0NQ=="}, "originalCommit": {"oid": "1bb3b54f8d8d0bfef826f10ea776d1b3e4e55c73"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODMzNTM2Mg==", "bodyText": "In the case where the thing is deactivated it might be ok. But since you can't tell the difference between thing deactivation and openhab shutdown it is better to play it safe and always treat it as a shutdown. So please remove any channel updates during disposal. If you need to send some commands to the device as part of shutdown then that is ok.", "url": "https://github.com/openhab/openhab-addons/pull/9401#discussion_r548335362", "createdAt": "2020-12-24T00:54:35Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.comfoair/src/main/java/org/openhab/binding/comfoair/internal/ComfoAirHandler.java", "diffHunk": "@@ -140,6 +152,8 @@ public void dispose() {\n             comfoAirConnector.close();\n         }\n \n+        updateState(ACTIVATE_CHANNEL_ID, OnOffType.OFF);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU2MDU0NQ=="}, "originalCommit": {"oid": "1bb3b54f8d8d0bfef826f10ea776d1b3e4e55c73"}, "originalPosition": 84}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3695, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}