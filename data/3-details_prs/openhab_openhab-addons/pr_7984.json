{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4MTY2Mjc1", "number": 7984, "title": "[homekit] change SECURED=OFF for HomeKit lock", "bodyText": "since this is what most real locks (especially ZWave ones) do\nSigned-off-by: Cody Cutrer cody@cutrer.us\ncc @yfre", "createdAt": "2020-06-22T20:40:29Z", "url": "https://github.com/openhab/openhab-addons/pull/7984", "merged": true, "mergeCommit": {"oid": "652b610f56f6c02a1bff2d1054fdbbc4cbc286d9"}, "closed": true, "closedAt": "2020-06-28T10:27:53Z", "author": {"login": "ccutrer"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABct4L7NgFqTQzNTMwMzgxNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcvoHLdAFqTQzODc1Njg1MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1MzAzODE1", "url": "https://github.com/openhab/openhab-addons/pull/7984#pullrequestreview-435303815", "createdAt": "2020-06-22T22:00:23Z", "commit": {"oid": "ebc690b68a14771b9e0b126f265338962102c8d1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9791c5566cf287a3691b094dedd922af414a6944", "author": {"user": {"login": "ccutrer", "name": "Cody Cutrer"}}, "url": "https://github.com/openhab/openhab-addons/commit/9791c5566cf287a3691b094dedd922af414a6944", "committedDate": "2020-06-22T23:21:40Z", "message": "[homekit] allow exposing jammed state for a lock\n\nalso change SECURED to be ON for SwitchItem\nsince this is what most real locks (especially ZWave ones) do\n\nSigned-off-by: Cody Cutrer <cody@cutrer.us>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ebc690b68a14771b9e0b126f265338962102c8d1", "author": {"user": {"login": "ccutrer", "name": "Cody Cutrer"}}, "url": "https://github.com/openhab/openhab-addons/commit/ebc690b68a14771b9e0b126f265338962102c8d1", "committedDate": "2020-06-22T20:37:01Z", "message": "SECURED=ON for lock\n\nsince this is what most real locks (especially ZWave ones) do\n\nSigned-off-by: Cody Cutrer <cody@cutrer.us>"}, "afterCommit": {"oid": "9791c5566cf287a3691b094dedd922af414a6944", "author": {"user": {"login": "ccutrer", "name": "Cody Cutrer"}}, "url": "https://github.com/openhab/openhab-addons/commit/9791c5566cf287a3691b094dedd922af414a6944", "committedDate": "2020-06-22T23:21:40Z", "message": "[homekit] allow exposing jammed state for a lock\n\nalso change SECURED to be ON for SwitchItem\nsince this is what most real locks (especially ZWave ones) do\n\nSigned-off-by: Cody Cutrer <cody@cutrer.us>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NzU2ODE1", "url": "https://github.com/openhab/openhab-addons/pull/7984#pullrequestreview-438756815", "createdAt": "2020-06-28T08:24:10Z", "commit": {"oid": "9791c5566cf287a3691b094dedd922af414a6944"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQwODoyNDoxMVrOGp7caA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQwODoyNDoxMVrOGp7caA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjYxODcyOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            state.equals(OnOffType.ON) ? LockCurrentStateEnum.SECURED : LockCurrentStateEnum.UNSECURED);\n          \n          \n            \n                            state == OnOffType.ON ? LockCurrentStateEnum.SECURED : LockCurrentStateEnum.UNSECURED);", "url": "https://github.com/openhab/openhab-addons/pull/7984#discussion_r446618728", "createdAt": "2020-06-28T08:24:11Z", "author": {"login": "J-N-K"}, "path": "bundles/org.openhab.io.homekit/src/main/java/org/openhab/io/homekit/internal/accessories/HomekitLockImpl.java", "diffHunk": "@@ -47,10 +50,14 @@ public HomekitLockImpl(HomekitTaggedItem taggedItem, List<HomekitTaggedItem> man\n     @Override\n     public CompletableFuture<LockCurrentStateEnum> getLockCurrentState() {\n         @Nullable\n-        OnOffType state = getStateAs(HomekitCharacteristicType.LOCK_CURRENT_STATE, OnOffType.class);\n-        if (state != null) {\n+\n+        final State state = getItem(HomekitCharacteristicType.LOCK_CURRENT_STATE, GenericItem.class).getState();\n+        if (state instanceof DecimalType) {\n+            return CompletableFuture.completedFuture(LockCurrentStateEnum.fromCode(\n+                state.as(DecimalType.class).intValue()));\n+        } else if (state instanceof OnOffType) {\n             return CompletableFuture.completedFuture(\n-                    state == OnOffType.OFF ? LockCurrentStateEnum.SECURED : LockCurrentStateEnum.UNSECURED);\n+                state.equals(OnOffType.ON) ? LockCurrentStateEnum.SECURED : LockCurrentStateEnum.UNSECURED);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9791c5566cf287a3691b094dedd922af414a6944"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eec24f54d617f178753d7959056b9d8cf2c9f93f", "author": {"user": {"login": "J-N-K", "name": null}}, "url": "https://github.com/openhab/openhab-addons/commit/eec24f54d617f178753d7959056b9d8cf2c9f93f", "committedDate": "2020-06-28T08:24:27Z", "message": "Update bundles/org.openhab.io.homekit/src/main/java/org/openhab/io/homekit/internal/accessories/HomekitLockImpl.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NzU2ODUw", "url": "https://github.com/openhab/openhab-addons/pull/7984#pullrequestreview-438756850", "createdAt": "2020-06-28T08:24:34Z", "commit": {"oid": "eec24f54d617f178753d7959056b9d8cf2c9f93f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 328, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}