{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxNDY0NjUx", "number": 8041, "title": "[homekit] some cleanups", "bodyText": "some cleanup and alignment of accessories implementations.\nkey changes\n\nmake consistent use of BooleanItemReader and some other helpers\nannotate with @NonNullByDefault where possible\nmake final where possible\nuse import static\nimprove logging at few places\n\nSigned-off-by: Eugen Freiter freiter@gmx.de", "createdAt": "2020-06-29T14:46:12Z", "url": "https://github.com/openhab/openhab-addons/pull/8041", "merged": true, "mergeCommit": {"oid": "5785cad4f861a383129283205c3f8467e210f322"}, "closed": true, "closedAt": "2020-07-08T18:09:01Z", "author": {"login": "yfre"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcvtykSgH2gAyNDQxNDY0NjUxOjZhMmYzY2ZmZWM4MTM1Y2M1ZTZmZjBiMGRkNzAzZTk0ZDBlNjVkYzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcy-dYTAFqTQ0NTAxMTkzNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6a2f3cffec8135cc5e6ff0b0dd703e94d0e65dc6", "author": {"user": null}, "url": "https://github.com/openhab/openhab-addons/commit/6a2f3cffec8135cc5e6ff0b0dd703e94d0e65dc6", "committedDate": "2020-06-28T15:01:29Z", "message": "some cleanups\n\nSigned-off-by: Eugen Freiter <freiter@gmx.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8317aba960f27f9d36cc6244d853457375326953", "author": {"user": null}, "url": "https://github.com/openhab/openhab-addons/commit/8317aba960f27f9d36cc6244d853457375326953", "committedDate": "2020-06-28T20:26:00Z", "message": "add some cleanups\n\nSigned-off-by: Eugen Freiter <freiter@gmx.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5MzQzNjU0", "url": "https://github.com/openhab/openhab-addons/pull/8041#pullrequestreview-439343654", "createdAt": "2020-06-29T17:12:27Z", "commit": {"oid": "8317aba960f27f9d36cc6244d853457375326953"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxNzoxMzo0MVrOGqacIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxNzozMjoyNlrOGqbGqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzEyNjU2Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    } catch (java.lang.NumberFormatException e) {\n          \n          \n            \n                    } catch (NumberFormatException e) {", "url": "https://github.com/openhab/openhab-addons/pull/8041#discussion_r447126563", "createdAt": "2020-06-29T17:13:41Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.io.homekit/src/main/java/org/openhab/io/homekit/internal/HomekitChangeListener.java", "diffHunk": "@@ -83,21 +84,21 @@\n                 Clock.systemUTC(), this::applyUpdates);\n \n         itemRegistry.addRegistryChangeListener(this);\n-        itemRegistry.getItems().stream().forEach(this::createRootAccessories);\n+        itemRegistry.getItems().forEach(this::createRootAccessories);\n         initialiseRevision();\n         logger.info(\"Created {} HomeKit items.\", accessoryRegistry.getAllAccessories().size());\n     }\n \n     private void initialiseRevision() {\n         int revision;\n         try {\n-            revision = Integer.valueOf(storage.get(REVISION_CONFIG));\n+            revision = Integer.parseInt(storage.get(REVISION_CONFIG));\n         } catch (java.lang.NumberFormatException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8317aba960f27f9d36cc6244d853457375326953"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzEyNjY0MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    } catch (java.lang.NumberFormatException e) {\n          \n          \n            \n                    } catch (NumberFormatException e) {", "url": "https://github.com/openhab/openhab-addons/pull/8041#discussion_r447126640", "createdAt": "2020-06-29T17:13:51Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.io.homekit/src/main/java/org/openhab/io/homekit/internal/HomekitChangeListener.java", "diffHunk": "@@ -83,21 +84,21 @@\n                 Clock.systemUTC(), this::applyUpdates);\n \n         itemRegistry.addRegistryChangeListener(this);\n-        itemRegistry.getItems().stream().forEach(this::createRootAccessories);\n+        itemRegistry.getItems().forEach(this::createRootAccessories);\n         initialiseRevision();\n         logger.info(\"Created {} HomeKit items.\", accessoryRegistry.getAllAccessories().size());\n     }\n \n     private void initialiseRevision() {\n         int revision;\n         try {\n-            revision = Integer.valueOf(storage.get(REVISION_CONFIG));\n+            revision = Integer.parseInt(storage.get(REVISION_CONFIG));\n         } catch (java.lang.NumberFormatException e) {\n             revision = 1;\n             storage.put(REVISION_CONFIG, \"\" + revision);\n         }\n         try {\n-            lastAccessoryCount = Integer.valueOf(storage.get(ACCESSORY_COUNT));\n+            lastAccessoryCount = Integer.parseInt(storage.get(ACCESSORY_COUNT));\n         } catch (java.lang.NumberFormatException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8317aba960f27f9d36cc6244d853457375326953"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzEyNzQxMA==", "bodyText": "Please remove the @NotNull here.", "url": "https://github.com/openhab/openhab-addons/pull/8041#discussion_r447127410", "createdAt": "2020-06-29T17:15:08Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.io.homekit/src/main/java/org/openhab/io/homekit/internal/HomekitCommandExtension.java", "diffHunk": "@@ -96,7 +101,7 @@ public void execute(String[] args, Console console) {\n     }\n \n     @Override\n-    public List<String> getUsages() {\n+    public @NotNull List<String> getUsages() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8317aba960f27f9d36cc6244d853457375326953"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzEyODU0NQ==", "bodyText": "Rather than suppressing warnings everywhere I would rather you just disable null checks for this field.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @Nullable\n          \n          \n            \n                private Homekit homekit;\n          \n          \n            \n                @NonNullByDefault({})\n          \n          \n            \n                private Homekit homekit;", "url": "https://github.com/openhab/openhab-addons/pull/8041#discussion_r447128545", "createdAt": "2020-06-29T17:17:00Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.io.homekit/src/main/java/org/openhab/io/homekit/internal/HomekitCommandExtension.java", "diffHunk": "@@ -42,6 +46,7 @@\n     private static final String LEGACY_SUBCMD_PRINT_ACCESSORY = \"printAccessory\";\n \n     private final Logger logger = LoggerFactory.getLogger(HomekitCommandExtension.class);\n+    @Nullable\n     private Homekit homekit;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8317aba960f27f9d36cc6244d853457375326953"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzEzMDAyMw==", "bodyText": "You should really use constants instead of literals when accessing storage.", "url": "https://github.com/openhab/openhab-addons/pull/8041#discussion_r447130023", "createdAt": "2020-06-29T17:19:38Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.io.homekit/src/main/java/org/openhab/io/homekit/internal/HomekitImpl.java", "diffHunk": "@@ -78,14 +74,14 @@\n     public HomekitImpl(@Reference StorageService storageService, @Reference ItemRegistry itemRegistry,\n             @Reference NetworkAddressService networkAddressService, Map<String, Object> config,\n             @Reference MetadataRegistry metadataRegistry) throws IOException, InvalidAlgorithmParameterException {\n-        this.storage = storageService.getStorage(\"homekit\");\n         this.networkAddressService = networkAddressService;\n         this.settings = processConfig(config);\n         this.changeListener = new HomekitChangeListener(itemRegistry, settings, metadataRegistry, storageService);\n+        authInfo = new HomekitAuthInfoImpl(storageService.getStorage(\"homekit\"), settings.pin);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8317aba960f27f9d36cc6244d853457375326953"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzEzMjE2Ng==", "bodyText": "Why not make this primitive?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                Boolean getValue() {\n          \n          \n            \n                boolean getValue() {", "url": "https://github.com/openhab/openhab-addons/pull/8041#discussion_r447132166", "createdAt": "2020-06-29T17:23:31Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.io.homekit/src/main/java/org/openhab/io/homekit/internal/accessories/BooleanItemReader.java", "diffHunk": "@@ -54,23 +55,30 @@\n     }\n \n     Boolean getValue() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8317aba960f27f9d36cc6244d853457375326953"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzEzNzQ0OQ==", "bodyText": "Making the configuration final doesn't solve this warning?", "url": "https://github.com/openhab/openhab-addons/pull/8041#discussion_r447137449", "createdAt": "2020-06-29T17:32:26Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.io.homekit/src/main/java/org/openhab/io/homekit/internal/HomekitTaggedItem.java", "diffHunk": "@@ -214,12 +213,15 @@ public double getConfigurationAsDouble(String key, double defaultValue) {\n     /**\n      * parse and apply item configuration.\n      */\n+    @SuppressWarnings(\"null\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8317aba960f27f9d36cc6244d853457375326953"}, "originalPosition": 61}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5Nzc0MDMy", "url": "https://github.com/openhab/openhab-addons/pull/8041#pullrequestreview-439774032", "createdAt": "2020-06-30T08:12:19Z", "commit": {"oid": "8317aba960f27f9d36cc6244d853457375326953"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwODoxMjoxOVrOGqw8tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwODoxMjoxOVrOGqw8tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ5NTM1MQ==", "bodyText": "We use the convention to inline the Non null annotations:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private Homekit homekit;\n          \n          \n            \n                private @NonNullByDefault({}) Homekit homekit;", "url": "https://github.com/openhab/openhab-addons/pull/8041#discussion_r447495351", "createdAt": "2020-06-30T08:12:19Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.io.homekit/src/main/java/org/openhab/io/homekit/internal/HomekitCommandExtension.java", "diffHunk": "@@ -42,6 +46,7 @@\n     private static final String LEGACY_SUBCMD_PRINT_ACCESSORY = \"printAccessory\";\n \n     private final Logger logger = LoggerFactory.getLogger(HomekitCommandExtension.class);\n+    @Nullable\n     private Homekit homekit;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8317aba960f27f9d36cc6244d853457375326953"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07b57c23bed0c8aa5dd4cdd1556e4eac6ceef2e9", "author": {"user": null}, "url": "https://github.com/openhab/openhab-addons/commit/07b57c23bed0c8aa5dd4cdd1556e4eac6ceef2e9", "committedDate": "2020-06-30T09:35:18Z", "message": "address feedback\n\nSigned-off-by: Eugen Freiter <freiter@gmx.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "780bc382bc60faec4ea0ecbcc8f4c265a59de04d", "author": {"user": null}, "url": "https://github.com/openhab/openhab-addons/commit/780bc382bc60faec4ea0ecbcc8f4c265a59de04d", "committedDate": "2020-07-02T06:20:27Z", "message": "remove final for parameters\n\nSigned-off-by: Eugen Freiter <freiter@gmx.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MTc2NDI5", "url": "https://github.com/openhab/openhab-addons/pull/8041#pullrequestreview-444176429", "createdAt": "2020-07-07T19:12:38Z", "commit": {"oid": "780bc382bc60faec4ea0ecbcc8f4c265a59de04d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxOToxMjozOFrOGuMDQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxOToxMjozOFrOGuMDQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA4NTEyMw==", "bodyText": "If you are going to remove the stack trace from the logs, then you should make sure that the exception is included as a cause exception when throwing.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        throw new HomekitException(\"Cannot instantiate accessory implementation for accessory \" + accessoryType);\n          \n          \n            \n                        throw new HomekitException(\"Cannot instantiate accessory implementation for accessory \" + accessoryType, e);", "url": "https://github.com/openhab/openhab-addons/pull/8041#discussion_r451085123", "createdAt": "2020-07-07T19:12:38Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.io.homekit/src/main/java/org/openhab/io/homekit/internal/accessories/HomekitAccessoryFactory.java", "diffHunk": "@@ -196,7 +194,7 @@ public static HomekitAccessory create(HomekitTaggedItem taggedItem, MetadataRegi\n             }\n         } catch (NoSuchMethodException | IllegalAccessException | InstantiationException\n                 | InvocationTargetException e) {\n-            logger.warn(\"Cannot instantiate accessory implementation for accessory {}\", accessoryType.getTag(), e);\n+            logger.warn(\"Cannot instantiate accessory implementation for accessory {}\", accessoryType.getTag());\n             throw new HomekitException(\"Cannot instantiate accessory implementation for accessory \" + accessoryType);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "780bc382bc60faec4ea0ecbcc8f4c265a59de04d"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f61db4a5aff0f6ba1a77ad9c3d8097d293599456", "author": {"user": null}, "url": "https://github.com/openhab/openhab-addons/commit/f61db4a5aff0f6ba1a77ad9c3d8097d293599456", "committedDate": "2020-07-08T15:50:25Z", "message": "revert changes on logging\n\nSigned-off-by: Eugen Freiter <freiter@gmx.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MDExOTM1", "url": "https://github.com/openhab/openhab-addons/pull/8041#pullrequestreview-445011935", "createdAt": "2020-07-08T18:08:30Z", "commit": {"oid": "f61db4a5aff0f6ba1a77ad9c3d8097d293599456"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 73, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}