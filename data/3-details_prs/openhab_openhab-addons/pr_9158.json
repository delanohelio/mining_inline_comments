{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4OTQ3MDcw", "number": 9158, "title": "[miio] dynamically generate channelTypes", "bodyText": "Simplify the json database creation for new models and less chance for errors\nDrive statedescription from Json\ndrive options from Json\nRelated to #7276", "createdAt": "2020-11-28T13:18:06Z", "url": "https://github.com/openhab/openhab-addons/pull/9158", "merged": true, "mergeCommit": {"oid": "2597ff20d471a974c91eeb06dcfb387165c8f387"}, "closed": true, "closedAt": "2020-12-04T21:01:19Z", "author": {"login": "marcelrv"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdhSP3_AH2gAyNTI4OTQ3MDcwOjJkZWUwNjlmYmNiMTg4YWVmMDNmYThkZGYzYmRjNmFlMTc3OWVkMDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABditpRUAFqTU0NDU5NzIxNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2dee069fbcb188aef03fa8ddf3bdc6ae1779ed03", "author": {"user": {"login": "marcelrv", "name": "Marcel"}}, "url": "https://github.com/openhab/openhab-addons/commit/2dee069fbcb188aef03fa8ddf3bdc6ae1779ed03", "committedDate": "2020-11-29T15:12:22Z", "message": "[miio] dynamically generate channelTypes\n\nSimplify the json database creation for new models and less chance for\nerrors\nRelated to #7276\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c801f69962df1018f87093117d4a66cb6172604e", "author": {"user": {"login": "marcelrv", "name": "Marcel"}}, "url": "https://github.com/openhab/openhab-addons/commit/c801f69962df1018f87093117d4a66cb6172604e", "committedDate": "2020-11-29T18:33:33Z", "message": "[miio] add tags and category\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "864ddd41236c3c48073b63bbdfbfa3569bd2e0e0", "author": {"user": {"login": "marcelrv", "name": "Marcel"}}, "url": "https://github.com/openhab/openhab-addons/commit/864ddd41236c3c48073b63bbdfbfa3569bd2e0e0", "committedDate": "2020-11-28T13:17:16Z", "message": "[miio] dynamically generate channelTypes\n\nSimplify the json database creation for new models and less chance for\nerrors\nRelated to #7276\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>"}, "afterCommit": {"oid": "c801f69962df1018f87093117d4a66cb6172604e", "author": {"user": {"login": "marcelrv", "name": "Marcel"}}, "url": "https://github.com/openhab/openhab-addons/commit/c801f69962df1018f87093117d4a66cb6172604e", "committedDate": "2020-11-29T18:33:33Z", "message": "[miio] add tags and category\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7cb90b0a3f81e123f3c696e4ad50b33c3626515f", "author": {"user": {"login": "marcelrv", "name": "Marcel"}}, "url": "https://github.com/openhab/openhab-addons/commit/7cb90b0a3f81e123f3c696e4ad50b33c3626515f", "committedDate": "2020-11-29T20:05:20Z", "message": "[miio] preserve sequence of tags as that is required in mainUI\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1540857a4b75ee8d138b9cd51bd2bce1b960ff1e", "author": {"user": {"login": "marcelrv", "name": "Marcel"}}, "url": "https://github.com/openhab/openhab-addons/commit/1540857a4b75ee8d138b9cd51bd2bce1b960ff1e", "committedDate": "2020-11-29T20:35:55Z", "message": "[miio] use hashmap to prevent some re-initiation drama\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d97e8164d7d2e187b52dc63b44e14be4337cf2df", "author": {"user": {"login": "marcelrv", "name": "Marcel"}}, "url": "https://github.com/openhab/openhab-addons/commit/d97e8164d7d2e187b52dc63b44e14be4337cf2df", "committedDate": "2020-11-29T21:49:49Z", "message": "[miio] change dewcription to label to be in line with regular DTO\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxNDE5MjMx", "url": "https://github.com/openhab/openhab-addons/pull/9158#pullrequestreview-541419231", "createdAt": "2020-12-01T01:19:16Z", "commit": {"oid": "d97e8164d7d2e187b52dc63b44e14be4337cf2df"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMToxOToxNlrOH8UVqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMToxOTozMVrOH8UV5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAwOTgzMw==", "bodyText": "Just reorganizing the annotation order so it is a bit more readable.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @SerializedName(\"value\")\n          \n          \n            \n                @Expose\n          \n          \n            \n                @Nullable\n          \n          \n            \n                public String value;\n          \n          \n            \n                @Expose\n          \n          \n            \n                @SerializedName(\"value\")\n          \n          \n            \n                public @Nullable String value;", "url": "https://github.com/openhab/openhab-addons/pull/9158#discussion_r533009833", "createdAt": "2020-12-01T01:19:16Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/basic/OptionsValueListDTO.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.miio.internal.basic;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import com.google.gson.annotations.Expose;\n+import com.google.gson.annotations.SerializedName;\n+\n+/**\n+ * Mapping properties from json for miot device info\n+ *\n+ * @author Marcel Verpaalen - Initial contribution\n+ */\n+@NonNullByDefault\n+public class OptionsValueListDTO {\n+\n+    @SerializedName(\"value\")\n+    @Expose\n+    @Nullable\n+    public String value;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d97e8164d7d2e187b52dc63b44e14be4337cf2df"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAwOTg5NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @SerializedName(\"label\")\n          \n          \n            \n                @Expose\n          \n          \n            \n                @Nullable\n          \n          \n            \n                public String label;\n          \n          \n            \n                @Expose\n          \n          \n            \n                @SerializedName(\"label\")\n          \n          \n            \n                public @Nullable String label;", "url": "https://github.com/openhab/openhab-addons/pull/9158#discussion_r533009894", "createdAt": "2020-12-01T01:19:31Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/basic/OptionsValueListDTO.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.miio.internal.basic;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import com.google.gson.annotations.Expose;\n+import com.google.gson.annotations.SerializedName;\n+\n+/**\n+ * Mapping properties from json for miot device info\n+ *\n+ * @author Marcel Verpaalen - Initial contribution\n+ */\n+@NonNullByDefault\n+public class OptionsValueListDTO {\n+\n+    @SerializedName(\"value\")\n+    @Expose\n+    @Nullable\n+    public String value;\n+    @SerializedName(\"label\")\n+    @Expose\n+    @Nullable\n+    public String label;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d97e8164d7d2e187b52dc63b44e14be4337cf2df"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f99ebfdc5cb75d795da75b21c5b4e8cad931504", "author": {"user": {"login": "marcelrv", "name": "Marcel"}}, "url": "https://github.com/openhab/openhab-addons/commit/2f99ebfdc5cb75d795da75b21c5b4e8cad931504", "committedDate": "2020-12-01T23:04:36Z", "message": "[miio] update with review feedback\n\nCo-authored-by: Connor Petty <mistercpp2000@gmail.com>\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b63fc891792da5b13210c43444e7cdfd73092867", "author": {"user": {"login": "marcelrv", "name": "Marcel"}}, "url": "https://github.com/openhab/openhab-addons/commit/b63fc891792da5b13210c43444e7cdfd73092867", "committedDate": "2020-12-02T11:50:55Z", "message": "[miio] minor cleanup and formatting\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0NTk3MjE0", "url": "https://github.com/openhab/openhab-addons/pull/9158#pullrequestreview-544597214", "createdAt": "2020-12-04T01:41:27Z", "commit": {"oid": "b63fc891792da5b13210c43444e7cdfd73092867"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwMTo0MToyOFrOH-8_zA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwMTo0MToyOFrOH-8_zA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTc3MzEzMg==", "bodyText": "I noticed in my own bindings that my channels would not show up in the UI if the channel types weren't available in the ChannelTypeProvider before the thing handler was started. Is there something special about your setup here or did you find some kind of workaround to prevent that issue?", "url": "https://github.com/openhab/openhab-addons/pull/9158#discussion_r535773132", "createdAt": "2020-12-04T01:41:28Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/basic/BasicChannelTypeProvider.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.miio.internal.basic;\n+\n+import static org.openhab.binding.miio.internal.MiIoBindingConstants.BINDING_ID;\n+\n+import java.math.BigDecimal;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.LinkedHashSet;\n+import java.util.List;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.concurrent.ConcurrentHashMap;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.core.thing.type.ChannelType;\n+import org.openhab.core.thing.type.ChannelTypeBuilder;\n+import org.openhab.core.thing.type.ChannelTypeProvider;\n+import org.openhab.core.thing.type.ChannelTypeUID;\n+import org.openhab.core.thing.type.StateChannelTypeBuilder;\n+import org.openhab.core.types.StateDescriptionFragmentBuilder;\n+import org.openhab.core.types.StateOption;\n+import org.osgi.service.component.annotations.Component;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Provide channelTypes for Mi IO Basic devices\n+ *\n+ * @author Marcel Verpaalen - Initial contribution\n+ */\n+@Component(service = { ChannelTypeProvider.class, BasicChannelTypeProvider.class })\n+@NonNullByDefault\n+public class BasicChannelTypeProvider implements ChannelTypeProvider {\n+    private final Map<String, ChannelType> channelTypes = new ConcurrentHashMap<>();\n+    private final Logger logger = LoggerFactory.getLogger(BasicChannelTypeProvider.class);\n+\n+    @Override\n+    public Collection<ChannelType> getChannelTypes(@Nullable Locale locale) {\n+        return channelTypes.values();\n+    }\n+\n+    @Override\n+    public @Nullable ChannelType getChannelType(ChannelTypeUID channelTypeUID, @Nullable Locale locale) {\n+        if (channelTypes.containsKey(channelTypeUID.getAsString())) {\n+            return channelTypes.get(channelTypeUID.getAsString());\n+        }\n+        return null;\n+    }\n+\n+    public void addChannelType(MiIoBasicChannel miChannel, String model) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b63fc891792da5b13210c43444e7cdfd73092867"}, "originalPosition": 63}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3862, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}