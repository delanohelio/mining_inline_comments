{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxOTkzMzgy", "number": 267, "title": "Hotfixes for YouTube and improve unavailable cases", "bodyText": "Fix the issues that I mentioned in #262, and some more that I found along the way.\n\nYouTube\n\nTake into account videos that have their views hidden.\nHandle videos with no views or with \"Recommended to you\" text.\nHandle video premiere's date and duration.\nAvoid crashing by letting exceptions bubble up.\n\nreCAPTCHAS, for example, were not reaching where they should, resulting in a crash instead of opening it for the user to solve.\nMaybe there's a better way/approach to how the exceptions are handled in the extractor (e.g. communicate error to front end, error propagation), I'll take a look some time.\n\n\nFix bug when url isn't present in the browseEndpoint object.\nDetect simple 404s in the standard fetch method.\nDetect deleted/nonexistent/invalid channels and playlists.\nDetect when a stream is deleted or doesn't exist.\n\nDownloader\n\nMake test downloader return a response instead of throwing an exception.\nAdd latest url to the response to make detection of a redirect possible.\nIgnore null-keyed entries when iterating through the response headers.", "createdAt": "2020-03-01T04:44:41Z", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/267", "merged": true, "mergeCommit": {"oid": "830b7d3dbdd4b777da94dc6ef87c140e5d623566"}, "closed": true, "closedAt": "2020-03-01T11:50:11Z", "author": {"login": "mauriciocolli"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcJU5MDAFqTM2Njg0Mjk3OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcJXuS3gBqjMwODU0OTkyODU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2ODQyOTc5", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/267#pullrequestreview-366842979", "createdAt": "2020-03-01T08:31:57Z", "commit": {"oid": "7d3bb8a6f01ef08ce6d1c2dfd12d90b658ea7838"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMVQwODozMTo1N1rOFwM8Tg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMVQwODozMTo1N1rOFwM8Tg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA4ODAxNA==", "bodyText": "Are you sure this works? I had issues with using has() for JsonObjects, so I've been doing getObject() != null. Otherwise this PR looks fine to me.", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/267#discussion_r386088014", "createdAt": "2020-03-01T08:31:57Z", "author": {"login": "wb9688"}, "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/youtube/extractors/YoutubeStreamInfoItemExtractor.java", "diffHunk": "@@ -225,7 +255,26 @@ private boolean isPremium() {\n                     return true;\n                 }\n             }\n-        } catch (Exception ignored) {}\n+        } catch (Exception ignored) {\n+        }\n         return false;\n     }\n+\n+    private boolean isPremiere() {\n+        return videoInfo.has(\"upcomingEventData\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d3bb8a6f01ef08ce6d1c2dfd12d90b658ea7838"}, "originalPosition": 106}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2ODUxMzEz", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/267#pullrequestreview-366851313", "createdAt": "2020-03-01T11:04:39Z", "commit": {"oid": "7d3bb8a6f01ef08ce6d1c2dfd12d90b658ea7838"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMVQxMTowNDo0MFrOFwNkjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMVQxMTowNDo0MFrOFwNkjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA5ODMxOA==", "bodyText": "Are there no other ways than relying on English?", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/267#discussion_r386098318", "createdAt": "2020-03-01T11:04:40Z", "author": {"login": "B0pol"}, "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/youtube/extractors/YoutubeStreamInfoItemExtractor.java", "diffHunk": "@@ -194,11 +213,22 @@ public long getViewCount() throws ParsingException {\n             if (videoInfo.getObject(\"topStandaloneBadge\") != null || isPremium()) {\n                 return -1;\n             }\n-            String viewCount = getTextFromObject(videoInfo.getObject(\"viewCountText\"));\n+\n+            final JsonObject viewCountObject = videoInfo.getObject(\"viewCountText\");\n+            if (viewCountObject == null) {\n+                // This object is null when a video has its views hidden.\n+                return -1;\n+            }\n+\n+            final String viewCount = getTextFromObject(viewCountObject);\n+\n+            if (viewCount.toLowerCase().contains(\"no views\")) {\n+                return 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d3bb8a6f01ef08ce6d1c2dfd12d90b658ea7838"}, "originalPosition": 84}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2ODUzNTU0", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/267#pullrequestreview-366853554", "createdAt": "2020-03-01T11:48:24Z", "commit": {"oid": "7d3bb8a6f01ef08ce6d1c2dfd12d90b658ea7838"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3441946bea9c172a4c96dd6deae450cecab875a4", "author": {"user": {"login": "mauriciocolli", "name": "Mauricio Colli"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/3441946bea9c172a4c96dd6deae450cecab875a4", "committedDate": "2020-03-01T11:49:13Z", "message": "Make test downloader return a response instead of throwing an exception\n\nThe test implementation was throwing an exception instead of just\nreturning the response and letting the caller handle it."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5edd774fc44b037608840e1e968aa72a581040a8", "author": {"user": {"login": "mauriciocolli", "name": "Mauricio Colli"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/5edd774fc44b037608840e1e968aa72a581040a8", "committedDate": "2020-03-01T11:49:13Z", "message": "Add latest url to the response to make detection of a redirect possible\n\nWill be latest one in this commit because there's need to check the\nhistory of redirects as of now."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f66c20de54418b464d529bebf0a49f66a1f27e74", "author": {"user": {"login": "mauriciocolli", "name": "Mauricio Colli"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/f66c20de54418b464d529bebf0a49f66a1f27e74", "committedDate": "2020-03-01T11:49:13Z", "message": "Ignore null-keyed entries when iterating through the response headers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da2c562eb0fe5244e6078b8d6d038d0341dddd32", "author": {"user": {"login": "mauriciocolli", "name": "Mauricio Colli"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/da2c562eb0fe5244e6078b8d6d038d0341dddd32", "committedDate": "2020-03-01T11:49:13Z", "message": "[YouTube] Take into account videos that have their views hidden\n\nAlso remove catch because it may hide bugs when the page changes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a470ac4f740f9232e8fe7a7ec0adab7b90bf659", "author": {"user": {"login": "mauriciocolli", "name": "Mauricio Colli"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/2a470ac4f740f9232e8fe7a7ec0adab7b90bf659", "committedDate": "2020-03-01T11:49:13Z", "message": "[YouTube] Handle videos with no views or with \"Recommended to you\" text"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9644e6216c9aaa20a6fefa4a0c94b471c09b1bf", "author": {"user": {"login": "mauriciocolli", "name": "Mauricio Colli"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/e9644e6216c9aaa20a6fefa4a0c94b471c09b1bf", "committedDate": "2020-03-01T11:49:13Z", "message": "[YouTube] Handle video premiere's date and duration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "342bdbb85256a510a7c9b4aeeea148d8a34481bf", "author": {"user": {"login": "mauriciocolli", "name": "Mauricio Colli"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/342bdbb85256a510a7c9b4aeeea148d8a34481bf", "committedDate": "2020-03-01T11:49:13Z", "message": "[YouTube] Avoid crashing by letting exceptions bubble up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "408f0421276da45410af1206e7de761865829f84", "author": {"user": {"login": "mauriciocolli", "name": "Mauricio Colli"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/408f0421276da45410af1206e7de761865829f84", "committedDate": "2020-03-01T11:49:13Z", "message": "[YouTube] Fix bug when url isn't present in the browseEndpoint object"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98e359438a4bdcd252b7fa6bb5fe9a48fde5d0be", "author": {"user": {"login": "mauriciocolli", "name": "Mauricio Colli"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/98e359438a4bdcd252b7fa6bb5fe9a48fde5d0be", "committedDate": "2020-03-01T11:49:13Z", "message": "[YouTube] Detect simple 404s in the standard fetch method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e65333c3cea86b6fa8197044b8969b21df47291e", "author": {"user": {"login": "mauriciocolli", "name": "Mauricio Colli"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/e65333c3cea86b6fa8197044b8969b21df47291e", "committedDate": "2020-03-01T11:49:13Z", "message": "[YouTube] Detect deleted/nonexistent/invalid channels and playlists\n\n- Added tests for these cases."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5686a6f562619c50bed53904eaafbc2aa85c8dbe", "author": {"user": {"login": "mauriciocolli", "name": "Mauricio Colli"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/5686a6f562619c50bed53904eaafbc2aa85c8dbe", "committedDate": "2020-03-01T11:49:13Z", "message": "[YouTube] Detect when a stream is deleted or doesn't exist\n\nAdded a test case as well."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7d3bb8a6f01ef08ce6d1c2dfd12d90b658ea7838", "author": {"user": {"login": "mauriciocolli", "name": "Mauricio Colli"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/7d3bb8a6f01ef08ce6d1c2dfd12d90b658ea7838", "committedDate": "2020-03-01T04:38:26Z", "message": "[YouTube] Detect when a stream is deleted or doesn't exist\n\nAdded a test case as well."}, "afterCommit": {"oid": "5686a6f562619c50bed53904eaafbc2aa85c8dbe", "author": {"user": {"login": "mauriciocolli", "name": "Mauricio Colli"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/5686a6f562619c50bed53904eaafbc2aa85c8dbe", "committedDate": "2020-03-01T11:49:13Z", "message": "[YouTube] Detect when a stream is deleted or doesn't exist\n\nAdded a test case as well."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3981, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}