{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5ODkxNTk1", "number": 293, "title": "[SoundCloud] Fix by migrating to `api-v2` and other improvements", "bodyText": "[ x] I carefully read the contribution guidelines and agree to them.\n[ x] I did test the API against NewPipe.\n\nEven though now api started to work again with the hardcoded id, it seems to be unstable, as yesterday it returned a \"403 Forbidden\". api-v2 works better than api, anyway, since I was able to unignore some previously ignored tests. This PR migrates every Extractor to api-v2, along with some other fixes.\nFixes #290\nThese are all the improvements:\n\nUse api-v2 in PlaylistExtractor: rewrote methods to calculate next page url and to get items from it. api-v2 is different from api since the initial playlist page contains (usually) the full info of the first 3 streams and only the id of the others. Then the single tracks can be requested in batch using /tracks?ids=id1,id2,..., so that's the next url we get.\nImprove thumbnail url extraction in PlaylistExtractor: prevent NullPointerExceptions and remove duplicate code.\nUse api-v2 in SubscriptionExtractor: changing the url was enough. Also added some tests for channel urls with an api-v2 url.\nImprove playlists tests: assert playlists do not have a banner, unignore every ignored test (now they all succeed)", "createdAt": "2020-03-17T15:03:05Z", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/293", "merged": true, "mergeCommit": {"oid": "6f03c6e877c45036b0713192446d06d12c8a59e3"}, "closed": true, "closedAt": "2020-03-18T16:49:55Z", "author": {"login": "Stypox"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOjWckgH2gAyMzg5ODkxNTk1OmYzMDk1NzEzZjljYzE1OGEwOTJlYjI0ZDMzMzhjMGM4ZmFmZDRhOGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcO4RiuAFqTM3NjkyMzIxOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f3095713f9cc158a092eb24d3338c0c8fafd4a8d", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/f3095713f9cc158a092eb24d3338c0c8fafd4a8d", "committedDate": "2020-03-17T14:12:13Z", "message": "[SoundCloud] Use api-v2 in PlaylistExtractor\n\nRewrote methods to calculate next page url and to get items from it. `api-v2` is different from `api` since the initial playlist page contains (usually) the full info of the first 3 streams and only the id of the other. Then the single tracks can be requested in batch using `/tracks?ids=id1,id2,...`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0e66cc600ad43a48e17c65e29e897f4b549a3d0", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/d0e66cc600ad43a48e17c65e29e897f4b549a3d0", "committedDate": "2020-03-17T14:13:28Z", "message": "[SoundCloud] Improve thumbnail url extraction in playlists\n\nPrevent NullPointerExceptions and remove duplicate code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3d811fde5ced6518381173b0d4c0e73a13d0b08", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/c3d811fde5ced6518381173b0d4c0e73a13d0b08", "committedDate": "2020-03-17T14:22:25Z", "message": "[SoundCloud] Use api-v2 in SubscriptionExtractor\n\nAlso added"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b1121aac7d48e84f97048028aa6005f2acc1d5f", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/4b1121aac7d48e84f97048028aa6005f2acc1d5f", "committedDate": "2020-03-17T14:23:13Z", "message": "[SoundCloud] Add tests for api-v2 channel urls"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4aa4a076375af22256fb622547bab71a3eb4a3e", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/d4aa4a076375af22256fb622547bab71a3eb4a3e", "committedDate": "2020-03-17T14:25:11Z", "message": "[SoundCloud] Fix typo in ChartsExtractor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca8bf53b61131a8849789e76156f490d12a15751", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/ca8bf53b61131a8849789e76156f490d12a15751", "committedDate": "2020-03-17T14:35:33Z", "message": "[SoundCloud] Fix playlist test: number of streams changed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1558da6f6b2aa4613c6af45f302104b1464d28a0", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/1558da6f6b2aa4613c6af45f302104b1464d28a0", "committedDate": "2020-03-17T14:46:35Z", "message": "[SoundCloud] Fix playlist next page generation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65bdb3bc9dd45c8d8fd198064497e9473be6e16f", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/65bdb3bc9dd45c8d8fd198064497e9473be6e16f", "committedDate": "2020-03-17T14:49:58Z", "message": "[SoundCloud] Unignore ignored playlist tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e1b4bbf17d460b081b409c35d276d4ba0eed15f", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/0e1b4bbf17d460b081b409c35d276d4ba0eed15f", "committedDate": "2020-03-17T14:53:25Z", "message": "[SoundCloud] Test playlists banner: it should not exist"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e4ddb368fe25b809e28428119b032f93b4ce28d", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/5e4ddb368fe25b809e28428119b032f93b4ce28d", "committedDate": "2020-03-17T17:04:40Z", "message": "[SoundCloud] Fix extractors built from next playlist pages\n\nThey didn't have the information to calculate another next page url. So now `nextPageUrl` contains a full link with all video ids, and `getPage` takes the first part of the url (containing 15 streams) and produces another `nextPageUrl` with the remaining streams.\nAlso add a test for this."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4389fd3b7b37608be495a17f93e63cf1b6feba8b", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/4389fd3b7b37608be495a17f93e63cf1b6feba8b", "committedDate": "2020-03-17T17:06:13Z", "message": "[SoundCloud] Migrate StreamExtractor to api-v2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MzMwMzcy", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/293#pullrequestreview-376330372", "createdAt": "2020-03-17T19:12:51Z", "commit": {"oid": "4389fd3b7b37608be495a17f93e63cf1b6feba8b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxOToxMjo1MlrOF3qZcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxOToxODowNFrOF3qjzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxMDY0Mg==", "bodyText": "What are you even doing here? getNextPageUrl should always return the same URL, as it's the next page relative to the initial page, see https://github.com/TeamNewPipe/NewPipeExtractor/blob/dev/extractor/src/main/java/org/schabi/newpipe/extractor/ListExtractor.java#L36.", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/293#discussion_r393910642", "createdAt": "2020-03-17T19:12:52Z", "author": {"login": "wb9688"}, "path": "extractor/src/test/java/org/schabi/newpipe/extractor/services/soundcloud/SoundcloudPlaylistExtractorTest.java", "diffHunk": "@@ -229,6 +234,15 @@ public static void setUp() throws Exception {\n         public void testGetPageInNewExtractor() throws Exception {\n             final PlaylistExtractor newExtractor = SoundCloud.getPlaylistExtractor(extractor.getUrl());\n             defaultTestGetPageInNewExtractor(extractor, newExtractor);\n+            String page1 = newExtractor.getNextPageUrl();\n+            defaultTestMoreItems(newExtractor); // there has to be another page\n+            String page2 = newExtractor.getNextPageUrl();\n+            defaultTestMoreItems(newExtractor); // and another one\n+            String page3 = newExtractor.getNextPageUrl();\n+\n+            assertNotEquals(\"Same pages\", page1, page2);\n+            assertNotEquals(\"Same pages\", page2, page3);\n+            assertNotEquals(\"Same pages\", page3, page1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4389fd3b7b37608be495a17f93e63cf1b6feba8b"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxMTYyMA==", "bodyText": "Why did you remove the code for better resolution? Does api-v2 return that by default?", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/293#discussion_r393911620", "createdAt": "2020-03-17T19:14:48Z", "author": {"login": "wb9688"}, "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/soundcloud/SoundcloudPlaylistExtractor.java", "diffHunk": "@@ -64,21 +74,20 @@ public String getThumbnailUrl() {\n             // if it also fails, return null\n             try {\n                 final InfoItemsPage<StreamInfoItem> infoItems = getInitialPage();\n-                if (infoItems.getItems().isEmpty()) return null;\n \n                 for (StreamInfoItem item : infoItems.getItems()) {\n-                    final String thumbnailUrl = item.getThumbnailUrl();\n-                    if (thumbnailUrl == null || thumbnailUrl.isEmpty()) continue;\n-\n-                    String thumbnailUrlBetterResolution = thumbnailUrl.replace(\"large.jpg\", \"crop.jpg\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4389fd3b7b37608be495a17f93e63cf1b6feba8b"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxMjI3Nw==", "bodyText": "Why did you change this? This test was to check that this playlist indeed doesn't have a next page of items.", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/293#discussion_r393912277", "createdAt": "2020-03-17T19:16:03Z", "author": {"login": "wb9688"}, "path": "extractor/src/test/java/org/schabi/newpipe/extractor/services/soundcloud/SoundcloudPlaylistExtractorTest.java", "diffHunk": "@@ -70,7 +73,9 @@ public void testRelatedItems() throws Exception {\n         }\n \n         @Test\n-        public void testMoreRelatedItems() {\n+        public void testMoreRelatedItems() throws Exception {\n+            defaultTestMoreItems(extractor);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4389fd3b7b37608be495a17f93e63cf1b6feba8b"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxMzI5NQ==", "bodyText": "Why is this change needed? Also, I don't think those additional imports are needed here.", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/293#discussion_r393913295", "createdAt": "2020-03-17T19:18:04Z", "author": {"login": "wb9688"}, "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/soundcloud/SoundcloudStreamExtractor.java", "diffHunk": "@@ -55,14 +57,14 @@ public String getName() {\n \n     @Nonnull\n     @Override\n-    public String getTextualUploadDate() {\n-        return track.getString(\"created_at\");\n+    public String getTextualUploadDate() throws ParsingException {\n+        return track.getString(\"created_at\").replace(\"T\",\" \").replace(\"Z\", \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4389fd3b7b37608be495a17f93e63cf1b6feba8b"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae47c9587c186013bb278d9aaafd0a9a1d8c0946", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/ae47c9587c186013bb278d9aaafd0a9a1d8c0946", "committedDate": "2020-03-17T19:32:04Z", "message": "[SoundCloud] Optimize imports in edited files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c505d4e2b77b12e4d2d259121d66937ded756de1", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/c505d4e2b77b12e4d2d259121d66937ded756de1", "committedDate": "2020-03-17T19:36:59Z", "message": "[SoundCloud] Remove trailing , in playlist page urls"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45bb646480b13c59d5c6f9aef53b257c51fbf0d5", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/45bb646480b13c59d5c6f9aef53b257c51fbf0d5", "committedDate": "2020-03-17T19:56:47Z", "message": "[SoundCloud] Do not overwrite nextPageUrl in PlaylistExtractor\n\nConsistent with YouTube and the documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "265cfb61f37c6a626b56f552e5619c95b6a3a34c", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/265cfb61f37c6a626b56f552e5619c95b6a3a34c", "committedDate": "2020-03-17T20:03:50Z", "message": "[SoundCloud] Add test for small playlist, use defaultTestGetPageInNewExtractor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NzEzODY4", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/293#pullrequestreview-376713868", "createdAt": "2020-03-18T09:59:08Z", "commit": {"oid": "265cfb61f37c6a626b56f552e5619c95b6a3a34c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "222d659d9e6ebebed5ea9a690518b1a7c1ac0c2d", "author": {"user": {"login": "wb9688", "name": null}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/222d659d9e6ebebed5ea9a690518b1a7c1ac0c2d", "committedDate": "2020-03-18T10:30:15Z", "message": "[SoundCloud] Don't make separate request for getAudioStreams() in StreamExtractor\n\nSigned-off-by: Stypox <stypox@pm.me>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2OTIzMjE4", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/293#pullrequestreview-376923218", "createdAt": "2020-03-18T14:34:52Z", "commit": {"oid": "222d659d9e6ebebed5ea9a690518b1a7c1ac0c2d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3988, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}