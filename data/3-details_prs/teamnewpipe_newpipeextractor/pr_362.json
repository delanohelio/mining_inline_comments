{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwOTE1MjA4", "number": 362, "title": "Add support for Google search redirect url", "bodyText": "I carefully read the contribution guidelines and agree to them.\n I have tested the API against NewPipe.\n\nThis PR handles Google search redirect URLs such as https://www.google.it/url?sa=t&rct=j&q=&esrc=s&cd=&cad=rja&uact=8&url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DHu80uDzh8RY&source=video by extracting the url= parameter before anything else happens. For this reason originalUrls inside linkHandlers are then not really the full original url, but only the extracted parameter, which I think is a good behaviour (those links are redirects, so using the pointed-to url as the original one looks good imo). Also note that Google search redirect URLs will be opened in NewPipe only when manually shared to it, since I wouldn't consider a good idea adding the google domain to the manifest.\nThis PR also fixes baseUrl extraction from urls with custom intents like \"vnd.youtube\", thus allowing to remove some useless overrides of getUrl.\nFixes TeamNewPipe/NewPipe#3790\nTest apk: app-debug.zip\n@webber-naut please check if this suits you, thank you in advance ;-)", "createdAt": "2020-06-27T13:56:59Z", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/362", "merged": true, "mergeCommit": {"oid": "b242e1d113bd24983db982f70fa9abfbaa53c5ff"}, "closed": true, "closedAt": "2020-10-31T20:03:49Z", "author": {"login": "Stypox"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcveVM9ABqjM0ODk0MTkyMTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdYA-KdgBqjM5NDQ0NTYyNzc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "31a42e2f37e9dacd7c1e580f4b54587c77bab6c5", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/31a42e2f37e9dacd7c1e580f4b54587c77bab6c5", "committedDate": "2020-06-27T13:47:49Z", "message": "Add support for Google search redirect url"}, "afterCommit": {"oid": "8ce3e9bda66e54641f05d05bde8702bbcf2bdeb2", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/8ce3e9bda66e54641f05d05bde8702bbcf2bdeb2", "committedDate": "2020-06-27T21:00:10Z", "message": "Add support for Google search redirect url"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8ce3e9bda66e54641f05d05bde8702bbcf2bdeb2", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/8ce3e9bda66e54641f05d05bde8702bbcf2bdeb2", "committedDate": "2020-06-27T21:00:10Z", "message": "Add support for Google search redirect url"}, "afterCommit": {"oid": "d66a361eae2902e2bb875a31e5a9e88a747fb1aa", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/d66a361eae2902e2bb875a31e5a9e88a747fb1aa", "committedDate": "2020-06-27T21:06:22Z", "message": "Add support for Google search redirect url"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d66a361eae2902e2bb875a31e5a9e88a747fb1aa", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/d66a361eae2902e2bb875a31e5a9e88a747fb1aa", "committedDate": "2020-06-27T21:06:22Z", "message": "Add support for Google search redirect url"}, "afterCommit": {"oid": "d9a8786f8d87fc4270d92014ace683e732f6774c", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/d9a8786f8d87fc4270d92014ace683e732f6774c", "committedDate": "2020-06-27T21:11:45Z", "message": "Add support for Google search redirect url"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d9a8786f8d87fc4270d92014ace683e732f6774c", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/d9a8786f8d87fc4270d92014ace683e732f6774c", "committedDate": "2020-06-27T21:11:45Z", "message": "Add support for Google search redirect url"}, "afterCommit": {"oid": "7ed38b703d06b1d4285f9c17d62c917aa40190e0", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/7ed38b703d06b1d4285f9c17d62c917aa40190e0", "committedDate": "2020-06-27T21:30:16Z", "message": "Add support for Google search redirect url"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NzkxNzky", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/362#pullrequestreview-438791792", "createdAt": "2020-06-28T15:51:43Z", "commit": {"oid": "7ed38b703d06b1d4285f9c17d62c917aa40190e0"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQxNTo1MTo0M1rOGp-YAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQxNjowNzowOVrOGp-epA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY2Njc1Mg==", "bodyText": "You forgot to remove this", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/362#discussion_r446666752", "createdAt": "2020-06-28T15:51:43Z", "author": {"login": "XiangRongLin"}, "path": "extractor/src/main/java/org/schabi/newpipe/extractor/utils/Utils.java", "diffHunk": "@@ -181,13 +181,38 @@ public static String removeUTF8BOM(String s) {\n     }\n \n     public static String getBaseUrl(String url) throws ParsingException {\n-        URL uri;\n         try {\n-            uri = stringToURL(url);\n+            final URL uri = stringToURL(url);\n+            return uri.getProtocol() + \"://\" + uri.getAuthority();\n         } catch (MalformedURLException e) {\n+            final String message = e.getMessage();\n+            if (message.startsWith(\"unknown protocol: \")) {\n+                System.out.println(message.substring(18));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ed38b703d06b1d4285f9c17d62c917aa40190e0"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY2NzQ4NQ==", "bodyText": "I would replace the 18 with \"unknown protocol: \".length(). Since on first view i could not see why it was 18", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/362#discussion_r446667485", "createdAt": "2020-06-28T15:58:20Z", "author": {"login": "XiangRongLin"}, "path": "extractor/src/main/java/org/schabi/newpipe/extractor/utils/Utils.java", "diffHunk": "@@ -181,13 +181,38 @@ public static String removeUTF8BOM(String s) {\n     }\n \n     public static String getBaseUrl(String url) throws ParsingException {\n-        URL uri;\n         try {\n-            uri = stringToURL(url);\n+            final URL uri = stringToURL(url);\n+            return uri.getProtocol() + \"://\" + uri.getAuthority();\n         } catch (MalformedURLException e) {\n+            final String message = e.getMessage();\n+            if (message.startsWith(\"unknown protocol: \")) {\n+                System.out.println(message.substring(18));\n+                return message.substring(18); // return just the protocol (e.g. vnd.youtube)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ed38b703d06b1d4285f9c17d62c917aa40190e0"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY2ODE3OQ==", "bodyText": "The input parameter shouldn't be reassigned. Especially since with the new checkstyle rules in the NewPipe repo forcing every input parameter to be final.", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/362#discussion_r446668179", "createdAt": "2020-06-28T16:04:29Z", "author": {"login": "XiangRongLin"}, "path": "extractor/src/main/java/org/schabi/newpipe/extractor/linkhandler/LinkHandlerFactory.java", "diffHunk": "@@ -42,12 +42,30 @@ public String getUrl(String id, String baseUrl) throws ParsingException {\n     // Logic\n     ///////////////////////////////////\n \n+    /**\n+     * Builds a {@link LinkHandler} from a url.<br>\n+     * Be sure to call {@link Utils#followGoogleRedirectIfNeeded(String)} on the url if overriding\n+     * this function.\n+     * @param url the url to extract path and id from\n+     * @return a {@link LinkHandler} complete with information\n+     */\n     public LinkHandler fromUrl(String url) throws ParsingException {\n         if (url == null) throw new IllegalArgumentException(\"url can not be null\");\n+        url = Utils.followGoogleRedirectIfNeeded(url);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ed38b703d06b1d4285f9c17d62c917aa40190e0"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY2ODMzOA==", "bodyText": "Same here, no reassignement", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/362#discussion_r446668338", "createdAt": "2020-06-28T16:06:06Z", "author": {"login": "XiangRongLin"}, "path": "extractor/src/main/java/org/schabi/newpipe/extractor/linkhandler/ListLinkHandlerFactory.java", "diffHunk": "@@ -32,7 +32,8 @@ public String getUrl(String id, List<String> contentFilter, String sortFilter, S\n \n     @Override\n     public ListLinkHandler fromUrl(String url) throws ParsingException {\n-        String baseUrl = Utils.getBaseUrl(url);\n+        url = Utils.followGoogleRedirectIfNeeded(url);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ed38b703d06b1d4285f9c17d62c917aa40190e0"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY2ODQ1Mg==", "bodyText": "Same here, no reassignement", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/362#discussion_r446668452", "createdAt": "2020-06-28T16:07:09Z", "author": {"login": "XiangRongLin"}, "path": "extractor/src/main/java/org/schabi/newpipe/extractor/StreamingService.java", "diffHunk": "@@ -277,12 +278,13 @@ public CommentsExtractor getCommentsExtractor(String url) throws ExtractionExcep\n      * Figures out where the link is pointing to (a channel, a video, a playlist, etc.)\n      * @param url the url on which it should be decided of which link type it is\n      * @return the link type of url\n-     * @throws ParsingException\n      */\n     public final LinkType getLinkTypeByUrl(String url) throws ParsingException {\n-        LinkHandlerFactory sH = getStreamLHFactory();\n-        LinkHandlerFactory cH = getChannelLHFactory();\n-        LinkHandlerFactory pH = getPlaylistLHFactory();\n+        url = Utils.followGoogleRedirectIfNeeded(url);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ed38b703d06b1d4285f9c17d62c917aa40190e0"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMTQ5NzA2", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/362#pullrequestreview-521149706", "createdAt": "2020-10-31T16:02:05Z", "commit": {"oid": "495f2191282a8a27845a2d1ea1c32e04f4e4f408"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c190a3029bf0a3ae36e584f1e74e83e4ba8137c4", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/c190a3029bf0a3ae36e584f1e74e83e4ba8137c4", "committedDate": "2020-10-31T19:58:28Z", "message": "Consider protocol as base url when it is a custom one (e.g. vnd.youtube)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fe55b30ba43ff44241e394d8b021b8c78c16e18", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/3fe55b30ba43ff44241e394d8b021b8c78c16e18", "committedDate": "2020-10-31T19:58:28Z", "message": "Add support for Google search redirect url"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e53cf0b56652c37e68d3c5a03624f0b6d8fff05", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/9e53cf0b56652c37e68d3c5a03624f0b6d8fff05", "committedDate": "2020-10-31T19:58:28Z", "message": "Fix parameter reassignment and other style issues\n\nAlso remove left-behind debug statement"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "495f2191282a8a27845a2d1ea1c32e04f4e4f408", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/495f2191282a8a27845a2d1ea1c32e04f4e4f408", "committedDate": "2020-06-28T20:44:16Z", "message": "Fix parameter reassignment and other style issues\n\nAlso remove left-behind debug statement"}, "afterCommit": {"oid": "9e53cf0b56652c37e68d3c5a03624f0b6d8fff05", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/9e53cf0b56652c37e68d3c5a03624f0b6d8fff05", "committedDate": "2020-10-31T19:58:28Z", "message": "Fix parameter reassignment and other style issues\n\nAlso remove left-behind debug statement"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3943, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}