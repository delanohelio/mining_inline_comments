{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5OTY4MTQ5", "number": 2779, "title": "HBASE-23340 hmaster /hbase/replication/rs session expired (hbase repl\u2026", "bodyText": "\u2026ication default value is true, we don't use ) causes logcleaner can not clean oldWALs, which resulits in oldWALs too large (more than 2TB)", "createdAt": "2020-12-15T04:33:51Z", "url": "https://github.com/apache/hbase/pull/2779", "merged": true, "mergeCommit": {"oid": "1612b9ef85b95f2b16c4798bfdde1622ebc08a86"}, "closed": true, "closedAt": "2021-01-14T03:36:08Z", "author": {"login": "cuibo01"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdniZpYAH2gAyNTM5OTY4MTQ5OjE1MTEwMWU4ZGI5NDY4NDIwZjUyMWY4OTJjMGIwN2NiMDg5ZWYzNjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdv6QlWgFqTU2Nzc5MzQ1Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "151101e8db9468420f521f892c0b07cb089ef365", "author": {"user": {"login": "cuibo01", "name": "Bo Cui"}}, "url": "https://github.com/apache/hbase/commit/151101e8db9468420f521f892c0b07cb089ef365", "committedDate": "2020-12-19T01:25:04Z", "message": "HBASE-23340 hmaster /hbase/replication/rs session expired (hbase replication default value is true, we don't use ) causes logcleaner can not clean oldWALs, which resulits in oldWALs too large (more than 2TB)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "337bf6229e25ff142b700b1a525253f60efa82a0", "author": {"user": {"login": "cuibo01", "name": "Bo Cui"}}, "url": "https://github.com/apache/hbase/commit/337bf6229e25ff142b700b1a525253f60efa82a0", "committedDate": "2020-12-13T11:13:58Z", "message": "HBASE-23340 hmaster /hbase/replication/rs session expired (hbase replication default value is true, we don't use ) causes logcleaner can not clean oldWALs, which resulits in oldWALs too large (more than 2TB)"}, "afterCommit": {"oid": "151101e8db9468420f521f892c0b07cb089ef365", "author": {"user": {"login": "cuibo01", "name": "Bo Cui"}}, "url": "https://github.com/apache/hbase/commit/151101e8db9468420f521f892c0b07cb089ef365", "committedDate": "2020-12-19T01:25:04Z", "message": "HBASE-23340 hmaster /hbase/replication/rs session expired (hbase replication default value is true, we don't use ) causes logcleaner can not clean oldWALs, which resulits in oldWALs too large (more than 2TB)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwMzEwOTk5", "url": "https://github.com/apache/hbase/pull/2779#pullrequestreview-560310999", "createdAt": "2020-12-31T09:54:24Z", "commit": {"oid": "151101e8db9468420f521f892c0b07cb089ef365"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYzMjY1MDY3", "url": "https://github.com/apache/hbase/pull/2779#pullrequestreview-563265067", "createdAt": "2021-01-07T07:37:19Z", "commit": {"oid": "151101e8db9468420f521f892c0b07cb089ef365"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QwNzozNzoxOVrOIPh60g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QwNzozNzoxOVrOIPh60g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzE1NTI4Mg==", "bodyText": "Better set this flag to true by default, and in the below if (zkw == null), set it to false. Without any other assumptions, it is possible that HMaster.getZooKeeper returns null and we will create a new ZKWatcher but shareZK is false then we will not close it...", "url": "https://github.com/apache/hbase/pull/2779#discussion_r553155282", "createdAt": "2021-01-07T07:37:19Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/replication/master/ReplicationLogCleaner.java", "diffHunk": "@@ -92,12 +96,20 @@ public boolean apply(FileStatus file) {\n   }\n \n   @Override\n-  public void setConf(Configuration config) {\n-    // Make my own Configuration.  Then I'll have my own connection to zk that\n-    // I can close myself when comes time.\n-    Configuration conf = new Configuration(config);\n+  public void init(Map<String, Object> params) {\n+    super.init(params);\n     try {\n-      setConf(conf, new ZKWatcher(conf, \"replicationLogCleaner\", null));\n+      if (MapUtils.isNotEmpty(params)) {\n+        Object master = params.get(HMaster.MASTER);\n+        if (master != null && master instanceof HMaster) {\n+          zkw = ((HMaster) master).getZooKeeper();\n+          shareZK = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "151101e8db9468420f521f892c0b07cb089ef365"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY3NzkzNDU2", "url": "https://github.com/apache/hbase/pull/2779#pullrequestreview-567793456", "createdAt": "2021-01-14T01:44:17Z", "commit": {"oid": "151101e8db9468420f521f892c0b07cb089ef365"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4836, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}