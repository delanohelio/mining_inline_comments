{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2NDcyMjQ3", "number": 1182, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwODozMjowOFrODgmkKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwODozMjowOFrODgmkKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1NTEyODc1OnYy", "diffSide": "LEFT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/MergeTableRegionsProcedure.java", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwODozMjowOFrOFq5KVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwOTo1MjozNlrOFq70QA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDUyMTA0Nw==", "bodyText": "You can add extra checks before scheduling the procedure to make the request fail fast, but I do not think we should remove the checks in the procedure? There could be race, that when scheduling, split and merge are enabled but when you actually execute the procedure, the flags are turned to disabled...", "url": "https://github.com/apache/hbase/pull/1182#discussion_r380521047", "createdAt": "2020-02-18T08:32:08Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/MergeTableRegionsProcedure.java", "diffHunk": "@@ -453,13 +453,6 @@ private boolean prepareMergeRegion(final MasterProcedureEnv env) throws IOExcept\n       throw new MergeRegionException(\"Skip merging regions \" +\n           RegionInfo.getShortNameToLog(regionsToMerge) + \", because we are snapshotting \" + tn);\n     }\n-    if (!env.getMasterServices().isSplitOrMergeEnabled(MasterSwitchType.MERGE)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "950d0d7c7596eb984dfe37593765652fbe550f55"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDUyNDEzOA==", "bodyText": "Agree with Duo, others are good.", "url": "https://github.com/apache/hbase/pull/1182#discussion_r380524138", "createdAt": "2020-02-18T08:38:54Z", "author": {"login": "binlijin"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/MergeTableRegionsProcedure.java", "diffHunk": "@@ -453,13 +453,6 @@ private boolean prepareMergeRegion(final MasterProcedureEnv env) throws IOExcept\n       throw new MergeRegionException(\"Skip merging regions \" +\n           RegionInfo.getShortNameToLog(regionsToMerge) + \", because we are snapshotting \" + tn);\n     }\n-    if (!env.getMasterServices().isSplitOrMergeEnabled(MasterSwitchType.MERGE)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDUyMTA0Nw=="}, "originalCommit": {"oid": "950d0d7c7596eb984dfe37593765652fbe550f55"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDUzMDgwMg==", "bodyText": "I thought the race is not a big deal? And our admin client never have this guarantee: interrupt the schduled Split/Merge after split/merge is disabled.", "url": "https://github.com/apache/hbase/pull/1182#discussion_r380530802", "createdAt": "2020-02-18T08:52:46Z", "author": {"login": "infraio"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/MergeTableRegionsProcedure.java", "diffHunk": "@@ -453,13 +453,6 @@ private boolean prepareMergeRegion(final MasterProcedureEnv env) throws IOExcept\n       throw new MergeRegionException(\"Skip merging regions \" +\n           RegionInfo.getShortNameToLog(regionsToMerge) + \", because we are snapshotting \" + tn);\n     }\n-    if (!env.getMasterServices().isSplitOrMergeEnabled(MasterSwitchType.MERGE)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDUyMTA0Nw=="}, "originalCommit": {"oid": "950d0d7c7596eb984dfe37593765652fbe550f55"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDUzMjMxMw==", "bodyText": "But split and merge can be scheduled by background task? And also, if you remove the checks here, then you need to add the check everywhere...", "url": "https://github.com/apache/hbase/pull/1182#discussion_r380532313", "createdAt": "2020-02-18T08:55:48Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/MergeTableRegionsProcedure.java", "diffHunk": "@@ -453,13 +453,6 @@ private boolean prepareMergeRegion(final MasterProcedureEnv env) throws IOExcept\n       throw new MergeRegionException(\"Skip merging regions \" +\n           RegionInfo.getShortNameToLog(regionsToMerge) + \", because we are snapshotting \" + tn);\n     }\n-    if (!env.getMasterServices().isSplitOrMergeEnabled(MasterSwitchType.MERGE)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDUyMTA0Nw=="}, "originalCommit": {"oid": "950d0d7c7596eb984dfe37593765652fbe550f55"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDUzNDAxMQ==", "bodyText": "Yes. I checked this. Now only two place can schedule split/merge task. One is the rpc request of master. Another one is from RS's report.", "url": "https://github.com/apache/hbase/pull/1182#discussion_r380534011", "createdAt": "2020-02-18T08:58:56Z", "author": {"login": "infraio"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/MergeTableRegionsProcedure.java", "diffHunk": "@@ -453,13 +453,6 @@ private boolean prepareMergeRegion(final MasterProcedureEnv env) throws IOExcept\n       throw new MergeRegionException(\"Skip merging regions \" +\n           RegionInfo.getShortNameToLog(regionsToMerge) + \", because we are snapshotting \" + tn);\n     }\n-    if (!env.getMasterServices().isSplitOrMergeEnabled(MasterSwitchType.MERGE)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDUyMTA0Nw=="}, "originalCommit": {"oid": "950d0d7c7596eb984dfe37593765652fbe550f55"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDU2NDU0NA==", "bodyText": "But if in the future we schedule these procedures in other places, we need to add the check there...", "url": "https://github.com/apache/hbase/pull/1182#discussion_r380564544", "createdAt": "2020-02-18T09:52:36Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/MergeTableRegionsProcedure.java", "diffHunk": "@@ -453,13 +453,6 @@ private boolean prepareMergeRegion(final MasterProcedureEnv env) throws IOExcept\n       throw new MergeRegionException(\"Skip merging regions \" +\n           RegionInfo.getShortNameToLog(regionsToMerge) + \", because we are snapshotting \" + tn);\n     }\n-    if (!env.getMasterServices().isSplitOrMergeEnabled(MasterSwitchType.MERGE)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDUyMTA0Nw=="}, "originalCommit": {"oid": "950d0d7c7596eb984dfe37593765652fbe550f55"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2084, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}