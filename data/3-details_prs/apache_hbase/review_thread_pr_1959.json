{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4ODMwNDIw", "number": 1959, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QyMjoxNDo1OVrOEIJxmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwNDo0Njo1OFrOEInB8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2OTg0MjE4OnYy", "diffSide": "RIGHT", "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QyMjoxNDo1OVrOGn8fUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNjoxNDozOFrOGoZYiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDUzODcwNQ==", "bodyText": "Are there imports you can drop now after doing this work? e.g. the HTableDescriptor import?", "url": "https://github.com/apache/hbase/pull/1959#discussion_r444538705", "createdAt": "2020-06-23T22:14:59Z", "author": {"login": "saintstack"}, "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "diffHunk": "@@ -25,6 +25,8 @@\n java_import org.apache.hadoop.hbase.util.Bytes\n java_import org.apache.hadoop.hbase.ServerName\n java_import org.apache.hadoop.hbase.TableName\n+java_import org.apache.hadoop.hbase.client.ColumnFamilyDescriptorBuilder", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5667720e7de3a412faa2586dcdc06f531c0e338"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAxMjEwNA==", "bodyText": "As of my most recent commit, the symbols HTableDescriptor and HColumnDescriptor are not present in the hbase-shell module, which I verified via grep -r 'HColumnDescriptor\\|HTableDescriptor' hbase-shell", "url": "https://github.com/apache/hbase/pull/1959#discussion_r445012104", "createdAt": "2020-06-24T16:14:38Z", "author": {"login": "bitoffdev"}, "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "diffHunk": "@@ -25,6 +25,8 @@\n java_import org.apache.hadoop.hbase.util.Bytes\n java_import org.apache.hadoop.hbase.ServerName\n java_import org.apache.hadoop.hbase.TableName\n+java_import org.apache.hadoop.hbase.client.ColumnFamilyDescriptorBuilder", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDUzODcwNQ=="}, "originalCommit": {"oid": "d5667720e7de3a412faa2586dcdc06f531c0e338"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2OTg0NjA5OnYy", "diffSide": "RIGHT", "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QyMjoxNjo0OFrOGn8h0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNDo0NTo0M1rOGoViIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDUzOTM0Nw==", "bodyText": "No 'remove' for CF?", "url": "https://github.com/apache/hbase/pull/1959#discussion_r444539347", "createdAt": "2020-06-23T22:16:48Z", "author": {"login": "saintstack"}, "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "diffHunk": "@@ -701,40 +703,40 @@ def alter(table_name_str, wait = true, *args)\n           # Delete column family\n           if method == 'delete'\n             raise(ArgumentError, 'NAME parameter missing for delete method') unless name\n-            htd.removeFamily(name.to_java_bytes)\n+            tdb.removeColumnFamily(name.to_java_bytes)\n             hasTableUpdate = true\n           # Unset table attributes\n           elsif method == 'table_att_unset'\n             raise(ArgumentError, 'NAME parameter missing for table_att_unset method') unless name\n             if name.is_a?(Array)\n               name.each do |key|\n-                if htd.getValue(key).nil?\n+                if tdb.build.getValue(key).nil?\n                   raise ArgumentError, \"Could not find attribute: #{key}\"\n                 end\n-                htd.remove(key)\n+                tdb.setValue(key, nil)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5667720e7de3a412faa2586dcdc06f531c0e338"}, "originalPosition": 120}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYxNjM3NA==", "bodyText": "We have a removeValue method so we'd better make use of it. Anyway the implementation is to just call setValue(key, null).", "url": "https://github.com/apache/hbase/pull/1959#discussion_r444616374", "createdAt": "2020-06-24T02:55:31Z", "author": {"login": "Apache9"}, "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "diffHunk": "@@ -701,40 +703,40 @@ def alter(table_name_str, wait = true, *args)\n           # Delete column family\n           if method == 'delete'\n             raise(ArgumentError, 'NAME parameter missing for delete method') unless name\n-            htd.removeFamily(name.to_java_bytes)\n+            tdb.removeColumnFamily(name.to_java_bytes)\n             hasTableUpdate = true\n           # Unset table attributes\n           elsif method == 'table_att_unset'\n             raise(ArgumentError, 'NAME parameter missing for table_att_unset method') unless name\n             if name.is_a?(Array)\n               name.each do |key|\n-                if htd.getValue(key).nil?\n+                if tdb.build.getValue(key).nil?\n                   raise ArgumentError, \"Could not find attribute: #{key}\"\n                 end\n-                htd.remove(key)\n+                tdb.setValue(key, nil)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDUzOTM0Nw=="}, "originalCommit": {"oid": "d5667720e7de3a412faa2586dcdc06f531c0e338"}, "originalPosition": 120}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDkyMjk4Ng==", "bodyText": "Unfortunately, the current overloads for TableDescriptorBuilder.removeValue take either Bytes, or byte[], whereas setValue has an overload for a String argument. Unless there is an objection, I will go ahead and add the removeValue(final String key) overload, which would be consistent with the setValue overloads, and may be helpful for other developers in the future as well.\nThe other alternative (converting the key to bytes) seems like it would be more effort than just using setValue as is.", "url": "https://github.com/apache/hbase/pull/1959#discussion_r444922986", "createdAt": "2020-06-24T14:11:33Z", "author": {"login": "bitoffdev"}, "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "diffHunk": "@@ -701,40 +703,40 @@ def alter(table_name_str, wait = true, *args)\n           # Delete column family\n           if method == 'delete'\n             raise(ArgumentError, 'NAME parameter missing for delete method') unless name\n-            htd.removeFamily(name.to_java_bytes)\n+            tdb.removeColumnFamily(name.to_java_bytes)\n             hasTableUpdate = true\n           # Unset table attributes\n           elsif method == 'table_att_unset'\n             raise(ArgumentError, 'NAME parameter missing for table_att_unset method') unless name\n             if name.is_a?(Array)\n               name.each do |key|\n-                if htd.getValue(key).nil?\n+                if tdb.build.getValue(key).nil?\n                   raise ArgumentError, \"Could not find attribute: #{key}\"\n                 end\n-                htd.remove(key)\n+                tdb.setValue(key, nil)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDUzOTM0Nw=="}, "originalCommit": {"oid": "d5667720e7de3a412faa2586dcdc06f531c0e338"}, "originalPosition": 120}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDk0OTAyNg==", "bodyText": "Agree with adding a removeValue(String). Thanks.", "url": "https://github.com/apache/hbase/pull/1959#discussion_r444949026", "createdAt": "2020-06-24T14:45:43Z", "author": {"login": "Apache9"}, "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "diffHunk": "@@ -701,40 +703,40 @@ def alter(table_name_str, wait = true, *args)\n           # Delete column family\n           if method == 'delete'\n             raise(ArgumentError, 'NAME parameter missing for delete method') unless name\n-            htd.removeFamily(name.to_java_bytes)\n+            tdb.removeColumnFamily(name.to_java_bytes)\n             hasTableUpdate = true\n           # Unset table attributes\n           elsif method == 'table_att_unset'\n             raise(ArgumentError, 'NAME parameter missing for table_att_unset method') unless name\n             if name.is_a?(Array)\n               name.each do |key|\n-                if htd.getValue(key).nil?\n+                if tdb.build.getValue(key).nil?\n                   raise ArgumentError, \"Could not find attribute: #{key}\"\n                 end\n-                htd.remove(key)\n+                tdb.setValue(key, nil)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDUzOTM0Nw=="}, "originalCommit": {"oid": "d5667720e7de3a412faa2586dcdc06f531c0e338"}, "originalPosition": 120}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3MDM0MTI2OnYy", "diffSide": "RIGHT", "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwMjo1NjowMVrOGoBPPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNjoxNjozMVrOGoZdGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYxNjUwOA==", "bodyText": "Ditto.", "url": "https://github.com/apache/hbase/pull/1959#discussion_r444616508", "createdAt": "2020-06-24T02:56:01Z", "author": {"login": "Apache9"}, "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "diffHunk": "@@ -701,40 +703,40 @@ def alter(table_name_str, wait = true, *args)\n           # Delete column family\n           if method == 'delete'\n             raise(ArgumentError, 'NAME parameter missing for delete method') unless name\n-            htd.removeFamily(name.to_java_bytes)\n+            tdb.removeColumnFamily(name.to_java_bytes)\n             hasTableUpdate = true\n           # Unset table attributes\n           elsif method == 'table_att_unset'\n             raise(ArgumentError, 'NAME parameter missing for table_att_unset method') unless name\n             if name.is_a?(Array)\n               name.each do |key|\n-                if htd.getValue(key).nil?\n+                if tdb.build.getValue(key).nil?\n                   raise ArgumentError, \"Could not find attribute: #{key}\"\n                 end\n-                htd.remove(key)\n+                tdb.setValue(key, nil)\n               end\n             else\n-              if htd.getValue(name).nil?\n+              if tdb.build.getValue(name).nil?\n                 raise ArgumentError, \"Could not find attribute: #{name}\"\n               end\n-              htd.remove(name)\n+              tdb.setValue(name, nil)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5667720e7de3a412faa2586dcdc06f531c0e338"}, "originalPosition": 128}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAxMzI3NA==", "bodyText": "Done", "url": "https://github.com/apache/hbase/pull/1959#discussion_r445013274", "createdAt": "2020-06-24T16:16:31Z", "author": {"login": "bitoffdev"}, "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "diffHunk": "@@ -701,40 +703,40 @@ def alter(table_name_str, wait = true, *args)\n           # Delete column family\n           if method == 'delete'\n             raise(ArgumentError, 'NAME parameter missing for delete method') unless name\n-            htd.removeFamily(name.to_java_bytes)\n+            tdb.removeColumnFamily(name.to_java_bytes)\n             hasTableUpdate = true\n           # Unset table attributes\n           elsif method == 'table_att_unset'\n             raise(ArgumentError, 'NAME parameter missing for table_att_unset method') unless name\n             if name.is_a?(Array)\n               name.each do |key|\n-                if htd.getValue(key).nil?\n+                if tdb.build.getValue(key).nil?\n                   raise ArgumentError, \"Could not find attribute: #{key}\"\n                 end\n-                htd.remove(key)\n+                tdb.setValue(key, nil)\n               end\n             else\n-              if htd.getValue(name).nil?\n+              if tdb.build.getValue(name).nil?\n                 raise ArgumentError, \"Could not find attribute: #{name}\"\n               end\n-              htd.remove(name)\n+              tdb.setValue(name, nil)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYxNjUwOA=="}, "originalCommit": {"oid": "d5667720e7de3a412faa2586dcdc06f531c0e338"}, "originalPosition": 128}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3MDM0MTU3OnYy", "diffSide": "RIGHT", "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwMjo1NjoxMVrOGoBPbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNjoxNjo0MFrOGoZdeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYxNjU1Ng==", "bodyText": "Ditto.", "url": "https://github.com/apache/hbase/pull/1959#discussion_r444616556", "createdAt": "2020-06-24T02:56:11Z", "author": {"login": "Apache9"}, "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "diffHunk": "@@ -701,40 +703,40 @@ def alter(table_name_str, wait = true, *args)\n           # Delete column family\n           if method == 'delete'\n             raise(ArgumentError, 'NAME parameter missing for delete method') unless name\n-            htd.removeFamily(name.to_java_bytes)\n+            tdb.removeColumnFamily(name.to_java_bytes)\n             hasTableUpdate = true\n           # Unset table attributes\n           elsif method == 'table_att_unset'\n             raise(ArgumentError, 'NAME parameter missing for table_att_unset method') unless name\n             if name.is_a?(Array)\n               name.each do |key|\n-                if htd.getValue(key).nil?\n+                if tdb.build.getValue(key).nil?\n                   raise ArgumentError, \"Could not find attribute: #{key}\"\n                 end\n-                htd.remove(key)\n+                tdb.setValue(key, nil)\n               end\n             else\n-              if htd.getValue(name).nil?\n+              if tdb.build.getValue(name).nil?\n                 raise ArgumentError, \"Could not find attribute: #{name}\"\n               end\n-              htd.remove(name)\n+              tdb.setValue(name, nil)\n             end\n             hasTableUpdate = true\n           # Unset table configuration\n           elsif method == 'table_conf_unset'\n             raise(ArgumentError, 'NAME parameter missing for table_conf_unset method') unless name\n             if name.is_a?(Array)\n               name.each do |key|\n-                if htd.getConfigurationValue(key).nil?\n+                if tdb.build.getValue(key).nil?\n                   raise ArgumentError, \"Could not find configuration: #{key}\"\n                 end\n-                htd.removeConfiguration(key)\n+                tdb.setValue(key, nil)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5667720e7de3a412faa2586dcdc06f531c0e338"}, "originalPosition": 141}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAxMzM2OA==", "bodyText": "Done", "url": "https://github.com/apache/hbase/pull/1959#discussion_r445013368", "createdAt": "2020-06-24T16:16:40Z", "author": {"login": "bitoffdev"}, "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "diffHunk": "@@ -701,40 +703,40 @@ def alter(table_name_str, wait = true, *args)\n           # Delete column family\n           if method == 'delete'\n             raise(ArgumentError, 'NAME parameter missing for delete method') unless name\n-            htd.removeFamily(name.to_java_bytes)\n+            tdb.removeColumnFamily(name.to_java_bytes)\n             hasTableUpdate = true\n           # Unset table attributes\n           elsif method == 'table_att_unset'\n             raise(ArgumentError, 'NAME parameter missing for table_att_unset method') unless name\n             if name.is_a?(Array)\n               name.each do |key|\n-                if htd.getValue(key).nil?\n+                if tdb.build.getValue(key).nil?\n                   raise ArgumentError, \"Could not find attribute: #{key}\"\n                 end\n-                htd.remove(key)\n+                tdb.setValue(key, nil)\n               end\n             else\n-              if htd.getValue(name).nil?\n+              if tdb.build.getValue(name).nil?\n                 raise ArgumentError, \"Could not find attribute: #{name}\"\n               end\n-              htd.remove(name)\n+              tdb.setValue(name, nil)\n             end\n             hasTableUpdate = true\n           # Unset table configuration\n           elsif method == 'table_conf_unset'\n             raise(ArgumentError, 'NAME parameter missing for table_conf_unset method') unless name\n             if name.is_a?(Array)\n               name.each do |key|\n-                if htd.getConfigurationValue(key).nil?\n+                if tdb.build.getValue(key).nil?\n                   raise ArgumentError, \"Could not find configuration: #{key}\"\n                 end\n-                htd.removeConfiguration(key)\n+                tdb.setValue(key, nil)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYxNjU1Ng=="}, "originalCommit": {"oid": "d5667720e7de3a412faa2586dcdc06f531c0e338"}, "originalPosition": 141}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3MDM0MTczOnYy", "diffSide": "RIGHT", "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwMjo1NjoxOFrOGoBPhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNjoxNjo0NlrOGoZduA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYxNjU4MA==", "bodyText": "Ditto.", "url": "https://github.com/apache/hbase/pull/1959#discussion_r444616580", "createdAt": "2020-06-24T02:56:18Z", "author": {"login": "Apache9"}, "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "diffHunk": "@@ -701,40 +703,40 @@ def alter(table_name_str, wait = true, *args)\n           # Delete column family\n           if method == 'delete'\n             raise(ArgumentError, 'NAME parameter missing for delete method') unless name\n-            htd.removeFamily(name.to_java_bytes)\n+            tdb.removeColumnFamily(name.to_java_bytes)\n             hasTableUpdate = true\n           # Unset table attributes\n           elsif method == 'table_att_unset'\n             raise(ArgumentError, 'NAME parameter missing for table_att_unset method') unless name\n             if name.is_a?(Array)\n               name.each do |key|\n-                if htd.getValue(key).nil?\n+                if tdb.build.getValue(key).nil?\n                   raise ArgumentError, \"Could not find attribute: #{key}\"\n                 end\n-                htd.remove(key)\n+                tdb.setValue(key, nil)\n               end\n             else\n-              if htd.getValue(name).nil?\n+              if tdb.build.getValue(name).nil?\n                 raise ArgumentError, \"Could not find attribute: #{name}\"\n               end\n-              htd.remove(name)\n+              tdb.setValue(name, nil)\n             end\n             hasTableUpdate = true\n           # Unset table configuration\n           elsif method == 'table_conf_unset'\n             raise(ArgumentError, 'NAME parameter missing for table_conf_unset method') unless name\n             if name.is_a?(Array)\n               name.each do |key|\n-                if htd.getConfigurationValue(key).nil?\n+                if tdb.build.getValue(key).nil?\n                   raise ArgumentError, \"Could not find configuration: #{key}\"\n                 end\n-                htd.removeConfiguration(key)\n+                tdb.setValue(key, nil)\n               end\n             else\n-              if htd.getConfigurationValue(name).nil?\n+              if tdb.build.getValue(name).nil?\n                 raise ArgumentError, \"Could not find configuration: #{name}\"\n               end\n-              htd.removeConfiguration(name)\n+              tdb.setValue(name, nil)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5667720e7de3a412faa2586dcdc06f531c0e338"}, "originalPosition": 149}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAxMzQzMg==", "bodyText": "Done", "url": "https://github.com/apache/hbase/pull/1959#discussion_r445013432", "createdAt": "2020-06-24T16:16:46Z", "author": {"login": "bitoffdev"}, "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "diffHunk": "@@ -701,40 +703,40 @@ def alter(table_name_str, wait = true, *args)\n           # Delete column family\n           if method == 'delete'\n             raise(ArgumentError, 'NAME parameter missing for delete method') unless name\n-            htd.removeFamily(name.to_java_bytes)\n+            tdb.removeColumnFamily(name.to_java_bytes)\n             hasTableUpdate = true\n           # Unset table attributes\n           elsif method == 'table_att_unset'\n             raise(ArgumentError, 'NAME parameter missing for table_att_unset method') unless name\n             if name.is_a?(Array)\n               name.each do |key|\n-                if htd.getValue(key).nil?\n+                if tdb.build.getValue(key).nil?\n                   raise ArgumentError, \"Could not find attribute: #{key}\"\n                 end\n-                htd.remove(key)\n+                tdb.setValue(key, nil)\n               end\n             else\n-              if htd.getValue(name).nil?\n+              if tdb.build.getValue(name).nil?\n                 raise ArgumentError, \"Could not find attribute: #{name}\"\n               end\n-              htd.remove(name)\n+              tdb.setValue(name, nil)\n             end\n             hasTableUpdate = true\n           # Unset table configuration\n           elsif method == 'table_conf_unset'\n             raise(ArgumentError, 'NAME parameter missing for table_conf_unset method') unless name\n             if name.is_a?(Array)\n               name.each do |key|\n-                if htd.getConfigurationValue(key).nil?\n+                if tdb.build.getValue(key).nil?\n                   raise ArgumentError, \"Could not find configuration: #{key}\"\n                 end\n-                htd.removeConfiguration(key)\n+                tdb.setValue(key, nil)\n               end\n             else\n-              if htd.getConfigurationValue(name).nil?\n+              if tdb.build.getValue(name).nil?\n                 raise ArgumentError, \"Could not find configuration: #{name}\"\n               end\n-              htd.removeConfiguration(name)\n+              tdb.setValue(name, nil)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYxNjU4MA=="}, "originalCommit": {"oid": "d5667720e7de3a412faa2586dcdc06f531c0e338"}, "originalPosition": 149}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3NDYyMjgwOnYy", "diffSide": "RIGHT", "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwNDozODozNFrOGorFxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNzoyODozOFrOGpErFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwMjIxMg==", "bodyText": "Since this no longer returns HColumnDescriptor maybe cfd would be a better name?", "url": "https://github.com/apache/hbase/pull/1959#discussion_r445302212", "createdAt": "2020-06-25T04:38:34Z", "author": {"login": "busbey"}, "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "diffHunk": "@@ -971,101 +976,103 @@ def enabled?(table_name)\n     end\n \n     #----------------------------------------------------------------------------------------------\n-    # Return a new HColumnDescriptor made of passed args\n-    def hcd(arg, htd)\n+    # Return a new ColumnFamilyDescriptor made of passed args\n+    def hcd(arg, tdb)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "13dbed076045a4bb4d3cc934c2ab172289831b9b"}, "originalPosition": 190}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwMzY3NA==", "bodyText": "even if we do not change this name we will need to release note this change because it is visible to shell users but the return type changed.", "url": "https://github.com/apache/hbase/pull/1959#discussion_r445303674", "createdAt": "2020-06-25T04:44:20Z", "author": {"login": "busbey"}, "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "diffHunk": "@@ -971,101 +976,103 @@ def enabled?(table_name)\n     end\n \n     #----------------------------------------------------------------------------------------------\n-    # Return a new HColumnDescriptor made of passed args\n-    def hcd(arg, htd)\n+    # Return a new ColumnFamilyDescriptor made of passed args\n+    def hcd(arg, tdb)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwMjIxMg=="}, "originalCommit": {"oid": "13dbed076045a4bb4d3cc934c2ab172289831b9b"}, "originalPosition": 190}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTcyMTM2NQ==", "bodyText": "I agree. I went ahead and renamed hcd to cfd and added the removal of hcd to the custom \"Release Note\" field in Jira.", "url": "https://github.com/apache/hbase/pull/1959#discussion_r445721365", "createdAt": "2020-06-25T17:28:38Z", "author": {"login": "bitoffdev"}, "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "diffHunk": "@@ -971,101 +976,103 @@ def enabled?(table_name)\n     end\n \n     #----------------------------------------------------------------------------------------------\n-    # Return a new HColumnDescriptor made of passed args\n-    def hcd(arg, htd)\n+    # Return a new ColumnFamilyDescriptor made of passed args\n+    def hcd(arg, tdb)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwMjIxMg=="}, "originalCommit": {"oid": "13dbed076045a4bb4d3cc934c2ab172289831b9b"}, "originalPosition": 190}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3NDYyNDAzOnYy", "diffSide": "RIGHT", "path": "hbase-shell/src/main/ruby/hbase_constants.rb", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwNDozOTozOFrOGorGsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNjo1NDowMFrOGpn-Sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwMjQ0OQ==", "bodyText": "we'll need to release note the changed set of constants, if any.", "url": "https://github.com/apache/hbase/pull/1959#discussion_r445302449", "createdAt": "2020-06-25T04:39:38Z", "author": {"login": "busbey"}, "path": "hbase-shell/src/main/ruby/hbase_constants.rb", "diffHunk": "@@ -109,8 +109,8 @@ def self.promote_constants(constants)\n     end\n   end\n \n-  promote_constants(org.apache.hadoop.hbase.HColumnDescriptor.constants)\n-  promote_constants(org.apache.hadoop.hbase.HTableDescriptor.constants)\n+  promote_constants(org.apache.hadoop.hbase.client.ColumnFamilyDescriptorBuilder.constants)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "13dbed076045a4bb4d3cc934c2ab172289831b9b"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTc0NjY3OQ==", "bodyText": "This patch removes 11 constants. I added these to the release notes and left a long-form explanation in Jira:\nhttps://issues.apache.org/jira/browse/HBASE-20819?focusedCommentId=17145696", "url": "https://github.com/apache/hbase/pull/1959#discussion_r445746679", "createdAt": "2020-06-25T18:12:56Z", "author": {"login": "bitoffdev"}, "path": "hbase-shell/src/main/ruby/hbase_constants.rb", "diffHunk": "@@ -109,8 +109,8 @@ def self.promote_constants(constants)\n     end\n   end\n \n-  promote_constants(org.apache.hadoop.hbase.HColumnDescriptor.constants)\n-  promote_constants(org.apache.hadoop.hbase.HTableDescriptor.constants)\n+  promote_constants(org.apache.hadoop.hbase.client.ColumnFamilyDescriptorBuilder.constants)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwMjQ0OQ=="}, "originalCommit": {"oid": "13dbed076045a4bb4d3cc934c2ab172289831b9b"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg3ODUzOQ==", "bodyText": "Hurm. Some of those still look likely to be useful (e.g. MOB_THRESHOLD_BYTES). Can we add them in without bringing back references to the classes we're removing?", "url": "https://github.com/apache/hbase/pull/1959#discussion_r445878539", "createdAt": "2020-06-25T22:44:23Z", "author": {"login": "busbey"}, "path": "hbase-shell/src/main/ruby/hbase_constants.rb", "diffHunk": "@@ -109,8 +109,8 @@ def self.promote_constants(constants)\n     end\n   end\n \n-  promote_constants(org.apache.hadoop.hbase.HColumnDescriptor.constants)\n-  promote_constants(org.apache.hadoop.hbase.HTableDescriptor.constants)\n+  promote_constants(org.apache.hadoop.hbase.client.ColumnFamilyDescriptorBuilder.constants)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwMjQ0OQ=="}, "originalCommit": {"oid": "13dbed076045a4bb4d3cc934c2ab172289831b9b"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI5NjQ2Ng==", "bodyText": "I just pushed a commit that adds back three constants, but leaves the rest out. I left a comment on Jira with my rationale for each of the constants. Let me know if you disagree with any of my conclusions, and I can easily add more constants back \ud83d\ude04.\nSpecifically for the MOB constants, we added setters for all the MOB key-value pairs to our builder. I think including these private constants will encourage users to go against our defined interface.", "url": "https://github.com/apache/hbase/pull/1959#discussion_r446296466", "createdAt": "2020-06-26T16:47:58Z", "author": {"login": "bitoffdev"}, "path": "hbase-shell/src/main/ruby/hbase_constants.rb", "diffHunk": "@@ -109,8 +109,8 @@ def self.promote_constants(constants)\n     end\n   end\n \n-  promote_constants(org.apache.hadoop.hbase.HColumnDescriptor.constants)\n-  promote_constants(org.apache.hadoop.hbase.HTableDescriptor.constants)\n+  promote_constants(org.apache.hadoop.hbase.client.ColumnFamilyDescriptorBuilder.constants)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwMjQ0OQ=="}, "originalCommit": {"oid": "13dbed076045a4bb4d3cc934c2ab172289831b9b"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI5OTcyMg==", "bodyText": "That's great work, thanks! Analysis looks reasonable to me.", "url": "https://github.com/apache/hbase/pull/1959#discussion_r446299722", "createdAt": "2020-06-26T16:54:00Z", "author": {"login": "busbey"}, "path": "hbase-shell/src/main/ruby/hbase_constants.rb", "diffHunk": "@@ -109,8 +109,8 @@ def self.promote_constants(constants)\n     end\n   end\n \n-  promote_constants(org.apache.hadoop.hbase.HColumnDescriptor.constants)\n-  promote_constants(org.apache.hadoop.hbase.HTableDescriptor.constants)\n+  promote_constants(org.apache.hadoop.hbase.client.ColumnFamilyDescriptorBuilder.constants)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwMjQ0OQ=="}, "originalCommit": {"oid": "13dbed076045a4bb4d3cc934c2ab172289831b9b"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3NDYyOTQxOnYy", "diffSide": "LEFT", "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwNDo0Mjo0NlrOGorJ7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNzoyOTo1NVrOGpEuQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwMzI3OA==", "bodyText": "this method was accessible to shell users, so we will need to release note the removal.", "url": "https://github.com/apache/hbase/pull/1959#discussion_r445303278", "createdAt": "2020-06-25T04:42:46Z", "author": {"login": "busbey"}, "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "diffHunk": "@@ -1359,26 +1366,26 @@ def list_locks\n       @admin.getLocks\n     end\n \n-    # Parse arguments and update HTableDescriptor accordingly\n-    def update_htd_from_arg(htd, arg)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "13dbed076045a4bb4d3cc934c2ab172289831b9b"}, "originalPosition": 358}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTcyMjE3OQ==", "bodyText": "Thanks for the heads up! I just updated the \"Release Note\" field in Jira to state that this method was removed.", "url": "https://github.com/apache/hbase/pull/1959#discussion_r445722179", "createdAt": "2020-06-25T17:29:55Z", "author": {"login": "bitoffdev"}, "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "diffHunk": "@@ -1359,26 +1366,26 @@ def list_locks\n       @admin.getLocks\n     end\n \n-    # Parse arguments and update HTableDescriptor accordingly\n-    def update_htd_from_arg(htd, arg)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwMzI3OA=="}, "originalCommit": {"oid": "13dbed076045a4bb4d3cc934c2ab172289831b9b"}, "originalPosition": 358}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3NDYzNTM2OnYy", "diffSide": "RIGHT", "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwNDo0Njo1OFrOGorN1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMTowNjoyNlrOGpLzlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwNDI3OQ==", "bodyText": "do we need to build the whole table descriptor in order to check for the column family? I see we do this several times in the change set.", "url": "https://github.com/apache/hbase/pull/1959#discussion_r445304279", "createdAt": "2020-06-25T04:46:58Z", "author": {"login": "busbey"}, "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "diffHunk": "@@ -971,101 +976,103 @@ def enabled?(table_name)\n     end\n \n     #----------------------------------------------------------------------------------------------\n-    # Return a new HColumnDescriptor made of passed args\n-    def hcd(arg, htd)\n+    # Return a new ColumnFamilyDescriptor made of passed args\n+    def hcd(arg, tdb)\n       # String arg, single parameter constructor\n-      return org.apache.hadoop.hbase.HColumnDescriptor.new(arg) if arg.is_a?(String)\n+\n+      return ColumnFamilyDescriptorBuilder.of(arg) if arg.is_a?(String)\n \n       raise(ArgumentError, \"Column family #{arg} must have a name\") unless name = arg.delete(NAME)\n \n-      family = htd.getFamily(name.to_java_bytes)\n+      cfd = tdb.build.getColumnFamily(name.to_java_bytes)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "13dbed076045a4bb4d3cc934c2ab172289831b9b"}, "originalPosition": 199}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTc5MDk3OA==", "bodyText": "I think this is the best way to do it at the moment. Currently, it seems that TableDescriptorBuilder is intended to be used for writing only, in which case we would not want the builder itself to have methods like getColumnFamily or hasColumnFamily. This is consistent with the lack of getValue and hasValue methods on the builder.\nOther than adding methods to builder, the only other way to shortcut the handful of calls this patch makes to tdb.build would be to cache the TableDescriptor at the start of each method that uses a T.D.. I have to recommend against this approach since it would technically change the behavior. Ex: If you were to execute something in the shell like alter 't1', {NAME => 'fam1', METHOD => 'delete'}, {NAME => 'fam1', VERSIONS => 5} where a C.F. is changed multiple times. In this example, a cached T.D. would not reflect the deletion of the C.F..\nWith these thoughts, I am inclined to leave the patch as-is.", "url": "https://github.com/apache/hbase/pull/1959#discussion_r445790978", "createdAt": "2020-06-25T19:31:39Z", "author": {"login": "bitoffdev"}, "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "diffHunk": "@@ -971,101 +976,103 @@ def enabled?(table_name)\n     end\n \n     #----------------------------------------------------------------------------------------------\n-    # Return a new HColumnDescriptor made of passed args\n-    def hcd(arg, htd)\n+    # Return a new ColumnFamilyDescriptor made of passed args\n+    def hcd(arg, tdb)\n       # String arg, single parameter constructor\n-      return org.apache.hadoop.hbase.HColumnDescriptor.new(arg) if arg.is_a?(String)\n+\n+      return ColumnFamilyDescriptorBuilder.of(arg) if arg.is_a?(String)\n \n       raise(ArgumentError, \"Column family #{arg} must have a name\") unless name = arg.delete(NAME)\n \n-      family = htd.getFamily(name.to_java_bytes)\n+      cfd = tdb.build.getColumnFamily(name.to_java_bytes)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwNDI3OQ=="}, "originalCommit": {"oid": "13dbed076045a4bb4d3cc934c2ab172289831b9b"}, "originalPosition": 199}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgzODIzMA==", "bodyText": "I think that if we do choose to add any sort of introspection (like hasColumnFamily, getColumnFamily) to the TableDescriptorBuilder itself, that would belong in a separate ticket/issue.", "url": "https://github.com/apache/hbase/pull/1959#discussion_r445838230", "createdAt": "2020-06-25T21:06:26Z", "author": {"login": "bitoffdev"}, "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "diffHunk": "@@ -971,101 +976,103 @@ def enabled?(table_name)\n     end\n \n     #----------------------------------------------------------------------------------------------\n-    # Return a new HColumnDescriptor made of passed args\n-    def hcd(arg, htd)\n+    # Return a new ColumnFamilyDescriptor made of passed args\n+    def hcd(arg, tdb)\n       # String arg, single parameter constructor\n-      return org.apache.hadoop.hbase.HColumnDescriptor.new(arg) if arg.is_a?(String)\n+\n+      return ColumnFamilyDescriptorBuilder.of(arg) if arg.is_a?(String)\n \n       raise(ArgumentError, \"Column family #{arg} must have a name\") unless name = arg.delete(NAME)\n \n-      family = htd.getFamily(name.to_java_bytes)\n+      cfd = tdb.build.getColumnFamily(name.to_java_bytes)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwNDI3OQ=="}, "originalCommit": {"oid": "13dbed076045a4bb4d3cc934c2ab172289831b9b"}, "originalPosition": 199}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2860, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}