{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyNzU0MDEz", "number": 1335, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMzozNjo0NFrODrArBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMzo0NjozN1rODrAzgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NDI2Mzc1OnYy", "diffSide": "RIGHT", "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/util/CommonFSUtils.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMzozNjo0NFrOF7HCdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMzozNjo0NFrOF7HCdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUyNTYyMQ==", "bodyText": "nit: path is not an instance of String, so auto-type-conversion means this will call path.toString() even when debug is not enabled. That method looks entirely too complicated, with lots of branching, but I guess nothing too hateful. Just and FYI.", "url": "https://github.com/apache/hbase/pull/1335#discussion_r397525621", "createdAt": "2020-03-24T23:36:44Z", "author": {"login": "ndimiduk"}, "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/util/CommonFSUtils.java", "diffHunk": "@@ -525,10 +518,7 @@ private static void invokeSetStoragePolicy(final FileSystem fs, final Path path,\n \n     try {\n       fs.setStoragePolicy(path, storagePolicy);\n-\n-      if (LOG.isDebugEnabled()) {\n-        LOG.debug(\"Set storagePolicy={} for path={}\", storagePolicy, path);\n-      }\n+      LOG.debug(\"Set storagePolicy={} for path={}\", storagePolicy, path);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "142cc8f83886e0b27a15fc9bddf9e4fbe4a823a6"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NDI4NTQ2OnYy", "diffSide": "RIGHT", "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/util/CommonFSUtils.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMzo0NjozN1rOF7HPKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMzoyMjo1NVrOF7K4rQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUyODg3NA==", "bodyText": "DistributedFileSystem appears to exist since 2.10, so can this string be built from a class reference? For example,\nString buildName = DistributedFileSystem.class.getName() + \"$HdfsDataOutputStreamBuilder\";\nLooks like hbase-common module doesn't depend on hadoop-hdfs-client jar, so maybe this gets too weird for a \"cleanup\" patch. Would be nice though, to use whatever static references we can...", "url": "https://github.com/apache/hbase/pull/1335#discussion_r397528874", "createdAt": "2020-03-24T23:46:37Z", "author": {"login": "ndimiduk"}, "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/util/CommonFSUtils.java", "diffHunk": "@@ -759,200 +739,75 @@ public static void checkShortCircuitReadBufferSize(final Configuration conf) {\n     conf.setIfUnset(dfsKey, Integer.toString(hbaseSize));\n   }\n \n-  private static class DfsBuilderUtility {\n-    static Class<?> dfsClass = null;\n-    static Method createMethod;\n-    static Method overwriteMethod;\n-    static Method bufferSizeMethod;\n-    static Method blockSizeMethod;\n-    static Method recursiveMethod;\n-    static Method replicateMethod;\n-    static Method replicationMethod;\n-    static Method buildMethod;\n-    static boolean allMethodsPresent = false;\n+  private static final class DfsBuilderUtility {\n+    private static final Class<?> BUILDER;\n+    private static final Method REPLICATE;\n \n     static {\n-      String dfsName = \"org.apache.hadoop.hdfs.DistributedFileSystem\";\n-      String builderName = dfsName + \"$HdfsDataOutputStreamBuilder\";\n+      String builderName = \"org.apache.hadoop.hdfs.DistributedFileSystem$HdfsDataOutputStreamBuilder\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "142cc8f83886e0b27a15fc9bddf9e4fbe4a823a6"}, "originalPosition": 98}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU4ODY1Mw==", "bodyText": "Yes, hbase-common only depends on hadoop-common so we can only access FileSystem, not DistributedFileSystem. I tried to move this method to hbase-server but then I realized that we also use this method in hbase-procedure, so leave it as is for now. The WALProcedureStore is supposed to be removed in 4.0.0, let's revive this again at that time...", "url": "https://github.com/apache/hbase/pull/1335#discussion_r397588653", "createdAt": "2020-03-25T03:22:55Z", "author": {"login": "Apache9"}, "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/util/CommonFSUtils.java", "diffHunk": "@@ -759,200 +739,75 @@ public static void checkShortCircuitReadBufferSize(final Configuration conf) {\n     conf.setIfUnset(dfsKey, Integer.toString(hbaseSize));\n   }\n \n-  private static class DfsBuilderUtility {\n-    static Class<?> dfsClass = null;\n-    static Method createMethod;\n-    static Method overwriteMethod;\n-    static Method bufferSizeMethod;\n-    static Method blockSizeMethod;\n-    static Method recursiveMethod;\n-    static Method replicateMethod;\n-    static Method replicationMethod;\n-    static Method buildMethod;\n-    static boolean allMethodsPresent = false;\n+  private static final class DfsBuilderUtility {\n+    private static final Class<?> BUILDER;\n+    private static final Method REPLICATE;\n \n     static {\n-      String dfsName = \"org.apache.hadoop.hdfs.DistributedFileSystem\";\n-      String builderName = dfsName + \"$HdfsDataOutputStreamBuilder\";\n+      String builderName = \"org.apache.hadoop.hdfs.DistributedFileSystem$HdfsDataOutputStreamBuilder\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUyODg3NA=="}, "originalCommit": {"oid": "142cc8f83886e0b27a15fc9bddf9e4fbe4a823a6"}, "originalPosition": 98}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1937, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}