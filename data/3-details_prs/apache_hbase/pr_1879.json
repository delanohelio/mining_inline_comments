{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxOTk0MzA1", "number": 1879, "title": "HBASE-24525 [branch-1] Support ZooKeeper 3.6.0+", "bodyText": "", "createdAt": "2020-06-09T18:41:53Z", "url": "https://github.com/apache/hbase/pull/1879", "merged": true, "mergeCommit": {"oid": "f74d1819143e1544b5cd4bcaa5305f2fcfb83474"}, "closed": true, "closedAt": "2020-06-10T18:44:22Z", "author": {"login": "apurtell"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcppd69AH2gAyNDMxOTk0MzA1OjI5MTUzN2UwNjNmOWFiZTExMTY4ZDU5YWQ5YjcxZTgwMTI2Y2IwMTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcp8aDIAFqTQyODIzODE5Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "291537e063f9abe11168d59ad9b71e80126cb013", "author": {"user": {"login": "apurtell", "name": "Andrew Purtell"}}, "url": "https://github.com/apache/hbase/commit/291537e063f9abe11168d59ad9b71e80126cb013", "committedDate": "2020-06-09T18:35:46Z", "message": "HBASE-24525 [branch-1] Support ZooKeeper 3.6.0+"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NDQzNDAy", "url": "https://github.com/apache/hbase/pull/1879#pullrequestreview-427443402", "createdAt": "2020-06-09T18:44:39Z", "commit": {"oid": "291537e063f9abe11168d59ad9b71e80126cb013"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxODo0NDozOVrOGhXnbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxODo0NDozOVrOGhXnbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY0MzExNw==", "bodyText": "ZooKeeper 3.6 throws NPE if the multi list is empty", "url": "https://github.com/apache/hbase/pull/1879#discussion_r437643117", "createdAt": "2020-06-09T18:44:39Z", "author": {"login": "apurtell"}, "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java", "diffHunk": "@@ -1811,9 +1811,10 @@ private static Op toZooKeeperOp(ZooKeeperWatcher zkw, ZKUtilOp op)\n    */\n   public static void multiOrSequential(ZooKeeperWatcher zkw, List<ZKUtilOp> ops,\n       boolean runSequentialOnMultiFailure) throws KeeperException {\n-    if (ops == null) return;\n+    if (ops == null || ops.isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "291537e063f9abe11168d59ad9b71e80126cb013"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NDQzNzY4", "url": "https://github.com/apache/hbase/pull/1879#pullrequestreview-427443768", "createdAt": "2020-06-09T18:45:09Z", "commit": {"oid": "291537e063f9abe11168d59ad9b71e80126cb013"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxODo0NToxMFrOGhXogQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxODo0NToxMFrOGhXogQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY0MzM5Mw==", "bodyText": "3.6.0 removed getRevision; 3.6.1 puts it back. Do we need it? I think: no", "url": "https://github.com/apache/hbase/pull/1879#discussion_r437643393", "createdAt": "2020-06-09T18:45:10Z", "author": {"login": "apurtell"}, "path": "hbase-server/src/main/jamon/org/apache/hadoop/hbase/tmpl/master/MasterStatusTmpl.jamon", "diffHunk": "@@ -294,7 +294,7 @@ AssignmentManager assignmentManager = master.getAssignmentManager();\n                 </tr>\n                 <tr>\n                     <td>ZooKeeper Client Version</td>\n-                    <td><% org.apache.zookeeper.Version.getVersion() %>, revision=<% org.apache.zookeeper.Version.getRevision() %></td>\n+                    <td><% org.apache.zookeeper.Version.getVersion() %></td>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "291537e063f9abe11168d59ad9b71e80126cb013"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NDkzMTY2", "url": "https://github.com/apache/hbase/pull/1879#pullrequestreview-427493166", "createdAt": "2020-06-09T19:55:37Z", "commit": {"oid": "291537e063f9abe11168d59ad9b71e80126cb013"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxOTo1NTozN1rOGhZ8ZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMDowMDoyMVrOGhaGvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY4MTI1Mw==", "bodyText": "UnknownHostException is also an IOE, so I think you can just remove UnknownHostException from the method signature and all is good? no need to try/catch/wrap blocks?", "url": "https://github.com/apache/hbase/pull/1879#discussion_r437681253", "createdAt": "2020-06-09T19:55:37Z", "author": {"login": "bharathv"}, "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/zookeeper/HQuorumPeer.java", "diffHunk": "@@ -85,14 +85,20 @@ public static void main(String[] args) {\n   }\n \n   private static void runZKServer(QuorumPeerConfig zkConfig) throws UnknownHostException, IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "291537e063f9abe11168d59ad9b71e80126cb013"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY4MzE1Mw==", "bodyText": "Why this? Any un-checked exception is propagated as-is?", "url": "https://github.com/apache/hbase/pull/1879#discussion_r437683153", "createdAt": "2020-06-09T19:59:00Z", "author": {"login": "bharathv"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperMainServer.java", "diffHunk": "@@ -66,8 +66,14 @@ public HACK_UNTIL_ZOOKEEPER_1897_ZooKeeperMain(String[] args)\n      * @throws IOException\n      * @throws InterruptedException\n      */\n-    void runCmdLine() throws KeeperException, IOException, InterruptedException {\n-      processCmd(this.cl);\n+    void runCmdLine() throws IOException, InterruptedException {\n+      try {\n+        processCmd(this.cl);\n+      } catch (IOException | InterruptedException e) {\n+        throw e;\n+      } catch (Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "291537e063f9abe11168d59ad9b71e80126cb013"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY4MzkwMA==", "bodyText": "nit: I think this for cross-version compatibility, a quick comment would be nice.", "url": "https://github.com/apache/hbase/pull/1879#discussion_r437683900", "createdAt": "2020-06-09T20:00:21Z", "author": {"login": "bharathv"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/zookeeper/TestHQuorumPeer.java", "diffHunk": "@@ -111,25 +115,39 @@\n     QuorumPeerConfig config = new QuorumPeerConfig();\n     config.parseProperties(properties);\n \n-    assertEquals(this.dataDir.toString(), config.getDataDir());\n+    assertEquals(this.dataDir.toString(), config.getDataDir().toString());\n     assertEquals(2181, config.getClientPortAddress().getPort());\n     Map<Long,QuorumServer> servers = config.getServers();\n     assertEquals(3, servers.size());\n     assertTrue(servers.containsKey(Long.valueOf(0)));\n     QuorumServer server = servers.get(Long.valueOf(0));\n-    assertEquals(\"localhost\", server.addr.getHostName());\n+    assertEquals(\"localhost\", getHostName(server));\n \n     // Override with system property.\n     System.setProperty(\"hbase.master.hostname\", \"foo.bar\");\n     is = new ByteArrayInputStream(s.getBytes());\n     properties = ZKConfig.parseZooCfg(conf, is);\n     assertEquals(\"foo.bar:2888:3888\", properties.get(\"server.0\"));\n-\n     config.parseProperties(properties);\n \n     servers = config.getServers();\n     server = servers.get(Long.valueOf(0));\n-    assertEquals(\"foo.bar\", server.addr.getHostName());\n+    assertEquals(\"foo.bar\", getHostName(server));\n+  }\n+\n+  private static String getHostName(QuorumServer server) throws Exception {\n+    String hostname;\n+    switch (server.addr.getClass().getName()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "291537e063f9abe11168d59ad9b71e80126cb013"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38734b0008df027edbeb2b349153019ed3ad82e5", "author": {"user": {"login": "apurtell", "name": "Andrew Purtell"}}, "url": "https://github.com/apache/hbase/commit/38734b0008df027edbeb2b349153019ed3ad82e5", "committedDate": "2020-06-09T21:50:10Z", "message": "Add comments per review feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f201c47ebed3f0af75654c17ac3339cb8f9c55f7", "author": {"user": {"login": "apurtell", "name": "Andrew Purtell"}}, "url": "https://github.com/apache/hbase/commit/f201c47ebed3f0af75654c17ac3339cb8f9c55f7", "committedDate": "2020-06-09T21:53:00Z", "message": "Fix checkstyle nit"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NTc0OTAx", "url": "https://github.com/apache/hbase/pull/1879#pullrequestreview-427574901", "createdAt": "2020-06-09T21:58:22Z", "commit": {"oid": "f201c47ebed3f0af75654c17ac3339cb8f9c55f7"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMTo1ODoyMlrOGhd5Aw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMjowMzoxNVrOGheAuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc0NTkyMw==", "bodyText": "Ah, okay. I missed the AdminServerException exception from the signature, wfm to keep it as-is.", "url": "https://github.com/apache/hbase/pull/1879#discussion_r437745923", "createdAt": "2020-06-09T21:58:22Z", "author": {"login": "bharathv"}, "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/zookeeper/HQuorumPeer.java", "diffHunk": "@@ -85,14 +85,20 @@ public static void main(String[] args) {\n   }\n \n   private static void runZKServer(QuorumPeerConfig zkConfig) throws UnknownHostException, IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY4MTI1Mw=="}, "originalCommit": {"oid": "291537e063f9abe11168d59ad9b71e80126cb013"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc0Nzg5OQ==", "bodyText": "ZK 3.6 throws another type of checked exception, which causes a compilation error\n\nI didn't see it here [1], hence my question.  May be I missed something.\n[1] https://github.com/apache/zookeeper/blob/branch-3.6/zookeeper-server/src/main/java/org/apache/zookeeper/ZooKeeperMain.java#L380", "url": "https://github.com/apache/hbase/pull/1879#discussion_r437747899", "createdAt": "2020-06-09T22:03:15Z", "author": {"login": "bharathv"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperMainServer.java", "diffHunk": "@@ -66,8 +66,14 @@ public HACK_UNTIL_ZOOKEEPER_1897_ZooKeeperMain(String[] args)\n      * @throws IOException\n      * @throws InterruptedException\n      */\n-    void runCmdLine() throws KeeperException, IOException, InterruptedException {\n-      processCmd(this.cl);\n+    void runCmdLine() throws IOException, InterruptedException {\n+      try {\n+        processCmd(this.cl);\n+      } catch (IOException | InterruptedException e) {\n+        throw e;\n+      } catch (Exception e) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY4MzE1Mw=="}, "originalCommit": {"oid": "291537e063f9abe11168d59ad9b71e80126cb013"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NjkzOTE4", "url": "https://github.com/apache/hbase/pull/1879#pullrequestreview-427693918", "createdAt": "2020-06-10T03:58:06Z", "commit": {"oid": "f201c47ebed3f0af75654c17ac3339cb8f9c55f7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MjM4MTk3", "url": "https://github.com/apache/hbase/pull/1879#pullrequestreview-428238197", "createdAt": "2020-06-10T16:37:13Z", "commit": {"oid": "f201c47ebed3f0af75654c17ac3339cb8f9c55f7"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNjozNzoxM1rOGh9YZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNjozNzo0NVrOGh9ZsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI2MTg2Mg==", "bodyText": "Did our unit tests catch this one or you knew it already? I just want to know what preparation we should do while upgrading ZK or any other heavy dependency.", "url": "https://github.com/apache/hbase/pull/1879#discussion_r438261862", "createdAt": "2020-06-10T16:37:13Z", "author": {"login": "virajjasani"}, "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java", "diffHunk": "@@ -1811,9 +1811,10 @@ private static Op toZooKeeperOp(ZooKeeperWatcher zkw, ZKUtilOp op)\n    */\n   public static void multiOrSequential(ZooKeeperWatcher zkw, List<ZKUtilOp> ops,\n       boolean runSequentialOnMultiFailure) throws KeeperException {\n-    if (ops == null) return;\n+    if (ops == null || ops.isEmpty()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY0MzExNw=="}, "originalCommit": {"oid": "291537e063f9abe11168d59ad9b71e80126cb013"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI2MjE5Mw==", "bodyText": "Agree, no need of revision IMHO", "url": "https://github.com/apache/hbase/pull/1879#discussion_r438262193", "createdAt": "2020-06-10T16:37:45Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/jamon/org/apache/hadoop/hbase/tmpl/master/MasterStatusTmpl.jamon", "diffHunk": "@@ -294,7 +294,7 @@ AssignmentManager assignmentManager = master.getAssignmentManager();\n                 </tr>\n                 <tr>\n                     <td>ZooKeeper Client Version</td>\n-                    <td><% org.apache.zookeeper.Version.getVersion() %>, revision=<% org.apache.zookeeper.Version.getRevision() %></td>\n+                    <td><% org.apache.zookeeper.Version.getVersion() %></td>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY0MzM5Mw=="}, "originalCommit": {"oid": "291537e063f9abe11168d59ad9b71e80126cb013"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4582, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}