{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ0NzU4Njcz", "number": 2809, "title": "HBASE-25432:add security checks for setTableStateInMeta and fixMeta", "bodyText": "", "createdAt": "2020-12-23T12:45:59Z", "url": "https://github.com/apache/hbase/pull/2809", "merged": true, "mergeCommit": {"oid": "d963342f8a54877cb212618ba35d75a7d6c2005b"}, "closed": true, "closedAt": "2020-12-28T18:57:31Z", "author": {"login": "lujiefsi"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdo_TIHgFqTU1Nzg3MzE1Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdqSvRpgFqTU1ODkzNDYxNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3ODczMTU2", "url": "https://github.com/apache/hbase/pull/2809#pullrequestreview-557873156", "createdAt": "2020-12-23T13:39:07Z", "commit": {"oid": "07ce54afa1ce029b03d3ef28805161b6b21ff41e"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3ODc1MjM4", "url": "https://github.com/apache/hbase/pull/2809#pullrequestreview-557875238", "createdAt": "2020-12-23T13:43:02Z", "commit": {"oid": "07ce54afa1ce029b03d3ef28805161b6b21ff41e"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4ODQyMzUz", "url": "https://github.com/apache/hbase/pull/2809#pullrequestreview-558842353", "createdAt": "2020-12-26T01:13:25Z", "commit": {"oid": "2361c2b6e10f2b81d067e69062d04c5868dd5d3f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNlQwMToxMzoyNVrOILf8fQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNlQwMToxMzozNlrOILf8kQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODkyODYzNw==", "bodyText": "Please use try-with-resources to close the connection.", "url": "https://github.com/apache/hbase/pull/2809#discussion_r548928637", "createdAt": "2020-12-26T01:13:25Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/security/access/TestAccessController.java", "diffHunk": "@@ -379,6 +381,36 @@ public void testUnauthorizedStopMaster() throws Exception {\n         USER_GROUP_WRITE, USER_GROUP_CREATE);\n   }\n \n+  @Test\n+  public void testUnauthorizedSetTableStateInMeta() throws Exception {\n+    AccessTestAction action = new AccessTestAction() {\n+      @Override public Object run() throws Exception {\n+        Connection conn = ConnectionFactory.createConnection(TEST_UTIL.getConfiguration()) ;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2361c2b6e10f2b81d067e69062d04c5868dd5d3f"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODkyODY1Nw==", "bodyText": "Ditto.", "url": "https://github.com/apache/hbase/pull/2809#discussion_r548928657", "createdAt": "2020-12-26T01:13:36Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/security/access/TestAccessController.java", "diffHunk": "@@ -379,6 +381,36 @@ public void testUnauthorizedStopMaster() throws Exception {\n         USER_GROUP_WRITE, USER_GROUP_CREATE);\n   }\n \n+  @Test\n+  public void testUnauthorizedSetTableStateInMeta() throws Exception {\n+    AccessTestAction action = new AccessTestAction() {\n+      @Override public Object run() throws Exception {\n+        Connection conn = ConnectionFactory.createConnection(TEST_UTIL.getConfiguration()) ;\n+        Hbck hbck = conn.getHbck();\n+        hbck.setTableStateInMeta(new TableState(TEST_TABLE, TableState.State.DISABLED));\n+        return null;\n+      }\n+    };\n+\n+    verifyDenied(action, USER_CREATE, USER_OWNER, USER_RW, USER_RO, USER_NONE, USER_GROUP_READ,\n+        USER_GROUP_WRITE, USER_GROUP_CREATE);\n+  }\n+\n+  @Test\n+  public void testUnauthorizedFixMeta() throws Exception {\n+    AccessTestAction action = new AccessTestAction() {\n+      @Override public Object run() throws Exception {\n+        Connection conn = ConnectionFactory.createConnection(TEST_UTIL.getConfiguration()) ;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2361c2b6e10f2b81d067e69062d04c5868dd5d3f"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4ODQ4MzE4", "url": "https://github.com/apache/hbase/pull/2809#pullrequestreview-558848318", "createdAt": "2020-12-26T05:36:24Z", "commit": {"oid": "2361c2b6e10f2b81d067e69062d04c5868dd5d3f"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNlQwNTozNjoyNFrOILhCAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNlQwNTozNjo0NlrOILhCJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODk0NjQzMg==", "bodyText": "Let's use lambda here?\n    AccessTestAction action = () -> {\n...\n...\n...\n      return null;\n    };", "url": "https://github.com/apache/hbase/pull/2809#discussion_r548946432", "createdAt": "2020-12-26T05:36:24Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/security/access/TestAccessController.java", "diffHunk": "@@ -379,6 +381,36 @@ public void testUnauthorizedStopMaster() throws Exception {\n         USER_GROUP_WRITE, USER_GROUP_CREATE);\n   }\n \n+  @Test\n+  public void testUnauthorizedSetTableStateInMeta() throws Exception {\n+    AccessTestAction action = new AccessTestAction() {\n+      @Override public Object run() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2361c2b6e10f2b81d067e69062d04c5868dd5d3f"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODk0NjQ2OQ==", "bodyText": "Same here", "url": "https://github.com/apache/hbase/pull/2809#discussion_r548946469", "createdAt": "2020-12-26T05:36:46Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/security/access/TestAccessController.java", "diffHunk": "@@ -379,6 +381,36 @@ public void testUnauthorizedStopMaster() throws Exception {\n         USER_GROUP_WRITE, USER_GROUP_CREATE);\n   }\n \n+  @Test\n+  public void testUnauthorizedSetTableStateInMeta() throws Exception {\n+    AccessTestAction action = new AccessTestAction() {\n+      @Override public Object run() throws Exception {\n+        Connection conn = ConnectionFactory.createConnection(TEST_UTIL.getConfiguration()) ;\n+        Hbck hbck = conn.getHbck();\n+        hbck.setTableStateInMeta(new TableState(TEST_TABLE, TableState.State.DISABLED));\n+        return null;\n+      }\n+    };\n+\n+    verifyDenied(action, USER_CREATE, USER_OWNER, USER_RW, USER_RO, USER_NONE, USER_GROUP_READ,\n+        USER_GROUP_WRITE, USER_GROUP_CREATE);\n+  }\n+\n+  @Test\n+  public void testUnauthorizedFixMeta() throws Exception {\n+    AccessTestAction action = new AccessTestAction() {\n+      @Override public Object run() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2361c2b6e10f2b81d067e69062d04c5868dd5d3f"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8f3c8bc933824a41ad5632a85da9ce39db48b04", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/b8f3c8bc933824a41ad5632a85da9ce39db48b04", "committedDate": "2020-12-27T07:07:07Z", "message": "HBASE-25432:add security checks for setTableStateInMeta and fixMeta"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4OTM0Mjkx", "url": "https://github.com/apache/hbase/pull/2809#pullrequestreview-558934291", "createdAt": "2020-12-27T14:46:41Z", "commit": {"oid": "b8f3c8bc933824a41ad5632a85da9ce39db48b04"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4OTM0NjE3", "url": "https://github.com/apache/hbase/pull/2809#pullrequestreview-558934617", "createdAt": "2020-12-27T14:51:59Z", "commit": {"oid": "b8f3c8bc933824a41ad5632a85da9ce39db48b04"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4898, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}