{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5MDA1MTMw", "number": 2268, "title": "HBASE-24874 Fix hbase-shell access to ModifiableTableDescriptor methods", "bodyText": "Resolves https://issues.apache.org/jira/browse/HBASE-24874\nChangelog\n\nFix hbase-shell access in JDK 11 for calls to\nTableDescriptorBuilder.toCoprocessorDescriptor and\nModifiableTableDescriptor.toStringTableAttributes.\nAllow coprocessors to be specified using a Ruby hash in the hbase-shell alter\ncommand and replace usage in the help text. The previous String overload of\nthe alter command will continue to work and is still covered by a unit test,\nbut will no longer be suggested in the alter command help.", "createdAt": "2020-08-17T18:40:25Z", "url": "https://github.com/apache/hbase/pull/2268", "merged": true, "mergeCommit": {"oid": "6789aca9a07b8cb7d9f64e45f2031855a03aedb7"}, "closed": true, "closedAt": "2020-08-18T19:58:40Z", "author": {"login": "bitoffdev"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc_208mgH2gAyNDY5MDA1MTMwOjMyM2Q1OThlZDIxODRjYjE2Y2I2MDRlZTY1NDdjNTFiYzNhNjI1ZTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAHl2ngH2gAyNDY5MDA1MTMwOmU4MmZhNWI0ZmEwYTA1ZjkxMzE0NzIxYjIxOGFiZTk2MGFiZWNkOWE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "323d598ed2184cb16cb604ee6547c51bc3a625e8", "author": {"user": {"login": "bitoffdev", "name": "Elliot"}}, "url": "https://github.com/apache/hbase/commit/323d598ed2184cb16cb604ee6547c51bc3a625e8", "committedDate": "2020-08-17T18:36:01Z", "message": "HBASE-24874 Fix hbase-shell access to ModifiableTableDescriptor methods\n\n- Fix hbase-shell access in JDK 11 for calls to\n  TableDescriptorBuilder.toCoprocessorDescriptor and\n  ModifiableTableDescriptor.toStringTableAttributes.\n- Allow coprocessors to be specified using a Ruby hash in the hbase-shell alter\n  command and replace usage in the help text. The previous String overload of\n  the alter command will continue to work and is still covered by a unit test,\n  but will no longer be suggested in the alter command help."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4ODE5MDc5", "url": "https://github.com/apache/hbase/pull/2268#pullrequestreview-468819079", "createdAt": "2020-08-17T20:43:26Z", "commit": {"oid": "323d598ed2184cb16cb604ee6547c51bc3a625e8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QyMDo0MzoyNlrOHB6NWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QyMDo0MzoyNlrOHB6NWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc2NDMxMg==", "bodyText": "If you want to do this, please place a fat warning in the docs over on the TableDescriptorBuilder.toCoprocessorDescriptor method.", "url": "https://github.com/apache/hbase/pull/2268#discussion_r471764312", "createdAt": "2020-08-17T20:43:26Z", "author": {"login": "ndimiduk"}, "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "diffHunk": "@@ -664,6 +668,40 @@ def alter_status(table_name)\n       puts 'Done.'\n     end\n \n+    #----------------------------------------------------------------------------------------------\n+    # Use our internal logic to convert from \"spec string\" format to a coprocessor descriptor\n+    #\n+    # Provided for backwards shell compatibility\n+    #\n+    # @param [String] spec_str\n+    # @return [ColumnDescriptor]\n+    def coprocessor_descriptor_from_spec_str(spec_str)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "323d598ed2184cb16cb604ee6547c51bc3a625e8"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4ODE5NTUx", "url": "https://github.com/apache/hbase/pull/2268#pullrequestreview-468819551", "createdAt": "2020-08-17T20:44:11Z", "commit": {"oid": "323d598ed2184cb16cb604ee6547c51bc3a625e8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QyMDo0NDoxMVrOHB6OwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QyMDo0NDoxMVrOHB6OwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc2NDY3Mw==", "bodyText": "should these 'CLASSPATH', 'JAR_PATH', &c. be defined from hbase_constants.rb ?", "url": "https://github.com/apache/hbase/pull/2268#discussion_r471764673", "createdAt": "2020-08-17T20:44:11Z", "author": {"login": "ndimiduk"}, "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "diffHunk": "@@ -664,6 +668,40 @@ def alter_status(table_name)\n       puts 'Done.'\n     end\n \n+    #----------------------------------------------------------------------------------------------\n+    # Use our internal logic to convert from \"spec string\" format to a coprocessor descriptor\n+    #\n+    # Provided for backwards shell compatibility\n+    #\n+    # @param [String] spec_str\n+    # @return [ColumnDescriptor]\n+    def coprocessor_descriptor_from_spec_str(spec_str)\n+      method = TableDescriptorBuilder.java_class.declared_method_smart :toCoprocessorDescriptor\n+      method.accessible = true\n+      result = method.invoke(nil, spec_str).to_java\n+      # unpack java's Optional to be more rubonic\n+      return result.isPresent ? result.get : nil\n+    end\n+\n+    #----------------------------------------------------------------------------------------------\n+    # Use CoprocessorDescriptorBuilder to convert a Hash to CoprocessorDescriptor\n+    #\n+    # @param [Hash] spec column descriptor specification\n+    # @return [ColumnDescriptor]\n+    def coprocessor_descriptor_from_hash(spec)\n+      classname = spec['CLASSNAME']", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "323d598ed2184cb16cb604ee6547c51bc3a625e8"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4OTgzNzUx", "url": "https://github.com/apache/hbase/pull/2268#pullrequestreview-468983751", "createdAt": "2020-08-18T04:33:08Z", "commit": {"oid": "323d598ed2184cb16cb604ee6547c51bc3a625e8"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQwNDozMzowOFrOHCC9lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQwNDo1OTo0MFrOHCDYmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkwNzczNA==", "bodyText": "Do you want to say in comment why you are doing this access setting?", "url": "https://github.com/apache/hbase/pull/2268#discussion_r471907734", "createdAt": "2020-08-18T04:33:08Z", "author": {"login": "saintstack"}, "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "diffHunk": "@@ -587,7 +588,10 @@ def get_column_families(table_name)\n \n     def get_table_attributes(table_name)\n       tableExists(table_name)\n-      @admin.getDescriptor(TableName.valueOf(table_name)).toStringTableAttributes\n+      td = @admin.getDescriptor TableName.valueOf(table_name)\n+      method = td.java_class.declared_method :toStringTableAttributes\n+      method.accessible = true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "323d598ed2184cb16cb604ee6547c51bc3a625e8"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkxNDIxNQ==", "bodyText": "Its ok not checking for nil classname?", "url": "https://github.com/apache/hbase/pull/2268#discussion_r471914215", "createdAt": "2020-08-18T04:57:52Z", "author": {"login": "saintstack"}, "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "diffHunk": "@@ -664,6 +668,40 @@ def alter_status(table_name)\n       puts 'Done.'\n     end\n \n+    #----------------------------------------------------------------------------------------------\n+    # Use our internal logic to convert from \"spec string\" format to a coprocessor descriptor\n+    #\n+    # Provided for backwards shell compatibility\n+    #\n+    # @param [String] spec_str\n+    # @return [ColumnDescriptor]\n+    def coprocessor_descriptor_from_spec_str(spec_str)\n+      method = TableDescriptorBuilder.java_class.declared_method_smart :toCoprocessorDescriptor\n+      method.accessible = true\n+      result = method.invoke(nil, spec_str).to_java\n+      # unpack java's Optional to be more rubonic\n+      return result.isPresent ? result.get : nil\n+    end\n+\n+    #----------------------------------------------------------------------------------------------\n+    # Use CoprocessorDescriptorBuilder to convert a Hash to CoprocessorDescriptor\n+    #\n+    # @param [Hash] spec column descriptor specification\n+    # @return [ColumnDescriptor]\n+    def coprocessor_descriptor_from_hash(spec)\n+      classname = spec['CLASSNAME']\n+      jar_path = spec['JAR_PATH']\n+      priority = spec['PRIORITY']\n+      properties = spec['PROPERTIES']\n+\n+      builder = CoprocessorDescriptorBuilder.newBuilder classname", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "323d598ed2184cb16cb604ee6547c51bc3a625e8"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkxNDY1MQ==", "bodyText": "nice", "url": "https://github.com/apache/hbase/pull/2268#discussion_r471914651", "createdAt": "2020-08-18T04:59:40Z", "author": {"login": "saintstack"}, "path": "hbase-shell/src/main/ruby/shell/commands/alter.rb", "diffHunk": "@@ -53,19 +53,19 @@ def help\n \n   hbase> alter 't1', MAX_FILESIZE => '134217728'\n \n-You can add a table coprocessor by setting a table coprocessor attribute:\n+You can add a table coprocessor by setting a table coprocessor attribute. Only the CLASSNAME is\n+required in the coprocessor specification.\n \n-  hbase> alter 't1',\n-    'coprocessor'=>'hdfs:///foo.jar|com.foo.FooRegionObserver|1001|arg1=1,arg2=2'\n+  hbase> alter 't1', 'coprocessor' => {\n+           'CLASSNAME' => 'org.apache.hadoop.hbase.coprocessor.SimpleRegionObserver',\n+           'JAR_PATH' => 'hdfs:///foo.jar'\n+           'PRIORITY' => 12,\n+           'PROPERTIES' => {'a' => '17' }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "323d598ed2184cb16cb604ee6547c51bc3a625e8"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0b68b727178e34f76268ca93f19e8fc0c0e755b", "author": {"user": {"login": "bitoffdev", "name": "Elliot"}}, "url": "https://github.com/apache/hbase/commit/b0b68b727178e34f76268ca93f19e8fc0c0e755b", "committedDate": "2020-08-18T13:55:38Z", "message": "Update patch\n\n- Add warning over toCoprocessorDescriptor noting the usage by hbase-shell\n- Add constants to hbase_constants for coprocessor specification\n- Document usage of ModifiableTableDescriptor.toStringTableAttributes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e82fa5b4fa0a05f91314721b218abe960abecd9a", "author": {"user": {"login": "bitoffdev", "name": "Elliot"}}, "url": "https://github.com/apache/hbase/commit/e82fa5b4fa0a05f91314721b218abe960abecd9a", "committedDate": "2020-08-18T14:07:55Z", "message": "Convert comment over toCoprocessorDescriptor into docstring"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4892, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}