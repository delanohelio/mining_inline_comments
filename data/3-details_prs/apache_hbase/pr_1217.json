{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwODg2MTY4", "number": 1217, "title": "HBASE-23891: Add an option to Actions to filter out meta RS", "bodyText": "make skipping or killing meta RegionServer cofigurable for new actions", "createdAt": "2020-02-27T14:30:46Z", "url": "https://github.com/apache/hbase/pull/1217", "merged": true, "mergeCommit": {"oid": "4cb60327be29a4d1b46f4969186a3136726cb557"}, "closed": true, "closedAt": "2020-03-06T10:44:40Z", "author": {"login": "BukrosSzabolcs"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIcLC8gH2gAyMzgwODg2MTY4OjQ2NDVkYjRlYjFhNzExN2I5MTdlMjY4ZjJjZDNkNmZjNmNhMWJhNDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcK9w61AFqTM3MDIzMTQxOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4645db4eb1a7117b917e268f2cd3d6fc6ca1ba41", "author": {"user": {"login": "BukrosSzabolcs", "name": null}}, "url": "https://github.com/apache/hbase/commit/4645db4eb1a7117b917e268f2cd3d6fc6ca1ba41", "committedDate": "2020-02-27T14:26:53Z", "message": "HBASE-23891: Add an option to Actions to filter out meta RS\n\nmake skipping or killing meta RegionServer cofigurable for new actions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d3797f37422037754ed4a949e06d44d28625ed84", "author": {"user": {"login": "BukrosSzabolcs", "name": null}}, "url": "https://github.com/apache/hbase/commit/d3797f37422037754ed4a949e06d44d28625ed84", "committedDate": "2020-02-27T14:13:34Z", "message": "HBASE-23891: Add an option to Actions to filter out meta RS\n\nmake skipping or killing meta RegionServer cofigurable for new actions"}, "afterCommit": {"oid": "4645db4eb1a7117b917e268f2cd3d6fc6ca1ba41", "author": {"user": {"login": "BukrosSzabolcs", "name": null}}, "url": "https://github.com/apache/hbase/commit/4645db4eb1a7117b917e268f2cd3d6fc6ca1ba41", "committedDate": "2020-02-27T14:26:53Z", "message": "HBASE-23891: Add an option to Actions to filter out meta RS\n\nmake skipping or killing meta RegionServer cofigurable for new actions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2MzQzMTQ2", "url": "https://github.com/apache/hbase/pull/1217#pullrequestreview-366343146", "createdAt": "2020-02-28T11:50:09Z", "commit": {"oid": "4645db4eb1a7117b917e268f2cd3d6fc6ca1ba41"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxMTo1MDowOVrOFvyd9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxMTo1NTozNFrOFvyl9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY1NDI2Mw==", "bodyText": "Could we move this to Action class, in order to avoid repeating it on different Action implementations? Just noticed we duplicate this in RollingBatchSuspendResumeRsAction.java.", "url": "https://github.com/apache/hbase/pull/1217#discussion_r385654263", "createdAt": "2020-02-28T11:50:09Z", "author": {"login": "wchevreuil"}, "path": "hbase-it/src/test/java/org/apache/hadoop/hbase/chaos/actions/GracefulRollingRestartRsAction.java", "diffHunk": "@@ -35,15 +35,23 @@\n public class GracefulRollingRestartRsAction extends RestartActionBaseAction {\n   private static final Logger LOG = LoggerFactory.getLogger(GracefulRollingRestartRsAction.class);\n \n-  public GracefulRollingRestartRsAction(long sleepTime) {\n+  private boolean killMetaRs;\n+\n+  public GracefulRollingRestartRsAction(long sleepTime, boolean killMetaRs) {\n     super(sleepTime);\n+    this.killMetaRs = killMetaRs;\n   }\n \n   @Override\n   public void perform() throws Exception {\n     LOG.info(\"Performing action: Rolling restarting non-master region servers\");\n     List<ServerName> selectedServers = selectServers();\n \n+    if(!killMetaRs){\n+      ServerName metaServer = cluster.getServerHoldingMeta();\n+      selectedServers.remove(metaServer);\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4645db4eb1a7117b917e268f2cd3d6fc6ca1ba41"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY1NDM2Ng==", "bodyText": "See previous comment above.", "url": "https://github.com/apache/hbase/pull/1217#discussion_r385654366", "createdAt": "2020-02-28T11:50:25Z", "author": {"login": "wchevreuil"}, "path": "hbase-it/src/test/java/org/apache/hadoop/hbase/chaos/actions/RollingBatchSuspendResumeRsAction.java", "diffHunk": "@@ -64,6 +67,11 @@ public void perform() throws Exception {\n         (int) (ratio * 100)));\n     List<ServerName> selectedServers = selectServers();\n \n+    if(!killMetaRs){\n+      ServerName metaServer = cluster.getServerHoldingMeta();\n+      selectedServers.remove(metaServer);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4645db4eb1a7117b917e268f2cd3d6fc6ca1ba41"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY1NjA5OA==", "bodyText": "Similar suggestion as done for the Actions. Can we move this to a common method in the parent class to avoid code repetition?", "url": "https://github.com/apache/hbase/pull/1217#discussion_r385656098", "createdAt": "2020-02-28T11:55:01Z", "author": {"login": "wchevreuil"}, "path": "hbase-it/src/test/java/org/apache/hadoop/hbase/chaos/factories/ServerAndDependenciesKillingMonkeyFactory.java", "diffHunk": "@@ -83,5 +84,8 @@ private void loadProperties() {\n     rollingBatchSuspendtRSRatio = Float.parseFloat(this.properties.getProperty(\n         MonkeyConstants.ROLLING_BATCH_SUSPEND_RS_RATIO,\n         MonkeyConstants.DEFAULT_ROLLING_BATCH_SUSPEND_RS_RATIO + \"\"));\n+    killMetaRs = Boolean.parseBoolean(this.properties.getProperty(\n+      MonkeyConstants.KILL_META_RS,\n+      MonkeyConstants.DEFAULT_KILL_META_RS + \"\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4645db4eb1a7117b917e268f2cd3d6fc6ca1ba41"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY1NjIwNQ==", "bodyText": "See previous comment.", "url": "https://github.com/apache/hbase/pull/1217#discussion_r385656205", "createdAt": "2020-02-28T11:55:18Z", "author": {"login": "wchevreuil"}, "path": "hbase-it/src/test/java/org/apache/hadoop/hbase/chaos/factories/ServerKillingMonkeyFactory.java", "diffHunk": "@@ -79,5 +80,8 @@ private void loadProperties() {\n     rollingBatchSuspendtRSRatio = Float.parseFloat(this.properties.getProperty(\n         MonkeyConstants.ROLLING_BATCH_SUSPEND_RS_RATIO,\n         MonkeyConstants.DEFAULT_ROLLING_BATCH_SUSPEND_RS_RATIO + \"\"));\n+    killMetaRs = Boolean.parseBoolean(this.properties.getProperty(\n+      MonkeyConstants.KILL_META_RS,\n+      MonkeyConstants.DEFAULT_KILL_META_RS + \"\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4645db4eb1a7117b917e268f2cd3d6fc6ca1ba41"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY1NjMwOQ==", "bodyText": "See previous comment.", "url": "https://github.com/apache/hbase/pull/1217#discussion_r385656309", "createdAt": "2020-02-28T11:55:34Z", "author": {"login": "wchevreuil"}, "path": "hbase-it/src/test/java/org/apache/hadoop/hbase/chaos/factories/StressAssignmentManagerMonkeyFactory.java", "diffHunk": "@@ -110,5 +111,8 @@ private void loadProperties() {\n     rollingBatchSuspendtRSRatio = Float.parseFloat(this.properties.getProperty(\n         MonkeyConstants.ROLLING_BATCH_SUSPEND_RS_RATIO,\n         MonkeyConstants.DEFAULT_ROLLING_BATCH_SUSPEND_RS_RATIO + \"\"));\n+    killMetaRs = Boolean.parseBoolean(this.properties.getProperty(\n+      MonkeyConstants.KILL_META_RS,\n+      MonkeyConstants.DEFAULT_KILL_META_RS + \"\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4645db4eb1a7117b917e268f2cd3d6fc6ca1ba41"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3dca98d355e6997c5b654177a79fa60ede923b3", "author": {"user": {"login": "BukrosSzabolcs", "name": null}}, "url": "https://github.com/apache/hbase/commit/f3dca98d355e6997c5b654177a79fa60ede923b3", "committedDate": "2020-03-05T14:06:06Z", "message": "HBASE-23891: Add an option to Actions to filter out meta RS\n\nRevert prev changes\nRework skipMetaRS into a generic solution that can remove the meta\nregion server from any server list independently of the action if\nrequired\nChange config handling to allow monkeyProps usage in Actions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b40fa8b026b81fc8f8622ba7902566c3ab4eead", "author": {"user": {"login": "BukrosSzabolcs", "name": null}}, "url": "https://github.com/apache/hbase/commit/3b40fa8b026b81fc8f8622ba7902566c3ab4eead", "committedDate": "2020-03-05T15:38:48Z", "message": "HBASE-23891: Add an option to Actions to filter out meta RS\n\ncheckstyle fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NjY0NzA4", "url": "https://github.com/apache/hbase/pull/1217#pullrequestreview-369664708", "createdAt": "2020-03-05T15:26:44Z", "commit": {"oid": "f3dca98d355e6997c5b654177a79fa60ede923b3"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNToyNjo0NFrOFyYCXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNTo1NTowNlrOFyZOPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM2Njk0MQ==", "bodyText": "nit: If we just overload the constructor on PolicyBasedChaosMonkey, then we don't need this extra change just to pass a null reference.", "url": "https://github.com/apache/hbase/pull/1217#discussion_r388366941", "createdAt": "2020-03-05T15:26:44Z", "author": {"login": "wchevreuil"}, "path": "hbase-it/src/test/java/org/apache/hadoop/hbase/IntegrationTestBackupRestore.java", "diffHunk": "@@ -139,7 +139,7 @@ public void tearDown() throws IOException {\n   public void setUpMonkey() throws Exception {\n     Policy p = new PeriodicRandomActionPolicy(sleepTime,\n       new RestartRandomRsExceptMetaAction(sleepTime));\n-    this.monkey = new PolicyBasedChaosMonkey(util, p);\n+    this.monkey = new PolicyBasedChaosMonkey(null, util, p);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3dca98d355e6997c5b654177a79fa60ede923b3"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM2NzIwNw==", "bodyText": "See previous comment.", "url": "https://github.com/apache/hbase/pull/1217#discussion_r388367207", "createdAt": "2020-03-05T15:27:11Z", "author": {"login": "wchevreuil"}, "path": "hbase-it/src/test/java/org/apache/hadoop/hbase/IntegrationTestRegionReplicaPerf.java", "diffHunk": "@@ -195,7 +195,7 @@ public void setUpMonkey() throws Exception {\n     Policy p = new PeriodicRandomActionPolicy(sleepTime,\n       new RestartRandomRsExceptMetaAction(sleepTime),\n       new MoveRandomRegionOfTableAction(tableName));\n-    this.monkey = new PolicyBasedChaosMonkey(util, p);\n+    this.monkey = new PolicyBasedChaosMonkey(null, util, p);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3dca98d355e6997c5b654177a79fa60ede923b3"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM4NjM2NQ==", "bodyText": "Do we really need to specify extra properties when creating policy for all these factories? Otherwise, if this is just duo to the change in PolicyBasedChaosMonkey constructor, it would benefit from overloading the constructor there.", "url": "https://github.com/apache/hbase/pull/1217#discussion_r388386365", "createdAt": "2020-03-05T15:55:06Z", "author": {"login": "wchevreuil"}, "path": "hbase-it/src/test/java/org/apache/hadoop/hbase/chaos/factories/MobNoKillMonkeyFactory.java", "diffHunk": "@@ -75,7 +75,7 @@\n \n     Action[] actions4 = new Action[] { new DumpClusterStatusAction() };\n \n-    return new PolicyBasedChaosMonkey(util,\n+    return new PolicyBasedChaosMonkey(properties, util,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3dca98d355e6997c5b654177a79fa60ede923b3"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddd39981b29baca832dfd1dd14be9338369412fc", "author": {"user": {"login": "BukrosSzabolcs", "name": null}}, "url": "https://github.com/apache/hbase/commit/ddd39981b29baca832dfd1dd14be9338369412fc", "committedDate": "2020-03-06T10:23:12Z", "message": "HBASE-23891: Add an option to Actions to filter out meta RS\n\noverload the constructor to minimize changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMjMxNDE4", "url": "https://github.com/apache/hbase/pull/1217#pullrequestreview-370231418", "createdAt": "2020-03-06T10:42:58Z", "commit": {"oid": "ddd39981b29baca832dfd1dd14be9338369412fc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2875, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}