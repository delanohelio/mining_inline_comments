{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5NDM1MDgx", "number": 991, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQwODoyOTozM1rODV6Y7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QwMzozMTozMVrODWJODQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0MzAzMzQyOnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQwODoyOTozM1rOFaXy4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QwNjoyMjoxNVrOFawu0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzE5NzE1NA==", "bodyText": "ok so by disabling throttling what we mean is providing negative int value for hbase.balancer.max.balancing in master site config", "url": "https://github.com/apache/hbase/pull/991#discussion_r363197154", "createdAt": "2020-01-06T08:29:33Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java", "diffHunk": "@@ -1860,11 +1856,14 @@ public boolean balance(boolean force) throws IOException {\n         //rpCount records balance plans processed, does not care if a plan succeeds\n         rpCount++;\n \n-        balanceThrottling(balanceStartTime + rpCount * balanceInterval, maxRegionsInTransition,\n+        if (this.maxBlancingTime > 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "198f06d2e69f1b28a42775cae2d244f20c2a6fac"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzIwMTcxOQ==", "bodyText": "Yes.", "url": "https://github.com/apache/hbase/pull/991#discussion_r363201719", "createdAt": "2020-01-06T08:45:09Z", "author": {"login": "binlijin"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java", "diffHunk": "@@ -1860,11 +1856,14 @@ public boolean balance(boolean force) throws IOException {\n         //rpCount records balance plans processed, does not care if a plan succeeds\n         rpCount++;\n \n-        balanceThrottling(balanceStartTime + rpCount * balanceInterval, maxRegionsInTransition,\n+        if (this.maxBlancingTime > 0) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzE5NzE1NA=="}, "originalCommit": {"oid": "198f06d2e69f1b28a42775cae2d244f20c2a6fac"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzU3OTM5Mg==", "bodyText": "So you will change this maxBlancingTime dynamically at HM config?\nIf permanently for the cluster the throttling needs disabled, hbase.master.balancer.maxRitPercent can be 100% right (which is the def value).  What am missing here? I did not read this part of code fully though", "url": "https://github.com/apache/hbase/pull/991#discussion_r363579392", "createdAt": "2020-01-07T03:34:27Z", "author": {"login": "anoopsjohn"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java", "diffHunk": "@@ -1860,11 +1856,14 @@ public boolean balance(boolean force) throws IOException {\n         //rpCount records balance plans processed, does not care if a plan succeeds\n         rpCount++;\n \n-        balanceThrottling(balanceStartTime + rpCount * balanceInterval, maxRegionsInTransition,\n+        if (this.maxBlancingTime > 0) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzE5NzE1NA=="}, "originalCommit": {"oid": "198f06d2e69f1b28a42775cae2d244f20c2a6fac"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYwNTcxNQ==", "bodyText": "No this do not change maxBlancingTime dynamically, It just skip the balanceThrottling when maxBlancingTime<=0.", "url": "https://github.com/apache/hbase/pull/991#discussion_r363605715", "createdAt": "2020-01-07T06:22:15Z", "author": {"login": "binlijin"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java", "diffHunk": "@@ -1860,11 +1856,14 @@ public boolean balance(boolean force) throws IOException {\n         //rpCount records balance plans processed, does not care if a plan succeeds\n         rpCount++;\n \n-        balanceThrottling(balanceStartTime + rpCount * balanceInterval, maxRegionsInTransition,\n+        if (this.maxBlancingTime > 0) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzE5NzE1NA=="}, "originalCommit": {"oid": "198f06d2e69f1b28a42775cae2d244f20c2a6fac"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0NTQ2MzE3OnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QwMzozMTozMVrOFavGXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QwNjoxMDowOFrOFawlQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzU3ODk3NQ==", "bodyText": "This change is wrong right?  We no longer check any configured value for HBASE_BALANCER_PERIOD.\nU wanted it like\nmaxBalancingTime = getConfiguration().getInt(HConstants.HBASE_BALANCER_MAX_BALANCING,  getConfiguration().getInt(HConstants.HBASE_BALANCER_PERIOD,\nHConstants.DEFAULT_HBASE_BALANCER_PERIOD);", "url": "https://github.com/apache/hbase/pull/991#discussion_r363578975", "createdAt": "2020-01-07T03:31:31Z", "author": {"login": "anoopsjohn"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java", "diffHunk": "@@ -1688,12 +1688,8 @@ InetAddress getRemoteInetAddress(final int port,\n    * @return Maximum time we should run balancer for\n    */\n   private int getMaxBalancingTime() {\n-    int maxBalancingTime = getConfiguration().getInt(HConstants.HBASE_BALANCER_MAX_BALANCING, -1);\n-    if (maxBalancingTime == -1) {\n-      // if max balancing time isn't set, defaulting it to period time\n-      maxBalancingTime = getConfiguration().getInt(HConstants.HBASE_BALANCER_PERIOD,\n-        HConstants.DEFAULT_HBASE_BALANCER_PERIOD);\n-    }\n+    int maxBalancingTime = getConfiguration()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "198f06d2e69f1b28a42775cae2d244f20c2a6fac"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYwMzI2NA==", "bodyText": "Yes, you are right.", "url": "https://github.com/apache/hbase/pull/991#discussion_r363603264", "createdAt": "2020-01-07T06:10:08Z", "author": {"login": "binlijin"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java", "diffHunk": "@@ -1688,12 +1688,8 @@ InetAddress getRemoteInetAddress(final int port,\n    * @return Maximum time we should run balancer for\n    */\n   private int getMaxBalancingTime() {\n-    int maxBalancingTime = getConfiguration().getInt(HConstants.HBASE_BALANCER_MAX_BALANCING, -1);\n-    if (maxBalancingTime == -1) {\n-      // if max balancing time isn't set, defaulting it to period time\n-      maxBalancingTime = getConfiguration().getInt(HConstants.HBASE_BALANCER_PERIOD,\n-        HConstants.DEFAULT_HBASE_BALANCER_PERIOD);\n-    }\n+    int maxBalancingTime = getConfiguration()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzU3ODk3NQ=="}, "originalCommit": {"oid": "198f06d2e69f1b28a42775cae2d244f20c2a6fac"}, "originalPosition": 10}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2211, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}