{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzMjUxNTIw", "number": 1511, "title": "HBASE-24139 : Balancer should avoid leaving idle region servers", "bodyText": "Balancer should avoid leaving idle region servers", "createdAt": "2020-04-14T15:21:39Z", "url": "https://github.com/apache/hbase/pull/1511", "merged": true, "mergeCommit": {"oid": "5f45c8293d45aa67d8dc26a34d3012b55e3b7c3e"}, "closed": true, "closedAt": "2020-04-22T04:21:54Z", "author": {"login": "bea0113"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXjep3AH2gAyNDAzMjUxNTIwOmJlNzQ2NjkyY2UzM2FkMWU2NTVkN2M4OTg3MTdiMGM4NGE3YTRjMzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZ4YcHAFqTM5NzU4NjU2MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "be746692ce33ad1e655d7c898717b0c84a7a4c34", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/be746692ce33ad1e655d7c898717b0c84a7a4c34", "committedDate": "2020-04-14T13:26:30Z", "message": "first try at HBASE-24139"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9792db7c8aee0c7246f970971d9b58aadc822462", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/9792db7c8aee0c7246f970971d9b58aadc822462", "committedDate": "2020-04-14T14:54:13Z", "message": "second try"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMTEwNDkz", "url": "https://github.com/apache/hbase/pull/1511#pullrequestreview-393110493", "createdAt": "2020-04-14T16:45:27Z", "commit": {"oid": "9792db7c8aee0c7246f970971d9b58aadc822462"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNjo0NToyOFrOGFXpWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNjo0NjoyMFrOGFXrdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODI4MzQ4MA==", "bodyText": "How about putting this method in BaseLoadBalancer as protected final ?", "url": "https://github.com/apache/hbase/pull/1511#discussion_r408283480", "createdAt": "2020-04-14T16:45:28Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java", "diffHunk": "@@ -310,6 +310,19 @@ protected synchronized boolean areSomeRegionReplicasColocated(Cluster c) {\n     return false;\n   }\n \n+  private synchronized boolean areThereIdleRegions(Cluster c){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9792db7c8aee0c7246f970971d9b58aadc822462"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODI4NDAyMA==", "bodyText": "Also, idleRegionsExist() might be better name", "url": "https://github.com/apache/hbase/pull/1511#discussion_r408284020", "createdAt": "2020-04-14T16:46:20Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java", "diffHunk": "@@ -310,6 +310,19 @@ protected synchronized boolean areSomeRegionReplicasColocated(Cluster c) {\n     return false;\n   }\n \n+  private synchronized boolean areThereIdleRegions(Cluster c){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODI4MzQ4MA=="}, "originalCommit": {"oid": "9792db7c8aee0c7246f970971d9b58aadc822462"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNDk1MzA4", "url": "https://github.com/apache/hbase/pull/1511#pullrequestreview-393495308", "createdAt": "2020-04-15T06:45:50Z", "commit": {"oid": "9792db7c8aee0c7246f970971d9b58aadc822462"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNjo0NTo1MFrOGFr5NQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNjo0OTo1N1rOGFsANQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYxNTIyMQ==", "bodyText": "Here it checks the status of RS.  The name areThereIdleRegions not making good meaning", "url": "https://github.com/apache/hbase/pull/1511#discussion_r408615221", "createdAt": "2020-04-15T06:45:50Z", "author": {"login": "anoopsjohn"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java", "diffHunk": "@@ -310,6 +310,19 @@ protected synchronized boolean areSomeRegionReplicasColocated(Cluster c) {\n     return false;\n   }\n \n+  private synchronized boolean areThereIdleRegions(Cluster c){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODI4MzQ4MA=="}, "originalCommit": {"oid": "9792db7c8aee0c7246f970971d9b58aadc822462"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYxNzAxMw==", "bodyText": "This is iterating over many data structures and complex. Why cant we just iterate over the regionsPerServer data structure alone and populate the booleans as needed?", "url": "https://github.com/apache/hbase/pull/1511#discussion_r408617013", "createdAt": "2020-04-15T06:49:57Z", "author": {"login": "anoopsjohn"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java", "diffHunk": "@@ -310,6 +310,19 @@ protected synchronized boolean areSomeRegionReplicasColocated(Cluster c) {\n     return false;\n   }\n \n+  private synchronized boolean areThereIdleRegions(Cluster c){\n+    boolean isServerExistsWithMoreRegions=false;\n+    boolean isServerExistsWithZeroRegions=false;\n+    for (ServerName server:c.servers){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9792db7c8aee0c7246f970971d9b58aadc822462"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0676cb7452ec22a2eba8e94581daf263d955d99b", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/0676cb7452ec22a2eba8e94581daf263d955d99b", "committedDate": "2020-04-15T07:36:36Z", "message": "addressing comments on PR"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0MDU5MDA2", "url": "https://github.com/apache/hbase/pull/1511#pullrequestreview-394059006", "createdAt": "2020-04-15T19:10:18Z", "commit": {"oid": "0676cb7452ec22a2eba8e94581daf263d955d99b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxOToxMDoxOFrOGGHy0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxOToxMDoxOFrOGGHy0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA3MjMzOA==", "bodyText": "please use {} around the body of if blocks.", "url": "https://github.com/apache/hbase/pull/1511#discussion_r409072338", "createdAt": "2020-04-15T19:10:18Z", "author": {"login": "busbey"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java", "diffHunk": "@@ -310,6 +310,18 @@ protected synchronized boolean areSomeRegionReplicasColocated(Cluster c) {\n     return false;\n   }\n \n+  protected final synchronized boolean idleRegionExist(Cluster c){\n+    boolean isServerExistsWithMoreRegions = false;\n+    boolean isServerExistsWithZeroRegions = false;\n+    for (int[] serverList: c.regionsPerServer){\n+      if (serverList.length > 1)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0676cb7452ec22a2eba8e94581daf263d955d99b"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "181015d5793362acbfd4a134c6653d032ed2e902", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/181015d5793362acbfd4a134c6653d032ed2e902", "committedDate": "2020-04-16T13:43:44Z", "message": "Addressing PR comments 2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ab34695307087966bd4e6c14b1c2adf69c86f0a", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/2ab34695307087966bd4e6c14b1c2adf69c86f0a", "committedDate": "2020-04-16T13:51:00Z", "message": "modified unit test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NzI2NjY4", "url": "https://github.com/apache/hbase/pull/1511#pullrequestreview-394726668", "createdAt": "2020-04-16T15:04:04Z", "commit": {"oid": "2ab34695307087966bd4e6c14b1c2adf69c86f0a"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNTowNDowNFrOGGp1vQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNTowNTo1MFrOGGp60g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTYzMDE0MQ==", "bodyText": "please use { } for the statement.", "url": "https://github.com/apache/hbase/pull/1511#discussion_r409630141", "createdAt": "2020-04-16T15:04:04Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/BaseLoadBalancer.java", "diffHunk": "@@ -1192,6 +1192,8 @@ protected boolean needsBalance(TableName tableName, Cluster c) {\n       return false;\n     }\n     if(areSomeRegionReplicasColocated(c)) return true;\n+    if(idleRegionExist(c)) return true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ab34695307087966bd4e6c14b1c2adf69c86f0a"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTYzMDg2OQ==", "bodyText": "nit: this can be serverList.length == 0", "url": "https://github.com/apache/hbase/pull/1511#discussion_r409630869", "createdAt": "2020-04-16T15:05:01Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/BaseLoadBalancer.java", "diffHunk": "@@ -1223,6 +1225,20 @@ protected boolean areSomeRegionReplicasColocated(Cluster c) {\n     return false;\n   }\n \n+  protected final synchronized boolean idleRegionExist(Cluster c){\n+    boolean isServerExistsWithMoreRegions = false;\n+    boolean isServerExistsWithZeroRegions = false;\n+    for (int[] serverList: c.regionsPerServer){\n+      if (serverList.length > 1) {\n+        isServerExistsWithMoreRegions = true;\n+      }\n+      if (serverList.length < 1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ab34695307087966bd4e6c14b1c2adf69c86f0a"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTYzMTQ0Mg==", "bodyText": "please remove these extra lines", "url": "https://github.com/apache/hbase/pull/1511#discussion_r409631442", "createdAt": "2020-04-16T15:05:50Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java", "diffHunk": "@@ -310,6 +310,8 @@ protected synchronized boolean areSomeRegionReplicasColocated(Cluster c) {\n     return false;\n   }\n \n+\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ab34695307087966bd4e6c14b1c2adf69c86f0a"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c17130127ea23e22382198908b0760b3b372101", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/7c17130127ea23e22382198908b0760b3b372101", "committedDate": "2020-04-16T17:13:31Z", "message": "fixing nits"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0ODgzMjQx", "url": "https://github.com/apache/hbase/pull/1511#pullrequestreview-394883241", "createdAt": "2020-04-16T18:13:17Z", "commit": {"oid": "7c17130127ea23e22382198908b0760b3b372101"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxODoxMzoxN1rOGGxdRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxODoxMzoxN1rOGGxdRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc1NDk0OQ==", "bodyText": "idleRegionExist => idleRegionServerExist would be a better fit since we are checking if any RS is idle (without regions).", "url": "https://github.com/apache/hbase/pull/1511#discussion_r409754949", "createdAt": "2020-04-16T18:13:17Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/BaseLoadBalancer.java", "diffHunk": "@@ -1223,6 +1227,20 @@ protected boolean areSomeRegionReplicasColocated(Cluster c) {\n     return false;\n   }\n \n+  protected final synchronized boolean idleRegionExist(Cluster c){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c17130127ea23e22382198908b0760b3b372101"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0OTMxMzM2", "url": "https://github.com/apache/hbase/pull/1511#pullrequestreview-394931336", "createdAt": "2020-04-16T19:21:27Z", "commit": {"oid": "7c17130127ea23e22382198908b0760b3b372101"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxOToyMToyN1rOGGz0bA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxOToyMToyN1rOGGz0bA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc5MzY0NA==", "bodyText": "why is this synchronized?", "url": "https://github.com/apache/hbase/pull/1511#discussion_r409793644", "createdAt": "2020-04-16T19:21:27Z", "author": {"login": "busbey"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/BaseLoadBalancer.java", "diffHunk": "@@ -1223,6 +1227,20 @@ protected boolean areSomeRegionReplicasColocated(Cluster c) {\n     return false;\n   }\n \n+  protected final synchronized boolean idleRegionExist(Cluster c){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c17130127ea23e22382198908b0760b3b372101"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b764536c35e857cd1ea636ce224e71ce3988d8c6", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/b764536c35e857cd1ea636ce224e71ce3988d8c6", "committedDate": "2020-04-20T07:00:29Z", "message": "fixes addressing the comments on PR"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NTM4OTk3", "url": "https://github.com/apache/hbase/pull/1511#pullrequestreview-397538997", "createdAt": "2020-04-21T17:51:42Z", "commit": {"oid": "b764536c35e857cd1ea636ce224e71ce3988d8c6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NTg2NTYw", "url": "https://github.com/apache/hbase/pull/1511#pullrequestreview-397586560", "createdAt": "2020-04-21T18:55:34Z", "commit": {"oid": "b764536c35e857cd1ea636ce224e71ce3988d8c6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2443, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}