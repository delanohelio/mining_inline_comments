{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwMDMwNTY3", "number": 1737, "title": "HBASE-24382 Flush partial stores of region filtered by seqId when arc\u2026", "bodyText": "\u2026hive wal due to too many wals", "createdAt": "2020-05-19T10:37:31Z", "url": "https://github.com/apache/hbase/pull/1737", "merged": true, "mergeCommit": {"oid": "c0461207eec122103067527d3dd5090741141a0c"}, "closed": true, "closedAt": "2020-06-26T05:03:19Z", "author": {"login": "bsglz"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjT30mAFqTQxNTgzMDMwNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcu8BU0gFqTQzODAxMzQzNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1ODMwMzA0", "url": "https://github.com/apache/hbase/pull/1737#pullrequestreview-415830304", "createdAt": "2020-05-21T02:00:45Z", "commit": {"oid": "b8b0e46c7ae8aa73df09491b10bd55acd9b1a2be"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQwMjowMDo0NVrOGYju7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQwMjowMDo0NVrOGYju7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQwNDQ2Mg==", "bodyText": "If we want to use contains then we better use a Set instead of a List?", "url": "https://github.com/apache/hbase/pull/1737#discussion_r428404462", "createdAt": "2020-05-21T02:00:45Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "diffHunk": "@@ -2444,8 +2451,16 @@ public FlushResultImpl flushcache(boolean forceFlushAllStores, boolean writeFlus\n       }\n \n       try {\n-        Collection<HStore> specificStoresToFlush =\n+        Collection<HStore> specificStoresToFlush = null;\n+        if (!forceFlushAllStores && families != null) {\n+          specificStoresToFlush = stores.entrySet().stream()\n+            .filter(e -> families.contains(Bytes.toString(e.getKey())))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8b0e46c7ae8aa73df09491b10bd55acd9b1a2be"}, "originalPosition": 47}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6dbea932b0dd506b392373847bcb99a45f4198c4", "author": {"user": {"login": "bsglz", "name": null}}, "url": "https://github.com/apache/hbase/commit/6dbea932b0dd506b392373847bcb99a45f4198c4", "committedDate": "2020-05-21T07:25:08Z", "message": "use byte[] instead of String, and avoid use contains"}, "afterCommit": {"oid": "631f0f66585a559ecddc32b302c4bc4304ab0376", "author": {"user": {"login": "bsglz", "name": null}}, "url": "https://github.com/apache/hbase/commit/631f0f66585a559ecddc32b302c4bc4304ab0376", "committedDate": "2020-05-23T09:31:12Z", "message": "HBASE-24382 Flush partial stores of region filtered by seqId when archive wal due to too many wals"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MjY2MTMw", "url": "https://github.com/apache/hbase/pull/1737#pullrequestreview-417266130", "createdAt": "2020-05-23T09:48:30Z", "commit": {"oid": "631f0f66585a559ecddc32b302c4bc4304ab0376"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QwOTo0ODozMVrOGZojcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QwOTo1MDo0OVrOGZoj8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUzMjAxNw==", "bodyText": "Change the comment?", "url": "https://github.com/apache/hbase/pull/1737#discussion_r429532017", "createdAt": "2020-05-23T09:48:31Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/LogRoller.java", "diffHunk": "@@ -59,7 +61,7 @@ protected void scheduleFlush(String encodedRegionName) {\n       return;\n     }\n     // force flushing all stores to clean old logs", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "631f0f66585a559ecddc32b302c4bc4304ab0376"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUzMjE0NA==", "bodyText": "Better use a TreeMap with BytesComparator?", "url": "https://github.com/apache/hbase/pull/1737#discussion_r429532144", "createdAt": "2020-05-23T09:50:49Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/SequenceIdAccounting.java", "diffHunk": "@@ -440,27 +440,27 @@ boolean areAllLower(Map<byte[], Long> sequenceids, Collection<byte[]> keysBlocki\n    * {@link #lowestUnflushedSequenceIds} has a sequence id less than that passed in\n    * <code>sequenceids</code> then return it.\n    * @param sequenceids Sequenceids keyed by encoded region name.\n-   * @return regions found in this instance with sequence ids less than those passed in.\n+   * @return stores of regions found in this instance with sequence ids less than those passed in.\n    */\n-  byte[][] findLower(Map<byte[], Long> sequenceids) {\n-    List<byte[]> toFlush = null;\n+  Map<byte[], List<byte[]>> findLower(Map<byte[], Long> sequenceids) {\n+    Map<byte[], List<byte[]>> toFlush = null;\n     // Keeping the old behavior of iterating unflushedSeqNums under oldestSeqNumsLock.\n     synchronized (tieLock) {\n       for (Map.Entry<byte[], Long> e : sequenceids.entrySet()) {\n         Map<ImmutableByteArray, Long> m = this.lowestUnflushedSequenceIds.get(e.getKey());\n         if (m == null) {\n           continue;\n         }\n-        // The lowest sequence id outstanding for this region.\n-        long lowest = getLowestSequenceId(m);\n-        if (lowest != HConstants.NO_SEQNUM && lowest <= e.getValue()) {\n-          if (toFlush == null) {\n-            toFlush = new ArrayList<>();\n+        for (Map.Entry<ImmutableByteArray, Long> me : m.entrySet()) {\n+          if (me.getValue() <= e.getValue()) {\n+            if (toFlush == null) {\n+              toFlush = new HashMap<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "631f0f66585a559ecddc32b302c4bc4304ab0376"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwMzE1MDY0", "url": "https://github.com/apache/hbase/pull/1737#pullrequestreview-420315064", "createdAt": "2020-05-28T17:00:28Z", "commit": {"oid": "bc0089a687d02b55706b0b4baf9173b013531de5"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNzowMDoyOFrOGb-Z5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNzoyMjo1M1rOGb_PPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk4NzE3NQ==", "bodyText": "Should this family selection pass through the flushPolicy?", "url": "https://github.com/apache/hbase/pull/1737#discussion_r431987175", "createdAt": "2020-05-28T17:00:28Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "diffHunk": "@@ -2444,8 +2451,16 @@ public FlushResultImpl flushcache(boolean forceFlushAllStores, boolean writeFlus\n       }\n \n       try {\n-        Collection<HStore> specificStoresToFlush =\n+        Collection<HStore> specificStoresToFlush = null;\n+        if (!forceFlushAllStores && families != null) {\n+          specificStoresToFlush = new ArrayList<>();\n+          for (byte[] family : families) {\n+            specificStoresToFlush.add(stores.get(family));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc0089a687d02b55706b0b4baf9173b013531de5"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk4NzM4Nw==", "bodyText": "Be careful here. Make code look like rest of the file. Add space around the 'else'.", "url": "https://github.com/apache/hbase/pull/1737#discussion_r431987387", "createdAt": "2020-05-28T17:00:50Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "diffHunk": "@@ -2444,8 +2451,16 @@ public FlushResultImpl flushcache(boolean forceFlushAllStores, boolean writeFlus\n       }\n \n       try {\n-        Collection<HStore> specificStoresToFlush =\n+        Collection<HStore> specificStoresToFlush = null;\n+        if (!forceFlushAllStores && families != null) {\n+          specificStoresToFlush = new ArrayList<>();\n+          for (byte[] family : families) {\n+            specificStoresToFlush.add(stores.get(family));\n+          }\n+        }else{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc0089a687d02b55706b0b4baf9173b013531de5"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk4ODAyNg==", "bodyText": "Space after comma (Make your code follow convention of surrounding code)", "url": "https://github.com/apache/hbase/pull/1737#discussion_r431988026", "createdAt": "2020-05-28T17:01:43Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/MemStoreFlusher.java", "diffHunk": "@@ -459,13 +459,18 @@ private FlushType isAboveLowWaterMark() {\n   }\n \n   @Override\n-  public boolean requestFlush(HRegion r, boolean forceFlushAllStores,\n-                              FlushLifeCycleTracker tracker) {\n+  public boolean requestFlush(HRegion r, boolean forceFlushAllStores,FlushLifeCycleTracker tracker) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc0089a687d02b55706b0b4baf9173b013531de5"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk5MDE0OQ==", "bodyText": "Usually ',' for lists.", "url": "https://github.com/apache/hbase/pull/1737#discussion_r431990149", "createdAt": "2020-05-28T17:04:16Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/AbstractFSWAL.java", "diffHunk": "@@ -639,26 +641,30 @@ public int getNumLogFiles() {\n    * If the number of un-archived WAL files ('live' WALs) is greater than maximum allowed,\n    * check the first (oldest) WAL, and return those regions which should be flushed so that\n    * it can be let-go/'archived'.\n-   * @return regions (encodedRegionNames) to flush in order to archive oldest WAL file.\n+   * @return stores of regions (encodedRegionNames) to flush in order to archive oldest WAL file.\n    */\n-  byte[][] findRegionsToForceFlush() throws IOException {\n-    byte[][] regions = null;\n+  Map<byte[], List<byte[]>> findRegionsToForceFlush() throws IOException {\n+    Map<byte[], List<byte[]>> regions = null;\n     int logCount = getNumRolledLogFiles();\n     if (logCount > this.maxLogs && logCount > 0) {\n       Map.Entry<Path, WalProps> firstWALEntry = this.walFile2Props.firstEntry();\n       regions =\n         this.sequenceIdAccounting.findLower(firstWALEntry.getValue().encodedName2HighestSequenceId);\n     }\n     if (regions != null) {\n-      StringBuilder sb = new StringBuilder();\n-      for (int i = 0; i < regions.length; i++) {\n-        if (i > 0) {\n-          sb.append(\", \");\n+      List<String> listForPrint = new ArrayList();\n+      for (Map.Entry<byte[], List<byte[]>> r : regions.entrySet()) {\n+        StringBuffer families = new StringBuffer();\n+        for (int i = 0; i < r.getValue().size(); i++) {\n+          if (i > 0) {\n+            families.append(\"|\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc0089a687d02b55706b0b4baf9173b013531de5"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjAwMDgyOA==", "bodyText": "s/forcing flush partial stores of/forcing (partial) flush of/", "url": "https://github.com/apache/hbase/pull/1737#discussion_r432000828", "createdAt": "2020-05-28T17:22:53Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/AbstractFSWAL.java", "diffHunk": "@@ -639,26 +641,30 @@ public int getNumLogFiles() {\n    * If the number of un-archived WAL files ('live' WALs) is greater than maximum allowed,\n    * check the first (oldest) WAL, and return those regions which should be flushed so that\n    * it can be let-go/'archived'.\n-   * @return regions (encodedRegionNames) to flush in order to archive oldest WAL file.\n+   * @return stores of regions (encodedRegionNames) to flush in order to archive oldest WAL file.\n    */\n-  byte[][] findRegionsToForceFlush() throws IOException {\n-    byte[][] regions = null;\n+  Map<byte[], List<byte[]>> findRegionsToForceFlush() throws IOException {\n+    Map<byte[], List<byte[]>> regions = null;\n     int logCount = getNumRolledLogFiles();\n     if (logCount > this.maxLogs && logCount > 0) {\n       Map.Entry<Path, WalProps> firstWALEntry = this.walFile2Props.firstEntry();\n       regions =\n         this.sequenceIdAccounting.findLower(firstWALEntry.getValue().encodedName2HighestSequenceId);\n     }\n     if (regions != null) {\n-      StringBuilder sb = new StringBuilder();\n-      for (int i = 0; i < regions.length; i++) {\n-        if (i > 0) {\n-          sb.append(\", \");\n+      List<String> listForPrint = new ArrayList();\n+      for (Map.Entry<byte[], List<byte[]>> r : regions.entrySet()) {\n+        StringBuffer families = new StringBuffer();\n+        for (int i = 0; i < r.getValue().size(); i++) {\n+          if (i > 0) {\n+            families.append(\"|\");\n+          }\n+          families.append(Bytes.toString(r.getValue().get(i)));\n         }\n-        sb.append(Bytes.toStringBinary(regions[i]));\n+        listForPrint.add(Bytes.toStringBinary(r.getKey()) + \"[\" + families.toString() + \"]\");\n       }\n       LOG.info(\"Too many WALs; count=\" + logCount + \", max=\" + this.maxLogs +\n-        \"; forcing flush of \" + regions.length + \" regions(s): \" + sb.toString());\n+        \"; forcing flush partial stores of \" + regions.size() + \" region(s): \" + StringUtils.join(\",\", listForPrint));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc0089a687d02b55706b0b4baf9173b013531de5"}, "originalPosition": 54}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4MjY3NjI4", "url": "https://github.com/apache/hbase/pull/1737#pullrequestreview-418267628", "createdAt": "2020-05-26T12:55:01Z", "commit": {"oid": "bc0089a687d02b55706b0b4baf9173b013531de5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxMjo1NTowMVrOGac5cQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQwODozOTowMlrOGdC_NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM4OTYxNw==", "bodyText": "StringBuilder", "url": "https://github.com/apache/hbase/pull/1737#discussion_r430389617", "createdAt": "2020-05-26T12:55:01Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/AbstractFSWAL.java", "diffHunk": "@@ -639,26 +641,30 @@ public int getNumLogFiles() {\n    * If the number of un-archived WAL files ('live' WALs) is greater than maximum allowed,\n    * check the first (oldest) WAL, and return those regions which should be flushed so that\n    * it can be let-go/'archived'.\n-   * @return regions (encodedRegionNames) to flush in order to archive oldest WAL file.\n+   * @return stores of regions (encodedRegionNames) to flush in order to archive oldest WAL file.\n    */\n-  byte[][] findRegionsToForceFlush() throws IOException {\n-    byte[][] regions = null;\n+  Map<byte[], List<byte[]>> findRegionsToForceFlush() throws IOException {\n+    Map<byte[], List<byte[]>> regions = null;\n     int logCount = getNumRolledLogFiles();\n     if (logCount > this.maxLogs && logCount > 0) {\n       Map.Entry<Path, WalProps> firstWALEntry = this.walFile2Props.firstEntry();\n       regions =\n         this.sequenceIdAccounting.findLower(firstWALEntry.getValue().encodedName2HighestSequenceId);\n     }\n     if (regions != null) {\n-      StringBuilder sb = new StringBuilder();\n-      for (int i = 0; i < regions.length; i++) {\n-        if (i > 0) {\n-          sb.append(\", \");\n+      List<String> listForPrint = new ArrayList();\n+      for (Map.Entry<byte[], List<byte[]>> r : regions.entrySet()) {\n+        StringBuffer families = new StringBuffer();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc0089a687d02b55706b0b4baf9173b013531de5"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM4OTg0NQ==", "bodyText": "Avoid star imports.", "url": "https://github.com/apache/hbase/pull/1737#discussion_r430389845", "createdAt": "2020-05-26T12:55:22Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/SequenceIdAccounting.java", "diffHunk": "@@ -19,13 +19,7 @@\n \n import static org.apache.hadoop.hbase.util.ConcurrentMapUtils.computeIfAbsent;\n \n-import java.util.ArrayList;\n-import java.util.Collection;\n-import java.util.Collections;\n-import java.util.HashMap;\n-import java.util.List;\n-import java.util.Map;\n-import java.util.Set;\n+import java.util.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc0089a687d02b55706b0b4baf9173b013531de5"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM5MDIwOA==", "bodyText": "Just return toFlush?", "url": "https://github.com/apache/hbase/pull/1737#discussion_r430390208", "createdAt": "2020-05-26T12:55:59Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/SequenceIdAccounting.java", "diffHunk": "@@ -440,27 +434,27 @@ boolean areAllLower(Map<byte[], Long> sequenceids, Collection<byte[]> keysBlocki\n    * {@link #lowestUnflushedSequenceIds} has a sequence id less than that passed in\n    * <code>sequenceids</code> then return it.\n    * @param sequenceids Sequenceids keyed by encoded region name.\n-   * @return regions found in this instance with sequence ids less than those passed in.\n+   * @return stores of regions found in this instance with sequence ids less than those passed in.\n    */\n-  byte[][] findLower(Map<byte[], Long> sequenceids) {\n-    List<byte[]> toFlush = null;\n+  Map<byte[], List<byte[]>> findLower(Map<byte[], Long> sequenceids) {\n+    Map<byte[], List<byte[]>> toFlush = null;\n     // Keeping the old behavior of iterating unflushedSeqNums under oldestSeqNumsLock.\n     synchronized (tieLock) {\n       for (Map.Entry<byte[], Long> e : sequenceids.entrySet()) {\n         Map<ImmutableByteArray, Long> m = this.lowestUnflushedSequenceIds.get(e.getKey());\n         if (m == null) {\n           continue;\n         }\n-        // The lowest sequence id outstanding for this region.\n-        long lowest = getLowestSequenceId(m);\n-        if (lowest != HConstants.NO_SEQNUM && lowest <= e.getValue()) {\n-          if (toFlush == null) {\n-            toFlush = new ArrayList<>();\n+        for (Map.Entry<ImmutableByteArray, Long> me : m.entrySet()) {\n+          if (me.getValue() <= e.getValue()) {\n+            if (toFlush == null) {\n+              toFlush = new TreeMap(Bytes.BYTES_COMPARATOR);\n+            }\n+            toFlush.computeIfAbsent(e.getKey(), k -> new ArrayList<>()).add(Bytes.toBytes(me.getKey().toString()));\n           }\n-          toFlush.add(e.getKey());\n         }\n       }\n     }\n-    return toFlush == null ? null : toFlush.toArray(new byte[0][]);\n+    return toFlush == null ? null : toFlush;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc0089a687d02b55706b0b4baf9173b013531de5"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzExMDgzNg==", "bodyText": "What's this?", "url": "https://github.com/apache/hbase/pull/1737#discussion_r433110836", "createdAt": "2020-06-01T08:39:02Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/AbstractTestWALReplay.java", "diffHunk": "@@ -9,7 +9,7 @@\n  * with the License.  You may obtain a copy of the License at\n  *\n  *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n+ *TestFlusher", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e1463fb7a0b15c15a29ce622ec8ad23505975d99"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c4eb9c3c23a769c100ca4c19ef6b88d4fbfe2ab3", "author": {"user": {"login": "bsglz", "name": null}}, "url": "https://github.com/apache/hbase/commit/c4eb9c3c23a769c100ca4c19ef6b88d4fbfe2ab3", "committedDate": "2020-06-01T09:14:28Z", "message": "fix review issue"}, "afterCommit": {"oid": "f62cb51f58fb416df00c8828931e84f871dbee34", "author": {"user": {"login": "bsglz", "name": null}}, "url": "https://github.com/apache/hbase/commit/f62cb51f58fb416df00c8828931e84f871dbee34", "committedDate": "2020-06-01T13:34:01Z", "message": "HBASE-24382 Flush partial stores of region filtered by seqId when archive wal due to too many wals"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba27fe16f14d7f620dbfc7d010cafe4c40b7f8f7", "author": {"user": {"login": "bsglz", "name": null}}, "url": "https://github.com/apache/hbase/commit/ba27fe16f14d7f620dbfc7d010cafe4c40b7f8f7", "committedDate": "2020-06-02T03:09:13Z", "message": "HBASE-24382 Flush partial stores of region filtered by seqId when archive wal due to too many wals"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f62cb51f58fb416df00c8828931e84f871dbee34", "author": {"user": {"login": "bsglz", "name": null}}, "url": "https://github.com/apache/hbase/commit/f62cb51f58fb416df00c8828931e84f871dbee34", "committedDate": "2020-06-01T13:34:01Z", "message": "HBASE-24382 Flush partial stores of region filtered by seqId when archive wal due to too many wals"}, "afterCommit": {"oid": "ba27fe16f14d7f620dbfc7d010cafe4c40b7f8f7", "author": {"user": {"login": "bsglz", "name": null}}, "url": "https://github.com/apache/hbase/commit/ba27fe16f14d7f620dbfc7d010cafe4c40b7f8f7", "committedDate": "2020-06-02T03:09:13Z", "message": "HBASE-24382 Flush partial stores of region filtered by seqId when archive wal due to too many wals"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "994a2eb60d9a0acccfc761429b2ae7a33349efd9", "author": {"user": {"login": "bsglz", "name": null}}, "url": "https://github.com/apache/hbase/commit/994a2eb60d9a0acccfc761429b2ae7a33349efd9", "committedDate": "2020-06-05T13:48:05Z", "message": "fix checkstyle and javadoc issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff0b09041215c4a49200c938aa4a52d7aa43f87c", "author": {"user": {"login": "bsglz", "name": null}}, "url": "https://github.com/apache/hbase/commit/ff0b09041215c4a49200c938aa4a52d7aa43f87c", "committedDate": "2020-06-05T14:48:30Z", "message": "fix javadoc issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1OTA3OTgx", "url": "https://github.com/apache/hbase/pull/1737#pullrequestreview-425907981", "createdAt": "2020-06-08T04:24:41Z", "commit": {"oid": "ff0b09041215c4a49200c938aa4a52d7aa43f87c"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwNDoyNDo0MVrOGgO2YQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwNTowMDoxNVrOGgPP9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1MDkxMw==", "bodyText": "Could be static?", "url": "https://github.com/apache/hbase/pull/1737#discussion_r436450913", "createdAt": "2020-06-08T04:24:41Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/FlushPolicy.java", "diffHunk": "@@ -46,4 +49,16 @@ protected void configureForRegion(HRegion region) {\n    */\n   public abstract Collection<HStore> selectStoresToFlush();\n \n+  /**\n+   * select stores which matches the specified families\n+   *\n+   * @return the stores need to be flushed.\n+   */\n+  public Collection<HStore> selectStoresToFlush(Map<byte[], HStore> stores, List<byte[]> families) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff0b09041215c4a49200c938aa4a52d7aa43f87c"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1MTI2Mw==", "bodyText": "If this true, does it mean flush all familes even if only a subset passed in families?", "url": "https://github.com/apache/hbase/pull/1737#discussion_r436451263", "createdAt": "2020-06-08T04:26:43Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/FlushRequester.java", "diffHunk": "@@ -36,6 +38,18 @@\n    */\n   boolean requestFlush(HRegion region, boolean forceFlushAllStores, FlushLifeCycleTracker tracker);\n \n+  /**\n+   * Tell the listener the cache needs to be flushed.\n+   *\n+   * @param region the Region requesting the cache flush\n+   * @param forceFlushAllStores whether we want to flush all stores. e.g., when request from log", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff0b09041215c4a49200c938aa4a52d7aa43f87c"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1MTgzOQ==", "bodyText": "If this is case, maybe say so in the javadoc?", "url": "https://github.com/apache/hbase/pull/1737#discussion_r436451839", "createdAt": "2020-06-08T04:30:09Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/FlushRequester.java", "diffHunk": "@@ -36,6 +38,18 @@\n    */\n   boolean requestFlush(HRegion region, boolean forceFlushAllStores, FlushLifeCycleTracker tracker);\n \n+  /**\n+   * Tell the listener the cache needs to be flushed.\n+   *\n+   * @param region the Region requesting the cache flush\n+   * @param forceFlushAllStores whether we want to flush all stores. e.g., when request from log", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1MTI2Mw=="}, "originalCommit": {"oid": "ff0b09041215c4a49200c938aa4a52d7aa43f87c"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1MjU0OA==", "bodyText": "Yeah, if this is true, families are ignored.", "url": "https://github.com/apache/hbase/pull/1737#discussion_r436452548", "createdAt": "2020-06-08T04:34:17Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/FlushRequester.java", "diffHunk": "@@ -36,6 +38,18 @@\n    */\n   boolean requestFlush(HRegion region, boolean forceFlushAllStores, FlushLifeCycleTracker tracker);\n \n+  /**\n+   * Tell the listener the cache needs to be flushed.\n+   *\n+   * @param region the Region requesting the cache flush\n+   * @param forceFlushAllStores whether we want to flush all stores. e.g., when request from log", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1MTI2Mw=="}, "originalCommit": {"oid": "ff0b09041215c4a49200c938aa4a52d7aa43f87c"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1NDc2Nw==", "bodyText": "So, looking at the flushPolicy implementations we currently have, I see two:\nFlushAllStoresPolicy\nand\nFlushLargeStoresPolicy\nGiven the current implementations, passing a subset of families doesn't seem appropriate at least for the FlushAllStoresPolicy -- if we flush some families only, then we are not flushing AllStores -- and perhaps for the FlushLargeStoresPolicy since we are not flushing the large but the passed families.\nDo you need to create a new flush policy? One that does the subset of families passed? If user configures the FlushAllStoresPolicy and instead we only flush a subset, then they will be confused.\nWhy do we pass in stores into selectStoresToFlush? We do not need the list of stores in the flushAllStoresPolicy. It has access to 'this' so can figure what Stores are in the Region.", "url": "https://github.com/apache/hbase/pull/1737#discussion_r436454767", "createdAt": "2020-06-08T04:46:43Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "diffHunk": "@@ -2457,8 +2463,13 @@ public FlushResultImpl flushcache(boolean forceFlushAllStores, boolean writeFlus\n       }\n \n       try {\n-        Collection<HStore> specificStoresToFlush =\n+        Collection<HStore> specificStoresToFlush = null;\n+        if (!forceFlushAllStores && families != null) {\n+          specificStoresToFlush = flushPolicy.selectStoresToFlush(stores, families);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff0b09041215c4a49200c938aa4a52d7aa43f87c"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1NjE3NA==", "bodyText": "We are in here because a force roll was requested.  You change the true to false. Isn't that changing behavior at least for the default flush all stores case?", "url": "https://github.com/apache/hbase/pull/1737#discussion_r436456174", "createdAt": "2020-06-08T04:53:42Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/LogRoller.java", "diffHunk": "@@ -58,8 +60,8 @@ protected void scheduleFlush(String encodedRegionName) {\n         encodedRegionName, r);\n       return;\n     }\n-    // force flushing all stores to clean old logs\n-    requester.requestFlush(r, true, FlushLifeCycleTracker.DUMMY);\n+    // force flushing specified stores to clean old logs\n+    requester.requestFlush(r, false, families, FlushLifeCycleTracker.DUMMY);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff0b09041215c4a49200c938aa4a52d7aa43f87c"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1NzQ2Mg==", "bodyText": "I do like this change in the return type from Region to Region Stores. I am wary that we are changing the default behavior.", "url": "https://github.com/apache/hbase/pull/1737#discussion_r436457462", "createdAt": "2020-06-08T05:00:15Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/wal/AbstractWALRoller.java", "diffHunk": "@@ -180,18 +181,18 @@ public void run() {\n           WAL wal = entry.getKey();\n           // reset the flag in front to avoid missing roll request before we return from rollWriter.\n           walNeedsRoll.put(wal, Boolean.FALSE);\n-          byte[][] regionsToFlush = null;\n+          Map<byte[], List<byte[]>> regionsToFlush = null;\n           try {\n             // Force the roll if the logroll.period is elapsed or if a roll was requested.\n-            // The returned value is an array of actual region names.\n+            // The returned value is an collection of actual region and family names.\n             regionsToFlush = wal.rollWriter(periodic || entry.getValue().booleanValue());\n           } catch (WALClosedException e) {\n             LOG.warn(\"WAL has been closed. Skipping rolling of writer and just remove it\", e);\n             iter.remove();\n           }\n           if (regionsToFlush != null) {\n-            for (byte[] r : regionsToFlush) {\n-              scheduleFlush(Bytes.toString(r));\n+            for (Map.Entry<byte[], List<byte[]>> r : regionsToFlush.entrySet()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff0b09041215c4a49200c938aa4a52d7aa43f87c"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5632d9f317506501ae72817808daed3d5af9d347", "author": {"user": {"login": "bsglz", "name": null}}, "url": "https://github.com/apache/hbase/commit/5632d9f317506501ae72817808daed3d5af9d347", "committedDate": "2020-06-09T13:33:56Z", "message": "move the geting of stores to HRegion, since it should not be part of FlushPolicy, and comment fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1ODY4ODA3", "url": "https://github.com/apache/hbase/pull/1737#pullrequestreview-435868807", "createdAt": "2020-06-23T14:55:32Z", "commit": {"oid": "5632d9f317506501ae72817808daed3d5af9d347"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNDo1NTozMlrOGntRag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNDo1NTozMlrOGntRag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI4OTM4Ng==", "bodyText": "Should remove these imports? Seems we add a method in this class and then moved it out but forgot to remove these imports?", "url": "https://github.com/apache/hbase/pull/1737#discussion_r444289386", "createdAt": "2020-06-23T14:55:32Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/FlushPolicy.java", "diffHunk": "@@ -17,7 +17,10 @@\n  */\n package org.apache.hadoop.hbase.regionserver;\n \n+import java.util.ArrayList;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5632d9f317506501ae72817808daed3d5af9d347"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78b9b5afdc77385e3d228467f512fe231c0f4e75", "author": {"user": {"login": "bsglz", "name": null}}, "url": "https://github.com/apache/hbase/commit/78b9b5afdc77385e3d228467f512fe231c0f4e75", "committedDate": "2020-06-23T15:12:21Z", "message": "fix checkstyle issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d494fca7e9ba36912ae4992366b3370860277d89", "author": {"user": {"login": "bsglz", "name": null}}, "url": "https://github.com/apache/hbase/commit/d494fca7e9ba36912ae4992366b3370860277d89", "committedDate": "2020-06-25T05:29:55Z", "message": "add some comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MTY4MDk0", "url": "https://github.com/apache/hbase/pull/1737#pullrequestreview-437168094", "createdAt": "2020-06-25T04:59:10Z", "commit": {"oid": "78b9b5afdc77385e3d228467f512fe231c0f4e75"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwNDo1OToxMFrOGorZWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwNTo0MTowMVrOGosEjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwNzIyNw==", "bodyText": "Did you add comment to clarify what is going on here? I don't see it. Maybe it is elsewhere?", "url": "https://github.com/apache/hbase/pull/1737#discussion_r445307227", "createdAt": "2020-06-25T04:59:10Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/FlushRequester.java", "diffHunk": "@@ -36,6 +38,18 @@\n    */\n   boolean requestFlush(HRegion region, boolean forceFlushAllStores, FlushLifeCycleTracker tracker);\n \n+  /**\n+   * Tell the listener the cache needs to be flushed.\n+   *\n+   * @param region the Region requesting the cache flush\n+   * @param forceFlushAllStores whether we want to flush all stores. e.g., when request from log", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1MTI2Mw=="}, "originalCommit": {"oid": "ff0b09041215c4a49200c938aa4a52d7aa43f87c"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwNzM4MA==", "bodyText": "Oh, I see it in next line. Let me resolve.", "url": "https://github.com/apache/hbase/pull/1737#discussion_r445307380", "createdAt": "2020-06-25T04:59:36Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/FlushRequester.java", "diffHunk": "@@ -36,6 +38,18 @@\n    */\n   boolean requestFlush(HRegion region, boolean forceFlushAllStores, FlushLifeCycleTracker tracker);\n \n+  /**\n+   * Tell the listener the cache needs to be flushed.\n+   *\n+   * @param region the Region requesting the cache flush\n+   * @param forceFlushAllStores whether we want to flush all stores. e.g., when request from log", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1MTI2Mw=="}, "originalCommit": {"oid": "ff0b09041215c4a49200c938aa4a52d7aa43f87c"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwNzU4OA==", "bodyText": "If null is passed, does that mean all families?", "url": "https://github.com/apache/hbase/pull/1737#discussion_r445307588", "createdAt": "2020-06-25T05:00:24Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "diffHunk": "@@ -2400,6 +2405,7 @@ public FlushResult flush(boolean force) throws IOException {\n    * <p>This method may block for some time, so it should not be called from a\n    * time-sensitive thread.\n    * @param forceFlushAllStores whether we want to flush all stores\n+   * @param families stores of region to flush.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78b9b5afdc77385e3d228467f512fe231c0f4e75"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwNzczNg==", "bodyText": "Yeah, looks like it.", "url": "https://github.com/apache/hbase/pull/1737#discussion_r445307736", "createdAt": "2020-06-25T05:00:57Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "diffHunk": "@@ -2400,6 +2405,7 @@ public FlushResult flush(boolean force) throws IOException {\n    * <p>This method may block for some time, so it should not be called from a\n    * time-sensitive thread.\n    * @param forceFlushAllStores whether we want to flush all stores\n+   * @param families stores of region to flush.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwNzU4OA=="}, "originalCommit": {"oid": "78b9b5afdc77385e3d228467f512fe231c0f4e75"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMxNTA5NA==", "bodyText": "The flag is set when we are in a critical condition -- the WAL count is in excess of our WAL limit. The flag's intent IIRC is that we flush all stores regardless of what determination is made at flush time as to which stores are in need of flush or not; the old edit may actually be hanging out in a store that is small and not in need of flush normally or in accordance w/ some flush policy. The flag says 'force' the flush. My understanding is that this is a FlushRequest usually but the flag changes the request to a demand.\nHere you are passing a set of stores instead where the stores chosen are the ones that will free up WALs. So, this flag is now redundant? We should purge it. Now it will confuse since the 'force' instead is a list of families to flush -- else its null if old behavior.", "url": "https://github.com/apache/hbase/pull/1737#discussion_r445315094", "createdAt": "2020-06-25T05:29:32Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/LogRoller.java", "diffHunk": "@@ -58,8 +60,8 @@ protected void scheduleFlush(String encodedRegionName) {\n         encodedRegionName, r);\n       return;\n     }\n-    // force flushing all stores to clean old logs\n-    requester.requestFlush(r, true, FlushLifeCycleTracker.DUMMY);\n+    // force flushing specified stores to clean old logs\n+    requester.requestFlush(r, false, families, FlushLifeCycleTracker.DUMMY);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1NjE3NA=="}, "originalCommit": {"oid": "ff0b09041215c4a49200c938aa4a52d7aa43f87c"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMxNzMyMg==", "bodyText": "So all families in a Region if 'families' is null or if forceFlushAllStores is true?", "url": "https://github.com/apache/hbase/pull/1737#discussion_r445317322", "createdAt": "2020-06-25T05:37:29Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "diffHunk": "@@ -2400,6 +2405,7 @@ public FlushResult flush(boolean force) throws IOException {\n    * <p>This method may block for some time, so it should not be called from a\n    * time-sensitive thread.\n    * @param forceFlushAllStores whether we want to flush all stores\n+   * @param families stores of region to flush.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwNzU4OA=="}, "originalCommit": {"oid": "78b9b5afdc77385e3d228467f512fe231c0f4e75"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMxODI4NA==", "bodyText": "Looking around, this is the only time forceFlushAllStores is set to true -- when we have too many WALs and we need to clear the old ones out.", "url": "https://github.com/apache/hbase/pull/1737#discussion_r445318284", "createdAt": "2020-06-25T05:41:01Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/LogRoller.java", "diffHunk": "@@ -58,8 +60,8 @@ protected void scheduleFlush(String encodedRegionName) {\n         encodedRegionName, r);\n       return;\n     }\n-    // force flushing all stores to clean old logs\n-    requester.requestFlush(r, true, FlushLifeCycleTracker.DUMMY);\n+    // force flushing specified stores to clean old logs\n+    requester.requestFlush(r, false, families, FlushLifeCycleTracker.DUMMY);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1NjE3NA=="}, "originalCommit": {"oid": "ff0b09041215c4a49200c938aa4a52d7aa43f87c"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d2a3ea2f1e1c0a4c3cd2f18e29115fba5bfd713", "author": {"user": {"login": "bsglz", "name": null}}, "url": "https://github.com/apache/hbase/commit/9d2a3ea2f1e1c0a4c3cd2f18e29115fba5bfd713", "committedDate": "2020-06-25T17:06:00Z", "message": "remove the forceFlushAllStores since we can use families to determine how to select stores to flush"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4MDEzNDM3", "url": "https://github.com/apache/hbase/pull/1737#pullrequestreview-438013437", "createdAt": "2020-06-26T04:58:03Z", "commit": {"oid": "9d2a3ea2f1e1c0a4c3cd2f18e29115fba5bfd713"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwNDo1ODowM1rOGpTsmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwNDo1ODowM1rOGpTsmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk2NzUxNA==", "bodyText": "Good", "url": "https://github.com/apache/hbase/pull/1737#discussion_r445967514", "createdAt": "2020-06-26T04:58:03Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "diffHunk": "@@ -2386,6 +2386,16 @@ public FlushResult flush(boolean force) throws IOException {\n     boolean isCompactionNeeded();\n   }\n \n+  public FlushResultImpl flushcache(boolean flushAllStores, boolean writeFlushRequestWalMarker,\n+    FlushLifeCycleTracker tracker) throws IOException {\n+    List families = null;\n+    if (flushAllStores) {\n+      families = new ArrayList();\n+      families.addAll(this.getTableDescriptor().getColumnFamilyNames());\n+    }\n+    return this.flushcache(families, writeFlushRequestWalMarker, tracker);\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d2a3ea2f1e1c0a4c3cd2f18e29115fba5bfd713"}, "originalPosition": 32}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4668, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}