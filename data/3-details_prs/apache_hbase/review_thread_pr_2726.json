{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI5ODgxNzI2", "number": 2726, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxOToxNzowMlrOFB8TXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxOToxNzowMlrOFB8TXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3NTgwODk1OnYy", "diffSide": "RIGHT", "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/client/CatalogReplicaLoadBalanceSimpleSelector.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxOToxNzowMlrOIA2cbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNzowOTo1MVrOICfwfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzc2MjkyNQ==", "bodyText": "How often will we log this message when a client is trying to connect to the cluster? Will it happen frequently?", "url": "https://github.com/apache/hbase/pull/2726#discussion_r537762925", "createdAt": "2020-12-07T19:17:02Z", "author": {"login": "saintstack"}, "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/client/CatalogReplicaLoadBalanceSimpleSelector.java", "diffHunk": "@@ -262,16 +261,16 @@ private void cleanupReplicaReplicaStaleCache() {\n   private int refreshCatalogReplicaCount() {\n     int newNumOfReplicas = this.getNumOfReplicas.getAsInt();\n     LOG.debug(\"Refreshed replica count {}\", newNumOfReplicas);\n-    if (newNumOfReplicas == 1) {\n-      LOG.warn(\"Table {}'s region replica count is 1, maybe a misconfiguration or failure to \"\n-        + \"fetch the replica count\", tableName);\n+    // If the returned number of replicas is -1, it is caused by failure to fetch the\n+    // replica count. Do not update the numOfReplicas in this case.\n+    if (newNumOfReplicas == CatalogReplicaLoadBalanceSelector.UNINITIALIZED_NUM_OF_REPLICAS) {\n+      LOG.error(\"Failed to fetch Table {}'s region replica count\", tableName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbd7d1c9bdebfe108e2431c7b8023acfb4558b90"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQ4ODM4Mg==", "bodyText": "Currently, it is logged every 2 minutes.", "url": "https://github.com/apache/hbase/pull/2726#discussion_r539488382", "createdAt": "2020-12-09T17:09:51Z", "author": {"login": "huaxiangsun"}, "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/client/CatalogReplicaLoadBalanceSimpleSelector.java", "diffHunk": "@@ -262,16 +261,16 @@ private void cleanupReplicaReplicaStaleCache() {\n   private int refreshCatalogReplicaCount() {\n     int newNumOfReplicas = this.getNumOfReplicas.getAsInt();\n     LOG.debug(\"Refreshed replica count {}\", newNumOfReplicas);\n-    if (newNumOfReplicas == 1) {\n-      LOG.warn(\"Table {}'s region replica count is 1, maybe a misconfiguration or failure to \"\n-        + \"fetch the replica count\", tableName);\n+    // If the returned number of replicas is -1, it is caused by failure to fetch the\n+    // replica count. Do not update the numOfReplicas in this case.\n+    if (newNumOfReplicas == CatalogReplicaLoadBalanceSelector.UNINITIALIZED_NUM_OF_REPLICAS) {\n+      LOG.error(\"Failed to fetch Table {}'s region replica count\", tableName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzc2MjkyNQ=="}, "originalCommit": {"oid": "bbd7d1c9bdebfe108e2431c7b8023acfb4558b90"}, "originalPosition": 36}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2311, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}