{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxMzcyNDMz", "number": 1223, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOVQwMDo1NDoyNVrODj_W-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOVQwMDo1NjoyMlrODj_Xow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5MDY0ODI2OnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOVQwMDo1NDoyNVrOFwGlng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOVQwMDo1NDoyNVrOFwGlng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk4MzkwMg==", "bodyText": "This changes the semantic? Not sure why but before this patch we only set this for HMaster?", "url": "https://github.com/apache/hbase/pull/1223#discussion_r385983902", "createdAt": "2020-02-29T00:54:25Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java", "diffHunk": "@@ -721,20 +720,20 @@ private void initializeFileSystem() throws IOException {\n   }\n \n   private TableDescriptors getFsTableDescriptors() throws IOException {\n-    return new FSTableDescriptors(this.conf,\n-      this.dataFs, this.dataRootDir, !canUpdateTableDescriptor(), false, getMetaTableObserver());\n-  }\n-\n-  protected Function<TableDescriptorBuilder, TableDescriptorBuilder> getMetaTableObserver() {\n-    return null;\n+    if (canUpdateTableDescriptor()) {\n+      return new FSTableDescriptors(this.conf, this.dataFs, this.dataRootDir, false,\n+        builder -> builder.setRegionReplication(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "354fa73e495367ccdb3ae2b7319a3ac4bca9fe23"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5MDY0OTk1OnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/util/ReadOnlyFSTableDescriptors.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOVQwMDo1NjoyM1rOFwGmmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOVQwMjoxODoyNFrOFwHG-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk4NDE1Mw==", "bodyText": "I think FSTableDescriptor should extends ReadOnlyFSTableDescriptor? And what is the problem for the old implementation where we just use a flag?", "url": "https://github.com/apache/hbase/pull/1223#discussion_r385984153", "createdAt": "2020-02-29T00:56:23Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/util/ReadOnlyFSTableDescriptors.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hbase.util;\n+\n+import java.io.IOException;\n+\n+import org.apache.commons.lang3.NotImplementedException;\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.FileStatus;\n+import org.apache.hadoop.fs.FileSystem;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.hadoop.hbase.TableName;\n+import org.apache.hadoop.hbase.client.TableDescriptor;\n+import org.apache.yetus.audience.InterfaceAudience;\n+\n+@InterfaceAudience.Private\n+public class ReadOnlyFSTableDescriptors extends FSTableDescriptors {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "354fa73e495367ccdb3ae2b7319a3ac4bca9fe23"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk4OTI0NQ==", "bodyText": "Because FSTableDescriptor's constructer method throws IOException now. Let me open a new issue to refactor FSTableDescriptor firstly.", "url": "https://github.com/apache/hbase/pull/1223#discussion_r385989245", "createdAt": "2020-02-29T01:41:00Z", "author": {"login": "infraio"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/util/ReadOnlyFSTableDescriptors.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hbase.util;\n+\n+import java.io.IOException;\n+\n+import org.apache.commons.lang3.NotImplementedException;\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.FileStatus;\n+import org.apache.hadoop.fs.FileSystem;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.hadoop.hbase.TableName;\n+import org.apache.hadoop.hbase.client.TableDescriptor;\n+import org.apache.yetus.audience.InterfaceAudience;\n+\n+@InterfaceAudience.Private\n+public class ReadOnlyFSTableDescriptors extends FSTableDescriptors {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk4NDE1Mw=="}, "originalCommit": {"oid": "354fa73e495367ccdb3ae2b7319a3ac4bca9fe23"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk5MjQ0MQ==", "bodyText": "OK, in FSTableDescriptor we need to write the meta table descriptor to fs so it will throw an IOException. Got it. New issue is fine.", "url": "https://github.com/apache/hbase/pull/1223#discussion_r385992441", "createdAt": "2020-02-29T02:18:24Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/util/ReadOnlyFSTableDescriptors.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hbase.util;\n+\n+import java.io.IOException;\n+\n+import org.apache.commons.lang3.NotImplementedException;\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.FileStatus;\n+import org.apache.hadoop.fs.FileSystem;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.hadoop.hbase.TableName;\n+import org.apache.hadoop.hbase.client.TableDescriptor;\n+import org.apache.yetus.audience.InterfaceAudience;\n+\n+@InterfaceAudience.Private\n+public class ReadOnlyFSTableDescriptors extends FSTableDescriptors {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk4NDE1Mw=="}, "originalCommit": {"oid": "354fa73e495367ccdb3ae2b7319a3ac4bca9fe23"}, "originalPosition": 32}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2113, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}