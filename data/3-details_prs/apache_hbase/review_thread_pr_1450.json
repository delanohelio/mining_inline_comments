{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwNDA1Mjk2", "number": 1450, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNjowMTozMFrODwD0GQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMzozNzoxNVrODwM-_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNzIwNzI5OnYy", "diffSide": "RIGHT", "path": "dev-support/hbase-personality.sh", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNjowMTozMFrOGC2Fwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMTozMTowN1rOGDBugg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTYzNjU0Ng==", "bodyText": "I don't think this should be here. we want this proc limit change all the time, not just when the hadoopcheck test is enabled.", "url": "https://github.com/apache/hbase/pull/1450#discussion_r405636546", "createdAt": "2020-04-08T16:01:30Z", "author": {"login": "busbey"}, "path": "dev-support/hbase-personality.sh", "diffHunk": "@@ -513,6 +516,7 @@ function hadoopcheck_parse_args\n ## @stability    evolving\n function hadoopcheck_docker_support\n {\n+  DOCKER_EXTRAARGS=(\"${DOCKER_EXTRAARGS[@]}\" \"--ulimit\" \"nproc=12500\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da2beb832d5981a50f96f708341c1ace1ddf7b6f"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcwNDU3Ng==", "bodyText": "I don't follow. The new 12500 number is put everywhere, not just here conditional on when hadoopcheck runs. Thanks for taking a look.", "url": "https://github.com/apache/hbase/pull/1450#discussion_r405704576", "createdAt": "2020-04-08T17:48:47Z", "author": {"login": "saintstack"}, "path": "dev-support/hbase-personality.sh", "diffHunk": "@@ -513,6 +516,7 @@ function hadoopcheck_parse_args\n ## @stability    evolving\n function hadoopcheck_docker_support\n {\n+  DOCKER_EXTRAARGS=(\"${DOCKER_EXTRAARGS[@]}\" \"--ulimit\" \"nproc=12500\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTYzNjU0Ng=="}, "originalCommit": {"oid": "da2beb832d5981a50f96f708341c1ace1ddf7b6f"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTczMDYwNw==", "bodyText": "the reference you've added here is in the function that defines what is needed when we run docker specifically just when we're doing the hadoopcheck test.\nif we need it all the time, then it should be elsewhere. It looks it should be coming in from the YETUS_ARGS that have been added to the wrapper. If that's the case, then removing it here should have no impact on what happens. If removing it here makes it so things don't do what you expect, then something else is broken because the inclusion here is only going to happen when the hadoopcheck test is enabled.", "url": "https://github.com/apache/hbase/pull/1450#discussion_r405730607", "createdAt": "2020-04-08T18:32:51Z", "author": {"login": "busbey"}, "path": "dev-support/hbase-personality.sh", "diffHunk": "@@ -513,6 +516,7 @@ function hadoopcheck_parse_args\n ## @stability    evolving\n function hadoopcheck_docker_support\n {\n+  DOCKER_EXTRAARGS=(\"${DOCKER_EXTRAARGS[@]}\" \"--ulimit\" \"nproc=12500\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTYzNjU0Ng=="}, "originalCommit": {"oid": "da2beb832d5981a50f96f708341c1ace1ddf7b6f"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgyNzIwMg==", "bodyText": "Let me push new patch w/ your change. Thanks @busbey", "url": "https://github.com/apache/hbase/pull/1450#discussion_r405827202", "createdAt": "2020-04-08T21:31:07Z", "author": {"login": "saintstack"}, "path": "dev-support/hbase-personality.sh", "diffHunk": "@@ -513,6 +516,7 @@ function hadoopcheck_parse_args\n ## @stability    evolving\n function hadoopcheck_docker_support\n {\n+  DOCKER_EXTRAARGS=(\"${DOCKER_EXTRAARGS[@]}\" \"--ulimit\" \"nproc=12500\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTYzNjU0Ng=="}, "originalCommit": {"oid": "da2beb832d5981a50f96f708341c1ace1ddf7b6f"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxODY5MzI2OnYy", "diffSide": "RIGHT", "path": "dev-support/flaky-tests/flaky-reporting.Jenkinsfile", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMzoyOTowM1rOGDEeGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwMDoyODozOVrOGDFkBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg3MjE1Mw==", "bodyText": "Yikes. This is just hiding over here in the corner. TODO: update flaky reporting to use yetus to run builds.", "url": "https://github.com/apache/hbase/pull/1450#discussion_r405872153", "createdAt": "2020-04-08T23:29:03Z", "author": {"login": "ndimiduk"}, "path": "dev-support/flaky-tests/flaky-reporting.Jenkinsfile", "diffHunk": "@@ -43,7 +43,7 @@ pipeline {\n           flaky_args=(\"${flaky_args[@]}\" --urls \"${JENKINS_URL}/job/HBase%20Nightly/job/${BRANCH_NAME}\" --is-yetus True --max-builds 10)\n           flaky_args=(\"${flaky_args[@]}\" --urls \"${JENKINS_URL}/job/HBase-Flaky-Tests/job/${BRANCH_NAME}\" --is-yetus False --max-builds 30)\n           docker build -t hbase-dev-support dev-support\n-          docker run -v \"${WORKSPACE}\":/hbase --workdir=/hbase hbase-dev-support python dev-support/flaky-tests/report-flakies.py --mvn -v \"${flaky_args[@]}\"\n+          docker run --ulimit nproc=12500 -v \"${WORKSPACE}\":/hbase --workdir=/hbase hbase-dev-support python dev-support/flaky-tests/report-flakies.py --mvn -v \"${flaky_args[@]}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "baf2d8929e6c56deff5ee300631a9f432bd784b2"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg5MDA1NQ==", "bodyText": "Yeah, one way to run all builds would be sweet.", "url": "https://github.com/apache/hbase/pull/1450#discussion_r405890055", "createdAt": "2020-04-09T00:28:39Z", "author": {"login": "saintstack"}, "path": "dev-support/flaky-tests/flaky-reporting.Jenkinsfile", "diffHunk": "@@ -43,7 +43,7 @@ pipeline {\n           flaky_args=(\"${flaky_args[@]}\" --urls \"${JENKINS_URL}/job/HBase%20Nightly/job/${BRANCH_NAME}\" --is-yetus True --max-builds 10)\n           flaky_args=(\"${flaky_args[@]}\" --urls \"${JENKINS_URL}/job/HBase-Flaky-Tests/job/${BRANCH_NAME}\" --is-yetus False --max-builds 30)\n           docker build -t hbase-dev-support dev-support\n-          docker run -v \"${WORKSPACE}\":/hbase --workdir=/hbase hbase-dev-support python dev-support/flaky-tests/report-flakies.py --mvn -v \"${flaky_args[@]}\"\n+          docker run --ulimit nproc=12500 -v \"${WORKSPACE}\":/hbase --workdir=/hbase hbase-dev-support python dev-support/flaky-tests/report-flakies.py --mvn -v \"${flaky_args[@]}\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg3MjE1Mw=="}, "originalCommit": {"oid": "baf2d8929e6c56deff5ee300631a9f432bd784b2"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxODY5OTI0OnYy", "diffSide": "RIGHT", "path": "dev-support/hbase_docker.sh", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMzozMTo1OFrOGDEhig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMzozMTo1OFrOGDEhig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg3MzAzNA==", "bodyText": "Oh no, I didn't know this script existed. I probably broke it with the improvements that went in with HBASE-23945.", "url": "https://github.com/apache/hbase/pull/1450#discussion_r405873034", "createdAt": "2020-04-08T23:31:58Z", "author": {"login": "ndimiduk"}, "path": "dev-support/hbase_docker.sh", "diffHunk": "@@ -159,4 +159,4 @@ done\n echo \"Successfully built ${IMAGE_NAME}.\"\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "baf2d8929e6c56deff5ee300631a9f432bd784b2"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxODcwODI2OnYy", "diffSide": "RIGHT", "path": "dev-support/hbase-personality.sh", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMzozNjoyMlrOGDEnBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwMDoyOToxOFrOGDFkyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg3NDQzNw==", "bodyText": "Ah, yeah. In yetus, the env variable is PROC_LIMIT. You found a bug :)", "url": "https://github.com/apache/hbase/pull/1450#discussion_r405874437", "createdAt": "2020-04-08T23:36:22Z", "author": {"login": "ndimiduk"}, "path": "dev-support/hbase-personality.sh", "diffHunk": "@@ -81,8 +81,11 @@ function personality_globals\n \n   # Yetus 0.7.0 enforces limits. Default proclimit is 1000.\n   # Up it. See HBASE-19902 for how we arrived at this number.\n+  # NOTE: I don't think changing this has an effect. Set the\n+  # --proclimit passed to yetus. This seems to do what we\n+  # need changing proclimit.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "baf2d8929e6c56deff5ee300631a9f432bd784b2"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg5MDI1MA==", "bodyText": "Let me try filing an issue.", "url": "https://github.com/apache/hbase/pull/1450#discussion_r405890250", "createdAt": "2020-04-09T00:29:18Z", "author": {"login": "saintstack"}, "path": "dev-support/hbase-personality.sh", "diffHunk": "@@ -81,8 +81,11 @@ function personality_globals\n \n   # Yetus 0.7.0 enforces limits. Default proclimit is 1000.\n   # Up it. See HBASE-19902 for how we arrived at this number.\n+  # NOTE: I don't think changing this has an effect. Set the\n+  # --proclimit passed to yetus. This seems to do what we\n+  # need changing proclimit.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg3NDQzNw=="}, "originalCommit": {"oid": "baf2d8929e6c56deff5ee300631a9f432bd784b2"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxODcwOTQ1OnYy", "diffSide": "RIGHT", "path": "dev-support/hbase_nightly_yetus.sh", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMzozNzowNVrOGDEnyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwMDoyOTozOVrOGDFlJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg3NDYzNQ==", "bodyText": "If the above change for PROC_LIMIT works, this line can be dropped.", "url": "https://github.com/apache/hbase/pull/1450#discussion_r405874635", "createdAt": "2020-04-08T23:37:05Z", "author": {"login": "ndimiduk"}, "path": "dev-support/hbase_nightly_yetus.sh", "diffHunk": "@@ -66,7 +66,7 @@ YETUS_ARGS=(\"--branch=${BRANCH_NAME}\" \"${YETUS_ARGS[@]}\")\n YETUS_ARGS=(\"--tests-filter=${TESTS_FILTER}\" \"${YETUS_ARGS[@]}\")\n YETUS_ARGS=(\"--ignore-unknown-options=true\" \"${YETUS_ARGS[@]}\")\n # Why are these not being picked up from hbase-personality?\n-YETUS_ARGS=(\"--proclimit=10000\" \"${YETUS_ARGS[@]}\")\n+YETUS_ARGS=(\"--proclimit=12500\" \"${YETUS_ARGS[@]}\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "baf2d8929e6c56deff5ee300631a9f432bd784b2"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg5MDM0MA==", "bodyText": "Yeah. For now they needed. Let me file an issue.", "url": "https://github.com/apache/hbase/pull/1450#discussion_r405890340", "createdAt": "2020-04-09T00:29:39Z", "author": {"login": "saintstack"}, "path": "dev-support/hbase_nightly_yetus.sh", "diffHunk": "@@ -66,7 +66,7 @@ YETUS_ARGS=(\"--branch=${BRANCH_NAME}\" \"${YETUS_ARGS[@]}\")\n YETUS_ARGS=(\"--tests-filter=${TESTS_FILTER}\" \"${YETUS_ARGS[@]}\")\n YETUS_ARGS=(\"--ignore-unknown-options=true\" \"${YETUS_ARGS[@]}\")\n # Why are these not being picked up from hbase-personality?\n-YETUS_ARGS=(\"--proclimit=10000\" \"${YETUS_ARGS[@]}\")\n+YETUS_ARGS=(\"--proclimit=12500\" \"${YETUS_ARGS[@]}\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg3NDYzNQ=="}, "originalCommit": {"oid": "baf2d8929e6c56deff5ee300631a9f432bd784b2"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxODcwOTc0OnYy", "diffSide": "RIGHT", "path": "dev-support/jenkins_precommit_github_yetus.sh", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMzozNzoxNVrOGDEn9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMzozNzoxNVrOGDEn9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg3NDY3OA==", "bodyText": "likewise.", "url": "https://github.com/apache/hbase/pull/1450#discussion_r405874678", "createdAt": "2020-04-08T23:37:15Z", "author": {"login": "ndimiduk"}, "path": "dev-support/jenkins_precommit_github_yetus.sh", "diffHunk": "@@ -102,7 +102,7 @@ YETUS_ARGS+=(\"--reapermode=kill\")\n # set relatively high limits for ASF machines\n # changing these to higher values may cause problems\n # with other jobs on systemd-enabled machines\n-YETUS_ARGS+=(\"--proclimit=10000\")\n+YETUS_ARGS+=(\"--proclimit=12500\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "baf2d8929e6c56deff5ee300631a9f432bd784b2"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1879, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}