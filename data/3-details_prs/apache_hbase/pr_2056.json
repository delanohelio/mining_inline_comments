{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4MjI3NDYy", "number": 2056, "title": "HBASE-24710 Incorrect checksum calculation in saveVersion.sh", "bodyText": "", "createdAt": "2020-07-13T12:35:56Z", "url": "https://github.com/apache/hbase/pull/2056", "merged": true, "mergeCommit": {"oid": "ea96743dd29fe993fea216e42b3e76c0b3dc29ca"}, "closed": true, "closedAt": "2020-07-21T08:40:23Z", "author": {"login": "petersomogyi"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc0grktAH2gAyNDQ4MjI3NDYyOjY4NmUwNDE3NzY3NGRlNjU3YzVlZThhY2E2NTgwYzY1YTVhNTgxNjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc25emIAFqTQ1MjAwNTgzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "686e04177674de657c5ee8aca6580c65a5a58166", "author": {"user": {"login": "petersomogyi", "name": "Peter Somogyi"}}, "url": "https://github.com/apache/hbase/commit/686e04177674de657c5ee8aca6580c65a5a58166", "committedDate": "2020-07-13T12:34:42Z", "message": "HBASE-24710 Incorrect checksum calculation in saveVersion.sh"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5MTA2ODAx", "url": "https://github.com/apache/hbase/pull/2056#pullrequestreview-449106801", "createdAt": "2020-07-15T16:13:01Z", "commit": {"oid": "686e04177674de657c5ee8aca6580c65a5a58166"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNjoxMzowMVrOGyFRLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNjozMjowMVrOGyF-XA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2ODMwMA==", "bodyText": "I think dropping the | between sort and xargs is a bug. I believe this calculates the sha512 of the sort error message, not the sha512 of the sha512s of the contents of all the files.\nOn a mac anyway, I get\n$ find hbase-common/src/main/ | grep -e \"\\.java\" | LC_ALL=C sort xargs gpg --print-md sha512\nsort: unrecognized option `--print-md'\nUsage: sort [-bcCdfigMmnrsuz] [-kPOS1[,POS2] ... ] [+POS1 [-POS2]] [-S memsize] [-T tmpdir] [-t separator] [-o outfile] [--batch-size size] [--files0-from file] [--heapsort] [--mergesort] [--radixsort] [--qsort] [--mmap] [--parallel thread_no] [--human-numeric-sort] [--version-sort] [--random-sort [--random-source file]] [--compress-program program] [file ...]\n$ find hbase-common/src/main/ | grep -e \"\\.java\" | LC_ALL=C sort xargs openssl dgst -sha512\nsort: invalid option -- a\nUsage: sort [-bcCdfigMmnrsuz] [-kPOS1[,POS2] ... ] [+POS1 [-POS2]] [-S memsize] [-T tmpdir] [-t separator] [-o outfile] [--batch-size size] [--files0-from file] [--heapsort] [--mergesort] [--radixsort] [--qsort] [--mmap] [--parallel thread_no] [--human-numeric-sort] [--version-sort] [--random-sort [--random-source file]] [--compress-program program] [file ...]", "url": "https://github.com/apache/hbase/pull/2056#discussion_r455168300", "createdAt": "2020-07-15T16:13:01Z", "author": {"login": "ndimiduk"}, "path": "hbase-common/src/saveVersion.sh", "diffHunk": "@@ -30,34 +30,34 @@ nativeOutputDirectory=\"$2/native/utils/\"\n pushd .\n cd ..\n \n-user=`whoami | sed -n -e 's/\\\\\\/\\\\\\\\\\\\\\\\/p'`\n+user=$(whoami | sed -n -e \"s/\\\\\\/\\\\\\\\\\\\\\\\/p\")\n if [ \"$user\" == \"\" ]\n then\n-  user=`whoami`\n+  user=$(whoami)\n fi\n-date=`date`\n-cwd=`pwd`\n+date=$(date)\n+cwd=$(pwd)\n if [ -d .svn ]; then\n-  revision=`(svn info | sed -n -e 's/Last Changed Rev: \\(.*\\)/\\1/p') || true`\n-  url=`(svn info | sed -n -e 's/^URL: \\(.*\\)/\\1/p') || true`\n+  revision=$( (svn info | sed -n -e \"s/Last Changed Rev: \\(.*\\)/\\1/p\") || true)\n+  url=$( (svn info | sed -n -e 's/^URL: \\(.*\\)/\\1/p') || true)\n elif [ -d .git ]; then\n-  revision=`git log -1 --no-show-signature --pretty=format:\"%H\" || true`\n-  hostname=`hostname`\n+  revision=$(git log -1 --no-show-signature --pretty=format:\"%H\" || true)\n+  hostname=$(hostname)\n   url=\"git://${hostname}${cwd}\"\n fi\n if [ -z \"${revision}\" ]; then\n   echo \"[WARN] revision info is empty! either we're not in VCS or VCS commands failed.\" >&2\n   revision=\"Unknown\"\n   url=\"file://$cwd\"\n fi\n-if ! [  -x \"$(command -v openssl)\" ]; then\n+if ! [ -x \"$(command -v openssl)\" ]; then\n   if ! [ -x \"$(command -v gpg)\" ]; then\n     srcChecksum=\"Unknown\"\n   else\n-    srcChecksum=`find hbase-*/src/main/ | grep -e \"\\.java\" -e \"\\.proto\" | LC_ALL=C sort | xargs gpg --print-md sha512 | gpg --print-md sha512 | cut -d ' ' -f 1`\n+    srcChecksum=$(find hbase-*/src/main/ | grep -e \"\\.java\" -e \"\\.proto\" | LC_ALL=C sort xargs gpg --print-md sha512 | gpg --print-md sha512 | tr '\\n' ' ' | sed 's/[[:space:]]*//g')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "686e04177674de657c5ee8aca6580c65a5a58166"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE3NzcxNQ==", "bodyText": "Previous use of cut here at the end is surprising. It took only the first block...", "url": "https://github.com/apache/hbase/pull/2056#discussion_r455177715", "createdAt": "2020-07-15T16:28:38Z", "author": {"login": "ndimiduk"}, "path": "hbase-common/src/saveVersion.sh", "diffHunk": "@@ -30,34 +30,34 @@ nativeOutputDirectory=\"$2/native/utils/\"\n pushd .\n cd ..\n \n-user=`whoami | sed -n -e 's/\\\\\\/\\\\\\\\\\\\\\\\/p'`\n+user=$(whoami | sed -n -e \"s/\\\\\\/\\\\\\\\\\\\\\\\/p\")\n if [ \"$user\" == \"\" ]\n then\n-  user=`whoami`\n+  user=$(whoami)\n fi\n-date=`date`\n-cwd=`pwd`\n+date=$(date)\n+cwd=$(pwd)\n if [ -d .svn ]; then\n-  revision=`(svn info | sed -n -e 's/Last Changed Rev: \\(.*\\)/\\1/p') || true`\n-  url=`(svn info | sed -n -e 's/^URL: \\(.*\\)/\\1/p') || true`\n+  revision=$( (svn info | sed -n -e \"s/Last Changed Rev: \\(.*\\)/\\1/p\") || true)\n+  url=$( (svn info | sed -n -e 's/^URL: \\(.*\\)/\\1/p') || true)\n elif [ -d .git ]; then\n-  revision=`git log -1 --no-show-signature --pretty=format:\"%H\" || true`\n-  hostname=`hostname`\n+  revision=$(git log -1 --no-show-signature --pretty=format:\"%H\" || true)\n+  hostname=$(hostname)\n   url=\"git://${hostname}${cwd}\"\n fi\n if [ -z \"${revision}\" ]; then\n   echo \"[WARN] revision info is empty! either we're not in VCS or VCS commands failed.\" >&2\n   revision=\"Unknown\"\n   url=\"file://$cwd\"\n fi\n-if ! [  -x \"$(command -v openssl)\" ]; then\n+if ! [ -x \"$(command -v openssl)\" ]; then\n   if ! [ -x \"$(command -v gpg)\" ]; then\n     srcChecksum=\"Unknown\"\n   else\n-    srcChecksum=`find hbase-*/src/main/ | grep -e \"\\.java\" -e \"\\.proto\" | LC_ALL=C sort | xargs gpg --print-md sha512 | gpg --print-md sha512 | cut -d ' ' -f 1`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "686e04177674de657c5ee8aca6580c65a5a58166"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE3OTg2OA==", "bodyText": "what is the purpose of the final sed? I see no difference.\n$ echo \"foo\" | openssl dgst -sha512 | sed 's/^.* //'\n0cf9180a764aba863a67b6d72f0918bc131c6772642cb2dce5a34f0a702f9470ddc2bf125c12198b1995c233c34b4afd346c54a2334c350a948a51b6e8b4e6b6\n$ echo \"foo\" | openssl dgst -sha512\n0cf9180a764aba863a67b6d72f0918bc131c6772642cb2dce5a34f0a702f9470ddc2bf125c12198b1995c233c34b4afd346c54a2334c350a948a51b6e8b4e6b6", "url": "https://github.com/apache/hbase/pull/2056#discussion_r455179868", "createdAt": "2020-07-15T16:32:01Z", "author": {"login": "ndimiduk"}, "path": "hbase-common/src/saveVersion.sh", "diffHunk": "@@ -30,34 +30,34 @@ nativeOutputDirectory=\"$2/native/utils/\"\n pushd .\n cd ..\n \n-user=`whoami | sed -n -e 's/\\\\\\/\\\\\\\\\\\\\\\\/p'`\n+user=$(whoami | sed -n -e \"s/\\\\\\/\\\\\\\\\\\\\\\\/p\")\n if [ \"$user\" == \"\" ]\n then\n-  user=`whoami`\n+  user=$(whoami)\n fi\n-date=`date`\n-cwd=`pwd`\n+date=$(date)\n+cwd=$(pwd)\n if [ -d .svn ]; then\n-  revision=`(svn info | sed -n -e 's/Last Changed Rev: \\(.*\\)/\\1/p') || true`\n-  url=`(svn info | sed -n -e 's/^URL: \\(.*\\)/\\1/p') || true`\n+  revision=$( (svn info | sed -n -e \"s/Last Changed Rev: \\(.*\\)/\\1/p\") || true)\n+  url=$( (svn info | sed -n -e 's/^URL: \\(.*\\)/\\1/p') || true)\n elif [ -d .git ]; then\n-  revision=`git log -1 --no-show-signature --pretty=format:\"%H\" || true`\n-  hostname=`hostname`\n+  revision=$(git log -1 --no-show-signature --pretty=format:\"%H\" || true)\n+  hostname=$(hostname)\n   url=\"git://${hostname}${cwd}\"\n fi\n if [ -z \"${revision}\" ]; then\n   echo \"[WARN] revision info is empty! either we're not in VCS or VCS commands failed.\" >&2\n   revision=\"Unknown\"\n   url=\"file://$cwd\"\n fi\n-if ! [  -x \"$(command -v openssl)\" ]; then\n+if ! [ -x \"$(command -v openssl)\" ]; then\n   if ! [ -x \"$(command -v gpg)\" ]; then\n     srcChecksum=\"Unknown\"\n   else\n-    srcChecksum=`find hbase-*/src/main/ | grep -e \"\\.java\" -e \"\\.proto\" | LC_ALL=C sort | xargs gpg --print-md sha512 | gpg --print-md sha512 | cut -d ' ' -f 1`\n+    srcChecksum=$(find hbase-*/src/main/ | grep -e \"\\.java\" -e \"\\.proto\" | LC_ALL=C sort xargs gpg --print-md sha512 | gpg --print-md sha512 | tr '\\n' ' ' | sed 's/[[:space:]]*//g')\n   fi\n else\n-  srcChecksum=`find hbase-*/src/main/ | grep -e \"\\.java\" -e \"\\.proto\" | LC_ALL=C sort | xargs openssl dgst -sha512 | openssl dgst -sha512 | cut -d ' ' -f 1`\n+  srcChecksum=$(find hbase-*/src/main/ | grep -e \"\\.java\" -e \"\\.proto\" | LC_ALL=C sort xargs openssl dgst -sha512 | openssl dgst -sha512 | sed 's/^.* //')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "686e04177674de657c5ee8aca6580c65a5a58166"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73f809afd0569d6b696d54ea2724f8568c98ce67", "author": {"user": {"login": "petersomogyi", "name": "Peter Somogyi"}}, "url": "https://github.com/apache/hbase/commit/73f809afd0569d6b696d54ea2724f8568c98ce67", "committedDate": "2020-07-15T17:01:52Z", "message": "Add missing pipe"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyMDA1ODMw", "url": "https://github.com/apache/hbase/pull/2056#pullrequestreview-452005830", "createdAt": "2020-07-20T22:36:00Z", "commit": {"oid": "73f809afd0569d6b696d54ea2724f8568c98ce67"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4252, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}