{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI1MDkyNjE4", "number": 2688, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQxNzo1Njo0MVrOE74Q6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQxNzo1OTo1MlrOE74R1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxMjIzMjcyOnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQxNzo1Njo0MVrOH3wO0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMlQwODo1Nzo0M1rOH31IgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODIyMzk1Mg==", "bodyText": "nit: if debug log is not that imp, this could be replaced with few lines of code using for-each and lambda:\n      replicationLoadSources.forEach(replicationLoadSource -> Optional\n        .ofNullable(replicationLoadSourceMap.get(replicationLoadSource.getPeerID()))\n        .ifPresent(pairs -> pairs.add(new Pair<>(serverName, replicationLoadSource))));\n\nHowever, if debug log is imp, feel free to ignore this nit.", "url": "https://github.com/apache/hbase/pull/2688#discussion_r528223952", "createdAt": "2020-11-21T17:56:41Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java", "diffHunk": "@@ -3621,8 +3621,15 @@ public ReplicationPeerManager getReplicationPeerManager() {\n       List<ReplicationLoadSource> replicationLoadSources =\n           getServerManager().getLoad(serverName).getReplicationLoadSourceList();\n       for (ReplicationLoadSource replicationLoadSource : replicationLoadSources) {\n-        replicationLoadSourceMap.get(replicationLoadSource.getPeerID())\n-            .add(new Pair<>(serverName, replicationLoadSource));\n+        List<Pair<ServerName, ReplicationLoadSource>> replicationLoadSourceList =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02368d95378df7d4fd6132f35c47079d86c2ae3e"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODI2NDg3OQ==", "bodyText": "yes, but i think log help understand the current code logic\nIf lambda is necessary, I can update the code", "url": "https://github.com/apache/hbase/pull/2688#discussion_r528264879", "createdAt": "2020-11-22T01:12:11Z", "author": {"login": "cuibo01"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java", "diffHunk": "@@ -3621,8 +3621,15 @@ public ReplicationPeerManager getReplicationPeerManager() {\n       List<ReplicationLoadSource> replicationLoadSources =\n           getServerManager().getLoad(serverName).getReplicationLoadSourceList();\n       for (ReplicationLoadSource replicationLoadSource : replicationLoadSources) {\n-        replicationLoadSourceMap.get(replicationLoadSource.getPeerID())\n-            .add(new Pair<>(serverName, replicationLoadSource));\n+        List<Pair<ServerName, ReplicationLoadSource>> replicationLoadSourceList =", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODIyMzk1Mg=="}, "originalCommit": {"oid": "02368d95378df7d4fd6132f35c47079d86c2ae3e"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODMwNDI1Nw==", "bodyText": "Sounds good.\nThanks", "url": "https://github.com/apache/hbase/pull/2688#discussion_r528304257", "createdAt": "2020-11-22T08:57:43Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java", "diffHunk": "@@ -3621,8 +3621,15 @@ public ReplicationPeerManager getReplicationPeerManager() {\n       List<ReplicationLoadSource> replicationLoadSources =\n           getServerManager().getLoad(serverName).getReplicationLoadSourceList();\n       for (ReplicationLoadSource replicationLoadSource : replicationLoadSources) {\n-        replicationLoadSourceMap.get(replicationLoadSource.getPeerID())\n-            .add(new Pair<>(serverName, replicationLoadSource));\n+        List<Pair<ServerName, ReplicationLoadSource>> replicationLoadSourceList =", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODIyMzk1Mg=="}, "originalCommit": {"oid": "02368d95378df7d4fd6132f35c47079d86c2ae3e"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxMjIzNTA5OnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQxNzo1OTo1MlrOH3wP9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQxNzo1OTo1MlrOH3wP9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODIyNDI0NQ==", "bodyText": "Please use placeholder in log with argument: LOG.debug(\"{} does not exist,.....\", replicationLoadSource.getPeerID());", "url": "https://github.com/apache/hbase/pull/2688#discussion_r528224245", "createdAt": "2020-11-21T17:59:52Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java", "diffHunk": "@@ -3621,8 +3621,15 @@ public ReplicationPeerManager getReplicationPeerManager() {\n       List<ReplicationLoadSource> replicationLoadSources =\n           getServerManager().getLoad(serverName).getReplicationLoadSourceList();\n       for (ReplicationLoadSource replicationLoadSource : replicationLoadSources) {\n-        replicationLoadSourceMap.get(replicationLoadSource.getPeerID())\n-            .add(new Pair<>(serverName, replicationLoadSource));\n+        List<Pair<ServerName, ReplicationLoadSource>> replicationLoadSourceList =\n+          replicationLoadSourceMap.get(replicationLoadSource.getPeerID());\n+        if (replicationLoadSourceList == null) {\n+          LOG.debug(replicationLoadSource.getPeerID() + \" does not exist, but it exists \"\n+            + \"in znode(/hbase/replication/rs). when the rs restarts, peerId is deleted, so \"\n+            + \"we just need to ignore it\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02368d95378df7d4fd6132f35c47079d86c2ae3e"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2293, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}