{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4MDM2NDE2", "number": 2162, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQyMDo0MDo1MlrOES--lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwODo0NTowNVrOETKA_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4MzQxNjU1OnYy", "diffSide": "RIGHT", "path": "hbase-mapreduce/src/main/java/org/apache/hadoop/hbase/mapreduce/TableOutputFormat.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQyMDo0MDo1MlrOG4eAQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQyMDo0MDo1MlrOG4eAQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg2NTAyNg==", "bodyText": "nit: Check-style might flag this for bad indentation (needs nested indent)", "url": "https://github.com/apache/hbase/pull/2162#discussion_r461865026", "createdAt": "2020-07-28T20:40:52Z", "author": {"login": "bharathv"}, "path": "hbase-mapreduce/src/main/java/org/apache/hadoop/hbase/mapreduce/TableOutputFormat.java", "diffHunk": "@@ -155,11 +155,10 @@ public void write(KEY key, Mutation value)\n    * @param context  The current task context.\n    * @return The newly created writer instance.\n    * @throws IOException When creating the writer fails.\n-   * @throws InterruptedException When the jobs is cancelled.\n    */\n   @Override\n   public RecordWriter<KEY, Mutation> getRecordWriter(TaskAttemptContext context)\n-  throws IOException, InterruptedException {\n+  throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "568eb12a49c5c1d5a5813fb1d5bcf1c2e933ccf2"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4MzQxOTYyOnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/util/ServerRegionReplicaUtil.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQyMDo0MTo0MVrOG4eCIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQyMDo0MTo0MVrOG4eCIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg2NTUwNg==", "bodyText": "nit: remove extra newline", "url": "https://github.com/apache/hbase/pull/2162#discussion_r461865506", "createdAt": "2020-07-28T20:41:41Z", "author": {"login": "bharathv"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/util/ServerRegionReplicaUtil.java", "diffHunk": "@@ -161,25 +162,27 @@ public static void setupRegionReplicaReplication(Configuration conf) throws IOEx\n     if (!isRegionReplicaReplicationEnabled(conf)) {\n       return;\n     }\n-    Admin admin = ConnectionFactory.createConnection(conf).getAdmin();\n-    ReplicationPeerConfig peerConfig = null;\n-    try {\n-      peerConfig = admin.getReplicationPeerConfig(REGION_REPLICA_REPLICATION_PEER);\n-    } catch (ReplicationPeerNotFoundException e) {\n-      LOG.warn(\"Region replica replication peer id=\" + REGION_REPLICA_REPLICATION_PEER\n-          + \" not exist\", e);\n-    }\n-    try {\n+\n+    try (Connection connection = ConnectionFactory.createConnection(conf);\n+      Admin admin = connection.getAdmin()) {\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "568eb12a49c5c1d5a5813fb1d5bcf1c2e933ccf2"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4MzQyMDk5OnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/util/ServerRegionReplicaUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQyMDo0MjowMlrOG4eC8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQyMDo0MjowMlrOG4eC8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg2NTcxMg==", "bodyText": "nit: can be condensed to fewer lines.", "url": "https://github.com/apache/hbase/pull/2162#discussion_r461865712", "createdAt": "2020-07-28T20:42:02Z", "author": {"login": "bharathv"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/util/ServerRegionReplicaUtil.java", "diffHunk": "@@ -161,25 +162,27 @@ public static void setupRegionReplicaReplication(Configuration conf) throws IOEx\n     if (!isRegionReplicaReplicationEnabled(conf)) {\n       return;\n     }\n-    Admin admin = ConnectionFactory.createConnection(conf).getAdmin();\n-    ReplicationPeerConfig peerConfig = null;\n-    try {\n-      peerConfig = admin.getReplicationPeerConfig(REGION_REPLICA_REPLICATION_PEER);\n-    } catch (ReplicationPeerNotFoundException e) {\n-      LOG.warn(\"Region replica replication peer id=\" + REGION_REPLICA_REPLICATION_PEER\n-          + \" not exist\", e);\n-    }\n-    try {\n+\n+    try (Connection connection = ConnectionFactory.createConnection(conf);\n+      Admin admin = connection.getAdmin()) {\n+\n+      ReplicationPeerConfig peerConfig = null;\n+      try {\n+        peerConfig = admin.getReplicationPeerConfig(REGION_REPLICA_REPLICATION_PEER);\n+      } catch (ReplicationPeerNotFoundException e) {\n+        LOG.warn(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "568eb12a49c5c1d5a5813fb1d5bcf1c2e933ccf2"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4Mzk5MzU1OnYy", "diffSide": "RIGHT", "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestClearRegionBlockCache.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQyMzozNjoyOVrOG4jZDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQyMzozNjoyOVrOG4jZDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk1MzI5Mw==", "bodyText": "this should be a try-with-resources too?", "url": "https://github.com/apache/hbase/pull/2162#discussion_r461953293", "createdAt": "2020-07-28T23:36:29Z", "author": {"login": "bharathv"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestClearRegionBlockCache.java", "diffHunk": "@@ -149,8 +150,8 @@ public void testClearBlockCacheFromAdmin() throws Exception {\n \n   @Test\n   public void testClearBlockCacheFromAsyncAdmin() throws Exception {\n-    AsyncAdmin admin =\n-        ConnectionFactory.createAsyncConnection(HTU.getConfiguration()).get().getAdmin();\n+    AsyncConnection conn = ConnectionFactory.createAsyncConnection(HTU.getConfiguration()).get();\n+    AsyncAdmin admin = conn.getAdmin();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c065a8c46a89244329e93b5e09c7a91d75b2b74"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NTIyNDkzOnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/util/ServerRegionReplicaUtil.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwODo0NTowNVrOG4utpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwODo0Nzo1N1rOG4u0dA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjEzODc4OA==", "bodyText": "If we catch this Exception, don't we want to create replication peer id?\nWe can model this with:\ntry(closeables){\n  try{\n    peerConfig = admin.getReplicationPeerConfig(REGION_REPLICA_REPLICATION_PEER);\n  } catch (ReplicationPeerNotFoundException e){\n  }\n  if (peerConfig == null) {\n    .....\n  }\n}", "url": "https://github.com/apache/hbase/pull/2162#discussion_r462138788", "createdAt": "2020-07-29T08:45:05Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/util/ServerRegionReplicaUtil.java", "diffHunk": "@@ -161,25 +162,24 @@ public static void setupRegionReplicaReplication(Configuration conf) throws IOEx\n     if (!isRegionReplicaReplicationEnabled(conf)) {\n       return;\n     }\n-    Admin admin = ConnectionFactory.createConnection(conf).getAdmin();\n-    ReplicationPeerConfig peerConfig = null;\n-    try {\n+\n+    try (Connection connection = ConnectionFactory.createConnection(conf);\n+      Admin admin = connection.getAdmin()) {\n+      ReplicationPeerConfig peerConfig = null;\n       peerConfig = admin.getReplicationPeerConfig(REGION_REPLICA_REPLICATION_PEER);\n-    } catch (ReplicationPeerNotFoundException e) {\n-      LOG.warn(\"Region replica replication peer id=\" + REGION_REPLICA_REPLICATION_PEER\n-          + \" not exist\", e);\n-    }\n-    try {\n+\n       if (peerConfig == null) {\n         LOG.info(\"Region replica replication peer id=\" + REGION_REPLICA_REPLICATION_PEER\n-            + \" not exist. Creating...\");\n+          + \" not exist. Creating...\");\n         peerConfig = new ReplicationPeerConfig();\n         peerConfig.setClusterKey(ZKConfig.getZooKeeperClusterKey(conf));\n         peerConfig.setReplicationEndpointImpl(RegionReplicaReplicationEndpoint.class.getName());\n         admin.addReplicationPeer(REGION_REPLICA_REPLICATION_PEER, peerConfig);\n       }\n-    } finally {\n-      admin.close();\n+    } catch (ReplicationPeerNotFoundException e) {\n+      LOG.warn(\n+        \"Region replica replication peer id=\" + REGION_REPLICA_REPLICATION_PEER + \" not exist\",\n+        e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b445adc31c83ed1c461202e851f21cee9cb483a"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjE0MDUzMg==", "bodyText": "yeah, I was about to submit the change for this.", "url": "https://github.com/apache/hbase/pull/2162#discussion_r462140532", "createdAt": "2020-07-29T08:47:57Z", "author": {"login": "sandeepvinayak"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/util/ServerRegionReplicaUtil.java", "diffHunk": "@@ -161,25 +162,24 @@ public static void setupRegionReplicaReplication(Configuration conf) throws IOEx\n     if (!isRegionReplicaReplicationEnabled(conf)) {\n       return;\n     }\n-    Admin admin = ConnectionFactory.createConnection(conf).getAdmin();\n-    ReplicationPeerConfig peerConfig = null;\n-    try {\n+\n+    try (Connection connection = ConnectionFactory.createConnection(conf);\n+      Admin admin = connection.getAdmin()) {\n+      ReplicationPeerConfig peerConfig = null;\n       peerConfig = admin.getReplicationPeerConfig(REGION_REPLICA_REPLICATION_PEER);\n-    } catch (ReplicationPeerNotFoundException e) {\n-      LOG.warn(\"Region replica replication peer id=\" + REGION_REPLICA_REPLICATION_PEER\n-          + \" not exist\", e);\n-    }\n-    try {\n+\n       if (peerConfig == null) {\n         LOG.info(\"Region replica replication peer id=\" + REGION_REPLICA_REPLICATION_PEER\n-            + \" not exist. Creating...\");\n+          + \" not exist. Creating...\");\n         peerConfig = new ReplicationPeerConfig();\n         peerConfig.setClusterKey(ZKConfig.getZooKeeperClusterKey(conf));\n         peerConfig.setReplicationEndpointImpl(RegionReplicaReplicationEndpoint.class.getName());\n         admin.addReplicationPeer(REGION_REPLICA_REPLICATION_PEER, peerConfig);\n       }\n-    } finally {\n-      admin.close();\n+    } catch (ReplicationPeerNotFoundException e) {\n+      LOG.warn(\n+        \"Region replica replication peer id=\" + REGION_REPLICA_REPLICATION_PEER + \" not exist\",\n+        e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjEzODc4OA=="}, "originalCommit": {"oid": "6b445adc31c83ed1c461202e851f21cee9cb483a"}, "originalPosition": 40}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2717, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}