{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5MDUxMDAx", "number": 1724, "title": "HBASE-24386 TableSnapshotScanner support scan limit", "bodyText": "", "createdAt": "2020-05-17T02:35:00Z", "url": "https://github.com/apache/hbase/pull/1724", "merged": true, "mergeCommit": {"oid": "8f4c255b386e892383ad4e001befece7fa922fd6"}, "closed": true, "closedAt": "2020-05-19T15:22:30Z", "author": {"login": "nyl3532016"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABciCsILgBqjMzNDQxNDI2NDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcibuptAFqTQxMzM4MzI1MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "578fa06a4de2c1e52fea0e93ebf9fd18a15ce403", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/578fa06a4de2c1e52fea0e93ebf9fd18a15ce403", "committedDate": "2020-05-17T02:33:17Z", "message": "HBASE-24386 TableSnapshotScanner support scan limit"}, "afterCommit": {"oid": "149c4ee1d95b8a5c58a093548b1023ee72518964", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/149c4ee1d95b8a5c58a093548b1023ee72518964", "committedDate": "2020-05-17T03:20:58Z", "message": "HBASE-24386 TableSnapshotScanner support scan limit"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMTQwMDU4", "url": "https://github.com/apache/hbase/pull/1724#pullrequestreview-413140058", "createdAt": "2020-05-17T08:40:03Z", "commit": {"oid": "149c4ee1d95b8a5c58a093548b1023ee72518964"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QwODo0MDowM1rOGWfRkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QwODo0MDowM1rOGWfRkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIzNDI1Nw==", "bodyText": "Please use assertTrue or assertEquals.", "url": "https://github.com/apache/hbase/pull/1724#discussion_r426234257", "createdAt": "2020-05-17T08:40:03Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestTableSnapshotScanner.java", "diffHunk": "@@ -190,6 +190,36 @@ public void testNoDuplicateResultsWhenSplitting() throws Exception {\n     }\n   }\n \n+\n+  @Test\n+  public void testScanLimit() throws Exception {\n+    setupCluster();\n+    TableName tableName = TableName.valueOf(\"testScanLimit\");\n+    String snapshotName = \"testScanLimitSnapshot\";\n+    try {\n+      createTableAndSnapshot(UTIL, tableName, snapshotName, 50);\n+      Path restoreDir = UTIL.getDataTestDirOnTestFS(snapshotName);\n+      Scan scan = new Scan().withStartRow(bbb).setLimit(100); // limit the scan\n+\n+      TableSnapshotScanner scanner =\n+          new TableSnapshotScanner(UTIL.getConfiguration(), restoreDir, snapshotName, scan);\n+      int count = 0;\n+      while (true) {\n+        Result result = scanner.next();\n+        if (result == null) {\n+          break;\n+        }\n+        count++;\n+      }\n+      assert (100 == count);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "149c4ee1d95b8a5c58a093548b1023ee72518964"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMTQ1MDE1", "url": "https://github.com/apache/hbase/pull/1724#pullrequestreview-413145015", "createdAt": "2020-05-17T09:45:25Z", "commit": {"oid": "149c4ee1d95b8a5c58a093548b1023ee72518964"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QwOTo0NToyNlrOGWfovQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QwOTo0NzoyNlrOGWfpSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI0MDE4OQ==", "bodyText": "Please introduce a rule for the table name\n@Rule\npublic TestName name = new TestName();\n\nAnd use it like this\nfinal TableName tableName = TableName.valueOf(name.getMethodName());", "url": "https://github.com/apache/hbase/pull/1724#discussion_r426240189", "createdAt": "2020-05-17T09:45:26Z", "author": {"login": "HorizonNet"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestTableSnapshotScanner.java", "diffHunk": "@@ -190,6 +190,36 @@ public void testNoDuplicateResultsWhenSplitting() throws Exception {\n     }\n   }\n \n+\n+  @Test\n+  public void testScanLimit() throws Exception {\n+    setupCluster();\n+    TableName tableName = TableName.valueOf(\"testScanLimit\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "149c4ee1d95b8a5c58a093548b1023ee72518964"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI0MDMzMA==", "bodyText": "I would prefer assertEquals in that case.", "url": "https://github.com/apache/hbase/pull/1724#discussion_r426240330", "createdAt": "2020-05-17T09:47:26Z", "author": {"login": "HorizonNet"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestTableSnapshotScanner.java", "diffHunk": "@@ -190,6 +190,36 @@ public void testNoDuplicateResultsWhenSplitting() throws Exception {\n     }\n   }\n \n+\n+  @Test\n+  public void testScanLimit() throws Exception {\n+    setupCluster();\n+    TableName tableName = TableName.valueOf(\"testScanLimit\");\n+    String snapshotName = \"testScanLimitSnapshot\";\n+    try {\n+      createTableAndSnapshot(UTIL, tableName, snapshotName, 50);\n+      Path restoreDir = UTIL.getDataTestDirOnTestFS(snapshotName);\n+      Scan scan = new Scan().withStartRow(bbb).setLimit(100); // limit the scan\n+\n+      TableSnapshotScanner scanner =\n+          new TableSnapshotScanner(UTIL.getConfiguration(), restoreDir, snapshotName, scan);\n+      int count = 0;\n+      while (true) {\n+        Result result = scanner.next();\n+        if (result == null) {\n+          break;\n+        }\n+        count++;\n+      }\n+      assert (100 == count);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIzNDI1Nw=="}, "originalCommit": {"oid": "149c4ee1d95b8a5c58a093548b1023ee72518964"}, "originalPosition": 25}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "149c4ee1d95b8a5c58a093548b1023ee72518964", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/149c4ee1d95b8a5c58a093548b1023ee72518964", "committedDate": "2020-05-17T03:20:58Z", "message": "HBASE-24386 TableSnapshotScanner support scan limit"}, "afterCommit": {"oid": "4f0b79ecde3aa7e6ce3ff7d61fa24e1e3962f50f", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/4f0b79ecde3aa7e6ce3ff7d61fa24e1e3962f50f", "committedDate": "2020-05-17T11:13:01Z", "message": "HBASE-24386 TableSnapshotScanner support scan limit"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMTYxMTYw", "url": "https://github.com/apache/hbase/pull/1724#pullrequestreview-413161160", "createdAt": "2020-05-17T13:09:55Z", "commit": {"oid": "4f0b79ecde3aa7e6ce3ff7d61fa24e1e3962f50f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMTY5MTI2", "url": "https://github.com/apache/hbase/pull/1724#pullrequestreview-413169126", "createdAt": "2020-05-17T14:39:29Z", "commit": {"oid": "4f0b79ecde3aa7e6ce3ff7d61fa24e1e3962f50f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QxNDozOToyOVrOGWhZVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QxNDozOToyOVrOGWhZVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI2OTAxNA==", "bodyText": "Can we move scanner.close() in finally? We can definte TableSnapshotScanner scanner=null outside of try {}, and in finally, we can check if scanner is not null, then close it.", "url": "https://github.com/apache/hbase/pull/1724#discussion_r426269014", "createdAt": "2020-05-17T14:39:29Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestTableSnapshotScanner.java", "diffHunk": "@@ -190,6 +195,36 @@ public void testNoDuplicateResultsWhenSplitting() throws Exception {\n     }\n   }\n \n+\n+  @Test\n+  public void testScanLimit() throws Exception {\n+    setupCluster();\n+    final TableName tableName = TableName.valueOf(name.getMethodName());\n+    final String snapshotName = tableName + \"Snapshot\";\n+    try {\n+      createTableAndSnapshot(UTIL, tableName, snapshotName, 50);\n+      Path restoreDir = UTIL.getDataTestDirOnTestFS(snapshotName);\n+      Scan scan = new Scan().withStartRow(bbb).setLimit(100); // limit the scan\n+\n+      TableSnapshotScanner scanner =\n+          new TableSnapshotScanner(UTIL.getConfiguration(), restoreDir, snapshotName, scan);\n+      int count = 0;\n+      while (true) {\n+        Result result = scanner.next();\n+        if (result == null) {\n+          break;\n+        }\n+        count++;\n+      }\n+      Assert.assertEquals(100, count);\n+      scanner.close();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f0b79ecde3aa7e6ce3ff7d61fa24e1e3962f50f"}, "originalPosition": 47}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47e5eb5792ccdb276597744cc86d194813adc149", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/47e5eb5792ccdb276597744cc86d194813adc149", "committedDate": "2020-05-18T06:45:59Z", "message": "HBASE-24386 TableSnapshotScanner support scan limit"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4f0b79ecde3aa7e6ce3ff7d61fa24e1e3962f50f", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/4f0b79ecde3aa7e6ce3ff7d61fa24e1e3962f50f", "committedDate": "2020-05-17T11:13:01Z", "message": "HBASE-24386 TableSnapshotScanner support scan limit"}, "afterCommit": {"oid": "47e5eb5792ccdb276597744cc86d194813adc149", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/47e5eb5792ccdb276597744cc86d194813adc149", "committedDate": "2020-05-18T06:45:59Z", "message": "HBASE-24386 TableSnapshotScanner support scan limit"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMzgzMjUw", "url": "https://github.com/apache/hbase/pull/1724#pullrequestreview-413383250", "createdAt": "2020-05-18T08:37:54Z", "commit": {"oid": "47e5eb5792ccdb276597744cc86d194813adc149"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4633, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}