{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3ODIwNTY4", "number": 1852, "title": "HBASE-24505 Reimplement Hbck.setRegionStateInMeta", "bodyText": "", "createdAt": "2020-06-04T13:04:17Z", "url": "https://github.com/apache/hbase/pull/1852", "merged": true, "mergeCommit": {"oid": "b2ec4c1ea06d16ebfff42a75e2befa5e15bc57e1"}, "closed": true, "closedAt": "2020-06-05T00:48:40Z", "author": {"login": "Apache9"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcn9spLAH2gAyNDI3ODIwNTY4OjZiNmY2N2JjZDY4NzI5ZWIyN2M2Y2E5M2M3MDc4MjZlZWViNjZhNWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcn_wY0AH2gAyNDI3ODIwNTY4OjZkZTdhMjEyMDM2OGFhNzcwNDVmNTM5OTNmMWY0ZjEwYTM4YzZjZWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6b6f67bcd68729eb27c6ca93c707826eeeb66a5f", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/6b6f67bcd68729eb27c6ca93c707826eeeb66a5f", "committedDate": "2020-06-04T13:02:06Z", "message": "HBASE-24505 Reimplement Hbck.setRegionStateInMeta"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0NTU0MDU4", "url": "https://github.com/apache/hbase/pull/1852#pullrequestreview-424554058", "createdAt": "2020-06-04T15:13:59Z", "commit": {"oid": "6b6f67bcd68729eb27c6ca93c707826eeeb66a5f"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNToxMzo1OVrOGfK24w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNToxMzo1OVrOGfK24w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTMzNjkzMQ==", "bodyText": "Agreed. If we have how to resolve a full region name from only the encoded name. The motivation to allow only region encoded name is because that's what's easily available for operators, and normally reported on hbck/hbck2.", "url": "https://github.com/apache/hbase/pull/1852#discussion_r435336931", "createdAt": "2020-06-04T15:13:59Z", "author": {"login": "wchevreuil"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/MasterRpcServices.java", "diffHunk": "@@ -2500,31 +2502,39 @@ public GetTableStateResponse setTableStateInMeta(RpcController controller,\n    * @return previous states of the regions\n    */\n   @Override\n-  public GetRegionStateInMetaResponse setRegionStateInMeta(RpcController controller,\n+  public SetRegionStateInMetaResponse setRegionStateInMeta(RpcController controller,\n     SetRegionStateInMetaRequest request) throws ServiceException {\n-    final GetRegionStateInMetaResponse.Builder builder = GetRegionStateInMetaResponse.newBuilder();\n-    for(ClusterStatusProtos.RegionState s : request.getStatesList()) {\n-      try {\n-        RegionInfo info = this.master.getAssignmentManager().\n-          loadRegionFromMeta(s.getRegionInfo().getRegionEncodedName());\n+    SetRegionStateInMetaResponse.Builder builder = SetRegionStateInMetaResponse.newBuilder();\n+    try {\n+      for (RegionSpecifierAndState s : request.getStatesList()) {\n+        RegionSpecifier spec = s.getRegionSpecifier();\n+        String encodedName;\n+        if (spec.getType() == RegionSpecifierType.ENCODED_REGION_NAME) {\n+          encodedName = spec.getValue().toStringUtf8();\n+        } else {\n+          // TODO: actually, a full region name can save a lot on meta scan, improve later.\n+          encodedName = RegionInfo.encodeRegionName(spec.getValue().toByteArray());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b6f67bcd68729eb27c6ca93c707826eeeb66a5f"}, "originalPosition": 53}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6de7a2120368aa77045f53993f1f4f10a38c6ceb", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/6de7a2120368aa77045f53993f1f4f10a38c6ceb", "committedDate": "2020-06-04T15:26:00Z", "message": "remove unused imports"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4539, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}