{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyNTU1NjE3", "number": 2596, "title": "Backport \"HBASE-24419 Normalizer merge plans should consider more than 2 region\u2026\" to branch-2", "bodyText": "\u2026s when possible\nThe core change here is to the loop in\nSimpleRegionNormalizer#computeMergeNormalizationPlans. It's a nested\nloop that walks the table's region chain once, looking for contiguous\nsequences of regions that meet the criteria for merge. The outer loop\ntracks the starting point of the next sequence, the inner loop looks\nfor the end of that sequence. A single sequence becomes an instance of\nMergeNormalizationPlan.\nSigned-off-by: Huaxiang Sun huaxiangsun@apache.org", "createdAt": "2020-10-29T20:45:06Z", "url": "https://github.com/apache/hbase/pull/2596", "merged": true, "mergeCommit": {"oid": "b84e2f598bf2485bb80fb25c57f92837f6151ab1"}, "closed": true, "closedAt": "2020-10-30T17:43:44Z", "author": {"login": "ndimiduk"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXYaH-gH2gAyNTEyNTU1NjE3OjYzY2UzYmU3Yzk0NTU4MWViOWM1ZTIwZjBjMzhmYWNjNGUwYzZhYjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABejimdVgFqTY5MDUzMzM4Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "63ce3be7c945581eb9c5e20f0c38facc4e0c6ab2", "author": {"user": {"login": "ndimiduk", "name": "Nick Dimiduk"}}, "url": "https://github.com/apache/hbase/commit/63ce3be7c945581eb9c5e20f0c38facc4e0c6ab2", "committedDate": "2020-10-29T20:43:45Z", "message": "HBASE-24419 Normalizer merge plans should consider more than 2 regions when possible\n\nThe core change here is to the loop in\n`SimpleRegionNormalizer#computeMergeNormalizationPlans`. It's a nested\nloop that walks the table's region chain once, looking for contiguous\nsequences of regions that meet the criteria for merge. The outer loop\ntracks the starting point of the next sequence, the inner loop looks\nfor the end of that sequence. A single sequence becomes an instance of\n`MergeNormalizationPlan`.\n\nSigned-off-by: Huaxiang Sun <huaxiangsun@apache.org>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjkwNTMzMzgy", "url": "https://github.com/apache/hbase/pull/2596#pullrequestreview-690533382", "createdAt": "2021-06-23T11:34:25Z", "commit": {"oid": "63ce3be7c945581eb9c5e20f0c38facc4e0c6ab2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0yM1QxMTozNDoyNVrOJykmQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0yM1QxMTozNDoyNVrOJykmQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1NzAwODE5NA==", "bodyText": "I know this is an old PR but can you explain while we skip merging if our average region size is low?\nLet's say min region size is 2GB but my average region size is 750MB then this would not do anything while we'd like to merge.", "url": "https://github.com/apache/hbase/pull/2596#discussion_r657008194", "createdAt": "2021-06-23T11:34:25Z", "author": {"login": "lfrancke"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/normalizer/SimpleRegionNormalizer.java", "diffHunk": "@@ -315,35 +316,60 @@ private boolean skipForMerge(final RegionStates regionStates, final RegionInfo r\n    * towards target average or target region count.\n    */\n   private List<NormalizationPlan> computeMergeNormalizationPlans(final NormalizeContext ctx) {\n-    if (ctx.getTableRegions().size() < minRegionCount) {\n+    if (isEmpty(ctx.getTableRegions()) || ctx.getTableRegions().size() < minRegionCount) {\n       LOG.debug(\"Table {} has {} regions, required min number of regions for normalizer to run\"\n         + \" is {}, not computing merge plans.\", ctx.getTableName(), ctx.getTableRegions().size(),\n         minRegionCount);\n       return Collections.emptyList();\n     }\n \n-    final double avgRegionSizeMb = ctx.getAverageRegionSizeMb();\n+    final long avgRegionSizeMb = (long) ctx.getAverageRegionSizeMb();\n+    if (avgRegionSizeMb < mergeMinRegionSizeMb) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63ce3be7c945581eb9c5e20f0c38facc4e0c6ab2"}, "originalPosition": 87}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4496, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}