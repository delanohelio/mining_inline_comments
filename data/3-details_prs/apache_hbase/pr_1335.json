{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyNzU0MDEz", "number": 1335, "title": "HBASE-24000 Simplify CommonFSUtils after upgrading to hadoop 2.10.0", "bodyText": "", "createdAt": "2020-03-24T03:23:39Z", "url": "https://github.com/apache/hbase/pull/1335", "merged": true, "mergeCommit": {"oid": "f3ee9b8aa37dd30d34ff54cd39fb9b4b6d22e683"}, "closed": true, "closedAt": "2020-03-26T09:05:32Z", "author": {"login": "Apache9"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQ2pvQAFqTM4MDU1Njg1NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRSz6HgBqjMxNjY0NjA1MzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNTU2ODU1", "url": "https://github.com/apache/hbase/pull/1335#pullrequestreview-380556855", "createdAt": "2020-03-24T17:49:20Z", "commit": {"oid": "142cc8f83886e0b27a15fc9bddf9e4fbe4a823a6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNzY5OTEz", "url": "https://github.com/apache/hbase/pull/1335#pullrequestreview-380769913", "createdAt": "2020-03-24T23:36:44Z", "commit": {"oid": "142cc8f83886e0b27a15fc9bddf9e4fbe4a823a6"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMzozNjo0NFrOF7HCdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMzo0NjozN1rOF7HPKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUyNTYyMQ==", "bodyText": "nit: path is not an instance of String, so auto-type-conversion means this will call path.toString() even when debug is not enabled. That method looks entirely too complicated, with lots of branching, but I guess nothing too hateful. Just and FYI.", "url": "https://github.com/apache/hbase/pull/1335#discussion_r397525621", "createdAt": "2020-03-24T23:36:44Z", "author": {"login": "ndimiduk"}, "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/util/CommonFSUtils.java", "diffHunk": "@@ -525,10 +518,7 @@ private static void invokeSetStoragePolicy(final FileSystem fs, final Path path,\n \n     try {\n       fs.setStoragePolicy(path, storagePolicy);\n-\n-      if (LOG.isDebugEnabled()) {\n-        LOG.debug(\"Set storagePolicy={} for path={}\", storagePolicy, path);\n-      }\n+      LOG.debug(\"Set storagePolicy={} for path={}\", storagePolicy, path);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "142cc8f83886e0b27a15fc9bddf9e4fbe4a823a6"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUyODg3NA==", "bodyText": "DistributedFileSystem appears to exist since 2.10, so can this string be built from a class reference? For example,\nString buildName = DistributedFileSystem.class.getName() + \"$HdfsDataOutputStreamBuilder\";\nLooks like hbase-common module doesn't depend on hadoop-hdfs-client jar, so maybe this gets too weird for a \"cleanup\" patch. Would be nice though, to use whatever static references we can...", "url": "https://github.com/apache/hbase/pull/1335#discussion_r397528874", "createdAt": "2020-03-24T23:46:37Z", "author": {"login": "ndimiduk"}, "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/util/CommonFSUtils.java", "diffHunk": "@@ -759,200 +739,75 @@ public static void checkShortCircuitReadBufferSize(final Configuration conf) {\n     conf.setIfUnset(dfsKey, Integer.toString(hbaseSize));\n   }\n \n-  private static class DfsBuilderUtility {\n-    static Class<?> dfsClass = null;\n-    static Method createMethod;\n-    static Method overwriteMethod;\n-    static Method bufferSizeMethod;\n-    static Method blockSizeMethod;\n-    static Method recursiveMethod;\n-    static Method replicateMethod;\n-    static Method replicationMethod;\n-    static Method buildMethod;\n-    static boolean allMethodsPresent = false;\n+  private static final class DfsBuilderUtility {\n+    private static final Class<?> BUILDER;\n+    private static final Method REPLICATE;\n \n     static {\n-      String dfsName = \"org.apache.hadoop.hdfs.DistributedFileSystem\";\n-      String builderName = dfsName + \"$HdfsDataOutputStreamBuilder\";\n+      String builderName = \"org.apache.hadoop.hdfs.DistributedFileSystem$HdfsDataOutputStreamBuilder\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "142cc8f83886e0b27a15fc9bddf9e4fbe4a823a6"}, "originalPosition": 98}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "500142824de58eb4f7b81a55fba0f3fc4f56c383", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/500142824de58eb4f7b81a55fba0f3fc4f56c383", "committedDate": "2020-03-26T02:37:33Z", "message": "HBASE-24000 Simplify CommonFSUtils after upgrading to hadoop 2.10.0"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "142cc8f83886e0b27a15fc9bddf9e4fbe4a823a6", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/142cc8f83886e0b27a15fc9bddf9e4fbe4a823a6", "committedDate": "2020-03-24T03:23:00Z", "message": "HBASE-24000 Simplify CommonFSUtils after upgrading to hadoop 2.10.0"}, "afterCommit": {"oid": "500142824de58eb4f7b81a55fba0f3fc4f56c383", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/500142824de58eb4f7b81a55fba0f3fc4f56c383", "committedDate": "2020-03-26T02:37:33Z", "message": "HBASE-24000 Simplify CommonFSUtils after upgrading to hadoop 2.10.0"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2461, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}