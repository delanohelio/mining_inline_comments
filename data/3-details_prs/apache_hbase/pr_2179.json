{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU5ODUzMDA3", "number": 2179, "title": "HBASE-24694 Support flush a single column family of table", "bodyText": "", "createdAt": "2020-07-31T07:07:38Z", "url": "https://github.com/apache/hbase/pull/2179", "merged": true, "mergeCommit": {"oid": "485e0d2fa4dd92dbbd4a483b2e2f554e7848f494"}, "closed": true, "closedAt": "2020-08-07T10:28:53Z", "author": {"login": "bsglz"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc6OwwegH2gAyNDU5ODUzMDA3OjBhMWIwYWNhNjczYzQ5ZDFjZjViOTFmYTk4ODFkOGM0MTI1OTgyMjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc77y3HAH2gAyNDU5ODUzMDA3Ojk3Yzk0OGE0NzMzMmJkZjZhNWU4YjE3YjVlMTBmNmFjNTU3OTQyY2Y=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0a1b0aca673c49d1cf5b91fa9881d8c412598220", "author": {"user": {"login": "bsglz", "name": null}}, "url": "https://github.com/apache/hbase/commit/0a1b0aca673c49d1cf5b91fa9881d8c412598220", "committedDate": "2020-07-31T07:05:37Z", "message": "HBASE-24694 Support flush a single column family of table"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5MDM4NTE2", "url": "https://github.com/apache/hbase/pull/2179#pullrequestreview-459038516", "createdAt": "2020-07-31T09:27:42Z", "commit": {"oid": "0a1b0aca673c49d1cf5b91fa9881d8c412598220"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwOToyNzo0MlrOG6CHMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwOTo1MDoyMlrOG6Cx-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzUwNTIwMQ==", "bodyText": "Nit: It's better to be more specific when debugging: \"About to flush family {} on all regions for table {}\"", "url": "https://github.com/apache/hbase/pull/2179#discussion_r463505201", "createdAt": "2020-07-31T09:27:42Z", "author": {"login": "wchevreuil"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/procedure/flush/FlushTableSubprocedure.java", "diffHunk": "@@ -88,11 +95,15 @@ private void flushRegions() throws ForeignException {\n       throw new IllegalStateException(\"Attempting to flush \"\n           + table + \" but we currently have outstanding tasks\");\n     }\n-\n+    List<byte[]> families = null;\n+    if (family != null) {\n+      LOG.debug(\"Flush regions with specified family:{}\", family);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a1b0aca673c49d1cf5b91fa9881d8c412598220"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzUwNzgxOQ==", "bodyText": "We should explain better how this overloaded version differs from flush(TableName tableName).", "url": "https://github.com/apache/hbase/pull/2179#discussion_r463507819", "createdAt": "2020-07-31T09:33:07Z", "author": {"login": "wchevreuil"}, "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/client/Admin.java", "diffHunk": "@@ -513,6 +513,15 @@ default void modifyColumnFamily(TableName tableName, ColumnFamilyDescriptor colu\n    */\n   void flush(TableName tableName) throws IOException;\n \n+  /**\n+   * Flush a table. Synchronous operation.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a1b0aca673c49d1cf5b91fa9881d8c412598220"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzUwODE2MA==", "bodyText": "We should explain better how this overloaded version differs from flush(TableName tableName).", "url": "https://github.com/apache/hbase/pull/2179#discussion_r463508160", "createdAt": "2020-07-31T09:33:53Z", "author": {"login": "wchevreuil"}, "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/client/AsyncAdmin.java", "diffHunk": "@@ -302,6 +302,13 @@\n    */\n   CompletableFuture<Void> flush(TableName tableName);\n \n+  /**\n+   * Flush a table.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a1b0aca673c49d1cf5b91fa9881d8c412598220"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzUxNDMyNQ==", "bodyText": "Can this affect the other versions that don't specify any families, like flush(TableName tableName)? Because region.flush(true), internally, loads all families before delegating to flushcache(List<byte[]> families, boolean writeFlushRequestWalMarker, FlushLifeCycleTracker tracker), but it doesn't seem we are doing this now.", "url": "https://github.com/apache/hbase/pull/2179#discussion_r463514325", "createdAt": "2020-07-31T09:46:34Z", "author": {"login": "wchevreuil"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/procedure/flush/FlushTableSubprocedure.java", "diffHunk": "@@ -65,7 +72,7 @@ public Void call() throws Exception {\n       region.startRegionOperation();\n       try {\n         LOG.debug(\"Flush region \" + region.toString() + \" started...\");\n-        region.flush(true);\n+        region.flushcache(families, false, FlushLifeCycleTracker.DUMMY);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a1b0aca673c49d1cf5b91fa9881d8c412598220"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzUxNjE1Mw==", "bodyText": "Will it always be non null even when we don't specify any family?", "url": "https://github.com/apache/hbase/pull/2179#discussion_r463516153", "createdAt": "2020-07-31T09:50:22Z", "author": {"login": "wchevreuil"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/procedure/flush/RegionServerFlushTableProcedureManager.java", "diffHunk": "@@ -183,8 +185,17 @@ public Subprocedure buildSubprocedure(String table) {\n \n     @Override\n     public Subprocedure buildSubprocedure(String name, byte[] data) {\n+      String family = null;\n+      if (data.length > 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a1b0aca673c49d1cf5b91fa9881d8c412598220"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "898b8ee225c1a47ca1cb93c54229234b1584e76e", "author": {"user": {"login": "bsglz", "name": null}}, "url": "https://github.com/apache/hbase/commit/898b8ee225c1a47ca1cb93c54229234b1584e76e", "committedDate": "2020-08-01T09:01:47Z", "message": "fix review issue"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxNjczOTcy", "url": "https://github.com/apache/hbase/pull/2179#pullrequestreview-461673972", "createdAt": "2020-08-05T13:40:37Z", "commit": {"oid": "898b8ee225c1a47ca1cb93c54229234b1584e76e"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMzo0MDozN1rOG8KKHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMzo0MjowN1rOG8KOFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTczNDE3Mw==", "bodyText": "Let's not leave any room for confusion: Flush the specified column family stores on all regions of the passed table. This runs as a synchronous operation.", "url": "https://github.com/apache/hbase/pull/2179#discussion_r465734173", "createdAt": "2020-08-05T13:40:37Z", "author": {"login": "wchevreuil"}, "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/client/Admin.java", "diffHunk": "@@ -513,6 +513,15 @@ default void modifyColumnFamily(TableName tableName, ColumnFamilyDescriptor colu\n    */\n   void flush(TableName tableName) throws IOException;\n \n+  /**\n+   * Flush a table with specified column family. Synchronous operation.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "898b8ee225c1a47ca1cb93c54229234b1584e76e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTczNDUyNA==", "bodyText": "Similar to above.", "url": "https://github.com/apache/hbase/pull/2179#discussion_r465734524", "createdAt": "2020-08-05T13:41:08Z", "author": {"login": "wchevreuil"}, "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/client/AsyncAdmin.java", "diffHunk": "@@ -302,6 +302,13 @@\n    */\n   CompletableFuture<Void> flush(TableName tableName);\n \n+  /**\n+   * Flush a table with specified column family.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "898b8ee225c1a47ca1cb93c54229234b1584e76e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTczNTE5MQ==", "bodyText": "You can also flush a single column family for all regions within a table, or for an specific region only.", "url": "https://github.com/apache/hbase/pull/2179#discussion_r465735191", "createdAt": "2020-08-05T13:42:07Z", "author": {"login": "wchevreuil"}, "path": "hbase-shell/src/main/ruby/shell/commands/flush.rb", "diffHunk": "@@ -25,10 +25,11 @@ def help\n Flush all regions in passed table or pass a region row to\n flush an individual region or a region server name whose format\n is 'host,port,startcode', to flush all its regions.\n-You can also flush a single column family within a region.\n+You can also flush a single column family within a table or region.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "898b8ee225c1a47ca1cb93c54229234b1584e76e"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97c948a47332bdf6a5e8b17b5e10f6ac557942cf", "author": {"user": {"login": "bsglz", "name": null}}, "url": "https://github.com/apache/hbase/commit/97c948a47332bdf6a5e8b17b5e10f6ac557942cf", "committedDate": "2020-08-05T14:07:34Z", "message": "fix review issue"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4130, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}