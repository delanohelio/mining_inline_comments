{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzMjc3ODg2", "number": 2543, "title": "HBASE-25184 Move RegionLocationFinder to hbase-balancer", "bodyText": "", "createdAt": "2020-10-14T10:39:13Z", "url": "https://github.com/apache/hbase/pull/2543", "merged": true, "mergeCommit": {"oid": "f9e928e5a7550c748bfd9fb137ba70aa63e65e50"}, "closed": true, "closedAt": "2021-04-10T13:10:54Z", "author": {"login": "Apache9"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSkfpIgFqTUwODc5OTY5MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABeE1VCdABqjQ0ODQ5Nzg0ODY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4Nzk5Njkx", "url": "https://github.com/apache/hbase/pull/2543#pullrequestreview-508799691", "createdAt": "2020-10-14T21:58:56Z", "commit": {"oid": "e21cf5f71e1ecdabaa1db5bb580b021af0333287"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMTo1ODo1NlrOHhm0Hw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMTo1ODo1NlrOHhm0Hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTAwMDk5MQ==", "bodyText": "Why is RegionLocationFinder in the balancer module?", "url": "https://github.com/apache/hbase/pull/2543#discussion_r505000991", "createdAt": "2020-10-14T21:58:56Z", "author": {"login": "saintstack"}, "path": "hbase-balancer/src/main/java/org/apache/hadoop/hbase/master/balancer/RegionLocationFinder.java", "diffHunk": "@@ -17,235 +17,186 @@\n  */\n package org.apache.hadoop.hbase.master.balancer;\n \n-import java.io.FileNotFoundException;\n import java.io.IOException;\n import java.util.ArrayList;\n import java.util.Collection;\n+import java.util.Collections;\n import java.util.HashMap;\n import java.util.List;\n+import java.util.Map;\n import java.util.concurrent.Callable;\n import java.util.concurrent.ExecutionException;\n import java.util.concurrent.Executors;\n import java.util.concurrent.TimeUnit;\n-import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.conf.Configured;\n import org.apache.hadoop.hbase.ClusterMetrics;\n import org.apache.hadoop.hbase.HDFSBlocksDistribution;\n import org.apache.hadoop.hbase.ServerName;\n import org.apache.hadoop.hbase.TableName;\n import org.apache.hadoop.hbase.client.RegionInfo;\n import org.apache.hadoop.hbase.client.TableDescriptor;\n-import org.apache.hadoop.hbase.master.MasterServices;\n-import org.apache.hadoop.hbase.master.assignment.AssignmentManager;\n-import org.apache.hadoop.hbase.regionserver.HRegion;\n import org.apache.hadoop.hbase.util.EnvironmentEdgeManager;\n import org.apache.yetus.audience.InterfaceAudience;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n+\n+import org.apache.hbase.thirdparty.com.google.common.annotations.VisibleForTesting;\n import org.apache.hbase.thirdparty.com.google.common.cache.CacheBuilder;\n import org.apache.hbase.thirdparty.com.google.common.cache.CacheLoader;\n import org.apache.hbase.thirdparty.com.google.common.cache.LoadingCache;\n-import org.apache.hbase.thirdparty.com.google.common.collect.Lists;\n import org.apache.hbase.thirdparty.com.google.common.util.concurrent.Futures;\n import org.apache.hbase.thirdparty.com.google.common.util.concurrent.ListenableFuture;\n import org.apache.hbase.thirdparty.com.google.common.util.concurrent.ListeningExecutorService;\n import org.apache.hbase.thirdparty.com.google.common.util.concurrent.MoreExecutors;\n import org.apache.hbase.thirdparty.com.google.common.util.concurrent.ThreadFactoryBuilder;\n \n /**\n- * This will find where data for a region is located in HDFS. It ranks\n- * {@link ServerName}'s by the size of the store files they are holding for a\n- * given region.\n- *\n+ * This will find where data for a region is located in HDFS. It ranks {@link ServerName}'s by the\n+ * size of the store files they are holding for a given region.\n  */\n @InterfaceAudience.Private\n-class RegionLocationFinder {\n+class RegionLocationFinder extends Configured {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e21cf5f71e1ecdabaa1db5bb580b021af0333287"}, "originalPosition": 53}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e21cf5f71e1ecdabaa1db5bb580b021af0333287", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/e21cf5f71e1ecdabaa1db5bb580b021af0333287", "committedDate": "2020-10-14T10:38:23Z", "message": "HBASE-25184 Move RegionLocationFinder to hbase-balancer"}, "afterCommit": {"oid": "0f7f9e1e44fc97c99a08755784d2917d5b9de8d3", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/0f7f9e1e44fc97c99a08755784d2917d5b9de8d3", "committedDate": "2021-03-06T01:38:55Z", "message": "HBASE-25184 Move RegionLocationFinder to hbase-balancer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjExNzk4ODMx", "url": "https://github.com/apache/hbase/pull/2543#pullrequestreview-611798831", "createdAt": "2021-03-15T03:15:34Z", "commit": {"oid": "ec3e004d6bcc0ab56fbf883b48d60900c131b790"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjEyODYwMjE5", "url": "https://github.com/apache/hbase/pull/2543#pullrequestreview-612860219", "createdAt": "2021-03-16T05:19:17Z", "commit": {"oid": "ec3e004d6bcc0ab56fbf883b48d60900c131b790"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQwNToxOToxOFrOI3T4xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQwNToyOTowOVrOI3UFWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NDg2ODQyMw==", "bodyText": "This comment is odd. Is BalanceService a good name for this? There is no start/stop of this Service?  There is not even a balance method in this BalanceService?", "url": "https://github.com/apache/hbase/pull/2543#discussion_r594868423", "createdAt": "2021-03-16T05:19:18Z", "author": {"login": "saintstack"}, "path": "hbase-balancer/src/main/java/org/apache/hadoop/hbase/master/balancer/BalancerService.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hbase.master.balancer;\n+\n+import java.io.IOException;\n+import java.util.List;\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.hbase.HDFSBlocksDistribution;\n+import org.apache.hadoop.hbase.TableName;\n+import org.apache.hadoop.hbase.client.RegionInfo;\n+import org.apache.hadoop.hbase.client.TableDescriptor;\n+import org.apache.yetus.audience.InterfaceAudience;\n+\n+/**\n+ * This is the cluster we want to balance. It provides methods to let us get the information we", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec3e004d6bcc0ab56fbf883b48d60900c131b790"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NDg3MTY0MA==", "bodyText": "I thought this class was about finding Region locations. Now I see it is about HDFS block locations per Region... something else altogether. Seems like the class is named incorrectly? Perhaps fix?  RegionHDFSBlockLocationsFinder?", "url": "https://github.com/apache/hbase/pull/2543#discussion_r594871640", "createdAt": "2021-03-16T05:29:09Z", "author": {"login": "saintstack"}, "path": "hbase-balancer/src/main/java/org/apache/hadoop/hbase/master/balancer/RegionLocationFinder.java", "diffHunk": "@@ -17,235 +17,187 @@\n  */\n package org.apache.hadoop.hbase.master.balancer;\n \n-import java.io.FileNotFoundException;\n+import com.google.errorprone.annotations.RestrictedApi;\n import java.io.IOException;\n import java.util.ArrayList;\n import java.util.Collection;\n+import java.util.Collections;\n import java.util.HashMap;\n import java.util.List;\n+import java.util.Map;\n import java.util.concurrent.Callable;\n import java.util.concurrent.ExecutionException;\n import java.util.concurrent.Executors;\n import java.util.concurrent.TimeUnit;\n-import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.conf.Configured;\n import org.apache.hadoop.hbase.ClusterMetrics;\n import org.apache.hadoop.hbase.HDFSBlocksDistribution;\n import org.apache.hadoop.hbase.ServerName;\n import org.apache.hadoop.hbase.TableName;\n import org.apache.hadoop.hbase.client.RegionInfo;\n import org.apache.hadoop.hbase.client.TableDescriptor;\n-import org.apache.hadoop.hbase.master.MasterServices;\n-import org.apache.hadoop.hbase.master.assignment.AssignmentManager;\n-import org.apache.hadoop.hbase.regionserver.HRegion;\n import org.apache.hadoop.hbase.util.EnvironmentEdgeManager;\n import org.apache.yetus.audience.InterfaceAudience;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n+\n import org.apache.hbase.thirdparty.com.google.common.cache.CacheBuilder;\n import org.apache.hbase.thirdparty.com.google.common.cache.CacheLoader;\n import org.apache.hbase.thirdparty.com.google.common.cache.LoadingCache;\n-import org.apache.hbase.thirdparty.com.google.common.collect.Lists;\n import org.apache.hbase.thirdparty.com.google.common.util.concurrent.Futures;\n import org.apache.hbase.thirdparty.com.google.common.util.concurrent.ListenableFuture;\n import org.apache.hbase.thirdparty.com.google.common.util.concurrent.ListeningExecutorService;\n import org.apache.hbase.thirdparty.com.google.common.util.concurrent.MoreExecutors;\n import org.apache.hbase.thirdparty.com.google.common.util.concurrent.ThreadFactoryBuilder;\n \n /**\n- * This will find where data for a region is located in HDFS. It ranks\n- * {@link ServerName}'s by the size of the store files they are holding for a\n- * given region.\n- *\n+ * This will find where data for a region is located in HDFS. It ranks {@link ServerName}'s by the\n+ * size of the store files they are holding for a given region.\n  */\n @InterfaceAudience.Private\n-class RegionLocationFinder {\n+class RegionLocationFinder extends Configured {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec3e004d6bcc0ab56fbf883b48d60900c131b790"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjEyODc5NDYw", "url": "https://github.com/apache/hbase/pull/2543#pullrequestreview-612879460", "createdAt": "2021-03-16T06:08:47Z", "commit": {"oid": "ec3e004d6bcc0ab56fbf883b48d60900c131b790"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQwNjowODo0OFrOI3U50w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQwNjowODo0OFrOI3U50w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NDg4NTA3NQ==", "bodyText": "After reading whole patch I see that this is not a BalancerService but a subset of the MasterSerivces, those methods the Balancer can't do without.\nSuggest the class comment say that.\nThe getAssignedRegions is all assigned Regions on the cluster it seems? Add a bit of javadoc? Ditto for computeHDFSBlockDist...", "url": "https://github.com/apache/hbase/pull/2543#discussion_r594885075", "createdAt": "2021-03-16T06:08:48Z", "author": {"login": "saintstack"}, "path": "hbase-balancer/src/main/java/org/apache/hadoop/hbase/master/balancer/BalancerService.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hbase.master.balancer;\n+\n+import java.io.IOException;\n+import java.util.List;\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.hbase.HDFSBlocksDistribution;\n+import org.apache.hadoop.hbase.TableName;\n+import org.apache.hadoop.hbase.client.RegionInfo;\n+import org.apache.hadoop.hbase.client.TableDescriptor;\n+import org.apache.yetus.audience.InterfaceAudience;\n+\n+/**\n+ * This is the cluster we want to balance. It provides methods to let us get the information we\n+ * want.\n+ */\n+@InterfaceAudience.Private\n+public interface BalancerService {\n+\n+  List<RegionInfo> getAssignedRegions();\n+\n+  TableDescriptor getTableDescriptor(TableName tableName) throws IOException;\n+\n+  HDFSBlocksDistribution computeHDFSBlocksDistribution(Configuration conf,\n+    TableDescriptor tableDescriptor, RegionInfo regionInfo) throws IOException;\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec3e004d6bcc0ab56fbf883b48d60900c131b790"}, "originalPosition": 42}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ec3e004d6bcc0ab56fbf883b48d60900c131b790", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/ec3e004d6bcc0ab56fbf883b48d60900c131b790", "committedDate": "2021-03-06T15:17:25Z", "message": "fix error prone warnings as much as possible"}, "afterCommit": {"oid": "a3d81fbd4a53b1e7f43ffb542accaffabfc74f8e", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/a3d81fbd4a53b1e7f43ffb542accaffabfc74f8e", "committedDate": "2021-03-19T15:32:03Z", "message": "HBASE-25184 Move RegionLocationFinder to hbase-balancer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "436de4df682f38bd129363b387eacdaa4bcbe0bf", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/436de4df682f38bd129363b387eacdaa4bcbe0bf", "committedDate": "2021-03-20T01:51:50Z", "message": "HBASE-25184 Move RegionLocationFinder to hbase-balancer"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a3d81fbd4a53b1e7f43ffb542accaffabfc74f8e", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/a3d81fbd4a53b1e7f43ffb542accaffabfc74f8e", "committedDate": "2021-03-19T15:32:03Z", "message": "HBASE-25184 Move RegionLocationFinder to hbase-balancer"}, "afterCommit": {"oid": "436de4df682f38bd129363b387eacdaa4bcbe0bf", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/436de4df682f38bd129363b387eacdaa4bcbe0bf", "committedDate": "2021-03-20T01:51:50Z", "message": "HBASE-25184 Move RegionLocationFinder to hbase-balancer"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4377, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}