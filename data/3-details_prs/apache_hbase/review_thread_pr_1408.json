{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3MTY0ODU2", "number": 1408, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMTowODo0OFrODttOjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwMjowMToxM1rODtxMAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MjUzNTE3OnYy", "diffSide": "RIGHT", "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/util/CommonFSUtils.java", "isResolved": false, "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMTowODo0OFrOF_SrqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwMDoyNTo0NVrOF_XP5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkxMDY5Nw==", "bodyText": "nit: make it an else if? meaning if the user didn't override UNSAFE_STREAM_CAPABILITY_ENFORCE and its a local fs mode..", "url": "https://github.com/apache/hbase/pull/1408#discussion_r401910697", "createdAt": "2020-04-01T21:08:48Z", "author": {"login": "bharathv"}, "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/util/CommonFSUtils.java", "diffHunk": "@@ -350,11 +350,18 @@ public static void setWALRootDir(final Configuration c, final Path root) {\n   public static FileSystem getWALFileSystem(final Configuration c) throws IOException {\n     Path p = getWALRootDir(c);\n     FileSystem fs = p.getFileSystem(c);\n-    // hadoop-core does fs caching, so need to propogate this if set\n+    // hadoop-core does fs caching, so need to propagate this if set\n     String enforceStreamCapability = c.get(UNSAFE_STREAM_CAPABILITY_ENFORCE);\n     if (enforceStreamCapability != null) {\n       fs.getConf().set(UNSAFE_STREAM_CAPABILITY_ENFORCE, enforceStreamCapability);\n     }\n+    if (!c.getBoolean(HConstants.CLUSTER_DISTRIBUTED, false)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "788f800c68200f78eb05b535d33b4b4f8fcff64f"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkxMzk5NQ==", "bodyText": "Can you not ask fs if it is an instance of local fs? If it is, then set the boolean?", "url": "https://github.com/apache/hbase/pull/1408#discussion_r401913995", "createdAt": "2020-04-01T21:15:23Z", "author": {"login": "saintstack"}, "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/util/CommonFSUtils.java", "diffHunk": "@@ -350,11 +350,18 @@ public static void setWALRootDir(final Configuration c, final Path root) {\n   public static FileSystem getWALFileSystem(final Configuration c) throws IOException {\n     Path p = getWALRootDir(c);\n     FileSystem fs = p.getFileSystem(c);\n-    // hadoop-core does fs caching, so need to propogate this if set\n+    // hadoop-core does fs caching, so need to propagate this if set\n     String enforceStreamCapability = c.get(UNSAFE_STREAM_CAPABILITY_ENFORCE);\n     if (enforceStreamCapability != null) {\n       fs.getConf().set(UNSAFE_STREAM_CAPABILITY_ENFORCE, enforceStreamCapability);\n     }\n+    if (!c.getBoolean(HConstants.CLUSTER_DISTRIBUTED, false)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkxMDY5Nw=="}, "originalCommit": {"oid": "788f800c68200f78eb05b535d33b4b4f8fcff64f"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkxNTExMQ==", "bodyText": "Hmm.... Looking here, the distributed flag is good to check [1] but would we run non-distributed on an fs that supports sync? s3?\n\nhttp://hbase.apache.org/book.html#standalone", "url": "https://github.com/apache/hbase/pull/1408#discussion_r401915111", "createdAt": "2020-04-01T21:17:46Z", "author": {"login": "saintstack"}, "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/util/CommonFSUtils.java", "diffHunk": "@@ -350,11 +350,18 @@ public static void setWALRootDir(final Configuration c, final Path root) {\n   public static FileSystem getWALFileSystem(final Configuration c) throws IOException {\n     Path p = getWALRootDir(c);\n     FileSystem fs = p.getFileSystem(c);\n-    // hadoop-core does fs caching, so need to propogate this if set\n+    // hadoop-core does fs caching, so need to propagate this if set\n     String enforceStreamCapability = c.get(UNSAFE_STREAM_CAPABILITY_ENFORCE);\n     if (enforceStreamCapability != null) {\n       fs.getConf().set(UNSAFE_STREAM_CAPABILITY_ENFORCE, enforceStreamCapability);\n     }\n+    if (!c.getBoolean(HConstants.CLUSTER_DISTRIBUTED, false)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkxMDY5Nw=="}, "originalCommit": {"oid": "788f800c68200f78eb05b535d33b4b4f8fcff64f"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkzMDEzMg==", "bodyText": "make it an else if? meaning if the user didn't override UNSAFE_STREAM_CAPABILITY_ENFORCE and its a local fs mode..\n\nI explicitly disable it here because we know it doesn't work with the local filesystem. There are plenty of places where conf lookups of UNSAFE_STREAM_CAPABILITY_ENFORCE have a default of true, so leaving it unset sometimes doesn't help.", "url": "https://github.com/apache/hbase/pull/1408#discussion_r401930132", "createdAt": "2020-04-01T21:48:28Z", "author": {"login": "ndimiduk"}, "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/util/CommonFSUtils.java", "diffHunk": "@@ -350,11 +350,18 @@ public static void setWALRootDir(final Configuration c, final Path root) {\n   public static FileSystem getWALFileSystem(final Configuration c) throws IOException {\n     Path p = getWALRootDir(c);\n     FileSystem fs = p.getFileSystem(c);\n-    // hadoop-core does fs caching, so need to propogate this if set\n+    // hadoop-core does fs caching, so need to propagate this if set\n     String enforceStreamCapability = c.get(UNSAFE_STREAM_CAPABILITY_ENFORCE);\n     if (enforceStreamCapability != null) {\n       fs.getConf().set(UNSAFE_STREAM_CAPABILITY_ENFORCE, enforceStreamCapability);\n     }\n+    if (!c.getBoolean(HConstants.CLUSTER_DISTRIBUTED, false)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkxMDY5Nw=="}, "originalCommit": {"oid": "788f800c68200f78eb05b535d33b4b4f8fcff64f"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkzMTMwMQ==", "bodyText": "Can you not ask fs if it is an instance of local fs? If it is, then set the boolean?\nwould we run non-distributed on an fs that supports sync? s3?\n\nMy preference would be if !distributed && !fs.supportsCapabilities(), however the only way I see to ask a FS if it supports the capabilities is to first instantiate a stream, which I didn't want to do here. Other suggestions?", "url": "https://github.com/apache/hbase/pull/1408#discussion_r401931301", "createdAt": "2020-04-01T21:50:51Z", "author": {"login": "ndimiduk"}, "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/util/CommonFSUtils.java", "diffHunk": "@@ -350,11 +350,18 @@ public static void setWALRootDir(final Configuration c, final Path root) {\n   public static FileSystem getWALFileSystem(final Configuration c) throws IOException {\n     Path p = getWALRootDir(c);\n     FileSystem fs = p.getFileSystem(c);\n-    // hadoop-core does fs caching, so need to propogate this if set\n+    // hadoop-core does fs caching, so need to propagate this if set\n     String enforceStreamCapability = c.get(UNSAFE_STREAM_CAPABILITY_ENFORCE);\n     if (enforceStreamCapability != null) {\n       fs.getConf().set(UNSAFE_STREAM_CAPABILITY_ENFORCE, enforceStreamCapability);\n     }\n+    if (!c.getBoolean(HConstants.CLUSTER_DISTRIBUTED, false)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkxMDY5Nw=="}, "originalCommit": {"oid": "788f800c68200f78eb05b535d33b4b4f8fcff64f"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk3MTg3OA==", "bodyText": "I think @saintstack is right. We can run non-distributed on a distributed fs with stream capabilities. So the check is probably not tight...\n\nOther suggestions?\n\nOne naive way is to just check for instance of LocalFileSystem and override? (Think this is what Stack was suggesting). This covers the most common case of testing something by just unpacking a bin release. Any other fancy filesystems, users may have to figure out themselves?", "url": "https://github.com/apache/hbase/pull/1408#discussion_r401971878", "createdAt": "2020-04-01T23:39:59Z", "author": {"login": "bharathv"}, "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/util/CommonFSUtils.java", "diffHunk": "@@ -350,11 +350,18 @@ public static void setWALRootDir(final Configuration c, final Path root) {\n   public static FileSystem getWALFileSystem(final Configuration c) throws IOException {\n     Path p = getWALRootDir(c);\n     FileSystem fs = p.getFileSystem(c);\n-    // hadoop-core does fs caching, so need to propogate this if set\n+    // hadoop-core does fs caching, so need to propagate this if set\n     String enforceStreamCapability = c.get(UNSAFE_STREAM_CAPABILITY_ENFORCE);\n     if (enforceStreamCapability != null) {\n       fs.getConf().set(UNSAFE_STREAM_CAPABILITY_ENFORCE, enforceStreamCapability);\n     }\n+    if (!c.getBoolean(HConstants.CLUSTER_DISTRIBUTED, false)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkxMDY5Nw=="}, "originalCommit": {"oid": "788f800c68200f78eb05b535d33b4b4f8fcff64f"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk3ODQ4Mw==", "bodyText": "I was hoping to avoid pinning the logic to specific FileSystem implementations, rather on capabilities. Fun fact: the only commonality between LocalFileSystem and RawLocalFileSystem is FileSystem :/", "url": "https://github.com/apache/hbase/pull/1408#discussion_r401978483", "createdAt": "2020-04-02T00:01:42Z", "author": {"login": "ndimiduk"}, "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/util/CommonFSUtils.java", "diffHunk": "@@ -350,11 +350,18 @@ public static void setWALRootDir(final Configuration c, final Path root) {\n   public static FileSystem getWALFileSystem(final Configuration c) throws IOException {\n     Path p = getWALRootDir(c);\n     FileSystem fs = p.getFileSystem(c);\n-    // hadoop-core does fs caching, so need to propogate this if set\n+    // hadoop-core does fs caching, so need to propagate this if set\n     String enforceStreamCapability = c.get(UNSAFE_STREAM_CAPABILITY_ENFORCE);\n     if (enforceStreamCapability != null) {\n       fs.getConf().set(UNSAFE_STREAM_CAPABILITY_ENFORCE, enforceStreamCapability);\n     }\n+    if (!c.getBoolean(HConstants.CLUSTER_DISTRIBUTED, false)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkxMDY5Nw=="}, "originalCommit": {"oid": "788f800c68200f78eb05b535d33b4b4f8fcff64f"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk3OTc3Mw==", "bodyText": "Ya, that'd be ideal.. probably a new Hadoop jira for the FileSystem interface to expose the capabilities in some form...", "url": "https://github.com/apache/hbase/pull/1408#discussion_r401979773", "createdAt": "2020-04-02T00:05:51Z", "author": {"login": "bharathv"}, "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/util/CommonFSUtils.java", "diffHunk": "@@ -350,11 +350,18 @@ public static void setWALRootDir(final Configuration c, final Path root) {\n   public static FileSystem getWALFileSystem(final Configuration c) throws IOException {\n     Path p = getWALRootDir(c);\n     FileSystem fs = p.getFileSystem(c);\n-    // hadoop-core does fs caching, so need to propogate this if set\n+    // hadoop-core does fs caching, so need to propagate this if set\n     String enforceStreamCapability = c.get(UNSAFE_STREAM_CAPABILITY_ENFORCE);\n     if (enforceStreamCapability != null) {\n       fs.getConf().set(UNSAFE_STREAM_CAPABILITY_ENFORCE, enforceStreamCapability);\n     }\n+    if (!c.getBoolean(HConstants.CLUSTER_DISTRIBUTED, false)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkxMDY5Nw=="}, "originalCommit": {"oid": "788f800c68200f78eb05b535d33b4b4f8fcff64f"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk4NTUxMA==", "bodyText": "From debugging, it's LocalFileSystem that gets used for wals, so that's what I've used. This seems very fragile though :/", "url": "https://github.com/apache/hbase/pull/1408#discussion_r401985510", "createdAt": "2020-04-02T00:25:45Z", "author": {"login": "ndimiduk"}, "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/util/CommonFSUtils.java", "diffHunk": "@@ -350,11 +350,18 @@ public static void setWALRootDir(final Configuration c, final Path root) {\n   public static FileSystem getWALFileSystem(final Configuration c) throws IOException {\n     Path p = getWALRootDir(c);\n     FileSystem fs = p.getFileSystem(c);\n-    // hadoop-core does fs caching, so need to propogate this if set\n+    // hadoop-core does fs caching, so need to propagate this if set\n     String enforceStreamCapability = c.get(UNSAFE_STREAM_CAPABILITY_ENFORCE);\n     if (enforceStreamCapability != null) {\n       fs.getConf().set(UNSAFE_STREAM_CAPABILITY_ENFORCE, enforceStreamCapability);\n     }\n+    if (!c.getBoolean(HConstants.CLUSTER_DISTRIBUTED, false)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkxMDY5Nw=="}, "originalCommit": {"oid": "788f800c68200f78eb05b535d33b4b4f8fcff64f"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MzE4NDAzOnYy", "diffSide": "RIGHT", "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/util/CommonFSUtils.java", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwMjowMToxM1rOF_YwyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNzoxNDoxOFrOF_1MtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjAxMDMxMw==", "bodyText": "Just test whether this is a LocalFileSystem is enough?", "url": "https://github.com/apache/hbase/pull/1408#discussion_r402010313", "createdAt": "2020-04-02T02:01:13Z", "author": {"login": "Apache9"}, "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/util/CommonFSUtils.java", "diffHunk": "@@ -350,11 +349,19 @@ public static void setWALRootDir(final Configuration c, final Path root) {\n   public static FileSystem getWALFileSystem(final Configuration c) throws IOException {\n     Path p = getWALRootDir(c);\n     FileSystem fs = p.getFileSystem(c);\n-    // hadoop-core does fs caching, so need to propogate this if set\n+    // hadoop-core does fs caching, so need to propagate this if set\n     String enforceStreamCapability = c.get(UNSAFE_STREAM_CAPABILITY_ENFORCE);\n     if (enforceStreamCapability != null) {\n       fs.getConf().set(UNSAFE_STREAM_CAPABILITY_ENFORCE, enforceStreamCapability);\n     }\n+    if (!c.getBoolean(HConstants.CLUSTER_DISTRIBUTED, false)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d798e78da954d6cbbe96566252912f8efb58baf"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjAxNTI1Nw==", "bodyText": "You tell me :)\nYes, for running out of the source tree, not modifying any configuration, this change permits the process to start, master and region server threads all come online. I performed some additional verification by running ltt against the process, a scant 100k rows.\nI don't know well when we choose LocalFileSystem vs. RawLocalFIleSystem, so there may be other issues lurking.", "url": "https://github.com/apache/hbase/pull/1408#discussion_r402015257", "createdAt": "2020-04-02T02:21:11Z", "author": {"login": "ndimiduk"}, "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/util/CommonFSUtils.java", "diffHunk": "@@ -350,11 +349,19 @@ public static void setWALRootDir(final Configuration c, final Path root) {\n   public static FileSystem getWALFileSystem(final Configuration c) throws IOException {\n     Path p = getWALRootDir(c);\n     FileSystem fs = p.getFileSystem(c);\n-    // hadoop-core does fs caching, so need to propogate this if set\n+    // hadoop-core does fs caching, so need to propagate this if set\n     String enforceStreamCapability = c.get(UNSAFE_STREAM_CAPABILITY_ENFORCE);\n     if (enforceStreamCapability != null) {\n       fs.getConf().set(UNSAFE_STREAM_CAPABILITY_ENFORCE, enforceStreamCapability);\n     }\n+    if (!c.getBoolean(HConstants.CLUSTER_DISTRIBUTED, false)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjAxMDMxMw=="}, "originalCommit": {"oid": "8d798e78da954d6cbbe96566252912f8efb58baf"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjA1OTQxOA==", "bodyText": "Hmm.. I too think it should just be (fs instanceof LocalFS).. With this patch, try using the following combination (distributed cluster + localfs), it fails with the same error when it should work..\n<configuration>\n    <property>\n          <name>hbase.cluster.distributed</name>\n          <value>true</value>\n    </property>\n</configuration>\n\nPoint being that, these two configuration params are disjoint. Meaning a distributed/non-distributed cluster should work with a local file system. Stream capability is a property of the FS in use, so just a check on FS should be good IMO.\nI poked around a little bit about RawFS in the hadoop code, didn't fully understand its use but it appears that FileSystem when parsing the config would pick LocalFileSystem when the scheme is file:///. So I think just doing it for LocalFileSystem should be ok.", "url": "https://github.com/apache/hbase/pull/1408#discussion_r402059418", "createdAt": "2020-04-02T05:27:50Z", "author": {"login": "bharathv"}, "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/util/CommonFSUtils.java", "diffHunk": "@@ -350,11 +349,19 @@ public static void setWALRootDir(final Configuration c, final Path root) {\n   public static FileSystem getWALFileSystem(final Configuration c) throws IOException {\n     Path p = getWALRootDir(c);\n     FileSystem fs = p.getFileSystem(c);\n-    // hadoop-core does fs caching, so need to propogate this if set\n+    // hadoop-core does fs caching, so need to propagate this if set\n     String enforceStreamCapability = c.get(UNSAFE_STREAM_CAPABILITY_ENFORCE);\n     if (enforceStreamCapability != null) {\n       fs.getConf().set(UNSAFE_STREAM_CAPABILITY_ENFORCE, enforceStreamCapability);\n     }\n+    if (!c.getBoolean(HConstants.CLUSTER_DISTRIBUTED, false)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjAxMDMxMw=="}, "originalCommit": {"oid": "8d798e78da954d6cbbe96566252912f8efb58baf"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ1NjQyNQ==", "bodyText": "How do you run a distributed cluster on local fs? You running off of shared NFS mounts?", "url": "https://github.com/apache/hbase/pull/1408#discussion_r402456425", "createdAt": "2020-04-02T16:43:04Z", "author": {"login": "ndimiduk"}, "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/util/CommonFSUtils.java", "diffHunk": "@@ -350,11 +349,19 @@ public static void setWALRootDir(final Configuration c, final Path root) {\n   public static FileSystem getWALFileSystem(final Configuration c) throws IOException {\n     Path p = getWALRootDir(c);\n     FileSystem fs = p.getFileSystem(c);\n-    // hadoop-core does fs caching, so need to propogate this if set\n+    // hadoop-core does fs caching, so need to propagate this if set\n     String enforceStreamCapability = c.get(UNSAFE_STREAM_CAPABILITY_ENFORCE);\n     if (enforceStreamCapability != null) {\n       fs.getConf().set(UNSAFE_STREAM_CAPABILITY_ENFORCE, enforceStreamCapability);\n     }\n+    if (!c.getBoolean(HConstants.CLUSTER_DISTRIBUTED, false)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjAxMDMxMw=="}, "originalCommit": {"oid": "8d798e78da954d6cbbe96566252912f8efb58baf"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ2NTI5Mw==", "bodyText": "Pseudo-distributed http://hbase.apache.org/book.html#quickstart_pseudo, just that I didn't set \"hbase.rootdir\" and hence it defaults to local fs.", "url": "https://github.com/apache/hbase/pull/1408#discussion_r402465293", "createdAt": "2020-04-02T16:56:34Z", "author": {"login": "bharathv"}, "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/util/CommonFSUtils.java", "diffHunk": "@@ -350,11 +349,19 @@ public static void setWALRootDir(final Configuration c, final Path root) {\n   public static FileSystem getWALFileSystem(final Configuration c) throws IOException {\n     Path p = getWALRootDir(c);\n     FileSystem fs = p.getFileSystem(c);\n-    // hadoop-core does fs caching, so need to propogate this if set\n+    // hadoop-core does fs caching, so need to propagate this if set\n     String enforceStreamCapability = c.get(UNSAFE_STREAM_CAPABILITY_ENFORCE);\n     if (enforceStreamCapability != null) {\n       fs.getConf().set(UNSAFE_STREAM_CAPABILITY_ENFORCE, enforceStreamCapability);\n     }\n+    if (!c.getBoolean(HConstants.CLUSTER_DISTRIBUTED, false)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjAxMDMxMw=="}, "originalCommit": {"oid": "8d798e78da954d6cbbe96566252912f8efb58baf"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ3NjIxMg==", "bodyText": "Yeah, fair enough. So I'll remove the CLUSTER_DISTRIBUTED check and instead check fs instanceOf LocalFileSystem.\nI also asked the stream capabilities question over on hdfs-user.", "url": "https://github.com/apache/hbase/pull/1408#discussion_r402476212", "createdAt": "2020-04-02T17:14:18Z", "author": {"login": "ndimiduk"}, "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/util/CommonFSUtils.java", "diffHunk": "@@ -350,11 +349,19 @@ public static void setWALRootDir(final Configuration c, final Path root) {\n   public static FileSystem getWALFileSystem(final Configuration c) throws IOException {\n     Path p = getWALRootDir(c);\n     FileSystem fs = p.getFileSystem(c);\n-    // hadoop-core does fs caching, so need to propogate this if set\n+    // hadoop-core does fs caching, so need to propagate this if set\n     String enforceStreamCapability = c.get(UNSAFE_STREAM_CAPABILITY_ENFORCE);\n     if (enforceStreamCapability != null) {\n       fs.getConf().set(UNSAFE_STREAM_CAPABILITY_ENFORCE, enforceStreamCapability);\n     }\n+    if (!c.getBoolean(HConstants.CLUSTER_DISTRIBUTED, false)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjAxMDMxMw=="}, "originalCommit": {"oid": "8d798e78da954d6cbbe96566252912f8efb58baf"}, "originalPosition": 32}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1960, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}