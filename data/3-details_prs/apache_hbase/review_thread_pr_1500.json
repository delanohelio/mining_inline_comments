{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyNDk2NzU4", "number": 1500, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QyMDo1OTowOVrOD25Ofg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QyMTowMjowNFrOD25TXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU4ODg3Mjk0OnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QyMDo1OTowOVrOGM3bcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQwMjozODo0MlrOGM_8UA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE0NDI0Mw==", "bodyText": "If the Region went to another server and was over there for a week before coming to this server, then these metrics would be incorrect? Thats ok?", "url": "https://github.com/apache/hbase/pull/1500#discussion_r416144243", "createdAt": "2020-04-27T20:59:09Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "diffHunk": "@@ -877,6 +877,19 @@ public HRegion(final HRegionFileSystem fs, final WAL wal, final Configuration co\n     this.maxCellSize = conf.getLong(HBASE_MAX_CELL_SIZE_KEY, DEFAULT_MAX_CELL_SIZE);\n     this.miniBatchSize = conf.getInt(HBASE_REGIONSERVER_MINIBATCH_SIZE,\n         DEFAULT_HBASE_REGIONSERVER_MINIBATCH_SIZE);\n+\n+    // recover the metrics of read and write requests count if they were retained\n+    if (rsServices != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b61ab26bbbf2f98b6ca9c0cede5bcc362f56c14"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjI4MzcyOA==", "bodyText": "In this case, the metrics would be zero, i think it is correct.\nBTW, there are three type of statistical calibers on region r/w count:\n\ncumulative by all regionserver\ncumulative by independent regionserver\ncumulative by independent regionserver in continuous time range\n\nIMO, the third one is more clear to users.", "url": "https://github.com/apache/hbase/pull/1500#discussion_r416283728", "createdAt": "2020-04-28T02:38:42Z", "author": {"login": "bsglz"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "diffHunk": "@@ -877,6 +877,19 @@ public HRegion(final HRegionFileSystem fs, final WAL wal, final Configuration co\n     this.maxCellSize = conf.getLong(HBASE_MAX_CELL_SIZE_KEY, DEFAULT_MAX_CELL_SIZE);\n     this.miniBatchSize = conf.getInt(HBASE_REGIONSERVER_MINIBATCH_SIZE,\n         DEFAULT_HBASE_REGIONSERVER_MINIBATCH_SIZE);\n+\n+    // recover the metrics of read and write requests count if they were retained\n+    if (rsServices != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE0NDI0Mw=="}, "originalCommit": {"oid": "9b61ab26bbbf2f98b6ca9c0cede5bcc362f56c14"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU4ODg3NDY5OnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QyMDo1OTozNFrOGM3cfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNTo0Nzo1NlrOGTiRuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE0NDUwOA==", "bodyText": "Has to be public? Can't be private or package private?", "url": "https://github.com/apache/hbase/pull/1500#discussion_r416144508", "createdAt": "2020-04-27T20:59:34Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "diffHunk": "@@ -8964,4 +8977,12 @@ static void decorateRegionConfiguration(Configuration conf) {\n       }\n     }\n   }\n+\n+  public void setReadRequestsCount(long readRequestsCount) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b61ab26bbbf2f98b6ca9c0cede5bcc362f56c14"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjI4NDY2Mg==", "bodyText": "It could be private, will fix.", "url": "https://github.com/apache/hbase/pull/1500#discussion_r416284662", "createdAt": "2020-04-28T02:41:53Z", "author": {"login": "bsglz"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "diffHunk": "@@ -8964,4 +8977,12 @@ static void decorateRegionConfiguration(Configuration conf) {\n       }\n     }\n   }\n+\n+  public void setReadRequestsCount(long readRequestsCount) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE0NDUwOA=="}, "originalCommit": {"oid": "9b61ab26bbbf2f98b6ca9c0cede5bcc362f56c14"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzEyNzU2MQ==", "bodyText": "Were you going to make these private?", "url": "https://github.com/apache/hbase/pull/1500#discussion_r423127561", "createdAt": "2020-05-11T15:33:15Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "diffHunk": "@@ -8964,4 +8977,12 @@ static void decorateRegionConfiguration(Configuration conf) {\n       }\n     }\n   }\n+\n+  public void setReadRequestsCount(long readRequestsCount) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE0NDUwOA=="}, "originalCommit": {"oid": "9b61ab26bbbf2f98b6ca9c0cede5bcc362f56c14"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzEzNzcyMA==", "bodyText": "I found it used by ut, so changed to public and marked VisableForTesting.", "url": "https://github.com/apache/hbase/pull/1500#discussion_r423137720", "createdAt": "2020-05-11T15:47:56Z", "author": {"login": "bsglz"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "diffHunk": "@@ -8964,4 +8977,12 @@ static void decorateRegionConfiguration(Configuration conf) {\n       }\n     }\n   }\n+\n+  public void setReadRequestsCount(long readRequestsCount) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE0NDUwOA=="}, "originalCommit": {"oid": "9b61ab26bbbf2f98b6ca9c0cede5bcc362f56c14"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU4ODg3ODcwOnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerAccounting.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QyMTowMDozNVrOGM3e_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQwMjo0NjowOVrOGNAFBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE0NTE0OA==", "bodyText": "Has to be public? Can't be package private?", "url": "https://github.com/apache/hbase/pull/1500#discussion_r416145148", "createdAt": "2020-04-27T21:00:35Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerAccounting.java", "diffHunk": "@@ -123,6 +127,13 @@ public long getGlobalMemStoreOffHeapSize() {\n     return this.globalMemStoreOffHeapSize.sum();\n   }\n \n+  /**\n+   * @return the retained metrics of region's read and write requests count\n+   */\n+  public ConcurrentMap<String, Pair<Long, Long>> getRetainedRegionRWRequestsCnt() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b61ab26bbbf2f98b6ca9c0cede5bcc362f56c14"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjI4NTk1OQ==", "bodyText": "It could be protected, will fix.", "url": "https://github.com/apache/hbase/pull/1500#discussion_r416285959", "createdAt": "2020-04-28T02:46:09Z", "author": {"login": "bsglz"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerAccounting.java", "diffHunk": "@@ -123,6 +127,13 @@ public long getGlobalMemStoreOffHeapSize() {\n     return this.globalMemStoreOffHeapSize.sum();\n   }\n \n+  /**\n+   * @return the retained metrics of region's read and write requests count\n+   */\n+  public ConcurrentMap<String, Pair<Long, Long>> getRetainedRegionRWRequestsCnt() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE0NTE0OA=="}, "originalCommit": {"oid": "9b61ab26bbbf2f98b6ca9c0cede5bcc362f56c14"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU4ODg4NTQzOnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerAccounting.java", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QyMTowMjowNFrOGM3i2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNTo1MjoxMlrOGTidMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE0NjEzNg==", "bodyText": "This data structure can grow w/o bound?\nThis data structure needs a comment on how it is used and life cycle of items. They items should age out I'd think.", "url": "https://github.com/apache/hbase/pull/1500#discussion_r416146136", "createdAt": "2020-04-27T21:02:04Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerAccounting.java", "diffHunk": "@@ -67,6 +70,7 @@ public RegionServerAccounting(Configuration conf) {\n     this.globalOnHeapMemstoreLimit = MemorySizeUtil.getOnheapGlobalMemStoreSize(conf);\n     this.globalOnHeapMemstoreLimitLowMark =\n         (long) (this.globalOnHeapMemstoreLimit * this.globalMemStoreLimitLowMarkPercent);\n+    this.retainedRegionRWRequestsCnt = new ConcurrentHashMap<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b61ab26bbbf2f98b6ca9c0cede5bcc362f56c14"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjI5Mzg0Mw==", "bodyText": "This data structure can grow w/o bound?\n\nThe entry of it will be removed in time, so will not grow too big.\n\nThis data structure needs a comment on how it is used and life cycle of items. They items should age out I'd think.\n\nAdded some comment.", "url": "https://github.com/apache/hbase/pull/1500#discussion_r416293843", "createdAt": "2020-04-28T03:10:35Z", "author": {"login": "bsglz"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerAccounting.java", "diffHunk": "@@ -67,6 +70,7 @@ public RegionServerAccounting(Configuration conf) {\n     this.globalOnHeapMemstoreLimit = MemorySizeUtil.getOnheapGlobalMemStoreSize(conf);\n     this.globalOnHeapMemstoreLimitLowMark =\n         (long) (this.globalOnHeapMemstoreLimit * this.globalMemStoreLimitLowMarkPercent);\n+    this.retainedRegionRWRequestsCnt = new ConcurrentHashMap<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE0NjEzNg=="}, "originalCommit": {"oid": "9b61ab26bbbf2f98b6ca9c0cede5bcc362f56c14"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzEzMDY5Mw==", "bodyText": "So, this data structure will get an entry when we close a region that we are to reopen on this server? On open, the entry is removed?\ns/reigon/region/", "url": "https://github.com/apache/hbase/pull/1500#discussion_r423130693", "createdAt": "2020-05-11T15:37:35Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerAccounting.java", "diffHunk": "@@ -67,6 +70,7 @@ public RegionServerAccounting(Configuration conf) {\n     this.globalOnHeapMemstoreLimit = MemorySizeUtil.getOnheapGlobalMemStoreSize(conf);\n     this.globalOnHeapMemstoreLimitLowMark =\n         (long) (this.globalOnHeapMemstoreLimit * this.globalMemStoreLimitLowMarkPercent);\n+    this.retainedRegionRWRequestsCnt = new ConcurrentHashMap<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE0NjEzNg=="}, "originalCommit": {"oid": "9b61ab26bbbf2f98b6ca9c0cede5bcc362f56c14"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzEzMTA4Ng==", "bodyText": "Does the reopen of regions on same server happen often?", "url": "https://github.com/apache/hbase/pull/1500#discussion_r423131086", "createdAt": "2020-05-11T15:38:09Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerAccounting.java", "diffHunk": "@@ -67,6 +70,7 @@ public RegionServerAccounting(Configuration conf) {\n     this.globalOnHeapMemstoreLimit = MemorySizeUtil.getOnheapGlobalMemStoreSize(conf);\n     this.globalOnHeapMemstoreLimitLowMark =\n         (long) (this.globalOnHeapMemstoreLimit * this.globalMemStoreLimitLowMarkPercent);\n+    this.retainedRegionRWRequestsCnt = new ConcurrentHashMap<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE0NjEzNg=="}, "originalCommit": {"oid": "9b61ab26bbbf2f98b6ca9c0cede5bcc362f56c14"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzEzODYyNA==", "bodyText": "So, this data structure will get an entry when we close a region that we are to reopen on this server? On open, the entry is removed?\ns/reigon/region/\n\nYeah.", "url": "https://github.com/apache/hbase/pull/1500#discussion_r423138624", "createdAt": "2020-05-11T15:49:18Z", "author": {"login": "bsglz"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerAccounting.java", "diffHunk": "@@ -67,6 +70,7 @@ public RegionServerAccounting(Configuration conf) {\n     this.globalOnHeapMemstoreLimit = MemorySizeUtil.getOnheapGlobalMemStoreSize(conf);\n     this.globalOnHeapMemstoreLimitLowMark =\n         (long) (this.globalOnHeapMemstoreLimit * this.globalMemStoreLimitLowMarkPercent);\n+    this.retainedRegionRWRequestsCnt = new ConcurrentHashMap<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE0NjEzNg=="}, "originalCommit": {"oid": "9b61ab26bbbf2f98b6ca9c0cede5bcc362f56c14"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE0MDY1OQ==", "bodyText": "Does the reopen of regions on same server happen often?\n\nIt will happen when alter table.", "url": "https://github.com/apache/hbase/pull/1500#discussion_r423140659", "createdAt": "2020-05-11T15:52:12Z", "author": {"login": "bsglz"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerAccounting.java", "diffHunk": "@@ -67,6 +70,7 @@ public RegionServerAccounting(Configuration conf) {\n     this.globalOnHeapMemstoreLimit = MemorySizeUtil.getOnheapGlobalMemStoreSize(conf);\n     this.globalOnHeapMemstoreLimitLowMark =\n         (long) (this.globalOnHeapMemstoreLimit * this.globalMemStoreLimitLowMarkPercent);\n+    this.retainedRegionRWRequestsCnt = new ConcurrentHashMap<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE0NjEzNg=="}, "originalCommit": {"oid": "9b61ab26bbbf2f98b6ca9c0cede5bcc362f56c14"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1915, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}