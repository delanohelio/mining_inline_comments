{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg5MzQ5OTM5", "number": 2419, "title": "HBASE-25050 - We initialize Filesystems more than once.", "bodyText": "A simple fix.", "createdAt": "2020-09-18T14:23:16Z", "url": "https://github.com/apache/hbase/pull/2419", "merged": true, "mergeCommit": {"oid": "f221d11227049a95bbe1ee531d237bed001a6914"}, "closed": true, "closedAt": "2020-11-24T10:01:04Z", "author": {"login": "ramkrish86"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdKGnTJAFqTQ5MTUyNjgyMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdfmr8sgBqjQwMzE4MjQ3NTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNTI2ODIw", "url": "https://github.com/apache/hbase/pull/2419#pullrequestreview-491526820", "createdAt": "2020-09-18T14:38:46Z", "commit": {"oid": "29cac230b871f03edb819074ff97c33f1df9182e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxNDozODo0NlrOHUP-wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxNDozODo0NlrOHUP-wg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk5NTM5NA==", "bodyText": "where else do we do the initialize?", "url": "https://github.com/apache/hbase/pull/2419#discussion_r490995394", "createdAt": "2020-09-18T14:38:46Z", "author": {"login": "busbey"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/fs/HFileSystem.java", "diffHunk": "@@ -85,8 +85,6 @@ public HFileSystem(Configuration conf, boolean useHBaseChecksum)\n     this.fs = FileSystem.get(conf);\n     this.useHBaseChecksum = useHBaseChecksum;\n \n-    fs.initialize(getDefaultUri(conf), conf);\n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29cac230b871f03edb819074ff97c33f1df9182e"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNTUyOTcy", "url": "https://github.com/apache/hbase/pull/2419#pullrequestreview-491552972", "createdAt": "2020-09-18T15:08:55Z", "commit": {"oid": "29cac230b871f03edb819074ff97c33f1df9182e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxNTowODo1NVrOHURKLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxNTowODo1NVrOHURKLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTAxNDcwMg==", "bodyText": "looking at the source and javadocs for hadoop versions we use, I think we should remove this line as you have done and then also replace line 85 with\n this.fs = FileSystem.get(getDefaultUri(conf), conf);\n\nbecause the javadocs for that version of get make clear that initialize will have already been called on whatever is returned. the get method we're using now is ambiguous about it.", "url": "https://github.com/apache/hbase/pull/2419#discussion_r491014702", "createdAt": "2020-09-18T15:08:55Z", "author": {"login": "busbey"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/fs/HFileSystem.java", "diffHunk": "@@ -85,8 +85,6 @@ public HFileSystem(Configuration conf, boolean useHBaseChecksum)\n     this.fs = FileSystem.get(conf);\n     this.useHBaseChecksum = useHBaseChecksum;\n \n-    fs.initialize(getDefaultUri(conf), conf);\n-", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk5NTM5NA=="}, "originalCommit": {"oid": "29cac230b871f03edb819074ff97c33f1df9182e"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3OTA4MjI5", "url": "https://github.com/apache/hbase/pull/2419#pullrequestreview-507908229", "createdAt": "2020-10-14T00:01:59Z", "commit": {"oid": "4ee205ad4b8fcc1748eb9093f649039caa31dda8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwOTg3NjQ2", "url": "https://github.com/apache/hbase/pull/2419#pullrequestreview-510987646", "createdAt": "2020-10-17T13:55:51Z", "commit": {"oid": "08934cbaf0d8d731154aa9cea0064925b1572955"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QxMzo1NTo1MVrOHjdhNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QxMzo1NTo1MVrOHjdhNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk0NTg0Nw==", "bodyText": "Mind explaining a bit why we need this change? And also add it to the comment above? And I also see later we all change to use URI instead of Path. What is the reason?", "url": "https://github.com/apache/hbase/pull/2419#discussion_r506945847", "createdAt": "2020-10-17T13:55:51Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/fs/HFileSystem.java", "diffHunk": "@@ -82,11 +82,9 @@ public HFileSystem(Configuration conf, boolean useHBaseChecksum)\n     // Create the default filesystem with checksum verification switched on.\n     // By default, any operation to this FilterFileSystem occurs on\n     // the underlying filesystem that has checksums switched on.\n-    this.fs = FileSystem.get(conf);\n+    this.fs = FileSystem.get(getDefaultUri(conf), conf);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08934cbaf0d8d731154aa9cea0064925b1572955"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyOTcwMTEx", "url": "https://github.com/apache/hbase/pull/2419#pullrequestreview-512970111", "createdAt": "2020-10-20T17:27:28Z", "commit": {"oid": "342517b54d323acb5106a5c92dfdbdd829e3ec93"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNzoyNzoyOFrOHlJL0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNzoyNzoyOFrOHlJL0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODcwOTg0Mw==", "bodyText": "To Duo's request, add in something like:\n// We take pains to funnel all of our FileSystem instantiation through this call to ensure\n// we never need to call FS.initialize ourself so that we do not have to track any state to\n// avoid calling initialize more than once.", "url": "https://github.com/apache/hbase/pull/2419#discussion_r508709843", "createdAt": "2020-10-20T17:27:28Z", "author": {"login": "busbey"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/fs/HFileSystem.java", "diffHunk": "@@ -82,7 +82,10 @@ public HFileSystem(Configuration conf, boolean useHBaseChecksum)\n     // Create the default filesystem with checksum verification switched on.\n     // By default, any operation to this FilterFileSystem occurs on\n     // the underlying filesystem that has checksums switched on.\n-    this.fs = FileSystem.get(conf);\n+    // This FS#get(URI, conf) clearly indicates in the javadoc that if the FS is\n+    // not created it will initialize the FS and return that created FS. If it is\n+    // already created it will just return the FS that was already created.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "342517b54d323acb5106a5c92dfdbdd829e3ec93"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c2e1229d4ea3fad6d4546462bcfdd8d0adfd748", "author": {"user": {"login": "ramkrish86", "name": null}}, "url": "https://github.com/apache/hbase/commit/1c2e1229d4ea3fad6d4546462bcfdd8d0adfd748", "committedDate": "2020-11-24T09:46:54Z", "message": "HBASE-25050 - We initialize Filesystems more than once."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09101c70ca3f219aad3034f530f292d4b260db27", "author": {"user": {"login": "ramkrish86", "name": null}}, "url": "https://github.com/apache/hbase/commit/09101c70ca3f219aad3034f530f292d4b260db27", "committedDate": "2020-11-24T09:46:54Z", "message": "Ensuring that calling the FS#get() will only ensure FS init."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04005ce99e76d7dfcc92343dc2cfd8e283ad1014", "author": {"user": {"login": "ramkrish86", "name": null}}, "url": "https://github.com/apache/hbase/commit/04005ce99e76d7dfcc92343dc2cfd8e283ad1014", "committedDate": "2020-11-24T09:46:54Z", "message": "Fix for testfailures. We should pass the entire path and no the scheme\nalone"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fec3a499b958158d069265d357c854452ead2d8", "author": {"user": {"login": "ramkrish86", "name": null}}, "url": "https://github.com/apache/hbase/commit/3fec3a499b958158d069265d357c854452ead2d8", "committedDate": "2020-11-24T09:46:54Z", "message": "Cases where we don't have a scheme for the URI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e07afe1a21660c31c495daea17ec142e8d57103e", "author": {"user": {"login": "ramkrish86", "name": null}}, "url": "https://github.com/apache/hbase/commit/e07afe1a21660c31c495daea17ec142e8d57103e", "committedDate": "2020-11-24T09:46:54Z", "message": "Address review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef08ccd262a5dbbf6d16b958da3ade3ce79c4e85", "author": {"user": {"login": "ramkrish86", "name": null}}, "url": "https://github.com/apache/hbase/commit/ef08ccd262a5dbbf6d16b958da3ade3ce79c4e85", "committedDate": "2020-11-24T09:46:54Z", "message": "Add some comments on why FS#get(URI, conf) is getting used"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c7238e9349d7cc7ba0595d035c46ef7aec75e33", "author": {"user": {"login": "ramkrish86", "name": null}}, "url": "https://github.com/apache/hbase/commit/6c7238e9349d7cc7ba0595d035c46ef7aec75e33", "committedDate": "2020-11-24T09:51:45Z", "message": "Adding the comment as per Sean's review"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "342517b54d323acb5106a5c92dfdbdd829e3ec93", "author": {"user": {"login": "ramkrish86", "name": null}}, "url": "https://github.com/apache/hbase/commit/342517b54d323acb5106a5c92dfdbdd829e3ec93", "committedDate": "2020-10-19T05:24:13Z", "message": "Add some comments on why FS#get(URI, conf) is getting used"}, "afterCommit": {"oid": "6c7238e9349d7cc7ba0595d035c46ef7aec75e33", "author": {"user": {"login": "ramkrish86", "name": null}}, "url": "https://github.com/apache/hbase/commit/6c7238e9349d7cc7ba0595d035c46ef7aec75e33", "committedDate": "2020-11-24T09:51:45Z", "message": "Adding the comment as per Sean's review"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4512, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}