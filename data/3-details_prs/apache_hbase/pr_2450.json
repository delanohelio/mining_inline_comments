{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyMTQ0NDEx", "number": 2450, "title": "HBASE-25093 the RSGroupBasedLoadBalancer#retainAssignment throws NPE", "bodyText": "", "createdAt": "2020-09-24T02:35:55Z", "url": "https://github.com/apache/hbase/pull/2450", "merged": true, "mergeCommit": {"oid": "8eea05235929a16706a83b759d98f9336f10fd49"}, "closed": true, "closedAt": "2020-10-12T03:02:38Z", "author": {"login": "nyl3532016"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdL36t9gFqTQ5NTE4MDQ0Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdRe1yZgFqTUwNjE3NjMzMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1MTgwNDQ3", "url": "https://github.com/apache/hbase/pull/2450#pullrequestreview-495180447", "createdAt": "2020-09-24T02:39:15Z", "commit": {"oid": "275f0bdeb56cbb6ae80f626333635e505adc2598"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwMjozOToxNVrOHXHqTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwMjozOToxNVrOHXHqTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDAwNDgxNA==", "bodyText": "When will retainAssignment return null? If there is no difference between a null and an empty Map, let's just return an empty Map to avoid the null check here?", "url": "https://github.com/apache/hbase/pull/2450#discussion_r494004814", "createdAt": "2020-09-24T02:39:15Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/rsgroup/RSGroupBasedLoadBalancer.java", "diffHunk": "@@ -203,8 +203,11 @@ public void setMasterServices(MasterServices masterServices) {\n         regionList.forEach(r -> currentAssignmentMap.put(r, regions.get(r)));\n         Map<ServerName, List<RegionInfo>> pairResult =\n             this.internalBalancer.retainAssignment(currentAssignmentMap, pair.getSecond());\n-        pairResult.forEach((server, rs) ->\n-            assignments.computeIfAbsent(server, s -> Lists.newArrayList()).addAll(rs));\n+        if (pairResult == null || pairResult.isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "275f0bdeb56cbb6ae80f626333635e505adc2598"}, "originalPosition": 15}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "275f0bdeb56cbb6ae80f626333635e505adc2598", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/275f0bdeb56cbb6ae80f626333635e505adc2598", "committedDate": "2020-09-24T02:34:28Z", "message": "HBASE-25093 the RSGroupBasedLoadBalancer#retainAssignment throws NPE"}, "afterCommit": {"oid": "2a04beb23230a7f331e61d257462cf6f6f4a5e25", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/2a04beb23230a7f331e61d257462cf6f6f4a5e25", "committedDate": "2020-09-24T11:20:25Z", "message": "HBASE-25093 the RSGroupBasedLoadBalancer#retainAssignment throws NPE"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2a04beb23230a7f331e61d257462cf6f6f4a5e25", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/2a04beb23230a7f331e61d257462cf6f6f4a5e25", "committedDate": "2020-09-24T11:20:25Z", "message": "HBASE-25093 the RSGroupBasedLoadBalancer#retainAssignment throws NPE"}, "afterCommit": {"oid": "8267ab4948b400e8925a752a32c1631c8c67550a", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/8267ab4948b400e8925a752a32c1631c8c67550a", "committedDate": "2020-09-29T08:01:24Z", "message": "HBASE-25093 the RSGroupBasedLoadBalancer#retainAssignment throws NPE"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86275542f37d997544abe1fcddc704cec065c4ed", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/86275542f37d997544abe1fcddc704cec065c4ed", "committedDate": "2020-09-29T12:04:26Z", "message": "HBASE-25093 the RSGroupBasedLoadBalancer#retainAssignment throws NPE"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8267ab4948b400e8925a752a32c1631c8c67550a", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/8267ab4948b400e8925a752a32c1631c8c67550a", "committedDate": "2020-09-29T08:01:24Z", "message": "HBASE-25093 the RSGroupBasedLoadBalancer#retainAssignment throws NPE"}, "afterCommit": {"oid": "86275542f37d997544abe1fcddc704cec065c4ed", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/86275542f37d997544abe1fcddc704cec065c4ed", "committedDate": "2020-09-29T12:04:26Z", "message": "HBASE-25093 the RSGroupBasedLoadBalancer#retainAssignment throws NPE"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MTAxNjMx", "url": "https://github.com/apache/hbase/pull/2450#pullrequestreview-506101631", "createdAt": "2020-10-10T14:31:09Z", "commit": {"oid": "86275542f37d997544abe1fcddc704cec065c4ed"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQxNDozMTowOVrOHfgRMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQxNDozMTowOVrOHfgRMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc5NjU5NA==", "bodyText": "Why this change?", "url": "https://github.com/apache/hbase/pull/2450#discussion_r502796594", "createdAt": "2020-10-10T14:31:09Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/AssignmentManager.java", "diffHunk": "@@ -2150,12 +2150,8 @@ private void acceptPlan(final HashMap<RegionInfo, RegionStateNode> regions,\n     final ProcedureEvent<?>[] events = new ProcedureEvent[regions.size()];\n     final long st = System.currentTimeMillis();\n \n-    if (plan == null) {\n-      throw new HBaseIOException(\"unable to compute plans for regions=\" + regions.size());\n-    }\n-\n     if (plan.isEmpty()) {\n-      return;\n+      throw new HBaseIOException(\"unable to compute plans for regions=\" + regions.size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86275542f37d997544abe1fcddc704cec065c4ed"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MTc2MzMy", "url": "https://github.com/apache/hbase/pull/2450#pullrequestreview-506176332", "createdAt": "2020-10-11T12:49:46Z", "commit": {"oid": "86275542f37d997544abe1fcddc704cec065c4ed"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMVQxMjo0OTo0NlrOHfnRkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMVQxMjo0OTo0NlrOHfnRkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjkxMTM3Ng==", "bodyText": "Oh, just saw the 'plan == null' in the old code. This is a bit strange as the plan is a function parameter, but anyway, not your fault.", "url": "https://github.com/apache/hbase/pull/2450#discussion_r502911376", "createdAt": "2020-10-11T12:49:46Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/AssignmentManager.java", "diffHunk": "@@ -2150,12 +2150,8 @@ private void acceptPlan(final HashMap<RegionInfo, RegionStateNode> regions,\n     final ProcedureEvent<?>[] events = new ProcedureEvent[regions.size()];\n     final long st = System.currentTimeMillis();\n \n-    if (plan == null) {\n-      throw new HBaseIOException(\"unable to compute plans for regions=\" + regions.size());\n-    }\n-\n     if (plan.isEmpty()) {\n-      return;\n+      throw new HBaseIOException(\"unable to compute plans for regions=\" + regions.size());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc5NjU5NA=="}, "originalCommit": {"oid": "86275542f37d997544abe1fcddc704cec065c4ed"}, "originalPosition": 10}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4558, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}