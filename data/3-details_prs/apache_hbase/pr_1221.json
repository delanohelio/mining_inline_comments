{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxMTkxMzky", "number": 1221, "title": "HBASE-23895 STUCK Region-In-Transition when failed to insert procedur\u2026", "bodyText": "\u2026e to procedure store", "createdAt": "2020-02-28T04:07:34Z", "url": "https://github.com/apache/hbase/pull/1221", "merged": true, "mergeCommit": {"oid": "9b0d214b7b7626d3706f5cddfe44e89962a9fcf0"}, "closed": true, "closedAt": "2020-03-07T07:50:10Z", "author": {"login": "infraio"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIqwE0ABqjMwODA3NTExNTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcLMwTOABqjMxMDc0NDQ2OTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "86fff54ef990050de66109e3dc80930b2e79f9e7", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/86fff54ef990050de66109e3dc80930b2e79f9e7", "committedDate": "2020-02-28T04:02:24Z", "message": "HBASE-23895 STUCK Region-In-Transition when failed to insert procedure to procedure store"}, "afterCommit": {"oid": "7c14ac5f4f520d024a331f9e408ca18aebd8107c", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/7c14ac5f4f520d024a331f9e408ca18aebd8107c", "committedDate": "2020-02-28T07:25:30Z", "message": "HBASE-23895 STUCK Region-In-Transition when failed to insert procedure to procedure store"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3NDI3ODI3", "url": "https://github.com/apache/hbase/pull/1221#pullrequestreview-367427827", "createdAt": "2020-03-02T18:31:47Z", "commit": {"oid": "7c14ac5f4f520d024a331f9e408ca18aebd8107c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxODozMTo0N1rOFwqbTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxODozMTo0N1rOFwqbTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU3MTA4Nw==", "bodyText": "Will this work?\nWe still might get another's rpc when the RpcServer is called because the row key clashes?", "url": "https://github.com/apache/hbase/pull/1221#discussion_r386571087", "createdAt": "2020-03-02T18:31:47Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/procedure2/store/region/RegionProcedureStore.java", "diffHunk": "@@ -552,11 +586,12 @@ public void insert(Procedure<?> proc, Procedure<?>[] subProcs) {\n       for (Procedure<?> subProc : subProcs) {\n         serializePut(subProc, mutations, rowsToLock);\n       }\n-      region.mutateRowsWithLocks(mutations, rowsToLock, NO_NONCE, NO_NONCE);\n+      executeInsert(mutations, rowsToLock);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c14ac5f4f520d024a331f9e408ca18aebd8107c"}, "originalPosition": 90}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7c14ac5f4f520d024a331f9e408ca18aebd8107c", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/7c14ac5f4f520d024a331f9e408ca18aebd8107c", "committedDate": "2020-02-28T07:25:30Z", "message": "HBASE-23895 STUCK Region-In-Transition when failed to insert procedure to procedure store"}, "afterCommit": {"oid": "69d5fc6650f7cc1797244d54cb46d22753d71a86", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/69d5fc6650f7cc1797244d54cb46d22753d71a86", "committedDate": "2020-03-03T08:09:26Z", "message": "HBASE-23895 STUCK Region-In-Transition when failed to insert procedure to procedure store"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "69d5fc6650f7cc1797244d54cb46d22753d71a86", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/69d5fc6650f7cc1797244d54cb46d22753d71a86", "committedDate": "2020-03-03T08:09:26Z", "message": "HBASE-23895 STUCK Region-In-Transition when failed to insert procedure to procedure store"}, "afterCommit": {"oid": "6bf63547f8127bb02cd3ff5d76c8b47e5dfb2728", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/6bf63547f8127bb02cd3ff5d76c8b47e5dfb2728", "committedDate": "2020-03-03T09:29:15Z", "message": "HBASE-23895 STUCK Region-In-Transition when failed to insert procedure to procedure store"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6bf63547f8127bb02cd3ff5d76c8b47e5dfb2728", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/6bf63547f8127bb02cd3ff5d76c8b47e5dfb2728", "committedDate": "2020-03-03T09:29:15Z", "message": "HBASE-23895 STUCK Region-In-Transition when failed to insert procedure to procedure store"}, "afterCommit": {"oid": "88d24dff09b64e3bf3fe01822cda14ea204ffd0a", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/88d24dff09b64e3bf3fe01822cda14ea204ffd0a", "committedDate": "2020-03-03T09:31:09Z", "message": "HBASE-23895 STUCK Region-In-Transition when failed to insert procedure to procedure store"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "88d24dff09b64e3bf3fe01822cda14ea204ffd0a", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/88d24dff09b64e3bf3fe01822cda14ea204ffd0a", "committedDate": "2020-03-03T09:31:09Z", "message": "HBASE-23895 STUCK Region-In-Transition when failed to insert procedure to procedure store"}, "afterCommit": {"oid": "a8fbd1d13e38040b1cac32e16dd7989d97743ea7", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/a8fbd1d13e38040b1cac32e16dd7989d97743ea7", "committedDate": "2020-03-03T10:40:55Z", "message": "HBASE-23895 STUCK Region-In-Transition when failed to insert procedure to procedure store"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a8fbd1d13e38040b1cac32e16dd7989d97743ea7", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/a8fbd1d13e38040b1cac32e16dd7989d97743ea7", "committedDate": "2020-03-03T10:40:55Z", "message": "HBASE-23895 STUCK Region-In-Transition when failed to insert procedure to procedure store"}, "afterCommit": {"oid": "592dfe77969ea5632454c0fae2d0d040a623bf13", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/592dfe77969ea5632454c0fae2d0d040a623bf13", "committedDate": "2020-03-05T04:16:13Z", "message": "HBASE-23895 STUCK Region-In-Transition when failed to insert procedure to procedure store"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "592dfe77969ea5632454c0fae2d0d040a623bf13", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/592dfe77969ea5632454c0fae2d0d040a623bf13", "committedDate": "2020-03-05T04:16:13Z", "message": "HBASE-23895 STUCK Region-In-Transition when failed to insert procedure to procedure store"}, "afterCommit": {"oid": "e51bf582d3099877aad6be483065096699147719", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/e51bf582d3099877aad6be483065096699147719", "committedDate": "2020-03-05T04:19:51Z", "message": "HBASE-23895 STUCK Region-In-Transition when failed to insert procedure to procedure store"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e51bf582d3099877aad6be483065096699147719", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/e51bf582d3099877aad6be483065096699147719", "committedDate": "2020-03-05T04:19:51Z", "message": "HBASE-23895 STUCK Region-In-Transition when failed to insert procedure to procedure store"}, "afterCommit": {"oid": "8d79960bec990d549e85a5a259f8c970ad1763d9", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/8d79960bec990d549e85a5a259f8c970ad1763d9", "committedDate": "2020-03-05T06:41:46Z", "message": "HBASE-23895 STUCK Region-In-Transition when failed to insert procedure to procedure store"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMTcwNTkz", "url": "https://github.com/apache/hbase/pull/1221#pullrequestreview-370170593", "createdAt": "2020-03-06T09:04:41Z", "commit": {"oid": "8d79960bec990d549e85a5a259f8c970ad1763d9"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwOTowNDo0MVrOFyxhVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwOTowNDo0MVrOFyxhVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc4NDQ3MQ==", "bodyText": "Pity we have to write the comment three times...\nCan be a follow on, to abstract a method for this logic...", "url": "https://github.com/apache/hbase/pull/1221#discussion_r388784471", "createdAt": "2020-03-06T09:04:41Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/procedure2/store/region/RegionProcedureStore.java", "diffHunk": "@@ -547,6 +551,10 @@ public void insert(Procedure<?> proc, Procedure<?>[] subProcs) {\n     }\n     List<Mutation> mutations = new ArrayList<>(subProcs.length + 1);\n     List<byte[]> rowsToLock = new ArrayList<>(subProcs.length + 1);\n+    // Insert procedure may be called by master's rpc call. There are some check about the rpc call\n+    // when mutate region. Here unset the current rpc call and set it back in finally block.\n+    // See HBASE-23895 for more details.\n+    Optional<RpcCall> rpcCall = RpcServer.unsetCurrentCall();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d79960bec990d549e85a5a259f8c970ad1763d9"}, "originalPosition": 25}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8d79960bec990d549e85a5a259f8c970ad1763d9", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/8d79960bec990d549e85a5a259f8c970ad1763d9", "committedDate": "2020-03-05T06:41:46Z", "message": "HBASE-23895 STUCK Region-In-Transition when failed to insert procedure to procedure store"}, "afterCommit": {"oid": "984942eaaee962af70a821d2de01733fcaf16e17", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/984942eaaee962af70a821d2de01733fcaf16e17", "committedDate": "2020-03-06T10:39:40Z", "message": "HBASE-23895 STUCK Region-In-Transition when failed to insert procedure to procedure store"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNzE4MzM3", "url": "https://github.com/apache/hbase/pull/1221#pullrequestreview-370718337", "createdAt": "2020-03-07T03:19:01Z", "commit": {"oid": "984942eaaee962af70a821d2de01733fcaf16e17"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d02956d553e38534c60c459a6cfe08a2929cc80f", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/d02956d553e38534c60c459a6cfe08a2929cc80f", "committedDate": "2020-03-07T04:10:33Z", "message": "HBASE-23895 STUCK Region-In-Transition when failed to insert procedure to procedure store"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "984942eaaee962af70a821d2de01733fcaf16e17", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/984942eaaee962af70a821d2de01733fcaf16e17", "committedDate": "2020-03-06T10:39:40Z", "message": "HBASE-23895 STUCK Region-In-Transition when failed to insert procedure to procedure store"}, "afterCommit": {"oid": "d02956d553e38534c60c459a6cfe08a2929cc80f", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/d02956d553e38534c60c459a6cfe08a2929cc80f", "committedDate": "2020-03-07T04:10:33Z", "message": "HBASE-23895 STUCK Region-In-Transition when failed to insert procedure to procedure store"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2885, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}