{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1NTEzNTgz", "number": 1913, "title": "HBASE-24577 Doc WALSplitter classes", "bodyText": "", "createdAt": "2020-06-16T23:12:03Z", "url": "https://github.com/apache/hbase/pull/1913", "merged": true, "mergeCommit": {"oid": "812d1e2bb51d3e4b6ab69c88a0e0bc7e8a83373b"}, "closed": true, "closedAt": "2020-06-17T21:59:30Z", "author": {"login": "saintstack"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcr-a7QgFqTQzMTk3MjU5Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsXCwxgFqTQzMjkzODMxNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxOTcyNTkz", "url": "https://github.com/apache/hbase/pull/1913#pullrequestreview-431972593", "createdAt": "2020-06-17T00:08:20Z", "commit": {"oid": "9b22ca97fcc775401b0a330b7a014df26107c13b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwMDowODoyMFrOGkxOtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwMDowODoyMFrOGkxOtw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwODUwMw==", "bodyText": "Log => WAL?", "url": "https://github.com/apache/hbase/pull/1913#discussion_r441208503", "createdAt": "2020-06-17T00:08:20Z", "author": {"login": "infraio"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WALSplitter.java", "diffHunk": "@@ -233,7 +247,7 @@ public static boolean splitLogFile(Path walDir, FileStatus logfile, FileSystem w\n   }\n \n   /**\n-   * log splitting implementation, splits one log file.\n+   * Log splitting implementation, splits one log file.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b22ca97fcc775401b0a330b7a014df26107c13b"}, "originalPosition": 110}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxOTcyODE0", "url": "https://github.com/apache/hbase/pull/1913#pullrequestreview-431972814", "createdAt": "2020-06-17T00:09:03Z", "commit": {"oid": "9b22ca97fcc775401b0a330b7a014df26107c13b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMDk2ODkx", "url": "https://github.com/apache/hbase/pull/1913#pullrequestreview-432096891", "createdAt": "2020-06-17T06:35:19Z", "commit": {"oid": "9b22ca97fcc775401b0a330b7a014df26107c13b"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwNjozNToxOVrOGk3h0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwNjozNzozMVrOGk3lQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTMxMTY5Ng==", "bodyText": "Per one WAL file split, every region will have one recovered edits file. If another WAL file also get split, we will have one more right?", "url": "https://github.com/apache/hbase/pull/1913#discussion_r441311696", "createdAt": "2020-06-17T06:35:19Z", "author": {"login": "anoopsjohn"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/wal/RecoveredEditsOutputSink.java", "diffHunk": "@@ -26,20 +26,20 @@\n import java.util.concurrent.ConcurrentMap;\n import java.util.concurrent.ExecutionException;\n import java.util.concurrent.Future;\n-\n import org.apache.hadoop.fs.Path;\n import org.apache.hadoop.hbase.TableName;\n import org.apache.hadoop.hbase.util.Bytes;\n import org.apache.hadoop.io.MultipleIOException;\n import org.apache.yetus.audience.InterfaceAudience;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n-\n import org.apache.hbase.thirdparty.com.google.common.collect.Lists;\n \n /**\n  * Class that manages the output streams from the log splitting process.\n- * Every region only has one recovered edits.\n+ * Every region only has one recovered edits file.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b22ca97fcc775401b0a330b7a014df26107c13b"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTMxMjU3Nw==", "bodyText": "This defaults to false right?", "url": "https://github.com/apache/hbase/pull/1913#discussion_r441312577", "createdAt": "2020-06-17T06:37:31Z", "author": {"login": "anoopsjohn"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WALSplitter.java", "diffHunk": "@@ -115,7 +119,18 @@\n \n   private final String tmpDirName;\n \n+  /**\n+   * Split WAL directly to hfiles instead of into intermediary 'recovered.edits' files.\n+   */\n+  public static final String WAL_SPLIT_TO_HFILE = \"hbase.wal.split.to.hfile\";\n+  public static final boolean DEFAULT_WAL_SPLIT_TO_HFILE = false;\n+\n+  /**\n+   * True if we are to run with bounded amount of writers rather than let the count blossom.\n+   * Bounded writing tends to have higher throughput.\n+   */\n   public final static String SPLIT_WRITER_CREATION_BOUNDED = \"hbase.split.writer.creation.bounded\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b22ca97fcc775401b0a330b7a014df26107c13b"}, "originalPosition": 69}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMjY5NDY0", "url": "https://github.com/apache/hbase/pull/1913#pullrequestreview-432269464", "createdAt": "2020-06-17T10:30:56Z", "commit": {"oid": "9b22ca97fcc775401b0a330b7a014df26107c13b"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxMDozMDo1N1rOGk_zJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxMDozMTowNlrOGk_zfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQ0NzIwNQ==", "bodyText": "Good to guard with LOG.isTraceEnabled()?", "url": "https://github.com/apache/hbase/pull/1913#discussion_r441447205", "createdAt": "2020-06-17T10:30:57Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/wal/BoundedRecoveredHFilesOutputSink.java", "diffHunk": "@@ -99,12 +102,13 @@ public void append(RegionEntryBuffer buffer) throws IOException {\n       }\n     }\n \n-    // The key point is create a new writer for each column family, write edits then close writer.\n+    // Create a new hfile writer for each column family, write edits then close writer.\n     String regionName = Bytes.toString(buffer.encodedRegionName);\n     for (Map.Entry<String, CellSet> cellsEntry : familyCells.entrySet()) {\n       String familyName = cellsEntry.getKey();\n       StoreFileWriter writer = createRecoveredHFileWriter(buffer.tableName, regionName,\n         familySeqIds.get(familyName), familyName, isMetaTable);\n+      LOG.trace(\"Created {}\", writer.getPath());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b22ca97fcc775401b0a330b7a014df26107c13b"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQ0NzI5Mg==", "bodyText": "same here", "url": "https://github.com/apache/hbase/pull/1913#discussion_r441447292", "createdAt": "2020-06-17T10:31:06Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/wal/BoundedRecoveredHFilesOutputSink.java", "diffHunk": "@@ -118,6 +122,7 @@ public void append(RegionEntryBuffer buffer) throws IOException {\n         openingWritersNum.decrementAndGet();\n       } finally {\n         writer.close();\n+        LOG.trace(\"Closed {}, edits={}\", writer.getPath(), familyCells.size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b22ca97fcc775401b0a330b7a014df26107c13b"}, "originalPosition": 70}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9b22ca97fcc775401b0a330b7a014df26107c13b", "author": {"user": {"login": "saintstack", "name": "Michael Stack"}}, "url": "https://github.com/apache/hbase/commit/9b22ca97fcc775401b0a330b7a014df26107c13b", "committedDate": "2020-06-16T23:10:08Z", "message": "HBASE-24577 Doc WALSplitter classes"}, "afterCommit": {"oid": "dc3f2c477d0573abeebe3fc0fe6c7f8207625121", "author": {"user": {"login": "saintstack", "name": "Michael Stack"}}, "url": "https://github.com/apache/hbase/commit/dc3f2c477d0573abeebe3fc0fe6c7f8207625121", "committedDate": "2020-06-17T17:59:30Z", "message": "HBASE-24577 Doc WALSplitter classes\n\nSigned-off-by: Anoop Sam John <anoopsamjohn@apache.org>\nSigned-off-by: Viraj Jasani <vjasani@apache.org>\nSigned-off-by: Guanghao Zhang <zghao@apache.org>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNjc0MTI2", "url": "https://github.com/apache/hbase/pull/1913#pullrequestreview-432674126", "createdAt": "2020-06-17T18:40:35Z", "commit": {"oid": "dc3f2c477d0573abeebe3fc0fe6c7f8207625121"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36d85465ab24abea1fd98ffdf9adb95712364fd6", "author": {"user": {"login": "saintstack", "name": "Michael Stack"}}, "url": "https://github.com/apache/hbase/commit/36d85465ab24abea1fd98ffdf9adb95712364fd6", "committedDate": "2020-06-17T18:49:15Z", "message": "HBASE-24577 Doc WALSplitter classes\n\nSigned-off-by: Anoop Sam John <anoopsamjohn@apache.org>\nSigned-off-by: Viraj Jasani <vjasani@apache.org>\nSigned-off-by: Guanghao Zhang <zghao@apache.org>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dc3f2c477d0573abeebe3fc0fe6c7f8207625121", "author": {"user": {"login": "saintstack", "name": "Michael Stack"}}, "url": "https://github.com/apache/hbase/commit/dc3f2c477d0573abeebe3fc0fe6c7f8207625121", "committedDate": "2020-06-17T17:59:30Z", "message": "HBASE-24577 Doc WALSplitter classes\n\nSigned-off-by: Anoop Sam John <anoopsamjohn@apache.org>\nSigned-off-by: Viraj Jasani <vjasani@apache.org>\nSigned-off-by: Guanghao Zhang <zghao@apache.org>"}, "afterCommit": {"oid": "36d85465ab24abea1fd98ffdf9adb95712364fd6", "author": {"user": {"login": "saintstack", "name": "Michael Stack"}}, "url": "https://github.com/apache/hbase/commit/36d85465ab24abea1fd98ffdf9adb95712364fd6", "committedDate": "2020-06-17T18:49:15Z", "message": "HBASE-24577 Doc WALSplitter classes\n\nSigned-off-by: Anoop Sam John <anoopsamjohn@apache.org>\nSigned-off-by: Viraj Jasani <vjasani@apache.org>\nSigned-off-by: Guanghao Zhang <zghao@apache.org>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyOTM4MzE0", "url": "https://github.com/apache/hbase/pull/1913#pullrequestreview-432938314", "createdAt": "2020-06-18T04:49:34Z", "commit": {"oid": "36d85465ab24abea1fd98ffdf9adb95712364fd6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNDo0OTozNFrOGlffEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNDo0OTozNFrOGlffEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk2NjM1NQ==", "bodyText": "Just asking. this can be in DEBUG mode right rather than trace?", "url": "https://github.com/apache/hbase/pull/1913#discussion_r441966355", "createdAt": "2020-06-18T04:49:34Z", "author": {"login": "ramkrish86"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/wal/RecoveredEditsOutputSink.java", "diffHunk": "@@ -81,6 +83,7 @@ private RecoveredEditsWriter getRecoveredEditsWriter(TableName tableName, byte[]\n     if (ret == null) {\n       return null;\n     }\n+    LOG.trace(\"Created {}\", ret.path);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36d85465ab24abea1fd98ffdf9adb95712364fd6"}, "originalPosition": 36}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4325, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}