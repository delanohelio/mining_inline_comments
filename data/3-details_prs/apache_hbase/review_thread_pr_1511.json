{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzMjUxNTIw", "number": 1511, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNjo0NToyOFrODxu32A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxOToyMToyN1rODypGBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNDc0Nzc2OnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNjo0NToyOFrOGFXpWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxMDo1MDozMlrOGF0PZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODI4MzQ4MA==", "bodyText": "How about putting this method in BaseLoadBalancer as protected final ?", "url": "https://github.com/apache/hbase/pull/1511#discussion_r408283480", "createdAt": "2020-04-14T16:45:28Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java", "diffHunk": "@@ -310,6 +310,19 @@ protected synchronized boolean areSomeRegionReplicasColocated(Cluster c) {\n     return false;\n   }\n \n+  private synchronized boolean areThereIdleRegions(Cluster c){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9792db7c8aee0c7246f970971d9b58aadc822462"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODI4NDAyMA==", "bodyText": "Also, idleRegionsExist() might be better name", "url": "https://github.com/apache/hbase/pull/1511#discussion_r408284020", "createdAt": "2020-04-14T16:46:20Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java", "diffHunk": "@@ -310,6 +310,19 @@ protected synchronized boolean areSomeRegionReplicasColocated(Cluster c) {\n     return false;\n   }\n \n+  private synchronized boolean areThereIdleRegions(Cluster c){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODI4MzQ4MA=="}, "originalCommit": {"oid": "9792db7c8aee0c7246f970971d9b58aadc822462"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYxNTIyMQ==", "bodyText": "Here it checks the status of RS.  The name areThereIdleRegions not making good meaning", "url": "https://github.com/apache/hbase/pull/1511#discussion_r408615221", "createdAt": "2020-04-15T06:45:50Z", "author": {"login": "anoopsjohn"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java", "diffHunk": "@@ -310,6 +310,19 @@ protected synchronized boolean areSomeRegionReplicasColocated(Cluster c) {\n     return false;\n   }\n \n+  private synchronized boolean areThereIdleRegions(Cluster c){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODI4MzQ4MA=="}, "originalCommit": {"oid": "9792db7c8aee0c7246f970971d9b58aadc822462"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODY0MTAxNw==", "bodyText": "Yeah, it could be something similar to idleRSPresent() maybe", "url": "https://github.com/apache/hbase/pull/1511#discussion_r408641017", "createdAt": "2020-04-15T07:38:42Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java", "diffHunk": "@@ -310,6 +310,19 @@ protected synchronized boolean areSomeRegionReplicasColocated(Cluster c) {\n     return false;\n   }\n \n+  private synchronized boolean areThereIdleRegions(Cluster c){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODI4MzQ4MA=="}, "originalCommit": {"oid": "9792db7c8aee0c7246f970971d9b58aadc822462"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODc1MTk3NQ==", "bodyText": "thanks!", "url": "https://github.com/apache/hbase/pull/1511#discussion_r408751975", "createdAt": "2020-04-15T10:50:32Z", "author": {"login": "bea0113"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java", "diffHunk": "@@ -310,6 +310,19 @@ protected synchronized boolean areSomeRegionReplicasColocated(Cluster c) {\n     return false;\n   }\n \n+  private synchronized boolean areThereIdleRegions(Cluster c){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODI4MzQ4MA=="}, "originalCommit": {"oid": "9792db7c8aee0c7246f970971d9b58aadc822462"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNjg4Nzc3OnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNjo0OTo1N1rOGFsANQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxMDo0OToyOVrOGF0NSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYxNzAxMw==", "bodyText": "This is iterating over many data structures and complex. Why cant we just iterate over the regionsPerServer data structure alone and populate the booleans as needed?", "url": "https://github.com/apache/hbase/pull/1511#discussion_r408617013", "createdAt": "2020-04-15T06:49:57Z", "author": {"login": "anoopsjohn"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java", "diffHunk": "@@ -310,6 +310,19 @@ protected synchronized boolean areSomeRegionReplicasColocated(Cluster c) {\n     return false;\n   }\n \n+  private synchronized boolean areThereIdleRegions(Cluster c){\n+    boolean isServerExistsWithMoreRegions=false;\n+    boolean isServerExistsWithZeroRegions=false;\n+    for (ServerName server:c.servers){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9792db7c8aee0c7246f970971d9b58aadc822462"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODc1MTQzMw==", "bodyText": "thanks, that was an idea as well, but I wasn't sure about it, I'll fix it", "url": "https://github.com/apache/hbase/pull/1511#discussion_r408751433", "createdAt": "2020-04-15T10:49:29Z", "author": {"login": "bea0113"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java", "diffHunk": "@@ -310,6 +310,19 @@ protected synchronized boolean areSomeRegionReplicasColocated(Cluster c) {\n     return false;\n   }\n \n+  private synchronized boolean areThereIdleRegions(Cluster c){\n+    boolean isServerExistsWithMoreRegions=false;\n+    boolean isServerExistsWithZeroRegions=false;\n+    for (ServerName server:c.servers){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYxNzAxMw=="}, "originalCommit": {"oid": "9792db7c8aee0c7246f970971d9b58aadc822462"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzOTcyNzg1OnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxOToxMDoxOFrOGGHy0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxOToxMDoxOFrOGGHy0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA3MjMzOA==", "bodyText": "please use {} around the body of if blocks.", "url": "https://github.com/apache/hbase/pull/1511#discussion_r409072338", "createdAt": "2020-04-15T19:10:18Z", "author": {"login": "busbey"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java", "diffHunk": "@@ -310,6 +310,18 @@ protected synchronized boolean areSomeRegionReplicasColocated(Cluster c) {\n     return false;\n   }\n \n+  protected final synchronized boolean idleRegionExist(Cluster c){\n+    boolean isServerExistsWithMoreRegions = false;\n+    boolean isServerExistsWithZeroRegions = false;\n+    for (int[] serverList: c.regionsPerServer){\n+      if (serverList.length > 1)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0676cb7452ec22a2eba8e94581daf263d955d99b"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0MzI4MDc2OnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/BaseLoadBalancer.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNTowNDowNFrOGGp1vQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNTowNDowNFrOGGp1vQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTYzMDE0MQ==", "bodyText": "please use { } for the statement.", "url": "https://github.com/apache/hbase/pull/1511#discussion_r409630141", "createdAt": "2020-04-16T15:04:04Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/BaseLoadBalancer.java", "diffHunk": "@@ -1192,6 +1192,8 @@ protected boolean needsBalance(TableName tableName, Cluster c) {\n       return false;\n     }\n     if(areSomeRegionReplicasColocated(c)) return true;\n+    if(idleRegionExist(c)) return true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ab34695307087966bd4e6c14b1c2adf69c86f0a"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0MzI4NTM0OnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/BaseLoadBalancer.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNTowNTowMVrOGGp4lQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNzoxNDoyMFrOGGvQSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTYzMDg2OQ==", "bodyText": "nit: this can be serverList.length == 0", "url": "https://github.com/apache/hbase/pull/1511#discussion_r409630869", "createdAt": "2020-04-16T15:05:01Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/BaseLoadBalancer.java", "diffHunk": "@@ -1223,6 +1225,20 @@ protected boolean areSomeRegionReplicasColocated(Cluster c) {\n     return false;\n   }\n \n+  protected final synchronized boolean idleRegionExist(Cluster c){\n+    boolean isServerExistsWithMoreRegions = false;\n+    boolean isServerExistsWithZeroRegions = false;\n+    for (int[] serverList: c.regionsPerServer){\n+      if (serverList.length > 1) {\n+        isServerExistsWithMoreRegions = true;\n+      }\n+      if (serverList.length < 1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ab34695307087966bd4e6c14b1c2adf69c86f0a"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTcxODg1OA==", "bodyText": "Thank you!", "url": "https://github.com/apache/hbase/pull/1511#discussion_r409718858", "createdAt": "2020-04-16T17:14:20Z", "author": {"login": "bea0113"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/BaseLoadBalancer.java", "diffHunk": "@@ -1223,6 +1225,20 @@ protected boolean areSomeRegionReplicasColocated(Cluster c) {\n     return false;\n   }\n \n+  protected final synchronized boolean idleRegionExist(Cluster c){\n+    boolean isServerExistsWithMoreRegions = false;\n+    boolean isServerExistsWithZeroRegions = false;\n+    for (int[] serverList: c.regionsPerServer){\n+      if (serverList.length > 1) {\n+        isServerExistsWithMoreRegions = true;\n+      }\n+      if (serverList.length < 1) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTYzMDg2OQ=="}, "originalCommit": {"oid": "2ab34695307087966bd4e6c14b1c2adf69c86f0a"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0MzI4OTAxOnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNTowNTo1MFrOGGp60g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNTowNTo1MFrOGGp60g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTYzMTQ0Mg==", "bodyText": "please remove these extra lines", "url": "https://github.com/apache/hbase/pull/1511#discussion_r409631442", "createdAt": "2020-04-16T15:05:50Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java", "diffHunk": "@@ -310,6 +310,8 @@ protected synchronized boolean areSomeRegionReplicasColocated(Cluster c) {\n     return false;\n   }\n \n+\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ab34695307087966bd4e6c14b1c2adf69c86f0a"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0NDA0NzAxOnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/BaseLoadBalancer.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxODoxMzoxN1rOGGxdRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxODoxMzoxN1rOGGxdRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc1NDk0OQ==", "bodyText": "idleRegionExist => idleRegionServerExist would be a better fit since we are checking if any RS is idle (without regions).", "url": "https://github.com/apache/hbase/pull/1511#discussion_r409754949", "createdAt": "2020-04-16T18:13:17Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/BaseLoadBalancer.java", "diffHunk": "@@ -1223,6 +1227,20 @@ protected boolean areSomeRegionReplicasColocated(Cluster c) {\n     return false;\n   }\n \n+  protected final synchronized boolean idleRegionExist(Cluster c){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c17130127ea23e22382198908b0760b3b372101"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0NDI4Njc2OnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/BaseLoadBalancer.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxOToyMToyN1rOGGz0bA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzo0OTo1MVrOGJQ0VA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc5MzY0NA==", "bodyText": "why is this synchronized?", "url": "https://github.com/apache/hbase/pull/1511#discussion_r409793644", "createdAt": "2020-04-16T19:21:27Z", "author": {"login": "busbey"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/BaseLoadBalancer.java", "diffHunk": "@@ -1223,6 +1227,20 @@ protected boolean areSomeRegionReplicasColocated(Cluster c) {\n     return false;\n   }\n \n+  protected final synchronized boolean idleRegionExist(Cluster c){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c17130127ea23e22382198908b0760b3b372101"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTU2MTk3NA==", "bodyText": "Hmm, as part of HBASE-12559, many methods that are overridden in StochasticLoadBalancer are made synchronized due to findbugs warnings. I was surprised to see all these methods non-synchronized in parent and synchronized in child class.", "url": "https://github.com/apache/hbase/pull/1511#discussion_r411561974", "createdAt": "2020-04-20T17:32:33Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/BaseLoadBalancer.java", "diffHunk": "@@ -1223,6 +1227,20 @@ protected boolean areSomeRegionReplicasColocated(Cluster c) {\n     return false;\n   }\n \n+  protected final synchronized boolean idleRegionExist(Cluster c){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc5MzY0NA=="}, "originalCommit": {"oid": "7c17130127ea23e22382198908b0760b3b372101"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE3ODU2Ng==", "bodyText": "Yes, I've got a bit confused about this, and as I've originally put this in StochasticLoadBalancer, I thought it it would work there as well.\nShould I remove the synchronised?", "url": "https://github.com/apache/hbase/pull/1511#discussion_r412178566", "createdAt": "2020-04-21T13:21:16Z", "author": {"login": "bea0113"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/BaseLoadBalancer.java", "diffHunk": "@@ -1223,6 +1227,20 @@ protected boolean areSomeRegionReplicasColocated(Cluster c) {\n     return false;\n   }\n \n+  protected final synchronized boolean idleRegionExist(Cluster c){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc5MzY0NA=="}, "originalCommit": {"oid": "7c17130127ea23e22382198908b0760b3b372101"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM2NTkwOA==", "bodyText": "You have already removed synchronized and it's fine to do so, anyways method is now in BaseLoadBalancer.", "url": "https://github.com/apache/hbase/pull/1511#discussion_r412365908", "createdAt": "2020-04-21T17:49:51Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/BaseLoadBalancer.java", "diffHunk": "@@ -1223,6 +1227,20 @@ protected boolean areSomeRegionReplicasColocated(Cluster c) {\n     return false;\n   }\n \n+  protected final synchronized boolean idleRegionExist(Cluster c){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc5MzY0NA=="}, "originalCommit": {"oid": "7c17130127ea23e22382198908b0760b3b372101"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1925, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}