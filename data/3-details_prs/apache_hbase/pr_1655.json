{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzNjIzMTk2", "number": 1655, "title": "HBASE-24321 - Add writable MinVersions and read-only Scan to coproc S\u2026", "bodyText": "\u2026canOptions", "createdAt": "2020-05-05T16:29:39Z", "url": "https://github.com/apache/hbase/pull/1655", "merged": true, "mergeCommit": {"oid": "ca81283fe561499f119e5a0c5efa97947a6b2e26"}, "closed": true, "closedAt": "2020-05-11T07:24:23Z", "author": {"login": "gjacoby126"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceWqTuAH2gAyNDEzNjIzMTk2OmQ0ZTZiZjAyNTJhNWM4OWMyOGMxNDI2MTc5ZmVmZjYzNGExZGFlM2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgFiAuAFqTQwODgxNDEwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d4e6bf0252a5c89c28c1426179feff634a1dae3c", "author": {"user": {"login": "gjacoby126", "name": "Geoffrey Jacoby"}}, "url": "https://github.com/apache/hbase/commit/d4e6bf0252a5c89c28c1426179feff634a1dae3c", "committedDate": "2020-05-05T16:27:56Z", "message": "HBASE-24321 - Add writable MinVersions and read-only Scan to coproc ScanOptions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MDg5NDUw", "url": "https://github.com/apache/hbase/pull/1655#pullrequestreview-406089450", "createdAt": "2020-05-05T19:26:20Z", "commit": {"oid": "d4e6bf0252a5c89c28c1426179feff634a1dae3c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxOToyNjoyMVrOGQ4SJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxOTozMDo0OFrOGQ4bmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM1MjU0OA==", "bodyText": "The Scan constructor throws IOE now?? Not an issue for this patch, though", "url": "https://github.com/apache/hbase/pull/1655#discussion_r420352548", "createdAt": "2020-05-05T19:26:21Z", "author": {"login": "apurtell"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/CustomizedScanInfoBuilder.java", "diffHunk": "@@ -34,8 +36,18 @@\n \n   private KeepDeletedCells keepDeletedCells = null;\n \n+  private Integer minVersions;\n+\n+  private final Scan scan;\n+\n   public CustomizedScanInfoBuilder(ScanInfo scanInfo) {\n     this.scanInfo = scanInfo;\n+    this.scan = new Scan();\n+  }\n+  public CustomizedScanInfoBuilder(ScanInfo scanInfo, Scan scan) throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4e6bf0252a5c89c28c1426179feff634a1dae3c"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM1Mzg1MQ==", "bodyText": "Changes made on the returned scan object will be effective and visible beyond the caller. Clone and return?", "url": "https://github.com/apache/hbase/pull/1655#discussion_r420353851", "createdAt": "2020-05-05T19:28:48Z", "author": {"login": "apurtell"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/CustomizedScanInfoBuilder.java", "diffHunk": "@@ -80,4 +93,19 @@ public KeepDeletedCells getKeepDeletedCells() {\n     return keepDeletedCells != null ? keepDeletedCells : scanInfo.getKeepDeletedCells();\n   }\n \n+  @Override\n+  public int getMinVersions() {\n+    return minVersions != null ? minVersions : scanInfo.getMinVersions();\n+  }\n+\n+  @Override\n+  public void setMinVersions(int minVersions) {\n+    this.minVersions = minVersions;\n+  }\n+\n+  @Override\n+  public Scan getScan() {\n+    return scan;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4e6bf0252a5c89c28c1426179feff634a1dae3c"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM1NDk2OQ==", "bodyText": "Nice additional tests.", "url": "https://github.com/apache/hbase/pull/1655#discussion_r420354969", "createdAt": "2020-05-05T19:30:48Z", "author": {"login": "apurtell"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/coprocessor/TestRegionCoprocessorHost.java", "diffHunk": "@@ -74,4 +105,73 @@ public void testLoadDuplicateCoprocessor() throws Exception {\n     // Two duplicate coprocessors loaded\n     assertEquals(2, host.coprocEnvironments.size());\n   }\n-}\n\\ No newline at end of file\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4e6bf0252a5c89c28c1426179feff634a1dae3c"}, "originalPosition": 96}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59cde3dc6eabd0d1b898f18d0c461b6602bd7082", "author": {"user": {"login": "gjacoby126", "name": "Geoffrey Jacoby"}}, "url": "https://github.com/apache/hbase/commit/59cde3dc6eabd0d1b898f18d0c461b6602bd7082", "committedDate": "2020-05-05T21:08:41Z", "message": "HBASE-24321 - Add writable MinVersions and read-only Scan to coproc ScanOptions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MjQ2ODAx", "url": "https://github.com/apache/hbase/pull/1655#pullrequestreview-406246801", "createdAt": "2020-05-06T00:44:53Z", "commit": {"oid": "59cde3dc6eabd0d1b898f18d0c461b6602bd7082"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwMDo0NDo1M1rOGRAncQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwMDo1NTowM1rOGRAxIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQ4OTA3Mw==", "bodyText": "I think this class is only used to test whether a specific CP method has been called? What is this used for?", "url": "https://github.com/apache/hbase/pull/1655#discussion_r420489073", "createdAt": "2020-05-06T00:44:53Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/coprocessor/SimpleRegionObserver.java", "diffHunk": "@@ -685,6 +687,40 @@ public StoreFileReader postStoreFileReaderOpen(ObserverContext<RegionCoprocessor\n     return reader;\n   }\n \n+  @Override\n+  public void preStoreScannerOpen(ObserverContext<RegionCoprocessorEnvironment> ctx,\n+    Store store, ScanOptions options) throws IOException {\n+    if (options.getScan().getTimeRange().isAllTime()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59cde3dc6eabd0d1b898f18d0c461b6602bd7082"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQ4OTg3Mw==", "bodyText": "Let's just catch the IOException in the code here and then throw an AssertionError to indicate this should not happen, and we can filed another issue to remove the IOException from throws.", "url": "https://github.com/apache/hbase/pull/1655#discussion_r420489873", "createdAt": "2020-05-06T00:48:28Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/CustomizedScanInfoBuilder.java", "diffHunk": "@@ -34,8 +36,18 @@\n \n   private KeepDeletedCells keepDeletedCells = null;\n \n+  private Integer minVersions;\n+\n+  private final Scan scan;\n+\n   public CustomizedScanInfoBuilder(ScanInfo scanInfo) {\n     this.scanInfo = scanInfo;\n+    this.scan = new Scan();\n+  }\n+  public CustomizedScanInfoBuilder(ScanInfo scanInfo, Scan scan) throws IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM1MjU0OA=="}, "originalCommit": {"oid": "d4e6bf0252a5c89c28c1426179feff634a1dae3c"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQ5MTAwMA==", "bodyText": "Is this method still referenced? Just remove it?", "url": "https://github.com/apache/hbase/pull/1655#discussion_r420491000", "createdAt": "2020-05-06T00:52:54Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/ScanInfo.java", "diffHunk": "@@ -174,8 +174,13 @@ public boolean isNewVersionBehavior() {\n    * Used for CP users for customizing max versions, ttl and keepDeletedCells.\n    */\n   ScanInfo customize(int maxVersions, long ttl, KeepDeletedCells keepDeletedCells) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59cde3dc6eabd0d1b898f18d0c461b6602bd7082"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQ5MTU1Mg==", "bodyText": "Please add a comment to say that the returned Scan object is only for reading, changing it will have no effect to the actual scan operation.\nAnd please modify the javadoc of this class to indicate that now we can also change min versions?", "url": "https://github.com/apache/hbase/pull/1655#discussion_r420491552", "createdAt": "2020-05-06T00:55:03Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/ScanOptions.java", "diffHunk": "@@ -64,4 +66,10 @@ default void readAllVersions() {\n   void setKeepDeletedCells(KeepDeletedCells keepDeletedCells);\n \n   KeepDeletedCells getKeepDeletedCells();\n+\n+  int getMinVersions();\n+\n+  void setMinVersions(int minVersions);\n+\n+  Scan getScan() throws IOException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59cde3dc6eabd0d1b898f18d0c461b6602bd7082"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38089de230448601763d0d4f59e254d9758df4f2", "author": {"user": {"login": "gjacoby126", "name": "Geoffrey Jacoby"}}, "url": "https://github.com/apache/hbase/commit/38089de230448601763d0d4f59e254d9758df4f2", "committedDate": "2020-05-06T03:22:29Z", "message": "HBASE-24321 - Add writable MinVersions and read-only Scan to coproc ScanOptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95f88022ba84fa679cd9a8e0cc5e85ad4eb3fa66", "author": {"user": {"login": "gjacoby126", "name": "Geoffrey Jacoby"}}, "url": "https://github.com/apache/hbase/commit/95f88022ba84fa679cd9a8e0cc5e85ad4eb3fa66", "committedDate": "2020-05-06T03:32:07Z", "message": "HBASE-24321 - Add writable MinVersions and read-only Scan to coproc ScanOptions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2Mjg2OTgx", "url": "https://github.com/apache/hbase/pull/1655#pullrequestreview-406286981", "createdAt": "2020-05-06T03:42:40Z", "commit": {"oid": "95f88022ba84fa679cd9a8e0cc5e85ad4eb3fa66"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwMzo0Mjo0MFrOGRDEVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwMzo0Mjo0MFrOGRDEVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDUyOTIzNw==", "bodyText": "The comment is a bit confusing as you are free to call the modification methods of the returned Scan object? So it is not 'read only'.\nMaybe better with \"The returned Scan object is just a copy, modifying it will have no effect, so treat it as read-only.\"\nOf course I'm not a native English speaker, so feel free to use your own word. Just show the meaning that 'you can modify, but no effect, so please do not modify'.", "url": "https://github.com/apache/hbase/pull/1655#discussion_r420529237", "createdAt": "2020-05-06T03:42:40Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/ScanOptions.java", "diffHunk": "@@ -64,4 +66,13 @@ default void readAllVersions() {\n   void setKeepDeletedCells(KeepDeletedCells keepDeletedCells);\n \n   KeepDeletedCells getKeepDeletedCells();\n+\n+  int getMinVersions();\n+\n+  void setMinVersions(int minVersions);\n+\n+  /**\n+   * Returns a read-only copy of the Scan object", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95f88022ba84fa679cd9a8e0cc5e85ad4eb3fa66"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27c2f4ef969ce625af19001afa30fe61bb2f4fe1", "author": {"user": {"login": "gjacoby126", "name": "Geoffrey Jacoby"}}, "url": "https://github.com/apache/hbase/commit/27c2f4ef969ce625af19001afa30fe61bb2f4fe1", "committedDate": "2020-05-06T06:01:31Z", "message": "HBASE-24321 - Add writable MinVersions and read-only Scan to coproc ScanOptions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2OTY0OTI5", "url": "https://github.com/apache/hbase/pull/1655#pullrequestreview-406964929", "createdAt": "2020-05-06T20:33:06Z", "commit": {"oid": "27c2f4ef969ce625af19001afa30fe61bb2f4fe1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2OTcyNTIy", "url": "https://github.com/apache/hbase/pull/1655#pullrequestreview-406972522", "createdAt": "2020-05-06T20:44:41Z", "commit": {"oid": "27c2f4ef969ce625af19001afa30fe61bb2f4fe1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMDo0NDo0MVrOGRktNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMDo0NDo0MVrOGRktNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTA4MDM3Mg==", "bodyText": "Might be good at some point to have an unmodifiable subclass or wrapper of Scan, so that any modification would cause an error. (not in this PR, though)", "url": "https://github.com/apache/hbase/pull/1655#discussion_r421080372", "createdAt": "2020-05-06T20:44:41Z", "author": {"login": "lhofhansl"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/CustomizedScanInfoBuilder.java", "diffHunk": "@@ -80,4 +97,23 @@ public KeepDeletedCells getKeepDeletedCells() {\n     return keepDeletedCells != null ? keepDeletedCells : scanInfo.getKeepDeletedCells();\n   }\n \n+  @Override\n+  public int getMinVersions() {\n+    return minVersions != null ? minVersions : scanInfo.getMinVersions();\n+  }\n+\n+  @Override\n+  public void setMinVersions(int minVersions) {\n+    this.minVersions = minVersions;\n+  }\n+\n+  @Override\n+  public Scan getScan() {\n+    try {\n+      return new Scan(scan);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27c2f4ef969ce625af19001afa30fe61bb2f4fe1"}, "originalPosition": 66}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2OTc1OTQ1", "url": "https://github.com/apache/hbase/pull/1655#pullrequestreview-406975945", "createdAt": "2020-05-06T20:49:55Z", "commit": {"oid": "27c2f4ef969ce625af19001afa30fe61bb2f4fe1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4NzEyOTE5", "url": "https://github.com/apache/hbase/pull/1655#pullrequestreview-408712919", "createdAt": "2020-05-10T06:54:25Z", "commit": {"oid": "27c2f4ef969ce625af19001afa30fe61bb2f4fe1"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQwNjo1NDoyNVrOGTBVpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQwNjo1NDoyNVrOGTBVpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU5ODA1NQ==", "bodyText": "+1 to Immutable Scan wrapper with unmodifiable getters", "url": "https://github.com/apache/hbase/pull/1655#discussion_r422598055", "createdAt": "2020-05-10T06:54:25Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/CustomizedScanInfoBuilder.java", "diffHunk": "@@ -80,4 +97,23 @@ public KeepDeletedCells getKeepDeletedCells() {\n     return keepDeletedCells != null ? keepDeletedCells : scanInfo.getKeepDeletedCells();\n   }\n \n+  @Override\n+  public int getMinVersions() {\n+    return minVersions != null ? minVersions : scanInfo.getMinVersions();\n+  }\n+\n+  @Override\n+  public void setMinVersions(int minVersions) {\n+    this.minVersions = minVersions;\n+  }\n+\n+  @Override\n+  public Scan getScan() {\n+    try {\n+      return new Scan(scan);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTA4MDM3Mg=="}, "originalCommit": {"oid": "27c2f4ef969ce625af19001afa30fe61bb2f4fe1"}, "originalPosition": 66}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4ODE0MTAw", "url": "https://github.com/apache/hbase/pull/1655#pullrequestreview-408814100", "createdAt": "2020-05-11T01:38:20Z", "commit": {"oid": "27c2f4ef969ce625af19001afa30fe61bb2f4fe1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2067, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}