{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEwMDYzNDE2", "number": 2588, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxODo1NToxOVrOEyCw_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxODo1NjozNVrOEyCy5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwOTA5NTY1OnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/MetaFixer.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxODo1NToxOVrOHod9pA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxODo1NToxOVrOHod9pA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE5NjAwNA==", "bodyText": "Good", "url": "https://github.com/apache/hbase/pull/2588#discussion_r512196004", "createdAt": "2020-10-26T18:55:19Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/MetaFixer.java", "diffHunk": "@@ -247,6 +247,10 @@ void fixOverlaps(CatalogJanitor.Report report) throws IOException {\n       if (regionInfoWithlargestEndKey != null) {\n         if (!isOverlap(regionInfoWithlargestEndKey, pair) ||\n             currentMergeSet.size() >= maxMergeCount) {\n+          // Log when we cut-off-merge because we hit the configured maximum merge limit.\n+          if (currentMergeSet.size() >= maxMergeCount) {\n+            LOG.warn(\"Ran into maximum-at-a-time merges limit={}\", maxMergeCount);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cecca2cf9701354c1f4e00198a31341f50a726ac"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwOTA5OTE2OnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/MergeTableRegionsProcedure.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxODo1NjoxMlrOHod_sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxOTozMDo1MFrOHofL0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE5NjUzMQ==", "bodyText": "nit: we need the ' characters? we don't usually do this?", "url": "https://github.com/apache/hbase/pull/2588#discussion_r512196531", "createdAt": "2020-10-26T18:56:12Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/MergeTableRegionsProcedure.java", "diffHunk": "@@ -135,8 +134,8 @@ private static void checkRegionsToMerge(MasterProcedureEnv env, final RegionInfo\n           throw new MergeRegionException(msg);\n         }\n         if (!force && !ri.isAdjacent(previous) && !ri.isOverlap(previous)) {\n-          String msg = \"Unable to merge non-adjacent or non-overlapping regions \" +\n-              previous.getShortNameToLog() + \", \" + ri.getShortNameToLog() + \" when force=false\";\n+          String msg = \"Unable to merge non-adjacent or non-overlapping regions '\" +\n+              previous.getShortNameToLog() + \"', '\" + ri.getShortNameToLog() + \"' when force=false\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cecca2cf9701354c1f4e00198a31341f50a726ac"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjIxNjAxOQ==", "bodyText": "This is a clean cherry-pick of your commit to master, the ' character was part of the original commit. \ud83d\ude42  It was not pushed to branch-2.2 at that time I found this as a nice improvement.", "url": "https://github.com/apache/hbase/pull/2588#discussion_r512216019", "createdAt": "2020-10-26T19:30:50Z", "author": {"login": "petersomogyi"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/MergeTableRegionsProcedure.java", "diffHunk": "@@ -135,8 +134,8 @@ private static void checkRegionsToMerge(MasterProcedureEnv env, final RegionInfo\n           throw new MergeRegionException(msg);\n         }\n         if (!force && !ri.isAdjacent(previous) && !ri.isOverlap(previous)) {\n-          String msg = \"Unable to merge non-adjacent or non-overlapping regions \" +\n-              previous.getShortNameToLog() + \", \" + ri.getShortNameToLog() + \" when force=false\";\n+          String msg = \"Unable to merge non-adjacent or non-overlapping regions '\" +\n+              previous.getShortNameToLog() + \"', '\" + ri.getShortNameToLog() + \"' when force=false\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE5NjUzMQ=="}, "originalCommit": {"oid": "cecca2cf9701354c1f4e00198a31341f50a726ac"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwOTEwMDU0OnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/MergeTableRegionsProcedure.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxODo1NjozNVrOHoeAlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxODo1NjozNVrOHoeAlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE5Njc1Ng==", "bodyText": "Good", "url": "https://github.com/apache/hbase/pull/2588#discussion_r512196756", "createdAt": "2020-10-26T18:56:35Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/MergeTableRegionsProcedure.java", "diffHunk": "@@ -479,16 +478,20 @@ private boolean prepareMergeRegion(final MasterProcedureEnv env) throws IOExcept\n     for (RegionInfo ri: this.regionsToMerge) {\n       if (!catalogJanitor.cleanMergeQualifier(ri)) {\n         String msg = \"Skip merging \" + RegionInfo.getShortNameToLog(regionsToMerge) +\n-            \", because parent \" + RegionInfo.getShortNameToLog(ri) + \" has a merge qualifier\";\n+            \", because a parent, \" + RegionInfo.getShortNameToLog(ri) + \", has a merge qualifier \" +\n+          \"(if a 'merge column' in parent, it was recently merged but still has outstanding \" +\n+          \"references to its parents that must be cleared before it can participate in merge -- \" +\n+          \"major compact it to hurry clearing of its references)\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cecca2cf9701354c1f4e00198a31341f50a726ac"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2471, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}