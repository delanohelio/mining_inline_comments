{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0ODYxNzE0", "number": 1801, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQwNTozMjozOVrOEBFjeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQwNjoxOTozMlrOEBKJcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NTc1MDMzOnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQwNTozMjozOVrOGcwySg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQwMzozMDozNFrOGc2fMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgxMjYxOA==", "bodyText": "IMO better we should move this LOG from here to HStore.\nprotected void createCacheConf(final ColumnFamilyDescriptor family) {\nthis.cacheConf = new CacheConfig(conf, family, region.getBlockCache(),\nregion.getRegionServicesForStores().getByteBuffAllocator());\n}\nAfter the cacheConf is created.  CacheConfig is having toString() with all details.  This way we can avoid passing the RegionInfo/regionName unnecessarily to CacheConfig just for log.\nIn Master branch, we are not seeing the CacheConfig log with every compaction because of a different constructor being used.", "url": "https://github.com/apache/hbase/pull/1801#discussion_r432812618", "createdAt": "2020-05-30T05:32:39Z", "author": {"login": "anoopsjohn"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java", "diffHunk": "@@ -205,6 +206,7 @@ public CacheConfig(Configuration conf, ColumnFamilyDescriptor family, BlockCache\n     this.blockCache = blockCache;\n     this.byteBuffAllocator = byteBuffAllocator;\n     LOG.info(\"Created cacheConfig: \" + this + (family == null ? \"\" : \" for family \" + family) +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95f84f4a4451c6a0d1db98167088ce3e49c993e1"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkwNjAzNA==", "bodyText": "Yes, you are right, thank you for your suggestions", "url": "https://github.com/apache/hbase/pull/1801#discussion_r432906034", "createdAt": "2020-05-31T03:30:34Z", "author": {"login": "songxincun"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java", "diffHunk": "@@ -205,6 +206,7 @@ public CacheConfig(Configuration conf, ColumnFamilyDescriptor family, BlockCache\n     this.blockCache = blockCache;\n     this.byteBuffAllocator = byteBuffAllocator;\n     LOG.info(\"Created cacheConfig: \" + this + (family == null ? \"\" : \" for family \" + family) +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgxMjYxOA=="}, "originalCommit": {"oid": "95f84f4a4451c6a0d1db98167088ce3e49c993e1"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NTc1MDY1OnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQwNTozMjo1OFrOGcwyag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQwNTozMjo1OFrOGcwyag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgxMjY1MA==", "bodyText": "Ya this is some thing we can avoid", "url": "https://github.com/apache/hbase/pull/1801#discussion_r432812650", "createdAt": "2020-05-30T05:32:58Z", "author": {"login": "anoopsjohn"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java", "diffHunk": "@@ -377,7 +377,7 @@ private MemStore getMemstore() {\n    * @param family The current column family.\n    */\n   protected void createCacheConf(final ColumnFamilyDescriptor family) {\n-    this.cacheConf = new CacheConfig(conf, family, region.getBlockCache(),\n+    this.cacheConf = new CacheConfig(conf, family, region.getRegionInfo(), region.getBlockCache(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95f84f4a4451c6a0d1db98167088ce3e49c993e1"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NTc1MDc4OnYy", "diffSide": "LEFT", "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/io/hfile/TestCacheConfig.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQwNTozMzoxN1rOGcwyeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQwNTozMzoxN1rOGcwyeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgxMjY2Ng==", "bodyText": "All these test changes will be not needed", "url": "https://github.com/apache/hbase/pull/1801#discussion_r432812666", "createdAt": "2020-05-30T05:33:17Z", "author": {"login": "anoopsjohn"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/io/hfile/TestCacheConfig.java", "diffHunk": "@@ -245,7 +245,8 @@ public void testDisableCacheDataBlock() throws IOException {\n         .setBlockCacheEnabled(false)\n         .build();\n \n-    cacheConfig = new CacheConfig(conf, columnFamilyDescriptor, null, ByteBuffAllocator.HEAP);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95f84f4a4451c6a0d1db98167088ce3e49c993e1"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NTc1MjA1OnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQwNTozNTo0NFrOGcwzIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQwMzozMjo0OVrOGc2fmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgxMjgzMg==", "bodyText": "Here this blockCache will just give object identifier as no toString() there. BlockCache will be single object within RS. So IMO there is no need to log that with every Store create.  Anyway if you do other comment, we will avoid it as CacheConfig#toString() wont be having BlockCache object", "url": "https://github.com/apache/hbase/pull/1801#discussion_r432812832", "createdAt": "2020-05-30T05:35:44Z", "author": {"login": "anoopsjohn"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java", "diffHunk": "@@ -205,6 +206,7 @@ public CacheConfig(Configuration conf, ColumnFamilyDescriptor family, BlockCache\n     this.blockCache = blockCache;\n     this.byteBuffAllocator = byteBuffAllocator;\n     LOG.info(\"Created cacheConfig: \" + this + (family == null ? \"\" : \" for family \" + family) +\n+        (hri == null ? \"\" : \" in region \" + hri.getRegionNameAsString()) +\n         \" with blockCache=\" + blockCache);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95f84f4a4451c6a0d1db98167088ce3e49c993e1"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkwNjEzOQ==", "bodyText": "Yes, maybe we can log CacheConfig in the BlockCacheFactory#createBlockCache and remove it from here", "url": "https://github.com/apache/hbase/pull/1801#discussion_r432906139", "createdAt": "2020-05-31T03:32:49Z", "author": {"login": "songxincun"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java", "diffHunk": "@@ -205,6 +206,7 @@ public CacheConfig(Configuration conf, ColumnFamilyDescriptor family, BlockCache\n     this.blockCache = blockCache;\n     this.byteBuffAllocator = byteBuffAllocator;\n     LOG.info(\"Created cacheConfig: \" + this + (family == null ? \"\" : \" for family \" + family) +\n+        (hri == null ? \"\" : \" in region \" + hri.getRegionNameAsString()) +\n         \" with blockCache=\" + blockCache);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgxMjgzMg=="}, "originalCommit": {"oid": "95f84f4a4451c6a0d1db98167088ce3e49c993e1"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NjUwMjg5OnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQwNjoxOTozMlrOGc2-rQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQwNDoxOTowN1rOGc-WSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkxNDA5Mw==", "bodyText": "Looks good. There is another jira where we discuss abt  changing HStore#toString() to add region info also there. Then u will need to change this also.", "url": "https://github.com/apache/hbase/pull/1801#discussion_r432914093", "createdAt": "2020-05-31T06:19:32Z", "author": {"login": "anoopsjohn"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java", "diffHunk": "@@ -379,6 +379,9 @@ private MemStore getMemstore() {\n   protected void createCacheConf(final ColumnFamilyDescriptor family) {\n     this.cacheConf = new CacheConfig(conf, family, region.getBlockCache(),\n         region.getRegionServicesForStores().getByteBuffAllocator());\n+    LOG.info(\"Created cacheConfig: \" + this.getCacheConfig()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b5d7d6202abcfb04a2a5b4a174e4c041ed30686"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkxOTUxOQ==", "bodyText": "Looks good. There is another jira where we discuss abt changing HStore#toString() to add region info also there. Then u will need to change this also.\n\nBut, HStore#toString() prints only short name of column family without any attribute. I am not sure is it suitable to use here. @anoopsjohn  Would you give me some suggestions? Thanks a lot", "url": "https://github.com/apache/hbase/pull/1801#discussion_r432919519", "createdAt": "2020-05-31T07:38:36Z", "author": {"login": "songxincun"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java", "diffHunk": "@@ -379,6 +379,9 @@ private MemStore getMemstore() {\n   protected void createCacheConf(final ColumnFamilyDescriptor family) {\n     this.cacheConf = new CacheConfig(conf, family, region.getBlockCache(),\n         region.getRegionServicesForStores().getByteBuffAllocator());\n+    LOG.info(\"Created cacheConfig: \" + this.getCacheConfig()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkxNDA5Mw=="}, "originalCommit": {"oid": "9b5d7d6202abcfb04a2a5b4a174e4c041ed30686"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzAzNDgyNQ==", "bodyText": "Ya that should be fine IMO", "url": "https://github.com/apache/hbase/pull/1801#discussion_r433034825", "createdAt": "2020-06-01T04:19:07Z", "author": {"login": "anoopsjohn"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java", "diffHunk": "@@ -379,6 +379,9 @@ private MemStore getMemstore() {\n   protected void createCacheConf(final ColumnFamilyDescriptor family) {\n     this.cacheConf = new CacheConfig(conf, family, region.getBlockCache(),\n         region.getRegionServicesForStores().getByteBuffAllocator());\n+    LOG.info(\"Created cacheConfig: \" + this.getCacheConfig()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkxNDA5Mw=="}, "originalCommit": {"oid": "9b5d7d6202abcfb04a2a5b4a174e4c041ed30686"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3078, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}