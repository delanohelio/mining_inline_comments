{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzODQzMjY1", "number": 1894, "title": "HBASE-21405 [DOC] Add Details about Output of \"status 'replication'\"", "bodyText": "", "createdAt": "2020-06-12T19:12:20Z", "url": "https://github.com/apache/hbase/pull/1894", "merged": true, "mergeCommit": {"oid": "3ac99ad192fb0ab0db7c07e40da6d2d83a732e62"}, "closed": true, "closedAt": "2020-06-16T09:02:29Z", "author": {"login": "wchevreuil"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqnxUUAH2gAyNDMzODQzMjY1OmZmYzRlMGNhNGQwYWY2YmQ5NzhkZmM1MTNjOTI5MTliMjU4YzRhMmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcriD__AFqTQzMDcyODM3Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ffc4e0ca4d0af6bd978dfc513c92919b258c4a2c", "author": {"user": {"login": "wchevreuil", "name": "Wellington Ramos Chevreuil"}}, "url": "https://github.com/apache/hbase/commit/ffc4e0ca4d0af6bd978dfc513c92919b258c4a2c", "committedDate": "2020-06-12T19:11:04Z", "message": "HBASE-21405 [DOC] Add Details about Output of \"status 'replication'\""}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMDU1NDA5", "url": "https://github.com/apache/hbase/pull/1894#pullrequestreview-430055409", "createdAt": "2020-06-12T21:50:03Z", "commit": {"oid": "ffc4e0ca4d0af6bd978dfc513c92919b258c4a2c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQyMTo1MDowM1rOGjSfGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQyMTo1MjoyMFrOGjSh4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY1NjIxNw==", "bodyText": "This should be SizeOfLogQueue, or?", "url": "https://github.com/apache/hbase/pull/1894#discussion_r439656217", "createdAt": "2020-06-12T21:50:03Z", "author": {"login": "HorizonNet"}, "path": "src/main/asciidoc/_chapters/ops_mgt.adoc", "diffHunk": "@@ -2629,6 +2629,91 @@ You can use the HBase Shell command `status 'replication'` to monitor the replic\n * `status 'replication', 'source'` -- prints the status for each replication source, sorted by hostname.\n * `status 'replication', 'sink'` -- prints the status for each replication sink, sorted by hostname.\n \n+==== Understanding the output\n+\n+The command output will vary according to the state of replication. For example right after a restart\n+and if destination peer is not reachable, no replication source threads would be running,\n+so no metrics would get displayed:\n+\n+----\n+hbase01.home:\n+SOURCE: PeerID=1\n+Normal Queue: 1\n+No Reader/Shipper threads runnning yet.\n+SINK: TimeStampStarted=1591985197350, Waiting for OPs...\n+----\n+\n+Under normal circumstances, a healthy, active-active replication deployment would\n+show the following:\n+\n+----\n+    hbase01.home:\n+      SOURCE: PeerID=1\n+         Normal Queue: 1\n+           AgeOfLastShippedOp=0, TimeStampOfLastShippedOp=Fri Jun 12 18:49:23 BST 2020, SizeOfLogQueue=1, EditsReadFromLogQueue=1, OpsShippedToTarget=1, TimeStampOfNextToReplicate=Fri Jun 12 18:49:23 BST 2020, Replication Lag=0\n+      SINK: TimeStampStarted=1591983663458, AgeOfLastAppliedOp=0, TimeStampsOfLastAppliedOp=Fri Jun 12 18:57:18 BST 2020\n+----\n+\n+The definition for each of these metrics is detailed below:\n+\n+[cols=\"1,1,1\", options=\"header\"]\n+|===\n+| Type\n+| Metric Name\n+| Description\n+\n+| Source\n+| AgeOfLastShippedOp\n+| How long last successfully shipped edit took to effectively get replicated on target.\n+\n+| Source\n+| TimeStampOfLastShippedOp\n+| The actual date of last successful edit shipment.\n+\n+| Source\n+| `", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ffc4e0ca4d0af6bd978dfc513c92919b258c4a2c"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY1NjkyOA==", "bodyText": "There seems to be a space missing before \"command\".", "url": "https://github.com/apache/hbase/pull/1894#discussion_r439656928", "createdAt": "2020-06-12T21:52:20Z", "author": {"login": "HorizonNet"}, "path": "src/main/asciidoc/_chapters/ops_mgt.adoc", "diffHunk": "@@ -2629,6 +2629,91 @@ You can use the HBase Shell command `status 'replication'` to monitor the replic\n * `status 'replication', 'source'` -- prints the status for each replication source, sorted by hostname.\n * `status 'replication', 'sink'` -- prints the status for each replication sink, sorted by hostname.\n \n+==== Understanding the output\n+\n+The command output will vary according to the state of replication. For example right after a restart\n+and if destination peer is not reachable, no replication source threads would be running,\n+so no metrics would get displayed:\n+\n+----\n+hbase01.home:\n+SOURCE: PeerID=1\n+Normal Queue: 1\n+No Reader/Shipper threads runnning yet.\n+SINK: TimeStampStarted=1591985197350, Waiting for OPs...\n+----\n+\n+Under normal circumstances, a healthy, active-active replication deployment would\n+show the following:\n+\n+----\n+    hbase01.home:\n+      SOURCE: PeerID=1\n+         Normal Queue: 1\n+           AgeOfLastShippedOp=0, TimeStampOfLastShippedOp=Fri Jun 12 18:49:23 BST 2020, SizeOfLogQueue=1, EditsReadFromLogQueue=1, OpsShippedToTarget=1, TimeStampOfNextToReplicate=Fri Jun 12 18:49:23 BST 2020, Replication Lag=0\n+      SINK: TimeStampStarted=1591983663458, AgeOfLastAppliedOp=0, TimeStampsOfLastAppliedOp=Fri Jun 12 18:57:18 BST 2020\n+----\n+\n+The definition for each of these metrics is detailed below:\n+\n+[cols=\"1,1,1\", options=\"header\"]\n+|===\n+| Type\n+| Metric Name\n+| Description\n+\n+| Source\n+| AgeOfLastShippedOp\n+| How long last successfully shipped edit took to effectively get replicated on target.\n+\n+| Source\n+| TimeStampOfLastShippedOp\n+| The actual date of last successful edit shipment.\n+\n+| Source\n+| `\n+| Number of wal files on this given queue.\n+\n+| Source\n+| EditsReadFromLogQueue\n+| How many edits have been read from this given queue since this source thread started.\n+\n+| Source\n+| OpsShippedToTarget\n+| How many edits have been shipped to target since this source thread started.\n+\n+| Source\n+| TimeStampOfNextToReplicate\n+| Date of the current edit been attempted to replicate.\n+\n+| Source\n+| Replication Lag\n+| The elapsed time (in millis), since the last edit to replicate was read by this source\n+thread and effectively replicated to target\n+\n+| Sink\n+| TimeStampStarted\n+| Date (in millis) of when this Sink thread started.\n+\n+| Sink\n+| AgeOfLastAppliedOp\n+| How long it took to apply the last successful shipped edit.\n+\n+| Sink\n+| TimeStampsOfLastAppliedOp\n+| Date of last successful applied edit.\n+\n+|===\n+\n+Growing values for `Source.TimeStampsOfLastAppliedOp` and/or\n+`Source.Replication Lag` would indicate replication delays. If those numbers keep going\n+up, while `Source.TimeStampOfLastShippedOp`, `Source.EditsReadFromLogQueue`,\n+`Source.OpsShippedToTarget` or `Source.TimeStampOfNextToReplicate` do not change at all,\n+ then replication flow is failing to progress, and there might be problems within\n+clusters communication. This could also happen if replication is manually paused\n+(via hbase shell `disable_peer`command, for example), but date keeps getting ingested", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ffc4e0ca4d0af6bd978dfc513c92919b258c4a2c"}, "originalPosition": 86}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6610602513738a1ea9f6dc89660e202f52120dc", "author": {"user": {"login": "wchevreuil", "name": "Wellington Ramos Chevreuil"}}, "url": "https://github.com/apache/hbase/commit/f6610602513738a1ea9f6dc89660e202f52120dc", "committedDate": "2020-06-15T09:37:40Z", "message": "Addressing Jan's comments."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNTQ1ODA3", "url": "https://github.com/apache/hbase/pull/1894#pullrequestreview-430545807", "createdAt": "2020-06-15T11:14:39Z", "commit": {"oid": "f6610602513738a1ea9f6dc89660e202f52120dc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNzI4Mzc2", "url": "https://github.com/apache/hbase/pull/1894#pullrequestreview-430728376", "createdAt": "2020-06-15T14:59:39Z", "commit": {"oid": "f6610602513738a1ea9f6dc89660e202f52120dc"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNDo1OTo0MFrOGj2Ftg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNDo1OTo0MFrOGj2Ftg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDIzOTU0Mg==", "bodyText": "Just a question: For active-active replication, in order to get peerId of both clusters (defined in each other), we need to run status 'replication' at both clusters side right?\nGetting ageOfLastShipped etc metric values from remote cluster is also not that easy even if we want to display here.", "url": "https://github.com/apache/hbase/pull/1894#discussion_r440239542", "createdAt": "2020-06-15T14:59:40Z", "author": {"login": "virajjasani"}, "path": "src/main/asciidoc/_chapters/ops_mgt.adoc", "diffHunk": "@@ -2629,6 +2629,91 @@ You can use the HBase Shell command `status 'replication'` to monitor the replic\n * `status 'replication', 'source'` -- prints the status for each replication source, sorted by hostname.\n * `status 'replication', 'sink'` -- prints the status for each replication sink, sorted by hostname.\n \n+==== Understanding the output\n+\n+The command output will vary according to the state of replication. For example right after a restart\n+and if destination peer is not reachable, no replication source threads would be running,\n+so no metrics would get displayed:\n+\n+----\n+hbase01.home:\n+SOURCE: PeerID=1\n+Normal Queue: 1\n+No Reader/Shipper threads runnning yet.\n+SINK: TimeStampStarted=1591985197350, Waiting for OPs...\n+----\n+\n+Under normal circumstances, a healthy, active-active replication deployment would\n+show the following:\n+\n+----\n+    hbase01.home:\n+      SOURCE: PeerID=1\n+         Normal Queue: 1\n+           AgeOfLastShippedOp=0, TimeStampOfLastShippedOp=Fri Jun 12 18:49:23 BST 2020, SizeOfLogQueue=1, EditsReadFromLogQueue=1, OpsShippedToTarget=1, TimeStampOfNextToReplicate=Fri Jun 12 18:49:23 BST 2020, Replication Lag=0\n+      SINK: TimeStampStarted=1591983663458, AgeOfLastAppliedOp=0, TimeStampsOfLastAppliedOp=Fri Jun 12 18:57:18 BST 2020", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6610602513738a1ea9f6dc89660e202f52120dc"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4607, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}