{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwMTA2NTMw", "number": 2514, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxODozMjoxNFrOErvZow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxOToxNjowN1rOErwYJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0MzAwODM1OnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/mob/MobFileCompactionChore.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxODozMjoxNFrOHeraDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwMTowODowMlrOHe2h3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTkzMDUwOQ==", "bodyText": "I feel like we've run into this a few times recently.\nAny thoughts about whether it's a good idea to make the ShortCircuitingClusterConnection not close itself (unless we can know that we're in the process of shutting down)?", "url": "https://github.com/apache/hbase/pull/2514#discussion_r501930509", "createdAt": "2020-10-08T18:32:14Z", "author": {"login": "joshelser"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/mob/MobFileCompactionChore.java", "diffHunk": "@@ -84,10 +84,10 @@ public MobFileCompactionChore(Configuration conf, int batchSize) {\n   protected void chore() {\n \n     boolean reported = false;\n-\n-    try (Connection conn = master.getConnection();\n-        Admin admin = conn.getAdmin();) {\n-\n+    Admin admin = null;\n+    try {\n+      Connection conn = master.getConnection();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b50200e654299960bf8be46af6e88e09e4b795"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk0OTU2OA==", "bodyText": "like have it log a debug/info for someone trying to call the normal close but don't do it, then have inShutdownClose to actually close? that sounds like a good idea for a follow-on?", "url": "https://github.com/apache/hbase/pull/2514#discussion_r501949568", "createdAt": "2020-10-08T19:05:24Z", "author": {"login": "busbey"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/mob/MobFileCompactionChore.java", "diffHunk": "@@ -84,10 +84,10 @@ public MobFileCompactionChore(Configuration conf, int batchSize) {\n   protected void chore() {\n \n     boolean reported = false;\n-\n-    try (Connection conn = master.getConnection();\n-        Admin admin = conn.getAdmin();) {\n-\n+    Admin admin = null;\n+    try {\n+      Connection conn = master.getConnection();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTkzMDUwOQ=="}, "originalCommit": {"oid": "30b50200e654299960bf8be46af6e88e09e4b795"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk1ODI0Nw==", "bodyText": "that sounds like a good idea for a follow-on?\n\nFine to think about as follow-on. Just wanted to ask the question while it was fresh :D", "url": "https://github.com/apache/hbase/pull/2514#discussion_r501958247", "createdAt": "2020-10-08T19:20:52Z", "author": {"login": "joshelser"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/mob/MobFileCompactionChore.java", "diffHunk": "@@ -84,10 +84,10 @@ public MobFileCompactionChore(Configuration conf, int batchSize) {\n   protected void chore() {\n \n     boolean reported = false;\n-\n-    try (Connection conn = master.getConnection();\n-        Admin admin = conn.getAdmin();) {\n-\n+    Admin admin = null;\n+    try {\n+      Connection conn = master.getConnection();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTkzMDUwOQ=="}, "originalCommit": {"oid": "30b50200e654299960bf8be46af6e88e09e4b795"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjExMjczMg==", "bodyText": "yes, we should guard-rail the internal connection (in master or RS) from being closed by any shared services by probably wrapping it with SharedConnection which throws an exception when close() is called out (the same way we share it with users through coprocessor ). I'll raise another JIRA for it.\nThanks guys for the ideas and review.", "url": "https://github.com/apache/hbase/pull/2514#discussion_r502112732", "createdAt": "2020-10-09T01:08:02Z", "author": {"login": "ankitsinghal"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/mob/MobFileCompactionChore.java", "diffHunk": "@@ -84,10 +84,10 @@ public MobFileCompactionChore(Configuration conf, int batchSize) {\n   protected void chore() {\n \n     boolean reported = false;\n-\n-    try (Connection conn = master.getConnection();\n-        Admin admin = conn.getAdmin();) {\n-\n+    Admin admin = null;\n+    try {\n+      Connection conn = master.getConnection();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTkzMDUwOQ=="}, "originalCommit": {"oid": "30b50200e654299960bf8be46af6e88e09e4b795"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0MzE2ODM3OnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/mob/MobFileCompactionChore.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxOToxNjowN1rOHes8TA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwMTowODoxMVrOHe2iIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk1NTY2MA==", "bodyText": "Can we just use try with resources on the Admin object? Do we actually use the Connection at all?", "url": "https://github.com/apache/hbase/pull/2514#discussion_r501955660", "createdAt": "2020-10-08T19:16:07Z", "author": {"login": "busbey"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/mob/MobFileCompactionChore.java", "diffHunk": "@@ -84,10 +84,10 @@ public MobFileCompactionChore(Configuration conf, int batchSize) {\n   protected void chore() {\n \n     boolean reported = false;\n-\n-    try (Connection conn = master.getConnection();\n-        Admin admin = conn.getAdmin();) {\n-\n+    Admin admin = null;\n+    try {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b50200e654299960bf8be46af6e88e09e4b795"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjExMjgwMQ==", "bodyText": "Done", "url": "https://github.com/apache/hbase/pull/2514#discussion_r502112801", "createdAt": "2020-10-09T01:08:11Z", "author": {"login": "ankitsinghal"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/mob/MobFileCompactionChore.java", "diffHunk": "@@ -84,10 +84,10 @@ public MobFileCompactionChore(Configuration conf, int batchSize) {\n   protected void chore() {\n \n     boolean reported = false;\n-\n-    try (Connection conn = master.getConnection();\n-        Admin admin = conn.getAdmin();) {\n-\n+    Admin admin = null;\n+    try {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk1NTY2MA=="}, "originalCommit": {"oid": "30b50200e654299960bf8be46af6e88e09e4b795"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2410, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}