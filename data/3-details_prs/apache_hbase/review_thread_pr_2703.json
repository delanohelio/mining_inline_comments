{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2MzY0MzE2", "number": 2703, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNDoyMjoyOVrOE8vpBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQyMzo0OToyMFrOE9ARiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMTMwNTY0OnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WALSplitter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNDoyMjoyOVrOH5DG0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNDoyMjoyOVrOH5DG0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU4MTc3Ng==", "bodyText": "Nice", "url": "https://github.com/apache/hbase/pull/2703#discussion_r529581776", "createdAt": "2020-11-24T14:22:29Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WALSplitter.java", "diffHunk": "@@ -220,17 +218,16 @@ public static boolean splitLogFile(Path walDir, FileStatus logfile, FileSystem w\n     Path rootDir = CommonFSUtils.getRootDir(conf);\n     FileSystem rootFS = rootDir.getFileSystem(conf);\n     WALSplitter splitter = new WALSplitter(factory, conf, walRootDir, walFS, rootDir, rootFS);\n-    final FileStatus[] wals =\n+    final List<FileStatus> wals =\n       SplitLogManager.getFileList(conf, Collections.singletonList(walsDir), null);\n     List<Path> splits = new ArrayList<>();\n-    if (ArrayUtils.isNotEmpty(wals)) {\n+    if (CollectionUtils.isNotEmpty(wals)) {\n       for (FileStatus wal: wals) {\n         SplitWALResult splitWALResult = splitter.splitWAL(wal, null);\n         if (splitWALResult.isFinished()) {\n           WALSplitUtil.archive(wal.getPath(), splitWALResult.isCorrupt(), archiveDir, walFS, conf);\n-          if (splitter.outputSink.splits != null) {\n-            splits.addAll(splitter.outputSink.splits);\n-          }\n+          //splitter.outputSink.splits is mark as final, do not need null check\n+          splits.addAll(splitter.outputSink.splits);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2453e09408bb0236c3e2ce781a61934343c08d1d"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMjIyNTMzOnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/SplitLogManager.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNjo1NzowM1rOH5MPLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQwMjoyMTowMVrOH5gnWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTczMTM3NA==", "bodyText": "s/logfiles.size != 0/logfiles.isEmpty()/", "url": "https://github.com/apache/hbase/pull/2703#discussion_r529731374", "createdAt": "2020-11-24T16:57:03Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/SplitLogManager.java", "diffHunk": "@@ -242,11 +242,11 @@ public long splitLogDistributed(final Set<ServerName> serverNames, final List<Pa\n     long totalSize = 0;\n     TaskBatch batch = null;\n     long startTime = 0;\n-    FileStatus[] logfiles = getFileList(logDirs, filter);\n-    if (logfiles.length != 0) {\n+    List<FileStatus> logfiles = getFileList(logDirs, filter);\n+    if (logfiles.size() != 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2453e09408bb0236c3e2ce781a61934343c08d1d"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDA2NTI0MA==", "bodyText": "Nice, I will use CollectionUtils.isNotEmpty instead", "url": "https://github.com/apache/hbase/pull/2703#discussion_r530065240", "createdAt": "2020-11-25T02:21:01Z", "author": {"login": "yuqi1129"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/SplitLogManager.java", "diffHunk": "@@ -242,11 +242,11 @@ public long splitLogDistributed(final Set<ServerName> serverNames, final List<Pa\n     long totalSize = 0;\n     TaskBatch batch = null;\n     long startTime = 0;\n-    FileStatus[] logfiles = getFileList(logDirs, filter);\n-    if (logfiles.length != 0) {\n+    List<FileStatus> logfiles = getFileList(logDirs, filter);\n+    if (logfiles.size() != 0) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTczMTM3NA=="}, "originalCommit": {"oid": "2453e09408bb0236c3e2ce781a61934343c08d1d"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyNDAzMDgzOnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WALSplitter.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQyMzo0OToyMFrOH5dt-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQwMjoyODoyMlrOH5gwZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDAxNzc4Ng==", "bodyText": "wals.isEmpty()?", "url": "https://github.com/apache/hbase/pull/2703#discussion_r530017786", "createdAt": "2020-11-24T23:49:20Z", "author": {"login": "infraio"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WALSplitter.java", "diffHunk": "@@ -220,17 +218,16 @@ public static boolean splitLogFile(Path walDir, FileStatus logfile, FileSystem w\n     Path rootDir = CommonFSUtils.getRootDir(conf);\n     FileSystem rootFS = rootDir.getFileSystem(conf);\n     WALSplitter splitter = new WALSplitter(factory, conf, walRootDir, walFS, rootDir, rootFS);\n-    final FileStatus[] wals =\n+    final List<FileStatus> wals =\n       SplitLogManager.getFileList(conf, Collections.singletonList(walsDir), null);\n     List<Path> splits = new ArrayList<>();\n-    if (ArrayUtils.isNotEmpty(wals)) {\n+    if (CollectionUtils.isNotEmpty(wals)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2453e09408bb0236c3e2ce781a61934343c08d1d"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDA2NzU1Ng==", "bodyText": "The logic here: if wals is not (empty or null), we will do the following loop, so i can't clearly figure out your meaning, could you description it in detail ?", "url": "https://github.com/apache/hbase/pull/2703#discussion_r530067556", "createdAt": "2020-11-25T02:28:22Z", "author": {"login": "yuqi1129"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WALSplitter.java", "diffHunk": "@@ -220,17 +218,16 @@ public static boolean splitLogFile(Path walDir, FileStatus logfile, FileSystem w\n     Path rootDir = CommonFSUtils.getRootDir(conf);\n     FileSystem rootFS = rootDir.getFileSystem(conf);\n     WALSplitter splitter = new WALSplitter(factory, conf, walRootDir, walFS, rootDir, rootFS);\n-    final FileStatus[] wals =\n+    final List<FileStatus> wals =\n       SplitLogManager.getFileList(conf, Collections.singletonList(walsDir), null);\n     List<Path> splits = new ArrayList<>();\n-    if (ArrayUtils.isNotEmpty(wals)) {\n+    if (CollectionUtils.isNotEmpty(wals)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDAxNzc4Ng=="}, "originalCommit": {"oid": "2453e09408bb0236c3e2ce781a61934343c08d1d"}, "originalPosition": 34}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2304, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}