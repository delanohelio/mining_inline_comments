{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1NDYxOTIy", "number": 1379, "title": "HBASE-24077 When encounter RowTooBigException, log the row info.", "bodyText": "", "createdAt": "2020-03-30T07:35:00Z", "url": "https://github.com/apache/hbase/pull/1379", "merged": true, "mergeCommit": {"oid": "62718cdb28c83fabdf0e0429d3bf8a917fa8f283"}, "closed": true, "closedAt": "2020-04-07T02:28:36Z", "author": {"login": "binlijin"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcSpc96AH2gAyMzk1NDYxOTIyOjc4MTIzYTE4YmZhNzRmYjQyY2JhYjYwZDhkNTMwZWI1NjIzZWEzZGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcUsE3HAFqTM4NzgzMjI4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "78123a18bfa74fb42cbab60d8d530eb5623ea3df", "author": {"user": {"login": "binlijin", "name": null}}, "url": "https://github.com/apache/hbase/commit/78123a18bfa74fb42cbab60d8d530eb5623ea3df", "committedDate": "2020-03-30T07:34:28Z", "message": "HBASE-24077 When encounter RowTooBigException, log the row info."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNjA3NDM5", "url": "https://github.com/apache/hbase/pull/1379#pullrequestreview-383607439", "createdAt": "2020-03-30T07:53:08Z", "commit": {"oid": "78123a18bfa74fb42cbab60d8d530eb5623ea3df"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwNzo1MzowOFrOF9dkpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwNzo1MzowOFrOF9dkpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk5MTk3Mg==", "bodyText": "Should we use LOG.warn or error here? Also, with variable params replacing + var + with {} and argument?", "url": "https://github.com/apache/hbase/pull/1379#discussion_r399991972", "createdAt": "2020-03-30T07:53:08Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java", "diffHunk": "@@ -635,8 +635,12 @@ public boolean next(List<Cell> outResult, ScannerContext scannerContext) throws\n             scannerContext.incrementBatchProgress(1);\n \n             if (matcher.isUserScan() && totalBytesRead > maxRowSize) {\n-              throw new RowTooBigException(\n-                  \"Max row size allowed: \" + maxRowSize + \", but the row is bigger than that.\");\n+              LOG.info(\"Max row size allowed: \" + maxRowSize\n+                + \", but the row is bigger than that, the row info: \" + CellUtil\n+                .toString(cell, true) + \", already have process row cells = \" + outResult.size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78123a18bfa74fb42cbab60d8d530eb5623ea3df"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33ca253cd8f39d29b52e3f2bcc0b39ce4ad12d5d", "author": {"user": {"login": "binlijin", "name": null}}, "url": "https://github.com/apache/hbase/commit/33ca253cd8f39d29b52e3f2bcc0b39ce4ad12d5d", "committedDate": "2020-03-30T11:25:07Z", "message": "fix comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNzcxOTYz", "url": "https://github.com/apache/hbase/pull/1379#pullrequestreview-383771963", "createdAt": "2020-03-30T11:43:52Z", "commit": {"oid": "32d1a9129dc1f7c9f6343e32b8b2a0e097e941dc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58c325fbfe4e605e82cf995efa357f59dee4ada4", "author": {"user": {"login": "binlijin", "name": null}}, "url": "https://github.com/apache/hbase/commit/58c325fbfe4e605e82cf995efa357f59dee4ada4", "committedDate": "2020-03-30T11:45:49Z", "message": "add region info"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "32d1a9129dc1f7c9f6343e32b8b2a0e097e941dc", "author": {"user": {"login": "binlijin", "name": null}}, "url": "https://github.com/apache/hbase/commit/32d1a9129dc1f7c9f6343e32b8b2a0e097e941dc", "committedDate": "2020-03-30T11:40:44Z", "message": "add region info"}, "afterCommit": {"oid": "58c325fbfe4e605e82cf995efa357f59dee4ada4", "author": {"user": {"login": "binlijin", "name": null}}, "url": "https://github.com/apache/hbase/commit/58c325fbfe4e605e82cf995efa357f59dee4ada4", "committedDate": "2020-03-30T11:45:49Z", "message": "add region info"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzOTU0MzA3", "url": "https://github.com/apache/hbase/pull/1379#pullrequestreview-383954307", "createdAt": "2020-03-30T15:10:24Z", "commit": {"oid": "58c325fbfe4e605e82cf995efa357f59dee4ada4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNToxMDoyNVrOF9ugCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNToxMDoyNVrOF9ugCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI2OTMyMQ==", "bodyText": "I think the variable substitution ({}) here won't work. Didn't we had a better way for this in exceptions?", "url": "https://github.com/apache/hbase/pull/1379#discussion_r400269321", "createdAt": "2020-03-30T15:10:25Z", "author": {"login": "HorizonNet"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java", "diffHunk": "@@ -635,8 +635,14 @@ public boolean next(List<Cell> outResult, ScannerContext scannerContext) throws\n             scannerContext.incrementBatchProgress(1);\n \n             if (matcher.isUserScan() && totalBytesRead > maxRowSize) {\n-              throw new RowTooBigException(\n-                  \"Max row size allowed: \" + maxRowSize + \", but the row is bigger than that.\");\n+              LOG.warn(\"Max row size allowed: {}, but the row is bigger than that, the row info: \"\n+                  + \"{}, already have process row cells = {}, it belong to region = {}\",\n+                maxRowSize, CellUtil.toString(cell, true), outResult.size(),\n+                store.getHRegion().getRegionInfo().getRegionNameAsString());\n+              throw new RowTooBigException(\"Max row size allowed: \" + maxRowSize\n+                + \", but the row is bigger than that, the row info: \" + CellUtil\n+                .toString(cell, true) + \", it belong to region = {}\" + store.getHRegion()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "58c325fbfe4e605e82cf995efa357f59dee4ada4"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bc65e1115867289d317891995d7b1ed56bd7b65", "author": {"user": {"login": "binlijin", "name": null}}, "url": "https://github.com/apache/hbase/commit/9bc65e1115867289d317891995d7b1ed56bd7b65", "committedDate": "2020-03-31T01:00:28Z", "message": "fix comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3364da9b42b5610cb18e28730d452fbc085212a1", "author": {"user": {"login": "binlijin", "name": null}}, "url": "https://github.com/apache/hbase/commit/3364da9b42b5610cb18e28730d452fbc085212a1", "committedDate": "2020-04-01T07:30:31Z", "message": "refactor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MTQzMzEy", "url": "https://github.com/apache/hbase/pull/1379#pullrequestreview-384143312", "createdAt": "2020-03-30T18:59:21Z", "commit": {"oid": "58c325fbfe4e605e82cf995efa357f59dee4ada4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxODo1OToyMVrOF9330w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxODo1OToyMVrOF9330w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQyMjg2Nw==", "bodyText": "IMO client data shouldn't be logged at sever side. We can throw RowTooBigException with rowKey.", "url": "https://github.com/apache/hbase/pull/1379#discussion_r400422867", "createdAt": "2020-03-30T18:59:21Z", "author": {"login": "pankaj72981"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java", "diffHunk": "@@ -635,8 +635,14 @@ public boolean next(List<Cell> outResult, ScannerContext scannerContext) throws\n             scannerContext.incrementBatchProgress(1);\n \n             if (matcher.isUserScan() && totalBytesRead > maxRowSize) {\n-              throw new RowTooBigException(\n-                  \"Max row size allowed: \" + maxRowSize + \", but the row is bigger than that.\");\n+              LOG.warn(\"Max row size allowed: {}, but the row is bigger than that, the row info: \"\n+                  + \"{}, already have process row cells = {}, it belong to region = {}\",\n+                maxRowSize, CellUtil.toString(cell, true), outResult.size(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "58c325fbfe4e605e82cf995efa357f59dee4ada4"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MzM2MzQz", "url": "https://github.com/apache/hbase/pull/1379#pullrequestreview-385336343", "createdAt": "2020-04-01T07:43:20Z", "commit": {"oid": "3364da9b42b5610cb18e28730d452fbc085212a1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3ODMyMjg4", "url": "https://github.com/apache/hbase/pull/1379#pullrequestreview-387832288", "createdAt": "2020-04-05T15:45:42Z", "commit": {"oid": "3364da9b42b5610cb18e28730d452fbc085212a1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2504, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}