{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4MjMzNjA0", "number": 1572, "title": "HBASE-24246 Miscellaneous hbck2 fixMeta bulk merge fixes: better logg\u2026", "bodyText": "\u2026ing around merges/overlap-fixing, 'HBCK Report' overlap listing, and configuration\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java\nFix weird brackets around each region name when logging.\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/MetaFixer.java\nLog when we hit the max merge limit. Also up limit to 64.\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/MergeTableRegionsProcedure.java\nMake logs make more sense to operator.\nhbase-server/src/main/resources/hbase-webapps/master/hbck.jsp\nMake RegionName show when you mouseover so long names don't mess up\ndisplay of holes and overlaps.", "createdAt": "2020-04-23T22:32:16Z", "url": "https://github.com/apache/hbase/pull/1572", "merged": true, "mergeCommit": {"oid": "1dd4b13e175a59756e812b154ab1a9399f885190"}, "closed": true, "closedAt": "2020-05-04T15:21:53Z", "author": {"login": "saintstack"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcalaTkABqjMyNjcyNTA4NDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcd-gq0gFqTQwNDkzMzA4NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f86aea2ba190007345b76ebfeec493ae83ea56cc", "author": {"user": {"login": "saintstack", "name": "Michael Stack"}}, "url": "https://github.com/apache/hbase/commit/f86aea2ba190007345b76ebfeec493ae83ea56cc", "committedDate": "2020-04-23T22:30:30Z", "message": "HBASE-24246 Miscellaneous hbck2 fixMeta bulk merge fixes: better logging around merges/overlap-fixing, 'HBCK Report' overlap listing, and configuration\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java\n Fix weird brackets around each region name when logging.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/MetaFixer.java\n  Log when we hit the max merge limit. Also up limit to 64.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/MergeTableRegionsProcedure.java\n Make logs make more sense to operator.\n\nhbase-server/src/main/resources/hbase-webapps/master/hbck.jsp\n Make RegionName show when you mouseover so long names don't mess up\n display of holes and overlaps."}, "afterCommit": {"oid": "a3bc430280cef2d4054647c3ed30776b281b9731", "author": {"user": {"login": "saintstack", "name": "Michael Stack"}}, "url": "https://github.com/apache/hbase/commit/a3bc430280cef2d4054647c3ed30776b281b9731", "committedDate": "2020-04-23T23:23:03Z", "message": "HBASE-24246 Miscellaneous hbck2 fixMeta bulk merge fixes: better logging around merges/overlap-fixing, 'HBCK Report' overlap listing, and configuration\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java\n Fix weird brackets around each region name when logging.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/MetaFixer.java\n  Log when we hit the max merge limit. Also up limit to 64.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/MergeTableRegionsProcedure.java\n Make logs make more sense to operator.\n\nhbase-server/src/main/resources/hbase-webapps/master/hbck.jsp\n Make RegionName show when you mouseover so long names don't mess up\n display of holes and overlaps."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5NTQ1MDg4", "url": "https://github.com/apache/hbase/pull/1572#pullrequestreview-399545088", "createdAt": "2020-04-23T23:28:02Z", "commit": {"oid": "f86aea2ba190007345b76ebfeec493ae83ea56cc"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QyMzoyODoxN1rOGLAKcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QyMzozMDo1OVrOGLAOVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE5MDE5NA==", "bodyText": "tooltip \ud83d\udd7a I also started using tooltip in #1485", "url": "https://github.com/apache/hbase/pull/1572#discussion_r414190194", "createdAt": "2020-04-23T23:28:17Z", "author": {"login": "liuml07"}, "path": "hbase-server/src/main/resources/hbase-webapps/master/hbck.jsp", "diffHunk": "@@ -223,8 +224,8 @@\n             </tr>\n             <% for (Pair<RegionInfo, RegionInfo> p : report.getHoles()) { %>\n             <tr>\n-              <td><%= p.getFirst() %></td>\n-              <td><%= p.getSecond() %></td>\n+              <td><span title=\"<%= p.getFirst() %>\"><%= p.getFirst().getEncodedName() %></span></td>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a3bc430280cef2d4054647c3ed30776b281b9731"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE5MDY4NQ==", "bodyText": "If you like, ri -> ri.getShortNameToLog() can be replaced with method reference RegionInfo::getShortNameToLog. Same other places. Good to have class type before method so I personally prefer that.", "url": "https://github.com/apache/hbase/pull/1572#discussion_r414190685", "createdAt": "2020-04-23T23:29:33Z", "author": {"login": "liuml07"}, "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/client/RegionInfo.java", "diffHunk": "@@ -304,12 +304,11 @@ static String getShortNameToLog(RegionInfo...hris) {\n   }\n \n   /**\n-   * @return Return a String of short, printable names for <code>hris</code>\n-   * (usually encoded name) for us logging.\n+   * @return Return a String of short, printable names for <code>hris</code> (usually encoded name)\n+   *   for us logging.\n    */\n   static String getShortNameToLog(final List<RegionInfo> ris) {\n-    return ris.stream().map(ri -> ri.getShortNameToLog()).\n-    collect(Collectors.toList()).toString();\n+    return ris.stream().map(ri -> ri.getShortNameToLog()).collect(Collectors.toList()).toString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a3bc430280cef2d4054647c3ed30776b281b9731"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE5MDk1NQ==", "bodyText": "Is currentMergeSet.size() also worth in the log message?", "url": "https://github.com/apache/hbase/pull/1572#discussion_r414190955", "createdAt": "2020-04-23T23:30:24Z", "author": {"login": "liuml07"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/MetaFixer.java", "diffHunk": "@@ -247,6 +247,10 @@ void fixOverlaps(CatalogJanitor.Report report) throws IOException {\n       if (regionInfoWithlargestEndKey != null) {\n         if (!isOverlap(regionInfoWithlargestEndKey, pair) ||\n             currentMergeSet.size() >= maxMergeCount) {\n+          // Log when we cut-off-merge because we hit the configured maximum merge limit.\n+          if (currentMergeSet.size() >= maxMergeCount) {\n+            LOG.warn(\"Ran into maximum-at-a-time merges limit={}\", maxMergeCount);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a3bc430280cef2d4054647c3ed30776b281b9731"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE5MTE4OQ==", "bodyText": "Not sure if you like String.format.", "url": "https://github.com/apache/hbase/pull/1572#discussion_r414191189", "createdAt": "2020-04-23T23:30:59Z", "author": {"login": "liuml07"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/MergeTableRegionsProcedure.java", "diffHunk": "@@ -134,8 +132,8 @@ private static void checkRegionsToMerge(MasterProcedureEnv env, final RegionInfo\n           throw new MergeRegionException(msg);\n         }\n         if (!force && !ri.isAdjacent(previous) && !ri.isOverlap(previous)) {\n-          String msg = \"Unable to merge non-adjacent or non-overlapping regions \" +\n-              previous.getShortNameToLog() + \", \" + ri.getShortNameToLog() + \" when force=false\";\n+          String msg = \"Unable to merge non-adjacent or non-overlapping regions '\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a3bc430280cef2d4054647c3ed30776b281b9731"}, "originalPosition": 22}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c569094fc7b637609994cfbd796ebe6610d3a899", "author": {"user": {"login": "saintstack", "name": "Michael Stack"}}, "url": "https://github.com/apache/hbase/commit/c569094fc7b637609994cfbd796ebe6610d3a899", "committedDate": "2020-04-24T00:03:49Z", "message": "Address Mingliang Liu liuml07 feedback"}, "afterCommit": {"oid": "6edff7c49f08558bf2989b930edabaff2c7819d8", "author": {"user": {"login": "saintstack", "name": "Michael Stack"}}, "url": "https://github.com/apache/hbase/commit/6edff7c49f08558bf2989b930edabaff2c7819d8", "committedDate": "2020-04-28T20:49:18Z", "message": "Address Mingliang Liu liuml07 feedback"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6edff7c49f08558bf2989b930edabaff2c7819d8", "author": {"user": {"login": "saintstack", "name": "Michael Stack"}}, "url": "https://github.com/apache/hbase/commit/6edff7c49f08558bf2989b930edabaff2c7819d8", "committedDate": "2020-04-28T20:49:18Z", "message": "Address Mingliang Liu liuml07 feedback"}, "afterCommit": {"oid": "cf23bea1b34b9109db5a100b210eecaa5b508111", "author": {"user": {"login": "saintstack", "name": "Michael Stack"}}, "url": "https://github.com/apache/hbase/commit/cf23bea1b34b9109db5a100b210eecaa5b508111", "committedDate": "2020-04-29T00:29:13Z", "message": "HBASE-24246 Miscellaneous hbck2 fixMeta bulk merge fixes: better logging around merges/overlap-fixing, 'HBCK Report' overlap listing, and configuration\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java\n Fix weird brackets around each region name when logging.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/MetaFixer.java\n  Log when we hit the max merge limit. Also up limit to 64.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/MergeTableRegionsProcedure.java\n Make logs make more sense to operator.\n\nhbase-server/src/main/resources/hbase-webapps/master/hbck.jsp\n Make RegionName show when you mouseover so long names don't mess up\n display of holes and overlaps.\n\nAddress Mingliang Liu liuml07 feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a5924a540808642125db5ab9c37472c15738ac0", "author": {"user": {"login": "saintstack", "name": "Michael Stack"}}, "url": "https://github.com/apache/hbase/commit/1a5924a540808642125db5ab9c37472c15738ac0", "committedDate": "2020-04-29T22:25:33Z", "message": "HBASE-24246 Miscellaneous hbck2 fixMeta bulk merge fixes: better logging around merges/overlap-fixing, 'HBCK Report' overlap listing, and configuration\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java\n Fix weird brackets around each region name when logging.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/MetaFixer.java\n  Log when we hit the max merge limit. Also up limit to 64.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/MergeTableRegionsProcedure.java\n Make logs make more sense to operator.\n\nhbase-server/src/main/resources/hbase-webapps/master/hbck.jsp\n Make RegionName show when you mouseover so long names don't mess up\n display of holes and overlaps.\n\nAddress Mingliang Liu liuml07 feedback"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cf23bea1b34b9109db5a100b210eecaa5b508111", "author": {"user": {"login": "saintstack", "name": "Michael Stack"}}, "url": "https://github.com/apache/hbase/commit/cf23bea1b34b9109db5a100b210eecaa5b508111", "committedDate": "2020-04-29T00:29:13Z", "message": "HBASE-24246 Miscellaneous hbck2 fixMeta bulk merge fixes: better logging around merges/overlap-fixing, 'HBCK Report' overlap listing, and configuration\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java\n Fix weird brackets around each region name when logging.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/MetaFixer.java\n  Log when we hit the max merge limit. Also up limit to 64.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/MergeTableRegionsProcedure.java\n Make logs make more sense to operator.\n\nhbase-server/src/main/resources/hbase-webapps/master/hbck.jsp\n Make RegionName show when you mouseover so long names don't mess up\n display of holes and overlaps.\n\nAddress Mingliang Liu liuml07 feedback"}, "afterCommit": {"oid": "1a5924a540808642125db5ab9c37472c15738ac0", "author": {"user": {"login": "saintstack", "name": "Michael Stack"}}, "url": "https://github.com/apache/hbase/commit/1a5924a540808642125db5ab9c37472c15738ac0", "committedDate": "2020-04-29T22:25:33Z", "message": "HBASE-24246 Miscellaneous hbck2 fixMeta bulk merge fixes: better logging around merges/overlap-fixing, 'HBCK Report' overlap listing, and configuration\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java\n Fix weird brackets around each region name when logging.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/MetaFixer.java\n  Log when we hit the max merge limit. Also up limit to 64.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/MergeTableRegionsProcedure.java\n Make logs make more sense to operator.\n\nhbase-server/src/main/resources/hbase-webapps/master/hbck.jsp\n Make RegionName show when you mouseover so long names don't mess up\n display of holes and overlaps.\n\nAddress Mingliang Liu liuml07 feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0OTMzMDg1", "url": "https://github.com/apache/hbase/pull/1572#pullrequestreview-404933085", "createdAt": "2020-05-04T12:17:49Z", "commit": {"oid": "1a5924a540808642125db5ab9c37472c15738ac0"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMjoxNzo0OVrOGP9uew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMjoxNzo0OVrOGP9uew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTM5MzE0Nw==", "bodyText": "nit: no holes?", "url": "https://github.com/apache/hbase/pull/1572#discussion_r419393147", "createdAt": "2020-05-04T12:17:49Z", "author": {"login": "petersomogyi"}, "path": "hbase-server/src/main/resources/hbase-webapps/master/hbck.jsp", "diffHunk": "@@ -166,7 +166,8 @@\n       <p>\n         <span>\n           The below are Regions we've lost account of. To be safe, run bulk load of any data found in these Region orphan directories back into the HBase cluster.\n-          First make sure <em>hbase:meta</em> is in a healthy state; run <em>hbck2 fixMeta</em> to be sure. Once this is done, per Region below, run a bulk\n+          First make sure <em>hbase:meta</em> is in a healthy state, that there are not holes, overlaps or inconsistencies (else bulk load may complain);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a5924a540808642125db5ab9c37472c15738ac0"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2217, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}