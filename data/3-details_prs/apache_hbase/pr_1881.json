{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyMTk4OTY5", "number": 1881, "title": "HBASE-24529 hbase.rs.evictblocksonclose is not honored when removing \u2026", "bodyText": "\u2026compacted files and closing the storefiles", "createdAt": "2020-06-10T04:49:23Z", "url": "https://github.com/apache/hbase/pull/1881", "merged": true, "mergeCommit": {"oid": "6b7a93d10ce4abcf140afbdc8c8f7ca670399541"}, "closed": true, "closedAt": "2020-06-12T09:59:04Z", "author": {"login": "brfrn169"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcp3GinAFqTQyNzkyMjAwNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqcrW0AFqTQyOTQ4NTc4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3OTIyMDA2", "url": "https://github.com/apache/hbase/pull/1881#pullrequestreview-427922006", "createdAt": "2020-06-10T10:28:54Z", "commit": {"oid": "48bbd5afe6ae1abe270870fab8985f337f152183"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMDoyODo1NFrOGhuyXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMDoyODo1NFrOGhuyXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODAyMjc0OQ==", "bodyText": "While closing the region, doing the evict caused delay in closure. But here are we seeing some impact because of this evict? This will happen in async way from the Discharger thread right? Just trying to understand.", "url": "https://github.com/apache/hbase/pull/1881#discussion_r438022749", "createdAt": "2020-06-10T10:28:54Z", "author": {"login": "anoopsjohn"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java", "diffHunk": "@@ -622,7 +622,8 @@ void setDataBlockEncoderInTest(HFileDataBlockEncoder blockEncoder) {\n       for (HStoreFile storeFile : results) {\n         if (compactedStoreFiles.contains(storeFile.getPath().getName())) {\n           LOG.warn(\"Clearing the compacted storefile {} from {}\", storeFile, this);\n-          storeFile.getReader().close(true);\n+          storeFile.getReader().close(storeFile.getCacheConf() != null ?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48bbd5afe6ae1abe270870fab8985f337f152183"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "48bbd5afe6ae1abe270870fab8985f337f152183", "author": {"user": {"login": "brfrn169", "name": "Toshihiro Suzuki"}}, "url": "https://github.com/apache/hbase/commit/48bbd5afe6ae1abe270870fab8985f337f152183", "committedDate": "2020-06-10T04:47:42Z", "message": "HBASE-24529 hbase.rs.evictblocksonclose is not honored when removing compacted files and closing the storefiles"}, "afterCommit": {"oid": "4ddb06ad7fe26e56d476a04ff4fa384bbac49d75", "author": {"user": {"login": "brfrn169", "name": "Toshihiro Suzuki"}}, "url": "https://github.com/apache/hbase/commit/4ddb06ad7fe26e56d476a04ff4fa384bbac49d75", "committedDate": "2020-06-10T13:50:48Z", "message": "HBASE-24529 hbase.rs.evictblocksonclose is not honored when removing compacted files and closing the storefiles"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NzU3MjA5", "url": "https://github.com/apache/hbase/pull/1881#pullrequestreview-428757209", "createdAt": "2020-06-11T09:47:17Z", "commit": {"oid": "4ddb06ad7fe26e56d476a04ff4fa384bbac49d75"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwOTo0NzoxOFrOGiWQHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwOTo0NzoxOFrOGiWQHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY2OTM0Mg==", "bodyText": "This area will be getting called when we close a store as well as when the CompactionDischarger finds unreferenced compacted files..  CompactionDischarger  is working in an async way anyways.  But ya as per ur explanation, during close() we wanted to keep it this was as in patch.", "url": "https://github.com/apache/hbase/pull/1881#discussion_r438669342", "createdAt": "2020-06-11T09:47:18Z", "author": {"login": "anoopsjohn"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java", "diffHunk": "@@ -2741,7 +2741,8 @@ private void removeCompactedfiles(Collection<HStoreFile> compactedfiles)\n             LOG.trace(\"Closing and archiving the file {}\", file);\n             // Copy the file size before closing the reader\n             final long length = r.length();\n-            r.close(true);\n+            r.close(file.getCacheConf() != null ?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ddb06ad7fe26e56d476a04ff4fa384bbac49d75"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4ddb06ad7fe26e56d476a04ff4fa384bbac49d75", "author": {"user": {"login": "brfrn169", "name": "Toshihiro Suzuki"}}, "url": "https://github.com/apache/hbase/commit/4ddb06ad7fe26e56d476a04ff4fa384bbac49d75", "committedDate": "2020-06-10T13:50:48Z", "message": "HBASE-24529 hbase.rs.evictblocksonclose is not honored when removing compacted files and closing the storefiles"}, "afterCommit": {"oid": "a4610b984d0e02062c022abce73b60aac376f708", "author": {"user": {"login": "brfrn169", "name": "Toshihiro Suzuki"}}, "url": "https://github.com/apache/hbase/commit/a4610b984d0e02062c022abce73b60aac376f708", "committedDate": "2020-06-11T09:55:31Z", "message": "HBASE-24529 hbase.rs.evictblocksonclose is not honored when removing compacted files and closing the storefiles"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8acc92640ff8995379fcabc6d2a9c720b48bc287", "author": {"user": {"login": "brfrn169", "name": "Toshihiro Suzuki"}}, "url": "https://github.com/apache/hbase/commit/8acc92640ff8995379fcabc6d2a9c720b48bc287", "committedDate": "2020-06-12T04:45:56Z", "message": "HBASE-24529 hbase.rs.evictblocksonclose is not honored when removing compacted files and closing the storefiles"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a4610b984d0e02062c022abce73b60aac376f708", "author": {"user": {"login": "brfrn169", "name": "Toshihiro Suzuki"}}, "url": "https://github.com/apache/hbase/commit/a4610b984d0e02062c022abce73b60aac376f708", "committedDate": "2020-06-11T09:55:31Z", "message": "HBASE-24529 hbase.rs.evictblocksonclose is not honored when removing compacted files and closing the storefiles"}, "afterCommit": {"oid": "8acc92640ff8995379fcabc6d2a9c720b48bc287", "author": {"user": {"login": "brfrn169", "name": "Toshihiro Suzuki"}}, "url": "https://github.com/apache/hbase/commit/8acc92640ff8995379fcabc6d2a9c720b48bc287", "committedDate": "2020-06-12T04:45:56Z", "message": "HBASE-24529 hbase.rs.evictblocksonclose is not honored when removing compacted files and closing the storefiles"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5NDg1Nzgw", "url": "https://github.com/apache/hbase/pull/1881#pullrequestreview-429485780", "createdAt": "2020-06-12T06:15:36Z", "commit": {"oid": "8acc92640ff8995379fcabc6d2a9c720b48bc287"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4591, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}