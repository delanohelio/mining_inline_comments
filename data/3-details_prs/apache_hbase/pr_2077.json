{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ5ODY0Nzc1", "number": 2077, "title": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead o\u2026", "bodyText": "\u2026f ZooKeeper", "createdAt": "2020-07-16T03:14:16Z", "url": "https://github.com/apache/hbase/pull/2077", "merged": true, "mergeCommit": {"oid": "7e9baa2eb2795b4ef14d7995614b8371c816fa72"}, "closed": true, "closedAt": "2020-09-20T02:54:44Z", "author": {"login": "ddupg"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1XJ2xgFqTQ0OTQ5MTU0OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJay00ABqjM3NzI3Mzg3MzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NDkxNTQ5", "url": "https://github.com/apache/hbase/pull/2077#pullrequestreview-449491549", "createdAt": "2020-07-16T04:02:39Z", "commit": {"oid": "7c06e150a5d065c3865e9335c611db61dc042572"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwNDowMjozOVrOGyZTjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwNDowMjozOVrOGyZTjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQ5NjU5MQ==", "bodyText": "Should be compatible with the old ZK impl. Cannot remove them directly?", "url": "https://github.com/apache/hbase/pull/2077#discussion_r455496591", "createdAt": "2020-07-16T04:02:39Z", "author": {"login": "infraio"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/replication/HBaseReplicationEndpoint.java", "diffHunk": "@@ -148,27 +149,30 @@ public boolean isAborted() {\n     return false;\n   }\n \n+  /**\n+   * Get the connection to peer cluster\n+   * @return connection to peer cluster\n+   * @throws IOException\n+   */\n+  protected synchronized Connection getPeerConnection() throws IOException {\n+    if (peerConnection == null) {\n+      peerConnection = ConnectionFactory.createConnection(ctx.getConfiguration());\n+    }\n+    return peerConnection;\n+  }\n+\n   /**\n    * Get the list of all the region servers from the specified peer\n-   * @param zkw zk connection to use\n    * @return list of region server addresses or an empty list if the slave is unavailable\n    */\n-  protected static List<ServerName> fetchSlavesAddresses(ZKWatcher zkw)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c06e150a5d065c3865e9335c611db61dc042572"}, "originalPosition": 98}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7c06e150a5d065c3865e9335c611db61dc042572", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/7c06e150a5d065c3865e9335c611db61dc042572", "committedDate": "2020-07-16T03:12:55Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}, "afterCommit": {"oid": "4f051756748965caec708086d3bd1c53b0432c0e", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/4f051756748965caec708086d3bd1c53b0432c0e", "committedDate": "2020-07-16T08:01:12Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4f051756748965caec708086d3bd1c53b0432c0e", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/4f051756748965caec708086d3bd1c53b0432c0e", "committedDate": "2020-07-16T08:01:12Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}, "afterCommit": {"oid": "000e8740f19be71925c0624e53db905179ca07b8", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/000e8740f19be71925c0624e53db905179ca07b8", "committedDate": "2020-07-16T08:10:29Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "000e8740f19be71925c0624e53db905179ca07b8", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/000e8740f19be71925c0624e53db905179ca07b8", "committedDate": "2020-07-16T08:10:29Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}, "afterCommit": {"oid": "069337f933ebb2042813a5d8da0f738f786086f5", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/069337f933ebb2042813a5d8da0f738f786086f5", "committedDate": "2020-07-16T11:05:31Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "069337f933ebb2042813a5d8da0f738f786086f5", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/069337f933ebb2042813a5d8da0f738f786086f5", "committedDate": "2020-07-16T11:05:31Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}, "afterCommit": {"oid": "89661e89425bcd063bd9a72f532e62cee70153c2", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/89661e89425bcd063bd9a72f532e62cee70153c2", "committedDate": "2020-07-20T07:38:12Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "89661e89425bcd063bd9a72f532e62cee70153c2", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/89661e89425bcd063bd9a72f532e62cee70153c2", "committedDate": "2020-07-20T07:38:12Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}, "afterCommit": {"oid": "b16639e8d5ff33eee78485ca9598b32bf3bdd5f8", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/b16639e8d5ff33eee78485ca9598b32bf3bdd5f8", "committedDate": "2020-07-21T07:13:48Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b16639e8d5ff33eee78485ca9598b32bf3bdd5f8", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/b16639e8d5ff33eee78485ca9598b32bf3bdd5f8", "committedDate": "2020-07-21T07:13:48Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}, "afterCommit": {"oid": "de926bacff1e3c0a98ca4d48831461725b2d72b4", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/de926bacff1e3c0a98ca4d48831461725b2d72b4", "committedDate": "2020-07-21T09:04:02Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "de926bacff1e3c0a98ca4d48831461725b2d72b4", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/de926bacff1e3c0a98ca4d48831461725b2d72b4", "committedDate": "2020-07-21T09:04:02Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}, "afterCommit": {"oid": "955791ed0ddbcda4f48f753ea085203723a9be2c", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/955791ed0ddbcda4f48f753ea085203723a9be2c", "committedDate": "2020-07-21T11:44:29Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNjc3NTY5", "url": "https://github.com/apache/hbase/pull/2077#pullrequestreview-452677569", "createdAt": "2020-07-21T17:28:17Z", "commit": {"oid": "955791ed0ddbcda4f48f753ea085203723a9be2c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNzoyODoxOFrOG1CbZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNzoyODoxOFrOG1CbZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI2NzQ5Mg==", "bodyText": "Would it be interesting to also add a config flag allowing 3+ versions to optionally still use ZK?", "url": "https://github.com/apache/hbase/pull/2077#discussion_r458267492", "createdAt": "2020-07-21T17:28:18Z", "author": {"login": "wchevreuil"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/replication/HBaseReplicationEndpoint.java", "diffHunk": "@@ -87,8 +108,24 @@ public void stop() {\n   }\n \n   @Override\n-  protected void doStart() {\n+  protected synchronized void doStart() {\n     try {\n+      try (Admin admin = getPeerConnection().getAdmin()) {\n+        String version = admin.getClusterMetrics().getHBaseVersion();\n+        LOG.info(\"Peer cluster version is {} for peer {}\", version, ctx.getPeerId());\n+        if (Integer.parseInt(version.split(\"\\\\.\")[0]) >= 3) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "955791ed0ddbcda4f48f753ea085203723a9be2c"}, "originalPosition": 65}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "955791ed0ddbcda4f48f753ea085203723a9be2c", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/955791ed0ddbcda4f48f753ea085203723a9be2c", "committedDate": "2020-07-21T11:44:29Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}, "afterCommit": {"oid": "95e8050905af6fe3abf6ced3e34e7b9c1d6bbdb0", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/95e8050905af6fe3abf6ced3e34e7b9c1d6bbdb0", "committedDate": "2020-07-22T01:48:24Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "95e8050905af6fe3abf6ced3e34e7b9c1d6bbdb0", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/95e8050905af6fe3abf6ced3e34e7b9c1d6bbdb0", "committedDate": "2020-07-22T01:48:24Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}, "afterCommit": {"oid": "073dca044a629e1d03ab4db7959325dcb5a11508", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/073dca044a629e1d03ab4db7959325dcb5a11508", "committedDate": "2020-07-23T03:30:35Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0NzQwMDA0", "url": "https://github.com/apache/hbase/pull/2077#pullrequestreview-454740004", "createdAt": "2020-07-24T09:11:37Z", "commit": {"oid": "073dca044a629e1d03ab4db7959325dcb5a11508"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "073dca044a629e1d03ab4db7959325dcb5a11508", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/073dca044a629e1d03ab4db7959325dcb5a11508", "committedDate": "2020-07-23T03:30:35Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}, "afterCommit": {"oid": "f90c37eee6026a23a956e1f433f47ca7916a297b", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/f90c37eee6026a23a956e1f433f47ca7916a297b", "committedDate": "2020-08-21T03:17:35Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f90c37eee6026a23a956e1f433f47ca7916a297b", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/f90c37eee6026a23a956e1f433f47ca7916a297b", "committedDate": "2020-08-21T03:17:35Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}, "afterCommit": {"oid": "d2ff2434573381504bc71010054d6574c310203f", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/d2ff2434573381504bc71010054d6574c310203f", "committedDate": "2020-09-07T10:33:13Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d2ff2434573381504bc71010054d6574c310203f", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/d2ff2434573381504bc71010054d6574c310203f", "committedDate": "2020-09-07T10:33:13Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}, "afterCommit": {"oid": "d351993b8510814a11d6dcdab595dd8f7a0b8275", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/d351993b8510814a11d6dcdab595dd8f7a0b8275", "committedDate": "2020-09-07T10:39:01Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d351993b8510814a11d6dcdab595dd8f7a0b8275", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/d351993b8510814a11d6dcdab595dd8f7a0b8275", "committedDate": "2020-09-07T10:39:01Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}, "afterCommit": {"oid": "6552ee1e963c3fcdec9a7b507997ee5e3548bbbc", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/6552ee1e963c3fcdec9a7b507997ee5e3548bbbc", "committedDate": "2020-09-08T08:54:38Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6552ee1e963c3fcdec9a7b507997ee5e3548bbbc", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/6552ee1e963c3fcdec9a7b507997ee5e3548bbbc", "committedDate": "2020-09-08T08:54:38Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}, "afterCommit": {"oid": "2cf24da55f0aee423bd68a0719b73d0e707fe9e3", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/2cf24da55f0aee423bd68a0719b73d0e707fe9e3", "committedDate": "2020-09-08T10:12:43Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2cf24da55f0aee423bd68a0719b73d0e707fe9e3", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/2cf24da55f0aee423bd68a0719b73d0e707fe9e3", "committedDate": "2020-09-08T10:12:43Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}, "afterCommit": {"oid": "8ec7bc2480ef78e84efb77fa92448538fe237361", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/8ec7bc2480ef78e84efb77fa92448538fe237361", "committedDate": "2020-09-10T04:01:18Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8ec7bc2480ef78e84efb77fa92448538fe237361", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/8ec7bc2480ef78e84efb77fa92448538fe237361", "committedDate": "2020-09-10T04:01:18Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}, "afterCommit": {"oid": "390f58738ab58c523cb4eb4c3059f294ccd91581", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/390f58738ab58c523cb4eb4c3059f294ccd91581", "committedDate": "2020-09-11T07:09:01Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "390f58738ab58c523cb4eb4c3059f294ccd91581", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/390f58738ab58c523cb4eb4c3059f294ccd91581", "committedDate": "2020-09-11T07:09:01Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}, "afterCommit": {"oid": "97b36f363c58f3205cd47a431e9caea5d159a0db", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/97b36f363c58f3205cd47a431e9caea5d159a0db", "committedDate": "2020-09-14T06:36:41Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ec226e0169a0a3cc7642a01a7e7260098be29cc", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/4ec226e0169a0a3cc7642a01a7e7260098be29cc", "committedDate": "2020-09-15T02:18:26Z", "message": "HBASE-24681 Remove the cache walsById/walsByIdRecoveredQueues from ReplicationSourceManager (#2019)\n\nSigned-off-by: Wellington Chevreuil <wchevreuil@apache.org>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "97b36f363c58f3205cd47a431e9caea5d159a0db", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/97b36f363c58f3205cd47a431e9caea5d159a0db", "committedDate": "2020-09-14T06:36:41Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}, "afterCommit": {"oid": "4d25e7c70444ae29acafc6082c58bc22176e41bc", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/4d25e7c70444ae29acafc6082c58bc22176e41bc", "committedDate": "2020-09-15T02:18:26Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "969ddcae00afae16482e404c35c84b3b1454f323", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/969ddcae00afae16482e404c35c84b3b1454f323", "committedDate": "2020-09-16T11:35:21Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4d25e7c70444ae29acafc6082c58bc22176e41bc", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/4d25e7c70444ae29acafc6082c58bc22176e41bc", "committedDate": "2020-09-15T02:18:26Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}, "afterCommit": {"oid": "969ddcae00afae16482e404c35c84b3b1454f323", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/969ddcae00afae16482e404c35c84b3b1454f323", "committedDate": "2020-09-16T11:35:21Z", "message": "HBASE-24684 Fetch ReplicationSink servers list from HMaster instead of ZooKeeper"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4289, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}