{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxNjc1NDMw", "number": 1137, "title": "HBASE-23804: Fix default master addr hostname in master registry", "bodyText": "Master rpc server end point doesn't always bind to localhost when a\nspecific end point is configured. It looks up the hostname and\nbinds to the endpoint to which it resolves. MasterRegistry should\ndo the same when building the default server end point to talk to.", "createdAt": "2020-02-06T02:18:42Z", "url": "https://github.com/apache/hbase/pull/1137", "merged": true, "mergeCommit": {"oid": "eb84327c405c569aaac3e9d92621079a301efebe"}, "closed": true, "closedAt": "2020-02-10T22:32:24Z", "author": {"login": "bharathv"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBhn3WgFqTM1NDE3MzI3Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDEb8kAFqTM1NjI5NDgwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MTczMjc3", "url": "https://github.com/apache/hbase/pull/1137#pullrequestreview-354173277", "createdAt": "2020-02-06T02:50:25Z", "commit": {"oid": "decf924469e85bedbb1388c2a3b618f2783d8616"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwMjo1MDoyNVrOFmN2Tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwMjo1MDoyNVrOFmN2Tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTYxNzEwMw==", "bodyText": "Unused import?", "url": "https://github.com/apache/hbase/pull/1137#discussion_r375617103", "createdAt": "2020-02-06T02:50:25Z", "author": {"login": "ndimiduk"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java", "diffHunk": "@@ -20,6 +20,7 @@\n import static org.apache.hadoop.hbase.HConstants.DEFAULT_HBASE_SPLIT_COORDINATED_BY_ZK;\n import static org.apache.hadoop.hbase.HConstants.HBASE_MASTER_LOGCLEANER_PLUGINS;\n import static org.apache.hadoop.hbase.HConstants.HBASE_SPLIT_WAL_COORDINATED_BY_ZK;\n+import static org.apache.hadoop.hbase.HConstants.MASTER_HOSTNAME_KEY;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "decf924469e85bedbb1388c2a3b618f2783d8616"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0NTAyMTQz", "url": "https://github.com/apache/hbase/pull/1137#pullrequestreview-354502143", "createdAt": "2020-02-06T14:43:23Z", "commit": {"oid": "decf924469e85bedbb1388c2a3b618f2783d8616"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNDo0MzoyM1rOFmdf4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNDo0MzoyM1rOFmdf4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTg3MzUwNQ==", "bodyText": "Fixed.", "url": "https://github.com/apache/hbase/pull/1137#discussion_r375873505", "createdAt": "2020-02-06T14:43:23Z", "author": {"login": "bharathv"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java", "diffHunk": "@@ -20,6 +20,7 @@\n import static org.apache.hadoop.hbase.HConstants.DEFAULT_HBASE_SPLIT_COORDINATED_BY_ZK;\n import static org.apache.hadoop.hbase.HConstants.HBASE_MASTER_LOGCLEANER_PLUGINS;\n import static org.apache.hadoop.hbase.HConstants.HBASE_SPLIT_WAL_COORDINATED_BY_ZK;\n+import static org.apache.hadoop.hbase.HConstants.MASTER_HOSTNAME_KEY;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTYxNzEwMw=="}, "originalCommit": {"oid": "decf924469e85bedbb1388c2a3b618f2783d8616"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "decf924469e85bedbb1388c2a3b618f2783d8616", "author": {"user": {"login": "bharathv", "name": "Bharath Vissapragada"}}, "url": "https://github.com/apache/hbase/commit/decf924469e85bedbb1388c2a3b618f2783d8616", "committedDate": "2020-02-06T02:16:35Z", "message": "HBASE-23804: Fix default master addr hostname in master registry\n\nMaster rpc server end point doesn't always bind to localhost when a\nspecific end point is configured. It looks up the hostname and\nbinds to the endpoint to which it resolves. MasterRegistry should\ndo the same when building the default server end point to talk to."}, "afterCommit": {"oid": "c221ce391a072a1f6c37b19a435ae945ce44c72f", "author": {"user": {"login": "bharathv", "name": "Bharath Vissapragada"}}, "url": "https://github.com/apache/hbase/commit/c221ce391a072a1f6c37b19a435ae945ce44c72f", "committedDate": "2020-02-06T14:54:38Z", "message": "Revert \"HBASE-23779 Up the default fork count; make count relative to CPU count (#1108)\"\n\nThis reverts commit b49ec5807349ab566675063b8280611aea2dd681."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c221ce391a072a1f6c37b19a435ae945ce44c72f", "author": {"user": {"login": "bharathv", "name": "Bharath Vissapragada"}}, "url": "https://github.com/apache/hbase/commit/c221ce391a072a1f6c37b19a435ae945ce44c72f", "committedDate": "2020-02-06T14:54:38Z", "message": "Revert \"HBASE-23779 Up the default fork count; make count relative to CPU count (#1108)\"\n\nThis reverts commit b49ec5807349ab566675063b8280611aea2dd681."}, "afterCommit": {"oid": "c98f426993e4303774ecdc166177fe598139a348", "author": {"user": {"login": "bharathv", "name": "Bharath Vissapragada"}}, "url": "https://github.com/apache/hbase/commit/c98f426993e4303774ecdc166177fe598139a348", "committedDate": "2020-02-06T22:25:23Z", "message": "HBASE-23804: Fix default master addr hostname in master registry\n\nMaster rpc server end point doesn't bind to localhost's\nIP address by default. Instead, it looks up the hostname and\nbinds to the endpoint to which it resolves. MasterRegistry should\ndo the same when building the default server end point to talk to."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0ODA2MTYy", "url": "https://github.com/apache/hbase/pull/1137#pullrequestreview-354806162", "createdAt": "2020-02-06T22:06:13Z", "commit": {"oid": "a9b4577594cbc60f49c61d0832e448b19d76fdb2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQyMjowNjoxM1rOFmr3NA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQyMjowNjoxM1rOFmr3NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjEwODg1Mg==", "bodyText": "Actually it is needed here, I moved it to HConstants, so have to explicitly import now.", "url": "https://github.com/apache/hbase/pull/1137#discussion_r376108852", "createdAt": "2020-02-06T22:06:13Z", "author": {"login": "bharathv"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java", "diffHunk": "@@ -20,6 +20,7 @@\n import static org.apache.hadoop.hbase.HConstants.DEFAULT_HBASE_SPLIT_COORDINATED_BY_ZK;\n import static org.apache.hadoop.hbase.HConstants.HBASE_MASTER_LOGCLEANER_PLUGINS;\n import static org.apache.hadoop.hbase.HConstants.HBASE_SPLIT_WAL_COORDINATED_BY_ZK;\n+import static org.apache.hadoop.hbase.HConstants.MASTER_HOSTNAME_KEY;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTYxNzEwMw=="}, "originalCommit": {"oid": "decf924469e85bedbb1388c2a3b618f2783d8616"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NDU4NTQz", "url": "https://github.com/apache/hbase/pull/1137#pullrequestreview-355458543", "createdAt": "2020-02-07T21:51:03Z", "commit": {"oid": "c98f426993e4303774ecdc166177fe598139a348"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QyMTo1MTowM1rOFnLU6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QyMjoxMTo1MlrOFnLxYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjYyNDM2MQ==", "bodyText": "Since this is now in a more public space, and since we have more service types than just \"master\" and \"regionserver\", perhaps the boolean isMaster should become String serviceName.", "url": "https://github.com/apache/hbase/pull/1137#discussion_r376624361", "createdAt": "2020-02-07T21:51:03Z", "author": {"login": "ndimiduk"}, "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/util/DNS.java", "diffHunk": "@@ -66,4 +68,24 @@ public static String getDefaultHost(String strInterface, String nameserver)\n       return org.apache.hadoop.net.DNS.getDefaultHost(strInterface, nameserver);\n     }\n   }\n+\n+  /**\n+   * Get the configured hostname for master/regionserver. Gets the default hostname if not specified\n+   * in the configuration.\n+   * @param conf Configuration to look up.\n+   * @param isMaster True if master hostname needs to be looked up and false for regionserver.\n+   */\n+  public static String getHostname(Configuration conf, boolean isMaster)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c98f426993e4303774ecdc166177fe598139a348"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjYyNjgyNg==", "bodyText": "This method has a number of commits sprinkled into its recent history: HBASE-12954, HBASE-12956, HBASE-13481. They appear related to property binding to 0.0.0.0 and to a configuration with multiple IP's on a network interface. How do we test changes in this part of our code?", "url": "https://github.com/apache/hbase/pull/1137#discussion_r376626826", "createdAt": "2020-02-07T21:57:41Z", "author": {"login": "ndimiduk"}, "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/util/DNS.java", "diffHunk": "@@ -66,4 +68,24 @@ public static String getDefaultHost(String strInterface, String nameserver)\n       return org.apache.hadoop.net.DNS.getDefaultHost(strInterface, nameserver);\n     }\n   }\n+\n+  /**\n+   * Get the configured hostname for master/regionserver. Gets the default hostname if not specified\n+   * in the configuration.\n+   * @param conf Configuration to look up.\n+   * @param isMaster True if master hostname needs to be looked up and false for regionserver.\n+   */\n+  public static String getHostname(Configuration conf, boolean isMaster)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c98f426993e4303774ecdc166177fe598139a348"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjYyODkwNA==", "bodyText": "Head's up, this file is InterfaceAudience.Public, which means removals have to go through a full release deprecation cycle.\nFrom the sub-section titled \"Client API compatibility\" in the book:\n\nAn API needs to be deprecated for a whole major version before we will change/remove it.\n\nAn example: An API was deprecated in 2.0.1 and will be marked for deletion in 4.0.0. On the other hand, an API deprecated in 2.0.0 can be removed in 3.0.0.\n\n\nYou'll need to retain the hold field -- annotate it as deprecated and add a java doc explaining that the other method could be used in its place. You can file a follow-on ticket with a fixVersion of 4.0.0 as a task to delete the field once we get there (and maybe leave a TODO referencing that ticket).\nSadly this constant is a field not a method, which means we have no way to logging a WARN for clients who make use of it.", "url": "https://github.com/apache/hbase/pull/1137#discussion_r376628904", "createdAt": "2020-02-07T22:03:41Z", "author": {"login": "ndimiduk"}, "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/HConstants.java", "diffHunk": "@@ -181,7 +181,11 @@\n   /** Configuration key for the list of master host:ports **/\n   public static final String MASTER_ADDRS_KEY = \"hbase.masters\";\n \n-  public static final String MASTER_ADDRS_DEFAULT =  \"localhost:\" + DEFAULT_MASTER_PORT;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c98f426993e4303774ecdc166177fe598139a348"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjYzMTY0OQ==", "bodyText": "Don't add these here. In the book, they're considered \"expert\" configuration params (and the master version appears to not be documented at all).\nInstead, add them to the DNS class, from which they'll be used. Also, it's InterfaceAudience.Private so we have more maintenance/refactoring flexibility there. And don't lose their InterfaceAudience.LimitedPrivate annotations when you move them.", "url": "https://github.com/apache/hbase/pull/1137#discussion_r376631649", "createdAt": "2020-02-07T22:11:52Z", "author": {"login": "ndimiduk"}, "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/HConstants.java", "diffHunk": "@@ -181,7 +181,11 @@\n   /** Configuration key for the list of master host:ports **/\n   public static final String MASTER_ADDRS_KEY = \"hbase.masters\";\n \n-  public static final String MASTER_ADDRS_DEFAULT =  \"localhost:\" + DEFAULT_MASTER_PORT;\n+  // key to the config parameter of server hostname\n+  // the specification of server hostname is optional. The hostname should be resolvable from\n+  // both master and region server\n+  public static final String RS_HOSTNAME_KEY = \"hbase.regionserver.hostname\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c98f426993e4303774ecdc166177fe598139a348"}, "originalPosition": 8}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c98f426993e4303774ecdc166177fe598139a348", "author": {"user": {"login": "bharathv", "name": "Bharath Vissapragada"}}, "url": "https://github.com/apache/hbase/commit/c98f426993e4303774ecdc166177fe598139a348", "committedDate": "2020-02-06T22:25:23Z", "message": "HBASE-23804: Fix default master addr hostname in master registry\n\nMaster rpc server end point doesn't bind to localhost's\nIP address by default. Instead, it looks up the hostname and\nbinds to the endpoint to which it resolves. MasterRegistry should\ndo the same when building the default server end point to talk to."}, "afterCommit": {"oid": "57b01e08d6e066616314dff37ff0db4a846a803e", "author": {"user": {"login": "bharathv", "name": "Bharath Vissapragada"}}, "url": "https://github.com/apache/hbase/commit/57b01e08d6e066616314dff37ff0db4a846a803e", "committedDate": "2020-02-09T01:02:18Z", "message": "HBASE-23804: Fix default master addr hostname in master registry\n\nMaster rpc server end point doesn't bind to localhost's\nIP address by default. Instead, it looks up the hostname and\nbinds to the endpoint to which it resolves. MasterRegistry should\ndo the same when building the default server end point to talk to."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e32a4ec5854fcd70750c406475f19f09539d7b94", "author": {"user": {"login": "bharathv", "name": "Bharath Vissapragada"}}, "url": "https://github.com/apache/hbase/commit/e32a4ec5854fcd70750c406475f19f09539d7b94", "committedDate": "2020-02-09T01:29:16Z", "message": "HBASE-23804: Fix default master addr hostname in master registry\n\nMaster rpc server end point doesn't bind to localhost's\nIP address by default. Instead, it looks up the hostname and\nbinds to the endpoint to which it resolves. MasterRegistry should\ndo the same when building the default server end point to talk to."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "57b01e08d6e066616314dff37ff0db4a846a803e", "author": {"user": {"login": "bharathv", "name": "Bharath Vissapragada"}}, "url": "https://github.com/apache/hbase/commit/57b01e08d6e066616314dff37ff0db4a846a803e", "committedDate": "2020-02-09T01:02:18Z", "message": "HBASE-23804: Fix default master addr hostname in master registry\n\nMaster rpc server end point doesn't bind to localhost's\nIP address by default. Instead, it looks up the hostname and\nbinds to the endpoint to which it resolves. MasterRegistry should\ndo the same when building the default server end point to talk to."}, "afterCommit": {"oid": "e32a4ec5854fcd70750c406475f19f09539d7b94", "author": {"user": {"login": "bharathv", "name": "Bharath Vissapragada"}}, "url": "https://github.com/apache/hbase/commit/e32a4ec5854fcd70750c406475f19f09539d7b94", "committedDate": "2020-02-09T01:29:16Z", "message": "HBASE-23804: Fix default master addr hostname in master registry\n\nMaster rpc server end point doesn't bind to localhost's\nIP address by default. Instead, it looks up the hostname and\nbinds to the endpoint to which it resolves. MasterRegistry should\ndo the same when building the default server end point to talk to."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2Mjk0ODA0", "url": "https://github.com/apache/hbase/pull/1137#pullrequestreview-356294804", "createdAt": "2020-02-10T21:58:00Z", "commit": {"oid": "e32a4ec5854fcd70750c406475f19f09539d7b94"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2747, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}