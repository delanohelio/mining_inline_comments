{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI4NjM5MDUy", "number": 1860, "title": "HBASE-24380 : Provide WAL splitting journal logging", "bodyText": "Sample output:\nJournal Log: null at 1591291865775\nOpening log file hdfs://localhost:64541/user/vjasani/test-data/9cad028f-1b56-2eeb-fec5-c83773b30f41/WALs/testsplitlogfilemultipleregions,16010,1591291865558/wal.dat.0 at 1591291865776\nFinishing writing output logs and closing down at 1591291865801\nCreating recovered edits writer path=hdfs://localhost:64541/user/vjasani/test-data/9cad028f-1b56-2eeb-fec5-c83773b30f41/data/default/t1/ccc/recovered.edits/0000000000000000002-wal.dat.0.temp at 1591291866091\nCreating recovered edits writer path=hdfs://localhost:64541/user/vjasani/test-data/9cad028f-1b56-2eeb-fec5-c83773b30f41/data/default/t1/bbb/recovered.edits/0000000000000000001-wal.dat.0.temp at 1591291866091\n3 split writer threads finished at 1591291866118\nClosed recovered edits writer path=hdfs://localhost:64541/user/vjasani/test-data/9cad028f-1b56-2eeb-fec5-c83773b30f41/data/default/t1/ccc/recovered.edits/0000000000000000002-wal.dat.0.temp (wrote 10 edits, skipped 0 edits in 25 ms) at 1591291866137\nClosed recovered edits writer path=hdfs://localhost:64541/user/vjasani/test-data/9cad028f-1b56-2eeb-fec5-c83773b30f41/data/default/t1/bbb/recovered.edits/0000000000000000001-wal.dat.0.temp (wrote 10 edits, skipped 0 edits in 25 ms) at 1591291866137\nRename recovered edits hdfs://localhost:64541/user/vjasani/test-data/9cad028f-1b56-2eeb-fec5-c83773b30f41/data/default/t1/ccc/recovered.edits/0000000000000000002-wal.dat.0.temp to hdfs://localhost:64541/user/vjasani/test-data/9cad028f-1b56-2eeb-fec5-c83773b30f41/data/default/t1/ccc/recovered.edits/0000000000000000020 at 1591291866139\nRename recovered edits hdfs://localhost:64541/user/vjasani/test-data/9cad028f-1b56-2eeb-fec5-c83773b30f41/data/default/t1/bbb/recovered.edits/0000000000000000001-wal.dat.0.temp to hdfs://localhost:64541/user/vjasani/test-data/9cad028f-1b56-2eeb-fec5-c83773b30f41/data/default/t1/bbb/recovered.edits/0000000000000000019 at 1591291866139\nProcessed 20 edits across 2 regions cost 354 ms; edits skipped=7; WAL=hdfs://localhost:64541/user/vjasani/test-data/9cad028f-1b56-2eeb-fec5-c83773b30f41/WALs/testsplitlogfilemultipleregions,16010,1591291865558/wal.dat.0, size=2.3 K, length=2322, corrupted=false, progress failed=false at 1591291866139", "createdAt": "2020-06-05T18:14:09Z", "url": "https://github.com/apache/hbase/pull/1860", "merged": true, "mergeCommit": {"oid": "3c319811799cb4c1f51fb5b43dd4743acd28052c"}, "closed": true, "closedAt": "2020-06-19T23:25:03Z", "author": {"login": "virajjasani"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoWvMpgH2gAyNDI4NjM5MDUyOjhjNmY2ZmE1ZjJhNmVlMzVlODgyYThkMTIwNmQwM2VmMWMxMzIwZTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcr57htAH2gAyNDI4NjM5MDUyOjczYzY3ZTcwYzZjMDhjNDIwNTAyYzUwNTQ0NWFjNzI1MDM3MGJmOWQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8c6f6fa5f2a6ee35e882a8d1206d03ef1c1320e8", "author": {"user": {"login": "virajjasani", "name": "Viraj Jasani"}}, "url": "https://github.com/apache/hbase/commit/8c6f6fa5f2a6ee35e882a8d1206d03ef1c1320e8", "committedDate": "2020-06-05T18:12:31Z", "message": "HBASE-24380 : Provide WAL splitting journal logging"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5MTE5NTI4", "url": "https://github.com/apache/hbase/pull/1860#pullrequestreview-429119528", "createdAt": "2020-06-11T17:14:11Z", "commit": {"oid": "8c6f6fa5f2a6ee35e882a8d1206d03ef1c1320e8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNzoxNDoxMVrOGim8xQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNzoxNzowNFrOGinCuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk0MjkxNw==", "bodyText": "Same", "url": "https://github.com/apache/hbase/pull/1860#discussion_r438942917", "createdAt": "2020-06-11T17:14:11Z", "author": {"login": "apurtell"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/wal/OutputSink.java", "diffHunk": "@@ -129,10 +138,13 @@ long getTotalSkippedEdits() {\n \n   /**\n    * @param buffer A buffer of some number of edits for a given region.\n+   * @param status MonitoredTask instance to capture WAL splitting\n+   * @throws IOException For any IO errors\n    */\n-  abstract void append(EntryBuffers.RegionEntryBuffer buffer) throws IOException;\n+  abstract void append(EntryBuffers.RegionEntryBuffer buffer, MonitoredTask status)\n+    throws IOException;\n \n-  abstract List<Path> close() throws IOException;\n+  abstract List<Path> close(MonitoredTask status) throws IOException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c6f6fa5f2a6ee35e882a8d1206d03ef1c1320e8"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk0MzI0Nw==", "bodyText": "Same", "url": "https://github.com/apache/hbase/pull/1860#discussion_r438943247", "createdAt": "2020-06-11T17:14:52Z", "author": {"login": "apurtell"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/wal/RecoveredEditsOutputSink.java", "diffHunk": "@@ -52,15 +53,16 @@ public RecoveredEditsOutputSink(WALSplitter walSplitter,\n   }\n \n   @Override\n-  public void append(EntryBuffers.RegionEntryBuffer buffer) throws IOException {\n+  public void append(EntryBuffers.RegionEntryBuffer buffer, MonitoredTask status)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c6f6fa5f2a6ee35e882a8d1206d03ef1c1320e8"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk0MzQyMg==", "bodyText": "Same", "url": "https://github.com/apache/hbase/pull/1860#discussion_r438943422", "createdAt": "2020-06-11T17:15:09Z", "author": {"login": "apurtell"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/wal/RecoveredEditsOutputSink.java", "diffHunk": "@@ -86,26 +88,27 @@ private RecoveredEditsWriter getRecoveredEditsWriter(TableName tableName, byte[]\n   }\n \n   @Override\n-  public List<Path> close() throws IOException {\n+  public List<Path> close(MonitoredTask status) throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c6f6fa5f2a6ee35e882a8d1206d03ef1c1320e8"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk0MzUxNQ==", "bodyText": "Same", "url": "https://github.com/apache/hbase/pull/1860#discussion_r438943515", "createdAt": "2020-06-11T17:15:18Z", "author": {"login": "apurtell"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/wal/RecoveredEditsOutputSink.java", "diffHunk": "@@ -86,26 +88,27 @@ private RecoveredEditsWriter getRecoveredEditsWriter(TableName tableName, byte[]\n   }\n \n   @Override\n-  public List<Path> close() throws IOException {\n+  public List<Path> close(MonitoredTask status) throws IOException {\n     boolean isSuccessful = true;\n     try {\n-      isSuccessful &= finishWriterThreads();\n+      isSuccessful = finishWriterThreads();\n     } finally {\n-      isSuccessful &= closeWriters();\n+      isSuccessful &= closeWriters(status);\n     }\n     return isSuccessful ? splits : null;\n   }\n \n   /**\n    * Close all of the output streams.\n    *\n+   * @param status MonitoredTask instance to capture WAL splitting\n    * @return true when there is no error.\n    */\n-  private boolean closeWriters() throws IOException {\n+  private boolean closeWriters(MonitoredTask status) throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c6f6fa5f2a6ee35e882a8d1206d03ef1c1320e8"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk0NDM2Mw==", "bodyText": "Does this context have access to the OutputSink's MonitoredTask field? Can we do that instead, so we don't have to change these method signatures?", "url": "https://github.com/apache/hbase/pull/1860#discussion_r438944363", "createdAt": "2020-06-11T17:16:55Z", "author": {"login": "apurtell"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/wal/BoundedRecoveredEditsOutputSink.java", "diffHunk": "@@ -83,25 +85,26 @@ public void append(EntryBuffers.RegionEntryBuffer buffer) throws IOException {\n   }\n \n   @Override\n-  public List<Path> close() throws IOException {\n+  public List<Path> close(MonitoredTask status) throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c6f6fa5f2a6ee35e882a8d1206d03ef1c1320e8"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk0NDQ0MQ==", "bodyText": "Does this context have access to the OutputSink's MonitoredTask field? Can we do that instead, so we don't have to change these method signatures?", "url": "https://github.com/apache/hbase/pull/1860#discussion_r438944441", "createdAt": "2020-06-11T17:17:04Z", "author": {"login": "apurtell"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/wal/BoundedRecoveredEditsOutputSink.java", "diffHunk": "@@ -57,7 +58,8 @@ public BoundedRecoveredEditsOutputSink(WALSplitter walSplitter,\n   }\n \n   @Override\n-  public void append(EntryBuffers.RegionEntryBuffer buffer) throws IOException {\n+  public void append(EntryBuffers.RegionEntryBuffer buffer, MonitoredTask status)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c6f6fa5f2a6ee35e882a8d1206d03ef1c1320e8"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1bc4ca8f92be0c4098789b130e6e1d822eab0fe6", "author": {"user": {"login": "virajjasani", "name": "Viraj Jasani"}}, "url": "https://github.com/apache/hbase/commit/1bc4ca8f92be0c4098789b130e6e1d822eab0fe6", "committedDate": "2020-06-11T18:10:33Z", "message": "addressing review - use protected MonitorTask"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e17311ca80976e3a2484c555a416bb699e49067e", "author": {"user": {"login": "virajjasani", "name": "Viraj Jasani"}}, "url": "https://github.com/apache/hbase/commit/e17311ca80976e3a2484c555a416bb699e49067e", "committedDate": "2020-06-11T18:32:13Z", "message": "adding error msgs where possible"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3d2ea2b416eb5dda8f50679ee37d73d45083297", "author": {"user": {"login": "virajjasani", "name": "Viraj Jasani"}}, "url": "https://github.com/apache/hbase/commit/b3d2ea2b416eb5dda8f50679ee37d73d45083297", "committedDate": "2020-06-12T10:38:23Z", "message": "add more status updates"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNjk3Njk0", "url": "https://github.com/apache/hbase/pull/1860#pullrequestreview-431697694", "createdAt": "2020-06-16T16:41:26Z", "commit": {"oid": "b3d2ea2b416eb5dda8f50679ee37d73d45083297"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNjo0MToyNlrOGkkF6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNjo0MTo0MlrOGkkGjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk5MzI1Ng==", "bodyText": "Will take care of removal of this import.", "url": "https://github.com/apache/hbase/pull/1860#discussion_r440993256", "createdAt": "2020-06-16T16:41:26Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/wal/BoundedRecoveredEditsOutputSink.java", "diffHunk": "@@ -29,6 +29,7 @@\n import java.util.concurrent.atomic.AtomicInteger;\n \n import org.apache.hadoop.fs.Path;\n+import org.apache.hadoop.hbase.monitoring.MonitoredTask;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3d2ea2b416eb5dda8f50679ee37d73d45083297"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk5MzQyMg==", "bodyText": "same here", "url": "https://github.com/apache/hbase/pull/1860#discussion_r440993422", "createdAt": "2020-06-16T16:41:42Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/wal/BoundedRecoveredHFilesOutputSink.java", "diffHunk": "@@ -41,6 +41,7 @@\n import org.apache.hadoop.hbase.io.hfile.CacheConfig;\n import org.apache.hadoop.hbase.io.hfile.HFileContext;\n import org.apache.hadoop.hbase.io.hfile.HFileContextBuilder;\n+import org.apache.hadoop.hbase.monitoring.MonitoredTask;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3d2ea2b416eb5dda8f50679ee37d73d45083297"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNzMxNjY1", "url": "https://github.com/apache/hbase/pull/1860#pullrequestreview-431731665", "createdAt": "2020-06-16T17:24:58Z", "commit": {"oid": "b3d2ea2b416eb5dda8f50679ee37d73d45083297"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzoyNDo1OFrOGklrlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzoyNDo1OFrOGklrlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAxOTI4Nw==", "bodyText": "Missing null check here?", "url": "https://github.com/apache/hbase/pull/1860#discussion_r441019287", "createdAt": "2020-06-16T17:24:58Z", "author": {"login": "apurtell"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/wal/AbstractRecoveredEditsOutputSink.java", "diffHunk": "@@ -233,7 +251,10 @@ void writeRegionEntries(List<WAL.Entry> entries) throws IOException {\n         incrementNanoTime(System.nanoTime() - startTime);\n       } catch (IOException e) {\n         e = e instanceof RemoteException ? ((RemoteException) e).unwrapRemoteException() : e;\n-        LOG.error(HBaseMarkers.FATAL, \"Got while writing log entry to log\", e);\n+        final String errorMsg =\n+          \"Failed to write log entry \" + currentWalEntry.toString() + \" to log\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3d2ea2b416eb5dda8f50679ee37d73d45083297"}, "originalPosition": 105}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6bd43928db902c228b27bbb46b37d25ab727646d", "author": {"user": {"login": "virajjasani", "name": "Viraj Jasani"}}, "url": "https://github.com/apache/hbase/commit/6bd43928db902c228b27bbb46b37d25ab727646d", "committedDate": "2020-06-16T18:50:28Z", "message": "handle IOException for writer.append()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73c67e70c6c08c420502c505445ac7250370bf9d", "author": {"user": {"login": "virajjasani", "name": "Viraj Jasani"}}, "url": "https://github.com/apache/hbase/commit/73c67e70c6c08c420502c505445ac7250370bf9d", "committedDate": "2020-06-16T18:54:26Z", "message": "redundant import"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4545, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}