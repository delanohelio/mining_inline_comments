{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc1NzMxNDYz", "number": 2326, "title": "HBASE-24967 The table.jsp cost long time to load if the table include\u2026", "bodyText": "\u2026 closed regions", "createdAt": "2020-08-29T06:36:31Z", "url": "https://github.com/apache/hbase/pull/2326", "merged": true, "mergeCommit": {"oid": "5d926627ae7692bb46e4febaf04a14f2fdd30a30"}, "closed": true, "closedAt": "2020-09-29T07:36:04Z", "author": {"login": "bsglz"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFZ0sFAFqTQ4MjI3OTM3OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNjDk1AFqTQ5ODE2ODA2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyMjc5Mzc4", "url": "https://github.com/apache/hbase/pull/2326#pullrequestreview-482279378", "createdAt": "2020-09-04T00:12:01Z", "commit": {"oid": "9ddf0f116baf3482d4e76c6d7f2436dcd36a6cfd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwMDoxMjowMVrOHM7Vvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwMDoxMjowMVrOHM7Vvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMxNzE4Mw==", "bodyText": "1 sec is too short? And another way is: get the compaction state from master's memory and avoid rpc call.", "url": "https://github.com/apache/hbase/pull/2326#discussion_r483317183", "createdAt": "2020-09-04T00:12:01Z", "author": {"login": "infraio"}, "path": "hbase-server/src/main/resources/hbase-webapps/master/table.jsp", "diffHunk": "@@ -655,12 +656,14 @@\n <%\n   if (master.getAssignmentManager().isTableEnabled(table.getName())) {\n     try {\n-      CompactionState compactionState = admin.getCompactionState(table.getName()).get();\n+      CompactionState compactionState = admin.getCompactionState(table.getName()).get(1, TimeUnit.SECONDS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ddf0f116baf3482d4e76c6d7f2436dcd36a6cfd"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a56e77a3507bbf880dd15134750116c6edce25f4", "author": {"user": {"login": "bsglz", "name": null}}, "url": "https://github.com/apache/hbase/commit/a56e77a3507bbf880dd15134750116c6edce25f4", "committedDate": "2020-09-05T08:41:53Z", "message": "HBASE-24967 The table.jsp cost long time to load if the table include closed regions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dcf271f6645f1ea905797aa4d555df85187a6260", "author": {"user": {"login": "bsglz", "name": null}}, "url": "https://github.com/apache/hbase/commit/dcf271f6645f1ea905797aa4d555df85187a6260", "committedDate": "2020-09-06T04:29:53Z", "message": "fix it  by another way"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9ddf0f116baf3482d4e76c6d7f2436dcd36a6cfd", "author": {"user": {"login": "bsglz", "name": null}}, "url": "https://github.com/apache/hbase/commit/9ddf0f116baf3482d4e76c6d7f2436dcd36a6cfd", "committedDate": "2020-08-29T06:31:57Z", "message": "HBASE-24967 The table.jsp cost long time to load if the table include closed regions"}, "afterCommit": {"oid": "dcf271f6645f1ea905797aa4d555df85187a6260", "author": {"user": {"login": "bsglz", "name": null}}, "url": "https://github.com/apache/hbase/commit/dcf271f6645f1ea905797aa4d555df85187a6260", "committedDate": "2020-09-06T04:29:53Z", "message": "fix it  by another way"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyNTYxMDYx", "url": "https://github.com/apache/hbase/pull/2326#pullrequestreview-492561061", "createdAt": "2020-09-21T12:43:12Z", "commit": {"oid": "dcf271f6645f1ea905797aa4d555df85187a6260"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMjo0MzoxMlrOHVOH3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMjo0NTozNVrOHVOOWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAxMzUzMg==", "bodyText": "Debug log?", "url": "https://github.com/apache/hbase/pull/2326#discussion_r492013532", "createdAt": "2020-09-21T12:43:12Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java", "diffHunk": "@@ -1741,9 +1741,10 @@ RegionLoad createRegionLoad(final HRegion r, RegionLoad.Builder regionLoadBldr,\n       .setBlocksLocalWeight(blocksLocalWeight)\n       .setBlocksLocalWithSsdWeight(blocksLocalWithSsdWeight)\n       .setBlocksTotalWeight(blocksTotalWeight)\n+      .setCompactionState(ProtobufUtil.createCompactionStateForRegionLoad(r.getCompactionState()))\n       .setLastMajorCompactionTs(r.getOldestHfileTs(true));\n     r.setCompleteSequenceId(regionLoadBldr);\n-\n+    LOG.info(\">>>>>>setCompactionState:{}\",r.getCompactionState());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dcf271f6645f1ea905797aa4d555df85187a6260"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAxMzg5Mg==", "bodyText": "Why full class name here?", "url": "https://github.com/apache/hbase/pull/2326#discussion_r492013892", "createdAt": "2020-09-21T12:43:36Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java", "diffHunk": "@@ -3907,4 +3909,51 @@ public MetaRegionLocationCache getMetaRegionLocationCache() {\n   public RSGroupInfoManager getRSGroupInfoManager() {\n     return rsGroupInfoManager;\n   }\n+\n+  /**\n+   * Get the compaction state of the table\n+   *\n+   * @param tableName The table name\n+   * @return CompactionState Compaction state of the table\n+   */\n+  public org.apache.hadoop.hbase.client.CompactionState getCompactionState(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dcf271f6645f1ea905797aa4d555df85187a6260"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAxNDM3MA==", "bodyText": "New line here?", "url": "https://github.com/apache/hbase/pull/2326#discussion_r492014370", "createdAt": "2020-09-21T12:44:13Z", "author": {"login": "Apache9"}, "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/RegionMetricsBuilder.java", "diffHunk": "@@ -263,6 +268,10 @@ public RegionMetricsBuilder setBlocksTotalWeight(long value) {\n     this.blocksTotalWeight = value;\n     return this;\n   }\n+  public RegionMetricsBuilder setCompactionState(CompactionState compactionState) {\n+    this.compactionState = compactionState;\n+    return this;\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dcf271f6645f1ea905797aa4d555df85187a6260"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAxNTE5Mg==", "bodyText": "I think this test is for testing the HBaseAdmin.getCompactionState so we should not change to use master?", "url": "https://github.com/apache/hbase/pull/2326#discussion_r492015192", "createdAt": "2020-09-21T12:45:35Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestCompactionState.java", "diffHunk": "@@ -164,10 +166,10 @@ private void compaction(final String tableName, final int flushes,\n       long curt = System.currentTimeMillis();\n       long waitTime = 5000;\n       long endt = curt + waitTime;\n-      CompactionState state = admin.getCompactionState(table);\n+      CompactionState state = master.getCompactionState(table);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dcf271f6645f1ea905797aa4d555df85187a6260"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6364049f112d4bcadac2837fab0b3203f7453f14", "author": {"user": {"login": "bsglz", "name": null}}, "url": "https://github.com/apache/hbase/commit/6364049f112d4bcadac2837fab0b3203f7453f14", "committedDate": "2020-09-22T06:41:02Z", "message": "fix review issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2102697571a1c733aa3e4c5d04940eae75c73a92", "author": {"user": {"login": "bsglz", "name": null}}, "url": "https://github.com/apache/hbase/commit/2102697571a1c733aa3e4c5d04940eae75c73a92", "committedDate": "2020-09-22T08:29:55Z", "message": "fix checkstyle warnings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed3e8ce403dd5a8f8abc89c32dbf6e0b4a674a25", "author": {"user": {"login": "bsglz", "name": null}}, "url": "https://github.com/apache/hbase/commit/ed3e8ce403dd5a8f8abc89c32dbf6e0b4a674a25", "committedDate": "2020-09-22T09:02:19Z", "message": "fix checkstyle warning"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MTY4MDY3", "url": "https://github.com/apache/hbase/pull/2326#pullrequestreview-498168067", "createdAt": "2020-09-29T07:28:50Z", "commit": {"oid": "ed3e8ce403dd5a8f8abc89c32dbf6e0b4a674a25"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4710, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}