{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwMTI0MDQ2", "number": 1738, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwMjo1NDozNVrOD-Co3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwMjo1NDozNVrOD-Co3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MzgxNTMyOnYy", "diffSide": "LEFT", "path": "hbase-rsgroup/src/test/java/org/apache/hadoop/hbase/rsgroup/TestRSGroupUtil.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwMjo1NDozNVrOGX5iwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwMzoxNDozOFrOGX51Cg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcxMzIxOA==", "bodyText": "Why this removed?", "url": "https://github.com/apache/hbase/pull/1738#discussion_r427713218", "createdAt": "2020-05-20T02:54:35Z", "author": {"login": "infraio"}, "path": "hbase-rsgroup/src/test/java/org/apache/hadoop/hbase/rsgroup/TestRSGroupUtil.java", "diffHunk": "@@ -57,39 +68,40 @@ public static void setUp() throws Exception {\n       RSGroupAdminEndpoint.class.getName());\n     UTIL.startMiniCluster(5);\n     master = UTIL.getMiniHBaseCluster().getMaster();\n-    admin = UTIL.getAdmin();\n-    rsGroupAdminClient = new RSGroupAdminClient(UTIL.getConnection());\n \n-    HRegionServer rs = UTIL.getHBaseCluster().getRegionServer(0);\n-    rsGroupAdminClient.addRSGroup(GROUP_NAME);\n-    rsGroupAdminClient.moveServers(Collections.singleton(rs.getServerName().getAddress()), GROUP_NAME);\n-    admin.createNamespace(NamespaceDescriptor.create(NAMESPACE_NAME)\n-      .addConfiguration(RSGroupInfo.NAMESPACE_DESC_PROP_GROUP, GROUP_NAME)\n-      .build());\n+    UTIL.waitFor(60000, (Predicate<Exception>) () ->\n+        master.isInitialized() && ((RSGroupBasedLoadBalancer) master.getLoadBalancer()).isOnline());\n \n-    rsGroupInfoManager = RSGroupInfoManagerImpl.getInstance(master);\n-    rsGroupInfoManager.start();\n+    rsGroupAdminClient = new RSGroupAdminClient(UTIL.getConnection());\n+\n+    List<RSGroupAdminEndpoint> cps =\n+        master.getMasterCoprocessorHost().findCoprocessors(RSGroupAdminEndpoint.class);\n+    assertTrue(cps.size() > 0);\n+    rsGroupInfoManager = cps.get(0).getGroupInfoManager();\n   }\n \n   @AfterClass\n-  public static void tearDown() throws IOException {\n-    admin.deleteNamespace(NAMESPACE_NAME);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5aeefbedb315185211f73d8433c827c1d6ae3567"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcxNzg5OA==", "bodyText": "namespace creation is redundant in this UT, so I removed the code related namespace", "url": "https://github.com/apache/hbase/pull/1738#discussion_r427717898", "createdAt": "2020-05-20T03:14:38Z", "author": {"login": "ddupg"}, "path": "hbase-rsgroup/src/test/java/org/apache/hadoop/hbase/rsgroup/TestRSGroupUtil.java", "diffHunk": "@@ -57,39 +68,40 @@ public static void setUp() throws Exception {\n       RSGroupAdminEndpoint.class.getName());\n     UTIL.startMiniCluster(5);\n     master = UTIL.getMiniHBaseCluster().getMaster();\n-    admin = UTIL.getAdmin();\n-    rsGroupAdminClient = new RSGroupAdminClient(UTIL.getConnection());\n \n-    HRegionServer rs = UTIL.getHBaseCluster().getRegionServer(0);\n-    rsGroupAdminClient.addRSGroup(GROUP_NAME);\n-    rsGroupAdminClient.moveServers(Collections.singleton(rs.getServerName().getAddress()), GROUP_NAME);\n-    admin.createNamespace(NamespaceDescriptor.create(NAMESPACE_NAME)\n-      .addConfiguration(RSGroupInfo.NAMESPACE_DESC_PROP_GROUP, GROUP_NAME)\n-      .build());\n+    UTIL.waitFor(60000, (Predicate<Exception>) () ->\n+        master.isInitialized() && ((RSGroupBasedLoadBalancer) master.getLoadBalancer()).isOnline());\n \n-    rsGroupInfoManager = RSGroupInfoManagerImpl.getInstance(master);\n-    rsGroupInfoManager.start();\n+    rsGroupAdminClient = new RSGroupAdminClient(UTIL.getConnection());\n+\n+    List<RSGroupAdminEndpoint> cps =\n+        master.getMasterCoprocessorHost().findCoprocessors(RSGroupAdminEndpoint.class);\n+    assertTrue(cps.size() > 0);\n+    rsGroupInfoManager = cps.get(0).getGroupInfoManager();\n   }\n \n   @AfterClass\n-  public static void tearDown() throws IOException {\n-    admin.deleteNamespace(NAMESPACE_NAME);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcxMzIxOA=="}, "originalCommit": {"oid": "5aeefbedb315185211f73d8433c827c1d6ae3567"}, "originalPosition": 82}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3004, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}