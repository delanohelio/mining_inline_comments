{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyMzIyNjg3", "number": 2452, "title": "HBASE-25071 ReplicationServer support start ReplicationSource internal", "bodyText": "", "createdAt": "2020-09-24T09:46:12Z", "url": "https://github.com/apache/hbase/pull/2452", "merged": true, "mergeCommit": {"oid": "36407759d67d67a089625c63cb3c3c81b624fe85"}, "closed": true, "closedAt": "2020-11-09T03:46:03Z", "author": {"login": "infraio"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdL-aoIABqjM4MDI0NTg1MDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZxr6JgBqjM5NjU4NjY3MzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "94ebb298516ebcdf0a44f4d3c765fa5fc403e838", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/94ebb298516ebcdf0a44f4d3c765fa5fc403e838", "committedDate": "2020-09-24T09:45:16Z", "message": "HBASE-25071 ReplicationServer support start ReplicationSource internal"}, "afterCommit": {"oid": "da592f5c7d909f8ed6b21234e5e9e4578ae550ac", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/da592f5c7d909f8ed6b21234e5e9e4578ae550ac", "committedDate": "2020-09-24T10:12:56Z", "message": "HBASE-25071 ReplicationServer support start ReplicationSource internal"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "da592f5c7d909f8ed6b21234e5e9e4578ae550ac", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/da592f5c7d909f8ed6b21234e5e9e4578ae550ac", "committedDate": "2020-09-24T10:12:56Z", "message": "HBASE-25071 ReplicationServer support start ReplicationSource internal"}, "afterCommit": {"oid": "1edb685b2a17ca8a6d5094d7d85b9642b15927c8", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/1edb685b2a17ca8a6d5094d7d85b9642b15927c8", "committedDate": "2020-09-24T10:15:47Z", "message": "HBASE-25071 ReplicationServer support start ReplicationSource internal"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1edb685b2a17ca8a6d5094d7d85b9642b15927c8", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/1edb685b2a17ca8a6d5094d7d85b9642b15927c8", "committedDate": "2020-09-24T10:15:47Z", "message": "HBASE-25071 ReplicationServer support start ReplicationSource internal"}, "afterCommit": {"oid": "8e6639eb646a021de02a383f0bb48615c6cf32c4", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/8e6639eb646a021de02a383f0bb48615c6cf32c4", "committedDate": "2020-09-24T10:18:17Z", "message": "HBASE-25071 ReplicationServer support start ReplicationSource internal"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NzkxNDQ3", "url": "https://github.com/apache/hbase/pull/2452#pullrequestreview-495791447", "createdAt": "2020-09-24T17:23:02Z", "commit": {"oid": "8e6639eb646a021de02a383f0bb48615c6cf32c4"}, "state": "COMMENTED", "comments": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNzoyMzowMlrOHXlEMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNzo0MTowMVrOHXlt3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ4NjU3Ng==", "bodyText": "Is this right name for the attribute? The method name for a boolean should be isATTRIBUTE but the ATTRIBUTE itself should not have the 'is' prefix.", "url": "https://github.com/apache/hbase/pull/2452#discussion_r494486576", "createdAt": "2020-09-24T17:23:02Z", "author": {"login": "saintstack"}, "path": "hbase-protocol-shaded/src/main/protobuf/server/master/Master.proto", "diffHunk": "@@ -721,7 +721,8 @@ message ListReplicationSinkServersRequest {\n }\n \n message ListReplicationSinkServersResponse {\n-  repeated ServerName server_name = 1;\n+  required bool is_replication_server = 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e6639eb646a021de02a383f0bb48615c6cf32c4"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ4NzAxNg==", "bodyText": "Oh, you can't change the protobuf index.... it breaks compatibility. Give the replication_server '2' and leave server_name as '1'.", "url": "https://github.com/apache/hbase/pull/2452#discussion_r494487016", "createdAt": "2020-09-24T17:23:48Z", "author": {"login": "saintstack"}, "path": "hbase-protocol-shaded/src/main/protobuf/server/master/Master.proto", "diffHunk": "@@ -721,7 +721,8 @@ message ListReplicationSinkServersRequest {\n }\n \n message ListReplicationSinkServersResponse {\n-  repeated ServerName server_name = 1;\n+  required bool is_replication_server = 1;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ4NjU3Ng=="}, "originalCommit": {"oid": "8e6639eb646a021de02a383f0bb48615c6cf32c4"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ4Nzk2MA==", "bodyText": "Does the replication server belong in the core? Should it be done outside in hbase-operator-tools? Just add the communication bits to core?", "url": "https://github.com/apache/hbase/pull/2452#discussion_r494487960", "createdAt": "2020-09-24T17:25:19Z", "author": {"login": "saintstack"}, "path": "hbase-protocol-shaded/src/main/protobuf/server/replication/ReplicationServer.proto", "diffHunk": "@@ -24,9 +24,21 @@ option java_generic_services = true;\n option java_generate_equals_and_hash = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e6639eb646a021de02a383f0bb48615c6cf32c4"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ4OTQ3MA==", "bodyText": "Yeah, boolean should be named replicationServer and the method to access this data member is named isReplicationServer.", "url": "https://github.com/apache/hbase/pull/2452#discussion_r494489470", "createdAt": "2020-09-24T17:27:58Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/replication/HBaseReplicationEndpoint.java", "diffHunk": "@@ -118,6 +118,7 @@\n   private boolean fetchServersUseZk = false;\n   private FetchServersChore fetchServersChore;\n   private int shortOperationTimeout;\n+  private boolean isReplicationServer = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e6639eb646a021de02a383f0bb48615c6cf32c4"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ5MDAwOA==", "bodyText": "Do you have to do hasReplicationServer first? And then read it if present? Or maybe this defaults false if not present?", "url": "https://github.com/apache/hbase/pull/2452#discussion_r494490008", "createdAt": "2020-09-24T17:28:54Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/replication/HBaseReplicationEndpoint.java", "diffHunk": "@@ -295,6 +296,7 @@ private synchronized AsyncClusterConnection getPeerConnection() throws IOExcepti\n           .createBlockingRpcChannel(master, User.getCurrent(), shortOperationTimeout));\n       ListReplicationSinkServersResponse resp = masterStub\n         .listReplicationSinkServers(null, ListReplicationSinkServersRequest.newBuilder().build());\n+      isReplicationServer = resp.getIsReplicationServer();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e6639eb646a021de02a383f0bb48615c6cf32c4"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ5MDUxMw==", "bodyText": "Looks like ReplicationServer already committed (why have the 'H' prefix?)", "url": "https://github.com/apache/hbase/pull/2452#discussion_r494490513", "createdAt": "2020-09-24T17:29:47Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/replication/HReplicationServer.java", "diffHunk": "@@ -50,7 +72,7 @@\n  */\n @InterfaceAudience.Private\n @SuppressWarnings({ \"deprecation\"})\n-public class HReplicationServer extends Thread implements Server {\n+public class HReplicationServer extends Thread implements Server, ReplicationSourceController  {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e6639eb646a021de02a383f0bb48615c6cf32c4"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ5MTM4MA==", "bodyText": "We have to do this? Just because we do it for HMaster and HRegionServer, it doesn't make it a good pattern. This is an Interface to pass instead of the impl?", "url": "https://github.com/apache/hbase/pull/2452#discussion_r494491380", "createdAt": "2020-09-24T17:31:10Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/replication/HReplicationServer.java", "diffHunk": "@@ -78,27 +104,44 @@\n    */\n   private ServerName serverName;\n \n-  protected final Configuration conf;\n+  private final Configuration conf;\n \n-  private ReplicationSinkService replicationSinkService;\n+  // zookeeper connection and watcher\n+  private final ZKWatcher zooKeeper;\n \n-  final int msgInterval;\n-  // A sleeper that sleeps for msgInterval.\n-  protected final Sleeper sleeper;\n+  private final UUID clusterId;\n \n-  // zookeeper connection and watcher\n-  protected final ZKWatcher zooKeeper;\n+  private HFileSystem walFs;\n+  private Path walRootDir;\n+\n+  /**\n+   * ChoreService used to schedule tasks that we want to run periodically\n+   */\n+  private ChoreService choreService;\n \n   /**\n    * The asynchronous cluster connection to be shared by services.\n    */\n-  protected AsyncClusterConnection asyncClusterConnection;\n+  private AsyncClusterConnection asyncClusterConnection;\n \n   private UserProvider userProvider;\n \n-  protected final ReplicationServerRpcServices rpcServices;\n+  private final ReplicationServerRpcServices rpcServices;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e6639eb646a021de02a383f0bb48615c6cf32c4"}, "originalPosition": 113}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ5MTU1NQ==", "bodyText": "Maybe it is to mock?", "url": "https://github.com/apache/hbase/pull/2452#discussion_r494491555", "createdAt": "2020-09-24T17:31:25Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/replication/HReplicationServer.java", "diffHunk": "@@ -78,27 +104,44 @@\n    */\n   private ServerName serverName;\n \n-  protected final Configuration conf;\n+  private final Configuration conf;\n \n-  private ReplicationSinkService replicationSinkService;\n+  // zookeeper connection and watcher\n+  private final ZKWatcher zooKeeper;\n \n-  final int msgInterval;\n-  // A sleeper that sleeps for msgInterval.\n-  protected final Sleeper sleeper;\n+  private final UUID clusterId;\n \n-  // zookeeper connection and watcher\n-  protected final ZKWatcher zooKeeper;\n+  private HFileSystem walFs;\n+  private Path walRootDir;\n+\n+  /**\n+   * ChoreService used to schedule tasks that we want to run periodically\n+   */\n+  private ChoreService choreService;\n \n   /**\n    * The asynchronous cluster connection to be shared by services.\n    */\n-  protected AsyncClusterConnection asyncClusterConnection;\n+  private AsyncClusterConnection asyncClusterConnection;\n \n   private UserProvider userProvider;\n \n-  protected final ReplicationServerRpcServices rpcServices;\n+  private final ReplicationServerRpcServices rpcServices;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ5MTM4MA=="}, "originalCommit": {"oid": "8e6639eb646a021de02a383f0bb48615c6cf32c4"}, "originalPosition": 113}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ5MjQ2MQ==", "bodyText": "Is this stuff normally inside a ReplicationSourceManager? Or maybe the Replication instance? Can you not use these instead?", "url": "https://github.com/apache/hbase/pull/2452#discussion_r494492461", "createdAt": "2020-09-24T17:32:58Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/replication/HReplicationServer.java", "diffHunk": "@@ -78,27 +104,44 @@\n    */\n   private ServerName serverName;\n \n-  protected final Configuration conf;\n+  private final Configuration conf;\n \n-  private ReplicationSinkService replicationSinkService;\n+  // zookeeper connection and watcher\n+  private final ZKWatcher zooKeeper;\n \n-  final int msgInterval;\n-  // A sleeper that sleeps for msgInterval.\n-  protected final Sleeper sleeper;\n+  private final UUID clusterId;\n \n-  // zookeeper connection and watcher\n-  protected final ZKWatcher zooKeeper;\n+  private HFileSystem walFs;\n+  private Path walRootDir;\n+\n+  /**\n+   * ChoreService used to schedule tasks that we want to run periodically\n+   */\n+  private ChoreService choreService;\n \n   /**\n    * The asynchronous cluster connection to be shared by services.\n    */\n-  protected AsyncClusterConnection asyncClusterConnection;\n+  private AsyncClusterConnection asyncClusterConnection;\n \n   private UserProvider userProvider;\n \n-  protected final ReplicationServerRpcServices rpcServices;\n+  private final ReplicationServerRpcServices rpcServices;\n+\n+  // Total buffer size on this RegionServer for holding batched edits to be shipped.\n+  private final long totalBufferLimit;\n+  private AtomicLong totalBufferUsed = new AtomicLong();\n+\n+  private final MetricsReplicationGlobalSourceSource globalMetrics;\n+  private final Map<String, MetricsSource> sourceMetrics = new HashMap<>();\n+  private final ConcurrentMap<String, ReplicationSourceInterface> sources = new ConcurrentHashMap<>();\n+\n+  private final ReplicationQueueStorage queueStorage;\n+  private final ReplicationPeers replicationPeers;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e6639eb646a021de02a383f0bb48615c6cf32c4"}, "originalPosition": 124}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ5MzM5MQ==", "bodyText": "Undo this change. Misspelling.", "url": "https://github.com/apache/hbase/pull/2452#discussion_r494493391", "createdAt": "2020-09-24T17:34:28Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/replication/HReplicationServer.java", "diffHunk": "@@ -226,13 +302,16 @@ protected final synchronized void setupClusterConnection() throws IOException {\n   }\n \n   /**\n-   * Wait on all threads to finish. Presumption is that all closes and stops\n+   * Wait on all threads to fnish. Presumption is that all closes and stops", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e6639eb646a021de02a383f0bb48615c6cf32c4"}, "originalPosition": 196}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ5NjE1OA==", "bodyText": "This is for the RecoveryReplicationSource only?", "url": "https://github.com/apache/hbase/pull/2452#discussion_r494496158", "createdAt": "2020-09-24T17:39:14Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceInterface.java", "diffHunk": "@@ -52,15 +52,17 @@\n    * @param queueStorage the replication queue storage\n    * @param replicationPeer the replication peer\n    * @param server the server which start and run this replication source\n+   * @param producer the name of region server which produce the replication queue", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e6639eb646a021de02a383f0bb48615c6cf32c4"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ5NjgxMw==", "bodyText": "There will be a time when the passed in 'server' differs from server.getServerName?", "url": "https://github.com/apache/hbase/pull/2452#discussion_r494496813", "createdAt": "2020-09-24T17:40:21Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java", "diffHunk": "@@ -360,8 +360,8 @@ private ReplicationSourceInterface createSource(String queueId, ReplicationPeer\n     MetricsSource metrics = new MetricsSource(queueId);\n     sourceMetrics.put(queueId, metrics);\n     // init replication source\n-    src.init(conf, fs, logDir, this, queueStorage, replicationPeer, server, queueId, clusterId,\n-      walFileLengthProvider, metrics);\n+    src.init(conf, fs, logDir, this, queueStorage, replicationPeer, server, server.getServerName(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e6639eb646a021de02a383f0bb48615c6cf32c4"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ5NzI0NQ==", "bodyText": "Perhaps say more about this?", "url": "https://github.com/apache/hbase/pull/2452#discussion_r494497245", "createdAt": "2020-09-24T17:41:01Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java", "diffHunk": "@@ -360,8 +360,8 @@ private ReplicationSourceInterface createSource(String queueId, ReplicationPeer\n     MetricsSource metrics = new MetricsSource(queueId);\n     sourceMetrics.put(queueId, metrics);\n     // init replication source\n-    src.init(conf, fs, logDir, this, queueStorage, replicationPeer, server, queueId, clusterId,\n-      walFileLengthProvider, metrics);\n+    src.init(conf, fs, logDir, this, queueStorage, replicationPeer, server, server.getServerName(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ5NjgxMw=="}, "originalCommit": {"oid": "8e6639eb646a021de02a383f0bb48615c6cf32c4"}, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8e6639eb646a021de02a383f0bb48615c6cf32c4", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/8e6639eb646a021de02a383f0bb48615c6cf32c4", "committedDate": "2020-09-24T10:18:17Z", "message": "HBASE-25071 ReplicationServer support start ReplicationSource internal"}, "afterCommit": {"oid": "b7e51db3fb90a58fc82548be96f87f7bff67077f", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/b7e51db3fb90a58fc82548be96f87f7bff67077f", "committedDate": "2020-09-25T01:12:11Z", "message": "HBASE-25071 ReplicationServer support start ReplicationSource internal"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b7e51db3fb90a58fc82548be96f87f7bff67077f", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/b7e51db3fb90a58fc82548be96f87f7bff67077f", "committedDate": "2020-09-25T01:12:11Z", "message": "HBASE-25071 ReplicationServer support start ReplicationSource internal"}, "afterCommit": {"oid": "425ffb4ff4d462b9e935a03cc04538f96d86fa52", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/425ffb4ff4d462b9e935a03cc04538f96d86fa52", "committedDate": "2020-09-25T02:37:56Z", "message": "HBASE-25071 ReplicationServer support start ReplicationSource internal"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "425ffb4ff4d462b9e935a03cc04538f96d86fa52", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/425ffb4ff4d462b9e935a03cc04538f96d86fa52", "committedDate": "2020-09-25T02:37:56Z", "message": "HBASE-25071 ReplicationServer support start ReplicationSource internal"}, "afterCommit": {"oid": "bb46ef90898a7d3bc9967d73eb11b3d170103701", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/bb46ef90898a7d3bc9967d73eb11b3d170103701", "committedDate": "2020-09-25T08:22:40Z", "message": "HBASE-25071 ReplicationServer support start ReplicationSource internal"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bb46ef90898a7d3bc9967d73eb11b3d170103701", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/bb46ef90898a7d3bc9967d73eb11b3d170103701", "committedDate": "2020-09-25T08:22:40Z", "message": "HBASE-25071 ReplicationServer support start ReplicationSource internal"}, "afterCommit": {"oid": "5a39f53bdba58765c5f0dc9fbbbfc2b646967fc2", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/5a39f53bdba58765c5f0dc9fbbbfc2b646967fc2", "committedDate": "2020-11-02T06:39:13Z", "message": "HBASE-25071 ReplicationServer support start ReplicationSource internal"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5a39f53bdba58765c5f0dc9fbbbfc2b646967fc2", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/5a39f53bdba58765c5f0dc9fbbbfc2b646967fc2", "committedDate": "2020-11-02T06:39:13Z", "message": "HBASE-25071 ReplicationServer support start ReplicationSource internal"}, "afterCommit": {"oid": "8a063c37cbd81f96c3480c49a0edbbf53fb44748", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/8a063c37cbd81f96c3480c49a0edbbf53fb44748", "committedDate": "2020-11-02T10:33:58Z", "message": "HBASE-25071 ReplicationServer support start ReplicationSource internal"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8a063c37cbd81f96c3480c49a0edbbf53fb44748", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/8a063c37cbd81f96c3480c49a0edbbf53fb44748", "committedDate": "2020-11-02T10:33:58Z", "message": "HBASE-25071 ReplicationServer support start ReplicationSource internal"}, "afterCommit": {"oid": "108dddd3fe824141b681f015e549e7794328e1a1", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/108dddd3fe824141b681f015e549e7794328e1a1", "committedDate": "2020-11-02T11:11:54Z", "message": "HBASE-25071 ReplicationServer support start ReplicationSource internal"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "108dddd3fe824141b681f015e549e7794328e1a1", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/108dddd3fe824141b681f015e549e7794328e1a1", "committedDate": "2020-11-02T11:11:54Z", "message": "HBASE-25071 ReplicationServer support start ReplicationSource internal"}, "afterCommit": {"oid": "97f0c23953dc942d53e4de9d5110c50559c61080", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/97f0c23953dc942d53e4de9d5110c50559c61080", "committedDate": "2020-11-04T02:23:14Z", "message": "HBASE-25071 ReplicationServer support start ReplicationSource internal"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "97f0c23953dc942d53e4de9d5110c50559c61080", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/97f0c23953dc942d53e4de9d5110c50559c61080", "committedDate": "2020-11-04T02:23:14Z", "message": "HBASE-25071 ReplicationServer support start ReplicationSource internal"}, "afterCommit": {"oid": "7d4b04119169b6f4a2beb619fe27951100850baa", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/7d4b04119169b6f4a2beb619fe27951100850baa", "committedDate": "2020-11-04T06:16:42Z", "message": "HBASE-25071 ReplicationServer support start ReplicationSource internal"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzMTI1NTA5", "url": "https://github.com/apache/hbase/pull/2452#pullrequestreview-523125509", "createdAt": "2020-11-04T08:17:07Z", "commit": {"oid": "7d4b04119169b6f4a2beb619fe27951100850baa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwODoxNzowOFrOHtNK3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwODoxNzowOFrOHtNK3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE2Mzc0MQ==", "bodyText": "interrrupt the fetchWALsThread when the ReplicationServer exits or when the peer terminates?", "url": "https://github.com/apache/hbase/pull/2452#discussion_r517163741", "createdAt": "2020-11-04T08:17:08Z", "author": {"login": "ddupg"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java", "diffHunk": "@@ -224,6 +226,35 @@ public void init(Configuration conf, FileSystem fs, Path walDir,\n     this.abortOnError = this.conf.getBoolean(\"replication.source.regionserver.abort\",\n       true);\n \n+    if (conf.getBoolean(HConstants.REPLICATION_OFFLOAD_ENABLE_KEY,\n+      HConstants.REPLICATION_OFFLOAD_ENABLE_DEFAULT)) {\n+      fetchWALsThread = new Thread(() -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d4b04119169b6f4a2beb619fe27951100850baa"}, "originalPosition": 26}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7d4b04119169b6f4a2beb619fe27951100850baa", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/7d4b04119169b6f4a2beb619fe27951100850baa", "committedDate": "2020-11-04T06:16:42Z", "message": "HBASE-25071 ReplicationServer support start ReplicationSource internal"}, "afterCommit": {"oid": "a28ec449c181477d11df405d7ec4e30e63c42228", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/a28ec449c181477d11df405d7ec4e30e63c42228", "committedDate": "2020-11-05T07:16:23Z", "message": "HBASE-25071 ReplicationServer support start ReplicationSource internal"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzOTkxMjc3", "url": "https://github.com/apache/hbase/pull/2452#pullrequestreview-523991277", "createdAt": "2020-11-05T07:42:45Z", "commit": {"oid": "a28ec449c181477d11df405d7ec4e30e63c42228"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8537ef2b49c8c7e592fff0d1f4e3ec449a9fd89", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/c8537ef2b49c8c7e592fff0d1f4e3ec449a9fd89", "committedDate": "2020-11-06T07:17:50Z", "message": "HBASE-25071 ReplicationServer support start ReplicationSource internal"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a28ec449c181477d11df405d7ec4e30e63c42228", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/a28ec449c181477d11df405d7ec4e30e63c42228", "committedDate": "2020-11-05T07:16:23Z", "message": "HBASE-25071 ReplicationServer support start ReplicationSource internal"}, "afterCommit": {"oid": "c8537ef2b49c8c7e592fff0d1f4e3ec449a9fd89", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/c8537ef2b49c8c7e592fff0d1f4e3ec449a9fd89", "committedDate": "2020-11-06T07:17:50Z", "message": "HBASE-25071 ReplicationServer support start ReplicationSource internal"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4581, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}