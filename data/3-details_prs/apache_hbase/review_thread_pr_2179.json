{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU5ODUzMDA3", "number": 2179, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwOToyNzo0MlrOET_fiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMzo0MjowN1rOEVay7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5Mzk4NjY3OnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/procedure/flush/FlushTableSubprocedure.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwOToyNzo0MlrOG6CHMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMVQwNjowNTo1N1rOG6b7Xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzUwNTIwMQ==", "bodyText": "Nit: It's better to be more specific when debugging: \"About to flush family {} on all regions for table {}\"", "url": "https://github.com/apache/hbase/pull/2179#discussion_r463505201", "createdAt": "2020-07-31T09:27:42Z", "author": {"login": "wchevreuil"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/procedure/flush/FlushTableSubprocedure.java", "diffHunk": "@@ -88,11 +95,15 @@ private void flushRegions() throws ForeignException {\n       throw new IllegalStateException(\"Attempting to flush \"\n           + table + \" but we currently have outstanding tasks\");\n     }\n-\n+    List<byte[]> families = null;\n+    if (family != null) {\n+      LOG.debug(\"Flush regions with specified family:{}\", family);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a1b0aca673c49d1cf5b91fa9881d8c412598220"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzkyODE1OA==", "bodyText": "Will fix, thanks.", "url": "https://github.com/apache/hbase/pull/2179#discussion_r463928158", "createdAt": "2020-08-01T06:05:57Z", "author": {"login": "bsglz"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/procedure/flush/FlushTableSubprocedure.java", "diffHunk": "@@ -88,11 +95,15 @@ private void flushRegions() throws ForeignException {\n       throw new IllegalStateException(\"Attempting to flush \"\n           + table + \" but we currently have outstanding tasks\");\n     }\n-\n+    List<byte[]> families = null;\n+    if (family != null) {\n+      LOG.debug(\"Flush regions with specified family:{}\", family);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzUwNTIwMQ=="}, "originalCommit": {"oid": "0a1b0aca673c49d1cf5b91fa9881d8c412598220"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NDAwMzM4OnYy", "diffSide": "RIGHT", "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/client/Admin.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwOTozMzowN1rOG6CRaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMVQwNjoxNjozMVrOG6b-Wg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzUwNzgxOQ==", "bodyText": "We should explain better how this overloaded version differs from flush(TableName tableName).", "url": "https://github.com/apache/hbase/pull/2179#discussion_r463507819", "createdAt": "2020-07-31T09:33:07Z", "author": {"login": "wchevreuil"}, "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/client/Admin.java", "diffHunk": "@@ -513,6 +513,15 @@ default void modifyColumnFamily(TableName tableName, ColumnFamilyDescriptor colu\n    */\n   void flush(TableName tableName) throws IOException;\n \n+  /**\n+   * Flush a table. Synchronous operation.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a1b0aca673c49d1cf5b91fa9881d8c412598220"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzkyODkyMg==", "bodyText": "Will fix.", "url": "https://github.com/apache/hbase/pull/2179#discussion_r463928922", "createdAt": "2020-08-01T06:16:31Z", "author": {"login": "bsglz"}, "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/client/Admin.java", "diffHunk": "@@ -513,6 +513,15 @@ default void modifyColumnFamily(TableName tableName, ColumnFamilyDescriptor colu\n    */\n   void flush(TableName tableName) throws IOException;\n \n+  /**\n+   * Flush a table. Synchronous operation.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzUwNzgxOQ=="}, "originalCommit": {"oid": "0a1b0aca673c49d1cf5b91fa9881d8c412598220"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NDAwNTY5OnYy", "diffSide": "RIGHT", "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/client/AsyncAdmin.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwOTozMzo1M1rOG6CSwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMVQwNjoyMzo0MVrOG6cAhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzUwODE2MA==", "bodyText": "We should explain better how this overloaded version differs from flush(TableName tableName).", "url": "https://github.com/apache/hbase/pull/2179#discussion_r463508160", "createdAt": "2020-07-31T09:33:53Z", "author": {"login": "wchevreuil"}, "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/client/AsyncAdmin.java", "diffHunk": "@@ -302,6 +302,13 @@\n    */\n   CompletableFuture<Void> flush(TableName tableName);\n \n+  /**\n+   * Flush a table.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a1b0aca673c49d1cf5b91fa9881d8c412598220"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzkyOTQ3OA==", "bodyText": "Will fix.", "url": "https://github.com/apache/hbase/pull/2179#discussion_r463929478", "createdAt": "2020-08-01T06:23:41Z", "author": {"login": "bsglz"}, "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/client/AsyncAdmin.java", "diffHunk": "@@ -302,6 +302,13 @@\n    */\n   CompletableFuture<Void> flush(TableName tableName);\n \n+  /**\n+   * Flush a table.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzUwODE2MA=="}, "originalCommit": {"oid": "0a1b0aca673c49d1cf5b91fa9881d8c412598220"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NDA0NTU5OnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/procedure/flush/FlushTableSubprocedure.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwOTo0NjozNFrOG6Cq1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMVQwNjoyNToyMFrOG6cBHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzUxNDMyNQ==", "bodyText": "Can this affect the other versions that don't specify any families, like flush(TableName tableName)? Because region.flush(true), internally, loads all families before delegating to flushcache(List<byte[]> families, boolean writeFlushRequestWalMarker, FlushLifeCycleTracker tracker), but it doesn't seem we are doing this now.", "url": "https://github.com/apache/hbase/pull/2179#discussion_r463514325", "createdAt": "2020-07-31T09:46:34Z", "author": {"login": "wchevreuil"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/procedure/flush/FlushTableSubprocedure.java", "diffHunk": "@@ -65,7 +72,7 @@ public Void call() throws Exception {\n       region.startRegionOperation();\n       try {\n         LOG.debug(\"Flush region \" + region.toString() + \" started...\");\n-        region.flush(true);\n+        region.flushcache(families, false, FlushLifeCycleTracker.DUMMY);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a1b0aca673c49d1cf5b91fa9881d8c412598220"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzkyOTYzMA==", "bodyText": "You are right, it indeed affect, will fix.\nThanks.", "url": "https://github.com/apache/hbase/pull/2179#discussion_r463929630", "createdAt": "2020-08-01T06:25:20Z", "author": {"login": "bsglz"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/procedure/flush/FlushTableSubprocedure.java", "diffHunk": "@@ -65,7 +72,7 @@ public Void call() throws Exception {\n       region.startRegionOperation();\n       try {\n         LOG.debug(\"Flush region \" + region.toString() + \" started...\");\n-        region.flush(true);\n+        region.flushcache(families, false, FlushLifeCycleTracker.DUMMY);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzUxNDMyNQ=="}, "originalCommit": {"oid": "0a1b0aca673c49d1cf5b91fa9881d8c412598220"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NDA1NzUxOnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/procedure/flush/RegionServerFlushTableProcedureManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwOTo1MDoyMlrOG6Cx-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMVQwNjoyODo1NlrOG6cCPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzUxNjE1Mw==", "bodyText": "Will it always be non null even when we don't specify any family?", "url": "https://github.com/apache/hbase/pull/2179#discussion_r463516153", "createdAt": "2020-07-31T09:50:22Z", "author": {"login": "wchevreuil"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/procedure/flush/RegionServerFlushTableProcedureManager.java", "diffHunk": "@@ -183,8 +185,17 @@ public Subprocedure buildSubprocedure(String table) {\n \n     @Override\n     public Subprocedure buildSubprocedure(String name, byte[] data) {\n+      String family = null;\n+      if (data.length > 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a1b0aca673c49d1cf5b91fa9881d8c412598220"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzkyOTkxOA==", "bodyText": "Currently it is true, since we only set an empty array before this issue.", "url": "https://github.com/apache/hbase/pull/2179#discussion_r463929918", "createdAt": "2020-08-01T06:28:56Z", "author": {"login": "bsglz"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/procedure/flush/RegionServerFlushTableProcedureManager.java", "diffHunk": "@@ -183,8 +185,17 @@ public Subprocedure buildSubprocedure(String table) {\n \n     @Override\n     public Subprocedure buildSubprocedure(String name, byte[] data) {\n+      String family = null;\n+      if (data.length > 0) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzUxNjE1Mw=="}, "originalCommit": {"oid": "0a1b0aca673c49d1cf5b91fa9881d8c412598220"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwODkzOTcwOnYy", "diffSide": "RIGHT", "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/client/Admin.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMzo0MDozN1rOG8KKHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMzo1OToyMFrOG8K83g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTczNDE3Mw==", "bodyText": "Let's not leave any room for confusion: Flush the specified column family stores on all regions of the passed table. This runs as a synchronous operation.", "url": "https://github.com/apache/hbase/pull/2179#discussion_r465734173", "createdAt": "2020-08-05T13:40:37Z", "author": {"login": "wchevreuil"}, "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/client/Admin.java", "diffHunk": "@@ -513,6 +513,15 @@ default void modifyColumnFamily(TableName tableName, ColumnFamilyDescriptor colu\n    */\n   void flush(TableName tableName) throws IOException;\n \n+  /**\n+   * Flush a table with specified column family. Synchronous operation.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "898b8ee225c1a47ca1cb93c54229234b1584e76e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTc0NzE2Ng==", "bodyText": "Will fix later.\nThanks.", "url": "https://github.com/apache/hbase/pull/2179#discussion_r465747166", "createdAt": "2020-08-05T13:59:20Z", "author": {"login": "bsglz"}, "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/client/Admin.java", "diffHunk": "@@ -513,6 +513,15 @@ default void modifyColumnFamily(TableName tableName, ColumnFamilyDescriptor colu\n    */\n   void flush(TableName tableName) throws IOException;\n \n+  /**\n+   * Flush a table with specified column family. Synchronous operation.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTczNDE3Mw=="}, "originalCommit": {"oid": "898b8ee225c1a47ca1cb93c54229234b1584e76e"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwODk0MTc2OnYy", "diffSide": "RIGHT", "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/client/AsyncAdmin.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMzo0MTowOFrOG8KLfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMzo1OTozNFrOG8K9kA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTczNDUyNA==", "bodyText": "Similar to above.", "url": "https://github.com/apache/hbase/pull/2179#discussion_r465734524", "createdAt": "2020-08-05T13:41:08Z", "author": {"login": "wchevreuil"}, "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/client/AsyncAdmin.java", "diffHunk": "@@ -302,6 +302,13 @@\n    */\n   CompletableFuture<Void> flush(TableName tableName);\n \n+  /**\n+   * Flush a table with specified column family.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "898b8ee225c1a47ca1cb93c54229234b1584e76e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTc0NzM0NA==", "bodyText": "Will fix later.\nThanks.", "url": "https://github.com/apache/hbase/pull/2179#discussion_r465747344", "createdAt": "2020-08-05T13:59:34Z", "author": {"login": "bsglz"}, "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/client/AsyncAdmin.java", "diffHunk": "@@ -302,6 +302,13 @@\n    */\n   CompletableFuture<Void> flush(TableName tableName);\n \n+  /**\n+   * Flush a table with specified column family.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTczNDUyNA=="}, "originalCommit": {"oid": "898b8ee225c1a47ca1cb93c54229234b1584e76e"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwODk0NTc1OnYy", "diffSide": "RIGHT", "path": "hbase-shell/src/main/ruby/shell/commands/flush.rb", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMzo0MjowN1rOG8KOFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMzo1OTo0MFrOG8K94w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTczNTE5MQ==", "bodyText": "You can also flush a single column family for all regions within a table, or for an specific region only.", "url": "https://github.com/apache/hbase/pull/2179#discussion_r465735191", "createdAt": "2020-08-05T13:42:07Z", "author": {"login": "wchevreuil"}, "path": "hbase-shell/src/main/ruby/shell/commands/flush.rb", "diffHunk": "@@ -25,10 +25,11 @@ def help\n Flush all regions in passed table or pass a region row to\n flush an individual region or a region server name whose format\n is 'host,port,startcode', to flush all its regions.\n-You can also flush a single column family within a region.\n+You can also flush a single column family within a table or region.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "898b8ee225c1a47ca1cb93c54229234b1584e76e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTc0NzQyNw==", "bodyText": "Will fix later.\nThanks.", "url": "https://github.com/apache/hbase/pull/2179#discussion_r465747427", "createdAt": "2020-08-05T13:59:40Z", "author": {"login": "bsglz"}, "path": "hbase-shell/src/main/ruby/shell/commands/flush.rb", "diffHunk": "@@ -25,10 +25,11 @@ def help\n Flush all regions in passed table or pass a region row to\n flush an individual region or a region server name whose format\n is 'host,port,startcode', to flush all its regions.\n-You can also flush a single column family within a region.\n+You can also flush a single column family within a table or region.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTczNTE5MQ=="}, "originalCommit": {"oid": "898b8ee225c1a47ca1cb93c54229234b1584e76e"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2727, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}