{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwNDExOTEw", "number": 2521, "title": "HBASE-25117 ReplicationSourceShipper thread can not be finished", "bodyText": "", "createdAt": "2020-10-09T07:46:58Z", "url": "https://github.com/apache/hbase/pull/2521", "merged": true, "mergeCommit": {"oid": "78b7244091f294d7e2f59a563d34dac7cf722cd7"}, "closed": true, "closedAt": "2020-10-14T17:08:54Z", "author": {"login": "ddupg"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQ1NlnAFqTUwNTYxOTUzNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSHRT9gFqTUwNzM1MjgwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1NjE5NTM0", "url": "https://github.com/apache/hbase/pull/2521#pullrequestreview-505619534", "createdAt": "2020-10-09T12:19:50Z", "commit": {"oid": "76d357e8616a9428f821a04005bf3532710f4071"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1OTU3Mzc2", "url": "https://github.com/apache/hbase/pull/2521#pullrequestreview-505957376", "createdAt": "2020-10-09T20:04:10Z", "commit": {"oid": "76d357e8616a9428f821a04005bf3532710f4071"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MDYyNjM0", "url": "https://github.com/apache/hbase/pull/2521#pullrequestreview-506062634", "createdAt": "2020-10-10T03:44:54Z", "commit": {"oid": "76d357e8616a9428f821a04005bf3532710f4071"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQwMzo0NDo1NVrOHfc5Ag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQwMzo0NDo1NVrOHfc5Ag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc0MTI1MA==", "bodyText": "This means we eat the interrupted exception at some places? Can we propagate it to the upper layer?", "url": "https://github.com/apache/hbase/pull/2521#discussion_r502741250", "createdAt": "2020-10-10T03:44:55Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/HBaseInterClusterReplicationEndpoint.java", "diffHunk": "@@ -475,7 +476,7 @@ public boolean replicate(ReplicateContext replicateContext) {\n     }\n \n     List<List<Entry>> batches = createBatches(replicateContext.getEntries());\n-    while (this.isRunning() && !exec.isShutdown()) {\n+    while (this.isRunning() && !exec.isShutdown() && !Thread.currentThread().isInterrupted()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76d357e8616a9428f821a04005bf3532710f4071"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0bb3ce5874edc2cdb55690a10c3e59c143094abf", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/0bb3ce5874edc2cdb55690a10c3e59c143094abf", "committedDate": "2020-10-13T03:15:04Z", "message": "HBASE-25117 ReplicationSourceShipper thread can not be finished"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "76d357e8616a9428f821a04005bf3532710f4071", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/76d357e8616a9428f821a04005bf3532710f4071", "committedDate": "2020-10-09T07:44:10Z", "message": "HBASE-25117 ReplicationSourceShipper thread can not be finished"}, "afterCommit": {"oid": "0bb3ce5874edc2cdb55690a10c3e59c143094abf", "author": {"user": {"login": "ddupg", "name": "XinSun"}}, "url": "https://github.com/apache/hbase/commit/0bb3ce5874edc2cdb55690a10c3e59c143094abf", "committedDate": "2020-10-13T03:15:04Z", "message": "HBASE-25117 ReplicationSourceShipper thread can not be finished"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MDQ4Mzkw", "url": "https://github.com/apache/hbase/pull/2521#pullrequestreview-507048390", "createdAt": "2020-10-13T03:43:18Z", "commit": {"oid": "0bb3ce5874edc2cdb55690a10c3e59c143094abf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwMzo0MzoxOVrOHgUUjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwMzo0MzoxOVrOHgUUjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY0OTQyMg==", "bodyText": "ReplicationSourceShipper and entryReader are thread. replicationEndpoint is not a thread and is used by ReplicationSourceShipper thread. I am +1 for this: stop firstly, then interrupt thread.", "url": "https://github.com/apache/hbase/pull/2521#discussion_r503649422", "createdAt": "2020-10-13T03:43:19Z", "author": {"login": "infraio"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java", "diffHunk": "@@ -691,6 +691,9 @@ public void terminate(String reason, Exception cause, boolean clearMetrics,\n       }\n     }\n \n+    if (this.replicationEndpoint != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0bb3ce5874edc2cdb55690a10c3e59c143094abf"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MDUxMTU2", "url": "https://github.com/apache/hbase/pull/2521#pullrequestreview-507051156", "createdAt": "2020-10-13T03:53:16Z", "commit": {"oid": "0bb3ce5874edc2cdb55690a10c3e59c143094abf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MzUyODA2", "url": "https://github.com/apache/hbase/pull/2521#pullrequestreview-507352806", "createdAt": "2020-10-13T11:55:29Z", "commit": {"oid": "0bb3ce5874edc2cdb55690a10c3e59c143094abf"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMTo1NToyOVrOHgi-Nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMTo1NToyOVrOHgi-Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzg4OTQ2Mw==", "bodyText": "I think the intenion here to interrupt thread first is that, we want to make sure that, we could still do replication when shutting down the worker.\nIn general, I'm fine with this approach as in distributed system, we should have the ability to deal with this type error. But it is still a bit strange that, the above stop worker and setReaderRunning to false can not stop the work?", "url": "https://github.com/apache/hbase/pull/2521#discussion_r503889463", "createdAt": "2020-10-13T11:55:29Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java", "diffHunk": "@@ -691,6 +691,9 @@ public void terminate(String reason, Exception cause, boolean clearMetrics,\n       }\n     }\n \n+    if (this.replicationEndpoint != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY0OTQyMg=="}, "originalCommit": {"oid": "0bb3ce5874edc2cdb55690a10c3e59c143094abf"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4330, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}