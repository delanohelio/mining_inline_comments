{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0NjczMDU0", "number": 1243, "title": "HBASE-23944 The method setClusterLoad of SimpleLoadBalancer is incorr\u2026", "bodyText": "\u2026ect when balance by table", "createdAt": "2020-03-06T07:26:05Z", "url": "https://github.com/apache/hbase/pull/1243", "merged": true, "mergeCommit": {"oid": "819965a35ad8e322b0253fc59e7c4229330a11ee"}, "closed": true, "closedAt": "2020-03-07T08:18:41Z", "author": {"login": "nyl3532016"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcK7ca7AFqTM3MDEzODQxNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcLQQugAFqTM3MDczMTE3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMTM4NDE2", "url": "https://github.com/apache/hbase/pull/1243#pullrequestreview-370138416", "createdAt": "2020-03-06T08:00:45Z", "commit": {"oid": "2702fe87723c4efaa0554d186fc0efce738ff318"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwODowMDo0NVrOFyv9Fw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwODowMDo0NVrOFyv9Fw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc1ODgwNw==", "bodyText": "Why change TreeMap to Map?", "url": "https://github.com/apache/hbase/pull/1243#discussion_r388758807", "createdAt": "2020-03-06T08:00:45Z", "author": {"login": "infraio"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/master/balancer/BalancerTestBase.java", "diffHunk": "@@ -402,13 +402,13 @@ protected void updateLoad(final Map<ServerName, ServerAndLoad> map,\n     return servers;\n   }\n \n-  protected HashMap<TableName, TreeMap<ServerName, List<RegionInfo>>> mockClusterServersWithTables(Map<ServerName, List<RegionInfo>> clusterServers) {\n-    HashMap<TableName, TreeMap<ServerName, List<RegionInfo>>> result = new HashMap<>();\n+  protected Map<TableName, Map<ServerName, List<RegionInfo>>> mockClusterServersWithTables(Map<ServerName, List<RegionInfo>> clusterServers) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2702fe87723c4efaa0554d186fc0efce738ff318"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMTM4NTU2", "url": "https://github.com/apache/hbase/pull/1243#pullrequestreview-370138556", "createdAt": "2020-03-06T08:01:07Z", "commit": {"oid": "2702fe87723c4efaa0554d186fc0efce738ff318"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwODowMTowOFrOFyv9pg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwODowMTowOFrOFyv9pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc1ODk1MA==", "bodyText": "The difference of results1 and clusterLoad is?", "url": "https://github.com/apache/hbase/pull/1243#discussion_r388758950", "createdAt": "2020-03-06T08:01:08Z", "author": {"login": "infraio"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/master/balancer/TestDefaultLoadBalancer.java", "diffHunk": "@@ -171,20 +171,33 @@ public void testBalanceClusterOverall() throws Exception {\n    */\n   @Test\n   public void testImpactOfBalanceClusterOverall() throws Exception {\n+    testImpactOfBalanceClusterOverall(false);\n+  }\n+\n+  @Test\n+  public void testImpactOfBalanceClusterOverallWithTableClusterLoad() throws Exception {\n+    testImpactOfBalanceClusterOverall(true);\n+  }\n+\n+  private void testImpactOfBalanceClusterOverall(boolean useTableClusterLoad) throws Exception {\n     Map<TableName, Map<ServerName, List<RegionInfo>>> clusterLoad = new TreeMap<>();\n     Map<ServerName, List<RegionInfo>> clusterServers = mockUniformClusterServers(mockUniformCluster);\n     List<ServerAndLoad> clusterList = convertToList(clusterServers);\n     clusterLoad.put(TableName.valueOf(name.getMethodName()), clusterServers);\n     // use overall can achieve both table and cluster level balance\n-    HashMap<TableName, TreeMap<ServerName, List<RegionInfo>>> result1 = mockClusterServersWithTables(clusterServers);\n-    loadBalancer.setClusterLoad(clusterLoad);\n+    Map<TableName, Map<ServerName, List<RegionInfo>>> result1 = mockClusterServersWithTables(clusterServers);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2702fe87723c4efaa0554d186fc0efce738ff318"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f744aff3fd15ce99423e3a68b051638f58820bd", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/0f744aff3fd15ce99423e3a68b051638f58820bd", "committedDate": "2020-03-07T01:11:05Z", "message": "HBASE-23944 The method setClusterLoad of SimpleLoadBalancer is incorrect when balance by table"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2702fe87723c4efaa0554d186fc0efce738ff318", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/2702fe87723c4efaa0554d186fc0efce738ff318", "committedDate": "2020-03-06T07:23:48Z", "message": "HBASE-23944 The method setClusterLoad of SimpleLoadBalancer is incorrect when balance by table"}, "afterCommit": {"oid": "0f744aff3fd15ce99423e3a68b051638f58820bd", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/0f744aff3fd15ce99423e3a68b051638f58820bd", "committedDate": "2020-03-07T01:11:05Z", "message": "HBASE-23944 The method setClusterLoad of SimpleLoadBalancer is incorrect when balance by table"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNzMxMTc3", "url": "https://github.com/apache/hbase/pull/1243#pullrequestreview-370731177", "createdAt": "2020-03-07T08:16:00Z", "commit": {"oid": "0f744aff3fd15ce99423e3a68b051638f58820bd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2572, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}