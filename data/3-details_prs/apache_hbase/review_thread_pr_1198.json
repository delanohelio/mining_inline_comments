{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4Njk1NjU3", "number": 1198, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yM1QxODo1OToxN1rODiLAbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwODo1Mzo0MFrODiPwCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3MTU4NTA5OnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionFileSystem.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yM1QxODo1OToxN1rOFtSQ0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwOTozNzowM1rOFtaGHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzAyOTQ1Nw==", "bodyText": "Might want to use {} for status.getPath()?", "url": "https://github.com/apache/hbase/pull/1198#discussion_r383029457", "createdAt": "2020-02-23T18:59:17Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionFileSystem.java", "diffHunk": "@@ -245,7 +245,11 @@ public String getStoragePolicyName(String familyName) {\n     ArrayList<StoreFileInfo> storeFiles = new ArrayList<>(files.length);\n     for (FileStatus status: files) {\n       if (validate && !StoreFileInfo.isValid(status)) {\n-        LOG.warn(\"Invalid StoreFile: \" + status.getPath());\n+        // recovered.hfiles directory is expected inside CF path when hbase.wal.split.to.hfile to\n+        // true, refer HBASE-23740\n+        if (!HConstants.RECOVERED_HFILES_DIR.equals(status.getPath().getName())) {\n+          LOG.warn(\"Invalid StoreFile: \" + status.getPath());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39045e30fcd6f88b95070a4a9f3d15f32bdb2a84"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzE1Nzc4OA==", "bodyText": "Done in 34f2189", "url": "https://github.com/apache/hbase/pull/1198#discussion_r383157788", "createdAt": "2020-02-24T09:37:03Z", "author": {"login": "pankaj72981"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionFileSystem.java", "diffHunk": "@@ -245,7 +245,11 @@ public String getStoragePolicyName(String familyName) {\n     ArrayList<StoreFileInfo> storeFiles = new ArrayList<>(files.length);\n     for (FileStatus status: files) {\n       if (validate && !StoreFileInfo.isValid(status)) {\n-        LOG.warn(\"Invalid StoreFile: \" + status.getPath());\n+        // recovered.hfiles directory is expected inside CF path when hbase.wal.split.to.hfile to\n+        // true, refer HBASE-23740\n+        if (!HConstants.RECOVERED_HFILES_DIR.equals(status.getPath().getName())) {\n+          LOG.warn(\"Invalid StoreFile: \" + status.getPath());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzAyOTQ1Nw=="}, "originalCommit": {"oid": "39045e30fcd6f88b95070a4a9f3d15f32bdb2a84"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3MjM2MjMyOnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionFileSystem.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwODo1Mzo0MFrOFtY6MQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwOTozNzoxN1rOFtaGfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzEzODM1Mw==", "bodyText": "Same here.", "url": "https://github.com/apache/hbase/pull/1198#discussion_r383138353", "createdAt": "2020-02-24T08:53:40Z", "author": {"login": "petersomogyi"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionFileSystem.java", "diffHunk": "@@ -278,7 +282,11 @@ public String getStoragePolicyName(String familyName) {\n     List<LocatedFileStatus> validStoreFiles = Lists.newArrayList();\n     for (LocatedFileStatus status : locatedFileStatuses) {\n       if (validate && !StoreFileInfo.isValid(status)) {\n-        LOG.warn(\"Invalid StoreFile: \" + status.getPath());\n+        // recovered.hfiles directory is expected inside CF path when hbase.wal.split.to.hfile to\n+        // true, refer HBASE-23740\n+        if (!HConstants.RECOVERED_HFILES_DIR.equals(status.getPath().getName())) {\n+          LOG.warn(\"Invalid StoreFile: \" + status.getPath());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39045e30fcd6f88b95070a4a9f3d15f32bdb2a84"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzE1Nzg4Ng==", "bodyText": "Done 34f2189", "url": "https://github.com/apache/hbase/pull/1198#discussion_r383157886", "createdAt": "2020-02-24T09:37:17Z", "author": {"login": "pankaj72981"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionFileSystem.java", "diffHunk": "@@ -278,7 +282,11 @@ public String getStoragePolicyName(String familyName) {\n     List<LocatedFileStatus> validStoreFiles = Lists.newArrayList();\n     for (LocatedFileStatus status : locatedFileStatuses) {\n       if (validate && !StoreFileInfo.isValid(status)) {\n-        LOG.warn(\"Invalid StoreFile: \" + status.getPath());\n+        // recovered.hfiles directory is expected inside CF path when hbase.wal.split.to.hfile to\n+        // true, refer HBASE-23740\n+        if (!HConstants.RECOVERED_HFILES_DIR.equals(status.getPath().getName())) {\n+          LOG.warn(\"Invalid StoreFile: \" + status.getPath());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzEzODM1Mw=="}, "originalCommit": {"oid": "39045e30fcd6f88b95070a4a9f3d15f32bdb2a84"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2092, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}