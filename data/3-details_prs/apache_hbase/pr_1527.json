{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0MDM5NTQy", "number": 1527, "title": "HBASE-24143 [JDK11] Switch default garbage collector from CMS", "bodyText": "Per comments in Jira, be explicit about what collector we\nuse. Existing code simply hard-codes HBASE_OPTS in\nconf/hbase-env.sh. We now need to be a little more clever than this,\nso moves the definition into bin/hbase. Also consolidates logic\naround JVM version detection into a reusable function.\nThis change also changes how we set HBASE_OPTS. Before, we would\naccept an operator's value, but always append our GC\nprescription. After this change, we defer entirely to the operator's\nchoice, only applying our values when they've not specified their\nintentions.", "createdAt": "2020-04-15T23:33:54Z", "url": "https://github.com/apache/hbase/pull/1527", "merged": true, "mergeCommit": {"oid": "52245e9f7c8315c0cadcd9d9ca842bbe54cd5ca1"}, "closed": true, "closedAt": "2020-04-17T20:51:09Z", "author": {"login": "ndimiduk"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYGouvgFqTM5NDMyOTEwNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYnVeSgBqjMyNDU4ODI5NzQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0MzI5MTA1", "url": "https://github.com/apache/hbase/pull/1527#pullrequestreview-394329105", "createdAt": "2020-04-16T06:23:05Z", "commit": {"oid": "0fde2bfc66d2e6572939381af292fabbacd1d631"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwNjoyMzowNVrOGGWPng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwNjoyMzowNVrOGGWPng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTMwOTA4Ng==", "bodyText": "This in jdk8 too?", "url": "https://github.com/apache/hbase/pull/1527#discussion_r409309086", "createdAt": "2020-04-16T06:23:05Z", "author": {"login": "saintstack"}, "path": "bin/hbase-config.sh", "diffHunk": "@@ -168,3 +168,27 @@ if [ -z \"$JAVA_HOME\" ]; then\n EOF\n     exit 1\n fi\n+\n+function read_java_version() {\n+  properties=\"$(\"${JAVA_HOME}/bin/java\" -XshowSettings:properties -version 2>&1)\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0fde2bfc66d2e6572939381af292fabbacd1d631"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0OTQ0ODEx", "url": "https://github.com/apache/hbase/pull/1527#pullrequestreview-394944811", "createdAt": "2020-04-16T19:41:59Z", "commit": {"oid": "0fde2bfc66d2e6572939381af292fabbacd1d631"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxOTo0MTo1OVrOGG0feg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxOTo0NToyMVrOGG0mog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgwNDY2Ng==", "bodyText": "G1GC is the default, why aren't we just leaving this out?", "url": "https://github.com/apache/hbase/pull/1527#discussion_r409804666", "createdAt": "2020-04-16T19:41:59Z", "author": {"login": "busbey"}, "path": "bin/hbase", "diffHunk": "@@ -136,6 +136,21 @@ if [ -f \"$HBASE_HOME/conf/hbase-env-$COMMAND.sh\" ]; then\n   . \"$HBASE_HOME/conf/hbase-env-$COMMAND.sh\"\n fi\n \n+# establish a default value for HBASE_OPTS if it's not already set. For now,\n+# all we set is the garbage collector.\n+if [ -z \"${HBASE_OPTS}\" ] ; then\n+  major_version_number=\"$(parse_java_major_version \"$(read_java_version)\")\"\n+  case \"$major_version_number\" in\n+  8|9|10)\n+    HBASE_OPTS=\"-XX:+UseConcMarkSweepGC\"\n+    ;;\n+  11|*)\n+    HBASE_OPTS=\"-XX:+UseG1GC\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0fde2bfc66d2e6572939381af292fabbacd1d631"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgwNjQ5OA==", "bodyText": "nit, but this usually means we didn't tell shellcheck how to source some file we presume is present in the environment. in this case hbase-env. it'd be nice if we fixed that, but I don't think it needs to be your problem in this PR.", "url": "https://github.com/apache/hbase/pull/1527#discussion_r409806498", "createdAt": "2020-04-16T19:45:21Z", "author": {"login": "busbey"}, "path": "bin/hbase-config.sh", "diffHunk": "@@ -168,3 +168,27 @@ if [ -z \"$JAVA_HOME\" ]; then\n EOF\n     exit 1\n fi\n+\n+function read_java_version() {\n+  properties=\"$(\"${JAVA_HOME}/bin/java\" -XshowSettings:properties -version 2>&1)\"\n+  #shellcheck disable=SC2016 # shellcheck cannot see through \"${AWK}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0fde2bfc66d2e6572939381af292fabbacd1d631"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NjczNTQz", "url": "https://github.com/apache/hbase/pull/1527#pullrequestreview-395673543", "createdAt": "2020-04-17T18:16:22Z", "commit": {"oid": "0fde2bfc66d2e6572939381af292fabbacd1d631"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efd0cbb9696cc41db4038dd14c450deecb1f6228", "author": {"user": {"login": "ndimiduk", "name": "Nick Dimiduk"}}, "url": "https://github.com/apache/hbase/commit/efd0cbb9696cc41db4038dd14c450deecb1f6228", "committedDate": "2020-04-17T20:19:46Z", "message": "HBASE-24143 [JDK11] Switch default garbage collector from CMS\n\nPer comments in Jira, be explicit about what collector we\nuse. Existing code simply hard-codes HBASE_OPTS in\n`conf/hbase-env.sh`. We now need to be a little more clever than this,\nso moves the definition into `bin/hbase`. Also consolidates logic\naround JVM version detection into a reusable function.\n\nThis change also changes how we set `HBASE_OPTS`. Before, we would\naccept an operator's value, but always append our GC\nprescription. After this change, we defer entirely to the operator's\nchoice, only applying our values when they've not specified their\nintentions.\n\nSigned-off-by: stack <stack@apache.org>\nSigned-off-by: Sean Busbey <busbey@apache.org>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0fde2bfc66d2e6572939381af292fabbacd1d631", "author": {"user": {"login": "ndimiduk", "name": "Nick Dimiduk"}}, "url": "https://github.com/apache/hbase/commit/0fde2bfc66d2e6572939381af292fabbacd1d631", "committedDate": "2020-04-15T23:31:21Z", "message": "HBASE-24143 [JDK11] Switch default garbage collector from CMS\n\nPer comments in Jira, be explicit about what collector we\nuse. Existing code simply hard-codes HBASE_OPTS in\n`conf/hbase-env.sh`. We now need to be a little more clever than this,\nso moves the definition into `bin/hbase`. Also consolidates logic\naround JVM version detection into a reusable function.\n\nThis change also changes how we set `HBASE_OPTS`. Before, we would\naccept an operator's value, but always append our GC\nprescription. After this change, we defer entirely to the operator's\nchoice, only applying our values when they've not specified their\nintentions."}, "afterCommit": {"oid": "efd0cbb9696cc41db4038dd14c450deecb1f6228", "author": {"user": {"login": "ndimiduk", "name": "Nick Dimiduk"}}, "url": "https://github.com/apache/hbase/commit/efd0cbb9696cc41db4038dd14c450deecb1f6228", "committedDate": "2020-04-17T20:19:46Z", "message": "HBASE-24143 [JDK11] Switch default garbage collector from CMS\n\nPer comments in Jira, be explicit about what collector we\nuse. Existing code simply hard-codes HBASE_OPTS in\n`conf/hbase-env.sh`. We now need to be a little more clever than this,\nso moves the definition into `bin/hbase`. Also consolidates logic\naround JVM version detection into a reusable function.\n\nThis change also changes how we set `HBASE_OPTS`. Before, we would\naccept an operator's value, but always append our GC\nprescription. After this change, we defer entirely to the operator's\nchoice, only applying our values when they've not specified their\nintentions.\n\nSigned-off-by: stack <stack@apache.org>\nSigned-off-by: Sean Busbey <busbey@apache.org>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2152, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}