{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyNjQ1MDYx", "number": 2304, "title": "HBASE-24916: Region hole contains wrong regions pair when hole is cre\u2026", "bodyText": "\u2026ated by first region deletion", "createdAt": "2020-08-24T16:56:44Z", "url": "https://github.com/apache/hbase/pull/2304", "merged": true, "mergeCommit": {"oid": "bb64070bd310611afed7c9a0d0e30b761fdfb444"}, "closed": true, "closedAt": "2020-08-30T17:04:41Z", "author": {"login": "arshadmohammad"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCFk_ogH2gAyNDcyNjQ1MDYxOmEyMjYzNjBhOWUyYzg4Y2FlZGIxYjMzODhiZDllNGIwNmZhNmZhNDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdD3N2hgH2gAyNDcyNjQ1MDYxOmZmMDQyMzA4OTdlMDhlOGQyMTIzZWM5ZjEyZjZhMTJlMjA2YWI0NzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a226360a9e2c88caedb1b3388bd9e4b06fa6fa45", "author": {"user": {"login": "arshadmohammad", "name": "Mohammad Arshad"}}, "url": "https://github.com/apache/hbase/commit/a226360a9e2c88caedb1b3388bd9e4b06fa6fa45", "committedDate": "2020-08-24T16:55:01Z", "message": "HBASE-24916: Region hole contains wrong regions pair when hole is created by first region deletion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2OTgzMzgz", "url": "https://github.com/apache/hbase/pull/2304#pullrequestreview-476983383", "createdAt": "2020-08-27T18:37:01Z", "commit": {"oid": "a226360a9e2c88caedb1b3388bd9e4b06fa6fa45"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxODozNzowMVrOHIclZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxODozNzowMVrOHIclZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYxODk4MQ==", "bodyText": "Add an 'else' here?", "url": "https://github.com/apache/hbase/pull/2304#discussion_r478618981", "createdAt": "2020-08-27T18:37:01Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java", "diffHunk": "@@ -644,12 +644,17 @@ private RegionInfo metaTableConsistencyCheck(Result metaTableRow) {\n       // If table is disabled, skip integrity check.\n       if (!isTableDisabled(ri)) {\n         if (isTableTransition(ri)) {\n-          // On table transition, look to see if last region was last in table\n-          // and if this is the first. Report 'hole' if neither is true.\n           // HBCK1 used to have a special category for missing start or end keys.\n           // We'll just lump them in as 'holes'.\n-          if ((this.previous != null && !this.previous.isLast()) || !ri.isFirst()) {\n-            addHole(this.previous == null? RegionInfo.UNDEFINED: this.previous, ri);\n+\n+          // This is a table transition. If this region is not first region, report a hole.\n+          if (!ri.isFirst()) {\n+            addHole(RegionInfo.UNDEFINED, ri);\n+          }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a226360a9e2c88caedb1b3388bd9e4b06fa6fa45"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3NDgwNTc5", "url": "https://github.com/apache/hbase/pull/2304#pullrequestreview-477480579", "createdAt": "2020-08-28T08:14:15Z", "commit": {"oid": "a226360a9e2c88caedb1b3388bd9e4b06fa6fa45"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwODoxNDoxNlrOHIvRBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwODoxNDoxNlrOHIvRBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODkyNTA2Mg==", "bodyText": "Please run MetaFixer to verify is it processing these holes correctly.", "url": "https://github.com/apache/hbase/pull/2304#discussion_r478925062", "createdAt": "2020-08-28T08:14:16Z", "author": {"login": "KanakaKumar"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitorCluster.java", "diffHunk": "@@ -231,4 +234,86 @@ public void testConsistency() throws IOException {\n     row[row.length - 1] = (byte)(((int)row[row.length - 1]) + 1);\n     return row;\n   }\n+\n+  @Test\n+  public void testHoles() throws IOException {\n+    CatalogJanitor janitor = TEST_UTIL.getHBaseCluster().getMaster().getCatalogJanitor();\n+\n+    CatalogJanitor.Report report = janitor.getLastReport();\n+    // Assert no problems.\n+    assertTrue(report.isEmpty());\n+    //Verify start and end region holes\n+    verifyCornerHoles(janitor, T1);\n+    //Verify start and end region holes\n+    verifyCornerHoles(janitor, T2);\n+    verifyMiddleHole(janitor);\n+    //verify total number of holes, 2 in t1 and t2 each and one in t3\n+    janitor.scan();\n+    assertEquals(5, janitor.getLastReport().getHoles().size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a226360a9e2c88caedb1b3388bd9e4b06fa6fa45"}, "originalPosition": 51}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff04230897e08e8d2123ec9f12f6a12e206ab470", "author": {"user": {"login": "arshadmohammad", "name": "Mohammad Arshad"}}, "url": "https://github.com/apache/hbase/commit/ff04230897e08e8d2123ec9f12f6a12e206ab470", "committedDate": "2020-08-30T05:18:55Z", "message": "Fixed review comment, Called MetaFix to fix all the holes created during the test."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4967, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}