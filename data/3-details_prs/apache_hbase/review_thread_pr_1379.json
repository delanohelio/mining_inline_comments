{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1NDYxOTIy", "number": 1379, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwNzo1MzowOFrODsjUBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxODo1OToyMVrODsz53A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4MDQyNTAxOnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java", "isResolved": false, "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwNzo1MzowOFrOF9dkpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQxNTo0NTozMlrOGBBETQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk5MTk3Mg==", "bodyText": "Should we use LOG.warn or error here? Also, with variable params replacing + var + with {} and argument?", "url": "https://github.com/apache/hbase/pull/1379#discussion_r399991972", "createdAt": "2020-03-30T07:53:08Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java", "diffHunk": "@@ -635,8 +635,12 @@ public boolean next(List<Cell> outResult, ScannerContext scannerContext) throws\n             scannerContext.incrementBatchProgress(1);\n \n             if (matcher.isUserScan() && totalBytesRead > maxRowSize) {\n-              throw new RowTooBigException(\n-                  \"Max row size allowed: \" + maxRowSize + \", but the row is bigger than that.\");\n+              LOG.info(\"Max row size allowed: \" + maxRowSize\n+                + \", but the row is bigger than that, the row info: \" + CellUtil\n+                .toString(cell, true) + \", already have process row cells = \" + outResult.size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78123a18bfa74fb42cbab60d8d530eb5623ea3df"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk5NDkwMg==", "bodyText": "Is it necessary that we write out the log and throw the exception? With that we potentially have the same log entry twice.  Better would be to only have the exception with the full log message.", "url": "https://github.com/apache/hbase/pull/1379#discussion_r399994902", "createdAt": "2020-03-30T07:58:22Z", "author": {"login": "HorizonNet"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java", "diffHunk": "@@ -635,8 +635,12 @@ public boolean next(List<Cell> outResult, ScannerContext scannerContext) throws\n             scannerContext.incrementBatchProgress(1);\n \n             if (matcher.isUserScan() && totalBytesRead > maxRowSize) {\n-              throw new RowTooBigException(\n-                  \"Max row size allowed: \" + maxRowSize + \", but the row is bigger than that.\");\n+              LOG.info(\"Max row size allowed: \" + maxRowSize\n+                + \", but the row is bigger than that, the row info: \" + CellUtil\n+                .toString(cell, true) + \", already have process row cells = \" + outResult.size());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk5MTk3Mg=="}, "originalCommit": {"oid": "78123a18bfa74fb42cbab60d8d530eb5623ea3df"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDExNzA4Mw==", "bodyText": "@virajjasani  Done.", "url": "https://github.com/apache/hbase/pull/1379#discussion_r400117083", "createdAt": "2020-03-30T11:25:33Z", "author": {"login": "binlijin"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java", "diffHunk": "@@ -635,8 +635,12 @@ public boolean next(List<Cell> outResult, ScannerContext scannerContext) throws\n             scannerContext.incrementBatchProgress(1);\n \n             if (matcher.isUserScan() && totalBytesRead > maxRowSize) {\n-              throw new RowTooBigException(\n-                  \"Max row size allowed: \" + maxRowSize + \", but the row is bigger than that.\");\n+              LOG.info(\"Max row size allowed: \" + maxRowSize\n+                + \", but the row is bigger than that, the row info: \" + CellUtil\n+                .toString(cell, true) + \", already have process row cells = \" + outResult.size());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk5MTk3Mg=="}, "originalCommit": {"oid": "78123a18bfa74fb42cbab60d8d530eb5623ea3df"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDEyNjQ0MA==", "bodyText": "For region name, we might need this log. Log is worth for getRegionInfo().getRegionNameAsString(). WDYT @HorizonNet ?", "url": "https://github.com/apache/hbase/pull/1379#discussion_r400126440", "createdAt": "2020-03-30T11:43:28Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java", "diffHunk": "@@ -635,8 +635,12 @@ public boolean next(List<Cell> outResult, ScannerContext scannerContext) throws\n             scannerContext.incrementBatchProgress(1);\n \n             if (matcher.isUserScan() && totalBytesRead > maxRowSize) {\n-              throw new RowTooBigException(\n-                  \"Max row size allowed: \" + maxRowSize + \", but the row is bigger than that.\");\n+              LOG.info(\"Max row size allowed: \" + maxRowSize\n+                + \", but the row is bigger than that, the row info: \" + CellUtil\n+                .toString(cell, true) + \", already have process row cells = \" + outResult.size());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk5MTk3Mg=="}, "originalCommit": {"oid": "78123a18bfa74fb42cbab60d8d530eb5623ea3df"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDEyOTA2MA==", "bodyText": "@HorizonNet  regionserver log level default is INFO level and do not log the exception, the exception only return to client.", "url": "https://github.com/apache/hbase/pull/1379#discussion_r400129060", "createdAt": "2020-03-30T11:48:14Z", "author": {"login": "binlijin"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java", "diffHunk": "@@ -635,8 +635,12 @@ public boolean next(List<Cell> outResult, ScannerContext scannerContext) throws\n             scannerContext.incrementBatchProgress(1);\n \n             if (matcher.isUserScan() && totalBytesRead > maxRowSize) {\n-              throw new RowTooBigException(\n-                  \"Max row size allowed: \" + maxRowSize + \", but the row is bigger than that.\");\n+              LOG.info(\"Max row size allowed: \" + maxRowSize\n+                + \", but the row is bigger than that, the row info: \" + CellUtil\n+                .toString(cell, true) + \", already have process row cells = \" + outResult.size());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk5MTk3Mg=="}, "originalCommit": {"oid": "78123a18bfa74fb42cbab60d8d530eb5623ea3df"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDEzMDM1Nw==", "bodyText": "@virajjasani  Yes, already log the regionname in the latest commit.", "url": "https://github.com/apache/hbase/pull/1379#discussion_r400130357", "createdAt": "2020-03-30T11:50:43Z", "author": {"login": "binlijin"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java", "diffHunk": "@@ -635,8 +635,12 @@ public boolean next(List<Cell> outResult, ScannerContext scannerContext) throws\n             scannerContext.incrementBatchProgress(1);\n \n             if (matcher.isUserScan() && totalBytesRead > maxRowSize) {\n-              throw new RowTooBigException(\n-                  \"Max row size allowed: \" + maxRowSize + \", but the row is bigger than that.\");\n+              LOG.info(\"Max row size allowed: \" + maxRowSize\n+                + \", but the row is bigger than that, the row info: \" + CellUtil\n+                .toString(cell, true) + \", already have process row cells = \" + outResult.size());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk5MTk3Mg=="}, "originalCommit": {"oid": "78123a18bfa74fb42cbab60d8d530eb5623ea3df"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjEwNjQ5MA==", "bodyText": "The exception is not automatically logged?", "url": "https://github.com/apache/hbase/pull/1379#discussion_r402106490", "createdAt": "2020-04-02T07:31:06Z", "author": {"login": "HorizonNet"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java", "diffHunk": "@@ -635,8 +635,12 @@ public boolean next(List<Cell> outResult, ScannerContext scannerContext) throws\n             scannerContext.incrementBatchProgress(1);\n \n             if (matcher.isUserScan() && totalBytesRead > maxRowSize) {\n-              throw new RowTooBigException(\n-                  \"Max row size allowed: \" + maxRowSize + \", but the row is bigger than that.\");\n+              LOG.info(\"Max row size allowed: \" + maxRowSize\n+                + \", but the row is bigger than that, the row info: \" + CellUtil\n+                .toString(cell, true) + \", already have process row cells = \" + outResult.size());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk5MTk3Mg=="}, "originalCommit": {"oid": "78123a18bfa74fb42cbab60d8d530eb5623ea3df"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjExOTcyMQ==", "bodyText": "No, the exception is log only when RegionServer change log level to DEBUG/TRACE.", "url": "https://github.com/apache/hbase/pull/1379#discussion_r402119721", "createdAt": "2020-04-02T07:55:10Z", "author": {"login": "binlijin"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java", "diffHunk": "@@ -635,8 +635,12 @@ public boolean next(List<Cell> outResult, ScannerContext scannerContext) throws\n             scannerContext.incrementBatchProgress(1);\n \n             if (matcher.isUserScan() && totalBytesRead > maxRowSize) {\n-              throw new RowTooBigException(\n-                  \"Max row size allowed: \" + maxRowSize + \", but the row is bigger than that.\");\n+              LOG.info(\"Max row size allowed: \" + maxRowSize\n+                + \", but the row is bigger than that, the row info: \" + CellUtil\n+                .toString(cell, true) + \", already have process row cells = \" + outResult.size());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk5MTk3Mg=="}, "originalCommit": {"oid": "78123a18bfa74fb42cbab60d8d530eb5623ea3df"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxOTI0NQ==", "bodyText": "Ok. Go ahead.", "url": "https://github.com/apache/hbase/pull/1379#discussion_r403719245", "createdAt": "2020-04-05T15:45:32Z", "author": {"login": "HorizonNet"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java", "diffHunk": "@@ -635,8 +635,12 @@ public boolean next(List<Cell> outResult, ScannerContext scannerContext) throws\n             scannerContext.incrementBatchProgress(1);\n \n             if (matcher.isUserScan() && totalBytesRead > maxRowSize) {\n-              throw new RowTooBigException(\n-                  \"Max row size allowed: \" + maxRowSize + \", but the row is bigger than that.\");\n+              LOG.info(\"Max row size allowed: \" + maxRowSize\n+                + \", but the row is bigger than that, the row info: \" + CellUtil\n+                .toString(cell, true) + \", already have process row cells = \" + outResult.size());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk5MTk3Mg=="}, "originalCommit": {"oid": "78123a18bfa74fb42cbab60d8d530eb5623ea3df"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4MjE4MDg1OnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNToxMDoyNVrOF9ugCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMTowMTowOFrOF-BmTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI2OTMyMQ==", "bodyText": "I think the variable substitution ({}) here won't work. Didn't we had a better way for this in exceptions?", "url": "https://github.com/apache/hbase/pull/1379#discussion_r400269321", "createdAt": "2020-03-30T15:10:25Z", "author": {"login": "HorizonNet"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java", "diffHunk": "@@ -635,8 +635,14 @@ public boolean next(List<Cell> outResult, ScannerContext scannerContext) throws\n             scannerContext.incrementBatchProgress(1);\n \n             if (matcher.isUserScan() && totalBytesRead > maxRowSize) {\n-              throw new RowTooBigException(\n-                  \"Max row size allowed: \" + maxRowSize + \", but the row is bigger than that.\");\n+              LOG.warn(\"Max row size allowed: {}, but the row is bigger than that, the row info: \"\n+                  + \"{}, already have process row cells = {}, it belong to region = {}\",\n+                maxRowSize, CellUtil.toString(cell, true), outResult.size(),\n+                store.getHRegion().getRegionInfo().getRegionNameAsString());\n+              throw new RowTooBigException(\"Max row size allowed: \" + maxRowSize\n+                + \", but the row is bigger than that, the row info: \" + CellUtil\n+                .toString(cell, true) + \", it belong to region = {}\" + store.getHRegion()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "58c325fbfe4e605e82cf995efa357f59dee4ada4"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI3NTI2NQ==", "bodyText": "Oh yes, it would not work here. It works only for LOG. Looks like recent commit change @binlijin", "url": "https://github.com/apache/hbase/pull/1379#discussion_r400275265", "createdAt": "2020-03-30T15:17:36Z", "author": {"login": "virajjasani"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java", "diffHunk": "@@ -635,8 +635,14 @@ public boolean next(List<Cell> outResult, ScannerContext scannerContext) throws\n             scannerContext.incrementBatchProgress(1);\n \n             if (matcher.isUserScan() && totalBytesRead > maxRowSize) {\n-              throw new RowTooBigException(\n-                  \"Max row size allowed: \" + maxRowSize + \", but the row is bigger than that.\");\n+              LOG.warn(\"Max row size allowed: {}, but the row is bigger than that, the row info: \"\n+                  + \"{}, already have process row cells = {}, it belong to region = {}\",\n+                maxRowSize, CellUtil.toString(cell, true), outResult.size(),\n+                store.getHRegion().getRegionInfo().getRegionNameAsString());\n+              throw new RowTooBigException(\"Max row size allowed: \" + maxRowSize\n+                + \", but the row is bigger than that, the row info: \" + CellUtil\n+                .toString(cell, true) + \", it belong to region = {}\" + store.getHRegion()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI2OTMyMQ=="}, "originalCommit": {"oid": "58c325fbfe4e605e82cf995efa357f59dee4ada4"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4MjIyMA==", "bodyText": "ok, fix it.", "url": "https://github.com/apache/hbase/pull/1379#discussion_r400582220", "createdAt": "2020-03-31T01:01:08Z", "author": {"login": "binlijin"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java", "diffHunk": "@@ -635,8 +635,14 @@ public boolean next(List<Cell> outResult, ScannerContext scannerContext) throws\n             scannerContext.incrementBatchProgress(1);\n \n             if (matcher.isUserScan() && totalBytesRead > maxRowSize) {\n-              throw new RowTooBigException(\n-                  \"Max row size allowed: \" + maxRowSize + \", but the row is bigger than that.\");\n+              LOG.warn(\"Max row size allowed: {}, but the row is bigger than that, the row info: \"\n+                  + \"{}, already have process row cells = {}, it belong to region = {}\",\n+                maxRowSize, CellUtil.toString(cell, true), outResult.size(),\n+                store.getHRegion().getRegionInfo().getRegionNameAsString());\n+              throw new RowTooBigException(\"Max row size allowed: \" + maxRowSize\n+                + \", but the row is bigger than that, the row info: \" + CellUtil\n+                .toString(cell, true) + \", it belong to region = {}\" + store.getHRegion()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI2OTMyMQ=="}, "originalCommit": {"oid": "58c325fbfe4e605e82cf995efa357f59dee4ada4"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4MzE0MzMyOnYy", "diffSide": "RIGHT", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxODo1OToyMVrOF9330w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxODo1OToyMVrOF9330w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQyMjg2Nw==", "bodyText": "IMO client data shouldn't be logged at sever side. We can throw RowTooBigException with rowKey.", "url": "https://github.com/apache/hbase/pull/1379#discussion_r400422867", "createdAt": "2020-03-30T18:59:21Z", "author": {"login": "pankaj72981"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java", "diffHunk": "@@ -635,8 +635,14 @@ public boolean next(List<Cell> outResult, ScannerContext scannerContext) throws\n             scannerContext.incrementBatchProgress(1);\n \n             if (matcher.isUserScan() && totalBytesRead > maxRowSize) {\n-              throw new RowTooBigException(\n-                  \"Max row size allowed: \" + maxRowSize + \", but the row is bigger than that.\");\n+              LOG.warn(\"Max row size allowed: {}, but the row is bigger than that, the row info: \"\n+                  + \"{}, already have process row cells = {}, it belong to region = {}\",\n+                maxRowSize, CellUtil.toString(cell, true), outResult.size(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "58c325fbfe4e605e82cf995efa357f59dee4ada4"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1948, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}