{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxNzAyMjY3", "number": 2000, "title": "HBASE-24658 Update PolicyBasedChaosMonkey to handle uncaught exceptions", "bodyText": "Running ServerKillingChaosMonkey via RESTApiClusterManager for any\nduration of time slowly leaks region servers. I see failures on the\nRESTApi side go unreported on the ChaosMonkey side. It seems like\nRuntimeExceptions are being thrown and lost.\nPolicyBasedChaosMonkey uses a primitive means of thread management\nanyway. Update to use a thread pool, thread groups, and an\nuncaughtExceptionHandler.", "createdAt": "2020-06-29T23:38:03Z", "url": "https://github.com/apache/hbase/pull/2000", "merged": true, "mergeCommit": {"oid": "fbfff92bd57d14eadc15eec98a21f83f09a192e6"}, "closed": true, "closedAt": "2020-07-20T23:55:51Z", "author": {"login": "ndimiduk"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwYkwbgFqTQ0MDIwODE2Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc26nOkABqjM1NjgzMzU2ODY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwMjA4MTYy", "url": "https://github.com/apache/hbase/pull/2000#pullrequestreview-440208162", "createdAt": "2020-06-30T16:52:19Z", "commit": {"oid": "0883e6d239eb7bfda6fc29f159a20c43bfcd3154"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2MzY0NTQ1", "url": "https://github.com/apache/hbase/pull/2000#pullrequestreview-446364545", "createdAt": "2020-07-10T12:35:29Z", "commit": {"oid": "0883e6d239eb7bfda6fc29f159a20c43bfcd3154"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMjozNToyOVrOGv1pCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMjo0OTowNFrOGv2C1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjgxNTExNQ==", "bodyText": "nit: redundant", "url": "https://github.com/apache/hbase/pull/2000#discussion_r452815115", "createdAt": "2020-07-10T12:35:29Z", "author": {"login": "virajjasani"}, "path": "hbase-it/src/test/java/org/apache/hadoop/hbase/chaos/monkies/PolicyBasedChaosMonkey.java", "diffHunk": "@@ -38,14 +42,16 @@\n \n   private static final Logger LOG = LoggerFactory.getLogger(PolicyBasedChaosMonkey.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0883e6d239eb7bfda6fc29f159a20c43bfcd3154"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjgyMTcxNg==", "bodyText": "Would you prefer using our internal\nThreads.newDaemonThreadFactory(String prefix, UncaughtExceptionHandler handler) ?", "url": "https://github.com/apache/hbase/pull/2000#discussion_r452821716", "createdAt": "2020-07-10T12:49:04Z", "author": {"login": "virajjasani"}, "path": "hbase-it/src/test/java/org/apache/hadoop/hbase/chaos/monkies/PolicyBasedChaosMonkey.java", "diffHunk": "@@ -60,19 +66,30 @@ public PolicyBasedChaosMonkey(IntegrationTestingUtility util, Collection<Policy>\n   }\n \n   public PolicyBasedChaosMonkey(Properties monkeyProps, IntegrationTestingUtility util,\n-    Policy... policies) {\n-    this.monkeyProps = monkeyProps;\n-    this.util = util;\n-    this.policies = policies;\n+    Collection<Policy> policies) {\n+    this(monkeyProps, util, policies.toArray(new Policy[0]));\n   }\n \n   public PolicyBasedChaosMonkey(Properties monkeyProps, IntegrationTestingUtility util,\n-    Collection<Policy> policies) {\n+    Policy... policies) {\n     this.monkeyProps = monkeyProps;\n-    this.util = util;\n-    this.policies = policies.toArray(new Policy[policies.size()]);\n+    this.util = Objects.requireNonNull(util);\n+    this.policies = Objects.requireNonNull(policies);\n+    if (policies.length == 0) {\n+      throw new IllegalArgumentException(\"policies may not be empty\");\n+    }\n+    this.monkeyThreadPool = buildMonkeyThreadPool(policies.length);\n   }\n \n+  private static ExecutorService buildMonkeyThreadPool(final int size) {\n+    return Executors.newFixedThreadPool(size, new ThreadFactoryBuilder()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0883e6d239eb7bfda6fc29f159a20c43bfcd3154"}, "originalPosition": 71}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0883e6d239eb7bfda6fc29f159a20c43bfcd3154", "author": {"user": {"login": "ndimiduk", "name": "Nick Dimiduk"}}, "url": "https://github.com/apache/hbase/commit/0883e6d239eb7bfda6fc29f159a20c43bfcd3154", "committedDate": "2020-06-29T23:35:26Z", "message": "HBASE-24658 Update PolicyBasedChaosMonkey to handle uncaught exceptions\n\nRunning `ServerKillingChaosMonkey` via `RESTApiClusterManager` for any\nduration of time slowly leaks region servers. I see failures on the\nRESTApi side go unreported on the ChaosMonkey side. It seems like\n`RuntimeException`s are being thrown and lost.\n\n`PolicyBasedChaosMonkey` uses a primitive means of thread management\nanyway. Update to use a thread pool, thread groups, and an\nuncaughtExceptionHandler."}, "afterCommit": {"oid": "429bef788d706aba216536597ceb89d282b27231", "author": {"user": {"login": "ndimiduk", "name": "Nick Dimiduk"}}, "url": "https://github.com/apache/hbase/commit/429bef788d706aba216536597ceb89d282b27231", "committedDate": "2020-07-20T23:50:42Z", "message": "HBASE-24658 Update PolicyBasedChaosMonkey to handle uncaught exceptions\n\nRunning `ServerKillingChaosMonkey` via `RESTApiClusterManager` for any\nduration of time slowly leaks region servers. I see failures on the\nRESTApi side go unreported on the ChaosMonkey side. It seems like\n`RuntimeException`s are being thrown and lost.\n\n`PolicyBasedChaosMonkey` uses a primitive means of thread management\nanyway. Update to use a thread pool, thread groups, and an\nuncaughtExceptionHandler.\n\nSigned-off-by: Bharath Vissapragada <bharathv@apache.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9318c2e309027f04853f491d8f8721ecc078f80b", "author": {"user": {"login": "ndimiduk", "name": "Nick Dimiduk"}}, "url": "https://github.com/apache/hbase/commit/9318c2e309027f04853f491d8f8721ecc078f80b", "committedDate": "2020-07-20T23:54:46Z", "message": "HBASE-24658 Update PolicyBasedChaosMonkey to handle uncaught exceptions\n\nRunning `ServerKillingChaosMonkey` via `RESTApiClusterManager` for any\nduration of time slowly leaks region servers. I see failures on the\nRESTApi side go unreported on the ChaosMonkey side. It seems like\n`RuntimeException`s are being thrown and lost.\n\n`PolicyBasedChaosMonkey` uses a primitive means of thread management\nanyway. Update to use a thread pool, thread groups, and an\nuncaughtExceptionHandler.\n\nSigned-off-by: Bharath Vissapragada <bharathv@apache.org>\nSigned-off-by: Viraj Jasani <vjasani@apache.org>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "429bef788d706aba216536597ceb89d282b27231", "author": {"user": {"login": "ndimiduk", "name": "Nick Dimiduk"}}, "url": "https://github.com/apache/hbase/commit/429bef788d706aba216536597ceb89d282b27231", "committedDate": "2020-07-20T23:50:42Z", "message": "HBASE-24658 Update PolicyBasedChaosMonkey to handle uncaught exceptions\n\nRunning `ServerKillingChaosMonkey` via `RESTApiClusterManager` for any\nduration of time slowly leaks region servers. I see failures on the\nRESTApi side go unreported on the ChaosMonkey side. It seems like\n`RuntimeException`s are being thrown and lost.\n\n`PolicyBasedChaosMonkey` uses a primitive means of thread management\nanyway. Update to use a thread pool, thread groups, and an\nuncaughtExceptionHandler.\n\nSigned-off-by: Bharath Vissapragada <bharathv@apache.org>"}, "afterCommit": {"oid": "9318c2e309027f04853f491d8f8721ecc078f80b", "author": {"user": {"login": "ndimiduk", "name": "Nick Dimiduk"}}, "url": "https://github.com/apache/hbase/commit/9318c2e309027f04853f491d8f8721ecc078f80b", "committedDate": "2020-07-20T23:54:46Z", "message": "HBASE-24658 Update PolicyBasedChaosMonkey to handle uncaught exceptions\n\nRunning `ServerKillingChaosMonkey` via `RESTApiClusterManager` for any\nduration of time slowly leaks region servers. I see failures on the\nRESTApi side go unreported on the ChaosMonkey side. It seems like\n`RuntimeException`s are being thrown and lost.\n\n`PolicyBasedChaosMonkey` uses a primitive means of thread management\nanyway. Update to use a thread pool, thread groups, and an\nuncaughtExceptionHandler.\n\nSigned-off-by: Bharath Vissapragada <bharathv@apache.org>\nSigned-off-by: Viraj Jasani <vjasani@apache.org>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4436, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}