{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1Nzk3MTMw", "number": 1921, "title": "HBASE-24579: Failed SASL authentication does not result in an exception on client side", "bodyText": "read input stream even if the authentication is completed\nadd a test", "createdAt": "2020-06-17T11:45:42Z", "url": "https://github.com/apache/hbase/pull/1921", "merged": true, "mergeCommit": {"oid": "bd79c4065ccb13a5e217d844376b3e7b9489d2fe"}, "closed": true, "closedAt": "2020-06-18T11:25:44Z", "author": {"login": "BukrosSzabolcs"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsIX61gH2gAyNDM1Nzk3MTMwOjBlNWRlMzJhODlmMDQ2YjU0OGNhYWRlNmEzOThkNDk3OGNkOTllNTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsbgMWgFqTQzMzEzMDA0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0e5de32a89f046b548caade6a398d4978cd99e52", "author": {"user": {"login": "BukrosSzabolcs", "name": null}}, "url": "https://github.com/apache/hbase/commit/0e5de32a89f046b548caade6a398d4978cd99e52", "committedDate": "2020-06-17T11:44:07Z", "message": "HBASE-24579: Failed SASL authentication does not result in an exception on client side\n\nread input stream even if the auhentication is comleted\nadd a test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNDI0NDQ1", "url": "https://github.com/apache/hbase/pull/1921#pullrequestreview-432424445", "createdAt": "2020-06-17T13:52:59Z", "commit": {"oid": "0e5de32a89f046b548caade6a398d4978cd99e52"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxMzo1Mjo1OVrOGlG1Bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxMzo1ODo1OFrOGlHHJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU2MjM3NQ==", "bodyText": "Why not just catch IOException ?", "url": "https://github.com/apache/hbase/pull/1921#discussion_r441562375", "createdAt": "2020-06-17T13:52:59Z", "author": {"login": "virajjasani"}, "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcClient.java", "diffHunk": "@@ -148,6 +148,18 @@ public boolean saslConnect(InputStream inS, OutputStream outS) throws IOExceptio\n           inStream.readFully(saslToken);\n         }\n       }\n+\n+      if(isComplete()){\n+        try {\n+          readStatus(inStream);\n+        }\n+        catch (Exception e){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e5de32a89f046b548caade6a398d4978cd99e52"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU2MzY3Ng==", "bodyText": "Good to log at error level?", "url": "https://github.com/apache/hbase/pull/1921#discussion_r441563676", "createdAt": "2020-06-17T13:54:41Z", "author": {"login": "virajjasani"}, "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcClient.java", "diffHunk": "@@ -148,6 +148,18 @@ public boolean saslConnect(InputStream inS, OutputStream outS) throws IOExceptio\n           inStream.readFully(saslToken);\n         }\n       }\n+\n+      if(isComplete()){\n+        try {\n+          readStatus(inStream);\n+        }\n+        catch (Exception e){\n+          if(e instanceof RemoteException){\n+            LOG.debug(\"Sasl connection failed: \", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e5de32a89f046b548caade6a398d4978cd99e52"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU2NzAxMw==", "bodyText": "This should be out of if condition right? Don't we want to re-throw IOException other than RemoteException?\nWhich brings the question, why to even have if condition? I know RemoteException coming from readStatus is imp to us but we don't want to swallow IOException if inStream.readInt() throws one because inStream.readInt() is pre-requisite to know whether the status is SaslStatus.SUCCESS", "url": "https://github.com/apache/hbase/pull/1921#discussion_r441567013", "createdAt": "2020-06-17T13:58:58Z", "author": {"login": "virajjasani"}, "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcClient.java", "diffHunk": "@@ -148,6 +148,18 @@ public boolean saslConnect(InputStream inS, OutputStream outS) throws IOExceptio\n           inStream.readFully(saslToken);\n         }\n       }\n+\n+      if(isComplete()){\n+        try {\n+          readStatus(inStream);\n+        }\n+        catch (Exception e){\n+          if(e instanceof RemoteException){\n+            LOG.debug(\"Sasl connection failed: \", e);\n+            throw e;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e5de32a89f046b548caade6a398d4978cd99e52"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d9f0ab736e9ec110d70050984779c656dfcc344", "author": {"user": {"login": "BukrosSzabolcs", "name": null}}, "url": "https://github.com/apache/hbase/commit/0d9f0ab736e9ec110d70050984779c656dfcc344", "committedDate": "2020-06-17T15:43:32Z", "message": "HBASE-24579: Failed SASL authentication does not result in an exception on client side\n\nremove if condition\nonly catch IOExceptions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNjUxNDg4", "url": "https://github.com/apache/hbase/pull/1921#pullrequestreview-432651488", "createdAt": "2020-06-17T18:09:39Z", "commit": {"oid": "0d9f0ab736e9ec110d70050984779c656dfcc344"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNjc1ODcw", "url": "https://github.com/apache/hbase/pull/1921#pullrequestreview-432675870", "createdAt": "2020-06-17T18:43:03Z", "commit": {"oid": "0d9f0ab736e9ec110d70050984779c656dfcc344"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODo0MzowM1rOGlSdRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODo0MzowM1rOGlSdRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc1MjkwMQ==", "bodyText": "We still have this condition? I was talking about removing this condition because with this condition, we are swallowing IOException other than RemoteException, which we don't want to do. We want to re-throw all categories of IOException here, not just RemoteException.", "url": "https://github.com/apache/hbase/pull/1921#discussion_r441752901", "createdAt": "2020-06-17T18:43:03Z", "author": {"login": "virajjasani"}, "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcClient.java", "diffHunk": "@@ -148,6 +148,16 @@ public boolean saslConnect(InputStream inS, OutputStream outS) throws IOExceptio\n           inStream.readFully(saslToken);\n         }\n       }\n+\n+      try {\n+        readStatus(inStream);\n+      }\n+      catch (IOException e){\n+        if(e instanceof RemoteException){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d9f0ab736e9ec110d70050984779c656dfcc344"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzMTMwMDQ2", "url": "https://github.com/apache/hbase/pull/1921#pullrequestreview-433130046", "createdAt": "2020-06-18T10:01:21Z", "commit": {"oid": "0d9f0ab736e9ec110d70050984779c656dfcc344"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4339, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}