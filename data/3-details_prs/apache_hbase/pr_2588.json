{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEwMDYzNDE2", "number": 2588, "title": "HBASE-25220 Backport HBASE-24246 Miscellaneous hbck2 fixMeta bulk merge fixes: better logging around merges/overlap-fixing, 'HBCK Report' overlap listing, and configuration", "bodyText": "Includes addendum\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java\nFix weird brackets around each region name when logging.\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/MetaFixer.java\nLog when we hit the max merge limit. Also up limit to 64.\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/MergeTableRegionsProcedure.java\nMake logs make more sense to operator.\nhbase-server/src/main/resources/hbase-webapps/master/hbck.jsp\nMake RegionName show when you mouseover so long names don't mess up\ndisplay of holes and overlaps.\nAddress Mingliang Liu liuml07 feedback\nSigned-off-by: Peter Somogyi psomogyi@apache.org\nSigned-off-by: Mingliang Liu liuml07@apache.org\nAddendum to address minor feedback on text", "createdAt": "2020-10-26T14:19:43Z", "url": "https://github.com/apache/hbase/pull/2588", "merged": true, "mergeCommit": {"oid": "84cf1186d0a103aa62f788aa24f58aa3b815c2ac"}, "closed": true, "closedAt": "2020-10-26T20:16:17Z", "author": {"login": "petersomogyi"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWVFWQgH2gAyNTEwMDYzNDE2OmNlY2NhMmNmOTcwMTM1NGMxZjRlMDAxOThhMzEzNDFmNTBhNzI2YWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdWZGPqgFqTUxNzA4NDAyMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cecca2cf9701354c1f4e00198a31341f50a726ac", "author": {"user": {"login": "saintstack", "name": "Michael Stack"}}, "url": "https://github.com/apache/hbase/commit/cecca2cf9701354c1f4e00198a31341f50a726ac", "committedDate": "2020-10-26T14:17:25Z", "message": "HBASE-25220 Backport HBASE-24246 Miscellaneous hbck2 fixMeta bulk merge fixes: better logging around merges/overlap-fixing, 'HBCK Report' overlap listing, and configuration\n\nIncludes addendum\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java\n Fix weird brackets around each region name when logging.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/MetaFixer.java\n  Log when we hit the max merge limit. Also up limit to 64.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/MergeTableRegionsProcedure.java\n Make logs make more sense to operator.\n\nhbase-server/src/main/resources/hbase-webapps/master/hbck.jsp\n Make RegionName show when you mouseover so long names don't mess up\n display of holes and overlaps.\n\nAddress Mingliang Liu liuml07 feedback\n\nSigned-off-by: Peter Somogyi <psomogyi@apache.org>\nSigned-off-by: Mingliang Liu <liuml07@apache.org>\n\n Addendum to address minor feedback on text"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3MDg0MDIx", "url": "https://github.com/apache/hbase/pull/2588#pullrequestreview-517084021", "createdAt": "2020-10-26T18:55:19Z", "commit": {"oid": "cecca2cf9701354c1f4e00198a31341f50a726ac"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxODo1NToxOVrOHod9pA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxODo1NjozNVrOHoeAlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE5NjAwNA==", "bodyText": "Good", "url": "https://github.com/apache/hbase/pull/2588#discussion_r512196004", "createdAt": "2020-10-26T18:55:19Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/MetaFixer.java", "diffHunk": "@@ -247,6 +247,10 @@ void fixOverlaps(CatalogJanitor.Report report) throws IOException {\n       if (regionInfoWithlargestEndKey != null) {\n         if (!isOverlap(regionInfoWithlargestEndKey, pair) ||\n             currentMergeSet.size() >= maxMergeCount) {\n+          // Log when we cut-off-merge because we hit the configured maximum merge limit.\n+          if (currentMergeSet.size() >= maxMergeCount) {\n+            LOG.warn(\"Ran into maximum-at-a-time merges limit={}\", maxMergeCount);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cecca2cf9701354c1f4e00198a31341f50a726ac"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE5NjUzMQ==", "bodyText": "nit: we need the ' characters? we don't usually do this?", "url": "https://github.com/apache/hbase/pull/2588#discussion_r512196531", "createdAt": "2020-10-26T18:56:12Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/MergeTableRegionsProcedure.java", "diffHunk": "@@ -135,8 +134,8 @@ private static void checkRegionsToMerge(MasterProcedureEnv env, final RegionInfo\n           throw new MergeRegionException(msg);\n         }\n         if (!force && !ri.isAdjacent(previous) && !ri.isOverlap(previous)) {\n-          String msg = \"Unable to merge non-adjacent or non-overlapping regions \" +\n-              previous.getShortNameToLog() + \", \" + ri.getShortNameToLog() + \" when force=false\";\n+          String msg = \"Unable to merge non-adjacent or non-overlapping regions '\" +\n+              previous.getShortNameToLog() + \"', '\" + ri.getShortNameToLog() + \"' when force=false\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cecca2cf9701354c1f4e00198a31341f50a726ac"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE5Njc1Ng==", "bodyText": "Good", "url": "https://github.com/apache/hbase/pull/2588#discussion_r512196756", "createdAt": "2020-10-26T18:56:35Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/MergeTableRegionsProcedure.java", "diffHunk": "@@ -479,16 +478,20 @@ private boolean prepareMergeRegion(final MasterProcedureEnv env) throws IOExcept\n     for (RegionInfo ri: this.regionsToMerge) {\n       if (!catalogJanitor.cleanMergeQualifier(ri)) {\n         String msg = \"Skip merging \" + RegionInfo.getShortNameToLog(regionsToMerge) +\n-            \", because parent \" + RegionInfo.getShortNameToLog(ri) + \" has a merge qualifier\";\n+            \", because a parent, \" + RegionInfo.getShortNameToLog(ri) + \", has a merge qualifier \" +\n+          \"(if a 'merge column' in parent, it was recently merged but still has outstanding \" +\n+          \"references to its parents that must be cleared before it can participate in merge -- \" +\n+          \"major compact it to hurry clearing of its references)\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cecca2cf9701354c1f4e00198a31341f50a726ac"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4477, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}