{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxMDE4NTk3", "number": 1866, "title": "HBASE-24517 AssignmentManager.start should add meta region to ServerS\u2026", "bodyText": "\u2026tateNode", "createdAt": "2020-06-08T10:00:25Z", "url": "https://github.com/apache/hbase/pull/1866", "merged": true, "mergeCommit": {"oid": "2dd34b3f0177864380e06b56a1b80fab340d5662"}, "closed": true, "closedAt": "2020-06-09T00:14:01Z", "author": {"login": "Apache9"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpNe_0AH2gAyNDMxMDE4NTk3OjUyYmE5MDUxYjZhMTA2NTFjYTlhZDJlOTg4MDQwNzQ4YzI3NmZhYjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpP83VAFqTQyNjE5Nzc5NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "52ba9051b6a10651ca9ad2e988040748c276fab7", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/52ba9051b6a10651ca9ad2e988040748c276fab7", "committedDate": "2020-06-08T09:59:36Z", "message": "HBASE-24517 AssignmentManager.start should add meta region to ServerStateNode"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MTI4MjQw", "url": "https://github.com/apache/hbase/pull/1866#pullrequestreview-426128240", "createdAt": "2020-06-08T11:11:09Z", "commit": {"oid": "52ba9051b6a10651ca9ad2e988040748c276fab7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxMToxMTowOVrOGgZJ7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxMToxMTowOVrOGgZJ7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjYxOTc1Ng==", "bodyText": "Donot need lock because the master was started now? No other procedures runed at the same time?", "url": "https://github.com/apache/hbase/pull/1866#discussion_r436619756", "createdAt": "2020-06-08T11:11:09Z", "author": {"login": "infraio"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/AssignmentManager.java", "diffHunk": "@@ -231,17 +231,15 @@ public void start() throws IOException, KeeperException {\n       RegionState regionState = MetaTableLocator.getMetaRegionState(zkw);\n       RegionStateNode regionNode =\n         regionStates.getOrCreateRegionStateNode(RegionInfoBuilder.FIRST_META_REGIONINFO);\n-      regionNode.lock();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52ba9051b6a10651ca9ad2e988040748c276fab7"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MTI5NTc1", "url": "https://github.com/apache/hbase/pull/1866#pullrequestreview-426129575", "createdAt": "2020-06-08T11:13:24Z", "commit": {"oid": "52ba9051b6a10651ca9ad2e988040748c276fab7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxMToxMzoyNFrOGgZNoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxMToxMzoyNFrOGgZNoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjYyMDcwNA==", "bodyText": "Without this patch, the newRegions will not contains meta region?", "url": "https://github.com/apache/hbase/pull/1866#discussion_r436620704", "createdAt": "2020-06-08T11:13:24Z", "author": {"login": "infraio"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/master/assignment/TestAssignmentManagerLoadMetaRegionState.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hbase.master.assignment;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n+\n+import java.io.IOException;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Set;\n+import org.apache.hadoop.hbase.HBaseClassTestRule;\n+import org.apache.hadoop.hbase.HBaseTestingUtility;\n+import org.apache.hadoop.hbase.ServerName;\n+import org.apache.hadoop.hbase.client.RegionInfo;\n+import org.apache.hadoop.hbase.master.HMaster;\n+import org.apache.hadoop.hbase.testclassification.MasterTests;\n+import org.apache.hadoop.hbase.testclassification.MediumTests;\n+import org.junit.AfterClass;\n+import org.junit.BeforeClass;\n+import org.junit.ClassRule;\n+import org.junit.Test;\n+import org.junit.experimental.categories.Category;\n+\n+@Category({ MasterTests.class, MediumTests.class })\n+public class TestAssignmentManagerLoadMetaRegionState {\n+\n+  @ClassRule\n+  public static final HBaseClassTestRule CLASS_RULE =\n+    HBaseClassTestRule.forClass(TestAssignmentManagerLoadMetaRegionState.class);\n+\n+  private static final HBaseTestingUtility UTIL = new HBaseTestingUtility();\n+\n+  @BeforeClass\n+  public static void setUp() throws Exception {\n+    UTIL.startMiniCluster(1);\n+  }\n+\n+  @AfterClass\n+  public static void tearDown() throws IOException {\n+    UTIL.shutdownMiniCluster();\n+  }\n+\n+  @Test\n+  public void testRestart() throws InterruptedException, IOException {\n+    ServerName sn = UTIL.getMiniHBaseCluster().getRegionServer(0).getServerName();\n+    AssignmentManager am = UTIL.getMiniHBaseCluster().getMaster().getAssignmentManager();\n+    Set<RegionInfo> regions = new HashSet<>(am.getRegionsOnServer(sn));\n+\n+    UTIL.getMiniHBaseCluster().stopMaster(0).join();\n+    HMaster newMaster = UTIL.getMiniHBaseCluster().startMaster().getMaster();\n+    UTIL.waitFor(30000, () -> newMaster.isInitialized());\n+\n+    am = UTIL.getMiniHBaseCluster().getMaster().getAssignmentManager();\n+    List<RegionInfo> newRegions = am.getRegionsOnServer(sn);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52ba9051b6a10651ca9ad2e988040748c276fab7"}, "originalPosition": 70}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MTg3NjA2", "url": "https://github.com/apache/hbase/pull/1866#pullrequestreview-426187606", "createdAt": "2020-06-08T12:45:26Z", "commit": {"oid": "52ba9051b6a10651ca9ad2e988040748c276fab7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MTk3Nzk0", "url": "https://github.com/apache/hbase/pull/1866#pullrequestreview-426197794", "createdAt": "2020-06-08T12:52:02Z", "commit": {"oid": "52ba9051b6a10651ca9ad2e988040748c276fab7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4563, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}