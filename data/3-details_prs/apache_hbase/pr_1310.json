{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwNzEyMjAw", "number": 1310, "title": "HBASE-23957 [flakey test] client.TestMultiParallel fails to read hbas\u2026", "bodyText": "\u2026e-site.xml\nUse a customized hbase-site.xml for updating configuration, leave hbase-site.xml immutable under target/test-classes so it wont interrupt other parallel tests.", "createdAt": "2020-03-18T23:19:04Z", "url": "https://github.com/apache/hbase/pull/1310", "merged": true, "mergeCommit": {"oid": "542244056cf0be67fb39597a26a29051b07452ea"}, "closed": true, "closedAt": "2020-03-23T00:43:05Z", "author": {"login": "qiaoandxiang"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcPAGUhgFqTM3NzMxMDQ2Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcP3r7DABqjMxNTE4Nzg4Mjg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MzEwNDY2", "url": "https://github.com/apache/hbase/pull/1310#pullrequestreview-377310466", "createdAt": "2020-03-18T23:34:42Z", "commit": {"oid": "d63899057271ec7b2f2bb124d7f59548453be86b"}, "state": "COMMENTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQyMzozNDo0MlrOF4agaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQyMzo0MToyNVrOF4aotA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDY5ODg1Nw==", "bodyText": "Does it have to be static? Can these be done in @before per test?", "url": "https://github.com/apache/hbase/pull/1310#discussion_r394698857", "createdAt": "2020-03-18T23:34:42Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestAsyncClusterAdminApi.java", "diffHunk": "@@ -65,19 +67,47 @@\n   public static final HBaseClassTestRule CLASS_RULE =\n       HBaseClassTestRule.forClass(TestAsyncClusterAdminApi.class);\n \n-  private final Path cnfPath = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site.xml\");\n-  private final Path cnf2Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site2.xml\");\n-  private final Path cnf3Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site3.xml\");\n+  private static Path newCnfPath, newCnf2Path, newCnf3Path;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d63899057271ec7b2f2bb124d7f59548453be86b"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDY5OTIzNA==", "bodyText": "This is interesting. Do you not trust what you get from TEST_UTIL#getDataTestDir?", "url": "https://github.com/apache/hbase/pull/1310#discussion_r394699234", "createdAt": "2020-03-18T23:35:51Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestAsyncClusterAdminApi.java", "diffHunk": "@@ -65,19 +67,47 @@\n   public static final HBaseClassTestRule CLASS_RULE =\n       HBaseClassTestRule.forClass(TestAsyncClusterAdminApi.class);\n \n-  private final Path cnfPath = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site.xml\");\n-  private final Path cnf2Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site2.xml\");\n-  private final Path cnf3Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site3.xml\");\n+  private static Path newCnfPath, newCnf2Path, newCnf3Path;\n \n   @BeforeClass\n   public static void setUpBeforeClass() throws Exception {\n+    Path cnfPath = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site.xml\");\n+    Path cnf2Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site2.xml\");\n+    Path cnf3Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site3.xml\");\n+\n+    String absoluteDataPath = TEST_UTIL.getDataTestDir().toString();\n+    String dataBasePath = System.getProperty(HBaseCommonTestingUtility.BASE_TEST_DIRECTORY_KEY,\n+      HBaseCommonTestingUtility.DEFAULT_BASE_TEST_DIRECTORY);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d63899057271ec7b2f2bb124d7f59548453be86b"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDY5OTY1Nw==", "bodyText": "This is the dir above the test dir?", "url": "https://github.com/apache/hbase/pull/1310#discussion_r394699657", "createdAt": "2020-03-18T23:37:07Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestAsyncClusterAdminApi.java", "diffHunk": "@@ -65,19 +67,47 @@\n   public static final HBaseClassTestRule CLASS_RULE =\n       HBaseClassTestRule.forClass(TestAsyncClusterAdminApi.class);\n \n-  private final Path cnfPath = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site.xml\");\n-  private final Path cnf2Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site2.xml\");\n-  private final Path cnf3Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site3.xml\");\n+  private static Path newCnfPath, newCnf2Path, newCnf3Path;\n \n   @BeforeClass\n   public static void setUpBeforeClass() throws Exception {\n+    Path cnfPath = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site.xml\");\n+    Path cnf2Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site2.xml\");\n+    Path cnf3Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site3.xml\");\n+\n+    String absoluteDataPath = TEST_UTIL.getDataTestDir().toString();\n+    String dataBasePath = System.getProperty(HBaseCommonTestingUtility.BASE_TEST_DIRECTORY_KEY,\n+      HBaseCommonTestingUtility.DEFAULT_BASE_TEST_DIRECTORY);\n+\n+    String dataPath = absoluteDataPath.substring(absoluteDataPath.indexOf(dataBasePath));\n+    newCnfPath = Paths.get(dataPath + \"/hbase-site.xml\");\n+    newCnf2Path = Paths.get(dataPath + \"/hbase-site2.xml\");\n+    newCnf3Path = Paths.get(dataPath + \"/hbase-site3.xml\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d63899057271ec7b2f2bb124d7f59548453be86b"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDY5OTg2Mg==", "bodyText": "Is this inside the test dir?", "url": "https://github.com/apache/hbase/pull/1310#discussion_r394699862", "createdAt": "2020-03-18T23:37:50Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestAsyncClusterAdminApi.java", "diffHunk": "@@ -65,19 +67,47 @@\n   public static final HBaseClassTestRule CLASS_RULE =\n       HBaseClassTestRule.forClass(TestAsyncClusterAdminApi.class);\n \n-  private final Path cnfPath = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site.xml\");\n-  private final Path cnf2Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site2.xml\");\n-  private final Path cnf3Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site3.xml\");\n+  private static Path newCnfPath, newCnf2Path, newCnf3Path;\n \n   @BeforeClass\n   public static void setUpBeforeClass() throws Exception {\n+    Path cnfPath = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site.xml\");\n+    Path cnf2Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site2.xml\");\n+    Path cnf3Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site3.xml\");\n+\n+    String absoluteDataPath = TEST_UTIL.getDataTestDir().toString();\n+    String dataBasePath = System.getProperty(HBaseCommonTestingUtility.BASE_TEST_DIRECTORY_KEY,\n+      HBaseCommonTestingUtility.DEFAULT_BASE_TEST_DIRECTORY);\n+\n+    String dataPath = absoluteDataPath.substring(absoluteDataPath.indexOf(dataBasePath));\n+    newCnfPath = Paths.get(dataPath + \"/hbase-site.xml\");\n+    newCnf2Path = Paths.get(dataPath + \"/hbase-site2.xml\");\n+    newCnf3Path = Paths.get(dataPath + \"/hbase-site3.xml\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDY5OTY1Nw=="}, "originalCommit": {"oid": "d63899057271ec7b2f2bb124d7f59548453be86b"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDcwMDIwNg==", "bodyText": "loop?", "url": "https://github.com/apache/hbase/pull/1310#discussion_r394700206", "createdAt": "2020-03-18T23:38:44Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestAsyncClusterAdminApi.java", "diffHunk": "@@ -65,19 +67,47 @@\n   public static final HBaseClassTestRule CLASS_RULE =\n       HBaseClassTestRule.forClass(TestAsyncClusterAdminApi.class);\n \n-  private final Path cnfPath = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site.xml\");\n-  private final Path cnf2Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site2.xml\");\n-  private final Path cnf3Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site3.xml\");\n+  private static Path newCnfPath, newCnf2Path, newCnf3Path;\n \n   @BeforeClass\n   public static void setUpBeforeClass() throws Exception {\n+    Path cnfPath = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site.xml\");\n+    Path cnf2Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site2.xml\");\n+    Path cnf3Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site3.xml\");\n+\n+    String absoluteDataPath = TEST_UTIL.getDataTestDir().toString();\n+    String dataBasePath = System.getProperty(HBaseCommonTestingUtility.BASE_TEST_DIRECTORY_KEY,\n+      HBaseCommonTestingUtility.DEFAULT_BASE_TEST_DIRECTORY);\n+\n+    String dataPath = absoluteDataPath.substring(absoluteDataPath.indexOf(dataBasePath));\n+    newCnfPath = Paths.get(dataPath + \"/hbase-site.xml\");\n+    newCnf2Path = Paths.get(dataPath + \"/hbase-site2.xml\");\n+    newCnf3Path = Paths.get(dataPath + \"/hbase-site3.xml\");\n+\n+    // Copy Files from target/test-classes to data directory, this is to avoid messing up\n+    // the config file under target/test-class, which is supposed to be immutable.\n+    Files.createDirectories(Paths.get(dataPath));\n+    Files.copy(cnfPath, newCnfPath);\n+    Files.copy(cnf2Path, newCnf2Path);\n+    Files.copy(cnf3Path, newCnf3Path);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d63899057271ec7b2f2bb124d7f59548453be86b"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDcwMDQ4Mw==", "bodyText": "Did this get copied into the dir above? Which part?", "url": "https://github.com/apache/hbase/pull/1310#discussion_r394700483", "createdAt": "2020-03-18T23:39:41Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestAsyncClusterAdminApi.java", "diffHunk": "@@ -65,19 +67,47 @@\n   public static final HBaseClassTestRule CLASS_RULE =\n       HBaseClassTestRule.forClass(TestAsyncClusterAdminApi.class);\n \n-  private final Path cnfPath = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site.xml\");\n-  private final Path cnf2Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site2.xml\");\n-  private final Path cnf3Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site3.xml\");\n+  private static Path newCnfPath, newCnf2Path, newCnf3Path;\n \n   @BeforeClass\n   public static void setUpBeforeClass() throws Exception {\n+    Path cnfPath = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site.xml\");\n+    Path cnf2Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site2.xml\");\n+    Path cnf3Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site3.xml\");\n+\n+    String absoluteDataPath = TEST_UTIL.getDataTestDir().toString();\n+    String dataBasePath = System.getProperty(HBaseCommonTestingUtility.BASE_TEST_DIRECTORY_KEY,\n+      HBaseCommonTestingUtility.DEFAULT_BASE_TEST_DIRECTORY);\n+\n+    String dataPath = absoluteDataPath.substring(absoluteDataPath.indexOf(dataBasePath));\n+    newCnfPath = Paths.get(dataPath + \"/hbase-site.xml\");\n+    newCnf2Path = Paths.get(dataPath + \"/hbase-site2.xml\");\n+    newCnf3Path = Paths.get(dataPath + \"/hbase-site3.xml\");\n+\n+    // Copy Files from target/test-classes to data directory, this is to avoid messing up\n+    // the config file under target/test-class, which is supposed to be immutable.\n+    Files.createDirectories(Paths.get(dataPath));\n+    Files.copy(cnfPath, newCnfPath);\n+    Files.copy(cnf2Path, newCnf2Path);\n+    Files.copy(cnf3Path, newCnf3Path);\n+\n+    // Add the new custom config file to Configuration\n+    TEST_UTIL.getConfiguration().addResource(TEST_UTIL.getDataTestDir(\"hbase-site.xml\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d63899057271ec7b2f2bb124d7f59548453be86b"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDcwMDY5MQ==", "bodyText": "Interesting. Can we fix the base problem? Good find though.", "url": "https://github.com/apache/hbase/pull/1310#discussion_r394700691", "createdAt": "2020-03-18T23:40:26Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestAsyncClusterAdminApi.java", "diffHunk": "@@ -65,19 +67,47 @@\n   public static final HBaseClassTestRule CLASS_RULE =\n       HBaseClassTestRule.forClass(TestAsyncClusterAdminApi.class);\n \n-  private final Path cnfPath = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site.xml\");\n-  private final Path cnf2Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site2.xml\");\n-  private final Path cnf3Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site3.xml\");\n+  private static Path newCnfPath, newCnf2Path, newCnf3Path;\n \n   @BeforeClass\n   public static void setUpBeforeClass() throws Exception {\n+    Path cnfPath = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site.xml\");\n+    Path cnf2Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site2.xml\");\n+    Path cnf3Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site3.xml\");\n+\n+    String absoluteDataPath = TEST_UTIL.getDataTestDir().toString();\n+    String dataBasePath = System.getProperty(HBaseCommonTestingUtility.BASE_TEST_DIRECTORY_KEY,\n+      HBaseCommonTestingUtility.DEFAULT_BASE_TEST_DIRECTORY);\n+\n+    String dataPath = absoluteDataPath.substring(absoluteDataPath.indexOf(dataBasePath));\n+    newCnfPath = Paths.get(dataPath + \"/hbase-site.xml\");\n+    newCnf2Path = Paths.get(dataPath + \"/hbase-site2.xml\");\n+    newCnf3Path = Paths.get(dataPath + \"/hbase-site3.xml\");\n+\n+    // Copy Files from target/test-classes to data directory, this is to avoid messing up\n+    // the config file under target/test-class, which is supposed to be immutable.\n+    Files.createDirectories(Paths.get(dataPath));\n+    Files.copy(cnfPath, newCnfPath);\n+    Files.copy(cnf2Path, newCnf2Path);\n+    Files.copy(cnf3Path, newCnf3Path);\n+\n+    // Add the new custom config file to Configuration\n+    TEST_UTIL.getConfiguration().addResource(TEST_UTIL.getDataTestDir(\"hbase-site.xml\"));\n+\n     TEST_UTIL.getConfiguration().setInt(HConstants.MASTER_INFO_PORT, 0);\n     TEST_UTIL.getConfiguration().setInt(HConstants.HBASE_RPC_TIMEOUT_KEY, 60000);\n     TEST_UTIL.getConfiguration().setInt(HConstants.HBASE_CLIENT_OPERATION_TIMEOUT, 120000);\n     TEST_UTIL.getConfiguration().setInt(HConstants.HBASE_CLIENT_RETRIES_NUMBER, 2);\n     TEST_UTIL.getConfiguration().setInt(START_LOG_ERRORS_AFTER_COUNT_KEY, 0);\n     TEST_UTIL.startMiniCluster(2);\n     ASYNC_CONN = ConnectionFactory.createAsyncConnection(TEST_UTIL.getConfiguration()).get();\n+\n+    // The resources added to TEST_UTIL.conf is lost during Region Server Creation, hack it here\n+    // again.\n+    for (int i = 0; i < 2; i ++) {\n+      TEST_UTIL.getMiniHBaseCluster().getRegionServer(i).getConfiguration().\n+        addResource(TEST_UTIL.getDataTestDir(\"hbase-site.xml\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d63899057271ec7b2f2bb124d7f59548453be86b"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDcwMDk4MA==", "bodyText": "Duped code. Any way of sharing ?", "url": "https://github.com/apache/hbase/pull/1310#discussion_r394700980", "createdAt": "2020-03-18T23:41:25Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestUpdateConfiguration.java", "diffHunk": "@@ -47,31 +49,56 @@\n   private static final Logger LOG = LoggerFactory.getLogger(TestUpdateConfiguration.class);\n   private final static HBaseTestingUtility TEST_UTIL = new HBaseTestingUtility();\n \n+  private static Path newCnfPath, newCnf2Path, newCnf3Path;\n+\n   @BeforeClass\n   public static void setup() throws Exception {\n-    // Set master number and use default values for other options.\n+    Path cnfPath = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site.xml\");\n+    Path cnf2Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site2.xml\");\n+    Path cnf3Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site3.xml\");\n+\n+    String absoluteDataPath = TEST_UTIL.getDataTestDir().toString();\n+    String dataBasePath = System.getProperty(HBaseCommonTestingUtility.BASE_TEST_DIRECTORY_KEY,\n+      HBaseCommonTestingUtility.DEFAULT_BASE_TEST_DIRECTORY);\n+\n+    String dataPath = absoluteDataPath.substring(absoluteDataPath.indexOf(dataBasePath));\n+    newCnfPath = Paths.get(dataPath + \"/hbase-site.xml\");\n+    newCnf2Path = Paths.get(dataPath + \"/hbase-site2.xml\");\n+    newCnf3Path = Paths.get(dataPath + \"/hbase-site3.xml\");\n+\n+    // Copy Files from target/test-classes to data directory, this is to avoid messing up\n+    // the config file under target/test-class, which is supposed to be immutable.\n+    Files.createDirectories(Paths.get(dataPath));\n+    Files.copy(cnfPath, newCnfPath);\n+    Files.copy(cnf2Path, newCnf2Path);\n+    Files.copy(cnf3Path, newCnf3Path);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d63899057271ec7b2f2bb124d7f59548453be86b"}, "originalPosition": 39}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d63899057271ec7b2f2bb124d7f59548453be86b", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/d63899057271ec7b2f2bb124d7f59548453be86b", "committedDate": "2020-03-18T23:15:43Z", "message": "HBASE-23957 [flakey test] client.TestMultiParallel fails to read hbase-site.xml"}, "afterCommit": {"oid": "59e4fa1318244e34319e32d8e3fa5aab8accba6b", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/59e4fa1318244e34319e32d8e3fa5aab8accba6b", "committedDate": "2020-03-19T15:22:43Z", "message": "HBASE-23957 [flakey test] client.TestMultiParallel fails to read hbase-site.xml"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3OTI2NTA5", "url": "https://github.com/apache/hbase/pull/1310#pullrequestreview-377926509", "createdAt": "2020-03-19T17:11:35Z", "commit": {"oid": "59e4fa1318244e34319e32d8e3fa5aab8accba6b"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNzoxMTozNVrOF44Tyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNzoxMjowMlrOF44U8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE4NzE0Ng==", "bodyText": "Good comment.", "url": "https://github.com/apache/hbase/pull/1310#discussion_r395187146", "createdAt": "2020-03-19T17:11:35Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestAsyncClusterAdminApi.java", "diffHunk": "@@ -65,19 +67,51 @@\n   public static final HBaseClassTestRule CLASS_RULE =\n       HBaseClassTestRule.forClass(TestAsyncClusterAdminApi.class);\n \n-  private final Path cnfPath = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site.xml\");\n-  private final Path cnf2Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site2.xml\");\n-  private final Path cnf3Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site3.xml\");\n+  private static List<Path> newCnfPathes = new ArrayList<>();\n \n   @BeforeClass\n   public static void setUpBeforeClass() throws Exception {\n+    // Before this change, the test will update hbase-site.xml under target/test-classes and\n+    // trigger a config reload. Since target/test-classes/hbase-site.xml is being used by\n+    // other testing cases at the same time, this update will break other testing cases so it will\n+    // be flakey in nature.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59e4fa1318244e34319e32d8e3fa5aab8accba6b"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE4NzQ0MQ==", "bodyText": "Excellent", "url": "https://github.com/apache/hbase/pull/1310#discussion_r395187441", "createdAt": "2020-03-19T17:12:02Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestAsyncClusterAdminApi.java", "diffHunk": "@@ -65,19 +67,51 @@\n   public static final HBaseClassTestRule CLASS_RULE =\n       HBaseClassTestRule.forClass(TestAsyncClusterAdminApi.class);\n \n-  private final Path cnfPath = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site.xml\");\n-  private final Path cnf2Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site2.xml\");\n-  private final Path cnf3Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site3.xml\");\n+  private static List<Path> newCnfPathes = new ArrayList<>();\n \n   @BeforeClass\n   public static void setUpBeforeClass() throws Exception {\n+    // Before this change, the test will update hbase-site.xml under target/test-classes and\n+    // trigger a config reload. Since target/test-classes/hbase-site.xml is being used by\n+    // other testing cases at the same time, this update will break other testing cases so it will\n+    // be flakey in nature.\n+    // To avoid this, the change is to make target/test-classes/hbase-site.xml immutable. A new\n+    // hbase-site.xml will be created under its test data directory, i.e,\n+    // hbase-server/target/test-data/UUID, this new file will be added as a resource for the\n+    // config, new update will be applied to this new file and only visible to this specific test\n+    // case. The target/test-classes/hbase-site.xml will not be changed during the test.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59e4fa1318244e34319e32d8e3fa5aab8accba6b"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3OTU5NTYx", "url": "https://github.com/apache/hbase/pull/1310#pullrequestreview-377959561", "createdAt": "2020-03-19T17:51:38Z", "commit": {"oid": "59e4fa1318244e34319e32d8e3fa5aab8accba6b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNzo1MTozOVrOF456Ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxODoxMToyOVrOF46ojg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTIxMzM3MQ==", "bodyText": "You sure you should change the privacy here? The javadoc comment here literally says \"Should not be used by the unit tests, hence its's private.\" Seems like callers are supposed to use getDataTestDir", "url": "https://github.com/apache/hbase/pull/1310#discussion_r395213371", "createdAt": "2020-03-19T17:51:39Z", "author": {"login": "ndimiduk"}, "path": "hbase-common/src/test/java/org/apache/hadoop/hbase/HBaseCommonTestingUtility.java", "diffHunk": "@@ -207,7 +207,7 @@ boolean cleanupTestDir(final String subdir) {\n    *    Unit test will use a subdirectory of this directory.\n    * @see #setupDataTestDir()\n    */\n-  private Path getBaseTestDir() {\n+  public Path getBaseTestDir() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59e4fa1318244e34319e32d8e3fa5aab8accba6b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTIxNDcyMg==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/apache/hbase/pull/1310#discussion_r395214722", "createdAt": "2020-03-19T17:53:51Z", "author": {"login": "ndimiduk"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestAsyncClusterAdminApi.java", "diffHunk": "@@ -65,19 +67,51 @@\n   public static final HBaseClassTestRule CLASS_RULE =\n       HBaseClassTestRule.forClass(TestAsyncClusterAdminApi.class);\n \n-  private final Path cnfPath = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site.xml\");\n-  private final Path cnf2Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site2.xml\");\n-  private final Path cnf3Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site3.xml\");\n+  private static List<Path> newCnfPathes = new ArrayList<>();\n \n   @BeforeClass\n   public static void setUpBeforeClass() throws Exception {\n+    // Before this change, the test will update hbase-site.xml under target/test-classes and\n+    // trigger a config reload. Since target/test-classes/hbase-site.xml is being used by\n+    // other testing cases at the same time, this update will break other testing cases so it will\n+    // be flakey in nature.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE4NzE0Ng=="}, "originalCommit": {"oid": "59e4fa1318244e34319e32d8e3fa5aab8accba6b"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTIxNTU2MA==", "bodyText": "Yikes! Can you use the File or Path APIs instead of doing string manipulation?\nWhy is a relative path necessary anyway?", "url": "https://github.com/apache/hbase/pull/1310#discussion_r395215560", "createdAt": "2020-03-19T17:55:14Z", "author": {"login": "ndimiduk"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestAsyncClusterAdminApi.java", "diffHunk": "@@ -65,19 +67,51 @@\n   public static final HBaseClassTestRule CLASS_RULE =\n       HBaseClassTestRule.forClass(TestAsyncClusterAdminApi.class);\n \n-  private final Path cnfPath = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site.xml\");\n-  private final Path cnf2Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site2.xml\");\n-  private final Path cnf3Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site3.xml\");\n+  private static List<Path> newCnfPathes = new ArrayList<>();\n \n   @BeforeClass\n   public static void setUpBeforeClass() throws Exception {\n+    // Before this change, the test will update hbase-site.xml under target/test-classes and\n+    // trigger a config reload. Since target/test-classes/hbase-site.xml is being used by\n+    // other testing cases at the same time, this update will break other testing cases so it will\n+    // be flakey in nature.\n+    // To avoid this, the change is to make target/test-classes/hbase-site.xml immutable. A new\n+    // hbase-site.xml will be created under its test data directory, i.e,\n+    // hbase-server/target/test-data/UUID, this new file will be added as a resource for the\n+    // config, new update will be applied to this new file and only visible to this specific test\n+    // case. The target/test-classes/hbase-site.xml will not be changed during the test.\n+    String absoluteDataPath = TEST_UTIL.getDataTestDir().toString();\n+    String dataBasePath = TEST_UTIL.getBaseTestDir().toString();\n+    String dataPath = absoluteDataPath.substring(absoluteDataPath.indexOf(dataBasePath));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59e4fa1318244e34319e32d8e3fa5aab8accba6b"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTIxNjY5Ng==", "bodyText": "Please use the API of Path to build these. For example, Path(Path parent, String child) lets you create an instance from a base path plus a string for the child component.", "url": "https://github.com/apache/hbase/pull/1310#discussion_r395216696", "createdAt": "2020-03-19T17:57:05Z", "author": {"login": "ndimiduk"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestAsyncClusterAdminApi.java", "diffHunk": "@@ -65,19 +67,51 @@\n   public static final HBaseClassTestRule CLASS_RULE =\n       HBaseClassTestRule.forClass(TestAsyncClusterAdminApi.class);\n \n-  private final Path cnfPath = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site.xml\");\n-  private final Path cnf2Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site2.xml\");\n-  private final Path cnf3Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site3.xml\");\n+  private static List<Path> newCnfPathes = new ArrayList<>();\n \n   @BeforeClass\n   public static void setUpBeforeClass() throws Exception {\n+    // Before this change, the test will update hbase-site.xml under target/test-classes and\n+    // trigger a config reload. Since target/test-classes/hbase-site.xml is being used by\n+    // other testing cases at the same time, this update will break other testing cases so it will\n+    // be flakey in nature.\n+    // To avoid this, the change is to make target/test-classes/hbase-site.xml immutable. A new\n+    // hbase-site.xml will be created under its test data directory, i.e,\n+    // hbase-server/target/test-data/UUID, this new file will be added as a resource for the\n+    // config, new update will be applied to this new file and only visible to this specific test\n+    // case. The target/test-classes/hbase-site.xml will not be changed during the test.\n+    String absoluteDataPath = TEST_UTIL.getDataTestDir().toString();\n+    String dataBasePath = TEST_UTIL.getBaseTestDir().toString();\n+    String dataPath = absoluteDataPath.substring(absoluteDataPath.indexOf(dataBasePath));\n+    // Copy Files from target/test-classes to data directory, this is to avoid messing up\n+    // the config file under target/test-class, which is supposed to be immutable.\n+    Files.createDirectories(Paths.get(dataPath));\n+\n+    List<String> confs = Arrays.asList(\"/hbase-site.xml\", \"/hbase-site2.xml\", \"/hbase-site3.xml\");\n+    for (String conf : confs) {\n+      Path cnfPath = FileSystems.getDefault().getPath(\"target/test-classes\" + conf);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59e4fa1318244e34319e32d8e3fa5aab8accba6b"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTIyMDczOQ==", "bodyText": "Two questions:\n\ncan this test get away with starting only one region server instead of 2?\ncan you use a non-indexed for-loop over MiniHBaseCluster$getRegionServerThreads() instead of an indexed for-loop?", "url": "https://github.com/apache/hbase/pull/1310#discussion_r395220739", "createdAt": "2020-03-19T18:03:36Z", "author": {"login": "ndimiduk"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestAsyncClusterAdminApi.java", "diffHunk": "@@ -65,19 +67,51 @@\n   public static final HBaseClassTestRule CLASS_RULE =\n       HBaseClassTestRule.forClass(TestAsyncClusterAdminApi.class);\n \n-  private final Path cnfPath = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site.xml\");\n-  private final Path cnf2Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site2.xml\");\n-  private final Path cnf3Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site3.xml\");\n+  private static List<Path> newCnfPathes = new ArrayList<>();\n \n   @BeforeClass\n   public static void setUpBeforeClass() throws Exception {\n+    // Before this change, the test will update hbase-site.xml under target/test-classes and\n+    // trigger a config reload. Since target/test-classes/hbase-site.xml is being used by\n+    // other testing cases at the same time, this update will break other testing cases so it will\n+    // be flakey in nature.\n+    // To avoid this, the change is to make target/test-classes/hbase-site.xml immutable. A new\n+    // hbase-site.xml will be created under its test data directory, i.e,\n+    // hbase-server/target/test-data/UUID, this new file will be added as a resource for the\n+    // config, new update will be applied to this new file and only visible to this specific test\n+    // case. The target/test-classes/hbase-site.xml will not be changed during the test.\n+    String absoluteDataPath = TEST_UTIL.getDataTestDir().toString();\n+    String dataBasePath = TEST_UTIL.getBaseTestDir().toString();\n+    String dataPath = absoluteDataPath.substring(absoluteDataPath.indexOf(dataBasePath));\n+    // Copy Files from target/test-classes to data directory, this is to avoid messing up\n+    // the config file under target/test-class, which is supposed to be immutable.\n+    Files.createDirectories(Paths.get(dataPath));\n+\n+    List<String> confs = Arrays.asList(\"/hbase-site.xml\", \"/hbase-site2.xml\", \"/hbase-site3.xml\");\n+    for (String conf : confs) {\n+      Path cnfPath = FileSystems.getDefault().getPath(\"target/test-classes\" + conf);\n+      Path newConfPath = Paths.get(dataPath + conf);\n+      Files.copy(cnfPath, newConfPath);\n+      newCnfPathes.add(newConfPath);\n+    }\n+\n     TEST_UTIL.getConfiguration().setInt(HConstants.MASTER_INFO_PORT, 0);\n     TEST_UTIL.getConfiguration().setInt(HConstants.HBASE_RPC_TIMEOUT_KEY, 60000);\n     TEST_UTIL.getConfiguration().setInt(HConstants.HBASE_CLIENT_OPERATION_TIMEOUT, 120000);\n     TEST_UTIL.getConfiguration().setInt(HConstants.HBASE_CLIENT_RETRIES_NUMBER, 2);\n     TEST_UTIL.getConfiguration().setInt(START_LOG_ERRORS_AFTER_COUNT_KEY, 0);\n+\n+    // Add the new custom config file to Configuration\n+    TEST_UTIL.getConfiguration().addResource(TEST_UTIL.getDataTestDir(\"hbase-site.xml\"));\n     TEST_UTIL.startMiniCluster(2);\n     ASYNC_CONN = ConnectionFactory.createAsyncConnection(TEST_UTIL.getConfiguration()).get();\n+\n+    // The resources added to TEST_UTIL.conf is lost during Region Server Creation, hack it here\n+    // again.\n+    for (int i = 0; i < 2; i ++) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59e4fa1318244e34319e32d8e3fa5aab8accba6b"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTIyMzAxMQ==", "bodyText": "nit for other readers: since you're here cleaning up, can you use descriptive names for these variables? Instead of cnfPath{1,2,3} or this array of paths, how about\n\nrsConfigFilePath instead of cnfPath\noverwriteFilePath instead of cnf1Path\nrsConfigFileBackup instead of cnf3Path\n\nIMHO, descriptive variable names are better than comments. Just a suggestion :)", "url": "https://github.com/apache/hbase/pull/1310#discussion_r395223011", "createdAt": "2020-03-19T18:07:30Z", "author": {"login": "ndimiduk"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestAsyncClusterAdminApi.java", "diffHunk": "@@ -139,14 +173,14 @@ public void testAllClusterOnlineConfigChange() throws IOException {\n \n   private void replaceHBaseSiteXML() throws IOException {\n     // make a backup of hbase-site.xml\n-    Files.copy(cnfPath, cnf3Path, StandardCopyOption.REPLACE_EXISTING);\n+    Files.copy(newCnfPathes.get(0), newCnfPathes.get(2), StandardCopyOption.REPLACE_EXISTING);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59e4fa1318244e34319e32d8e3fa5aab8accba6b"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTIyMzk4Ng==", "bodyText": "same comments about using File or Path api instead of string manipulation.", "url": "https://github.com/apache/hbase/pull/1310#discussion_r395223986", "createdAt": "2020-03-19T18:09:11Z", "author": {"login": "ndimiduk"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestUpdateConfiguration.java", "diffHunk": "@@ -47,31 +51,61 @@\n   private static final Logger LOG = LoggerFactory.getLogger(TestUpdateConfiguration.class);\n   private final static HBaseTestingUtility TEST_UTIL = new HBaseTestingUtility();\n \n+  private static List<Path> newCnfPathes = new ArrayList<>();\n+\n   @BeforeClass\n   public static void setup() throws Exception {\n-    // Set master number and use default values for other options.\n+    // Before this change, the test will update hbase-site.xml under target/test-classes and\n+    // trigger a config reload. Since target/test-classes/hbase-site.xml is being used by\n+    // other testing cases at the same time, this update will break other testing cases so it will\n+    // be flakey in nature.\n+    // To avoid this, the change is to make target/test-classes/hbase-site.xml immutable. A new\n+    // hbase-site.xml will be created under its test data directory, i.e,\n+    // hbase-server/target/test-data/UUID, this new file will be added as a resource for the\n+    // config, new update will be applied to this new file and only visible to this specific test\n+    // case. The target/test-classes/hbase-site.xml will not be changed during the test.\n+    String absoluteDataPath = TEST_UTIL.getDataTestDir().toString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59e4fa1318244e34319e32d8e3fa5aab8accba6b"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTIyNDM5Nw==", "bodyText": "same comment about using iteration over all cluster members instead of hard-coding an assumed number.", "url": "https://github.com/apache/hbase/pull/1310#discussion_r395224397", "createdAt": "2020-03-19T18:09:56Z", "author": {"login": "ndimiduk"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestUpdateConfiguration.java", "diffHunk": "@@ -47,31 +51,61 @@\n   private static final Logger LOG = LoggerFactory.getLogger(TestUpdateConfiguration.class);\n   private final static HBaseTestingUtility TEST_UTIL = new HBaseTestingUtility();\n \n+  private static List<Path> newCnfPathes = new ArrayList<>();\n+\n   @BeforeClass\n   public static void setup() throws Exception {\n-    // Set master number and use default values for other options.\n+    // Before this change, the test will update hbase-site.xml under target/test-classes and\n+    // trigger a config reload. Since target/test-classes/hbase-site.xml is being used by\n+    // other testing cases at the same time, this update will break other testing cases so it will\n+    // be flakey in nature.\n+    // To avoid this, the change is to make target/test-classes/hbase-site.xml immutable. A new\n+    // hbase-site.xml will be created under its test data directory, i.e,\n+    // hbase-server/target/test-data/UUID, this new file will be added as a resource for the\n+    // config, new update will be applied to this new file and only visible to this specific test\n+    // case. The target/test-classes/hbase-site.xml will not be changed during the test.\n+    String absoluteDataPath = TEST_UTIL.getDataTestDir().toString();\n+    String dataBasePath = TEST_UTIL.getBaseTestDir().toString();\n+\n+    String dataPath = absoluteDataPath.substring(absoluteDataPath.indexOf(dataBasePath));\n+    // Copy Files from target/test-classes to data directory, this is to avoid messing up\n+    // the config file under target/test-class, which is supposed to be immutable.\n+    Files.createDirectories(Paths.get(dataPath));\n+\n+    List<String> confs = Arrays.asList(\"/hbase-site.xml\", \"/hbase-site2.xml\", \"/hbase-site3.xml\");\n+    for (String conf : confs) {\n+      Path cnfPath = FileSystems.getDefault().getPath(\"target/test-classes\" + conf);\n+      Path newConfPath = Paths.get(dataPath + conf);\n+      Files.copy(cnfPath, newConfPath);\n+      newCnfPathes.add(newConfPath);\n+    }\n+\n+    // Add the new custom config file to Configuration\n+    TEST_UTIL.getConfiguration().addResource(TEST_UTIL.getDataTestDir(\"hbase-site.xml\"));\n     StartMiniClusterOption option = StartMiniClusterOption.builder().numMasters(2).build();\n     TEST_UTIL.startMiniCluster(option);\n+\n+    // The resources added to TEST_UTIL.conf is lost during Region Server Creation, hack it here\n+    // again.\n+    TEST_UTIL.getMiniHBaseCluster().getRegionServer(0).getConfiguration().", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59e4fa1318244e34319e32d8e3fa5aab8accba6b"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTIyNTA2Ng==", "bodyText": "for places where you want to refer to the test's method name, JUnit provides an API for this. Check out org.junit.rules.TestName. It's used throughout the code base.", "url": "https://github.com/apache/hbase/pull/1310#discussion_r395225066", "createdAt": "2020-03-19T18:11:10Z", "author": {"login": "ndimiduk"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestUpdateConfiguration.java", "diffHunk": "@@ -47,31 +51,61 @@\n   private static final Logger LOG = LoggerFactory.getLogger(TestUpdateConfiguration.class);\n   private final static HBaseTestingUtility TEST_UTIL = new HBaseTestingUtility();\n \n+  private static List<Path> newCnfPathes = new ArrayList<>();\n+\n   @BeforeClass\n   public static void setup() throws Exception {\n-    // Set master number and use default values for other options.\n+    // Before this change, the test will update hbase-site.xml under target/test-classes and\n+    // trigger a config reload. Since target/test-classes/hbase-site.xml is being used by\n+    // other testing cases at the same time, this update will break other testing cases so it will\n+    // be flakey in nature.\n+    // To avoid this, the change is to make target/test-classes/hbase-site.xml immutable. A new\n+    // hbase-site.xml will be created under its test data directory, i.e,\n+    // hbase-server/target/test-data/UUID, this new file will be added as a resource for the\n+    // config, new update will be applied to this new file and only visible to this specific test\n+    // case. The target/test-classes/hbase-site.xml will not be changed during the test.\n+    String absoluteDataPath = TEST_UTIL.getDataTestDir().toString();\n+    String dataBasePath = TEST_UTIL.getBaseTestDir().toString();\n+\n+    String dataPath = absoluteDataPath.substring(absoluteDataPath.indexOf(dataBasePath));\n+    // Copy Files from target/test-classes to data directory, this is to avoid messing up\n+    // the config file under target/test-class, which is supposed to be immutable.\n+    Files.createDirectories(Paths.get(dataPath));\n+\n+    List<String> confs = Arrays.asList(\"/hbase-site.xml\", \"/hbase-site2.xml\", \"/hbase-site3.xml\");\n+    for (String conf : confs) {\n+      Path cnfPath = FileSystems.getDefault().getPath(\"target/test-classes\" + conf);\n+      Path newConfPath = Paths.get(dataPath + conf);\n+      Files.copy(cnfPath, newConfPath);\n+      newCnfPathes.add(newConfPath);\n+    }\n+\n+    // Add the new custom config file to Configuration\n+    TEST_UTIL.getConfiguration().addResource(TEST_UTIL.getDataTestDir(\"hbase-site.xml\"));\n     StartMiniClusterOption option = StartMiniClusterOption.builder().numMasters(2).build();\n     TEST_UTIL.startMiniCluster(option);\n+\n+    // The resources added to TEST_UTIL.conf is lost during Region Server Creation, hack it here\n+    // again.\n+    TEST_UTIL.getMiniHBaseCluster().getRegionServer(0).getConfiguration().\n+      addResource(TEST_UTIL.getDataTestDir(\"hbase-site.xml\"));\n   }\n \n   @Test\n   public void testOnlineConfigChange() throws IOException {\n-    LOG.debug(\"Starting the test\");\n+    LOG.debug(\"Starting the test testOnlineConfigChange\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59e4fa1318244e34319e32d8e3fa5aab8accba6b"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTIyNTIzMA==", "bodyText": "same comment about descriptive variable names.", "url": "https://github.com/apache/hbase/pull/1310#discussion_r395225230", "createdAt": "2020-03-19T18:11:29Z", "author": {"login": "ndimiduk"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestUpdateConfiguration.java", "diffHunk": "@@ -47,31 +51,61 @@\n   private static final Logger LOG = LoggerFactory.getLogger(TestUpdateConfiguration.class);\n   private final static HBaseTestingUtility TEST_UTIL = new HBaseTestingUtility();\n \n+  private static List<Path> newCnfPathes = new ArrayList<>();\n+\n   @BeforeClass\n   public static void setup() throws Exception {\n-    // Set master number and use default values for other options.\n+    // Before this change, the test will update hbase-site.xml under target/test-classes and\n+    // trigger a config reload. Since target/test-classes/hbase-site.xml is being used by\n+    // other testing cases at the same time, this update will break other testing cases so it will\n+    // be flakey in nature.\n+    // To avoid this, the change is to make target/test-classes/hbase-site.xml immutable. A new\n+    // hbase-site.xml will be created under its test data directory, i.e,\n+    // hbase-server/target/test-data/UUID, this new file will be added as a resource for the\n+    // config, new update will be applied to this new file and only visible to this specific test\n+    // case. The target/test-classes/hbase-site.xml will not be changed during the test.\n+    String absoluteDataPath = TEST_UTIL.getDataTestDir().toString();\n+    String dataBasePath = TEST_UTIL.getBaseTestDir().toString();\n+\n+    String dataPath = absoluteDataPath.substring(absoluteDataPath.indexOf(dataBasePath));\n+    // Copy Files from target/test-classes to data directory, this is to avoid messing up\n+    // the config file under target/test-class, which is supposed to be immutable.\n+    Files.createDirectories(Paths.get(dataPath));\n+\n+    List<String> confs = Arrays.asList(\"/hbase-site.xml\", \"/hbase-site2.xml\", \"/hbase-site3.xml\");\n+    for (String conf : confs) {\n+      Path cnfPath = FileSystems.getDefault().getPath(\"target/test-classes\" + conf);\n+      Path newConfPath = Paths.get(dataPath + conf);\n+      Files.copy(cnfPath, newConfPath);\n+      newCnfPathes.add(newConfPath);\n+    }\n+\n+    // Add the new custom config file to Configuration\n+    TEST_UTIL.getConfiguration().addResource(TEST_UTIL.getDataTestDir(\"hbase-site.xml\"));\n     StartMiniClusterOption option = StartMiniClusterOption.builder().numMasters(2).build();\n     TEST_UTIL.startMiniCluster(option);\n+\n+    // The resources added to TEST_UTIL.conf is lost during Region Server Creation, hack it here\n+    // again.\n+    TEST_UTIL.getMiniHBaseCluster().getRegionServer(0).getConfiguration().\n+      addResource(TEST_UTIL.getDataTestDir(\"hbase-site.xml\"));\n   }\n \n   @Test\n   public void testOnlineConfigChange() throws IOException {\n-    LOG.debug(\"Starting the test\");\n+    LOG.debug(\"Starting the test testOnlineConfigChange\");\n     Admin admin = TEST_UTIL.getAdmin();\n     ServerName server = TEST_UTIL.getHBaseCluster().getRegionServer(0).getServerName();\n     admin.updateConfiguration(server);\n   }\n \n   @Test\n   public void testMasterOnlineConfigChange() throws IOException {\n-    LOG.debug(\"Starting the test\");\n-    Path cnfPath = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site.xml\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59e4fa1318244e34319e32d8e3fa5aab8accba6b"}, "originalPosition": 69}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "59e4fa1318244e34319e32d8e3fa5aab8accba6b", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/59e4fa1318244e34319e32d8e3fa5aab8accba6b", "committedDate": "2020-03-19T15:22:43Z", "message": "HBASE-23957 [flakey test] client.TestMultiParallel fails to read hbase-site.xml"}, "afterCommit": {"oid": "72fa7605843c19bb626e1370c84f330d1d946577", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/72fa7605843c19bb626e1370c84f330d1d946577", "committedDate": "2020-03-20T00:45:23Z", "message": "HBASE-23957 [flakey test] client.TestMultiParallel fails to read hbase-site.xml"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "72fa7605843c19bb626e1370c84f330d1d946577", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/72fa7605843c19bb626e1370c84f330d1d946577", "committedDate": "2020-03-20T00:45:23Z", "message": "HBASE-23957 [flakey test] client.TestMultiParallel fails to read hbase-site.xml"}, "afterCommit": {"oid": "2200d1a5bd5f2cb072f410202c0196f764ab6212", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/2200d1a5bd5f2cb072f410202c0196f764ab6212", "committedDate": "2020-03-20T17:05:51Z", "message": "HBASE-23957 [flakey test] client.TestMultiParallel fails to read hbase-site.xml"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2200d1a5bd5f2cb072f410202c0196f764ab6212", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/2200d1a5bd5f2cb072f410202c0196f764ab6212", "committedDate": "2020-03-20T17:05:51Z", "message": "HBASE-23957 [flakey test] client.TestMultiParallel fails to read hbase-site.xml"}, "afterCommit": {"oid": "e4d6677e4335ecd109fe31c4987da83ed95237dd", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/e4d6677e4335ecd109fe31c4987da83ed95237dd", "committedDate": "2020-03-20T19:15:55Z", "message": "HBASE-23957 [flakey test] client.TestMultiParallel fails to read hbase-site.xml"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4ODA0NzMz", "url": "https://github.com/apache/hbase/pull/1310#pullrequestreview-378804733", "createdAt": "2020-03-20T20:52:14Z", "commit": {"oid": "e4d6677e4335ecd109fe31c4987da83ed95237dd"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMDo1MjoxNVrOF5i3fg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMDo1MjoxNVrOF5i3fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg4NDQxNA==", "bodyText": "nit: This class could have comment up here on what it is for and what it provides?", "url": "https://github.com/apache/hbase/pull/1310#discussion_r395884414", "createdAt": "2020-03-20T20:52:15Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/AbstractTestUpdateConfiguration.java", "diffHunk": "@@ -0,0 +1,100 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hbase.client;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.nio.file.StandardCopyOption;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import org.apache.hadoop.hbase.HBaseTestingUtility;\n+import org.apache.hadoop.hbase.util.JVMClusterUtil.RegionServerThread;\n+\n+/**\n+ * Base class to test Configuration Update logic.\n+ */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4d6677e4335ecd109fe31c4987da83ed95237dd"}, "originalPosition": 33}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e4d6677e4335ecd109fe31c4987da83ed95237dd", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/e4d6677e4335ecd109fe31c4987da83ed95237dd", "committedDate": "2020-03-20T19:15:55Z", "message": "HBASE-23957 [flakey test] client.TestMultiParallel fails to read hbase-site.xml"}, "afterCommit": {"oid": "f80dd68d3c2104ba5d96c8dea97cb37b784aa896", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/f80dd68d3c2104ba5d96c8dea97cb37b784aa896", "committedDate": "2020-03-20T21:44:21Z", "message": "HBASE-23957 [flakey test] client.TestMultiParallel fails to read hbase-site.xml"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4ODI3MjUw", "url": "https://github.com/apache/hbase/pull/1310#pullrequestreview-378827250", "createdAt": "2020-03-20T21:40:18Z", "commit": {"oid": "e4d6677e4335ecd109fe31c4987da83ed95237dd"}, "state": "APPROVED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMTo0MDoxOFrOF5j8QA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMTo1MDoxOFrOF5kJCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkwMjAxNg==", "bodyText": "+1", "url": "https://github.com/apache/hbase/pull/1310#discussion_r395902016", "createdAt": "2020-03-20T21:40:18Z", "author": {"login": "ndimiduk"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/AbstractTestUpdateConfiguration.java", "diffHunk": "@@ -0,0 +1,100 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hbase.client;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.nio.file.StandardCopyOption;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import org.apache.hadoop.hbase.HBaseTestingUtility;\n+import org.apache.hadoop.hbase.util.JVMClusterUtil.RegionServerThread;\n+\n+/**\n+ * Base class to test Configuration Update logic.\n+ */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg4NDQxNA=="}, "originalCommit": {"oid": "e4d6677e4335ecd109fe31c4987da83ed95237dd"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkwMzg1OA==", "bodyText": "Why track indices when you could just have three variables like\nprivate static final String SERVER_CONFIG = \"hbase-site.xml\";\nprivate static final String OVERWRITE_SERVER_CONFIG = \"hbase-site2.xml\";\n...\nThis is what I meant in my earlier comment about descriptive variable names.\nAnd for easier debugging, why call the file names 1, 2, 3 -- they can be named whatever we want since we're manually adding them as resources. Might as well make the file names descriptive too, so someone doing forensics later can have a clue. Something like \"copy-of-hbase-site.xml\", \"overrides-for-test-hbase-site.xml\", &c.", "url": "https://github.com/apache/hbase/pull/1310#discussion_r395903858", "createdAt": "2020-03-20T21:45:51Z", "author": {"login": "ndimiduk"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/AbstractTestUpdateConfiguration.java", "diffHunk": "@@ -0,0 +1,100 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hbase.client;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.nio.file.StandardCopyOption;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import org.apache.hadoop.hbase.HBaseTestingUtility;\n+import org.apache.hadoop.hbase.util.JVMClusterUtil.RegionServerThread;\n+\n+/**\n+ * Base class to test Configuration Update logic.\n+ */\n+public abstract class AbstractTestUpdateConfiguration {\n+  private static final int SERVER_CONFIG_INDEX  = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4d6677e4335ecd109fe31c4987da83ed95237dd"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkwNDY3Ng==", "bodyText": "Again you're concatenating strings instead of using the API as provided. How about\nfinal Path confPath = Paths.get(\"target\", \"test-classes\", \"hbase-site.xml\");", "url": "https://github.com/apache/hbase/pull/1310#discussion_r395904676", "createdAt": "2020-03-20T21:48:12Z", "author": {"login": "ndimiduk"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/AbstractTestUpdateConfiguration.java", "diffHunk": "@@ -0,0 +1,102 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hbase.client;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.nio.file.StandardCopyOption;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import org.apache.hadoop.hbase.HBaseTestingUtility;\n+import org.apache.hadoop.hbase.util.JVMClusterUtil.RegionServerThread;\n+\n+/**\n+ * Base class to test Configuration Update logic. It wraps up things needed to\n+ * test configuration change and provides utility methods for test cluster setup,\n+ * updating/restoring configuration file.\n+ */\n+public abstract class AbstractTestUpdateConfiguration {\n+  private static final int SERVER_CONFIG_INDEX  = 0;\n+  private static final int OVERWRITE_SERVER_CONFIG_INDEX  = 1;\n+  private static final int BACKUP_SERVER_CONFIG_INDEX  = 2;\n+  private static List<Path> newCnfPathes = new ArrayList<>();\n+\n+  protected static void setUpConfigurationFiles(final HBaseTestingUtility testUtil)\n+    throws Exception {\n+    // Before this change, the test will update hbase-site.xml under target/test-classes and\n+    // trigger a config reload. Since target/test-classes/hbase-site.xml is being used by\n+    // other testing cases at the same time, this update will break other testing cases so it will\n+    // be flakey in nature.\n+    // To avoid this, the change is to make target/test-classes/hbase-site.xml immutable. A new\n+    // hbase-site.xml will be created under its test data directory, i.e,\n+    // hbase-server/target/test-data/UUID, this new file will be added as a resource for the\n+    // config, new update will be applied to this new file and only visible to this specific test\n+    // case. The target/test-classes/hbase-site.xml will not be changed during the test.\n+\n+    String absoluteDataPath = testUtil.getDataTestDir().toString();\n+\n+    // Copy Files from target/test-classes to test-data directory, this is to avoid messing up\n+    // the config file under target/test-class, which is supposed to be immutable.\n+    Files.createDirectories(Paths.get(absoluteDataPath));\n+\n+    List<String> confs = Arrays.asList(\"/hbase-site.xml\", \"/hbase-site2.xml\", \"/hbase-site3.xml\");\n+    for (String conf : confs) {\n+      Path cnfPath = Paths.get(\"target/test-classes\" + conf);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f80dd68d3c2104ba5d96c8dea97cb37b784aa896"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkwNTA1MA==", "bodyText": "good.", "url": "https://github.com/apache/hbase/pull/1310#discussion_r395905050", "createdAt": "2020-03-20T21:49:24Z", "author": {"login": "ndimiduk"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/AbstractTestUpdateConfiguration.java", "diffHunk": "@@ -0,0 +1,102 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hbase.client;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.nio.file.StandardCopyOption;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import org.apache.hadoop.hbase.HBaseTestingUtility;\n+import org.apache.hadoop.hbase.util.JVMClusterUtil.RegionServerThread;\n+\n+/**\n+ * Base class to test Configuration Update logic. It wraps up things needed to\n+ * test configuration change and provides utility methods for test cluster setup,\n+ * updating/restoring configuration file.\n+ */\n+public abstract class AbstractTestUpdateConfiguration {\n+  private static final int SERVER_CONFIG_INDEX  = 0;\n+  private static final int OVERWRITE_SERVER_CONFIG_INDEX  = 1;\n+  private static final int BACKUP_SERVER_CONFIG_INDEX  = 2;\n+  private static List<Path> newCnfPathes = new ArrayList<>();\n+\n+  protected static void setUpConfigurationFiles(final HBaseTestingUtility testUtil)\n+    throws Exception {\n+    // Before this change, the test will update hbase-site.xml under target/test-classes and\n+    // trigger a config reload. Since target/test-classes/hbase-site.xml is being used by\n+    // other testing cases at the same time, this update will break other testing cases so it will\n+    // be flakey in nature.\n+    // To avoid this, the change is to make target/test-classes/hbase-site.xml immutable. A new\n+    // hbase-site.xml will be created under its test data directory, i.e,\n+    // hbase-server/target/test-data/UUID, this new file will be added as a resource for the\n+    // config, new update will be applied to this new file and only visible to this specific test\n+    // case. The target/test-classes/hbase-site.xml will not be changed during the test.\n+\n+    String absoluteDataPath = testUtil.getDataTestDir().toString();\n+\n+    // Copy Files from target/test-classes to test-data directory, this is to avoid messing up\n+    // the config file under target/test-class, which is supposed to be immutable.\n+    Files.createDirectories(Paths.get(absoluteDataPath));\n+\n+    List<String> confs = Arrays.asList(\"/hbase-site.xml\", \"/hbase-site2.xml\", \"/hbase-site3.xml\");\n+    for (String conf : confs) {\n+      Path cnfPath = Paths.get(\"target/test-classes\" + conf);\n+      Path newConfPath = Paths.get(absoluteDataPath + conf);\n+\n+      // Do not copy the last one as it does not exist\n+      if (!conf.equals(\"/hbase-site3.xml\")) {\n+        Files.copy(cnfPath, newConfPath);\n+      }\n+      newCnfPathes.add(newConfPath);\n+    }\n+\n+    // Add the new custom config file to Configuration\n+    testUtil.getConfiguration().addResource(testUtil.getDataTestDir(\"hbase-site.xml\"));\n+  }\n+\n+  protected static void addResourceToRegionServerConfiguration(final HBaseTestingUtility testUtil) {\n+    // When RegionServer is created in MiniHBaseCluster, it uses HBaseConfiguration.create(conf) of\n+    // the master Configuration. The create() just copies config params over, it does not do\n+    // a clone for a historic reason. Properties such as resources are lost during this process.\n+    // Exposing a new method in HBaseConfiguration causes confusion. Instead, the new hbase-site.xml\n+    // under test-data directory is added to RegionServer's configuration as a workaround.\n+    for (RegionServerThread rsThread : testUtil.getMiniHBaseCluster().getRegionServerThreads()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f80dd68d3c2104ba5d96c8dea97cb37b784aa896"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkwNTI5MQ==", "bodyText": "i'm surprised an hbase-site2.xml exists.", "url": "https://github.com/apache/hbase/pull/1310#discussion_r395905291", "createdAt": "2020-03-20T21:50:18Z", "author": {"login": "ndimiduk"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/AbstractTestUpdateConfiguration.java", "diffHunk": "@@ -0,0 +1,102 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hbase.client;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.nio.file.StandardCopyOption;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import org.apache.hadoop.hbase.HBaseTestingUtility;\n+import org.apache.hadoop.hbase.util.JVMClusterUtil.RegionServerThread;\n+\n+/**\n+ * Base class to test Configuration Update logic. It wraps up things needed to\n+ * test configuration change and provides utility methods for test cluster setup,\n+ * updating/restoring configuration file.\n+ */\n+public abstract class AbstractTestUpdateConfiguration {\n+  private static final int SERVER_CONFIG_INDEX  = 0;\n+  private static final int OVERWRITE_SERVER_CONFIG_INDEX  = 1;\n+  private static final int BACKUP_SERVER_CONFIG_INDEX  = 2;\n+  private static List<Path> newCnfPathes = new ArrayList<>();\n+\n+  protected static void setUpConfigurationFiles(final HBaseTestingUtility testUtil)\n+    throws Exception {\n+    // Before this change, the test will update hbase-site.xml under target/test-classes and\n+    // trigger a config reload. Since target/test-classes/hbase-site.xml is being used by\n+    // other testing cases at the same time, this update will break other testing cases so it will\n+    // be flakey in nature.\n+    // To avoid this, the change is to make target/test-classes/hbase-site.xml immutable. A new\n+    // hbase-site.xml will be created under its test data directory, i.e,\n+    // hbase-server/target/test-data/UUID, this new file will be added as a resource for the\n+    // config, new update will be applied to this new file and only visible to this specific test\n+    // case. The target/test-classes/hbase-site.xml will not be changed during the test.\n+\n+    String absoluteDataPath = testUtil.getDataTestDir().toString();\n+\n+    // Copy Files from target/test-classes to test-data directory, this is to avoid messing up\n+    // the config file under target/test-class, which is supposed to be immutable.\n+    Files.createDirectories(Paths.get(absoluteDataPath));\n+\n+    List<String> confs = Arrays.asList(\"/hbase-site.xml\", \"/hbase-site2.xml\", \"/hbase-site3.xml\");\n+    for (String conf : confs) {\n+      Path cnfPath = Paths.get(\"target/test-classes\" + conf);\n+      Path newConfPath = Paths.get(absoluteDataPath + conf);\n+\n+      // Do not copy the last one as it does not exist", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f80dd68d3c2104ba5d96c8dea97cb37b784aa896"}, "originalPosition": 65}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f80dd68d3c2104ba5d96c8dea97cb37b784aa896", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/f80dd68d3c2104ba5d96c8dea97cb37b784aa896", "committedDate": "2020-03-20T21:44:21Z", "message": "HBASE-23957 [flakey test] client.TestMultiParallel fails to read hbase-site.xml"}, "afterCommit": {"oid": "267b803a3b77472ad50db266121ef24553000599", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/267b803a3b77472ad50db266121ef24553000599", "committedDate": "2020-03-20T23:26:59Z", "message": "HBASE-23957 [flakey test] client.TestMultiParallel fails to read hbase-site.xml"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4ODYzNjYw", "url": "https://github.com/apache/hbase/pull/1310#pullrequestreview-378863660", "createdAt": "2020-03-20T23:38:08Z", "commit": {"oid": "267b803a3b77472ad50db266121ef24553000599"}, "state": "APPROVED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMzozODowOFrOF5l05Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMzo0Njo0MFrOF5l7kQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkzMjkwMQ==", "bodyText": "Hey! it makes a bit of sense now. Much easier to read!", "url": "https://github.com/apache/hbase/pull/1310#discussion_r395932901", "createdAt": "2020-03-20T23:38:08Z", "author": {"login": "ndimiduk"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/AbstractTestUpdateConfiguration.java", "diffHunk": "@@ -0,0 +1,103 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hbase.client;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.nio.file.StandardCopyOption;\n+import org.apache.hadoop.hbase.HBaseTestingUtility;\n+import org.apache.hadoop.hbase.util.JVMClusterUtil.RegionServerThread;\n+\n+/**\n+ * Base class to test Configuration Update logic. It wraps up things needed to\n+ * test configuration change and provides utility methods for test cluster setup,\n+ * updating/restoring configuration file.\n+ */\n+public abstract class AbstractTestUpdateConfiguration {\n+  private static final String SERVER_CONFIG = \"hbase-site.xml\";\n+  private static final String OVERWRITE_SERVER_CONFIG  = \"overwrite-hbase-site.xml\";\n+  private static final String BACKUP_SERVER_CONFIG  = \"backup-hbase-site.xml\";\n+\n+  private static Path configFileUnderTestDataDir;\n+  private static Path overwriteConfigFileUnderTestDataDir;\n+  private static Path backupConfigFileUnderTestDataDir;\n+\n+  protected static void setUpConfigurationFiles(final HBaseTestingUtility testUtil)\n+    throws Exception {\n+    // Before this change, the test will update hbase-site.xml under target/test-classes and\n+    // trigger a config reload. Since target/test-classes/hbase-site.xml is being used by\n+    // other testing cases at the same time, this update will break other testing cases so it will\n+    // be flakey in nature.\n+    // To avoid this, the change is to make target/test-classes/hbase-site.xml immutable. A new\n+    // hbase-site.xml will be created under its test data directory, i.e,\n+    // hbase-server/target/test-data/UUID, this new file will be added as a resource for the\n+    // config, new update will be applied to this new file and only visible to this specific test\n+    // case. The target/test-classes/hbase-site.xml will not be changed during the test.\n+\n+    String absoluteDataPath = testUtil.getDataTestDir().toString();\n+\n+    // Create test-data directories.\n+    Files.createDirectories(Paths.get(absoluteDataPath));\n+\n+    // Copy hbase-site.xml from target/test-class to target/test-data/UUID directory.\n+    Path configFile = Paths.get(\"target\", \"test-classes\", SERVER_CONFIG);\n+    configFileUnderTestDataDir = Paths.get(absoluteDataPath, SERVER_CONFIG);\n+    Files.copy(configFile, configFileUnderTestDataDir);\n+\n+    // Copy overwrite config file overwrite-hbase-site.xml from target/test-class to\n+    // target/test-data/UUID directory.\n+    Path overwriteConfigFile = Paths.get(\"target\", \"test-classes\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "267b803a3b77472ad50db266121ef24553000599"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkzMzM0NQ==", "bodyText": "nit: testUtil.getDataTestDir(SERVER_CONFIG) is the same path as configFileUnderTestDataDir ? why not reuse that existing variable?", "url": "https://github.com/apache/hbase/pull/1310#discussion_r395933345", "createdAt": "2020-03-20T23:40:30Z", "author": {"login": "ndimiduk"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/AbstractTestUpdateConfiguration.java", "diffHunk": "@@ -0,0 +1,103 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hbase.client;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.nio.file.StandardCopyOption;\n+import org.apache.hadoop.hbase.HBaseTestingUtility;\n+import org.apache.hadoop.hbase.util.JVMClusterUtil.RegionServerThread;\n+\n+/**\n+ * Base class to test Configuration Update logic. It wraps up things needed to\n+ * test configuration change and provides utility methods for test cluster setup,\n+ * updating/restoring configuration file.\n+ */\n+public abstract class AbstractTestUpdateConfiguration {\n+  private static final String SERVER_CONFIG = \"hbase-site.xml\";\n+  private static final String OVERWRITE_SERVER_CONFIG  = \"overwrite-hbase-site.xml\";\n+  private static final String BACKUP_SERVER_CONFIG  = \"backup-hbase-site.xml\";\n+\n+  private static Path configFileUnderTestDataDir;\n+  private static Path overwriteConfigFileUnderTestDataDir;\n+  private static Path backupConfigFileUnderTestDataDir;\n+\n+  protected static void setUpConfigurationFiles(final HBaseTestingUtility testUtil)\n+    throws Exception {\n+    // Before this change, the test will update hbase-site.xml under target/test-classes and\n+    // trigger a config reload. Since target/test-classes/hbase-site.xml is being used by\n+    // other testing cases at the same time, this update will break other testing cases so it will\n+    // be flakey in nature.\n+    // To avoid this, the change is to make target/test-classes/hbase-site.xml immutable. A new\n+    // hbase-site.xml will be created under its test data directory, i.e,\n+    // hbase-server/target/test-data/UUID, this new file will be added as a resource for the\n+    // config, new update will be applied to this new file and only visible to this specific test\n+    // case. The target/test-classes/hbase-site.xml will not be changed during the test.\n+\n+    String absoluteDataPath = testUtil.getDataTestDir().toString();\n+\n+    // Create test-data directories.\n+    Files.createDirectories(Paths.get(absoluteDataPath));\n+\n+    // Copy hbase-site.xml from target/test-class to target/test-data/UUID directory.\n+    Path configFile = Paths.get(\"target\", \"test-classes\", SERVER_CONFIG);\n+    configFileUnderTestDataDir = Paths.get(absoluteDataPath, SERVER_CONFIG);\n+    Files.copy(configFile, configFileUnderTestDataDir);\n+\n+    // Copy overwrite config file overwrite-hbase-site.xml from target/test-class to\n+    // target/test-data/UUID directory.\n+    Path overwriteConfigFile = Paths.get(\"target\", \"test-classes\",\n+      OVERWRITE_SERVER_CONFIG);\n+    overwriteConfigFileUnderTestDataDir = Paths.get(absoluteDataPath, OVERWRITE_SERVER_CONFIG);\n+    Files.copy(overwriteConfigFile, overwriteConfigFileUnderTestDataDir);\n+\n+    backupConfigFileUnderTestDataDir = Paths.get(absoluteDataPath, BACKUP_SERVER_CONFIG);\n+\n+    // Add the new custom config file to Configuration\n+    testUtil.getConfiguration().addResource(testUtil.getDataTestDir(SERVER_CONFIG));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "267b803a3b77472ad50db266121ef24553000599"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkzMzgyNg==", "bodyText": "I think you mean \"override\", not \"overwrite\", don't you? This is the file that contains override values specific for the given test. It just so happens that it was overwriting the base config file, which was the source of our bugs in the first place :p", "url": "https://github.com/apache/hbase/pull/1310#discussion_r395933826", "createdAt": "2020-03-20T23:42:45Z", "author": {"login": "ndimiduk"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/AbstractTestUpdateConfiguration.java", "diffHunk": "@@ -0,0 +1,103 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hbase.client;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.nio.file.StandardCopyOption;\n+import org.apache.hadoop.hbase.HBaseTestingUtility;\n+import org.apache.hadoop.hbase.util.JVMClusterUtil.RegionServerThread;\n+\n+/**\n+ * Base class to test Configuration Update logic. It wraps up things needed to\n+ * test configuration change and provides utility methods for test cluster setup,\n+ * updating/restoring configuration file.\n+ */\n+public abstract class AbstractTestUpdateConfiguration {\n+  private static final String SERVER_CONFIG = \"hbase-site.xml\";\n+  private static final String OVERWRITE_SERVER_CONFIG  = \"overwrite-hbase-site.xml\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "267b803a3b77472ad50db266121ef24553000599"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkzNDM3NQ==", "bodyText": "since these methods are part of an interface consumed by children, some javadoc would be nice here. Something like\n\nreplace the site.xml file under this test's data directory with the content of the override file. stashes the current existing file so that it can be restored using {@link #restoreHBaseSiteXML()}\n\nand\n\nRestores the site.xml that was stashed by a previous call to {@link #replaceHBaseSiteXML()}.", "url": "https://github.com/apache/hbase/pull/1310#discussion_r395934375", "createdAt": "2020-03-20T23:45:33Z", "author": {"login": "ndimiduk"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/AbstractTestUpdateConfiguration.java", "diffHunk": "@@ -0,0 +1,103 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hbase.client;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.nio.file.StandardCopyOption;\n+import org.apache.hadoop.hbase.HBaseTestingUtility;\n+import org.apache.hadoop.hbase.util.JVMClusterUtil.RegionServerThread;\n+\n+/**\n+ * Base class to test Configuration Update logic. It wraps up things needed to\n+ * test configuration change and provides utility methods for test cluster setup,\n+ * updating/restoring configuration file.\n+ */\n+public abstract class AbstractTestUpdateConfiguration {\n+  private static final String SERVER_CONFIG = \"hbase-site.xml\";\n+  private static final String OVERWRITE_SERVER_CONFIG  = \"overwrite-hbase-site.xml\";\n+  private static final String BACKUP_SERVER_CONFIG  = \"backup-hbase-site.xml\";\n+\n+  private static Path configFileUnderTestDataDir;\n+  private static Path overwriteConfigFileUnderTestDataDir;\n+  private static Path backupConfigFileUnderTestDataDir;\n+\n+  protected static void setUpConfigurationFiles(final HBaseTestingUtility testUtil)\n+    throws Exception {\n+    // Before this change, the test will update hbase-site.xml under target/test-classes and\n+    // trigger a config reload. Since target/test-classes/hbase-site.xml is being used by\n+    // other testing cases at the same time, this update will break other testing cases so it will\n+    // be flakey in nature.\n+    // To avoid this, the change is to make target/test-classes/hbase-site.xml immutable. A new\n+    // hbase-site.xml will be created under its test data directory, i.e,\n+    // hbase-server/target/test-data/UUID, this new file will be added as a resource for the\n+    // config, new update will be applied to this new file and only visible to this specific test\n+    // case. The target/test-classes/hbase-site.xml will not be changed during the test.\n+\n+    String absoluteDataPath = testUtil.getDataTestDir().toString();\n+\n+    // Create test-data directories.\n+    Files.createDirectories(Paths.get(absoluteDataPath));\n+\n+    // Copy hbase-site.xml from target/test-class to target/test-data/UUID directory.\n+    Path configFile = Paths.get(\"target\", \"test-classes\", SERVER_CONFIG);\n+    configFileUnderTestDataDir = Paths.get(absoluteDataPath, SERVER_CONFIG);\n+    Files.copy(configFile, configFileUnderTestDataDir);\n+\n+    // Copy overwrite config file overwrite-hbase-site.xml from target/test-class to\n+    // target/test-data/UUID directory.\n+    Path overwriteConfigFile = Paths.get(\"target\", \"test-classes\",\n+      OVERWRITE_SERVER_CONFIG);\n+    overwriteConfigFileUnderTestDataDir = Paths.get(absoluteDataPath, OVERWRITE_SERVER_CONFIG);\n+    Files.copy(overwriteConfigFile, overwriteConfigFileUnderTestDataDir);\n+\n+    backupConfigFileUnderTestDataDir = Paths.get(absoluteDataPath, BACKUP_SERVER_CONFIG);\n+\n+    // Add the new custom config file to Configuration\n+    testUtil.getConfiguration().addResource(testUtil.getDataTestDir(SERVER_CONFIG));\n+  }\n+\n+  protected static void addResourceToRegionServerConfiguration(final HBaseTestingUtility testUtil) {\n+    // When RegionServer is created in MiniHBaseCluster, it uses HBaseConfiguration.create(conf) of\n+    // the master Configuration. The create() just copies config params over, it does not do\n+    // a clone for a historic reason. Properties such as resources are lost during this process.\n+    // Exposing a new method in HBaseConfiguration causes confusion. Instead, the new hbase-site.xml\n+    // under test-data directory is added to RegionServer's configuration as a workaround.\n+    for (RegionServerThread rsThread : testUtil.getMiniHBaseCluster().getRegionServerThreads()) {\n+      rsThread.getRegionServer().getConfiguration().addResource(\n+        testUtil.getDataTestDir(SERVER_CONFIG));\n+    }\n+  }\n+\n+  protected void replaceHBaseSiteXML() throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "267b803a3b77472ad50db266121ef24553000599"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkzNDYwOQ==", "bodyText": "nit: we make a habit of using the logger's format string capability. That way it only performs the computation necessary to build the log message if the logger is emitting messages at the target level.\nLOG.debug(\"Starting the test {}\", name.getMethodName());", "url": "https://github.com/apache/hbase/pull/1310#discussion_r395934609", "createdAt": "2020-03-20T23:46:40Z", "author": {"login": "ndimiduk"}, "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestUpdateConfiguration.java", "diffHunk": "@@ -49,57 +47,47 @@\n \n   @BeforeClass\n   public static void setup() throws Exception {\n-    // Set master number and use default values for other options.\n+    setUpConfigurationFiles(TEST_UTIL);\n     StartMiniClusterOption option = StartMiniClusterOption.builder().numMasters(2).build();\n     TEST_UTIL.startMiniCluster(option);\n+    addResourceToRegionServerConfiguration(TEST_UTIL);\n   }\n \n+  @Rule\n+  public TestName name = new TestName();\n+\n   @Test\n   public void testOnlineConfigChange() throws IOException {\n-    LOG.debug(\"Starting the test\");\n+    LOG.debug(\"Starting the test \" + name.getMethodName());\n     Admin admin = TEST_UTIL.getAdmin();\n     ServerName server = TEST_UTIL.getHBaseCluster().getRegionServer(0).getServerName();\n     admin.updateConfiguration(server);\n   }\n \n   @Test\n   public void testMasterOnlineConfigChange() throws IOException {\n-    LOG.debug(\"Starting the test\");\n-    Path cnfPath = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site.xml\");\n-    Path cnf2Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site2.xml\");\n-    Path cnf3Path = FileSystems.getDefault().getPath(\"target/test-classes/hbase-site3.xml\");\n-    // make a backup of hbase-site.xml\n-    Files.copy(cnfPath, cnf3Path, StandardCopyOption.REPLACE_EXISTING);\n-    // update hbase-site.xml by overwriting it\n-    Files.copy(cnf2Path, cnfPath, StandardCopyOption.REPLACE_EXISTING);\n-\n+    LOG.debug(\"Starting the test \" + name.getMethodName());\n+    replaceHBaseSiteXML();\n     Admin admin = TEST_UTIL.getAdmin();\n     ServerName server = TEST_UTIL.getHBaseCluster().getMaster().getServerName();\n     admin.updateConfiguration(server);\n     Configuration conf = TEST_UTIL.getMiniHBaseCluster().getMaster().getConfiguration();\n     int custom = conf.getInt(\"hbase.custom.config\", 0);\n     assertEquals(1000, custom);\n-    // restore hbase-site.xml\n-    Files.copy(cnf3Path, cnfPath, StandardCopyOption.REPLACE_EXISTING);\n+    restoreHBaseSiteXML();\n   }\n \n   @Test\n   public void testAllOnlineConfigChange() throws IOException {\n-    LOG.debug(\"Starting the test\");\n+    LOG.debug(\"Starting the test \" + name.getMethodName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "267b803a3b77472ad50db266121ef24553000599"}, "originalPosition": 78}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "267b803a3b77472ad50db266121ef24553000599", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/267b803a3b77472ad50db266121ef24553000599", "committedDate": "2020-03-20T23:26:59Z", "message": "HBASE-23957 [flakey test] client.TestMultiParallel fails to read hbase-site.xml"}, "afterCommit": {"oid": "0ed5ab9de16a48a50d18f296a986bef7c53d1753", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/0ed5ab9de16a48a50d18f296a986bef7c53d1753", "committedDate": "2020-03-21T06:44:07Z", "message": "HBASE-23957 [flakey test] client.TestMultiParallel fails to read hbase-site.xml"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0ed5ab9de16a48a50d18f296a986bef7c53d1753", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/0ed5ab9de16a48a50d18f296a986bef7c53d1753", "committedDate": "2020-03-21T06:44:07Z", "message": "HBASE-23957 [flakey test] client.TestMultiParallel fails to read hbase-site.xml"}, "afterCommit": {"oid": "84cba8e4340615630df726deec8cda5c208cab3c", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/84cba8e4340615630df726deec8cda5c208cab3c", "committedDate": "2020-03-21T06:49:35Z", "message": "HBASE-23957 [flakey test] client.TestMultiParallel fails to read hbase-site.xml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c549399506762365a239882b4825a3928121830", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/8c549399506762365a239882b4825a3928121830", "committedDate": "2020-03-21T16:27:20Z", "message": "HBASE-23957 [flakey test] client.TestMultiParallel fails to read hbase-site.xml"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "84cba8e4340615630df726deec8cda5c208cab3c", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/84cba8e4340615630df726deec8cda5c208cab3c", "committedDate": "2020-03-21T06:49:35Z", "message": "HBASE-23957 [flakey test] client.TestMultiParallel fails to read hbase-site.xml"}, "afterCommit": {"oid": "8c549399506762365a239882b4825a3928121830", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/8c549399506762365a239882b4825a3928121830", "committedDate": "2020-03-21T16:27:20Z", "message": "HBASE-23957 [flakey test] client.TestMultiParallel fails to read hbase-site.xml"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2718, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}