{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0Mzg3NjEx", "number": 2682, "title": "HBASE-25127 Enhance PerformanceEvaluation to profile meta replica per\u2026", "bodyText": "\u2026formance. (#2644)\nSigned-off-by: Huaxiang Sun huaxiangsun@apache.com\nSigned-off-by: stack stack@apache.com", "createdAt": "2020-11-20T03:45:15Z", "url": "https://github.com/apache/hbase/pull/2682", "merged": true, "mergeCommit": {"oid": "dfe3672266c12144d023926d66c1cc98d869a36f"}, "closed": true, "closedAt": "2020-11-30T18:28:35Z", "author": {"login": "saintstack"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdeSZ92gFqTUzNTE3NDMxNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdecpVNgBqjQwMjI0ODM3OTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1MTc0MzE1", "url": "https://github.com/apache/hbase/pull/2682#pullrequestreview-535174315", "createdAt": "2020-11-20T07:35:49Z", "commit": {"oid": "ca66986f7240ed635df5e05c7019872f50a480b1"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwNzozNTo0OVrOH3DhqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwNzo0MDoyNlrOH3DpPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzQ5MTQ5Nw==", "bodyText": "nits: add a * before the line.", "url": "https://github.com/apache/hbase/pull/2682#discussion_r527491497", "createdAt": "2020-11-20T07:35:49Z", "author": {"login": "Apache9"}, "path": "hbase-mapreduce/src/test/java/org/apache/hadoop/hbase/PerformanceEvaluation.java", "diffHunk": "@@ -1481,6 +1489,31 @@ void onTakedown() throws IOException {\n     }\n   }\n \n+  /*\n+  Parent class for all meta tests: MetaWriteTest, MetaRandomReadTest and CleanMetaTest", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca66986f7240ed635df5e05c7019872f50a480b1"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzQ5MTkzMA==", "bodyText": "Ditto.", "url": "https://github.com/apache/hbase/pull/2682#discussion_r527491930", "createdAt": "2020-11-20T07:37:05Z", "author": {"login": "Apache9"}, "path": "hbase-mapreduce/src/test/java/org/apache/hadoop/hbase/PerformanceEvaluation.java", "diffHunk": "@@ -1481,6 +1489,31 @@ void onTakedown() throws IOException {\n     }\n   }\n \n+  /*\n+  Parent class for all meta tests: MetaWriteTest, MetaRandomReadTest and CleanMetaTest\n+   */\n+  static abstract class MetaTest extends TableTest {\n+    protected int keyLength;\n+\n+    MetaTest(Connection con, TestOptions options, Status status) {\n+      super(con, options, status);\n+      keyLength = Integer.toString(opts.perClientRunRows).length();\n+    }\n+\n+    @Override\n+    void onTakedown() throws IOException {\n+      // No clean up\n+    }\n+\n+    /*\n+    Generates Lexicographically ascending strings", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca66986f7240ed635df5e05c7019872f50a480b1"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzQ5MjY0Mg==", "bodyText": "Since we do not pre set a seed here, please just use ThreadLocalRandom instead.", "url": "https://github.com/apache/hbase/pull/2682#discussion_r527492642", "createdAt": "2020-11-20T07:38:30Z", "author": {"login": "Apache9"}, "path": "hbase-mapreduce/src/test/java/org/apache/hadoop/hbase/PerformanceEvaluation.java", "diffHunk": "@@ -1999,6 +2032,47 @@ protected void testTakedown() throws IOException {\n     }\n   }\n \n+  /*\n+  Send random reads against fake regions inserted by MetaWriteTest\n+   */\n+  static class MetaRandomReadTest extends MetaTest {\n+    private Random rd = new Random();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca66986f7240ed635df5e05c7019872f50a480b1"}, "originalPosition": 109}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzQ5MzQzOQ==", "bodyText": "Out of interest, we have several pattern of the implementations for this method. Some just returns opts.perClientRunRows, some divide by 10, some divide by 100. What's the difference here? Why we choose 10 here? Because the random read test uses 10? Not a big concern, just asking.", "url": "https://github.com/apache/hbase/pull/2682#discussion_r527493439", "createdAt": "2020-11-20T07:40:26Z", "author": {"login": "Apache9"}, "path": "hbase-mapreduce/src/test/java/org/apache/hadoop/hbase/PerformanceEvaluation.java", "diffHunk": "@@ -1999,6 +2032,47 @@ protected void testTakedown() throws IOException {\n     }\n   }\n \n+  /*\n+  Send random reads against fake regions inserted by MetaWriteTest\n+   */\n+  static class MetaRandomReadTest extends MetaTest {\n+    private Random rd = new Random();\n+    private RegionLocator regionLocator;\n+\n+    MetaRandomReadTest(Connection con, TestOptions options, Status status) {\n+      super(con, options, status);\n+      LOG.info(\"call getRegionLocation\");\n+    }\n+\n+    @Override\n+    void onStartup() throws IOException {\n+      super.onStartup();\n+      this.regionLocator = connection.getRegionLocator(table.getName());\n+    }\n+\n+    @Override\n+    boolean testRow(final int i, final long startTime) throws IOException, InterruptedException {\n+      if (opts.randomSleep > 0) {\n+        Thread.sleep(rd.nextInt(opts.randomSleep));\n+      }\n+      HRegionLocation hRegionLocation = regionLocator.getRegionLocation(\n+        getSplitKey(rd.nextInt(opts.perClientRunRows)), true);\n+      LOG.debug(\"get location for region: \" + hRegionLocation);\n+      return true;\n+    }\n+\n+    @Override\n+    protected int getReportingPeriod() {\n+      int period = opts.perClientRunRows / 10;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca66986f7240ed635df5e05c7019872f50a480b1"}, "originalPosition": 136}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "995d261aff190a5da6834b3de0574684a804d256", "author": {"user": {"login": "clarax", "name": null}}, "url": "https://github.com/apache/hbase/commit/995d261aff190a5da6834b3de0574684a804d256", "committedDate": "2020-11-20T19:36:38Z", "message": "HBASE-25127 Enhance PerformanceEvaluation to profile meta replica performance. (#2644)\n\nSigned-off-by: Huaxiang Sun <huaxiangsun@apache.com>\nSigned-off-by: stack <stack@apache.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ca66986f7240ed635df5e05c7019872f50a480b1", "author": {"user": {"login": "saintstack", "name": "Michael Stack"}}, "url": "https://github.com/apache/hbase/commit/ca66986f7240ed635df5e05c7019872f50a480b1", "committedDate": "2020-11-20T03:44:17Z", "message": "HBASE-25127 Enhance PerformanceEvaluation to profile meta replica performance. (#2644)\n\nSigned-off-by: Huaxiang Sun <huaxiangsun@apache.com>\nSigned-off-by: stack <stack@apache.com>"}, "afterCommit": {"oid": "995d261aff190a5da6834b3de0574684a804d256", "author": {"user": {"login": "clarax", "name": null}}, "url": "https://github.com/apache/hbase/commit/995d261aff190a5da6834b3de0574684a804d256", "committedDate": "2020-11-20T19:36:38Z", "message": "HBASE-25127 Enhance PerformanceEvaluation to profile meta replica performance. (#2644)\n\nSigned-off-by: Huaxiang Sun <huaxiangsun@apache.com>\nSigned-off-by: stack <stack@apache.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4957, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}