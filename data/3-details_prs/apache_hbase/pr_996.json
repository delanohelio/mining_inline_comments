{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5OTY2NTE1", "number": 996, "title": "HBASE-23655 Fix flaky TestRSGroupsKillRS: should wait the SCP to finish", "bodyText": "", "createdAt": "2020-01-07T12:22:45Z", "url": "https://github.com/apache/hbase/pull/996", "merged": true, "mergeCommit": {"oid": "1bb69d2d6005b84b6709d6a367fafc5af10d8e1c"}, "closed": true, "closedAt": "2020-01-09T06:40:02Z", "author": {"login": "infraio"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb4J6zqABqjI5Mjk0NjU0Njc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb4kGMRAFqTM0MDMxMjk5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "60a02e2f9b03e17fe90e4f984a56ca0e9372c659", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/60a02e2f9b03e17fe90e4f984a56ca0e9372c659", "committedDate": "2020-01-07T12:19:38Z", "message": "HBASE-23655 Fix flaky TestRSGroupsKillRS: should wait the SCP to finish"}, "afterCommit": {"oid": "21ebfb9e6c2b51f7eca2041f2b26ab3386948216", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/21ebfb9e6c2b51f7eca2041f2b26ab3386948216", "committedDate": "2020-01-08T00:06:54Z", "message": "HBASE-23655 Fix flaky TestRSGroupsKillRS: should wait the SCP to finish"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5NjEwNzA0", "url": "https://github.com/apache/hbase/pull/996#pullrequestreview-339610704", "createdAt": "2020-01-08T01:54:55Z", "commit": {"oid": "21ebfb9e6c2b51f7eca2041f2b26ab3386948216"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQwMTo1NDo1NVrOFbK6JA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQwMTo1NToyMlrOFbK6fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDAzNDU5Ng==", "bodyText": "Does this method work for meta table? I'm not sure, just asking. As lots of the methods in HBTU just read the meta table so can not be used to test meta table itself...", "url": "https://github.com/apache/hbase/pull/996#discussion_r364034596", "createdAt": "2020-01-08T01:54:55Z", "author": {"login": "Apache9"}, "path": "hbase-rsgroup/src/test/java/org/apache/hadoop/hbase/rsgroup/TestRSGroupsKillRS.java", "diffHunk": "@@ -237,12 +238,12 @@ public void testLowerMetaGroupVersion() throws Exception{\n     addGroup(groupName, groupRSCount);\n \n     // move hbase:meta to meta_group\n-    tableName = TableName.META_TABLE_NAME;\n     Set<TableName> toAddTables = new HashSet<>();\n-    toAddTables.add(tableName);\n+    toAddTables.add(TableName.META_TABLE_NAME);\n     rsGroupAdmin.moveTables(toAddTables, groupName);\n-    assertTrue(rsGroupAdmin.getRSGroupInfo(groupName).getTables().contains(tableName));\n-    TEST_UTIL.waitTableAvailable(tableName, 30000);\n+    assertTrue(\n+        rsGroupAdmin.getRSGroupInfo(groupName).getTables().contains(TableName.META_TABLE_NAME));\n+    TEST_UTIL.waitUntilAllRegionsAssigned(TableName.META_TABLE_NAME, 30000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21ebfb9e6c2b51f7eca2041f2b26ab3386948216"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDAzNDY4Ng==", "bodyText": "So this is the root cause.", "url": "https://github.com/apache/hbase/pull/996#discussion_r364034686", "createdAt": "2020-01-08T01:55:22Z", "author": {"login": "Apache9"}, "path": "hbase-rsgroup/src/test/java/org/apache/hadoop/hbase/rsgroup/TestRSGroupsKillRS.java", "diffHunk": "@@ -268,7 +269,9 @@ public void testLowerMetaGroupVersion() throws Exception{\n     assertTrue(VersionInfo.compareVersion(originVersion,\n         master.getRegionServerVersion(getServerName(servers.iterator().next()))) > 0);\n     LOG.debug(\"wait for META assigned...\");\n-    TEST_UTIL.waitTableAvailable(tableName, 30000);\n+    TEST_UTIL.waitFor(60000, () -> !TEST_UTIL.getHBaseCluster().getMaster().getProcedures().stream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21ebfb9e6c2b51f7eca2041f2b26ab3386948216"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78226d32688de3d8eb0a3160aa7e60992bd55aca", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/78226d32688de3d8eb0a3160aa7e60992bd55aca", "committedDate": "2020-01-08T04:01:28Z", "message": "HBASE-23655 Fix flaky TestRSGroupsKillRS: should wait the SCP to finish"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "21ebfb9e6c2b51f7eca2041f2b26ab3386948216", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/21ebfb9e6c2b51f7eca2041f2b26ab3386948216", "committedDate": "2020-01-08T00:06:54Z", "message": "HBASE-23655 Fix flaky TestRSGroupsKillRS: should wait the SCP to finish"}, "afterCommit": {"oid": "78226d32688de3d8eb0a3160aa7e60992bd55aca", "author": {"user": {"login": "infraio", "name": "Guanghao Zhang"}}, "url": "https://github.com/apache/hbase/commit/78226d32688de3d8eb0a3160aa7e60992bd55aca", "committedDate": "2020-01-08T04:01:28Z", "message": "HBASE-23655 Fix flaky TestRSGroupsKillRS: should wait the SCP to finish"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwMzEyOTk4", "url": "https://github.com/apache/hbase/pull/996#pullrequestreview-340312998", "createdAt": "2020-01-09T06:38:02Z", "commit": {"oid": "78226d32688de3d8eb0a3160aa7e60992bd55aca"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3132, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}