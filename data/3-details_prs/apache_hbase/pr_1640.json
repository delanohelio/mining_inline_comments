{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEyOTcwNjEw", "number": 1640, "title": "HBASE-24309 Avoid introducing log4j and slf4j-log4j dependencies for modules other than hbase-assembly", "bodyText": "", "createdAt": "2020-05-04T14:01:35Z", "url": "https://github.com/apache/hbase/pull/1640", "merged": true, "mergeCommit": {"oid": "8601416ee8e8ed7dc3acdf13ad914e4c8dbee432"}, "closed": true, "closedAt": "2020-05-12T04:03:31Z", "author": {"login": "Apache9"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcen3y1gBqjMzMDgyNjU4NzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgcHqNAFqTQwOTY4MTQ1OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "67468af491b9767175231ae4755a91b7e68f828d", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/67468af491b9767175231ae4755a91b7e68f828d", "committedDate": "2020-05-04T13:52:55Z", "message": "HBASE-24309 Avoid introducing log4j and slf4j-log4j dependencies for modules other than hbase-assembly"}, "afterCommit": {"oid": "e3d32a7fe51b0c2eb05fd63d63568a6ba5f15546", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/e3d32a7fe51b0c2eb05fd63d63568a6ba5f15546", "committedDate": "2020-05-06T12:30:42Z", "message": "HBASE-24309 Avoid introducing log4j and slf4j-log4j dependencies for modules other than hbase-assembly"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e3d32a7fe51b0c2eb05fd63d63568a6ba5f15546", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/e3d32a7fe51b0c2eb05fd63d63568a6ba5f15546", "committedDate": "2020-05-06T12:30:42Z", "message": "HBASE-24309 Avoid introducing log4j and slf4j-log4j dependencies for modules other than hbase-assembly"}, "afterCommit": {"oid": "b270f9a5f0a95666fb4887c8e0e374e068623e62", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/b270f9a5f0a95666fb4887c8e0e374e068623e62", "committedDate": "2020-05-08T03:49:12Z", "message": "HBASE-24309 Avoid introducing log4j and slf4j-log4j dependencies for modules other than hbase-assembly"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3OTkwODMy", "url": "https://github.com/apache/hbase/pull/1640#pullrequestreview-407990832", "createdAt": "2020-05-08T04:39:25Z", "commit": {"oid": "b270f9a5f0a95666fb4887c8e0e374e068623e62"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwNDozOToyNVrOGSYx1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwNDo1ODoyM1rOGSZD4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkzMzUyNw==", "bodyText": "Good", "url": "https://github.com/apache/hbase/pull/1640#discussion_r421933527", "createdAt": "2020-05-08T04:39:25Z", "author": {"login": "saintstack"}, "path": "hbase-archetypes/hbase-client-project/pom.xml", "diffHunk": "@@ -43,31 +43,35 @@\n     <dependency>\n       <groupId>org.apache.hbase</groupId>\n       <artifactId>hbase-testing-util</artifactId>\n-      <version>${project.version}</version>\n       <scope>test</scope>\n     </dependency>\n     <dependency>\n       <groupId>org.apache.hbase</groupId>\n       <artifactId>hbase-common</artifactId>\n-      <version>${project.version}</version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b270f9a5f0a95666fb4887c8e0e374e068623e62"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkzNjcwNw==", "bodyText": "This is a good note. Should it go elsewhere, in the top-level pom for instance? (Maybe it is there already...  Let me keep going)", "url": "https://github.com/apache/hbase/pull/1640#discussion_r421936707", "createdAt": "2020-05-08T04:52:33Z", "author": {"login": "saintstack"}, "path": "hbase-assembly/pom.xml", "diffHunk": "@@ -318,5 +318,18 @@\n       <artifactId>jaxws-ri</artifactId>\n       <type>pom</type>\n     </dependency>\n+    <!--\n+      Include the log framework here.\n+      For other sub modules, we only declare slf4j-api as a compile dependency,\n+      so here we must pull in the real logging framework to actually log to log4j.\n+    -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b270f9a5f0a95666fb4887c8e0e374e068623e62"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkzNzA2NA==", "bodyText": "What happens when we run in-situ... i.e. build and then do ./bin/start-hbase.sh? Does it produce logs?", "url": "https://github.com/apache/hbase/pull/1640#discussion_r421937064", "createdAt": "2020-05-08T04:54:02Z", "author": {"login": "saintstack"}, "path": "hbase-assembly/pom.xml", "diffHunk": "@@ -318,5 +318,18 @@\n       <artifactId>jaxws-ri</artifactId>\n       <type>pom</type>\n     </dependency>\n+    <!--\n+      Include the log framework here.\n+      For other sub modules, we only declare slf4j-api as a compile dependency,\n+      so here we must pull in the real logging framework to actually log to log4j.\n+    -->", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkzNjcwNw=="}, "originalCommit": {"oid": "b270f9a5f0a95666fb4887c8e0e374e068623e62"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkzNzUwMQ==", "bodyText": "Fixed?", "url": "https://github.com/apache/hbase/pull/1640#discussion_r421937501", "createdAt": "2020-05-08T04:55:40Z", "author": {"login": "saintstack"}, "path": "hbase-server/pom.xml", "diffHunk": "@@ -481,15 +473,6 @@\n       <artifactId>httpcore</artifactId>\n       <scope>test</scope>\n     </dependency>\n-    <!-- commons-logging is used by HBTU to monkey with log levels\n-         have to put it at compile scope because Hadoop's IOUtils uses it\n-         both for hadoop 2.7 and 3.0, so we'll fail at compile if it's at test scope.\n-      -->\n-    <dependency>\n-      <groupId>commons-logging</groupId>\n-      <artifactId>commons-logging</artifactId>\n-      <scope>compile</scope>\n-    </dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b270f9a5f0a95666fb4887c8e0e374e068623e62"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkzNzg2Mg==", "bodyText": "This is targeted at hbase2 which is to run against hadoop2? This comment that it can't be non-optional is fixed now? Not needed?", "url": "https://github.com/apache/hbase/pull/1640#discussion_r421937862", "createdAt": "2020-05-08T04:57:08Z", "author": {"login": "saintstack"}, "path": "hbase-shaded/pom.xml", "diffHunk": "@@ -51,15 +51,14 @@\n       <dependency>\n          <groupId>org.apache.hbase</groupId>\n          <artifactId>hbase-resource-bundle</artifactId>\n-         <version>${project.version}</version>\n          <optional>true</optional>\n       </dependency>\n-      <!-- log4j has to be non-optional for Hadoop 2 atleast -->\n+      <!-- put the log implementations to optional -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b270f9a5f0a95666fb4887c8e0e374e068623e62"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkzODE0NA==", "bodyText": "Painful.", "url": "https://github.com/apache/hbase/pull/1640#discussion_r421938144", "createdAt": "2020-05-08T04:58:23Z", "author": {"login": "saintstack"}, "path": "pom.xml", "diffHunk": "@@ -2861,6 +2917,14 @@\n                <groupId>org.codehause.jackson</groupId>\n                <artifactId>jackson-mapper-asl</artifactId>\n              </exclusion>\n+             <exclusion>\n+               <groupId>org.slf4j</groupId>\n+               <artifactId>slf4j-log4j12</artifactId>\n+             </exclusion>\n+             <exclusion>\n+               <groupId>log4j</groupId>\n+               <artifactId>log4j</artifactId>\n+             </exclusion>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b270f9a5f0a95666fb4887c8e0e374e068623e62"}, "originalPosition": 132}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b270f9a5f0a95666fb4887c8e0e374e068623e62", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/b270f9a5f0a95666fb4887c8e0e374e068623e62", "committedDate": "2020-05-08T03:49:12Z", "message": "HBASE-24309 Avoid introducing log4j and slf4j-log4j dependencies for modules other than hbase-assembly"}, "afterCommit": {"oid": "6f468fe1f1a2c4474b6ca0ac33a4e1094cfb9b1f", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/6f468fe1f1a2c4474b6ca0ac33a4e1094cfb9b1f", "committedDate": "2020-05-08T08:19:50Z", "message": "HBASE-24309 Avoid introducing log4j and slf4j-log4j dependencies for modules other than hbase-assembly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8d41f4a324e41b79efaafa51f5313e2bbe5faa5", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/b8d41f4a324e41b79efaafa51f5313e2bbe5faa5", "committedDate": "2020-05-10T15:20:34Z", "message": "HBASE-24309 Avoid introducing log4j and slf4j-log4j dependencies for modules other than hbase-assembly"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6f468fe1f1a2c4474b6ca0ac33a4e1094cfb9b1f", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/6f468fe1f1a2c4474b6ca0ac33a4e1094cfb9b1f", "committedDate": "2020-05-08T08:19:50Z", "message": "HBASE-24309 Avoid introducing log4j and slf4j-log4j dependencies for modules other than hbase-assembly"}, "afterCommit": {"oid": "b8d41f4a324e41b79efaafa51f5313e2bbe5faa5", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/b8d41f4a324e41b79efaafa51f5313e2bbe5faa5", "committedDate": "2020-05-10T15:20:34Z", "message": "HBASE-24309 Avoid introducing log4j and slf4j-log4j dependencies for modules other than hbase-assembly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1820f20711d8ec87e33f8f0e35628028e84a1106", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/1820f20711d8ec87e33f8f0e35628028e84a1106", "committedDate": "2020-05-11T01:58:40Z", "message": "fix checkstyle error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0d1d81ac46ad5d46fbda26a7d7965939f13115d", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/d0d1d81ac46ad5d46fbda26a7d7965939f13115d", "committedDate": "2020-05-11T09:12:24Z", "message": "ban commons-logging dependencies and ban commons-logging and log4j dependencies from non test code\nadd jcl-over-slf4j and jul-to-slf4j dependencies"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4047141c751bffb5da8d8a2309c9900d115c0558", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/4047141c751bffb5da8d8a2309c9900d115c0558", "committedDate": "2020-05-11T09:15:31Z", "message": "remove log4j.properties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5634becf77927fffa2878a66aa49184f184ab84d", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/5634becf77927fffa2878a66aa49184f184ab84d", "committedDate": "2020-05-11T09:49:38Z", "message": "do not exclude log4j.properties in test jar, exclude it in source jar"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MjU1MTg1", "url": "https://github.com/apache/hbase/pull/1640#pullrequestreview-409255185", "createdAt": "2020-05-11T14:59:15Z", "commit": {"oid": "5634becf77927fffa2878a66aa49184f184ab84d"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNDo1OToxNVrOGTgKMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNToyMToyOVrOGThJNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzEwMzAyNg==", "bodyText": "Check it out. It has always worked. Good for dev. We build up classpath and cache it.", "url": "https://github.com/apache/hbase/pull/1640#discussion_r423103026", "createdAt": "2020-05-11T14:59:15Z", "author": {"login": "saintstack"}, "path": "hbase-assembly/pom.xml", "diffHunk": "@@ -318,5 +318,18 @@\n       <artifactId>jaxws-ri</artifactId>\n       <type>pom</type>\n     </dependency>\n+    <!--\n+      Include the log framework here.\n+      For other sub modules, we only declare slf4j-api as a compile dependency,\n+      so here we must pull in the real logging framework to actually log to log4j.\n+    -->", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkzNjcwNw=="}, "originalCommit": {"oid": "b270f9a5f0a95666fb4887c8e0e374e068623e62"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzEwMzg3MA==", "bodyText": "There are a few extras here. Thats ok?", "url": "https://github.com/apache/hbase/pull/1640#discussion_r423103870", "createdAt": "2020-05-11T15:00:20Z", "author": {"login": "saintstack"}, "path": "hbase-assembly/src/main/assembly/client.xml", "diffHunk": "@@ -50,20 +52,22 @@\n               <exclude>com.sun.jersey:*</exclude>\n               <exclude>com.sun.jersey.contribs:*</exclude>\n               <exclude>jline:jline</exclude>\n-        <exclude>com.github.stephenc.findbugs:findbugs-annotations</exclude>\n-        <exclude>commons-logging:commons-logging</exclude>\n-        <exclude>log4j:log4j</exclude>\n-        <exclude>org.apache.hbase:hbase-shaded-client</exclude>\n-        <exclude>org.apache.hbase:hbase-shaded-client-byo-hadoop</exclude>\n-        <exclude>org.apache.hbase:hbase-shaded-mapreduce</exclude>\n-        <exclude>org.apache.htrace:htrace-core4</exclude>\n-        <exclude>org.apache.htrace:htrace-core</exclude>\n-        <exclude>org.apache.yetus:audience-annotations</exclude>\n-        <exclude>org.slf4j:slf4j-api</exclude>\n-        <exclude>org.slf4j:slf4j-log4j12</exclude>\n+              <exclude>com.github.stephenc.findbugs:findbugs-annotations</exclude>\n+              <exclude>commons-logging:commons-logging</exclude>\n+              <exclude>log4j:log4j</exclude>\n+              <exclude>org.apache.hbase:hbase-shaded-client</exclude>\n+              <exclude>org.apache.hbase:hbase-shaded-client-byo-hadoop</exclude>\n+              <exclude>org.apache.hbase:hbase-shaded-mapreduce</exclude>\n+              <exclude>org.apache.htrace:htrace-core4</exclude>\n+              <exclude>org.apache.htrace:htrace-core</exclude>\n+              <exclude>org.apache.yetus:audience-annotations</exclude>\n+              <exclude>org.slf4j:slf4j-api</exclude>\n+              <exclude>org.slf4j:jcl-over-slf4j</exclude>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5634becf77927fffa2878a66aa49184f184ab84d"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzEwNDQ2OA==", "bodyText": "Interesting", "url": "https://github.com/apache/hbase/pull/1640#discussion_r423104468", "createdAt": "2020-05-11T15:01:04Z", "author": {"login": "saintstack"}, "path": "hbase-asyncfs/pom.xml", "diffHunk": "@@ -72,6 +72,12 @@\n       <type>test-jar</type>\n       <scope>test</scope>\n     </dependency>\n+    <dependency>\n+      <groupId>org.apache.hbase</groupId>\n+      <artifactId>hbase-logging</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5634becf77927fffa2878a66aa49184f184ab84d"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzEwNzE0MA==", "bodyText": "Whats jcl and jul?", "url": "https://github.com/apache/hbase/pull/1640#discussion_r423107140", "createdAt": "2020-05-11T15:04:40Z", "author": {"login": "saintstack"}, "path": "hbase-common/pom.xml", "diffHunk": "@@ -212,9 +221,24 @@\n       <scope>test</scope>\n     </dependency>\n     <dependency>\n-      <!--For Hadoop-->\n+      <groupId>org.slf4j</groupId>\n+      <artifactId>jcl-over-slf4j</artifactId>\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.slf4j</groupId>\n+      <artifactId>jul-to-slf4j</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5634becf77927fffa2878a66aa49184f184ab84d"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzExOTE1OA==", "bodyText": "Good", "url": "https://github.com/apache/hbase/pull/1640#discussion_r423119158", "createdAt": "2020-05-11T15:21:29Z", "author": {"login": "saintstack"}, "path": "hbase-logging/src/main/java/org/apache/hadoop/hbase/logging/InternalLog4jUtils.java", "diffHunk": "@@ -0,0 +1,70 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hbase.logging;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.Enumeration;\n+import java.util.HashSet;\n+import java.util.Set;\n+import org.apache.yetus.audience.InterfaceAudience;\n+\n+/**\n+ * The actual class for operating on log4j.\n+ * <p/>\n+ * This class will depend on log4j directly, so callers should not use this class directly to avoid\n+ * introducing log4j dependencies to downstream users. Please call the methods in\n+ * {@link Log4jUtils}, as they will call the methods here through reflection.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5634becf77927fffa2878a66aa49184f184ab84d"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NjgxNDU5", "url": "https://github.com/apache/hbase/pull/1640#pullrequestreview-409681459", "createdAt": "2020-05-12T03:57:22Z", "commit": {"oid": "5634becf77927fffa2878a66aa49184f184ab84d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2042, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}