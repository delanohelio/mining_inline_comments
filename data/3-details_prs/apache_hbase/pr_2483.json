{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk1NjY0NTc4", "number": 2483, "title": "HBASE-25026 - Create a metric to track full region scans RPCs", "bodyText": "Initial PR to get the metrics that indicates full region scans.", "createdAt": "2020-09-30T17:25:17Z", "url": "https://github.com/apache/hbase/pull/2483", "merged": true, "mergeCommit": {"oid": "300b0a650f94567a1b0ca281cbc3d00f7eeb6956"}, "closed": true, "closedAt": "2020-11-17T03:18:59Z", "author": {"login": "gkanade"}, "timelineItems": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOBX1lgFqTQ5OTcxMjE2Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABddQxMPgFqTUzMTk5MTM3Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NzEyMTYy", "url": "https://github.com/apache/hbase/pull/2483#pullrequestreview-499712162", "createdAt": "2020-09-30T18:41:08Z", "commit": {"oid": "16cdf183b73fc2a6f4a5b88cdc5cdca7b7dcaa9b"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxODo0MTowOFrOHaqnKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxODo0NzoxNVrOHaq0-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcyMzE3OA==", "bodyText": "Full Region or full Table?", "url": "https://github.com/apache/hbase/pull/2483#discussion_r497723178", "createdAt": "2020-09-30T18:41:08Z", "author": {"login": "saintstack"}, "path": "hbase-hadoop-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionServerSource.java", "diffHunk": "@@ -571,6 +571,9 @@\n   String RPC_SCAN_REQUEST_COUNT = \"rpcScanRequestCount\";\n   String RPC_SCAN_REQUEST_COUNT_DESC =\n       \"Number of rpc scan requests this RegionServer has answered.\";\n+  String RPC_FULL_SCAN_REQUEST_COUNT = \"rpcFullScanRequestCount\";\n+  String RPC_FULL_SCAN_REQUEST_COUNT_DESC =\n+      \"Number of rpc scan requests that were possible full region scans.\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16cdf183b73fc2a6f4a5b88cdc5cdca7b7dcaa9b"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcyMzU2Mw==", "bodyText": "No need of space here", "url": "https://github.com/apache/hbase/pull/2483#discussion_r497723563", "createdAt": "2020-09-30T18:41:45Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "diffHunk": "@@ -1,4 +1,4 @@\n-/**\n+  /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16cdf183b73fc2a6f4a5b88cdc5cdca7b7dcaa9b"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcyNDg4Ng==", "bodyText": "Does this need javadoc/comment? It is NOT the same as the RegionInfo#startRow, right? If so, say so (my first though was why this data member when we have this info in RegionInfo... but this is the scan startRow...)", "url": "https://github.com/apache/hbase/pull/2483#discussion_r497724886", "createdAt": "2020-09-30T18:44:16Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "diffHunk": "@@ -7030,6 +7030,7 @@ public String toString() {\n     protected Cell joinedContinuationRow = null;\n     private boolean filterClosed = false;\n \n+    protected final byte[] startRow;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16cdf183b73fc2a6f4a5b88cdc5cdca7b7dcaa9b"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcyNjcxMw==", "bodyText": "Why exclude meta table scans? Do this check first before doing all the above byte array compares?", "url": "https://github.com/apache/hbase/pull/2483#discussion_r497726713", "createdAt": "2020-09-30T18:47:15Z", "author": {"login": "saintstack"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RSRpcServices.java", "diffHunk": "@@ -3498,6 +3501,18 @@ public ScanResponse scan(final RpcController controller, final ScanRequest reque\n       throw new ServiceException(e);\n     }\n     HRegion region = rsh.r;\n+    // If the start row is the actual start Row of the region and end row is actual end row of region\n+    // or\n+    // If the stop is not specified or the stop Row is greater than the end key of the current region\n+    if ((Bytes.equals(rsh.s.getStartRow(), region.getRegionInfo().getStartKey())\n+      && Bytes.equals(rsh.s.getStopRow(), region.getRegionInfo().getEndKey()))\n+      || Bytes.equals(rsh.s.getStopRow(), HConstants.EMPTY_END_ROW)\n+      || (Bytes.compareTo(region.getRegionInfo().getEndKey(), rsh.s.getStopRow()) <= 0\n+      && !Bytes.equals(region.getRegionInfo().getEndKey(), HConstants.EMPTY_END_ROW))) {\n+      if(!region.getTableDescriptor().isMetaTable()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16cdf183b73fc2a6f4a5b88cdc5cdca7b7dcaa9b"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwODM3MjA2", "url": "https://github.com/apache/hbase/pull/2483#pullrequestreview-500837206", "createdAt": "2020-10-02T03:05:07Z", "commit": {"oid": "1169cf7d697b4c26a6b29a0009f54ca81c87a866"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwMzowNTowN1rOHbgNsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwMzowNTowN1rOHbgNsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODYwMTM5NQ==", "bodyText": "We should not be exposing these in this interface. This interface is exposed to CPs possibly allowing to pollute the keys.\nWe can add a method which can check whether a full region scan or not. The RegionScannerImpl having ref to Scan instance as well as Region so it can check whether full region scan or not and return boolean", "url": "https://github.com/apache/hbase/pull/2483#discussion_r498601395", "createdAt": "2020-10-02T03:05:07Z", "author": {"login": "anoopsjohn"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RegionScanner.java", "diffHunk": "@@ -115,4 +116,12 @@\n    */\n   boolean nextRaw(List<Cell> result, ScannerContext scannerContext)\n       throws IOException;\n+\n+  default byte[] getStartRow() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1169cf7d697b4c26a6b29a0009f54ca81c87a866"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7192039e6fbb0c4cfcf8da5e0d9c652579a78821", "author": {"user": {"login": "gkanade", "name": null}}, "url": "https://github.com/apache/hbase/commit/7192039e6fbb0c4cfcf8da5e0d9c652579a78821", "committedDate": "2020-10-02T23:28:24Z", "message": "Merge branch 'hbase-25026' of https://github.com/gkanade/hbase into hbase-25026"}, "afterCommit": {"oid": "a90abf5515dd5963f539aaa339371d1d056d69cc", "author": {"user": {"login": "gkanade", "name": null}}, "url": "https://github.com/apache/hbase/commit/a90abf5515dd5963f539aaa339371d1d056d69cc", "committedDate": "2020-10-02T23:34:11Z", "message": "comment and spacing fixes\n\nuse full region scan bool interface"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a90abf5515dd5963f539aaa339371d1d056d69cc", "author": {"user": {"login": "gkanade", "name": null}}, "url": "https://github.com/apache/hbase/commit/a90abf5515dd5963f539aaa339371d1d056d69cc", "committedDate": "2020-10-02T23:34:11Z", "message": "comment and spacing fixes\n\nuse full region scan bool interface"}, "afterCommit": {"oid": "dd76e750afd026ee340ada2b1e9d5391766473ef", "author": {"user": {"login": "gkanade", "name": null}}, "url": "https://github.com/apache/hbase/commit/dd76e750afd026ee340ada2b1e9d5391766473ef", "committedDate": "2020-10-02T23:36:32Z", "message": "use full region scan bool interface\n\nIteration 1\n\ncomment and spacing fixes\n\nuse full region scan bool interface"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7e00016f039a824621f8f0535b2262f9fc76f634", "author": {"user": {"login": "gkanade", "name": null}}, "url": "https://github.com/apache/hbase/commit/7e00016f039a824621f8f0535b2262f9fc76f634", "committedDate": "2020-10-07T16:13:13Z", "message": "Made user table check cleaner"}, "afterCommit": {"oid": "6ba4f8acc9fa78096515c4720c1aa62c15973b5d", "author": {"user": {"login": "gkanade", "name": null}}, "url": "https://github.com/apache/hbase/commit/6ba4f8acc9fa78096515c4720c1aa62c15973b5d", "committedDate": "2020-10-07T18:55:53Z", "message": "Made user table check cleaner"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6ba4f8acc9fa78096515c4720c1aa62c15973b5d", "author": {"user": {"login": "gkanade", "name": null}}, "url": "https://github.com/apache/hbase/commit/6ba4f8acc9fa78096515c4720c1aa62c15973b5d", "committedDate": "2020-10-07T18:55:53Z", "message": "Made user table check cleaner"}, "afterCommit": {"oid": "9bef35c095668801070e0edb7e3d40e43c9b085e", "author": {"user": {"login": "ndimiduk", "name": "Nick Dimiduk"}}, "url": "https://github.com/apache/hbase/commit/9bef35c095668801070e0edb7e3d40e43c9b085e", "committedDate": "2020-10-07T19:02:36Z", "message": "Made check for user table only cleaner"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9bef35c095668801070e0edb7e3d40e43c9b085e", "author": {"user": {"login": "ndimiduk", "name": "Nick Dimiduk"}}, "url": "https://github.com/apache/hbase/commit/9bef35c095668801070e0edb7e3d40e43c9b085e", "committedDate": "2020-10-07T19:02:36Z", "message": "Made check for user table only cleaner"}, "afterCommit": {"oid": "9e1edc01397151dd5e8de094c7b34106a21d51fa", "author": {"user": {"login": "gkanade", "name": null}}, "url": "https://github.com/apache/hbase/commit/9e1edc01397151dd5e8de094c7b34106a21d51fa", "committedDate": "2020-10-07T18:55:52Z", "message": "added asf license message"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0NjI5MDIw", "url": "https://github.com/apache/hbase/pull/2483#pullrequestreview-504629020", "createdAt": "2020-10-08T10:11:10Z", "commit": {"oid": "89383694c696ba5da0edb1e4bd377533ba60f5e3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxMDoxMToxMFrOHeXeGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxMDoxMToxMFrOHeXeGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTYwMzg2NA==", "bodyText": "If we are doing this way - then I think it is better to have the default implementation in the interface returning 'false'. So that the downstreamers need not change this code. I think it is still better to have this check in RS (like a Util method)only rather than here because this will have an impact on projects like Phoenix. (because RegionScanner is exposed to CP).", "url": "https://github.com/apache/hbase/pull/2483#discussion_r501603864", "createdAt": "2020-10-08T10:11:10Z", "author": {"login": "ramkrish86"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RegionScanner.java", "diffHunk": "@@ -115,4 +116,6 @@\n    */\n   boolean nextRaw(List<Cell> result, ScannerContext scannerContext)\n       throws IOException;\n+\n+  boolean isFullRegionScan();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89383694c696ba5da0edb1e4bd377533ba60f5e3"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyNDA0MjY1", "url": "https://github.com/apache/hbase/pull/2483#pullrequestreview-512404265", "createdAt": "2020-10-20T07:26:41Z", "commit": {"oid": "d42ca89e1d3511fbdff89f2050093f4d640b6d0d"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQwNzoyNjo0MlrOHkuPoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQwNzoyOToxN1rOHkuVlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI2ODQ0OA==", "bodyText": "Not used.  Do we need this setter?", "url": "https://github.com/apache/hbase/pull/2483#discussion_r508268448", "createdAt": "2020-10-20T07:26:42Z", "author": {"login": "anoopsjohn"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "diffHunk": "@@ -9143,4 +9162,8 @@ public void setReadRequestsCount(long readRequestsCount) {\n   public void setWriteRequestsCount(long writeRequestsCount) {\n     this.writeRequestsCount.add(writeRequestsCount);\n   }\n+\n+  public void setFullScanRequestsCount(long fullScanRequestsCount) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d42ca89e1d3511fbdff89f2050093f4d640b6d0d"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI2ODk3Nw==", "bodyText": "Nit :  missing code formatting", "url": "https://github.com/apache/hbase/pull/2483#discussion_r508268977", "createdAt": "2020-10-20T07:27:39Z", "author": {"login": "anoopsjohn"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RSRpcServices.java", "diffHunk": "@@ -3498,6 +3501,12 @@ public ScanResponse scan(final RpcController controller, final ScanRequest reque\n       throw new ServiceException(e);\n     }\n     HRegion region = rsh.r;\n+    // If the start row is the actual start Row of the region and end row is actual end row of region\n+    // or\n+    // If the stop is not specified or the stop Row is greater than the end key of the current region\n+    if(!region.getRegionInfo().getTable().isSystemTable()){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d42ca89e1d3511fbdff89f2050093f4d640b6d0d"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI2OTE1OA==", "bodyText": "Unused import", "url": "https://github.com/apache/hbase/pull/2483#discussion_r508269158", "createdAt": "2020-10-20T07:27:53Z", "author": {"login": "anoopsjohn"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RegionScanner.java", "diffHunk": "@@ -23,6 +23,7 @@\n \n import org.apache.hadoop.hbase.Cell;\n import org.apache.hadoop.hbase.HBaseInterfaceAudience;\n+import org.apache.hadoop.hbase.HConstants;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d42ca89e1d3511fbdff89f2050093f4d640b6d0d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI2OTcyMQ==", "bodyText": "nit format\nif (isFullRegionScan()) {", "url": "https://github.com/apache/hbase/pull/2483#discussion_r508269721", "createdAt": "2020-10-20T07:28:53Z", "author": {"login": "anoopsjohn"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "diffHunk": "@@ -7238,6 +7246,9 @@ public boolean nextRaw(List<Cell> outResults, ScannerContext scannerContext)\n         rsServices.getMetrics().updateReadQueryMeter(getRegionInfo().getTable());\n       }\n \n+      if(isFullRegionScan()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d42ca89e1d3511fbdff89f2050093f4d640b6d0d"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI2OTk3NQ==", "bodyText": "Can be private now?", "url": "https://github.com/apache/hbase/pull/2483#discussion_r508269975", "createdAt": "2020-10-20T07:29:17Z", "author": {"login": "anoopsjohn"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "diffHunk": "@@ -7699,6 +7710,14 @@ public void run() throws IOException {\n       // callback\n       this.close();\n     }\n+\n+    public boolean isFullRegionScan() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d42ca89e1d3511fbdff89f2050093f4d640b6d0d"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzNDk5NTEy", "url": "https://github.com/apache/hbase/pull/2483#pullrequestreview-513499512", "createdAt": "2020-10-21T09:49:03Z", "commit": {"oid": "a2a655de440aabb4b5d7612cce685c16bcc3b0e1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwOTo0OTowM1rOHljnvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwOTo0OTowM1rOHljnvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTE0Mjk3Mw==", "bodyText": "Can add a comment saying what all we count as full scan..  the check is bit complex,.. So nice code level comment helps..  Also we can do this boolean eval at create of scan itself and use that boolean state? No need to do all thse bytes[] checks for every next() call?", "url": "https://github.com/apache/hbase/pull/2483#discussion_r509142973", "createdAt": "2020-10-21T09:49:03Z", "author": {"login": "anoopsjohn"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "diffHunk": "@@ -3075,6 +3080,13 @@ private RegionScannerImpl getScanner(Scan scan, List<KeyValueScanner> additional\n           checkFamily(family);\n         }\n       }\n+      if((Bytes.equals(scan.getStartRow(), getRegionInfo().getStartKey())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2a655de440aabb4b5d7612cce685c16bcc3b0e1"}, "originalPosition": 23}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "76398abb0fd359c33eb0ca68ce88cf22acab81cc", "author": {"user": {"login": "gkanade", "name": null}}, "url": "https://github.com/apache/hbase/commit/76398abb0fd359c33eb0ca68ce88cf22acab81cc", "committedDate": "2020-10-22T18:41:49Z", "message": "remove spaces"}, "afterCommit": {"oid": "3a32de67eef356c82c511df58ee522dfc2ff45a4", "author": {"user": {"login": "gkanade", "name": null}}, "url": "https://github.com/apache/hbase/commit/3a32de67eef356c82c511df58ee522dfc2ff45a4", "committedDate": "2020-10-22T18:44:37Z", "message": "Account at HRegion level"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ff81babdd9fbbf9854fe3628b1c0ff743c246b9c", "author": {"user": {"login": "gkanade", "name": null}}, "url": "https://github.com/apache/hbase/commit/ff81babdd9fbbf9854fe3628b1c0ff743c246b9c", "committedDate": "2020-10-22T18:59:18Z", "message": "added comment"}, "afterCommit": {"oid": "f71ffb37481dd021dc7a1a50e07462c701bb8eef", "author": {"user": {"login": "gkanade", "name": null}}, "url": "https://github.com/apache/hbase/commit/f71ffb37481dd021dc7a1a50e07462c701bb8eef", "committedDate": "2020-10-22T19:00:26Z", "message": "Account at HRegion level"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2MjY4OTAy", "url": "https://github.com/apache/hbase/pull/2483#pullrequestreview-516268902", "createdAt": "2020-10-24T10:59:15Z", "commit": {"oid": "f71ffb37481dd021dc7a1a50e07462c701bb8eef"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bab1b6f163362ab6b22d37acfc003e786fc8aee9", "author": {"user": {"login": "gkanade", "name": null}}, "url": "https://github.com/apache/hbase/commit/bab1b6f163362ab6b22d37acfc003e786fc8aee9", "committedDate": "2020-11-10T19:24:42Z", "message": "fixed test"}, "afterCommit": {"oid": "365363139fef83296a6c890afa721fc62fa43861", "author": {"user": {"login": "gkanade", "name": null}}, "url": "https://github.com/apache/hbase/commit/365363139fef83296a6c890afa721fc62fa43861", "committedDate": "2020-11-10T19:35:46Z", "message": "back to accounting at RSRpcServices"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "365363139fef83296a6c890afa721fc62fa43861", "author": {"user": {"login": "gkanade", "name": null}}, "url": "https://github.com/apache/hbase/commit/365363139fef83296a6c890afa721fc62fa43861", "committedDate": "2020-11-10T19:35:46Z", "message": "back to accounting at RSRpcServices"}, "afterCommit": {"oid": "28772ff4ece7fb5cc7c3359afeabb477e7810e02", "author": {"user": {"login": "gkanade", "name": null}}, "url": "https://github.com/apache/hbase/commit/28772ff4ece7fb5cc7c3359afeabb477e7810e02", "committedDate": "2020-11-10T20:00:47Z", "message": "back to accounting at RSRpcServices"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4MzgyNTU5", "url": "https://github.com/apache/hbase/pull/2483#pullrequestreview-528382559", "createdAt": "2020-11-11T17:24:26Z", "commit": {"oid": "28772ff4ece7fb5cc7c3359afeabb477e7810e02"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNzoyNDoyN1rOHxW7gg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNzoyNTowNlrOHxW9BA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTUxNzk1NA==", "bodyText": "This might not be needed. anyway we have inited to false na.", "url": "https://github.com/apache/hbase/pull/2483#discussion_r521517954", "createdAt": "2020-11-11T17:24:27Z", "author": {"login": "ramkrish86"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RSRpcServices.java", "diffHunk": "@@ -3167,7 +3187,18 @@ private RegionScannerHolder newRegionScanner(ScanRequest request, ScanResponse.B\n     builder.setMvccReadPoint(scanner.getMvccReadPoint());\n     builder.setTtl(scannerLeaseTimeoutPeriod);\n     String scannerName = String.valueOf(scannerId);\n-    return addScanner(scannerName, scanner, shipper, region, scan.isNeedCursorResult());\n+\n+    boolean isFullRegionScan = false;\n+    if(!region.getRegionInfo().getTable().isSystemTable()) {\n+      if(checkFullRegionScan(scan, region)){\n+        isFullRegionScan = true;\n+      } else {\n+        isFullRegionScan = false;\n+      }\n+    } else {\n+      isFullRegionScan = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28772ff4ece7fb5cc7c3359afeabb477e7810e02"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTUxODM0MA==", "bodyText": "Ya this looks good. So this is happening only for scan na ?", "url": "https://github.com/apache/hbase/pull/2483#discussion_r521518340", "createdAt": "2020-11-11T17:25:06Z", "author": {"login": "ramkrish86"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RSRpcServices.java", "diffHunk": "@@ -3481,6 +3512,9 @@ public ScanResponse scan(final RpcController controller, final ScanRequest reque\n       }\n       throw new ServiceException(e);\n     }\n+    if(rsh.isFullRegionScan) {\n+      rpcFullScanRequestCount.increment();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28772ff4ece7fb5cc7c3359afeabb477e7810e02"}, "originalPosition": 87}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NzQ3NjEw", "url": "https://github.com/apache/hbase/pull/2483#pullrequestreview-528747610", "createdAt": "2020-11-12T04:49:55Z", "commit": {"oid": "798d8dfb314a141b9d9991d122a884bd5c79bd2f"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNDo0OTo1NVrOHxqbOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNDo1Mzo1MVrOHxqfXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTgzNzM2OQ==", "bodyText": "Nit: whitespace lines", "url": "https://github.com/apache/hbase/pull/2483#discussion_r521837369", "createdAt": "2020-11-12T04:49:55Z", "author": {"login": "anoopsjohn"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RSRpcServices.java", "diffHunk": "@@ -1336,14 +1342,31 @@ private RegionScannerHolder addScanner(String scannerName, RegionScanner s, Ship\n     } else {\n       closeCallback = new RegionScannerCloseCallBack(s);\n     }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "798d8dfb314a141b9d9991d122a884bd5c79bd2f"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTgzNzQ5MA==", "bodyText": "nit: Format line so that max length is 100", "url": "https://github.com/apache/hbase/pull/2483#discussion_r521837490", "createdAt": "2020-11-12T04:50:20Z", "author": {"login": "anoopsjohn"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RSRpcServices.java", "diffHunk": "@@ -1336,14 +1342,31 @@ private RegionScannerHolder addScanner(String scannerName, RegionScanner s, Ship\n     } else {\n       closeCallback = new RegionScannerCloseCallBack(s);\n     }\n+\n+\n+\n     RegionScannerHolder rsh =\n-        new RegionScannerHolder(scannerName, s, r, closeCallback, shippedCallback, needCursor);\n+        new RegionScannerHolder(scannerName, s, r, closeCallback, shippedCallback, needCursor, isFullRegionScan);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "798d8dfb314a141b9d9991d122a884bd5c79bd2f"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTgzNzgxMQ==", "bodyText": "nit : format missing.  there should be a space between if and (", "url": "https://github.com/apache/hbase/pull/2483#discussion_r521837811", "createdAt": "2020-11-12T04:51:46Z", "author": {"login": "anoopsjohn"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RSRpcServices.java", "diffHunk": "@@ -3164,7 +3187,14 @@ private RegionScannerHolder newRegionScanner(ScanRequest request, ScanResponse.B\n     builder.setMvccReadPoint(scanner.getMvccReadPoint());\n     builder.setTtl(scannerLeaseTimeoutPeriod);\n     String scannerName = String.valueOf(scannerId);\n-    return addScanner(scannerName, scanner, shipper, region, scan.isNeedCursorResult());\n+\n+    boolean isFullRegionScan = false;\n+    if(!region.getRegionInfo().getTable().isSystemTable()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "798d8dfb314a141b9d9991d122a884bd5c79bd2f"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTgzODI0NQ==", "bodyText": "BTW this can be single line simply\nboolean isFullRegionScan = !region.getRegionInfo().getTable().isSystemTable() && checkFullRegionScan(scan, region);\ncheckFullRegionScan ->  isFullRegionScan", "url": "https://github.com/apache/hbase/pull/2483#discussion_r521838245", "createdAt": "2020-11-12T04:53:16Z", "author": {"login": "anoopsjohn"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RSRpcServices.java", "diffHunk": "@@ -3164,7 +3187,14 @@ private RegionScannerHolder newRegionScanner(ScanRequest request, ScanResponse.B\n     builder.setMvccReadPoint(scanner.getMvccReadPoint());\n     builder.setTtl(scannerLeaseTimeoutPeriod);\n     String scannerName = String.valueOf(scannerId);\n-    return addScanner(scannerName, scanner, shipper, region, scan.isNeedCursorResult());\n+\n+    boolean isFullRegionScan = false;\n+    if(!region.getRegionInfo().getTable().isSystemTable()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTgzNzgxMQ=="}, "originalCommit": {"oid": "798d8dfb314a141b9d9991d122a884bd5c79bd2f"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTgzODQzMA==", "bodyText": "Nit :   if( ->   if (", "url": "https://github.com/apache/hbase/pull/2483#discussion_r521838430", "createdAt": "2020-11-12T04:53:51Z", "author": {"login": "anoopsjohn"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RSRpcServices.java", "diffHunk": "@@ -3481,6 +3512,9 @@ public ScanResponse scan(final RpcController controller, final ScanRequest reque\n       }\n       throw new ServiceException(e);\n     }\n+    if(rsh.isFullRegionScan) {\n+      rpcFullScanRequestCount.increment();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTUxODM0MA=="}, "originalCommit": {"oid": "28772ff4ece7fb5cc7c3359afeabb477e7810e02"}, "originalPosition": 87}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "962e4837d8424098e2e05c5950616355434f3efb", "author": {"user": {"login": "gkanade", "name": null}}, "url": "https://github.com/apache/hbase/commit/962e4837d8424098e2e05c5950616355434f3efb", "committedDate": "2020-11-13T21:11:49Z", "message": "renamed as per convention"}, "afterCommit": {"oid": "6939673fa895671f8c4de4a5e2a0804511431b68", "author": {"user": {"login": "gkanade", "name": null}}, "url": "https://github.com/apache/hbase/commit/6939673fa895671f8c4de4a5e2a0804511431b68", "committedDate": "2020-11-13T21:15:04Z", "message": "Iteration 1\n\nAdd new metric rpcFullScanRequestCount to track number of requests that\nare full region scans. Can be used to notify user to check if this is\ntruly intended"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwOTI1Nzk5", "url": "https://github.com/apache/hbase/pull/2483#pullrequestreview-530925799", "createdAt": "2020-11-16T05:26:32Z", "commit": {"oid": "6939673fa895671f8c4de4a5e2a0804511431b68"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5cbf0db1d9674ea3228969582ea49f0dc41cade", "author": {"user": {"login": "gkanade", "name": null}}, "url": "https://github.com/apache/hbase/commit/c5cbf0db1d9674ea3228969582ea49f0dc41cade", "committedDate": "2020-11-16T19:32:01Z", "message": "Iteration 1\n\nAdd new metric rpcFullScanRequestCount to track number of requests that\nare full region scans. Can be used to notify user to check if this is\ntruly intended"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9dddcb25e99d9029e57d0cc390198df902d732af", "author": {"user": {"login": "gkanade", "name": null}}, "url": "https://github.com/apache/hbase/commit/9dddcb25e99d9029e57d0cc390198df902d732af", "committedDate": "2020-11-16T19:26:30Z", "message": "adjusted naming convention"}, "afterCommit": {"oid": "c5cbf0db1d9674ea3228969582ea49f0dc41cade", "author": {"user": {"login": "gkanade", "name": null}}, "url": "https://github.com/apache/hbase/commit/c5cbf0db1d9674ea3228969582ea49f0dc41cade", "committedDate": "2020-11-16T19:32:01Z", "message": "Iteration 1\n\nAdd new metric rpcFullScanRequestCount to track number of requests that\nare full region scans. Can be used to notify user to check if this is\ntruly intended"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxOTkxMzcz", "url": "https://github.com/apache/hbase/pull/2483#pullrequestreview-531991373", "createdAt": "2020-11-17T03:13:15Z", "commit": {"oid": "c5cbf0db1d9674ea3228969582ea49f0dc41cade"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4630, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}