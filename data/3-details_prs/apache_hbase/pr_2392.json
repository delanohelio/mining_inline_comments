{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg2MTg5MTI3", "number": 2392, "title": "HBASE-25013 Avoid reset the backup master root cache every time when \u2026", "bodyText": "\u2026syncing", "createdAt": "2020-09-13T14:22:30Z", "url": "https://github.com/apache/hbase/pull/2392", "merged": true, "mergeCommit": {"oid": "f440ea92eef1b79117a662c1538c3df8ead7077b"}, "closed": true, "closedAt": "2020-09-21T12:32:16Z", "author": {"login": "Apache9"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdIqye7gBqjM3NjEyNDgyMDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLAtAvAFqTQ5MjQ1Nzc5Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "62b6f25186bc87ad97416015cd671c1bef98318c", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/62b6f25186bc87ad97416015cd671c1bef98318c", "committedDate": "2020-09-13T14:21:28Z", "message": "HBASE-25013 Avoid reset the backup master root cache every time when syncing"}, "afterCommit": {"oid": "cb58eeff56da8b15c8c8ebc5b804da1a9d7a020a", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/cb58eeff56da8b15c8c8ebc5b804da1a9d7a020a", "committedDate": "2020-09-14T03:32:07Z", "message": "HBASE-25013 Avoid reset the backup master root cache every time when syncing"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8ef0cba0857ff24e00331766483df36afbffcb40", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/8ef0cba0857ff24e00331766483df36afbffcb40", "committedDate": "2020-09-14T07:12:50Z", "message": "fix UT"}, "afterCommit": {"oid": "fd360372be793e54041999ad32f0d64bd6f92c81", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/fd360372be793e54041999ad32f0d64bd6f92c81", "committedDate": "2020-09-15T13:54:52Z", "message": "HBASE-25013 Avoid reset the backup master root cache every time when syncing"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fd360372be793e54041999ad32f0d64bd6f92c81", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/fd360372be793e54041999ad32f0d64bd6f92c81", "committedDate": "2020-09-15T13:54:52Z", "message": "HBASE-25013 Avoid reset the backup master root cache every time when syncing"}, "afterCommit": {"oid": "384752fa50b629326da6bb90f7c861b56ed44b12", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/384752fa50b629326da6bb90f7c861b56ed44b12", "committedDate": "2020-09-17T09:10:30Z", "message": "HBASE-25013 Avoid reset the backup master root cache every time when syncing"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "384752fa50b629326da6bb90f7c861b56ed44b12", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/384752fa50b629326da6bb90f7c861b56ed44b12", "committedDate": "2020-09-17T09:10:30Z", "message": "HBASE-25013 Avoid reset the backup master root cache every time when syncing"}, "afterCommit": {"oid": "3a61dc806293acbd47dee021a48b97a446caa963", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/3a61dc806293acbd47dee021a48b97a446caa963", "committedDate": "2020-09-17T15:41:23Z", "message": "HBASE-25013 Avoid reset the backup master root cache every time when syncing"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3a61dc806293acbd47dee021a48b97a446caa963", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/3a61dc806293acbd47dee021a48b97a446caa963", "committedDate": "2020-09-17T15:41:23Z", "message": "HBASE-25013 Avoid reset the backup master root cache every time when syncing"}, "afterCommit": {"oid": "f89190fbbb61e0839be1398f77fbaa44cf13eec6", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/f89190fbbb61e0839be1398f77fbaa44cf13eec6", "committedDate": "2020-09-18T03:20:16Z", "message": "HBASE-25013 Avoid reset the backup master root cache every time when syncing"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f89190fbbb61e0839be1398f77fbaa44cf13eec6", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/f89190fbbb61e0839be1398f77fbaa44cf13eec6", "committedDate": "2020-09-18T03:20:16Z", "message": "HBASE-25013 Avoid reset the backup master root cache every time when syncing"}, "afterCommit": {"oid": "a0e3c8e7bda7b93b01651ea73dc13217a0cbbdb2", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/a0e3c8e7bda7b93b01651ea73dc13217a0cbbdb2", "committedDate": "2020-09-18T07:11:35Z", "message": "HBASE-25013 Avoid reset the backup master root cache every time when syncing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxOTY5ODg5", "url": "https://github.com/apache/hbase/pull/2392#pullrequestreview-491969889", "createdAt": "2020-09-19T05:31:22Z", "commit": {"oid": "a0e3c8e7bda7b93b01651ea73dc13217a0cbbdb2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOVQwNTozMToyMlrOHUg4mQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOVQwNTozMToyMlrOHUg4mQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTI3MjM0NQ==", "bodyText": "This may log a negative number?", "url": "https://github.com/apache/hbase/pull/2392#discussion_r491272345", "createdAt": "2020-09-19T05:31:22Z", "author": {"login": "infraio"}, "path": "hbase-balancer/src/main/java/org/apache/hadoop/hbase/MetaTableAccessor.java", "diffHunk": "@@ -486,26 +485,12 @@ public static void scanMeta(Connection connection, @Nullable final byte[] startR\n \n     if (LOG.isTraceEnabled()) {\n       LOG.trace(\"Scanning META\" + \" starting at row=\" + Bytes.toStringBinary(startRow) +\n-        \" stopping at row=\" + Bytes.toStringBinary(stopRow) + \" for max=\" + rowUpperLimit +\n+        \" stopping at row=\" + Bytes.toStringBinary(stopRow) + \" for max=\" + maxRows +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a0e3c8e7bda7b93b01651ea73dc13217a0cbbdb2"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxOTczNTQ1", "url": "https://github.com/apache/hbase/pull/2392#pullrequestreview-491973545", "createdAt": "2020-09-19T05:50:54Z", "commit": {"oid": "a0e3c8e7bda7b93b01651ea73dc13217a0cbbdb2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOVQwNTo1MDo1NFrOHUhRNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOVQwNTo1MDo1NFrOHUhRNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTI3ODY0NA==", "bodyText": "What is the key thing of this jira? Just refactor getAllMetaRegionLocations to syncRoot? And I thought maybe need a better name for understand.", "url": "https://github.com/apache/hbase/pull/2392#discussion_r491278644", "createdAt": "2020-09-19T05:50:54Z", "author": {"login": "infraio"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/MetaLocationCache.java", "diffHunk": "@@ -102,34 +111,43 @@\n       master.getConfiguration().getInt(SYNC_INTERVAL_SECONDS, DEFAULT_SYNC_INTERVAL_SECONDS);\n     int fetchTimeoutMs =\n       master.getConfiguration().getInt(FETCH_TIMEOUT_MS, DEFAULT_FETCH_TIMEOUT_MS);\n-    master.getChoreService().scheduleChore(new ScheduledChore(\n-      getClass().getSimpleName() + \"-Sync-Chore\", this, syncIntervalSeconds, 0, TimeUnit.SECONDS) {\n+    refreshChore = new ScheduledChore(getClass().getSimpleName() + \"-Sync-Chore\", this,\n+      syncIntervalSeconds, 0, TimeUnit.SECONDS) {\n \n       @Override\n       protected void chore() {\n         AsyncClusterConnection conn = master.getAsyncClusterConnection();\n         if (conn != null) {\n-          addListener(conn.getAllMetaRegionLocations(fetchTimeoutMs), (locs, error) -> {\n+          final CacheHolder ch = holder.get();\n+          long lastSyncSeqId = ch != null ? ch.lastSyncSeqId : HConstants.NO_SEQNUM;\n+          addListener(conn.syncRoot(lastSyncSeqId, fetchTimeoutMs), (resp, error) -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a0e3c8e7bda7b93b01651ea73dc13217a0cbbdb2"}, "originalPosition": 67}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a0e3c8e7bda7b93b01651ea73dc13217a0cbbdb2", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/a0e3c8e7bda7b93b01651ea73dc13217a0cbbdb2", "committedDate": "2020-09-18T07:11:35Z", "message": "HBASE-25013 Avoid reset the backup master root cache every time when syncing"}, "afterCommit": {"oid": "6b82675dcfac1784a7d36565d699a916a9e836d3", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/6b82675dcfac1784a7d36565d699a916a9e836d3", "committedDate": "2020-09-20T03:44:05Z", "message": "HBASE-25013 Avoid reset the backup master root cache every time when syncing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3a1d8d2122e714af65d7138c6f4d77d8d1a44a1", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/b3a1d8d2122e714af65d7138c6f4d77d8d1a44a1", "committedDate": "2020-09-20T08:33:39Z", "message": "HBASE-25013 Avoid reset the backup master root cache every time when syncing"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6b82675dcfac1784a7d36565d699a916a9e836d3", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/6b82675dcfac1784a7d36565d699a916a9e836d3", "committedDate": "2020-09-20T03:44:05Z", "message": "HBASE-25013 Avoid reset the backup master root cache every time when syncing"}, "afterCommit": {"oid": "b3a1d8d2122e714af65d7138c6f4d77d8d1a44a1", "author": {"user": {"login": "Apache9", "name": "Duo Zhang"}}, "url": "https://github.com/apache/hbase/commit/b3a1d8d2122e714af65d7138c6f4d77d8d1a44a1", "committedDate": "2020-09-20T08:33:39Z", "message": "HBASE-25013 Avoid reset the backup master root cache every time when syncing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyNDU3Nzky", "url": "https://github.com/apache/hbase/pull/2392#pullrequestreview-492457792", "createdAt": "2020-09-21T10:19:34Z", "commit": {"oid": "b3a1d8d2122e714af65d7138c6f4d77d8d1a44a1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4800, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}