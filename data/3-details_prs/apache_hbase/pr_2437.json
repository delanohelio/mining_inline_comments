{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwNjY2ODA0", "number": 2437, "title": "HBASE-25053 WAL replay should ignore 0-length files", "bodyText": "", "createdAt": "2020-09-22T03:21:40Z", "url": "https://github.com/apache/hbase/pull/2437", "merged": true, "mergeCommit": {"oid": "0e71d6192ae731b3c05726ea49bb3b623d5e5487"}, "closed": true, "closedAt": "2020-11-04T16:21:31Z", "author": {"login": "nyl3532016"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLS1gOAFqTQ5MzE4Nzg4MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdRLtJcgFqTUwNjEwMTcxMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMTg3ODgw", "url": "https://github.com/apache/hbase/pull/2437#pullrequestreview-493187880", "createdAt": "2020-09-22T07:27:08Z", "commit": {"oid": "714367ca5493c184bfeeeb3b980e1692c5dbe466"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "714367ca5493c184bfeeeb3b980e1692c5dbe466", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/714367ca5493c184bfeeeb3b980e1692c5dbe466", "committedDate": "2020-09-22T03:17:36Z", "message": "HBASE-25053 WAL replay should ignore 0-length files"}, "afterCommit": {"oid": "b3f83c0bcc3724ff80eea4e5ee453920f380844a", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/b3f83c0bcc3724ff80eea4e5ee453920f380844a", "committedDate": "2020-09-27T13:15:10Z", "message": "HBASE-25053 WAL replay should ignore 0-length files"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MDgzOTkw", "url": "https://github.com/apache/hbase/pull/2437#pullrequestreview-497083990", "createdAt": "2020-09-27T14:05:32Z", "commit": {"oid": "b3f83c0bcc3724ff80eea4e5ee453920f380844a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QxNDowNTozM1rOHYnmfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QxNDowNTozM1rOHYnmfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTU3NjcwMw==", "bodyText": "But after this, you do not get the stat again?\nAnyway, my point here is that, make sure that when we call this method, we have already finished renaming the wal directory and calling recover lease on the wal files. Calling recoverLease and then re-get the FileStatus will generate extra load to NameNode.", "url": "https://github.com/apache/hbase/pull/2437#discussion_r495576703", "createdAt": "2020-09-27T14:05:33Z", "author": {"login": "Apache9"}, "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "diffHunk": "@@ -6423,7 +6427,11 @@ protected void restoreEdit(HStore s, Cell cell, MemStoreSizing memstoreAccountin\n    * @throws IOException\n    */\n   private static boolean isZeroLengthThenDelete(final FileSystem fs, final FileStatus stat,\n-      final Path p) throws IOException {\n+      final Path p, Configuration conf) throws IOException {\n+    if (stat.getLen() > 0) {\n+      return false;\n+    }\n+    RecoverLeaseFSUtils.recoverFileLease(fs, p, conf);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3f83c0bcc3724ff80eea4e5ee453920f380844a"}, "originalPosition": 48}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b3f83c0bcc3724ff80eea4e5ee453920f380844a", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/b3f83c0bcc3724ff80eea4e5ee453920f380844a", "committedDate": "2020-09-27T13:15:10Z", "message": "HBASE-25053 WAL replay should ignore 0-length files"}, "afterCommit": {"oid": "f80000eb59b01ae95f05651045c7b11c372248cc", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/f80000eb59b01ae95f05651045c7b11c372248cc", "committedDate": "2020-09-28T10:20:29Z", "message": "HBASE-25053 WAL replay should ignore 0-length files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33ed6332b426ec1e14421ee297ca11ba22832799", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/33ed6332b426ec1e14421ee297ca11ba22832799", "committedDate": "2020-10-02T02:23:18Z", "message": "HBASE-25053 WAL replay should ignore 0-length files"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f80000eb59b01ae95f05651045c7b11c372248cc", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/f80000eb59b01ae95f05651045c7b11c372248cc", "committedDate": "2020-09-28T10:20:29Z", "message": "HBASE-25053 WAL replay should ignore 0-length files"}, "afterCommit": {"oid": "33ed6332b426ec1e14421ee297ca11ba22832799", "author": {"user": null}, "url": "https://github.com/apache/hbase/commit/33ed6332b426ec1e14421ee297ca11ba22832799", "committedDate": "2020-10-02T02:23:18Z", "message": "HBASE-25053 WAL replay should ignore 0-length files"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MTAxNzEw", "url": "https://github.com/apache/hbase/pull/2437#pullrequestreview-506101710", "createdAt": "2020-10-10T14:32:13Z", "commit": {"oid": "33ed6332b426ec1e14421ee297ca11ba22832799"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4526, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}