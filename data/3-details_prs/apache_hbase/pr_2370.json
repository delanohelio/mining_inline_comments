{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyNzI2MTgw", "number": 2370, "title": "HBASE-25002 Create simple pattern matching query for retrieving metri\u2026", "bodyText": "Supports a pattern for getting a JMX metrics. This is helpful when we have multiple metrics under a the Tables category, then fetching the entire metric under Tables may be very big. So this helps to fetch a certain pattern of metrics alone and returns them as JSON.\nThe format is\nhttp://../jmx?get=Hadoop:service=HBase,name=RegionServer,sub=Tables::[a-zA-z_0-9]*memStoreSize,[a-zA-z_0-9]*storeFileSize", "createdAt": "2020-09-09T10:01:39Z", "url": "https://github.com/apache/hbase/pull/2370", "merged": true, "mergeCommit": {"oid": "a3f40287ad53ee49b1629fe16914cdab771edfbf"}, "closed": true, "closedAt": "2020-09-14T13:37:41Z", "author": {"login": "ramkrish86"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHJKIZgH2gAyNDgyNzI2MTgwOmJhNzgzNjU5Yzk0M2RkMTkxNjU2ODY4NWFhMGRhYjBiN2E4ODM0MDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdIsbIMgH2gAyNDgyNzI2MTgwOjNlNzEzZjdlZTUyNmM4N2NiMTI3Y2M1MGE0OGMyMTMzNWJmOTZlMzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ba783659c943dd1916568685aa0dab0b7a883403", "author": {"user": {"login": "ramkrish86", "name": null}}, "url": "https://github.com/apache/hbase/commit/ba783659c943dd1916568685aa0dab0b7a883403", "committedDate": "2020-09-09T09:54:55Z", "message": "HBASE-25002 Create simple pattern matching query for retrieving metrics matching the pattern"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1NTU3NzA1", "url": "https://github.com/apache/hbase/pull/2370#pullrequestreview-485557705", "createdAt": "2020-09-10T04:31:18Z", "commit": {"oid": "ba783659c943dd1916568685aa0dab0b7a883403"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1NjQyODc3", "url": "https://github.com/apache/hbase/pull/2370#pullrequestreview-485642877", "createdAt": "2020-09-10T07:13:39Z", "commit": {"oid": "ba783659c943dd1916568685aa0dab0b7a883403"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwNzoxMzozOVrOHPmJmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwNzoyMzowM1rOHPmc3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjExNTczNw==", "bodyText": "Wanted this log level change?", "url": "https://github.com/apache/hbase/pull/2370#discussion_r486115737", "createdAt": "2020-09-10T07:13:39Z", "author": {"login": "anoopsjohn"}, "path": "hbase-http/src/main/java/org/apache/hadoop/hbase/util/JSONBean.java", "diffHunk": "@@ -125,11 +130,13 @@ public int write(MBeanServer mBeanServer, ObjectName qry, String attribute,\n    */\n   private static int write(JsonWriter writer, MBeanServer mBeanServer, ObjectName qry,\n       String attribute, boolean description) throws IOException {\n-    LOG.trace(\"Listing beans for \" + qry);\n+    LOG.debug(\"Listing beans for \" + qry);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba783659c943dd1916568685aa0dab0b7a883403"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjExODE5MQ==", "bodyText": "You can avoid this boolean. Just use String[] and check for null value and call diff write methods?", "url": "https://github.com/apache/hbase/pull/2370#discussion_r486118191", "createdAt": "2020-09-10T07:18:28Z", "author": {"login": "anoopsjohn"}, "path": "hbase-http/src/main/java/org/apache/hadoop/hbase/util/JSONBean.java", "diffHunk": "@@ -125,11 +130,13 @@ public int write(MBeanServer mBeanServer, ObjectName qry, String attribute,\n    */\n   private static int write(JsonWriter writer, MBeanServer mBeanServer, ObjectName qry,\n       String attribute, boolean description) throws IOException {\n-    LOG.trace(\"Listing beans for \" + qry);\n+    LOG.debug(\"Listing beans for \" + qry);\n     Set<ObjectName> names = null;\n     names = mBeanServer.queryNames(qry, null);\n     writer.name(\"beans\").beginArray();\n     Iterator<ObjectName> it = names.iterator();\n+    boolean pattern = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba783659c943dd1916568685aa0dab0b7a883403"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjEyMDY2OQ==", "bodyText": "We are compiling this pattern for each and every MBean attribute.  This will be costly. we could have compiled the attribute and kept that in an Array at 1st step itself (instead of keeping the regex patterns in String[])", "url": "https://github.com/apache/hbase/pull/2370#discussion_r486120669", "createdAt": "2020-09-10T07:23:03Z", "author": {"login": "anoopsjohn"}, "path": "hbase-http/src/main/java/org/apache/hadoop/hbase/util/JSONBean.java", "diffHunk": "@@ -237,6 +267,22 @@ private static void writeAttribute(JsonWriter writer, MBeanServer mBeanServer, O\n     if (attName.indexOf(\"=\") >= 0 || attName.indexOf(\":\") >= 0 || attName.indexOf(\" \") >= 0) {\n       return;\n     }\n+\n+    if (pattern != null) {\n+      boolean matchFound = false;\n+      for (String patt : pattern) {\n+        Pattern compile = Pattern.compile(patt);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba783659c943dd1916568685aa0dab0b7a883403"}, "originalPosition": 102}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55f8e1795cd54f0bba3a0fd6733d5f6553316505", "author": {"user": {"login": "ramkrish86", "name": null}}, "url": "https://github.com/apache/hbase/commit/55f8e1795cd54f0bba3a0fd6733d5f6553316505", "committedDate": "2020-09-10T07:41:16Z", "message": "Address review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1ODAxNzUx", "url": "https://github.com/apache/hbase/pull/2370#pullrequestreview-485801751", "createdAt": "2020-09-10T10:37:49Z", "commit": {"oid": "55f8e1795cd54f0bba3a0fd6733d5f6553316505"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMDozNzo0OVrOHPtlcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMDo0MzowMFrOHPtvgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjIzNzU1NQ==", "bodyText": "Ok to change. Can u also change to use {} format log line. Anyways that will be nice to have", "url": "https://github.com/apache/hbase/pull/2370#discussion_r486237555", "createdAt": "2020-09-10T10:37:49Z", "author": {"login": "anoopsjohn"}, "path": "hbase-http/src/main/java/org/apache/hadoop/hbase/util/JSONBean.java", "diffHunk": "@@ -125,11 +130,13 @@ public int write(MBeanServer mBeanServer, ObjectName qry, String attribute,\n    */\n   private static int write(JsonWriter writer, MBeanServer mBeanServer, ObjectName qry,\n       String attribute, boolean description) throws IOException {\n-    LOG.trace(\"Listing beans for \" + qry);\n+    LOG.debug(\"Listing beans for \" + qry);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjExNTczNw=="}, "originalCommit": {"oid": "ba783659c943dd1916568685aa0dab0b7a883403"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjIzODg5Mw==", "bodyText": "Infact u can see we dont need such if else, end of the day we call same writeAttribute which is having Pattern[] arg and we have null check there anyways.", "url": "https://github.com/apache/hbase/pull/2370#discussion_r486238893", "createdAt": "2020-09-10T10:40:32Z", "author": {"login": "anoopsjohn"}, "path": "hbase-http/src/main/java/org/apache/hadoop/hbase/util/JSONBean.java", "diffHunk": "@@ -216,7 +239,12 @@ private static int write(JsonWriter writer, MBeanServer mBeanServer, ObjectName\n       } else {\n         MBeanAttributeInfo[] attrs = minfo.getAttributes();\n         for (int i = 0; i < attrs.length; i++) {\n-          writeAttribute(writer, mBeanServer, oname, description, attrs[i]);\n+          if (matchingPattern != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55f8e1795cd54f0bba3a0fd6733d5f6553316505"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjIzODk4OA==", "bodyText": "Ya even this also not needed.", "url": "https://github.com/apache/hbase/pull/2370#discussion_r486238988", "createdAt": "2020-09-10T10:40:43Z", "author": {"login": "anoopsjohn"}, "path": "hbase-http/src/main/java/org/apache/hadoop/hbase/util/JSONBean.java", "diffHunk": "@@ -225,8 +253,14 @@ private static int write(JsonWriter writer, MBeanServer mBeanServer, ObjectName\n     return 0;\n   }\n \n+  private static void writeAttribute(final JsonWriter jg, final MBeanServer mBeanServer,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55f8e1795cd54f0bba3a0fd6733d5f6553316505"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjI0MDEzMQ==", "bodyText": "Call its  pattern : patterns?", "url": "https://github.com/apache/hbase/pull/2370#discussion_r486240131", "createdAt": "2020-09-10T10:43:00Z", "author": {"login": "anoopsjohn"}, "path": "hbase-http/src/main/java/org/apache/hadoop/hbase/util/JSONBean.java", "diffHunk": "@@ -237,6 +271,21 @@ private static void writeAttribute(JsonWriter writer, MBeanServer mBeanServer, O\n     if (attName.indexOf(\"=\") >= 0 || attName.indexOf(\":\") >= 0 || attName.indexOf(\" \") >= 0) {\n       return;\n     }\n+\n+    if (pattern != null) {\n+      boolean matchFound = false;\n+      for (Pattern compile : pattern) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55f8e1795cd54f0bba3a0fd6733d5f6553316505"}, "originalPosition": 105}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02bd4874545f693bf5fe44d4fe3c8338a8233152", "author": {"user": {"login": "ramkrish86", "name": null}}, "url": "https://github.com/apache/hbase/commit/02bd4874545f693bf5fe44d4fe3c8338a8233152", "committedDate": "2020-09-10T16:36:22Z", "message": "Final set of comments addressed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e713f7ee526c87cb127cc50a48c21335bf96e30", "author": {"user": {"login": "ramkrish86", "name": null}}, "url": "https://github.com/apache/hbase/commit/3e713f7ee526c87cb127cc50a48c21335bf96e30", "committedDate": "2020-09-14T05:34:05Z", "message": "Address checkstyle comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4772, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}