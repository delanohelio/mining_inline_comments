{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxMDg1MzA3", "number": 3197, "title": "GH-3183: Add ReactiveRequestHandlerAdvice", "bodyText": "Fixes #3183\n\nIntroduce a ReactiveRequestHandlerAdvice with a BiFunction<Message<?>, Mono<?>, Publisher<?>>\nlogic to apply a Mono.transform() operator for a returned from the handler Mono reply\nFix WebFluxRequestExecutingMessageHandler to return a Mono.then() instead of an explicit subscription -\nit happens downstream anyway during reply producing with a proper error handling, too\nDemonstrate ReactiveRequestHandlerAdvice in the RSocketDslTests - without retry() it fails\nAdd ConsumerEndpointSpec.customizeMonoReply() for convenience\nDocument ReactiveRequestHandlerAdvice feature", "createdAt": "2020-02-27T21:35:37Z", "url": "https://github.com/spring-projects/spring-integration/pull/3197", "merged": true, "mergeCommit": {"oid": "c84d2642941e8e14ad523b883535d7d6b9d79506"}, "closed": true, "closedAt": "2020-03-05T18:37:55Z", "author": {"login": "artembilan"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcI0HkAABqjMwODMwMzUxNzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKv9FZgFqTM2OTgxNjU0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a55f71f78d5690a9dc9e9e6747e95cd60ffe6c8f", "author": {"user": {"login": "artembilan", "name": "Artem Bilan"}}, "url": "https://github.com/spring-projects/spring-integration/commit/a55f71f78d5690a9dc9e9e6747e95cd60ffe6c8f", "committedDate": "2020-02-27T21:33:22Z", "message": "GH-3183: Add ReactiveRequestHandlerAdvice\n\nFixes https://github.com/spring-projects/spring-integration/issues/3183\n\n* Introduce a `BaseReplyProducingMessageHandler` with common advices logic for target message handler\n* Implement `BaseReplyProducingMessageHandler` from the `AbstractReplyProducingMessageHandler`\nand newly introduced `AbstractReactiveReplyProducingMessageHandler` for message handlers with `Mono` replies\n* Introduce a `ReactiveRequestHandlerAdvice` with a `BiFunction<Message<?>, Mono<?>, Publisher<?>>`\nlogic to apply a `Mono.transform()` operator for a returned from the handler `Mono` reply\n* Make `RSocketOutboundGateway` implementing an `AbstractReactiveReplyProducingMessageHandler`\n* Fix `WebFluxRequestExecutingMessageHandler` to return a `Mono.then()` instead of an explicit subscription -\nit happens downstream anyway during reply producing with a proper error handling, too\n* Fix `ConsumerEndpointSpec` & `ConsumerEndpointFactoryBean` to deal with an\n`AbstractReactiveReplyProducingMessageHandler` as well\n* Demonstrate `ReactiveRequestHandlerAdvice` in the `RSocketDslTests` - without `retry()` it fails"}, "afterCommit": {"oid": "b91c943cf2b2899f4eaf80ab7b8dfc5a89b476e5", "author": {"user": {"login": "artembilan", "name": "Artem Bilan"}}, "url": "https://github.com/spring-projects/spring-integration/commit/b91c943cf2b2899f4eaf80ab7b8dfc5a89b476e5", "committedDate": "2020-02-28T18:20:28Z", "message": "* Fix Checkstyle violations\n* Add JavaDocs to new classes\n* Fix some code style inconsistency in the `AbstractMessageProducingHandler`"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b91c943cf2b2899f4eaf80ab7b8dfc5a89b476e5", "author": {"user": {"login": "artembilan", "name": "Artem Bilan"}}, "url": "https://github.com/spring-projects/spring-integration/commit/b91c943cf2b2899f4eaf80ab7b8dfc5a89b476e5", "committedDate": "2020-02-28T18:20:28Z", "message": "* Fix Checkstyle violations\n* Add JavaDocs to new classes\n* Fix some code style inconsistency in the `AbstractMessageProducingHandler`"}, "afterCommit": {"oid": "1f68bb41e024e7c4a92710d46b74be858184eda7", "author": {"user": {"login": "artembilan", "name": "Artem Bilan"}}, "url": "https://github.com/spring-projects/spring-integration/commit/1f68bb41e024e7c4a92710d46b74be858184eda7", "committedDate": "2020-03-03T21:03:23Z", "message": "GH-3183: Add ReactiveRequestHandlerAdvice\n\nFixes https://github.com/spring-projects/spring-integration/issues/3183\n\n* Introduce a `ReactiveRequestHandlerAdvice` with a `BiFunction<Message<?>, Mono<?>, Publisher<?>>`\nlogic to apply a `Mono.transform()` operator for a returned from the handler `Mono` reply\n* Fix `WebFluxRequestExecutingMessageHandler` to return a `Mono.then()` instead of an explicit subscription -\nit happens downstream anyway during reply producing with a proper error handling, too\n* Demonstrate `ReactiveRequestHandlerAdvice` in the `RSocketDslTests` - without `retry()` it fails\n* Add `ConsumerEndpointSpec.customizeMonoReply()` for convenience\n* Document `ReactiveRequestHandlerAdvice` feature"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NzUwOTEw", "url": "https://github.com/spring-projects/spring-integration/pull/3197#pullrequestreview-369750910", "createdAt": "2020-03-05T17:04:50Z", "commit": {"oid": "1f68bb41e024e7c4a92710d46b74be858184eda7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNzowNDo1MFrOFycFLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNzowNjo0MFrOFycJ-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQzMzE5OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            For example when we can an HTTP request over WebFlux client, we could use bellow configuration to not wait for response more than 5 seconds:\n          \n          \n            \n            For example when we can an HTTP request over WebFlux client, we could use below configuration to not wait for response more than 5 seconds:", "url": "https://github.com/spring-projects/spring-integration/pull/3197#discussion_r388433199", "createdAt": "2020-03-05T17:04:50Z", "author": {"login": "garyrussell"}, "path": "src/reference/asciidoc/handler-advice.adoc", "diffHunk": "@@ -549,6 +551,26 @@ public Message<?> service(Message<?> message) {\n ----\n ====\n \n+[[reactive-advice]]\n+==== Reactive Advice\n+\n+Starting with version 5.3, a `ReactiveRequestHandlerAdvice` can be used for request message handlers producing a `Mono` replies.\n+A `BiFunction<Message<?>, Mono<?>, Publisher<?>>` has to be provided for this advice and it is called from the `Mono.transform()` operator on a reply produced by the intercepted `handleRequestMessage()` method implementation.\n+Typically such a `Mono` customization is necessary when we would like to control network fluctuations via `timeout()`, `retry()` and similar support operators.\n+For example when we can an HTTP request over WebFlux client, we could use bellow configuration to not wait for response more than 5 seconds:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f68bb41e024e7c4a92710d46b74be858184eda7"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQzMzcwMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The `message` argument is a request message for such a message handler and can be used to determine a request-scope attributes.\n          \n          \n            \n            The `message` argument is the request message for the message handler and can be used to determine request-scope attributes.", "url": "https://github.com/spring-projects/spring-integration/pull/3197#discussion_r388433703", "createdAt": "2020-03-05T17:05:44Z", "author": {"login": "garyrussell"}, "path": "src/reference/asciidoc/handler-advice.adoc", "diffHunk": "@@ -549,6 +551,26 @@ public Message<?> service(Message<?> message) {\n ----\n ====\n \n+[[reactive-advice]]\n+==== Reactive Advice\n+\n+Starting with version 5.3, a `ReactiveRequestHandlerAdvice` can be used for request message handlers producing a `Mono` replies.\n+A `BiFunction<Message<?>, Mono<?>, Publisher<?>>` has to be provided for this advice and it is called from the `Mono.transform()` operator on a reply produced by the intercepted `handleRequestMessage()` method implementation.\n+Typically such a `Mono` customization is necessary when we would like to control network fluctuations via `timeout()`, `retry()` and similar support operators.\n+For example when we can an HTTP request over WebFlux client, we could use bellow configuration to not wait for response more than 5 seconds:\n+\n+====\n+[source, java]\n+----\n+.handle(WebFlux.outboundGateway(\"https://somehost/\"),\n+                       e -> e.customizeMonoReply((message, mono) -> mono.timeout(Duration.ofSeconds(5))));\n+----\n+====\n+\n+The `message` argument is a request message for such a message handler and can be used to determine a request-scope attributes.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f68bb41e024e7c4a92710d46b74be858184eda7"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQzNDQyNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The `mono` argument is a result of this message handler `handleRequestMessage()` method implementation.\n          \n          \n            \n            The `mono` argument is the result of this message handler's `handleRequestMessage()` method implementation.", "url": "https://github.com/spring-projects/spring-integration/pull/3197#discussion_r388434424", "createdAt": "2020-03-05T17:06:40Z", "author": {"login": "garyrussell"}, "path": "src/reference/asciidoc/handler-advice.adoc", "diffHunk": "@@ -549,6 +551,26 @@ public Message<?> service(Message<?> message) {\n ----\n ====\n \n+[[reactive-advice]]\n+==== Reactive Advice\n+\n+Starting with version 5.3, a `ReactiveRequestHandlerAdvice` can be used for request message handlers producing a `Mono` replies.\n+A `BiFunction<Message<?>, Mono<?>, Publisher<?>>` has to be provided for this advice and it is called from the `Mono.transform()` operator on a reply produced by the intercepted `handleRequestMessage()` method implementation.\n+Typically such a `Mono` customization is necessary when we would like to control network fluctuations via `timeout()`, `retry()` and similar support operators.\n+For example when we can an HTTP request over WebFlux client, we could use bellow configuration to not wait for response more than 5 seconds:\n+\n+====\n+[source, java]\n+----\n+.handle(WebFlux.outboundGateway(\"https://somehost/\"),\n+                       e -> e.customizeMonoReply((message, mono) -> mono.timeout(Duration.ofSeconds(5))));\n+----\n+====\n+\n+The `message` argument is a request message for such a message handler and can be used to determine a request-scope attributes.\n+The `mono` argument is a result of this message handler `handleRequestMessage()` method implementation.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f68bb41e024e7c4a92710d46b74be858184eda7"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6af51f92bc37afdfcbb3175a3b865adcab86f7c2", "author": {"user": {"login": "artembilan", "name": "Artem Bilan"}}, "url": "https://github.com/spring-projects/spring-integration/commit/6af51f92bc37afdfcbb3175a3b865adcab86f7c2", "committedDate": "2020-03-05T18:14:45Z", "message": "GH-3183: Add ReactiveRequestHandlerAdvice\n\nFixes https://github.com/spring-projects/spring-integration/issues/3183\n\n* Introduce a `ReactiveRequestHandlerAdvice` with a `BiFunction<Message<?>, Mono<?>, Publisher<?>>`\nlogic to apply a `Mono.transform()` operator for a returned from the handler `Mono` reply\n* Fix `WebFluxRequestExecutingMessageHandler` to return a `Mono.then()` instead of an explicit subscription -\nit happens downstream anyway during reply producing with a proper error handling, too\n* Demonstrate `ReactiveRequestHandlerAdvice` in the `RSocketDslTests` - without `retry()` it fails\n* Add `ConsumerEndpointSpec.customizeMonoReply()` for convenience\n* Document `ReactiveRequestHandlerAdvice` feature"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b515011ddfbbc48485380d6f2b6219f2c379834", "author": {"user": {"login": "artembilan", "name": "Artem Bilan"}}, "url": "https://github.com/spring-projects/spring-integration/commit/8b515011ddfbbc48485380d6f2b6219f2c379834", "committedDate": "2020-03-05T18:16:12Z", "message": "* Fix language in docs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1f68bb41e024e7c4a92710d46b74be858184eda7", "author": {"user": {"login": "artembilan", "name": "Artem Bilan"}}, "url": "https://github.com/spring-projects/spring-integration/commit/1f68bb41e024e7c4a92710d46b74be858184eda7", "committedDate": "2020-03-03T21:03:23Z", "message": "GH-3183: Add ReactiveRequestHandlerAdvice\n\nFixes https://github.com/spring-projects/spring-integration/issues/3183\n\n* Introduce a `ReactiveRequestHandlerAdvice` with a `BiFunction<Message<?>, Mono<?>, Publisher<?>>`\nlogic to apply a `Mono.transform()` operator for a returned from the handler `Mono` reply\n* Fix `WebFluxRequestExecutingMessageHandler` to return a `Mono.then()` instead of an explicit subscription -\nit happens downstream anyway during reply producing with a proper error handling, too\n* Demonstrate `ReactiveRequestHandlerAdvice` in the `RSocketDslTests` - without `retry()` it fails\n* Add `ConsumerEndpointSpec.customizeMonoReply()` for convenience\n* Document `ReactiveRequestHandlerAdvice` feature"}, "afterCommit": {"oid": "8b515011ddfbbc48485380d6f2b6219f2c379834", "author": {"user": {"login": "artembilan", "name": "Artem Bilan"}}, "url": "https://github.com/spring-projects/spring-integration/commit/8b515011ddfbbc48485380d6f2b6219f2c379834", "committedDate": "2020-03-05T18:16:12Z", "message": "* Fix language in docs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5ODE2NTQ3", "url": "https://github.com/spring-projects/spring-integration/pull/3197#pullrequestreview-369816547", "createdAt": "2020-03-05T18:37:35Z", "commit": {"oid": "8b515011ddfbbc48485380d6f2b6219f2c379834"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 187, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}