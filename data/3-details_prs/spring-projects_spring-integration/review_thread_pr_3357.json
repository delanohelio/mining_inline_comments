{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0MjMwNzIy", "number": 3357, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMDo1Mzo1N1rOEWCj-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxNDowNzowMlrOEWOqAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNTQ2MTA3OnYy", "diffSide": "RIGHT", "path": "spring-integration-core/src/main/java/org/springframework/integration/channel/QueueChannel.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMDo1Mzo1N1rOG9I4Wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxNDoxODoxN1rOG9brxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2MTgxOA==", "bodyText": "The @ManagedResource is missed then.\nOr you placed it on QueueChannelOperations...", "url": "https://github.com/spring-projects/spring-integration/pull/3357#discussion_r466761818", "createdAt": "2020-08-07T00:53:57Z", "author": {"login": "artembilan"}, "path": "spring-integration-core/src/main/java/org/springframework/integration/channel/QueueChannel.java", "diffHunk": "@@ -219,11 +219,13 @@ protected boolean doSend(Message<?> message, long timeout) {\n \t\treturn purgedMessages;\n \t}\n \n+\t@ManagedAttribute(description = \"Queue size\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b939ba1e97287522a9117aa4afdf934ed823adf1"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzA2OTg5NA==", "bodyText": "AbstractMessageChannel is annotated with @IntegrationManagedResource.", "url": "https://github.com/spring-projects/spring-integration/pull/3357#discussion_r467069894", "createdAt": "2020-08-07T14:18:17Z", "author": {"login": "garyrussell"}, "path": "spring-integration-core/src/main/java/org/springframework/integration/channel/QueueChannel.java", "diffHunk": "@@ -219,11 +219,13 @@ protected boolean doSend(Message<?> message, long timeout) {\n \t\treturn purgedMessages;\n \t}\n \n+\t@ManagedAttribute(description = \"Queue size\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2MTgxOA=="}, "originalCommit": {"oid": "b939ba1e97287522a9117aa4afdf934ed823adf1"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNTQ2NTI0OnYy", "diffSide": "RIGHT", "path": "spring-integration-core/src/main/java/org/springframework/integration/core/Pausable.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMDo1NjoyNFrOG9I6wQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxNDo0ODoxNlrOG9c0Hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2MjQzMw==", "bodyText": "Hm. Looks like we don't need a @ManagedResource.\nWhat do I miss?\nThanks", "url": "https://github.com/spring-projects/spring-integration/pull/3357#discussion_r466762433", "createdAt": "2020-08-07T00:56:24Z", "author": {"login": "artembilan"}, "path": "spring-integration-core/src/main/java/org/springframework/integration/core/Pausable.java", "diffHunk": "@@ -27,16 +28,18 @@\n  * @since 5.0.3\n  *\n  */\n-public interface Pausable extends Lifecycle {\n+public interface Pausable extends ManageableLifecycle {\n \n \t/**\n \t * Pause the endpoint.\n \t */\n+\t@ManagedOperation(description = \"Pause the component\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b939ba1e97287522a9117aa4afdf934ed823adf1"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzA4ODQxNA==", "bodyText": "We export all components; they don't need @ManagedResource; they do, however, need @IntegrationManagedResource to prevent the normal MBE from exporting.\nThat said, pause/resume are not showing up - investigating...", "url": "https://github.com/spring-projects/spring-integration/pull/3357#discussion_r467088414", "createdAt": "2020-08-07T14:48:16Z", "author": {"login": "garyrussell"}, "path": "spring-integration-core/src/main/java/org/springframework/integration/core/Pausable.java", "diffHunk": "@@ -27,16 +28,18 @@\n  * @since 5.0.3\n  *\n  */\n-public interface Pausable extends Lifecycle {\n+public interface Pausable extends ManageableLifecycle {\n \n \t/**\n \t * Pause the endpoint.\n \t */\n+\t@ManagedOperation(description = \"Pause the component\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2MjQzMw=="}, "originalCommit": {"oid": "b939ba1e97287522a9117aa4afdf934ed823adf1"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNTQ3OTczOnYy", "diffSide": "RIGHT", "path": "spring-integration-core/src/main/java/org/springframework/integration/endpoint/ReactiveStreamsConsumer.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMTowNDo0NlrOG9JC_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMTowNDo0NlrOG9JC_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2NDU0Mw==", "bodyText": "I'm not sure this one has to be manageable - it is just an inner one", "url": "https://github.com/spring-projects/spring-integration/pull/3357#discussion_r466764543", "createdAt": "2020-08-07T01:04:46Z", "author": {"login": "artembilan"}, "path": "spring-integration-core/src/main/java/org/springframework/integration/endpoint/ReactiveStreamsConsumer.java", "diffHunk": "@@ -209,7 +210,7 @@ protected void doStop() {\n \t}\n \n \tprivate static final class MessageHandlerSubscriber\n-\t\t\timplements CoreSubscriber<Message<?>>, Disposable, Lifecycle {\n+\t\t\timplements CoreSubscriber<Message<?>>, Disposable, ManageableLifecycle {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b939ba1e97287522a9117aa4afdf934ed823adf1"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNTQ4MTczOnYy", "diffSide": "RIGHT", "path": "spring-integration-core/src/main/java/org/springframework/integration/gateway/MessagingGatewaySupport.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMTowNTo1MFrOG9JEBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMTowNTo1MFrOG9JEBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2NDgwNw==", "bodyText": "Probably we need to raise an issue to not forget this TODO...", "url": "https://github.com/spring-projects/spring-integration/pull/3357#discussion_r466764807", "createdAt": "2020-08-07T01:05:50Z", "author": {"login": "artembilan"}, "path": "spring-integration-core/src/main/java/org/springframework/integration/gateway/MessagingGatewaySupport.java", "diffHunk": "@@ -675,8 +646,8 @@ private void sendMessageForReactiveFlow(MessageChannel requestChannel, Message<?\n \n \t\treturn reply\n \t\t\t\t.doOnSubscribe(s -> {\n-\t\t\t\t\tif (!error && this.countsEnabled) {\n-\t\t\t\t\t\tthis.messageCount.incrementAndGet();\n+\t\t\t\t\tif (!error) {\n+\t\t\t\t\t\t// TODO Micrometer counter", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b939ba1e97287522a9117aa4afdf934ed823adf1"}, "originalPosition": 162}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNTQ5NzI2OnYy", "diffSide": "RIGHT", "path": "spring-integration-core/src/main/java/org/springframework/integration/store/MessageGroupStoreReaper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMToxNDo0M1rOG9JNGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMToxNDo0M1rOG9JNGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2NzEyOA==", "bodyText": "I wonder if we really should apply our Integration management logic to not integration components.\nThis one sounds more like regular Spring bean, so what is the point to manage it.\nI might be not reached JMX yet, but just in case I won't forget in this number of file to review...\nThanks for understanding", "url": "https://github.com/spring-projects/spring-integration/pull/3357#discussion_r466767128", "createdAt": "2020-08-07T01:14:43Z", "author": {"login": "artembilan"}, "path": "spring-integration-core/src/main/java/org/springframework/integration/store/MessageGroupStoreReaper.java", "diffHunk": "@@ -35,7 +35,7 @@\n  * @author Dave Turanski\n  * @author Artem Bilan\n  */\n-public class MessageGroupStoreReaper implements Runnable, DisposableBean, InitializingBean, SmartLifecycle {\n+public class MessageGroupStoreReaper implements Runnable, DisposableBean, InitializingBean, ManageableSmartLifecycle {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b939ba1e97287522a9117aa4afdf934ed823adf1"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNTUwMzQ0OnYy", "diffSide": "RIGHT", "path": "spring-integration-core/src/main/java/org/springframework/integration/support/management/IntegrationManagement.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMToxNzo1OFrOG9JQhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxNDo1MToxM1rOG9c7Tg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2ODAwNg==", "bodyText": "Do we really need this?\nI'm sorry to asking nit-pick questions: you definitely spent some effort on the matter, but it is very hard to review this big PR.", "url": "https://github.com/spring-projects/spring-integration/pull/3357#discussion_r466768006", "createdAt": "2020-08-07T01:17:58Z", "author": {"login": "artembilan"}, "path": "spring-integration-core/src/main/java/org/springframework/integration/support/management/IntegrationManagement.java", "diffHunk": "@@ -84,14 +83,21 @@ default void registerMetricsCaptor(MetricsCaptor captor) {\n \t\t// no op\n \t}\n \n-\n-\n \t@Override\n \tdefault void destroy() {\n \t\t// no op\n \t}\n \n-\n+\t/**\n+\t * Return this {@link IntegrationManagement} as its concrete type.\n+\t * @param <T> the type.\n+\t * @return this.\n+\t * @since 5.4\n+\t */\n+\t@SuppressWarnings(\"unchecked\")\n+\tdefault <T> T getThisAs() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b939ba1e97287522a9117aa4afdf934ed823adf1"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzA4OTU1MA==", "bodyText": "I understand; this is hard to review; I just thought this would be a convenience to avoid casting.", "url": "https://github.com/spring-projects/spring-integration/pull/3357#discussion_r467089550", "createdAt": "2020-08-07T14:50:08Z", "author": {"login": "garyrussell"}, "path": "spring-integration-core/src/main/java/org/springframework/integration/support/management/IntegrationManagement.java", "diffHunk": "@@ -84,14 +83,21 @@ default void registerMetricsCaptor(MetricsCaptor captor) {\n \t\t// no op\n \t}\n \n-\n-\n \t@Override\n \tdefault void destroy() {\n \t\t// no op\n \t}\n \n-\n+\t/**\n+\t * Return this {@link IntegrationManagement} as its concrete type.\n+\t * @param <T> the type.\n+\t * @return this.\n+\t * @since 5.4\n+\t */\n+\t@SuppressWarnings(\"unchecked\")\n+\tdefault <T> T getThisAs() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2ODAwNg=="}, "originalCommit": {"oid": "b939ba1e97287522a9117aa4afdf934ed823adf1"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzA5MDI1NA==", "bodyText": "Sure! We can give it a shot!\n\ud83d\udc4d", "url": "https://github.com/spring-projects/spring-integration/pull/3357#discussion_r467090254", "createdAt": "2020-08-07T14:51:13Z", "author": {"login": "artembilan"}, "path": "spring-integration-core/src/main/java/org/springframework/integration/support/management/IntegrationManagement.java", "diffHunk": "@@ -84,14 +83,21 @@ default void registerMetricsCaptor(MetricsCaptor captor) {\n \t\t// no op\n \t}\n \n-\n-\n \t@Override\n \tdefault void destroy() {\n \t\t// no op\n \t}\n \n-\n+\t/**\n+\t * Return this {@link IntegrationManagement} as its concrete type.\n+\t * @param <T> the type.\n+\t * @return this.\n+\t * @since 5.4\n+\t */\n+\t@SuppressWarnings(\"unchecked\")\n+\tdefault <T> T getThisAs() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2ODAwNg=="}, "originalCommit": {"oid": "b939ba1e97287522a9117aa4afdf934ed823adf1"}, "originalPosition": 99}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNzQ0MjU4OnYy", "diffSide": "RIGHT", "path": "spring-integration-jmx/src/main/java/org/springframework/integration/monitor/IntegrationMBeanExporter.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxNDowNzowMlrOG9bQwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxNDo1MToxMlrOG9c7Qw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzA2Mjk3Nw==", "bodyText": "I think we don't need this if. The logic below covers everything we needed.\nAnd having a MessageHandler as a proxy won't give us a positive match with this if anyway.", "url": "https://github.com/spring-projects/spring-integration/pull/3357#discussion_r467062977", "createdAt": "2020-08-07T14:07:02Z", "author": {"login": "artembilan"}, "path": "spring-integration-jmx/src/main/java/org/springframework/integration/monitor/IntegrationMBeanExporter.java", "diffHunk": "@@ -348,25 +344,25 @@ private void postProcessAbstractEndpoint(Object bean) {\n \t\tif (bean instanceof IntegrationConsumer) {\n \t\t\tIntegrationConsumer integrationConsumer = (IntegrationConsumer) bean;\n \t\t\tMessageHandler handler = integrationConsumer.getHandler();\n-\t\t\tif (handler instanceof org.springframework.integration.support.management.MessageHandlerMetrics) {\n-\t\t\t\torg.springframework.integration.support.management.MessageHandlerMetrics messageHandlerMetrics =\n-\t\t\t\t\t\t(org.springframework.integration.support.management.MessageHandlerMetrics) extractTarget(handler);\n-\t\t\t\tregisterHandler(messageHandlerMetrics);\n-\t\t\t\tthis.handlers.add(messageHandlerMetrics);\n-\t\t\t\tthis.runtimeBeans.add(messageHandlerMetrics);\n+\t\t\tif (handler instanceof AbstractMessageHandler) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b939ba1e97287522a9117aa4afdf934ed823adf1"}, "originalPosition": 191}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzA5MDI0Mw==", "bodyText": "Yeah - I went through a lot of iterations with this; I thought I had cleaned all these up. Good catch.", "url": "https://github.com/spring-projects/spring-integration/pull/3357#discussion_r467090243", "createdAt": "2020-08-07T14:51:12Z", "author": {"login": "garyrussell"}, "path": "spring-integration-jmx/src/main/java/org/springframework/integration/monitor/IntegrationMBeanExporter.java", "diffHunk": "@@ -348,25 +344,25 @@ private void postProcessAbstractEndpoint(Object bean) {\n \t\tif (bean instanceof IntegrationConsumer) {\n \t\t\tIntegrationConsumer integrationConsumer = (IntegrationConsumer) bean;\n \t\t\tMessageHandler handler = integrationConsumer.getHandler();\n-\t\t\tif (handler instanceof org.springframework.integration.support.management.MessageHandlerMetrics) {\n-\t\t\t\torg.springframework.integration.support.management.MessageHandlerMetrics messageHandlerMetrics =\n-\t\t\t\t\t\t(org.springframework.integration.support.management.MessageHandlerMetrics) extractTarget(handler);\n-\t\t\t\tregisterHandler(messageHandlerMetrics);\n-\t\t\t\tthis.handlers.add(messageHandlerMetrics);\n-\t\t\t\tthis.runtimeBeans.add(messageHandlerMetrics);\n+\t\t\tif (handler instanceof AbstractMessageHandler) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzA2Mjk3Nw=="}, "originalCommit": {"oid": "b939ba1e97287522a9117aa4afdf934ed823adf1"}, "originalPosition": 191}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1890, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}