{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxNzgxMDA0", "number": 3402, "title": "GH-3356: Add the way to not load mail message", "bodyText": "Fixes #3356\nIn some cases it is not necessary to have a whole mail message to be load\nwhen it could be filtered out downstream\n\nTreat \"no eager load\" for MimeMessage in the AbstractMailReceiver\nwhen no headerMapper, not simpleContent and no autoCloseFolder", "createdAt": "2020-10-12T19:55:11Z", "url": "https://github.com/spring-projects/spring-integration/pull/3402", "merged": true, "mergeCommit": {"oid": "3e501905e37052ab1549c5f69d2e85bffea04baa"}, "closed": true, "closedAt": "2020-10-12T21:36:23Z", "author": {"login": "artembilan"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdR5hOxAH2gAyNTAxNzgxMDA0OjQ4YjkzMjM4NzJhNmFkYzQ4NzMwNTU4MTYzNDY5NDg3NmVjM2JjNGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdR55L-AH2gAyNTAxNzgxMDA0OjIzNmUyOGFhYjNhZjFiMGY5MjA1YTc4NDc0ZWEwZDE2YTgzYmYyNDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "48b9323872a6adc487305581634694876ec3bc4b", "author": {"user": {"login": "artembilan", "name": "Artem Bilan"}}, "url": "https://github.com/spring-projects/spring-integration/commit/48b9323872a6adc487305581634694876ec3bc4b", "committedDate": "2020-10-12T19:54:50Z", "message": "GH-3356: Add the way to not load mail message\n\nFixes https://github.com/spring-projects/spring-integration/issues/3356\n\nIn some cases it is not necessary to have a whole mail message to be load\nwhen it could be filtered out downstream\n\n* Treat \"no eager load\" for `MimeMessage` in the `AbstractMailReceiver`\nwhen no `headerMapper`, not `simpleContent` and no `autoCloseFolder`"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2ODgzOTY0", "url": "https://github.com/spring-projects/spring-integration/pull/3402#pullrequestreview-506883964", "createdAt": "2020-10-12T20:04:58Z", "commit": {"oid": "48b9323872a6adc487305581634694876ec3bc4b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQyMDowNDo1OFrOHgLpJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQyMDoxNDoyNVrOHgL41w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzUwNzIzNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            These functionality is possible with these options combination: no `headerMapper` provided, the `simpleContent` is disabled and the `autoCloseFolder` is turned off.\n          \n          \n            \n            This functionality is enabled with this combination of options: no `headerMapper` provided, the `simpleContent` property is `false` and the `autoCloseFolder` property is `false`.", "url": "https://github.com/spring-projects/spring-integration/pull/3402#discussion_r503507236", "createdAt": "2020-10-12T20:04:58Z", "author": {"login": "garyrussell"}, "path": "src/reference/asciidoc/mail.adoc", "diffHunk": "@@ -128,13 +128,17 @@ Closeable closeableResource = StaticMessageHeaderAccessor.getCloseableResource(m\n if (closeableResource != null) {\n     closeableResource.close();\n }\n-\n ----\n ====\n \n Keeping the folder open is useful in cases where communication with the server is needed during parsing multipart content of the email with attachments.\n The `close()` on the `IntegrationMessageHeaderAccessor.CLOSEABLE_RESOURCE` header delegates to the `AbstractMailReceiver` to close the folder with `expunge` option if `shouldDeleteMessages` is configured respectively on the `AbstractMailReceiver`.\n \n+Starting with version 5.4, it is possible now to return a `MimeMessage` as is without any conversion or eager content loading.\n+These functionality is possible with these options combination: no `headerMapper` provided, the `simpleContent` is disabled and the `autoCloseFolder` is turned off.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48b9323872a6adc487305581634694876ec3bc4b"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzUwODE0MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The whole `MimeMessage` is present as a payload of the Spring message to produce.\n          \n          \n            \n            The `MimeMessage` is present as the payload of the Spring message produced.", "url": "https://github.com/spring-projects/spring-integration/pull/3402#discussion_r503508140", "createdAt": "2020-10-12T20:07:14Z", "author": {"login": "garyrussell"}, "path": "src/reference/asciidoc/mail.adoc", "diffHunk": "@@ -128,13 +128,17 @@ Closeable closeableResource = StaticMessageHeaderAccessor.getCloseableResource(m\n if (closeableResource != null) {\n     closeableResource.close();\n }\n-\n ----\n ====\n \n Keeping the folder open is useful in cases where communication with the server is needed during parsing multipart content of the email with attachments.\n The `close()` on the `IntegrationMessageHeaderAccessor.CLOSEABLE_RESOURCE` header delegates to the `AbstractMailReceiver` to close the folder with `expunge` option if `shouldDeleteMessages` is configured respectively on the `AbstractMailReceiver`.\n \n+Starting with version 5.4, it is possible now to return a `MimeMessage` as is without any conversion or eager content loading.\n+These functionality is possible with these options combination: no `headerMapper` provided, the `simpleContent` is disabled and the `autoCloseFolder` is turned off.\n+The whole `MimeMessage` is present as a payload of the Spring message to produce.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48b9323872a6adc487305581634694876ec3bc4b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzUwOTA0OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Only a header presented is the mentioned above `IntegrationMessageHeaderAccessor.CLOSEABLE_RESOURCE` for the folder to close when done with the `MimeMessage` processing.\n          \n          \n            \n            In this case, the only header populated is the above mentioned `IntegrationMessageHeaderAccessor.CLOSEABLE_RESOURCE` for the folder which must be closed when processing of the the `MimeMessage` is complete.", "url": "https://github.com/spring-projects/spring-integration/pull/3402#discussion_r503509048", "createdAt": "2020-10-12T20:09:25Z", "author": {"login": "garyrussell"}, "path": "src/reference/asciidoc/mail.adoc", "diffHunk": "@@ -128,13 +128,17 @@ Closeable closeableResource = StaticMessageHeaderAccessor.getCloseableResource(m\n if (closeableResource != null) {\n     closeableResource.close();\n }\n-\n ----\n ====\n \n Keeping the folder open is useful in cases where communication with the server is needed during parsing multipart content of the email with attachments.\n The `close()` on the `IntegrationMessageHeaderAccessor.CLOSEABLE_RESOURCE` header delegates to the `AbstractMailReceiver` to close the folder with `expunge` option if `shouldDeleteMessages` is configured respectively on the `AbstractMailReceiver`.\n \n+Starting with version 5.4, it is possible now to return a `MimeMessage` as is without any conversion or eager content loading.\n+These functionality is possible with these options combination: no `headerMapper` provided, the `simpleContent` is disabled and the `autoCloseFolder` is turned off.\n+The whole `MimeMessage` is present as a payload of the Spring message to produce.\n+Only a header presented is the mentioned above `IntegrationMessageHeaderAccessor.CLOSEABLE_RESOURCE` for the folder to close when done with the `MimeMessage` processing.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48b9323872a6adc487305581634694876ec3bc4b"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzUxMDY3Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Starting with version 5.4, when no `headerMapper`, no `autoCloseFolder` and no `simpleContent`, the `MimeMessage` is returned as is in the payload of produced Spring message.\n          \n          \n            \n            This way a content of the `MimeMessage` is loaded on demand.\n          \n          \n            \n            All the mentioned above transformations are still valid.\n          \n          \n            \n            Starting with version 5.4, when no `headerMapper` is provided, `autoCloseFolder` is `false` and `simpleContent` is `false`, the `MimeMessage` is returned as-is in the payload of the Spring message produced.\n          \n          \n            \n            This way, the content of the `MimeMessage` is loaded on demand when referenced, later in the flow.\n          \n          \n            \n            All of the mentioned above transformations are still valid.", "url": "https://github.com/spring-projects/spring-integration/pull/3402#discussion_r503510677", "createdAt": "2020-10-12T20:13:11Z", "author": {"login": "garyrussell"}, "path": "src/reference/asciidoc/mail.adoc", "diffHunk": "@@ -210,6 +214,10 @@ Starting with version 4.3, the transformer handles embedded `Part` instances (as\n The transformer is a subclass of `AbstractMailTransformer` that maps the address and subject headers from the preceding list.\n If you wish to perform some other transformation on the message, consider subclassing `AbstractMailTransformer`.\n \n+Starting with version 5.4, when no `headerMapper`, no `autoCloseFolder` and no `simpleContent`, the `MimeMessage` is returned as is in the payload of produced Spring message.\n+This way a content of the `MimeMessage` is loaded on demand.\n+All the mentioned above transformations are still valid.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48b9323872a6adc487305581634694876ec3bc4b"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzUxMTI1NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The `AbstractMailReceiver` now can produce `MimeMessage` as is without eager fetching for its content.\n          \n          \n            \n            The `AbstractMailReceiver` can now produce the `MimeMessage` as-is without eager fetching its content.", "url": "https://github.com/spring-projects/spring-integration/pull/3402#discussion_r503511255", "createdAt": "2020-10-12T20:14:25Z", "author": {"login": "garyrussell"}, "path": "src/reference/asciidoc/whats-new.adoc", "diffHunk": "@@ -86,3 +87,9 @@ See <<./amqp.adoc#alternative-confirms-returns,Alternative Mechanism for Publish\n \n A new `BatchMode.EXTRACT_PAYLOAD_WITH_HEADERS` is supported by the `AmqpInboundChannelAdapter`.\n See <<./amqp.adoc#amqp-inbound-channel-adapter,Inbound Channel Adapter>> for more information.\n+\n+[[x5.4-mail]]\n+=== Mail Changes\n+\n+The `AbstractMailReceiver` now can produce `MimeMessage` as is without eager fetching for its content.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48b9323872a6adc487305581634694876ec3bc4b"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "236e28aab3af1b0f9205a78474ea0d16a83bf241", "author": {"user": {"login": "artembilan", "name": "Artem Bilan"}}, "url": "https://github.com/spring-projects/spring-integration/commit/236e28aab3af1b0f9205a78474ea0d16a83bf241", "committedDate": "2020-10-12T20:21:00Z", "message": "Fix language in Docs\n\nCo-authored-by: Gary Russell <grussell@vmware.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 130, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}