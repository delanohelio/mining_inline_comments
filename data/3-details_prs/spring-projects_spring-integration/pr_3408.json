{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA3Njk3OTUz", "number": 3408, "title": "Gateway: Propagate Error to the errorChannel", "bodyText": "See SO for more info:\nhttps://stackoverflow.com/questions/64456946/handle-exceptions-errors-other-than-messagingexception-ie-other-error-excepti\nIn the versions before 5.2.x the Error was wrapped to the MessagingException\nin the AbstractRequestHandlerAdvice and this one was handled properly\non the gateway level with its errorChannel configured\n\nFix MessagingGatewaySupport to catch all the Throwable and try to send them as ErrorMessage\nto the errorChannel.\nOtherwise unwrap returned MessagingException and re-throw an Error as is to keep\nthe current behavior for non-handled exceptions\n\nCherry-pick to 5.3.x & 5.2.x", "createdAt": "2020-10-21T16:29:58Z", "url": "https://github.com/spring-projects/spring-integration/pull/3408", "merged": true, "mergeCommit": {"oid": "b94c20a0ce1dc61c9419bc7b5d221f27338ada71"}, "closed": true, "closedAt": "2020-10-22T15:41:35Z", "author": {"login": "artembilan"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUv-O5AH2gAyNTA3Njk3OTUzOjUwMDJmZWFiZDQ4NDc3NDkzZTBkMjNkMWVkZGY1MmNjODQ1ZWVhNzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUxaaTgFqTUxNDA0NDUwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5002feabd48477493e0d23d1eddf52cc845eea74", "author": {"user": {"login": "artembilan", "name": "Artem Bilan"}}, "url": "https://github.com/spring-projects/spring-integration/commit/5002feabd48477493e0d23d1eddf52cc845eea74", "committedDate": "2020-10-21T16:29:14Z", "message": "Gateway: Propagate Error to the errorChannel\n\nSee SO for more info:\nhttps://stackoverflow.com/questions/64456946/handle-exceptions-errors-other-than-messagingexception-ie-other-error-excepti\n\nIn the versions before `5.2.x` the `Error` was wrapped to the `MessagingException`\nin the `AbstractRequestHandlerAdvice` and this one was handled properly\non the gateway level with its `errorChannel` configured\n\n* Fix `MessagingGatewaySupport` to catch all the `Throwable` and try to send them as `ErrorMessage`\nto the `errorChannel`.\nOtherwise unwrap returned `MessagingException` and re-throw an `Error` as is to keep\nthe current behavior for non-handled exceptions\n\n**Cherry-pick to 5.3.x & 5.2.x**"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzOTM3NDA5", "url": "https://github.com/spring-projects/spring-integration/pull/3408#pullrequestreview-513937409", "createdAt": "2020-10-21T16:46:30Z", "commit": {"oid": "5002feabd48477493e0d23d1eddf52cc845eea74"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxNjo0NjozMFrOHl14Kg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxNjo0OToxOVrOHl1_Fw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTQ0MjA5MA==", "bodyText": "Needs // NOSONAR (catch throwable).", "url": "https://github.com/spring-projects/spring-integration/pull/3408#discussion_r509442090", "createdAt": "2020-10-21T16:46:30Z", "author": {"login": "garyrussell"}, "path": "spring-integration-core/src/main/java/org/springframework/integration/gateway/MessagingGatewaySupport.java", "diffHunk": "@@ -528,7 +528,7 @@ private Object doSendAndReceive(Object object, boolean shouldConvert) {\n \t\t\t\tsample.stop(sendTimer());\n \t\t\t}\n \t\t}\n-\t\tcatch (Exception ex) {\n+\t\tcatch (Throwable ex) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5002feabd48477493e0d23d1eddf52cc845eea74"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTQ0Mzg2Mw==", "bodyText": "Needs throw me; to retain existing behavior of throwing error flow exceptions to caller.\nIt's not clear why this try/catch is here at all; this is an Error on the error flow, not the original flow.", "url": "https://github.com/spring-projects/spring-integration/pull/3408#discussion_r509443863", "createdAt": "2020-10-21T16:49:19Z", "author": {"login": "garyrussell"}, "path": "spring-integration-core/src/main/java/org/springframework/integration/gateway/MessagingGatewaySupport.java", "diffHunk": "@@ -543,7 +543,14 @@ private Object doSendAndReceive(Object object, boolean shouldConvert) {\n \t\t\t\t\treply instanceof ErrorMessage\n \t\t\t\t\t\t\t? ((ErrorMessage) reply).getPayload()\n \t\t\t\t\t\t\t: (Throwable) reply;\n-\t\t\treturn handleSendAndReceiveError(object, requestMessage, error, shouldConvert);\n+\t\t\ttry {\n+\t\t\t\treturn handleSendAndReceiveError(object, requestMessage, error, shouldConvert);\n+\t\t\t}\n+\t\t\tcatch (MessagingException me) {\n+\t\t\t\tif (me.getCause() instanceof Error) { // NOSONAR\n+\t\t\t\t\tthrow (Error) me.getCause();\n+\t\t\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5002feabd48477493e0d23d1eddf52cc845eea74"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de7196f504fc83480fe1302f5b160e9b8785d25b", "author": {"user": {"login": "artembilan", "name": "Artem Bilan"}}, "url": "https://github.com/spring-projects/spring-integration/commit/de7196f504fc83480fe1302f5b160e9b8785d25b", "committedDate": "2020-10-21T18:00:12Z", "message": "* Do not wrap `Error` into a `MessagingException`\nand re-throw as is if there is no `errorChannel`"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0MDQ0NTA0", "url": "https://github.com/spring-projects/spring-integration/pull/3408#pullrequestreview-514044504", "createdAt": "2020-10-21T18:09:55Z", "commit": {"oid": "de7196f504fc83480fe1302f5b160e9b8785d25b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 138, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}