{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2MzgwNDQx", "number": 3332, "title": "Fix CachedSessionFactory Race", "bodyText": "Close the pool so that any sessions returned after the factory is\ndestroy()ed are closed.\ncherry-pick to all supported branches", "createdAt": "2020-07-08T17:20:24Z", "url": "https://github.com/spring-projects/spring-integration/pull/3332", "merged": true, "mergeCommit": {"oid": "b45d690a4538fb5dfb87df9bdb6db0323820471b"}, "closed": true, "closedAt": "2020-07-08T18:19:58Z", "author": {"login": "garyrussell"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcy9thzAH2gAyNDQ2MzgwNDQxOjhlOGU4M2I0NzhiZGU2NDdkYTFkMmEwMzM3M2I3MGE0NmU0ZmJjMmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcy-nkpAFqTQ0NTAxOTU1OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8e8e83b478bde647da1d2a03373b70a46e4fbc2b", "author": {"user": {"login": "garyrussell", "name": "Gary Russell"}}, "url": "https://github.com/spring-projects/spring-integration/commit/8e8e83b478bde647da1d2a03373b70a46e4fbc2b", "committedDate": "2020-07-08T17:16:14Z", "message": "Fix CachedSessionFactory Race\n\nClose the pool so that any sessions returned after the factory is\n`destroy()`ed are closed.\n\n**cherry-pick to all supported branches**"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0OTc3MzA1", "url": "https://github.com/spring-projects/spring-integration/pull/3332#pullrequestreview-444977305", "createdAt": "2020-07-08T17:21:54Z", "commit": {"oid": "8e8e83b478bde647da1d2a03373b70a46e4fbc2b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNzoyMTo1NFrOGux-EQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNzoyNjoyM1rOGuyIqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTcwNjM4NQ==", "bodyText": "The default is not going to work for Java 6, but we may not just introduce this method into the Pool interface for backward bytecode compatibility.", "url": "https://github.com/spring-projects/spring-integration/pull/3332#discussion_r451706385", "createdAt": "2020-07-08T17:21:54Z", "author": {"login": "artembilan"}, "path": "spring-integration-core/src/main/java/org/springframework/integration/util/Pool.java", "diffHunk": "@@ -72,4 +72,11 @@\n \t */\n \tint getAllocatedCount();\n \n+\t/**\n+\t * Close the pool; returned items will be destroyed.\n+\t * @since 4.3.23\n+\t */\n+\tdefault void close() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e8e83b478bde647da1d2a03373b70a46e4fbc2b"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTcwODEwMw==", "bodyText": "I'll take a look what we need to do during back-port to 4.3.x ...", "url": "https://github.com/spring-projects/spring-integration/pull/3332#discussion_r451708103", "createdAt": "2020-07-08T17:24:45Z", "author": {"login": "artembilan"}, "path": "spring-integration-core/src/test/java/org/springframework/integration/util/SimplePoolTests.java", "diffHunk": "@@ -27,7 +29,7 @@\n import java.util.concurrent.Semaphore;\n import java.util.concurrent.atomic.AtomicBoolean;\n \n-import org.junit.Test;\n+import org.junit.jupiter.api.Test;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e8e83b478bde647da1d2a03373b70a46e4fbc2b"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTcwOTA5Ng==", "bodyText": "Why that new close() can't do this for us, too?", "url": "https://github.com/spring-projects/spring-integration/pull/3332#discussion_r451709096", "createdAt": "2020-07-08T17:26:23Z", "author": {"login": "artembilan"}, "path": "spring-integration-ip/src/main/java/org/springframework/integration/ip/tcp/connection/CachingClientConnectionFactory.java", "diffHunk": "@@ -389,6 +390,12 @@ public synchronized void stop() {\n \t\tthis.pool.removeAllIdleItems();\n \t}\n \n+\t@Override\n+\tpublic void destroy() throws Exception {\n+\t\tthis.pool.close();\n+\t\tthis.pool.removeAllIdleItems();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e8e83b478bde647da1d2a03373b70a46e4fbc2b"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "998fbb96c6dc5e6b8a707121287d562c501f6efd", "author": {"user": {"login": "garyrussell", "name": "Gary Russell"}}, "url": "https://github.com/spring-projects/spring-integration/commit/998fbb96c6dc5e6b8a707121287d562c501f6efd", "committedDate": "2020-07-08T17:42:22Z", "message": "Call `removeAllIdleItems()` in `close()`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12f5cfbd2926b9b0d04283b4c80af36f33cf85a9", "author": {"user": {"login": "garyrussell", "name": "Gary Russell"}}, "url": "https://github.com/spring-projects/spring-integration/commit/12f5cfbd2926b9b0d04283b4c80af36f33cf85a9", "committedDate": "2020-07-08T18:13:38Z", "message": "Close sessions in `SftpStreamingMessageSourceTests`."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MDE5NTU4", "url": "https://github.com/spring-projects/spring-integration/pull/3332#pullrequestreview-445019558", "createdAt": "2020-07-08T18:19:38Z", "commit": {"oid": "12f5cfbd2926b9b0d04283b4c80af36f33cf85a9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 84, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}