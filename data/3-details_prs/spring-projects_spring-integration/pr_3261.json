{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4MTk2MTUx", "number": 3261, "title": "GH-3253: Scan BF hierarchy for BeanDefinition", "bodyText": "Fixes #3253\nThe IntegrationFlowBeanPostProcessor uses a containsBean()\nand then getBeanDefinition() to be sure that we don't override already\nexisting bean even if it is created in the parent(s) context.\nThe problem that containsBean() check the hierarchy, but getBeanDefinition()\ndoesn't.\nSo, we fail with NoSuchBeanDefinitionException if bean exists in the parent ctx\n\nIntroduce an utility IntegrationContextUtils.getBeanDefinition() to\nscan BeanFactory recursively for BeanDefinition for the requested name\nUse this tool in the IntegrationFlowBeanPostProcessor logic\n\nCherry-pick to 5.2.x & 5.1.x", "createdAt": "2020-04-23T21:03:46Z", "url": "https://github.com/spring-projects/spring-integration/pull/3261", "merged": true, "mergeCommit": {"oid": "6b57e16440865894a601a64185d7fbadc315b4a1"}, "closed": true, "closedAt": "2020-04-24T18:01:04Z", "author": {"login": "artembilan"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcajZ9sgH2gAyNDA4MTk2MTUxOjkwYTJkN2E1NWQyOWZlMWFjMWFhNDdjNjRiNTkxYmVjZTY0OGE1OTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcazvPKAFqTQwMDA3ODU0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "90a2d7a55d29fe1ac1aa47c64b591bece648a594", "author": {"user": {"login": "artembilan", "name": "Artem Bilan"}}, "url": "https://github.com/spring-projects/spring-integration/commit/90a2d7a55d29fe1ac1aa47c64b591bece648a594", "committedDate": "2020-04-23T21:03:09Z", "message": "GH-3253: Scan BF hierarchy for BeanDefinition\n\nFixes https://github.com/spring-projects/spring-integration/issues/3253\n\nThe `IntegrationFlowBeanPostProcessor` uses a `containsBean()`\nand then `getBeanDefinition()` to be sure that we don't override already\nexisting bean even if it is created in the parent(s) context.\nThe problem that `containsBean()` check the hierarchy, but `getBeanDefinition()`\ndoesn't.\nSo, we fail with `NoSuchBeanDefinitionException` if bean exists in the parent ctx\n\n* Introduce an utility `IntegrationContextUtils.getBeanDefinition()` to\nscan `BeanFactory` recursively for `BeanDefinition` for the requested `name`\n* Use this tool in the `IntegrationFlowBeanPostProcessor` logic\n\n**Cherry-pick to 5.2.x & 5.1.x**"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMDc4NTQ3", "url": "https://github.com/spring-projects/spring-integration/pull/3261#pullrequestreview-400078547", "createdAt": "2020-04-24T16:04:12Z", "commit": {"oid": "90a2d7a55d29fe1ac1aa47c64b591bece648a594"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxNjowNDoxMlrOGLerMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxNjowNDoxMlrOGLerMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY5MDA5OQ==", "bodyText": "Why just one parent? Don't we need to recurse up the BF tree?", "url": "https://github.com/spring-projects/spring-integration/pull/3261#discussion_r414690099", "createdAt": "2020-04-24T16:04:12Z", "author": {"login": "garyrussell"}, "path": "spring-integration-core/src/main/java/org/springframework/integration/context/IntegrationContextUtils.java", "diffHunk": "@@ -212,4 +215,26 @@ public static Properties getIntegrationProperties(BeanFactory beanFactory) {\n \t\treturn properties;\n \t}\n \n+\t/**\n+\t * Return a {@link BeanDefinition} with the given name,\n+\t * obtained from the given {@link BeanFactory} or one of its parents.\n+\t * @param name the bean name to return\n+\t * @param beanFactory the {@link ConfigurableListableBeanFactory} to travers.\n+\t * @return the {@link BeanDefinition} for a given name\n+\t * @throws NoSuchBeanDefinitionException if a {@link BeanDefinition} is not found\n+\t * @since 5.1.10\n+\t */\n+\tpublic static BeanDefinition getBeanDefinition(String name, ConfigurableListableBeanFactory beanFactory) {\n+\t\ttry {\n+\t\t\treturn beanFactory.getBeanDefinition(name);\n+\t\t}\n+\t\tcatch (NoSuchBeanDefinitionException ex) {\n+\t\t\tBeanFactory parentBeanFactory = beanFactory.getParentBeanFactory();\n+\t\t\tif (parentBeanFactory instanceof ConfigurableListableBeanFactory) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90a2d7a55d29fe1ac1aa47c64b591bece648a594"}, "originalPosition": 36}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 227, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}