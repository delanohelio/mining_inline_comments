{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3MDA4MDA5", "number": 3398, "title": "GH-3396: Add Docs for Micrometer MeterFilters", "bodyText": "Resolves #3396", "createdAt": "2020-10-02T16:20:40Z", "url": "https://github.com/spring-projects/spring-integration/pull/3398", "merged": true, "mergeCommit": {"oid": "a66e82b0aad0eb3ffb909dd5568c14b6713259c0"}, "closed": true, "closedAt": "2020-10-02T18:32:45Z", "author": {"login": "garyrussell"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOoc58gH2gAyNDk3MDA4MDA5OjFjYWMzMTkyOTcyNjE3ZmZkY2ViZmYwMjA2ODNkMTVjNGZlMWQxZjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOqJvxAH2gAyNDk3MDA4MDA5OjM3MzE5ZTkyYjI2YTVhNWMxZDhkMGRhMGZhMGE3MjczMjRiZmM4MTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1cac3192972617ffdcebff020683d15c4fe1d1f8", "author": {"user": {"login": "garyrussell", "name": "Gary Russell"}}, "url": "https://github.com/spring-projects/spring-integration/commit/1cac3192972617ffdcebff020683d15c4fe1d1f8", "committedDate": "2020-10-02T16:19:57Z", "message": "GH-3396: Add Docs for Micrometer MeterFilters\n\nResolves https://github.com/spring-projects/spring-integration/issues/3396"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMjk3MjU3", "url": "https://github.com/spring-projects/spring-integration/pull/3398#pullrequestreview-501297257", "createdAt": "2020-10-02T16:55:15Z", "commit": {"oid": "1cac3192972617ffdcebff020683d15c4fe1d1f8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNjo1NToxNVrOHb0x7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNjo1NToxNVrOHb0x7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODkzODM0OQ==", "bodyText": "Any chances to have some sample how to disable metrics for example for myChannel bean?", "url": "https://github.com/spring-projects/spring-integration/pull/3398#discussion_r498938349", "createdAt": "2020-10-02T16:55:15Z", "author": {"login": "artembilan"}, "path": "src/reference/asciidoc/metrics.adoc", "diffHunk": "@@ -118,3 +120,11 @@ and\n * `tag`: `type:channel`\n * `tag`: `name:<componentName>`\n * `description`: `The remaining capacity of the queue channel`\n+\n+===== Disabling Meters\n+\n+With the <<legacy-metrics>> (which have now been removed), you could specify which integration components would collect metrics.\n+By default, all meters are registered when first used.\n+Now, with Micrometer, you can add `MeterFilter` s to the `MeterRegistry` to prevent some or all from being registered.\n+You can filter out (deny) meters by any of the properties provided, `name`, `tag`, etc.\n+See https://micrometer.io/docs/concepts#_meter_filters[Meter Filters] in the Micrometer documentation for more information.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1cac3192972617ffdcebff020683d15c4fe1d1f8"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06e60ca6362a556ce141fb31a3cf01a7bd580b90", "author": {"user": {"login": "garyrussell", "name": "Gary Russell"}}, "url": "https://github.com/spring-projects/spring-integration/commit/06e60ca6362a556ce141fb31a3cf01a7bd580b90", "committedDate": "2020-10-02T17:57:20Z", "message": "Add example."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMzQzMDI4", "url": "https://github.com/spring-projects/spring-integration/pull/3398#pullrequestreview-501343028", "createdAt": "2020-10-02T18:06:40Z", "commit": {"oid": "06e60ca6362a556ce141fb31a3cf01a7bd580b90"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxODowNjo0MFrOHb22rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxODowNjo0MFrOHb22rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk3MjMzNA==", "bodyText": "Probably writing this test you were going to add something to docs.\nAren't you?", "url": "https://github.com/spring-projects/spring-integration/pull/3398#discussion_r498972334", "createdAt": "2020-10-02T18:06:40Z", "author": {"login": "artembilan"}, "path": "spring-integration-core/src/test/java/org/springframework/integration/support/management/micrometer/MicrometerMetricsTests.java", "diffHunk": "@@ -264,7 +275,11 @@ public void testMicrometerMetrics() {\n \n \t\t@Bean\n \t\tpublic static MeterRegistry meterRegistry() {\n-\t\t\treturn new SimpleMeterRegistry();\n+\t\t\tSimpleMeterRegistry registry = new SimpleMeterRegistry();\n+\t\t\tregistry.config().meterFilter(MeterFilter.deny(id ->\n+\t\t\t\t\t\"channel\".equals(id.getTag(\"type\")) &&\n+\t\t\t\t\t\"noMeters\".equals(id.getTag(\"name\"))));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06e60ca6362a556ce141fb31a3cf01a7bd580b90"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37319e92b26a5a5c1d8d0da0fa0a727324bfc811", "author": {"user": {"login": "garyrussell", "name": "Gary Russell"}}, "url": "https://github.com/spring-projects/spring-integration/commit/37319e92b26a5a5c1d8d0da0fa0a727324bfc811", "committedDate": "2020-10-02T18:18:50Z", "message": "Commit unsaved editor changes."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 126, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}