{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxNjExMjUx", "number": 3201, "title": "Add Reactive TX Manager support", "bodyText": "Change TransactionInterceptorBuilder and TransactionHandleMessageAdvice to reply\non a generic TransactionManager, so we can configure reactive one as well\nChange a <transactional> XML element to support a generic TransactionManager reference,\nso we can configure reactive one as well\nSupport adviceChain configuration for the ReactiveMessageHandler in the ConsumerEndpointFactoryBean\nAttemp to apply reactive transaction for the Reactive MongoDB channel adapter", "createdAt": "2020-02-28T21:50:02Z", "url": "https://github.com/spring-projects/spring-integration/pull/3201", "merged": true, "mergeCommit": {"oid": "45a91b25de34cbaad79856888908cb7251544e38"}, "closed": true, "closedAt": "2020-03-03T16:54:30Z", "author": {"login": "artembilan"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKEf7QgBqjMwOTI3ODc1MTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKFRuwgFqTM2ODE1MjUwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4d7008e6c0757217de044cf65aa2f2c1a5c34467", "author": {"user": {"login": "artembilan", "name": "Artem Bilan"}}, "url": "https://github.com/spring-projects/spring-integration/commit/4d7008e6c0757217de044cf65aa2f2c1a5c34467", "committedDate": "2020-02-28T21:49:34Z", "message": "Add Reactive TX Manager support\n\n* Change `TransactionInterceptorBuilder` and `TransactionHandleMessageAdvice` to reply\non a generic `TransactionManager`, so we can configure reactive one as well\n* Change a `<transactional>` XML element to support a generic `TransactionManager` reference,\nso we can configure reactive one as well\n* Support `adviceChain` configuration for the `ReactiveMessageHandler` in the `ConsumerEndpointFactoryBean`\n* Attemp to apply reactive transaction for the Reactive MongoDB channel adapter"}, "afterCommit": {"oid": "acd996cdc5f2570d073de8be07e4c24fc0e1c4b3", "author": {"user": {"login": "artembilan", "name": "Artem Bilan"}}, "url": "https://github.com/spring-projects/spring-integration/commit/acd996cdc5f2570d073de8be07e4c24fc0e1c4b3", "committedDate": "2020-03-03T15:59:34Z", "message": "* Revert `MongoDbTests` change -\nto support transactions we need the latest MongoDb server with replica enabled\n* Document reactive transactions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MTQwNTU4", "url": "https://github.com/spring-projects/spring-integration/pull/3201#pullrequestreview-368140558", "createdAt": "2020-03-03T16:40:01Z", "commit": {"oid": "acd996cdc5f2570d073de8be07e4c24fc0e1c4b3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNjo0MDowMlrOFxNpKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNjo0NDoyOVrOFxN04w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE0ODA3Mw==", "bodyText": "Need final overrides of these to call from a CTOR - even though Spring is in violation of that rule in the super class.", "url": "https://github.com/spring-projects/spring-integration/pull/3201#discussion_r387148073", "createdAt": "2020-03-03T16:40:02Z", "author": {"login": "garyrussell"}, "path": "spring-integration-core/src/main/java/org/springframework/integration/transaction/TransactionHandleMessageAdvice.java", "diffHunk": "@@ -46,12 +46,16 @@\n \tpublic TransactionHandleMessageAdvice() {\n \t}\n \n-\tpublic TransactionHandleMessageAdvice(PlatformTransactionManager ptm, Properties attributes) {\n-\t\tsuper(ptm, attributes);\n+\tpublic TransactionHandleMessageAdvice(TransactionManager transactionManager, Properties transactionAttributes) {\n+\t\tsetTransactionManager(transactionManager);\n+\t\tsetTransactionAttributes(transactionAttributes);\n \t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acd996cdc5f2570d073de8be07e4c24fc0e1c4b3"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE0OTYyMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\tReactiveMessageHandler reactiveMessageHandler =\n          \n          \n            \n            \t\t\t\t\t((ReactiveMessageHandlerAdapter) this.handler).getDelegate();\n          \n          \n            \n            \t\t\treactiveMessageHandler = adviceChain(reactiveMessageHandler);\n          \n          \n            \n            \t\t\tthis.handler = new ReactiveMessageHandlerAdapter(reactiveMessageHandler);\n          \n          \n            \n                    this.handler = new ReactiveMessageHandlerAdapter(adviceChain(((ReactiveMessageHandlerAdapter) this.handler).getDelegate())));", "url": "https://github.com/spring-projects/spring-integration/pull/3201#discussion_r387149620", "createdAt": "2020-03-03T16:42:18Z", "author": {"login": "garyrussell"}, "path": "spring-integration-core/src/main/java/org/springframework/integration/config/ConsumerEndpointFactoryBean.java", "diffHunk": "@@ -200,10 +200,13 @@ public void afterPropertiesSet() {\n \t\t}\n \n \t\tif (!(this.handler instanceof ReactiveMessageHandlerAdapter)) {\n-\t\t\tadviceChain();\n+\t\t\tthis.handler = adviceChain(this.handler);\n \t\t}\n \t\telse if (!CollectionUtils.isEmpty(this.adviceChain)) {\n-\t\t\tLOGGER.warn(\"the advice chain cannot be applied to a 'ReactiveMessageHandler'\");\n+\t\t\tReactiveMessageHandler reactiveMessageHandler =\n+\t\t\t\t\t((ReactiveMessageHandlerAdapter) this.handler).getDelegate();\n+\t\t\treactiveMessageHandler = adviceChain(reactiveMessageHandler);\n+\t\t\tthis.handler = new ReactiveMessageHandlerAdapter(reactiveMessageHandler);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acd996cdc5f2570d073de8be07e4c24fc0e1c4b3"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE1MTA3NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The transactional support in Spring Integration now also includes options to configure a `ReactiveTransactionManager` if a `MessageSource` or `MessageHandler` implementation produces a reactive type for payload to send.\n          \n          \n            \n            Transactional support in Spring Integration now also includes options to configure a `ReactiveTransactionManager` if a `MessageSource` or `MessageHandler` implementation produces a reactive type for payload to send.", "url": "https://github.com/spring-projects/spring-integration/pull/3201#discussion_r387151075", "createdAt": "2020-03-03T16:44:29Z", "author": {"login": "garyrussell"}, "path": "src/reference/asciidoc/whats-new.adoc", "diffHunk": "@@ -57,6 +57,10 @@ A new `publishSubscribeChannel()` operator, based on the `BroadcastCapableChanne\n This fluent API has its advantage when we configure sub-flows as pub-sub subscribers for broker-backed channels like `SubscribableJmsChannel`, `SubscribableRedisChannel` etc.\n See <<./dsl.adoc#java-dsl-subflows,Sub-flows support>> for more information.\n \n+The transactional support in Spring Integration now also includes options to configure a `ReactiveTransactionManager` if a `MessageSource` or `MessageHandler` implementation produces a reactive type for payload to send.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acd996cdc5f2570d073de8be07e4c24fc0e1c4b3"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85b3fa05b03469cbee9cddf3d5f940b9d7a89156", "author": {"user": {"login": "artembilan", "name": "Artem Bilan"}}, "url": "https://github.com/spring-projects/spring-integration/commit/85b3fa05b03469cbee9cddf3d5f940b9d7a89156", "committedDate": "2020-03-03T16:49:56Z", "message": "Add Reactive TX Manager support\n\n* Change `TransactionInterceptorBuilder` and `TransactionHandleMessageAdvice` to reply\non a generic `TransactionManager`, so we can configure reactive one as well\n* Change a `<transactional>` XML element to support a generic `TransactionManager` reference,\nso we can configure reactive one as well\n* Support `adviceChain` configuration for the `ReactiveMessageHandler` in the `ConsumerEndpointFactoryBean`\n* Attemp to apply reactive transaction for the Reactive MongoDB channel adapter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1627f8c69ebefc1d3a37ce9edbc9ef1bdd96380", "author": {"user": {"login": "artembilan", "name": "Artem Bilan"}}, "url": "https://github.com/spring-projects/spring-integration/commit/a1627f8c69ebefc1d3a37ce9edbc9ef1bdd96380", "committedDate": "2020-03-03T16:49:56Z", "message": "* Revert `MongoDbTests` change -\nto support transactions we need the latest MongoDb server with replica enabled\n* Document reactive transactions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdb29d823e1a569ad99482ce692e62c26e6e9658", "author": {"user": {"login": "artembilan", "name": "Artem Bilan"}}, "url": "https://github.com/spring-projects/spring-integration/commit/bdb29d823e1a569ad99482ce692e62c26e6e9658", "committedDate": "2020-03-03T16:51:29Z", "message": "* Address PR reviews"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "acd996cdc5f2570d073de8be07e4c24fc0e1c4b3", "author": {"user": {"login": "artembilan", "name": "Artem Bilan"}}, "url": "https://github.com/spring-projects/spring-integration/commit/acd996cdc5f2570d073de8be07e4c24fc0e1c4b3", "committedDate": "2020-03-03T15:59:34Z", "message": "* Revert `MongoDbTests` change -\nto support transactions we need the latest MongoDb server with replica enabled\n* Document reactive transactions"}, "afterCommit": {"oid": "bdb29d823e1a569ad99482ce692e62c26e6e9658", "author": {"user": {"login": "artembilan", "name": "Artem Bilan"}}, "url": "https://github.com/spring-projects/spring-integration/commit/bdb29d823e1a569ad99482ce692e62c26e6e9658", "committedDate": "2020-03-03T16:51:29Z", "message": "* Address PR reviews"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MTUyNTAy", "url": "https://github.com/spring-projects/spring-integration/pull/3201#pullrequestreview-368152502", "createdAt": "2020-03-03T16:54:13Z", "commit": {"oid": "bdb29d823e1a569ad99482ce692e62c26e6e9658"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 191, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}