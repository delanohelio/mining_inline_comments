{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0OTA0Nzcz", "number": 3228, "title": "Fix JsonToObjectTransformer for ClassNotFoundEx", "bodyText": "Related to #3223\nThe JsonToObjectTransformer consults JsonHeaders first and tries to build\na ResolvableType from other type headers which may be just a string identifications.\nIn this case a ClassNotFoundException could be thrown if a ResolvableType cannot\nbe build against non-class identificators\n\nAdd valueTypeExpression option to the JsonToObjectTransformer to let to\nbuild a ResolvableType using any possible custom logic, e.g. resolving\ntarget classes from some registry using their ids from the mentioned headers\n\nCherry-pick to 5.2.x", "createdAt": "2020-03-27T18:20:33Z", "url": "https://github.com/spring-projects/spring-integration/pull/3228", "merged": true, "mergeCommit": {"oid": "9c46b3420ea674899f032027f292aee526b16805"}, "closed": true, "closedAt": "2020-03-27T19:42:25Z", "author": {"login": "artembilan"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcR05HxgH2gAyMzk0OTA0NzczOmNhY2YyZjMxOTRkNjMwMWVlNDRkZWJkMzE3YTMwZjIyNWRmYjA5YWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcR2EIjgFqTM4MzE1MjM1Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cacf2f3194d6301ee44debd317a30f225dfb09ac", "author": {"user": {"login": "artembilan", "name": "Artem Bilan"}}, "url": "https://github.com/spring-projects/spring-integration/commit/cacf2f3194d6301ee44debd317a30f225dfb09ac", "committedDate": "2020-03-27T18:20:15Z", "message": "Fix JsonToObjectTransformer for ClassNotFoundEx\n\nRelated to https://github.com/spring-projects/spring-integration/issues/3223\n\nThe `JsonToObjectTransformer` consults `JsonHeaders` first and tries to build\na `ResolvableType` from other type headers which may be just a string identifications.\nIn this case a `ClassNotFoundException` could be thrown if a `ResolvableType` cannot\nbe build against non-class identificators\n\n* Add `valueTypeExpression` option to the `JsonToObjectTransformer` to let to\nbuild a `ResolvableType` using any possible custom logic, e.g. resolving\ntarget classes from some registry using their ids from the mentioned headers\n\n**Cherry-pick to 5.2.x**"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMTIwMDAy", "url": "https://github.com/spring-projects/spring-integration/pull/3228#pullrequestreview-383120002", "createdAt": "2020-03-27T18:50:20Z", "commit": {"oid": "cacf2f3194d6301ee44debd317a30f225dfb09ac"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxODo1MDoyMVrOF898zw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxODo1NToyOFrOF8-HDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQ3Mzg3MQ==", "bodyText": "Since alone is ok; Starting needs with.", "url": "https://github.com/spring-projects/spring-integration/pull/3228#discussion_r399473871", "createdAt": "2020-03-27T18:50:21Z", "author": {"login": "garyrussell"}, "path": "spring-integration-core/src/main/java/org/springframework/integration/json/JsonToObjectTransformer.java", "diffHunk": "@@ -37,10 +41,12 @@\n  * factory to get an instance of Jackson JSON-processor\n  * if jackson-databind lib is present on the classpath. Any other {@linkplain JsonObjectMapper}\n  * implementation can be provided.\n- * <p>Since version 3.0, you can omit the target class and the target type can be\n+ * <p> Starting version 3.0, you can omit the target class and the target type can be", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cacf2f3194d6301ee44debd317a30f225dfb09ac"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQ3NDAxMg==", "bodyText": "with", "url": "https://github.com/spring-projects/spring-integration/pull/3228#discussion_r399474012", "createdAt": "2020-03-27T18:50:39Z", "author": {"login": "garyrussell"}, "path": "spring-integration-core/src/main/java/org/springframework/integration/json/JsonToObjectTransformer.java", "diffHunk": "@@ -37,10 +41,12 @@\n  * factory to get an instance of Jackson JSON-processor\n  * if jackson-databind lib is present on the classpath. Any other {@linkplain JsonObjectMapper}\n  * implementation can be provided.\n- * <p>Since version 3.0, you can omit the target class and the target type can be\n+ * <p> Starting version 3.0, you can omit the target class and the target type can be\n  * determined by the {@link JsonHeaders} type entries - including the contents of a\n  * one-level container or map type.\n- * <p>The type headers can be classes or fully-qualified class names.\n+ * <p> The type headers can be classes or fully-qualified class names.\n+ * <p> Starting version 5.2.6, a SpEL expression option is provided to let to build a target", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cacf2f3194d6301ee44debd317a30f225dfb09ac"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQ3NjEwMA==", "bodyText": "against the request message.", "url": "https://github.com/spring-projects/spring-integration/pull/3228#discussion_r399476100", "createdAt": "2020-03-27T18:54:40Z", "author": {"login": "garyrussell"}, "path": "src/reference/asciidoc/transformer.adoc", "diffHunk": "@@ -449,6 +449,11 @@ Starting with version 5.2, the `JsonToObjectTransformer` can be configured with\n Also this component now consults request message headers first for the presence of the `JsonHeaders.RESOLVABLE_TYPE` or `JsonHeaders.TYPE_ID` and falls back to the configured type otherwise.\n The `ObjectToJsonTransformer` now also populates a `JsonHeaders.RESOLVABLE_TYPE` header based on the request message payload for any possible downstream scenarios.\n \n+Starting with version 5.2.6, the `JsonToObjectTransformer` can be supplied with a `valueTypeExpression` to resolve a `ResolvableType` for the payload to convert from JSON at runtime against request message.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cacf2f3194d6301ee44debd317a30f225dfb09ac"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQ3NjQ5Mw==", "bodyText": "from the request message", "url": "https://github.com/spring-projects/spring-integration/pull/3228#discussion_r399476493", "createdAt": "2020-03-27T18:55:28Z", "author": {"login": "garyrussell"}, "path": "spring-integration-core/src/main/java/org/springframework/integration/json/JsonToObjectTransformer.java", "diffHunk": "@@ -144,12 +191,31 @@ protected Object doTransform(Message<?> message) {\n \t}\n \n \t@Nullable\n-\tprivate ResolvableType obtainResolvableTypeFromHeadersIfAny(MessageHeaders headers) {\n+\tprivate ResolvableType obtainResolvableType(Message<?> message) {\n+\t\ttry {\n+\t\t\treturn this.valueTypeExpression.getValue(this.evaluationContext, message, ResolvableType.class);\n+\t\t}\n+\t\tcatch (Exception ex) {\n+\t\t\tif (ex.getCause() instanceof ClassNotFoundException) {\n+\t\t\t\tlogger.info(\"Cannot build a ResolvableType from a request message '\" + message +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cacf2f3194d6301ee44debd317a30f225dfb09ac"}, "originalPosition": 124}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18ed8a6dc9747cdf5cb778e89e9a708b020dbf6e", "author": {"user": {"login": "artembilan", "name": "Artem Bilan"}}, "url": "https://github.com/spring-projects/spring-integration/commit/18ed8a6dc9747cdf5cb778e89e9a708b020dbf6e", "committedDate": "2020-03-27T19:19:24Z", "message": "* Fix English language mistakes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMTUyMzUy", "url": "https://github.com/spring-projects/spring-integration/pull/3228#pullrequestreview-383152352", "createdAt": "2020-03-27T19:42:11Z", "commit": {"oid": "18ed8a6dc9747cdf5cb778e89e9a708b020dbf6e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 208, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}