{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3OTcwMDI4", "number": 3190, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQyMToyMjo0M1rODhrwcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxNzoyMzowNlrODh9DDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NjQ2NTE0OnYy", "diffSide": "RIGHT", "path": "spring-integration-test/src/main/java/org/springframework/integration/test/context/MockIntegrationContext.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQyMToyMjo0M1rOFsjm4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQyMToyMjo0M1rOFsjm4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjI2NTA1OQ==", "bodyText": "Don't we need a test for this \"partial\" reset use case?", "url": "https://github.com/spring-projects/spring-integration/pull/3190#discussion_r382265059", "createdAt": "2020-02-20T21:22:43Z", "author": {"login": "garyrussell"}, "path": "spring-integration-test/src/main/java/org/springframework/integration/test/context/MockIntegrationContext.java", "diffHunk": "@@ -108,9 +114,19 @@ else if (endpoint instanceof ReactiveStreamsConsumer) {\n \t\t\t\t\telse if (endpoint instanceof IntegrationConsumer) {\n \t\t\t\t\t\tdirectFieldAccessor.setPropertyValue(HANDLER, e.getValue());\n \t\t\t\t\t}\n+\t\t\t\t\tif (lifecycle != null && lifecycle.isAutoStartup()) {\n+\t\t\t\t\t\tlifecycle.start();\n+\t\t\t\t\t}\n \t\t\t\t});\n \n-\t\tthis.beans.clear();\n+\t\tif (!ObjectUtils.isEmpty(beanNames)) {\n+\t\t\tfor (String name : beanNames) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e69e038c19339bfbc54af14dbbb4163c14c51f9c"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2OTI5ODA2OnYy", "diffSide": "RIGHT", "path": "spring-integration-test/src/main/java/org/springframework/integration/test/context/MockIntegrationContext.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxNzoyMzowNlrOFs-mjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxODo0MDowMlrOFtAu-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjcwNzM0MA==", "bodyText": "Doesn't this have potential to break existing tests?\nMaybe this just matters for constructed examples. But I could imagine something like this:\n@BeforeClass\nvoid init() {\n  nonAutostartupHandler.start();\n}\n\n@After \nvoid cleanup() {\n  mockIntegrationContext.reset()\n}\n\n@Test\nvoid t1() {\n  // do something with handler\n}\n\n@Test \nvoid t2() {\n  // expect handler to be still running\n}\n\nAdmittedly the @BeforeClass is somewhat artificial. But I could see a  handler being manually started as part of context initialization.\nI'm sorry for not contributing a fix myself, I had a pretty busy week at work.", "url": "https://github.com/spring-projects/spring-integration/pull/3190#discussion_r382707340", "createdAt": "2020-02-21T17:23:06Z", "author": {"login": "hgarus"}, "path": "spring-integration-test/src/main/java/org/springframework/integration/test/context/MockIntegrationContext.java", "diffHunk": "@@ -108,9 +114,19 @@ else if (endpoint instanceof ReactiveStreamsConsumer) {\n \t\t\t\t\telse if (endpoint instanceof IntegrationConsumer) {\n \t\t\t\t\t\tdirectFieldAccessor.setPropertyValue(HANDLER, e.getValue());\n \t\t\t\t\t}\n+\t\t\t\t\tif (lifecycle != null && lifecycle.isAutoStartup()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e69e038c19339bfbc54af14dbbb4163c14c51f9c"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc0MjI2NQ==", "bodyText": "nonAutostartupHandler.start(); - you definitely start it manually. The framework can't assume when and how you have started it or going to.\nOnly the way for the framework to start it when you have that autoStartup = true.\nI admit that it may break some peculiar test, but at the same time the test is wrong because it has been relied on bug which we are fixing here.\nOn the other hand I don't worry too much about breaking changes for tests. That's not that part of project which may make your customer unhappy.", "url": "https://github.com/spring-projects/spring-integration/pull/3190#discussion_r382742265", "createdAt": "2020-02-21T18:40:02Z", "author": {"login": "artembilan"}, "path": "spring-integration-test/src/main/java/org/springframework/integration/test/context/MockIntegrationContext.java", "diffHunk": "@@ -108,9 +114,19 @@ else if (endpoint instanceof ReactiveStreamsConsumer) {\n \t\t\t\t\telse if (endpoint instanceof IntegrationConsumer) {\n \t\t\t\t\t\tdirectFieldAccessor.setPropertyValue(HANDLER, e.getValue());\n \t\t\t\t\t}\n+\t\t\t\t\tif (lifecycle != null && lifecycle.isAutoStartup()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjcwNzM0MA=="}, "originalCommit": {"oid": "e69e038c19339bfbc54af14dbbb4163c14c51f9c"}, "originalPosition": 31}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1972, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}