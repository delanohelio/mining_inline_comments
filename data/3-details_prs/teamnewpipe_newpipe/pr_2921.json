{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5MjQ2ODU2", "number": 2921, "title": "Add language selector to change the app language", "bodyText": "I carefully read the contribution guidelines and agree to them.\n\nFixes #2794, fixes #2162, fixes #2887, fixes #1215, fixes #1130, fixes #2848, fixes #578, fix r/NewPipe : Any way to change the app language? & r/NewPipe : how to change app language ?\nExplaination :\nBefore, NewPipe's language was phone's language. Now, it's the language selected in Settings -> Content -> App language, and by default, it stays system default language.\nThus, you can force an app language (eg. English for developing / debugging : take a screenshot in English) or use non-available system language (Esperanto isn't translated for Android) or simply just set the language you want without changing phone / system language.\nAPK: 2020-01-27_language-selector#2921_APK.zip", "createdAt": "2020-01-04T20:56:22Z", "url": "https://github.com/TeamNewPipe/NewPipe/pull/2921", "merged": true, "mergeCommit": {"oid": "14e852237f7985ed719d5dde82a0e81d7cebf204"}, "closed": true, "closedAt": "2020-02-01T14:47:14Z", "author": {"login": "B0pol"}, "timelineItems": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb3JH0bgH2gAyMzU5MjQ2ODU2OmRlYTFlMGRjYjk2NTJkYmFkZGNkMWYxZGU2OGQ4YTVkMzQwNDI2YTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcAE0aWgFqTM1MTg4NzQ2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dea1e0dcb9652dbaddcd1f1de68d8a5d340426a2", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/dea1e0dcb9652dbaddcd1f1de68d8a5d340426a2", "committedDate": "2020-01-04T20:38:27Z", "message": "Update localizations settings\n\n1) now, on \u00ab content language \u00bb change, it will also change the app language\n2) added Esperanto to the list of language in content language"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ad0e313caee037d42ea9a4ef89e80fbd04d9a2f", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/3ad0e313caee037d42ea9a4ef89e80fbd04d9a2f", "committedDate": "2020-01-09T08:40:05Z", "message": "changed the way to change language, now is \u00abNewPipe's language\u00bb selector"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0a39efa2b9d61428a5cd3dafbf28266d98a1e1c", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/e0a39efa2b9d61428a5cd3dafbf28266d98a1e1c", "committedDate": "2020-01-09T09:07:22Z", "message": "Merge branch 'dev' into dev"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed9a3517c63708a613373ff274cd6eeec63f79ff", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/ed9a3517c63708a613373ff274cd6eeec63f79ff", "committedDate": "2020-01-09T11:15:01Z", "message": "removed unused imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b32935a1b087bbc6d19fb7e50493273796d2ffb4", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/b32935a1b087bbc6d19fb7e50493273796d2ffb4", "committedDate": "2020-01-09T14:51:41Z", "message": "app language now changes time formatting (3hrs ago), was system language b4"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f46432391578b6602cea69ef344817857f75a7e", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/8f46432391578b6602cea69ef344817857f75a7e", "committedDate": "2020-01-10T14:50:15Z", "message": "fixed some activities where the wrong languages would be set"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11d06dc86d8e1f0e2614251a1359e36dd537a81c", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/11d06dc86d8e1f0e2614251a1359e36dd537a81c", "committedDate": "2020-01-10T15:03:24Z", "message": "remove todo as it's already done"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "382e69273ee29ce62ee39ecfc55ba03351b52820", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/382e69273ee29ce62ee39ecfc55ba03351b52820", "committedDate": "2020-01-14T10:11:45Z", "message": "Merge branch 'dev' into dev"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8a7aac40d0e7e1a6558753e012dabd6f97d7df7", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/f8a7aac40d0e7e1a6558753e012dabd6f97d7df7", "committedDate": "2020-01-14T13:15:42Z", "message": "fixed indonesian, see https://stackoverflow.com/questions/13291578/how-to-localize-an-android-app-in-indonesian-language"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "055365a44931b65e9fffd0d5d57595fe3be40abb", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/055365a44931b65e9fffd0d5d57595fe3be40abb", "committedDate": "2020-01-14T13:26:53Z", "message": "added Occitan to the selector"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "105981b2eb426b598f81694442621e8b695a642e", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/105981b2eb426b598f81694442621e8b695a642e", "committedDate": "2020-01-14T18:11:46Z", "message": "made system translatable + renamed it to system's language"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d8fcbbffe7ade9e662ab94e1a5a539a7e4e7d04", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/9d8fcbbffe7ade9e662ab94e1a5a539a7e4e7d04", "committedDate": "2020-01-15T07:33:57Z", "message": "fix: wrong language shown when rotating screen in popup player"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cd9fb32a8cfdf71ab5083866a8f61192f412103", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/0cd9fb32a8cfdf71ab5083866a8f61192f412103", "committedDate": "2020-01-17T23:26:04Z", "message": "Merge branch 'dev' into dev"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b155f23d276ebc48ffe5fe86759320b6751ac512", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/b155f23d276ebc48ffe5fe86759320b6751ac512", "committedDate": "2020-01-18T08:46:38Z", "message": "fix: wrong language shown in playback parameters dialog\n\nThis is a hardly reproduceable bug that I hopefully fixed. After a long time of watching videos, you could have your system language shown in playback parameters dialog.\nCalling changeAppLanguage(getAppLocale(\u2026),\u2026) onCreate will most certainly fix this bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e08e7245738ca8ee5dab4dc5801dc6d35399873a", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/e08e7245738ca8ee5dab4dc5801dc6d35399873a", "committedDate": "2020-01-18T09:46:53Z", "message": "upload date in description now matches newpipe's language"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e58088d290e065b736f8feb5b1ce9d10465dd8e2", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/e58088d290e065b736f8feb5b1ce9d10465dd8e2", "committedDate": "2020-01-19T17:09:17Z", "message": "Merge branch 'dev' into dev"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "489420e8557917c7054eee30f65a79319c1f2c63", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/489420e8557917c7054eee30f65a79319c1f2c63", "committedDate": "2020-01-24T19:19:51Z", "message": "Merge branch 'dev' into dev"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e94981e6f7b4a0a33b3e5030d32f5ecbbcb88d52", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/e94981e6f7b4a0a33b3e5030d32f5ecbbcb88d52", "committedDate": "2020-01-27T18:24:18Z", "message": "Merge branch 'dev' into dev"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "156a2eb4ffe7479333536f3195ed3ceee63fa7f1", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/156a2eb4ffe7479333536f3195ed3ceee63fa7f1", "committedDate": "2020-01-27T18:32:40Z", "message": "update prettytime dependency\n\nsee https://github.com/TeamNewPipe/NewPipe/pull/2921#issuecomment-572601812\nIt will add Esperanto, add bengali, update vietnamese\npretty time is the library used in the home page: \u2026 days ago"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5MzE4ODQ5", "url": "https://github.com/TeamNewPipe/NewPipe/pull/2921#pullrequestreview-349318849", "createdAt": "2020-01-28T11:56:46Z", "commit": {"oid": "156a2eb4ffe7479333536f3195ed3ceee63fa7f1"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMTo1Njo0NlrOFiiZLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMTo1OTozNFrOFiid6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc1OTQwNg==", "bodyText": "Is this to differentiate between accents like EN-GB and EN-US? If yes, please add a comment to help others to understand this.", "url": "https://github.com/TeamNewPipe/NewPipe/pull/2921#discussion_r371759406", "createdAt": "2020-01-28T11:56:46Z", "author": {"login": "TobiGr"}, "path": "app/src/main/java/org/schabi/newpipe/util/Localization.java", "diffHunk": "@@ -199,21 +204,41 @@ public static String getDurationString(long duration) {\n     // Pretty Time\n     //////////////////////////////////////////////////////////////////////////*/\n \n-    private static void initPrettyTime() {\n-        prettyTime = new PrettyTime(Locale.getDefault());\n+    private static void initPrettyTime(Context context) {\n+        prettyTime = new PrettyTime(getAppLocale(context));\n         // Do not use decades as YouTube doesn't either.\n         prettyTime.removeUnit(Decade.class);\n     }\n \n     private static PrettyTime getPrettyTime() {\n-        // If pretty time's Locale is different, init again with the new one.\n-        if (!prettyTime.getLocale().equals(Locale.getDefault())) {\n-            initPrettyTime();\n-        }\n         return prettyTime;\n     }\n \n     public static String relativeTime(Calendar calendarTime) {\n         return getPrettyTime().formatUnrounded(calendarTime);\n     }\n+\n+    public static void changeAppLanguage(Locale loc, Resources res) {\n+        DisplayMetrics dm = res.getDisplayMetrics();\n+        Configuration conf = res.getConfiguration();\n+        conf.setLocale(loc);\n+        res.updateConfiguration(conf, dm);\n+    }\n+\n+    public static Locale getAppLocale(Context context) {\n+        SharedPreferences prefs = androidx.preference.PreferenceManager.getDefaultSharedPreferences(context);\n+        String lang = prefs.getString(\"newpipes_language_key\", \"en\");\n+        Locale loc;\n+        if (lang.equals(\"system\")) {\n+            loc = Locale.getDefault();\n+        } else if (lang.matches(\".*-.*\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "156a2eb4ffe7479333536f3195ed3ceee63fa7f1"}, "originalPosition": 94}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc1OTc1MA==", "bodyText": "maybe app language?", "url": "https://github.com/TeamNewPipe/NewPipe/pull/2921#discussion_r371759750", "createdAt": "2020-01-28T11:57:34Z", "author": {"login": "TobiGr"}, "path": "app/src/main/res/values/settings_keys.xml", "diffHunk": "@@ -175,6 +175,8 @@\n     <string name=\"main_page_content_key\" translatable=\"false\">main_page_content</string>\n     <string name=\"enable_playback_resume_key\" translatable=\"false\">enable_playback_resume</string>\n     <string name=\"enable_playback_state_lists_key\" translatable=\"false\">enable_playback_state_lists</string>\n+\n+    <string name=\"newpipes_language_key\" translatable=\"false\">newpipes_language_key</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "156a2eb4ffe7479333536f3195ed3ceee63fa7f1"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc2MDA5Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                <!--The next two arrays are set to change the NewPipe language-->\n          \n          \n            \n                <!--The next two arrays are set to change the app language-->", "url": "https://github.com/TeamNewPipe/NewPipe/pull/2921#discussion_r371760096", "createdAt": "2020-01-28T11:58:24Z", "author": {"login": "TobiGr"}, "path": "app/src/main/res/values/settings_keys.xml", "diffHunk": "@@ -924,6 +926,138 @@\n         <item>ZW</item>\n     </string-array>\n \n+    <!--The next two arrays are set to change the NewPipe language-->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "156a2eb4ffe7479333536f3195ed3ceee63fa7f1"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc2MDQ2Mg==", "bodyText": "Maybe system default?", "url": "https://github.com/TeamNewPipe/NewPipe/pull/2921#discussion_r371760462", "createdAt": "2020-01-28T11:59:11Z", "author": {"login": "TobiGr"}, "path": "app/src/main/res/values/strings.xml", "diffHunk": "@@ -589,4 +589,6 @@\n     <string name=\"downloads_storage_use_saf_title\">Use SAF</string>\n     <string name=\"downloads_storage_use_saf_summary\">The Storage Access Framework allows downloads to an external SD card.\\nNote: some devices are not compatible</string>\n     <string name=\"choose_instance_prompt\">Choose an instance</string>\n+    <string name=\"newpipes_language_title\">NewPipe\\'s language</string>\n+    <string name=\"systems_language\">System\\'s language</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "156a2eb4ffe7479333536f3195ed3ceee63fa7f1"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc2MDYxOQ==", "bodyText": "Display / app language", "url": "https://github.com/TeamNewPipe/NewPipe/pull/2921#discussion_r371760619", "createdAt": "2020-01-28T11:59:34Z", "author": {"login": "TobiGr"}, "path": "app/src/main/res/values/strings.xml", "diffHunk": "@@ -589,4 +589,6 @@\n     <string name=\"downloads_storage_use_saf_title\">Use SAF</string>\n     <string name=\"downloads_storage_use_saf_summary\">The Storage Access Framework allows downloads to an external SD card.\\nNote: some devices are not compatible</string>\n     <string name=\"choose_instance_prompt\">Choose an instance</string>\n+    <string name=\"newpipes_language_title\">NewPipe\\'s language</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "156a2eb4ffe7479333536f3195ed3ceee63fa7f1"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edc9d47da795efbc1606efae50788bdc81f4468b", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/edc9d47da795efbc1606efae50788bdc81f4468b", "committedDate": "2020-01-29T20:21:00Z", "message": "app language: refactoring\n\nrenamed NewPipe's language into App language, and same for all the\nconcerning thing (keys, comments\u2026)\n\nwe now call assureCorrectAppLanguage(CONTEXT) in activities needing it\ninstead of changeAppLanguage(getAppLocale(CONTEXT), RESOURCES)\nchangeAppLanguage becomes private."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "41528d7cc8f55c3ae843e5ac25f12c328bc4a1fc", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/41528d7cc8f55c3ae843e5ac25f12c328bc4a1fc", "committedDate": "2020-01-28T20:02:44Z", "message": "refactoring for app language:\n\nwe now call assureCorrectAppLanguage(CONTEXT) instead of changeAppLanguage(getAppLocale(CONTEXT), RESOURCES) in the activities where it's needed"}, "afterCommit": {"oid": "edc9d47da795efbc1606efae50788bdc81f4468b", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/edc9d47da795efbc1606efae50788bdc81f4468b", "committedDate": "2020-01-29T20:21:00Z", "message": "app language: refactoring\n\nrenamed NewPipe's language into App language, and same for all the\nconcerning thing (keys, comments\u2026)\n\nwe now call assureCorrectAppLanguage(CONTEXT) in activities needing it\ninstead of changeAppLanguage(getAppLocale(CONTEXT), RESOURCES)\nchangeAppLanguage becomes private."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6be23a0a6fd7ea3ced7efed21c5b8e4b8321a7ec", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/6be23a0a6fd7ea3ced7efed21c5b8e4b8321a7ec", "committedDate": "2020-02-01T08:44:49Z", "message": "fix wrong language shown many popup dialogs\n\nChanged android.R.string.ok, which is \"OK\", into R.string.finish, which is also OK, but from our strings\nThen for a small amount of languages that don't have Android translation, it will show the good string."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9d60b74908aa305d349f535b03c95bb6804745b2", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/9d60b74908aa305d349f535b03c95bb6804745b2", "committedDate": "2020-01-31T21:49:43Z", "message": "fix wrong language shown in licence popup"}, "afterCommit": {"oid": "6be23a0a6fd7ea3ced7efed21c5b8e4b8321a7ec", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/6be23a0a6fd7ea3ced7efed21c5b8e4b8321a7ec", "committedDate": "2020-02-01T08:44:49Z", "message": "fix wrong language shown many popup dialogs\n\nChanged android.R.string.ok, which is \"OK\", into R.string.finish, which is also OK, but from our strings\nThen for a small amount of languages that don't have Android translation, it will show the good string."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5e6bb58bce295a18e0d5a478a7c77eb0ee522b9", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/c5e6bb58bce295a18e0d5a478a7c77eb0ee522b9", "committedDate": "2020-02-01T14:11:01Z", "message": "Merge remote-tracking branch 'upstream/dev' into dev\n\nmerging dev"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55a138e8da10ffb7b9a18b9ee602c20f2ef4b307", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/55a138e8da10ffb7b9a18b9ee602c20f2ef4b307", "committedDate": "2020-02-01T14:30:51Z", "message": "fix toast on app language change\n\nI forgot to change the key here when I renamed it"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d36ac7a5dee1c460e5bf06dd291f292830e77dd4", "author": {"user": {"login": "TobiGr", "name": "Tobi"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/d36ac7a5dee1c460e5bf06dd291f292830e77dd4", "committedDate": "2020-02-01T14:35:33Z", "message": "Improve formatting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxODg3NDY2", "url": "https://github.com/TeamNewPipe/NewPipe/pull/2921#pullrequestreview-351887466", "createdAt": "2020-02-01T14:42:57Z", "commit": {"oid": "d36ac7a5dee1c460e5bf06dd291f292830e77dd4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4007, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}