{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA3NjI0Nzk3", "number": 4587, "title": "Separate player gesture logic and UI", "bodyText": "What is it?\n\n Bugfix (user facing)\n Feature (user facing)\n Codebase improvement (dev facing)\n Meta improvement to the project (dev facing)\n\nDescription of the changes in your PR\nThis PR separates the logic behind the player gestures (for example popup position observation) and the UI (for example show/hide controls and adjusting the brightness during scrolling) This way it is more readable.\n\nCreated BasePlayerGestureListener which handles the logic and provides abstract methods for listening\nNow PlayerGestureListener contains only visual code\nAdded DisplayPortion enum class (LEFT,MIDDLE,RIGHT for double tap, LEFT_HALF, RIGHT_HALF for scrolling)\nAdded multi-double-tap-logic (will be used by #4264 soon)\n\nAPK testing\napp-debug-0.20.2-fix.zip\nDue diligence\n\n I read the contribution guidelines.", "createdAt": "2020-10-21T15:11:12Z", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4587", "merged": true, "mergeCommit": {"oid": "f1583b6e0cbb8b9b52f3d1cf82bc8143fcab29bf"}, "closed": true, "closedAt": "2020-11-02T15:36:51Z", "author": {"login": "vkay94"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXQuUZAH2gAyNTA3NjI0Nzk3OjI2ODMwNDM3NjIyNjQ1N2U5OWFlYTY0MGFlZGZhM2NjYzIyYzU5YmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdYmadvgFqTUyMTc0MTE1OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "268304376226457e99aea640aedfa3ccc22c59bb", "author": {"user": {"login": "vkay94", "name": "Viktor K"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/268304376226457e99aea640aedfa3ccc22c59bb", "committedDate": "2020-10-29T11:46:34Z", "message": "Player gestures: separate logic and UI"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7a5de5db8e70f69ed97b02d8a8fdf9a860702d3a", "author": {"user": {"login": "vkay94", "name": "Viktor K"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/7a5de5db8e70f69ed97b02d8a8fdf9a860702d3a", "committedDate": "2020-10-21T14:41:14Z", "message": "Player gestures: Add multi-double-tap logic"}, "afterCommit": {"oid": "e97f71cf2c7005c114e2e81853063add9da5b496", "author": {"user": {"login": "vkay94", "name": "Viktor K"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/e97f71cf2c7005c114e2e81853063add9da5b496", "committedDate": "2020-10-29T11:46:34Z", "message": "Player gestures: Add multi-double-tap logic"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxNjQ5MDY2", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4587#pullrequestreview-521649066", "createdAt": "2020-11-02T13:57:20Z", "commit": {"oid": "e97f71cf2c7005c114e2e81853063add9da5b496"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMzo1NzoyMVrOHsFY2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMzo1NzoyMVrOHsFY2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTk4NzY3NA==", "bodyText": "Could you add here else if (portion == DisplayPortion.MIDDLE) { playerImpl.onPlayPause(); }, so that a double tap in the middle changes the playing state, as it did before #2907? Or will you do this in a future PR?", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4587#discussion_r515987674", "createdAt": "2020-11-02T13:57:21Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/player/event/PlayerGestureListener.java", "diffHunk": "@@ -23,217 +23,114 @@\n import static org.schabi.newpipe.util.AnimationUtils.Type.SCALE_AND_ALPHA;\n import static org.schabi.newpipe.util.AnimationUtils.animateView;\n \n+/**\n+ * GestureListener for the player\n+ *\n+ * While {@link BasePlayerGestureListener} contains the logic behind the single gestures\n+ * this class focuses on the visual aspect like hiding and showing the controls or changing\n+ * volume/brightness during scrolling for specific events.\n+ */\n public class PlayerGestureListener\n-        extends GestureDetector.SimpleOnGestureListener\n+        extends BasePlayerGestureListener\n         implements View.OnTouchListener {\n     private static final String TAG = \".PlayerGestureListener\";\n     private static final boolean DEBUG = BasePlayer.DEBUG;\n \n-    private final VideoPlayerImpl playerImpl;\n-    private final MainPlayer service;\n-\n-    private int initialPopupX;\n-    private int initialPopupY;\n-\n-    private boolean isMovingInMain;\n-    private boolean isMovingInPopup;\n-\n-    private boolean isResizing;\n-\n-    private final int tossFlingVelocity;\n-\n     private final boolean isVolumeGestureEnabled;\n     private final boolean isBrightnessGestureEnabled;\n     private final int maxVolume;\n-    private static final int MOVEMENT_THRESHOLD = 40;\n-\n-    // [popup] initial coordinates and distance between fingers\n-    private double initPointerDistance = -1;\n-    private float initFirstPointerX = -1;\n-    private float initFirstPointerY = -1;\n-    private float initSecPointerX = -1;\n-    private float initSecPointerY = -1;\n-\n \n     public PlayerGestureListener(final VideoPlayerImpl playerImpl, final MainPlayer service) {\n-        this.playerImpl = playerImpl;\n-        this.service = service;\n-        this.tossFlingVelocity = PlayerHelper.getTossFlingVelocity(service);\n+        super(playerImpl, service);\n \n         isVolumeGestureEnabled = PlayerHelper.isVolumeGestureEnabled(service);\n         isBrightnessGestureEnabled = PlayerHelper.isBrightnessGestureEnabled(service);\n         maxVolume = playerImpl.getAudioReactor().getMaxVolume();\n     }\n \n-    /*//////////////////////////////////////////////////////////////////////////\n-    // Helpers\n-    //////////////////////////////////////////////////////////////////////////*/\n-\n-    /*\n-     * Main and popup players' gesture listeners is too different.\n-     * So it will be better to have different implementations of them\n-     * */\n-    @Override\n-    public boolean onDoubleTap(final MotionEvent e) {\n-        if (DEBUG) {\n-            Log.d(TAG, \"onDoubleTap() called with: e = [\" + e + \"]\" + \"rawXy = \"\n-                    + e.getRawX() + \", \" + e.getRawY() + \", xy = \" + e.getX() + \", \" + e.getY());\n-        }\n-\n-        if (playerImpl.popupPlayerSelected()) {\n-            return onDoubleTapInPopup(e);\n-        } else {\n-            return onDoubleTapInMain(e);\n-        }\n-    }\n-\n     @Override\n-    public boolean onSingleTapConfirmed(final MotionEvent e) {\n+    public void onDoubleTap(@NotNull final MotionEvent event,\n+                            @NotNull final DisplayPortion portion) {\n         if (DEBUG) {\n-            Log.d(TAG, \"onSingleTapConfirmed() called with: e = [\" + e + \"]\");\n+            Log.d(TAG, \"onDoubleTap called with playerType = [\"\n+                    + playerImpl.getPlayerType() + \"], portion = [\"\n+                    + portion + \"]\");\n         }\n-\n-        if (playerImpl.popupPlayerSelected()) {\n-            return onSingleTapConfirmedInPopup(e);\n-        } else {\n-            return onSingleTapConfirmedInMain(e);\n-        }\n-    }\n-\n-    @Override\n-    public boolean onDown(final MotionEvent e) {\n-        if (DEBUG) {\n-            Log.d(TAG, \"onDown() called with: e = [\" + e + \"]\");\n+        if (playerImpl.isSomePopupMenuVisible()) {\n+            playerImpl.hideControls(0, 0);\n         }\n \n-        if (playerImpl.popupPlayerSelected()) {\n-            return onDownInPopup(e);\n-        } else {\n-            return true;\n+        if (portion == DisplayPortion.LEFT) {\n+            playerImpl.onFastRewind();\n+        } else if (portion == DisplayPortion.RIGHT) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e97f71cf2c7005c114e2e81853063add9da5b496"}, "originalPosition": 129}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "347566c311f9e215b48baa20ab3c10f53525f809", "author": {"user": {"login": "vkay94", "name": "Viktor K"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/347566c311f9e215b48baa20ab3c10f53525f809", "committedDate": "2020-11-02T14:50:34Z", "message": "Player gestures: Add multi-double-tap logic"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e97f71cf2c7005c114e2e81853063add9da5b496", "author": {"user": {"login": "vkay94", "name": "Viktor K"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/e97f71cf2c7005c114e2e81853063add9da5b496", "committedDate": "2020-10-29T11:46:34Z", "message": "Player gestures: Add multi-double-tap logic"}, "afterCommit": {"oid": "347566c311f9e215b48baa20ab3c10f53525f809", "author": {"user": {"login": "vkay94", "name": "Viktor K"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/347566c311f9e215b48baa20ab3c10f53525f809", "committedDate": "2020-11-02T14:50:34Z", "message": "Player gestures: Add multi-double-tap logic"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxNzQxMTU5", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4587#pullrequestreview-521741159", "createdAt": "2020-11-02T15:36:43Z", "commit": {"oid": "347566c311f9e215b48baa20ab3c10f53525f809"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4068, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}