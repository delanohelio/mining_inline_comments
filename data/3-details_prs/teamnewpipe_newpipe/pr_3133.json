{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4NjgzNTc2", "number": 3133, "title": "Change app id based on current git branch", "bodyText": "I carefully read the contribution guidelines and agree to them.\n\nAs stated in #3114 (comment) I changed the gradle script so that it adds the current branch name to the application id and to the app name.\nSince the application id cannot contain special characters, I remove all non-letter characters from the branch name when appending it to the app id. When the current branch is \"master\" or \"dev\", everything is just like before (i.e. the app name is \"NewPipe Debug\" and the app id is \"org.schabi.newpipe.debug\"). When building a release apk everything is like before, too (i.e. the app name is \"NewPipe\" and the app id is \"org.schabi.newpipe\").\nI removed the debug AndroidManifest.xml because its only purpose was that of setting the app name to \"Android Debug\" in debug builds, but this is now done by the gradle script.\nThanks to this change we would be able to install multiple builds from different branches at once.\nFor example take this PR: the branch name is gradle-app-id-suffix. Therefore the app name is \"NewPipe gradle-app-id-suffix\" and the app id is \"org.schabi.newpipe.debug.gradleappidsuffix\".", "createdAt": "2020-02-23T09:04:10Z", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3133", "merged": true, "mergeCommit": {"oid": "f7822a448e8d0a5319929623b476f258845b067e"}, "closed": true, "closedAt": "2020-03-11T21:41:53Z", "author": {"login": "Stypox"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcHE6KVAH2gAyMzc4NjgzNTc2OmEzYmNlN2Y3Y2FmMTRmMDM0ZmQ1NTA4NzBiY2JlYWY1ZDA0ZGVlNWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMuL1cAFqTM3MzE0NTM2OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a3bce7f7caf14f034fd550870bcbeaf5d04dee5e", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/a3bce7f7caf14f034fd550870bcbeaf5d04dee5e", "committedDate": "2020-02-23T08:46:42Z", "message": "Change app id based on current git branch\n\nThis enables to install multiple builds from different branches at once"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d46cd265f5f695d67fe1f25d26bc745a2d47d503", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/d46cd265f5f695d67fe1f25d26bc745a2d47d503", "committedDate": "2020-02-23T09:04:19Z", "message": "Merge branch 'dev' into gradle-app-id-suffix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzMDgxNDg1", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3133#pullrequestreview-363081485", "createdAt": "2020-02-23T09:27:37Z", "commit": {"oid": "d46cd265f5f695d67fe1f25d26bc745a2d47d503"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yM1QwOToyNzozOFrOFtPreA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yM1QwOToyNzozOFrOFtPreA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk4NzEyOA==", "bodyText": "Uh, won't it add .debug and \" Debug\" to master? Because if I'm wide awake, with || workingBranch == \"master\" master is true on this if block, and has .debug suffix, and NewPipe Debug as name.\nHave you tried to apply your changes in the master branch and launch the app, to see what happens?", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3133#discussion_r382987128", "createdAt": "2020-02-23T09:27:38Z", "author": {"login": "B0pol"}, "path": "app/build.gradle", "diffHunk": "@@ -28,7 +29,15 @@ android {\n         debug {\n             multiDexEnabled true\n             debuggable true\n-            applicationIdSuffix \".debug\"\n+\n+            def workingBranch = \"git rev-parse --abbrev-ref HEAD\".execute().text.trim()\n+            if (workingBranch.isEmpty() || workingBranch == \"master\" || workingBranch == \"dev\") {\n+                applicationIdSuffix \".debug\"\n+                resValue \"string\", \"app_name\", \"NewPipe Debug\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d46cd265f5f695d67fe1f25d26bc745a2d47d503"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "030e5ab894ed576e9e63332c6b08cdda090eade6", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/030e5ab894ed576e9e63332c6b08cdda090eade6", "committedDate": "2020-02-23T19:56:56Z", "message": "Add comment to gradle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3434ff4d45bea55ca43fcaecf5bc71323cdeab0b", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/3434ff4d45bea55ca43fcaecf5bc71323cdeab0b", "committedDate": "2020-02-23T19:57:50Z", "message": "Merge branch 'gradle-app-id-suffix' of github.com:Stypox/NewPipe into gradle-app-id-suffix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92f4010e8ee16f0ebebad91e9d217fa20e2e0418", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/92f4010e8ee16f0ebebad91e9d217fa20e2e0418", "committedDate": "2020-03-02T19:50:35Z", "message": "Add more checks to prevent build failures in gradle branch suffix\n\n- Add function `getGitWorkingBranch` that returns the current working branch, and \"\" if it could not be determined (either because git is not installed or because the directory is not a git repo).\n- Make sure normalizedWorkingBranch is not empty (leading to an invalid app id terminating with `.`)\n- Make normalizedWorkingBranch lowercase\n- Add comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMTQ1MzY4", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3133#pullrequestreview-373145368", "createdAt": "2020-03-11T21:41:44Z", "commit": {"oid": "92f4010e8ee16f0ebebad91e9d217fa20e2e0418"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4032, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}