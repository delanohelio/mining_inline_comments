{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4OTY3ODE0", "number": 4154, "title": "Prevent jumping of the player and wrong padding on devices with cutout", "bodyText": "What is it?\n\n Bug fix (user facing)\n\nDescription of the changes in your PR\nOn devices with cutout there is a \"jump\" when you are in multiWindow mode or when you're watching vertical video in fullscreen. This PR fixes that jump (the first commit).\nOn the same devices there is a problem related to top padding on vertical videos in portrait in fullscreen. This is more interesting because a couple hours ago I thought I will not be able to fix it. This problem makes situation when the center of the player is not in the center of the screen. After hours trying I installed the app on my phone and the issue is fixed actually (same Android version but different result). So I have no idea will my method (from the second commit) work on user's devices or not. I think the issue is still here but on devices with non-standard screen ratio. But I don't know how to fix it. You can merge the PR as is or merge only first commit, or drop it.\nIn short:\n\nin multiwindow mode all videos work great\nthere is no jump that happened before when a user shows/hides controls in the player\nthere is a correct padding on top of the player (but I'm sure it isn't on devices with non-standart ratio).\n\nEveryone who has a device with a hole, cutout, whatever check this build in vertical videos in landscape, in portrait, in multi window mode, check non-vertical videos too.\nFixes the following issue(s)\npartially fixes #4040\nTesting apk\napp-release-final.zip\nAgreement\n\n I carefully read the contribution guidelines and agree to them.", "createdAt": "2020-08-17T17:26:16Z", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4154", "merged": true, "mergeCommit": {"oid": "530f745e44a95e74f3587c429805f147ced4e73c"}, "closed": true, "closedAt": "2020-09-08T17:47:10Z", "author": {"login": "avently"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc_2jO0AFqTQ2ODcxNzcyNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdGvd3AAFqTQ4Mzc3OTg3Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4NzE3NzI3", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4154#pullrequestreview-468717727", "createdAt": "2020-08-17T18:16:40Z", "commit": {"oid": "fe90638897ea9dd1573f39797996594359176859"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxODoxNjo0MFrOHB0s5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxODoxNjo0MFrOHB0s5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY3NDA4Ng==", "bodyText": "That looks like it should be in DeviceUtils.", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4154#discussion_r471674086", "createdAt": "2020-08-17T18:16:40Z", "author": {"login": "TobiGr"}, "path": "app/src/main/java/org/schabi/newpipe/player/VideoPlayerImpl.java", "diffHunk": "@@ -1565,6 +1571,20 @@ private int getStatusBarHeight() {\n         return statusBarHeight;\n     }\n \n+    /*\n+    * Compares current status bar height with default status bar height in Android and decides,\n+    * does the device has cutout or not\n+    * */\n+    private boolean hasCutout(final float statusBarHeight) {\n+        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.P) {\n+            final DisplayMetrics metrics = getRootView().getResources().getDisplayMetrics();\n+            final float defaultStatusBarHeight = TypedValue.applyDimension(\n+                    TypedValue.COMPLEX_UNIT_DIP, 25, metrics);\n+            return statusBarHeight > defaultStatusBarHeight;\n+        }\n+        return false;\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe90638897ea9dd1573f39797996594359176859"}, "originalPosition": 76}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8030312924400d73084acb6bc0a7c1874c0e8e56", "author": {"user": {"login": "avently", "name": null}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/8030312924400d73084acb6bc0a7c1874c0e8e56", "committedDate": "2020-09-03T12:48:17Z", "message": "Prevent jumping of the player on devices with cutout"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e833d415e322eb83c65d2f8e9085f35d2ace2dc0", "author": {"user": {"login": "avently", "name": null}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/e833d415e322eb83c65d2f8e9085f35d2ace2dc0", "committedDate": "2020-09-03T12:48:17Z", "message": "Fixed wrong padding on devices with cutout on vertical videos"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8a35e9e4aae29800739a1d2dd470e97e5327df3", "author": {"user": {"login": "avently", "name": null}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/b8a35e9e4aae29800739a1d2dd470e97e5327df3", "committedDate": "2020-09-03T12:48:17Z", "message": "Moved device-specific code into DeviceUtils"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fe90638897ea9dd1573f39797996594359176859", "author": {"user": {"login": "avently", "name": null}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/fe90638897ea9dd1573f39797996594359176859", "committedDate": "2020-08-17T17:18:16Z", "message": "Fixed wrong padding on devices with cutout on vertical videos"}, "afterCommit": {"oid": "b8a35e9e4aae29800739a1d2dd470e97e5327df3", "author": {"user": {"login": "avently", "name": null}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/b8a35e9e4aae29800739a1d2dd470e97e5327df3", "committedDate": "2020-09-03T12:48:17Z", "message": "Moved device-specific code into DeviceUtils"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyMjkxMTM2", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4154#pullrequestreview-482291136", "createdAt": "2020-09-04T00:55:52Z", "commit": {"oid": "b8a35e9e4aae29800739a1d2dd470e97e5327df3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwMDo1NTo1MlrOHM8AWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwMDo1NTo1MlrOHM8AWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyODA5MA==", "bodyText": "Change to the following and it fixes landscape too.\n        // Prevent jumping of the player on devices with cutout\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.P) {\n            if (isLandscape()) {\n                activity.getWindow().getAttributes().layoutInDisplayCutoutMode =\n                        WindowManager.LayoutParams.LAYOUT_IN_DISPLAY_CUTOUT_MODE_SHORT_EDGES;\n            } else {\n                activity.getWindow().getAttributes().layoutInDisplayCutoutMode =\n                        WindowManager.LayoutParams.LAYOUT_IN_DISPLAY_CUTOUT_MODE_NEVER;\n            }\n        }", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4154#discussion_r483328090", "createdAt": "2020-09-04T00:55:52Z", "author": {"login": "blackbox87"}, "path": "app/src/main/java/org/schabi/newpipe/fragments/detail/VideoDetailFragment.java", "diffHunk": "@@ -1995,6 +2000,11 @@ private void hideSystemUi() {\n             return;\n         }\n \n+        // Prevent jumping of the player on devices with cutout\n+        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.P) {\n+            activity.getWindow().getAttributes().layoutInDisplayCutoutMode =\n+                    WindowManager.LayoutParams.LAYOUT_IN_DISPLAY_CUTOUT_MODE_NEVER;\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8a35e9e4aae29800739a1d2dd470e97e5327df3"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzMjk1NDI1", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4154#pullrequestreview-483295425", "createdAt": "2020-09-07T07:14:45Z", "commit": {"oid": "b8a35e9e4aae29800739a1d2dd470e97e5327df3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNzc5ODcz", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4154#pullrequestreview-483779873", "createdAt": "2020-09-08T03:58:56Z", "commit": {"oid": "b8a35e9e4aae29800739a1d2dd470e97e5327df3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4113, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}