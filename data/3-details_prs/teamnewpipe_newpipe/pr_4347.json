{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0NTIzNjU0", "number": 4347, "title": "Player rebind", "bodyText": "What is it?\n\n Bug fix (user facing)\n Feature (user facing)\n\nDescription of the changes in your PR\n\neach time something starts to play in any player VideoDetailFragment will be started (if not yet started) and mini player will show up. It makes possible to see a playing stream in mini player even if the stream was started without using fragment or after player service was closed somehow\nplay/next/queue buttons will be updated in realtime when stream was added/removed from queue instead of waiting for a onPlay/onPause action to happen. It needed when you have opened popup and doing something with queue in background activiry or fragment\nwhen popup or background players start the stream will start playing only if paused state wasn't requested. Which means, for example, if a user opens popup it will be started when START_PAUSED is false. If, for example, the stream was played in main player and then popup was started the stream will still be playing, but if it was paused it still be paused in popup (or background) in APPEND_ONLY mode (but will be playing on new queue initialization). Who read these sentences and understood please tell me where I can learn more about how to use different tenses in such hard way but correctly\nthe play/pause button in mini player will be set as paused once player service dies.\n\nMaybe I missed something since it's quite serious change in logic and may broke other functionality but it works ok for me. Some weak places I already changed. It was something I should do in initial PR but better now than never. I'm sure that other changes to unified player architecture after this PR can be made by someone without deep knowledge of it.\n\nFixes the following issue(s)\n\n#4332 (comment)\n#4332 (comment)\nTesting apk\nrebind.zip\nAgreement\n\n I carefully read the contribution guidelines and agree to them.", "createdAt": "2020-09-29T03:38:48Z", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4347", "merged": true, "mergeCommit": {"oid": "4e7632949d40bf4d061e999f8f21b27dc2b3421f"}, "closed": true, "closedAt": "2020-10-01T13:03:45Z", "author": {"login": "avently"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNfiZsgH2gAyNDk0NTIzNjU0OmMxZDVhNWNkOTg3MTA0YjkzYjhiOTUyYmYzMThjZGUyNGUwMzE0YmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdORC0BAFqTUwMDMyMjk3MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c1d5a5cd987104b93b8b952bf318cde24e0314bb", "author": {"user": {"login": "avently", "name": null}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/c1d5a5cd987104b93b8b952bf318cde24e0314bb", "committedDate": "2020-09-29T03:22:53Z", "message": "Player will be rebound when needed, prev/next/queue buttons, preserving paused state\n- each time something starts to play in any player VideoDetailFragment will be started (if not yet started) and mini player will show up. It makes possible to see a playing stream in mini player even if the stream was started without using fragment or after player service was closed somehow\n- play/next/queue buttons will be updated in realtime when stream was added/removed from queue instead of waiting for a onPlay/onPause action to happen\n- when popup or background players start the stream will start playing only if paused state wasn't requested. Which means, for example, if a user opens popup it will be started when START_PAUSED is false. If, for example, the stream was played in main player and then popup was started the stream will still be playing, but if it was paused it still be paused in popup (or background) in APPEND_ONLY mode (but will be playing on new queue initialization)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NDYzOTU0", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4347#pullrequestreview-498463954", "createdAt": "2020-09-29T13:24:47Z", "commit": {"oid": "c1d5a5cd987104b93b8b952bf318cde24e0314bb"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzoyNDo0N1rOHZs-cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzoyODo0N1rOHZtKSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcxMzMzMQ==", "bodyText": "I'd call this newCollapsedInstance", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4347#discussion_r496713331", "createdAt": "2020-09-29T13:24:47Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/fragments/detail/VideoDetailFragment.java", "diffHunk": "@@ -302,6 +304,12 @@ public static VideoDetailFragment getInstance(final int serviceId, final String\n         return instance;\n     }\n \n+    public static VideoDetailFragment getInstanceCollapsed() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1d5a5cd987104b93b8b952bf318cde24e0314bb"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcxNjM2MA==", "bodyText": "Could you add a comment explaining what this piece of code does?\nIs the following interpretation correct? \"If a player is started when there is no VideoDetailFragment active, the bottom sheet is initialized.\"", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4347#discussion_r496716360", "createdAt": "2020-09-29T13:28:47Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/MainActivity.java", "diffHunk": "@@ -795,9 +802,24 @@ private void handleIntent(final Intent intent) {\n             ErrorActivity.reportUiError(this, e);\n         }\n     }\n-    /*\n-     * Utils\n-     * */\n+\n+    private void setupBroadcastReceiver() {\n+        broadcastReceiver = new BroadcastReceiver() {\n+            @Override\n+            public void onReceive(final Context context, final Intent intent) {\n+                if (intent.getAction().equals(VideoDetailFragment.ACTION_PLAYER_STARTED)) {\n+                    final Fragment fragmentPlayer = getSupportFragmentManager()\n+                            .findFragmentById(R.id.fragment_player_holder);\n+                    if (fragmentPlayer == null) {\n+                        NavigationHelper.showMiniPlayer(getSupportFragmentManager());\n+                    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1d5a5cd987104b93b8b952bf318cde24e0314bb"}, "originalPosition": 53}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6665d630ec7e104e35514e85a0b79376584cda3a", "author": {"user": {"login": "avently", "name": null}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/6665d630ec7e104e35514e85a0b79376584cda3a", "committedDate": "2020-09-29T21:49:34Z", "message": "Added comments and improved the code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4OTUyMTk4", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4347#pullrequestreview-498952198", "createdAt": "2020-09-29T22:26:56Z", "commit": {"oid": "6665d630ec7e104e35514e85a0b79376584cda3a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwMzIyOTcw", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4347#pullrequestreview-500322970", "createdAt": "2020-10-01T13:03:38Z", "commit": {"oid": "6665d630ec7e104e35514e85a0b79376584cda3a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4124, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}