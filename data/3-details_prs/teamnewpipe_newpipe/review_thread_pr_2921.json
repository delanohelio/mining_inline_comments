{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5MjQ2ODU2", "number": 2921, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMTo1Njo0NlrODbMZmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMTo1OTozNFrODbMchw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODQxMzA1OnYy", "diffSide": "RIGHT", "path": "app/src/main/java/org/schabi/newpipe/util/Localization.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMTo1Njo0NlrOFiiZLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxODoyODoyOVrOFiv0UQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc1OTQwNg==", "bodyText": "Is this to differentiate between accents like EN-GB and EN-US? If yes, please add a comment to help others to understand this.", "url": "https://github.com/TeamNewPipe/NewPipe/pull/2921#discussion_r371759406", "createdAt": "2020-01-28T11:56:46Z", "author": {"login": "TobiGr"}, "path": "app/src/main/java/org/schabi/newpipe/util/Localization.java", "diffHunk": "@@ -199,21 +204,41 @@ public static String getDurationString(long duration) {\n     // Pretty Time\n     //////////////////////////////////////////////////////////////////////////*/\n \n-    private static void initPrettyTime() {\n-        prettyTime = new PrettyTime(Locale.getDefault());\n+    private static void initPrettyTime(Context context) {\n+        prettyTime = new PrettyTime(getAppLocale(context));\n         // Do not use decades as YouTube doesn't either.\n         prettyTime.removeUnit(Decade.class);\n     }\n \n     private static PrettyTime getPrettyTime() {\n-        // If pretty time's Locale is different, init again with the new one.\n-        if (!prettyTime.getLocale().equals(Locale.getDefault())) {\n-            initPrettyTime();\n-        }\n         return prettyTime;\n     }\n \n     public static String relativeTime(Calendar calendarTime) {\n         return getPrettyTime().formatUnrounded(calendarTime);\n     }\n+\n+    public static void changeAppLanguage(Locale loc, Resources res) {\n+        DisplayMetrics dm = res.getDisplayMetrics();\n+        Configuration conf = res.getConfiguration();\n+        conf.setLocale(loc);\n+        res.updateConfiguration(conf, dm);\n+    }\n+\n+    public static Locale getAppLocale(Context context) {\n+        SharedPreferences prefs = androidx.preference.PreferenceManager.getDefaultSharedPreferences(context);\n+        String lang = prefs.getString(\"newpipes_language_key\", \"en\");\n+        Locale loc;\n+        if (lang.equals(\"system\")) {\n+            loc = Locale.getDefault();\n+        } else if (lang.matches(\".*-.*\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "156a2eb4ffe7479333536f3195ed3ceee63fa7f1"}, "originalPosition": 94}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTk3OTM0NQ==", "bodyText": "not en-gb and en-us (there is only one form of english in NewPipe and weblate), but pt (portugal) from pt-br (brazil), same for nl and nl-be, chinese\u2026", "url": "https://github.com/TeamNewPipe/NewPipe/pull/2921#discussion_r371979345", "createdAt": "2020-01-28T18:28:29Z", "author": {"login": "B0pol"}, "path": "app/src/main/java/org/schabi/newpipe/util/Localization.java", "diffHunk": "@@ -199,21 +204,41 @@ public static String getDurationString(long duration) {\n     // Pretty Time\n     //////////////////////////////////////////////////////////////////////////*/\n \n-    private static void initPrettyTime() {\n-        prettyTime = new PrettyTime(Locale.getDefault());\n+    private static void initPrettyTime(Context context) {\n+        prettyTime = new PrettyTime(getAppLocale(context));\n         // Do not use decades as YouTube doesn't either.\n         prettyTime.removeUnit(Decade.class);\n     }\n \n     private static PrettyTime getPrettyTime() {\n-        // If pretty time's Locale is different, init again with the new one.\n-        if (!prettyTime.getLocale().equals(Locale.getDefault())) {\n-            initPrettyTime();\n-        }\n         return prettyTime;\n     }\n \n     public static String relativeTime(Calendar calendarTime) {\n         return getPrettyTime().formatUnrounded(calendarTime);\n     }\n+\n+    public static void changeAppLanguage(Locale loc, Resources res) {\n+        DisplayMetrics dm = res.getDisplayMetrics();\n+        Configuration conf = res.getConfiguration();\n+        conf.setLocale(loc);\n+        res.updateConfiguration(conf, dm);\n+    }\n+\n+    public static Locale getAppLocale(Context context) {\n+        SharedPreferences prefs = androidx.preference.PreferenceManager.getDefaultSharedPreferences(context);\n+        String lang = prefs.getString(\"newpipes_language_key\", \"en\");\n+        Locale loc;\n+        if (lang.equals(\"system\")) {\n+            loc = Locale.getDefault();\n+        } else if (lang.matches(\".*-.*\")) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc1OTQwNg=="}, "originalCommit": {"oid": "156a2eb4ffe7479333536f3195ed3ceee63fa7f1"}, "originalPosition": 94}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODQxNDk2OnYy", "diffSide": "RIGHT", "path": "app/src/main/res/values/settings_keys.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMTo1NzozNFrOFiiahg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMTo1NzozNFrOFiiahg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc1OTc1MA==", "bodyText": "maybe app language?", "url": "https://github.com/TeamNewPipe/NewPipe/pull/2921#discussion_r371759750", "createdAt": "2020-01-28T11:57:34Z", "author": {"login": "TobiGr"}, "path": "app/src/main/res/values/settings_keys.xml", "diffHunk": "@@ -175,6 +175,8 @@\n     <string name=\"main_page_content_key\" translatable=\"false\">main_page_content</string>\n     <string name=\"enable_playback_resume_key\" translatable=\"false\">enable_playback_resume</string>\n     <string name=\"enable_playback_state_lists_key\" translatable=\"false\">enable_playback_state_lists</string>\n+\n+    <string name=\"newpipes_language_key\" translatable=\"false\">newpipes_language_key</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "156a2eb4ffe7479333536f3195ed3ceee63fa7f1"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODQxNzE5OnYy", "diffSide": "RIGHT", "path": "app/src/main/res/values/settings_keys.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMTo1ODoyNFrOFiib4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMTo1ODoyNFrOFiib4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc2MDA5Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                <!--The next two arrays are set to change the NewPipe language-->\n          \n          \n            \n                <!--The next two arrays are set to change the app language-->", "url": "https://github.com/TeamNewPipe/NewPipe/pull/2921#discussion_r371760096", "createdAt": "2020-01-28T11:58:24Z", "author": {"login": "TobiGr"}, "path": "app/src/main/res/values/settings_keys.xml", "diffHunk": "@@ -924,6 +926,138 @@\n         <item>ZW</item>\n     </string-array>\n \n+    <!--The next two arrays are set to change the NewPipe language-->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "156a2eb4ffe7479333536f3195ed3ceee63fa7f1"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODQxOTQ5OnYy", "diffSide": "RIGHT", "path": "app/src/main/res/values/strings.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMTo1OToxMVrOFiidTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMTo1OToxMVrOFiidTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc2MDQ2Mg==", "bodyText": "Maybe system default?", "url": "https://github.com/TeamNewPipe/NewPipe/pull/2921#discussion_r371760462", "createdAt": "2020-01-28T11:59:11Z", "author": {"login": "TobiGr"}, "path": "app/src/main/res/values/strings.xml", "diffHunk": "@@ -589,4 +589,6 @@\n     <string name=\"downloads_storage_use_saf_title\">Use SAF</string>\n     <string name=\"downloads_storage_use_saf_summary\">The Storage Access Framework allows downloads to an external SD card.\\nNote: some devices are not compatible</string>\n     <string name=\"choose_instance_prompt\">Choose an instance</string>\n+    <string name=\"newpipes_language_title\">NewPipe\\'s language</string>\n+    <string name=\"systems_language\">System\\'s language</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "156a2eb4ffe7479333536f3195ed3ceee63fa7f1"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODQyMDU1OnYy", "diffSide": "RIGHT", "path": "app/src/main/res/values/strings.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMTo1OTozNFrOFiid6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMTo1OTozNFrOFiid6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc2MDYxOQ==", "bodyText": "Display / app language", "url": "https://github.com/TeamNewPipe/NewPipe/pull/2921#discussion_r371760619", "createdAt": "2020-01-28T11:59:34Z", "author": {"login": "TobiGr"}, "path": "app/src/main/res/values/strings.xml", "diffHunk": "@@ -589,4 +589,6 @@\n     <string name=\"downloads_storage_use_saf_title\">Use SAF</string>\n     <string name=\"downloads_storage_use_saf_summary\">The Storage Access Framework allows downloads to an external SD card.\\nNote: some devices are not compatible</string>\n     <string name=\"choose_instance_prompt\">Choose an instance</string>\n+    <string name=\"newpipes_language_title\">NewPipe\\'s language</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "156a2eb4ffe7479333536f3195ed3ceee63fa7f1"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3227, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}