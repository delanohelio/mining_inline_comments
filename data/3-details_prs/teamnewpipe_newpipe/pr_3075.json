{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczNDg0MjQ5", "number": 3075, "title": "Better popup resizing with pinch gestures", "bodyText": "I carefully read the contribution guidelines and agree to them.\n\nThe current popup window does resize with pinch gestures, but it's a bit weird. It resizes to the distance between the 2 fingers, and changes its position to one of the fingers. I changed it so that the window size scales to the pinch-in/out gesture and stays in the same position.\nFixes #515 fixes #2880 fixes #2918\nAPK:\napp-debug.zip", "createdAt": "2020-02-11T05:45:40Z", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3075", "merged": true, "mergeCommit": {"oid": "feab633e60fc18cd437b14966cafd2994a9e7511"}, "closed": true, "closedAt": "2020-04-10T20:27:00Z", "author": {"login": "harshlele"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKISvTAFqTM2ODI5MjYwMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcWW_BjAFqTM5MTY0MDYwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MjkyNjAw", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3075#pullrequestreview-368292600", "createdAt": "2020-03-03T20:15:54Z", "commit": {"oid": "b68f76474dc0e57f4e90017893b50c611257c256"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMDoxNTo1NVrOFxVABQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMDoyNDozNVrOFxVQhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzI2ODYxMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    secPointerMoveX > scaledTouchSlop || secPointerMoveY > scaledTouchSlop){\n          \n          \n            \n                                    secPointerMoveX > scaledTouchSlop || secPointerMoveY > scaledTouchSlop) {", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3075#discussion_r387268613", "createdAt": "2020-03-03T20:15:55Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/player/PopupVideoPlayer.java", "diffHunk": "@@ -1082,25 +1106,52 @@ public boolean onTouch(View v, MotionEvent event) {\n         private boolean handleMultiDrag(final MotionEvent event) {\n             if (event.getPointerCount() != 2) return false;\n \n-            final float firstPointerX = event.getX(0);\n-            final float secondPointerX = event.getX(1);\n+            if(initPointerDistance != -1){\n \n-            final float diff = Math.abs(firstPointerX - secondPointerX);\n-            if (firstPointerX > secondPointerX) {\n-                // second pointer is the anchor (the leftmost pointer)\n-                popupLayoutParams.x = (int) (event.getRawX() - diff);\n-            } else {\n-                // first pointer is the anchor\n-                popupLayoutParams.x = (int) event.getRawX();\n-            }\n+                //get the movements of the fingers\n+                float firstPointerMoveX = event.getX(0) - initFirstPointerX;\n+                float firstPointerMoveY = event.getY(0) - initFirstPointerY;\n+                float secPointerMoveX = event.getX(1) - initSecPointerX;\n+                float secPointerMoveY = event.getY(1) - initSecPointerY;\n+                //minimum threshold beyond which pinch gesture will work\n+                int scaledTouchSlop = ViewConfiguration.get(PopupVideoPlayer.this).getScaledTouchSlop();\n \n-            checkPopupPositionBounds();\n-            updateScreenSize();\n+                if(firstPointerMoveX > scaledTouchSlop ||firstPointerMoveY > scaledTouchSlop ||\n+                        secPointerMoveX > scaledTouchSlop || secPointerMoveY > scaledTouchSlop){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b68f76474dc0e57f4e90017893b50c611257c256"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzI2ODcxMw==", "bodyText": "This is algebraically equal to:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                double scale = 1 + (currentPointerDistance - initPointerDistance)/ initPointerDistance;\n          \n          \n            \n                                double scale = currentPointerDistance / initPointerDistance;", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3075#discussion_r387268713", "createdAt": "2020-03-03T20:16:08Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/player/PopupVideoPlayer.java", "diffHunk": "@@ -1082,25 +1106,52 @@ public boolean onTouch(View v, MotionEvent event) {\n         private boolean handleMultiDrag(final MotionEvent event) {\n             if (event.getPointerCount() != 2) return false;\n \n-            final float firstPointerX = event.getX(0);\n-            final float secondPointerX = event.getX(1);\n+            if(initPointerDistance != -1){\n \n-            final float diff = Math.abs(firstPointerX - secondPointerX);\n-            if (firstPointerX > secondPointerX) {\n-                // second pointer is the anchor (the leftmost pointer)\n-                popupLayoutParams.x = (int) (event.getRawX() - diff);\n-            } else {\n-                // first pointer is the anchor\n-                popupLayoutParams.x = (int) event.getRawX();\n-            }\n+                //get the movements of the fingers\n+                float firstPointerMoveX = event.getX(0) - initFirstPointerX;\n+                float firstPointerMoveY = event.getY(0) - initFirstPointerY;\n+                float secPointerMoveX = event.getX(1) - initSecPointerX;\n+                float secPointerMoveY = event.getY(1) - initSecPointerY;\n+                //minimum threshold beyond which pinch gesture will work\n+                int scaledTouchSlop = ViewConfiguration.get(PopupVideoPlayer.this).getScaledTouchSlop();\n \n-            checkPopupPositionBounds();\n-            updateScreenSize();\n+                if(firstPointerMoveX > scaledTouchSlop ||firstPointerMoveY > scaledTouchSlop ||\n+                        secPointerMoveX > scaledTouchSlop || secPointerMoveY > scaledTouchSlop){\n \n-            final int width = (int) Math.min(screenWidth, diff);\n-            updatePopupSize(width, -1);\n+                    double newWidth = popupWidth;\n \n-            return true;\n+                    //calculate current distance between the pointers\n+                    float currentXDiff = event.getX(0) - event.getX(1);\n+                    float currentYDiff = event.getY(0) - event.getY(1);\n+                    double currentPointerDistance = Math.sqrt(currentXDiff * currentXDiff + currentYDiff * currentYDiff);\n+\n+                    //scale popup width\n+                    double scale = 1 + (currentPointerDistance - initPointerDistance)/ initPointerDistance;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b68f76474dc0e57f4e90017893b50c611257c256"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzI3MTY3MQ==", "bodyText": "This piece is also algebraically equal to:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                if(currentPointerDistance > initPointerDistance){\n          \n          \n            \n                                    popupLayoutParams.x -= (newWidth - popupWidth)/2;\n          \n          \n            \n                                }\n          \n          \n            \n                                else{\n          \n          \n            \n                                    popupLayoutParams.x += (popupWidth - newWidth)/2;\n          \n          \n            \n                                }\n          \n          \n            \n                                popupLayoutParams.x += (popupWidth - newWidth) / 2;\n          \n      \n    \n    \n  \n\nAlso, shouldn't you first normalize newWidth (i.e. doing newWidth = (int) Math.min(screenWidth, newWidth);)? Otherwise the popup center would be moved around when at full size. Or do the checkPopupPositionBounds(); and updateScreenSize(); functions prevent this?", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3075#discussion_r387271671", "createdAt": "2020-03-03T20:22:04Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/player/PopupVideoPlayer.java", "diffHunk": "@@ -1082,25 +1106,52 @@ public boolean onTouch(View v, MotionEvent event) {\n         private boolean handleMultiDrag(final MotionEvent event) {\n             if (event.getPointerCount() != 2) return false;\n \n-            final float firstPointerX = event.getX(0);\n-            final float secondPointerX = event.getX(1);\n+            if(initPointerDistance != -1){\n \n-            final float diff = Math.abs(firstPointerX - secondPointerX);\n-            if (firstPointerX > secondPointerX) {\n-                // second pointer is the anchor (the leftmost pointer)\n-                popupLayoutParams.x = (int) (event.getRawX() - diff);\n-            } else {\n-                // first pointer is the anchor\n-                popupLayoutParams.x = (int) event.getRawX();\n-            }\n+                //get the movements of the fingers\n+                float firstPointerMoveX = event.getX(0) - initFirstPointerX;\n+                float firstPointerMoveY = event.getY(0) - initFirstPointerY;\n+                float secPointerMoveX = event.getX(1) - initSecPointerX;\n+                float secPointerMoveY = event.getY(1) - initSecPointerY;\n+                //minimum threshold beyond which pinch gesture will work\n+                int scaledTouchSlop = ViewConfiguration.get(PopupVideoPlayer.this).getScaledTouchSlop();\n \n-            checkPopupPositionBounds();\n-            updateScreenSize();\n+                if(firstPointerMoveX > scaledTouchSlop ||firstPointerMoveY > scaledTouchSlop ||\n+                        secPointerMoveX > scaledTouchSlop || secPointerMoveY > scaledTouchSlop){\n \n-            final int width = (int) Math.min(screenWidth, diff);\n-            updatePopupSize(width, -1);\n+                    double newWidth = popupWidth;\n \n-            return true;\n+                    //calculate current distance between the pointers\n+                    float currentXDiff = event.getX(0) - event.getX(1);\n+                    float currentYDiff = event.getY(0) - event.getY(1);\n+                    double currentPointerDistance = Math.sqrt(currentXDiff * currentXDiff + currentYDiff * currentYDiff);\n+\n+                    //scale popup width\n+                    double scale = 1 + (currentPointerDistance - initPointerDistance)/ initPointerDistance;\n+\n+                    newWidth = (popupWidth * scale);\n+\n+                    //change co-ordinates of popup so the center stays at the same position\n+                    if(currentPointerDistance > initPointerDistance){\n+                        popupLayoutParams.x -= (newWidth - popupWidth)/2;\n+                    }\n+                    else{\n+                        popupLayoutParams.x += (popupWidth - newWidth)/2;\n+                    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b68f76474dc0e57f4e90017893b50c611257c256"}, "originalPosition": 102}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzI3MjY1MA==", "bodyText": "There is the Java Math.hypot() function that does exactly this\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                float currentXDiff = event.getX(0) - event.getX(1);\n          \n          \n            \n                                float currentYDiff = event.getY(0) - event.getY(1);\n          \n          \n            \n                                double currentPointerDistance = Math.sqrt(currentXDiff * currentXDiff + currentYDiff * currentYDiff);\n          \n          \n            \n                                double currentPointerDistance = Math.hypot(event.getX(0) - event.getX(1), event.getY(0) - event.getY(1));", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3075#discussion_r387272650", "createdAt": "2020-03-03T20:24:14Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/player/PopupVideoPlayer.java", "diffHunk": "@@ -1082,25 +1106,52 @@ public boolean onTouch(View v, MotionEvent event) {\n         private boolean handleMultiDrag(final MotionEvent event) {\n             if (event.getPointerCount() != 2) return false;\n \n-            final float firstPointerX = event.getX(0);\n-            final float secondPointerX = event.getX(1);\n+            if(initPointerDistance != -1){\n \n-            final float diff = Math.abs(firstPointerX - secondPointerX);\n-            if (firstPointerX > secondPointerX) {\n-                // second pointer is the anchor (the leftmost pointer)\n-                popupLayoutParams.x = (int) (event.getRawX() - diff);\n-            } else {\n-                // first pointer is the anchor\n-                popupLayoutParams.x = (int) event.getRawX();\n-            }\n+                //get the movements of the fingers\n+                float firstPointerMoveX = event.getX(0) - initFirstPointerX;\n+                float firstPointerMoveY = event.getY(0) - initFirstPointerY;\n+                float secPointerMoveX = event.getX(1) - initSecPointerX;\n+                float secPointerMoveY = event.getY(1) - initSecPointerY;\n+                //minimum threshold beyond which pinch gesture will work\n+                int scaledTouchSlop = ViewConfiguration.get(PopupVideoPlayer.this).getScaledTouchSlop();\n \n-            checkPopupPositionBounds();\n-            updateScreenSize();\n+                if(firstPointerMoveX > scaledTouchSlop ||firstPointerMoveY > scaledTouchSlop ||\n+                        secPointerMoveX > scaledTouchSlop || secPointerMoveY > scaledTouchSlop){\n \n-            final int width = (int) Math.min(screenWidth, diff);\n-            updatePopupSize(width, -1);\n+                    double newWidth = popupWidth;\n \n-            return true;\n+                    //calculate current distance between the pointers\n+                    float currentXDiff = event.getX(0) - event.getX(1);\n+                    float currentYDiff = event.getY(0) - event.getY(1);\n+                    double currentPointerDistance = Math.sqrt(currentXDiff * currentXDiff + currentYDiff * currentYDiff);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b68f76474dc0e57f4e90017893b50c611257c256"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzI3MjgzOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                }\n          \n          \n            \n                                else{\n          \n          \n            \n                                } else {", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3075#discussion_r387272839", "createdAt": "2020-03-03T20:24:35Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/player/PopupVideoPlayer.java", "diffHunk": "@@ -1082,25 +1106,52 @@ public boolean onTouch(View v, MotionEvent event) {\n         private boolean handleMultiDrag(final MotionEvent event) {\n             if (event.getPointerCount() != 2) return false;\n \n-            final float firstPointerX = event.getX(0);\n-            final float secondPointerX = event.getX(1);\n+            if(initPointerDistance != -1){\n \n-            final float diff = Math.abs(firstPointerX - secondPointerX);\n-            if (firstPointerX > secondPointerX) {\n-                // second pointer is the anchor (the leftmost pointer)\n-                popupLayoutParams.x = (int) (event.getRawX() - diff);\n-            } else {\n-                // first pointer is the anchor\n-                popupLayoutParams.x = (int) event.getRawX();\n-            }\n+                //get the movements of the fingers\n+                float firstPointerMoveX = event.getX(0) - initFirstPointerX;\n+                float firstPointerMoveY = event.getY(0) - initFirstPointerY;\n+                float secPointerMoveX = event.getX(1) - initSecPointerX;\n+                float secPointerMoveY = event.getY(1) - initSecPointerY;\n+                //minimum threshold beyond which pinch gesture will work\n+                int scaledTouchSlop = ViewConfiguration.get(PopupVideoPlayer.this).getScaledTouchSlop();\n \n-            checkPopupPositionBounds();\n-            updateScreenSize();\n+                if(firstPointerMoveX > scaledTouchSlop ||firstPointerMoveY > scaledTouchSlop ||\n+                        secPointerMoveX > scaledTouchSlop || secPointerMoveY > scaledTouchSlop){\n \n-            final int width = (int) Math.min(screenWidth, diff);\n-            updatePopupSize(width, -1);\n+                    double newWidth = popupWidth;\n \n-            return true;\n+                    //calculate current distance between the pointers\n+                    float currentXDiff = event.getX(0) - event.getX(1);\n+                    float currentYDiff = event.getY(0) - event.getY(1);\n+                    double currentPointerDistance = Math.sqrt(currentXDiff * currentXDiff + currentYDiff * currentYDiff);\n+\n+                    //scale popup width\n+                    double scale = 1 + (currentPointerDistance - initPointerDistance)/ initPointerDistance;\n+\n+                    newWidth = (popupWidth * scale);\n+\n+                    //change co-ordinates of popup so the center stays at the same position\n+                    if(currentPointerDistance > initPointerDistance){\n+                        popupLayoutParams.x -= (newWidth - popupWidth)/2;\n+                    }\n+                    else{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b68f76474dc0e57f4e90017893b50c611257c256"}, "originalPosition": 100}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwODE1Mzcy", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3075#pullrequestreview-370815372", "createdAt": "2020-03-08T09:11:27Z", "commit": {"oid": "1871a2c27271913e77c8ddb526ba095d9af10d68"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQwOToxMToyN1rOFzUDqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQwOToxMTozOVrOFzUDxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM1MDMxNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            if(firstPointerMoveX > scaledTouchSlop ||firstPointerMoveY > scaledTouchSlop ||\n          \n          \n            \n                                    secPointerMoveX > scaledTouchSlop || secPointerMoveY > scaledTouchSlop) {\n          \n          \n            \n                            if (firstPointerMoveX > scaledTouchSlop || firstPointerMoveY > scaledTouchSlop\n          \n          \n            \n                                    || secPointerMoveX > scaledTouchSlop || secPointerMoveY > scaledTouchSlop) {", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3075#discussion_r389350314", "createdAt": "2020-03-08T09:11:27Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/player/PopupVideoPlayer.java", "diffHunk": "@@ -1082,25 +1105,47 @@ public boolean onTouch(View v, MotionEvent event) {\n         private boolean handleMultiDrag(final MotionEvent event) {\n             if (event.getPointerCount() != 2) return false;\n \n-            final float firstPointerX = event.getX(0);\n-            final float secondPointerX = event.getX(1);\n+            if(initPointerDistance != -1){\n \n-            final float diff = Math.abs(firstPointerX - secondPointerX);\n-            if (firstPointerX > secondPointerX) {\n-                // second pointer is the anchor (the leftmost pointer)\n-                popupLayoutParams.x = (int) (event.getRawX() - diff);\n-            } else {\n-                // first pointer is the anchor\n-                popupLayoutParams.x = (int) event.getRawX();\n-            }\n+                //get the movements of the fingers\n+                float firstPointerMoveX = event.getX(0) - initFirstPointerX;\n+                float firstPointerMoveY = event.getY(0) - initFirstPointerY;\n+                float secPointerMoveX = event.getX(1) - initSecPointerX;\n+                float secPointerMoveY = event.getY(1) - initSecPointerY;\n+                //minimum threshold beyond which pinch gesture will work\n+                int scaledTouchSlop = ViewConfiguration.get(PopupVideoPlayer.this).getScaledTouchSlop();\n \n-            checkPopupPositionBounds();\n-            updateScreenSize();\n+                if(firstPointerMoveX > scaledTouchSlop ||firstPointerMoveY > scaledTouchSlop ||\n+                        secPointerMoveX > scaledTouchSlop || secPointerMoveY > scaledTouchSlop) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1871a2c27271913e77c8ddb526ba095d9af10d68"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM1MDM0MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if(initPointerDistance != -1){\n          \n          \n            \n                        if (initPointerDistance != -1) {", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3075#discussion_r389350341", "createdAt": "2020-03-08T09:11:39Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/player/PopupVideoPlayer.java", "diffHunk": "@@ -1082,25 +1105,47 @@ public boolean onTouch(View v, MotionEvent event) {\n         private boolean handleMultiDrag(final MotionEvent event) {\n             if (event.getPointerCount() != 2) return false;\n \n-            final float firstPointerX = event.getX(0);\n-            final float secondPointerX = event.getX(1);\n+            if(initPointerDistance != -1){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1871a2c27271913e77c8ddb526ba095d9af10d68"}, "originalPosition": 57}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NjczNzUy", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3075#pullrequestreview-387673752", "createdAt": "2020-04-04T06:44:45Z", "commit": {"oid": "2e59ed9a67f6f7cb761c646c7a2f934cb2aaf297"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNFQwNjo0NDo0NVrOGAvqjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNFQwNjo0NTozNlrOGAvq1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQzNDEyNg==", "bodyText": "Remove the double newWidth = popupWidth; declaration above and put it directly here:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                newWidth = (popupWidth * scale);\n          \n          \n            \n                                double newWidth = popupWidth * scale;", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3075#discussion_r403434126", "createdAt": "2020-04-04T06:44:45Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/player/PopupVideoPlayer.java", "diffHunk": "@@ -1082,25 +1105,47 @@ public boolean onTouch(View v, MotionEvent event) {\n         private boolean handleMultiDrag(final MotionEvent event) {\n             if (event.getPointerCount() != 2) return false;\n \n-            final float firstPointerX = event.getX(0);\n-            final float secondPointerX = event.getX(1);\n+            if (initPointerDistance != -1) {\n \n-            final float diff = Math.abs(firstPointerX - secondPointerX);\n-            if (firstPointerX > secondPointerX) {\n-                // second pointer is the anchor (the leftmost pointer)\n-                popupLayoutParams.x = (int) (event.getRawX() - diff);\n-            } else {\n-                // first pointer is the anchor\n-                popupLayoutParams.x = (int) event.getRawX();\n-            }\n+                //get the movements of the fingers\n+                float firstPointerMoveX = event.getX(0) - initFirstPointerX;\n+                float firstPointerMoveY = event.getY(0) - initFirstPointerY;\n+                float secPointerMoveX = event.getX(1) - initSecPointerX;\n+                float secPointerMoveY = event.getY(1) - initSecPointerY;\n+                //minimum threshold beyond which pinch gesture will work\n+                int scaledTouchSlop = ViewConfiguration.get(PopupVideoPlayer.this).getScaledTouchSlop();\n \n-            checkPopupPositionBounds();\n-            updateScreenSize();\n+                if (firstPointerMoveX > scaledTouchSlop ||firstPointerMoveY > scaledTouchSlop\n+                        || secPointerMoveX > scaledTouchSlop || secPointerMoveY > scaledTouchSlop) {\n \n-            final int width = (int) Math.min(screenWidth, diff);\n-            updatePopupSize(width, -1);\n+                    double newWidth = popupWidth;\n \n-            return true;\n+                    //calculate current distance between the pointers\n+                    double currentPointerDistance = Math.hypot(event.getX(0) - event.getX(1),\n+                                                                event.getY(0) - event.getY(1));\n+\n+                    //scale popup width\n+                    double scale = currentPointerDistance / initPointerDistance;\n+\n+                    newWidth = (popupWidth * scale);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e59ed9a67f6f7cb761c646c7a2f934cb2aaf297"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQzNDE5OA==", "bodyText": "Also remove some of these spaces and group similar/related statements toghether, to enhance readability", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3075#discussion_r403434198", "createdAt": "2020-04-04T06:45:36Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/player/PopupVideoPlayer.java", "diffHunk": "@@ -1082,25 +1105,47 @@ public boolean onTouch(View v, MotionEvent event) {\n         private boolean handleMultiDrag(final MotionEvent event) {\n             if (event.getPointerCount() != 2) return false;\n \n-            final float firstPointerX = event.getX(0);\n-            final float secondPointerX = event.getX(1);\n+            if (initPointerDistance != -1) {\n \n-            final float diff = Math.abs(firstPointerX - secondPointerX);\n-            if (firstPointerX > secondPointerX) {\n-                // second pointer is the anchor (the leftmost pointer)\n-                popupLayoutParams.x = (int) (event.getRawX() - diff);\n-            } else {\n-                // first pointer is the anchor\n-                popupLayoutParams.x = (int) event.getRawX();\n-            }\n+                //get the movements of the fingers\n+                float firstPointerMoveX = event.getX(0) - initFirstPointerX;\n+                float firstPointerMoveY = event.getY(0) - initFirstPointerY;\n+                float secPointerMoveX = event.getX(1) - initSecPointerX;\n+                float secPointerMoveY = event.getY(1) - initSecPointerY;\n+                //minimum threshold beyond which pinch gesture will work\n+                int scaledTouchSlop = ViewConfiguration.get(PopupVideoPlayer.this).getScaledTouchSlop();\n \n-            checkPopupPositionBounds();\n-            updateScreenSize();\n+                if (firstPointerMoveX > scaledTouchSlop ||firstPointerMoveY > scaledTouchSlop\n+                        || secPointerMoveX > scaledTouchSlop || secPointerMoveY > scaledTouchSlop) {\n \n-            final int width = (int) Math.min(screenWidth, diff);\n-            updatePopupSize(width, -1);\n+                    double newWidth = popupWidth;\n \n-            return true;\n+                    //calculate current distance between the pointers\n+                    double currentPointerDistance = Math.hypot(event.getX(0) - event.getX(1),\n+                                                                event.getY(0) - event.getY(1));\n+\n+                    //scale popup width\n+                    double scale = currentPointerDistance / initPointerDistance;\n+\n+                    newWidth = (popupWidth * scale);\n+\n+                    //change co-ordinates of popup so the center stays at the same position\n+                    popupLayoutParams.x += (popupWidth - newWidth)/2;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e59ed9a67f6f7cb761c646c7a2f934cb2aaf297"}, "originalPosition": 96}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9487b5367d4f3cf1a78ffca34ca9024ef55c8f71", "author": {"user": {"login": "harshlele", "name": null}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/9487b5367d4f3cf1a78ffca34ca9024ef55c8f71", "committedDate": "2020-04-10T20:10:32Z", "message": "changed popup resizing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe1889653e98b7fb55d24b03f9d4903e26b82278", "author": {"user": {"login": "harshlele", "name": null}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/fe1889653e98b7fb55d24b03f9d4903e26b82278", "committedDate": "2020-04-10T20:10:32Z", "message": "made formatting changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46918ee9079f22e19b32f119fb6d454043f4efcc", "author": {"user": {"login": "harshlele", "name": null}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/46918ee9079f22e19b32f119fb6d454043f4efcc", "committedDate": "2020-04-10T20:10:32Z", "message": "formatting changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a50e430cd96ae508a66755678f21b318d00127f8", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/a50e430cd96ae508a66755678f21b318d00127f8", "committedDate": "2020-04-10T20:12:45Z", "message": "Fix checkstyle issues and improve code formatting\n\nAlso calculate differently the moved distance of a pointer: use euclidean and not manhattan geometry"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2e59ed9a67f6f7cb761c646c7a2f934cb2aaf297", "author": {"user": {"login": "harshlele", "name": null}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/2e59ed9a67f6f7cb761c646c7a2f934cb2aaf297", "committedDate": "2020-03-09T17:56:35Z", "message": "formatting changes"}, "afterCommit": {"oid": "a50e430cd96ae508a66755678f21b318d00127f8", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/a50e430cd96ae508a66755678f21b318d00127f8", "committedDate": "2020-04-10T20:12:45Z", "message": "Fix checkstyle issues and improve code formatting\n\nAlso calculate differently the moved distance of a pointer: use euclidean and not manhattan geometry"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxNjQwNjAy", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3075#pullrequestreview-391640602", "createdAt": "2020-04-10T20:19:11Z", "commit": {"oid": "a50e430cd96ae508a66755678f21b318d00127f8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4022, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}