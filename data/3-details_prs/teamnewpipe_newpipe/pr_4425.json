{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4NTIyNzg5", "number": 4425, "title": "Replace specific enqueue options with one", "bodyText": "What is it?\n\n Bug fix (user facing)\n Feature (user facing)\n Code base improvement (dev facing)\n Meta improvement to the project (dev facing)\n\nDescription of the changes in your PR\n\nThis PR replaces the enqueue options within the StreamDialogEntry-dialogs with one.\nDev:\n\nAdded static method to PlayerHolder to determine the current running PlayerType (VIDEO, AUDIO, POPUP).\nAdded new entry enqueue which automatically checks which type is running and enqueues the stream accordingly to the right player.\nAdjustments to showStreamDialog (see more in User)\nRemoved unused StreamDialogEntry items and their strings.\nSet generic Toast message for all three types (needs to be translated).\n\nUser:\nIf there is no player playing a stream, then the options for queuing won't be shown - there is no need for them, in this case it's the same as start playing in background/popup.\nBut If there is a stream playing then there'll be the entry Enqueue which enqueues the next stream without interrupting the current flow.\nI hope the behavior is what you've expected @TobiGr\nFixes the following issue(s)\n\n\n#4380\n\nTesting apk\n\napp-debug-2.zip\nAgreement\n\n I carefully read the contribution guidelines and agree to them.", "createdAt": "2020-10-06T12:55:41Z", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4425", "merged": true, "mergeCommit": {"oid": "44e82217c1eff8f182ef373cf612ee69a7762562"}, "closed": true, "closedAt": "2020-10-06T20:37:19Z", "author": {"login": "vkay94"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdP2wTcAH2gAyNDk4NTIyNzg5OmNkNTE1OTkzZjVlZTQ3ZWRkMTdhYTczN2I1MzdhYjNjNjE0YjY3MWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdP9j4ZAFqTUwMzI5MTM1Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cd515993f5ee47edd17aa737b537ab3c614b671d", "author": {"user": {"login": "vkay94", "name": "Viktor K"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/cd515993f5ee47edd17aa737b537ab3c614b671d", "committedDate": "2020-10-06T11:33:44Z", "message": "Enqueue: Add auto-select StreamDialogEntry for current PlayerType"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed6fc4d848ba113c1087ca453541af08752e4316", "author": {"user": {"login": "vkay94", "name": "Viktor K"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/ed6fc4d848ba113c1087ca453541af08752e4316", "committedDate": "2020-10-06T12:38:48Z", "message": "Enqueue: Replaced specific StreamDialogEntry items with one\n\nThe enqueue options won't be shown in the dialogs if the Player service is not running. When it's running one item (enqueue stream) will be shown and enqueues the item into the Player type which is currently selected."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyOTE1MjE1", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4425#pullrequestreview-502915215", "createdAt": "2020-10-06T13:03:17Z", "commit": {"oid": "ed6fc4d848ba113c1087ca453541af08752e4316"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMzowMzoxN1rOHdFR-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMzowMzoxN1rOHdFR-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDI1NzI3Mw==", "bodyText": "br br?", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4425#discussion_r500257273", "createdAt": "2020-10-06T13:03:17Z", "author": {"login": "opusforlife2"}, "path": "app/src/main/java/org/schabi/newpipe/util/StreamDialogEntry.java", "diffHunk": "@@ -1,21 +1,61 @@\n package org.schabi.newpipe.util;\n \n import android.content.Context;\n+import android.widget.Toast;\n \n import androidx.fragment.app.Fragment;\n \n import org.schabi.newpipe.R;\n import org.schabi.newpipe.extractor.stream.StreamInfoItem;\n import org.schabi.newpipe.local.dialog.PlaylistAppendDialog;\n+import org.schabi.newpipe.player.MainPlayer;\n+import org.schabi.newpipe.player.helper.PlayerHolder;\n import org.schabi.newpipe.player.playqueue.SinglePlayQueue;\n \n+import java.util.ArrayList;\n import java.util.Collections;\n \n public enum StreamDialogEntry {\n     //////////////////////////////////////\n     // enum values with DEFAULT actions //\n     //////////////////////////////////////\n \n+    /**\n+     * Enqueues the stream automatically to the current PlayerType.<br>\n+     * <br>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed6fc4d848ba113c1087ca453541af08752e4316"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyOTY5NTM0", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4425#pullrequestreview-502969534", "createdAt": "2020-10-06T13:36:34Z", "commit": {"oid": "ed6fc4d848ba113c1087ca453541af08752e4316"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMzozNjozNFrOHdG1tg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMzo0NjoyN1rOHdHaTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDI4MjgwNg==", "bodyText": "Add a method to VideoPlayerImpl that just returns the playerType field", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4425#discussion_r500282806", "createdAt": "2020-10-06T13:36:34Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/player/helper/PlayerHolder.java", "diffHunk": "@@ -31,6 +35,24 @@ private PlayerHolder() {\n     private static MainPlayer playerService;\n     private static VideoPlayerImpl player;\n \n+    /**\n+     * Returns the current {@link MainPlayer.PlayerType} of the {@link MainPlayer} service,\n+     * otherwise `null` if no service running.\n+     *\n+     * @return Current PlayerType\n+     */\n+    @Nullable\n+    public static MainPlayer.PlayerType getType() {\n+        if (player == null) {\n+            return null;\n+        }\n+\n+        return player.videoPlayerSelected() ? MainPlayer.PlayerType.VIDEO\n+                : player.popupPlayerSelected() ? MainPlayer.PlayerType.POPUP\n+                : player.audioPlayerSelected() ? MainPlayer.PlayerType.AUDIO\n+                : null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed6fc4d848ba113c1087ca453541af08752e4316"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDI4OTMzNw==", "bodyText": "I think you can replace this part with something like this, and call it a day. As you said the type can never theoretically be null or an invalid value, so we can just include that impossible situation into the condition for opening the main video player (enqueueing when there is no player does not raise errors, but just opens that player).\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (type == null) {\n          \n          \n            \n                        // This code shouldn't be reached since the checks for appending this entry should be\n          \n          \n            \n                        // done within the showStreamDialog calls.\n          \n          \n            \n                        Toast.makeText(fragment.getContext(),\n          \n          \n            \n                                \"No player currently playing\", Toast.LENGTH_SHORT).show();\n          \n          \n            \n                        return;\n          \n          \n            \n                    }\n          \n          \n            \n                    switch (type) {\n          \n          \n            \n                        case AUDIO:\n          \n          \n            \n                            NavigationHelper.enqueueOnBackgroundPlayer(fragment.getContext(),\n          \n          \n            \n                                    new SinglePlayQueue(item), false);\n          \n          \n            \n                            break;\n          \n          \n            \n                        case POPUP:\n          \n          \n            \n                            NavigationHelper.enqueueOnPopupPlayer(fragment.getContext(),\n          \n          \n            \n                                    new SinglePlayQueue(item), false);\n          \n          \n            \n                            break;\n          \n          \n            \n                        case VIDEO:\n          \n          \n            \n                            NavigationHelper.enqueueOnVideoPlayer(fragment.getContext(),\n          \n          \n            \n                                    new SinglePlayQueue(item), false);\n          \n          \n            \n                            break;\n          \n          \n            \n                        default:\n          \n          \n            \n                            // Same as above, but keep it for now for debugging.\n          \n          \n            \n                            Toast.makeText(fragment.getContext(),\n          \n          \n            \n                                    \"Unreachable code executed\", Toast.LENGTH_SHORT).show();\n          \n          \n            \n                            break;\n          \n          \n            \n                    }\n          \n          \n            \n                    if (type == AUDIO) {\n          \n          \n            \n                        NavigationHelper.enqueueOnBackgroundPlayer(fragment.getContext(),\n          \n          \n            \n                                new SinglePlayQueue(item), false);\n          \n          \n            \n                    } else if (type == POPUP) {\n          \n          \n            \n                        NavigationHelper.enqueueOnPopupPlayer(fragment.getContext(),\n          \n          \n            \n                                new SinglePlayQueue(item), false);\n          \n          \n            \n                    } else /* type == VIDEO */ {\n          \n          \n            \n                        NavigationHelper.enqueueOnVideoPlayer(fragment.getContext(),\n          \n          \n            \n                                new SinglePlayQueue(item), false);\n          \n          \n            \n                    }", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4425#discussion_r500289337", "createdAt": "2020-10-06T13:43:27Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/util/StreamDialogEntry.java", "diffHunk": "@@ -1,21 +1,61 @@\n package org.schabi.newpipe.util;\n \n import android.content.Context;\n+import android.widget.Toast;\n \n import androidx.fragment.app.Fragment;\n \n import org.schabi.newpipe.R;\n import org.schabi.newpipe.extractor.stream.StreamInfoItem;\n import org.schabi.newpipe.local.dialog.PlaylistAppendDialog;\n+import org.schabi.newpipe.player.MainPlayer;\n+import org.schabi.newpipe.player.helper.PlayerHolder;\n import org.schabi.newpipe.player.playqueue.SinglePlayQueue;\n \n+import java.util.ArrayList;\n import java.util.Collections;\n \n public enum StreamDialogEntry {\n     //////////////////////////////////////\n     // enum values with DEFAULT actions //\n     //////////////////////////////////////\n \n+    /**\n+     * Enqueues the stream automatically to the current PlayerType.<br>\n+     * <br>\n+     * Info: Add this entry within showStreamDialog.\n+     */\n+    enqueue_stream(R.string.enqueue_stream, (fragment, item) -> {\n+        final MainPlayer.PlayerType type = PlayerHolder.getType();\n+\n+        if (type == null) {\n+            // This code shouldn't be reached since the checks for appending this entry should be\n+            // done within the showStreamDialog calls.\n+            Toast.makeText(fragment.getContext(),\n+                    \"No player currently playing\", Toast.LENGTH_SHORT).show();\n+            return;\n+        }\n+        switch (type) {\n+            case AUDIO:\n+                NavigationHelper.enqueueOnBackgroundPlayer(fragment.getContext(),\n+                        new SinglePlayQueue(item), false);\n+                break;\n+            case POPUP:\n+                NavigationHelper.enqueueOnPopupPlayer(fragment.getContext(),\n+                        new SinglePlayQueue(item), false);\n+                break;\n+            case VIDEO:\n+                NavigationHelper.enqueueOnVideoPlayer(fragment.getContext(),\n+                        new SinglePlayQueue(item), false);\n+                break;\n+            default:\n+                // Same as above, but keep it for now for debugging.\n+                Toast.makeText(fragment.getContext(),\n+                        \"Unreachable code executed\", Toast.LENGTH_SHORT).show();\n+                break;\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed6fc4d848ba113c1087ca453541af08752e4316"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDI5MDI2Mg==", "bodyText": "Remove this and the one below, since they are now unused.", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4425#discussion_r500290262", "createdAt": "2020-10-06T13:44:24Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/util/StreamDialogEntry.java", "diffHunk": "@@ -1,21 +1,61 @@\n package org.schabi.newpipe.util;\n \n import android.content.Context;\n+import android.widget.Toast;\n \n import androidx.fragment.app.Fragment;\n \n import org.schabi.newpipe.R;\n import org.schabi.newpipe.extractor.stream.StreamInfoItem;\n import org.schabi.newpipe.local.dialog.PlaylistAppendDialog;\n+import org.schabi.newpipe.player.MainPlayer;\n+import org.schabi.newpipe.player.helper.PlayerHolder;\n import org.schabi.newpipe.player.playqueue.SinglePlayQueue;\n \n+import java.util.ArrayList;\n import java.util.Collections;\n \n public enum StreamDialogEntry {\n     //////////////////////////////////////\n     // enum values with DEFAULT actions //\n     //////////////////////////////////////\n \n+    /**\n+     * Enqueues the stream automatically to the current PlayerType.<br>\n+     * <br>\n+     * Info: Add this entry within showStreamDialog.\n+     */\n+    enqueue_stream(R.string.enqueue_stream, (fragment, item) -> {\n+        final MainPlayer.PlayerType type = PlayerHolder.getType();\n+\n+        if (type == null) {\n+            // This code shouldn't be reached since the checks for appending this entry should be\n+            // done within the showStreamDialog calls.\n+            Toast.makeText(fragment.getContext(),\n+                    \"No player currently playing\", Toast.LENGTH_SHORT).show();\n+            return;\n+        }\n+        switch (type) {\n+            case AUDIO:\n+                NavigationHelper.enqueueOnBackgroundPlayer(fragment.getContext(),\n+                        new SinglePlayQueue(item), false);\n+                break;\n+            case POPUP:\n+                NavigationHelper.enqueueOnPopupPlayer(fragment.getContext(),\n+                        new SinglePlayQueue(item), false);\n+                break;\n+            case VIDEO:\n+                NavigationHelper.enqueueOnVideoPlayer(fragment.getContext(),\n+                        new SinglePlayQueue(item), false);\n+                break;\n+            default:\n+                // Same as above, but keep it for now for debugging.\n+                Toast.makeText(fragment.getContext(),\n+                        \"Unreachable code executed\", Toast.LENGTH_SHORT).show();\n+                break;\n+        }\n+    }),\n+\n     enqueue_on_background(R.string.enqueue_on_background, (fragment, item) ->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed6fc4d848ba113c1087ca453541af08752e4316"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDI5MTI5MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static void setEnabledEntries(final ArrayList<StreamDialogEntry> entries) {\n          \n          \n            \n                public static void setEnabledEntries(final List<StreamDialogEntry> entries) {", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4425#discussion_r500291290", "createdAt": "2020-10-06T13:45:26Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/util/StreamDialogEntry.java", "diffHunk": "@@ -69,6 +109,10 @@\n     // non-static methods to initialize and edit entries //\n     ///////////////////////////////////////////////////////\n \n+    public static void setEnabledEntries(final ArrayList<StreamDialogEntry> entries) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed6fc4d848ba113c1087ca453541af08752e4316"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDI5MjE3NQ==", "bodyText": "I am not sure, but if these are unused, please remove them.", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4425#discussion_r500292175", "createdAt": "2020-10-06T13:46:27Z", "author": {"login": "Stypox"}, "path": "app/src/main/res/values/strings.xml", "diffHunk": "@@ -445,6 +445,7 @@\n     <string name=\"play_queue_stream_detail\">Details</string>\n     <string name=\"play_queue_audio_settings\">Audio Settings</string>\n     <string name=\"hold_to_append\">Hold to enqueue</string>\n+    <string name=\"enqueue_stream\">Enqueue stream</string>\n     <string name=\"enqueue_on_background\">Enqueue in the background</string>\n     <string name=\"enqueue_on_popup\">Enqueue in a popup</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed6fc4d848ba113c1087ca453541af08752e4316"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12f615c6da39b7220569c5172899dc8e1c17bbd1", "author": {"user": {"login": "vkay94", "name": "Viktor K"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/12f615c6da39b7220569c5172899dc8e1c17bbd1", "committedDate": "2020-10-06T15:22:12Z", "message": "Enqueue: Removed unneeded dialog-entries and strings + adjustments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMjUzMzcx", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4425#pullrequestreview-503253371", "createdAt": "2020-10-06T18:36:27Z", "commit": {"oid": "12f615c6da39b7220569c5172899dc8e1c17bbd1"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxODozNjoyN1rOHdVBRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxODozNjoyN1rOHdVBRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDUxNTE0Mw==", "bodyText": "Just use enqueued as the id, or is it already used?", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4425#discussion_r500515143", "createdAt": "2020-10-06T18:36:27Z", "author": {"login": "Stypox"}, "path": "app/src/main/res/values/strings.xml", "diffHunk": "@@ -445,8 +445,8 @@\n     <string name=\"play_queue_stream_detail\">Details</string>\n     <string name=\"play_queue_audio_settings\">Audio Settings</string>\n     <string name=\"hold_to_append\">Hold to enqueue</string>\n-    <string name=\"enqueue_on_background\">Enqueue in the background</string>\n-    <string name=\"enqueue_on_popup\">Enqueue in a popup</string>\n+    <string name=\"enqueue_stream\">Enqueue</string>\n+    <string name=\"player_append\">Enqueued</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12f615c6da39b7220569c5172899dc8e1c17bbd1"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cbf364f24f775122555122d2705332a086b27eba", "author": {"user": {"login": "vkay94", "name": "Viktor K"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/cbf364f24f775122555122d2705332a086b27eba", "committedDate": "2020-10-06T19:17:52Z", "message": "Enqueue: Renamed string resource"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMjkxMzU3", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4425#pullrequestreview-503291357", "createdAt": "2020-10-06T19:29:30Z", "commit": {"oid": "cbf364f24f775122555122d2705332a086b27eba"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4130, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}