{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1MjEzMjM3", "number": 3197, "title": "Fix bug in main screen tabs state management", "bodyText": "Tabs were not being destroyed/restored correctly due to a call to a method that populated the view pager before it even had a chance of restoring itself.\nThe solution was to null out the adapter before calling that method so the view pager will postpone the populating process.", "createdAt": "2020-03-08T01:24:26Z", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3197", "merged": true, "mergeCommit": {"oid": "33475ef40382ae6ef0304c2fca6146a801324d11"}, "closed": true, "closedAt": "2020-03-11T21:03:17Z", "author": {"login": "mauriciocolli"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcLlj0yAFqTM3MDgxMzkxNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcLpGGOgFqTM3MDgyOTA3NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwODEzOTE1", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3197#pullrequestreview-370813915", "createdAt": "2020-03-08T08:45:43Z", "commit": {"oid": "ee5220c0ba2c742affbae05007928ea6d33657a7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQwODo0NTo0NFrOFzT8wA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQwOTowMjoxN1rOFzUBLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM0ODU0NA==", "bodyText": "Invert the condition in the if:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (!hasTabsChanged) {\n          \n          \n            \n                        if (viewPager.getOffscreenPageLimit() != tabsList.size()) {\n          \n          \n            \n                            viewPager.setOffscreenPageLimit(tabsList.size());\n          \n          \n            \n                        }\n          \n          \n            \n                    } else {\n          \n          \n            \n                        setupTabs();\n          \n          \n            \n                    }\n          \n          \n            \n                    if (hasTabsChanged) {\n          \n          \n            \n                        setupTabs();\n          \n          \n            \n                    } else {\n          \n          \n            \n                        if (viewPager.getOffscreenPageLimit() != tabsList.size()) {\n          \n          \n            \n                            viewPager.setOffscreenPageLimit(tabsList.size());\n          \n          \n            \n                        }\n          \n          \n            \n                    }", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3197#discussion_r389348544", "createdAt": "2020-03-08T08:45:44Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/fragments/MainFragment.java", "diffHunk": "@@ -89,7 +89,13 @@ protected void initViews(View rootView, Bundle savedInstanceState) {\n     public void onResume() {\n         super.onResume();\n \n-        if (hasTabsChanged) setupTabs();\n+        if (!hasTabsChanged) {\n+            if (viewPager.getOffscreenPageLimit() != tabsList.size()) {\n+                viewPager.setOffscreenPageLimit(tabsList.size());\n+            }\n+        } else {\n+            setupTabs();\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee5220c0ba2c742affbae05007928ea6d33657a7"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM0ODcwNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (pagerAdapter == null || !pagerAdapter.sameTabs(tabsList)) {\n          \n          \n            \n                    if (wasAdapterNull || !pagerAdapter.sameTabs(tabsList)) {", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3197#discussion_r389348705", "createdAt": "2020-03-08T08:48:02Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/fragments/MainFragment.java", "diffHunk": "@@ -136,16 +142,23 @@ public boolean onOptionsItemSelected(MenuItem item) {\n     // Tabs\n     //////////////////////////////////////////////////////////////////////////*/\n \n-    public void setupTabs() {\n+    private void setupTabs() {\n         tabsList.clear();\n         tabsList.addAll(tabsManager.getTabs());\n \n+        boolean wasAdapterNull = pagerAdapter == null;\n         if (pagerAdapter == null || !pagerAdapter.sameTabs(tabsList)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee5220c0ba2c742affbae05007928ea6d33657a7"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM0OTY3Nw==", "bodyText": "Couldn't this be put inside the if (!wasAdapterNull), too?", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3197#discussion_r389349677", "createdAt": "2020-03-08T09:02:17Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/fragments/MainFragment.java", "diffHunk": "@@ -136,16 +142,23 @@ public boolean onOptionsItemSelected(MenuItem item) {\n     // Tabs\n     //////////////////////////////////////////////////////////////////////////*/\n \n-    public void setupTabs() {\n+    private void setupTabs() {\n         tabsList.clear();\n         tabsList.addAll(tabsManager.getTabs());\n \n+        boolean wasAdapterNull = pagerAdapter == null;\n         if (pagerAdapter == null || !pagerAdapter.sameTabs(tabsList)) {\n             pagerAdapter = new SelectedTabsPagerAdapter(requireContext(), getChildFragmentManager(), tabsList);\n         }\n         // Clear previous tabs/fragments and set new adapter\n         viewPager.setAdapter(pagerAdapter);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee5220c0ba2c742affbae05007928ea6d33657a7"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2526ed5a892b0e59d2c575437d7782000f1d664", "author": {"user": {"login": "mauriciocolli", "name": "Mauricio Colli"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/f2526ed5a892b0e59d2c575437d7782000f1d664", "committedDate": "2020-03-08T12:09:04Z", "message": "Fix bug in main screen tabs state management\n\nTabs were not being destroyed/restored correctly due to a call to a\nmethod that populated the view pager before it even had a chance of\nrestoring itself.\n\nThe solution was to null out the adapter before calling that method so\nthe view pager will postpone the populating process."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ee5220c0ba2c742affbae05007928ea6d33657a7", "author": {"user": {"login": "mauriciocolli", "name": "Mauricio Colli"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/ee5220c0ba2c742affbae05007928ea6d33657a7", "committedDate": "2020-03-08T01:21:01Z", "message": "Fix bug in main screen tabs state management\n\nTabs were not being destroyed/restored correctly due to a call to a\nmethod that populated the view pager even before it had a chance of\nrestoring itself.\n\nThe solution was to postpone the call for that method after the pager\nhad already restored its state."}, "afterCommit": {"oid": "f2526ed5a892b0e59d2c575437d7782000f1d664", "author": {"user": {"login": "mauriciocolli", "name": "Mauricio Colli"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/f2526ed5a892b0e59d2c575437d7782000f1d664", "committedDate": "2020-03-08T12:09:04Z", "message": "Fix bug in main screen tabs state management\n\nTabs were not being destroyed/restored correctly due to a call to a\nmethod that populated the view pager before it even had a chance of\nrestoring itself.\n\nThe solution was to null out the adapter before calling that method so\nthe view pager will postpone the populating process."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwODI5MDc0", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3197#pullrequestreview-370829074", "createdAt": "2020-03-08T13:12:01Z", "commit": {"oid": "f2526ed5a892b0e59d2c575437d7782000f1d664"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4039, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}