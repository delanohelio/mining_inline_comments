{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyNDI1OTAw", "number": 2957, "title": "Rewrite ttml conversion", "bodyText": "rewrite SubtitleConverter (use JSoup library instead, remove unused methods)\nfixes #2891\n\n[ \u2714 ] I carefully read the contribution guidelines and agree to them.", "createdAt": "2020-01-14T03:28:31Z", "url": "https://github.com/TeamNewPipe/NewPipe/pull/2957", "merged": true, "mergeCommit": {"oid": "bf5e94fc1a8cd86f824a43647040ce7149bec871"}, "closed": true, "closedAt": "2020-01-26T10:03:14Z", "author": {"login": "kapodamy"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb6ICR4AH2gAyMzYyNDI1OTAwOjQyZWM2ZjA4MTAzMzI5MDRmYmIyMmQxZDNkZDg3YThjZTQ0MmM2NTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb-FN4JgFqTM0ODM2OTM2MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "42ec6f0810332904fbb22d1d3dd87a8ce442c655", "author": {"user": {"login": "kapodamy", "name": "kapodamy"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/42ec6f0810332904fbb22d1d3dd87a8ce442c655", "committedDate": "2020-01-14T03:04:16Z", "message": "ttml to srt conversion\nrewrite SubtitleConverter (use JSoup library instead, remove unused methods)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyNDE4NDY2", "url": "https://github.com/TeamNewPipe/NewPipe/pull/2957#pullrequestreview-342418466", "createdAt": "2020-01-14T10:12:01Z", "commit": {"oid": "42ec6f0810332904fbb22d1d3dd87a8ce442c655"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQxMDoxMjowMVrOFdSN_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQxMDoxMjowMVrOFdSN_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjI1MTUxOA==", "bodyText": "I guess this one is faster.\n    private final Charset charset = StandardCharsets.UTF_8;", "url": "https://github.com/TeamNewPipe/NewPipe/pull/2957#discussion_r366251518", "createdAt": "2020-01-14T10:12:01Z", "author": {"login": "TobiGr"}, "path": "app/src/main/java/org/schabi/newpipe/streams/SrtFromTtmlWriter.java", "diffHunk": "@@ -0,0 +1,95 @@\n+package org.schabi.newpipe.streams;\n+\n+import org.jsoup.Jsoup;\n+import org.jsoup.nodes.Document;\n+import org.jsoup.nodes.Element;\n+import org.jsoup.nodes.Node;\n+import org.jsoup.nodes.TextNode;\n+import org.jsoup.parser.Parser;\n+import org.jsoup.select.Elements;\n+import org.schabi.newpipe.streams.io.SharpStream;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.nio.charset.Charset;\n+import java.text.ParseException;\n+\n+/**\n+ * @author kapodamy\n+ */\n+public class SrtFromTtmlWriter {\n+    private static final String NEW_LINE = \"\\r\\n\";\n+\n+    private SharpStream out;\n+    private boolean ignoreEmptyFrames;\n+    private final Charset charset = Charset.forName(\"utf-8\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42ec6f0810332904fbb22d1d3dd87a8ce442c655"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "845767e2f8f62dc34452e54723a2dd3670c93ff7", "author": {"user": {"login": "kapodamy", "name": "kapodamy"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/845767e2f8f62dc34452e54723a2dd3670c93ff7", "committedDate": "2020-01-18T03:43:38Z", "message": "StandardCharsets.UTF_8 instead of Charset.forName(\"utf-8\")"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed18466c3b45817bf93fef738f1e870e2ede5b9d", "author": {"user": {"login": "kapodamy", "name": "kapodamy"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/ed18466c3b45817bf93fef738f1e870e2ede5b9d", "committedDate": "2020-01-18T03:35:48Z", "message": "Merge branch 'dev' into subtitles"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2d3e2c7e0799fbc9fba717d7cc586dbf63ac241", "author": {"user": {"login": "kapodamy", "name": "kapodamy"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/a2d3e2c7e0799fbc9fba717d7cc586dbf63ac241", "committedDate": "2020-01-18T04:10:25Z", "message": "2 typo fixup\n* add missing namespace of StandardCharsets\n* use an unused constructor argument"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1MTY1MDg4", "url": "https://github.com/TeamNewPipe/NewPipe/pull/2957#pullrequestreview-345165088", "createdAt": "2020-01-20T09:15:01Z", "commit": {"oid": "a2d3e2c7e0799fbc9fba717d7cc586dbf63ac241"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQwOToxNTowMVrOFfXl4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQwOToxNjo1OFrOFfXpgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQzNjcwNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            .replace('.', ',');// Str uses comma as decimal separator\n          \n          \n            \n                            .replace('.', ',');// Srt uses comma as decimal separator", "url": "https://github.com/TeamNewPipe/NewPipe/pull/2957#discussion_r368436705", "createdAt": "2020-01-20T09:15:01Z", "author": {"login": "TobiGr"}, "path": "app/src/main/java/org/schabi/newpipe/streams/SrtFromTtmlWriter.java", "diffHunk": "@@ -0,0 +1,95 @@\n+package org.schabi.newpipe.streams;\n+\n+import org.jsoup.Jsoup;\n+import org.jsoup.nodes.Document;\n+import org.jsoup.nodes.Element;\n+import org.jsoup.nodes.Node;\n+import org.jsoup.nodes.TextNode;\n+import org.jsoup.parser.Parser;\n+import org.jsoup.select.Elements;\n+import org.schabi.newpipe.streams.io.SharpStream;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.nio.charset.Charset;\n+import java.nio.charset.StandardCharsets;\n+\n+/**\n+ * @author kapodamy\n+ */\n+public class SrtFromTtmlWriter {\n+    private static final String NEW_LINE = \"\\r\\n\";\n+\n+    private SharpStream out;\n+    private boolean ignoreEmptyFrames;\n+    private final Charset charset = StandardCharsets.UTF_8;\n+\n+    private int frameIndex = 0;\n+\n+    public SrtFromTtmlWriter(SharpStream out, boolean ignoreEmptyFrames) {\n+        this.out = out;\n+        this.ignoreEmptyFrames = ignoreEmptyFrames;\n+    }\n+\n+    private static String getTimestamp(Element frame, String attr) {\n+        return frame\n+                .attr(attr)\n+                .replace('.', ',');// Str uses comma as decimal separator", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2d3e2c7e0799fbc9fba717d7cc586dbf63ac241"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQzNzYzMg==", "bodyText": "Just to increase readability.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Elements paragraph_list = doc.select(\"body>div>p\");\n          \n          \n            \n                    Elements paragraph_list = doc.select(\"body > div > p\");", "url": "https://github.com/TeamNewPipe/NewPipe/pull/2957#discussion_r368437632", "createdAt": "2020-01-20T09:16:58Z", "author": {"login": "TobiGr"}, "path": "app/src/main/java/org/schabi/newpipe/streams/SrtFromTtmlWriter.java", "diffHunk": "@@ -0,0 +1,95 @@\n+package org.schabi.newpipe.streams;\n+\n+import org.jsoup.Jsoup;\n+import org.jsoup.nodes.Document;\n+import org.jsoup.nodes.Element;\n+import org.jsoup.nodes.Node;\n+import org.jsoup.nodes.TextNode;\n+import org.jsoup.parser.Parser;\n+import org.jsoup.select.Elements;\n+import org.schabi.newpipe.streams.io.SharpStream;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.nio.charset.Charset;\n+import java.nio.charset.StandardCharsets;\n+\n+/**\n+ * @author kapodamy\n+ */\n+public class SrtFromTtmlWriter {\n+    private static final String NEW_LINE = \"\\r\\n\";\n+\n+    private SharpStream out;\n+    private boolean ignoreEmptyFrames;\n+    private final Charset charset = StandardCharsets.UTF_8;\n+\n+    private int frameIndex = 0;\n+\n+    public SrtFromTtmlWriter(SharpStream out, boolean ignoreEmptyFrames) {\n+        this.out = out;\n+        this.ignoreEmptyFrames = ignoreEmptyFrames;\n+    }\n+\n+    private static String getTimestamp(Element frame, String attr) {\n+        return frame\n+                .attr(attr)\n+                .replace('.', ',');// Str uses comma as decimal separator\n+    }\n+\n+    private void writeFrame(String begin, String end, StringBuilder text) throws IOException {\n+        writeString(String.valueOf(frameIndex++));\n+        writeString(NEW_LINE);\n+        writeString(begin);\n+        writeString(\" --> \");\n+        writeString(end);\n+        writeString(NEW_LINE);\n+        writeString(text.toString());\n+        writeString(NEW_LINE);\n+        writeString(NEW_LINE);\n+    }\n+\n+    private void writeString(String text) throws IOException {\n+        out.write(text.getBytes(charset));\n+    }\n+\n+    public void build(SharpStream ttml) throws IOException {\n+        /*\n+         * TTML parser with BASIC support\n+         * multiple CUE is not supported\n+         * styling is not supported\n+         * tag timestamps (in auto-generated subtitles) are not supported, maybe in the future\n+         * also TimestampTagOption enum is not applicable\n+         * Language parsing is not supported\n+         */\n+\n+        // parse XML\n+        byte[] buffer = new byte[(int) ttml.available()];\n+        ttml.read(buffer);\n+        Document doc = Jsoup.parse(new ByteArrayInputStream(buffer), \"UTF-8\", \"\", Parser.xmlParser());\n+\n+        StringBuilder text = new StringBuilder(128);\n+        Elements paragraph_list = doc.select(\"body>div>p\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2d3e2c7e0799fbc9fba717d7cc586dbf63ac241"}, "originalPosition": 72}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "afc362d2b613773df1896dbb1a3f6179f2d7beb6", "author": {"user": {"login": "kapodamy", "name": "kapodamy"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/afc362d2b613773df1896dbb1a3f6179f2d7beb6", "committedDate": "2020-01-21T02:33:30Z", "message": "readability changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8f726153f2e5b71c1d2bd1ecec23ca749bbd4fb", "author": {"user": {"login": "kapodamy", "name": "kapodamy"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/b8f726153f2e5b71c1d2bd1ecec23ca749bbd4fb", "committedDate": "2020-01-21T02:23:51Z", "message": "Merge branch 'dev' into subtitles"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4MzY5MzYw", "url": "https://github.com/TeamNewPipe/NewPipe/pull/2957#pullrequestreview-348369360", "createdAt": "2020-01-26T10:02:55Z", "commit": {"oid": "b8f726153f2e5b71c1d2bd1ecec23ca749bbd4fb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4013, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}