{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0NDQ2MTky", "number": 4345, "title": "Fix PlaylistAppendDialog showing when no local playlists exist", "bodyText": "What is it?\n\n Bug fix (user facing)\n Feature (user facing)\n Code base improvement (dev facing)\n Meta improvement to the project (dev facing)\n\nDescription of the changes in your PR\n\n\nAdded methods to PlaylistDAO and LocalPlaylistManager to get an observable for checking if there is a playlist\nAdded method checkPlaylists to PlaylistAppendDialog which gives the opportunity to react on existing playlists\nInserted the check into the three corresponding places (menus + background player)\n\nFixes the following issue(s)\n\n\nfixes #4339\n\nTesting apk\n\napp-debug-fix-createplaylist.zip\nAgreement\n\n I carefully read the contribution guidelines and agree to them.", "createdAt": "2020-09-28T22:58:20Z", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4345", "merged": true, "mergeCommit": {"oid": "7c80233f2625a28b96d07108e67c62d704b542f2"}, "closed": true, "closedAt": "2020-10-23T08:08:21Z", "author": {"login": "vkay94"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNhoEYgFqTQ5ODEwOTc5OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVRrgUgFqTUxNTQyMDI3OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MTA5Nzk4", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4345#pullrequestreview-498109798", "createdAt": "2020-09-29T05:39:50Z", "commit": {"oid": "6a7a83cb9a66924cf0829f706007b5552bff3c89"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwNTozOTo1MVrOHZbq7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwNTo0ODoyNlrOHZb08Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQyOTgwNA==", "bodyText": "Maybe use different names here, like onPlaylistFound", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4345#discussion_r496429804", "createdAt": "2020-09-29T05:39:51Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/local/dialog/PlaylistAppendDialog.java", "diffHunk": "@@ -38,6 +40,27 @@\n \n     private CompositeDisposable playlistDisposables = new CompositeDisposable();\n \n+    public static Disposable checkPlaylists(\n+            final Context context, final Invoker onSuccess, final Invoker onFailed", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a7a83cb9a66924cf0829f706007b5552bff3c89"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQzMDY5NQ==", "bodyText": "You can just use a Runnable instead", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4345#discussion_r496430695", "createdAt": "2020-09-29T05:42:45Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/local/dialog/PlaylistAppendDialog.java", "diffHunk": "@@ -38,6 +40,27 @@\n \n     private CompositeDisposable playlistDisposables = new CompositeDisposable();\n \n+    public static Disposable checkPlaylists(\n+            final Context context, final Invoker onSuccess, final Invoker onFailed\n+    ) {\n+        final LocalPlaylistManager playlistManager =\n+                new LocalPlaylistManager(NewPipeDatabase.getInstance(context));\n+\n+        return playlistManager.hasPlaylists()\n+                .observeOn(AndroidSchedulers.mainThread())\n+                .subscribe(hasPlaylists -> {\n+                    if (hasPlaylists) {\n+                        onSuccess.invoke();\n+                    } else {\n+                        onFailed.invoke();\n+                    }\n+                });\n+    }\n+\n+    public interface Invoker {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a7a83cb9a66924cf0829f706007b5552bff3c89"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQzMTQ2OA==", "bodyText": "Should't this return a Single? Is it impossible for the database getCount to return a Single? I might be wrong", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4345#discussion_r496431468", "createdAt": "2020-09-29T05:45:21Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/local/playlist/LocalPlaylistManager.java", "diffHunk": "@@ -126,4 +126,10 @@ public String getPlaylistThumbnail(final long playlistId) {\n                 }).subscribeOn(Schedulers.io());\n     }\n \n+    public Maybe<Boolean> hasPlaylists() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a7a83cb9a66924cf0829f706007b5552bff3c89"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQzMjM2OQ==", "bodyText": "Maybe extract this code to a function so that it can be reused above", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4345#discussion_r496432369", "createdAt": "2020-09-29T05:48:26Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/util/StreamDialogEntry.java", "diffHunk": "@@ -40,8 +41,14 @@\n \n     append_playlist(R.string.append_playlist, (fragment, item) -> {\n         if (fragment.getFragmentManager() != null) {\n-            PlaylistAppendDialog.fromStreamInfoItems(Collections.singletonList(item))\n-                    .show(fragment.getFragmentManager(), \"StreamDialogEntry@append_playlist\");\n+            final PlaylistAppendDialog d = PlaylistAppendDialog\n+                    .fromStreamInfoItems(Collections.singletonList(item));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a7a83cb9a66924cf0829f706007b5552bff3c89"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NDI4MTI3", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4345#pullrequestreview-498428127", "createdAt": "2020-09-29T12:45:19Z", "commit": {"oid": "d93e2638661a457e9c0096b8d4c91c433a4d861c"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2680d41a3dff08aa5505da4aec0f67ff3f4155c8", "author": {"user": {"login": "vkay94", "name": "Viktor K"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/2680d41a3dff08aa5505da4aec0f67ff3f4155c8", "committedDate": "2020-10-23T07:44:26Z", "message": "Fix PlaylistAppendDialog showing when no local playlists exist"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32a142bf79351272c56e745b3a1f2052a0e5679b", "author": {"user": {"login": "vkay94", "name": "Viktor K"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/32a142bf79351272c56e745b3a1f2052a0e5679b", "committedDate": "2020-10-23T07:44:26Z", "message": "Fix PlaylistAppendDialog: Renamed method and replaced with Runnable"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d93e2638661a457e9c0096b8d4c91c433a4d861c", "author": {"user": {"login": "vkay94", "name": "Viktor K"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/d93e2638661a457e9c0096b8d4c91c433a4d861c", "committedDate": "2020-09-29T12:04:14Z", "message": "Fix PlaylistAppendDialog: Renamed method and replaced with Runnable"}, "afterCommit": {"oid": "32a142bf79351272c56e745b3a1f2052a0e5679b", "author": {"user": {"login": "vkay94", "name": "Viktor K"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/32a142bf79351272c56e745b3a1f2052a0e5679b", "committedDate": "2020-10-23T07:44:26Z", "message": "Fix PlaylistAppendDialog: Renamed method and replaced with Runnable"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1NDIwMjc4", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4345#pullrequestreview-515420278", "createdAt": "2020-10-23T07:45:33Z", "commit": {"oid": "32a142bf79351272c56e745b3a1f2052a0e5679b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4123, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}