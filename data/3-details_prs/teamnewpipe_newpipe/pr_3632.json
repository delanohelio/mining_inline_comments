{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxOTQ5NzIx", "number": 3632, "title": "Add settings to match device's theme (dark & black)", "bodyText": "What is it?\n\n Bug fix (user facing)\n Feature (user facing)\n Code base improvement (dev facing)\n Meta improvement to the project (dev facing)\n\nDescription of the changes in your PR\n\nAdded two device theme settings:\n\nDevice theme (Dark)\nDevice theme (Black)\n\nDevice theme (Dark) and Device theme (Black) will set the theme to light if device's theme is light or unknown, otherwise it will set dark or black.\nAvailable for Android 10+ only, LineageOS 16+ and other ROMs providing dark theme.\nHere is a GIF:\n\nFixes the following issue(s)\n\n\nFixes #3420\nFixes #687\nFixes partially #1535 : fixes for people who can set Automatic (time of the day) theme in Android settings.\n\nTesting apk\n\nNewPipe_theme.zip\nAgreement\n\n I carefully read the contribution guidelines and agree to them.", "createdAt": "2020-05-22T14:23:04Z", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3632", "merged": true, "mergeCommit": {"oid": "08b960cc6e07c189317c6b122cfc12eb78a711c9"}, "closed": true, "closedAt": "2021-03-18T14:11:40Z", "author": {"login": "B0pol"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcmo20YgBqjMzOTA0NzIwNDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABeEU8PRgFqTYxNTMwNTc5Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "85e813ee667f5ef5f22f78a690ac9fc3c0b85450", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/85e813ee667f5ef5f22f78a690ac9fc3c0b85450", "committedDate": "2020-05-22T13:50:19Z", "message": "improve code style"}, "afterCommit": {"oid": "145b6b0bdde86e37ba860256d749cbb0d199b0a0", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/145b6b0bdde86e37ba860256d749cbb0d199b0a0", "committedDate": "2020-05-31T10:11:05Z", "message": "fix bugs related to isLightThemeSelected not handling device themes\n\nsuch as license having dark background when it should be white"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NzU1NDI1", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3632#pullrequestreview-425755425", "createdAt": "2020-06-06T17:20:28Z", "commit": {"oid": "145b6b0bdde86e37ba860256d749cbb0d199b0a0"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxNzoyMDoyOVrOGgEvwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxNzozMjo0M1rOGgEzNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4NTM3Ng==", "bodyText": "The name of this method is irritating. What about\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private static boolean getDeviceTheme(final Context context) {\n          \n          \n            \n                private static boolean isDeviceNightModeEnabled(final Context context) {", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3632#discussion_r436285376", "createdAt": "2020-06-06T17:20:29Z", "author": {"login": "TobiGr"}, "path": "app/src/main/java/org/schabi/newpipe/util/ThemeHelper.java", "diffHunk": "@@ -231,4 +269,28 @@ private static String getSelectedThemeString(final Context context) {\n         return PreferenceManager.getDefaultSharedPreferences(context)\n                 .getString(themeKey, defaultTheme);\n     }\n+\n+    /**\n+     * Get the device theme\n+     * <p>\n+     * It will return true if the device's theme is dark, false otherwise.\n+     * <p>\n+     * From https://developer.android.com/guide/topics/ui/look-and-feel/darktheme#java\n+     *\n+     * @param context the context to use\n+     * @return true: dark theme, false: light or unknown\n+     */\n+    private static boolean getDeviceTheme(final Context context) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "145b6b0bdde86e37ba860256d749cbb0d199b0a0"}, "originalPosition": 150}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4NTU5NQ==", "bodyText": "To be honest, when testing the APK, I did not know what the two settings were supposed to change.\nWe need to make clear that the dark or black theme is used when the night mode is enabled, light theme otherwise. However, I have no idea how to put that in a few words.", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3632#discussion_r436285595", "createdAt": "2020-06-06T17:23:07Z", "author": {"login": "TobiGr"}, "path": "app/src/main/res/values/strings.xml", "diffHunk": "@@ -66,6 +66,8 @@\n     <string name=\"light_theme_title\">Light</string>\n     <string name=\"dark_theme_title\">Dark</string>\n     <string name=\"black_theme_title\">Black</string>\n+    <string name=\"device_dark_theme_title\">Device theme (Dark)</string>\n+    <string name=\"device_black_theme_title\">Device theme (Black)</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "145b6b0bdde86e37ba860256d749cbb0d199b0a0"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4NjI2Mw==", "bodyText": "Why are these two lines necessary?", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3632#discussion_r436286263", "createdAt": "2020-06-06T17:32:43Z", "author": {"login": "TobiGr"}, "path": "app/src/main/java/org/schabi/newpipe/util/ThemeHelper.java", "diffHunk": "@@ -139,6 +150,18 @@ public static int getThemeForService(final Context context, final int serviceId)\n             defaultTheme = R.style.BlackTheme;\n         } else if (selectedTheme.equals(darkTheme)) {\n             defaultTheme = R.style.DarkTheme;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "145b6b0bdde86e37ba860256d749cbb0d199b0a0"}, "originalPosition": 66}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ad307f1e53915728a44e774855d9ea0e033b2c60", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/ad307f1e53915728a44e774855d9ea0e033b2c60", "committedDate": "2020-06-06T19:12:53Z", "message": "minor refactoring"}, "afterCommit": {"oid": "755bc4c49da7db85227115b4c53a6c2b4e3430a5", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/755bc4c49da7db85227115b4c53a6c2b4e3430a5", "committedDate": "2020-06-10T14:36:53Z", "message": "minor refactoring"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NzgwODgy", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3632#pullrequestreview-438780882", "createdAt": "2020-06-28T13:32:47Z", "commit": {"oid": "755bc4c49da7db85227115b4c53a6c2b4e3430a5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQxMzozMjo0OFrOGp9c-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQxMzozMjo0OFrOGp9c-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1MTY0Mg==", "bodyText": "final", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3632#discussion_r446651642", "createdAt": "2020-06-28T13:32:48Z", "author": {"login": "wb9688"}, "path": "app/src/main/java/org/schabi/newpipe/util/ThemeHelper.java", "diffHunk": "@@ -231,4 +265,28 @@ private static String getSelectedThemeString(final Context context) {\n         return PreferenceManager.getDefaultSharedPreferences(context)\n                 .getString(themeKey, defaultTheme);\n     }\n+\n+    /**\n+     * Get the device theme\n+     * <p>\n+     * It will return true if the device's theme is dark, false otherwise.\n+     * <p>\n+     * From https://developer.android.com/guide/topics/ui/look-and-feel/darktheme#java\n+     *\n+     * @param context the context to use\n+     * @return true: dark theme, false: light or unknown\n+     */\n+    private static boolean isDeviceDarkThemeEnabled(final Context context) {\n+        int deviceTheme = context.getResources().getConfiguration().uiMode", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "755bc4c49da7db85227115b4c53a6c2b4e3430a5"}, "originalPosition": 152}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "755bc4c49da7db85227115b4c53a6c2b4e3430a5", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/755bc4c49da7db85227115b4c53a6c2b4e3430a5", "committedDate": "2020-06-10T14:36:53Z", "message": "minor refactoring"}, "afterCommit": {"oid": "746a9510c5122cb0c55726bff222515704e0d72e", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/746a9510c5122cb0c55726bff222515704e0d72e", "committedDate": "2020-07-03T16:44:34Z", "message": "use a switch preference to follow device theme"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "746a9510c5122cb0c55726bff222515704e0d72e", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/746a9510c5122cb0c55726bff222515704e0d72e", "committedDate": "2020-07-03T16:44:34Z", "message": "use a switch preference to follow device theme"}, "afterCommit": {"oid": "7ee43b9911f41d8889dbe39ba25e2b2d817948f3", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/7ee43b9911f41d8889dbe39ba25e2b2d817948f3", "committedDate": "2020-10-11T08:47:23Z", "message": "use a switch preference to follow device theme"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MTc3Nzk5", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3632#pullrequestreview-506177799", "createdAt": "2020-10-11T13:06:17Z", "commit": {"oid": "c6cc619ea87d01f095540bb76d36a7cca5d13027"}, "state": "DISMISSED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMVQxMzowNjoxOFrOHfnZcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMVQxMzowNzowMFrOHfnZtw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjkxMzM5Mw==", "bodyText": "Invert this if", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3632#discussion_r502913393", "createdAt": "2020-10-11T13:06:18Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/util/ThemeHelper.java", "diffHunk": "@@ -141,8 +150,19 @@ public static int getThemeForService(final Context context, final int serviceId)\n             defaultTheme = R.style.LightTheme;\n         } else if (selectedTheme.equals(blackTheme)) {\n             defaultTheme = R.style.BlackTheme;\n-        } else if (selectedTheme.equals(darkTheme)) {\n-            defaultTheme = R.style.DarkTheme;\n+        } else if (selectedTheme.equals(automaticDeviceTheme)) {\n+\n+            if (!isDeviceDarkThemeEnabled(context)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6cc619ea87d01f095540bb76d36a7cca5d13027"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjkxMzQ2Mw==", "bodyText": "Also here", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3632#discussion_r502913463", "createdAt": "2020-10-11T13:07:00Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/util/ThemeHelper.java", "diffHunk": "@@ -191,6 +212,18 @@ public static int getSettingsThemeStyle(final Context context) {\n             return R.style.BlackSettingsTheme;\n         } else if (selectedTheme.equals(darkTheme)) {\n             return R.style.DarkSettingsTheme;\n+        } else if (selectedTheme.equals(automaticDeviceTheme)) {\n+            if (!isDeviceDarkThemeEnabled(context)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6cc619ea87d01f095540bb76d36a7cca5d13027"}, "originalPosition": 117}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MzA5MjAy", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3632#pullrequestreview-507309202", "createdAt": "2020-10-13T10:53:23Z", "commit": {"oid": "09a3a29c331697a50f4d7e82efd541999867e692"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "09a3a29c331697a50f4d7e82efd541999867e692", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/09a3a29c331697a50f4d7e82efd541999867e692", "committedDate": "2020-10-11T13:49:22Z", "message": "invert the if statements"}, "afterCommit": {"oid": "05e59987847c3b9c8e2d2a341db1d94e81727f12", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/05e59987847c3b9c8e2d2a341db1d94e81727f12", "committedDate": "2020-11-11T10:04:31Z", "message": "invert the if statements"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "05e59987847c3b9c8e2d2a341db1d94e81727f12", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/05e59987847c3b9c8e2d2a341db1d94e81727f12", "committedDate": "2020-11-11T10:04:31Z", "message": "invert the if statements"}, "afterCommit": {"oid": "14648d1b3576a3c91b888e90de689bd841e94565", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/14648d1b3576a3c91b888e90de689bd841e94565", "committedDate": "2021-03-18T10:07:28Z", "message": "invert the if statements"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "14648d1b3576a3c91b888e90de689bd841e94565", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/14648d1b3576a3c91b888e90de689bd841e94565", "committedDate": "2021-03-18T10:07:28Z", "message": "invert the if statements"}, "afterCommit": {"oid": "8568acfb6f72aef772f1e853bc899c31df90da67", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/8568acfb6f72aef772f1e853bc899c31df90da67", "committedDate": "2021-03-18T10:15:00Z", "message": "Remove unused string & invert if statements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a713ce21263c29347e633efa871576f31c0d4249", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/a713ce21263c29347e633efa871576f31c0d4249", "committedDate": "2021-03-18T10:17:06Z", "message": "Add settings for device theme (dark & black)\n\nfix bugs related to isLightThemeSelected not handling device themes\nsuch as license having dark background when it should be white"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8568acfb6f72aef772f1e853bc899c31df90da67", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/8568acfb6f72aef772f1e853bc899c31df90da67", "committedDate": "2021-03-18T10:15:00Z", "message": "Remove unused string & invert if statements"}, "afterCommit": {"oid": "f1a4e07b9227c72fbe010699cfa87e5ec82181f5", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/f1a4e07b9227c72fbe010699cfa87e5ec82181f5", "committedDate": "2021-03-18T10:17:06Z", "message": "Remove unused string & invert if statements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22b2f52f8c83df746153f197cf6fef40a75e3976", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/22b2f52f8c83df746153f197cf6fef40a75e3976", "committedDate": "2021-03-18T10:23:55Z", "message": "Use a switch preference to follow device theme"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f1a4e07b9227c72fbe010699cfa87e5ec82181f5", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/f1a4e07b9227c72fbe010699cfa87e5ec82181f5", "committedDate": "2021-03-18T10:17:06Z", "message": "Remove unused string & invert if statements"}, "afterCommit": {"oid": "f87b66fea4a77eb8c297a17b2423beb2579a1e56", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/f87b66fea4a77eb8c297a17b2423beb2579a1e56", "committedDate": "2021-03-18T10:24:00Z", "message": "Use a list for night themes\n\nAlso remove unused string\nAlso invert if statements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a85e8a29ffc6f46d67dc4bbdacbf8f6f6ed818dd", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/a85e8a29ffc6f46d67dc4bbdacbf8f6f6ed818dd", "committedDate": "2021-03-18T11:12:04Z", "message": "Use a list for night themes\n\nAlso remove unused strings"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f87b66fea4a77eb8c297a17b2423beb2579a1e56", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/f87b66fea4a77eb8c297a17b2423beb2579a1e56", "committedDate": "2021-03-18T10:24:00Z", "message": "Use a list for night themes\n\nAlso remove unused string\nAlso invert if statements"}, "afterCommit": {"oid": "fc1a963ed18586844ca3222ff0da7886cac69939", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/fc1a963ed18586844ca3222ff0da7886cac69939", "committedDate": "2021-03-18T11:35:53Z", "message": "Refactor ThemeHelper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "731c65cd59e72921389c114f5f5ba4da8374336c", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/731c65cd59e72921389c114f5f5ba4da8374336c", "committedDate": "2021-03-18T11:39:29Z", "message": "Refactor ThemeHelper"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fc1a963ed18586844ca3222ff0da7886cac69939", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/fc1a963ed18586844ca3222ff0da7886cac69939", "committedDate": "2021-03-18T11:35:53Z", "message": "Refactor ThemeHelper"}, "afterCommit": {"oid": "731c65cd59e72921389c114f5f5ba4da8374336c", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/731c65cd59e72921389c114f5f5ba4da8374336c", "committedDate": "2021-03-18T11:39:29Z", "message": "Refactor ThemeHelper"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjE1MzA1Nzkz", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3632#pullrequestreview-615305793", "createdAt": "2021-03-18T12:07:59Z", "commit": {"oid": "731c65cd59e72921389c114f5f5ba4da8374336c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4165, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}