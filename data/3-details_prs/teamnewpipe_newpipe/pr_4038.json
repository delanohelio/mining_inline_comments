{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYwOTQyNTA1", "number": 4038, "title": "Remember last selected media type for downloads.", "bodyText": "What is it?\n\n Feature (user facing)\n\nDescription of the changes in your PR\n\n\nNewPipe now remembers which media type was downloaded last and will select that option the next time the user wants to download something.\n\nFixes the following issue(s)\n\nCloses #3490. This implementation follows the suggestion (2): remember last choice.\nReplaces PR #3901.\n\nTesting apk\n\ndebug.zip\nAgreement\n\n I carefully read the contribution guidelines and agree to them. Please note that I do not plan to maintain this feature.", "createdAt": "2020-08-01T09:16:34Z", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4038", "merged": true, "mergeCommit": {"oid": "0fd1e2fcd9a944ac35eabe4c904fdc95acaecd17"}, "closed": true, "closedAt": "2020-09-03T18:11:37Z", "author": {"login": "vmazoyer"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc6m__xgFqTQ1OTU3MDc0NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFUqmGgFqTQ4MjA4NTYxNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5NTcwNzQ1", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4038#pullrequestreview-459570745", "createdAt": "2020-08-01T10:57:54Z", "commit": {"oid": "f82955d5c8356b79bae20c0bb2050be4a63f6d4a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMVQxMDo1Nzo1NFrOG6dTUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMVQxMToxOTowOFrOG6dZ7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk1MDY3NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    String defaultMedia = prefs.getString(getString(R.string.last_used_download_type),\n          \n          \n            \n                    final String defaultMedia = prefs.getString(getString(R.string.last_used_download_type),", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4038#discussion_r463950675", "createdAt": "2020-08-01T10:57:54Z", "author": {"login": "TobiGr"}, "path": "app/src/main/java/org/schabi/newpipe/download/DownloadDialog.java", "diffHunk": "@@ -515,7 +515,22 @@ protected void setupDownloadOptions() {\n         videoButton.setVisibility(isVideoStreamsAvailable ? View.VISIBLE : View.GONE);\n         subtitleButton.setVisibility(isSubtitleStreamsAvailable ? View.VISIBLE : View.GONE);\n \n-        if (isVideoStreamsAvailable) {\n+        prefs = PreferenceManager.getDefaultSharedPreferences(getContext());\n+        String defaultMedia = prefs.getString(getString(R.string.last_used_download_type),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f82955d5c8356b79bae20c0bb2050be4a63f6d4a"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk1MTEzMw==", "bodyText": "(defaultMedia.equals(getString(R.string.video)) this will fail to detect the last used type when the user changed tha pplication language. Please create three keys in settings_keys.xml to avoid that.", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4038#discussion_r463951133", "createdAt": "2020-08-01T11:03:47Z", "author": {"login": "TobiGr"}, "path": "app/src/main/java/org/schabi/newpipe/download/DownloadDialog.java", "diffHunk": "@@ -515,7 +515,22 @@ protected void setupDownloadOptions() {\n         videoButton.setVisibility(isVideoStreamsAvailable ? View.VISIBLE : View.GONE);\n         subtitleButton.setVisibility(isSubtitleStreamsAvailable ? View.VISIBLE : View.GONE);\n \n-        if (isVideoStreamsAvailable) {\n+        prefs = PreferenceManager.getDefaultSharedPreferences(getContext());\n+        String defaultMedia = prefs.getString(getString(R.string.last_used_download_type),\n+                    getString(R.string.video));\n+\n+        assert defaultMedia != null;\n+        if (isVideoStreamsAvailable && (defaultMedia.equals(getString(R.string.video)))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f82955d5c8356b79bae20c0bb2050be4a63f6d4a"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk1MjM2NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    SharedPreferences.Editor editor = prefs.edit();\n          \n          \n            \n                    final SharedPreferences.Editor editor = prefs.edit();", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4038#discussion_r463952364", "createdAt": "2020-08-01T11:19:08Z", "author": {"login": "TobiGr"}, "path": "app/src/main/java/org/schabi/newpipe/download/DownloadDialog.java", "diffHunk": "@@ -663,6 +682,11 @@ private void prepareSelectedDownload() {\n \n         // check for existing file with the same name\n         checkSelectedDownload(mainStorage, mainStorage.findFile(filename), filename, mime);\n+\n+        // remember the last media type downloaded by the user\n+        SharedPreferences.Editor editor = prefs.edit();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f82955d5c8356b79bae20c0bb2050be4a63f6d4a"}, "originalPosition": 61}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3OTg1OTg0", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4038#pullrequestreview-467985984", "createdAt": "2020-08-15T13:34:41Z", "commit": {"oid": "4f40bd6ae58c9d8732f8ba2f3c842a2a8b3264bf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNVQxMzozNDo0MlrOHBKf2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNVQxMzozNDo0MlrOHBKf2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk4MjYxOQ==", "bodyText": "According to the docs, getString(resInt) cannot be null, thus defaultMedia cannot be null (as long as we don't put anything stupid into the preferences, which we clearly do not). I think, the assertion can be removed.", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4038#discussion_r470982619", "createdAt": "2020-08-15T13:34:42Z", "author": {"login": "TobiGr"}, "path": "app/src/main/java/org/schabi/newpipe/download/DownloadDialog.java", "diffHunk": "@@ -515,7 +515,24 @@ protected void setupDownloadOptions() {\n         videoButton.setVisibility(isVideoStreamsAvailable ? View.VISIBLE : View.GONE);\n         subtitleButton.setVisibility(isSubtitleStreamsAvailable ? View.VISIBLE : View.GONE);\n \n-        if (isVideoStreamsAvailable) {\n+        prefs = PreferenceManager.getDefaultSharedPreferences(getContext());\n+        final String defaultMedia = prefs.getString(getString(R.string.last_used_download_type),\n+                    getString(R.string.last_download_type_video_key));\n+\n+        assert defaultMedia != null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f40bd6ae58c9d8732f8ba2f3c842a2a8b3264bf"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyMDU5Njkx", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4038#pullrequestreview-482059691", "createdAt": "2020-09-03T17:34:51Z", "commit": {"oid": "0cdcfc98cb79f64f01910a259d9fcc6fdf17536a"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99442b6e0489de74cc22f6bb404dfc33ea08ec7c", "author": {"user": {"login": "vmazoyer", "name": "Vincent Mazoyer"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/99442b6e0489de74cc22f6bb404dfc33ea08ec7c", "committedDate": "2020-09-03T17:47:34Z", "message": "Remember last selected media type for downloads."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0cdcfc98cb79f64f01910a259d9fcc6fdf17536a", "author": {"user": {"login": "vmazoyer", "name": "Vincent Mazoyer"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/0cdcfc98cb79f64f01910a259d9fcc6fdf17536a", "committedDate": "2020-08-30T13:21:09Z", "message": "Merge branch 'dev' into remember_dl_pref"}, "afterCommit": {"oid": "99442b6e0489de74cc22f6bb404dfc33ea08ec7c", "author": {"user": {"login": "vmazoyer", "name": "Vincent Mazoyer"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/99442b6e0489de74cc22f6bb404dfc33ea08ec7c", "committedDate": "2020-09-03T17:47:34Z", "message": "Remember last selected media type for downloads."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyMDg1NjE0", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4038#pullrequestreview-482085614", "createdAt": "2020-09-03T18:11:29Z", "commit": {"oid": "99442b6e0489de74cc22f6bb404dfc33ea08ec7c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4105, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}