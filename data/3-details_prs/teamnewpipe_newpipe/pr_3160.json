{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxODQwOTk4", "number": 3160, "title": "Hide 5, 15, 25 second seek options if inexact seek is enabled", "bodyText": "I carefully read the contribution guidelines and agree to them.\n\ncloses #3127\nHides 5, 15, 25 second seek options if inexact seek is enabled. If one of those values was selected while activating inexact seek, it automatically gets set to 10 seconds.\nWill the edited string resource make any problems concerning translation with weblate, since it was not a rewrite but adding additional info.\nI tested it on my Android 10 and 7.1 devices.\nUpdated apk: app-debug.zip", "createdAt": "2020-02-29T12:02:01Z", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3160", "merged": true, "mergeCommit": {"oid": "d5c29bf1b540e8e9243651b6d43baa177884c29a"}, "closed": true, "closedAt": "2020-03-03T20:58:19Z", "author": {"login": "XiangRongLin"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcJzqztgFqTM2NzQ5NzUyMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKIsITAFqTM2ODMxNTMzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3NDk3NTIy", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3160#pullrequestreview-367497522", "createdAt": "2020-03-02T20:17:59Z", "commit": {"oid": "8a077c46958e3f550309b45bd0a257e763586071"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQyMDoxNzo1OVrOFwt0ZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQyMDoyMjoxNVrOFwt8Sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyNjY2MA==", "bodyText": "Add a newline here:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    final ListPreference durations = (ListPreference) findPreference(getString(R.string.seek_duration_key));\n          \n          \n            \n            \n          \n          \n            \n                    final ListPreference durations = (ListPreference) findPreference(getString(R.string.seek_duration_key));", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3160#discussion_r386626660", "createdAt": "2020-03-02T20:17:59Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/settings/VideoAudioSettingsFragment.java", "diffHunk": "@@ -58,10 +46,59 @@ public void onCreate(@Nullable Bundle savedInstanceState) {\n                             .show();\n \n                 }\n+            } else if (s.equals(getString(R.string.use_inexact_seek_key))) {\n+                updateSeekOptions();\n             }\n         };\n     }\n \n+    /**\n+     * Update fast-forward/-rewind seek duration options according to language and inexact seek setting.\n+     * Exoplayer can't seek 5 seconds in audio when using inexact seek.\n+     */\n+    private void updateSeekOptions() {\n+        //initializing R.array.seek_duration_description to display the translation of seconds\n+        final Resources res = getResources();\n+        final String[] durationsValues = res.getStringArray(R.array.seek_duration_value);\n+        final List<String> displayedDurationValues = new LinkedList<>();\n+        final List<String> displayedDescriptionValues = new LinkedList<>();\n+        int currentDurationValue;\n+        final boolean inexactSeek = getPreferenceManager().getSharedPreferences()\n+            .getBoolean(res.getString(R.string.use_inexact_seek_key), false);\n+\n+        for (String durationsValue : durationsValues) {\n+            currentDurationValue =\n+                Integer.parseInt(durationsValue) / (int) DateUtils.SECOND_IN_MILLIS;\n+            if (inexactSeek && currentDurationValue % 10 == 5) {\n+                continue;\n+            }\n+            try {\n+                displayedDurationValues.add(durationsValue);\n+                displayedDescriptionValues.add(String.format(\n+                    res.getQuantityString(R.plurals.dynamic_seek_duration_description,\n+                        currentDurationValue),\n+                    currentDurationValue));\n+            } catch (Resources.NotFoundException ignored) {\n+                //if this happens, the translation is missing, and the english string will be displayed instead\n+            }\n+        }\n+        final ListPreference durations = (ListPreference) findPreference(getString(R.string.seek_duration_key));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a077c46958e3f550309b45bd0a257e763586071"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyODY4Mg==", "bodyText": "Shouldn't this have a %s indicating where the \"X seconds\" string should be inserted? For English it is ok for this to be at the end, but for other languages this could be different.", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3160#discussion_r386628682", "createdAt": "2020-03-02T20:22:15Z", "author": {"login": "Stypox"}, "path": "app/src/main/res/values/strings.xml", "diffHunk": "@@ -593,6 +593,7 @@\n     <string name=\"app_language_title\">App language</string>\n     <string name=\"systems_language\">System default</string>\n     <string name=\"dynamic_seek_duration_description\">%s seconds</string>\n+    <string name=\"new_seek_duration_toast\">Due to ExoPlayer contraints the seek duration was set to</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a077c46958e3f550309b45bd0a257e763586071"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57504acd0017b2825ecbb68a4ff7bec9c7f64fdc", "author": {"user": {"login": "XiangRongLin", "name": null}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/57504acd0017b2825ecbb68a4ff7bec9c7f64fdc", "committedDate": "2020-03-03T18:40:10Z", "message": "If inexact seekt is used, hide 5,15,25 seconds seek duration options when opening settings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "446380433804c1c38213c37562d8d34151caca3b", "author": {"user": {"login": "XiangRongLin", "name": null}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/446380433804c1c38213c37562d8d34151caca3b", "committedDate": "2020-03-03T18:40:10Z", "message": "Update seek options on inexact seek option change.\nReset to 10 seconds when previous value is not valid anymore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "288a61895cde2c271ae80c7b927a0200ca1480c9", "author": {"user": {"login": "XiangRongLin", "name": null}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/288a61895cde2c271ae80c7b927a0200ca1480c9", "committedDate": "2020-03-03T18:40:10Z", "message": "Update inexact seek summary"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a42714326dbd42dabdf4b072cf25396fa4da529", "author": {"user": {"login": "XiangRongLin", "name": null}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/6a42714326dbd42dabdf4b072cf25396fa4da529", "committedDate": "2020-03-03T18:40:10Z", "message": "Round seek duration up instead of setting it to 10 seconds"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d3b21582cc94b3954d88d57ec3c186712396a78", "author": {"user": {"login": "XiangRongLin", "name": null}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/7d3b21582cc94b3954d88d57ec3c186712396a78", "committedDate": "2020-03-03T18:40:10Z", "message": "Use DateUtils constant for 1000"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3fff4356a5c7cc4138f9a4dde954cf2bdea03ef", "author": {"user": {"login": "XiangRongLin", "name": null}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/e3fff4356a5c7cc4138f9a4dde954cf2bdea03ef", "committedDate": "2020-03-03T18:40:10Z", "message": "Show a toast when seek duration was rounded up"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8a077c46958e3f550309b45bd0a257e763586071", "author": {"user": {"login": "XiangRongLin", "name": null}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/8a077c46958e3f550309b45bd0a257e763586071", "committedDate": "2020-03-02T19:15:54Z", "message": "Show a toast when seek duration was rounded up"}, "afterCommit": {"oid": "e3fff4356a5c7cc4138f9a4dde954cf2bdea03ef", "author": {"user": {"login": "XiangRongLin", "name": null}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/e3fff4356a5c7cc4138f9a4dde954cf2bdea03ef", "committedDate": "2020-03-03T18:40:10Z", "message": "Show a toast when seek duration was rounded up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efb67b0fd4e98fe5e99b6d323a4d8686bc6c06f7", "author": {"user": {"login": "XiangRongLin", "name": null}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/efb67b0fd4e98fe5e99b6d323a4d8686bc6c06f7", "committedDate": "2020-03-03T18:50:50Z", "message": "Change toast string resource to be useable with different languages"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MjczODcw", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3160#pullrequestreview-368273870", "createdAt": "2020-03-03T19:47:46Z", "commit": {"oid": "efb67b0fd4e98fe5e99b6d323a4d8686bc6c06f7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxOTo0Nzo0NlrOFxUFrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxOTo0Nzo0NlrOFxUFrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzI1MzY3OQ==", "bodyText": "Even though this is not relative to this PR, I think this line should be before the try-catch, since it can't throw an exception, and for a moment it led me to thinking that for missing translations the value would not be added.\nAlso note the added newline.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        try {\n          \n          \n            \n                            displayedDurationValues.add(durationsValue);\n          \n          \n            \n            \n          \n          \n            \n                        displayedDurationValues.add(durationsValue);\n          \n          \n            \n                        try {", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3160#discussion_r387253679", "createdAt": "2020-03-03T19:47:46Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/settings/VideoAudioSettingsFragment.java", "diffHunk": "@@ -58,10 +46,58 @@ public void onCreate(@Nullable Bundle savedInstanceState) {\n                             .show();\n \n                 }\n+            } else if (s.equals(getString(R.string.use_inexact_seek_key))) {\n+                updateSeekOptions();\n             }\n         };\n     }\n \n+    /**\n+     * Update fast-forward/-rewind seek duration options according to language and inexact seek setting.\n+     * Exoplayer can't seek 5 seconds in audio when using inexact seek.\n+     */\n+    private void updateSeekOptions() {\n+        //initializing R.array.seek_duration_description to display the translation of seconds\n+        final Resources res = getResources();\n+        final String[] durationsValues = res.getStringArray(R.array.seek_duration_value);\n+        final List<String> displayedDurationValues = new LinkedList<>();\n+        final List<String> displayedDescriptionValues = new LinkedList<>();\n+        int currentDurationValue;\n+        final boolean inexactSeek = getPreferenceManager().getSharedPreferences()\n+            .getBoolean(res.getString(R.string.use_inexact_seek_key), false);\n+\n+        for (String durationsValue : durationsValues) {\n+            currentDurationValue =\n+                Integer.parseInt(durationsValue) / (int) DateUtils.SECOND_IN_MILLIS;\n+            if (inexactSeek && currentDurationValue % 10 == 5) {\n+                continue;\n+            }\n+            try {\n+                displayedDurationValues.add(durationsValue);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efb67b0fd4e98fe5e99b6d323a4d8686bc6c06f7"}, "originalPosition": 72}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7ef7a18ac764f53c7b2a748af43a34a252abe90", "author": {"user": {"login": "XiangRongLin", "name": null}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/f7ef7a18ac764f53c7b2a748af43a34a252abe90", "committedDate": "2020-03-03T20:41:15Z", "message": "Update app/src/main/java/org/schabi/newpipe/settings/VideoAudioSettingsFragment.java\n\nCo-Authored-By: Stypox <stypox@pm.me>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MzEwMDEx", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3160#pullrequestreview-368310011", "createdAt": "2020-03-03T20:44:19Z", "commit": {"oid": "f7ef7a18ac764f53c7b2a748af43a34a252abe90"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MzE0NjUy", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3160#pullrequestreview-368314652", "createdAt": "2020-03-03T20:51:40Z", "commit": {"oid": "f7ef7a18ac764f53c7b2a748af43a34a252abe90"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMDo1MTo0MFrOFxWD5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMDo1MTo0MFrOFxWD5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzI4NTk4OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                <string name=\"new_seek_duration_toast\">Due to ExoPlayer contraints the seek duration was set to %d seconds</string>\n          \n          \n            \n                <string name=\"new_seek_duration_toast\">Due to ExoPlayer constraints the seek duration was set to %d seconds</string>", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3160#discussion_r387285988", "createdAt": "2020-03-03T20:51:40Z", "author": {"login": "Stypox"}, "path": "app/src/main/res/values/strings.xml", "diffHunk": "@@ -593,6 +593,7 @@\n     <string name=\"app_language_title\">App language</string>\n     <string name=\"systems_language\">System default</string>\n     <string name=\"dynamic_seek_duration_description\">%s seconds</string>\n+    <string name=\"new_seek_duration_toast\">Due to ExoPlayer contraints the seek duration was set to %d seconds</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7ef7a18ac764f53c7b2a748af43a34a252abe90"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4bb6a146e8212af975d9c1acd1bbd3cf51fa6af6", "author": {"user": {"login": "Stypox", "name": "Stypox"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/4bb6a146e8212af975d9c1acd1bbd3cf51fa6af6", "committedDate": "2020-03-03T20:51:46Z", "message": "Update app/src/main/res/values/strings.xml"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MzE1MzMw", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3160#pullrequestreview-368315330", "createdAt": "2020-03-03T20:52:46Z", "commit": {"oid": "4bb6a146e8212af975d9c1acd1bbd3cf51fa6af6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4036, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}