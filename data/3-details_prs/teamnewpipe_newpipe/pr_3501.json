{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwNjEzMzg4", "number": 3501, "title": "Open in browser button now really opens in browser", "bodyText": "What is it?\n\n Bug fix (user facing)\n Feature (user facing)\n Code base improvement (dev facing)\n Meta improvement to the project (dev facing)\n\nDescription of the changes in your PR\n\n\nOpen in browser buttons open in default browser for android 6+ (otherwise no change).\n\nFixes the following issue(s)\n\nOpen in browser button not opening in browser, but either showing a chooser, or worse: opening in NewPipe if NewPipe is set as default for youtube links. I just wanna open in browser\n\nIt will only work for android 6+ since it uses default apps, available from settings -> apps -> more -> default apps -> browser app, a new feature in android 6, otherwise it will not change. It will also not change if you have no browser set as default. It's a rare case, because if you have only one browser that does not happen, if you have two, as soon as you choose one browser as default for opening a link, it will be set default in that selector.\nTherefore there are only two such cases: fresh new browser install, or not any link set as default.\nI've tested with Firefox, Firefox preview and a chromium based browser and had no troubles with this code (I first had a problem with Firefox browsers but changed the way to send the intent, following playWithKore() and now it works).\nTesting apk\nNewPipe_openInBrowser.zip\nAgreement\n\n I carefully read the contribution guidelines and agree to them.", "createdAt": "2020-04-29T10:06:45Z", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3501", "merged": true, "mergeCommit": {"oid": "a3e2a085b635f5a4c06530cc9ca9be38fd5bdb5c"}, "closed": true, "closedAt": "2020-05-21T07:24:58Z", "author": {"login": "B0pol"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABciycIKgFqTQxNDMzNjI3Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjCwLgAFqTQxNTAxNTk3Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0MzM2Mjcz", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3501#pullrequestreview-414336273", "createdAt": "2020-05-19T11:05:24Z", "commit": {"oid": "f7cd4d5989b8f1056366c98ed95f0afea6718033"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMTowNToyNFrOGXbO_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMTowNToyNFrOGXbO_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzIxNjYzNg==", "bodyText": "Maybe the title should be changed to something like \"Open in browser\"", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3501#discussion_r427216636", "createdAt": "2020-05-19T11:05:24Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/util/ShareUtils.java", "diffHunk": "@@ -2,19 +2,77 @@\n \n import android.content.Context;\n import android.content.Intent;\n+import android.content.pm.PackageManager;\n+import android.content.pm.ResolveInfo;\n import android.net.Uri;\n \n import org.schabi.newpipe.R;\n \n public final class ShareUtils {\n-    private ShareUtils() { }\n+    private ShareUtils() {\n+    }\n \n+    /**\n+     * Open the url with the system default browser.\n+     * <p>\n+     * If no browser is set as default, fallbacks to\n+     * {@link ShareUtils#openUrlBrowserChooser(Context, String)}\n+     *\n+     * @param context the context to use\n+     * @param url     the url to browse\n+     */\n     public static void openUrlInBrowser(final Context context, final String url) {\n-        Intent intent = new Intent(Intent.ACTION_VIEW, Uri.parse(url));\n+        final Intent intent = new Intent(Intent.ACTION_VIEW);\n+        intent.setData(Uri.parse(url));\n+\n+        final String defaultBrowserPackageName = getDefaultBrowserPackageName(context);\n+\n+        if (defaultBrowserPackageName.equals(\"android\")) {\n+            // no browser set as default\n+            openUrlBrowserChooser(context, url);\n+        } else {\n+            intent.setPackage(defaultBrowserPackageName);\n+            context.startActivity(intent);\n+        }\n+    }\n+\n+    /**\n+     * Open the url with application chooser, including browser and apps able to open url.\n+     * <p>\n+     * If any app (except browser, typically NewPipe) is set as default,\n+     * it will nor open in browser, neither open the chooser, but just the default app.\n+     *\n+     * @param context the context to use\n+     * @param url     the url to browse\n+     */\n+    private static void openUrlBrowserChooser(final Context context, final String url) {\n+        final Intent intent = new Intent(Intent.ACTION_VIEW, Uri.parse(url));\n         context.startActivity(Intent.createChooser(\n                 intent, context.getString(R.string.share_dialog_title)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7cd4d5989b8f1056366c98ed95f0afea6718033"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NDAzNTAx", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3501#pullrequestreview-414403501", "createdAt": "2020-05-19T12:41:45Z", "commit": {"oid": "f7cd4d5989b8f1056366c98ed95f0afea6718033"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMjo0MTo0NVrOGXegmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMjo0MTo0NVrOGXegmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzI3MDI5OQ==", "bodyText": "Move the intent instantiation code inside the else branch, as it is not needed otherwise", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3501#discussion_r427270299", "createdAt": "2020-05-19T12:41:45Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/util/ShareUtils.java", "diffHunk": "@@ -2,19 +2,77 @@\n \n import android.content.Context;\n import android.content.Intent;\n+import android.content.pm.PackageManager;\n+import android.content.pm.ResolveInfo;\n import android.net.Uri;\n \n import org.schabi.newpipe.R;\n \n public final class ShareUtils {\n-    private ShareUtils() { }\n+    private ShareUtils() {\n+    }\n \n+    /**\n+     * Open the url with the system default browser.\n+     * <p>\n+     * If no browser is set as default, fallbacks to\n+     * {@link ShareUtils#openUrlBrowserChooser(Context, String)}\n+     *\n+     * @param context the context to use\n+     * @param url     the url to browse\n+     */\n     public static void openUrlInBrowser(final Context context, final String url) {\n-        Intent intent = new Intent(Intent.ACTION_VIEW, Uri.parse(url));\n+        final Intent intent = new Intent(Intent.ACTION_VIEW);\n+        intent.setData(Uri.parse(url));\n+\n+        final String defaultBrowserPackageName = getDefaultBrowserPackageName(context);\n+\n+        if (defaultBrowserPackageName.equals(\"android\")) {\n+            // no browser set as default\n+            openUrlBrowserChooser(context, url);\n+        } else {\n+            intent.setPackage(defaultBrowserPackageName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7cd4d5989b8f1056366c98ed95f0afea6718033"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NDA5MTc4", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3501#pullrequestreview-414409178", "createdAt": "2020-05-19T12:48:36Z", "commit": {"oid": "f7cd4d5989b8f1056366c98ed95f0afea6718033"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMjo0ODozNlrOGXex_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMjo0ODozNlrOGXex_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzI3NDc0OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    final Intent intent = new Intent(Intent.ACTION_VIEW);\n          \n          \n            \n                    intent.setData(Uri.parse(url));\n          \n          \n            \n                    final Intent intent = new Intent(Intent.ACTION_VIEW, Uri.parse(url));", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3501#discussion_r427274748", "createdAt": "2020-05-19T12:48:36Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/util/ShareUtils.java", "diffHunk": "@@ -2,19 +2,77 @@\n \n import android.content.Context;\n import android.content.Intent;\n+import android.content.pm.PackageManager;\n+import android.content.pm.ResolveInfo;\n import android.net.Uri;\n \n import org.schabi.newpipe.R;\n \n public final class ShareUtils {\n-    private ShareUtils() { }\n+    private ShareUtils() {\n+    }\n \n+    /**\n+     * Open the url with the system default browser.\n+     * <p>\n+     * If no browser is set as default, fallbacks to\n+     * {@link ShareUtils#openUrlBrowserChooser(Context, String)}\n+     *\n+     * @param context the context to use\n+     * @param url     the url to browse\n+     */\n     public static void openUrlInBrowser(final Context context, final String url) {\n-        Intent intent = new Intent(Intent.ACTION_VIEW, Uri.parse(url));\n+        final Intent intent = new Intent(Intent.ACTION_VIEW);\n+        intent.setData(Uri.parse(url));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7cd4d5989b8f1056366c98ed95f0afea6718033"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a938093e2b8a2ad2dfa01c391af89ab38589605", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/9a938093e2b8a2ad2dfa01c391af89ab38589605", "committedDate": "2020-05-19T19:51:47Z", "message": "Open in browser button now really opens in browser"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97437b8af3ac20580f8d75178ed320691393f796", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/97437b8af3ac20580f8d75178ed320691393f796", "committedDate": "2020-05-19T19:52:30Z", "message": "apply @stypox suggestions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e13161f64c06f3d47a72ae2c075538998f5887c", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/8e13161f64c06f3d47a72ae2c075538998f5887c", "committedDate": "2020-05-19T19:57:46Z", "message": "fix checkstyle"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f7cd4d5989b8f1056366c98ed95f0afea6718033", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/f7cd4d5989b8f1056366c98ed95f0afea6718033", "committedDate": "2020-04-29T09:45:01Z", "message": "Open in browser button now really opens in browser"}, "afterCommit": {"oid": "8e13161f64c06f3d47a72ae2c075538998f5887c", "author": {"user": {"login": "B0pol", "name": "bopol"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/8e13161f64c06f3d47a72ae2c075538998f5887c", "committedDate": "2020-05-19T19:57:46Z", "message": "fix checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1MDE1OTcz", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3501#pullrequestreview-415015973", "createdAt": "2020-05-20T06:05:52Z", "commit": {"oid": "8e13161f64c06f3d47a72ae2c075538998f5887c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4158, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}