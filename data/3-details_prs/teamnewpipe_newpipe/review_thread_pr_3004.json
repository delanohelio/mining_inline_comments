{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3MTM0MDk0", "number": 3004, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo1ODoxOFrODbQFfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo1ODoxOFrODbQFfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5OTAxNjk0OnYy", "diffSide": "RIGHT", "path": "app/src/main/java/org/schabi/newpipe/settings/VideoAudioSettingsFragment.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo1ODoxOFrOFioIrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo1ODoxOFrOFioIrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg1MzQ4NQ==", "bodyText": "Suggestion:\npublic void onSharedPreferenceChanged(SharedPreferences sharedPreferences, String s) {\n    // on M and above, if user chooses to minimise to popup player on exit and the app doesn't have\n    // display over other apps permission, so show a snackbar to let the user give permission\n    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M &&\n            s.equals(getString(R.string.minimize_on_exit_key))) {\n\n        String newSetting = sharedPreferences.getString(s,null);\n        if(newSetting != null &&\n                newSetting.equals(getString(R.string.minimize_on_exit_popup_key)) &&\n                !Settings.canDrawOverlays(getContext())) {\n\n            Snackbar.make(getListView(),R.string.permission_display_over_apps,Snackbar.LENGTH_INDEFINITE)\n                           .setAction(R.string.settings, new View.OnClickListener() {\n                               @Override\n                               public void onClick(View view) {\n                                   PermissionHelper.checkSystemAlertWindowPermission(getContext());\n                               }\n                           })\n                           .show();\n        }\n    }\n}", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3004#discussion_r371853485", "createdAt": "2020-01-28T14:58:18Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/settings/VideoAudioSettingsFragment.java", "diffHunk": "@@ -1,12 +1,75 @@\n package org.schabi.newpipe.settings;\n \n+import android.content.SharedPreferences;\n+import android.os.Build;\n import android.os.Bundle;\n+import android.provider.Settings;\n+import android.view.View;\n+\n+import androidx.annotation.Nullable;\n+\n+import com.google.android.material.snackbar.Snackbar;\n \n import org.schabi.newpipe.R;\n+import org.schabi.newpipe.util.PermissionHelper;\n \n public class VideoAudioSettingsFragment extends BasePreferenceFragment {\n+\n+    private SharedPreferences.OnSharedPreferenceChangeListener listener;\n+\n+    @Override\n+    public void onCreate(@Nullable Bundle savedInstanceState) {\n+        super.onCreate(savedInstanceState);\n+\n+        listener = new SharedPreferences.OnSharedPreferenceChangeListener() {\n+            @Override\n+            public void onSharedPreferenceChanged(SharedPreferences sharedPreferences, String s) {\n+\n+                //on M and above, if user chooses to minimise to popup player on exit and the app doesn't have\n+                //display over other apps permission, show a snackbar to let the user give permission\n+                if(s.equals(getString(R.string.minimize_on_exit_key))){\n+\n+                    String newSetting = sharedPreferences.getString(s,null);\n+                    if(newSetting != null){\n+\n+                        if(newSetting.equals(getString(R.string.minimize_on_exit_popup_key))){\n+\n+                            if(Build.VERSION.SDK_INT >= Build.VERSION_CODES.M && !Settings.canDrawOverlays(getContext())){\n+\n+                                Snackbar.make(getListView(),R.string.permission_display_over_apps,Snackbar.LENGTH_INDEFINITE)\n+                                        .setAction(R.string.settings, new View.OnClickListener() {\n+                                            @Override\n+                                            public void onClick(View view) {\n+                                                PermissionHelper.checkSystemAlertWindowPermission(getContext());\n+                                            }\n+                                        })\n+                                        .show();\n+\n+                            }\n+                        }\n+                    }\n+                }\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f24c186146c17f6fe5e140539cc7e56b2266062"}, "originalPosition": 52}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3250, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}