{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3MTM0MDk0", "number": 3004, "title": "ask for display over other apps permission in settings", "bodyText": "I carefully read the contribution guidelines and agree to them.\n\n#2922 - This issue seems to happen on any device on Android 6 and above. Specifically on Android 10, it seems like it doesn't open the Settings window for the permission when the home button is pressed. But even in cases where it does show the window, it won't open the popup window when you give it the permission.\nSo i added a snackbar that lets the user go to the settings when they set the \"minimise on home\" option to \"minimise to popup player\".", "createdAt": "2020-01-25T17:06:34Z", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3004", "merged": true, "mergeCommit": {"oid": "bcb3cb9125808a350aedd673a573f54f8c588ed2"}, "closed": true, "closedAt": "2020-02-01T13:28:03Z", "author": {"login": "harshlele"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb92mHegH2gAyMzY3MTM0MDk0OmUxMTQ1ZjE2ZjJiNDliMDdkNmE3NGQzZWJlMWZlNmUyMjA5NWVjM2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcADvIwgFqTM1MTg4NDM4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e1145f16f2b49b07d6a74d3ebe1fe6e22095ec3b", "author": {"user": {"login": "harshlele", "name": null}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/e1145f16f2b49b07d6a74d3ebe1fe6e22095ec3b", "committedDate": "2020-01-25T17:00:49Z", "message": "ask for display over other apps permission in settings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52420d4bf109bc36d4b299283f317aa43e86ff06", "author": {"user": {"login": "harshlele", "name": null}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/52420d4bf109bc36d4b299283f317aa43e86ff06", "committedDate": "2020-01-26T04:27:30Z", "message": "Merge branch 'dev' into ask-overlay-perm-settings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f24c186146c17f6fe5e140539cc7e56b2266062", "author": {"user": {"login": "harshlele", "name": null}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/1f24c186146c17f6fe5e140539cc7e56b2266062", "committedDate": "2020-01-28T14:44:35Z", "message": "reformatted and commented code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5NDQwNzM5", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3004#pullrequestreview-349440739", "createdAt": "2020-01-28T14:58:18Z", "commit": {"oid": "1f24c186146c17f6fe5e140539cc7e56b2266062"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo1ODoxOFrOFioIrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo1ODoxOFrOFioIrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg1MzQ4NQ==", "bodyText": "Suggestion:\npublic void onSharedPreferenceChanged(SharedPreferences sharedPreferences, String s) {\n    // on M and above, if user chooses to minimise to popup player on exit and the app doesn't have\n    // display over other apps permission, so show a snackbar to let the user give permission\n    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M &&\n            s.equals(getString(R.string.minimize_on_exit_key))) {\n\n        String newSetting = sharedPreferences.getString(s,null);\n        if(newSetting != null &&\n                newSetting.equals(getString(R.string.minimize_on_exit_popup_key)) &&\n                !Settings.canDrawOverlays(getContext())) {\n\n            Snackbar.make(getListView(),R.string.permission_display_over_apps,Snackbar.LENGTH_INDEFINITE)\n                           .setAction(R.string.settings, new View.OnClickListener() {\n                               @Override\n                               public void onClick(View view) {\n                                   PermissionHelper.checkSystemAlertWindowPermission(getContext());\n                               }\n                           })\n                           .show();\n        }\n    }\n}", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3004#discussion_r371853485", "createdAt": "2020-01-28T14:58:18Z", "author": {"login": "Stypox"}, "path": "app/src/main/java/org/schabi/newpipe/settings/VideoAudioSettingsFragment.java", "diffHunk": "@@ -1,12 +1,75 @@\n package org.schabi.newpipe.settings;\n \n+import android.content.SharedPreferences;\n+import android.os.Build;\n import android.os.Bundle;\n+import android.provider.Settings;\n+import android.view.View;\n+\n+import androidx.annotation.Nullable;\n+\n+import com.google.android.material.snackbar.Snackbar;\n \n import org.schabi.newpipe.R;\n+import org.schabi.newpipe.util.PermissionHelper;\n \n public class VideoAudioSettingsFragment extends BasePreferenceFragment {\n+\n+    private SharedPreferences.OnSharedPreferenceChangeListener listener;\n+\n+    @Override\n+    public void onCreate(@Nullable Bundle savedInstanceState) {\n+        super.onCreate(savedInstanceState);\n+\n+        listener = new SharedPreferences.OnSharedPreferenceChangeListener() {\n+            @Override\n+            public void onSharedPreferenceChanged(SharedPreferences sharedPreferences, String s) {\n+\n+                //on M and above, if user chooses to minimise to popup player on exit and the app doesn't have\n+                //display over other apps permission, show a snackbar to let the user give permission\n+                if(s.equals(getString(R.string.minimize_on_exit_key))){\n+\n+                    String newSetting = sharedPreferences.getString(s,null);\n+                    if(newSetting != null){\n+\n+                        if(newSetting.equals(getString(R.string.minimize_on_exit_popup_key))){\n+\n+                            if(Build.VERSION.SDK_INT >= Build.VERSION_CODES.M && !Settings.canDrawOverlays(getContext())){\n+\n+                                Snackbar.make(getListView(),R.string.permission_display_over_apps,Snackbar.LENGTH_INDEFINITE)\n+                                        .setAction(R.string.settings, new View.OnClickListener() {\n+                                            @Override\n+                                            public void onClick(View view) {\n+                                                PermissionHelper.checkSystemAlertWindowPermission(getContext());\n+                                            }\n+                                        })\n+                                        .show();\n+\n+                            }\n+                        }\n+                    }\n+                }\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f24c186146c17f6fe5e140539cc7e56b2266062"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a78762756a68b8db5fd711f461e53b8aed0a3c48", "author": {"user": {"login": "harshlele", "name": null}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/a78762756a68b8db5fd711f461e53b8aed0a3c48", "committedDate": "2020-01-28T15:24:24Z", "message": "reformatted code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5NTA3ODE4", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3004#pullrequestreview-349507818", "createdAt": "2020-01-28T16:16:13Z", "commit": {"oid": "a78762756a68b8db5fd711f461e53b8aed0a3c48"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7203d4ac9666c1eee10374210c2f92ec50a2eba", "author": {"user": {"login": "TobiGr", "name": "Tobi"}}, "url": "https://github.com/TeamNewPipe/NewPipe/commit/f7203d4ac9666c1eee10374210c2f92ec50a2eba", "committedDate": "2020-02-01T12:41:03Z", "message": "Fix formatting and use lamda functions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxODg0Mzgw", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3004#pullrequestreview-351884380", "createdAt": "2020-02-01T13:27:17Z", "commit": {"oid": "f7203d4ac9666c1eee10374210c2f92ec50a2eba"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4016, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}