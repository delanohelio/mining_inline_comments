{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxNDIwMDU4", "number": 5477, "title": "[C] fix issues on enums", "bodyText": "To fix #5091 that requires enums to be generated when the enum is in a param to a API call, instead than in a model. I did that by copying and adapting enum code from model-body.mustache to api-body.mustache, and from model-header.mustache to model-body.mustache.\nTo fix #4293 that needs to decorate enums, for when enum names or enum values are repeated over the yaml definition.\nI decorated the values of the enums in API's params as {{enumName}}{{{value}}}. The enum name did not need decoration.\nFor models, I decorated the values as {{classFilename}}{{enumName}}{{{value}}}. The enum names were decorated as {{classFilename}}{{classname}}_e.\nAs with pre-PR version, string enums are well supported. If you provide me interesting YAML with other kinds of enums, I can add material to the mustache templates to support them too.\nTake a look at this YAML:\nhttps://gist.github.com/michelealbano/88262eddc22966553055acc20fb6021f\nand to this main.c:\nhttps://gist.github.com/michelealbano/5ebb78590354af4785b345842891ae16\n@zhemant\n@ityuhui\nPR checklist\n\n[ X ] Read the contribution guidelines.\n[ X ] If contributing template-only or documentation-only changes which will change sample output, build the project before.\n[ X ] Run the shell script(s) under ./bin/ (or Windows batch scripts under.\\bin\\windows) to update Petstore samples related to your fix. This is important, as CI jobs will verify all generator outputs of your HEAD commit, and these must match the expectations made by your contribution. You only need to run ./bin/{LANG}-petstore.sh, ./bin/openapi3/{LANG}-petstore.sh if updating the code or mustache templates for a language ({LANG}) (e.g. php, ruby, python, etc).\n[ X ] File the PR against the correct branch: master, 4.3.x, 5.0.x. Default: master.\n[ X ] Copy the technical committee to review the pull request if your PR is targeting a particular programming language.", "createdAt": "2020-02-28T14:30:31Z", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5477", "merged": true, "mergeCommit": {"oid": "fc9d4584ca1144532c0b86db958d7f782098253d"}, "closed": true, "closedAt": "2020-03-16T05:53:55Z", "author": {"login": "michelealbano"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIyPZkgFqTM2NjUxMTE5OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcM-o3-ABqjMxMjM2NjY4MTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NTExMTk4", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5477#pullrequestreview-366511198", "createdAt": "2020-02-28T16:09:33Z", "commit": {"oid": "71a827bbc3288846993d863cec28e9f1dfd9a905"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNjowOTozM1rOFv6UeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNjowOTozM1rOFv6UeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc4MjkwNA==", "bodyText": "Here, the first value when the code is generated will be the actual enum value and its respective number will be 0, so if the enum is mandatory or optional in both cases the enum will be sent. But to avoid this we can make the array start with { NULL , and rest of values}. This will make NULL as 0, so when the enum is optional you can actually skip sending the enum value.", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5477#discussion_r385782904", "createdAt": "2020-02-28T16:09:33Z", "author": {"login": "zhemant"}, "path": "modules/openapi-generator/src/main/resources/C-libcurl/api-body.mustache", "diffHunk": "@@ -11,6 +11,95 @@\n     snprintf(dst, 256, \"%ld\", (long int)(src));\\\n }while(0)\n \n+{{#operations}}\n+{{#operation}}\n+{{#allParams}}\n+\n+{{#isEnum}}\n+// Functions for enum {{enumName}} for {{{classname}}}_{{{operationId}}}\n+\n+\n+char* {{enumName}}_ToString({{baseName}}_e {{enumName}}){\n+char *{{enumName}}Array[] =  { {{#allowableValues}}{{#enumVars}}\"{{{value}}}\"{{^-last}},{{/-last}}{{/enumVars}}{{/allowableValues}} };", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71a827bbc3288846993d863cec28e9f1dfd9a905"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NzgwNzE1", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5477#pullrequestreview-366780715", "createdAt": "2020-02-29T06:14:36Z", "commit": {"oid": "637564baacc2b7fbc03d5aedc6bf59fe9a5b90b7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOVQwNjoxNDozNlrOFwH6oQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOVQwNjoxNDozNlrOFwH6oQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjAwNTY2NQ==", "bodyText": "Hello @michelealbano @zhemant\nActually, for the test case Petstore, the function involve enum is:\nlist_t*\nPetAPI_findPetsByStatus(apiClient_t *apiClient ,list_t * status);\n\nThe status is a list rather than an enum, so it does not need add the code in api-header and api-body.\nyaml snippet of petstore.yaml\nparameters:\n        - name: status\n          in: query\n          description: Status values that need to be considered for filter\n          required: true\n          type: array\n          items:\n            type: string\n            enum:\n              - available\n              - pending\n              - sold\n\nMaybe we need another template code to control whether generating the enum related code in api header and body.", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5477#discussion_r386005665", "createdAt": "2020-02-29T06:14:36Z", "author": {"login": "ityuhui"}, "path": "samples/client/petstore/c/api/PetAPI.c", "diffHunk": "@@ -10,6 +10,83 @@\n     char dst[256];\\\n     snprintf(dst, 256, \"%ld\", (long int)(src));\\\n }while(0)\n+\n+\n+\n+\n+\n+\n+\n+\n+// Functions for enum STATUS for PetAPI_findPetsByStatus\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "637564baacc2b7fbc03d5aedc6bf59fe9a5b90b7"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2ODMzMzAy", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5477#pullrequestreview-366833302", "createdAt": "2020-03-01T03:49:58Z", "commit": {"oid": "637564baacc2b7fbc03d5aedc6bf59fe9a5b90b7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMVQwMzo0OTo1OFrOFwMGlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMVQwMzo0OTo1OFrOFwMGlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA3NDI2MA==", "bodyText": "Hello @michelealbano\nThere are so many blank lines here. Could you please remove them ?", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5477#discussion_r386074260", "createdAt": "2020-03-01T03:49:58Z", "author": {"login": "ityuhui"}, "path": "modules/openapi-generator/src/main/resources/C-libcurl/api-body.mustache", "diffHunk": "@@ -11,6 +11,91 @@\n     snprintf(dst, 256, \"%ld\", (long int)(src));\\\n }while(0)\n \n+{{#operations}}\n+{{#operation}}\n+{{#allParams}}\n+\n+{{#isEnum}}\n+// Functions for enum {{enumName}} for {{{classname}}}_{{{operationId}}}\n+\n+\n+char* {{enumName}}_ToString({{baseName}}_e {{enumName}}){\n+char *{{enumName}}Array[] =  { {{#allowableValues}}{{#enumVars}}\"{{{value}}}\"{{^-last}},{{/-last}}{{/enumVars}}{{/allowableValues}} };\n+    return {{enumName}}Array[{{enumName}}];\n+}\n+\n+{{baseName}}_e {{enumName}}_FromString(char* {{enumName}}){\n+    int stringToReturn = 0;\n+    char *{{enumName}}Array[] =  { {{#allowableValues}}{{#enumVars}}\"{{{value}}}\"{{^-last}},{{/-last}}{{/enumVars}}{{/allowableValues}} };\n+    size_t sizeofArray = sizeof({{enumName}}Array) / sizeof({{enumName}}Array[0]);\n+    while(stringToReturn < sizeofArray) {\n+        if(strcmp({{enumName}}, {{enumName}}Array[stringToReturn]) == 0) {\n+            return stringToReturn;\n+        }\n+        stringToReturn++;\n+    }\n+    return 0;\n+}\n+\n+cJSON *{{enumName}}_convertToJSON({{baseName}}_e {{enumName}}) {\n+cJSON *item = cJSON_CreateObject();\n+{{#isString}}\n+    if(cJSON_AddStringToObject(item, \"{{{paramName}}}\", {{{enumName}}}_ToString({{{enumName}}})) == NULL) {\n+        goto fail;\n+    }\n+{{/isString}}\n+{{#isNumeric}}\n+    if(cJSON_AddNumberToObject(item, \"{{{paramName}}}\", {{{enumName}}}) == NULL) {\n+        goto fail;\n+    }\n+{{/isNumeric}}\n+    return item;\n+    fail:\n+    cJSON_Delete(item);\n+    return NULL;\n+}\n+\n+{{baseName}}_e {{enumName}}_parseFromJSON(cJSON *{{enumName}}JSON){\n+\n+{{{baseName}}}_e {{enumName}}Variable = 0;\n+{{#isNumeric}}\n+cJSON *{{{enumName}}}Var = cJSON_GetObjectItemCaseSensitive({{enumName}}JSON, \"{{{paramName}}}\");\n+if(!cJSON_IsNumber({{{enumName}}}Var))\n+{\n+    goto end;\n+}\n+{{/isNumeric}}\n+{{#isString}}\n+cJSON *{{{enumName}}}Var = cJSON_GetObjectItemCaseSensitive({{enumName}}JSON, \"{{{paramName}}}\");\n+if(!cJSON_IsString({{{enumName}}}Var) || ({{{enumName}}}Var->valuestring == NULL)){\n+    goto end;\n+}\n+{{enumName}}Variable = {{enumName}}_FromString({{{enumName}}}Var->valuestring);\n+{{/isString}}\n+return {{enumName}}Variable;\n+end:\n+return 0;\n+}\n+{{/isEnum}}\n+\n+{{/allParams}}\n+{{/operation}}\n+{{/operations}}\n+\n+\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "637564baacc2b7fbc03d5aedc6bf59fe9a5b90b7"}, "originalPosition": 76}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMTc4Nzkz", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5477#pullrequestreview-372178793", "createdAt": "2020-03-10T17:39:50Z", "commit": {"oid": "d3c6998e2b2463a5765202cde414e28d7681f7a9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNzozOTo1MFrOF0Z23g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNzozOTo1MFrOF0Z23g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQ5MzkxOA==", "bodyText": "@michelealbano Shall we remove these System.out.println?", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5477#discussion_r390493918", "createdAt": "2020-03-10T17:39:50Z", "author": {"login": "wing328"}, "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/CLibcurlClientCodegen.java", "diffHunk": "@@ -617,11 +617,17 @@ public void preprocessOpenAPI(OpenAPI openAPI) {\n         } else {\n             setProjectName(defaultProjectName);\n         }\n+        System.out.println(\"michele was here preprocessOpenAPI \"+projectName);\n         additionalProperties.put(PROJECT_NAME, projectName);\n+        System.out.println(\"michele was here preprocessOpenAPI after \"+projectName);\n     }\n \n     public void setProjectName(String projectName) {\n-        this.projectName = underscore(projectName.toLowerCase(Locale.ROOT));\n+        System.out.println(\"michele was here setProjectName this1 \"+this.projectName);\n+        System.out.println(\"michele was here setProjectName no1 \"+projectName);\n+        this.projectName = underscore(sanitizeName(projectName.toLowerCase(Locale.ROOT)));\n+        System.out.println(\"michele was here setProjectName this2 \"+this.projectName);\n+        System.out.println(\"michele was here setProjectName no2 \"+projectName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3c6998e2b2463a5765202cde414e28d7681f7a9"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e568f73b3934109594a5f7e105efd4794516ef6f", "author": {"user": {"login": "michelealbano", "name": "Michele Albano"}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/e568f73b3934109594a5f7e105efd4794516ef6f", "committedDate": "2020-03-12T16:26:45Z", "message": "PR to solve 2 open issues on enums:\nIssue 5091 needs to generate enums also when the enum is directly in a param to a API call, instead than in a model. I did that by copying and adapting enum code from *model* to *api*\nIssue 4293 needs to decorate enums, for when enum names or enum values are repeated over the yaml definition."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3fa511358317fa391181852f6540c42db0057d4", "author": {"user": {"login": "michelealbano", "name": "Michele Albano"}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/c3fa511358317fa391181852f6540c42db0057d4", "committedDate": "2020-03-12T16:40:44Z", "message": "PR to solve 2 open issues on enums:\nIssue 5091 needs to generate enums also when the enum is directly in a param to a API call, instead than in a model. I did that by copying and adapting enum code from *model* to *api*\nIssue 4293 needs to decorate enums, for when enum names or enum values are repeated over the yaml definition."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54a95d84890ae3fc60d4f0bddd307e3bc7f79a3d", "author": {"user": {"login": "michelealbano", "name": "Michele Albano"}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/54a95d84890ae3fc60d4f0bddd307e3bc7f79a3d", "committedDate": "2020-03-12T16:43:50Z", "message": "Enums decorated: with {{projectName}}_{{classVarName}}_{{enumName}}_ in the models, with {{projectName}}_{{classVarName}}_{{enumName}}_ in the operations."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1400a8e46c71ca639203fbcabb49c876b8dbc4f7", "author": {"user": {"login": "michelealbano", "name": "Michele Albano"}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/1400a8e46c71ca639203fbcabb49c876b8dbc4f7", "committedDate": "2020-03-12T16:46:07Z", "message": "Changes to the c client:\n- Removed white space.\n- Removed ToJSON and FromJSON function for the enums, since they are not used\n- Sanitized project name in the .java file. For example, this solves a problem with the issue #2338, where the yaml file had title: \"Skycoin REST API.\""}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfdd7cff4949c00252b50b97841b81d7873a2c7b", "author": {"user": {"login": "michelealbano", "name": "Michele Albano"}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/bfdd7cff4949c00252b50b97841b81d7873a2c7b", "committedDate": "2020-03-12T16:47:44Z", "message": "Changes to the c client:\n- Removed white space.\n- Removed ToJSON and FromJSON function for the enums, since they are not used\n- Sanitized project name in the .java file. For example, this solves a problem with the issue #2338, where the yaml file had title: \"Skycoin REST API.\""}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d9543fcd19007b74c4d45841229400730aa20165", "author": {"user": {"login": "michelealbano", "name": "Michele Albano"}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/d9543fcd19007b74c4d45841229400730aa20165", "committedDate": "2020-03-10T19:41:08Z", "message": "Merge branch 'CClientEnum' of https://github.com/michelealbano/openapi-generator into CClientEnum\n\nRemoved printlns"}, "afterCommit": {"oid": "bfdd7cff4949c00252b50b97841b81d7873a2c7b", "author": {"user": {"login": "michelealbano", "name": "Michele Albano"}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/bfdd7cff4949c00252b50b97841b81d7873a2c7b", "committedDate": "2020-03-12T16:47:44Z", "message": "Changes to the c client:\n- Removed white space.\n- Removed ToJSON and FromJSON function for the enums, since they are not used\n- Sanitized project name in the .java file. For example, this solves a problem with the issue #2338, where the yaml file had title: \"Skycoin REST API.\""}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2711, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}