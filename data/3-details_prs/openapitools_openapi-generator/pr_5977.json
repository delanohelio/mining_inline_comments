{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1NjA0NzM3", "number": 5977, "title": "Restore allOf behaviour (model composition) for definition with a single schema reference", "bodyText": "This PR fixes issue 5876\nWe are reverting the code back to the prior state to make it so\ncodegenModel.parentSchema, .parent, and parentModel return back to previous behavior for composed schemas.\n@amakhrov this update changes result for the test testAllOfSingleRefWithOwnPropsNoDiscriminator which you added in #5738\nPR checklist\n\n Read the contribution guidelines.\n If contributing template-only or documentation-only changes which will change sample output, build the project before.\n Run the shell script(s) under ./bin/ (or Windows batch scripts under.\\bin\\windows) to update Petstore samples related to your fix. This is important, as CI jobs will verify all generator outputs of your HEAD commit, and these must match the expectations made by your contribution. You only need to run ./bin/{LANG}-petstore.sh, ./bin/openapi3/{LANG}-petstore.sh if updating the code or mustache templates for a language ({LANG}) (e.g. php, ruby, python, etc).\n File the PR against the correct branch: master, 4.3.x, 5.0.x. Default: master.\n Copy the technical committee to review the pull request if your PR is targeting a particular programming language.", "createdAt": "2020-04-19T04:52:47Z", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5977", "merged": true, "mergeCommit": {"oid": "1766279916377f49df70aa2b935a98f9efe35eab"}, "closed": true, "closedAt": "2020-04-20T08:00:25Z", "author": {"login": "spacether"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZNKCTgH2gAyNDA1NjA0NzM3OjVjMjNiMWJlNjA3MWE2ZTFkNjY5NTRiMmZlZjVhZWIzNWE5MDg5Y2U=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZPI2hAH2gAyNDA1NjA0NzM3OjE2MWU3NTkzYTZmYzlmZjI1OGNmNzI2MjQwZGM2NzI2ZDkwZTkyNDI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5c23b1be6071a6e1d66954b2fef5aeb35a9089ce", "author": {"user": {"login": "spacether", "name": "Justin Black"}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/5c23b1be6071a6e1d66954b2fef5aeb35a9089ce", "committedDate": "2020-04-19T16:33:55Z", "message": "Fixes getParentName function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90660282c8fef67863b62a061a1666a52cc07fb2", "author": {"user": {"login": "spacether", "name": "Justin Black"}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/90660282c8fef67863b62a061a1666a52cc07fb2", "committedDate": "2020-04-19T16:33:55Z", "message": "Updates getChildrenMap to not throw a NPE"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d3e682afaf6ab73dc2ca12d11df5e3efad8ed3b", "author": {"user": {"login": "spacether", "name": "Justin Black"}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/3d3e682afaf6ab73dc2ca12d11df5e3efad8ed3b", "committedDate": "2020-04-19T17:00:22Z", "message": "Updates test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3d56e0b81ef07d0030a4211d4c7df9840749761a", "author": {"user": {"login": "spacether", "name": "Justin Black"}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/3d56e0b81ef07d0030a4211d4c7df9840749761a", "committedDate": "2020-04-19T04:32:06Z", "message": "Updates getChildrenMap to not throw a NPE"}, "afterCommit": {"oid": "3d3e682afaf6ab73dc2ca12d11df5e3efad8ed3b", "author": {"user": {"login": "spacether", "name": "Justin Black"}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/3d3e682afaf6ab73dc2ca12d11df5e3efad8ed3b", "committedDate": "2020-04-19T17:00:22Z", "message": "Updates test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2MDQwMjA1", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5977#pullrequestreview-396040205", "createdAt": "2020-04-19T17:04:09Z", "commit": {"oid": "3d3e682afaf6ab73dc2ca12d11df5e3efad8ed3b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQxNzowNDowOVrOGH6OoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQxNzowNDowOVrOGH6OoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk0NzIzMw==", "bodyText": "This filtering prevents a NPE from happening when getParentName returns null, that's why I deleted the comment on line 1107 on the left. If I omit this filtering, the NPE is seen when we run our tests.", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5977#discussion_r410947233", "createdAt": "2020-04-19T17:04:09Z", "author": {"login": "spacether"}, "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/utils/ModelUtils.java", "diffHunk": "@@ -1104,9 +1104,9 @@ public static Header getHeader(OpenAPI openAPI, String name) {\n     public static Map<String, List<String>> getChildrenMap(OpenAPI openAPI) {\n         Map<String, Schema> allSchemas = getSchemas(openAPI);\n \n-        // FIXME: The collect here will throw NPE if a spec document has only a single oneOf hierarchy.\n         Map<String, List<Entry<String, Schema>>> groupedByParent = allSchemas.entrySet().stream()\n             .filter(entry -> isComposedSchema(entry.getValue()))\n+                .filter(entry -> getParentName((ComposedSchema) entry.getValue(), allSchemas)!=null)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d3e682afaf6ab73dc2ca12d11df5e3efad8ed3b"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2MDQwMjI0", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5977#pullrequestreview-396040224", "createdAt": "2020-04-19T17:04:22Z", "commit": {"oid": "3d3e682afaf6ab73dc2ca12d11df5e3efad8ed3b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQxNzowNDoyMlrOGH6Ovg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQxNzowNDoyMlrOGH6Ovg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk0NzI2Mg==", "bodyText": "reverted to original code", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5977#discussion_r410947262", "createdAt": "2020-04-19T17:04:22Z", "author": {"login": "spacether"}, "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/utils/ModelUtils.java", "diffHunk": "@@ -1165,14 +1165,6 @@ public static String getParentName(ComposedSchema composedSchema, Map<String, Sc\n         int nullSchemaChildrenCount = 0;\n         boolean hasAmbiguousParents = false;\n         List<String> refedWithoutDiscriminator = new ArrayList<>();\n-        String schemaName = \"\";\n-        for (String thisSchemaName : allSchemas.keySet()) {\n-            Schema sc = allSchemas.get(thisSchemaName);\n-            if (isComposedSchema(sc) && (ComposedSchema) sc == composedSchema) {\n-                schemaName = thisSchemaName;\n-                break;\n-            }\n-        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d3e682afaf6ab73dc2ca12d11df5e3efad8ed3b"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2MDQwMjM5", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5977#pullrequestreview-396040239", "createdAt": "2020-04-19T17:04:33Z", "commit": {"oid": "3d3e682afaf6ab73dc2ca12d11df5e3efad8ed3b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQxNzowNDozM1rOGH6Oyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQxNzowNDozM1rOGH6Oyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk0NzI3NA==", "bodyText": "reverted to original code", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5977#discussion_r410947274", "createdAt": "2020-04-19T17:04:33Z", "author": {"login": "spacether"}, "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/utils/ModelUtils.java", "diffHunk": "@@ -1189,10 +1181,7 @@ public static String getParentName(ComposedSchema composedSchema, Map<String, Sc\n                     } else {\n                         // not a parent since discriminator.propertyName is not set\n                         hasAmbiguousParents = true;\n-                        boolean isNotExtractedInlineSchema = !parentName.equals(schemaName+\"_allOf\");\n-                        if (isNotExtractedInlineSchema) {\n-                            refedWithoutDiscriminator.add(parentName);\n-                        }\n+                        refedWithoutDiscriminator.add(parentName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d3e682afaf6ab73dc2ca12d11df5e3efad8ed3b"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "161e7593a6fc9ff258cf726240dc6726d90e9242", "author": {"user": {"login": "spacether", "name": "Justin Black"}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/161e7593a6fc9ff258cf726240dc6726d90e9242", "committedDate": "2020-04-19T18:52:26Z", "message": "Runs ensure up to date"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2449, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}