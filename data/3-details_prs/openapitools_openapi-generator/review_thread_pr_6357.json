{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5NzUyNjQz", "number": 6357, "reviewThreads": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxOTowOTo1NVrOD_DCMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQwODozODo1N1rOELcaRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NDM2NTkzOnYy", "diffSide": "LEFT", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/AbstractGenerator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxOTowOTo1NVrOGZhT2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxOTowOTo1NVrOGZhT2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQxMzMzNw==", "bodyText": "FYI breaking change, but we should really try sticking to interfaces and move away from abstract base types.", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6357#discussion_r429413337", "createdAt": "2020-05-22T19:09:55Z", "author": {"login": "jimschubert"}, "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/AbstractGenerator.java", "diffHunk": "@@ -1,213 +0,0 @@\n-/*\n- * Copyright 2018 OpenAPI-Generator Contributors (https://openapi-generator.tech)\n- * Copyright 2018 SmartBear Software\n- *\n- * Licensed under the Apache License, Version 2.0 (the \"License\");\n- * you may not use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- *\n- *     https://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-\n-package org.openapitools.codegen;\n-\n-import java.nio.charset.StandardCharsets;\n-import java.nio.file.Files;\n-import java.nio.file.StandardCopyOption;\n-import java.util.Arrays;\n-import org.apache.commons.lang3.StringUtils;\n-import org.openapitools.codegen.api.TemplatingGenerator;\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n-\n-import java.io.*;\n-import java.nio.file.Paths;\n-import java.util.HashMap;\n-import java.util.Map;\n-import java.util.Scanner;\n-import java.util.regex.Pattern;\n-\n-public abstract class AbstractGenerator implements TemplatingGenerator {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5307f3184db13284f85ea1aab40213147a1b130"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NDM2NzkxOnYy", "diffSide": "LEFT", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/DefaultCodegen.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxOToxMDo0MlrOGZhVEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxOToxMDo0MlrOGZhVEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQxMzY0OA==", "bodyText": "this is now handled by template loading functionality, as that is not the responsibility of DefaultCodegen.", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6357#discussion_r429413648", "createdAt": "2020-05-22T19:10:42Z", "author": {"login": "jimschubert"}, "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/DefaultCodegen.java", "diffHunk": "@@ -163,7 +163,6 @@ apiTemplateFiles are for API outputs only (controllers/handlers).\n     protected Map<String, String> reservedWordsMappings = new HashMap<String, String>();\n     protected String templateDir;\n     protected String embeddedTemplateDir;\n-    protected String commonTemplateDir = \"_common\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5307f3184db13284f85ea1aab40213147a1b130"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NDM3NzQwOnYy", "diffSide": "RIGHT", "path": "modules/openapi-generator/src/test/java/org/openapitools/codegen/TestUtils.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxOToxNTowNVrOGZhbiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxOToxNTowNVrOGZhbiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQxNTMwNw==", "bodyText": "MockDefaultGenerator duplicates all written bytes. getTemplateBasedFile is used to \"inspect\" data passed to templates, but this should be tested differently in the future.", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6357#discussion_r429415307", "createdAt": "2020-05-22T19:15:05Z", "author": {"login": "jimschubert"}, "path": "modules/openapi-generator/src/test/java/org/openapitools/codegen/TestUtils.java", "diffHunk": "@@ -83,31 +88,32 @@ public static OpenAPI createOpenAPIWithOneSchema(String name, Schema schema) {\n         return openAPI;\n     }\n \n+    /**\n+     * Extract file from {@link MockDefaultGenerator}\n+     *\n+     * @param generator Generator\n+     * @param root root path\n+     * @param filename filename under root\n+     *\n+     * @return a {@link WrittenTemplateBasedFile}\n+     * @deprecated Since 5.0. Please avoid this method and usage of {@link MockDefaultGenerator}, prefer {@link DefaultGenerator#DefaultGenerator(Boolean)} with dryRun=true.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5307f3184db13284f85ea1aab40213147a1b130"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NzgwODQyOnYy", "diffSide": "LEFT", "path": "bin/ci/java-feign.json", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMjo1NzowMlrOGaASRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMjo1NzowMlrOGaASRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkyMDgzNg==", "bodyText": "Note these removals of libraries/<library name> in the Java sample configs and scripts.\nWhile this syntax works if the entirety of the library code is in the named folder, this would cause fallbacks to fail if anyone were to remove something like model.mustache intending to fallback to resources/Java/model.mustache. We should avoid this possible confusion especially when these subdirectories are structured to follow our library lookup logic:\n\nUser customized library path (e.g. custom_template/libraries/feign/model.mustache)\nUser customized generator top-level path (e.g. custom_template/model.mustache)\nEmbedded library path (e.g. resources/Java/libraries/feign/model.mustache)\nEmbedded top-level path (e.g. resources/Java/model.mustache)\nCommon embedded path (e.g. resources/_common/model.mustache)\nthrow TemplateNotFoundException", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6357#discussion_r429920836", "createdAt": "2020-05-25T12:57:02Z", "author": {"login": "jimschubert"}, "path": "bin/ci/java-feign.json", "diffHunk": "@@ -3,7 +3,7 @@\n   \"generatorName\": \"java\",\n   \"inputSpec\": \"modules/openapi-generator/src/test/resources/2_0/petstore-with-fake-endpoints-models-for-testing.yaml\",\n   \"outputDir\": \"samples/client/petstore/java/feign\",\n-  \"templateDir\": \"modules/openapi-generator/src/main/resources/Java/libraries/feign\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e934beca61b2ee293b8f142e12f382cb88cf0a55"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NzgxMTU3OnYy", "diffSide": "RIGHT", "path": "appveyor.yml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMjo1ODowOFrOGaAUKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMjo1ODowOFrOGaAUKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkyMTMyMg==", "bodyText": "I'd like to leave --stacktrace here rather than --info. It was taking ~2 hours to get the feedback from AppVeyor after commit and I was unable to repro the issue in Windows locally.", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6357#discussion_r429921322", "createdAt": "2020-05-25T12:58:08Z", "author": {"login": "jimschubert"}, "path": "appveyor.yml", "diffHunk": "@@ -50,7 +50,7 @@ build_script:\n   # install openapi-generator locally\n   - mvn clean install --quiet -Dorg.slf4j.simpleLogger.defaultLogLevel=error\n   # run the locally installed openapi-generator-gradle-plugin\n-  - gradle -b modules\\openapi-generator-gradle-plugin\\samples\\local-spec\\build.gradle buildGoSdk --info\n+  - gradle -b modules\\openapi-generator-gradle-plugin\\samples\\local-spec\\build.gradle buildGoSdk --stacktrace", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e934beca61b2ee293b8f142e12f382cb88cf0a55"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NzgyNDc3OnYy", "diffSide": "RIGHT", "path": "modules/openapi-generator-cli/src/main/java/org/openapitools/codegen/cmd/Meta.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMzowMjo1MlrOGaAcRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMzowMjo1MlrOGaAcRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkyMzM5OQ==", "bodyText": "Notice regarding the design\u2026\u00a0template processor no longer requires that we pass that logic through a DefaultGenerator instance, which holds logic for OpenAPI input generation to templated output.\nWe can now generate without tight coupling to OpenAPI documents. This is work directed toward #841 and somewhat related to #843.", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6357#discussion_r429923399", "createdAt": "2020-05-25T13:02:52Z", "author": {"login": "jimschubert"}, "path": "modules/openapi-generator-cli/src/main/java/org/openapitools/codegen/cmd/Meta.java", "diffHunk": "@@ -136,52 +141,38 @@ public void execute() {\n      */\n     private static Converter<SupportingFile, File> processFiles(final File targetDir,\n             final Map<String, Object> data) {\n-        return new Converter<SupportingFile, File>() {\n-            private DefaultGenerator generator = new DefaultGenerator();\n-\n-            @Override\n-            public File convert(SupportingFile support) {\n-                try {\n-                    File destinationFolder =\n-                            new File(new File(targetDir.getAbsolutePath()), support.folder);\n-                    File outputFile = new File(destinationFolder, support.destinationFilename);\n-\n-                    String template =\n-                            generator.readTemplate(new File(TEMPLATE_DIR_CLASSPATH,\n-                                    support.templateFile).getPath());\n-                    String formatted = template;\n-\n-                    if (support.templateFile.endsWith(MUSTACHE_EXTENSION)) {\n-                        LOGGER.info(\"writing file to {}\", outputFile.getAbsolutePath());\n-                        formatted =\n-                                Mustache.compiler().withLoader(loader(generator)).defaultValue(\"\")\n-                                        .compile(template).execute(data);\n-                    } else {\n-                        LOGGER.info(\"copying file to {}\", outputFile.getAbsolutePath());\n-                    }\n-\n-                    FileUtils.writeStringToFile(outputFile, formatted, StandardCharsets.UTF_8);\n-                    return outputFile;\n-\n-                } catch (IOException e) {\n-                    throw new RuntimeException(\"Can't generate project\", e);\n+        return support -> {\n+            try {\n+                File destinationFolder =\n+                        new File(new File(targetDir.getAbsolutePath()), support.folder);\n+                File outputFile = new File(destinationFolder, support.destinationFilename);\n+\n+                TemplateManager templateProcessor = new TemplateManager(\n+                        new TemplateManagerOptions(false, false),\n+                        new MustacheEngineAdapter(),\n+                        new TemplatePathLocator[]{ new CommonTemplateContentLocator(\"codegen\") }\n+                );\n+\n+                String template = templateProcessor.readTemplate(new File(TEMPLATE_DIR_CLASSPATH, support.templateFile).getPath());\n+\n+                String formatted = template;\n+\n+                Mustache.TemplateLoader loader = name -> templateProcessor.getTemplateReader(name.concat(MUSTACHE_EXTENSION));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e934beca61b2ee293b8f142e12f382cb88cf0a55"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3Nzg0MDMwOnYy", "diffSide": "LEFT", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/AbstractPhpCodegen.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMzowODoyMlrOGaAllg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMzowODoyMlrOGaAllg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkyNTc4Mg==", "bodyText": "I found that .gitignore files sometimes don't load via this.getClass().getClassLoader().getResource(path).\nFor example, this works: this.getClass().getClassLoader().getResource(\"_common/.openapi-generator-ignore\") while this did not: this.getClass().getClassLoader().getResource(\"graphql-nodejs-express-server/.gitignore\"). This only seems to affect PHP and the GraphQL Express servers as everything else is either gitignore or gitignore.mustache (the formats documented as acceptable on Java documentation).", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6357#discussion_r429925782", "createdAt": "2020-05-25T13:08:22Z", "author": {"login": "jimschubert"}, "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/AbstractPhpCodegen.java", "diffHunk": "@@ -218,7 +218,7 @@ public void processOpts() {\n         // supportingFiles.add(new SupportingFile(\"LICENSE\", \"\", \"LICENSE\"));\n \n         // all PHP codegens requires Composer, it means that we need to exclude from SVN at least vendor folder\n-        supportingFiles.add(new SupportingFile(\".gitignore\", \"\", \".gitignore\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e934beca61b2ee293b8f142e12f382cb88cf0a55"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3Nzg1NjgwOnYy", "diffSide": "RIGHT", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/templating/HandlebarsEngineAdapter.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMzoxMzo1N1rOGaAvkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMzoxMzo1N1rOGaAvkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkyODMzOQ==", "bodyText": "This is required because filenames without extensions would become .hbs or .handlebars in the above loop. A file which isn't intended to be handled like REAMDE.md would become README.hbs or README.handlebars and would result in template not found without this as-is attempt.", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6357#discussion_r429928339", "createdAt": "2020-05-25T13:13:57Z", "author": {"login": "jimschubert"}, "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/templating/HandlebarsEngineAdapter.java", "diffHunk": "@@ -83,14 +82,22 @@ public TemplateSource sourceAt(String location) {\n         return tmpl.apply(context);\n     }\n \n-    public TemplateSource findTemplate(TemplatingGenerator generator, String templateFile) {\n-        for (String file : getModifiedFileLocation(templateFile)) {\n+    public TemplateSource findTemplate(TemplatingExecutor generator, String templateFile) {\n+        String[] possibilities = getModifiedFileLocation(templateFile);\n+        for (String file : possibilities) {\n             try {\n                 return new StringTemplateSource(file, generator.getFullTemplateContents(file));\n             } catch (Exception ignored) {\n             }\n         }\n-        throw new TemplateNotFoundException(templateFile);\n+\n+        // allow lookup of files without extension modification (such as .openapi-generator-ignore, README.md, etc)\n+        try {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e934beca61b2ee293b8f142e12f382cb88cf0a55"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3Nzg2NjMzOnYy", "diffSide": "RIGHT", "path": "samples/client/petstore/kotlin-multiplatform/.openapi-generator-ignore", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMzoxNzoxM1rOGaA1Yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMzoxNzoxM1rOGaA1Yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkyOTgyNg==", "bodyText": "I had issues executing this test locally with Bash 5.0. Had to update gradle in the example so the bash sourcing would succeed. I've only updated the generated output rather than the embedded files so we're not forcing users to update to a potentially invalid Gradle version as they regenerate the kotlin multiplatform generate.", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6357#discussion_r429929826", "createdAt": "2020-05-25T13:17:13Z", "author": {"login": "jimschubert"}, "path": "samples/client/petstore/kotlin-multiplatform/.openapi-generator-ignore", "diffHunk": "@@ -1,23 +1,5 @@\n # OpenAPI Generator Ignore\n-# Generated by openapi-generator https://github.com/openapitools/openapi-generator\n-\n-# Use this file to prevent files from being overwritten by the generator.\n-# The patterns follow closely to .gitignore or .dockerignore.\n-\n-# As an example, the C# client generator defines ApiClient.cs.\n-# You can make changes and tell OpenAPI Generator to ignore just this file by uncommenting the following line:\n-#ApiClient.cs\n-\n-# You can match any string of characters against a directory, file or extension with a single asterisk (*):\n-#foo/*/qux\n-# The above matches foo/bar/qux and foo/baz/qux, but not foo/bar/baz/qux\n-\n-# You can recursively match patterns against a directory, file or extension with a double asterisk (**):\n-#foo/**/qux\n-# This matches foo/bar/qux, foo/baz/qux, and foo/bar/baz/qux\n-\n-# You can also negate patterns with an exclamation (!).\n-# For example, you can ignore all files in a docs folder with the file extension .md:\n-#docs/*.md\n-# Then explicitly reverse the ignore rule for a single file:\n-#!docs/README.md\n+gradle/wrapper/gradle-wrapper.jar", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e934beca61b2ee293b8f142e12f382cb88cf0a55"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNDM1MjA1OnYy", "diffSide": "RIGHT", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/templating/GeneratorTemplateContentLocator.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQwODozNzoyMlrOGtAurw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQxMTo0ODowMVrOH3t-XA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg1MTA1NQ==", "bodyText": "JAR classpath resource path requires '/' as file separator always, must not be OS dependent, e.g. '\\' under Windows won't work!\nSuggestion: use TemplateManager.getCPResourcePath(libTemplateFile), may extract to similar method like embeddedTemplateExists(String)", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6357#discussion_r449851055", "createdAt": "2020-07-05T08:37:22Z", "author": {"login": "DenisKnoepfle"}, "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/templating/GeneratorTemplateContentLocator.java", "diffHunk": "@@ -0,0 +1,91 @@\n+package org.openapitools.codegen.templating;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.openapitools.codegen.CodegenConfig;\n+import org.openapitools.codegen.TemplateManager;\n+import org.openapitools.codegen.api.TemplatePathLocator;\n+\n+import java.io.File;\n+\n+/**\n+ * Locates templates according to {@link CodegenConfig} settings.\n+ */\n+public class GeneratorTemplateContentLocator implements TemplatePathLocator {\n+    private final CodegenConfig codegenConfig;\n+\n+    /**\n+     * Constructs a new instance of {@link GeneratorTemplateContentLocator} for the provided {@link CodegenConfig}\n+     *\n+     * @param codegenConfig A generator's configuration used for determining template file location.\n+     */\n+    public GeneratorTemplateContentLocator(CodegenConfig codegenConfig) {\n+        this.codegenConfig = codegenConfig;\n+    }\n+\n+    private String buildLibraryFilePath(String dir, String library, String file) {\n+        return dir + File.separator + \"libraries\" + File.separator + library + File.separator + file;\n+    }\n+\n+    /**\n+     * Determines whether an embedded file with the specified name exists.\n+     *\n+     * @param name The name of the file (i.e. relative to resource root)\n+     *\n+     * @return true if file is an embedded resource, false if it does not exist\n+     */\n+    public boolean embeddedTemplateExists(String name) {\n+        return this.getClass().getClassLoader().getResource(TemplateManager.getCPResourcePath(name)) != null;\n+    }\n+\n+    /**\n+     * Get the template file path with template dir prepended, and use the library template if exists.\n+     *\n+     * Precedence:\n+     * 1) (template dir)/libraries/(library)\n+     * 2) (template dir)\n+     * 3) (embedded template dir)/libraries/(library)\n+     * 4) (embedded template dir)\n+     *\n+     * Where \"template dir\" may be user defined and \"embedded template dir\" are the built-in templates for the given generator.\n+     *\n+     * @param relativeTemplateFile Template file\n+     * @return String Full template file path\n+     */\n+    @Override\n+    public String getFullTemplatePath(String relativeTemplateFile) {\n+        CodegenConfig config = this.codegenConfig;\n+\n+        //check the supplied template library folder for the file\n+        final String library = config.getLibrary();\n+        if (StringUtils.isNotEmpty(library)) {\n+            //look for the file in the library subfolder of the supplied template\n+            final String libTemplateFile = buildLibraryFilePath(config.templateDir(), library, relativeTemplateFile);\n+            if (new File(libTemplateFile).exists() || this.getClass().getClassLoader().getResource(libTemplateFile) != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "636c4dd2d6681d67a11c5c374814034257ef7771"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU3NTAzNQ==", "bodyText": "@DenisKnoepfle are you suggesting this based on code quality or based on an error you've experienced?\nThis method falls back to embedded templates in the last two conditions, which allows for Windows paths evaluation using exactly what you've mentioned above.\nThe methods as written here allow us to check for the embedded file in operating systems without windows style paths without incurring the performance overhead of doing that adjustment.\nMaybe this method's comment would be better to document it as this to avoid confusion?\n     * 1) (template dir)/libraries/(library) [Windows + *nix]\n     * 2) (embedded template dir)/libraries/(library) [*nix]\n     * 2) (template dir) [Windows + *nix]\n     * 3) (embedded template dir) [*nix]\n     * 4) (embedded template dir)/libraries/(library) [Windows only]\n     * 4) (embedded template dir) [Windows only]\n\nAnd since we use File.separator in buildLibraryFilePath, the file check works for both Windows and non-Windows separators consistently throughout.\nThe alternative that you suggest would require transforming via the regular expression in TemplateManager.getCPResourcePath for all operating systems, and we really shouldn't have to pay that price on non-Windows.", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6357#discussion_r450575035", "createdAt": "2020-07-07T02:19:36Z", "author": {"login": "jimschubert"}, "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/templating/GeneratorTemplateContentLocator.java", "diffHunk": "@@ -0,0 +1,91 @@\n+package org.openapitools.codegen.templating;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.openapitools.codegen.CodegenConfig;\n+import org.openapitools.codegen.TemplateManager;\n+import org.openapitools.codegen.api.TemplatePathLocator;\n+\n+import java.io.File;\n+\n+/**\n+ * Locates templates according to {@link CodegenConfig} settings.\n+ */\n+public class GeneratorTemplateContentLocator implements TemplatePathLocator {\n+    private final CodegenConfig codegenConfig;\n+\n+    /**\n+     * Constructs a new instance of {@link GeneratorTemplateContentLocator} for the provided {@link CodegenConfig}\n+     *\n+     * @param codegenConfig A generator's configuration used for determining template file location.\n+     */\n+    public GeneratorTemplateContentLocator(CodegenConfig codegenConfig) {\n+        this.codegenConfig = codegenConfig;\n+    }\n+\n+    private String buildLibraryFilePath(String dir, String library, String file) {\n+        return dir + File.separator + \"libraries\" + File.separator + library + File.separator + file;\n+    }\n+\n+    /**\n+     * Determines whether an embedded file with the specified name exists.\n+     *\n+     * @param name The name of the file (i.e. relative to resource root)\n+     *\n+     * @return true if file is an embedded resource, false if it does not exist\n+     */\n+    public boolean embeddedTemplateExists(String name) {\n+        return this.getClass().getClassLoader().getResource(TemplateManager.getCPResourcePath(name)) != null;\n+    }\n+\n+    /**\n+     * Get the template file path with template dir prepended, and use the library template if exists.\n+     *\n+     * Precedence:\n+     * 1) (template dir)/libraries/(library)\n+     * 2) (template dir)\n+     * 3) (embedded template dir)/libraries/(library)\n+     * 4) (embedded template dir)\n+     *\n+     * Where \"template dir\" may be user defined and \"embedded template dir\" are the built-in templates for the given generator.\n+     *\n+     * @param relativeTemplateFile Template file\n+     * @return String Full template file path\n+     */\n+    @Override\n+    public String getFullTemplatePath(String relativeTemplateFile) {\n+        CodegenConfig config = this.codegenConfig;\n+\n+        //check the supplied template library folder for the file\n+        final String library = config.getLibrary();\n+        if (StringUtils.isNotEmpty(library)) {\n+            //look for the file in the library subfolder of the supplied template\n+            final String libTemplateFile = buildLibraryFilePath(config.templateDir(), library, relativeTemplateFile);\n+            if (new File(libTemplateFile).exists() || this.getClass().getClassLoader().getResource(libTemplateFile) != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg1MTA1NQ=="}, "originalCommit": {"oid": "636c4dd2d6681d67a11c5c374814034257ef7771"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTE1OTEzMw==", "bodyText": "Sorry for the late response, I had been on holidays.\n@jimschubert I'm suggesting this based on an error I've experienced under Windows using the template path feature (resolve from classpath).\n\nAnd since we use File.separator in buildLibraryFilePath, the file check works for both Windows and non-Windows separators consistently throughout.\n\nThis is what's breaking it. You must not use backslashes ('\\') in a java classpath-path, it won't work, not even under Windows. Thus it must always be a forward slash ('/') when forming a classpath-path.\nIs it clear now how I meant it? Did you test it under Windows trying to find a resource on a classpath that was not in the root of a jar, e.g. some.jar/some/deep/folder/JavaSpring/pojo.mustache? In my case it always resorted to the embedded dir instead of using my custom mustache template.", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6357#discussion_r481159133", "createdAt": "2020-09-01T13:59:54Z", "author": {"login": "DenisKnoepfle"}, "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/templating/GeneratorTemplateContentLocator.java", "diffHunk": "@@ -0,0 +1,91 @@\n+package org.openapitools.codegen.templating;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.openapitools.codegen.CodegenConfig;\n+import org.openapitools.codegen.TemplateManager;\n+import org.openapitools.codegen.api.TemplatePathLocator;\n+\n+import java.io.File;\n+\n+/**\n+ * Locates templates according to {@link CodegenConfig} settings.\n+ */\n+public class GeneratorTemplateContentLocator implements TemplatePathLocator {\n+    private final CodegenConfig codegenConfig;\n+\n+    /**\n+     * Constructs a new instance of {@link GeneratorTemplateContentLocator} for the provided {@link CodegenConfig}\n+     *\n+     * @param codegenConfig A generator's configuration used for determining template file location.\n+     */\n+    public GeneratorTemplateContentLocator(CodegenConfig codegenConfig) {\n+        this.codegenConfig = codegenConfig;\n+    }\n+\n+    private String buildLibraryFilePath(String dir, String library, String file) {\n+        return dir + File.separator + \"libraries\" + File.separator + library + File.separator + file;\n+    }\n+\n+    /**\n+     * Determines whether an embedded file with the specified name exists.\n+     *\n+     * @param name The name of the file (i.e. relative to resource root)\n+     *\n+     * @return true if file is an embedded resource, false if it does not exist\n+     */\n+    public boolean embeddedTemplateExists(String name) {\n+        return this.getClass().getClassLoader().getResource(TemplateManager.getCPResourcePath(name)) != null;\n+    }\n+\n+    /**\n+     * Get the template file path with template dir prepended, and use the library template if exists.\n+     *\n+     * Precedence:\n+     * 1) (template dir)/libraries/(library)\n+     * 2) (template dir)\n+     * 3) (embedded template dir)/libraries/(library)\n+     * 4) (embedded template dir)\n+     *\n+     * Where \"template dir\" may be user defined and \"embedded template dir\" are the built-in templates for the given generator.\n+     *\n+     * @param relativeTemplateFile Template file\n+     * @return String Full template file path\n+     */\n+    @Override\n+    public String getFullTemplatePath(String relativeTemplateFile) {\n+        CodegenConfig config = this.codegenConfig;\n+\n+        //check the supplied template library folder for the file\n+        final String library = config.getLibrary();\n+        if (StringUtils.isNotEmpty(library)) {\n+            //look for the file in the library subfolder of the supplied template\n+            final String libTemplateFile = buildLibraryFilePath(config.templateDir(), library, relativeTemplateFile);\n+            if (new File(libTemplateFile).exists() || this.getClass().getClassLoader().getResource(libTemplateFile) != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg1MTA1NQ=="}, "originalCommit": {"oid": "636c4dd2d6681d67a11c5c374814034257ef7771"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE3NzI4Mg==", "bodyText": "@DenisKnoepfle thanks for the detailed response. The issue was indeed that I was testing  only with a directory structure which mirrors the resources directory in our project. However, I was also testing under Git Bash which I assume is not using the same file separators. I've never done Java development under windows, so I'm not entirely sure how to attach a remote debugger to find out.\nIf you don't mind, I'd like to tag you in the PR I'll open if you're able to test.", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6357#discussion_r499177282", "createdAt": "2020-10-03T19:57:06Z", "author": {"login": "jimschubert"}, "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/templating/GeneratorTemplateContentLocator.java", "diffHunk": "@@ -0,0 +1,91 @@\n+package org.openapitools.codegen.templating;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.openapitools.codegen.CodegenConfig;\n+import org.openapitools.codegen.TemplateManager;\n+import org.openapitools.codegen.api.TemplatePathLocator;\n+\n+import java.io.File;\n+\n+/**\n+ * Locates templates according to {@link CodegenConfig} settings.\n+ */\n+public class GeneratorTemplateContentLocator implements TemplatePathLocator {\n+    private final CodegenConfig codegenConfig;\n+\n+    /**\n+     * Constructs a new instance of {@link GeneratorTemplateContentLocator} for the provided {@link CodegenConfig}\n+     *\n+     * @param codegenConfig A generator's configuration used for determining template file location.\n+     */\n+    public GeneratorTemplateContentLocator(CodegenConfig codegenConfig) {\n+        this.codegenConfig = codegenConfig;\n+    }\n+\n+    private String buildLibraryFilePath(String dir, String library, String file) {\n+        return dir + File.separator + \"libraries\" + File.separator + library + File.separator + file;\n+    }\n+\n+    /**\n+     * Determines whether an embedded file with the specified name exists.\n+     *\n+     * @param name The name of the file (i.e. relative to resource root)\n+     *\n+     * @return true if file is an embedded resource, false if it does not exist\n+     */\n+    public boolean embeddedTemplateExists(String name) {\n+        return this.getClass().getClassLoader().getResource(TemplateManager.getCPResourcePath(name)) != null;\n+    }\n+\n+    /**\n+     * Get the template file path with template dir prepended, and use the library template if exists.\n+     *\n+     * Precedence:\n+     * 1) (template dir)/libraries/(library)\n+     * 2) (template dir)\n+     * 3) (embedded template dir)/libraries/(library)\n+     * 4) (embedded template dir)\n+     *\n+     * Where \"template dir\" may be user defined and \"embedded template dir\" are the built-in templates for the given generator.\n+     *\n+     * @param relativeTemplateFile Template file\n+     * @return String Full template file path\n+     */\n+    @Override\n+    public String getFullTemplatePath(String relativeTemplateFile) {\n+        CodegenConfig config = this.codegenConfig;\n+\n+        //check the supplied template library folder for the file\n+        final String library = config.getLibrary();\n+        if (StringUtils.isNotEmpty(library)) {\n+            //look for the file in the library subfolder of the supplied template\n+            final String libTemplateFile = buildLibraryFilePath(config.templateDir(), library, relativeTemplateFile);\n+            if (new File(libTemplateFile).exists() || this.getClass().getClassLoader().getResource(libTemplateFile) != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg1MTA1NQ=="}, "originalCommit": {"oid": "636c4dd2d6681d67a11c5c374814034257ef7771"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE4Njk3Mg==", "bodyText": "Sorry, I couldn't test it sooner, but I confirmed that it's working properly now for me under Windows (v5.0.0-beta3). Thank you!", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6357#discussion_r528186972", "createdAt": "2020-11-21T11:48:01Z", "author": {"login": "DenisKnoepfle"}, "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/templating/GeneratorTemplateContentLocator.java", "diffHunk": "@@ -0,0 +1,91 @@\n+package org.openapitools.codegen.templating;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.openapitools.codegen.CodegenConfig;\n+import org.openapitools.codegen.TemplateManager;\n+import org.openapitools.codegen.api.TemplatePathLocator;\n+\n+import java.io.File;\n+\n+/**\n+ * Locates templates according to {@link CodegenConfig} settings.\n+ */\n+public class GeneratorTemplateContentLocator implements TemplatePathLocator {\n+    private final CodegenConfig codegenConfig;\n+\n+    /**\n+     * Constructs a new instance of {@link GeneratorTemplateContentLocator} for the provided {@link CodegenConfig}\n+     *\n+     * @param codegenConfig A generator's configuration used for determining template file location.\n+     */\n+    public GeneratorTemplateContentLocator(CodegenConfig codegenConfig) {\n+        this.codegenConfig = codegenConfig;\n+    }\n+\n+    private String buildLibraryFilePath(String dir, String library, String file) {\n+        return dir + File.separator + \"libraries\" + File.separator + library + File.separator + file;\n+    }\n+\n+    /**\n+     * Determines whether an embedded file with the specified name exists.\n+     *\n+     * @param name The name of the file (i.e. relative to resource root)\n+     *\n+     * @return true if file is an embedded resource, false if it does not exist\n+     */\n+    public boolean embeddedTemplateExists(String name) {\n+        return this.getClass().getClassLoader().getResource(TemplateManager.getCPResourcePath(name)) != null;\n+    }\n+\n+    /**\n+     * Get the template file path with template dir prepended, and use the library template if exists.\n+     *\n+     * Precedence:\n+     * 1) (template dir)/libraries/(library)\n+     * 2) (template dir)\n+     * 3) (embedded template dir)/libraries/(library)\n+     * 4) (embedded template dir)\n+     *\n+     * Where \"template dir\" may be user defined and \"embedded template dir\" are the built-in templates for the given generator.\n+     *\n+     * @param relativeTemplateFile Template file\n+     * @return String Full template file path\n+     */\n+    @Override\n+    public String getFullTemplatePath(String relativeTemplateFile) {\n+        CodegenConfig config = this.codegenConfig;\n+\n+        //check the supplied template library folder for the file\n+        final String library = config.getLibrary();\n+        if (StringUtils.isNotEmpty(library)) {\n+            //look for the file in the library subfolder of the supplied template\n+            final String libTemplateFile = buildLibraryFilePath(config.templateDir(), library, relativeTemplateFile);\n+            if (new File(libTemplateFile).exists() || this.getClass().getClassLoader().getResource(libTemplateFile) != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg1MTA1NQ=="}, "originalCommit": {"oid": "636c4dd2d6681d67a11c5c374814034257ef7771"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNDM1MjcxOnYy", "diffSide": "RIGHT", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/templating/GeneratorTemplateContentLocator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQwODozODo1N1rOGtAvFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQwODozODo1N1rOGtAvFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg1MTE1OA==", "bodyText": "Same issue with '\\' in resource path under windows, see line 63.", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6357#discussion_r449851158", "createdAt": "2020-07-05T08:38:57Z", "author": {"login": "DenisKnoepfle"}, "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/templating/GeneratorTemplateContentLocator.java", "diffHunk": "@@ -0,0 +1,91 @@\n+package org.openapitools.codegen.templating;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.openapitools.codegen.CodegenConfig;\n+import org.openapitools.codegen.TemplateManager;\n+import org.openapitools.codegen.api.TemplatePathLocator;\n+\n+import java.io.File;\n+\n+/**\n+ * Locates templates according to {@link CodegenConfig} settings.\n+ */\n+public class GeneratorTemplateContentLocator implements TemplatePathLocator {\n+    private final CodegenConfig codegenConfig;\n+\n+    /**\n+     * Constructs a new instance of {@link GeneratorTemplateContentLocator} for the provided {@link CodegenConfig}\n+     *\n+     * @param codegenConfig A generator's configuration used for determining template file location.\n+     */\n+    public GeneratorTemplateContentLocator(CodegenConfig codegenConfig) {\n+        this.codegenConfig = codegenConfig;\n+    }\n+\n+    private String buildLibraryFilePath(String dir, String library, String file) {\n+        return dir + File.separator + \"libraries\" + File.separator + library + File.separator + file;\n+    }\n+\n+    /**\n+     * Determines whether an embedded file with the specified name exists.\n+     *\n+     * @param name The name of the file (i.e. relative to resource root)\n+     *\n+     * @return true if file is an embedded resource, false if it does not exist\n+     */\n+    public boolean embeddedTemplateExists(String name) {\n+        return this.getClass().getClassLoader().getResource(TemplateManager.getCPResourcePath(name)) != null;\n+    }\n+\n+    /**\n+     * Get the template file path with template dir prepended, and use the library template if exists.\n+     *\n+     * Precedence:\n+     * 1) (template dir)/libraries/(library)\n+     * 2) (template dir)\n+     * 3) (embedded template dir)/libraries/(library)\n+     * 4) (embedded template dir)\n+     *\n+     * Where \"template dir\" may be user defined and \"embedded template dir\" are the built-in templates for the given generator.\n+     *\n+     * @param relativeTemplateFile Template file\n+     * @return String Full template file path\n+     */\n+    @Override\n+    public String getFullTemplatePath(String relativeTemplateFile) {\n+        CodegenConfig config = this.codegenConfig;\n+\n+        //check the supplied template library folder for the file\n+        final String library = config.getLibrary();\n+        if (StringUtils.isNotEmpty(library)) {\n+            //look for the file in the library subfolder of the supplied template\n+            final String libTemplateFile = buildLibraryFilePath(config.templateDir(), library, relativeTemplateFile);\n+            if (new File(libTemplateFile).exists() || this.getClass().getClassLoader().getResource(libTemplateFile) != null) {\n+                return libTemplateFile;\n+            }\n+        }\n+\n+        //check the supplied template main folder for the file\n+        final String template = config.templateDir() + File.separator + relativeTemplateFile;\n+        if (new File(template).exists() || this.getClass().getClassLoader().getResource(template) != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "636c4dd2d6681d67a11c5c374814034257ef7771"}, "originalPosition": 70}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3447, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}