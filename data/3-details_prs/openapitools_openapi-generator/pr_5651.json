{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxNjk3NzUz", "number": 5651, "title": "[C++] [Qt5] fixed cpp-client-qt5 HttpRequestWorker requests crashing on timeout", "bodyText": "\u2026 when they have actually NOT timed out (were calling back into a deleted struct).\nOld behavior:\n\nrequest without timeout on a responding url: get an answer back, works as expected.\nrequest without timeout on a non-responding url: get no answer back, no callback called, works as expected.\nrequest with timeout on a non-responding url: get no answer back, timeout gets triggered, works as expected.\nrequest with timeout on a responding url: get answer back, reply gets deleted, timeout gets triggered, callback writes on deleted data -> crash.\n\nPatch content: replaced the timeout integer with a QTimer to handle and own the timeout callback. The timer is stopped whenever a call gets an answer back, or the owner object is deleted.\nThis has only been tested empirically since the patch has a small scope.\nCopying the technical committee: @ravinikam @stkrwork @etherealjoy @MartinDelille @muttleyxd\nThank you", "createdAt": "2020-03-20T19:08:45Z", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5651", "merged": true, "mergeCommit": {"oid": "bb2112f3debe491ca5d4ac5e21da5f59784b5707"}, "closed": true, "closedAt": "2020-03-27T08:00:27Z", "author": {"login": "onze"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcPlNQngH2gAyMzkxNjk3NzUzOjcxOWRlN2M3NjE2OTA5Mjk0ZjIwZGQxMzIzOWUyNTIxZGM3MDNkYjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQyDywAFqTM4MDI2MDA2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "719de7c7616909294f20dd13239e2521dc703db1", "author": {"user": null}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/719de7c7616909294f20dd13239e2521dc703db1", "committedDate": "2020-03-20T18:55:55Z", "message": "- fixed cpp-client-qt5 HttpRequestWorker requests crashing on timeout when they have actually NOT timed out (were calling back into a deleted struct)."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4ODM1MjIw", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5651#pullrequestreview-378835220", "createdAt": "2020-03-20T22:00:09Z", "commit": {"oid": "719de7c7616909294f20dd13239e2521dc703db1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMjowMDowOVrOF5kVtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMjowMDowOVrOF5kVtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkwODUzMw==", "bodyText": "I think you might want to set the parent for timeOutTimer", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5651#discussion_r395908533", "createdAt": "2020-03-20T22:00:09Z", "author": {"login": "etherealjoy"}, "path": "modules/openapi-generator/src/main/resources/cpp-qt5-client/HttpRequest.cpp.mustache", "diffHunk": "@@ -45,14 +45,15 @@ void {{prefix}}HttpRequestInput::add_file(QString variable_name, QString local_f\n }\n \n {{prefix}}HttpRequestWorker::{{prefix}}HttpRequestWorker(QObject *parent)\n-    : QObject(parent), manager(nullptr), _timeOut(0) {\n+    : QObject(parent), manager(nullptr), timeOutTimer() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "719de7c7616909294f20dd13239e2521dc703db1"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4ODM1ODk0", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5651#pullrequestreview-378835894", "createdAt": "2020-03-20T22:01:55Z", "commit": {"oid": "719de7c7616909294f20dd13239e2521dc703db1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMjowMTo1NVrOF5kXsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMjowMTo1NVrOF5kXsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkwOTA0Mw==", "bodyText": "is this needed?", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5651#discussion_r395909043", "createdAt": "2020-03-20T22:01:55Z", "author": {"login": "etherealjoy"}, "path": "modules/openapi-generator/src/main/resources/cpp-qt5-client/HttpRequest.cpp.mustache", "diffHunk": "@@ -86,8 +87,11 @@ QByteArray *{{prefix}}HttpRequestWorker::getMultiPartField(const QString &fieldn\n     return nullptr;\n }\n \n-void {{prefix}}HttpRequestWorker::setTimeOut(int timeOut) {\n-    _timeOut = timeOut;\n+void {{prefix}}HttpRequestWorker::setTimeOut(int timeOutMs) {\n+    timeOutTimer.setInterval(timeOutMs);\n+    if(timeOutTimer.interval() == 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "719de7c7616909294f20dd13239e2521dc703db1"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4ODM2NDk5", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5651#pullrequestreview-378836499", "createdAt": "2020-03-20T22:03:28Z", "commit": {"oid": "719de7c7616909294f20dd13239e2521dc703db1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMjowMzoyOFrOF5kZkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMjowMzoyOFrOF5kZkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkwOTUyMA==", "bodyText": "This is available only on 5.12 and above. Is there a possibility to use a more backward compatible call?", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5651#discussion_r395909520", "createdAt": "2020-03-20T22:03:28Z", "author": {"login": "etherealjoy"}, "path": "modules/openapi-generator/src/main/resources/cpp-qt5-client/HttpRequest.cpp.mustache", "diffHunk": "@@ -347,12 +351,14 @@ void {{prefix}}HttpRequestWorker::execute({{prefix}}HttpRequestInput *input) {\n         buffer->setParent(reply);\n #endif\n     }\n-    if (_timeOut > 0) {\n-        QTimer::singleShot(_timeOut, [=]() { on_manager_timeout(reply); });\n+    if (timeOutTimer.interval() > 0) {\n+        timeOutTimer.callOnTimeout([=]() { on_manager_timeout(reply); });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "719de7c7616909294f20dd13239e2521dc703db1"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4ODM2ODQz", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5651#pullrequestreview-378836843", "createdAt": "2020-03-20T22:04:23Z", "commit": {"oid": "719de7c7616909294f20dd13239e2521dc703db1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMjowNDoyNFrOF5kadw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMjowNDoyNFrOF5kadw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkwOTc1MQ==", "bodyText": "Need to stop the timer here too.", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5651#discussion_r395909751", "createdAt": "2020-03-20T22:04:24Z", "author": {"login": "etherealjoy"}, "path": "modules/openapi-generator/src/main/resources/cpp-qt5-client/HttpRequest.cpp.mustache", "diffHunk": "@@ -347,12 +351,14 @@ void {{prefix}}HttpRequestWorker::execute({{prefix}}HttpRequestInput *input) {\n         buffer->setParent(reply);\n #endif\n     }\n-    if (_timeOut > 0) {\n-        QTimer::singleShot(_timeOut, [=]() { on_manager_timeout(reply); });\n+    if (timeOutTimer.interval() > 0) {\n+        timeOutTimer.callOnTimeout([=]() { on_manager_timeout(reply); });\n     }\n }\n \n void {{prefix}}HttpRequestWorker::on_manager_finished(QNetworkReply *reply) {\n+    if(timeOutTimer.interval() > 0)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "719de7c7616909294f20dd13239e2521dc703db1"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21f7e48c8c20226f8b493b3e6ada3c87949fd3e6", "author": {"user": null}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/21f7e48c8c20226f8b493b3e6ada3c87949fd3e6", "committedDate": "2020-03-23T14:57:40Z", "message": "#minor fixes after review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40617d6ee96706c191b0923e6d8f802adbf911fa", "author": {"user": {"login": "etherealjoy", "name": "sunn"}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/40617d6ee96706c191b0923e6d8f802adbf911fa", "committedDate": "2020-03-24T12:26:56Z", "message": "Regenerate changed files"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMjYwMDYx", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5651#pullrequestreview-380260061", "createdAt": "2020-03-24T12:28:16Z", "commit": {"oid": "40617d6ee96706c191b0923e6d8f802adbf911fa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2620, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}