{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUzNzY0ODQ3", "number": 7002, "title": "[Protobuf] Make it possible to override field numbers using x-protobuf-index", "bodyText": "As described in issue #6756 .\nCc: @dobl1 .\nThe protobuf generator currently does not guarantee that generated field numbers are preserved across multiple generations: it always generates them as a sequence from 0 to n (through the x-index vendor extension). If fields are re-ordered, added, or deleted, field numbers will almost always shift. This is a big deal, as field numbers are part of the binary interface of protobuf serialization format.\nThis change is making it possible to specify protobuf field numbers using the vendor extension x-protobuf-index. This is an opt-in feature at field level: if x-protobuf-index is not specified, then the current behavior based on x-index still applies. In other words: this is backward compatible.\nFor example, the following data definition:\nPet:\n  type: object\n  properties:\n    id:\n      type: integer\n      x-protobuf-index: 3\n    name:\n      type: string\n      x-protobuf-index: 1\n... will generate the below protobuf message:\nmessage Pet {\n  int64 id = 3;\n  string name = 1;\n}\nI do not expect this pull-request to be merged as-is, I rather see it as a conversation-starter: do you agree with the general approach ? How would you suggest I improve the implementation ? I'd rather get feedback before investing time in writing automated tests, for example. For now, I've just manually validated the behavior on a toy example.\n\nPR checklist\n\n Read the contribution guidelines.\n If contributing template-only or documentation-only changes which will change sample output, build the project beforehand.\n Run the shell script ./bin/generate-samples.shto update all Petstore samples related to your fix. This is important, as CI jobs will verify all generator outputs of your HEAD commit as it would merge with master. These must match the expectations made by your contribution. You may regenerate an individual generator by passing the relevant config(s) as an argument to the script, for example ./bin/generate-samples.sh bin/configs/java*. For Windows users, please run the script in Git BASH.\n File the PR against the correct branch: master\n Copy the technical committee to review the pull request if your PR is targeting a particular programming language.", "createdAt": "2020-07-20T19:31:42Z", "url": "https://github.com/OpenAPITools/openapi-generator/pull/7002", "merged": true, "mergeCommit": {"oid": "8d63f75966f307063428e48b811b6c102bcb4845"}, "closed": true, "closedAt": "2020-07-26T09:25:36Z", "author": {"login": "k0ral"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc4abnOABqjM1ODYzNTY1MzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc4oWhxgBqjM1ODY4NTk0NDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "482f5fb967b027905860a3b556a7e71d2052e923", "author": {"user": {"login": "k0ral", "name": null}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/482f5fb967b027905860a3b556a7e71d2052e923", "committedDate": "2020-07-20T17:45:19Z", "message": "[Protobuf] Make it possible to override field index using x-protobuf-index"}, "afterCommit": {"oid": "0b881139d9d5cffdeece02972f4aab5214c1d3d8", "author": {"user": {"login": "k0ral", "name": null}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/0b881139d9d5cffdeece02972f4aab5214c1d3d8", "committedDate": "2020-07-25T15:33:22Z", "message": "[Protobuf] Make it possible to override field index using x-protobuf-index"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0b881139d9d5cffdeece02972f4aab5214c1d3d8", "author": {"user": {"login": "k0ral", "name": null}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/0b881139d9d5cffdeece02972f4aab5214c1d3d8", "committedDate": "2020-07-25T15:33:22Z", "message": "[Protobuf] Make it possible to override field index using x-protobuf-index"}, "afterCommit": {"oid": "52e166274803ac7e4b468a3e2106e6647a5cdc8c", "author": {"user": {"login": "k0ral", "name": null}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/52e166274803ac7e4b468a3e2106e6647a5cdc8c", "committedDate": "2020-07-25T15:34:06Z", "message": "[Protobuf] Make it possible to override field index using x-protobuf-index"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "52e166274803ac7e4b468a3e2106e6647a5cdc8c", "author": {"user": {"login": "k0ral", "name": null}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/52e166274803ac7e4b468a3e2106e6647a5cdc8c", "committedDate": "2020-07-25T15:34:06Z", "message": "[Protobuf] Make it possible to override field index using x-protobuf-index"}, "afterCommit": {"oid": "150fbf39b95677b89e3b0f86fd793f28ed19b77c", "author": {"user": {"login": "k0ral", "name": null}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/150fbf39b95677b89e3b0f86fd793f28ed19b77c", "committedDate": "2020-07-25T15:42:19Z", "message": "[Protobuf] Make it possible to override field index using x-protobuf-index"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MzM5NzYz", "url": "https://github.com/OpenAPITools/openapi-generator/pull/7002#pullrequestreview-455339763", "createdAt": "2020-07-26T07:30:33Z", "commit": {"oid": "150fbf39b95677b89e3b0f86fd793f28ed19b77c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNlQwNzozMDozM1rOG3KLmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNlQwNzozMDozM1rOG3KLmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ5MTY3Mw==", "bodyText": "@k0ral overall it looks good \ud83d\udc4d but this line is missing the ; at the end.", "url": "https://github.com/OpenAPITools/openapi-generator/pull/7002#discussion_r460491673", "createdAt": "2020-07-26T07:30:33Z", "author": {"login": "wing328"}, "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/ProtobufSchemaCodegen.java", "diffHunk": "@@ -216,13 +215,12 @@ public String toOperationId(String operationId) {\n     public Map<String, Object> postProcessModels(Map<String, Object> objs) {\n         objs = postProcessModelsEnum(objs);\n         List<Object> models = (List<Object>) objs.get(\"models\");\n-        // add x-index to properties\n-        ProcessUtils.addIndexToProperties(models, 1);\n \n         for (Object _mo : models) {\n             Map<String, Object> mo = (Map<String, Object>) _mo;\n             CodegenModel cm = (CodegenModel) mo.get(\"model\");\n \n+            int index = 1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "150fbf39b95677b89e3b0f86fd793f28ed19b77c"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78934ba9f976f2a241a793380ac037eeb37bf1a9", "author": {"user": {"login": "k0ral", "name": null}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/78934ba9f976f2a241a793380ac037eeb37bf1a9", "committedDate": "2020-07-26T07:46:33Z", "message": "[Protobuf] Make it possible to override field index using x-protobuf-index"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "150fbf39b95677b89e3b0f86fd793f28ed19b77c", "author": {"user": {"login": "k0ral", "name": null}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/150fbf39b95677b89e3b0f86fd793f28ed19b77c", "committedDate": "2020-07-25T15:42:19Z", "message": "[Protobuf] Make it possible to override field index using x-protobuf-index"}, "afterCommit": {"oid": "78934ba9f976f2a241a793380ac037eeb37bf1a9", "author": {"user": {"login": "k0ral", "name": null}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/78934ba9f976f2a241a793380ac037eeb37bf1a9", "committedDate": "2020-07-26T07:46:33Z", "message": "[Protobuf] Make it possible to override field index using x-protobuf-index"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3255, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}