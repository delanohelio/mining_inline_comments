{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM2MTE5NTA4", "number": 8153, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQyMDo1OTo0NVrOFDrh8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQyMToxMjozM1rOFDr2lQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5NDAzMjUwOnYy", "diffSide": "RIGHT", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/DartClientCodegen.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQyMDo1OTo0NVrOIDdDQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQyMDo1OTo0NVrOIDdDQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQ5MjYxMA==", "bodyText": "Sets.newHashSet from guava", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8153#discussion_r540492610", "createdAt": "2020-12-10T20:59:45Z", "author": {"login": "agilob"}, "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/DartClientCodegen.java", "diffHunk": "@@ -188,6 +177,8 @@ public DartClientCodegen() {\n         importMapping.put(\"Set\", \"dart:core\");\n         importMapping.put(\"DateTime\", \"dart:core\");\n \n+        defaultIncludes = new HashSet<>(Collections.singletonList(\"dart:core\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b86d5c40c26cbe1f9f23c7ba06a9ecdfbb78a4b8"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5NDA4MjYwOnYy", "diffSide": "RIGHT", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/DartClientCodegen.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQyMToxMTo1M1rOIDdfoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQyMjo1MToyNlrOIDg6Iw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQ5OTg3Mg==", "bodyText": "can you add unit tests to this method?", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8153#discussion_r540499872", "createdAt": "2020-12-10T21:11:53Z", "author": {"login": "agilob"}, "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/DartClientCodegen.java", "diffHunk": "@@ -474,34 +465,62 @@ public String toDefaultValue(Schema schema) {\n \n     @Override\n     public String getTypeDeclaration(Schema p) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b86d5c40c26cbe1f9f23c7ba06a9ecdfbb78a4b8"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU1NTgxMQ==", "bodyText": "There are tests for dart and dart-dio that test the type returned for array and map OAS types.", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8153#discussion_r540555811", "createdAt": "2020-12-10T22:51:26Z", "author": {"login": "kuhnroyal"}, "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/DartClientCodegen.java", "diffHunk": "@@ -474,34 +465,62 @@ public String toDefaultValue(Schema schema) {\n \n     @Override\n     public String getTypeDeclaration(Schema p) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQ5OTg3Mg=="}, "originalCommit": {"oid": "b86d5c40c26cbe1f9f23c7ba06a9ecdfbb78a4b8"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5NDA4NTMzOnYy", "diffSide": "RIGHT", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/DartClientCodegen.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQyMToxMjozM1rOIDdhOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQyMzowMzo1M1rOIDhd5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDUwMDI4MA==", "bodyText": "can you add unit tests for this method? is it worth to make it more dart-dio specific as the rest of the changes are dart-dio?", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8153#discussion_r540500280", "createdAt": "2020-12-10T21:12:33Z", "author": {"login": "agilob"}, "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/DartClientCodegen.java", "diffHunk": "@@ -474,34 +465,62 @@ public String toDefaultValue(Schema schema) {\n \n     @Override\n     public String getTypeDeclaration(Schema p) {\n-        if (ModelUtils.isArraySchema(p)) {\n-            ArraySchema ap = (ArraySchema) p;\n-            Schema inner = ap.getItems();\n-            return instantiationTypes().get(\"array\") + \"<\" + getTypeDeclaration(inner) + \">\";\n-        } else if (ModelUtils.isMapSchema(p)) {\n-            Schema inner = getAdditionalProperties(p);\n-            return instantiationTypes().get(\"map\") + \"<String, \" + getTypeDeclaration(inner) + \">\";\n+        Schema<?> schema = ModelUtils.unaliasSchema(this.openAPI, p, importMapping);\n+        Schema<?> target = ModelUtils.isGenerateAliasAsModel() ? p : schema;\n+        if (ModelUtils.isArraySchema(target)) {\n+            Schema<?> items = getSchemaItems((ArraySchema) schema);\n+            return getSchemaType(target) + \"<\" + getTypeDeclaration(items) + \">\";\n+        } else if (ModelUtils.isMapSchema(target)) {\n+            // Note: ModelUtils.isMapSchema(p) returns true when p is a composed schema that also defines\n+            // additionalproperties: true\n+            Schema<?> inner = getAdditionalProperties(target);\n+            if (inner == null) {\n+                LOGGER.error(\"`{}` (map property) does not have a proper inner type defined. Default to type:string\", p.getName());\n+                inner = new StringSchema().description(\"TODO default missing map inner type to string\");\n+                p.setAdditionalProperties(inner);\n+            }\n+            return getSchemaType(target) + \"<String, \" + getTypeDeclaration(inner) + \">\";\n         }\n         return super.getTypeDeclaration(p);\n     }\n \n     @Override\n     public String getSchemaType(Schema p) {\n-        String type = super.getSchemaType(p);\n-        if (typeMapping.containsKey(type)) {\n-            return typeMapping.get(type);\n+        String openAPIType = super.getSchemaType(p);\n+        if (openAPIType == null) {\n+            LOGGER.error(\"No Type defined for Schema \" + p);\n         }\n-        if (languageSpecificPrimitives.contains(type)) {\n-            return type;\n+        if (typeMapping.containsKey(openAPIType)) {\n+            return typeMapping.get(openAPIType);\n         }\n-        return toModelName(type);\n+        if (languageSpecificPrimitives.contains(openAPIType)) {\n+            return openAPIType;\n+        }\n+        return toModelName(openAPIType);\n     }\n \n     @Override\n     public Map<String, Object> postProcessModels(Map<String, Object> objs) {\n         return postProcessModelsEnum(objs);\n     }\n \n+    @Override\n+    public CodegenOperation fromOperation(String path, String httpMethod, Operation operation, List<Server> servers) {\n+        final CodegenOperation op = super.fromOperation(path, httpMethod, operation, servers);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b86d5c40c26cbe1f9f23c7ba06a9ecdfbb78a4b8"}, "originalPosition": 115}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU1OTgzNg==", "bodyText": "Could possibly be moved to the dart-dio generator.", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8153#discussion_r540559836", "createdAt": "2020-12-10T22:57:26Z", "author": {"login": "kuhnroyal"}, "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/DartClientCodegen.java", "diffHunk": "@@ -474,34 +465,62 @@ public String toDefaultValue(Schema schema) {\n \n     @Override\n     public String getTypeDeclaration(Schema p) {\n-        if (ModelUtils.isArraySchema(p)) {\n-            ArraySchema ap = (ArraySchema) p;\n-            Schema inner = ap.getItems();\n-            return instantiationTypes().get(\"array\") + \"<\" + getTypeDeclaration(inner) + \">\";\n-        } else if (ModelUtils.isMapSchema(p)) {\n-            Schema inner = getAdditionalProperties(p);\n-            return instantiationTypes().get(\"map\") + \"<String, \" + getTypeDeclaration(inner) + \">\";\n+        Schema<?> schema = ModelUtils.unaliasSchema(this.openAPI, p, importMapping);\n+        Schema<?> target = ModelUtils.isGenerateAliasAsModel() ? p : schema;\n+        if (ModelUtils.isArraySchema(target)) {\n+            Schema<?> items = getSchemaItems((ArraySchema) schema);\n+            return getSchemaType(target) + \"<\" + getTypeDeclaration(items) + \">\";\n+        } else if (ModelUtils.isMapSchema(target)) {\n+            // Note: ModelUtils.isMapSchema(p) returns true when p is a composed schema that also defines\n+            // additionalproperties: true\n+            Schema<?> inner = getAdditionalProperties(target);\n+            if (inner == null) {\n+                LOGGER.error(\"`{}` (map property) does not have a proper inner type defined. Default to type:string\", p.getName());\n+                inner = new StringSchema().description(\"TODO default missing map inner type to string\");\n+                p.setAdditionalProperties(inner);\n+            }\n+            return getSchemaType(target) + \"<String, \" + getTypeDeclaration(inner) + \">\";\n         }\n         return super.getTypeDeclaration(p);\n     }\n \n     @Override\n     public String getSchemaType(Schema p) {\n-        String type = super.getSchemaType(p);\n-        if (typeMapping.containsKey(type)) {\n-            return typeMapping.get(type);\n+        String openAPIType = super.getSchemaType(p);\n+        if (openAPIType == null) {\n+            LOGGER.error(\"No Type defined for Schema \" + p);\n         }\n-        if (languageSpecificPrimitives.contains(type)) {\n-            return type;\n+        if (typeMapping.containsKey(openAPIType)) {\n+            return typeMapping.get(openAPIType);\n         }\n-        return toModelName(type);\n+        if (languageSpecificPrimitives.contains(openAPIType)) {\n+            return openAPIType;\n+        }\n+        return toModelName(openAPIType);\n     }\n \n     @Override\n     public Map<String, Object> postProcessModels(Map<String, Object> objs) {\n         return postProcessModelsEnum(objs);\n     }\n \n+    @Override\n+    public CodegenOperation fromOperation(String path, String httpMethod, Operation operation, List<Server> servers) {\n+        final CodegenOperation op = super.fromOperation(path, httpMethod, operation, servers);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDUwMDI4MA=="}, "originalCommit": {"oid": "b86d5c40c26cbe1f9f23c7ba06a9ecdfbb78a4b8"}, "originalPosition": 115}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU2NDk2Ng==", "bodyText": "makes sense to keep it here for all darts.", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8153#discussion_r540564966", "createdAt": "2020-12-10T23:03:53Z", "author": {"login": "agilob"}, "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/DartClientCodegen.java", "diffHunk": "@@ -474,34 +465,62 @@ public String toDefaultValue(Schema schema) {\n \n     @Override\n     public String getTypeDeclaration(Schema p) {\n-        if (ModelUtils.isArraySchema(p)) {\n-            ArraySchema ap = (ArraySchema) p;\n-            Schema inner = ap.getItems();\n-            return instantiationTypes().get(\"array\") + \"<\" + getTypeDeclaration(inner) + \">\";\n-        } else if (ModelUtils.isMapSchema(p)) {\n-            Schema inner = getAdditionalProperties(p);\n-            return instantiationTypes().get(\"map\") + \"<String, \" + getTypeDeclaration(inner) + \">\";\n+        Schema<?> schema = ModelUtils.unaliasSchema(this.openAPI, p, importMapping);\n+        Schema<?> target = ModelUtils.isGenerateAliasAsModel() ? p : schema;\n+        if (ModelUtils.isArraySchema(target)) {\n+            Schema<?> items = getSchemaItems((ArraySchema) schema);\n+            return getSchemaType(target) + \"<\" + getTypeDeclaration(items) + \">\";\n+        } else if (ModelUtils.isMapSchema(target)) {\n+            // Note: ModelUtils.isMapSchema(p) returns true when p is a composed schema that also defines\n+            // additionalproperties: true\n+            Schema<?> inner = getAdditionalProperties(target);\n+            if (inner == null) {\n+                LOGGER.error(\"`{}` (map property) does not have a proper inner type defined. Default to type:string\", p.getName());\n+                inner = new StringSchema().description(\"TODO default missing map inner type to string\");\n+                p.setAdditionalProperties(inner);\n+            }\n+            return getSchemaType(target) + \"<String, \" + getTypeDeclaration(inner) + \">\";\n         }\n         return super.getTypeDeclaration(p);\n     }\n \n     @Override\n     public String getSchemaType(Schema p) {\n-        String type = super.getSchemaType(p);\n-        if (typeMapping.containsKey(type)) {\n-            return typeMapping.get(type);\n+        String openAPIType = super.getSchemaType(p);\n+        if (openAPIType == null) {\n+            LOGGER.error(\"No Type defined for Schema \" + p);\n         }\n-        if (languageSpecificPrimitives.contains(type)) {\n-            return type;\n+        if (typeMapping.containsKey(openAPIType)) {\n+            return typeMapping.get(openAPIType);\n         }\n-        return toModelName(type);\n+        if (languageSpecificPrimitives.contains(openAPIType)) {\n+            return openAPIType;\n+        }\n+        return toModelName(openAPIType);\n     }\n \n     @Override\n     public Map<String, Object> postProcessModels(Map<String, Object> objs) {\n         return postProcessModelsEnum(objs);\n     }\n \n+    @Override\n+    public CodegenOperation fromOperation(String path, String httpMethod, Operation operation, List<Server> servers) {\n+        final CodegenOperation op = super.fromOperation(path, httpMethod, operation, servers);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDUwMDI4MA=="}, "originalCommit": {"oid": "b86d5c40c26cbe1f9f23c7ba06a9ecdfbb78a4b8"}, "originalPosition": 115}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3925, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}