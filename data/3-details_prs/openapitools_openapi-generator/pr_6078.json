{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA5NTY1MjI5", "number": 6078, "title": "[php-symfony] Fix problem with clients, that put charset in content type header.", "bodyText": "With this fix header \"Content-Type: application/json; charset=utf-8\" working same as \"Content-Type: application/json\" for parse input data\n\nPR checklist\n\n[ + Read the contribution guidelines.\n[+] If contributing template-only or documentation-only changes which will change sample output, build the project before.\n[+] Run the shell script(s) under ./bin/ (or Windows batch scripts under.\\bin\\windows) to update Petstore samples related to your fix. This is important, as CI jobs will verify all generator outputs of your HEAD commit, and these must match the expectations made by your contribution. You only need to run ./bin/{LANG}-petstore.sh, ./bin/openapi3/{LANG}-petstore.sh if updating the code or mustache templates for a language ({LANG}) (e.g. php, ruby, python, etc).\n[+] File the PR against the correct branch: master, 4.3.x, 5.0.x. Default: master.\n[+] Copy the technical committee to review the pull request if your PR is targeting a particular programming language.\n\n@jebentier (2017/07), @dkarlovi (2017/07), @mandrean (2017/08), @jfastnacht (2017/09), @ackintosh (2017/09)\u00a0\u2764\ufe0f, @ybelenko (2018/07), @renepardon (2018/12)", "createdAt": "2020-04-27T15:12:53Z", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6078", "merged": true, "mergeCommit": {"oid": "3e2c933dec3cb1ca30576500098fdb2e8a37096e"}, "closed": true, "closedAt": "2020-04-30T09:22:45Z", "author": {"login": "reznikartem"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcbwwFUAH2gAyNDA5NTY1MjI5OmZkZGZiYmNmMWRkMzdkNTcyYmU4MjkxYzJhOTM5NDJkY2RjMjc3MTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccaKRngH2gAyNDA5NTY1MjI5OmYxNzE2MjEwMWZmNTYyNmUyZWEzNzMyNDdmMWYzZTI3Yzc1MzUxODY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fddfbbcf1dd37d572be8291c2a93942dcdc27712", "author": {"user": {"login": "reznikartem", "name": "Artem"}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/fddfbbcf1dd37d572be8291c2a93942dcdc27712", "committedDate": "2020-04-27T15:10:00Z", "message": "Fix problem with clients, that put charset in content type header.\n\nWith this fix header \"Content-Type: application/json; charset=utf-8\" working same as \"Content-Type: application/json\" for parse input data"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxNDM5NzI3", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6078#pullrequestreview-401439727", "createdAt": "2020-04-28T01:37:34Z", "commit": {"oid": "fddfbbcf1dd37d572be8291c2a93942dcdc27712"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQwMTozNzozNFrOGM-vrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQwMTo0MToyNlrOGM-0jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjI2NDEwOA==", "bodyText": "Please fix coding style at least in your changes(line 65 and 494).\n$  ./vendor/bin/phpcs --standard=PSR2 -n -s ./Controller/PetController.php\n\nFILE: ...store/php-symfony/SymfonyBundle-php/Controller/PetController.php\n----------------------------------------------------------------------\nFOUND 3 ERRORS AFFECTING 3 LINES\n----------------------------------------------------------------------\n  19 | ERROR | [x] Whitespace found at end of line\n     |       |     (Squiz.WhiteSpace.SuperfluousWhitespace.EndLine)\n  65 | ERROR | [x] No space found after comma in function call\n     |       |     (Generic.Functions.FunctionCallArgumentSpacing.NoSpaceAfterComma)\n 494 | ERROR | [x] No space found after comma in function call\n     |       |     (Generic.Functions.FunctionCallArgumentSpacing.NoSpaceAfterComma)\n----------------------------------------------------------------------\nPHPCBF CAN FIX THE 3 MARKED SNIFF VIOLATIONS AUTOMATICALLY\n----------------------------------------------------------------------", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6078#discussion_r416264108", "createdAt": "2020-04-28T01:37:34Z", "author": {"login": "ybelenko"}, "path": "samples/server/petstore/php-symfony/SymfonyBundle-php/Controller/PetController.php", "diffHunk": "@@ -62,7 +62,7 @@ public function addPetAction(Request $request)\n     {\n         // Make sure that the client is providing something that we can consume\n         $consumes = ['application/json', 'application/xml'];\n-        $inputFormat = $request->headers->has('Content-Type')?$request->headers->get('Content-Type'):$consumes[0];\n+        $inputFormat = $request->headers->has('Content-Type')?explode(\";\",$request->headers->get('Content-Type'))[0]:$consumes[0];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fddfbbcf1dd37d572be8291c2a93942dcdc27712"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjI2NTAwOA==", "bodyText": "$  ./vendor/bin/phpcs --standard=PSR2 -n -s ./Controller/StoreController.php\n\nFILE: ...ore/php-symfony/SymfonyBundle-php/Controller/StoreController.php\n----------------------------------------------------------------------\nFOUND 2 ERRORS AFFECTING 2 LINES\n----------------------------------------------------------------------\n  19 | ERROR | [x] Whitespace found at end of line\n     |       |     (Squiz.WhiteSpace.SuperfluousWhitespace.EndLine)\n 287 | ERROR | [x] No space found after comma in function call\n     |       |     (Generic.Functions.FunctionCallArgumentSpacing.NoSpaceAfterComma)\n----------------------------------------------------------------------\nPHPCBF CAN FIX THE 2 MARKED SNIFF VIOLATIONS AUTOMATICALLY\n----------------------------------------------------------------------", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6078#discussion_r416265008", "createdAt": "2020-04-28T01:40:31Z", "author": {"login": "ybelenko"}, "path": "samples/server/petstore/php-symfony/SymfonyBundle-php/Controller/StoreController.php", "diffHunk": "@@ -284,7 +284,7 @@ public function placeOrderAction(Request $request)\n     {\n         // Make sure that the client is providing something that we can consume\n         $consumes = [];\n-        $inputFormat = $request->headers->has('Content-Type')?$request->headers->get('Content-Type'):$consumes[0];\n+        $inputFormat = $request->headers->has('Content-Type')?explode(\";\",$request->headers->get('Content-Type'))[0]:$consumes[0];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fddfbbcf1dd37d572be8291c2a93942dcdc27712"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjI2NTM1OA==", "bodyText": "$consumes = [];\n$inputFormat = $request->headers->has('Content-Type')?$request->headers->get('Content-Type'):$consumes[0];\n// request without Content-Type returns $consumes[0] which doesn't exist\n// so I think it throws unexpected index error\nBut it was there before you, so you don't have to fix it. Just an observation.\nAnd PHPCodeSniffer errors:\n$  ./vendor/bin/phpcs --standard=PSR2 -n -s ./Controller/UserController.php\n\nFILE: ...tore/php-symfony/SymfonyBundle-php/Controller/UserController.php\n----------------------------------------------------------------------\nFOUND 5 ERRORS AFFECTING 5 LINES\n----------------------------------------------------------------------\n  19 | ERROR | [x] Whitespace found at end of line\n     |       |     (Squiz.WhiteSpace.SuperfluousWhitespace.EndLine)\n  64 | ERROR | [x] No space found after comma in function call\n     |       |     (Generic.Functions.FunctionCallArgumentSpacing.NoSpaceAfterComma)\n 141 | ERROR | [x] No space found after comma in function call\n     |       |     (Generic.Functions.FunctionCallArgumentSpacing.NoSpaceAfterComma)\n 220 | ERROR | [x] No space found after comma in function call\n     |       |     (Generic.Functions.FunctionCallArgumentSpacing.NoSpaceAfterComma)\n 595 | ERROR | [x] No space found after comma in function call\n     |       |     (Generic.Functions.FunctionCallArgumentSpacing.NoSpaceAfterComma)\n----------------------------------------------------------------------\nPHPCBF CAN FIX THE 5 MARKED SNIFF VIOLATIONS AUTOMATICALLY\n----------------------------------------------------------------------", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6078#discussion_r416265358", "createdAt": "2020-04-28T01:41:26Z", "author": {"login": "ybelenko"}, "path": "samples/server/petstore/php-symfony/SymfonyBundle-php/Controller/UserController.php", "diffHunk": "@@ -61,7 +61,7 @@ public function createUserAction(Request $request)\n     {\n         // Make sure that the client is providing something that we can consume\n         $consumes = [];\n-        $inputFormat = $request->headers->has('Content-Type')?$request->headers->get('Content-Type'):$consumes[0];\n+        $inputFormat = $request->headers->has('Content-Type')?explode(\";\",$request->headers->get('Content-Type'))[0]:$consumes[0];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fddfbbcf1dd37d572be8291c2a93942dcdc27712"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58c4d251f2b228d62cc0ab919ec68bbdfd54b09d", "author": {"user": {"login": "reznikartem", "name": "Artem"}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/58c4d251f2b228d62cc0ab919ec68bbdfd54b09d", "committedDate": "2020-04-28T08:59:03Z", "message": "Fix code style, add $consumes length check."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMTA0MDEy", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6078#pullrequestreview-402104012", "createdAt": "2020-04-28T18:30:21Z", "commit": {"oid": "58c4d251f2b228d62cc0ab919ec68bbdfd54b09d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMTExNzYy", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6078#pullrequestreview-402111762", "createdAt": "2020-04-28T18:40:52Z", "commit": {"oid": "58c4d251f2b228d62cc0ab919ec68bbdfd54b09d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxODo0MDo1M1rOGNh3tg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxODo0MDo1M1rOGNh3tg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjgzOTYwNg==", "bodyText": "Well, PR is ready to be merged now. But I would suggest to put your changes into base Controller/Controller.php class method and cover it with unit tests to avoid this bug in future. Public method(maybe static) like:\npublic static function isContentTypeAllowed(Request $request, array $consumes = []): bool;\nOf course you can stay with your changes, it's just a suggestion.", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6078#discussion_r416839606", "createdAt": "2020-04-28T18:40:53Z", "author": {"login": "ybelenko"}, "path": "modules/openapi-generator/src/main/resources/php-symfony/api_controller.mustache", "diffHunk": "@@ -60,10 +60,16 @@ class {{controllerName}} extends Controller\n         {{#bodyParams}}\n         // Make sure that the client is providing something that we can consume\n         $consumes = [{{#consumes}}'{{{mediaType}}}'{{#hasMore}}, {{/hasMore}}{{/consumes}}];\n-        $inputFormat = $request->headers->has('Content-Type')?$request->headers->get('Content-Type'):$consumes[0];\n-        if (!in_array($inputFormat, $consumes)) {\n-            // We can't consume the content that the client is sending us\n-            return new Response('', 415);\n+        if (sizeof($consumes) > 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "58c4d251f2b228d62cc0ab919ec68bbdfd54b09d"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa582b3aae799307259d429fd939336bd97f1c3d", "author": {"user": {"login": "ybelenko", "name": "Yuriy Belenko"}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/fa582b3aae799307259d429fd939336bd97f1c3d", "committedDate": "2020-04-29T15:21:40Z", "message": "Add isContentTypeAllowed static method and tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11a192c075057a3d895e9d570766862bc796df9c", "author": {"user": {"login": "ybelenko", "name": "Yuriy Belenko"}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/11a192c075057a3d895e9d570766862bc796df9c", "committedDate": "2020-04-29T15:23:43Z", "message": "Fix old tests\n\nRight now serializer doesn't support anything beside json and xml.\nCall tests with application/json instead of form data."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f17162101ff5626e2ea373247f1f3e27c7535186", "author": {"user": {"login": "ybelenko", "name": "Yuriy Belenko"}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/f17162101ff5626e2ea373247f1f3e27c7535186", "committedDate": "2020-04-29T15:24:43Z", "message": "Refresh samples"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2500, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}