{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5NTY3NzQ0", "number": 5177, "title": "[Java][okhttp-gson] Use builder api of OkHttpClient to avoid UnsupportedOperationEx", "bodyText": "Fix Issue #3432\nChanged the template for generating the ApiClient.java class for Java with okhttp-gson library so that the GzipRequestInterceptor and the RetryingOauth interceptors are added to the OkHttpClient builder before building it. This avoids modifying the immutable list of interceptors which caused the UnsupportedOperationException before.\n@bbdouglas (2017/07) @sreeshas (2017/08) @jfiala (2017/08) @lukoyanov (2017/09) @cbornet (2017/09) @jeff9finger (2018/01) @karismann (2019/03) @Zomzog (2019/04) @lwlee2608 (2019/10) @bkabrda (2020/01)\nPR checklist\n\n Read the contribution guidelines.\n If contributing template-only or documentation-only changes which will change sample output, build the project before.\n Run the shell script(s) under ./bin/ (or Windows batch scripts under.\\bin\\windows) to update Petstore samples related to your fix. This is important, as CI jobs will verify all generator outputs of your HEAD commit, and these must match the expectations made by your contribution. You only need to run ./bin/{LANG}-petstore.sh, ./bin/openapi3/{LANG}-petstore.sh if updating the code or mustache templates for a language ({LANG}) (e.g. php, ruby, python, etc).\n File the PR against the correct branch: master, 4.3.x, 5.0.x. Default: master.\n Copy the technical committee to review the pull request if your PR is targeting a particular programming language.", "createdAt": "2020-01-31T12:52:18Z", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5177", "merged": true, "mergeCommit": {"oid": "f5265853ba56a8017c74bb08ea25dd4d0b3ac66e"}, "closed": true, "closedAt": "2020-02-13T13:55:11Z", "author": {"login": "trohrberg"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_rnrggH2gAyMzY5NTY3NzQ0OmE0NjcyMTYxMTU4ZTUxNDg4YzE3M2FjNDY3M2E4YzY3Y2QzZTZjYmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcD7UTlAFqTM1ODIzMjE0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a4672161158e51488c173ac4673a8c67cd3e6cbf", "author": {"user": null}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/a4672161158e51488c173ac4673a8c67cd3e6cbf", "committedDate": "2020-01-31T09:21:25Z", "message": "3432 Use builder api of OkHttpClient to avoid UnsupportedOperationEx\n\nThe reason for the UnsupportedOperationException was an invalid access to the interceptors list of OkHttpClient. That list is unmodifiable as stated by the JavaDoc. Instead accessing the list directly, the interceptors should always be passed when building the client by the builder api."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dca86546ab25d5e04444f492fcd3a06e12e219bf", "author": {"user": null}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/dca86546ab25d5e04444f492fcd3a06e12e219bf", "committedDate": "2020-01-31T15:34:31Z", "message": "3432 Use builder api of OkHttpClient to avoid UnsupportedOperationEx\n\nThe reason for the UnsupportedOperationException was an invalid access to the interceptors list of OkHttpClient. That list is unmodifiable as stated by the JavaDoc. Instead accessing the list directly, the interceptors should always be passed when building the client by the builder api."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4096155749fddbf48e1617d8278295a48f306703", "author": {"user": null}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/4096155749fddbf48e1617d8278295a48f306703", "committedDate": "2020-01-31T15:34:53Z", "message": "Merge branch 'fix_issue_3432' of https://github.com/trohrberg/openapi-generator into fix_issue_3432"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebaeacb98bd0ff43353be7f3f3e7db14b1aea9ca", "author": {"user": null}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/ebaeacb98bd0ff43353be7f3f3e7db14b1aea9ca", "committedDate": "2020-02-01T11:48:29Z", "message": "3432 Follow-up fix to make samples compile again"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "652f1ac8a9937dc2d91688294f2f433681801527", "author": {"user": null}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/652f1ac8a9937dc2d91688294f2f433681801527", "committedDate": "2020-02-01T15:18:13Z", "message": "3432 Updated sample implementation for okHttp-Gson-ParcelableModel"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4MjMyMTQ3", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5177#pullrequestreview-358232147", "createdAt": "2020-02-13T13:54:26Z", "commit": {"oid": "652f1ac8a9937dc2d91688294f2f433681801527"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QxMzo1NDoyNlrOFpUktA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QxMzo1NDoyNlrOFpUktA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg3MzAxMg==", "bodyText": "@trohrberg seems like these 2 lines are not indented correctly. I'll file a separate PR to update it after merging this one.", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5177#discussion_r378873012", "createdAt": "2020-02-13T13:54:26Z", "author": {"login": "wing328"}, "path": "modules/openapi-generator/src/main/resources/Java/libraries/okhttp-gson/ApiClient.mustache", "diffHunk": "@@ -139,16 +140,25 @@ public class ApiClient {\n     {{/-first}}\n     {{/oauthMethods}}\n     {{/hasOAuthMethods}}\n-    private void init() {\n+    private void initHttpClient() {\n+        initHttpClient(Collections.<Interceptor>emptyList());\n+    }\n+\n+    private void initHttpClient(List<Interceptor> interceptors) {\n         OkHttpClient.Builder builder = new OkHttpClient.Builder();\n         builder.addNetworkInterceptor(getProgressInterceptor());\n-        httpClient = builder.build();\n-\n+        for (Interceptor interceptor: interceptors) {\n+            builder.addInterceptor(interceptor);\n+        }\n         {{#useGzipFeature}}\n-        // Enable gzip request compression\n-        httpClient.interceptors().add(new GzipRequestInterceptor());\n+            // Enable gzip request compression\n+            builder.addInterceptor(new GzipRequestInterceptor());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "652f1ac8a9937dc2d91688294f2f433681801527"}, "originalPosition": 38}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2905, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}