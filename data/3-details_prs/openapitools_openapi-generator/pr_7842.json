{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyOTY3NjQ5", "number": 7842, "title": "[Ruby][faraday] fix download_file", "bodyText": "fixes: #7734\ndownload_file doesn't work.\n\nPR checklist\n\n Read the contribution guidelines.\n Pull Request title clearly describes the work in the pull request and Pull Request description provides details about how to validate the work. Missing information here may result in delayed response from the community.\n If contributing template-only or documentation-only changes which will change sample output, build the project beforehand.\n Run the shell script ./bin/generate-samples.shto update all Petstore samples related to your fix. This is important, as CI jobs will verify all generator outputs of your HEAD commit as it would merge with master. These must match the expectations made by your contribution. You may regenerate an individual generator by passing the relevant config(s) as an argument to the script, for example ./bin/generate-samples.sh bin/configs/java*. For Windows users, please run the script in Git BASH.\n File the PR against the correct branch: master\n Copy the technical committee to review the pull request if your PR is targeting a particular programming language.\n\ncc @cliffano (2017/07) @zlx (2017/09) @autopp (2019/02)", "createdAt": "2020-10-30T12:40:09Z", "url": "https://github.com/OpenAPITools/openapi-generator/pull/7842", "merged": true, "mergeCommit": {"oid": "46b36c2e652fa6170eba7aa5871cbd9b2fb2530d"}, "closed": true, "closedAt": "2020-10-31T08:20:32Z", "author": {"login": "tsuwatch"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXmCJjAH2gAyNTEyOTY3NjQ5OmYxZGY2YWNkZWU2N2VmZjcyODMzZTdjYmFjYWI1YjYyNGIwMDkyZTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXmWADgH2gAyNTEyOTY3NjQ5OjFiNGM5ZGY1NjdjNzFiZGE3ZmI4ZjUzNTk1MzMxNjZhNWNjYzllNjg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f1df6acdee67eff72833e7cbacab5b624b0092e7", "author": {"user": {"login": "tsuwatch", "name": "Tomohiro Suwa"}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/f1df6acdee67eff72833e7cbacab5b624b0092e7", "committedDate": "2020-10-30T12:36:14Z", "message": "Fix download_file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5c7e150323a68aee8e7cd72c8f5ccb9a20d8ed4", "author": {"user": {"login": "tsuwatch", "name": "Tomohiro Suwa"}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/d5c7e150323a68aee8e7cd72c8f5ccb9a20d8ed4", "committedDate": "2020-10-30T12:38:14Z", "message": "Generate samples with f1df6acdee6"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwNjMxMzQ2", "url": "https://github.com/OpenAPITools/openapi-generator/pull/7842#pullrequestreview-520631346", "createdAt": "2020-10-30T12:43:48Z", "commit": {"oid": "d5c7e150323a68aee8e7cd72c8f5ccb9a20d8ed4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMjo0Mzo0OFrOHrNbOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMjo0Mzo0OFrOHrNbOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA3MDc3OQ==", "bodyText": "Does not process this block.", "url": "https://github.com/OpenAPITools/openapi-generator/pull/7842#discussion_r515070779", "createdAt": "2020-10-30T12:43:48Z", "author": {"login": "tsuwatch"}, "path": "modules/openapi-generator/src/main/resources/ruby-client/api_client_faraday_partial.mustache", "diffHunk": "@@ -128,40 +128,11 @@\n       data\n     end\n \n-    # Save response body into a file in (the defined) temporary folder, using the filename\n-    # from the \"Content-Disposition\" header if provided, otherwise a random filename.\n-    # The response body is written to the file in chunks in order to handle files which\n-    # size is larger than maximum Ruby String or even larger than the maximum memory a Ruby\n-    # process can use.\n-    #\n-    # @see Configuration#temp_folder_path\n     def download_file(request)\n-      tempfile = nil\n-      encoding = nil\n-      request.headers do |response|", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5c7e150323a68aee8e7cd72c8f5ccb9a20d8ed4"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwNjMxNDgw", "url": "https://github.com/OpenAPITools/openapi-generator/pull/7842#pullrequestreview-520631480", "createdAt": "2020-10-30T12:44:00Z", "commit": {"oid": "d5c7e150323a68aee8e7cd72c8f5ccb9a20d8ed4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMjo0NDowMFrOHrNbng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMjo0NDowMFrOHrNbng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA3MDg3OA==", "bodyText": "@tsuwatch thanks for the PR. Would it be possible to keep the filename from the response headers if available?", "url": "https://github.com/OpenAPITools/openapi-generator/pull/7842#discussion_r515070878", "createdAt": "2020-10-30T12:44:00Z", "author": {"login": "wing328"}, "path": "modules/openapi-generator/src/main/resources/ruby-client/api_client_faraday_partial.mustache", "diffHunk": "@@ -128,40 +128,11 @@\n       data\n     end\n \n-    # Save response body into a file in (the defined) temporary folder, using the filename\n-    # from the \"Content-Disposition\" header if provided, otherwise a random filename.\n-    # The response body is written to the file in chunks in order to handle files which\n-    # size is larger than maximum Ruby String or even larger than the maximum memory a Ruby\n-    # process can use.\n-    #\n-    # @see Configuration#temp_folder_path\n     def download_file(request)\n-      tempfile = nil\n-      encoding = nil\n-      request.headers do |response|\n-        content_disposition = response.headers['Content-Disposition']\n-        if content_disposition && content_disposition =~ /filename=/i\n-          filename = content_disposition[/filename=['\"]?([^'\"\\s]+)['\"]?/, 1]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5c7e150323a68aee8e7cd72c8f5ccb9a20d8ed4"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwNjMyMDY0", "url": "https://github.com/OpenAPITools/openapi-generator/pull/7842#pullrequestreview-520632064", "createdAt": "2020-10-30T12:44:53Z", "commit": {"oid": "d5c7e150323a68aee8e7cd72c8f5ccb9a20d8ed4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMjo0NDo1M1rOHrNdTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMjo0NDo1M1rOHrNdTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA3MTMwOQ==", "bodyText": "@stream is array", "url": "https://github.com/OpenAPITools/openapi-generator/pull/7842#discussion_r515071309", "createdAt": "2020-10-30T12:44:53Z", "author": {"login": "tsuwatch"}, "path": "samples/client/petstore/ruby-faraday/lib/petstore/api_client.rb", "diffHunk": "@@ -232,7 +203,8 @@ def deserialize(response, return_type)\n       # handle file downloading - return the File instance processed in request callbacks\n       # note that response body is empty when the file is written in chunks in request on_body callback\n       if return_type == 'File'\n-        @tempfile.write(@stream)\n+        @tempfile = Tempfile.open('download-', @config.temp_folder_path, encoding: body.encoding)\n+        @tempfile.write(@stream.join.force_encoding(body.encoding))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5c7e150323a68aee8e7cd72c8f5ccb9a20d8ed4"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e3ea88b0dec7763c861e9623f88a9d1fa9034c8", "author": {"user": {"login": "tsuwatch", "name": "Tomohiro Suwa"}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/3e3ea88b0dec7763c861e9623f88a9d1fa9034c8", "committedDate": "2020-10-30T12:47:58Z", "message": "fixup! Fix download_file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b4c9df567c71bda7fb8f5359533166a5ccc9e68", "author": {"user": {"login": "tsuwatch", "name": "Tomohiro Suwa"}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/1b4c9df567c71bda7fb8f5359533166a5ccc9e68", "committedDate": "2020-10-30T12:57:55Z", "message": "Generate samples with 3e3ea88b0dec7763c8"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2947, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}