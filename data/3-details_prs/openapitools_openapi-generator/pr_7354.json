{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgwMjQ1MjQy", "number": 7354, "title": "[cli] Batch: support multiple/nested !include directive", "bodyText": "Issue 7311\nThis change updates the '!include' directive available in the 'batch' CLI command to handle multiple includes as well as nested includes.\nInstead of parsing the files into a tree, parsing them via the streaming API allows multiple and nested includes.\nThe appropriate test case (GenerateBatchTest) has been updated to test nested and multiple includes for both JSON and YAML.\nThe file usage.md has been updated to explain the change. It mentions version 5.0.0 as the affected version - that may have to change.\n\nPR checklist\n\n Read the contribution guidelines.\n Pull Request title clearly describes the work in the pull request and Pull Request description provides details about how to validate the work. Missing information here may result in delayed response from the community.\n If contributing template-only or documentation-only changes which will change sample output, build the project beforehand.\n Run the shell script ./bin/generate-samples.shto update all Petstore samples related to your fix. This is important, as CI jobs will verify all generator outputs of your HEAD commit as it would merge with master. These must match the expectations made by your contribution. You may regenerate an individual generator by passing the relevant config(s) as an argument to the script, for example ./bin/generate-samples.sh bin/configs/java*. For Windows users, please run the script in Git BASH.\n File the PR against the correct branch: master\n Copy the technical committee to review the pull request if your PR is targeting a particular programming language.", "createdAt": "2020-09-04T23:02:49Z", "url": "https://github.com/OpenAPITools/openapi-generator/pull/7354", "merged": true, "mergeCommit": {"oid": "6909c888d2e3a2f0887e7b40f0811275474faf3d"}, "closed": true, "closedAt": "2020-09-17T02:45:26Z", "author": {"login": "dtiller"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJTEHrgFqTQ4OTIyNTc4OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJm_1MABqjM3NzU3MDUwMjc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MjI1Nzg5", "url": "https://github.com/OpenAPITools/openapi-generator/pull/7354#pullrequestreview-489225789", "createdAt": "2020-09-16T02:13:38Z", "commit": {"oid": "0a614a17f91bd12ee1bc72cb01d1441cca458a0f"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwMjoxMzozOVrOHSdhJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwMjoyOToyM1rOHSdx_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEyMDAzOQ==", "bodyText": "Should be batch not !batch in the first changed sentence.\nAnd The suffixes in the last sentence.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            modified by `--includes-base-dir`. Starting with 5.0.0, the `!batch` command supports multiple `!include` properties, either sequential or nested. In order to support multiple `!include` properties in a JSON file, the property name can have a suffix, e.g. `!include1`, `!include2`, etc. The suffix have no meaning other than providing unique property names.\n          \n          \n            \n            modified by `--includes-base-dir`. Starting with 5.0.0, the `batch` command supports multiple `!include` properties, either sequential or nested. In order to support multiple `!include` properties in a JSON file, the property name can have a suffix, e.g. `!include1`, `!include2`, `!include_asdf`, etc. The suffixes have no meaning other than providing unique property names. The only requirement is that the property start with `!include`. Nested documents are loaded and merged in declaration order.", "url": "https://github.com/OpenAPITools/openapi-generator/pull/7354#discussion_r489120039", "createdAt": "2020-09-16T02:13:39Z", "author": {"login": "jimschubert"}, "path": "docs/usage.md", "diffHunk": "@@ -602,7 +602,7 @@ openapi-generator generate -i petstore.yaml -g typescript-fetch -o out \\\n The `batch` command allows you to move all CLI arguments supported by the `generate` command into a YAML or JSON file.\n \n *NOTE*: This command supports an additional `!include` property which may point to another \"shared\" file, the base path to which can be\n-modified by `--includes-base-dir`.\n+modified by `--includes-base-dir`. Starting with 5.0.0, the `!batch` command supports multiple `!include` properties, either sequential or nested. In order to support multiple `!include` properties in a JSON file, the property name can have a suffix, e.g. `!include1`, `!include2`, etc. The suffix have no meaning other than providing unique property names.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a614a17f91bd12ee1bc72cb01d1441cca458a0f"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEyNDI0NA==", "bodyText": "I wonder if we should move inputSpec from here to jaxrs-datelib-j8-nested.yaml to verify that the initial !include processing will also load sibling properties?", "url": "https://github.com/OpenAPITools/openapi-generator/pull/7354#discussion_r489124244", "createdAt": "2020-09-16T02:29:03Z", "author": {"login": "jimschubert"}, "path": "modules/openapi-generator-cli/src/test/resources/batch/jaxrs-datelib-j8-nested-include.yaml", "diffHunk": "@@ -0,0 +1,8 @@\n+---\n+\"!include\": common/jaxrs-datelib-j8.yaml\n+generatorName: jaxrs-jersey\n+inputSpec: batch/specs/petstore.yaml", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a614a17f91bd12ee1bc72cb01d1441cca458a0f"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEyNDM1MA==", "bodyText": "I wonder if we should move inputSpec from here to jaxrs-datelib-j8-nested.json to verify that the initial !include processing will also load sibling properties?\nI tested the suggestion locally for both JSON and YAML to verify the functionality.", "url": "https://github.com/OpenAPITools/openapi-generator/pull/7354#discussion_r489124350", "createdAt": "2020-09-16T02:29:23Z", "author": {"login": "jimschubert"}, "path": "modules/openapi-generator-cli/src/test/resources/batch/jaxrs-datelib-j8-nested-include.json", "diffHunk": "@@ -0,0 +1,10 @@\n+{\n+  \"!include\": \"common/jaxrs-datelib-j8.json\",\n+  \"generatorName\": \"jaxrs-jersey\",\n+  \"inputSpec\": \"batch/specs/petstore.yaml\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a614a17f91bd12ee1bc72cb01d1441cca458a0f"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0a614a17f91bd12ee1bc72cb01d1441cca458a0f", "author": {"user": null}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/0a614a17f91bd12ee1bc72cb01d1441cca458a0f", "committedDate": "2020-09-04T23:24:56Z", "message": "De-tabbed the file."}, "afterCommit": {"oid": "bfdf21693341e81bb3a0d088facbfd7a66cc793a", "author": {"user": {"login": "dtiller", "name": null}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/bfdf21693341e81bb3a0d088facbfd7a66cc793a", "committedDate": "2020-09-16T11:48:22Z", "message": "De-tabbed the file."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d86b0ab7dfcc33a50c5df16f18d3b6e5fc5eb28", "author": {"user": {"login": "dtiller", "name": null}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/6d86b0ab7dfcc33a50c5df16f18d3b6e5fc5eb28", "committedDate": "2020-09-17T01:21:55Z", "message": "[cli] Allow nested !include in batch command\n\n* Added sequenntial and nested `!include' support for the CLI batch generate command.\n\n* Added test cases.\n\n* Edited documentation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0f16f52c747516192271c44c600180c1c3aa986", "author": {"user": {"login": "jimschubert", "name": "Jim Schubert"}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/d0f16f52c747516192271c44c600180c1c3aa986", "committedDate": "2020-09-17T01:30:08Z", "message": "Move inputSpec into top-level of nested imports to verify merge functionality."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e757334f5dc2e23687f38f100c4967b8b96102df", "author": {"user": {"login": "jimschubert", "name": "Jim Schubert"}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/e757334f5dc2e23687f38f100c4967b8b96102df", "committedDate": "2020-09-17T01:44:06Z", "message": "Test property merging in nested imports in batch"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bfdf21693341e81bb3a0d088facbfd7a66cc793a", "author": {"user": {"login": "dtiller", "name": null}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/bfdf21693341e81bb3a0d088facbfd7a66cc793a", "committedDate": "2020-09-16T11:48:22Z", "message": "De-tabbed the file."}, "afterCommit": {"oid": "e757334f5dc2e23687f38f100c4967b8b96102df", "author": {"user": {"login": "jimschubert", "name": "Jim Schubert"}}, "url": "https://github.com/OpenAPITools/openapi-generator/commit/e757334f5dc2e23687f38f100c4967b8b96102df", "committedDate": "2020-09-17T01:44:06Z", "message": "Test property merging in nested imports in batch"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3233, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}