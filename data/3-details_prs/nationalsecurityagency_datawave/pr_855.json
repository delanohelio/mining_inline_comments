{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUxMzgzMjY5", "number": 855, "title": "fixes #854: QueryPruningVisitor reduces AndNode and OrNode", "bodyText": "", "createdAt": "2020-07-17T19:18:17Z", "url": "https://github.com/NationalSecurityAgency/datawave/pull/855", "merged": true, "mergeCommit": {"oid": "974fbc9e52d1ce47055b6e5e47059ba00c07cf92"}, "closed": true, "closedAt": "2020-07-31T13:59:57Z", "author": {"login": "FineAndDandy"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc141W7AH2gAyNDUxMzgzMjY5OmY3ZjBjMWRlNDQ1YTMzMTVlZGVhNWNlYzRjYzQ0MDU0MjgzNWY3ZGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc6UBF3gH2gAyNDUxMzgzMjY5OjZiMmM4YTA2ZTYwMTIxOTZjYTlmYTBjMzhlMjIyZjQ5OTUzMWE5Nzc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f7f0c1de445a3315edea5cec4cc440542835f7dc", "author": {"user": {"login": "FineAndDandy", "name": null}}, "url": "https://github.com/NationalSecurityAgency/datawave/commit/f7f0c1de445a3315edea5cec4cc440542835f7dc", "committedDate": "2020-07-17T19:17:02Z", "message": "fixes #854: QueryPruningVisitor reduces AndNode and OrNode"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MzQ3MDkw", "url": "https://github.com/NationalSecurityAgency/datawave/pull/855#pullrequestreview-458347090", "createdAt": "2020-07-30T12:22:07Z", "commit": {"oid": "f7f0c1de445a3315edea5cec4cc440542835f7dc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMjoyMjowOFrOG5go6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMjoyMjowOFrOG5go6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk1Njc3OQ==", "bodyText": "should/can this be (child != toReplace) instead of (!child.equals(toReplace))", "url": "https://github.com/NationalSecurityAgency/datawave/pull/855#discussion_r462956779", "createdAt": "2020-07-30T12:22:08Z", "author": {"login": "ivakegg"}, "path": "warehouse/query-core/src/main/java/datawave/query/jexl/visitors/QueryPruningVisitor.java", "diffHunk": "@@ -516,10 +540,28 @@ private void replaceAndAssign(JexlNode toReplace, String queryString, JexlNode b\n             JexlNode parent = toReplace.jjtGetParent();\n             if (parent != null && parent != toReplace) {\n                 if (queryString != null && log.isDebugEnabled()) {\n-                    log.debug(\"Pruning \" + queryString + \" to \" + (baseReplacement instanceof ASTTrueNode ? \"true\" : \"false\"));\n+                    if (this.debugPrune && baseReplacement != null) {\n+                        log.debug(\"Pruning \" + queryString + \" to \" + (baseReplacement instanceof ASTTrueNode ? \"true\" : \"false\"));\n+                    }\n                 }\n                 \n-                JexlNodes.swap(parent, toReplace, baseReplacement);\n+                if (baseReplacement != null) {\n+                    JexlNodes.swap(parent, toReplace, baseReplacement);\n+                } else {\n+                    // remove the node entirely\n+                    List<JexlNode> children = new ArrayList<>(parent.jjtGetNumChildren() - 1);\n+                    for (int i = 0; i < parent.jjtGetNumChildren(); i++) {\n+                        JexlNode child = parent.jjtGetChild(i);\n+                        if (!child.equals(toReplace)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7f0c1de445a3315edea5cec4cc440542835f7dc"}, "originalPosition": 80}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9cfc27e189f23212e31975fd68a13629d1dba68f", "author": {"user": {"login": "FineAndDandy", "name": null}}, "url": "https://github.com/NationalSecurityAgency/datawave/commit/9cfc27e189f23212e31975fd68a13629d1dba68f", "committedDate": "2020-07-30T14:55:00Z", "message": "fixes #854: Update equality check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1bc0eea0628f47a1ab3871327782af53adeffaf", "author": {"user": {"login": "ivakegg", "name": "Ivan Bella"}}, "url": "https://github.com/NationalSecurityAgency/datawave/commit/a1bc0eea0628f47a1ab3871327782af53adeffaf", "committedDate": "2020-07-30T16:22:25Z", "message": "Merge branch 'release/version2.9' into 854"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4NTYwNjMx", "url": "https://github.com/NationalSecurityAgency/datawave/pull/855#pullrequestreview-458560631", "createdAt": "2020-07-30T16:22:37Z", "commit": {"oid": "9cfc27e189f23212e31975fd68a13629d1dba68f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d676e85f0c0799318c42dea25f3d953af5dfad7", "author": {"user": {"login": "ivakegg", "name": "Ivan Bella"}}, "url": "https://github.com/NationalSecurityAgency/datawave/commit/6d676e85f0c0799318c42dea25f3d953af5dfad7", "committedDate": "2020-07-31T12:47:52Z", "message": "Merge branch 'release/version2.9' into 854"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b2c8a06e6012196ca9fa0c38e222f499531a977", "author": {"user": {"login": "ivakegg", "name": "Ivan Bella"}}, "url": "https://github.com/NationalSecurityAgency/datawave/commit/6b2c8a06e6012196ca9fa0c38e222f499531a977", "committedDate": "2020-07-31T13:12:59Z", "message": "Merge branch 'release/version2.9' into 854"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1017, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}