{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA3MDk0MDcy", "number": 958, "title": "Verify lineage for ExpandMultinormalizedTerms", "bodyText": "Add an assert to tests for ExpandMultinormalizedTerms to verify that it\nreturns a query tree with valid lineage.\nPart of #880.", "createdAt": "2020-10-20T21:01:55Z", "url": "https://github.com/NationalSecurityAgency/datawave/pull/958", "merged": true, "mergeCommit": {"oid": "fb30e94a2903bfe2ab050cd318ee2207d233492a"}, "closed": true, "closedAt": "2020-12-11T21:33:17Z", "author": {"login": "lbschanno"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUfP2AgH2gAyNTA3MDk0MDcyOjczYzhiMGQ2YWNlNGFiNjQwYzc0Zjg3OTRiNzRjNGMzM2I0NGQyM2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdlOjXcAH2gAyNTA3MDk0MDcyOjM0Y2E5MjQyYzcwZjdlMzMzOTBiZjVlYmQ5Yjk4NTc4ZDkwNTAzY2E=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "73c8b0d6ace4ab640c74f8794b74c4c33b44d23d", "author": {"user": {"login": "lbschanno", "name": "Laura Schanno"}}, "url": "https://github.com/NationalSecurityAgency/datawave/commit/73c8b0d6ace4ab640c74f8794b74c4c33b44d23d", "committedDate": "2020-10-20T21:00:05Z", "message": "Verify lineage for ExpandMultinormalizedTerms\n\nAdd an assert to tests for ExpandMultinormalizedTerms to verify that it\nreturns a query tree with valid lineage.\n\nPart of #880."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0MDAyNTE1", "url": "https://github.com/NationalSecurityAgency/datawave/pull/958#pullrequestreview-514002515", "createdAt": "2020-10-21T17:29:20Z", "commit": {"oid": "73c8b0d6ace4ab640c74f8794b74c4c33b44d23d"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMjI2MDM0", "url": "https://github.com/NationalSecurityAgency/datawave/pull/958#pullrequestreview-520226034", "createdAt": "2020-10-30T00:35:50Z", "commit": {"oid": "73c8b0d6ace4ab640c74f8794b74c4c33b44d23d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwMDozNTo1MFrOHqzVjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwMDozNTo1MFrOHqzVjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDY0MzM0MQ==", "bodyText": "return QueryPropertyMarkerVisitor.instanceOf(currNode, Arrays.asList(ASTDelayedPredicate.class, ExceededOrThresholdMarkerJexlNode.class,\n                        ExceededValueThresholdMarkerJexlNode.class, ExceededTermThresholdMarkerJexlNode.class, IndexHoleMarkerJexlNode.class,\n                        ASTEvaluationOnly.class), null);\n\nThis method is a dupe of (erroneously protected) JexlASTHelper.isDelayedPredicate.  We should rip this out, update the JexlASTHelper method to be public, and use that instead.\nAlso, instead of visiting the tree six times for each instanceof call, we should pass the list of types to the QueryPropertyMarkerVisitor, and run instanceof once (as shown above);", "url": "https://github.com/NationalSecurityAgency/datawave/pull/958#discussion_r514643341", "createdAt": "2020-10-30T00:35:50Z", "author": {"login": "jwomeara"}, "path": "warehouse/query-core/src/main/java/datawave/query/jexl/visitors/ExpandMultiNormalizedTerms.java", "diffHunk": "@@ -155,12 +155,9 @@ public Object visit(ASTReference node, Object data) {\n      * @return\n      */\n     protected boolean isDelayedPredicate(JexlNode currNode) {\n-        if (ASTDelayedPredicate.instanceOf(currNode) || ExceededOrThresholdMarkerJexlNode.instanceOf(currNode)\n+        return ASTDelayedPredicate.instanceOf(currNode) || ExceededOrThresholdMarkerJexlNode.instanceOf(currNode)\n                         || ExceededValueThresholdMarkerJexlNode.instanceOf(currNode) || ExceededTermThresholdMarkerJexlNode.instanceOf(currNode)\n-                        || IndexHoleMarkerJexlNode.instanceOf(currNode) || ASTEvaluationOnly.instanceOf(currNode))\n-            return true;\n-        else\n-            return false;\n+                        || IndexHoleMarkerJexlNode.instanceOf(currNode) || ASTEvaluationOnly.instanceOf(currNode);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73c8b0d6ace4ab640c74f8794b74c4c33b44d23d"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31b850c8beae5f370620330951d3587189ba355d", "author": {"user": {"login": "lbschanno", "name": "Laura Schanno"}}, "url": "https://github.com/NationalSecurityAgency/datawave/commit/31b850c8beae5f370620330951d3587189ba355d", "committedDate": "2020-10-30T02:33:59Z", "message": "Merge branch 'master' into 880-ExpandMultinormalizedTerms"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c649cd2305114ef4f75e189e786b01d450a1bf1", "author": {"user": {"login": "lbschanno", "name": "Laura Schanno"}}, "url": "https://github.com/NationalSecurityAgency/datawave/commit/8c649cd2305114ef4f75e189e786b01d450a1bf1", "committedDate": "2020-10-30T02:57:40Z", "message": "Dedupe and optimize JexlASTHelper.isDelayedPredicate"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwNjg4NTYx", "url": "https://github.com/NationalSecurityAgency/datawave/pull/958#pullrequestreview-520688561", "createdAt": "2020-10-30T13:53:13Z", "commit": {"oid": "8c649cd2305114ef4f75e189e786b01d450a1bf1"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33fe59f69defa7569142ea22ff5aae369f43cb7d", "author": {"user": {"login": "ivakegg", "name": "Ivan Bella"}}, "url": "https://github.com/NationalSecurityAgency/datawave/commit/33fe59f69defa7569142ea22ff5aae369f43cb7d", "committedDate": "2020-11-02T14:07:55Z", "message": "Merge branch 'master' into 880-ExpandMultinormalizedTerms"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxNjkzNTk3", "url": "https://github.com/NationalSecurityAgency/datawave/pull/958#pullrequestreview-521693597", "createdAt": "2020-11-02T14:46:37Z", "commit": {"oid": "33fe59f69defa7569142ea22ff5aae369f43cb7d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNDo0NjozN1rOHsHakw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNDo0NjozN1rOHsHakw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAyMDg4Mw==", "bodyText": "I don't believe this should be changed.  isDelayedPredictate is specific to a certain set of query property markers.  BoundedRange is coming along in #926 which is specifically not a delayed predicate.  Please revert this to it original state.", "url": "https://github.com/NationalSecurityAgency/datawave/pull/958#discussion_r516020883", "createdAt": "2020-11-02T14:46:37Z", "author": {"login": "ivakegg"}, "path": "warehouse/query-core/src/main/java/datawave/query/jexl/JexlASTHelper.java", "diffHunk": "@@ -1204,13 +1201,15 @@ private static void getERNodes(JexlNode node, List<ASTERNode> erNodes) {\n         return nodes;\n     }\n     \n-    protected static boolean isDelayedPredicate(JexlNode currNode) {\n-        if (ASTDelayedPredicate.instanceOf(currNode) || ExceededOrThresholdMarkerJexlNode.instanceOf(currNode)\n-                        || ExceededValueThresholdMarkerJexlNode.instanceOf(currNode) || ExceededTermThresholdMarkerJexlNode.instanceOf(currNode)\n-                        || IndexHoleMarkerJexlNode.instanceOf(currNode) || ASTEvaluationOnly.instanceOf(currNode))\n-            return true;\n-        else\n-            return false;\n+    /**\n+     * Return whether to not the provided node is an instance of a delayed predicate.\n+     * \n+     * @param node\n+     *            the node\n+     * @return true if the node is an instance of a delayed predicate, or false otherwise\n+     */\n+    public static boolean isDelayedPredicate(JexlNode node) {\n+        return QueryPropertyMarkerVisitor.instanceOfAny(node);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33fe59f69defa7569142ea22ff5aae369f43cb7d"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb2a52223dbb3d137159fe632809072267c96315", "author": {"user": {"login": "lbschanno", "name": "Laura Schanno"}}, "url": "https://github.com/NationalSecurityAgency/datawave/commit/fb2a52223dbb3d137159fe632809072267c96315", "committedDate": "2020-11-02T20:51:58Z", "message": "Revert isDelayedPredicate changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMTQzNjMz", "url": "https://github.com/NationalSecurityAgency/datawave/pull/958#pullrequestreview-522143633", "createdAt": "2020-11-03T01:34:16Z", "commit": {"oid": "fb2a52223dbb3d137159fe632809072267c96315"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwMTozNDoxNlrOHsdn4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwMTozNDoxNlrOHsdn4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM4NDczOA==", "bodyText": "If we do it this way, we only traverse the tree once:\nreturn QueryPropertyMarkerVisitor.instanceOf(currNode, Arrays.asList(ASTDelayedPredicate.class, ExceededOrThresholdMarkerJexlNode.class,\n                        ExceededValueThresholdMarkerJexlNode.class, ExceededTermThresholdMarkerJexlNode.class, IndexHoleMarkerJexlNode.class,\n                        ASTEvaluationOnly.class), null);", "url": "https://github.com/NationalSecurityAgency/datawave/pull/958#discussion_r516384738", "createdAt": "2020-11-03T01:34:16Z", "author": {"login": "jwomeara"}, "path": "warehouse/query-core/src/main/java/datawave/query/jexl/JexlASTHelper.java", "diffHunk": "@@ -1204,13 +1204,10 @@ private static void getERNodes(JexlNode node, List<ASTERNode> erNodes) {\n         return nodes;\n     }\n     \n-    protected static boolean isDelayedPredicate(JexlNode currNode) {\n-        if (ASTDelayedPredicate.instanceOf(currNode) || ExceededOrThresholdMarkerJexlNode.instanceOf(currNode)\n+    public static boolean isDelayedPredicate(JexlNode currNode) {\n+        return ASTDelayedPredicate.instanceOf(currNode) || ExceededOrThresholdMarkerJexlNode.instanceOf(currNode)\n                         || ExceededValueThresholdMarkerJexlNode.instanceOf(currNode) || ExceededTermThresholdMarkerJexlNode.instanceOf(currNode)\n-                        || IndexHoleMarkerJexlNode.instanceOf(currNode) || ASTEvaluationOnly.instanceOf(currNode))\n-            return true;\n-        else\n-            return false;\n+                        || IndexHoleMarkerJexlNode.instanceOf(currNode) || ASTEvaluationOnly.instanceOf(currNode);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb2a52223dbb3d137159fe632809072267c96315"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c26e9d2e786d476ac291cd4a8dfcda9e77bbc268", "author": {"user": {"login": "lbschanno", "name": "Laura Schanno"}}, "url": "https://github.com/NationalSecurityAgency/datawave/commit/c26e9d2e786d476ac291cd4a8dfcda9e77bbc268", "committedDate": "2020-11-03T02:24:04Z", "message": "Avoid multiple recursions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00a113c5965f6c339dd6a706de0936e58e3076fc", "author": {"user": {"login": "lbschanno", "name": "Laura Schanno"}}, "url": "https://github.com/NationalSecurityAgency/datawave/commit/00a113c5965f6c339dd6a706de0936e58e3076fc", "committedDate": "2020-11-03T22:50:34Z", "message": "Move isDelayedPredicate method to QueryPropertyMarkerVisitor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89842633910c1b586fdc3802d6a13a87d43a6441", "author": {"user": {"login": "lbschanno", "name": "Laura Schanno"}}, "url": "https://github.com/NationalSecurityAgency/datawave/commit/89842633910c1b586fdc3802d6a13a87d43a6441", "committedDate": "2020-11-03T22:52:46Z", "message": "Merge branch 'master' into 880-ExpandMultinormalizedTerms"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3MjA3OTcy", "url": "https://github.com/NationalSecurityAgency/datawave/pull/958#pullrequestreview-527207972", "createdAt": "2020-11-10T13:38:33Z", "commit": {"oid": "89842633910c1b586fdc3802d6a13a87d43a6441"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMzozODozM1rOHwc6Jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMzozODozM1rOHwc6Jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU2NzMzNQ==", "bodyText": "This constant is not needed?", "url": "https://github.com/NationalSecurityAgency/datawave/pull/958#discussion_r520567335", "createdAt": "2020-11-10T13:38:33Z", "author": {"login": "ivakegg"}, "path": "warehouse/query-core/src/main/java/datawave/query/jexl/JexlASTHelper.java", "diffHunk": "@@ -1204,14 +1206,9 @@ private static void getERNodes(JexlNode node, List<ASTERNode> erNodes) {\n         return nodes;\n     }\n     \n-    protected static boolean isDelayedPredicate(JexlNode currNode) {\n-        if (ASTDelayedPredicate.instanceOf(currNode) || ExceededOrThresholdMarkerJexlNode.instanceOf(currNode)\n-                        || ExceededValueThresholdMarkerJexlNode.instanceOf(currNode) || ExceededTermThresholdMarkerJexlNode.instanceOf(currNode)\n-                        || IndexHoleMarkerJexlNode.instanceOf(currNode) || ASTEvaluationOnly.instanceOf(currNode))\n-            return true;\n-        else\n-            return false;\n-    }\n+    private static final List<Class<? extends QueryPropertyMarker>> DELAYED_PREDICATE_TYPES = Collections.unmodifiableList(Arrays.asList(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89842633910c1b586fdc3802d6a13a87d43a6441"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45b204176c08df7f8f963cf1e2e8f232efb39198", "author": {"user": {"login": "lbschanno", "name": "Laura Schanno"}}, "url": "https://github.com/NationalSecurityAgency/datawave/commit/45b204176c08df7f8f963cf1e2e8f232efb39198", "committedDate": "2020-11-10T15:34:35Z", "message": "Remove obsolete constant"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4612e2a2a939686eade2969e41e1c3b77b73090", "author": {"user": {"login": "ivakegg", "name": "Ivan Bella"}}, "url": "https://github.com/NationalSecurityAgency/datawave/commit/f4612e2a2a939686eade2969e41e1c3b77b73090", "committedDate": "2020-12-11T16:34:06Z", "message": "Merge branch 'release/version3.0' into 880-ExpandMultinormalizedTerms"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34ca9242c70f7e33390bf5ebd9b98578d90503ca", "author": {"user": {"login": "ivakegg", "name": "Ivan Bella"}}, "url": "https://github.com/NationalSecurityAgency/datawave/commit/34ca9242c70f7e33390bf5ebd9b98578d90503ca", "committedDate": "2020-12-11T21:09:44Z", "message": "Merge branch 'release/version3.0' into 880-ExpandMultinormalizedTerms"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1080, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}