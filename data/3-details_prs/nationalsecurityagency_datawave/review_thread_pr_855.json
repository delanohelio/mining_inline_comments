{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUxMzgzMjY5", "number": 855, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMjoyMjowOFrOETp6-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMjoyMjowOFrOETp6-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MDQ1MjQzOnYy", "diffSide": "RIGHT", "path": "warehouse/query-core/src/main/java/datawave/query/jexl/visitors/QueryPruningVisitor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMjoyMjowOFrOG5go6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNDo0MDoyNVrOG5mH3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk1Njc3OQ==", "bodyText": "should/can this be (child != toReplace) instead of (!child.equals(toReplace))", "url": "https://github.com/NationalSecurityAgency/datawave/pull/855#discussion_r462956779", "createdAt": "2020-07-30T12:22:08Z", "author": {"login": "ivakegg"}, "path": "warehouse/query-core/src/main/java/datawave/query/jexl/visitors/QueryPruningVisitor.java", "diffHunk": "@@ -516,10 +540,28 @@ private void replaceAndAssign(JexlNode toReplace, String queryString, JexlNode b\n             JexlNode parent = toReplace.jjtGetParent();\n             if (parent != null && parent != toReplace) {\n                 if (queryString != null && log.isDebugEnabled()) {\n-                    log.debug(\"Pruning \" + queryString + \" to \" + (baseReplacement instanceof ASTTrueNode ? \"true\" : \"false\"));\n+                    if (this.debugPrune && baseReplacement != null) {\n+                        log.debug(\"Pruning \" + queryString + \" to \" + (baseReplacement instanceof ASTTrueNode ? \"true\" : \"false\"));\n+                    }\n                 }\n                 \n-                JexlNodes.swap(parent, toReplace, baseReplacement);\n+                if (baseReplacement != null) {\n+                    JexlNodes.swap(parent, toReplace, baseReplacement);\n+                } else {\n+                    // remove the node entirely\n+                    List<JexlNode> children = new ArrayList<>(parent.jjtGetNumChildren() - 1);\n+                    for (int i = 0; i < parent.jjtGetNumChildren(); i++) {\n+                        JexlNode child = parent.jjtGetChild(i);\n+                        if (!child.equals(toReplace)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7f0c1de445a3315edea5cec4cc440542835f7dc"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzA0NjYyMg==", "bodyText": "yep it should be the exact object so we can use !=", "url": "https://github.com/NationalSecurityAgency/datawave/pull/855#discussion_r463046622", "createdAt": "2020-07-30T14:40:25Z", "author": {"login": "FineAndDandy"}, "path": "warehouse/query-core/src/main/java/datawave/query/jexl/visitors/QueryPruningVisitor.java", "diffHunk": "@@ -516,10 +540,28 @@ private void replaceAndAssign(JexlNode toReplace, String queryString, JexlNode b\n             JexlNode parent = toReplace.jjtGetParent();\n             if (parent != null && parent != toReplace) {\n                 if (queryString != null && log.isDebugEnabled()) {\n-                    log.debug(\"Pruning \" + queryString + \" to \" + (baseReplacement instanceof ASTTrueNode ? \"true\" : \"false\"));\n+                    if (this.debugPrune && baseReplacement != null) {\n+                        log.debug(\"Pruning \" + queryString + \" to \" + (baseReplacement instanceof ASTTrueNode ? \"true\" : \"false\"));\n+                    }\n                 }\n                 \n-                JexlNodes.swap(parent, toReplace, baseReplacement);\n+                if (baseReplacement != null) {\n+                    JexlNodes.swap(parent, toReplace, baseReplacement);\n+                } else {\n+                    // remove the node entirely\n+                    List<JexlNode> children = new ArrayList<>(parent.jjtGetNumChildren() - 1);\n+                    for (int i = 0; i < parent.jjtGetNumChildren(); i++) {\n+                        JexlNode child = parent.jjtGetChild(i);\n+                        if (!child.equals(toReplace)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk1Njc3OQ=="}, "originalCommit": {"oid": "f7f0c1de445a3315edea5cec4cc440542835f7dc"}, "originalPosition": 80}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4404, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}