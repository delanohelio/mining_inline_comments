{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzNjAyOTgy", "number": 775, "title": "Better way to configure unique terms within an expression", "bodyText": "Push the configuration for the UniqueExpressionTermsVisitor down to the logic level vs. the DefaultQueryPlanner level.", "createdAt": "2020-03-04T14:43:23Z", "url": "https://github.com/NationalSecurityAgency/datawave/pull/775", "merged": true, "mergeCommit": {"oid": "0ec5badb8d694f29db07b2df1531b09797ef54b2"}, "closed": true, "closedAt": "2020-03-06T16:17:59Z", "author": {"login": "apmoriarty"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKtZesgH2gAyMzgzNjAyOTgyOmQyMDU1YmM1YWI4NTE3MTQ5MzZhZjg3Y2U1ZDkzMDQ5ZTY2YWEzMDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcLB7F_AFqTM3MDQxMjQ1Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d2055bc5ab851714936af87ce5d93049e66aa308", "author": {"user": {"login": "apmoriarty", "name": "Moriarty"}}, "url": "https://github.com/NationalSecurityAgency/datawave/commit/d2055bc5ab851714936af87ce5d93049e66aa308", "committedDate": "2020-03-05T15:38:53Z", "message": "Push the configuration for the UniqueExpressionTermsVisitor down to the logic level vs. the DefaultQueryPlanner level."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c56a7402304ddfe859455d1600a385f39300601", "author": {"user": {"login": "apmoriarty", "name": "Moriarty"}}, "url": "https://github.com/NationalSecurityAgency/datawave/commit/9c56a7402304ddfe859455d1600a385f39300601", "committedDate": "2020-03-05T15:38:58Z", "message": "Don't drop config options when tuning lookupUUID."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b36f48fd825782c56ad99d42373d9cb204ba6a28", "author": {"user": {"login": "apmoriarty", "name": "Moriarty"}}, "url": "https://github.com/NationalSecurityAgency/datawave/commit/b36f48fd825782c56ad99d42373d9cb204ba6a28", "committedDate": "2020-03-05T13:00:13Z", "message": "Don't drop config options when tuning lookupUUID."}, "afterCommit": {"oid": "9c56a7402304ddfe859455d1600a385f39300601", "author": {"user": {"login": "apmoriarty", "name": "Moriarty"}}, "url": "https://github.com/NationalSecurityAgency/datawave/commit/9c56a7402304ddfe859455d1600a385f39300601", "committedDate": "2020-03-05T15:38:58Z", "message": "Don't drop config options when tuning lookupUUID."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89cbd2e6e90ead3853ed1f8445faa671e08777f2", "author": {"user": {"login": "apmoriarty", "name": "Moriarty"}}, "url": "https://github.com/NationalSecurityAgency/datawave/commit/89cbd2e6e90ead3853ed1f8445faa671e08777f2", "committedDate": "2020-03-05T15:48:41Z", "message": "Merge branch 'release/version2.9' into task/UniqueExpressionTermVisitor_betterConfigs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NjkwMTc0", "url": "https://github.com/NationalSecurityAgency/datawave/pull/775#pullrequestreview-369690174", "createdAt": "2020-03-05T15:54:54Z", "commit": {"oid": "89cbd2e6e90ead3853ed1f8445faa671e08777f2"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNTo1NDo1NFrOFyZNqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNTo1NjoyNlrOFyZR5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM4NjIxNg==", "bodyText": "Is the conditional here really necessary?", "url": "https://github.com/NationalSecurityAgency/datawave/pull/775#discussion_r388386216", "createdAt": "2020-03-05T15:54:54Z", "author": {"login": "jwomeara"}, "path": "warehouse/query-core/src/main/java/datawave/query/config/LookupUUIDTune.java", "diffHunk": "@@ -54,6 +54,8 @@ public void configure(BaseQueryLogic<Entry<Key,Value>> logic) {\n             rsq.setSpeculativeScanning(speculativeScanning);\n             rsq.setCacheModel(enableCaching);\n             rsq.setPrimaryToSecondaryFieldMap(primaryToSecondaryFieldMap);\n+            if (enforceUniqueTermsWithinExpressions)\n+                rsq.setEnforceUniqueTermsWithinExpressions(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89cbd2e6e90ead3853ed1f8445faa671e08777f2"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM4NjM4OA==", "bodyText": "Same comment as above.", "url": "https://github.com/NationalSecurityAgency/datawave/pull/775#discussion_r388386388", "createdAt": "2020-03-05T15:55:08Z", "author": {"login": "jwomeara"}, "path": "warehouse/query-core/src/main/java/datawave/query/config/LookupUUIDTune.java", "diffHunk": "@@ -66,6 +68,9 @@ public void configure(BaseQueryLogic<Entry<Key,Value>> logic) {\n                 SeekingQueryPlanner planner = new SeekingQueryPlanner();\n                 planner.setMaxFieldHitsBeforeSeek(maxFieldHitsBeforeSeek);\n                 planner.setMaxKeysBeforeSeek(maxKeysBeforeSeek);\n+                if (enforceUniqueTermsWithinExpressions)\n+                    planner.setEnforceUniqueTermsWithinExpressions(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89cbd2e6e90ead3853ed1f8445faa671e08777f2"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM4NjU5OQ==", "bodyText": "Same comment as above.", "url": "https://github.com/NationalSecurityAgency/datawave/pull/775#discussion_r388386599", "createdAt": "2020-03-05T15:55:28Z", "author": {"login": "jwomeara"}, "path": "warehouse/query-core/src/main/java/datawave/query/config/LookupUUIDTune.java", "diffHunk": "@@ -125,6 +130,8 @@ public void configure(GenericQueryConfiguration configuration) {\n             if (maxShardsPerDayThreshold != -1) {\n                 rsqc.setShardsPerDayThreshold(maxShardsPerDayThreshold);\n             }\n+            if (enforceUniqueTermsWithinExpressions)\n+                rsqc.setEnforceUniqueTermsWithinExpressions(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89cbd2e6e90ead3853ed1f8445faa671e08777f2"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM4NzMwMg==", "bodyText": "Why does this term exist in two places?  Why not only have it in the shard query configuration?", "url": "https://github.com/NationalSecurityAgency/datawave/pull/775#discussion_r388387302", "createdAt": "2020-03-05T15:56:26Z", "author": {"login": "jwomeara"}, "path": "warehouse/query-core/src/main/java/datawave/query/planner/DefaultQueryPlanner.java", "diffHunk": "@@ -746,7 +746,8 @@ protected ASTJexlScript updateQueryTree(ScannerFactory scannerFactory, MetadataH\n         \n         stopwatch.stop();\n         \n-        if (enforceUniqueTermsWithinExpressions) {\n+        // Enforce if either DefaultQueryPlanner or ShardQueryConfig is true\n+        if (enforceUniqueTermsWithinExpressions || config.getEnforceUniqueTermsWithinExpressions()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89cbd2e6e90ead3853ed1f8445faa671e08777f2"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f464803cf8e10532c60a424efd608b703bebd11", "author": {"user": {"login": "apmoriarty", "name": "Moriarty"}}, "url": "https://github.com/NationalSecurityAgency/datawave/commit/3f464803cf8e10532c60a424efd608b703bebd11", "committedDate": "2020-03-05T16:18:19Z", "message": "Remove UniqueExpressionVisitor hook form DefaultQueryPlanner, rely solely on the shardQueryConfig."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5ODg1NDk3", "url": "https://github.com/NationalSecurityAgency/datawave/pull/775#pullrequestreview-369885497", "createdAt": "2020-03-05T20:21:02Z", "commit": {"oid": "3f464803cf8e10532c60a424efd608b703bebd11"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMjI1NDI1", "url": "https://github.com/NationalSecurityAgency/datawave/pull/775#pullrequestreview-370225425", "createdAt": "2020-03-06T10:32:25Z", "commit": {"oid": "3f464803cf8e10532c60a424efd608b703bebd11"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMDozMjoyNVrOFy0MTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMDozMjoyNVrOFy0MTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgyODIzOQ==", "bodyText": "we only need to set this once. If the value is stored in the BaseQueryLogic, no need to set it again in the ShardQueryConfiguration", "url": "https://github.com/NationalSecurityAgency/datawave/pull/775#discussion_r388828239", "createdAt": "2020-03-06T10:32:25Z", "author": {"login": "FineAndDandy"}, "path": "warehouse/query-core/src/main/java/datawave/query/config/LookupUUIDTune.java", "diffHunk": "@@ -125,6 +125,8 @@ public void configure(GenericQueryConfiguration configuration) {\n             if (maxShardsPerDayThreshold != -1) {\n                 rsqc.setShardsPerDayThreshold(maxShardsPerDayThreshold);\n             }\n+            rsqc.setEnforceUniqueTermsWithinExpressions(enforceUniqueTermsWithinExpressions);\n+            ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f464803cf8e10532c60a424efd608b703bebd11"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00ba807d2cc8a31cc8762322883f204f7cf32df2", "author": {"user": {"login": "apmoriarty", "name": "Moriarty"}}, "url": "https://github.com/NationalSecurityAgency/datawave/commit/00ba807d2cc8a31cc8762322883f204f7cf32df2", "committedDate": "2020-03-06T10:45:36Z", "message": "Only set config option once."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMjU2NTE5", "url": "https://github.com/NationalSecurityAgency/datawave/pull/775#pullrequestreview-370256519", "createdAt": "2020-03-06T11:28:42Z", "commit": {"oid": "00ba807d2cc8a31cc8762322883f204f7cf32df2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNDExOTc1", "url": "https://github.com/NationalSecurityAgency/datawave/pull/775#pullrequestreview-370411975", "createdAt": "2020-03-06T15:33:05Z", "commit": {"oid": "00ba807d2cc8a31cc8762322883f204f7cf32df2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxNTozMzowNVrOFy88gA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxNTozMzowNVrOFy88gA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk3MTY0OA==", "bodyText": "YES!", "url": "https://github.com/NationalSecurityAgency/datawave/pull/775#discussion_r388971648", "createdAt": "2020-03-06T15:33:05Z", "author": {"login": "jwomeara"}, "path": "warehouse/query-core/src/main/java/datawave/query/planner/DefaultQueryPlanner.java", "diffHunk": "@@ -746,7 +740,8 @@ protected ASTJexlScript updateQueryTree(ScannerFactory scannerFactory, MetadataH\n         \n         stopwatch.stop();\n         \n-        if (enforceUniqueTermsWithinExpressions) {\n+        // Enforce unique terms within an AND or OR expression.\n+        if (config.getEnforceUniqueTermsWithinExpressions()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "00ba807d2cc8a31cc8762322883f204f7cf32df2"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNDEyNDUz", "url": "https://github.com/NationalSecurityAgency/datawave/pull/775#pullrequestreview-370412453", "createdAt": "2020-03-06T15:33:42Z", "commit": {"oid": "00ba807d2cc8a31cc8762322883f204f7cf32df2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1164, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}