{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzNjAyOTgy", "number": 775, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNTo1NDo1NFrODleoBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxNTozMzowNVrODl1rMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNjI1NjcwOnYy", "diffSide": "RIGHT", "path": "warehouse/query-core/src/main/java/datawave/query/config/LookupUUIDTune.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNTo1NDo1NFrOFyZNqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNjoxOToxMVrOFyaQiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM4NjIxNg==", "bodyText": "Is the conditional here really necessary?", "url": "https://github.com/NationalSecurityAgency/datawave/pull/775#discussion_r388386216", "createdAt": "2020-03-05T15:54:54Z", "author": {"login": "jwomeara"}, "path": "warehouse/query-core/src/main/java/datawave/query/config/LookupUUIDTune.java", "diffHunk": "@@ -54,6 +54,8 @@ public void configure(BaseQueryLogic<Entry<Key,Value>> logic) {\n             rsq.setSpeculativeScanning(speculativeScanning);\n             rsq.setCacheModel(enableCaching);\n             rsq.setPrimaryToSecondaryFieldMap(primaryToSecondaryFieldMap);\n+            if (enforceUniqueTermsWithinExpressions)\n+                rsq.setEnforceUniqueTermsWithinExpressions(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89cbd2e6e90ead3853ed1f8445faa671e08777f2"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQwMzMzNg==", "bodyText": "Nope, resolving in next commit.", "url": "https://github.com/NationalSecurityAgency/datawave/pull/775#discussion_r388403336", "createdAt": "2020-03-05T16:19:11Z", "author": {"login": "apmoriarty"}, "path": "warehouse/query-core/src/main/java/datawave/query/config/LookupUUIDTune.java", "diffHunk": "@@ -54,6 +54,8 @@ public void configure(BaseQueryLogic<Entry<Key,Value>> logic) {\n             rsq.setSpeculativeScanning(speculativeScanning);\n             rsq.setCacheModel(enableCaching);\n             rsq.setPrimaryToSecondaryFieldMap(primaryToSecondaryFieldMap);\n+            if (enforceUniqueTermsWithinExpressions)\n+                rsq.setEnforceUniqueTermsWithinExpressions(true);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM4NjIxNg=="}, "originalCommit": {"oid": "89cbd2e6e90ead3853ed1f8445faa671e08777f2"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNjI1NzczOnYy", "diffSide": "RIGHT", "path": "warehouse/query-core/src/main/java/datawave/query/config/LookupUUIDTune.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNTo1NTowOFrOFyZOVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNTo1NTowOFrOFyZOVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM4NjM4OA==", "bodyText": "Same comment as above.", "url": "https://github.com/NationalSecurityAgency/datawave/pull/775#discussion_r388386388", "createdAt": "2020-03-05T15:55:08Z", "author": {"login": "jwomeara"}, "path": "warehouse/query-core/src/main/java/datawave/query/config/LookupUUIDTune.java", "diffHunk": "@@ -66,6 +68,9 @@ public void configure(BaseQueryLogic<Entry<Key,Value>> logic) {\n                 SeekingQueryPlanner planner = new SeekingQueryPlanner();\n                 planner.setMaxFieldHitsBeforeSeek(maxFieldHitsBeforeSeek);\n                 planner.setMaxKeysBeforeSeek(maxKeysBeforeSeek);\n+                if (enforceUniqueTermsWithinExpressions)\n+                    planner.setEnforceUniqueTermsWithinExpressions(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89cbd2e6e90ead3853ed1f8445faa671e08777f2"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNjI1OTA4OnYy", "diffSide": "RIGHT", "path": "warehouse/query-core/src/main/java/datawave/query/config/LookupUUIDTune.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNTo1NToyOFrOFyZPJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNjoxOToyNVrOFyaRKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM4NjU5OQ==", "bodyText": "Same comment as above.", "url": "https://github.com/NationalSecurityAgency/datawave/pull/775#discussion_r388386599", "createdAt": "2020-03-05T15:55:28Z", "author": {"login": "jwomeara"}, "path": "warehouse/query-core/src/main/java/datawave/query/config/LookupUUIDTune.java", "diffHunk": "@@ -125,6 +130,8 @@ public void configure(GenericQueryConfiguration configuration) {\n             if (maxShardsPerDayThreshold != -1) {\n                 rsqc.setShardsPerDayThreshold(maxShardsPerDayThreshold);\n             }\n+            if (enforceUniqueTermsWithinExpressions)\n+                rsqc.setEnforceUniqueTermsWithinExpressions(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89cbd2e6e90ead3853ed1f8445faa671e08777f2"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQwMzQ5Ng==", "bodyText": "Resolved", "url": "https://github.com/NationalSecurityAgency/datawave/pull/775#discussion_r388403496", "createdAt": "2020-03-05T16:19:25Z", "author": {"login": "apmoriarty"}, "path": "warehouse/query-core/src/main/java/datawave/query/config/LookupUUIDTune.java", "diffHunk": "@@ -125,6 +130,8 @@ public void configure(GenericQueryConfiguration configuration) {\n             if (maxShardsPerDayThreshold != -1) {\n                 rsqc.setShardsPerDayThreshold(maxShardsPerDayThreshold);\n             }\n+            if (enforceUniqueTermsWithinExpressions)\n+                rsqc.setEnforceUniqueTermsWithinExpressions(true);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM4NjU5OQ=="}, "originalCommit": {"oid": "89cbd2e6e90ead3853ed1f8445faa671e08777f2"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNjI2MzYwOnYy", "diffSide": "RIGHT", "path": "warehouse/query-core/src/main/java/datawave/query/planner/DefaultQueryPlanner.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNTo1NjoyNlrOFyZR5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNjowMjozNFrOFyZk4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM4NzMwMg==", "bodyText": "Why does this term exist in two places?  Why not only have it in the shard query configuration?", "url": "https://github.com/NationalSecurityAgency/datawave/pull/775#discussion_r388387302", "createdAt": "2020-03-05T15:56:26Z", "author": {"login": "jwomeara"}, "path": "warehouse/query-core/src/main/java/datawave/query/planner/DefaultQueryPlanner.java", "diffHunk": "@@ -746,7 +746,8 @@ protected ASTJexlScript updateQueryTree(ScannerFactory scannerFactory, MetadataH\n         \n         stopwatch.stop();\n         \n-        if (enforceUniqueTermsWithinExpressions) {\n+        // Enforce if either DefaultQueryPlanner or ShardQueryConfig is true\n+        if (enforceUniqueTermsWithinExpressions || config.getEnforceUniqueTermsWithinExpressions()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89cbd2e6e90ead3853ed1f8445faa671e08777f2"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5MjE2Mw==", "bodyText": "I can remove the DQP hook and rely solely on the ShardQueryConfig", "url": "https://github.com/NationalSecurityAgency/datawave/pull/775#discussion_r388392163", "createdAt": "2020-03-05T16:02:34Z", "author": {"login": "apmoriarty"}, "path": "warehouse/query-core/src/main/java/datawave/query/planner/DefaultQueryPlanner.java", "diffHunk": "@@ -746,7 +746,8 @@ protected ASTJexlScript updateQueryTree(ScannerFactory scannerFactory, MetadataH\n         \n         stopwatch.stop();\n         \n-        if (enforceUniqueTermsWithinExpressions) {\n+        // Enforce if either DefaultQueryPlanner or ShardQueryConfig is true\n+        if (enforceUniqueTermsWithinExpressions || config.getEnforceUniqueTermsWithinExpressions()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM4NzMwMg=="}, "originalCommit": {"oid": "89cbd2e6e90ead3853ed1f8445faa671e08777f2"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwOTEwODMwOnYy", "diffSide": "RIGHT", "path": "warehouse/query-core/src/main/java/datawave/query/config/LookupUUIDTune.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMDozMjoyNVrOFy0MTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMDozMzo1MlrOFy0O1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgyODIzOQ==", "bodyText": "we only need to set this once. If the value is stored in the BaseQueryLogic, no need to set it again in the ShardQueryConfiguration", "url": "https://github.com/NationalSecurityAgency/datawave/pull/775#discussion_r388828239", "createdAt": "2020-03-06T10:32:25Z", "author": {"login": "FineAndDandy"}, "path": "warehouse/query-core/src/main/java/datawave/query/config/LookupUUIDTune.java", "diffHunk": "@@ -125,6 +125,8 @@ public void configure(GenericQueryConfiguration configuration) {\n             if (maxShardsPerDayThreshold != -1) {\n                 rsqc.setShardsPerDayThreshold(maxShardsPerDayThreshold);\n             }\n+            rsqc.setEnforceUniqueTermsWithinExpressions(enforceUniqueTermsWithinExpressions);\n+            ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f464803cf8e10532c60a424efd608b703bebd11"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgyODg4Nw==", "bodyText": "I'll make that change, thanks", "url": "https://github.com/NationalSecurityAgency/datawave/pull/775#discussion_r388828887", "createdAt": "2020-03-06T10:33:52Z", "author": {"login": "apmoriarty"}, "path": "warehouse/query-core/src/main/java/datawave/query/config/LookupUUIDTune.java", "diffHunk": "@@ -125,6 +125,8 @@ public void configure(GenericQueryConfiguration configuration) {\n             if (maxShardsPerDayThreshold != -1) {\n                 rsqc.setShardsPerDayThreshold(maxShardsPerDayThreshold);\n             }\n+            rsqc.setEnforceUniqueTermsWithinExpressions(enforceUniqueTermsWithinExpressions);\n+            ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgyODIzOQ=="}, "originalCommit": {"oid": "3f464803cf8e10532c60a424efd608b703bebd11"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxMDAzMzEzOnYy", "diffSide": "RIGHT", "path": "warehouse/query-core/src/main/java/datawave/query/planner/DefaultQueryPlanner.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxNTozMzowNVrOFy88gA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxNTozMzowNVrOFy88gA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk3MTY0OA==", "bodyText": "YES!", "url": "https://github.com/NationalSecurityAgency/datawave/pull/775#discussion_r388971648", "createdAt": "2020-03-06T15:33:05Z", "author": {"login": "jwomeara"}, "path": "warehouse/query-core/src/main/java/datawave/query/planner/DefaultQueryPlanner.java", "diffHunk": "@@ -746,7 +740,8 @@ protected ASTJexlScript updateQueryTree(ScannerFactory scannerFactory, MetadataH\n         \n         stopwatch.stop();\n         \n-        if (enforceUniqueTermsWithinExpressions) {\n+        // Enforce unique terms within an AND or OR expression.\n+        if (config.getEnforceUniqueTermsWithinExpressions()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "00ba807d2cc8a31cc8762322883f204f7cf32df2"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4508, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}