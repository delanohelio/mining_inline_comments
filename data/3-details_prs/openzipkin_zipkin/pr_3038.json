{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5NzAyMjMz", "number": 3038, "title": "Default unsupported locales to English.", "bodyText": "Even with good hints on what causes the issue, I still can't reproduce locally. Have tried changing browser language and hacking the code to return an unsupported locale and things always work fine for me.\nBut anyways, by ensuring the app locale is only ever a supported locale, I'm guessing any issues will go away.\nFixes #3034 hopefully", "createdAt": "2020-03-17T08:46:01Z", "url": "https://github.com/openzipkin/zipkin/pull/3038", "merged": true, "mergeCommit": {"oid": "707e56f53d3be2985ffac033bb67adcfc50917a0"}, "closed": true, "closedAt": "2020-03-18T07:11:58Z", "author": {"login": "anuraaga"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOeqSnAH2gAyMzg5NzAyMjMzOmVjMjFiNzU4OWE1MzZkMmFlYmMyMmY1N2U1NWJlNWI0MTNkNDYyY2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOwYXqgH2gAyMzg5NzAyMjMzOjJmNDZlZGE0OWZjYWFhNWIyODA1ZjkyMWZhMDVjNGFkOTM2MTVkOWY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ec21b7589a536d2aebc22f57e55be5b413d462cc", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/openzipkin/zipkin/commit/ec21b7589a536d2aebc22f57e55be5b413d462cc", "committedDate": "2020-03-17T08:44:22Z", "message": "Default unsupported locales to English."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1ODM2MTI0", "url": "https://github.com/openzipkin/zipkin/pull/3038#pullrequestreview-375836124", "createdAt": "2020-03-17T08:47:46Z", "commit": {"oid": "ec21b7589a536d2aebc22f57e55be5b413d462cc"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwODo0Nzo0N1rOF3SqPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwODo0Nzo0N1rOF3SqPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzUyMTcyNQ==", "bodyText": "guessing this is the key", "url": "https://github.com/openzipkin/zipkin/pull/3038#discussion_r393521725", "createdAt": "2020-03-17T08:47:47Z", "author": {"login": "codefromthecrypt"}, "path": "zipkin-lens/src/util/locale.ts", "diffHunk": "@@ -12,25 +12,49 @@\n  * the License.\n  */\n \n+import { Catalogs, setupI18n } from '@lingui/core';\n+\n+import enMessages from '../translations/en/messages';\n+import esMessages from '../translations/es/messages';\n+import zhCnMessages from '../translations/zh-cn/messages';\n+\n const localeStorageKey = 'localeOverride';\n \n+const catalogs = {\n+  en: enMessages,\n+  es: esMessages,\n+  'zh-cn': zhCnMessages,\n+};\n+\n export function getLocale(): string {\n   const override = localStorage.getItem(localeStorageKey);\n   if (override) {\n     return override;\n   }\n+\n   const browserLanguage = navigator.language.toLowerCase();\n-  // Strip browser language to what we support.\n-  if (browserLanguage === 'en' || browserLanguage.startsWith('en-')) {\n-    return 'en';\n+\n+  if (catalogs.hasOwnProperty(browserLanguage)) {\n+    return browserLanguage;\n   }\n-  if (browserLanguage === 'zh-cn') {\n-    return 'zh-cn';\n+\n+  const hyphenIndex = browserLanguage.indexOf('-');\n+  if (hyphenIndex >= 0) {\n+    const stripped = browserLanguage.substring(0, hyphenIndex);\n+    if (catalogs.hasOwnProperty(stripped)) {\n+      return stripped;\n+    }\n   }\n \n-  return browserLanguage;\n+  // Default to English if we don't support the current browser language.\n+  return 'en';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec21b7589a536d2aebc22f57e55be5b413d462cc"}, "originalPosition": 45}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fd07fd44d63c0e9ed6b4f1b1d5ffeb1b6e6003c", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/openzipkin/zipkin/commit/9fd07fd44d63c0e9ed6b4f1b1d5ffeb1b6e6003c", "committedDate": "2020-03-17T08:53:27Z", "message": "Lint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f46eda49fcaaa5b2805f921fa05c4ad93615d9f", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/openzipkin/zipkin/commit/2f46eda49fcaaa5b2805f921fa05c4ad93615d9f", "committedDate": "2020-03-18T05:23:05Z", "message": "Wait for scribe on all tests not just success."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1634, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}