{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEzMzc0MTc2", "number": 3272, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMVQwNTowMzozMFrOE0A3Eg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMVQwNjozODoyN1rOE0BPRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyOTc1NTA2OnYy", "diffSide": "RIGHT", "path": ".github/workflows/docker-tests.yml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMVQwNTowMzozMFrOHrk-jQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMVQwNTowMzozMFrOHrk-jQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ1NjY1Mw==", "bodyText": "hoping this actually works, but can only test by watching :P", "url": "https://github.com/openzipkin/zipkin/pull/3272#discussion_r515456653", "createdAt": "2020-10-31T05:03:30Z", "author": {"login": "codefromthecrypt"}, "path": ".github/workflows/docker-tests.yml", "diffHunk": "@@ -6,16 +6,59 @@ on:\n   pull_request:\n \n jobs:\n-  discover-targets:\n-    name: Build target matrix\n+  prepare-docker:\n+    name: Build Zipkin and Docker target matrix\n     runs-on: ubuntu-latest\n     outputs:\n       matrix: ${{ steps.set-matrix.outputs.matrix }}\n     steps:\n-      - name: Checkout Sources\n+      - name: Checkout Repository\n         uses: actions/checkout@v2\n         with:\n-          fetch-depth: 1\n+          fetch-depth: 10\n+      # Remove apt repos that are known to break from time to time.\n+      # See https://github.com/actions/virtual-environments/issues/323\n+      - name: Remove broken apt repos [Ubuntu]\n+        if: matrix.os == 'ubuntu-latest'\n+        run: |\n+          for apt_file in `grep -lr microsoft /etc/apt/sources.list.d/`; do sudo rm $apt_file; done\n+      # Setup latest JDK. We do this to ensure users don't need to use the same version as our\n+      # release process. Release uses JDK 11, the last version that can target 1.6 bytecode.\n+      - name: Setup java\n+        uses: actions/setup-java@v1\n+        with:\n+          java-version: 15\n+      - name: Cache NPM Packages\n+        uses: actions/cache@v1\n+        with:\n+          path: ~/.npm\n+          key: npm-packages-${{ runner.os }}-${{ hashFiles('zipkin-lens/package-lock.json') }}\n+      - name: Cache Maven Modules\n+        uses: actions/cache@v1\n+        with:\n+          path: ~/.m2/repository\n+          key: m2-repository-${{ hashFiles('**/pom.xml') }}\n+      - name: Cache Maven Wrapper\n+        uses: actions/cache@v1\n+        with:\n+          path: .mvn/wrapper\n+          key: mvn-wrapper-${{ hashFiles('.mvn/wrapper/maven-wrapper.properties') }}\n+      - name: Show version\n+        run: ./mvnw -version\n+        shell: bash\n+      - name: Execute Server Build\n+        run: ./mvnw -T1C -q --batch-mode -DskipTests -Dlicense.skip=true --also-make -pl zipkin-server clean package\n+        shell: bash\n+        env:\n+          CI: true\n+      - uses: actions/upload-artifact@v2\n+        with:\n+          name: zipkin-server-jars\n+          if: ${{ success() }}\n+          if-no-files-found: error\n+          path: |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59e18e8a6fe60283f6faab4fc3e24f3299dbacd2"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyOTgxNzAyOnYy", "diffSide": "LEFT", "path": "docker/bin/install.sh", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMVQwNjozODoyN1rOHrlacg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMVQwNzoyMDoxMlrOHrlmsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ2Mzc5NA==", "bodyText": "Even without the builder, does it hurt to just keep these three lines in the SNAPSHOT branch below instead of the warning message?", "url": "https://github.com/openzipkin/zipkin/pull/3272#discussion_r515463794", "createdAt": "2020-10-31T06:38:27Z", "author": {"login": "anuraaga"}, "path": "docker/bin/install.sh", "diffHunk": "@@ -15,33 +15,29 @@\n \n set -eux\n \n-# This script decides based on $RELEASE_FROM_CONTEXT and $RELEASE_VERSION whether to reuse, build,\n-# or download the binaries we need.\n-if [ \"$RELEASE_FROM_CONTEXT\" = \"true\" ]; then\n-  echo \"*** Reusing binaries in the Docker context...\"\n-  cp /code/zipkin-exec.jar zipkin-exec.jar\n-  cp /code/zipkin-slim.jar zipkin-slim.jar\n-elif [ \"$RELEASE_VERSION\" = \"master\" ]; then\n-  echo \"*** Building from source...\"\n-\n-  # Defensively avoid arm64+alpine problems with posix_spawn\n-  export MAVEN_OPTS=\"-Djdk.lang.Process.launchMechanism=vfork\"\n-\n-  # Use the same command as we suggest in zipkin-server/README.md\n-  #  * Uses mvn not ./mvnw to reduce layer size: we control the Maven version in Docker\n-  (cd /code; mvn -T1C -q --batch-mode -DskipTests -Dlicense.skip=true --also-make -pl zipkin-server package)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "638f1a31e0673c58b993d35788ed2244c80f6cbb"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ2NjIxMg==", "bodyText": "it hurts because it is never touched and can be wrong or drift and we wouldn't know it. Explicitly unsupporting nesting builds prevents the next person from losing ages trying to get it to work on multi-arch (also laying a bomb for the next maintainer if they succeed). They'll see where it was removed and why.", "url": "https://github.com/openzipkin/zipkin/pull/3272#discussion_r515466212", "createdAt": "2020-10-31T07:10:00Z", "author": {"login": "codefromthecrypt"}, "path": "docker/bin/install.sh", "diffHunk": "@@ -15,33 +15,29 @@\n \n set -eux\n \n-# This script decides based on $RELEASE_FROM_CONTEXT and $RELEASE_VERSION whether to reuse, build,\n-# or download the binaries we need.\n-if [ \"$RELEASE_FROM_CONTEXT\" = \"true\" ]; then\n-  echo \"*** Reusing binaries in the Docker context...\"\n-  cp /code/zipkin-exec.jar zipkin-exec.jar\n-  cp /code/zipkin-slim.jar zipkin-slim.jar\n-elif [ \"$RELEASE_VERSION\" = \"master\" ]; then\n-  echo \"*** Building from source...\"\n-\n-  # Defensively avoid arm64+alpine problems with posix_spawn\n-  export MAVEN_OPTS=\"-Djdk.lang.Process.launchMechanism=vfork\"\n-\n-  # Use the same command as we suggest in zipkin-server/README.md\n-  #  * Uses mvn not ./mvnw to reduce layer size: we control the Maven version in Docker\n-  (cd /code; mvn -T1C -q --batch-mode -DskipTests -Dlicense.skip=true --also-make -pl zipkin-server package)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ2Mzc5NA=="}, "originalCommit": {"oid": "638f1a31e0673c58b993d35788ed2244c80f6cbb"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ2NjY4Mw==", "bodyText": "But it's not so bad if it doesn't support multiarch right? If it drifts then when someone notices they can fix it. There seems to me reasonable bang for the buck in these few commands. Up to you though :)", "url": "https://github.com/openzipkin/zipkin/pull/3272#discussion_r515466683", "createdAt": "2020-10-31T07:16:46Z", "author": {"login": "anuraaga"}, "path": "docker/bin/install.sh", "diffHunk": "@@ -15,33 +15,29 @@\n \n set -eux\n \n-# This script decides based on $RELEASE_FROM_CONTEXT and $RELEASE_VERSION whether to reuse, build,\n-# or download the binaries we need.\n-if [ \"$RELEASE_FROM_CONTEXT\" = \"true\" ]; then\n-  echo \"*** Reusing binaries in the Docker context...\"\n-  cp /code/zipkin-exec.jar zipkin-exec.jar\n-  cp /code/zipkin-slim.jar zipkin-slim.jar\n-elif [ \"$RELEASE_VERSION\" = \"master\" ]; then\n-  echo \"*** Building from source...\"\n-\n-  # Defensively avoid arm64+alpine problems with posix_spawn\n-  export MAVEN_OPTS=\"-Djdk.lang.Process.launchMechanism=vfork\"\n-\n-  # Use the same command as we suggest in zipkin-server/README.md\n-  #  * Uses mvn not ./mvnw to reduce layer size: we control the Maven version in Docker\n-  (cd /code; mvn -T1C -q --batch-mode -DskipTests -Dlicense.skip=true --also-make -pl zipkin-server package)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ2Mzc5NA=="}, "originalCommit": {"oid": "638f1a31e0673c58b993d35788ed2244c80f6cbb"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ2NjkyOA==", "bodyText": "you can add it back in a commit, but I think you will be the only user of this. I like the commit log shows how much horror this created.", "url": "https://github.com/openzipkin/zipkin/pull/3272#discussion_r515466928", "createdAt": "2020-10-31T07:20:12Z", "author": {"login": "codefromthecrypt"}, "path": "docker/bin/install.sh", "diffHunk": "@@ -15,33 +15,29 @@\n \n set -eux\n \n-# This script decides based on $RELEASE_FROM_CONTEXT and $RELEASE_VERSION whether to reuse, build,\n-# or download the binaries we need.\n-if [ \"$RELEASE_FROM_CONTEXT\" = \"true\" ]; then\n-  echo \"*** Reusing binaries in the Docker context...\"\n-  cp /code/zipkin-exec.jar zipkin-exec.jar\n-  cp /code/zipkin-slim.jar zipkin-slim.jar\n-elif [ \"$RELEASE_VERSION\" = \"master\" ]; then\n-  echo \"*** Building from source...\"\n-\n-  # Defensively avoid arm64+alpine problems with posix_spawn\n-  export MAVEN_OPTS=\"-Djdk.lang.Process.launchMechanism=vfork\"\n-\n-  # Use the same command as we suggest in zipkin-server/README.md\n-  #  * Uses mvn not ./mvnw to reduce layer size: we control the Maven version in Docker\n-  (cd /code; mvn -T1C -q --batch-mode -DskipTests -Dlicense.skip=true --also-make -pl zipkin-server package)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ2Mzc5NA=="}, "originalCommit": {"oid": "638f1a31e0673c58b993d35788ed2244c80f6cbb"}, "originalPosition": 18}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1078, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}