{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1Njk3ODMw", "number": 2979, "title": "Read config.json in zipkin-lens and use it to set default query lookb\u2026", "bodyText": "\u2026ack.\n\nFetches config.json before displaying the app\nInstead of initializing redux state when loading, initializes after fetching config with the config passed in so it can be tweaked based on configuration\nSwitches lookback value from string like '15m' to milliseconds for more flexibility and uses moment to format duration instead of hardcoding\nOnly overrides lookback from URL if there is actually a lookback in the URL\nI think fixes an issue with parsing lookback from URL, it was parsing out strings like '15m' though query parameter just has a number of milliseconds\n\nI didn't get fancy and add a custom default lookback as an option in the menu, so if a user selects a lookback, the default would not be selectable again. If this seems important to make it selectable I can grunge it in.\nFixes #2969\nUnblocks #2491, #2519", "createdAt": "2020-02-15T09:27:54Z", "url": "https://github.com/openzipkin/zipkin/pull/2979", "merged": true, "mergeCommit": {"oid": "2d6467ec7915a2a03e61741a7792b489c78ab63c"}, "closed": true, "closedAt": "2020-02-18T08:49:44Z", "author": {"login": "anuraaga"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcEguSbAH2gAyMzc1Njk3ODMwOjU2YWJlZTFjNDRhZDc3Mzc1OTQyM2ZiZjA4OTU4ODk2YzM3YjFhMDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFd4kGAFqTM2MDE1MzM1NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "56abee1c44ad773759423fbf08958896c37b1a00", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/openzipkin/zipkin/commit/56abee1c44ad773759423fbf08958896c37b1a00", "committedDate": "2020-02-15T09:29:18Z", "message": "Read config.json in zipkin-lens and use it to set default query lookback."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "594dbaff38669e7a6ba3e7960cd1030c7f910028", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/openzipkin/zipkin/commit/594dbaff38669e7a6ba3e7960cd1030c7f910028", "committedDate": "2020-02-15T09:20:52Z", "message": "Read config.json in zipkin-lens and use it to set default query lookback."}, "afterCommit": {"oid": "56abee1c44ad773759423fbf08958896c37b1a00", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/openzipkin/zipkin/commit/56abee1c44ad773759423fbf08958896c37b1a00", "committedDate": "2020-02-15T09:29:18Z", "message": "Read config.json in zipkin-lens and use it to set default query lookback."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5Mzg4NTE2", "url": "https://github.com/openzipkin/zipkin/pull/2979#pullrequestreview-359388516", "createdAt": "2020-02-16T08:46:17Z", "commit": {"oid": "56abee1c44ad773759423fbf08958896c37b1a00"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNlQwODo0NjoxN1rOFqSZDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNlQwODo0NzozN1rOFqSZYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg4NTgzOQ==", "bodyText": "I am in suspense", "url": "https://github.com/openzipkin/zipkin/pull/2979#discussion_r379885839", "createdAt": "2020-02-16T08:46:17Z", "author": {"login": "codefromthecrypt"}, "path": "zipkin-lens/src/components/App/App.jsx", "diffHunk": "@@ -11,9 +11,10 @@\n  * or implied. See the License for the specific language governing permissions and limitations under\n  * the License.\n  */\n-import React from 'react';\n+import React, { Suspense } from 'react';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56abee1c44ad773759423fbf08958896c37b1a00"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg4NTkyMA==", "bodyText": "lifespan 1?", "url": "https://github.com/openzipkin/zipkin/pull/2979#discussion_r379885920", "createdAt": "2020-02-16T08:47:37Z", "author": {"login": "codefromthecrypt"}, "path": "zipkin-lens/src/components/UiConfig/UiConfig.jsx", "diffHunk": "@@ -0,0 +1,31 @@\n+/*\n+ * Copyright 2015-2020 The OpenZipkin Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+import useFetch from 'fetch-suspense';\n+import React from 'react';\n+\n+import { UI_CONFIG } from '../../constants/api';\n+\n+const ConfigContext = React.createContext();\n+\n+export const UiConfig = ({ children }) => {\n+  const response = useFetch(UI_CONFIG, { lifespan: 1 });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56abee1c44ad773759423fbf08958896c37b1a00"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93f130be8caeb902a2571b0ff7aa5aa34ddb6eea", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/openzipkin/zipkin/commit/93f130be8caeb902a2571b0ff7aa5aa34ddb6eea", "committedDate": "2020-02-17T06:36:11Z", "message": "Merge branch 'master' of github.com:openzipkin/zipkin into read-config-json"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27f22084c5f90af891625e40868a391c16ce1cdb", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/openzipkin/zipkin/commit/27f22084c5f90af891625e40868a391c16ce1cdb", "committedDate": "2020-02-17T07:38:20Z", "message": "[WIP] First fix existing tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5NTY0ODE4", "url": "https://github.com/openzipkin/zipkin/pull/2979#pullrequestreview-359564818", "createdAt": "2020-02-17T08:45:47Z", "commit": {"oid": "27f22084c5f90af891625e40868a391c16ce1cdb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QwODo0NTo0N1rOFqcMfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QwODo0NTo0N1rOFqcMfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA0NjQ2MQ==", "bodyText": "heh react suspense is making you work hard for your.. no money", "url": "https://github.com/openzipkin/zipkin/pull/2979#discussion_r380046461", "createdAt": "2020-02-17T08:45:47Z", "author": {"login": "codefromthecrypt"}, "path": "zipkin-lens/src/util/fetch-resource.js", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * Copyright 2015-2020 The OpenZipkin Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+/**\n+ * Converts a promise to a resource as used in React Suspense nomenclature. A resource provides a", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27f22084c5f90af891625e40868a391c16ce1cdb"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b1af8b5e9be885cfe5853c0a663a1c9d307abaf", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/openzipkin/zipkin/commit/9b1af8b5e9be885cfe5853c0a663a1c9d307abaf", "committedDate": "2020-02-18T07:49:02Z", "message": "More tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e3b1451ff8056f7ed0ed7cd7739bca6e787b963", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/openzipkin/zipkin/commit/8e3b1451ff8056f7ed0ed7cd7739bca6e787b963", "committedDate": "2020-02-18T08:06:15Z", "message": "Lint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwMTUyODI3", "url": "https://github.com/openzipkin/zipkin/pull/2979#pullrequestreview-360152827", "createdAt": "2020-02-18T08:43:50Z", "commit": {"oid": "8e3b1451ff8056f7ed0ed7cd7739bca6e787b963"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwODo0Mzo1MFrOFq5fVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwODo0Mzo1MFrOFq5fVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDUyNjQyMQ==", "bodyText": "cool!", "url": "https://github.com/openzipkin/zipkin/pull/2979#discussion_r380526421", "createdAt": "2020-02-18T08:43:50Z", "author": {"login": "codefromthecrypt"}, "path": "zipkin-lens/src/components/UiConfig/UiConfig.test.jsx", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Copyright 2015-2020 The OpenZipkin Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+import { render } from '@testing-library/react';\n+import fetchMock from 'fetch-mock';\n+import React, { Suspense } from 'react';\n+\n+import { UI_CONFIG } from '../../constants/api';\n+\n+afterEach(() => {\n+  fetchMock.restore();\n+});\n+\n+beforeEach(() => {\n+  // We fetch the resource on module initialization for performance, but want to do that in every\n+  // test.\n+  jest.resetModules();\n+});\n+\n+const UiConfig = () => {\n+  const UiConfigModule = require('./UiConfig');\n+  const UiConfig = UiConfigModule.UiConfig;\n+  const UiConfigConsumer = UiConfigModule.UiConfigConsumer;\n+\n+  return (\n+    <Suspense fallback=\"Suspended\">\n+      <UiConfig>\n+        <UiConfigConsumer>\n+          {value => (\n+            <div>{JSON.stringify(value)}</div>\n+          )}\n+        </UiConfigConsumer>\n+      </UiConfig>\n+    </Suspense>\n+  );\n+};\n+\n+test('fetches config and suspends', async () => {\n+  const configPromise = new Promise(() => undefined);\n+  fetchMock.mock('*', configPromise);\n+\n+  const { getByText } = render(<UiConfig />);\n+  expect(getByText('Suspended')).toBeInTheDocument();\n+\n+  fetchMock.called(UI_CONFIG);\n+});\n+\n+test('provides config when resolved', async () => {\n+  const config = { defaultLookback: 100 };\n+  fetchMock.once('*', config);\n+\n+  const { getByText, rerender } = render(<UiConfig />);\n+  expect(getByText('Suspended')).toBeInTheDocument();\n+\n+  // We need to get off the processing loop to allow the promise to complete and resolve the\n+  // config.\n+  await new Promise(resolve => setTimeout(resolve, 1));\n+\n+  rerender(<UiConfig />);\n+  expect(getByText(JSON.stringify(config))).toBeInTheDocument();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e3b1451ff8056f7ed0ed7cd7739bca6e787b963"}, "originalPosition": 70}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwMTUzMDA1", "url": "https://github.com/openzipkin/zipkin/pull/2979#pullrequestreview-360153005", "createdAt": "2020-02-18T08:44:08Z", "commit": {"oid": "8e3b1451ff8056f7ed0ed7cd7739bca6e787b963"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwODo0NDowOFrOFq5f5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwODo0NDowOFrOFq5f5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDUyNjU2NQ==", "bodyText": "do you love our license header?", "url": "https://github.com/openzipkin/zipkin/pull/2979#discussion_r380526565", "createdAt": "2020-02-18T08:44:08Z", "author": {"login": "codefromthecrypt"}, "path": "zipkin-lens/src/components/UiConfig/index.js", "diffHunk": "@@ -0,0 +1,14 @@\n+/*\n+ * Copyright 2015-2020 The OpenZipkin Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+export * from './UiConfig';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e3b1451ff8056f7ed0ed7cd7739bca6e787b963"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwMTUzMzU1", "url": "https://github.com/openzipkin/zipkin/pull/2979#pullrequestreview-360153355", "createdAt": "2020-02-18T08:44:44Z", "commit": {"oid": "8e3b1451ff8056f7ed0ed7cd7739bca6e787b963"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1578, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}