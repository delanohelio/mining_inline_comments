{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg5MjQ3MzEz", "number": 3210, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxMToxMzozN1rOEk7LzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxMToxMzozN1rOEk7LzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3MTUzODY5OnYy", "diffSide": "RIGHT", "path": "docker/storage/mysql/install.sh", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxMToxMzozN1rOHUIrsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxMToxMzozN1rOHUIrsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDg3NTgyNA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            echo \"Will wait up to ${timeout} seconds for Cassandra to come up before installing Schema\"\n          \n          \n            \n            echo \"Will wait up to ${timeout} seconds for MySQL to come up before installing Schema\"", "url": "https://github.com/openzipkin/zipkin/pull/3210#discussion_r490875824", "createdAt": "2020-09-18T11:13:37Z", "author": {"login": "codefromthecrypt"}, "path": "docker/storage/mysql/install.sh", "diffHunk": "@@ -19,22 +19,30 @@ echo \"*** Installing MySQL\"\n apk add --update --no-cache mysql mysql-client\n # Fake auth tools install as 10.4.0 install dies otherwise\n mkdir -p /auth_pam_tool_dir/auth_pam_tool\n-mysql_install_db --user=mysql --basedir=/usr/ --datadir=/mysql/data --force\n-mkdir -p /run/mysqld/\n-chown -R mysql /mysql /run/mysqld/\n+\n+MYSQL_OPTS=\"--user=mysql --basedir=${PWD} --datadir=${PWD}/data --tmpdir=/tmp\"\n+\n+# Create the database (stored in the data directory)\n+ln -s /usr/bin bin\n+ln -s /usr/share share\n+mysql_install_db ${MYSQL_OPTS} --force\n+\n+# Prevent \"Bind on unix socket: No such file or directory\"\n+mkdir -p /run/mysqld/ && chown mysql /run/mysqld/\n \n echo \"*** Starting MySQL\"\n-mysqld --user=mysql --basedir=/usr/ --datadir=/mysql/data &\n+mysqld ${MYSQL_OPTS} &\n \n-timeout=300\n-while [[ \"$timeout\" -gt 0 ]] && ! mysql --user=mysql --protocol=socket -uroot -e 'SELECT 1' >/dev/null 2>/dev/null; do\n-    echo \"Waiting ${timeout} seconds for mysql to come up\"\n-    sleep 2\n-    timeout=$(($timeout - 2))\n+# Excessively long timeout to avoid having to create an ENV variable, decide its name, etc.\n+timeout=180\n+echo \"Will wait up to ${timeout} seconds for Cassandra to come up before installing Schema\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16ebdc7971c0686fa6e80795cbfde744b657024a"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1253, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}