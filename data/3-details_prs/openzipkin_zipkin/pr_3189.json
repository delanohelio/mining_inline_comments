{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyODc1Nzc5", "number": 3189, "title": "Polishes Kafka Docker image more", "bodyText": "This primarily mentions why relative dir is in use (to make it easy to change).", "createdAt": "2020-08-25T01:55:26Z", "url": "https://github.com/openzipkin/zipkin/pull/3189", "merged": true, "mergeCommit": {"oid": "a46fdbd8243e5ec1a8a5a8a303ca8d0e910e7532"}, "closed": true, "closedAt": "2020-09-01T01:15:20Z", "author": {"login": "codefromthecrypt"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCNS2FAH2gAyNDcyODc1Nzc5OjZlZDg3ZTZjZDg2YzllOGU1NzY5OTEwNDk3ZDg5NGNkMzlmOTdlNDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdEb21oAH2gAyNDcyODc1Nzc5OjExMjAwZmViNmNlNGM3NTg4NjNlZjZjNzQzYTMxYTRiMmQ4ODJhMjY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6ed87e6cd86c9e8e5769910497d894cd39f97e46", "author": {"user": null}, "url": "https://github.com/openzipkin/zipkin/commit/6ed87e6cd86c9e8e5769910497d894cd39f97e46", "committedDate": "2020-08-25T01:54:26Z", "message": "Polishes Kafka Docker image more\n\nThis primarily mentions why relative dir is in use (to make it easy to change)."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0MDQwMjU3", "url": "https://github.com/openzipkin/zipkin/pull/3189#pullrequestreview-474040257", "createdAt": "2020-08-25T01:55:55Z", "commit": {"oid": "6ed87e6cd86c9e8e5769910497d894cd39f97e46"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwMTo1NTo1NVrOHGAOEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwMTo1NTo1NVrOHGAOEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjA1NzEwNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            # All Kafka content including binaries logs writes under WORKDIR\n          \n          \n            \n            # All Kafka content including binaries and logs write under WORKDIR", "url": "https://github.com/openzipkin/zipkin/pull/3189#discussion_r476057106", "createdAt": "2020-08-25T01:55:55Z", "author": {"login": "codefromthecrypt"}, "path": "docker/collector/kafka/Dockerfile", "diffHunk": "@@ -26,17 +25,19 @@ RUN /tmp/install && rm /tmp/install\n FROM openzipkin/jre-full:14.0.2-14.29.23\n LABEL MAINTAINER Zipkin \"https://zipkin.io/\"\n \n-# add HEALTHCHECK and ENTRYPOINT scripts\n+# Add HEALTHCHECK and ENTRYPOINT scripts\n COPY docker/collector/kafka/docker-bin/* /usr/local/bin/\n \n-# setup non-root user and its home dir\n+# All Kafka content including binaries logs writes under WORKDIR", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ed87e6cd86c9e8e5769910497d894cd39f97e46"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01758f6193fc2904736f53b5a10dbf8256edcdaa", "author": {"user": null}, "url": "https://github.com/openzipkin/zipkin/commit/01758f6193fc2904736f53b5a10dbf8256edcdaa", "committedDate": "2020-08-25T01:56:00Z", "message": "Update docker/collector/kafka/Dockerfile"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0MDQwNDUy", "url": "https://github.com/openzipkin/zipkin/pull/3189#pullrequestreview-474040452", "createdAt": "2020-08-25T01:56:36Z", "commit": {"oid": "01758f6193fc2904736f53b5a10dbf8256edcdaa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwMTo1NjozNlrOHGAP0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwMTo1NjozNlrOHGAP0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjA1NzU1Mg==", "bodyText": "note: the workdir is now decoupled from the convention", "url": "https://github.com/openzipkin/zipkin/pull/3189#discussion_r476057552", "createdAt": "2020-08-25T01:56:36Z", "author": {"login": "codefromthecrypt"}, "path": "docker/collector/kafka/Dockerfile", "diffHunk": "@@ -26,17 +25,19 @@ RUN /tmp/install && rm /tmp/install\n FROM openzipkin/jre-full:14.0.2-14.29.23\n LABEL MAINTAINER Zipkin \"https://zipkin.io/\"\n \n-# add HEALTHCHECK and ENTRYPOINT scripts\n+# Add HEALTHCHECK and ENTRYPOINT scripts\n COPY docker/collector/kafka/docker-bin/* /usr/local/bin/\n \n-# setup non-root user and its home dir\n+# All Kafka content including binaries and logs write under WORKDIR\n+WORKDIR /kafka\n+\n+# Ensure the process doesn't run as root\n ARG USER=kafka\n-WORKDIR /${USER}\n-RUN adduser -g '' -h /${USER} -D ${USER}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01758f6193fc2904736f53b5a10dbf8256edcdaa"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0MDQwNTc3", "url": "https://github.com/openzipkin/zipkin/pull/3189#pullrequestreview-474040577", "createdAt": "2020-08-25T01:56:58Z", "commit": {"oid": "01758f6193fc2904736f53b5a10dbf8256edcdaa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwMTo1Njo1OFrOHGAQ2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwMTo1Njo1OFrOHGAQ2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjA1NzgxOQ==", "bodyText": "clears a minor log warning", "url": "https://github.com/openzipkin/zipkin/pull/3189#discussion_r476057819", "createdAt": "2020-08-25T01:56:58Z", "author": {"login": "codefromthecrypt"}, "path": "docker/collector/kafka/docker-bin/docker-entrypoint", "diffHunk": "@@ -14,10 +14,13 @@\n #\n \n # ENTRYPOINT script that starts ZooKeeper and then Kafka\n+#\n+# This intentionally locates config using the current working directory, in order to consolidate\n+# Dockerfile instructions to WORKDIR\n set -eu\n \n echo Starting ZooKeeper\n-bin/kafka-run-class.sh -Dlog4j.configuration=file:config/log4j.properties org.apache.zookeeper.server.quorum.QuorumPeerMain config/zookeeper.properties &\n+bin/kafka-run-class.sh -Dlog4j.configuration=file:./config/log4j.properties org.apache.zookeeper.server.quorum.QuorumPeerMain ./config/zookeeper.properties &", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01758f6193fc2904736f53b5a10dbf8256edcdaa"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0MDQyNDQ2", "url": "https://github.com/openzipkin/zipkin/pull/3189#pullrequestreview-474042446", "createdAt": "2020-08-25T02:03:14Z", "commit": {"oid": "01758f6193fc2904736f53b5a10dbf8256edcdaa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwMjowMzoxNFrOHGAgwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwMjowMzoxNFrOHGAgwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjA2MTg4OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            # Add HEALTHCHECK and ENTRYPOINT scripts\n          \n          \n            \n            # Add HEALTHCHECK and ENTRYPOINT scripts into the default search path", "url": "https://github.com/openzipkin/zipkin/pull/3189#discussion_r476061889", "createdAt": "2020-08-25T02:03:14Z", "author": {"login": "codefromthecrypt"}, "path": "docker/collector/kafka/Dockerfile", "diffHunk": "@@ -26,17 +25,19 @@ RUN /tmp/install && rm /tmp/install\n FROM openzipkin/jre-full:14.0.2-14.29.23\n LABEL MAINTAINER Zipkin \"https://zipkin.io/\"\n \n-# add HEALTHCHECK and ENTRYPOINT scripts\n+# Add HEALTHCHECK and ENTRYPOINT scripts", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01758f6193fc2904736f53b5a10dbf8256edcdaa"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6b222f8c5e8cca81a2594ea38fd56fe27caad9f", "author": {"user": null}, "url": "https://github.com/openzipkin/zipkin/commit/b6b222f8c5e8cca81a2594ea38fd56fe27caad9f", "committedDate": "2020-08-25T02:03:17Z", "message": "Update docker/collector/kafka/Dockerfile"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0MDQyNjM1", "url": "https://github.com/openzipkin/zipkin/pull/3189#pullrequestreview-474042635", "createdAt": "2020-08-25T02:03:56Z", "commit": {"oid": "b6b222f8c5e8cca81a2594ea38fd56fe27caad9f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwMjowMzo1NlrOHGAihg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwMjowMzo1NlrOHGAihg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjA2MjM0Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            # Copy content we installed earlier\n          \n          \n            \n            # Copy binaries and config we installed earlier", "url": "https://github.com/openzipkin/zipkin/pull/3189#discussion_r476062342", "createdAt": "2020-08-25T02:03:56Z", "author": {"login": "codefromthecrypt"}, "path": "docker/collector/kafka/Dockerfile", "diffHunk": "@@ -26,17 +25,19 @@ RUN /tmp/install && rm /tmp/install\n FROM openzipkin/jre-full:14.0.2-14.29.23\n LABEL MAINTAINER Zipkin \"https://zipkin.io/\"\n \n-# add HEALTHCHECK and ENTRYPOINT scripts\n+# Add HEALTHCHECK and ENTRYPOINT scripts into the default search path\n COPY docker/collector/kafka/docker-bin/* /usr/local/bin/\n \n-# setup non-root user and its home dir\n+# All Kafka content including binaries and logs write under WORKDIR\n+WORKDIR /kafka\n+\n+# Ensure the process doesn't run as root\n ARG USER=kafka\n-WORKDIR /${USER}\n-RUN adduser -g '' -h /${USER} -D ${USER}\n+RUN adduser -g '' -h  ${PWD} -D ${USER}\n USER ${USER}\n \n-# copy content we installed earlier into the home dir\n-COPY --from=install --chown=${USER} /install /${USER}\n+# Copy content we installed earlier", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6b222f8c5e8cca81a2594ea38fd56fe27caad9f"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "469cb532fdb2472c8229782627223467af67e408", "author": {"user": null}, "url": "https://github.com/openzipkin/zipkin/commit/469cb532fdb2472c8229782627223467af67e408", "committedDate": "2020-08-25T02:04:00Z", "message": "Update docker/collector/kafka/Dockerfile"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03f768e749e727c0162c7cc74698055ea4d8ae85", "author": {"user": null}, "url": "https://github.com/openzipkin/zipkin/commit/03f768e749e727c0162c7cc74698055ea4d8ae85", "committedDate": "2020-08-25T03:23:24Z", "message": "use the power of GNU tar"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0MTA4MTM4", "url": "https://github.com/openzipkin/zipkin/pull/3189#pullrequestreview-474108138", "createdAt": "2020-08-25T03:24:37Z", "commit": {"oid": "03f768e749e727c0162c7cc74698055ea4d8ae85"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwMzoyNDozOFrOHGDlew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwMzoyNDozOFrOHGDlew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjExMjI1MQ==", "bodyText": "the power of GNU tar :D", "url": "https://github.com/openzipkin/zipkin/pull/3189#discussion_r476112251", "createdAt": "2020-08-25T03:24:38Z", "author": {"login": "codefromthecrypt"}, "path": "docker/collector/kafka/install", "diffHunk": "@@ -13,16 +13,18 @@\n # the License.\n \n # install script used only in building the docker image, but not at runtime.\n+# This uses relative path so that you can change the home dir without editing this file.\n+# This also trims dependencies to only those used at runtime.\n set -eux\n \n echo \"*** Installing Kafka and dependencies\"\n APACHE_MIRROR=$(curl --stderr /dev/null https://www.apache.org/dyn/closer.cgi\\?as_json\\=1 | sed -n '/preferred/s/.*\"\\(.*\\)\"/\\1/gp')\n \n-# download kafka binaries\n-curl -sSL $APACHE_MIRROR/kafka/$KAFKA_VERSION/kafka_$SCALA_VERSION-$KAFKA_VERSION.tgz | tar xz\n-mv kafka_$SCALA_VERSION-$KAFKA_VERSION/* .\n+# Download scripts and config for Kafka and ZooKeeper, but not for Connect\n+curl -sSL $APACHE_MIRROR/kafka/$KAFKA_VERSION/kafka_$SCALA_VERSION-$KAFKA_VERSION.tgz | tar xvz \\\n+  --wildcards --strip=1 --exclude=connect* */bin/zookeeper-* */bin/kafka-* */config", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03f768e749e727c0162c7cc74698055ea4d8ae85"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "547f60d829249ace38f646fbd4761d7ba08581ce", "author": {"user": null}, "url": "https://github.com/openzipkin/zipkin/commit/547f60d829249ace38f646fbd4761d7ba08581ce", "committedDate": "2020-08-25T03:26:06Z", "message": "nov"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a79c0df578ee233f78e12f6fd452bdd753acd947", "author": {"user": null}, "url": "https://github.com/openzipkin/zipkin/commit/a79c0df578ee233f78e12f6fd452bdd753acd947", "committedDate": "2020-08-25T03:37:16Z", "message": "document wtf"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af146062065511e7ac6162f87b25bd8f0a7df5b1", "author": {"user": null}, "url": "https://github.com/openzipkin/zipkin/commit/af146062065511e7ac6162f87b25bd8f0a7df5b1", "committedDate": "2020-08-25T08:22:48Z", "message": "nicer name in docker ps"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0MjQ5NzEy", "url": "https://github.com/openzipkin/zipkin/pull/3189#pullrequestreview-474249712", "createdAt": "2020-08-25T08:24:59Z", "commit": {"oid": "af146062065511e7ac6162f87b25bd8f0a7df5b1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2NTAyNDYz", "url": "https://github.com/openzipkin/zipkin/pull/3189#pullrequestreview-476502463", "createdAt": "2020-08-27T08:34:40Z", "commit": {"oid": "af146062065511e7ac6162f87b25bd8f0a7df5b1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1e7ac60846c9d190c55d48de45d892588f537c8", "author": {"user": null}, "url": "https://github.com/openzipkin/zipkin/commit/b1e7ac60846c9d190c55d48de45d892588f537c8", "committedDate": "2020-08-30T12:14:45Z", "message": "final polish"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aee139e5ef85d9574b437433226c8a24b918fb0c", "author": {"user": null}, "url": "https://github.com/openzipkin/zipkin/commit/aee139e5ef85d9574b437433226c8a24b918fb0c", "committedDate": "2020-08-30T12:23:18Z", "message": "add license metadata"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11200feb6ce4c758863ef6c743a31a4b2d882a26", "author": {"user": null}, "url": "https://github.com/openzipkin/zipkin/commit/11200feb6ce4c758863ef6c743a31a4b2d882a26", "committedDate": "2020-09-01T00:00:16Z", "message": "last polish"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1527, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}