{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxOTg5Njk1", "number": 3130, "title": "Updates versions, most notably Armeria", "bodyText": "", "createdAt": "2020-06-30T12:20:03Z", "url": "https://github.com/openzipkin/zipkin/pull/3130", "merged": true, "mergeCommit": {"oid": "5cfde9ea1264779dadce175a5c2fd1e43294a13c"}, "closed": true, "closedAt": "2020-07-03T14:03:23Z", "author": {"login": "codefromthecrypt"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwUskpAFqTQzOTk1NzY4OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcxTRn4gH2gAyNDQxOTg5Njk1OmFjMTk2MGJkN2VmOWE2ZTY4YzhkYTljMDY0Y2JhZDcwNWM3NjYzOTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5OTU3Njg5", "url": "https://github.com/openzipkin/zipkin/pull/3130#pullrequestreview-439957689", "createdAt": "2020-06-30T12:21:13Z", "commit": {"oid": "49d883fcedee6c427108dd3365179ce1d1838723"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxMjoyMToxNFrOGq5vYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxMjoyMToxNFrOGq5vYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzYzOTM5Mg==", "bodyText": "I might have misunderstood line/armeria#2837 (comment) by @trustin or maybe the two tests below mentioning TODO are drifting for a different reason", "url": "https://github.com/openzipkin/zipkin/pull/3130#discussion_r447639392", "createdAt": "2020-06-30T12:21:14Z", "author": {"login": "codefromthecrypt"}, "path": "zipkin-server/src/main/java/zipkin2/server/internal/elasticsearch/LazyHttpClientImpl.java", "diffHunk": "@@ -60,32 +59,10 @@\n   EndpointGroup getEndpoint() {\n     EndpointGroup initial = initialEndpoints.get();\n     // Only health-check when there are alternative endpoints. There aren't when instanceof Endpoint\n-    if (initial instanceof Endpoint) return initial;\n+    if (initial instanceof Endpoint || !healthCheck.isEnabled()) return initial;\n \n     // Wrap the result when health checking is enabled.\n-    EndpointGroup result = initial;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49d883fcedee6c427108dd3365179ce1d1838723"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5OTU4MjU4", "url": "https://github.com/openzipkin/zipkin/pull/3130#pullrequestreview-439958258", "createdAt": "2020-06-30T12:22:05Z", "commit": {"oid": "49d883fcedee6c427108dd3365179ce1d1838723"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxMjoyMjowNlrOGq5xEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxMjoyMjowNlrOGq5xEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzYzOTgyNw==", "bodyText": "current image is busted per #3129", "url": "https://github.com/openzipkin/zipkin/pull/3130#discussion_r447639827", "createdAt": "2020-06-30T12:22:06Z", "author": {"login": "codefromthecrypt"}, "path": "zipkin-storage/elasticsearch/src/test/java/zipkin2/elasticsearch/integration/ITElasticsearchStorageV7.java", "diffHunk": "@@ -20,7 +20,7 @@\n class ITElasticsearchStorageV7 extends ITElasticsearchStorage {\n \n   @RegisterExtension ElasticsearchStorageExtension backend = new ElasticsearchStorageExtension(\n-    \"openzipkin/zipkin-elasticsearch7:2.21.4\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49d883fcedee6c427108dd3365179ce1d1838723"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwNDk3MTc3", "url": "https://github.com/openzipkin/zipkin/pull/3130#pullrequestreview-440497177", "createdAt": "2020-07-01T01:56:41Z", "commit": {"oid": "49d883fcedee6c427108dd3365179ce1d1838723"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQwMTo1Njo0MlrOGrUNWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQwMjowMzoyM1rOGrUT0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODA3MzA1MQ==", "bodyText": "Not sure if you're looking to do larger cleanup but you can use PooledWebClient.of(httpClient) to have a PooledWebClient where all the methods return Pooled*Response", "url": "https://github.com/openzipkin/zipkin/pull/3130#discussion_r448073051", "createdAt": "2020-07-01T01:56:42Z", "author": {"login": "anuraaga"}, "path": "zipkin-storage/elasticsearch/src/main/java/zipkin2/elasticsearch/internal/client/HttpCall.java", "diffHunk": "@@ -143,14 +145,13 @@ public Factory(WebClient httpClient) {\n \n   final WebClient httpClient;\n \n-  volatile CompletableFuture<AggregatedHttpResponse> responseFuture;\n+  volatile CompletableFuture<PooledAggregatedHttpResponse> responseFuture;\n \n   HttpCall(WebClient httpClient, RequestSupplier request, BodyConverter<V> bodyConverter,\n     String name) {\n     this.httpClient = httpClient;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49d883fcedee6c427108dd3365179ce1d1838723"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODA3NDcwNw==", "bodyText": "This change itself looks like what I'd expect after the async endpoint selection change. Perhaps a timing issue that needs to tweak the timeouts in the test with this change added, or possibly a bug introduced? /cc @trustin", "url": "https://github.com/openzipkin/zipkin/pull/3130#discussion_r448074707", "createdAt": "2020-07-01T02:03:23Z", "author": {"login": "anuraaga"}, "path": "zipkin-server/src/main/java/zipkin2/server/internal/elasticsearch/LazyHttpClientImpl.java", "diffHunk": "@@ -60,32 +59,10 @@\n   EndpointGroup getEndpoint() {\n     EndpointGroup initial = initialEndpoints.get();\n     // Only health-check when there are alternative endpoints. There aren't when instanceof Endpoint\n-    if (initial instanceof Endpoint) return initial;\n+    if (initial instanceof Endpoint || !healthCheck.isEnabled()) return initial;\n \n     // Wrap the result when health checking is enabled.\n-    EndpointGroup result = initial;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzYzOTM5Mg=="}, "originalCommit": {"oid": "49d883fcedee6c427108dd3365179ce1d1838723"}, "originalPosition": 16}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ab43f89a5726fafe066dc1ea250ef2d7c3299b9a", "author": {"user": null}, "url": "https://github.com/openzipkin/zipkin/commit/ab43f89a5726fafe066dc1ea250ef2d7c3299b9a", "committedDate": "2020-07-01T02:20:00Z", "message": "fix wrong comment"}, "afterCommit": {"oid": "b42528b6fa6f79ed8a7995ef887e0dd2155dfaeb", "author": {"user": null}, "url": "https://github.com/openzipkin/zipkin/commit/b42528b6fa6f79ed8a7995ef887e0dd2155dfaeb", "committedDate": "2020-07-01T06:12:51Z", "message": "WIP: latest armeria"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8a72158221df12f13b3bee2dd5be1b74ab03ee95", "author": {"user": null}, "url": "https://github.com/openzipkin/zipkin/commit/8a72158221df12f13b3bee2dd5be1b74ab03ee95", "committedDate": "2020-07-01T10:07:15Z", "message": "try jitpack"}, "afterCommit": {"oid": "f8dccf1701c1b8c1adcc65b0570db36a0625eb3f", "author": {"user": null}, "url": "https://github.com/openzipkin/zipkin/commit/f8dccf1701c1b8c1adcc65b0570db36a0625eb3f", "committedDate": "2020-07-01T09:52:47Z", "message": "use snapshots"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a5f292bb17ada683d47fcb1bdd1865fe8b14002", "author": {"user": null}, "url": "https://github.com/openzipkin/zipkin/commit/3a5f292bb17ada683d47fcb1bdd1865fe8b14002", "committedDate": "2020-07-03T12:04:13Z", "message": "Updates versions, most notably Armeria"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "51c1ac3e0929737f80bf139ea6557a07f581fe1b", "author": {"user": null}, "url": "https://github.com/openzipkin/zipkin/commit/51c1ac3e0929737f80bf139ea6557a07f581fe1b", "committedDate": "2020-07-02T01:44:35Z", "message": "artifactId drift"}, "afterCommit": {"oid": "3a5f292bb17ada683d47fcb1bdd1865fe8b14002", "author": {"user": null}, "url": "https://github.com/openzipkin/zipkin/commit/3a5f292bb17ada683d47fcb1bdd1865fe8b14002", "committedDate": "2020-07-03T12:04:13Z", "message": "Updates versions, most notably Armeria"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "358c11153c8fa7ec307fbfb04e0d365824968b1a", "author": {"user": null}, "url": "https://github.com/openzipkin/zipkin/commit/358c11153c8fa7ec307fbfb04e0d365824968b1a", "committedDate": "2020-07-03T12:07:39Z", "message": "ore clean"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0079dbb8623d61539f7dc7d3fda88213c9461ec1", "author": {"user": null}, "url": "https://github.com/openzipkin/zipkin/commit/0079dbb8623d61539f7dc7d3fda88213c9461ec1", "committedDate": "2020-07-03T12:25:14Z", "message": "drift"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac1960bd7ef9a6e68c8da9c064cbad705c766392", "author": {"user": null}, "url": "https://github.com/openzipkin/zipkin/commit/ac1960bd7ef9a6e68c8da9c064cbad705c766392", "committedDate": "2020-07-03T13:15:49Z", "message": "mock drift"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1445, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}