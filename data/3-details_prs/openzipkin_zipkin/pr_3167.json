{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzODgxMTQ1", "number": 3167, "title": "Update Armeria and Netty dependencies", "bodyText": "Armeria 0.99.8 -> 0.99.9\nNetty 4.1.50.Final -> 4.1.51.Final", "createdAt": "2020-08-06T08:47:15Z", "url": "https://github.com/openzipkin/zipkin/pull/3167", "merged": true, "mergeCommit": {"oid": "1845702272992ec430af6dc23a340186b5c9d285"}, "closed": true, "closedAt": "2020-08-07T03:57:01Z", "author": {"login": "minwoox"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8LxeYAH2gAyNDYzODgxMTQ1OmU4MTkyZDFhMDYyZDhiZmFjODRkMDZlN2U3YmJkYTcyNjEzZGU0OWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8a4PbAH2gAyNDYzODgxMTQ1OmY1ZDQ3N2M4ZDAyMTZmN2MwODFmOTQ0ODIwYmUxNjBlMGVhZmJlYzc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e8192d1a062d8bfac84d06e7e7bbda72613de49d", "author": {"user": {"login": "minwoox", "name": "minux"}}, "url": "https://github.com/openzipkin/zipkin/commit/e8192d1a062d8bfac84d06e7e7bbda72613de49d", "committedDate": "2020-08-06T08:44:32Z", "message": "Update Armeria and Netty dependencies\nArmeria 0.99.8 -> 0.99.9\nNetty 4.1.50.Final -> 4.1.51.Final"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMzExOTcy", "url": "https://github.com/openzipkin/zipkin/pull/3167#pullrequestreview-462311972", "createdAt": "2020-08-06T08:50:46Z", "commit": {"oid": "e8192d1a062d8bfac84d06e7e7bbda72613de49d"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwODo1MDo0NlrOG8pfEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwODo1MDo0NlrOG8pfEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjI0NzQ0MA==", "bodyText": "Don't we have try / resources now?", "url": "https://github.com/openzipkin/zipkin/pull/3167#discussion_r466247440", "createdAt": "2020-08-06T08:50:46Z", "author": {"login": "anuraaga"}, "path": "zipkin-server/src/main/java/zipkin2/server/internal/ZipkinHttpCollector.java", "diffHunk": "@@ -168,7 +159,7 @@ HttpResponse validateAndStoreSpans(SpanBytesDecoder decoder, ServiceRequestConte\n           return null;\n         }\n       } finally {\n-        ReferenceCountUtil.release(content);\n+        PooledObjects.close(content);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8192d1a062d8bfac84d06e7e7bbda72613de49d"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMzQ0ODA2", "url": "https://github.com/openzipkin/zipkin/pull/3167#pullrequestreview-462344806", "createdAt": "2020-08-06T09:11:51Z", "commit": {"oid": "e8192d1a062d8bfac84d06e7e7bbda72613de49d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f49d31665b662130ac26ab14a8711a7f019f2dc3", "author": {"user": {"login": "minwoox", "name": "minux"}}, "url": "https://github.com/openzipkin/zipkin/commit/f49d31665b662130ac26ab14a8711a7f019f2dc3", "committedDate": "2020-08-06T11:32:36Z", "message": "Address the comment by @anuraaga"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a8494c4483178c5c85b6f65088f8eb40d350b0e", "author": {"user": {"login": "minwoox", "name": "minux"}}, "url": "https://github.com/openzipkin/zipkin/commit/7a8494c4483178c5c85b6f65088f8eb40d350b0e", "committedDate": "2020-08-06T11:34:36Z", "message": "Fix imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06d71b89f30ff9afc023274dba9a75b282351be6", "author": {"user": {"login": "minwoox", "name": "minux"}}, "url": "https://github.com/openzipkin/zipkin/commit/06d71b89f30ff9afc023274dba9a75b282351be6", "committedDate": "2020-08-06T11:38:44Z", "message": "Remove arbitraliry add empty lines"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7061ac8e1f44a229bc41f58e589c89cab5b25de7", "author": {"user": {"login": "minwoox", "name": "minux"}}, "url": "https://github.com/openzipkin/zipkin/commit/7061ac8e1f44a229bc41f58e589c89cab5b25de7", "committedDate": "2020-08-06T12:53:23Z", "message": "Fix tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyNDkxNTkw", "url": "https://github.com/openzipkin/zipkin/pull/3167#pullrequestreview-462491590", "createdAt": "2020-08-06T12:57:39Z", "commit": {"oid": "7061ac8e1f44a229bc41f58e589c89cab5b25de7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMjo1Nzo0MFrOG8yUDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMjo1Nzo0MFrOG8yUDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjM5MjA3Nw==", "bodyText": "Is there any better string that only exposed by prometheus?\nWe have changed the meter tags to contain method and service name.\nFor example scrape() contains method=getHealth and service=server.internal.health.ITzipkinHealth which made this test failed. \ud83d\ude13", "url": "https://github.com/openzipkin/zipkin/pull/3167#discussion_r466392077", "createdAt": "2020-08-06T12:57:40Z", "author": {"login": "minwoox"}, "path": "zipkin-server/src/test/java/zipkin2/server/internal/health/ITZipkinHealth.java", "diffHunk": "@@ -73,7 +73,7 @@\n \n     // ensure we don't track health in prometheus\n     assertThat(scrape())\n-      .doesNotContain(\"health\");\n+      .doesNotContain(\"health_check\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7061ac8e1f44a229bc41f58e589c89cab5b25de7"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyNDkxOTU5", "url": "https://github.com/openzipkin/zipkin/pull/3167#pullrequestreview-462491959", "createdAt": "2020-08-06T12:58:08Z", "commit": {"oid": "7061ac8e1f44a229bc41f58e589c89cab5b25de7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMjo1ODowOFrOG8yVGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMjo1ODowOFrOG8yVGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjM5MjM0NQ==", "bodyText": "This one as well. Any better suggestion please?", "url": "https://github.com/openzipkin/zipkin/pull/3167#discussion_r466392345", "createdAt": "2020-08-06T12:58:08Z", "author": {"login": "minwoox"}, "path": "zipkin-server/src/test/java/zipkin2/server/internal/prometheus/ITZipkinMetrics.java", "diffHunk": "@@ -77,7 +77,7 @@\n \n     // ensure we don't track prometheus, UI requests in prometheus\n     assertThat(scrape())\n-      .doesNotContain(\"prometheus\")\n+      .doesNotContain(\"prometheus_notifications\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7061ac8e1f44a229bc41f58e589c89cab5b25de7"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1de66ec204b74e3ea72372e8c4447c1edd64f41", "author": {"user": {"login": "minwoox", "name": "minux"}}, "url": "https://github.com/openzipkin/zipkin/commit/e1de66ec204b74e3ea72372e8c4447c1edd64f41", "committedDate": "2020-08-06T14:50:17Z", "message": "Fix license year"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyOTUzNDQ2", "url": "https://github.com/openzipkin/zipkin/pull/3167#pullrequestreview-462953446", "createdAt": "2020-08-07T00:01:04Z", "commit": {"oid": "e1de66ec204b74e3ea72372e8c4447c1edd64f41"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMDowMTowNVrOG9IClA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMDowMjoyN1rOG9ID6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc0ODA1Mg==", "bodyText": "but isn't this possibly a correct positive? why would we be adding metrics for the scrape endpoint? Maybe you can dump the actual contents here.", "url": "https://github.com/openzipkin/zipkin/pull/3167#discussion_r466748052", "createdAt": "2020-08-07T00:01:05Z", "author": {"login": "codefromthecrypt"}, "path": "zipkin-server/src/test/java/zipkin2/server/internal/health/ITZipkinHealth.java", "diffHunk": "@@ -73,7 +73,7 @@\n \n     // ensure we don't track health in prometheus\n     assertThat(scrape())\n-      .doesNotContain(\"health\");\n+      .doesNotContain(\"health_check\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjM5MjA3Nw=="}, "originalCommit": {"oid": "7061ac8e1f44a229bc41f58e589c89cab5b25de7"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc0ODM5Mg==", "bodyText": "similarly we intentionally shouldn't see any meta stats about prometheus. Possibly this is a correct glitch and something else we need to disable now. Stats cost money (especially in SaaS) and we don't want to blanket add things especially monitoring the monitor without being conscious about it.", "url": "https://github.com/openzipkin/zipkin/pull/3167#discussion_r466748392", "createdAt": "2020-08-07T00:02:27Z", "author": {"login": "codefromthecrypt"}, "path": "zipkin-server/src/test/java/zipkin2/server/internal/prometheus/ITZipkinMetrics.java", "diffHunk": "@@ -77,7 +77,7 @@\n \n     // ensure we don't track prometheus, UI requests in prometheus\n     assertThat(scrape())\n-      .doesNotContain(\"prometheus\")\n+      .doesNotContain(\"prometheus_notifications\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjM5MjM0NQ=="}, "originalCommit": {"oid": "7061ac8e1f44a229bc41f58e589c89cab5b25de7"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5d477c8d0216f7c081f944820be160e0eafbec7", "author": {"user": {"login": "minwoox", "name": "minux"}}, "url": "https://github.com/openzipkin/zipkin/commit/f5d477c8d0216f7c081f944820be160e0eafbec7", "committedDate": "2020-08-07T02:20:30Z", "message": "Disable `ArmeriaSettings.enableMetrics`"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1490, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}