{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYxNzY3MDk1", "number": 3156, "title": "Stops using prepared or query builder statements for simple queries", "bodyText": "Before, we needlessly prepared service name query, which would have no\nparameters. While, this is being followed up below, it is unlikely that\npreparing is better than directly executing the statement:\nhttps://groups.google.com/a/lists.datastax.com/forum/#!topic/java-driver-user/d6wLkH3xDLI\nMore importantly, there is a bug in the cassandra driver >v3.6 which\ncrashes on QueryBuilder statements that have no parameters. This\nuses a simple statement for that instead (healthcheck). Moreover, the\nlog category that shows connection failures is now suggested in our\ndocs.\nSee datastax/java-driver#1138 for the NPE", "createdAt": "2020-08-02T06:21:25Z", "url": "https://github.com/openzipkin/zipkin/pull/3156", "merged": true, "mergeCommit": {"oid": "50c748ca4645ab05e0ba3469197b2a9559d407e5"}, "closed": true, "closedAt": "2020-08-02T07:41:06Z", "author": {"login": "codefromthecrypt"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc63Ve6AFqTQ1OTYyMzU4Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc63-VKgH2gAyNDYxNzY3MDk1OjYwZDYzYTE3ZDg1MmZhMjI1MjdkODMyZWViYzJlZjRiZGRiNDYzMDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5NjIzNTgz", "url": "https://github.com/openzipkin/zipkin/pull/3156#pullrequestreview-459623583", "createdAt": "2020-08-02T06:21:56Z", "commit": {"oid": "48ac415f1125e4662f7bec2ba9aeab48a41f592a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQwNjoyMTo1NlrOG6in_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQwNjoyMTo1NlrOG6in_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDAzNzg4Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            isenabled via SLF4J. Trace level includes bound values.\n          \n          \n            \n            is enabled via SLF4J. Trace level includes bound values.", "url": "https://github.com/openzipkin/zipkin/pull/3156#discussion_r464037887", "createdAt": "2020-08-02T06:21:56Z", "author": {"login": "codefromthecrypt"}, "path": "zipkin-storage/cassandra-v1/README.md", "diffHunk": "@@ -11,8 +11,8 @@ The implementation uses the [Datastax Java Driver 3.x](https://github.com/datast\n operate against a local Cassandra installation.\n \n ## Logging\n-Queries are logged to the category \"com.datastax.driver.core.QueryLogger\" when debug or trace is\n-enabled via SLF4J. Trace level includes bound values.\n+Queries are logged to the category \"com.datastax.driver.core.QueryLogger.NORMAL\" when debug or trace\n+isenabled via SLF4J. Trace level includes bound values.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48ac415f1125e4662f7bec2ba9aeab48a41f592a"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83421cb8edeb7d1b1927a3aff0d290fd9098cfb9", "author": {"user": null}, "url": "https://github.com/openzipkin/zipkin/commit/83421cb8edeb7d1b1927a3aff0d290fd9098cfb9", "committedDate": "2020-08-02T06:45:11Z", "message": "Stops using prepared or query builder statements for simply queries\n\nBefore, we needlessly prepared service name query, which would have no\nparameters. While, this is being followed up below, it is unlikely that\npreparing is better than directly executing the statement:\nhttps://groups.google.com/a/lists.datastax.com/forum/#!topic/java-driver-user/d6wLkH3xDLI\n\nMore importantly, there is a bug in the cassandra driver >v3.6 which\ncrashes on `QueryBuilder` statements that have no parameters. This\nuses a simple statement for that instead (healthcheck). Moreover, the\nlog category that shows connection failures is now suggested in our\ndocs.\n\nSee https://github.com/datastax/java-driver/pull/1138 for the NPE"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5NjI0Nzc2", "url": "https://github.com/openzipkin/zipkin/pull/3156#pullrequestreview-459624776", "createdAt": "2020-08-02T06:45:10Z", "commit": {"oid": "213802671eec281c2dabeaf066dcc73aecc7752c"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQwNjo0NToxMVrOG6ivcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQwNjo0NToxMVrOG6ivcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDAzOTc5Mw==", "bodyText": "Guess the world still builds SQL by concatenate strings :)", "url": "https://github.com/openzipkin/zipkin/pull/3156#discussion_r464039793", "createdAt": "2020-08-02T06:45:11Z", "author": {"login": "anuraaga"}, "path": "zipkin-storage/cassandra-v1/src/main/java/zipkin2/storage/cassandra/v1/CassandraStorage.java", "diffHunk": "@@ -384,7 +383,11 @@ public SpanConsumer spanConsumer() {\n   public CheckResult check() {\n     if (closeCalled) throw new IllegalStateException(\"closed\");\n     try {\n-      session.get().execute(QueryBuilder.select(\"trace_id\").from(\"traces\").limit(1));\n+      // Use direct CQL instead of query builder for simple statements.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "213802671eec281c2dabeaf066dcc73aecc7752c"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "48ac415f1125e4662f7bec2ba9aeab48a41f592a", "author": {"user": null}, "url": "https://github.com/openzipkin/zipkin/commit/48ac415f1125e4662f7bec2ba9aeab48a41f592a", "committedDate": "2020-08-02T06:15:36Z", "message": "Stops using prepared or query builder statements for simply queries\n\nBefore, we needlessly prepared service name query, which would have no\nparameters. While, this is being followed up below, it is unlikely that\npreparing is better than directly executing the statement:\nhttps://groups.google.com/a/lists.datastax.com/forum/#!topic/java-driver-user/d6wLkH3xDLI\n\nMore importantly, there is a bug in the cassandra driver >v3.6 which\ncrashes on `QueryBuilder` statements that have no parameters. This\nuses a simple statement for that instead (healthcheck). Moreover, the\nlog category that shows connection failures is now suggested in our\ndocs.\n\nSee https://github.com/datastax/java-driver/pull/1138 for the NPE"}, "afterCommit": {"oid": "83421cb8edeb7d1b1927a3aff0d290fd9098cfb9", "author": {"user": null}, "url": "https://github.com/openzipkin/zipkin/commit/83421cb8edeb7d1b1927a3aff0d290fd9098cfb9", "committedDate": "2020-08-02T06:45:11Z", "message": "Stops using prepared or query builder statements for simply queries\n\nBefore, we needlessly prepared service name query, which would have no\nparameters. While, this is being followed up below, it is unlikely that\npreparing is better than directly executing the statement:\nhttps://groups.google.com/a/lists.datastax.com/forum/#!topic/java-driver-user/d6wLkH3xDLI\n\nMore importantly, there is a bug in the cassandra driver >v3.6 which\ncrashes on `QueryBuilder` statements that have no parameters. This\nuses a simple statement for that instead (healthcheck). Moreover, the\nlog category that shows connection failures is now suggested in our\ndocs.\n\nSee https://github.com/datastax/java-driver/pull/1138 for the NPE"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60d63a17d852fa22527d832eebc2ef4bddb46301", "author": {"user": null}, "url": "https://github.com/openzipkin/zipkin/commit/60d63a17d852fa22527d832eebc2ef4bddb46301", "committedDate": "2020-08-02T07:06:33Z", "message": "revise logging"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1470, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}