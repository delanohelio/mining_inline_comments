{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzNzMyMTAx", "number": 3165, "title": "Adjusts Docker HEALTHCHECK for Kafka from 2s to 5s timeout", "bodyText": "This helps avoid annoying flakes, or having people need to override our\ndefaults.", "createdAt": "2020-08-06T01:53:05Z", "url": "https://github.com/openzipkin/zipkin/pull/3165", "merged": true, "mergeCommit": {"oid": "eb7608883239750b02782e4afa6d0abfa571b1d8"}, "closed": true, "closedAt": "2020-08-06T02:38:21Z", "author": {"login": "codefromthecrypt"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8F3qsAH2gAyNDYzNzMyMTAxOmM2YTU1YjAwZWYzOWIwYWQ1ZThlNzkyNzgxZmMxM2RjOTVlNzczMDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8GG6RgFqTQ2MjEzOTA1NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c6a55b00ef39b0ad5e8e792781fc13dc95e77304", "author": {"user": null}, "url": "https://github.com/openzipkin/zipkin/commit/c6a55b00ef39b0ad5e8e792781fc13dc95e77304", "committedDate": "2020-08-06T01:51:52Z", "message": "Adjusts Docker HEALTHCHECK for Kafka from 2s to 5s timeout\n\nThis helps avoid annoying flakes, or having people need to override our\ndefaults."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMTM0OTA5", "url": "https://github.com/openzipkin/zipkin/pull/3165#pullrequestreview-462134909", "createdAt": "2020-08-06T01:54:20Z", "commit": {"oid": "c6a55b00ef39b0ad5e8e792781fc13dc95e77304"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwMTo1NDoyMFrOG8gdPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwMTo1NDoyMFrOG8gdPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA5OTUxNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Compose, `kafka-topics.sh` was failed on 2s timeout after succeeding, causing a condition to break\n          \n          \n            \n            Compose, `kafka-topics.sh` timed out after 2s even though the prior run succeeded. This broke a condition", "url": "https://github.com/openzipkin/zipkin/pull/3165#discussion_r466099517", "createdAt": "2020-08-06T01:54:20Z", "author": {"login": "codefromthecrypt"}, "path": "docker/RATIONALE.md", "diffHunk": "@@ -15,3 +15,17 @@ Ex. The following command can be used ad-hoc or in scripts without the user know\n $ docker inspect --format='{{json .State.Health.Status}}' kafka-zookeeper\n \"unhealthy\"\n ```\n+\n+### Why default timeout to 5s for Kafka HEALTHCHECK?\n+\n+Docker `HEALTHCHECK` marks a container unhealthy on the first failure that occurs past its start\n+period. It is important to avoid false negatives that are host contention in nature, as they can\n+break orchestration such as docker-compose.\n+\n+Commands like `nc` will almost never timeout launching due to contention, even if they might timeout\n+on network connections themselves for the same reason.\n+\n+`kafka-topics.sh` uses Java and a relatively large classpath. It can be slow when many other\n+processes are starting at the same time. For example, when launching many containers in Docker\n+Compose, `kafka-topics.sh` was failed on 2s timeout after succeeding, causing a condition to break", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6a55b00ef39b0ad5e8e792781fc13dc95e77304"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3680748ec5e7f0c9830971f3af7fc130c357304f", "author": {"user": null}, "url": "https://github.com/openzipkin/zipkin/commit/3680748ec5e7f0c9830971f3af7fc130c357304f", "committedDate": "2020-08-06T01:55:18Z", "message": "Update docker/RATIONALE.md"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMTM5MDU0", "url": "https://github.com/openzipkin/zipkin/pull/3165#pullrequestreview-462139054", "createdAt": "2020-08-06T02:08:31Z", "commit": {"oid": "3680748ec5e7f0c9830971f3af7fc130c357304f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1487, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}