{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg5MjQ3MzEz", "number": 3210, "title": "Ports MySQL test image to our conventions", "bodyText": "Particularly, this image adds HEALTHCHECK and deletes 100MB of binaries not used at runtime, making it 170MB (compared to the official mariadb image which is 400MB)\nOnce released, this completes our storage images: we can add a health condition on any storage image or kafka:\nEx.\n    depends_on:\n      storage:\n        condition: service_healthy\n      kafka-zookeeper:\n        condition: service_healthy", "createdAt": "2020-09-18T11:12:40Z", "url": "https://github.com/openzipkin/zipkin/pull/3210", "merged": true, "mergeCommit": {"oid": "994e78c802109a38857b6bdb5d915c36fb54458a"}, "closed": true, "closedAt": "2020-09-19T00:06:54Z", "author": {"login": "codefromthecrypt"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdKDmViAH2gAyNDg5MjQ3MzEzOjE2ZWJkYzc5NzFjMDY4NmZhNmU4MDc5NWNiZmRlNzQ0YjY1NzAyNGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdKONiSAH2gAyNDg5MjQ3MzEzOjYwMGM1ODUyMzBhZWFhZDUxODg5YjI2NDJiM2VlYmFmNzJhYTQ1OGI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "16ebdc7971c0686fa6e80795cbfde744b657024a", "author": {"user": null}, "url": "https://github.com/openzipkin/zipkin/commit/16ebdc7971c0686fa6e80795cbfde744b657024a", "committedDate": "2020-09-18T11:08:04Z", "message": "Ports MySQL test image to our conventions\n\nThis adds HEALTCHECK and completes all our storage images.\n\nOnce released, we can add a health condition on any storage image or kafka:\n\nEx.\n```\n    depends_on:\n      storage:\n        condition: service_healthy\n      kafka-zookeeper:\n        condition: service_healthy\n```"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMzY5NDUx", "url": "https://github.com/openzipkin/zipkin/pull/3210#pullrequestreview-491369451", "createdAt": "2020-09-18T11:13:37Z", "commit": {"oid": "16ebdc7971c0686fa6e80795cbfde744b657024a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxMToxMzozN1rOHUIrsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxMToxMzozN1rOHUIrsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDg3NTgyNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            echo \"Will wait up to ${timeout} seconds for Cassandra to come up before installing Schema\"\n          \n          \n            \n            echo \"Will wait up to ${timeout} seconds for MySQL to come up before installing Schema\"", "url": "https://github.com/openzipkin/zipkin/pull/3210#discussion_r490875824", "createdAt": "2020-09-18T11:13:37Z", "author": {"login": "codefromthecrypt"}, "path": "docker/storage/mysql/install.sh", "diffHunk": "@@ -19,22 +19,30 @@ echo \"*** Installing MySQL\"\n apk add --update --no-cache mysql mysql-client\n # Fake auth tools install as 10.4.0 install dies otherwise\n mkdir -p /auth_pam_tool_dir/auth_pam_tool\n-mysql_install_db --user=mysql --basedir=/usr/ --datadir=/mysql/data --force\n-mkdir -p /run/mysqld/\n-chown -R mysql /mysql /run/mysqld/\n+\n+MYSQL_OPTS=\"--user=mysql --basedir=${PWD} --datadir=${PWD}/data --tmpdir=/tmp\"\n+\n+# Create the database (stored in the data directory)\n+ln -s /usr/bin bin\n+ln -s /usr/share share\n+mysql_install_db ${MYSQL_OPTS} --force\n+\n+# Prevent \"Bind on unix socket: No such file or directory\"\n+mkdir -p /run/mysqld/ && chown mysql /run/mysqld/\n \n echo \"*** Starting MySQL\"\n-mysqld --user=mysql --basedir=/usr/ --datadir=/mysql/data &\n+mysqld ${MYSQL_OPTS} &\n \n-timeout=300\n-while [[ \"$timeout\" -gt 0 ]] && ! mysql --user=mysql --protocol=socket -uroot -e 'SELECT 1' >/dev/null 2>/dev/null; do\n-    echo \"Waiting ${timeout} seconds for mysql to come up\"\n-    sleep 2\n-    timeout=$(($timeout - 2))\n+# Excessively long timeout to avoid having to create an ENV variable, decide its name, etc.\n+timeout=180\n+echo \"Will wait up to ${timeout} seconds for Cassandra to come up before installing Schema\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16ebdc7971c0686fa6e80795cbfde744b657024a"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77f725bc53a3934c07f2749887b6c5d891bc8374", "author": {"user": null}, "url": "https://github.com/openzipkin/zipkin/commit/77f725bc53a3934c07f2749887b6c5d891bc8374", "committedDate": "2020-09-18T11:13:47Z", "message": "copy/pasta"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNDI5NzI0", "url": "https://github.com/openzipkin/zipkin/pull/3210#pullrequestreview-491429724", "createdAt": "2020-09-18T12:44:25Z", "commit": {"oid": "77f725bc53a3934c07f2749887b6c5d891bc8374"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "600c585230aeaad51889b2642b3eebaf72aa458b", "author": {"user": null}, "url": "https://github.com/openzipkin/zipkin/commit/600c585230aeaad51889b2642b3eebaf72aa458b", "committedDate": "2020-09-18T23:29:56Z", "message": "license"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1550, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}