{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwNjkwNDc4", "number": 3180, "title": "Improve search result table's design", "bodyText": "The current search results table is cluttered.\nAnd the code was more complicated than it needed to be.\nSo I've updated these components from scratch.\nBefore\n\nAfter\n\n\nFeatrues\nCollapssible\n\nFiltering by service names\n\nSortable", "createdAt": "2020-08-20T06:24:56Z", "url": "https://github.com/openzipkin/zipkin/pull/3180", "merged": true, "mergeCommit": {"oid": "8895f9db749dc05c4cf84cf8d737d90a916aba68"}, "closed": true, "closedAt": "2020-09-04T05:52:58Z", "author": {"login": "tacigar"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAGeIxgH2gAyNDcwNjkwNDc4OmVjMWY3ODhlNGRiZGVjMmJlNWNjYjliNjg4MmRhZTI0MjA2YmZiZmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFSbntgH2gAyNDcwNjkwNDc4OjQ5MDczYmQzNDRkNzZmMTVlZTc1MDlkNTE5ZWMyZWEwMTNlNzdjZjk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ec1f788e4dbdec2be5ccb9b6882dae24206bfbfa", "author": {"user": {"login": "tacigar", "name": "tacigar"}}, "url": "https://github.com/openzipkin/zipkin/commit/ec1f788e4dbdec2be5ccb9b6882dae24206bfbfa", "committedDate": "2020-08-18T12:49:35Z", "message": "Add TraceSummary type and add root info to trace summary"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6055a6ca37049142ffd0b2da6fb2a701a9fd1829", "author": {"user": {"login": "tacigar", "name": "tacigar"}}, "url": "https://github.com/openzipkin/zipkin/commit/6055a6ca37049142ffd0b2da6fb2a701a9fd1829", "committedDate": "2020-08-19T01:47:20Z", "message": "Add TraceSummaryTable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a083bc57d5f701af0e3eb421fe3fe6dcde4a2f87", "author": {"user": {"login": "tacigar", "name": "tacigar"}}, "url": "https://github.com/openzipkin/zipkin/commit/a083bc57d5f701af0e3eb421fe3fe6dcde4a2f87", "committedDate": "2020-08-19T01:54:15Z", "message": "Add Trace ID"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08884304f980c2fe16ae1ea5132cc66ebdcb22e3", "author": {"user": {"login": "tacigar", "name": "tacigar"}}, "url": "https://github.com/openzipkin/zipkin/commit/08884304f980c2fe16ae1ea5132cc66ebdcb22e3", "committedDate": "2020-08-19T03:56:13Z", "message": "(package) Update recharts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f7570c7ac2e02ed920b6f403a15ff6347a46c36", "author": {"user": {"login": "tacigar", "name": "tacigar"}}, "url": "https://github.com/openzipkin/zipkin/commit/8f7570c7ac2e02ed920b6f403a15ff6347a46c36", "committedDate": "2020-08-19T03:56:31Z", "message": "Add service and span count chart"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26d5d13ddeb1e9e27a164c1a6f8d5b098ae49e67", "author": {"user": {"login": "tacigar", "name": "tacigar"}}, "url": "https://github.com/openzipkin/zipkin/commit/26d5d13ddeb1e9e27a164c1a6f8d5b098ae49e67", "committedDate": "2020-08-20T04:36:08Z", "message": "Add Link to trace page"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db904319d711031b28082c8673ec4333ff90ec22", "author": {"user": {"login": "tacigar", "name": "tacigar"}}, "url": "https://github.com/openzipkin/zipkin/commit/db904319d711031b28082c8673ec4333ff90ec22", "committedDate": "2020-08-20T04:55:51Z", "message": "Update design"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60304e3a5c9beb06d79e1fd05047e0f3a34c2a05", "author": {"user": {"login": "tacigar", "name": "tacigar"}}, "url": "https://github.com/openzipkin/zipkin/commit/60304e3a5c9beb06d79e1fd05047e0f3a34c2a05", "committedDate": "2020-08-20T05:56:03Z", "message": "Add sorter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12c0788ef1ddc61fbb6f80a8efd344d944591022", "author": {"user": {"login": "tacigar", "name": "tacigar"}}, "url": "https://github.com/openzipkin/zipkin/commit/12c0788ef1ddc61fbb6f80a8efd344d944591022", "committedDate": "2020-08-20T06:02:44Z", "message": "Remove labelFormatter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ba2e08c48de766b8da378a9670bc9ef44c8b572", "author": {"user": {"login": "tacigar", "name": "tacigar"}}, "url": "https://github.com/openzipkin/zipkin/commit/2ba2e08c48de766b8da378a9670bc9ef44c8b572", "committedDate": "2020-08-20T06:08:12Z", "message": "Remove unused files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0550c3f8994ff20a906c25ec3790037d071ca38", "author": {"user": {"login": "tacigar", "name": "tacigar"}}, "url": "https://github.com/openzipkin/zipkin/commit/e0550c3f8994ff20a906c25ec3790037d071ca38", "committedDate": "2020-08-21T00:06:44Z", "message": "Change root span cell design"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36066a60f9e85a591c0623092a1f45402a87400e", "author": {"user": {"login": "tacigar", "name": "tacigar"}}, "url": "https://github.com/openzipkin/zipkin/commit/36066a60f9e85a591c0623092a1f45402a87400e", "committedDate": "2020-08-30T22:46:14Z", "message": "Add Filter feature"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "940dbc03bd5681533693e056e072bcd3000dd6cf", "author": {"user": {"login": "tacigar", "name": "tacigar"}}, "url": "https://github.com/openzipkin/zipkin/commit/940dbc03bd5681533693e056e072bcd3000dd6cf", "committedDate": "2020-08-30T22:50:30Z", "message": "Sort service names by span count"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MjYyNjQx", "url": "https://github.com/openzipkin/zipkin/pull/3180#pullrequestreview-478262641", "createdAt": "2020-08-31T01:41:19Z", "commit": {"oid": "940dbc03bd5681533693e056e072bcd3000dd6cf"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwMTo0MToyMFrOHJnnWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwMTo0NDoxMVrOHJnpSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg0ODI4Mw==", "bodyText": "Is it possible to avoid this cast?", "url": "https://github.com/openzipkin/zipkin/pull/3180#discussion_r479848283", "createdAt": "2020-08-31T01:41:20Z", "author": {"login": "anuraaga"}, "path": "zipkin-lens/src/components/DiscoverPage/DiscoverPageContent.tsx", "diffHunk": "@@ -399,29 +404,60 @@ const DiscoverPageContent: React.FC<DiscoverPageContentProps> = ({\n     }\n   }, [setQueryParams, tempCriteria, tempLookback, tempLimit]);\n \n-  const [traces, isLoadingTraces] = useSelector((state: RootState) => [\n+  const [\n+    traces,\n+    isLoadingTraces,\n+    traceSummaries,\n+  ] = useSelector((state: RootState) => [\n     state.traces.traces,\n     state.traces.isLoading,\n+    state.traces.traceSummaries as TraceSummary[],", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "940dbc03bd5681533693e056e072bcd3000dd6cf"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg0ODQxMw==", "bodyText": "Can you use Set instead of object / keys?", "url": "https://github.com/openzipkin/zipkin/pull/3180#discussion_r479848413", "createdAt": "2020-08-31T01:41:57Z", "author": {"login": "anuraaga"}, "path": "zipkin-lens/src/components/DiscoverPage/DiscoverPageContent.tsx", "diffHunk": "@@ -399,29 +404,60 @@ const DiscoverPageContent: React.FC<DiscoverPageContentProps> = ({\n     }\n   }, [setQueryParams, tempCriteria, tempLookback, tempLimit]);\n \n-  const [traces, isLoadingTraces] = useSelector((state: RootState) => [\n+  const [\n+    traces,\n+    isLoadingTraces,\n+    traceSummaries,\n+  ] = useSelector((state: RootState) => [\n     state.traces.traces,\n     state.traces.isLoading,\n+    state.traces.traceSummaries as TraceSummary[],\n   ]);\n \n   const [isShowingLookbackMenu, setIsShowingLookbackMenu] = useState(false);\n-\n   const toggleLookbackMenu = useCallback(() => {\n     setIsShowingLookbackMenu((prev) => !prev);\n   }, []);\n-\n   const closeLookbackMenu = useCallback(() => {\n     setIsShowingLookbackMenu(false);\n   }, []);\n \n   const [isOpeningSettings, setIsOpeningSettings] = useState(false);\n-\n   const handleSettingsButtonClick = useCallback(() => {\n     setIsOpeningSettings((prev) => !prev);\n   }, []);\n \n-  let content: JSX.Element | undefined;\n+  const [filters, setFilters] = useState<string[]>([]);\n+  const filterOptions = useMemo(\n+    () =>\n+      Object.keys(\n+        traceSummaries.reduce((acc, cur) => {\n+          cur.serviceSummaries.forEach((serviceSummary) => {\n+            acc[serviceSummary.serviceName] = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "940dbc03bd5681533693e056e072bcd3000dd6cf"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg0ODU5Ng==", "bodyText": "Can wait until all the UI feedback is finalized but let's not forget i18n", "url": "https://github.com/openzipkin/zipkin/pull/3180#discussion_r479848596", "createdAt": "2020-08-31T01:43:08Z", "author": {"login": "anuraaga"}, "path": "zipkin-lens/src/components/DiscoverPage/DiscoverPageContent.tsx", "diffHunk": "@@ -483,14 +525,30 @@ const DiscoverPageContent: React.FC<DiscoverPageContentProps> = ({\n               <SettingsIcon />\n             </SettingsButton>\n           </Box>\n-          {isOpeningSettings ? (\n+        </Container>\n+        <Collapse in={isOpeningSettings}>\n+          <Box mt={1.5} mb={1.5}>\n+            <Divider />\n+          </Box>\n+          <Container>\n             <Box\n               display=\"flex\"\n               alignItems=\"center\"\n               justifyContent=\"flex-end\"\n               mt={1.75}\n             >\n-              <Box mr={1} position=\"relative\">\n+              <TextField\n+                label=\"Limit\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "940dbc03bd5681533693e056e072bcd3000dd6cf"}, "originalPosition": 147}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg0ODc3OA==", "bodyText": "Believe you may be able to use useReducer instead of useState + useCallback since you only toggle.", "url": "https://github.com/openzipkin/zipkin/pull/3180#discussion_r479848778", "createdAt": "2020-08-31T01:44:11Z", "author": {"login": "anuraaga"}, "path": "zipkin-lens/src/components/DiscoverPage/TraceSummaryRow.tsx", "diffHunk": "@@ -0,0 +1,231 @@\n+/*\n+ * Copyright 2015-2020 The OpenZipkin Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import {\n+  Box,\n+  Collapse,\n+  IconButton,\n+  TableCell,\n+  TableRow,\n+  Typography,\n+  useTheme,\n+  Button,\n+} from '@material-ui/core';\n+import KeyboardArrowDownIcon from '@material-ui/icons/KeyboardArrowDown';\n+import KeyboardArrowUpIcon from '@material-ui/icons/KeyboardArrowUp';\n+import moment from 'moment';\n+import React, { useCallback, useMemo, useState } from 'react';\n+import { Link } from 'react-router-dom';\n+import {\n+  Bar,\n+  BarChart,\n+  CartesianGrid,\n+  LabelList,\n+  ResponsiveContainer,\n+  Tooltip,\n+  XAxis,\n+  YAxis,\n+} from 'recharts';\n+import styled from 'styled-components';\n+\n+import { selectColorByInfoClass, selectServiceColor } from '../../colors';\n+import TraceSummary from '../../models/TraceSummary';\n+import { formatDuration } from '../../util/timestamp';\n+\n+const renderCustomizedLabel = (props: any) => {\n+  const { x, y, width, value } = props;\n+  const radius = 10;\n+\n+  return (\n+    <g>\n+      <circle\n+        cx={x + width / 2}\n+        cy={y - radius}\n+        r={radius}\n+        fill={selectServiceColor(value)}\n+      />\n+      <text\n+        x={x + width / 2}\n+        y={y - radius}\n+        fill=\"#fff\"\n+        textAnchor=\"middle\"\n+        dominantBaseline=\"middle\"\n+      >\n+        {value[0].toUpperCase()}\n+      </text>\n+    </g>\n+  );\n+};\n+\n+interface TraceSummaryRowProps {\n+  traceSummary: TraceSummary;\n+}\n+\n+const TraceSummaryRow: React.FC<TraceSummaryRowProps> = ({ traceSummary }) => {\n+  const theme = useTheme();\n+  const [open, setOpen] = useState(false);\n+  const handleOpenButtonClick = useCallback(() => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "940dbc03bd5681533693e056e072bcd3000dd6cf"}, "originalPosition": 78}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MzUxMzM1", "url": "https://github.com/openzipkin/zipkin/pull/3180#pullrequestreview-478351335", "createdAt": "2020-08-31T06:38:28Z", "commit": {"oid": "940dbc03bd5681533693e056e072bcd3000dd6cf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06fef6f68e739fcf2d6349c47809de9e951379be", "author": {"user": {"login": "tacigar", "name": "tacigar"}}, "url": "https://github.com/openzipkin/zipkin/commit/06fef6f68e739fcf2d6349c47809de9e951379be", "committedDate": "2020-08-31T12:00:48Z", "message": "Merge branch 'master' into tacigar/traces-page"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6e4fbd0abf010efb7bc8b306b1798cf8cd9a8112", "author": {"user": {"login": "tacigar", "name": "tacigar"}}, "url": "https://github.com/openzipkin/zipkin/commit/6e4fbd0abf010efb7bc8b306b1798cf8cd9a8112", "committedDate": "2020-08-31T11:56:08Z", "message": "Merge branch 'master' into tacigar/traces-page"}, "afterCommit": {"oid": "06fef6f68e739fcf2d6349c47809de9e951379be", "author": {"user": {"login": "tacigar", "name": "tacigar"}}, "url": "https://github.com/openzipkin/zipkin/commit/06fef6f68e739fcf2d6349c47809de9e951379be", "committedDate": "2020-08-31T12:00:48Z", "message": "Merge branch 'master' into tacigar/traces-page"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86babbb5be4ffac4d42086d8651054f46781f8a3", "author": {"user": {"login": "tacigar", "name": "tacigar"}}, "url": "https://github.com/openzipkin/zipkin/commit/86babbb5be4ffac4d42086d8651054f46781f8a3", "committedDate": "2020-08-31T12:14:01Z", "message": "Use Set instead of object"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94981617af1fb0c2e638600f8f109c45ee36c131", "author": {"user": {"login": "tacigar", "name": "tacigar"}}, "url": "https://github.com/openzipkin/zipkin/commit/94981617af1fb0c2e638600f8f109c45ee36c131", "committedDate": "2020-08-31T12:25:15Z", "message": "Use useReducer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbb5f0451995b90d9649b9b12e3a7fcdc82e9a12", "author": {"user": {"login": "tacigar", "name": "tacigar"}}, "url": "https://github.com/openzipkin/zipkin/commit/bbb5f0451995b90d9649b9b12e3a7fcdc82e9a12", "committedDate": "2020-08-31T12:46:45Z", "message": "i18n"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67242254e58fffe263d85875b50a200bf45ba836", "author": {"user": {"login": "tacigar", "name": "tacigar"}}, "url": "https://github.com/openzipkin/zipkin/commit/67242254e58fffe263d85875b50a200bf45ba836", "committedDate": "2020-09-01T08:21:39Z", "message": "Use Set"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwNTY2OTUx", "url": "https://github.com/openzipkin/zipkin/pull/3180#pullrequestreview-480566951", "createdAt": "2020-09-02T07:49:11Z", "commit": {"oid": "67242254e58fffe263d85875b50a200bf45ba836"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5362d30e53b20f7559495d18d718f78a9d51d9cc", "author": {"user": {"login": "tacigar", "name": "tacigar"}}, "url": "https://github.com/openzipkin/zipkin/commit/5362d30e53b20f7559495d18d718f78a9d51d9cc", "committedDate": "2020-09-03T14:53:35Z", "message": "Remove bar chart and revive service name badges"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "063b6c413833bc9454c84e2fd775ccdd653f0190", "author": {"user": {"login": "tacigar", "name": "tacigar"}}, "url": "https://github.com/openzipkin/zipkin/commit/063b6c413833bc9454c84e2fd775ccdd653f0190", "committedDate": "2020-09-03T15:22:59Z", "message": "Add expand all & collapse all button"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49073bd344d76f15ee7509d519ec2ea013e77cf9", "author": {"user": {"login": "tacigar", "name": "tacigar"}}, "url": "https://github.com/openzipkin/zipkin/commit/49073bd344d76f15ee7509d519ec2ea013e77cf9", "committedDate": "2020-09-03T15:35:19Z", "message": "Refactor"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1512, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}