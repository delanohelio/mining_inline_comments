{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYwMjk0Nzgx", "number": 2956, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQwNjowNDo1MlrODWcglg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQwNjowNToxNVrODWcgww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0ODYyMzU4OnYy", "diffSide": "RIGHT", "path": "zipkin-lens/src/components/TracePage/TraceSummary.jsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQwNjowNDo1MlrOFbNZeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwNDo0ODoyN1rOFbq3Hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDA3NTM4NQ==", "bodyText": "This logic is pretty complex, can you add some comments? In particular, this propagation of skip is confusing me.", "url": "https://github.com/openzipkin/zipkin/pull/2956#discussion_r364075385", "createdAt": "2020-01-08T06:04:52Z", "author": {"login": "anuraaga"}, "path": "zipkin-lens/src/components/TracePage/TraceSummary.jsx", "diffHunk": "@@ -80,19 +83,34 @@ const TraceSummary = React.memo(({ traceSummary }) => {\n   }, [isRootedTrace, rootSpanIndex, traceSummary.spans]);\n \n   const shownTree = useMemo(() => {\n-    const allHiddenSpanIds = {};\n-    rerootedTree.forEach((span) => {\n-      if (childrenHiddenSpanIds[span.parentId]) {\n-        allHiddenSpanIds[span.spanId] = true;\n+    let depth = 0;\n+    let skip = false;\n+\n+    return rerootedTree.reduce((acc, cur) => {\n+      if (cur.depth > depth && skip) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d234fc0894afa05ba6d5861525311a38aa60e368"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDU1ODExMA==", "bodyText": "I simplified this logic.\nAs you said, skip is unnecessary... \ud83d\ude13", "url": "https://github.com/openzipkin/zipkin/pull/2956#discussion_r364558110", "createdAt": "2020-01-09T04:48:27Z", "author": {"login": "tacigar"}, "path": "zipkin-lens/src/components/TracePage/TraceSummary.jsx", "diffHunk": "@@ -80,19 +83,34 @@ const TraceSummary = React.memo(({ traceSummary }) => {\n   }, [isRootedTrace, rootSpanIndex, traceSummary.spans]);\n \n   const shownTree = useMemo(() => {\n-    const allHiddenSpanIds = {};\n-    rerootedTree.forEach((span) => {\n-      if (childrenHiddenSpanIds[span.parentId]) {\n-        allHiddenSpanIds[span.spanId] = true;\n+    let depth = 0;\n+    let skip = false;\n+\n+    return rerootedTree.reduce((acc, cur) => {\n+      if (cur.depth > depth && skip) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDA3NTM4NQ=="}, "originalCommit": {"oid": "d234fc0894afa05ba6d5861525311a38aa60e368"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0ODYyNDAzOnYy", "diffSide": "RIGHT", "path": "zipkin-lens/src/components/TracePage/TraceSummary.jsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQwNjowNToxNVrOFbNZvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQwNjowNToxNVrOFbNZvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDA3NTQ1Mw==", "bodyText": "Let's use semantic names instead of acc, cur - I think it's shownTraces, trace?", "url": "https://github.com/openzipkin/zipkin/pull/2956#discussion_r364075453", "createdAt": "2020-01-08T06:05:15Z", "author": {"login": "anuraaga"}, "path": "zipkin-lens/src/components/TracePage/TraceSummary.jsx", "diffHunk": "@@ -80,19 +83,34 @@ const TraceSummary = React.memo(({ traceSummary }) => {\n   }, [isRootedTrace, rootSpanIndex, traceSummary.spans]);\n \n   const shownTree = useMemo(() => {\n-    const allHiddenSpanIds = {};\n-    rerootedTree.forEach((span) => {\n-      if (childrenHiddenSpanIds[span.parentId]) {\n-        allHiddenSpanIds[span.spanId] = true;\n+    let depth = 0;\n+    let skip = false;\n+\n+    return rerootedTree.reduce((acc, cur) => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d234fc0894afa05ba6d5861525311a38aa60e368"}, "originalPosition": 43}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1272, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}