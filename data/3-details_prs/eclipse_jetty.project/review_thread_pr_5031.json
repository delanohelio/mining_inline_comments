{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2MDc5Nzcy", "number": 5031, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNDoxMTo1M1rOEN1h1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNDoyNjoyMlrOEN17Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyOTQzOTU4OnYy", "diffSide": "RIGHT", "path": "jetty-websocket/websocket-jetty-client/src/main/java/org/eclipse/jetty/websocket/client/ClientUpgradeRequest.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNDoxMTo1M1rOGwqX3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQwNjo1MjowM1rOGxGkbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY3OTA2OA==", "bodyText": "Please move this static field to the top of the class and make it private.\nAlso, no need to pass it as parameter to quoteIfNeeded().", "url": "https://github.com/eclipse/jetty.project/pull/5031#discussion_r453679068", "createdAt": "2020-07-13T14:11:53Z", "author": {"login": "sbordet"}, "path": "jetty-websocket/websocket-jetty-client/src/main/java/org/eclipse/jetty/websocket/client/ClientUpgradeRequest.java", "diffHunk": "@@ -297,6 +292,25 @@ public void setSession(Object session)\n         throw new UnsupportedOperationException(\"HttpSession not available on Client request\");\n     }\n \n+    /**\n+     * @param timeout the total timeout for the request/response conversation of the WebSocket handshake;\n+     * use zero or a negative value to disable the timeout\n+     * @param unit the timeout unit\n+     */\n+    public void setTimeout(long timeout, TimeUnit unit)\n+    {\n+        this.timeout = unit.toMillis(timeout);\n+    }\n+\n+    /**\n+     * @return the total timeout for this request, in milliseconds;\n+     * zero or negative if the timeout is disabled\n+     */\n+    public long getTimeout()\n+    {\n+        return timeout;\n+    }\n+\n     /**\n      * ABNF from RFC 2616, RFC 822, and RFC 6455 specified characters requiring quoting.\n      */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25d7b99ba1c00c75ad10140c0e9ee9c44e257de2"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY5MzI3Nw==", "bodyText": "This suggestion is unrelated to this issue.\nGood for a different PR related to general cleanup tho.", "url": "https://github.com/eclipse/jetty.project/pull/5031#discussion_r453693277", "createdAt": "2020-07-13T14:32:03Z", "author": {"login": "joakime"}, "path": "jetty-websocket/websocket-jetty-client/src/main/java/org/eclipse/jetty/websocket/client/ClientUpgradeRequest.java", "diffHunk": "@@ -297,6 +292,25 @@ public void setSession(Object session)\n         throw new UnsupportedOperationException(\"HttpSession not available on Client request\");\n     }\n \n+    /**\n+     * @param timeout the total timeout for the request/response conversation of the WebSocket handshake;\n+     * use zero or a negative value to disable the timeout\n+     * @param unit the timeout unit\n+     */\n+    public void setTimeout(long timeout, TimeUnit unit)\n+    {\n+        this.timeout = unit.toMillis(timeout);\n+    }\n+\n+    /**\n+     * @return the total timeout for this request, in milliseconds;\n+     * zero or negative if the timeout is disabled\n+     */\n+    public long getTimeout()\n+    {\n+        return timeout;\n+    }\n+\n     /**\n      * ABNF from RFC 2616, RFC 822, and RFC 6455 specified characters requiring quoting.\n      */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY3OTA2OA=="}, "originalCommit": {"oid": "25d7b99ba1c00c75ad10140c0e9ee9c44e257de2"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDE0MTAzOA==", "bodyText": "I will do this in a separate cleanup PR then.", "url": "https://github.com/eclipse/jetty.project/pull/5031#discussion_r454141038", "createdAt": "2020-07-14T06:52:03Z", "author": {"login": "lachlan-roberts"}, "path": "jetty-websocket/websocket-jetty-client/src/main/java/org/eclipse/jetty/websocket/client/ClientUpgradeRequest.java", "diffHunk": "@@ -297,6 +292,25 @@ public void setSession(Object session)\n         throw new UnsupportedOperationException(\"HttpSession not available on Client request\");\n     }\n \n+    /**\n+     * @param timeout the total timeout for the request/response conversation of the WebSocket handshake;\n+     * use zero or a negative value to disable the timeout\n+     * @param unit the timeout unit\n+     */\n+    public void setTimeout(long timeout, TimeUnit unit)\n+    {\n+        this.timeout = unit.toMillis(timeout);\n+    }\n+\n+    /**\n+     * @return the total timeout for this request, in milliseconds;\n+     * zero or negative if the timeout is disabled\n+     */\n+    public long getTimeout()\n+    {\n+        return timeout;\n+    }\n+\n     /**\n      * ABNF from RFC 2616, RFC 822, and RFC 6455 specified characters requiring quoting.\n      */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY3OTA2OA=="}, "originalCommit": {"oid": "25d7b99ba1c00c75ad10140c0e9ee9c44e257de2"}, "originalPosition": 100}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyOTQ0OTY1OnYy", "diffSide": "RIGHT", "path": "jetty-websocket/websocket-jetty-client/src/main/java/org/eclipse/jetty/websocket/client/ClientUpgradeRequest.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNDoxNDoyNFrOGwqeBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxMjozMTozMVrOGxRj3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY4MDY0Nw==", "bodyText": "Return the hardcoded value HttpVersion.HTTP_1_1.asString().\nWe don't want to throw if someone calls this method for logging purposes.", "url": "https://github.com/eclipse/jetty.project/pull/5031#discussion_r453680647", "createdAt": "2020-07-13T14:14:24Z", "author": {"login": "sbordet"}, "path": "jetty-websocket/websocket-jetty-client/src/main/java/org/eclipse/jetty/websocket/client/ClientUpgradeRequest.java", "diffHunk": "@@ -161,13 +161,13 @@ public String getHost()\n     @Override\n     public String getHttpVersion()\n     {\n-        return httpVersion;\n+        throw new UnsupportedOperationException(\"HttpVersion not available on ClientUpgradeRequest\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25d7b99ba1c00c75ad10140c0e9ee9c44e257de2"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcwNzE5OA==", "bodyText": "What if we're doing websocket over HTTP/2?\nI don't think we have enough information available here to know if we are using HTTP/2 or not.\nThe previous implementation of this just returned null for both as there were no setters for it.", "url": "https://github.com/eclipse/jetty.project/pull/5031#discussion_r453707198", "createdAt": "2020-07-13T14:51:06Z", "author": {"login": "lachlan-roberts"}, "path": "jetty-websocket/websocket-jetty-client/src/main/java/org/eclipse/jetty/websocket/client/ClientUpgradeRequest.java", "diffHunk": "@@ -161,13 +161,13 @@ public String getHost()\n     @Override\n     public String getHttpVersion()\n     {\n-        return httpVersion;\n+        throw new UnsupportedOperationException(\"HttpVersion not available on ClientUpgradeRequest\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY4MDY0Nw=="}, "originalCommit": {"oid": "25d7b99ba1c00c75ad10140c0e9ee9c44e257de2"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDE4OTQ4OA==", "bodyText": "@lachlan-roberts so why there are these 2 methods then? A relic of 9.4.x?\nIf we cannot implement them like you correctly point out, let's remove them.", "url": "https://github.com/eclipse/jetty.project/pull/5031#discussion_r454189488", "createdAt": "2020-07-14T08:25:30Z", "author": {"login": "sbordet"}, "path": "jetty-websocket/websocket-jetty-client/src/main/java/org/eclipse/jetty/websocket/client/ClientUpgradeRequest.java", "diffHunk": "@@ -161,13 +161,13 @@ public String getHost()\n     @Override\n     public String getHttpVersion()\n     {\n-        return httpVersion;\n+        throw new UnsupportedOperationException(\"HttpVersion not available on ClientUpgradeRequest\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY4MDY0Nw=="}, "originalCommit": {"oid": "25d7b99ba1c00c75ad10140c0e9ee9c44e257de2"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDMyMTExNg==", "bodyText": "We need these methods here because this implements the org.eclipse.jetty.websocket.api.UpgradeRequest interface. These methods can be used on the server side, and are implemented on the client after the upgrade once you get it from the Session.", "url": "https://github.com/eclipse/jetty.project/pull/5031#discussion_r454321116", "createdAt": "2020-07-14T12:31:31Z", "author": {"login": "lachlan-roberts"}, "path": "jetty-websocket/websocket-jetty-client/src/main/java/org/eclipse/jetty/websocket/client/ClientUpgradeRequest.java", "diffHunk": "@@ -161,13 +161,13 @@ public String getHost()\n     @Override\n     public String getHttpVersion()\n     {\n-        return httpVersion;\n+        throw new UnsupportedOperationException(\"HttpVersion not available on ClientUpgradeRequest\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY4MDY0Nw=="}, "originalCommit": {"oid": "25d7b99ba1c00c75ad10140c0e9ee9c44e257de2"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyOTQ1MTU1OnYy", "diffSide": "RIGHT", "path": "jetty-websocket/websocket-jetty-client/src/main/java/org/eclipse/jetty/websocket/client/ClientUpgradeRequest.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNDoxNDo1M1rOGwqfRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQwNjo1NTozNlrOGxGqwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY4MDk2Nw==", "bodyText": "Return hardcoded HttpMethod.GET.asString().", "url": "https://github.com/eclipse/jetty.project/pull/5031#discussion_r453680967", "createdAt": "2020-07-13T14:14:53Z", "author": {"login": "sbordet"}, "path": "jetty-websocket/websocket-jetty-client/src/main/java/org/eclipse/jetty/websocket/client/ClientUpgradeRequest.java", "diffHunk": "@@ -161,13 +161,13 @@ public String getHost()\n     @Override\n     public String getHttpVersion()\n     {\n-        return httpVersion;\n+        throw new UnsupportedOperationException(\"HttpVersion not available on ClientUpgradeRequest\");\n     }\n \n     @Override\n     public String getMethod()\n     {\n-        return method;\n+        throw new UnsupportedOperationException(\"Method not available on ClientUpgradeRequest\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25d7b99ba1c00c75ad10140c0e9ee9c44e257de2"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY5NDExMA==", "bodyText": "Should just remove the .getMethod() entirely, it's always GET", "url": "https://github.com/eclipse/jetty.project/pull/5031#discussion_r453694110", "createdAt": "2020-07-13T14:33:20Z", "author": {"login": "joakime"}, "path": "jetty-websocket/websocket-jetty-client/src/main/java/org/eclipse/jetty/websocket/client/ClientUpgradeRequest.java", "diffHunk": "@@ -161,13 +161,13 @@ public String getHost()\n     @Override\n     public String getHttpVersion()\n     {\n-        return httpVersion;\n+        throw new UnsupportedOperationException(\"HttpVersion not available on ClientUpgradeRequest\");\n     }\n \n     @Override\n     public String getMethod()\n     {\n-        return method;\n+        throw new UnsupportedOperationException(\"Method not available on ClientUpgradeRequest\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY4MDk2Nw=="}, "originalCommit": {"oid": "25d7b99ba1c00c75ad10140c0e9ee9c44e257de2"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDE0MjY1Nw==", "bodyText": "Same as above, for HTTP/2 this would be CONNECT. So at this stage we don't really know.", "url": "https://github.com/eclipse/jetty.project/pull/5031#discussion_r454142657", "createdAt": "2020-07-14T06:55:36Z", "author": {"login": "lachlan-roberts"}, "path": "jetty-websocket/websocket-jetty-client/src/main/java/org/eclipse/jetty/websocket/client/ClientUpgradeRequest.java", "diffHunk": "@@ -161,13 +161,13 @@ public String getHost()\n     @Override\n     public String getHttpVersion()\n     {\n-        return httpVersion;\n+        throw new UnsupportedOperationException(\"HttpVersion not available on ClientUpgradeRequest\");\n     }\n \n     @Override\n     public String getMethod()\n     {\n-        return method;\n+        throw new UnsupportedOperationException(\"Method not available on ClientUpgradeRequest\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY4MDk2Nw=="}, "originalCommit": {"oid": "25d7b99ba1c00c75ad10140c0e9ee9c44e257de2"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyOTQ3NjQ1OnYy", "diffSide": "RIGHT", "path": "jetty-websocket/websocket-jetty-client/src/main/java/org/eclipse/jetty/websocket/client/WebSocketClient.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNDoyMDoxN1rOGwquRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNToyNTo0NlrOGwtoiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY4NDgwNw==", "bodyText": "You don't need to allocate this CF, just return what whenComplete() returns below.", "url": "https://github.com/eclipse/jetty.project/pull/5031#discussion_r453684807", "createdAt": "2020-07-13T14:20:17Z", "author": {"login": "sbordet"}, "path": "jetty-websocket/websocket-jetty-client/src/main/java/org/eclipse/jetty/websocket/client/WebSocketClient.java", "diffHunk": "@@ -149,9 +149,8 @@ public void onHandshakeResponse(HttpRequest request, HttpResponse response)\n                 }\n             });\n         }\n-        upgradeRequest.setConfiguration(configurationCustomizer);\n-        CompletableFuture<Session> futureSession = new CompletableFuture<>();\n \n+        CompletableFuture<Session> futureSession = new CompletableFuture<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25d7b99ba1c00c75ad10140c0e9ee9c44e257de2"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY5NTIzNQ==", "bodyText": "That doesn't seem right.\nWe want to return immediately, and let the whenComplete handle the success/exception at a later point in time.", "url": "https://github.com/eclipse/jetty.project/pull/5031#discussion_r453695235", "createdAt": "2020-07-13T14:34:54Z", "author": {"login": "joakime"}, "path": "jetty-websocket/websocket-jetty-client/src/main/java/org/eclipse/jetty/websocket/client/WebSocketClient.java", "diffHunk": "@@ -149,9 +149,8 @@ public void onHandshakeResponse(HttpRequest request, HttpResponse response)\n                 }\n             });\n         }\n-        upgradeRequest.setConfiguration(configurationCustomizer);\n-        CompletableFuture<Session> futureSession = new CompletableFuture<>();\n \n+        CompletableFuture<Session> futureSession = new CompletableFuture<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY4NDgwNw=="}, "originalCommit": {"oid": "25d7b99ba1c00c75ad10140c0e9ee9c44e257de2"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcwNTM5OQ==", "bodyText": "This CF is giving a Jetty WS API Session, and the one with the whenComplete() returns a CoreSession. They're not interchangeable.\nThe core connect is used to complete the future for the jetty ws api connect.", "url": "https://github.com/eclipse/jetty.project/pull/5031#discussion_r453705399", "createdAt": "2020-07-13T14:48:46Z", "author": {"login": "lachlan-roberts"}, "path": "jetty-websocket/websocket-jetty-client/src/main/java/org/eclipse/jetty/websocket/client/WebSocketClient.java", "diffHunk": "@@ -149,9 +149,8 @@ public void onHandshakeResponse(HttpRequest request, HttpResponse response)\n                 }\n             });\n         }\n-        upgradeRequest.setConfiguration(configurationCustomizer);\n-        CompletableFuture<Session> futureSession = new CompletableFuture<>();\n \n+        CompletableFuture<Session> futureSession = new CompletableFuture<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY4NDgwNw=="}, "originalCommit": {"oid": "25d7b99ba1c00c75ad10140c0e9ee9c44e257de2"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcwNzY4Mw==", "bodyText": "@lachlan-roberts CFs can be map()ed to transform their result; or perhaps use CF.handle() rather than whenComplete().", "url": "https://github.com/eclipse/jetty.project/pull/5031#discussion_r453707683", "createdAt": "2020-07-13T14:51:47Z", "author": {"login": "sbordet"}, "path": "jetty-websocket/websocket-jetty-client/src/main/java/org/eclipse/jetty/websocket/client/WebSocketClient.java", "diffHunk": "@@ -149,9 +149,8 @@ public void onHandshakeResponse(HttpRequest request, HttpResponse response)\n                 }\n             });\n         }\n-        upgradeRequest.setConfiguration(configurationCustomizer);\n-        CompletableFuture<Session> futureSession = new CompletableFuture<>();\n \n+        CompletableFuture<Session> futureSession = new CompletableFuture<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY4NDgwNw=="}, "originalCommit": {"oid": "25d7b99ba1c00c75ad10140c0e9ee9c44e257de2"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcyMzUyOA==", "bodyText": "Just looked at that, but I don't think we can map the exception like we are currently doing using CF.handle().", "url": "https://github.com/eclipse/jetty.project/pull/5031#discussion_r453723528", "createdAt": "2020-07-13T15:13:29Z", "author": {"login": "lachlan-roberts"}, "path": "jetty-websocket/websocket-jetty-client/src/main/java/org/eclipse/jetty/websocket/client/WebSocketClient.java", "diffHunk": "@@ -149,9 +149,8 @@ public void onHandshakeResponse(HttpRequest request, HttpResponse response)\n                 }\n             });\n         }\n-        upgradeRequest.setConfiguration(configurationCustomizer);\n-        CompletableFuture<Session> futureSession = new CompletableFuture<>();\n \n+        CompletableFuture<Session> futureSession = new CompletableFuture<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY4NDgwNw=="}, "originalCommit": {"oid": "25d7b99ba1c00c75ad10140c0e9ee9c44e257de2"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzczMjQ4OQ==", "bodyText": "@lachlan-roberts good point about the transformation of the exception.\nCode is good as is, returning the CF created on the fly, rather than the one returned by whenComplete().", "url": "https://github.com/eclipse/jetty.project/pull/5031#discussion_r453732489", "createdAt": "2020-07-13T15:25:46Z", "author": {"login": "sbordet"}, "path": "jetty-websocket/websocket-jetty-client/src/main/java/org/eclipse/jetty/websocket/client/WebSocketClient.java", "diffHunk": "@@ -149,9 +149,8 @@ public void onHandshakeResponse(HttpRequest request, HttpResponse response)\n                 }\n             });\n         }\n-        upgradeRequest.setConfiguration(configurationCustomizer);\n-        CompletableFuture<Session> futureSession = new CompletableFuture<>();\n \n+        CompletableFuture<Session> futureSession = new CompletableFuture<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY4NDgwNw=="}, "originalCommit": {"oid": "25d7b99ba1c00c75ad10140c0e9ee9c44e257de2"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyOTUwMDkzOnYy", "diffSide": "RIGHT", "path": "jetty-websocket/websocket-jetty-client/src/main/java/org/eclipse/jetty/websocket/client/impl/JettyClientUpgradeRequest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNDoyNTozM1rOGwq8sA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNDoyNTozM1rOGwq8sA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY4ODQ5Ng==", "bodyText": "Uh, no. It's a mistake that request.getHeaders() returns a HttpFields.Mutable.\nI'll fix jetty-10.0.x so please rebase this PR.\nThis code should be: headers(fields -> request.getHeaders().forEach(fields::put)).", "url": "https://github.com/eclipse/jetty.project/pull/5031#discussion_r453688496", "createdAt": "2020-07-13T14:25:33Z", "author": {"login": "sbordet"}, "path": "jetty-websocket/websocket-jetty-client/src/main/java/org/eclipse/jetty/websocket/client/impl/JettyClientUpgradeRequest.java", "diffHunk": "@@ -53,15 +50,7 @@ public JettyClientUpgradeRequest(WebSocketCoreClient coreClient, UpgradeRequest\n             request.getHeaders().forEach(fields::put);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25d7b99ba1c00c75ad10140c0e9ee9c44e257de2"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyOTUwNDU0OnYy", "diffSide": "RIGHT", "path": "jetty-websocket/websocket-jetty-client/src/main/java/org/eclipse/jetty/websocket/client/impl/JettyClientUpgradeRequest.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNDoyNjoyM1rOGwq--g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNDo1ODoxMFrOGwsaOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY4OTA4Mg==", "bodyText": "No need for the comment.", "url": "https://github.com/eclipse/jetty.project/pull/5031#discussion_r453689082", "createdAt": "2020-07-13T14:26:23Z", "author": {"login": "sbordet"}, "path": "jetty-websocket/websocket-jetty-client/src/main/java/org/eclipse/jetty/websocket/client/impl/JettyClientUpgradeRequest.java", "diffHunk": "@@ -71,13 +60,8 @@ public JettyClientUpgradeRequest(WebSocketCoreClient coreClient, UpgradeRequest\n                 .map(c -> new ExtensionConfig(c.getName(), c.getParameters()))\n                 .collect(Collectors.toList()));\n \n-            // Copy method from upgradeRequest object\n-            if (request.getMethod() != null)\n-                method(request.getMethod());\n-\n-            // Copy version from upgradeRequest object\n-            if (request.getHttpVersion() != null)\n-                version(HttpVersion.fromString(request.getHttpVersion()));\n+            // Copy timeout from upgradeRequest object", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25d7b99ba1c00c75ad10140c0e9ee9c44e257de2"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcxMDE0NQ==", "bodyText": "All the other operations in this block have a similar comment. I was trying to fit in with the current style.\nShould I remove all these comments to make it more compact?", "url": "https://github.com/eclipse/jetty.project/pull/5031#discussion_r453710145", "createdAt": "2020-07-13T14:54:58Z", "author": {"login": "lachlan-roberts"}, "path": "jetty-websocket/websocket-jetty-client/src/main/java/org/eclipse/jetty/websocket/client/impl/JettyClientUpgradeRequest.java", "diffHunk": "@@ -71,13 +60,8 @@ public JettyClientUpgradeRequest(WebSocketCoreClient coreClient, UpgradeRequest\n                 .map(c -> new ExtensionConfig(c.getName(), c.getParameters()))\n                 .collect(Collectors.toList()));\n \n-            // Copy method from upgradeRequest object\n-            if (request.getMethod() != null)\n-                method(request.getMethod());\n-\n-            // Copy version from upgradeRequest object\n-            if (request.getHttpVersion() != null)\n-                version(HttpVersion.fromString(request.getHttpVersion()));\n+            // Copy timeout from upgradeRequest object", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY4OTA4Mg=="}, "originalCommit": {"oid": "25d7b99ba1c00c75ad10140c0e9ee9c44e257de2"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcxMjQ0Mw==", "bodyText": "@lachlan-roberts if the comment just says what the code does, remove it.\nThis one was also rotten, as it was referring to an upgradeRequest object which does not exist in the code.", "url": "https://github.com/eclipse/jetty.project/pull/5031#discussion_r453712443", "createdAt": "2020-07-13T14:58:10Z", "author": {"login": "sbordet"}, "path": "jetty-websocket/websocket-jetty-client/src/main/java/org/eclipse/jetty/websocket/client/impl/JettyClientUpgradeRequest.java", "diffHunk": "@@ -71,13 +60,8 @@ public JettyClientUpgradeRequest(WebSocketCoreClient coreClient, UpgradeRequest\n                 .map(c -> new ExtensionConfig(c.getName(), c.getParameters()))\n                 .collect(Collectors.toList()));\n \n-            // Copy method from upgradeRequest object\n-            if (request.getMethod() != null)\n-                method(request.getMethod());\n-\n-            // Copy version from upgradeRequest object\n-            if (request.getHttpVersion() != null)\n-                version(HttpVersion.fromString(request.getHttpVersion()));\n+            // Copy timeout from upgradeRequest object", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY4OTA4Mg=="}, "originalCommit": {"oid": "25d7b99ba1c00c75ad10140c0e9ee9c44e257de2"}, "originalPosition": 63}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2417, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}