{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3MTY3MjUx", "number": 4935, "title": "#4877 fix PathSpec long-standing bugs and shortcomings", "bodyText": "A test failure in 10.0.x uncovered some long-standing bugs and hairy problems.\n\nPathMappings.remove() lacked a if-null check that made it throw when a UriTemplatePathSpec with a group of type EXACT, PREFIX_GLOB or SUFFIX_GLOB was removed.\nThe Comparable.compareTo() and Object.equals() could disagree when their declaration was the same but not their group or specLength.\n\nI've added to the javadoc of PathSpec that equals and hashcode have to be implemented and overridden equals() in each of the PathSpec implementations by basically doing a return compareTo(other) == 0 which makes equals() and compareTo() at peace.\nI believe I didn't break the existing behavior in any way by doing so but I'd appreciate some reviews, especially from @joakime as he changed the UriTemplatePathSpec.compareTo() implementation.", "createdAt": "2020-06-03T12:23:31Z", "url": "https://github.com/eclipse/jetty.project/pull/4935", "merged": true, "mergeCommit": {"oid": "2834f934479028caac9d7295c00026d0298719b3"}, "closed": true, "closedAt": "2020-06-03T16:46:39Z", "author": {"login": "lorban"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnomJiABqjM0MDE5MTM0NTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnsTnxgFqTQyMzc0NDI4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "62e8d0602cd3d4f85262a8b4bce316fd5b89911e", "author": {"user": {"login": "lorban", "name": "Ludovic Orban"}}, "url": "https://github.com/eclipse/jetty.project/commit/62e8d0602cd3d4f85262a8b4bce316fd5b89911e", "committedDate": "2020-06-03T12:21:53Z", "message": " #4877 fix PathSpec long-standing bugs and shortcomings\n\nSigned-off-by: Ludovic Orban <lorban@bitronix.be>"}, "afterCommit": {"oid": "a0179dfd57f204c27639958e60b07e1ba788e727", "author": {"user": {"login": "lorban", "name": "Ludovic Orban"}}, "url": "https://github.com/eclipse/jetty.project/commit/a0179dfd57f204c27639958e60b07e1ba788e727", "committedDate": "2020-06-03T12:26:35Z", "message": "#4877 fix PathSpec long-standing bugs and shortcomings\n\nSigned-off-by: Ludovic Orban <lorban@bitronix.be>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzNTA3MDIx", "url": "https://github.com/eclipse/jetty.project/pull/4935#pullrequestreview-423507021", "createdAt": "2020-06-03T12:36:13Z", "commit": {"oid": "a0179dfd57f204c27639958e60b07e1ba788e727"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxMjozNjoxM1rOGeZy2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxMjozNjoxM1rOGeZy2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDUzMzA4MQ==", "bodyText": "This code is duplicated 3 times, why don't we have a simple base class like AbstractPathSpec, which could implement this and also maybe compareTo and toString, and then we could reduce the code duplication.\nI made some similar changes like this in my branch at jetty-9.4.x-4877-PathSpecEquals if you want to take a look\n\n  \n    \n      jetty.project/jetty-http/src/main/java/org/eclipse/jetty/http/pathmap/AbstractPathSpec.java\n    \n    \n        Lines 23 to 60\n      in\n      c6a4078\n    \n    \n    \n    \n\n        \n          \n           public abstract class AbstractPathSpec implements PathSpec \n        \n\n        \n          \n           { \n        \n\n        \n          \n               @Override \n        \n\n        \n          \n               public int compareTo(PathSpec other) \n        \n\n        \n          \n               { \n        \n\n        \n          \n                   // Grouping (increasing) \n        \n\n        \n          \n                   int diff = getGroup().ordinal() - other.getGroup().ordinal(); \n        \n\n        \n          \n                   if (diff != 0) \n        \n\n        \n          \n                       return diff; \n        \n\n        \n          \n            \n        \n\n        \n          \n                   // Spec Length (decreasing) \n        \n\n        \n          \n                   diff = other.getSpecLength() - getSpecLength(); \n        \n\n        \n          \n                   if (diff != 0) \n        \n\n        \n          \n                       return diff; \n        \n\n        \n          \n            \n        \n\n        \n          \n                   // Path Spec Name (alphabetical) \n        \n\n        \n          \n                   return getDeclaration().compareTo(other.getDeclaration()); \n        \n\n        \n          \n               } \n        \n\n        \n          \n            \n        \n\n        \n          \n               @Override \n        \n\n        \n          \n               public boolean equals(Object obj) \n        \n\n        \n          \n               { \n        \n\n        \n          \n                   if (this == obj) \n        \n\n        \n          \n                       return true; \n        \n\n        \n          \n                   if (obj == null) \n        \n\n        \n          \n                       return false; \n        \n\n        \n          \n                   if (getClass() != obj.getClass()) \n        \n\n        \n          \n                       return false; \n        \n\n        \n          \n            \n        \n\n        \n          \n                   return Objects.equals(getDeclaration(), ((PathSpec)obj).getDeclaration()); \n        \n\n        \n          \n               } \n        \n\n        \n          \n            \n        \n\n        \n          \n               @Override \n        \n\n        \n          \n               public String toString() \n        \n\n        \n          \n               { \n        \n\n        \n          \n                   return String.format(\"%s@%s{%s}\", getClass().getSimpleName(), Integer.toHexString(hashCode()), getDeclaration()); \n        \n\n        \n          \n               } \n        \n\n        \n          \n           }", "url": "https://github.com/eclipse/jetty.project/pull/4935#discussion_r434533081", "createdAt": "2020-06-03T12:36:13Z", "author": {"login": "lachlan-roberts"}, "path": "jetty-http/src/main/java/org/eclipse/jetty/http/pathmap/RegexPathSpec.java", "diffHunk": "@@ -193,4 +194,21 @@ public boolean matches(final String path)\n             return getMatcher(path).matches();\n         }\n     }\n+\n+    @Override\n+    public boolean equals(Object o)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a0179dfd57f204c27639958e60b07e1ba788e727"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzNTMzNTU2", "url": "https://github.com/eclipse/jetty.project/pull/4935#pullrequestreview-423533556", "createdAt": "2020-06-03T13:08:49Z", "commit": {"oid": "62eadb4a5dbb4c189b056bf8a38d4ffa1970c680"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "62eadb4a5dbb4c189b056bf8a38d4ffa1970c680", "author": {"user": {"login": "lorban", "name": "Ludovic Orban"}}, "url": "https://github.com/eclipse/jetty.project/commit/62eadb4a5dbb4c189b056bf8a38d4ffa1970c680", "committedDate": "2020-06-03T12:52:00Z", "message": "#4877 move common code into abstract superclass which enforces that equals and compareTo do agree\n\nSigned-off-by: Ludovic Orban <lorban@bitronix.be>"}, "afterCommit": {"oid": "43cd401ba2b35f9bfd83461188b6dfc2b3a4d994", "author": {"user": {"login": "lorban", "name": "Ludovic Orban"}}, "url": "https://github.com/eclipse/jetty.project/commit/43cd401ba2b35f9bfd83461188b6dfc2b3a4d994", "committedDate": "2020-06-03T13:46:11Z", "message": "Signed-off-by: Ludovic Orban <lorban@bitronix.be>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c62157865f124c83c5b8e7278af8acf140883f2", "author": {"user": {"login": "lorban", "name": "Ludovic Orban"}}, "url": "https://github.com/eclipse/jetty.project/commit/6c62157865f124c83c5b8e7278af8acf140883f2", "committedDate": "2020-06-03T14:30:26Z", "message": "Signed-off-by: Ludovic Orban <lorban@bitronix.be>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "43cd401ba2b35f9bfd83461188b6dfc2b3a4d994", "author": {"user": {"login": "lorban", "name": "Ludovic Orban"}}, "url": "https://github.com/eclipse/jetty.project/commit/43cd401ba2b35f9bfd83461188b6dfc2b3a4d994", "committedDate": "2020-06-03T13:46:11Z", "message": "Signed-off-by: Ludovic Orban <lorban@bitronix.be>"}, "afterCommit": {"oid": "7d7f56ab7991c788c08bedf6e487ac6485436b3e", "author": {"user": {"login": "lorban", "name": "Ludovic Orban"}}, "url": "https://github.com/eclipse/jetty.project/commit/7d7f56ab7991c788c08bedf6e487ac6485436b3e", "committedDate": "2020-06-03T14:30:26Z", "message": "Signed-off-by: Ludovic Orban <lorban@bitronix.be>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e43c98f08d8f711a0f24b8c022133fb0a205c4d4", "author": {"user": {"login": "lorban", "name": "Ludovic Orban"}}, "url": "https://github.com/eclipse/jetty.project/commit/e43c98f08d8f711a0f24b8c022133fb0a205c4d4", "committedDate": "2020-06-03T15:58:01Z", "message": "Signed-off-by: Ludovic Orban <lorban@bitronix.be>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7d7f56ab7991c788c08bedf6e487ac6485436b3e", "author": {"user": {"login": "lorban", "name": "Ludovic Orban"}}, "url": "https://github.com/eclipse/jetty.project/commit/7d7f56ab7991c788c08bedf6e487ac6485436b3e", "committedDate": "2020-06-03T14:30:26Z", "message": "Signed-off-by: Ludovic Orban <lorban@bitronix.be>"}, "afterCommit": {"oid": "e43c98f08d8f711a0f24b8c022133fb0a205c4d4", "author": {"user": {"login": "lorban", "name": "Ludovic Orban"}}, "url": "https://github.com/eclipse/jetty.project/commit/e43c98f08d8f711a0f24b8c022133fb0a205c4d4", "committedDate": "2020-06-03T15:58:01Z", "message": "Signed-off-by: Ludovic Orban <lorban@bitronix.be>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzNzQ0Mjg5", "url": "https://github.com/eclipse/jetty.project/pull/4935#pullrequestreview-423744289", "createdAt": "2020-06-03T16:46:23Z", "commit": {"oid": "e43c98f08d8f711a0f24b8c022133fb0a205c4d4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 434, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}