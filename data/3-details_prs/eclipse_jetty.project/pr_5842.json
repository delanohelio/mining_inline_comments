{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ0OTUzOTEy", "number": 5842, "title": "Issue #5824 Durable ConstraintMappings.", "bodyText": "closes #5824\nEnsure that ConstraintMappings that are added to the ConstraintSecurityHandler before the context starts are retained across restarts, but those that are added after the context is starting (eg via annotations, web.xml/web-fragment.xml, javax.security api) are not.", "createdAt": "2020-12-23T17:35:21Z", "url": "https://github.com/eclipse/jetty.project/pull/5842", "merged": true, "mergeCommit": {"oid": "26ef233e94889e29b2b1f1aab307c41f7f61bae6"}, "closed": true, "closedAt": "2021-01-11T09:30:23Z", "author": {"login": "janbartel"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdpCpKXAH2gAyNTQ0OTUzOTEyOjc5NTVlYmNiM2RlNWNhYTZkMzM1MWI1MjRjYjMyODc0M2VhM2JjNmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdvCkc3AFqTU2NTE1NDk0NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7955ebcb3de5caa6d3351b524cb328743ea3bc6c", "author": {"user": {"login": "janbartel", "name": "Jan Bartel"}}, "url": "https://github.com/eclipse/jetty.project/commit/7955ebcb3de5caa6d3351b524cb328743ea3bc6c", "committedDate": "2020-12-23T17:32:54Z", "message": "Issue #5824 Durable ConstraintMappings.\n\nSigned-off-by: Jan Bartel <janb@webtide.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d328ce78bad6f3e353ef5398b7acac6ad810d72", "author": {"user": {"login": "janbartel", "name": "Jan Bartel"}}, "url": "https://github.com/eclipse/jetty.project/commit/9d328ce78bad6f3e353ef5398b7acac6ad810d72", "committedDate": "2020-12-23T20:56:43Z", "message": "Issue #5824 Fix ConstraintTest\n\nSigned-off-by: Jan Bartel <janb@webtide.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39d7083b47052ab7cbaf671fe822b58b8a773018", "author": {"user": {"login": "janbartel", "name": "Jan Bartel"}}, "url": "https://github.com/eclipse/jetty.project/commit/39d7083b47052ab7cbaf671fe822b58b8a773018", "committedDate": "2020-12-24T14:27:39Z", "message": "Issue #5824 Return only durable mappings before ConstraintSecurityHandler start\n\nSigned-off-by: Jan Bartel <janb@webtide.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5OTkyMjgz", "url": "https://github.com/eclipse/jetty.project/pull/5842#pullrequestreview-559992283", "createdAt": "2020-12-30T10:31:01Z", "commit": {"oid": "39d7083b47052ab7cbaf671fe822b58b8a773018"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxMDozMTowMVrOIMo3TQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxMDozNDo1NVrOIMpCEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDEyMzM0MQ==", "bodyText": "Is this necessary?  The _durableConstraintMappings is a subset of _constraintMappings, so isn't it always OK to return _constraintMappings?", "url": "https://github.com/eclipse/jetty.project/pull/5842#discussion_r550123341", "createdAt": "2020-12-30T10:31:01Z", "author": {"login": "gregw"}, "path": "jetty-security/src/main/java/org/eclipse/jetty/security/ConstraintSecurityHandler.java", "diffHunk": "@@ -260,12 +262,19 @@ public static Constraint createConstraint(String name, String[] rolesAllowed, Em\n     }\n \n     /**\n-     * @return Returns the constraintMappings.\n+     * @return only the durable mappings if we are not yet started, otherwise\n+     * return both the durables and transients.\n      */\n     @Override\n     public List<ConstraintMapping> getConstraintMappings()\n     {\n-        return _constraintMappings;\n+        //if we've started, then we've processed both the durable and\n+        //transient constraint mappings\n+        if (isRunning())\n+            return _constraintMappings;\n+        else\n+            //otherwise, we only have durables\n+            return _durableConstraintMappings;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39d7083b47052ab7cbaf671fe822b58b8a773018"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDEyNjA5OA==", "bodyText": "Oh I see.... will comment more in request for change....", "url": "https://github.com/eclipse/jetty.project/pull/5842#discussion_r550126098", "createdAt": "2020-12-30T10:34:55Z", "author": {"login": "gregw"}, "path": "jetty-security/src/main/java/org/eclipse/jetty/security/ConstraintSecurityHandler.java", "diffHunk": "@@ -260,12 +262,19 @@ public static Constraint createConstraint(String name, String[] rolesAllowed, Em\n     }\n \n     /**\n-     * @return Returns the constraintMappings.\n+     * @return only the durable mappings if we are not yet started, otherwise\n+     * return both the durables and transients.\n      */\n     @Override\n     public List<ConstraintMapping> getConstraintMappings()\n     {\n-        return _constraintMappings;\n+        //if we've started, then we've processed both the durable and\n+        //transient constraint mappings\n+        if (isRunning())\n+            return _constraintMappings;\n+        else\n+            //otherwise, we only have durables\n+            return _durableConstraintMappings;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDEyMzM0MQ=="}, "originalCommit": {"oid": "39d7083b47052ab7cbaf671fe822b58b8a773018"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60b350876c398bff3cac9b28c3a3cfac0e2ea762", "author": {"user": {"login": "janbartel", "name": "Jan Bartel"}}, "url": "https://github.com/eclipse/jetty.project/commit/60b350876c398bff3cac9b28c3a3cfac0e2ea762", "committedDate": "2020-12-30T10:51:03Z", "message": "Issue #5824 Change after review\n\nSigned-off-by: Jan Bartel <janb@webtide.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwMDY2OTQ5", "url": "https://github.com/eclipse/jetty.project/pull/5842#pullrequestreview-560066949", "createdAt": "2020-12-30T14:22:06Z", "commit": {"oid": "60b350876c398bff3cac9b28c3a3cfac0e2ea762"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65e53aa0b196364321816c41cd9431070c65b4e2", "author": {"user": {"login": "janbartel", "name": "Jan Bartel"}}, "url": "https://github.com/eclipse/jetty.project/commit/65e53aa0b196364321816c41cd9431070c65b4e2", "committedDate": "2020-12-30T16:42:06Z", "message": "Issue #5824 Changes after review\n\nSigned-off-by: Jan Bartel <janb@webtide.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY1MTU0OTQ0", "url": "https://github.com/eclipse/jetty.project/pull/5842#pullrequestreview-565154944", "createdAt": "2021-01-11T08:51:18Z", "commit": {"oid": "65e53aa0b196364321816c41cd9431070c65b4e2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4958, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}