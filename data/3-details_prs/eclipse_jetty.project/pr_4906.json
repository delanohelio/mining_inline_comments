{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyNTM0MTky", "number": 4906, "title": "Issue #4903 - give better errors for non public javax.websocket endpoints ", "bodyText": "closes #4903", "createdAt": "2020-05-25T04:09:53Z", "url": "https://github.com/eclipse/jetty.project/pull/4906", "merged": true, "mergeCommit": {"oid": "0b8306976a3da1010a9d4d7aa01243d187c6886e"}, "closed": true, "closedAt": "2020-05-26T23:43:24Z", "author": {"login": "lachlan-roberts"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABckmv-agH2gAyNDIyNTM0MTkyOjI4YTU4OGI4YmQ3YzA4NDk5YzlhNjk1ZTgyMmI5NjE5MTlhYjQ0M2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABclNd7SAH2gAyNDIyNTM0MTkyOmExMWM3ZjU1NGM1MGRjMjZkMjliNGIxZDY5ZWU1YWFiZGVkODA5NjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "28a588b8bd7c08499c9a695e822b961919ab443a", "author": {"user": {"login": "lachlan-roberts", "name": "Lachlan"}}, "url": "https://github.com/eclipse/jetty.project/commit/28a588b8bd7c08499c9a695e822b961919ab443a", "committedDate": "2020-05-25T02:36:09Z", "message": "Issue #4903 - Better errors for non public endpoints\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "add00c9dd8750c4e97508ac0ab6fbe84f9d0b82a", "author": {"user": {"login": "lachlan-roberts", "name": "Lachlan"}}, "url": "https://github.com/eclipse/jetty.project/commit/add00c9dd8750c4e97508ac0ab6fbe84f9d0b82a", "committedDate": "2020-05-25T03:57:41Z", "message": "Issue #4903 - check endpoint class is default constructable\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3NzE5MTI3", "url": "https://github.com/eclipse/jetty.project/pull/4906#pullrequestreview-417719127", "createdAt": "2020-05-25T13:42:07Z", "commit": {"oid": "add00c9dd8750c4e97508ac0ab6fbe84f9d0b82a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMzo0MjowN1rOGaBjig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMzo0MjowN1rOGaBjig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk0MTY0Mg==", "bodyText": "Please use the long form exception message from before here. (see lines 214 to 219 on old code)", "url": "https://github.com/eclipse/jetty.project/pull/4906#discussion_r429941642", "createdAt": "2020-05-25T13:42:07Z", "author": {"login": "joakime"}, "path": "jetty-websocket/javax-websocket-server-impl/src/main/java/org/eclipse/jetty/websocket/jsr356/server/ServerContainer.java", "diffHunk": "@@ -191,35 +195,36 @@ protected void doStart() throws Exception\n \n     public ServerEndpointMetadata getServerEndpointMetadata(final Class<?> endpoint, final ServerEndpointConfig config) throws DeploymentException\n     {\n-        ServerEndpointMetadata metadata = null;\n-\n-        ServerEndpoint anno = endpoint.getAnnotation(ServerEndpoint.class);\n-        if (anno != null)\n-        {\n-            // Annotated takes precedence here\n-            AnnotatedServerEndpointMetadata ametadata = new AnnotatedServerEndpointMetadata(this, endpoint, config);\n-            AnnotatedEndpointScanner<ServerEndpoint, ServerEndpointConfig> scanner = new AnnotatedEndpointScanner<>(ametadata);\n-            metadata = ametadata;\n-            scanner.scan();\n-        }\n-        else if (Endpoint.class.isAssignableFrom(endpoint))\n+        try\n         {\n-            // extends Endpoint\n-            @SuppressWarnings(\"unchecked\")\n-            Class<? extends Endpoint> eendpoint = (Class<? extends Endpoint>)endpoint;\n-            metadata = new SimpleServerEndpointMetadata(eendpoint, config);\n+            ServerEndpointMetadata metadata;\n+            ServerEndpoint anno = endpoint.getAnnotation(ServerEndpoint.class);\n+            if (anno != null)\n+            {\n+                // Annotated takes precedence here\n+                AnnotatedServerEndpointMetadata ametadata = new AnnotatedServerEndpointMetadata(this, endpoint, config);\n+                AnnotatedEndpointScanner<ServerEndpoint, ServerEndpointConfig> scanner = new AnnotatedEndpointScanner<>(ametadata);\n+                metadata = ametadata;\n+                scanner.scan();\n+            }\n+            else if (Endpoint.class.isAssignableFrom(endpoint))\n+            {\n+                // extends Endpoint\n+                @SuppressWarnings(\"unchecked\")\n+                Class<? extends Endpoint> eendpoint = (Class<? extends Endpoint>)endpoint;\n+                metadata = new SimpleServerEndpointMetadata(eendpoint, config);\n+            }\n+            else\n+            {\n+                throw new DeploymentException(\"Unable to identify as valid Endpoint: \" + endpoint);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "add00c9dd8750c4e97508ac0ab6fbe84f9d0b82a"}, "originalPosition": 59}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "470d948504daef688da39a8038a5ee8da6ff43e4", "author": {"user": {"login": "lachlan-roberts", "name": "Lachlan"}}, "url": "https://github.com/eclipse/jetty.project/commit/470d948504daef688da39a8038a5ee8da6ff43e4", "committedDate": "2020-05-25T23:35:17Z", "message": "Issue #4903 - changes from review\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c41560c7cd30f9ce5e79fd307763b1e6f9072817", "author": {"user": {"login": "lachlan-roberts", "name": "Lachlan"}}, "url": "https://github.com/eclipse/jetty.project/commit/c41560c7cd30f9ce5e79fd307763b1e6f9072817", "committedDate": "2020-05-26T05:35:39Z", "message": "Issue #4903 - add cause to Exception when creating endpoint instance\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4MDM3MjA3", "url": "https://github.com/eclipse/jetty.project/pull/4906#pullrequestreview-418037207", "createdAt": "2020-05-26T07:30:31Z", "commit": {"oid": "c41560c7cd30f9ce5e79fd307763b1e6f9072817"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwNzozMDozMVrOGaR63g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwNzozMDozMVrOGaR63g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDIwOTc1OA==", "bodyText": "Should not you catch Throwable here, to cover cases such as NoClassDefFoundError, etc.?", "url": "https://github.com/eclipse/jetty.project/pull/4906#discussion_r430209758", "createdAt": "2020-05-26T07:30:31Z", "author": {"login": "sbordet"}, "path": "jetty-websocket/javax-websocket-server-impl/src/main/java/org/eclipse/jetty/websocket/jsr356/server/ServerContainer.java", "diffHunk": "@@ -191,35 +195,39 @@ protected void doStart() throws Exception\n \n     public ServerEndpointMetadata getServerEndpointMetadata(final Class<?> endpoint, final ServerEndpointConfig config) throws DeploymentException\n     {\n-        ServerEndpointMetadata metadata = null;\n-\n-        ServerEndpoint anno = endpoint.getAnnotation(ServerEndpoint.class);\n-        if (anno != null)\n-        {\n-            // Annotated takes precedence here\n-            AnnotatedServerEndpointMetadata ametadata = new AnnotatedServerEndpointMetadata(this, endpoint, config);\n-            AnnotatedEndpointScanner<ServerEndpoint, ServerEndpointConfig> scanner = new AnnotatedEndpointScanner<>(ametadata);\n-            metadata = ametadata;\n-            scanner.scan();\n-        }\n-        else if (Endpoint.class.isAssignableFrom(endpoint))\n+        try\n         {\n-            // extends Endpoint\n-            @SuppressWarnings(\"unchecked\")\n-            Class<? extends Endpoint> eendpoint = (Class<? extends Endpoint>)endpoint;\n-            metadata = new SimpleServerEndpointMetadata(eendpoint, config);\n+            ServerEndpointMetadata metadata;\n+            ServerEndpoint anno = endpoint.getAnnotation(ServerEndpoint.class);\n+            if (anno != null)\n+            {\n+                // Annotated takes precedence here\n+                AnnotatedServerEndpointMetadata ametadata = new AnnotatedServerEndpointMetadata(this, endpoint, config);\n+                AnnotatedEndpointScanner<ServerEndpoint, ServerEndpointConfig> scanner = new AnnotatedEndpointScanner<>(ametadata);\n+                metadata = ametadata;\n+                scanner.scan();\n+            }\n+            else if (Endpoint.class.isAssignableFrom(endpoint))\n+            {\n+                // extends Endpoint\n+                @SuppressWarnings(\"unchecked\")\n+                Class<? extends Endpoint> eendpoint = (Class<? extends Endpoint>)endpoint;\n+                metadata = new SimpleServerEndpointMetadata(eendpoint, config);\n+            }\n+            else\n+            {\n+                String err = \"Not a recognized websocket [\" + endpoint.getName() +\n+                    \"] does not extend @\" + ServerEndpoint.class.getName() +\n+                    \" or extend from \" + Endpoint.class.getName();\n+                throw new DeploymentException(err);\n+            }\n+\n+            return metadata;\n         }\n-        else\n+        catch (RuntimeException e)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c41560c7cd30f9ce5e79fd307763b1e6f9072817"}, "originalPosition": 86}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c63b0ef7810634378a977fb9d198558da07d657", "author": {"user": {"login": "lachlan-roberts", "name": "Lachlan"}}, "url": "https://github.com/eclipse/jetty.project/commit/5c63b0ef7810634378a977fb9d198558da07d657", "committedDate": "2020-05-26T07:37:04Z", "message": "Issue #4903 - catch Throwable instead of RuntimeException\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4MzA5NzI3", "url": "https://github.com/eclipse/jetty.project/pull/4906#pullrequestreview-418309727", "createdAt": "2020-05-26T13:42:30Z", "commit": {"oid": "5c63b0ef7810634378a977fb9d198558da07d657"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxMzo0MjozMFrOGae1ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxMzo0MjozMFrOGae1ew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyMTM3MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    catch (Throwable t)\n          \n          \n            \n                    catch (DeploymentException e)\n          \n          \n            \n                    {\n          \n          \n            \n                        throw e;\n          \n          \n            \n                    }\n          \n          \n            \n                    catch (Throwable t)\n          \n          \n            \n                    {\n          \n          \n            \n                        throw new DeploymentException(t.getMessage(), t);\n          \n          \n            \n                    }", "url": "https://github.com/eclipse/jetty.project/pull/4906#discussion_r430421371", "createdAt": "2020-05-26T13:42:30Z", "author": {"login": "joakime"}, "path": "jetty-websocket/javax-websocket-server-impl/src/main/java/org/eclipse/jetty/websocket/jsr356/server/ServerContainer.java", "diffHunk": "@@ -224,9 +224,11 @@ else if (Endpoint.class.isAssignableFrom(endpoint))\n \n             return metadata;\n         }\n-        catch (RuntimeException e)\n+        catch (Throwable t)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c63b0ef7810634378a977fb9d198558da07d657"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a11c7f554c50dc26d29b4b1d69ee5aabded80960", "author": {"user": {"login": "lachlan-roberts", "name": "Lachlan"}}, "url": "https://github.com/eclipse/jetty.project/commit/a11c7f554c50dc26d29b4b1d69ee5aabded80960", "committedDate": "2020-05-26T23:42:44Z", "message": "Issue #4903 - cleanup catch statement from review\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 413, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}