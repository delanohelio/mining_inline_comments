{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4MDI3MDIz", "number": 5042, "reviewThreads": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNjo1NDowMVrOEN54xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwODowNzozMVrOEOkwIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzMDE1MzY2OnYy", "diffSide": "RIGHT", "path": "jetty-server/src/main/config/etc/jetty-ssl-reload.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNjo1NDowMVrOGwxOaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNjo1NDowMVrOGwxOaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc5MTMzOQ==", "bodyText": "Remove empty line!", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r453791339", "createdAt": "2020-07-13T16:54:01Z", "author": {"login": "sbordet"}, "path": "jetty-server/src/main/config/etc/jetty-ssl-reload.xml", "diffHunk": "@@ -0,0 +1,13 @@\n+<?xml version=\"1.0\"?><!DOCTYPE Configure PUBLIC \"-//Jetty//Configure//EN\" \"http://www.eclipse.org/jetty/configure_9_3.dtd\">\n+\n+<Configure id=\"Server\" class=\"org.eclipse.jetty.server.Server\">\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b03643961d9d7be6ed566c42aadb9bd6428a3cfa"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzMDE1NDI0OnYy", "diffSide": "RIGHT", "path": "jetty-server/src/main/config/modules/ssl-reload.mod", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNjo1NDoxMVrOGwxOyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxMTo1NjozNFrOGxQa9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc5MTQzMg==", "bodyText": "This is a comment.\nAdd # to the start please.", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r453791432", "createdAt": "2020-07-13T16:54:11Z", "author": {"login": "joakime"}, "path": "jetty-server/src/main/config/modules/ssl-reload.mod", "diffHunk": "@@ -0,0 +1,21 @@\n+DO NOT EDIT - See: https://www.eclipse.org/jetty/documentation/current/startup-modules.html", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b03643961d9d7be6ed566c42aadb9bd6428a3cfa"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDEyMzE4OA==", "bodyText": "None of the other module files have this as a comment? I don't think this is supposed to have a #.", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r454123188", "createdAt": "2020-07-14T06:07:46Z", "author": {"login": "lachlan-roberts"}, "path": "jetty-server/src/main/config/modules/ssl-reload.mod", "diffHunk": "@@ -0,0 +1,21 @@\n+DO NOT EDIT - See: https://www.eclipse.org/jetty/documentation/current/startup-modules.html", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc5MTQzMg=="}, "originalCommit": {"oid": "b03643961d9d7be6ed566c42aadb9bd6428a3cfa"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDMwMjQ1Mw==", "bodyText": "The other modules are in the wrong.\nPut this on your other PR for cleanup.\n$ git grep \"# DO NOT EDIT\"\njetty-cdi/src/main/config/modules/cdi-decorate.mod:# DO NOT EDIT - See: https://www.eclipse.org/jetty/documentation/current/startup-modules.html\njetty-cdi/src/main/config/modules/cdi-spi.mod:# DO NOT EDIT - See: https://www.eclipse.org/jetty/documentation/current/startup-modules.html\njetty-cdi/src/main/config/modules/cdi.mod:# DO NOT EDIT - See: https://www.eclipse.org/jetty/documentation/current/startup-modules.html\njetty-cdi/src/main/config/modules/cdi2.mod:# DO NOT EDIT - See: https://www.eclipse.org/jetty/documentation/current/startup-modules.html\njetty-deploy/src/main/config/modules/decorate.mod:# DO NOT EDIT - See: https://www.eclipse.org/jetty/documentation/current/startup-modules.html\njetty-home/src/main/resources/modules/setuid.mod:# DO NOT EDIT - See: https://www.eclipse.org/jetty/documentation/current/startup-modules.html\njetty-server/src/main/config/modules/https.mod:# DO NOT EDIT - See: https://www.eclipse.org/jetty/documentation/current/startup-modules.html", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r454302453", "createdAt": "2020-07-14T11:56:34Z", "author": {"login": "joakime"}, "path": "jetty-server/src/main/config/modules/ssl-reload.mod", "diffHunk": "@@ -0,0 +1,21 @@\n+DO NOT EDIT - See: https://www.eclipse.org/jetty/documentation/current/startup-modules.html", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc5MTQzMg=="}, "originalCommit": {"oid": "b03643961d9d7be6ed566c42aadb9bd6428a3cfa"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzMDE1NTYxOnYy", "diffSide": "RIGHT", "path": "jetty-server/src/main/config/modules/ssl-reload.mod", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNjo1NDozMlrOGwxPng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNjo1NDozMlrOGwxPng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc5MTY0Ng==", "bodyText": "I don't think there is this jar anymore?", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r453791646", "createdAt": "2020-07-13T16:54:32Z", "author": {"login": "sbordet"}, "path": "jetty-server/src/main/config/modules/ssl-reload.mod", "diffHunk": "@@ -0,0 +1,21 @@\n+DO NOT EDIT - See: https://www.eclipse.org/jetty/documentation/current/startup-modules.html\n+\n+[description]\n+Enables the SSL keystore to be reloaded after any changes are detected on the file system.\n+\n+[tags]\n+connector\n+ssl\n+\n+[depend]\n+ssl\n+\n+[lib]\n+lib/jetty-ssl-reload-${jetty.version}.jar", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b03643961d9d7be6ed566c42aadb9bd6428a3cfa"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzMDE1NjA0OnYy", "diffSide": "RIGHT", "path": "jetty-util/src/main/java/org/eclipse/jetty/util/ssl/SslKeyStoreScanner.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNjo1NDo0MFrOGwxP7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNjo1NDo0MFrOGwxP7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc5MTcyNA==", "bodyText": "Feel free to remove this, you have a testcase for it.\nThis works as-is, and makes sense.", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r453791724", "createdAt": "2020-07-13T16:54:40Z", "author": {"login": "joakime"}, "path": "jetty-util/src/main/java/org/eclipse/jetty/util/ssl/SslKeyStoreScanner.java", "diffHunk": "@@ -0,0 +1,145 @@\n+//\n+//  ========================================================================\n+//  Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//  ------------------------------------------------------------------------\n+//  All rights reserved. This program and the accompanying materials\n+//  are made available under the terms of the Eclipse Public License v1.0\n+//  and Apache License v2.0 which accompanies this distribution.\n+//\n+//      The Eclipse Public License is available at\n+//      http://www.eclipse.org/legal/epl-v10.html\n+//\n+//      The Apache License v2.0 is available at\n+//      http://www.opensource.org/licenses/apache2.0.php\n+//\n+//  You may elect to redistribute this code under either of these licenses.\n+//  ========================================================================\n+//\n+\n+package org.eclipse.jetty.util.ssl;\n+\n+import java.io.File;\n+import java.net.URI;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jetty.util.Scanner;\n+import org.eclipse.jetty.util.annotation.ManagedAttribute;\n+import org.eclipse.jetty.util.annotation.ManagedOperation;\n+import org.eclipse.jetty.util.component.AbstractLifeCycle;\n+import org.eclipse.jetty.util.log.Log;\n+import org.eclipse.jetty.util.log.Logger;\n+\n+public class SslKeyStoreScanner extends AbstractLifeCycle implements Scanner.DiscreteListener\n+{\n+    private static final Logger LOG = Log.getLogger(SslKeyStoreScanner.class);\n+\n+    private final SslContextFactory sslContextFactory;\n+    private final File keystoreFile;\n+    private final List<File> files = new ArrayList<>();\n+    private Scanner _scanner;\n+    private int _scanInterval = 1;\n+\n+    public SslKeyStoreScanner(SslContextFactory sslContextFactory)\n+    {\n+        this.sslContextFactory = sslContextFactory;\n+        this.keystoreFile = new File(URI.create(sslContextFactory.getKeyStorePath())); // getKeyStorePath is giving url instead of path?\n+        if (!keystoreFile.exists())\n+            throw new IllegalArgumentException(\"keystore file does not exist\");\n+        if (keystoreFile.isDirectory())\n+            throw new IllegalArgumentException(\"expected keystore file not directory\");\n+\n+        File parentFile = keystoreFile.getParentFile();\n+        if (!parentFile.exists() || !parentFile.isDirectory())\n+            throw new IllegalArgumentException(\"error obtaining keystore dir\");\n+\n+        files.add(parentFile);\n+        if (LOG.isDebugEnabled())\n+            LOG.debug(\"created {}\", this);\n+    }\n+\n+    @Override\n+    protected void doStart() throws Exception\n+    {\n+        if (LOG.isDebugEnabled())\n+            LOG.debug(this.getClass().getSimpleName() + \".doStart()\");\n+\n+        _scanner = new Scanner();\n+        _scanner.setScanDirs(files);\n+        _scanner.setScanInterval(_scanInterval);\n+        _scanner.setReportDirs(false);\n+        _scanner.setReportExistingFilesOnStartup(false);\n+        _scanner.setScanDepth(1);\n+        _scanner.addListener(this);\n+        _scanner.start();\n+    }\n+\n+    @Override\n+    protected void doStop() throws Exception\n+    {\n+        if (_scanner != null)\n+        {\n+            _scanner.stop();\n+            _scanner.removeListener(this);\n+            _scanner = null;\n+        }\n+    }\n+\n+    @Override\n+    public void fileAdded(String filename) throws Exception\n+    {\n+        if (LOG.isDebugEnabled())\n+            LOG.debug(\"added {}\", filename);\n+\n+        if (keystoreFile.toPath().toString().equals(filename))\n+            reload();\n+    }\n+\n+    @Override\n+    public void fileChanged(String filename) throws Exception\n+    {\n+        if (LOG.isDebugEnabled())\n+            LOG.debug(\"changed {}\", filename);\n+\n+        if (keystoreFile.toPath().toString().equals(filename))\n+            reload();\n+    }\n+\n+    @Override\n+    public void fileRemoved(String filename) throws Exception\n+    {\n+        if (LOG.isDebugEnabled())\n+            LOG.debug(\"removed {}\", filename);\n+\n+        // TODO: do we want to do this?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b03643961d9d7be6ed566c42aadb9bd6428a3cfa"}, "originalPosition": 114}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzMDE1Njk3OnYy", "diffSide": "RIGHT", "path": "jetty-util/src/main/java/org/eclipse/jetty/util/ssl/SslKeyStoreScanner.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNjo1NDo1OFrOGwxQjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNjo1NDo1OFrOGwxQjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc5MTg4Nw==", "bodyText": "Perhaps call it KeyStoreScanner ?", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r453791887", "createdAt": "2020-07-13T16:54:58Z", "author": {"login": "joakime"}, "path": "jetty-util/src/main/java/org/eclipse/jetty/util/ssl/SslKeyStoreScanner.java", "diffHunk": "@@ -0,0 +1,145 @@\n+//\n+//  ========================================================================\n+//  Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//  ------------------------------------------------------------------------\n+//  All rights reserved. This program and the accompanying materials\n+//  are made available under the terms of the Eclipse Public License v1.0\n+//  and Apache License v2.0 which accompanies this distribution.\n+//\n+//      The Eclipse Public License is available at\n+//      http://www.eclipse.org/legal/epl-v10.html\n+//\n+//      The Apache License v2.0 is available at\n+//      http://www.opensource.org/licenses/apache2.0.php\n+//\n+//  You may elect to redistribute this code under either of these licenses.\n+//  ========================================================================\n+//\n+\n+package org.eclipse.jetty.util.ssl;\n+\n+import java.io.File;\n+import java.net.URI;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jetty.util.Scanner;\n+import org.eclipse.jetty.util.annotation.ManagedAttribute;\n+import org.eclipse.jetty.util.annotation.ManagedOperation;\n+import org.eclipse.jetty.util.component.AbstractLifeCycle;\n+import org.eclipse.jetty.util.log.Log;\n+import org.eclipse.jetty.util.log.Logger;\n+\n+public class SslKeyStoreScanner extends AbstractLifeCycle implements Scanner.DiscreteListener", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b03643961d9d7be6ed566c42aadb9bd6428a3cfa"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzMDE1NzQ4OnYy", "diffSide": "RIGHT", "path": "jetty-util/src/main/java/org/eclipse/jetty/util/ssl/SslKeyStoreScanner.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNjo1NTowNFrOGwxQ4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNjo1NTowNFrOGwxQ4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc5MTk3MQ==", "bodyText": "Drop Ssl from the class name and extend ContainerLifeCycle so we can add the Scanner as a bean.", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r453791971", "createdAt": "2020-07-13T16:55:04Z", "author": {"login": "sbordet"}, "path": "jetty-util/src/main/java/org/eclipse/jetty/util/ssl/SslKeyStoreScanner.java", "diffHunk": "@@ -0,0 +1,145 @@\n+//\n+//  ========================================================================\n+//  Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//  ------------------------------------------------------------------------\n+//  All rights reserved. This program and the accompanying materials\n+//  are made available under the terms of the Eclipse Public License v1.0\n+//  and Apache License v2.0 which accompanies this distribution.\n+//\n+//      The Eclipse Public License is available at\n+//      http://www.eclipse.org/legal/epl-v10.html\n+//\n+//      The Apache License v2.0 is available at\n+//      http://www.opensource.org/licenses/apache2.0.php\n+//\n+//  You may elect to redistribute this code under either of these licenses.\n+//  ========================================================================\n+//\n+\n+package org.eclipse.jetty.util.ssl;\n+\n+import java.io.File;\n+import java.net.URI;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jetty.util.Scanner;\n+import org.eclipse.jetty.util.annotation.ManagedAttribute;\n+import org.eclipse.jetty.util.annotation.ManagedOperation;\n+import org.eclipse.jetty.util.component.AbstractLifeCycle;\n+import org.eclipse.jetty.util.log.Log;\n+import org.eclipse.jetty.util.log.Logger;\n+\n+public class SslKeyStoreScanner extends AbstractLifeCycle implements Scanner.DiscreteListener", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b03643961d9d7be6ed566c42aadb9bd6428a3cfa"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzMDE2OTk1OnYy", "diffSide": "RIGHT", "path": "jetty-server/src/main/config/modules/ssl-reload.mod", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNjo1ODoyNVrOGwxYrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNjo1ODoyNVrOGwxYrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc5Mzk2Ng==", "bodyText": "Rename the XML file to jetty-ssl-context-reload.xml.", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r453793966", "createdAt": "2020-07-13T16:58:25Z", "author": {"login": "sbordet"}, "path": "jetty-server/src/main/config/modules/ssl-reload.mod", "diffHunk": "@@ -0,0 +1,21 @@\n+DO NOT EDIT - See: https://www.eclipse.org/jetty/documentation/current/startup-modules.html\n+\n+[description]\n+Enables the SSL keystore to be reloaded after any changes are detected on the file system.\n+\n+[tags]\n+connector\n+ssl\n+\n+[depend]\n+ssl\n+\n+[lib]\n+lib/jetty-ssl-reload-${jetty.version}.jar\n+\n+[xml]\n+etc/jetty-ssl-reload.xml", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b03643961d9d7be6ed566c42aadb9bd6428a3cfa"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzMDE3MjY1OnYy", "diffSide": "RIGHT", "path": "jetty-server/src/main/config/modules/ssl-reload.mod", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNjo1OTowMlrOGwxaOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNjo1OTowMlrOGwxaOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc5NDM2MA==", "bodyText": "Properties should be jetty.sslContext.reload.scanInterval.", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r453794360", "createdAt": "2020-07-13T16:59:02Z", "author": {"login": "sbordet"}, "path": "jetty-server/src/main/config/modules/ssl-reload.mod", "diffHunk": "@@ -0,0 +1,21 @@\n+DO NOT EDIT - See: https://www.eclipse.org/jetty/documentation/current/startup-modules.html\n+\n+[description]\n+Enables the SSL keystore to be reloaded after any changes are detected on the file system.\n+\n+[tags]\n+connector\n+ssl\n+\n+[depend]\n+ssl\n+\n+[lib]\n+lib/jetty-ssl-reload-${jetty.version}.jar\n+\n+[xml]\n+etc/jetty-ssl-reload.xml\n+\n+[ini-template]\n+# Monitored directory scan period (seconds)\n+# jetty.ssl.reload.scanInterval=1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b03643961d9d7be6ed566c42aadb9bd6428a3cfa"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzMDE4MDA5OnYy", "diffSide": "RIGHT", "path": "jetty-util/src/main/java/org/eclipse/jetty/util/ssl/SslKeyStoreScanner.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNzowMDo1MVrOGwxesA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQwNjowODoxMFrOGxFfVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc5NTUwNA==", "bodyText": "Perhaps try ... sslContextFactory.getKeyStoreResource().getFile()?", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r453795504", "createdAt": "2020-07-13T17:00:51Z", "author": {"login": "joakime"}, "path": "jetty-util/src/main/java/org/eclipse/jetty/util/ssl/SslKeyStoreScanner.java", "diffHunk": "@@ -0,0 +1,145 @@\n+//\n+//  ========================================================================\n+//  Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//  ------------------------------------------------------------------------\n+//  All rights reserved. This program and the accompanying materials\n+//  are made available under the terms of the Eclipse Public License v1.0\n+//  and Apache License v2.0 which accompanies this distribution.\n+//\n+//      The Eclipse Public License is available at\n+//      http://www.eclipse.org/legal/epl-v10.html\n+//\n+//      The Apache License v2.0 is available at\n+//      http://www.opensource.org/licenses/apache2.0.php\n+//\n+//  You may elect to redistribute this code under either of these licenses.\n+//  ========================================================================\n+//\n+\n+package org.eclipse.jetty.util.ssl;\n+\n+import java.io.File;\n+import java.net.URI;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jetty.util.Scanner;\n+import org.eclipse.jetty.util.annotation.ManagedAttribute;\n+import org.eclipse.jetty.util.annotation.ManagedOperation;\n+import org.eclipse.jetty.util.component.AbstractLifeCycle;\n+import org.eclipse.jetty.util.log.Log;\n+import org.eclipse.jetty.util.log.Logger;\n+\n+public class SslKeyStoreScanner extends AbstractLifeCycle implements Scanner.DiscreteListener\n+{\n+    private static final Logger LOG = Log.getLogger(SslKeyStoreScanner.class);\n+\n+    private final SslContextFactory sslContextFactory;\n+    private final File keystoreFile;\n+    private final List<File> files = new ArrayList<>();\n+    private Scanner _scanner;\n+    private int _scanInterval = 1;\n+\n+    public SslKeyStoreScanner(SslContextFactory sslContextFactory)\n+    {\n+        this.sslContextFactory = sslContextFactory;\n+        this.keystoreFile = new File(URI.create(sslContextFactory.getKeyStorePath())); // getKeyStorePath is giving url instead of path?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b03643961d9d7be6ed566c42aadb9bd6428a3cfa"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc5NjU5NQ==", "bodyText": "How do you handle it when there is no KeyStore Resource/Path/File?\nSuch as when the user uses SslContextFactory.setKeyStore(KeyStore) or SslContextFactory.setKeyStoreResource(Resource) on a resource that is not backed by a File?", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r453796595", "createdAt": "2020-07-13T17:02:44Z", "author": {"login": "joakime"}, "path": "jetty-util/src/main/java/org/eclipse/jetty/util/ssl/SslKeyStoreScanner.java", "diffHunk": "@@ -0,0 +1,145 @@\n+//\n+//  ========================================================================\n+//  Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//  ------------------------------------------------------------------------\n+//  All rights reserved. This program and the accompanying materials\n+//  are made available under the terms of the Eclipse Public License v1.0\n+//  and Apache License v2.0 which accompanies this distribution.\n+//\n+//      The Eclipse Public License is available at\n+//      http://www.eclipse.org/legal/epl-v10.html\n+//\n+//      The Apache License v2.0 is available at\n+//      http://www.opensource.org/licenses/apache2.0.php\n+//\n+//  You may elect to redistribute this code under either of these licenses.\n+//  ========================================================================\n+//\n+\n+package org.eclipse.jetty.util.ssl;\n+\n+import java.io.File;\n+import java.net.URI;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jetty.util.Scanner;\n+import org.eclipse.jetty.util.annotation.ManagedAttribute;\n+import org.eclipse.jetty.util.annotation.ManagedOperation;\n+import org.eclipse.jetty.util.component.AbstractLifeCycle;\n+import org.eclipse.jetty.util.log.Log;\n+import org.eclipse.jetty.util.log.Logger;\n+\n+public class SslKeyStoreScanner extends AbstractLifeCycle implements Scanner.DiscreteListener\n+{\n+    private static final Logger LOG = Log.getLogger(SslKeyStoreScanner.class);\n+\n+    private final SslContextFactory sslContextFactory;\n+    private final File keystoreFile;\n+    private final List<File> files = new ArrayList<>();\n+    private Scanner _scanner;\n+    private int _scanInterval = 1;\n+\n+    public SslKeyStoreScanner(SslContextFactory sslContextFactory)\n+    {\n+        this.sslContextFactory = sslContextFactory;\n+        this.keystoreFile = new File(URI.create(sslContextFactory.getKeyStorePath())); // getKeyStorePath is giving url instead of path?", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc5NTUwNA=="}, "originalCommit": {"oid": "b03643961d9d7be6ed566c42aadb9bd6428a3cfa"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDEyMzM1MA==", "bodyText": "If there is no keystore file we will hit one of these IllegalArgumentExceptions and have an error during startup. I think this is fine as its bad configuration to have this when the keystore is not backed by a file.", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r454123350", "createdAt": "2020-07-14T06:08:10Z", "author": {"login": "lachlan-roberts"}, "path": "jetty-util/src/main/java/org/eclipse/jetty/util/ssl/SslKeyStoreScanner.java", "diffHunk": "@@ -0,0 +1,145 @@\n+//\n+//  ========================================================================\n+//  Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//  ------------------------------------------------------------------------\n+//  All rights reserved. This program and the accompanying materials\n+//  are made available under the terms of the Eclipse Public License v1.0\n+//  and Apache License v2.0 which accompanies this distribution.\n+//\n+//      The Eclipse Public License is available at\n+//      http://www.eclipse.org/legal/epl-v10.html\n+//\n+//      The Apache License v2.0 is available at\n+//      http://www.opensource.org/licenses/apache2.0.php\n+//\n+//  You may elect to redistribute this code under either of these licenses.\n+//  ========================================================================\n+//\n+\n+package org.eclipse.jetty.util.ssl;\n+\n+import java.io.File;\n+import java.net.URI;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jetty.util.Scanner;\n+import org.eclipse.jetty.util.annotation.ManagedAttribute;\n+import org.eclipse.jetty.util.annotation.ManagedOperation;\n+import org.eclipse.jetty.util.component.AbstractLifeCycle;\n+import org.eclipse.jetty.util.log.Log;\n+import org.eclipse.jetty.util.log.Logger;\n+\n+public class SslKeyStoreScanner extends AbstractLifeCycle implements Scanner.DiscreteListener\n+{\n+    private static final Logger LOG = Log.getLogger(SslKeyStoreScanner.class);\n+\n+    private final SslContextFactory sslContextFactory;\n+    private final File keystoreFile;\n+    private final List<File> files = new ArrayList<>();\n+    private Scanner _scanner;\n+    private int _scanInterval = 1;\n+\n+    public SslKeyStoreScanner(SslContextFactory sslContextFactory)\n+    {\n+        this.sslContextFactory = sslContextFactory;\n+        this.keystoreFile = new File(URI.create(sslContextFactory.getKeyStorePath())); // getKeyStorePath is giving url instead of path?", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc5NTUwNA=="}, "originalCommit": {"oid": "b03643961d9d7be6ed566c42aadb9bd6428a3cfa"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzMDE4MDk0OnYy", "diffSide": "RIGHT", "path": "jetty-util/src/main/java/org/eclipse/jetty/util/ssl/SslKeyStoreScanner.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNzowMTowNlrOGwxfUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNzowMTowNlrOGwxfUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc5NTY2NQ==", "bodyText": "Make _scanner final and add it as a bean in the constructor.\nHere just configure it and call super to start it.", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r453795665", "createdAt": "2020-07-13T17:01:06Z", "author": {"login": "sbordet"}, "path": "jetty-util/src/main/java/org/eclipse/jetty/util/ssl/SslKeyStoreScanner.java", "diffHunk": "@@ -0,0 +1,145 @@\n+//\n+//  ========================================================================\n+//  Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//  ------------------------------------------------------------------------\n+//  All rights reserved. This program and the accompanying materials\n+//  are made available under the terms of the Eclipse Public License v1.0\n+//  and Apache License v2.0 which accompanies this distribution.\n+//\n+//      The Eclipse Public License is available at\n+//      http://www.eclipse.org/legal/epl-v10.html\n+//\n+//      The Apache License v2.0 is available at\n+//      http://www.opensource.org/licenses/apache2.0.php\n+//\n+//  You may elect to redistribute this code under either of these licenses.\n+//  ========================================================================\n+//\n+\n+package org.eclipse.jetty.util.ssl;\n+\n+import java.io.File;\n+import java.net.URI;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jetty.util.Scanner;\n+import org.eclipse.jetty.util.annotation.ManagedAttribute;\n+import org.eclipse.jetty.util.annotation.ManagedOperation;\n+import org.eclipse.jetty.util.component.AbstractLifeCycle;\n+import org.eclipse.jetty.util.log.Log;\n+import org.eclipse.jetty.util.log.Logger;\n+\n+public class SslKeyStoreScanner extends AbstractLifeCycle implements Scanner.DiscreteListener\n+{\n+    private static final Logger LOG = Log.getLogger(SslKeyStoreScanner.class);\n+\n+    private final SslContextFactory sslContextFactory;\n+    private final File keystoreFile;\n+    private final List<File> files = new ArrayList<>();\n+    private Scanner _scanner;\n+    private int _scanInterval = 1;\n+\n+    public SslKeyStoreScanner(SslContextFactory sslContextFactory)\n+    {\n+        this.sslContextFactory = sslContextFactory;\n+        this.keystoreFile = new File(URI.create(sslContextFactory.getKeyStorePath())); // getKeyStorePath is giving url instead of path?\n+        if (!keystoreFile.exists())\n+            throw new IllegalArgumentException(\"keystore file does not exist\");\n+        if (keystoreFile.isDirectory())\n+            throw new IllegalArgumentException(\"expected keystore file not directory\");\n+\n+        File parentFile = keystoreFile.getParentFile();\n+        if (!parentFile.exists() || !parentFile.isDirectory())\n+            throw new IllegalArgumentException(\"error obtaining keystore dir\");\n+\n+        files.add(parentFile);\n+        if (LOG.isDebugEnabled())\n+            LOG.debug(\"created {}\", this);\n+    }\n+\n+    @Override\n+    protected void doStart() throws Exception\n+    {\n+        if (LOG.isDebugEnabled())\n+            LOG.debug(this.getClass().getSimpleName() + \".doStart()\");\n+\n+        _scanner = new Scanner();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b03643961d9d7be6ed566c42aadb9bd6428a3cfa"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzMDE4MjQ4OnYy", "diffSide": "RIGHT", "path": "jetty-util/src/main/java/org/eclipse/jetty/util/ssl/SslKeyStoreScanner.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNzowMTozMFrOGwxgOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNzowMTozMFrOGwxgOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc5NTg5Nw==", "bodyText": "Remove comment as you have a test case for this behavior and seems to work fine.", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r453795897", "createdAt": "2020-07-13T17:01:30Z", "author": {"login": "sbordet"}, "path": "jetty-util/src/main/java/org/eclipse/jetty/util/ssl/SslKeyStoreScanner.java", "diffHunk": "@@ -0,0 +1,145 @@\n+//\n+//  ========================================================================\n+//  Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//  ------------------------------------------------------------------------\n+//  All rights reserved. This program and the accompanying materials\n+//  are made available under the terms of the Eclipse Public License v1.0\n+//  and Apache License v2.0 which accompanies this distribution.\n+//\n+//      The Eclipse Public License is available at\n+//      http://www.eclipse.org/legal/epl-v10.html\n+//\n+//      The Apache License v2.0 is available at\n+//      http://www.opensource.org/licenses/apache2.0.php\n+//\n+//  You may elect to redistribute this code under either of these licenses.\n+//  ========================================================================\n+//\n+\n+package org.eclipse.jetty.util.ssl;\n+\n+import java.io.File;\n+import java.net.URI;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jetty.util.Scanner;\n+import org.eclipse.jetty.util.annotation.ManagedAttribute;\n+import org.eclipse.jetty.util.annotation.ManagedOperation;\n+import org.eclipse.jetty.util.component.AbstractLifeCycle;\n+import org.eclipse.jetty.util.log.Log;\n+import org.eclipse.jetty.util.log.Logger;\n+\n+public class SslKeyStoreScanner extends AbstractLifeCycle implements Scanner.DiscreteListener\n+{\n+    private static final Logger LOG = Log.getLogger(SslKeyStoreScanner.class);\n+\n+    private final SslContextFactory sslContextFactory;\n+    private final File keystoreFile;\n+    private final List<File> files = new ArrayList<>();\n+    private Scanner _scanner;\n+    private int _scanInterval = 1;\n+\n+    public SslKeyStoreScanner(SslContextFactory sslContextFactory)\n+    {\n+        this.sslContextFactory = sslContextFactory;\n+        this.keystoreFile = new File(URI.create(sslContextFactory.getKeyStorePath())); // getKeyStorePath is giving url instead of path?\n+        if (!keystoreFile.exists())\n+            throw new IllegalArgumentException(\"keystore file does not exist\");\n+        if (keystoreFile.isDirectory())\n+            throw new IllegalArgumentException(\"expected keystore file not directory\");\n+\n+        File parentFile = keystoreFile.getParentFile();\n+        if (!parentFile.exists() || !parentFile.isDirectory())\n+            throw new IllegalArgumentException(\"error obtaining keystore dir\");\n+\n+        files.add(parentFile);\n+        if (LOG.isDebugEnabled())\n+            LOG.debug(\"created {}\", this);\n+    }\n+\n+    @Override\n+    protected void doStart() throws Exception\n+    {\n+        if (LOG.isDebugEnabled())\n+            LOG.debug(this.getClass().getSimpleName() + \".doStart()\");\n+\n+        _scanner = new Scanner();\n+        _scanner.setScanDirs(files);\n+        _scanner.setScanInterval(_scanInterval);\n+        _scanner.setReportDirs(false);\n+        _scanner.setReportExistingFilesOnStartup(false);\n+        _scanner.setScanDepth(1);\n+        _scanner.addListener(this);\n+        _scanner.start();\n+    }\n+\n+    @Override\n+    protected void doStop() throws Exception\n+    {\n+        if (_scanner != null)\n+        {\n+            _scanner.stop();\n+            _scanner.removeListener(this);\n+            _scanner = null;\n+        }\n+    }\n+\n+    @Override\n+    public void fileAdded(String filename) throws Exception\n+    {\n+        if (LOG.isDebugEnabled())\n+            LOG.debug(\"added {}\", filename);\n+\n+        if (keystoreFile.toPath().toString().equals(filename))\n+            reload();\n+    }\n+\n+    @Override\n+    public void fileChanged(String filename) throws Exception\n+    {\n+        if (LOG.isDebugEnabled())\n+            LOG.debug(\"changed {}\", filename);\n+\n+        if (keystoreFile.toPath().toString().equals(filename))\n+            reload();\n+    }\n+\n+    @Override\n+    public void fileRemoved(String filename) throws Exception\n+    {\n+        if (LOG.isDebugEnabled())\n+            LOG.debug(\"removed {}\", filename);\n+\n+        // TODO: do we want to do this?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b03643961d9d7be6ed566c42aadb9bd6428a3cfa"}, "originalPosition": 114}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzMzAwMDg3OnYy", "diffSide": "RIGHT", "path": "jetty-util/src/main/java/org/eclipse/jetty/util/ssl/KeyStoreScanner.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQwOToyMDo0NVrOGxLeqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQwOToyMDo0NVrOGxLeqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDIyMTQ4MQ==", "bodyText": "Add javadocs.", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r454221481", "createdAt": "2020-07-14T09:20:45Z", "author": {"login": "sbordet"}, "path": "jetty-util/src/main/java/org/eclipse/jetty/util/ssl/KeyStoreScanner.java", "diffHunk": "@@ -0,0 +1,126 @@\n+//\n+//  ========================================================================\n+//  Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//  ------------------------------------------------------------------------\n+//  All rights reserved. This program and the accompanying materials\n+//  are made available under the terms of the Eclipse Public License v1.0\n+//  and Apache License v2.0 which accompanies this distribution.\n+//\n+//      The Eclipse Public License is available at\n+//      http://www.eclipse.org/legal/epl-v10.html\n+//\n+//      The Apache License v2.0 is available at\n+//      http://www.opensource.org/licenses/apache2.0.php\n+//\n+//  You may elect to redistribute this code under either of these licenses.\n+//  ========================================================================\n+//\n+\n+package org.eclipse.jetty.util.ssl;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.Collections;\n+\n+import org.eclipse.jetty.util.Scanner;\n+import org.eclipse.jetty.util.annotation.ManagedAttribute;\n+import org.eclipse.jetty.util.annotation.ManagedOperation;\n+import org.eclipse.jetty.util.component.ContainerLifeCycle;\n+import org.eclipse.jetty.util.log.Log;\n+import org.eclipse.jetty.util.log.Logger;\n+\n+public class KeyStoreScanner extends ContainerLifeCycle implements Scanner.DiscreteListener", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a83844df32f08a18ba2e78a76f98205a611d1254"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzMzAwNjE1OnYy", "diffSide": "RIGHT", "path": "jetty-server/src/main/config/etc/jetty-ssl-context-reload.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQwOToyMjowMVrOGxLhvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQwOToyMjowMVrOGxLhvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDIyMjI3MA==", "bodyText": "Drop ssl in the id.", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r454222270", "createdAt": "2020-07-14T09:22:01Z", "author": {"login": "sbordet"}, "path": "jetty-server/src/main/config/etc/jetty-ssl-context-reload.xml", "diffHunk": "@@ -0,0 +1,12 @@\n+<?xml version=\"1.0\"?><!DOCTYPE Configure PUBLIC \"-//Jetty//Configure//EN\" \"http://www.eclipse.org/jetty/configure_9_3.dtd\">\n+\n+<Configure id=\"Server\" class=\"org.eclipse.jetty.server.Server\">\n+  <Call name=\"addBean\">\n+    <Arg>\n+      <New id=\"sslKeyStoreScanner\" class=\"org.eclipse.jetty.util.ssl.KeyStoreScanner\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a83844df32f08a18ba2e78a76f98205a611d1254"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNzE3NjY2OnYy", "diffSide": "RIGHT", "path": "jetty-util/src/main/java/org/eclipse/jetty/util/ssl/SslContextFactory.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwODowNzozMVrOGxzAvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwODoyOTo1NlrOGxz0nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDg2OTE4MQ==", "bodyText": "Change the message to \"SslContextFactory not started or reload failed\" in the 3 places you have added it.\nWe will know from the stack trace what is unavailable.", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r454869181", "createdAt": "2020-07-15T08:07:31Z", "author": {"login": "sbordet"}, "path": "jetty-util/src/main/java/org/eclipse/jetty/util/ssl/SslContextFactory.java", "diffHunk": "@@ -1131,6 +1131,9 @@ public SSLContext getSslContext()\n \n         synchronized (this)\n         {\n+            if (_factory == null)\n+                throw new IllegalStateException(\"reload failed SslContext unavailable\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c40ba6922259b7c5c19e71dea2bfc6335c96982b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDg3MjQyOQ==", "bodyText": "There is this check just above the synchronized block\nif (!isStarted())\n    return _setContext;\nwhich is why I didn't put the \"not started\" bit in the exception message, or do you expect this state to be able to change in between this check and the synchronized block?", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r454872429", "createdAt": "2020-07-15T08:13:14Z", "author": {"login": "lachlan-roberts"}, "path": "jetty-util/src/main/java/org/eclipse/jetty/util/ssl/SslContextFactory.java", "diffHunk": "@@ -1131,6 +1131,9 @@ public SSLContext getSslContext()\n \n         synchronized (this)\n         {\n+            if (_factory == null)\n+                throw new IllegalStateException(\"reload failed SslContext unavailable\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDg2OTE4MQ=="}, "originalCommit": {"oid": "c40ba6922259b7c5c19e71dea2bfc6335c96982b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDg4MjQ2Mw==", "bodyText": "Cool, just say \"SslContextFactory reload failed\" then.", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r454882463", "createdAt": "2020-07-15T08:29:56Z", "author": {"login": "sbordet"}, "path": "jetty-util/src/main/java/org/eclipse/jetty/util/ssl/SslContextFactory.java", "diffHunk": "@@ -1131,6 +1131,9 @@ public SSLContext getSslContext()\n \n         synchronized (this)\n         {\n+            if (_factory == null)\n+                throw new IllegalStateException(\"reload failed SslContext unavailable\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDg2OTE4MQ=="}, "originalCommit": {"oid": "c40ba6922259b7c5c19e71dea2bfc6335c96982b"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2422, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}