{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ2NTYzMDE5", "number": 5847, "title": "Fixes #5845 - Use UTF-8 encoding for client basic auth if requested.", "bodyText": "Introduced get/setCharset in BasicAuthenticator on server-side.\nLooking for the \"charset\" parameter on the client-side, and if there, use it.\nAdded test case.\nCode cleanups.\n\nSigned-off-by: Simone Bordet simone.bordet@gmail.com", "createdAt": "2020-12-29T16:59:23Z", "url": "https://github.com/eclipse/jetty.project/pull/5847", "merged": true, "mergeCommit": {"oid": "6e1cd862e4e6069ff865933cb2ea9caeeed26cd3"}, "closed": true, "closedAt": "2021-01-12T10:26:34Z", "author": {"login": "sbordet"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdq9wBbgH2gAyNTQ2NTYzMDE5OmY0Y2FmMDdiMTcyZmExOThiZTk1ZDAzNTNjNWZkOTY3MzU5Nzg2ODM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdvC0WcAFqTU2NTE2NTkwOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f4caf07b172fa198be95d0353c5fd96735978683", "author": {"user": {"login": "sbordet", "name": "Simone Bordet"}}, "url": "https://github.com/eclipse/jetty.project/commit/f4caf07b172fa198be95d0353c5fd96735978683", "committedDate": "2020-12-29T16:58:43Z", "message": "Fixes #5845 - Use UTF-8 encoding for client basic auth if requested.\n\n* Introduced get/setCharset in BasicAuthenticator on server-side.\n* Looking for the \"charset\" parameter on the client-side, and if there, use it.\n* Added test case.\n* Code cleanups.\n\nSigned-off-by: Simone Bordet <simone.bordet@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "655c2e3eb11390a4f8702406fa739d14be8253b9", "author": {"user": {"login": "sbordet", "name": "Simone Bordet"}}, "url": "https://github.com/eclipse/jetty.project/commit/655c2e3eb11390a4f8702406fa739d14be8253b9", "committedDate": "2020-12-30T11:05:29Z", "message": "Fixes #5845 - Use UTF-8 encoding for client basic auth if requested.\n\nDon't use unicode sequences to please CheckStyle.\n\nSigned-off-by: Simone Bordet <simone.bordet@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6535f2d6e77b5db2432895fdbc2edd915e85be71", "author": {"user": {"login": "sbordet", "name": "Simone Bordet"}}, "url": "https://github.com/eclipse/jetty.project/commit/6535f2d6e77b5db2432895fdbc2edd915e85be71", "committedDate": "2020-12-30T11:08:13Z", "message": "Fixes #5845 - Use UTF-8 encoding for client basic auth if requested.\n\nDisable CheckStyle check so that the unicode sequence in the test matches that in realm.properties.\n\nSigned-off-by: Simone Bordet <simone.bordet@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b050bdbc9e47350b2807504eb5c7e1601ab3b967", "author": {"user": {"login": "sbordet", "name": "Simone Bordet"}}, "url": "https://github.com/eclipse/jetty.project/commit/b050bdbc9e47350b2807504eb5c7e1601ab3b967", "committedDate": "2020-12-30T15:09:28Z", "message": "Merged branch 'jetty-9.4.x' into 'jetty-9.4.x-5845-basic_auth_charset'."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY1MTY1OTA5", "url": "https://github.com/eclipse/jetty.project/pull/5847#pullrequestreview-565165909", "createdAt": "2021-01-11T09:07:32Z", "commit": {"oid": "b050bdbc9e47350b2807504eb5c7e1601ab3b967"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQwOTowNzozM1rOIRMnkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQwOTowNzozM1rOIRMnkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDkwMzQ0Mg==", "bodyText": "Maybe pre compute this string rather than recreate on every request?", "url": "https://github.com/eclipse/jetty.project/pull/5847#discussion_r554903442", "createdAt": "2021-01-11T09:07:33Z", "author": {"login": "gregw"}, "path": "jetty-security/src/main/java/org/eclipse/jetty/security/authentication/BasicAuthenticator.java", "diffHunk": "@@ -97,7 +97,11 @@ public Authentication validateRequest(ServletRequest req, ServletResponse res, b\n             if (DeferredAuthentication.isDeferred(response))\n                 return Authentication.UNAUTHENTICATED;\n \n-            response.setHeader(HttpHeader.WWW_AUTHENTICATE.asString(), \"basic realm=\\\"\" + _loginService.getName() + '\"');\n+            String value = \"basic realm=\\\"\" + _loginService.getName() + \"\\\"\";\n+            Charset charset = getCharset();\n+            if (charset != null)\n+                value += \", charset=\\\"\" + charset.name() + \"\\\"\";\n+            response.setHeader(HttpHeader.WWW_AUTHENTICATE.asString(), value);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b050bdbc9e47350b2807504eb5c7e1601ab3b967"}, "originalPosition": 76}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4959, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}