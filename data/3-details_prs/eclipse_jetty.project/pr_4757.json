{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwNzIyMzkz", "number": 4757, "title": "Use HandlerList instead of HandlerCollection", "bodyText": "The HandlerCollection class is both a concrete class and the base class for HandlerList and ContextHandlerCollection.  Behaviours are:\n\nHandlerCollection  has a list of handlers that are called in order regardless of errors or handled status\nHandlerList calls handlers in order until isHandled()==true or an exception\nContextHandlerCollection attempts to map a request to a handler by contextPath and virtual host and then calls matching in order until isHandled()==true` or an exception\n\nOriginally the basic jetty.xml setup was:\nServer\n  +-- HandlerCollection\n       +-- ContextHandlerCollection\n       +-- DefaultHandler\n\nWhich with some optional modules was extended to something like:\nServer\n  +-- HandlerCollection\n       +-- RewriteHandler\n       +-- ContextHandlerCollection\n       +-- RequestLogHandler\n       +-- DefaultHandler\n\nSo the HandlerCollection behaviour was needed so that the request was always rewritten and always logged.    The DefaultHandler does it's own isHandled()==true check so it only handles unhandled requests.\nHowever, now in Jetty-10 the extended structure is\nServer\n  +-- RewriteHandler\n  |   +-- HandlerCollection\n  |       +-- ContextHandlerCollection\n  |       +-- DefaultHandler\n  +-- RequestLog\n\nSo the HandlerCollection semantic is no longer needed.  This PR replaces the common usage of HandlerCollection with the more intuitive HandlerList", "createdAt": "2020-04-08T09:05:06Z", "url": "https://github.com/eclipse/jetty.project/pull/4757", "merged": true, "mergeCommit": {"oid": "2addb6a655ac40ac120be0e5cb33c59a91052024"}, "closed": true, "closedAt": "2020-04-15T16:42:29Z", "author": {"login": "gregw"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVkHzkAH2gAyNDAwNzIyMzkzOjQwN2Y2ZDAwNWFjYWJmMzcyYjMzNmVkYTA4Y2YwOTU5ZDNmNzA0NTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcX5HhsgFqTM5MzgzOTg4NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "407f6d005acabf372b336eda08cf0959d3f70454", "author": {"user": {"login": "gregw", "name": "Greg Wilkins"}}, "url": "https://github.com/eclipse/jetty.project/commit/407f6d005acabf372b336eda08cf0959d3f70454", "committedDate": "2020-04-08T09:03:36Z", "message": "Use HandlerList instead of HandlerCollection\n\nSigned-off-by: Greg Wilkins <gregw@webtide.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5Nzg5Nzc1", "url": "https://github.com/eclipse/jetty.project/pull/4757#pullrequestreview-389789775", "createdAt": "2020-04-08T09:09:38Z", "commit": {"oid": "407f6d005acabf372b336eda08cf0959d3f70454"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwOTowOTozOVrOGCmFuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwOTowOTozOVrOGCmFuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTM3NDM5NQ==", "bodyText": "@olamy the structure of this XML is a bit strange. Not sure why the two Contexts are not under the ContextHandlerCollection?", "url": "https://github.com/eclipse/jetty.project/pull/4757#discussion_r405374395", "createdAt": "2020-04-08T09:09:39Z", "author": {"login": "gregw"}, "path": "tests/test-integration/src/test/resources/RFC2616Base.xml", "diffHunk": "@@ -33,7 +33,7 @@\n     <!-- Set handler Collection Structure                            -->\n     <!-- =========================================================== -->\n     <Set name=\"handler\">\n-      <New id=\"Handlers\" class=\"org.eclipse.jetty.server.handler.HandlerCollection\">\n+      <New id=\"Handlers\" class=\"org.eclipse.jetty.server.handler.HandlerList\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "407f6d005acabf372b336eda08cf0959d3f70454"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6367a8b9d954ab2c04a904e399e5bdb9931bc5a0", "author": {"user": {"login": "gregw", "name": "Greg Wilkins"}}, "url": "https://github.com/eclipse/jetty.project/commit/6367a8b9d954ab2c04a904e399e5bdb9931bc5a0", "committedDate": "2020-04-08T13:07:11Z", "message": "Use HandlerList instead of HandlerCollection\n\nSigned-off-by: Greg Wilkins <gregw@webtide.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMTc0MTA3", "url": "https://github.com/eclipse/jetty.project/pull/4757#pullrequestreview-393174107", "createdAt": "2020-04-14T18:09:06Z", "commit": {"oid": "6367a8b9d954ab2c04a904e399e5bdb9931bc5a0"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxODowOTowNlrOGFa2kw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxODoxMzo0NVrOGFbBRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMzNjAxOQ==", "bodyText": "Meh.\nI like the HandlerList + addHandler view of the original.", "url": "https://github.com/eclipse/jetty.project/pull/4757#discussion_r408336019", "createdAt": "2020-04-14T18:09:06Z", "author": {"login": "joakime"}, "path": "examples/embedded/src/main/java/org/eclipse/jetty/embedded/WebSocketJsrServer.java", "diffHunk": "@@ -65,8 +62,7 @@ public static Server createServer(int port)\n             }\n         );\n \n-        handlers.addHandler(new DefaultHandler());\n-        server.setHandler(handlers);\n+        server.setHandler(new HandlerList(context, new DefaultHandler()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6367a8b9d954ab2c04a904e399e5bdb9931bc5a0"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMzODc1OQ==", "bodyText": "We shouldn't get rid of all of our usages of addHandler(Handler).\nThat needs to be tested as well.", "url": "https://github.com/eclipse/jetty.project/pull/4757#discussion_r408338759", "createdAt": "2020-04-14T18:13:45Z", "author": {"login": "joakime"}, "path": "jetty-server/src/test/java/org/eclipse/jetty/server/handler/SecuredRedirectHandlerTest.java", "diffHunk": "@@ -126,11 +126,7 @@ public static void startServer() throws Exception\n         contextHandlers.setHandlers(new Handler[]{redirectHandler, rootContext, test1Context, test2Context});\n \n         // Create server level handler tree\n-        HandlerList handlers = new HandlerList();\n-        handlers.addHandler(contextHandlers);\n-        handlers.addHandler(new DefaultHandler()); // round things out\n-\n-        server.setHandler(handlers);\n+        server.setHandler(new HandlerList(contextHandlers, new DefaultHandler()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6367a8b9d954ab2c04a904e399e5bdb9931bc5a0"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNTE3MjQ5", "url": "https://github.com/eclipse/jetty.project/pull/4757#pullrequestreview-393517249", "createdAt": "2020-04-15T07:24:35Z", "commit": {"oid": "6367a8b9d954ab2c04a904e399e5bdb9931bc5a0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNzoyNDozNVrOGFtAmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNzozNjoyMFrOGFtY2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYzMzQ5Nw==", "bodyText": "Since ServletContextHandler is a terminal Handler, what's the point of having a DefaultHandler afterwards?", "url": "https://github.com/eclipse/jetty.project/pull/4757#discussion_r408633497", "createdAt": "2020-04-15T07:24:35Z", "author": {"login": "sbordet"}, "path": "examples/embedded/src/main/java/org/eclipse/jetty/embedded/WebSocketJsrServer.java", "diffHunk": "@@ -65,8 +62,7 @@ public static Server createServer(int port)\n             }\n         );\n \n-        handlers.addHandler(new DefaultHandler());\n-        server.setHandler(handlers);\n+        server.setHandler(new HandlerList(context, new DefaultHandler()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMzNjAxOQ=="}, "originalCommit": {"oid": "6367a8b9d954ab2c04a904e399e5bdb9931bc5a0"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYzOTI0NQ==", "bodyText": "Again, is DefaultHandler ever called since ServletContextHandler is a terminal handler?", "url": "https://github.com/eclipse/jetty.project/pull/4757#discussion_r408639245", "createdAt": "2020-04-15T07:35:24Z", "author": {"login": "sbordet"}, "path": "jetty-websocket/websocket-javax-tests/src/test/java/org/eclipse/jetty/websocket/javax/tests/RestartContextTest.java", "diffHunk": "@@ -72,12 +72,7 @@ public void testStartStopStartServletContextListener() throws Exception\n         context.addEventListener(new AddEndpointListener());\n \n         // Setup handler tree\n-        HandlerList handlers = new HandlerList();\n-        handlers.addHandler(context);\n-        handlers.addHandler(new DefaultHandler());\n-\n-        // Add handler tree to server\n-        server.setHandler(handlers);\n+        server.setHandler(new HandlerList(context, new DefaultHandler()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6367a8b9d954ab2c04a904e399e5bdb9931bc5a0"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYzOTQ1Ng==", "bodyText": "Ditto.", "url": "https://github.com/eclipse/jetty.project/pull/4757#discussion_r408639456", "createdAt": "2020-04-15T07:35:48Z", "author": {"login": "sbordet"}, "path": "jetty-websocket/websocket-javax-tests/src/test/java/org/eclipse/jetty/websocket/javax/tests/RestartContextTest.java", "diffHunk": "@@ -114,9 +109,7 @@ public void testStartStopStartConfigurator() throws Exception\n         });\n \n         // Setup handler tree\n-        HandlerList handlers = new HandlerList();\n-        handlers.addHandler(context);\n-        handlers.addHandler(new DefaultHandler());\n+        HandlerList handlers = new HandlerList(context, new DefaultHandler());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6367a8b9d954ab2c04a904e399e5bdb9931bc5a0"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYzOTU4Mw==", "bodyText": "Ditto", "url": "https://github.com/eclipse/jetty.project/pull/4757#discussion_r408639583", "createdAt": "2020-04-15T07:36:04Z", "author": {"login": "sbordet"}, "path": "jetty-websocket/websocket-jetty-server/src/test/java/org/eclipse/jetty/websocket/server/browser/BrowserDebugTool.java", "diffHunk": "@@ -114,11 +114,7 @@ public void prepare(int port)\n         ServletHolder defHolder = new ServletHolder(\"default\", DefaultServlet.class);\n         context.addServlet(defHolder, \"/\");\n \n-        HandlerList handlers = new HandlerList();\n-        handlers.addHandler(context);\n-        handlers.addHandler(new DefaultHandler());\n-\n-        server.setHandler(handlers);\n+        server.setHandler(new HandlerList(context, new DefaultHandler()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6367a8b9d954ab2c04a904e399e5bdb9931bc5a0"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYzOTcwNw==", "bodyText": "Ditto.", "url": "https://github.com/eclipse/jetty.project/pull/4757#discussion_r408639707", "createdAt": "2020-04-15T07:36:20Z", "author": {"login": "sbordet"}, "path": "jetty-websocket/websocket-jetty-tests/src/test/java/org/eclipse/jetty/websocket/tests/client/BadNetworkTest.java", "diffHunk": "@@ -86,10 +86,7 @@ public void configure(JettyWebSocketServletFactory factory)\n         });\n         context.addServlet(holder, \"/ws\");\n \n-        HandlerList handlers = new HandlerList();\n-        handlers.addHandler(context);\n-        handlers.addHandler(new DefaultHandler());\n-        server.setHandler(handlers);\n+        server.setHandler(new HandlerList(context, new DefaultHandler()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6367a8b9d954ab2c04a904e399e5bdb9931bc5a0"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzODM5ODg0", "url": "https://github.com/eclipse/jetty.project/pull/4757#pullrequestreview-393839884", "createdAt": "2020-04-15T14:39:09Z", "commit": {"oid": "6367a8b9d954ab2c04a904e399e5bdb9931bc5a0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 533, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}