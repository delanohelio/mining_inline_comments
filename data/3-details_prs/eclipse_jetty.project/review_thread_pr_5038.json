{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2ODMyNjU1", "number": 5038, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMzoxNDo0NVrOENRVkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMzoxNjo0M1rOENRYVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMzUwOTk0OnYy", "diffSide": "RIGHT", "path": "jetty-server/src/main/config/etc/jetty.xml", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMzoxNDo0NVrOGv23cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwODo1NjozNVrOGx00Qw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjgzNTE4Nw==", "bodyText": "I don't like the name.\nIt's not whether relative redirects are allowed or not.\nIt's about whether we generate relative redirects or not.\ngenerateRelativeRedirects?\nuseRelativeRedirects?", "url": "https://github.com/eclipse/jetty.project/pull/5038#discussion_r452835187", "createdAt": "2020-07-10T13:14:45Z", "author": {"login": "sbordet"}, "path": "jetty-server/src/main/config/etc/jetty.xml", "diffHunk": "@@ -74,6 +74,7 @@\n       <Set name=\"requestCookieCompliance\"><Call class=\"org.eclipse.jetty.http.CookieCompliance\" name=\"valueOf\"><Arg><Property name=\"jetty.httpConfig.requestCookieCompliance\" deprecated=\"jetty.httpConfig.cookieCompliance\" default=\"RFC6265\"/></Arg></Call></Set>\n       <Set name=\"responseCookieCompliance\"><Call class=\"org.eclipse.jetty.http.CookieCompliance\" name=\"valueOf\"><Arg><Property name=\"jetty.httpConfig.responseCookieCompliance\" default=\"RFC6265\"/></Arg></Call></Set>\n       <Set name=\"multiPartFormDataCompliance\"><Call class=\"org.eclipse.jetty.server.MultiPartFormDataCompliance\" name=\"valueOf\"><Arg><Property name=\"jetty.httpConfig.multiPartFormDataCompliance\" default=\"RFC7578\"/></Arg></Call></Set>\n+      <Set name=\"relativeRedirectionAllowed\"><Property name=\"jetty.httpConfig.relativeRedirectionAllowed\" default=\"false\"/></Set>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b599b21c237a5f72b98c3a687ca358571cfe42d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg0OTEzNw==", "bodyText": "In the existing releases, If the application uses ...\nresponse.sendRedirect(\"/alt/path\"); // becomes an absolute-uri\nresponse.sendRedirect(\"www.machine.com/alt/path\"); // becomes an absolute-uri by adding scheme\nresponse.sendRedirect(\"https://www.machine.com/alt/path\"); // stays an absolute-uri\nWith this change, the default is false, which preserves the behavior.\nIf they set it to true, then the following happens ...\nresponse.sendRedirect(\"/alt/path\"); // no change to whats added, it is sent as `Location: /alt/path`\nresponse.sendRedirect(\"www.machine.com/alt/path\"); // no change to whats added, it is sent as `Location: www.machine.com/alt/path`\nresponse.sendRedirect(\"https://www.machine.com/alt/path\"); // no change to whats added, it is sent as `Location: https://www.machine.com/alt/path`\nPerhaps the name should indicate that Jetty, by default, ensures that the Location header is an absolute-uri, but if we change this configuration, it takes the Location as-is.\nensureAbsoluteUriLocation with a default of true?", "url": "https://github.com/eclipse/jetty.project/pull/5038#discussion_r452849137", "createdAt": "2020-07-10T13:38:47Z", "author": {"login": "joakime"}, "path": "jetty-server/src/main/config/etc/jetty.xml", "diffHunk": "@@ -74,6 +74,7 @@\n       <Set name=\"requestCookieCompliance\"><Call class=\"org.eclipse.jetty.http.CookieCompliance\" name=\"valueOf\"><Arg><Property name=\"jetty.httpConfig.requestCookieCompliance\" deprecated=\"jetty.httpConfig.cookieCompliance\" default=\"RFC6265\"/></Arg></Call></Set>\n       <Set name=\"responseCookieCompliance\"><Call class=\"org.eclipse.jetty.http.CookieCompliance\" name=\"valueOf\"><Arg><Property name=\"jetty.httpConfig.responseCookieCompliance\" default=\"RFC6265\"/></Arg></Call></Set>\n       <Set name=\"multiPartFormDataCompliance\"><Call class=\"org.eclipse.jetty.server.MultiPartFormDataCompliance\" name=\"valueOf\"><Arg><Property name=\"jetty.httpConfig.multiPartFormDataCompliance\" default=\"RFC7578\"/></Arg></Call></Set>\n+      <Set name=\"relativeRedirectionAllowed\"><Property name=\"jetty.httpConfig.relativeRedirectionAllowed\" default=\"false\"/></Set>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjgzNTE4Nw=="}, "originalCommit": {"oid": "2b599b21c237a5f72b98c3a687ca358571cfe42d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDg5ODc1NQ==", "bodyText": "The behaviour is definitely an 'Allow', as it just decides if a passed relative location can be allowed to remain relative.\nIt could be inverted to an ensure (or enforce?) but then isEnsureAbsoluteUriLocation is both a mouthful and doesn't scan.\nAfter chatting  to @sbordet online, I have renamed to relativeRedirectAllowed... but I could be pushed to allowRelativeRedirect if we can stomach isAllowRelativeRedirect ?", "url": "https://github.com/eclipse/jetty.project/pull/5038#discussion_r454898755", "createdAt": "2020-07-15T08:56:35Z", "author": {"login": "gregw"}, "path": "jetty-server/src/main/config/etc/jetty.xml", "diffHunk": "@@ -74,6 +74,7 @@\n       <Set name=\"requestCookieCompliance\"><Call class=\"org.eclipse.jetty.http.CookieCompliance\" name=\"valueOf\"><Arg><Property name=\"jetty.httpConfig.requestCookieCompliance\" deprecated=\"jetty.httpConfig.cookieCompliance\" default=\"RFC6265\"/></Arg></Call></Set>\n       <Set name=\"responseCookieCompliance\"><Call class=\"org.eclipse.jetty.http.CookieCompliance\" name=\"valueOf\"><Arg><Property name=\"jetty.httpConfig.responseCookieCompliance\" default=\"RFC6265\"/></Arg></Call></Set>\n       <Set name=\"multiPartFormDataCompliance\"><Call class=\"org.eclipse.jetty.server.MultiPartFormDataCompliance\" name=\"valueOf\"><Arg><Property name=\"jetty.httpConfig.multiPartFormDataCompliance\" default=\"RFC7578\"/></Arg></Call></Set>\n+      <Set name=\"relativeRedirectionAllowed\"><Property name=\"jetty.httpConfig.relativeRedirectionAllowed\" default=\"false\"/></Set>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjgzNTE4Nw=="}, "originalCommit": {"oid": "2b599b21c237a5f72b98c3a687ca358571cfe42d"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMzUxNzAyOnYy", "diffSide": "RIGHT", "path": "jetty-server/src/main/java/org/eclipse/jetty/server/Response.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMzoxNjo0M1rOGv27sA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwODo1NzoxNVrOGx02CQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjgzNjI3Mg==", "bodyText": "Is the Servlet specification mandating absolute redirects? Just to be sure that we actually can.", "url": "https://github.com/eclipse/jetty.project/pull/5038#discussion_r452836272", "createdAt": "2020-07-10T13:16:43Z", "author": {"login": "sbordet"}, "path": "jetty-server/src/main/java/org/eclipse/jetty/server/Response.java", "diffHunk": "@@ -506,7 +506,9 @@ public void sendRedirect(int code, String location) throws IOException\n \n         if (!URIUtil.hasScheme(location))\n         {\n-            StringBuilder buf = _channel.getRequest().getRootURL();\n+            StringBuilder buf = _channel.getHttpConfiguration().isRelativeRedirectionAllowed()\n+                ? new StringBuilder()\n+                : _channel.getRequest().getRootURL();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b599b21c237a5f72b98c3a687ca358571cfe42d"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDg5OTIwOQ==", "bodyText": "probably, but it was written before RFC7230 and we do absolute by default.  Happy to bend the rules if users configure it to do so.", "url": "https://github.com/eclipse/jetty.project/pull/5038#discussion_r454899209", "createdAt": "2020-07-15T08:57:15Z", "author": {"login": "gregw"}, "path": "jetty-server/src/main/java/org/eclipse/jetty/server/Response.java", "diffHunk": "@@ -506,7 +506,9 @@ public void sendRedirect(int code, String location) throws IOException\n \n         if (!URIUtil.hasScheme(location))\n         {\n-            StringBuilder buf = _channel.getRequest().getRootURL();\n+            StringBuilder buf = _channel.getHttpConfiguration().isRelativeRedirectionAllowed()\n+                ? new StringBuilder()\n+                : _channel.getRequest().getRootURL();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjgzNjI3Mg=="}, "originalCommit": {"oid": "2b599b21c237a5f72b98c3a687ca358571cfe42d"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2420, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}