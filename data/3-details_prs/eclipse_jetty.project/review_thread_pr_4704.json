{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyOTA5MjE0", "number": 4704, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxMDo1NTowOVrODxl27g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxMDo1OToxNlrODxl8TA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzMzI3MDg2OnYy", "diffSide": "RIGHT", "path": "jetty-openid/src/main/java/org/eclipse/jetty/security/openid/OpenIdAuthenticator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxMDo1NTowOVrOGFJNbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxMDo1NTowOVrOGFJNbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODA0Njk1OQ==", "bodyText": "In 10.0.x I have added to URIUtil:\n    /** Add a path and a query string\n     * @param path The path which may already contain contain a query\n     * @param query The query string or null if no query to be added\n     * @return The path with any non null query added after a '?' or '&amp;' as appropriate.\n     */\n    public static String addPathQuery(String path, String query)\n    {\n        if (query == null)\n            return path;\n        if (path.indexOf('?') >= 0)\n            return path + '&' + query;\n        return path + '?' + query;\n    }\nback port and use here.", "url": "https://github.com/eclipse/jetty.project/pull/4704#discussion_r408046959", "createdAt": "2020-04-14T10:55:09Z", "author": {"login": "gregw"}, "path": "jetty-openid/src/main/java/org/eclipse/jetty/security/openid/OpenIdAuthenticator.java", "diffHunk": "@@ -415,6 +402,47 @@ public Authentication validateRequest(ServletRequest req, ServletResponse res, b\n         }\n     }\n \n+    /**\n+     * Report an error case either by redirecting to the error page if it is defined, otherwise sending a 403 response.\n+     * If the message parameter is not null, a query parameter with a key of {@link #ERROR_PARAMETER} and value of the error\n+     * message will be logged and added to the error redirect URI if the error page is defined.\n+     * @param request the request.\n+     * @param response the response.\n+     * @param message the reason for the error or null.\n+     * @throws IOException if sending the error fails for any reason.\n+     */\n+    private void sendError(HttpServletRequest request, HttpServletResponse response, String message) throws IOException\n+    {\n+        final Request baseRequest = Request.getBaseRequest(request);\n+        final Response baseResponse = Objects.requireNonNull(baseRequest).getResponse();\n+\n+        if (LOG.isDebugEnabled())\n+            LOG.debug(\"OpenId authentication FAILED: {}\", message);\n+\n+        if (_errorPage == null)\n+        {\n+            if (LOG.isDebugEnabled())\n+                LOG.debug(\"auth failed 403\");\n+            if (response != null)\n+                response.sendError(HttpServletResponse.SC_FORBIDDEN);\n+        }\n+        else\n+        {\n+            if (LOG.isDebugEnabled())\n+                LOG.debug(\"auth failed {}\", _errorPage);\n+\n+            String redirectUri = URIUtil.addPaths(request.getContextPath(), _errorPage);\n+            if (message != null)\n+            {\n+                String query = URIUtil.combineQueryParams(ERROR_PARAMETER + \"=\" + UrlEncoded.encodeString(message), _errorQuery);\n+                redirectUri = URIUtil.addPaths(request.getContextPath(), _errorPath) + \"?\" + query;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4bc32e314bd0a81f3f3be02bc71c1bd94258c619"}, "originalPosition": 185}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzMzI4NDYwOnYy", "diffSide": "RIGHT", "path": "jetty-util/src/main/java/org/eclipse/jetty/util/URIUtil.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxMDo1OToxNlrOGFJWAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxMDo1OToxNlrOGFJWAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODA0OTE1NA==", "bodyText": "a better name is addQueries as that matches the addPaths we already have.\nTo make it more efficient it should do:\nif (StringUtil.isEmpty(query1))\n  return query2;\nif (StringUtil.isEmpty(query2))\n  return query1;\nreturn query1 + '&' + query2;", "url": "https://github.com/eclipse/jetty.project/pull/4704#discussion_r408049154", "createdAt": "2020-04-14T10:59:16Z", "author": {"login": "gregw"}, "path": "jetty-util/src/main/java/org/eclipse/jetty/util/URIUtil.java", "diffHunk": "@@ -1305,6 +1305,28 @@ public static URI addPath(URI uri, String path)\n         return URI.create(buf.toString());\n     }\n \n+    /**\n+     * Combine two query strings into one. Each query string should not contain the beginning '?' character, but\n+     * may contain multiple parameters separated by the '{@literal &}' character.\n+     * @param query1 the first query string.\n+     * @param query2 the second query string.\n+     * @return the combination of the two query strings.\n+     */\n+    public static String combineQueryParams(String query1, String query2)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4bc32e314bd0a81f3f3be02bc71c1bd94258c619"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2697, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}