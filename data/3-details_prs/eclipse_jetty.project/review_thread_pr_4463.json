{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYwMjMzMTIx", "number": 4463, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxMDo1NTo0M1rODWz_mg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxMDo1NTo0M1rODWz_mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1MjQ3MTMwOnYy", "diffSide": "RIGHT", "path": "jetty-servlet/src/test/java/org/eclipse/jetty/servlet/ServletContextHandlerTest.java", "isResolved": false, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxMDo1NTo0M1rOFbyE2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QwODoxMDo1MlrOFexbZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDY3NjMxMg==", "bodyText": "All other tests in this class have code that actually make a HTTP request to test the functionality.\nThis new test only adds the dynamic JSP but does not test that making a HTTP request to it works.\nIs that intended?", "url": "https://github.com/eclipse/jetty.project/pull/4463#discussion_r364676312", "createdAt": "2020-01-09T10:55:43Z", "author": {"login": "sbordet"}, "path": "jetty-servlet/src/test/java/org/eclipse/jetty/servlet/ServletContextHandlerTest.java", "diffHunk": "@@ -884,6 +884,38 @@ public void onStartup(Set<Class<?>> c, ServletContext ctx) throws ServletExcepti\n         assertThat(\"Response\", response, containsString(\"Hello World\"));\n     }\n \n+    @Test\n+    public void testAddJspFile() throws Exception\n+    {\n+        ContextHandlerCollection contexts = new ContextHandlerCollection();\n+        _server.setHandler(contexts);\n+\n+        ServletContextHandler root = new ServletContextHandler(contexts, \"/\");\n+        ServletHolder jspServlet = new ServletHolder();\n+        jspServlet.setName(\"jsp\");\n+        jspServlet.setHeldClass(FakeJspServlet.class);\n+        root.addServlet(jspServlet, \"*.jsp\");\n+        class JSPAddingSCI implements ServletContainerInitializer\n+        {\n+            @Override\n+            public void onStartup(Set<Class<?>> c, ServletContext ctx) throws ServletException\n+            {\n+                try\n+                {\n+                    ServletRegistration rego = ctx.addJspFile(\"some.jsp\", \"/path/to/some.jsp\");\n+                    rego.addMapping(\"/somejsp/*\");\n+                }\n+                catch (Exception e)\n+                {\n+                    fail(e);\n+                }\n+            }\n+        }\n+        \n+        root.addBean(new MySCIStarter(root.getServletContext(), new JSPAddingSCI()), true);\n+        _server.start();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fc82bf4f4b22529efefb922e5129129488bddcd"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDY3NjgxMg==", "bodyText": "Also, should we not have 3 tests for this functionality? No mapping, partial mapping, existing mapping?", "url": "https://github.com/eclipse/jetty.project/pull/4463#discussion_r364676812", "createdAt": "2020-01-09T10:56:47Z", "author": {"login": "sbordet"}, "path": "jetty-servlet/src/test/java/org/eclipse/jetty/servlet/ServletContextHandlerTest.java", "diffHunk": "@@ -884,6 +884,38 @@ public void onStartup(Set<Class<?>> c, ServletContext ctx) throws ServletExcepti\n         assertThat(\"Response\", response, containsString(\"Hello World\"));\n     }\n \n+    @Test\n+    public void testAddJspFile() throws Exception\n+    {\n+        ContextHandlerCollection contexts = new ContextHandlerCollection();\n+        _server.setHandler(contexts);\n+\n+        ServletContextHandler root = new ServletContextHandler(contexts, \"/\");\n+        ServletHolder jspServlet = new ServletHolder();\n+        jspServlet.setName(\"jsp\");\n+        jspServlet.setHeldClass(FakeJspServlet.class);\n+        root.addServlet(jspServlet, \"*.jsp\");\n+        class JSPAddingSCI implements ServletContainerInitializer\n+        {\n+            @Override\n+            public void onStartup(Set<Class<?>> c, ServletContext ctx) throws ServletException\n+            {\n+                try\n+                {\n+                    ServletRegistration rego = ctx.addJspFile(\"some.jsp\", \"/path/to/some.jsp\");\n+                    rego.addMapping(\"/somejsp/*\");\n+                }\n+                catch (Exception e)\n+                {\n+                    fail(e);\n+                }\n+            }\n+        }\n+        \n+        root.addBean(new MySCIStarter(root.getServletContext(), new JSPAddingSCI()), true);\n+        _server.start();\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDY3NjMxMg=="}, "originalCommit": {"oid": "8fc82bf4f4b22529efefb922e5129129488bddcd"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQzOTI5Nw==", "bodyText": "I can't add a test for a jsp file because jetty-servlet cannot depend on apache-jsp module. I've added an assertion that tests that the mapped jsp servlet is the one matched by the ServletHandler for the given path, that's as much as we can do.\nI also added tests for an existing full mapping and an existing preliminary mapping.", "url": "https://github.com/eclipse/jetty.project/pull/4463#discussion_r367439297", "createdAt": "2020-01-16T14:14:50Z", "author": {"login": "janbartel"}, "path": "jetty-servlet/src/test/java/org/eclipse/jetty/servlet/ServletContextHandlerTest.java", "diffHunk": "@@ -884,6 +884,38 @@ public void onStartup(Set<Class<?>> c, ServletContext ctx) throws ServletExcepti\n         assertThat(\"Response\", response, containsString(\"Hello World\"));\n     }\n \n+    @Test\n+    public void testAddJspFile() throws Exception\n+    {\n+        ContextHandlerCollection contexts = new ContextHandlerCollection();\n+        _server.setHandler(contexts);\n+\n+        ServletContextHandler root = new ServletContextHandler(contexts, \"/\");\n+        ServletHolder jspServlet = new ServletHolder();\n+        jspServlet.setName(\"jsp\");\n+        jspServlet.setHeldClass(FakeJspServlet.class);\n+        root.addServlet(jspServlet, \"*.jsp\");\n+        class JSPAddingSCI implements ServletContainerInitializer\n+        {\n+            @Override\n+            public void onStartup(Set<Class<?>> c, ServletContext ctx) throws ServletException\n+            {\n+                try\n+                {\n+                    ServletRegistration rego = ctx.addJspFile(\"some.jsp\", \"/path/to/some.jsp\");\n+                    rego.addMapping(\"/somejsp/*\");\n+                }\n+                catch (Exception e)\n+                {\n+                    fail(e);\n+                }\n+            }\n+        }\n+        \n+        root.addBean(new MySCIStarter(root.getServletContext(), new JSPAddingSCI()), true);\n+        _server.start();\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDY3NjMxMg=="}, "originalCommit": {"oid": "8fc82bf4f4b22529efefb922e5129129488bddcd"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzc5MDM5NQ==", "bodyText": "Can we add a jspFile via this API in the test-spec webapp as an integration test?", "url": "https://github.com/eclipse/jetty.project/pull/4463#discussion_r367790395", "createdAt": "2020-01-17T06:49:37Z", "author": {"login": "gregw"}, "path": "jetty-servlet/src/test/java/org/eclipse/jetty/servlet/ServletContextHandlerTest.java", "diffHunk": "@@ -884,6 +884,38 @@ public void onStartup(Set<Class<?>> c, ServletContext ctx) throws ServletExcepti\n         assertThat(\"Response\", response, containsString(\"Hello World\"));\n     }\n \n+    @Test\n+    public void testAddJspFile() throws Exception\n+    {\n+        ContextHandlerCollection contexts = new ContextHandlerCollection();\n+        _server.setHandler(contexts);\n+\n+        ServletContextHandler root = new ServletContextHandler(contexts, \"/\");\n+        ServletHolder jspServlet = new ServletHolder();\n+        jspServlet.setName(\"jsp\");\n+        jspServlet.setHeldClass(FakeJspServlet.class);\n+        root.addServlet(jspServlet, \"*.jsp\");\n+        class JSPAddingSCI implements ServletContainerInitializer\n+        {\n+            @Override\n+            public void onStartup(Set<Class<?>> c, ServletContext ctx) throws ServletException\n+            {\n+                try\n+                {\n+                    ServletRegistration rego = ctx.addJspFile(\"some.jsp\", \"/path/to/some.jsp\");\n+                    rego.addMapping(\"/somejsp/*\");\n+                }\n+                catch (Exception e)\n+                {\n+                    fail(e);\n+                }\n+            }\n+        }\n+        \n+        root.addBean(new MySCIStarter(root.getServletContext(), new JSPAddingSCI()), true);\n+        _server.start();\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDY3NjMxMg=="}, "originalCommit": {"oid": "8fc82bf4f4b22529efefb922e5129129488bddcd"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzc5OTM5NQ==", "bodyText": "That was already part of the initial commit: the test-spec-webapp calls addJsp via a ServletContainerInitiaizer.  See https://github.com/eclipse/jetty.project/blob/jetty-10.0.x-4433-addJspFile/tests/test-webapps/test-servlet-spec/test-container-initializer/src/main/java/com/acme/initializer/FooInitializer.java#L108 and https://github.com/eclipse/jetty.project/blob/jetty-10.0.x-4433-addJspFile/tests/test-webapps/test-servlet-spec/test-spec-webapp/src/main/java/com/acme/test/AnnotationTest.java#L255", "url": "https://github.com/eclipse/jetty.project/pull/4463#discussion_r367799395", "createdAt": "2020-01-17T07:27:41Z", "author": {"login": "janbartel"}, "path": "jetty-servlet/src/test/java/org/eclipse/jetty/servlet/ServletContextHandlerTest.java", "diffHunk": "@@ -884,6 +884,38 @@ public void onStartup(Set<Class<?>> c, ServletContext ctx) throws ServletExcepti\n         assertThat(\"Response\", response, containsString(\"Hello World\"));\n     }\n \n+    @Test\n+    public void testAddJspFile() throws Exception\n+    {\n+        ContextHandlerCollection contexts = new ContextHandlerCollection();\n+        _server.setHandler(contexts);\n+\n+        ServletContextHandler root = new ServletContextHandler(contexts, \"/\");\n+        ServletHolder jspServlet = new ServletHolder();\n+        jspServlet.setName(\"jsp\");\n+        jspServlet.setHeldClass(FakeJspServlet.class);\n+        root.addServlet(jspServlet, \"*.jsp\");\n+        class JSPAddingSCI implements ServletContainerInitializer\n+        {\n+            @Override\n+            public void onStartup(Set<Class<?>> c, ServletContext ctx) throws ServletException\n+            {\n+                try\n+                {\n+                    ServletRegistration rego = ctx.addJspFile(\"some.jsp\", \"/path/to/some.jsp\");\n+                    rego.addMapping(\"/somejsp/*\");\n+                }\n+                catch (Exception e)\n+                {\n+                    fail(e);\n+                }\n+            }\n+        }\n+        \n+        root.addBean(new MySCIStarter(root.getServletContext(), new JSPAddingSCI()), true);\n+        _server.start();\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDY3NjMxMg=="}, "originalCommit": {"oid": "8fc82bf4f4b22529efefb922e5129129488bddcd"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzgwMTI2MA==", "bodyText": "great!  can we then check that the test-distribution will see any fail for this?", "url": "https://github.com/eclipse/jetty.project/pull/4463#discussion_r367801260", "createdAt": "2020-01-17T07:35:41Z", "author": {"login": "gregw"}, "path": "jetty-servlet/src/test/java/org/eclipse/jetty/servlet/ServletContextHandlerTest.java", "diffHunk": "@@ -884,6 +884,38 @@ public void onStartup(Set<Class<?>> c, ServletContext ctx) throws ServletExcepti\n         assertThat(\"Response\", response, containsString(\"Hello World\"));\n     }\n \n+    @Test\n+    public void testAddJspFile() throws Exception\n+    {\n+        ContextHandlerCollection contexts = new ContextHandlerCollection();\n+        _server.setHandler(contexts);\n+\n+        ServletContextHandler root = new ServletContextHandler(contexts, \"/\");\n+        ServletHolder jspServlet = new ServletHolder();\n+        jspServlet.setName(\"jsp\");\n+        jspServlet.setHeldClass(FakeJspServlet.class);\n+        root.addServlet(jspServlet, \"*.jsp\");\n+        class JSPAddingSCI implements ServletContainerInitializer\n+        {\n+            @Override\n+            public void onStartup(Set<Class<?>> c, ServletContext ctx) throws ServletException\n+            {\n+                try\n+                {\n+                    ServletRegistration rego = ctx.addJspFile(\"some.jsp\", \"/path/to/some.jsp\");\n+                    rego.addMapping(\"/somejsp/*\");\n+                }\n+                catch (Exception e)\n+                {\n+                    fail(e);\n+                }\n+            }\n+        }\n+        \n+        root.addBean(new MySCIStarter(root.getServletContext(), new JSPAddingSCI()), true);\n+        _server.start();\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDY3NjMxMg=="}, "originalCommit": {"oid": "8fc82bf4f4b22529efefb922e5129129488bddcd"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzgxMTQzMQ==", "bodyText": "Done.", "url": "https://github.com/eclipse/jetty.project/pull/4463#discussion_r367811431", "createdAt": "2020-01-17T08:10:52Z", "author": {"login": "janbartel"}, "path": "jetty-servlet/src/test/java/org/eclipse/jetty/servlet/ServletContextHandlerTest.java", "diffHunk": "@@ -884,6 +884,38 @@ public void onStartup(Set<Class<?>> c, ServletContext ctx) throws ServletExcepti\n         assertThat(\"Response\", response, containsString(\"Hello World\"));\n     }\n \n+    @Test\n+    public void testAddJspFile() throws Exception\n+    {\n+        ContextHandlerCollection contexts = new ContextHandlerCollection();\n+        _server.setHandler(contexts);\n+\n+        ServletContextHandler root = new ServletContextHandler(contexts, \"/\");\n+        ServletHolder jspServlet = new ServletHolder();\n+        jspServlet.setName(\"jsp\");\n+        jspServlet.setHeldClass(FakeJspServlet.class);\n+        root.addServlet(jspServlet, \"*.jsp\");\n+        class JSPAddingSCI implements ServletContainerInitializer\n+        {\n+            @Override\n+            public void onStartup(Set<Class<?>> c, ServletContext ctx) throws ServletException\n+            {\n+                try\n+                {\n+                    ServletRegistration rego = ctx.addJspFile(\"some.jsp\", \"/path/to/some.jsp\");\n+                    rego.addMapping(\"/somejsp/*\");\n+                }\n+                catch (Exception e)\n+                {\n+                    fail(e);\n+                }\n+            }\n+        }\n+        \n+        root.addBean(new MySCIStarter(root.getServletContext(), new JSPAddingSCI()), true);\n+        _server.start();\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDY3NjMxMg=="}, "originalCommit": {"oid": "8fc82bf4f4b22529efefb922e5129129488bddcd"}, "originalPosition": 34}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2740, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}