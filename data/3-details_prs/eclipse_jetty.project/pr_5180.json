{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxNDIzMTAx", "number": 5180, "title": "Change the way ConnectorStatistics is added to the Servers Connectors", "bodyText": "We currently have ServerConnectionStatistics which extends ConnectionStatistics but is never even constructed and only ever used for its static method to add a new ConnectionStatistics to every connector on the server.\nI have moved the addToAllConnectors() method to be on Server and deprecated the ServerConnectionStatistics class.\nThis will make it easier to do things like add a IncludeExcludeConnectionStatistics with xml like:\n<Configure id=\"Server\" class=\"org.eclipse.jetty.server.Server\">\n  <Call name=\"addToAllConnectors\">\n    <Arg>\n      <New class=\"org.eclipse.jetty.io.IncludeExcludeConnectionStatistics\">\n        <Call name=\"include\" arg=\"org.eclipse.jetty.websocket.common.io.AbstractWebSocketConnection\"/>\n      </New>\n    </Arg>\n  </Call>\n</Configure>", "createdAt": "2020-08-21T05:56:59Z", "url": "https://github.com/eclipse/jetty.project/pull/5180", "merged": true, "mergeCommit": {"oid": "4dfcb807d8b7fda317cbd478063b347a2c927454"}, "closed": true, "closedAt": "2020-08-25T04:28:27Z", "author": {"login": "lachlan-roberts"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdA-NYfAH2gAyNDcxNDIzMTAxOjYyM2QxYmU3YzcxNmNjN2E4YzkwZjVkMGMzZTI4ZjI3NmJiOTNhYTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCL-fpAH2gAyNDcxNDIzMTAxOjhmYWE3MTgxOGY0NzlkYjVhOGNkMGQ3NGQ4ZTIwMzRkZjg3MmJiOTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "623d1be7c716cc7a8c90f5d0c3e28f276bb93aa5", "author": {"user": {"login": "lachlan-roberts", "name": "Lachlan"}}, "url": "https://github.com/eclipse/jetty.project/commit/623d1be7c716cc7a8c90f5d0c3e28f276bb93aa5", "committedDate": "2020-08-21T05:45:58Z", "message": "Change the way ConnectorStatistics is added to the Servers Connectors\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczNDMwNjE2", "url": "https://github.com/eclipse/jetty.project/pull/5180#pullrequestreview-473430616", "createdAt": "2020-08-24T12:50:07Z", "commit": {"oid": "623d1be7c716cc7a8c90f5d0c3e28f276bb93aa5"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxMjo1MDowN1rOHFiwqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxMjo1MDowN1rOHFiwqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTU3NDQ0Mg==", "bodyText": "maybe addBeanToAllConnectors()", "url": "https://github.com/eclipse/jetty.project/pull/5180#discussion_r475574442", "createdAt": "2020-08-24T12:50:07Z", "author": {"login": "gregw"}, "path": "examples/embedded/src/main/java/org/eclipse/jetty/embedded/OneServletContextJmxStats.java", "diffHunk": "@@ -45,7 +45,7 @@ public static Server createServer(int port)\n         context.addServlet(DefaultServlet.class, \"/\");\n \n         // Add Connector Statistics tracking to all connectors\n-        ServerConnectionStatistics.addToAllConnectors(server);\n+        server.addToAllConnectors(new ConnectionStatistics());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "623d1be7c716cc7a8c90f5d0c3e28f276bb93aa5"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczNTg0MTMz", "url": "https://github.com/eclipse/jetty.project/pull/5180#pullrequestreview-473584133", "createdAt": "2020-08-24T14:56:36Z", "commit": {"oid": "623d1be7c716cc7a8c90f5d0c3e28f276bb93aa5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxNDo1NjozNlrOHFo5Ug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxNDo1NjozNlrOHFo5Ug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTY3NDk2Mg==", "bodyText": "@gregw changing this to addBeanToAllConnectors will make this javadoc irrelevant.\nMaybe it is worth keeping it as a Listener method to keep this documentation around, it doesn't seem obvious that adding a Listener as a bean on a connector would add it for all new connections. Only other place I can see this mentioned is the javadoc for ConnectionStatistics which doesn't seem the right place.", "url": "https://github.com/eclipse/jetty.project/pull/5180#discussion_r475674962", "createdAt": "2020-08-24T14:56:36Z", "author": {"login": "lachlan-roberts"}, "path": "jetty-server/src/main/java/org/eclipse/jetty/server/Server.java", "diffHunk": "@@ -265,6 +266,19 @@ public void setConnectors(Connector[] connectors)\n             _connectors.addAll(Arrays.asList(connectors));\n     }\n \n+    /**\n+     * Add a {@link Connection.Listener} as a bean to all connectors on the server, this\n+     * will register the listener with all connections accepted by the connectors.\n+     * @param listener the listener to be added.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "623d1be7c716cc7a8c90f5d0c3e28f276bb93aa5"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczNjM4Nzk5", "url": "https://github.com/eclipse/jetty.project/pull/5180#pullrequestreview-473638799", "createdAt": "2020-08-24T15:59:18Z", "commit": {"oid": "623d1be7c716cc7a8c90f5d0c3e28f276bb93aa5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxNTo1OToxOVrOHFrs-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxNTo1OToxOVrOHFrs-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTcyMDk1Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                /**\n          \n          \n            \n                 * Add a {@link Connection.Listener} as a bean to all connectors on the server, this\n          \n          \n            \n                 * will register the listener with all connections accepted by the connectors.\n          \n          \n            \n                 * @param listener the listener to be added.\n          \n          \n            \n                 */\n          \n          \n            \n                public void addToAllConnectors(Connection.Listener listener)\n          \n          \n            \n                {\n          \n          \n            \n                    for (Connector connector : getConnectors())\n          \n          \n            \n                    {\n          \n          \n            \n                        connector.addBean(listener);\n          \n          \n            \n                    }\n          \n          \n            \n                }\n          \n          \n            \n                /**\n          \n          \n            \n                 * Add a bean to all connectors on the server.\n          \n          \n            \n                 * If the bean is an instance of {@link Connection.Listener} it will also be \n          \n          \n            \n                 * registered as a listener on all connections accepted by the connectors.\n          \n          \n            \n                 * @param bean the bean to be added.\n          \n          \n            \n                 */\n          \n          \n            \n                public void addBeanToAllConnectors(Object bean)\n          \n          \n            \n                {\n          \n          \n            \n                    for (Connector connector : getConnectors())\n          \n          \n            \n                    {\n          \n          \n            \n                        connector.addBean(bean);\n          \n          \n            \n                    }\n          \n          \n            \n                }", "url": "https://github.com/eclipse/jetty.project/pull/5180#discussion_r475720953", "createdAt": "2020-08-24T15:59:19Z", "author": {"login": "gregw"}, "path": "jetty-server/src/main/java/org/eclipse/jetty/server/Server.java", "diffHunk": "@@ -265,6 +266,19 @@ public void setConnectors(Connector[] connectors)\n             _connectors.addAll(Arrays.asList(connectors));\n     }\n \n+    /**\n+     * Add a {@link Connection.Listener} as a bean to all connectors on the server, this\n+     * will register the listener with all connections accepted by the connectors.\n+     * @param listener the listener to be added.\n+     */\n+    public void addToAllConnectors(Connection.Listener listener)\n+    {\n+        for (Connector connector : getConnectors())\n+        {\n+            connector.addBean(listener);\n+        }\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "623d1be7c716cc7a8c90f5d0c3e28f276bb93aa5"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8faa71818f479db5a8cd0d74d8e2034df872bb96", "author": {"user": {"login": "lachlan-roberts", "name": "Lachlan"}}, "url": "https://github.com/eclipse/jetty.project/commit/8faa71818f479db5a8cd0d74d8e2034df872bb96", "committedDate": "2020-08-25T00:22:18Z", "message": "change addToAllConnectors method to addBeanToAllConnectors\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 301, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}