{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2MjUyODYy", "number": 4512, "title": "Issue #4247 use context default for samesite cookie attribute", "bodyText": "Implement allowing a default value for SameSite cookie attribute to be set on a context attribute. If a cookie is added to the response that has SameSite=null, then we use the context default value instead. If the context default value is null, then the cookie remains as SameSite=null.\nCloses #4247", "createdAt": "2020-01-23T09:04:25Z", "url": "https://github.com/eclipse/jetty.project/pull/4512", "merged": true, "mergeCommit": {"oid": "9850c29839c0d653954fbf91e1c20ed89f66fa96"}, "closed": true, "closedAt": "2020-01-29T10:05:36Z", "author": {"login": "janbartel"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb9GgEXAH2gAyMzY2MjUyODYyOmY1MjM3M2JlZTQ4ZmUzYjRlZjE2M2QxY2E3NGEzYWIzMmJjODY1Yjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_CpKsAFqTM0OTk2OTIwOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f52373bee48fe3b4ef163d1ca74a3ab32bc865b7", "author": {"user": {"login": "janbartel", "name": "Jan Bartel"}}, "url": "https://github.com/eclipse/jetty.project/commit/f52373bee48fe3b4ef163d1ca74a3ab32bc865b7", "committedDate": "2020-01-23T08:58:46Z", "message": "Issue #4247 use context default for samesite cookie attribute\n\nSigned-off-by: Jan Bartel <janb@webtide.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5Mzk1MTc2", "url": "https://github.com/eclipse/jetty.project/pull/4512#pullrequestreview-349395176", "createdAt": "2020-01-28T14:02:30Z", "commit": {"oid": "f52373bee48fe3b4ef163d1ca74a3ab32bc865b7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDowMjozMFrOFimBMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDowODoxMFrOFimNJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgxODgwMA==", "bodyText": "This should not be a log warn.... at least no a log warn on every single cookie set as that will be very verbose.\nI think debug is fine.", "url": "https://github.com/eclipse/jetty.project/pull/4512#discussion_r371818800", "createdAt": "2020-01-28T14:02:30Z", "author": {"login": "gregw"}, "path": "jetty-http/src/main/java/org/eclipse/jetty/http/HttpCookie.java", "diffHunk": "@@ -448,6 +460,39 @@ public static SameSite getSameSiteFromComment(String comment)\n         return null;\n     }\n \n+    /**\n+     * Get the default value for SameSite cookie attribute, if one\n+     * has been set for the given context.\n+     * \n+     * @param context the context to check for default SameSite value\n+     * @return the default SameSite value or null if one does not exist\n+     * @throws IllegalStateException if the default value is not a permitted value\n+     */\n+    public static SameSite getSameSiteDefault(ServletContext context)\n+    {\n+        if (context == null)\n+            return null;\n+        Object o = context.getAttribute(SAME_SITE_DEFAULT_ATTRIBUTE);\n+        if (o == null)\n+        {\n+            LOG.warn(\"No default value for SameSite\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f52373bee48fe3b4ef163d1ca74a3ab32bc865b7"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgxOTU1NA==", "bodyText": "You should use o.toString() rather than a cast.", "url": "https://github.com/eclipse/jetty.project/pull/4512#discussion_r371819554", "createdAt": "2020-01-28T14:04:06Z", "author": {"login": "gregw"}, "path": "jetty-http/src/main/java/org/eclipse/jetty/http/HttpCookie.java", "diffHunk": "@@ -448,6 +460,39 @@ public static SameSite getSameSiteFromComment(String comment)\n         return null;\n     }\n \n+    /**\n+     * Get the default value for SameSite cookie attribute, if one\n+     * has been set for the given context.\n+     * \n+     * @param context the context to check for default SameSite value\n+     * @return the default SameSite value or null if one does not exist\n+     * @throws IllegalStateException if the default value is not a permitted value\n+     */\n+    public static SameSite getSameSiteDefault(ServletContext context)\n+    {\n+        if (context == null)\n+            return null;\n+        Object o = context.getAttribute(SAME_SITE_DEFAULT_ATTRIBUTE);\n+        if (o == null)\n+        {\n+            LOG.warn(\"No default value for SameSite\");\n+            return null;\n+        }\n+        \n+        if (o instanceof SameSite)\n+            return (SameSite)o;\n+        \n+        try\n+        {\n+            return Enum.valueOf(SameSite.class, ((String)o).trim().toUpperCase(Locale.ENGLISH));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f52373bee48fe3b4ef163d1ca74a3ab32bc865b7"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgyMTg2MQ==", "bodyText": "Should we set the converted value back so that every cookie doesn't need to carry this cost???", "url": "https://github.com/eclipse/jetty.project/pull/4512#discussion_r371821861", "createdAt": "2020-01-28T14:08:10Z", "author": {"login": "gregw"}, "path": "jetty-http/src/main/java/org/eclipse/jetty/http/HttpCookie.java", "diffHunk": "@@ -448,6 +460,39 @@ public static SameSite getSameSiteFromComment(String comment)\n         return null;\n     }\n \n+    /**\n+     * Get the default value for SameSite cookie attribute, if one\n+     * has been set for the given context.\n+     * \n+     * @param context the context to check for default SameSite value\n+     * @return the default SameSite value or null if one does not exist\n+     * @throws IllegalStateException if the default value is not a permitted value\n+     */\n+    public static SameSite getSameSiteDefault(ServletContext context)\n+    {\n+        if (context == null)\n+            return null;\n+        Object o = context.getAttribute(SAME_SITE_DEFAULT_ATTRIBUTE);\n+        if (o == null)\n+        {\n+            LOG.warn(\"No default value for SameSite\");\n+            return null;\n+        }\n+        \n+        if (o instanceof SameSite)\n+            return (SameSite)o;\n+        \n+        try\n+        {\n+            return Enum.valueOf(SameSite.class, ((String)o).trim().toUpperCase(Locale.ENGLISH));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f52373bee48fe3b4ef163d1ca74a3ab32bc865b7"}, "originalPosition": 71}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "495dcfec074b7d0d4e0751d8eed8b5fe893a6dbd", "author": {"user": {"login": "janbartel", "name": "Jan Bartel"}}, "url": "https://github.com/eclipse/jetty.project/commit/495dcfec074b7d0d4e0751d8eed8b5fe893a6dbd", "committedDate": "2020-01-29T08:59:17Z", "message": "Issue #4247 changes after review\n\nSigned-off-by: Jan Bartel <janb@webtide.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5OTY5MjA5", "url": "https://github.com/eclipse/jetty.project/pull/4512#pullrequestreview-349969209", "createdAt": "2020-01-29T09:36:56Z", "commit": {"oid": "495dcfec074b7d0d4e0751d8eed8b5fe893a6dbd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 559, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}