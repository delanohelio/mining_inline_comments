{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0Nzk0MTIy", "number": 5692, "title": "HttpInput may skip setting fill interest", "bodyText": "@gregw @lorban the first commit is logging improvements, the second commit is the actual fix.", "createdAt": "2020-11-20T15:53:46Z", "url": "https://github.com/eclipse/jetty.project/pull/5692", "merged": true, "mergeCommit": {"oid": "d9b9235919c682e372116a12645165e0dab72345"}, "closed": true, "closedAt": "2020-11-23T12:24:56Z", "author": {"login": "sbordet"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdeZZdgAH2gAyNTI0Nzk0MTIyOjhlZGI1Y2ZjMjRiMzQ0OTcxZDEzYmM1MjZhYjNmNmQ2NTg4OTNjNTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdfSKXXAFqTUzNjMxNTAyMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8edb5cfc24b344971d13bc526ab3f6d658893c53", "author": {"user": {"login": "sbordet", "name": "Simone Bordet"}}, "url": "https://github.com/eclipse/jetty.project/commit/8edb5cfc24b344971d13bc526ab3f6d658893c53", "committedDate": "2020-11-20T15:50:24Z", "message": "Issue #5691 - HttpInput may skip setting fill interest.\n\nCode cleanups and logging improvements.\n\nSigned-off-by: Simone Bordet <simone.bordet@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4654335fdbcbb51e2f6981a556c9ab513d82135b", "author": {"user": {"login": "sbordet", "name": "Simone Bordet"}}, "url": "https://github.com/eclipse/jetty.project/commit/4654335fdbcbb51e2f6981a556c9ab513d82135b", "committedDate": "2020-11-20T15:52:14Z", "message": "Fixes #5691 - HttpInput may skip setting fill interest.\n\nHttpInput.run() now uses contentProvider.isReady() to ensure that\nif there is no content, the fill interest is set.\n\nAsyncContentProvider.isReady() is now looping if there is content\nbut it cannot be transformed (e.g. too few gzipped bytes).\n\nSigned-off-by: Simone Bordet <simone.bordet@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NjYzNTQx", "url": "https://github.com/eclipse/jetty.project/pull/5692#pullrequestreview-535663541", "createdAt": "2020-11-20T18:04:59Z", "commit": {"oid": "4654335fdbcbb51e2f6981a556c9ab513d82135b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxODowNDo1OVrOH3bY4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxODowNDo1OVrOH3bY4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzg4MjQ2Nw==", "bodyText": "I think this method is correct, but I think it would read better as:\npublic boolean isReady()\n{\n    HttpInput.Content content = nextTransformedContent();\n    if (content != null)\n    {\n        // TODO do we really need to call onContentAdded in this case??? I don't think so as we have not called onReadUnready\n        return true;\n    }\n            \n   _httpChannel.getState().onReadUnready();\n    while (_httpChannel.needContent())\n    {\n        HttpInput.Content content = nextTransformedContent();\n        if (content != null)\n        {\n            _httpChannel.getState().onContentAdded();\n            return true;\n        }\n        _httpChannel.getState().onReadUnready();\n    }\n\n    return false;\n}", "url": "https://github.com/eclipse/jetty.project/pull/5692#discussion_r527882467", "createdAt": "2020-11-20T18:04:59Z", "author": {"login": "gregw"}, "path": "jetty-server/src/main/java/org/eclipse/jetty/server/AsyncContentProducer.java", "diffHunk": "@@ -222,24 +222,39 @@ public boolean isReady()\n         if (content == null)\n         {\n             _httpChannel.getState().onReadUnready();\n-            if (_httpChannel.needContent())\n+            while (true)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4654335fdbcbb51e2f6981a556c9ab513d82135b"}, "originalPosition": 119}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2c08188119456bd1d739505f3f487fd2eabf1d0", "author": {"user": {"login": "sbordet", "name": "Simone Bordet"}}, "url": "https://github.com/eclipse/jetty.project/commit/a2c08188119456bd1d739505f3f487fd2eabf1d0", "committedDate": "2020-11-20T18:10:55Z", "message": "Merged branch 'jetty-10.0.x' into 'jetty-10.0.x-5691-httpinput_skip_fill_interest'."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ac0af4a76a91b6b78627a37e772d51cabe7b363", "author": {"user": {"login": "sbordet", "name": "Simone Bordet"}}, "url": "https://github.com/eclipse/jetty.project/commit/1ac0af4a76a91b6b78627a37e772d51cabe7b363", "committedDate": "2020-11-21T15:40:12Z", "message": "Fixes #5691 - HttpInput may skip setting fill interest.\n\nUpdates after review.\n\nSigned-off-by: Simone Bordet <simone.bordet@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MjQ1MzM0", "url": "https://github.com/eclipse/jetty.project/pull/5692#pullrequestreview-536245334", "createdAt": "2020-11-23T08:18:09Z", "commit": {"oid": "1ac0af4a76a91b6b78627a37e772d51cabe7b363"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MzE1MDIy", "url": "https://github.com/eclipse/jetty.project/pull/5692#pullrequestreview-536315022", "createdAt": "2020-11-23T09:55:37Z", "commit": {"oid": "1ac0af4a76a91b6b78627a37e772d51cabe7b363"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwOTo1NTozN1rOH4GHzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwOTo1NzoyMlrOH4GMNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODU4MjYwNA==", "bodyText": "Can you add a TODO here to review if this is needed.... or @lorban  can you open an issue to check.  Eitherway, is unrelated to this PR", "url": "https://github.com/eclipse/jetty.project/pull/5692#discussion_r528582604", "createdAt": "2020-11-23T09:55:37Z", "author": {"login": "gregw"}, "path": "jetty-server/src/main/java/org/eclipse/jetty/server/AsyncContentProducer.java", "diffHunk": "@@ -219,39 +219,43 @@ public void reclaim(HttpInput.Content content)\n     public boolean isReady()\n     {\n         HttpInput.Content content = nextTransformedContent();\n-        if (content == null)\n+        if (content != null)\n+        {\n+            if (LOG.isDebugEnabled())\n+                LOG.debug(\"isReady(), got transformed content {} {}\", content, this);\n+            _httpChannel.getState().onContentAdded();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ac0af4a76a91b6b78627a37e772d51cabe7b363"}, "originalPosition": 123}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODU4MzczMg==", "bodyText": "So @lorban just double checking that we don't need to call onReadUnready in the body of this loop.... because onContentAdded is not called if we loop.", "url": "https://github.com/eclipse/jetty.project/pull/5692#discussion_r528583732", "createdAt": "2020-11-23T09:57:22Z", "author": {"login": "gregw"}, "path": "jetty-server/src/main/java/org/eclipse/jetty/server/AsyncContentProducer.java", "diffHunk": "@@ -219,39 +219,43 @@ public void reclaim(HttpInput.Content content)\n     public boolean isReady()\n     {\n         HttpInput.Content content = nextTransformedContent();\n-        if (content == null)\n+        if (content != null)\n+        {\n+            if (LOG.isDebugEnabled())\n+                LOG.debug(\"isReady(), got transformed content {} {}\", content, this);\n+            _httpChannel.getState().onContentAdded();\n+            return true;\n+        }\n+\n+        _httpChannel.getState().onReadUnready();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ac0af4a76a91b6b78627a37e772d51cabe7b363"}, "originalPosition": 127}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4970, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}