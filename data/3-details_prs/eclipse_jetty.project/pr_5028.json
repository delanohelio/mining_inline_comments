{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1Mjg4ODg5", "number": 5028, "title": "Issue #5020 Make servlets,filters,listeners beans again", "bodyText": "Closes #5020\nWith commit 9d37feb servlets, filters and listeners were removed as bean children of the ServletHandler. We think this was done to improve the output of dump() so that the servlets, filters and listeners would all be appropriately grouped together, rather than randomly listed. Having removed them as beans, a Container.Listener no longer receives addBean() events for them, and thus libraries apparently like Guice which were relying on these events to add further LifeCycle.Listeners were impacted.\nThis PR is to restore the servlets, filters and listeners as bean children of the ServletHandler, but ensuring that their special servlet-spec mandated lifecycle is respected whilst also retaining the special formatting in dump().", "createdAt": "2020-07-07T09:35:39Z", "url": "https://github.com/eclipse/jetty.project/pull/5028", "merged": true, "mergeCommit": {"oid": "b1e08ba4e0f7ad07be9ecaf2e5ad2f31f73540e1"}, "closed": true, "closedAt": "2020-07-14T09:20:21Z", "author": {"login": "janbartel"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyhuAkgH2gAyNDQ1Mjg4ODg5OmUwMDdmZDZlNDkzYzc3MTIwNmNhOTZlODgwNWRhY2IwYTJkMWE1Mzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczjUjmgFqTQ0NjM4NDA4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e007fd6e493c771206ca96e8805dacb0a2d1a537", "author": {"user": {"login": "janbartel", "name": "Jan Bartel"}}, "url": "https://github.com/eclipse/jetty.project/commit/e007fd6e493c771206ca96e8805dacb0a2d1a537", "committedDate": "2020-07-07T08:39:25Z", "message": "Issue #5020 Make servlets,filters,listeners beans again\n\nSigned-off-by: Jan Bartel <janb@webtide.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a5db40fb71d31f7894d8685734d1db41ff880ca", "author": {"user": {"login": "janbartel", "name": "Jan Bartel"}}, "url": "https://github.com/eclipse/jetty.project/commit/3a5db40fb71d31f7894d8685734d1db41ff880ca", "committedDate": "2020-07-07T12:04:55Z", "message": "Issue #5020 Add a test and fixes.\n\nSigned-off-by: Jan Bartel <janb@webtide.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MDI5NTA2", "url": "https://github.com/eclipse/jetty.project/pull/5028#pullrequestreview-444029506", "createdAt": "2020-07-07T15:55:17Z", "commit": {"oid": "3a5db40fb71d31f7894d8685734d1db41ff880ca"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNTo1NToxN1rOGuFFiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNTo1NToxN1rOGuFFiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk3MTAxOQ==", "bodyText": "Why are we dumping this new Object() created on the fly?\nAt least it deserves a comment.", "url": "https://github.com/eclipse/jetty.project/pull/5028#discussion_r450971019", "createdAt": "2020-07-07T15:55:17Z", "author": {"login": "sbordet"}, "path": "jetty-util/src/main/java/org/eclipse/jetty/util/component/Dumpable.java", "diffHunk": "@@ -155,41 +156,51 @@ static void dumpObjects(Appendable out, String indent, Object object, Object...\n \n         if (object instanceof Container)\n         {\n-            dumpContainer(out, indent, (Container)object, extras == 0);\n+            dumpContainer(out, indent, (Container)object, list);\n         }\n         if (object instanceof Iterable)\n         {\n-            dumpIterable(out, indent, (Iterable<?>)object, extras == 0);\n+            dumpIterable(out, indent, (Iterable<?>)object, list);\n         }\n         else if (object instanceof Map)\n         {\n-            dumpMapEntries(out, indent, (Map<?, ?>)object, extras == 0);\n+            dumpMapEntries(out, indent, (Map<?, ?>)object, list);\n         }\n \n-        if (extras == 0)\n+        if (list.size() == 0)\n             return;\n \n         int i = 0;\n         for (Object item : extraChildren)\n         {\n             i++;\n-            String nextIndent = indent + (i < extras ? \"|  \" : \"   \");\n+            String nextIndent = indent + (i < list.size() ? \"|  \" : \"   \");\n             out.append(indent).append(\"+> \");\n             if (item instanceof Dumpable)\n                 ((Dumpable)item).dump(out, nextIndent);\n             else\n                 dumpObjects(out, nextIndent, item);\n         }\n     }\n-\n+    \n+    @Deprecated\n     static void dumpContainer(Appendable out, String indent, Container object, boolean last) throws IOException\n+    {\n+        dumpContainer(out, indent, object, (last ? Collections.emptyList() : Collections.singletonList(new Object())));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3a5db40fb71d31f7894d8685734d1db41ff880ca"}, "originalPosition": 60}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3a4187666b2b7f89f37e2581dca3d154b32720a", "author": {"user": {"login": "janbartel", "name": "Jan Bartel"}}, "url": "https://github.com/eclipse/jetty.project/commit/e3a4187666b2b7f89f37e2581dca3d154b32720a", "committedDate": "2020-07-08T09:08:11Z", "message": "Issue #5020 Reimplement after review\n\nSigned-off-by: Jan Bartel <janb@webtide.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0Njc2OTE3", "url": "https://github.com/eclipse/jetty.project/pull/5028#pullrequestreview-444676917", "createdAt": "2020-07-08T11:53:42Z", "commit": {"oid": "e3a4187666b2b7f89f37e2581dca3d154b32720a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxMTo1Mzo0MlrOGukZow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxMTo1Mzo0MlrOGukZow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQ4NDA2Nw==", "bodyText": "OK, This is a actually a much better way to accomplish this.", "url": "https://github.com/eclipse/jetty.project/pull/5028#discussion_r451484067", "createdAt": "2020-07-08T11:53:42Z", "author": {"login": "joakime"}, "path": "jetty-util/src/main/java/org/eclipse/jetty/util/component/Dumpable.java", "diffHunk": "@@ -181,14 +181,18 @@ else if (object instanceof Map)\n                 dumpObjects(out, nextIndent, item);\n         }\n     }\n-\n+    \n     static void dumpContainer(Appendable out, String indent, Container object, boolean last) throws IOException\n     {\n         Container container = object;\n         ContainerLifeCycle containerLifeCycle = container instanceof ContainerLifeCycle ? (ContainerLifeCycle)container : null;\n         for (Iterator<Object> i = container.getBeans().iterator(); i.hasNext(); )\n         {\n             Object bean = i.next();\n+\n+            if (container instanceof DumpableContainer && !((DumpableContainer)container).isDumpable(bean))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3a4187666b2b7f89f37e2581dca3d154b32720a"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0NzYzMTM1", "url": "https://github.com/eclipse/jetty.project/pull/5028#pullrequestreview-444763135", "createdAt": "2020-07-08T13:27:47Z", "commit": {"oid": "e3a4187666b2b7f89f37e2581dca3d154b32720a"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxMzoyNzo0N1rOGuoBdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxMzozMDo0NlrOGuoJ9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU0MzQxNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (o instanceof Holder || o instanceof BaseHolder || o instanceof FilterMapping || o instanceof ServletMapping)\n          \n          \n            \n                        return false;\n          \n          \n            \n                    return true;\n          \n          \n            \n                    return !(o instanceof Holder || o instanceof BaseHolder || o instanceof FilterMapping || o instanceof ServletMapping);", "url": "https://github.com/eclipse/jetty.project/pull/5028#discussion_r451543415", "createdAt": "2020-07-08T13:27:47Z", "author": {"login": "gregw"}, "path": "jetty-servlet/src/main/java/org/eclipse/jetty/servlet/ServletHandler.java", "diffHunk": "@@ -133,6 +133,14 @@ public ServletHandler()\n     {\n     }\n \n+    @Override\n+    public boolean isDumpable(Object o)\n+    {\n+        if (o instanceof Holder || o instanceof BaseHolder || o instanceof FilterMapping || o instanceof ServletMapping)\n+            return false;\n+        return true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3a4187666b2b7f89f37e2581dca3d154b32720a"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU0NTU5MA==", "bodyText": "Can dumpContainer be moved to be a static method of DumpableContainer to keep those concepts together?", "url": "https://github.com/eclipse/jetty.project/pull/5028#discussion_r451545590", "createdAt": "2020-07-08T13:30:46Z", "author": {"login": "gregw"}, "path": "jetty-util/src/main/java/org/eclipse/jetty/util/component/Dumpable.java", "diffHunk": "@@ -181,14 +181,18 @@ else if (object instanceof Map)\n                 dumpObjects(out, nextIndent, item);\n         }\n     }\n-\n+    \n     static void dumpContainer(Appendable out, String indent, Container object, boolean last) throws IOException\n     {\n         Container container = object;\n         ContainerLifeCycle containerLifeCycle = container instanceof ContainerLifeCycle ? (ContainerLifeCycle)container : null;\n         for (Iterator<Object> i = container.getBeans().iterator(); i.hasNext(); )\n         {\n             Object bean = i.next();\n+\n+            if (container instanceof DumpableContainer && !((DumpableContainer)container).isDumpable(bean))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQ4NDA2Nw=="}, "originalCommit": {"oid": "e3a4187666b2b7f89f37e2581dca3d154b32720a"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "572f2a806a9bd195b431bc061e2577f2b0332ede", "author": {"user": {"login": "janbartel", "name": "Jan Bartel"}}, "url": "https://github.com/eclipse/jetty.project/commit/572f2a806a9bd195b431bc061e2577f2b0332ede", "committedDate": "2020-07-08T20:28:23Z", "message": "Update jetty-servlet/src/main/java/org/eclipse/jetty/servlet/ServletHandler.java\n\nCo-authored-by: Greg Wilkins <gregw@webtide.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NzcwMzAx", "url": "https://github.com/eclipse/jetty.project/pull/5028#pullrequestreview-445770301", "createdAt": "2020-07-09T16:16:03Z", "commit": {"oid": "572f2a806a9bd195b431bc061e2577f2b0332ede"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNjoxNjowM1rOGvYU4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNjoxNzoxMFrOGvYXmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzNDgxNw==", "bodyText": "Empty line!", "url": "https://github.com/eclipse/jetty.project/pull/5028#discussion_r452334817", "createdAt": "2020-07-09T16:16:03Z", "author": {"login": "sbordet"}, "path": "jetty-util/src/main/java/org/eclipse/jetty/util/component/DumpableContainer.java", "diffHunk": "@@ -0,0 +1,36 @@\n+//\n+//  ========================================================================\n+//  Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//  ------------------------------------------------------------------------\n+//  All rights reserved. This program and the accompanying materials\n+//  are made available under the terms of the Eclipse Public License v1.0\n+//  and Apache License v2.0 which accompanies this distribution.\n+//\n+//      The Eclipse Public License is available at\n+//      http://www.eclipse.org/legal/epl-v10.html\n+//\n+//      The Apache License v2.0 is available at\n+//      http://www.opensource.org/licenses/apache2.0.php\n+//\n+//  You may elect to redistribute this code under either of these licenses.\n+//  ========================================================================\n+//\n+\n+package org.eclipse.jetty.util.component;\n+\n+/**\n+ * DumpableContainer\n+ * \n+ * A Dumpable that is a container of beans can implement this\n+ * interface to allow it to refine which of its beans can be\n+ * ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "572f2a806a9bd195b431bc061e2577f2b0332ede"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzNDk3OA==", "bodyText": "Double space after interface!", "url": "https://github.com/eclipse/jetty.project/pull/5028#discussion_r452334978", "createdAt": "2020-07-09T16:16:20Z", "author": {"login": "sbordet"}, "path": "jetty-util/src/main/java/org/eclipse/jetty/util/component/DumpableContainer.java", "diffHunk": "@@ -0,0 +1,36 @@\n+//\n+//  ========================================================================\n+//  Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//  ------------------------------------------------------------------------\n+//  All rights reserved. This program and the accompanying materials\n+//  are made available under the terms of the Eclipse Public License v1.0\n+//  and Apache License v2.0 which accompanies this distribution.\n+//\n+//      The Eclipse Public License is available at\n+//      http://www.eclipse.org/legal/epl-v10.html\n+//\n+//      The Apache License v2.0 is available at\n+//      http://www.opensource.org/licenses/apache2.0.php\n+//\n+//  You may elect to redistribute this code under either of these licenses.\n+//  ========================================================================\n+//\n+\n+package org.eclipse.jetty.util.component;\n+\n+/**\n+ * DumpableContainer\n+ * \n+ * A Dumpable that is a container of beans can implement this\n+ * interface to allow it to refine which of its beans can be\n+ * \n+ */\n+public interface  DumpableContainer extends Dumpable", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "572f2a806a9bd195b431bc061e2577f2b0332ede"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzNTA0Mg==", "bodyText": "Empty line!", "url": "https://github.com/eclipse/jetty.project/pull/5028#discussion_r452335042", "createdAt": "2020-07-09T16:16:26Z", "author": {"login": "sbordet"}, "path": "jetty-util/src/main/java/org/eclipse/jetty/util/component/DumpableContainer.java", "diffHunk": "@@ -0,0 +1,36 @@\n+//\n+//  ========================================================================\n+//  Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//  ------------------------------------------------------------------------\n+//  All rights reserved. This program and the accompanying materials\n+//  are made available under the terms of the Eclipse Public License v1.0\n+//  and Apache License v2.0 which accompanies this distribution.\n+//\n+//      The Eclipse Public License is available at\n+//      http://www.eclipse.org/legal/epl-v10.html\n+//\n+//      The Apache License v2.0 is available at\n+//      http://www.opensource.org/licenses/apache2.0.php\n+//\n+//  You may elect to redistribute this code under either of these licenses.\n+//  ========================================================================\n+//\n+\n+package org.eclipse.jetty.util.component;\n+\n+/**\n+ * DumpableContainer\n+ * \n+ * A Dumpable that is a container of beans can implement this\n+ * interface to allow it to refine which of its beans can be\n+ * \n+ */\n+public interface  DumpableContainer extends Dumpable\n+{\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "572f2a806a9bd195b431bc061e2577f2b0332ede"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzNTEwNA==", "bodyText": "Empty line!", "url": "https://github.com/eclipse/jetty.project/pull/5028#discussion_r452335104", "createdAt": "2020-07-09T16:16:32Z", "author": {"login": "sbordet"}, "path": "jetty-util/src/main/java/org/eclipse/jetty/util/component/DumpableContainer.java", "diffHunk": "@@ -0,0 +1,36 @@\n+//\n+//  ========================================================================\n+//  Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//  ------------------------------------------------------------------------\n+//  All rights reserved. This program and the accompanying materials\n+//  are made available under the terms of the Eclipse Public License v1.0\n+//  and Apache License v2.0 which accompanies this distribution.\n+//\n+//      The Eclipse Public License is available at\n+//      http://www.eclipse.org/legal/epl-v10.html\n+//\n+//      The Apache License v2.0 is available at\n+//      http://www.opensource.org/licenses/apache2.0.php\n+//\n+//  You may elect to redistribute this code under either of these licenses.\n+//  ========================================================================\n+//\n+\n+package org.eclipse.jetty.util.component;\n+\n+/**\n+ * DumpableContainer\n+ * \n+ * A Dumpable that is a container of beans can implement this\n+ * interface to allow it to refine which of its beans can be\n+ * \n+ */\n+public interface  DumpableContainer extends Dumpable\n+{\n+\n+    default boolean isDumpable(Object o)\n+    {\n+        return true;\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "572f2a806a9bd195b431bc061e2577f2b0332ede"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzNTUxNA==", "bodyText": "I would move this simple class as an inner class of Dumpable, namely Dumpable.Container.", "url": "https://github.com/eclipse/jetty.project/pull/5028#discussion_r452335514", "createdAt": "2020-07-09T16:17:10Z", "author": {"login": "sbordet"}, "path": "jetty-util/src/main/java/org/eclipse/jetty/util/component/DumpableContainer.java", "diffHunk": "@@ -0,0 +1,36 @@\n+//\n+//  ========================================================================\n+//  Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//  ------------------------------------------------------------------------\n+//  All rights reserved. This program and the accompanying materials\n+//  are made available under the terms of the Eclipse Public License v1.0\n+//  and Apache License v2.0 which accompanies this distribution.\n+//\n+//      The Eclipse Public License is available at\n+//      http://www.eclipse.org/legal/epl-v10.html\n+//\n+//      The Apache License v2.0 is available at\n+//      http://www.opensource.org/licenses/apache2.0.php\n+//\n+//  You may elect to redistribute this code under either of these licenses.\n+//  ========================================================================\n+//\n+\n+package org.eclipse.jetty.util.component;\n+\n+/**\n+ * DumpableContainer\n+ * \n+ * A Dumpable that is a container of beans can implement this\n+ * interface to allow it to refine which of its beans can be\n+ * \n+ */\n+public interface  DumpableContainer extends Dumpable", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzNDk3OA=="}, "originalCommit": {"oid": "572f2a806a9bd195b431bc061e2577f2b0332ede"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e096ffb5972abeb52d21b758f2211d7a62bee2be", "author": {"user": {"login": "janbartel", "name": "Jan Bartel"}}, "url": "https://github.com/eclipse/jetty.project/commit/e096ffb5972abeb52d21b758f2211d7a62bee2be", "committedDate": "2020-07-09T19:35:55Z", "message": "Issue #5020 Make DumpableContainer a subclass of Dumpable\n\nSigned-off-by: Jan Bartel <janb@webtide.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2Mzg0MDg3", "url": "https://github.com/eclipse/jetty.project/pull/5028#pullrequestreview-446384087", "createdAt": "2020-07-10T13:05:21Z", "commit": {"oid": "e096ffb5972abeb52d21b758f2211d7a62bee2be"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 358, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}