{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM2NDc3MTEz", "number": 5797, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwODo1Mzo0MlrOFD4ZFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwODo1Mzo0MlrOFD4ZFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5NjEzOTc1OnYy", "diffSide": "RIGHT", "path": "jetty-server/src/main/java/org/eclipse/jetty/server/ServerConnector.java", "isResolved": false, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwODo1Mzo0MlrOIDvAFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwOToxMzowMlrOIFGqwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc4NjcxMA==", "bodyText": "Can you please rework this fix to use try-with-resources, so there is no need of an explicit close?", "url": "https://github.com/eclipse/jetty.project/pull/5797#discussion_r540786710", "createdAt": "2020-12-11T08:53:42Z", "author": {"login": "sbordet"}, "path": "jetty-server/src/main/java/org/eclipse/jetty/server/ServerConnector.java", "diffHunk": "@@ -346,6 +346,14 @@ protected ServerSocketChannel openAcceptChannel() throws IOException\n             }\n             catch (BindException e)\n             {\n+                try\n+                {\n+                    serverChannel.close();\n+                }\n+                catch (IOException ioe)\n+                {\n+                    LOG.warn(ioe);\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7d4b940a2e360c9d7b1d1a946e7828f347c2788"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTU4MDg1NQ==", "bodyText": "We only want the serverChannel closed if the BindException occurs.  Otherwise it needs to be returned to the caller in an open state.  I don't believe try-with-resources is what we want here but let me know if I misunderstood.", "url": "https://github.com/eclipse/jetty.project/pull/5797#discussion_r541580855", "createdAt": "2020-12-12T13:56:31Z", "author": {"login": "joewitt"}, "path": "jetty-server/src/main/java/org/eclipse/jetty/server/ServerConnector.java", "diffHunk": "@@ -346,6 +346,14 @@ protected ServerSocketChannel openAcceptChannel() throws IOException\n             }\n             catch (BindException e)\n             {\n+                try\n+                {\n+                    serverChannel.close();\n+                }\n+                catch (IOException ioe)\n+                {\n+                    LOG.warn(ioe);\n+                }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc4NjcxMA=="}, "originalCommit": {"oid": "f7d4b940a2e360c9d7b1d1a946e7828f347c2788"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTYyNzA5NA==", "bodyText": "@sbordet try-with-resources doesn't work in this case as we use the socket in the successful case...  actually probably should null out the field... just in case....", "url": "https://github.com/eclipse/jetty.project/pull/5797#discussion_r541627094", "createdAt": "2020-12-12T15:41:56Z", "author": {"login": "gregw"}, "path": "jetty-server/src/main/java/org/eclipse/jetty/server/ServerConnector.java", "diffHunk": "@@ -346,6 +346,14 @@ protected ServerSocketChannel openAcceptChannel() throws IOException\n             }\n             catch (BindException e)\n             {\n+                try\n+                {\n+                    serverChannel.close();\n+                }\n+                catch (IOException ioe)\n+                {\n+                    LOG.warn(ioe);\n+                }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc4NjcxMA=="}, "originalCommit": {"oid": "f7d4b940a2e360c9d7b1d1a946e7828f347c2788"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTYzMDMwMg==", "bodyText": "Actually no fields were set, but there was one already in a try-with-resources, so backed the change out of that one.", "url": "https://github.com/eclipse/jetty.project/pull/5797#discussion_r541630302", "createdAt": "2020-12-12T15:47:38Z", "author": {"login": "gregw"}, "path": "jetty-server/src/main/java/org/eclipse/jetty/server/ServerConnector.java", "diffHunk": "@@ -346,6 +346,14 @@ protected ServerSocketChannel openAcceptChannel() throws IOException\n             }\n             catch (BindException e)\n             {\n+                try\n+                {\n+                    serverChannel.close();\n+                }\n+                catch (IOException ioe)\n+                {\n+                    LOG.warn(ioe);\n+                }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc4NjcxMA=="}, "originalCommit": {"oid": "f7d4b940a2e360c9d7b1d1a946e7828f347c2788"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTYzMzM1Ng==", "bodyText": "Looks like the serverChannel is within the method scope so nothing to null out. I looked at the caller scope or otherwise to see if there was a better place to adjust the close (such as a try with resources).  And I'm not seeing that.  For the specific issue observed the change as I have it closes that problem.  If this is part of a larger concern I'm not sure I follow.  Do you need any change from the patch as-is?", "url": "https://github.com/eclipse/jetty.project/pull/5797#discussion_r541633356", "createdAt": "2020-12-12T15:53:29Z", "author": {"login": "joewitt"}, "path": "jetty-server/src/main/java/org/eclipse/jetty/server/ServerConnector.java", "diffHunk": "@@ -346,6 +346,14 @@ protected ServerSocketChannel openAcceptChannel() throws IOException\n             }\n             catch (BindException e)\n             {\n+                try\n+                {\n+                    serverChannel.close();\n+                }\n+                catch (IOException ioe)\n+                {\n+                    LOG.warn(ioe);\n+                }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc4NjcxMA=="}, "originalCommit": {"oid": "f7d4b940a2e360c9d7b1d1a946e7828f347c2788"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIxNzcxNw==", "bodyText": "Re: using try-with-resources: doh :)\n@gregw #5802 is the same fix? @joewitt can you use IO.close() instead? Also, I think we want to catch everything that may possibly be throws after ServerSocketChannel.open(), so I would widen the try scope.", "url": "https://github.com/eclipse/jetty.project/pull/5797#discussion_r542217717", "createdAt": "2020-12-14T09:04:57Z", "author": {"login": "sbordet"}, "path": "jetty-server/src/main/java/org/eclipse/jetty/server/ServerConnector.java", "diffHunk": "@@ -346,6 +346,14 @@ protected ServerSocketChannel openAcceptChannel() throws IOException\n             }\n             catch (BindException e)\n             {\n+                try\n+                {\n+                    serverChannel.close();\n+                }\n+                catch (IOException ioe)\n+                {\n+                    LOG.warn(ioe);\n+                }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc4NjcxMA=="}, "originalCommit": {"oid": "f7d4b940a2e360c9d7b1d1a946e7828f347c2788"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIyMzA0MA==", "bodyText": "Incorporating this change within #5802.", "url": "https://github.com/eclipse/jetty.project/pull/5797#discussion_r542223040", "createdAt": "2020-12-14T09:13:02Z", "author": {"login": "sbordet"}, "path": "jetty-server/src/main/java/org/eclipse/jetty/server/ServerConnector.java", "diffHunk": "@@ -346,6 +346,14 @@ protected ServerSocketChannel openAcceptChannel() throws IOException\n             }\n             catch (BindException e)\n             {\n+                try\n+                {\n+                    serverChannel.close();\n+                }\n+                catch (IOException ioe)\n+                {\n+                    LOG.warn(ioe);\n+                }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc4NjcxMA=="}, "originalCommit": {"oid": "f7d4b940a2e360c9d7b1d1a946e7828f347c2788"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2088, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}