{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3NzkyODMx", "number": 5396, "title": "Issue #5394 Fix injection for quickstart", "bodyText": "Closes #5394\nResource injection was broken with jetty-10 and quickstart. We made changes to accord with the servlet tck tests and servlet 4.0 clarifications that if a web descriptor was metadata-complete, we would not do resource injections. The descriptor that quickstart generated was marked as metadata-complete, thus we did not do resource injections.  I think it is incorrect to mark the quickstart-web.xml as metadata-complete: according to the clarified wording of the spec section 8.1, it would only be metadata-complete iff it contained the declarative equivalents of all resource injection annotations (and others like post-construct, pre-destroy etc etc). As jetty \"introspects\" to find these kind of annotations at the point at which an object is going into service, rather than during the blanket annotation code-scan,  the quickstart-web.xml will never contain them and thus cannot be considered metadata-complete.\nSo, the solution is to simply mark the generated quickstart-web.xml as metadata-complete=false.\nI've also changed one of the quickstart tests to really check properly for injection/post-construct etc happening correctly - previously the test was just testing if the webapp got deployed by retrieving static content, which is not sufficient.", "createdAt": "2020-10-05T11:41:59Z", "url": "https://github.com/eclipse/jetty.project/pull/5396", "merged": true, "mergeCommit": {"oid": "6ddbec3c62852a192f946ccfc9502d8527cd7af9"}, "closed": true, "closedAt": "2020-10-06T11:43:42Z", "author": {"login": "janbartel"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdPhq9CgH2gAyNDk3NzkyODMxOmZhMmMzYjJlOTNhOGNlOTczZTZiZGUwNmMwYjUzZTQ4ODY5ZDQ5ZTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdP107ogFqTUwMjc5NzY0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fa2c3b2e93a8ce973e6bde06c0b53e48869d49e0", "author": {"user": {"login": "janbartel", "name": "Jan Bartel"}}, "url": "https://github.com/eclipse/jetty.project/commit/fa2c3b2e93a8ce973e6bde06c0b53e48869d49e0", "committedDate": "2020-10-05T10:59:53Z", "message": "Issue #5394 Fix injection for quickstart\n\nSigned-off-by: Jan Bartel <janb@webtide.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNTEzOTAy", "url": "https://github.com/eclipse/jetty.project/pull/5396#pullrequestreview-502513902", "createdAt": "2020-10-06T00:50:15Z", "commit": {"oid": "fa2c3b2e93a8ce973e6bde06c0b53e48869d49e0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNTE0MTUx", "url": "https://github.com/eclipse/jetty.project/pull/5396#pullrequestreview-502514151", "createdAt": "2020-10-06T00:51:03Z", "commit": {"oid": "fa2c3b2e93a8ce973e6bde06c0b53e48869d49e0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwMDo1MTowM1rOHcyaSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwMDo1MTowM1rOHcyaSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTk0ODEwNg==", "bodyText": "take care when merging to 11 ;)", "url": "https://github.com/eclipse/jetty.project/pull/5396#discussion_r499948106", "createdAt": "2020-10-06T00:51:03Z", "author": {"login": "olamy"}, "path": "jetty-quickstart/src/main/java/org/eclipse/jetty/quickstart/PreconfigureQuickStartWar.java", "diffHunk": "@@ -109,7 +110,7 @@ public static void preconfigure(Resource war, Resource dir, Resource xml) throws\n                                 new AnnotationConfiguration());\n         webapp.setAttribute(QuickStartConfiguration.MODE, QuickStartConfiguration.Mode.GENERATE);\n         webapp.setAttribute(QuickStartConfiguration.ORIGIN_ATTRIBUTE, \"\");\n-\n+        webapp.setAttribute(MetaInfConfiguration.CONTAINER_JAR_PATTERN, \".*/jetty-servlet-api-[^/]*\\\\.jar$|.*/javax.servlet.jsp.jstl-.*\\\\.jar$|.*/org.apache.taglibs.taglibs-standard-impl-.*\\\\.jar$\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa2c3b2e93a8ce973e6bde06c0b53e48869d49e0"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNjUzOTgw", "url": "https://github.com/eclipse/jetty.project/pull/5396#pullrequestreview-502653980", "createdAt": "2020-10-06T07:28:46Z", "commit": {"oid": "fa2c3b2e93a8ce973e6bde06c0b53e48869d49e0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwNzoyODo0NlrOHc5TmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwNzoyODo0NlrOHc5TmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA2MTA4MQ==", "bodyText": "Surely this should not be hard coded to false, but take the value from the main web.xml\nOf course there will be issues if some fragments are complete and others are not!!!", "url": "https://github.com/eclipse/jetty.project/pull/5396#discussion_r500061081", "createdAt": "2020-10-06T07:28:46Z", "author": {"login": "gregw"}, "path": "jetty-quickstart/src/main/java/org/eclipse/jetty/quickstart/QuickStartGeneratorConfiguration.java", "diffHunk": "@@ -157,7 +157,7 @@ public void generateQuickStartWebXml(WebAppContext context, OutputStream stream)\n         webappAttr.put(\"xmlns\", \"http://xmlns.jcp.org/xml/ns/javaee\");\n         webappAttr.put(\"xmlns:xsi\", \"http://www.w3.org/2001/XMLSchema-instance\");\n         webappAttr.put(\"xsi:schemaLocation\", \"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_\" + (major + \"_\" + minor) + \".xsd\");\n-        webappAttr.put(\"metadata-complete\", \"true\");\n+        webappAttr.put(\"metadata-complete\", \"false\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa2c3b2e93a8ce973e6bde06c0b53e48869d49e0"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f6e0ee51bca25909ea0e7cb62d7d384476a910c", "author": {"user": {"login": "janbartel", "name": "Jan Bartel"}}, "url": "https://github.com/eclipse/jetty.project/commit/3f6e0ee51bca25909ea0e7cb62d7d384476a910c", "committedDate": "2020-10-06T08:58:23Z", "message": "Issue #5394 Set quickstart metadatacomplete based on web.xml value\n\nSigned-off-by: Jan Bartel <janb@webtide.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNzk3NjQ3", "url": "https://github.com/eclipse/jetty.project/pull/5396#pullrequestreview-502797647", "createdAt": "2020-10-06T10:28:53Z", "commit": {"oid": "3f6e0ee51bca25909ea0e7cb62d7d384476a910c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 19, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}