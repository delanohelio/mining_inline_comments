{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIzMTI0ODgw", "number": 4910, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxMjo0NjoxMVrOD_qC3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxMjo0OTowMFrOD_qHKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MDc1NzQzOnYy", "diffSide": "RIGHT", "path": "tests/test-sessions/test-jdbc-sessions/src/test/java/org/eclipse/jetty/server/session/JdbcTestHelper.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxMjo0NjoxMVrOGacj8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxMjo0NjoxMVrOGacj8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM4NDExMg==", "bodyText": "Still need to delete this line setting the derby property.", "url": "https://github.com/eclipse/jetty.project/pull/4910#discussion_r430384112", "createdAt": "2020-05-26T12:46:11Z", "author": {"login": "janbartel"}, "path": "tests/test-sessions/test-jdbc-sessions/src/test/java/org/eclipse/jetty/server/session/JdbcTestHelper.java", "diffHunk": "@@ -60,6 +68,39 @@\n     public static final String COOKIE_COL = \"cooktime\";\n     public static final String CREATE_COL = \"ctime\";\n \n+    static MariaDBContainer MARIAD_DB;\n+\n+    static final String MARIA_DB_USER = \"beer\";\n+    static final String MARIA_DB_PASSWORD = \"pacific_ale\";\n+\n+    static\n+    {\n+        try\n+        {\n+            long start = System.currentTimeMillis();\n+            MARIAD_DB =\n+                new MariaDBContainer(\"mariadb:\" + System.getProperty(\"mariadb.docker.version\", \"10.3.6\"))\n+                    .withUsername(MARIA_DB_USER)\n+                    .withPassword(MARIA_DB_PASSWORD)\n+                    .withDatabaseName(\"sessions\");\n+            MARIAD_DB.withLogConsumer(new Slf4jLogConsumer(MARIADB_LOG)).start();\n+            String containerIpAddress =  MARIAD_DB.getContainerIpAddress();\n+            int mariadbPort = MARIAD_DB.getMappedPort(3306);\n+            DEFAULT_CONNECTION_URL = MARIAD_DB.getJdbcUrl();\n+            DRIVER_CLASS = MARIAD_DB.getDriverClassName();\n+            LOG.info(\"Mariadb container started for {}:{} - {}ms\", containerIpAddress, mariadbPort,\n+                     System.currentTimeMillis() - start);\n+            DEFAULT_CONNECTION_URL = DEFAULT_CONNECTION_URL + \"?user=\" + MARIA_DB_USER +\n+                \"&password=\" + MARIA_DB_PASSWORD;\n+            LOG.info(\"DEFAULT_CONNECTION_URL: {}\", DEFAULT_CONNECTION_URL);\n+        }\n+        catch (Exception e)\n+        {\n+            LOG.error(e.getMessage(), e);\n+            throw new RuntimeException(e.getMessage(), e);\n+        }\n+    }\n+\n     static\n     {\n         System.setProperty(\"derby.system.home\", MavenTestingUtils.getTargetFile(\"test-derby\").getAbsolutePath());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95bc9cbcbfa8420cc57f2ed24b2619e37fcc27f6"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MDc2MTg3OnYy", "diffSide": "RIGHT", "path": "tests/test-sessions/test-jdbc-sessions/src/test/java/org/eclipse/jetty/server/session/SessionTableSchemaTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxMjo0NzoyNVrOGacmvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMToyODoyOFrOGaw9Gg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM4NDgzMA==", "bodyText": "Just out of interest, if the tables are dropped after every test, you don't need to make the id unique. Fine either way.", "url": "https://github.com/eclipse/jetty.project/pull/4910#discussion_r430384830", "createdAt": "2020-05-26T12:47:25Z", "author": {"login": "janbartel"}, "path": "tests/test-sessions/test-jdbc-sessions/src/test/java/org/eclipse/jetty/server/session/SessionTableSchemaTest.java", "diffHunk": "@@ -119,8 +117,10 @@ public void testLoad()\n         _da.initialize();\n         _tableSchema.prepareTables();\n \n+        String id = Long.toString(System.nanoTime());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95bc9cbcbfa8420cc57f2ed24b2619e37fcc27f6"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDcxODIzNA==", "bodyText": "ah yes I added that before truncate table after every tests.", "url": "https://github.com/eclipse/jetty.project/pull/4910#discussion_r430718234", "createdAt": "2020-05-26T21:28:28Z", "author": {"login": "olamy"}, "path": "tests/test-sessions/test-jdbc-sessions/src/test/java/org/eclipse/jetty/server/session/SessionTableSchemaTest.java", "diffHunk": "@@ -119,8 +117,10 @@ public void testLoad()\n         _da.initialize();\n         _tableSchema.prepareTables();\n \n+        String id = Long.toString(System.nanoTime());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM4NDgzMA=="}, "originalCommit": {"oid": "95bc9cbcbfa8420cc57f2ed24b2619e37fcc27f6"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MDc2ODQxOnYy", "diffSide": "RIGHT", "path": "tests/test-sessions/test-jdbc-sessions/pom.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxMjo0OTowMFrOGacqdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMToyNzoxOVrOGaw67Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM4NTc4Mg==", "bodyText": "The only qualm I have here is that before, the jdbc session tests were being executed automatically but now we need this property set. Just a qualm.", "url": "https://github.com/eclipse/jetty.project/pull/4910#discussion_r430385782", "createdAt": "2020-05-26T12:49:00Z", "author": {"login": "janbartel"}, "path": "tests/test-sessions/test-jdbc-sessions/pom.xml", "diffHunk": "@@ -46,19 +53,61 @@\n       <version>${project.version}</version>\n     </dependency>\n     <dependency>\n-      <groupId>org.apache.derby</groupId>\n-      <artifactId>derby</artifactId>\n+      <groupId>org.eclipse.jetty.toolchain</groupId>\n+      <artifactId>jetty-test-helper</artifactId>\n       <scope>test</scope>\n     </dependency>\n     <dependency>\n-      <groupId>org.apache.derby</groupId>\n-      <artifactId>derbytools</artifactId>\n+      <groupId>org.testcontainers</groupId>\n+      <artifactId>testcontainers</artifactId>\n       <scope>test</scope>\n     </dependency>\n     <dependency>\n-      <groupId>org.eclipse.jetty.toolchain</groupId>\n-      <artifactId>jetty-test-helper</artifactId>\n+      <groupId>org.testcontainers</groupId>\n+      <artifactId>mariadb</artifactId>\n+      <version>${testcontainers.version}</version>\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.testcontainers</groupId>\n+      <artifactId>junit-jupiter</artifactId>\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.slf4j</groupId>\n+      <artifactId>slf4j-simple</artifactId>\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.mariadb.jdbc</groupId>\n+      <artifactId>mariadb-java-client</artifactId>\n+      <version>2.6.0</version>\n       <scope>test</scope>\n     </dependency>\n   </dependencies>\n+  <profiles>\n+    <profile>\n+      <id>remote-session-tests</id>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95bc9cbcbfa8420cc57f2ed24b2619e37fcc27f6"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDcxNzY3Nw==", "bodyText": "yup makes sense. I will only add an option to check if docker is available.", "url": "https://github.com/eclipse/jetty.project/pull/4910#discussion_r430717677", "createdAt": "2020-05-26T21:27:19Z", "author": {"login": "olamy"}, "path": "tests/test-sessions/test-jdbc-sessions/pom.xml", "diffHunk": "@@ -46,19 +53,61 @@\n       <version>${project.version}</version>\n     </dependency>\n     <dependency>\n-      <groupId>org.apache.derby</groupId>\n-      <artifactId>derby</artifactId>\n+      <groupId>org.eclipse.jetty.toolchain</groupId>\n+      <artifactId>jetty-test-helper</artifactId>\n       <scope>test</scope>\n     </dependency>\n     <dependency>\n-      <groupId>org.apache.derby</groupId>\n-      <artifactId>derbytools</artifactId>\n+      <groupId>org.testcontainers</groupId>\n+      <artifactId>testcontainers</artifactId>\n       <scope>test</scope>\n     </dependency>\n     <dependency>\n-      <groupId>org.eclipse.jetty.toolchain</groupId>\n-      <artifactId>jetty-test-helper</artifactId>\n+      <groupId>org.testcontainers</groupId>\n+      <artifactId>mariadb</artifactId>\n+      <version>${testcontainers.version}</version>\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.testcontainers</groupId>\n+      <artifactId>junit-jupiter</artifactId>\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.slf4j</groupId>\n+      <artifactId>slf4j-simple</artifactId>\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.mariadb.jdbc</groupId>\n+      <artifactId>mariadb-java-client</artifactId>\n+      <version>2.6.0</version>\n       <scope>test</scope>\n     </dependency>\n   </dependencies>\n+  <profiles>\n+    <profile>\n+      <id>remote-session-tests</id>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM4NTc4Mg=="}, "originalCommit": {"oid": "95bc9cbcbfa8420cc57f2ed24b2619e37fcc27f6"}, "originalPosition": 69}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2564, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}