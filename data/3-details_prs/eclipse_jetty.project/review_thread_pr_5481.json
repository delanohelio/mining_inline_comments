{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA3MTA5MzI4", "number": 5481, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMTozODo1N1rOEv_M6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMjowMjo1MVrOEv_o6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4NzU0MDI2OnYy", "diffSide": "RIGHT", "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/WebInfConfiguration.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMTozODo1N1rOHlSHeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMjowMTo1M1rOHlSx1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg1NjE4Ng==", "bodyText": "I'm not sure about this .... we need to check that if the dir should not be persisted then anything that is already in it should be removed before we try and unpack the webapp into it.", "url": "https://github.com/eclipse/jetty.project/pull/5481#discussion_r508856186", "createdAt": "2020-10-20T21:38:57Z", "author": {"login": "janbartel"}, "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/WebInfConfiguration.java", "diffHunk": "@@ -522,21 +522,16 @@ public void configureTempDirectory(File dir, WebAppContext context)\n         if (dir == null)\n             throw new IllegalArgumentException(\"Null temp dir\");\n \n-        //if dir exists and we don't want it persisted, delete it\n-        if (dir.exists() && !context.isPersistTempDirectory())\n+        // if it doesn't exist make it", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6be6fae291eff4ff8d7449d7f222812e02c76645"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg1Nzk1Mg==", "bodyText": "But we cannot remove it arbitrarily here, only under small circumstance will removing the directory itself be safe.\nThis step isn't really necessary as both the WebInfConfiguration.deconfigure() and the Temp directory specific File.deleteOnExit() both cover the deletion angle.\nAs an alternative, we could simply clear out the directory contents.", "url": "https://github.com/eclipse/jetty.project/pull/5481#discussion_r508857952", "createdAt": "2020-10-20T21:42:35Z", "author": {"login": "joakime"}, "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/WebInfConfiguration.java", "diffHunk": "@@ -522,21 +522,16 @@ public void configureTempDirectory(File dir, WebAppContext context)\n         if (dir == null)\n             throw new IllegalArgumentException(\"Null temp dir\");\n \n-        //if dir exists and we don't want it persisted, delete it\n-        if (dir.exists() && !context.isPersistTempDirectory())\n+        // if it doesn't exist make it", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg1NjE4Ng=="}, "originalCommit": {"oid": "6be6fae291eff4ff8d7449d7f222812e02c76645"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg1ODUwNQ==", "bodyText": "yep I think we need to clear it out", "url": "https://github.com/eclipse/jetty.project/pull/5481#discussion_r508858505", "createdAt": "2020-10-20T21:43:53Z", "author": {"login": "gregw"}, "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/WebInfConfiguration.java", "diffHunk": "@@ -522,21 +522,16 @@ public void configureTempDirectory(File dir, WebAppContext context)\n         if (dir == null)\n             throw new IllegalArgumentException(\"Null temp dir\");\n \n-        //if dir exists and we don't want it persisted, delete it\n-        if (dir.exists() && !context.isPersistTempDirectory())\n+        // if it doesn't exist make it", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg1NjE4Ng=="}, "originalCommit": {"oid": "6be6fae291eff4ff8d7449d7f222812e02c76645"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg1OTI3MA==", "bodyText": "Yes, I'd prefer to clear out the directory contents, and leave the dir in place.\nThis is safeguarding if the previous deconfigure() failed, and deleteOnExit might not come into play because you're just restarting the context/server without restarting the jvm.", "url": "https://github.com/eclipse/jetty.project/pull/5481#discussion_r508859270", "createdAt": "2020-10-20T21:45:27Z", "author": {"login": "janbartel"}, "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/WebInfConfiguration.java", "diffHunk": "@@ -522,21 +522,16 @@ public void configureTempDirectory(File dir, WebAppContext context)\n         if (dir == null)\n             throw new IllegalArgumentException(\"Null temp dir\");\n \n-        //if dir exists and we don't want it persisted, delete it\n-        if (dir.exists() && !context.isPersistTempDirectory())\n+        // if it doesn't exist make it", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg1NjE4Ng=="}, "originalCommit": {"oid": "6be6fae291eff4ff8d7449d7f222812e02c76645"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg2NTQ0Mw==", "bodyText": "The temp directory deletion block has been restored.", "url": "https://github.com/eclipse/jetty.project/pull/5481#discussion_r508865443", "createdAt": "2020-10-20T21:58:23Z", "author": {"login": "joakime"}, "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/WebInfConfiguration.java", "diffHunk": "@@ -522,21 +522,16 @@ public void configureTempDirectory(File dir, WebAppContext context)\n         if (dir == null)\n             throw new IllegalArgumentException(\"Null temp dir\");\n \n-        //if dir exists and we don't want it persisted, delete it\n-        if (dir.exists() && !context.isPersistTempDirectory())\n+        // if it doesn't exist make it", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg1NjE4Ng=="}, "originalCommit": {"oid": "6be6fae291eff4ff8d7449d7f222812e02c76645"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg2NzAzMQ==", "bodyText": "About the concern about prior directory (example given is context/server restart) ...\nThe Files.createTempDirectory path (or the older File.createTempFile path), this delete would never have deleted the prior directory, as each time you enter this block you have a new directory path.", "url": "https://github.com/eclipse/jetty.project/pull/5481#discussion_r508867031", "createdAt": "2020-10-20T22:01:53Z", "author": {"login": "joakime"}, "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/WebInfConfiguration.java", "diffHunk": "@@ -522,21 +522,16 @@ public void configureTempDirectory(File dir, WebAppContext context)\n         if (dir == null)\n             throw new IllegalArgumentException(\"Null temp dir\");\n \n-        //if dir exists and we don't want it persisted, delete it\n-        if (dir.exists() && !context.isPersistTempDirectory())\n+        // if it doesn't exist make it", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg1NjE4Ng=="}, "originalCommit": {"oid": "6be6fae291eff4ff8d7449d7f222812e02c76645"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4NzU0Mjg1OnYy", "diffSide": "RIGHT", "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/WebInfConfiguration.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMTozOTo0NVrOHlSI_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMTo1ODo1MFrOHlSsdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg1NjU3Mw==", "bodyText": "You need to keep the if (!context.isPersistTempDirectory) dir.deleteOnExit.", "url": "https://github.com/eclipse/jetty.project/pull/5481#discussion_r508856573", "createdAt": "2020-10-20T21:39:45Z", "author": {"login": "janbartel"}, "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/WebInfConfiguration.java", "diffHunk": "@@ -522,21 +522,16 @@ public void configureTempDirectory(File dir, WebAppContext context)\n         if (dir == null)\n             throw new IllegalArgumentException(\"Null temp dir\");\n \n-        //if dir exists and we don't want it persisted, delete it\n-        if (dir.exists() && !context.isPersistTempDirectory())\n+        // if it doesn't exist make it\n+        if (!dir.exists())\n         {\n-            if (!IO.delete(dir))\n-                throw new IllegalStateException(\"Failed to delete temp dir \" + dir);\n+            if (!dir.mkdirs())\n+            {\n+                throw new IllegalStateException(\"Unable to create temp dir \" + dir);\n+            }\n         }\n \n-        //if it doesn't exist make it\n-        if (!dir.exists())\n-            dir.mkdirs();\n-\n-        if (!context.isPersistTempDirectory())\n-            dir.deleteOnExit();\n-\n-        //is it useable\n+        // is it useable", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6be6fae291eff4ff8d7449d7f222812e02c76645"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg1ODA3MQ==", "bodyText": "That's covered in makeTempDirectory() already.", "url": "https://github.com/eclipse/jetty.project/pull/5481#discussion_r508858071", "createdAt": "2020-10-20T21:42:52Z", "author": {"login": "joakime"}, "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/WebInfConfiguration.java", "diffHunk": "@@ -522,21 +522,16 @@ public void configureTempDirectory(File dir, WebAppContext context)\n         if (dir == null)\n             throw new IllegalArgumentException(\"Null temp dir\");\n \n-        //if dir exists and we don't want it persisted, delete it\n-        if (dir.exists() && !context.isPersistTempDirectory())\n+        // if it doesn't exist make it\n+        if (!dir.exists())\n         {\n-            if (!IO.delete(dir))\n-                throw new IllegalStateException(\"Failed to delete temp dir \" + dir);\n+            if (!dir.mkdirs())\n+            {\n+                throw new IllegalStateException(\"Unable to create temp dir \" + dir);\n+            }\n         }\n \n-        //if it doesn't exist make it\n-        if (!dir.exists())\n-            dir.mkdirs();\n-\n-        if (!context.isPersistTempDirectory())\n-            dir.deleteOnExit();\n-\n-        //is it useable\n+        // is it useable", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg1NjU3Mw=="}, "originalCommit": {"oid": "6be6fae291eff4ff8d7449d7f222812e02c76645"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg1ODcwMA==", "bodyText": "Scratch that, i'm wrong about this specific one.", "url": "https://github.com/eclipse/jetty.project/pull/5481#discussion_r508858700", "createdAt": "2020-10-20T21:44:15Z", "author": {"login": "joakime"}, "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/WebInfConfiguration.java", "diffHunk": "@@ -522,21 +522,16 @@ public void configureTempDirectory(File dir, WebAppContext context)\n         if (dir == null)\n             throw new IllegalArgumentException(\"Null temp dir\");\n \n-        //if dir exists and we don't want it persisted, delete it\n-        if (dir.exists() && !context.isPersistTempDirectory())\n+        // if it doesn't exist make it\n+        if (!dir.exists())\n         {\n-            if (!IO.delete(dir))\n-                throw new IllegalStateException(\"Failed to delete temp dir \" + dir);\n+            if (!dir.mkdirs())\n+            {\n+                throw new IllegalStateException(\"Unable to create temp dir \" + dir);\n+            }\n         }\n \n-        //if it doesn't exist make it\n-        if (!dir.exists())\n-            dir.mkdirs();\n-\n-        if (!context.isPersistTempDirectory())\n-            dir.deleteOnExit();\n-\n-        //is it useable\n+        // is it useable", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg1NjU3Mw=="}, "originalCommit": {"oid": "6be6fae291eff4ff8d7449d7f222812e02c76645"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg2MDg2MA==", "bodyText": "No, it's also called directly by resolveTempDirectory in the case where someone has explicitly supplied the temp directory to use or the javax.servlet.context.tempDir has been set - whether these are persisted or not is optional and configured by configureTempDirectory.", "url": "https://github.com/eclipse/jetty.project/pull/5481#discussion_r508860860", "createdAt": "2020-10-20T21:48:43Z", "author": {"login": "janbartel"}, "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/WebInfConfiguration.java", "diffHunk": "@@ -522,21 +522,16 @@ public void configureTempDirectory(File dir, WebAppContext context)\n         if (dir == null)\n             throw new IllegalArgumentException(\"Null temp dir\");\n \n-        //if dir exists and we don't want it persisted, delete it\n-        if (dir.exists() && !context.isPersistTempDirectory())\n+        // if it doesn't exist make it\n+        if (!dir.exists())\n         {\n-            if (!IO.delete(dir))\n-                throw new IllegalStateException(\"Failed to delete temp dir \" + dir);\n+            if (!dir.mkdirs())\n+            {\n+                throw new IllegalStateException(\"Unable to create temp dir \" + dir);\n+            }\n         }\n \n-        //if it doesn't exist make it\n-        if (!dir.exists())\n-            dir.mkdirs();\n-\n-        if (!context.isPersistTempDirectory())\n-            dir.deleteOnExit();\n-\n-        //is it useable\n+        // is it useable", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg1NjU3Mw=="}, "originalCommit": {"oid": "6be6fae291eff4ff8d7449d7f222812e02c76645"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg2NTY1Mw==", "bodyText": "deleteOnExit has been restored.", "url": "https://github.com/eclipse/jetty.project/pull/5481#discussion_r508865653", "createdAt": "2020-10-20T21:58:50Z", "author": {"login": "joakime"}, "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/WebInfConfiguration.java", "diffHunk": "@@ -522,21 +522,16 @@ public void configureTempDirectory(File dir, WebAppContext context)\n         if (dir == null)\n             throw new IllegalArgumentException(\"Null temp dir\");\n \n-        //if dir exists and we don't want it persisted, delete it\n-        if (dir.exists() && !context.isPersistTempDirectory())\n+        // if it doesn't exist make it\n+        if (!dir.exists())\n         {\n-            if (!IO.delete(dir))\n-                throw new IllegalStateException(\"Failed to delete temp dir \" + dir);\n+            if (!dir.mkdirs())\n+            {\n+                throw new IllegalStateException(\"Unable to create temp dir \" + dir);\n+            }\n         }\n \n-        //if it doesn't exist make it\n-        if (!dir.exists())\n-            dir.mkdirs();\n-\n-        if (!context.isPersistTempDirectory())\n-            dir.deleteOnExit();\n-\n-        //is it useable\n+        // is it useable", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg1NjU3Mw=="}, "originalCommit": {"oid": "6be6fae291eff4ff8d7449d7f222812e02c76645"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4NzU0NDQ5OnYy", "diffSide": "RIGHT", "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/WebInfConfiguration.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMTo0MDoxN1rOHlSKDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMTo0MDoxN1rOHlSKDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg1Njg0Ng==", "bodyText": "You've changed the logic here.   This was always deleting and recreating a non persistent temp dir.\nWe  don't want to do that any more because of hijacking!   But I think we have to ensure the tempdir is empty if it is not persistent.", "url": "https://github.com/eclipse/jetty.project/pull/5481#discussion_r508856846", "createdAt": "2020-10-20T21:40:17Z", "author": {"login": "gregw"}, "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/WebInfConfiguration.java", "diffHunk": "@@ -522,21 +522,16 @@ public void configureTempDirectory(File dir, WebAppContext context)\n         if (dir == null)\n             throw new IllegalArgumentException(\"Null temp dir\");\n \n-        //if dir exists and we don't want it persisted, delete it\n-        if (dir.exists() && !context.isPersistTempDirectory())\n+        // if it doesn't exist make it\n+        if (!dir.exists())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6be6fae291eff4ff8d7449d7f222812e02c76645"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4NzU0NjAzOnYy", "diffSide": "RIGHT", "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/WebInfConfiguration.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMTo0MDo0OFrOHlSLDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMjowMzoyMVrOHlS0PQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg1NzEwMA==", "bodyText": "assign getTempDirectory() to a variable", "url": "https://github.com/eclipse/jetty.project/pull/5481#discussion_r508857100", "createdAt": "2020-10-20T21:40:48Z", "author": {"login": "gregw"}, "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/WebInfConfiguration.java", "diffHunk": "@@ -355,7 +355,7 @@ public void configure(WebAppContext context) throws Exception\n     public void deconfigure(WebAppContext context) throws Exception\n     {\n         //if we're not persisting the temp dir contents delete it\n-        if (!context.isPersistTempDirectory())\n+        if (!context.isPersistTempDirectory() && context.getTempDirectory() != null && context.getTempDirectory().exists())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6be6fae291eff4ff8d7449d7f222812e02c76645"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg2NzY0NQ==", "bodyText": "Done.", "url": "https://github.com/eclipse/jetty.project/pull/5481#discussion_r508867645", "createdAt": "2020-10-20T22:03:21Z", "author": {"login": "joakime"}, "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/WebInfConfiguration.java", "diffHunk": "@@ -355,7 +355,7 @@ public void configure(WebAppContext context) throws Exception\n     public void deconfigure(WebAppContext context) throws Exception\n     {\n         //if we're not persisting the temp dir contents delete it\n-        if (!context.isPersistTempDirectory())\n+        if (!context.isPersistTempDirectory() && context.getTempDirectory() != null && context.getTempDirectory().exists())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg1NzEwMA=="}, "originalCommit": {"oid": "6be6fae291eff4ff8d7449d7f222812e02c76645"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4NzYwMzUxOnYy", "diffSide": "RIGHT", "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/WebInfConfiguration.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMTo1OTo0OFrOHlSuOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMTo1OTo0OFrOHlSuOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg2NjEwNw==", "bodyText": "This execution path does not use configureTempDirectory.\nIt's always a new, and unique, directory.\nAlso, it is always !isPersisTempDirectory()", "url": "https://github.com/eclipse/jetty.project/pull/5481#discussion_r508866107", "createdAt": "2020-10-20T21:59:48Z", "author": {"login": "joakime"}, "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/WebInfConfiguration.java", "diffHunk": "@@ -504,13 +506,15 @@ public void makeTempDirectory(File parent, WebAppContext context)\n             //if it is to be persisted, make sure it will be the same name\n             //by not using File.createTempFile, which appends random digits\n             tmpDir = new File(parent, temp);\n+            configureTempDirectory(tmpDir, context);\n         }\n         else\n         {\n-            //ensure file will always be unique by appending random digits\n+            // ensure dir will always be unique by having classlib generate random path name\n             tmpDir = Files.createTempDirectory(parent.toPath(), temp).toFile();\n+            tmpDir.deleteOnExit();\n+            ensureTempDirUsable(tmpDir);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7ae5b50ab8bfffe46aca5cc8cf1ceef305fa316"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4NzYwODY1OnYy", "diffSide": "RIGHT", "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/WebInfConfiguration.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMjowMTozOFrOHlSxcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMjowNDozMFrOHlS17g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg2NjkyOQ==", "bodyText": "probably should now be called ensureTempDirectory ?", "url": "https://github.com/eclipse/jetty.project/pull/5481#discussion_r508866929", "createdAt": "2020-10-20T22:01:38Z", "author": {"login": "gregw"}, "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/WebInfConfiguration.java", "diffHunk": "@@ -504,13 +506,15 @@ public void makeTempDirectory(File parent, WebAppContext context)\n             //if it is to be persisted, make sure it will be the same name\n             //by not using File.createTempFile, which appends random digits\n             tmpDir = new File(parent, temp);\n+            configureTempDirectory(tmpDir, context);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7ae5b50ab8bfffe46aca5cc8cf1ceef305fa316"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg2ODA3OA==", "bodyText": "This is a public API / method, don't want to change it for 9.4.x.\nBe happy to change it for 10.0.x though.", "url": "https://github.com/eclipse/jetty.project/pull/5481#discussion_r508868078", "createdAt": "2020-10-20T22:04:30Z", "author": {"login": "joakime"}, "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/WebInfConfiguration.java", "diffHunk": "@@ -504,13 +506,15 @@ public void makeTempDirectory(File parent, WebAppContext context)\n             //if it is to be persisted, make sure it will be the same name\n             //by not using File.createTempFile, which appends random digits\n             tmpDir = new File(parent, temp);\n+            configureTempDirectory(tmpDir, context);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg2NjkyOQ=="}, "originalCommit": {"oid": "c7ae5b50ab8bfffe46aca5cc8cf1ceef305fa316"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4NzYxMTkyOnYy", "diffSide": "RIGHT", "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/WebInfConfiguration.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMjowMjo1MVrOHlSzdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMjoyMTo0OFrOHlTQ5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg2NzQ0NQ==", "bodyText": "how hard is it to check if it is empty or not.   if it is empty, it would be good to avoid deleting it.", "url": "https://github.com/eclipse/jetty.project/pull/5481#discussion_r508867445", "createdAt": "2020-10-20T22:02:51Z", "author": {"login": "gregw"}, "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/WebInfConfiguration.java", "diffHunk": "@@ -522,21 +526,30 @@ public void configureTempDirectory(File dir, WebAppContext context)\n         if (dir == null)\n             throw new IllegalArgumentException(\"Null temp dir\");\n \n-        //if dir exists and we don't want it persisted, delete it\n-        if (dir.exists() && !context.isPersistTempDirectory())\n+        // if dir exists and we don't want it persisted, delete it\n+        if (!context.isPersistTempDirectory() && dir.exists() && !IO.delete(dir))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7ae5b50ab8bfffe46aca5cc8cf1ceef305fa316"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg2ODI4MA==", "bodyText": "Not to terrible to check if empty.\nLet me try.", "url": "https://github.com/eclipse/jetty.project/pull/5481#discussion_r508868280", "createdAt": "2020-10-20T22:04:59Z", "author": {"login": "joakime"}, "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/WebInfConfiguration.java", "diffHunk": "@@ -522,21 +526,30 @@ public void configureTempDirectory(File dir, WebAppContext context)\n         if (dir == null)\n             throw new IllegalArgumentException(\"Null temp dir\");\n \n-        //if dir exists and we don't want it persisted, delete it\n-        if (dir.exists() && !context.isPersistTempDirectory())\n+        // if dir exists and we don't want it persisted, delete it\n+        if (!context.isPersistTempDirectory() && dir.exists() && !IO.delete(dir))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg2NzQ0NQ=="}, "originalCommit": {"oid": "c7ae5b50ab8bfffe46aca5cc8cf1ceef305fa316"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg3NDk4MQ==", "bodyText": "This has been implemented and is available in this PR.", "url": "https://github.com/eclipse/jetty.project/pull/5481#discussion_r508874981", "createdAt": "2020-10-20T22:21:48Z", "author": {"login": "joakime"}, "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/WebInfConfiguration.java", "diffHunk": "@@ -522,21 +526,30 @@ public void configureTempDirectory(File dir, WebAppContext context)\n         if (dir == null)\n             throw new IllegalArgumentException(\"Null temp dir\");\n \n-        //if dir exists and we don't want it persisted, delete it\n-        if (dir.exists() && !context.isPersistTempDirectory())\n+        // if dir exists and we don't want it persisted, delete it\n+        if (!context.isPersistTempDirectory() && dir.exists() && !IO.delete(dir))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg2NzQ0NQ=="}, "originalCommit": {"oid": "c7ae5b50ab8bfffe46aca5cc8cf1ceef305fa316"}, "originalPosition": 38}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2178, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}