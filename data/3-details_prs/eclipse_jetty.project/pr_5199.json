{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDczMTc0MzAw", "number": 5199, "title": "Support Apache Commons Daemon methods in XmlConfiguration", "bodyText": "This is a minimal change to allow XmlConfiguration to be substituted for start.Main if using a --dry-run to avoid an exec.", "createdAt": "2020-08-25T12:37:13Z", "url": "https://github.com/eclipse/jetty.project/pull/5199", "merged": true, "mergeCommit": {"oid": "820f2b9195b187eb1d651a154a2835a1cbac39d7"}, "closed": true, "closedAt": "2020-09-02T21:40:06Z", "author": {"login": "gregw"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCWdwlAH2gAyNDczMTc0MzAwOjYxYTllYmExMGY0NjNlMzE2ZDA5NWI0NGNmNjY4OTA3MWJmYTZiMTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdE3dUUAH2gAyNDczMTc0MzAwOjdlNGQwMGMyMDM1YzZlZGNkZTIyZjcyMGNiZjI1M2QyYjU1ZjI4NzM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "61a9eba10f463e316d095b44cf6689071bfa6b13", "author": {"user": {"login": "gregw", "name": "Greg Wilkins"}}, "url": "https://github.com/eclipse/jetty.project/commit/61a9eba10f463e316d095b44cf6689071bfa6b13", "committedDate": "2020-08-25T12:35:30Z", "message": "Support Apache Commons Daemon methods in XmlConfiguration so it can substitute for start.Main after a --dry-run"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NDc1NjEw", "url": "https://github.com/eclipse/jetty.project/pull/5199#pullrequestreview-474475610", "createdAt": "2020-08-25T13:23:27Z", "commit": {"oid": "61a9eba10f463e316d095b44cf6689071bfa6b13"}, "state": "APPROVED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMzoyMzoyN1rOHGX2sg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMzoyOToyNVrOHGYG7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ0NDMzOA==", "bodyText": "Add a reason to the ISE", "url": "https://github.com/eclipse/jetty.project/pull/5199#discussion_r476444338", "createdAt": "2020-08-25T13:23:27Z", "author": {"login": "janbartel"}, "path": "jetty-xml/src/main/java/org/eclipse/jetty/xml/XmlConfiguration.java", "diffHunk": "@@ -361,6 +377,8 @@ else if (__factoryLoader != null)\n      */\n     public Object configure(Object obj) throws Exception\n     {\n+        if (_objects != null)\n+            throw new IllegalStateException();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61a9eba10f463e316d095b44cf6689071bfa6b13"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ0NDQ4NA==", "bodyText": "Add a reason to the ISE", "url": "https://github.com/eclipse/jetty.project/pull/5199#discussion_r476444484", "createdAt": "2020-08-25T13:23:38Z", "author": {"login": "janbartel"}, "path": "jetty-xml/src/main/java/org/eclipse/jetty/xml/XmlConfiguration.java", "diffHunk": "@@ -375,6 +393,8 @@ public Object configure(Object obj) throws Exception\n      */\n     public Object configure() throws Exception\n     {\n+        if (_objects != null)\n+            throw new IllegalStateException();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61a9eba10f463e316d095b44cf6689071bfa6b13"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ0NzAwNQ==", "bodyText": "Add if (objects == null) throw ISE?", "url": "https://github.com/eclipse/jetty.project/pull/5199#discussion_r476447005", "createdAt": "2020-08-25T13:27:14Z", "author": {"login": "janbartel"}, "path": "jetty-xml/src/main/java/org/eclipse/jetty/xml/XmlConfiguration.java", "diffHunk": "@@ -1833,24 +1853,8 @@ Args asEmptyVarArgs(Class<?> varArgType)\n         return values;\n     }\n \n-    /**\n-     * Runs the XML configurations as a main application.\n-     * The command line is used to obtain properties files (must be named '*.properties') and XmlConfiguration files.\n-     * <p>\n-     * Any property file on the command line is added to a combined Property instance that is passed to each configuration file via\n-     * {@link XmlConfiguration#getProperties()}.\n-     * <p>\n-     * Each configuration file on the command line is used to create a new XmlConfiguration instance and the\n-     * {@link XmlConfiguration#configure()} method is used to create the configured object.\n-     * If the resulting object is an instance of {@link LifeCycle}, then it is started.\n-     * <p>\n-     * Any IDs created in a configuration are passed to the next configuration file on the command line using {@link #getIdMap()}.\n-     * This allows objects with IDs created in one config file to be referenced in subsequent config files on the command line.\n-     *\n-     * @param args array of property and xml configuration filenames or {@link Resource}s.\n-     * @throws Exception if the XML configurations cannot be run\n-     */\n-    public static void main(final String... args) throws Exception\n+    // implement Apache commons daemon (jsvc) lifecycle methods (init, start, stop, destroy)\n+    public void init(String[] args) throws Exception", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61a9eba10f463e316d095b44cf6689071bfa6b13"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ0NzM0Mw==", "bodyText": "Add reason to ISE.", "url": "https://github.com/eclipse/jetty.project/pull/5199#discussion_r476447343", "createdAt": "2020-08-25T13:27:42Z", "author": {"login": "janbartel"}, "path": "jetty-xml/src/main/java/org/eclipse/jetty/xml/XmlConfiguration.java", "diffHunk": "@@ -1919,6 +1911,82 @@ else if (arg.toLowerCase(Locale.ENGLISH).endsWith(\".properties\"))\n         }\n     }\n \n+    // implement Apache commons daemon (jsvc) lifecycle methods (init, start, stop, destroy)\n+    public void start() throws Exception\n+    {\n+        if (_objects == null)\n+            throw new IllegalStateException();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61a9eba10f463e316d095b44cf6689071bfa6b13"}, "originalPosition": 145}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ0ODA1NA==", "bodyText": "Add a reason", "url": "https://github.com/eclipse/jetty.project/pull/5199#discussion_r476448054", "createdAt": "2020-08-25T13:28:46Z", "author": {"login": "janbartel"}, "path": "jetty-xml/src/main/java/org/eclipse/jetty/xml/XmlConfiguration.java", "diffHunk": "@@ -1919,6 +1911,82 @@ else if (arg.toLowerCase(Locale.ENGLISH).endsWith(\".properties\"))\n         }\n     }\n \n+    // implement Apache commons daemon (jsvc) lifecycle methods (init, start, stop, destroy)\n+    public void start() throws Exception\n+    {\n+        if (_objects == null)\n+            throw new IllegalStateException();\n+\n+        // For all objects created by XmlConfigurations, start them if they are lifecycles.\n+        for (Object obj : _objects)\n+        {\n+            if (obj instanceof LifeCycle)\n+            {\n+                LifeCycle lc = (LifeCycle)obj;\n+                if (!lc.isRunning())\n+                    lc.start();\n+            }\n+        }\n+\n+    }\n+\n+    // implement Apache commons daemon (jsvc) lifecycle methods (init, start, stop, destroy)\n+    public void stop() throws Exception\n+    {\n+        if (_objects == null)\n+            throw new IllegalStateException();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61a9eba10f463e316d095b44cf6689071bfa6b13"}, "originalPosition": 164}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ0ODI1OA==", "bodyText": "s/start/stop", "url": "https://github.com/eclipse/jetty.project/pull/5199#discussion_r476448258", "createdAt": "2020-08-25T13:29:03Z", "author": {"login": "janbartel"}, "path": "jetty-xml/src/main/java/org/eclipse/jetty/xml/XmlConfiguration.java", "diffHunk": "@@ -1919,6 +1911,82 @@ else if (arg.toLowerCase(Locale.ENGLISH).endsWith(\".properties\"))\n         }\n     }\n \n+    // implement Apache commons daemon (jsvc) lifecycle methods (init, start, stop, destroy)\n+    public void start() throws Exception\n+    {\n+        if (_objects == null)\n+            throw new IllegalStateException();\n+\n+        // For all objects created by XmlConfigurations, start them if they are lifecycles.\n+        for (Object obj : _objects)\n+        {\n+            if (obj instanceof LifeCycle)\n+            {\n+                LifeCycle lc = (LifeCycle)obj;\n+                if (!lc.isRunning())\n+                    lc.start();\n+            }\n+        }\n+\n+    }\n+\n+    // implement Apache commons daemon (jsvc) lifecycle methods (init, start, stop, destroy)\n+    public void stop() throws Exception\n+    {\n+        if (_objects == null)\n+            throw new IllegalStateException();\n+\n+        // For all objects created by XmlConfigurations, start them if they are lifecycles.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61a9eba10f463e316d095b44cf6689071bfa6b13"}, "originalPosition": 166}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ0ODQ5NA==", "bodyText": "Add reason", "url": "https://github.com/eclipse/jetty.project/pull/5199#discussion_r476448494", "createdAt": "2020-08-25T13:29:25Z", "author": {"login": "janbartel"}, "path": "jetty-xml/src/main/java/org/eclipse/jetty/xml/XmlConfiguration.java", "diffHunk": "@@ -1919,6 +1911,82 @@ else if (arg.toLowerCase(Locale.ENGLISH).endsWith(\".properties\"))\n         }\n     }\n \n+    // implement Apache commons daemon (jsvc) lifecycle methods (init, start, stop, destroy)\n+    public void start() throws Exception\n+    {\n+        if (_objects == null)\n+            throw new IllegalStateException();\n+\n+        // For all objects created by XmlConfigurations, start them if they are lifecycles.\n+        for (Object obj : _objects)\n+        {\n+            if (obj instanceof LifeCycle)\n+            {\n+                LifeCycle lc = (LifeCycle)obj;\n+                if (!lc.isRunning())\n+                    lc.start();\n+            }\n+        }\n+\n+    }\n+\n+    // implement Apache commons daemon (jsvc) lifecycle methods (init, start, stop, destroy)\n+    public void stop() throws Exception\n+    {\n+        if (_objects == null)\n+            throw new IllegalStateException();\n+\n+        // For all objects created by XmlConfigurations, start them if they are lifecycles.\n+        for (Object obj : _objects)\n+        {\n+            if (obj instanceof LifeCycle)\n+            {\n+                LifeCycle lc = (LifeCycle)obj;\n+                if (lc.isRunning())\n+                    lc.stop();\n+            }\n+        }\n+    }\n+\n+    // implement Apache commons daemon (jsvc) lifecycle methods (init, start, stop, destroy)\n+    public void destroy()\n+    {\n+        if (_objects == null)\n+            throw new IllegalStateException();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61a9eba10f463e316d095b44cf6689071bfa6b13"}, "originalPosition": 182}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd8e6d2f65041d9d2737947261545862a40b2ab3", "author": {"user": {"login": "gregw", "name": "Greg Wilkins"}}, "url": "https://github.com/eclipse/jetty.project/commit/cd8e6d2f65041d9d2737947261545862a40b2ab3", "committedDate": "2020-08-26T16:03:55Z", "message": "+ added --dry-run=parts to printout partial dry run\n+ added --no-exec\n\nSigned-off-by: Greg Wilkins <gregw@webtide.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b888a8f9b8d0275ac82ed2f74e580aec49a13ee3", "author": {"user": {"login": "gregw", "name": "Greg Wilkins"}}, "url": "https://github.com/eclipse/jetty.project/commit/b888a8f9b8d0275ac82ed2f74e580aec49a13ee3", "committedDate": "2020-08-31T10:53:24Z", "message": "+ updated for review feedback\n\nSigned-off-by: Greg Wilkins <gregw@webtide.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5OTY4NDkz", "url": "https://github.com/eclipse/jetty.project/pull/5199#pullrequestreview-479968493", "createdAt": "2020-09-01T17:30:52Z", "commit": {"oid": "b888a8f9b8d0275ac82ed2f74e580aec49a13ee3"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e422b347b98e21d19fbdcbc80ea8f7d1becd208", "author": {"user": {"login": "gregw", "name": "Greg Wilkins"}}, "url": "https://github.com/eclipse/jetty.project/commit/7e422b347b98e21d19fbdcbc80ea8f7d1becd208", "committedDate": "2020-09-02T07:33:37Z", "message": "Merge branch 'jetty-9.4.x' into jetty-9.4.x-ApacheCommonsDaemon-XmlConfiguration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e4d00c2035c6edcde22f720cbf253d2b55f2873", "author": {"user": {"login": "gregw", "name": "Greg Wilkins"}}, "url": "https://github.com/eclipse/jetty.project/commit/7e4d00c2035c6edcde22f720cbf253d2b55f2873", "committedDate": "2020-09-02T08:09:44Z", "message": "Feedback from review:\n\n + removed features other than --dry-run parts\n + added documentation"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 308, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}