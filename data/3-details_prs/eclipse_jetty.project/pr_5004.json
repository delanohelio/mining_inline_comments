{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxMTQ4MTk2", "number": 5004, "title": "Issue #4985 - fix NPE related to use of Attributes.Wrapper getAttributeNameSet()", "bodyText": "Issue #4985\nThis PR tries to prevent any of the Attributes.Wrapper implementations from returning a value in getAttributeNameSet() that corresponds to a null attribute when getAttribute() is called with the name.\nFor each Attributes.Wrapper we now do the following:\n\nEnsure that if the value is set to null, we do not add the corresponding attribute name to the set.\nDon't determine attribute values lazily as we won't know whether its null or not.\nEnsure that any conflicting attributes from the wrapped Attributes are removed.\n\n@mpetzold has tested this branch and it seems to have fixed the NPE originally reported\nsee #4985 (comment)\n\nThe NPE is gone. However, I still have a problem with the WebSocket connection of Vaadin / Atmosphere. This may be something else or related configuration.", "createdAt": "2020-06-29T01:25:17Z", "url": "https://github.com/eclipse/jetty.project/pull/5004", "merged": true, "mergeCommit": {"oid": "9a56301de110a76582f9391e48efe7529d530438"}, "closed": true, "closedAt": "2020-07-06T01:34:28Z", "author": {"login": "lachlan-roberts"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuueLwAH2gAyNDQxMTQ4MTk2OjY5MzMxMmE1NzdiOTIxYTRlNThjODU3NzY4OThhNzMwYWUxYjU1NzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcw4edYAH2gAyNDQxMTQ4MTk2OmYzNWQ2Y2ZkODBiMzllNmJlNzVjMDBhYTI1ZWYwZDdlZjdiYmRhNDk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "693312a577b921a4e58c85776898a730ae1b5576", "author": {"user": {"login": "lachlan-roberts", "name": "Lachlan"}}, "url": "https://github.com/eclipse/jetty.project/commit/693312a577b921a4e58c85776898a730ae1b5576", "committedDate": "2020-06-25T13:15:12Z", "message": "Issue #4985 - ensure every attribute in getAttributeNameSet has a non null value\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9126b282b1a0e76cd28a19c59d680ac1356afc83", "author": {"user": {"login": "lachlan-roberts", "name": "Lachlan"}}, "url": "https://github.com/eclipse/jetty.project/commit/9126b282b1a0e76cd28a19c59d680ac1356afc83", "committedDate": "2020-06-30T01:22:41Z", "message": "Merge remote-tracking branch 'origin/jetty-9.4.x' into jetty-9.4.x-4985-AttributeNameSet"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMjE4MDY3", "url": "https://github.com/eclipse/jetty.project/pull/5004#pullrequestreview-441218067", "createdAt": "2020-07-01T21:47:50Z", "commit": {"oid": "9126b282b1a0e76cd28a19c59d680ac1356afc83"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMTo0Nzo1MFrOGr2bVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMTo0Nzo1MFrOGr2bVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYzMzY4Ng==", "bodyText": "Because if you do an include then forward, you need to remove the include attributes, else the target will serve them rather than the getServletPath and getPathInfo indicated resources.\nIt is all to do with the strange setup of includes not changing the path methods and only setting attributes.", "url": "https://github.com/eclipse/jetty.project/pull/5004#discussion_r448633686", "createdAt": "2020-07-01T21:47:50Z", "author": {"login": "gregw"}, "path": "jetty-server/src/main/java/org/eclipse/jetty/server/Dispatcher.java", "diffHunk": "@@ -296,26 +297,23 @@ public Object getAttribute(String key)\n         public Set<String> getAttributeNameSet()\n         {\n             HashSet<String> set = new HashSet<>();\n-            for (String name : _attributes.getAttributeNameSet())\n-            {\n-                if (!name.startsWith(__INCLUDE_PREFIX) &&\n-                    !name.startsWith(__FORWARD_PREFIX))\n-                    set.add(name);\n-            }\n+            super.getAttributeNameSet().stream()\n+                .filter(name -> !name.startsWith(__INCLUDE_PREFIX)) // TODO: why does this filter the __INCLUDE_PREFIX as well?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9126b282b1a0e76cd28a19c59d680ac1356afc83"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f35d6cfd80b39e6be75c00aa25ef0d7ef7bbda49", "author": {"user": {"login": "lachlan-roberts", "name": "Lachlan"}}, "url": "https://github.com/eclipse/jetty.project/commit/f35d6cfd80b39e6be75c00aa25ef0d7ef7bbda49", "committedDate": "2020-07-02T06:02:24Z", "message": "Issue #4985 - remove TODO in Dispatcher\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 350, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}