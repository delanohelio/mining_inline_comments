{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0ODAxNDkx", "number": 4499, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMjozMjo0MVrODcOPhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMjozNDoxOVrODcOQ_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwOTIwMDY5OnYy", "diffSide": "RIGHT", "path": "jetty-util/src/main/java/org/eclipse/jetty/util/thread/ReservedThreadExecutor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMjozMjo0MVrOFkKCZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMjozMjo0MVrOFkKCZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQ1NzUxMA==", "bodyText": "Better catch Throwable here.", "url": "https://github.com/eclipse/jetty.project/pull/4499#discussion_r373457510", "createdAt": "2020-01-31T12:32:41Z", "author": {"login": "sbordet"}, "path": "jetty-util/src/main/java/org/eclipse/jetty/util/thread/ReservedThreadExecutor.java", "diffHunk": "@@ -264,20 +265,25 @@ public String toString()\n \n     private class ReservedThread implements Runnable\n     {\n-        private final Locker _locker = new Locker();\n-        private final Condition _wakeup = _locker.newCondition();\n+        private final SynchronousQueue<Runnable> _task = new SynchronousQueue<>();\n         private boolean _starting = true;\n-        private Runnable _task = null;\n \n-        public void offer(Runnable task)\n+        public boolean offer(Runnable task)\n         {\n             if (LOG.isDebugEnabled())\n                 LOG.debug(\"{} offer {}\", this, task);\n \n-            try (Locker.Lock lock = _locker.lock())\n+            try\n+            {\n+                _task.put(task);\n+                return true;\n+            }\n+            catch (InterruptedException e)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "458cb8c7edf91e01cd7de436374b737b2485d51f"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwOTIwMTUyOnYy", "diffSide": "RIGHT", "path": "jetty-util/src/main/java/org/eclipse/jetty/util/thread/ReservedThreadExecutor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMjozMzowM1rOFkKC7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMjozMzowM1rOFkKC7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQ1NzY0NA==", "bodyText": "Should be _idleTime <= 0.", "url": "https://github.com/eclipse/jetty.project/pull/4499#discussion_r373457644", "createdAt": "2020-01-31T12:33:03Z", "author": {"login": "sbordet"}, "path": "jetty-util/src/main/java/org/eclipse/jetty/util/thread/ReservedThreadExecutor.java", "diffHunk": "@@ -296,37 +302,12 @@ private Runnable reservedWait()\n                 if (!isRunning())\n                     return STOP;\n \n-                boolean idle = false;\n-                try (Locker.Lock lock = _locker.lock())\n+                try\n                 {\n-                    if (_task == null)\n-                    {\n-                        try\n-                        {\n-                            if (_idleTime == 0)\n-                                _wakeup.await();\n-                            else\n-                                idle = !_wakeup.await(_idleTime, _idleTimeUnit);\n-                        }\n-                        catch (InterruptedException e)\n-                        {\n-                            LOG.ignore(e);\n-                        }\n-                    }\n-                    else\n-                    {\n-                        Runnable task = _task;\n-                        _task = null;\n-\n-                        if (LOG.isDebugEnabled())\n-                            LOG.debug(\"{} task={}\", this, task);\n-\n+                    Runnable task = _idleTime == 0 ? _task.take() : _task.poll(_idleTime, _idleTimeUnit);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "458cb8c7edf91e01cd7de436374b737b2485d51f"}, "originalPosition": 84}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwOTIwNDQ1OnYy", "diffSide": "RIGHT", "path": "jetty-util/src/main/java/org/eclipse/jetty/util/thread/ReservedThreadExecutor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMjozNDoxOVrOFkKErw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMjozNDoxOVrOFkKErw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQ1ODA5NQ==", "bodyText": "There was a LOG.debug() statement when we had a non-null task that I would like to keep.", "url": "https://github.com/eclipse/jetty.project/pull/4499#discussion_r373458095", "createdAt": "2020-01-31T12:34:19Z", "author": {"login": "sbordet"}, "path": "jetty-util/src/main/java/org/eclipse/jetty/util/thread/ReservedThreadExecutor.java", "diffHunk": "@@ -296,37 +302,12 @@ private Runnable reservedWait()\n                 if (!isRunning())\n                     return STOP;\n \n-                boolean idle = false;\n-                try (Locker.Lock lock = _locker.lock())\n+                try\n                 {\n-                    if (_task == null)\n-                    {\n-                        try\n-                        {\n-                            if (_idleTime == 0)\n-                                _wakeup.await();\n-                            else\n-                                idle = !_wakeup.await(_idleTime, _idleTimeUnit);\n-                        }\n-                        catch (InterruptedException e)\n-                        {\n-                            LOG.ignore(e);\n-                        }\n-                    }\n-                    else\n-                    {\n-                        Runnable task = _task;\n-                        _task = null;\n-\n-                        if (LOG.isDebugEnabled())\n-                            LOG.debug(\"{} task={}\", this, task);\n-\n+                    Runnable task = _idleTime == 0 ? _task.take() : _task.poll(_idleTime, _idleTimeUnit);\n+                    if (task != null)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "458cb8c7edf91e01cd7de436374b737b2485d51f"}, "originalPosition": 85}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2760, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}