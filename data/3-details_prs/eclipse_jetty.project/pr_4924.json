{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI1Mjg4MjM3", "number": 4924, "title": "Issue #4923 - restore caching of SSLSession information for SSL Attributes", "bodyText": "Signed-off-by: Joakim Erdfelt joakim.erdfelt@gmail.com", "createdAt": "2020-05-29T19:29:01Z", "url": "https://github.com/eclipse/jetty.project/pull/4924", "merged": true, "mergeCommit": {"oid": "44d601aa604838462000d828a836d303c455fe9f"}, "closed": true, "closedAt": "2020-06-01T14:40:09Z", "author": {"login": "joakime"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcmGzlrgH2gAyNDI1Mjg4MjM3OmMxYzJjMDdhNTEzOGQ4ZWQ4MDIwZDE3YWMwNzA0MGYwNjY2ZTViODk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcm_nBpgFqTQyMTgxMTI4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c1c2c07a5138d8ed8020d17ac07040f0666e5b89", "author": {"user": {"login": "joakime", "name": "Joakim Erdfelt"}}, "url": "https://github.com/eclipse/jetty.project/commit/c1c2c07a5138d8ed8020d17ac07040f0666e5b89", "committedDate": "2020-05-29T18:30:59Z", "message": "Issue #4923 - restore caching of SSLSession information for SSL Attributes\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMjgzMDk4", "url": "https://github.com/eclipse/jetty.project/pull/4924#pullrequestreview-421283098", "createdAt": "2020-05-29T20:58:14Z", "commit": {"oid": "c1c2c07a5138d8ed8020d17ac07040f0666e5b89"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQyMDo1ODoxNVrOGcr27w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQyMTowMTozNlrOGcr8hA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjczMTg4Nw==", "bodyText": "Please rename the class to SslSessionData, and everywhere \"info\" to \"data\". Drop Cached.\nAlso make everything private: fields, methods, etc.", "url": "https://github.com/eclipse/jetty.project/pull/4924#discussion_r432731887", "createdAt": "2020-05-29T20:58:15Z", "author": {"login": "sbordet"}, "path": "jetty-server/src/main/java/org/eclipse/jetty/server/SecureRequestCustomizer.java", "diffHunk": "@@ -377,4 +397,41 @@ public Object getAttribute(String name)\n             return names;\n         }\n     }\n+\n+    /**\n+     * Simple bundle of information that is cached in the SSLSession. Stores the\n+     * effective keySize and the client certificate chain.\n+     */\n+    private static class CachedSslSessionInfo", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1c2c07a5138d8ed8020d17ac07040f0666e5b89"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjczMjQ5MA==", "bodyText": "Why Integer? Should be int.", "url": "https://github.com/eclipse/jetty.project/pull/4924#discussion_r432732490", "createdAt": "2020-05-29T20:59:43Z", "author": {"login": "sbordet"}, "path": "jetty-server/src/main/java/org/eclipse/jetty/server/SecureRequestCustomizer.java", "diffHunk": "@@ -377,4 +397,41 @@ public Object getAttribute(String name)\n             return names;\n         }\n     }\n+\n+    /**\n+     * Simple bundle of information that is cached in the SSLSession. Stores the\n+     * effective keySize and the client certificate chain.\n+     */\n+    private static class CachedSslSessionInfo\n+    {\n+        /**\n+         * The name of the SSLSession attribute that will contain any cached information.\n+         */\n+        public static final String ATTR = CachedSslSessionInfo.class.getName();\n+        private final X509Certificate[] _certs;\n+        private final Integer _keySize;\n+        private final String _idStr;\n+\n+        CachedSslSessionInfo(Integer keySize, X509Certificate[] certs, String idStr)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1c2c07a5138d8ed8020d17ac07040f0666e5b89"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjczMzMxNg==", "bodyText": "Keep field declarations in the same order as the constructor parameters and constructor assignments.", "url": "https://github.com/eclipse/jetty.project/pull/4924#discussion_r432733316", "createdAt": "2020-05-29T21:01:36Z", "author": {"login": "sbordet"}, "path": "jetty-server/src/main/java/org/eclipse/jetty/server/SecureRequestCustomizer.java", "diffHunk": "@@ -377,4 +397,41 @@ public Object getAttribute(String name)\n             return names;\n         }\n     }\n+\n+    /**\n+     * Simple bundle of information that is cached in the SSLSession. Stores the\n+     * effective keySize and the client certificate chain.\n+     */\n+    private static class CachedSslSessionInfo\n+    {\n+        /**\n+         * The name of the SSLSession attribute that will contain any cached information.\n+         */\n+        public static final String ATTR = CachedSslSessionInfo.class.getName();\n+        private final X509Certificate[] _certs;\n+        private final Integer _keySize;\n+        private final String _idStr;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1c2c07a5138d8ed8020d17ac07040f0666e5b89"}, "originalPosition": 77}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a953e3a0e0c6a8db40f2a0cc1f56078fcf37457", "author": {"user": {"login": "joakime", "name": "Joakim Erdfelt"}}, "url": "https://github.com/eclipse/jetty.project/commit/6a953e3a0e0c6a8db40f2a0cc1f56078fcf37457", "committedDate": "2020-05-29T21:30:08Z", "message": "Issue #4923 - Applying changes requested in PR\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMzEyOTI5", "url": "https://github.com/eclipse/jetty.project/pull/4924#pullrequestreview-421312929", "createdAt": "2020-05-29T21:42:48Z", "commit": {"oid": "6a953e3a0e0c6a8db40f2a0cc1f56078fcf37457"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQyMTo0Mjo0OFrOGcs6lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQyMTo0NjoyOVrOGctLGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc0OTIwNw==", "bodyText": "int, not Integer.", "url": "https://github.com/eclipse/jetty.project/pull/4924#discussion_r432749207", "createdAt": "2020-05-29T21:42:48Z", "author": {"login": "sbordet"}, "path": "jetty-server/src/main/java/org/eclipse/jetty/server/SecureRequestCustomizer.java", "diffHunk": "@@ -377,4 +400,40 @@ public Object getAttribute(String name)\n             return names;\n         }\n     }\n+\n+    /**\n+     * Simple bundle of information that is cached in the SSLSession.\n+     */\n+    private static class SslSessionData\n+    {\n+        /**\n+         * The name of the SSLSession attribute that will contain this information.\n+         */\n+        private static final String ATTR = SslSessionData.class.getName();\n+        private final Integer _keySize;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a953e3a0e0c6a8db40f2a0cc1f56078fcf37457"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc0OTkzMA==", "bodyText": "Put this getter after getKeySize() to be consistent with ordering.", "url": "https://github.com/eclipse/jetty.project/pull/4924#discussion_r432749930", "createdAt": "2020-05-29T21:43:27Z", "author": {"login": "sbordet"}, "path": "jetty-server/src/main/java/org/eclipse/jetty/server/SecureRequestCustomizer.java", "diffHunk": "@@ -377,4 +400,40 @@ public Object getAttribute(String name)\n             return names;\n         }\n     }\n+\n+    /**\n+     * Simple bundle of information that is cached in the SSLSession.\n+     */\n+    private static class SslSessionData\n+    {\n+        /**\n+         * The name of the SSLSession attribute that will contain this information.\n+         */\n+        private static final String ATTR = SslSessionData.class.getName();\n+        private final Integer _keySize;\n+        private final X509Certificate[] _certs;\n+        private final String _idStr;\n+\n+        private SslSessionData(int keySize, X509Certificate[] certs, String idStr)\n+        {\n+            this._keySize = keySize;\n+            this._certs = certs;\n+            this._idStr = idStr;\n+        }\n+\n+        private X509Certificate[] getCerts()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a953e3a0e0c6a8db40f2a0cc1f56078fcf37457"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc1MTA3OA==", "bodyText": "information -> data", "url": "https://github.com/eclipse/jetty.project/pull/4924#discussion_r432751078", "createdAt": "2020-05-29T21:44:27Z", "author": {"login": "sbordet"}, "path": "jetty-server/src/main/java/org/eclipse/jetty/server/SecureRequestCustomizer.java", "diffHunk": "@@ -377,4 +400,40 @@ public Object getAttribute(String name)\n             return names;\n         }\n     }\n+\n+    /**\n+     * Simple bundle of information that is cached in the SSLSession.\n+     */\n+    private static class SslSessionData\n+    {\n+        /**\n+         * The name of the SSLSession attribute that will contain this information.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a953e3a0e0c6a8db40f2a0cc1f56078fcf37457"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc1MTE3OQ==", "bodyText": "information -> data", "url": "https://github.com/eclipse/jetty.project/pull/4924#discussion_r432751179", "createdAt": "2020-05-29T21:44:33Z", "author": {"login": "sbordet"}, "path": "jetty-server/src/main/java/org/eclipse/jetty/server/SecureRequestCustomizer.java", "diffHunk": "@@ -377,4 +400,40 @@ public Object getAttribute(String name)\n             return names;\n         }\n     }\n+\n+    /**\n+     * Simple bundle of information that is cached in the SSLSession.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a953e3a0e0c6a8db40f2a0cc1f56078fcf37457"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc1MzQzNQ==", "bodyText": "This method is the only user of SslSessionData.ATTR.\nSo perhaps we don't need the constant in another class.\nWe can do at beginning of method:\nString key = SslSessionData.class.getName()\nand then use key where now we use ATTR.", "url": "https://github.com/eclipse/jetty.project/pull/4924#discussion_r432753435", "createdAt": "2020-05-29T21:46:29Z", "author": {"login": "sbordet"}, "path": "jetty-server/src/main/java/org/eclipse/jetty/server/SecureRequestCustomizer.java", "diffHunk": "@@ -363,6 +362,30 @@ public Object getAttribute(String name)\n             return null;\n         }\n \n+        /**\n+         * Get data belonging to the {@link SSLSession}.\n+         *\n+         * @return the SslSessionData\n+         */\n+        private SslSessionData getSslSessionData()\n+        {\n+            SslSessionData sslSessionData = (SslSessionData)_session.getValue(SslSessionData.ATTR);\n+            if (sslSessionData == null)\n+            {\n+                String cipherSuite = _session.getCipherSuite();\n+                int keySize = SslContextFactory.deduceKeyLength(cipherSuite);\n+\n+                X509Certificate[] certs = getCertChain(_request.getHttpChannel().getConnector(), _session);\n+\n+                byte[] bytes = _session.getId();\n+                String idStr = TypeUtil.toHexString(bytes);\n+\n+                sslSessionData = new SslSessionData(keySize, certs, idStr);\n+                _session.putValue(SslSessionData.ATTR, sslSessionData);\n+            }\n+            return sslSessionData;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a953e3a0e0c6a8db40f2a0cc1f56078fcf37457"}, "originalPosition": 57}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMzk0MjQ1", "url": "https://github.com/eclipse/jetty.project/pull/4924#pullrequestreview-421394245", "createdAt": "2020-05-30T10:05:02Z", "commit": {"oid": "6a953e3a0e0c6a8db40f2a0cc1f56078fcf37457"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQxMDowNTowM1rOGcxw_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQxMDowNTowM1rOGcxw_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgyODY3MQ==", "bodyText": "If the _keySize is an Integer then return that here so it doesn't get unboxed and reboxed.\nUse int everywhere or Integer everywhere.", "url": "https://github.com/eclipse/jetty.project/pull/4924#discussion_r432828671", "createdAt": "2020-05-30T10:05:03Z", "author": {"login": "gregw"}, "path": "jetty-server/src/main/java/org/eclipse/jetty/server/SecureRequestCustomizer.java", "diffHunk": "@@ -377,4 +400,40 @@ public Object getAttribute(String name)\n             return names;\n         }\n     }\n+\n+    /**\n+     * Simple bundle of information that is cached in the SSLSession.\n+     */\n+    private static class SslSessionData\n+    {\n+        /**\n+         * The name of the SSLSession attribute that will contain this information.\n+         */\n+        private static final String ATTR = SslSessionData.class.getName();\n+        private final Integer _keySize;\n+        private final X509Certificate[] _certs;\n+        private final String _idStr;\n+\n+        private SslSessionData(int keySize, X509Certificate[] certs, String idStr)\n+        {\n+            this._keySize = keySize;\n+            this._certs = certs;\n+            this._idStr = idStr;\n+        }\n+\n+        private X509Certificate[] getCerts()\n+        {\n+            return _certs;\n+        }\n+\n+        private int getKeySize()\n+        {\n+            return _keySize;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a953e3a0e0c6a8db40f2a0cc1f56078fcf37457"}, "originalPosition": 95}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNjgwMjEx", "url": "https://github.com/eclipse/jetty.project/pull/4924#pullrequestreview-421680211", "createdAt": "2020-06-01T08:36:47Z", "commit": {"oid": "6a953e3a0e0c6a8db40f2a0cc1f56078fcf37457"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6d24c2396f71ce9420ac51f038fc4191cf4f487", "author": {"user": {"login": "joakime", "name": "Joakim Erdfelt"}}, "url": "https://github.com/eclipse/jetty.project/commit/b6d24c2396f71ce9420ac51f038fc4191cf4f487", "committedDate": "2020-06-01T12:13:28Z", "message": "Issue #4923 - Applying changes requested in PR\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9b75ff1a30ba7ac88db529203f7b6520aa2692c", "author": {"user": {"login": "joakime", "name": "Joakim Erdfelt"}}, "url": "https://github.com/eclipse/jetty.project/commit/f9b75ff1a30ba7ac88db529203f7b6520aa2692c", "committedDate": "2020-06-01T12:15:07Z", "message": "Issue #4923 - Applying changes requested in PR\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNzk3NTMw", "url": "https://github.com/eclipse/jetty.project/pull/4924#pullrequestreview-421797530", "createdAt": "2020-06-01T12:17:09Z", "commit": {"oid": "f9b75ff1a30ba7ac88db529203f7b6520aa2692c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxODExMjgw", "url": "https://github.com/eclipse/jetty.project/pull/4924#pullrequestreview-421811280", "createdAt": "2020-06-01T12:41:51Z", "commit": {"oid": "f9b75ff1a30ba7ac88db529203f7b6520aa2692c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 425, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}