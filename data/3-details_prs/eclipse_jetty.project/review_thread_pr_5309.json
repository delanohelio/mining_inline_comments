{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwNTYxMDE2", "number": 5309, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMTozMTowMlrOEmCjyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMTo0Mjo0NFrOEmCybw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MzIzMjc0OnYy", "diffSide": "RIGHT", "path": "jetty-start/src/main/resources/org/eclipse/jetty/start/usage.txt", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMTozMTowMlrOHV1qXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMTozMTowMlrOHV1qXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY2MTM0MA==", "bodyText": "\"all it is moved ....\" you mean \"all its configuration\"?", "url": "https://github.com/eclipse/jetty.project/pull/5309#discussion_r492661340", "createdAt": "2020-09-22T11:31:02Z", "author": {"login": "janbartel"}, "path": "jetty-start/src/main/resources/org/eclipse/jetty/start/usage.txt", "diffHunk": "@@ -124,15 +124,21 @@ Jetty Module Management:\n                    be generated. An explicit --add-module is required to generate\n                    an ini file.\n \n-                   This option replaces the depecated --add-to-start and --add-to-startd.\n+                   This option replaces the deprecated --add-to-start and --add-to-startd.\n \n   --update-ini     Scan all start.ini and start.d/*.ini files and update\n                    any properties with values specified on the command\n                    line. e.g. --update-ini jetty.http.port=8888\n \n+  --create-start-d\n+                   Create a ${jetty.base}/start.d directory.  If a ${jetty.base}/start.ini\n+                   files exists, then all it is moved into start.d. Using a start.d directory", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9beb685b37f0118a739d6afe2f07082af8ed77ce"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MzIzNDM4OnYy", "diffSide": "RIGHT", "path": "jetty-start/src/main/resources/org/eclipse/jetty/start/usage.txt", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMTozMTozM1rOHV1rag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMTozMTozM1rOHV1rag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY2MTYxMA==", "bodyText": "No apostrophe for its.", "url": "https://github.com/eclipse/jetty.project/pull/5309#discussion_r492661610", "createdAt": "2020-09-22T11:31:33Z", "author": {"login": "janbartel"}, "path": "jetty-start/src/main/resources/org/eclipse/jetty/start/usage.txt", "diffHunk": "@@ -124,15 +124,21 @@ Jetty Module Management:\n                    be generated. An explicit --add-module is required to generate\n                    an ini file.\n \n-                   This option replaces the depecated --add-to-start and --add-to-startd.\n+                   This option replaces the deprecated --add-to-start and --add-to-startd.\n \n   --update-ini     Scan all start.ini and start.d/*.ini files and update\n                    any properties with values specified on the command\n                    line. e.g. --update-ini jetty.http.port=8888\n \n+  --create-start-d\n+                   Create a ${jetty.base}/start.d directory.  If a ${jetty.base}/start.ini\n+                   files exists, then all it is moved into start.d. Using a start.d directory\n+                   is the default and this option is only needed to either force the creation of a\n+                   ${jetty.home}/start.d or to move a start.ini file to start.d\n+\n   --create-start-ini\n                    Create a ${jetty.base}/start.ini file.  If a ${jetty.base}/start.d\n-                   directory exists, then all it's contained ini files are concatinated into\n+                   directory exists, then all it's contained ini files are concatenated into", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9beb685b37f0118a739d6afe2f07082af8ed77ce"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MzIzODY3OnYy", "diffSide": "RIGHT", "path": "jetty-start/src/main/resources/org/eclipse/jetty/start/usage.txt", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMTozMzowMFrOHV1uIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMTo0Nzo1NVrOHV2L6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY2MjMwNA==", "bodyText": "Typo: its has no apostrophe.", "url": "https://github.com/eclipse/jetty.project/pull/5309#discussion_r492662304", "createdAt": "2020-09-22T11:33:00Z", "author": {"login": "janbartel"}, "path": "jetty-start/src/main/resources/org/eclipse/jetty/start/usage.txt", "diffHunk": "@@ -124,15 +124,21 @@ Jetty Module Management:\n                    be generated. An explicit --add-module is required to generate", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9beb685b37f0118a739d6afe2f07082af8ed77ce"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY2OTkyOQ==", "bodyText": "yeah it was a typo :)", "url": "https://github.com/eclipse/jetty.project/pull/5309#discussion_r492669929", "createdAt": "2020-09-22T11:47:55Z", "author": {"login": "gregw"}, "path": "jetty-start/src/main/resources/org/eclipse/jetty/start/usage.txt", "diffHunk": "@@ -124,15 +124,21 @@ Jetty Module Management:\n                    be generated. An explicit --add-module is required to generate", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY2MjMwNA=="}, "originalCommit": {"oid": "9beb685b37f0118a739d6afe2f07082af8ed77ce"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MzI1Mzk5OnYy", "diffSide": "RIGHT", "path": "jetty-start/src/main/java/org/eclipse/jetty/start/BaseBuilder.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMTozNzo0MlrOHV13fQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMTozNzo0MlrOHV13fQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY2NDcwMQ==", "bodyText": "\"Use of both ...\"", "url": "https://github.com/eclipse/jetty.project/pull/5309#discussion_r492664701", "createdAt": "2020-09-22T11:37:42Z", "author": {"login": "janbartel"}, "path": "jetty-start/src/main/java/org/eclipse/jetty/start/BaseBuilder.java", "diffHunk": "@@ -222,72 +227,98 @@ public boolean accept(Path entry) throws IOException\n             }\n         }\n \n-        if (!newlyAdded.isEmpty())\n+        if ((startArgs.isCreateStartD() && (!Files.exists(startd) || Files.exists(startini))) ||\n+            (!newlyAdded.isEmpty() && !Files.exists(startini) && !Files.exists(startd)))\n         {\n-            if (!Files.exists(startini) && !Files.exists(startd) && FS.ensureDirectoryExists(startd))\n+            if (Files.exists(getBaseHome().getBasePath(\"start.jar\")) && !startArgs.isCreateStartD())\n+            {\n+                StartLog.warn(\"creating start.d in ${jetty.home} is not recommended!\");\n+                if (!startArgs.isCreateStartD())\n+                {\n+                    BufferedReader input = new BufferedReader(new InputStreamReader(System.in));\n+                    System.err.printf(\"%nProceed (y/N)? \");\n+                    String response = input.readLine();\n+\n+                    if (Utils.isBlank(response) || !response.toLowerCase(Locale.ENGLISH).startsWith(\"y\"))\n+                        System.exit(1);\n+                }\n+            }\n+\n+            if (FS.ensureDirectoryExists(startd))\n             {\n                 StartLog.info(\"mkdir \" + baseHome.toShortForm(startd));\n                 modified.set(true);\n             }\n \n-            if (Files.exists(startini) && Files.exists(startd))\n-                StartLog.warn(\"Use both %s and %s is deprecated\", getBaseHome().toShortForm(startd), getBaseHome().toShortForm(startini));\n-\n-            boolean useStartD = Files.exists(startd);\n-            builder.set(useStartD ? new StartDirBuilder(this) : new StartIniBuilder(this));\n-            newlyAdded.stream().map(modules::get).forEach(module ->\n+            if (Files.exists(startini) && startArgs.isCreateStartD())\n             {\n-                String ini = null;\n-                try\n+                int ini = 0;\n+                Path startdStartini = startd.resolve(\"start.ini\");\n+                while (Files.exists(startdStartini))\n                 {\n-                    if (module.isSkipFilesValidation())\n-                    {\n-                        StartLog.debug(\"Skipping [files] validation on %s\", module.getName());\n-                    }\n-                    else\n-                    {\n-                        // if (explicitly added and ini file modified)\n-                        if (startArgs.getStartModules().contains(module.getName()))\n-                        {\n-                            ini = builder.get().addModule(module, startArgs.getProperties());\n-                            if (ini != null)\n-                                modified.set(true);\n-                        }\n-                        for (String file : module.getFiles())\n-                        {\n-                            files.add(new FileArg(module, startArgs.getProperties().expand(file)));\n-                        }\n-                    }\n+                    ini++;\n+                    startdStartini = startd.resolve(\"start\" + ini + \".ini\");\n                 }\n-                catch (Exception e)\n+                Files.move(startini, startdStartini);\n+                modified.set(true);\n+            }\n+        }\n+\n+        boolean useStartD = Files.exists(startd);\n+        if (useStartD && Files.exists(startini))\n+            StartLog.warn(\"Use both %s and %s is deprecated\", getBaseHome().toShortForm(startd), getBaseHome().toShortForm(startini));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9beb685b37f0118a739d6afe2f07082af8ed77ce"}, "originalPosition": 102}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MzI3MDIzOnYy", "diffSide": "RIGHT", "path": "jetty-start/src/main/java/org/eclipse/jetty/start/BaseBuilder.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMTo0Mjo0NFrOHV2BSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMTo0OToyNFrOHV2O2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY2NzIxMA==", "bodyText": "So if you put both --create-startd and --create-start-ini on the command line what would happen? Is it dependent on the ordering on the command line? Should it be an error?", "url": "https://github.com/eclipse/jetty.project/pull/5309#discussion_r492667210", "createdAt": "2020-09-22T11:42:44Z", "author": {"login": "janbartel"}, "path": "jetty-start/src/main/java/org/eclipse/jetty/start/BaseBuilder.java", "diffHunk": "@@ -222,72 +227,98 @@ public boolean accept(Path entry) throws IOException\n             }\n         }\n \n-        if (!newlyAdded.isEmpty())\n+        if ((startArgs.isCreateStartD() && (!Files.exists(startd) || Files.exists(startini))) ||\n+            (!newlyAdded.isEmpty() && !Files.exists(startini) && !Files.exists(startd)))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9beb685b37f0118a739d6afe2f07082af8ed77ce"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY3MDY4Mw==", "bodyText": "No it will first create start.ini and then create start.d and move that start.ini into it.", "url": "https://github.com/eclipse/jetty.project/pull/5309#discussion_r492670683", "createdAt": "2020-09-22T11:49:24Z", "author": {"login": "gregw"}, "path": "jetty-start/src/main/java/org/eclipse/jetty/start/BaseBuilder.java", "diffHunk": "@@ -222,72 +227,98 @@ public boolean accept(Path entry) throws IOException\n             }\n         }\n \n-        if (!newlyAdded.isEmpty())\n+        if ((startArgs.isCreateStartD() && (!Files.exists(startd) || Files.exists(startini))) ||\n+            (!newlyAdded.isEmpty() && !Files.exists(startini) && !Files.exists(startd)))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY2NzIxMA=="}, "originalCommit": {"oid": "9beb685b37f0118a739d6afe2f07082af8ed77ce"}, "originalPosition": 36}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2244, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}