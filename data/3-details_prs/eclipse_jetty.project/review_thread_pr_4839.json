{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEyNTY2NDIx", "number": 4839, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxODoxOTo0MFrOD4zJaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxODoyMzo1OFrOD4zK8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwODg0ODQwOnYy", "diffSide": "RIGHT", "path": "jetty-slf4j-impl/src/test/java/org/eclipse/jetty/logging/JettyLoggerTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxODoxOTo0MFrOGPuRzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxODo1NzoyMFrOGPujAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE0MDA0Ng==", "bodyText": "What?\nOFF != ERROR", "url": "https://github.com/eclipse/jetty.project/pull/4839#discussion_r419140046", "createdAt": "2020-05-03T18:19:40Z", "author": {"login": "joakime"}, "path": "jetty-slf4j-impl/src/test/java/org/eclipse/jetty/logging/JettyLoggerTest.java", "diffHunk": "@@ -526,7 +526,7 @@ public void testToString()\n         assertThat(\"Logger.toString\", log.toString(), is(\"JettyLogger:xxx:LEVEL=ERROR\"));\n \n         log.setLevel(JettyLogger.OFF);\n-        assertThat(\"Logger.toString\", log.toString(), is(\"JettyLogger:xxx:LEVEL=OFF\"));\n+        assertThat(\"Logger.toString\", log.toString(), is(\"JettyLogger:xxx:LEVEL=ERROR\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2399205ff7d7820c6757d0f9f4acec9bea79412"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE0NDQ1MA==", "bodyText": "In #4831, \"OFF\" is converted to 999 and 999 is converted to Level.ERROR. So, uhm, why don't we get rid of OFF and just call it ERROR so it conforms to SLF4J?", "url": "https://github.com/eclipse/jetty.project/pull/4839#discussion_r419144450", "createdAt": "2020-05-03T18:57:20Z", "author": {"login": "sbordet"}, "path": "jetty-slf4j-impl/src/test/java/org/eclipse/jetty/logging/JettyLoggerTest.java", "diffHunk": "@@ -526,7 +526,7 @@ public void testToString()\n         assertThat(\"Logger.toString\", log.toString(), is(\"JettyLogger:xxx:LEVEL=ERROR\"));\n \n         log.setLevel(JettyLogger.OFF);\n-        assertThat(\"Logger.toString\", log.toString(), is(\"JettyLogger:xxx:LEVEL=OFF\"));\n+        assertThat(\"Logger.toString\", log.toString(), is(\"JettyLogger:xxx:LEVEL=ERROR\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE0MDA0Ng=="}, "originalCommit": {"oid": "d2399205ff7d7820c6757d0f9f4acec9bea79412"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwODg1MDU2OnYy", "diffSide": "RIGHT", "path": "jetty-slf4j-impl/src/main/java/org/eclipse/jetty/logging/LevelUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxODoyMTo0NFrOGPuS0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxOTowNTo0MFrOGPum2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE0MDMwNg==", "bodyText": "This needs testing.\nAlso, if someone provides an invalid levelStr, either from JMX or from the properties file, it should output a System.err indicating the bad usage and what are valid values, if used from a properties file, the name/key of the property should be indicated as well.", "url": "https://github.com/eclipse/jetty.project/pull/4839#discussion_r419140306", "createdAt": "2020-05-03T18:21:44Z", "author": {"login": "joakime"}, "path": "jetty-slf4j-impl/src/main/java/org/eclipse/jetty/logging/LevelUtils.java", "diffHunk": "@@ -0,0 +1,57 @@\n+//\n+// ========================================================================\n+// Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//\n+// This program and the accompanying materials are made available under\n+// the terms of the Eclipse Public License 2.0 which is available at\n+// https://www.eclipse.org/legal/epl-2.0\n+//\n+// This Source Code may also be made available under the following\n+// Secondary Licenses when the conditions for such availability set\n+// forth in the Eclipse Public License, v. 2.0 are satisfied:\n+// the Apache License v2.0 which is available at\n+// https://www.apache.org/licenses/LICENSE-2.0\n+//\n+// SPDX-License-Identifier: EPL-2.0 OR Apache-2.0\n+// ========================================================================\n+//\n+\n+package org.eclipse.jetty.logging;\n+\n+import java.util.Locale;\n+\n+import org.slf4j.event.Level;\n+\n+public class LevelUtils\n+{\n+    public static Integer getLevelInt(String levelStr)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2399205ff7d7820c6757d0f9f4acec9bea79412"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE0NTQzMw==", "bodyText": "I disagree on System.err because it often gets replaced to a logger and it would cause a stack overflow.\nDo we have a way to be completely sure that System.err is not replaced with one of our loggers?\nWhat more testing do you need?", "url": "https://github.com/eclipse/jetty.project/pull/4839#discussion_r419145433", "createdAt": "2020-05-03T19:05:40Z", "author": {"login": "sbordet"}, "path": "jetty-slf4j-impl/src/main/java/org/eclipse/jetty/logging/LevelUtils.java", "diffHunk": "@@ -0,0 +1,57 @@\n+//\n+// ========================================================================\n+// Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//\n+// This program and the accompanying materials are made available under\n+// the terms of the Eclipse Public License 2.0 which is available at\n+// https://www.eclipse.org/legal/epl-2.0\n+//\n+// This Source Code may also be made available under the following\n+// Secondary Licenses when the conditions for such availability set\n+// forth in the Eclipse Public License, v. 2.0 are satisfied:\n+// the Apache License v2.0 which is available at\n+// https://www.apache.org/licenses/LICENSE-2.0\n+//\n+// SPDX-License-Identifier: EPL-2.0 OR Apache-2.0\n+// ========================================================================\n+//\n+\n+package org.eclipse.jetty.logging;\n+\n+import java.util.Locale;\n+\n+import org.slf4j.event.Level;\n+\n+public class LevelUtils\n+{\n+    public static Integer getLevelInt(String levelStr)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE0MDMwNg=="}, "originalCommit": {"oid": "d2399205ff7d7820c6757d0f9f4acec9bea79412"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwODg1MTUzOnYy", "diffSide": "RIGHT", "path": "jetty-slf4j-impl/src/test/java/org/eclipse/jetty/logging/JMXTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxODoyMzowMFrOGPuTSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxODo1ODozMVrOGPujhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE0MDQyNw==", "bodyText": "How about using the JMX version here?\nsetLoggerLevel(String loggerName, String levelName)", "url": "https://github.com/eclipse/jetty.project/pull/4839#discussion_r419140427", "createdAt": "2020-05-03T18:23:00Z", "author": {"login": "joakime"}, "path": "jetty-slf4j-impl/src/test/java/org/eclipse/jetty/logging/JMXTest.java", "diffHunk": "@@ -0,0 +1,74 @@\n+//\n+// ========================================================================\n+// Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//\n+// This program and the accompanying materials are made available under\n+// the terms of the Eclipse Public License 2.0 which is available at\n+// https://www.eclipse.org/legal/epl-2.0\n+//\n+// This Source Code may also be made available under the following\n+// Secondary Licenses when the conditions for such availability set\n+// forth in the Eclipse Public License, v. 2.0 are satisfied:\n+// the Apache License v2.0 which is available at\n+// https://www.apache.org/licenses/LICENSE-2.0\n+//\n+// SPDX-License-Identifier: EPL-2.0 OR Apache-2.0\n+// ========================================================================\n+//\n+\n+package org.eclipse.jetty.logging;\n+\n+import java.lang.management.ManagementFactory;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Locale;\n+import java.util.Properties;\n+import javax.management.JMX;\n+import javax.management.MBeanServer;\n+import javax.management.ObjectName;\n+\n+import org.junit.jupiter.api.Test;\n+import org.slf4j.event.Level;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+public class JMXTest\n+{\n+    @Test\n+    public void testJMX() throws Exception\n+    {\n+        MBeanServer mbeanServer = ManagementFactory.getPlatformMBeanServer();\n+\n+        Properties props = new Properties();\n+        JettyLoggerConfiguration config = new JettyLoggerConfiguration(props);\n+        JettyLoggerFactory loggerFactory = new JettyLoggerFactory(config);\n+\n+        ObjectName objectName = ObjectName.getInstance(\"org.eclipse.jetty.logging\", \"type\", JettyLoggerFactory.class.getSimpleName().toLowerCase(Locale.ENGLISH));\n+        mbeanServer.registerMBean(loggerFactory, objectName);\n+\n+        JettyLoggerFactoryMBean mbean = JMX.newMBeanProxy(mbeanServer, objectName, JettyLoggerFactoryMBean.class);\n+\n+        // Only the root logger.\n+        assertEquals(1, mbean.getLoggerCount());\n+\n+        JettyLogger child = loggerFactory.getJettyLogger(\"org.eclipse.jetty.logging\");\n+        JettyLogger parent = loggerFactory.getJettyLogger(\"org.eclipse.jetty\");\n+        assertEquals(3, mbean.getLoggerCount());\n+\n+        // Names are sorted.\n+        List<String> expected = new ArrayList<>(Arrays.asList(JettyLogger.ROOT_LOGGER_NAME, parent.getName(), child.getName()));\n+        expected.sort(String::compareTo);\n+        String[] loggerNames = mbean.getLoggerNames();\n+        assertEquals(expected, Arrays.asList(loggerNames));\n+\n+        // Setting the parent level should propagate to the children.\n+        parent.setLevel(Level.DEBUG);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2399205ff7d7820c6757d0f9f4acec9bea79412"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE0NDU4MQ==", "bodyText": "It's done 2 lines below.", "url": "https://github.com/eclipse/jetty.project/pull/4839#discussion_r419144581", "createdAt": "2020-05-03T18:58:31Z", "author": {"login": "sbordet"}, "path": "jetty-slf4j-impl/src/test/java/org/eclipse/jetty/logging/JMXTest.java", "diffHunk": "@@ -0,0 +1,74 @@\n+//\n+// ========================================================================\n+// Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//\n+// This program and the accompanying materials are made available under\n+// the terms of the Eclipse Public License 2.0 which is available at\n+// https://www.eclipse.org/legal/epl-2.0\n+//\n+// This Source Code may also be made available under the following\n+// Secondary Licenses when the conditions for such availability set\n+// forth in the Eclipse Public License, v. 2.0 are satisfied:\n+// the Apache License v2.0 which is available at\n+// https://www.apache.org/licenses/LICENSE-2.0\n+//\n+// SPDX-License-Identifier: EPL-2.0 OR Apache-2.0\n+// ========================================================================\n+//\n+\n+package org.eclipse.jetty.logging;\n+\n+import java.lang.management.ManagementFactory;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Locale;\n+import java.util.Properties;\n+import javax.management.JMX;\n+import javax.management.MBeanServer;\n+import javax.management.ObjectName;\n+\n+import org.junit.jupiter.api.Test;\n+import org.slf4j.event.Level;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+public class JMXTest\n+{\n+    @Test\n+    public void testJMX() throws Exception\n+    {\n+        MBeanServer mbeanServer = ManagementFactory.getPlatformMBeanServer();\n+\n+        Properties props = new Properties();\n+        JettyLoggerConfiguration config = new JettyLoggerConfiguration(props);\n+        JettyLoggerFactory loggerFactory = new JettyLoggerFactory(config);\n+\n+        ObjectName objectName = ObjectName.getInstance(\"org.eclipse.jetty.logging\", \"type\", JettyLoggerFactory.class.getSimpleName().toLowerCase(Locale.ENGLISH));\n+        mbeanServer.registerMBean(loggerFactory, objectName);\n+\n+        JettyLoggerFactoryMBean mbean = JMX.newMBeanProxy(mbeanServer, objectName, JettyLoggerFactoryMBean.class);\n+\n+        // Only the root logger.\n+        assertEquals(1, mbean.getLoggerCount());\n+\n+        JettyLogger child = loggerFactory.getJettyLogger(\"org.eclipse.jetty.logging\");\n+        JettyLogger parent = loggerFactory.getJettyLogger(\"org.eclipse.jetty\");\n+        assertEquals(3, mbean.getLoggerCount());\n+\n+        // Names are sorted.\n+        List<String> expected = new ArrayList<>(Arrays.asList(JettyLogger.ROOT_LOGGER_NAME, parent.getName(), child.getName()));\n+        expected.sort(String::compareTo);\n+        String[] loggerNames = mbean.getLoggerNames();\n+        assertEquals(expected, Arrays.asList(loggerNames));\n+\n+        // Setting the parent level should propagate to the children.\n+        parent.setLevel(Level.DEBUG);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE0MDQyNw=="}, "originalCommit": {"oid": "d2399205ff7d7820c6757d0f9f4acec9bea79412"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwODg1MjM0OnYy", "diffSide": "RIGHT", "path": "jetty-slf4j-impl/src/main/java/org/eclipse/jetty/logging/JettyLoggerFactory.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxODoyMzo1OFrOGPuTsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNTozNjo1NVrOGSEdNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE0MDUyOQ==", "bodyText": "last Segment should be ROOT_LOGGER_NAME, not an empty string.", "url": "https://github.com/eclipse/jetty.project/pull/4839#discussion_r419140529", "createdAt": "2020-05-03T18:23:58Z", "author": {"login": "joakime"}, "path": "jetty-slf4j-impl/src/main/java/org/eclipse/jetty/logging/JettyLoggerFactory.java", "diffHunk": "@@ -74,109 +79,93 @@ public Logger getLogger(String name)\n         return getJettyLogger(name);\n     }\n \n-    protected void walkChildLoggers(String parentName, Consumer<JettyLogger> childConsumer)\n+    void walkChildrenLoggers(String parentName, Consumer<JettyLogger> childConsumer)\n     {\n         String prefix = parentName;\n         if (parentName.length() > 0 && !prefix.endsWith(\".\"))\n-        {\n             prefix += \".\";\n-        }\n \n         for (JettyLogger logger : loggerMap.values())\n         {\n+            // Skip self.\n             if (logger.getName().equals(parentName))\n-            {\n-                // skip self\n                 continue;\n-            }\n \n-            // is child, and is not itself\n+            // It is a child, and is not itself.\n             if (logger.getName().startsWith(prefix))\n-            {\n                 childConsumer.accept(logger);\n-            }\n         }\n     }\n \n-    public JettyLogger getRootLogger()\n+    JettyLogger getRootLogger()\n     {\n         return rootLogger;\n     }\n \n     private JettyLogger createLogger(String name)\n     {\n-        // or is that handled by slf4j itself?\n         JettyAppender appender = rootLogger.getAppender();\n         int level = this.configuration.getLevel(name);\n         boolean hideStacks = this.configuration.getHideStacks(name);\n         return new JettyLogger(this, name, appender, level, hideStacks);\n     }\n \n-    /**\n-     * Condenses a classname by stripping down the package name to just the first character of each package name\n-     * segment.Configured\n-     *\n-     * <pre>\n-     * Examples:\n-     * \"org.eclipse.jetty.test.FooTest\"           = \"oejt.FooTest\"\n-     * \"org.eclipse.jetty.server.logging.LogTest\" = \"orjsl.LogTest\"\n-     * </pre>\n-     *\n-     * @param classname the fully qualified class name\n-     * @return the condensed name\n-     */\n-    protected static String condensePackageString(String classname)\n+    static <T> T walkParentLoggerNames(String startName, Function<String, T> nameFunction)\n     {\n-        if (classname == null || classname.isEmpty())\n-        {\n-            return \"\";\n-        }\n+        if (startName == null)\n+            return null;\n \n-        int rawLen = classname.length();\n-        StringBuilder dense = new StringBuilder(rawLen);\n-        boolean foundStart = false;\n-        boolean hasPackage = false;\n-        int startIdx = -1;\n-        int endIdx = -1;\n-        for (int i = 0; i < rawLen; i++)\n+        // Checking with FQCN first, then each package segment from longest to shortest.\n+        String nameSegment = startName;\n+        while (nameSegment.length() > 0)\n         {\n-            char c = classname.charAt(i);\n-            if (!foundStart)\n-            {\n-                foundStart = Character.isJavaIdentifierStart(c);\n-                if (foundStart)\n-                {\n-                    if (startIdx >= 0)\n-                    {\n-                        dense.append(classname.charAt(startIdx));\n-                        hasPackage = true;\n-                    }\n-                    startIdx = i;\n-                }\n-            }\n-\n-            if (foundStart)\n-            {\n-                if (!Character.isJavaIdentifierPart(c))\n-                {\n-                    foundStart = false;\n-                }\n-                else\n-                {\n-                    endIdx = i;\n-                }\n-            }\n+            T ret = nameFunction.apply(nameSegment);\n+            if (ret != null)\n+                return ret;\n+\n+            // Trim and try again.\n+            int idx = nameSegment.lastIndexOf('.');\n+            if (idx >= 0)\n+                nameSegment = nameSegment.substring(0, idx);\n+            else\n+                break;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2399205ff7d7820c6757d0f9f4acec9bea79412"}, "originalPosition": 172}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE0NTA1Ng==", "bodyText": "I agree, so it was wrong in #4831 too, right?", "url": "https://github.com/eclipse/jetty.project/pull/4839#discussion_r419145056", "createdAt": "2020-05-03T19:02:29Z", "author": {"login": "sbordet"}, "path": "jetty-slf4j-impl/src/main/java/org/eclipse/jetty/logging/JettyLoggerFactory.java", "diffHunk": "@@ -74,109 +79,93 @@ public Logger getLogger(String name)\n         return getJettyLogger(name);\n     }\n \n-    protected void walkChildLoggers(String parentName, Consumer<JettyLogger> childConsumer)\n+    void walkChildrenLoggers(String parentName, Consumer<JettyLogger> childConsumer)\n     {\n         String prefix = parentName;\n         if (parentName.length() > 0 && !prefix.endsWith(\".\"))\n-        {\n             prefix += \".\";\n-        }\n \n         for (JettyLogger logger : loggerMap.values())\n         {\n+            // Skip self.\n             if (logger.getName().equals(parentName))\n-            {\n-                // skip self\n                 continue;\n-            }\n \n-            // is child, and is not itself\n+            // It is a child, and is not itself.\n             if (logger.getName().startsWith(prefix))\n-            {\n                 childConsumer.accept(logger);\n-            }\n         }\n     }\n \n-    public JettyLogger getRootLogger()\n+    JettyLogger getRootLogger()\n     {\n         return rootLogger;\n     }\n \n     private JettyLogger createLogger(String name)\n     {\n-        // or is that handled by slf4j itself?\n         JettyAppender appender = rootLogger.getAppender();\n         int level = this.configuration.getLevel(name);\n         boolean hideStacks = this.configuration.getHideStacks(name);\n         return new JettyLogger(this, name, appender, level, hideStacks);\n     }\n \n-    /**\n-     * Condenses a classname by stripping down the package name to just the first character of each package name\n-     * segment.Configured\n-     *\n-     * <pre>\n-     * Examples:\n-     * \"org.eclipse.jetty.test.FooTest\"           = \"oejt.FooTest\"\n-     * \"org.eclipse.jetty.server.logging.LogTest\" = \"orjsl.LogTest\"\n-     * </pre>\n-     *\n-     * @param classname the fully qualified class name\n-     * @return the condensed name\n-     */\n-    protected static String condensePackageString(String classname)\n+    static <T> T walkParentLoggerNames(String startName, Function<String, T> nameFunction)\n     {\n-        if (classname == null || classname.isEmpty())\n-        {\n-            return \"\";\n-        }\n+        if (startName == null)\n+            return null;\n \n-        int rawLen = classname.length();\n-        StringBuilder dense = new StringBuilder(rawLen);\n-        boolean foundStart = false;\n-        boolean hasPackage = false;\n-        int startIdx = -1;\n-        int endIdx = -1;\n-        for (int i = 0; i < rawLen; i++)\n+        // Checking with FQCN first, then each package segment from longest to shortest.\n+        String nameSegment = startName;\n+        while (nameSegment.length() > 0)\n         {\n-            char c = classname.charAt(i);\n-            if (!foundStart)\n-            {\n-                foundStart = Character.isJavaIdentifierStart(c);\n-                if (foundStart)\n-                {\n-                    if (startIdx >= 0)\n-                    {\n-                        dense.append(classname.charAt(startIdx));\n-                        hasPackage = true;\n-                    }\n-                    startIdx = i;\n-                }\n-            }\n-\n-            if (foundStart)\n-            {\n-                if (!Character.isJavaIdentifierPart(c))\n-                {\n-                    foundStart = false;\n-                }\n-                else\n-                {\n-                    endIdx = i;\n-                }\n-            }\n+            T ret = nameFunction.apply(nameSegment);\n+            if (ret != null)\n+                return ret;\n+\n+            // Trim and try again.\n+            int idx = nameSegment.lastIndexOf('.');\n+            if (idx >= 0)\n+                nameSegment = nameSegment.substring(0, idx);\n+            else\n+                break;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE0MDUyOQ=="}, "originalCommit": {"oid": "d2399205ff7d7820c6757d0f9f4acec9bea79412"}, "originalPosition": 172}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTYwMDU2Ng==", "bodyText": "Yeah, I think it has been wrong since before this PR.", "url": "https://github.com/eclipse/jetty.project/pull/4839#discussion_r421600566", "createdAt": "2020-05-07T15:36:55Z", "author": {"login": "joakime"}, "path": "jetty-slf4j-impl/src/main/java/org/eclipse/jetty/logging/JettyLoggerFactory.java", "diffHunk": "@@ -74,109 +79,93 @@ public Logger getLogger(String name)\n         return getJettyLogger(name);\n     }\n \n-    protected void walkChildLoggers(String parentName, Consumer<JettyLogger> childConsumer)\n+    void walkChildrenLoggers(String parentName, Consumer<JettyLogger> childConsumer)\n     {\n         String prefix = parentName;\n         if (parentName.length() > 0 && !prefix.endsWith(\".\"))\n-        {\n             prefix += \".\";\n-        }\n \n         for (JettyLogger logger : loggerMap.values())\n         {\n+            // Skip self.\n             if (logger.getName().equals(parentName))\n-            {\n-                // skip self\n                 continue;\n-            }\n \n-            // is child, and is not itself\n+            // It is a child, and is not itself.\n             if (logger.getName().startsWith(prefix))\n-            {\n                 childConsumer.accept(logger);\n-            }\n         }\n     }\n \n-    public JettyLogger getRootLogger()\n+    JettyLogger getRootLogger()\n     {\n         return rootLogger;\n     }\n \n     private JettyLogger createLogger(String name)\n     {\n-        // or is that handled by slf4j itself?\n         JettyAppender appender = rootLogger.getAppender();\n         int level = this.configuration.getLevel(name);\n         boolean hideStacks = this.configuration.getHideStacks(name);\n         return new JettyLogger(this, name, appender, level, hideStacks);\n     }\n \n-    /**\n-     * Condenses a classname by stripping down the package name to just the first character of each package name\n-     * segment.Configured\n-     *\n-     * <pre>\n-     * Examples:\n-     * \"org.eclipse.jetty.test.FooTest\"           = \"oejt.FooTest\"\n-     * \"org.eclipse.jetty.server.logging.LogTest\" = \"orjsl.LogTest\"\n-     * </pre>\n-     *\n-     * @param classname the fully qualified class name\n-     * @return the condensed name\n-     */\n-    protected static String condensePackageString(String classname)\n+    static <T> T walkParentLoggerNames(String startName, Function<String, T> nameFunction)\n     {\n-        if (classname == null || classname.isEmpty())\n-        {\n-            return \"\";\n-        }\n+        if (startName == null)\n+            return null;\n \n-        int rawLen = classname.length();\n-        StringBuilder dense = new StringBuilder(rawLen);\n-        boolean foundStart = false;\n-        boolean hasPackage = false;\n-        int startIdx = -1;\n-        int endIdx = -1;\n-        for (int i = 0; i < rawLen; i++)\n+        // Checking with FQCN first, then each package segment from longest to shortest.\n+        String nameSegment = startName;\n+        while (nameSegment.length() > 0)\n         {\n-            char c = classname.charAt(i);\n-            if (!foundStart)\n-            {\n-                foundStart = Character.isJavaIdentifierStart(c);\n-                if (foundStart)\n-                {\n-                    if (startIdx >= 0)\n-                    {\n-                        dense.append(classname.charAt(startIdx));\n-                        hasPackage = true;\n-                    }\n-                    startIdx = i;\n-                }\n-            }\n-\n-            if (foundStart)\n-            {\n-                if (!Character.isJavaIdentifierPart(c))\n-                {\n-                    foundStart = false;\n-                }\n-                else\n-                {\n-                    endIdx = i;\n-                }\n-            }\n+            T ret = nameFunction.apply(nameSegment);\n+            if (ret != null)\n+                return ret;\n+\n+            // Trim and try again.\n+            int idx = nameSegment.lastIndexOf('.');\n+            if (idx >= 0)\n+                nameSegment = nameSegment.substring(0, idx);\n+            else\n+                break;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE0MDUyOQ=="}, "originalCommit": {"oid": "d2399205ff7d7820c6757d0f9f4acec9bea79412"}, "originalPosition": 172}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2507, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}