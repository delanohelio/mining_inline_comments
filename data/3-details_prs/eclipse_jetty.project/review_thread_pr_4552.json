{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxODUwNzY5", "number": 4552, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwOTo0NToyOVrODd9zJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwOTo0NzowOFrODd91EQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNzQ3ODEyOnYy", "diffSide": "RIGHT", "path": "tests/test-distribution/src/test/java/org/eclipse/jetty/tests/distribution/DistributionTests.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwOTo0NToyOVrOFm3hBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwOTo0NToyOVrOFm3hBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjI5OTc4MA==", "bodyText": "Remove this empty line.", "url": "https://github.com/eclipse/jetty.project/pull/4552#discussion_r376299780", "createdAt": "2020-02-07T09:45:29Z", "author": {"login": "sbordet"}, "path": "tests/test-distribution/src/test/java/org/eclipse/jetty/tests/distribution/DistributionTests.java", "diffHunk": "@@ -401,4 +404,57 @@ public void testWebAppWithProxyAndJPMS() throws Exception\n             }\n         }\n     }\n+\n+    @ParameterizedTest\n+    @ValueSource(strings = {\n+        \"\",\n+        \"--jpms\",\n+    })\n+    public void testSimpleWebAppWithWebsocket(String arg) throws Exception\n+    {\n+        String jettyVersion = System.getProperty(\"jettyVersion\");\n+        DistributionTester distribution = DistributionTester.Builder.newInstance()\n+            .jettyVersion(jettyVersion)\n+            .mavenLocalRepository(System.getProperty(\"mavenRepoPath\"))\n+            .build();\n+        String[] args1 = {\n+            \"--create-startd\",\n+            \"--approve-all-licenses\",\n+            \"--add-to-start=resources,server,http,webapp,deploy,jsp,jmx,servlet,servlets,websocket\"\n+        };\n+        try (DistributionTester.Run run1 = distribution.start(args1))\n+        {\n+            assertTrue(run1.awaitFor(5, TimeUnit.SECONDS));\n+            assertEquals(0, run1.getExitValue());\n+\n+            File war = distribution.resolveArtifact(\"org.eclipse.jetty.tests:test-websocket-webapp:war:\" + jettyVersion);\n+            distribution.installWarFile(war, \"test1\");\n+            distribution.installWarFile(war, \"test2\");\n+\n+            int port = distribution.freePort();\n+            String[] args2 = {\n+                arg,\n+                \"jetty.http.port=\" + port//,\n+                //\"jetty.server.dumpAfterStart=true\"\n+            };\n+            try (DistributionTester.Run run2 = distribution.start(args2))\n+            {\n+                assertTrue(run2.awaitConsoleLogsFor(\"Started Server@\", 10, TimeUnit.SECONDS));\n+                assertFalse(run2.getLogs().stream().anyMatch(s -> s.contains(\"LinkageError\")));\n+\n+                startHttpClient();\n+                ContentResponse response = client.GET(\"http://localhost:\" + port + \"/test1/index.jsp\");\n+                assertEquals(HttpStatus.OK_200, response.getStatus());\n+                assertThat(response.getContentAsString(), containsString(\"Hello\"));\n+                assertThat(response.getContentAsString(), not(containsString(\"<%\")));\n+\n+                client.GET(\"http://localhost:\" + port + \"/test2/index.jsp\");\n+                assertEquals(HttpStatus.OK_200, response.getStatus());\n+                assertThat(response.getContentAsString(), containsString(\"Hello\"));\n+                assertThat(response.getContentAsString(), not(containsString(\"<%\")));\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ab4f66128d69fafb98b826156c79a2c06a74a57"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNzQ3ODgyOnYy", "diffSide": "RIGHT", "path": "tests/test-distribution/src/test/java/org/eclipse/jetty/tests/distribution/DistributionTests.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwOTo0NTo0MlrOFm3hcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwOTo0NTo0MlrOFm3hcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjI5OTg5MA==", "bodyText": "Remove this empty line.", "url": "https://github.com/eclipse/jetty.project/pull/4552#discussion_r376299890", "createdAt": "2020-02-07T09:45:42Z", "author": {"login": "sbordet"}, "path": "tests/test-distribution/src/test/java/org/eclipse/jetty/tests/distribution/DistributionTests.java", "diffHunk": "@@ -401,4 +404,57 @@ public void testWebAppWithProxyAndJPMS() throws Exception\n             }\n         }\n     }\n+\n+    @ParameterizedTest\n+    @ValueSource(strings = {\n+        \"\",\n+        \"--jpms\",\n+    })\n+    public void testSimpleWebAppWithWebsocket(String arg) throws Exception\n+    {\n+        String jettyVersion = System.getProperty(\"jettyVersion\");\n+        DistributionTester distribution = DistributionTester.Builder.newInstance()\n+            .jettyVersion(jettyVersion)\n+            .mavenLocalRepository(System.getProperty(\"mavenRepoPath\"))\n+            .build();\n+        String[] args1 = {\n+            \"--create-startd\",\n+            \"--approve-all-licenses\",\n+            \"--add-to-start=resources,server,http,webapp,deploy,jsp,jmx,servlet,servlets,websocket\"\n+        };\n+        try (DistributionTester.Run run1 = distribution.start(args1))\n+        {\n+            assertTrue(run1.awaitFor(5, TimeUnit.SECONDS));\n+            assertEquals(0, run1.getExitValue());\n+\n+            File war = distribution.resolveArtifact(\"org.eclipse.jetty.tests:test-websocket-webapp:war:\" + jettyVersion);\n+            distribution.installWarFile(war, \"test1\");\n+            distribution.installWarFile(war, \"test2\");\n+\n+            int port = distribution.freePort();\n+            String[] args2 = {\n+                arg,\n+                \"jetty.http.port=\" + port//,\n+                //\"jetty.server.dumpAfterStart=true\"\n+            };\n+            try (DistributionTester.Run run2 = distribution.start(args2))\n+            {\n+                assertTrue(run2.awaitConsoleLogsFor(\"Started Server@\", 10, TimeUnit.SECONDS));\n+                assertFalse(run2.getLogs().stream().anyMatch(s -> s.contains(\"LinkageError\")));\n+\n+                startHttpClient();\n+                ContentResponse response = client.GET(\"http://localhost:\" + port + \"/test1/index.jsp\");\n+                assertEquals(HttpStatus.OK_200, response.getStatus());\n+                assertThat(response.getContentAsString(), containsString(\"Hello\"));\n+                assertThat(response.getContentAsString(), not(containsString(\"<%\")));\n+\n+                client.GET(\"http://localhost:\" + port + \"/test2/index.jsp\");\n+                assertEquals(HttpStatus.OK_200, response.getStatus());\n+                assertThat(response.getContentAsString(), containsString(\"Hello\"));\n+                assertThat(response.getContentAsString(), not(containsString(\"<%\")));\n+\n+            }\n+        }\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ab4f66128d69fafb98b826156c79a2c06a74a57"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNzQ4MjMzOnYy", "diffSide": "RIGHT", "path": "tests/test-webapps/test-websocket-webapp/src/main/java/org/eclipse/jetty/tests/webapp/websocket/OnCloseServerEndpoint.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwOTo0Njo1MlrOFm3jqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxMDozMTo1MFrOFm400A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjMwMDQ1Ng==", "bodyText": "Seems like something is missing?", "url": "https://github.com/eclipse/jetty.project/pull/4552#discussion_r376300456", "createdAt": "2020-02-07T09:46:52Z", "author": {"login": "sbordet"}, "path": "tests/test-webapps/test-websocket-webapp/src/main/java/org/eclipse/jetty/tests/webapp/websocket/OnCloseServerEndpoint.java", "diffHunk": "@@ -0,0 +1,52 @@\n+//\n+// ========================================================================\n+// Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//\n+// This program and the accompanying materials are made available under\n+// the terms of the Eclipse Public License 2.0 which is available at\n+// https://www.eclipse.org/legal/epl-2.0\n+//\n+// This Source Code may also be made available under the following\n+// Secondary Licenses when the conditions for such availability set\n+// forth in the Eclipse Public License, v. 2.0 are satisfied:\n+// the Apache License v2.0 which is available at\n+// https://www.apache.org/licenses/LICENSE-2.0\n+//\n+// SPDX-License-Identifier: EPL-2.0 OR Apache-2.0\n+// ========================================================================\n+//\n+\n+package org.eclipse.jetty.tests.webapp.websocket;\n+\n+import java.io.IOException;\n+import javax.websocket.OnClose;\n+import javax.websocket.OnError;\n+import javax.websocket.OnMessage;\n+import javax.websocket.Session;\n+import javax.websocket.server.ServerEndpoint;\n+\n+@ServerEndpoint(\"/onclose/{arg}\")\n+public class OnCloseServerEndpoint\n+{\n+    private static String close = \"\";\n+\n+    @OnMessage\n+    public String echo(String echo)\n+    {\n+        return close + echo;\n+    }\n+\n+    @OnClose\n+    public void onClose(Session session)\n+    {\n+        //", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ab4f66128d69fafb98b826156c79a2c06a74a57"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjMyMTIzMg==", "bodyText": "not really it's just fake classes/method to test deployment", "url": "https://github.com/eclipse/jetty.project/pull/4552#discussion_r376321232", "createdAt": "2020-02-07T10:31:50Z", "author": {"login": "olamy"}, "path": "tests/test-webapps/test-websocket-webapp/src/main/java/org/eclipse/jetty/tests/webapp/websocket/OnCloseServerEndpoint.java", "diffHunk": "@@ -0,0 +1,52 @@\n+//\n+// ========================================================================\n+// Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//\n+// This program and the accompanying materials are made available under\n+// the terms of the Eclipse Public License 2.0 which is available at\n+// https://www.eclipse.org/legal/epl-2.0\n+//\n+// This Source Code may also be made available under the following\n+// Secondary Licenses when the conditions for such availability set\n+// forth in the Eclipse Public License, v. 2.0 are satisfied:\n+// the Apache License v2.0 which is available at\n+// https://www.apache.org/licenses/LICENSE-2.0\n+//\n+// SPDX-License-Identifier: EPL-2.0 OR Apache-2.0\n+// ========================================================================\n+//\n+\n+package org.eclipse.jetty.tests.webapp.websocket;\n+\n+import java.io.IOException;\n+import javax.websocket.OnClose;\n+import javax.websocket.OnError;\n+import javax.websocket.OnMessage;\n+import javax.websocket.Session;\n+import javax.websocket.server.ServerEndpoint;\n+\n+@ServerEndpoint(\"/onclose/{arg}\")\n+public class OnCloseServerEndpoint\n+{\n+    private static String close = \"\";\n+\n+    @OnMessage\n+    public String echo(String echo)\n+    {\n+        return close + echo;\n+    }\n+\n+    @OnClose\n+    public void onClose(Session session)\n+    {\n+        //", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjMwMDQ1Ng=="}, "originalCommit": {"oid": "5ab4f66128d69fafb98b826156c79a2c06a74a57"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNzQ4MzA1OnYy", "diffSide": "RIGHT", "path": "tests/test-webapps/test-websocket-webapp/src/main/java/org/eclipse/jetty/tests/webapp/websocket/OnOpenServerEndpoint.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwOTo0NzowOFrOFm3kIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxMDozMjowMlrOFm41HQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjMwMDU3Nw==", "bodyText": "Seems like something is missing?", "url": "https://github.com/eclipse/jetty.project/pull/4552#discussion_r376300577", "createdAt": "2020-02-07T09:47:08Z", "author": {"login": "sbordet"}, "path": "tests/test-webapps/test-websocket-webapp/src/main/java/org/eclipse/jetty/tests/webapp/websocket/OnOpenServerEndpoint.java", "diffHunk": "@@ -0,0 +1,52 @@\n+//\n+// ========================================================================\n+// Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//\n+// This program and the accompanying materials are made available under\n+// the terms of the Eclipse Public License 2.0 which is available at\n+// https://www.eclipse.org/legal/epl-2.0\n+//\n+// This Source Code may also be made available under the following\n+// Secondary Licenses when the conditions for such availability set\n+// forth in the Eclipse Public License, v. 2.0 are satisfied:\n+// the Apache License v2.0 which is available at\n+// https://www.apache.org/licenses/LICENSE-2.0\n+//\n+// SPDX-License-Identifier: EPL-2.0 OR Apache-2.0\n+// ========================================================================\n+//\n+\n+package org.eclipse.jetty.tests.webapp.websocket;\n+\n+import java.io.IOException;\n+import javax.websocket.OnError;\n+import javax.websocket.OnMessage;\n+import javax.websocket.OnOpen;\n+import javax.websocket.Session;\n+import javax.websocket.server.ServerEndpoint;\n+\n+@ServerEndpoint(\"/onopen/{arg}\")\n+public class OnOpenServerEndpoint\n+{\n+    private static String open = \"\";\n+\n+    @OnMessage\n+    public String echo(String echo)\n+    {\n+        return open + echo;\n+    }\n+\n+    @OnOpen\n+    public void onOpen(Session session)\n+    {\n+        //", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ab4f66128d69fafb98b826156c79a2c06a74a57"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjMyMTMwOQ==", "bodyText": "not really it's just fake classes/method to test deployment", "url": "https://github.com/eclipse/jetty.project/pull/4552#discussion_r376321309", "createdAt": "2020-02-07T10:32:02Z", "author": {"login": "olamy"}, "path": "tests/test-webapps/test-websocket-webapp/src/main/java/org/eclipse/jetty/tests/webapp/websocket/OnOpenServerEndpoint.java", "diffHunk": "@@ -0,0 +1,52 @@\n+//\n+// ========================================================================\n+// Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//\n+// This program and the accompanying materials are made available under\n+// the terms of the Eclipse Public License 2.0 which is available at\n+// https://www.eclipse.org/legal/epl-2.0\n+//\n+// This Source Code may also be made available under the following\n+// Secondary Licenses when the conditions for such availability set\n+// forth in the Eclipse Public License, v. 2.0 are satisfied:\n+// the Apache License v2.0 which is available at\n+// https://www.apache.org/licenses/LICENSE-2.0\n+//\n+// SPDX-License-Identifier: EPL-2.0 OR Apache-2.0\n+// ========================================================================\n+//\n+\n+package org.eclipse.jetty.tests.webapp.websocket;\n+\n+import java.io.IOException;\n+import javax.websocket.OnError;\n+import javax.websocket.OnMessage;\n+import javax.websocket.OnOpen;\n+import javax.websocket.Session;\n+import javax.websocket.server.ServerEndpoint;\n+\n+@ServerEndpoint(\"/onopen/{arg}\")\n+public class OnOpenServerEndpoint\n+{\n+    private static String open = \"\";\n+\n+    @OnMessage\n+    public String echo(String echo)\n+    {\n+        return open + echo;\n+    }\n+\n+    @OnOpen\n+    public void onOpen(Session session)\n+    {\n+        //", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjMwMDU3Nw=="}, "originalCommit": {"oid": "5ab4f66128d69fafb98b826156c79a2c06a74a57"}, "originalPosition": 42}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2795, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}