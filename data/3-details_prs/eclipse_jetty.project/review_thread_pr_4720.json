{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0MTE5NDcy", "number": 4720, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxODowNzo1OVrODrxUtg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxODowNzo1OVrODrxUtg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MjIzNDc4OnYy", "diffSide": "RIGHT", "path": "jetty-server/src/test/java/org/eclipse/jetty/server/ResponseTest.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxODowNzo1OVrOF8T7WQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxMToyNDoyOVrOF8tE7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc4NTM2OQ==", "bodyText": "Does this get sent over the wire on HTTP/1.1 as ...\nContent-Type: foo/bar; charset=utf-8\n\n?\nIf so, then this PR is either doing too much, or we lack the extra tests to prove that we allow a user to turn off that charset= portion on the HTTP response.", "url": "https://github.com/eclipse/jetty.project/pull/4720#discussion_r398785369", "createdAt": "2020-03-26T18:07:59Z", "author": {"login": "joakime"}, "path": "jetty-server/src/test/java/org/eclipse/jetty/server/ResponseTest.java", "diffHunk": "@@ -624,7 +635,7 @@ public void testResetContentTypeWithCharacterEncoding() throws Exception\n \n         response.setContentType(\"wrong/answer;charset=utf-8\");\n         response.setContentType(\"foo/bar\");\n-        assertEquals(\"foo/bar\", response.getContentType());\n+        assertEquals(\"foo/bar;charset=utf-8\", response.getContentType());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b73052923c2d90d6dad6fd721b8fe7093280c47d"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc5NDUwMA==", "bodyText": "This change won't force a change to the charset: in fact, the change prevents a change to the charset that that spec does not support.  Unfortunately, the javadoc for ServletResponse.setContentType() does not make this behaviour clear in the case of the content-type without char-set, so all we have to go on is the tck test: https://github.com/eclipse-ee4j/jakartaee-tck/blob/master/src/com/sun/ts/tests/servlet/api/common/response/ResponseTests.java#L680", "url": "https://github.com/eclipse/jetty.project/pull/4720#discussion_r398794500", "createdAt": "2020-03-26T18:21:58Z", "author": {"login": "janbartel"}, "path": "jetty-server/src/test/java/org/eclipse/jetty/server/ResponseTest.java", "diffHunk": "@@ -624,7 +635,7 @@ public void testResetContentTypeWithCharacterEncoding() throws Exception\n \n         response.setContentType(\"wrong/answer;charset=utf-8\");\n         response.setContentType(\"foo/bar\");\n-        assertEquals(\"foo/bar\", response.getContentType());\n+        assertEquals(\"foo/bar;charset=utf-8\", response.getContentType());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc4NTM2OQ=="}, "originalCommit": {"oid": "b73052923c2d90d6dad6fd721b8fe7093280c47d"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgzNDU4OA==", "bodyText": "I created a new branch (from this one) called jetty-10.0.x-4719-keepcharencoding-extratests with new testcases to show the concern (see commit e0b322f).\nTwo of the new testcases in ResponseHeadersTest are now failing ...\n\ntestCharsetChangeToJsonMimeType()\ntestCharsetChangeToJsonMimeTypeSetCharsetToNull()\n\n\nInteresting aside, I didn't know you could use HttpServletResponse.reset() after obtaining a getWriter() and still use that writer.", "url": "https://github.com/eclipse/jetty.project/pull/4720#discussion_r398834588", "createdAt": "2020-03-26T19:25:15Z", "author": {"login": "joakime"}, "path": "jetty-server/src/test/java/org/eclipse/jetty/server/ResponseTest.java", "diffHunk": "@@ -624,7 +635,7 @@ public void testResetContentTypeWithCharacterEncoding() throws Exception\n \n         response.setContentType(\"wrong/answer;charset=utf-8\");\n         response.setContentType(\"foo/bar\");\n-        assertEquals(\"foo/bar\", response.getContentType());\n+        assertEquals(\"foo/bar;charset=utf-8\", response.getContentType());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc4NTM2OQ=="}, "originalCommit": {"oid": "b73052923c2d90d6dad6fd721b8fe7093280c47d"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE5NzQyMA==", "bodyText": "@joakime I've merged your branch into mine, and added a fix for content types like json that must have an assumed char set. Thanks for the concrete tests!!", "url": "https://github.com/eclipse/jetty.project/pull/4720#discussion_r399197420", "createdAt": "2020-03-27T11:24:29Z", "author": {"login": "janbartel"}, "path": "jetty-server/src/test/java/org/eclipse/jetty/server/ResponseTest.java", "diffHunk": "@@ -624,7 +635,7 @@ public void testResetContentTypeWithCharacterEncoding() throws Exception\n \n         response.setContentType(\"wrong/answer;charset=utf-8\");\n         response.setContentType(\"foo/bar\");\n-        assertEquals(\"foo/bar\", response.getContentType());\n+        assertEquals(\"foo/bar;charset=utf-8\", response.getContentType());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc4NTM2OQ=="}, "originalCommit": {"oid": "b73052923c2d90d6dad6fd721b8fe7093280c47d"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2708, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}