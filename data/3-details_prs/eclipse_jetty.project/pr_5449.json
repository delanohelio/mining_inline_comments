{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAyODU1ODAz", "number": 5449, "title": "Fixes #5409 - HttpClient fails intermittently with \"Invalid response \u2026", "bodyText": "\u2026state TRANSIENT\".\nThe problem was a race condition during content decoding.\nSince decoding needs to be done in a loop, the condition to loop is to\ncheck whether there is demand for the next chunk of decoded content.\nChecking for demand also sets the stalled flag, and this must be done\nonly after the response state has been set back to CONTENT.\nUnfortunately this was not done in the decoding loop.\nThe fix is to always update the response state in the decoding loop.\nSigned-off-by: Simone Bordet simone.bordet@gmail.com", "createdAt": "2020-10-13T21:19:24Z", "url": "https://github.com/eclipse/jetty.project/pull/5449", "merged": true, "mergeCommit": {"oid": "7bfca258d59ad52fdeec0b76a42a862774656b21"}, "closed": true, "closedAt": "2020-10-14T13:55:21Z", "author": {"login": "sbordet"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSPUINAH2gAyNTAyODU1ODAzOmM1ZGY4MDdiNmQ1ZGU3NTExOGFjYTc5N2RjMTY4MzI3YjczNjRlYmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSYXabAFqTUwODA2MTQ2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c5df807b6d5de75118aca797dc168327b7364ebd", "author": {"user": {"login": "sbordet", "name": "Simone Bordet"}}, "url": "https://github.com/eclipse/jetty.project/commit/c5df807b6d5de75118aca797dc168327b7364ebd", "committedDate": "2020-10-13T21:18:26Z", "message": "Fixes #5409 - HttpClient fails intermittently with \"Invalid response state TRANSIENT\".\n\nThe problem was a race condition during content decoding.\nSince decoding needs to be done in a loop, the condition to loop is to\ncheck whether there is demand for the next chunk of decoded content.\n\nChecking for demand also sets the stalled flag, and this must be done\nonly after the response state has been set back to CONTENT.\nUnfortunately this was not done in the decoding loop.\n\nThe fix is to always update the response state in the decoding loop.\n\nSigned-off-by: Simone Bordet <simone.bordet@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4MDYxNDYx", "url": "https://github.com/eclipse/jetty.project/pull/5449#pullrequestreview-508061461", "createdAt": "2020-10-14T07:23:17Z", "commit": {"oid": "c5df807b6d5de75118aca797dc168327b7364ebd"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwNzoyMzoxN1rOHhFk9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwNzoyMzoxN1rOHhFk9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDQ1NjQzNw==", "bodyText": "I'm not fond of this method's signature, what do you think of that one instead?\nprivate boolean updateResponseState(EnumSet<ResponseState> from, ResponseState to)\nthat would make the callers look like this:\nif (updateResponseState(EnumSet.of(ResponseState.HEADERS, ResponseState.CONTENT), ResponseState.TRANSIENT))", "url": "https://github.com/eclipse/jetty.project/pull/5449#discussion_r504456437", "createdAt": "2020-10-14T07:23:17Z", "author": {"login": "lorban"}, "path": "jetty-client/src/main/java/org/eclipse/jetty/client/HttpReceiver.java", "diffHunk": "@@ -614,15 +565,42 @@ public boolean abort(HttpExchange exchange, Throwable failure)\n         }\n     }\n \n+    private boolean updateResponseState(ResponseState from1, ResponseState from2, ResponseState to)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5df807b6d5de75118aca797dc168327b7364ebd"}, "originalPosition": 173}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 39, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}