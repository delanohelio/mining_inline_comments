{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4NDYxOTc2", "number": 4810, "title": "Issue #4800 - fix WebSocket LinkageError and invalid PathParam type handling", "bodyText": "Issue #4800\nChanges to the WebSocket MethodHandle lookup were needed as the implementation has changed in JDK 14 and our method of using the MethodHandles.publicLookup() no longer works.\nThe type of PathParams in the endpoint signature are now being checked at deployment, where they were previously being checked during the first upgrade request to that endpoint.", "createdAt": "2020-04-24T10:17:07Z", "url": "https://github.com/eclipse/jetty.project/pull/4810", "merged": true, "mergeCommit": {"oid": "07551baef7d7eb179ac33c1579028175458a314c"}, "closed": true, "closedAt": "2020-05-04T01:17:30Z", "author": {"login": "lachlan-roberts"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcamMuIAH2gAyNDA4NDYxOTc2OjdjMmQ4MDRjZTljMTFmODQ3OWRkZDU4NjhjNzdiZDljZjBlNjk3ZWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcdmjnlgFqTQwNDU5Mzk1OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7c2d804ce9c11f8479ddd5868c77bd9cf0e697ed", "author": {"user": {"login": "lachlan-roberts", "name": "Lachlan"}}, "url": "https://github.com/eclipse/jetty.project/commit/7c2d804ce9c11f8479ddd5868c77bd9cf0e697ed", "committedDate": "2020-04-24T00:18:24Z", "message": "Change the WSServer to allow deployment of multiple webapps\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5b0dc56d27fdaf99a44fa4793296c75de632a3e", "author": {"user": {"login": "lachlan-roberts", "name": "Lachlan"}}, "url": "https://github.com/eclipse/jetty.project/commit/f5b0dc56d27fdaf99a44fa4793296c75de632a3e", "committedDate": "2020-04-24T03:14:42Z", "message": "Issue #4800 - Reproduce LinkageError in WebSocket unit test\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "870a7654645b638f7c57217b3d3b347696e18ee7", "author": {"user": {"login": "lachlan-roberts", "name": "Lachlan"}}, "url": "https://github.com/eclipse/jetty.project/commit/870a7654645b638f7c57217b3d3b347696e18ee7", "committedDate": "2020-04-24T03:31:29Z", "message": "Issue #4800 - prevent LinkageErrors for WS lookup on JDK 14\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb85c71f8d1fde93cb248f6f425d017dda67231d", "author": {"user": {"login": "lachlan-roberts", "name": "Lachlan"}}, "url": "https://github.com/eclipse/jetty.project/commit/fb85c71f8d1fde93cb248f6f425d017dda67231d", "committedDate": "2020-04-24T07:11:23Z", "message": "Issue #4800 - invalid PathParam types should be reported at Deployment\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64beae3382862c5a96ab887466194ef6cd7593c5", "author": {"user": {"login": "lachlan-roberts", "name": "Lachlan"}}, "url": "https://github.com/eclipse/jetty.project/commit/64beae3382862c5a96ab887466194ef6cd7593c5", "committedDate": "2020-04-24T10:16:19Z", "message": "Issue #4800 - test both cases individually\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5ODIxMzI2", "url": "https://github.com/eclipse/jetty.project/pull/4810#pullrequestreview-399821326", "createdAt": "2020-04-24T10:19:09Z", "commit": {"oid": "64beae3382862c5a96ab887466194ef6cd7593c5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMDoxOTowOVrOGLQ3rQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMDoxOTowOVrOGLQ3rQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ2MzkxNw==", "bodyText": "I had the idea about adding another webapp to be sure it's still deployed despite having this LinkageError", "url": "https://github.com/eclipse/jetty.project/pull/4810#discussion_r414463917", "createdAt": "2020-04-24T10:19:09Z", "author": {"login": "olamy"}, "path": "tests/test-distribution/src/test/java/org/eclipse/jetty/tests/distribution/DistributionTests.java", "diffHunk": "@@ -440,19 +439,14 @@ public void testSimpleWebAppWithWebsocket(String arg) throws Exception\n             try (DistributionTester.Run run2 = distribution.start(args2))\n             {\n                 assertTrue(run2.awaitConsoleLogsFor(\"Started Server@\", 10, TimeUnit.SECONDS));\n-                // we do not test that anymore because it doesn't work for java14\n-                //assertFalse(run2.getLogs().stream().anyMatch(s -> s.contains(\"LinkageError\")));\n+                assertFalse(run2.getLogs().stream().anyMatch(s -> s.contains(\"LinkageError\")));\n \n                 startHttpClient();\n                 ContentResponse response = client.GET(\"http://localhost:\" + port + \"/test1/index.jsp\");\n-                assertEquals(HttpStatus.OK_200, response.getStatus());\n-                assertThat(response.getContentAsString(), containsString(\"Hello\"));\n-                assertThat(response.getContentAsString(), not(containsString(\"<%\")));\n+                assertEquals(HttpStatus.SERVICE_UNAVAILABLE_503, response.getStatus());\n \n                 client.GET(\"http://localhost:\" + port + \"/test2/index.jsp\");\n-                assertEquals(HttpStatus.OK_200, response.getStatus());\n-                assertThat(response.getContentAsString(), containsString(\"Hello\"));\n-                assertThat(response.getContentAsString(), not(containsString(\"<%\")));\n+                assertEquals(HttpStatus.SERVICE_UNAVAILABLE_503, response.getStatus());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64beae3382862c5a96ab887466194ef6cd7593c5"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8a1dacdd09b8445c2f144d6b2590186608dc6d9", "author": {"user": {"login": "lachlan-roberts", "name": "Lachlan"}}, "url": "https://github.com/eclipse/jetty.project/commit/c8a1dacdd09b8445c2f144d6b2590186608dc6d9", "committedDate": "2020-04-27T00:54:06Z", "message": "Issue #4800 - Improve WS DistributionTest to also test working webapp\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf5d4ea55448476d8f97944c6ab025cf67160e8b", "author": {"user": {"login": "lachlan-roberts", "name": "Lachlan"}}, "url": "https://github.com/eclipse/jetty.project/commit/bf5d4ea55448476d8f97944c6ab025cf67160e8b", "committedDate": "2020-04-29T12:52:26Z", "message": "Issue #4800 - Revert MethodHandle changes & update DistributionTests\n\n- It seems it is correct to use the `MethodHandles.publicLookup().in()`\nbut this does not work if same webapp is deployed twice, so the\nMethodHandle changes have been reverted and the test has been disabled\nuntil a resolution to https://bugs.openjdk.java.net/browse/JDK-8244090.\n\n- The DistributionTest has been changed to properly reproduce the issue.\nThere must be a class in the signature of the websocket endpoint which\nis available to both webapps and the client must send and receive an echo\nmessage to ensure that the onOpen MethodHandle is actually invoked.\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0e57ffd6dd0ff30a318c832db860810f156f767", "author": {"user": {"login": "lachlan-roberts", "name": "Lachlan"}}, "url": "https://github.com/eclipse/jetty.project/commit/b0e57ffd6dd0ff30a318c832db860810f156f767", "committedDate": "2020-04-29T12:52:33Z", "message": "Merge remote-tracking branch 'origin/jetty-10.0.x' into jetty-10.0.x-LinkageErrorInvestigation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ad600ea49de49d03a75f69624f7bb5bc7d5e9fb", "author": {"user": {"login": "lachlan-roberts", "name": "Lachlan"}}, "url": "https://github.com/eclipse/jetty.project/commit/1ad600ea49de49d03a75f69624f7bb5bc7d5e9fb", "committedDate": "2020-04-30T00:14:43Z", "message": "fix WS DistributionTest incorrect test expectation\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NTkzOTU5", "url": "https://github.com/eclipse/jetty.project/pull/4810#pullrequestreview-404593959", "createdAt": "2020-05-03T08:25:12Z", "commit": {"oid": "1ad600ea49de49d03a75f69624f7bb5bc7d5e9fb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 355, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}