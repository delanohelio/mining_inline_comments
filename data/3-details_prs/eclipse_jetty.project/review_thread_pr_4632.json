{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgyNjQxOTQ3", "number": 4632, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNzo1MDo1MVrODmZtFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNDoxMjozOFrODmsjTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxNTkzNjIzOnYy", "diffSide": "RIGHT", "path": "jetty-xml/src/main/java/org/eclipse/jetty/xml/XmlConfiguration.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNzo1MDo1MVrOFzzH3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNzo1MDo1MVrOFzzH3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTg1OTI5Mg==", "bodyText": "Something weird has gone on in the history!  I thought the idea of passing in the index was so that leading ignored Args could be skipped!", "url": "https://github.com/eclipse/jetty.project/pull/4632#discussion_r389859292", "createdAt": "2020-03-09T17:50:51Z", "author": {"login": "gregw"}, "path": "jetty-xml/src/main/java/org/eclipse/jetty/xml/XmlConfiguration.java", "diffHunk": "@@ -493,21 +501,6 @@ public Object configure() throws Exception\n          */\n         public void configure(Object obj, XmlParser.Node cfg, int i) throws Exception", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc80ebed6c2d0cefadc8e307fded491841e63308"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxNTkzOTUyOnYy", "diffSide": "RIGHT", "path": "jetty-xml/src/main/java/org/eclipse/jetty/xml/XmlConfiguration.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNzo1MTozN1rOFzzJ2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNzo1MTozN1rOFzzJ2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTg1OTgwMA==", "bodyText": "I think we should somehow increment the index variable so that the Arg is ignored", "url": "https://github.com/eclipse/jetty.project/pull/4632#discussion_r389859800", "createdAt": "2020-03-09T17:51:37Z", "author": {"login": "gregw"}, "path": "jetty-xml/src/main/java/org/eclipse/jetty/xml/XmlConfiguration.java", "diffHunk": "@@ -466,6 +468,12 @@ public Object configure() throws Exception\n                     throw new IllegalStateException(String.format(\"No matching constructor %s in %s\", oClass, _configuration));\n                 }\n             }\n+            else\n+            {\n+                // The Object already existed, if it has <Arg> nodes, warn about them not being used.\n+                XmlConfiguration.getNodes(_root, \"Arg\")\n+                    .forEach((node) -> LOG.warn(\"Ignored arg {} in {}\", node, this._configuration._location));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc80ebed6c2d0cefadc8e307fded491841e63308"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxOTAyNDE0OnYy", "diffSide": "RIGHT", "path": "jetty-xml/src/test/java/org/eclipse/jetty/xml/XmlConfigurationTest.java", "isResolved": false, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNDoxMjozOFrOF0Qlpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNDoyODoyMVrOF0RVQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM0MjA1NA==", "bodyText": "I would like to see a test where there is a Arg misplaced, as below, so that we define in a test how we should behave.\n<Configure ...>\n  <Arg>...</Arg>\n  <New ...>...</New>\n  <Arg>...</Arg>\n</Configure>", "url": "https://github.com/eclipse/jetty.project/pull/4632#discussion_r390342054", "createdAt": "2020-03-10T14:12:38Z", "author": {"login": "sbordet"}, "path": "jetty-xml/src/test/java/org/eclipse/jetty/xml/XmlConfigurationTest.java", "diffHunk": "@@ -1309,6 +1318,185 @@ public void testJettyStandardIdsAndPropertiesAndJettyHomeUriAndJettyBaseUri() th\n         }\n     }\n \n+    public static class BarNamed\n+    {\n+        private String foo;\n+        private List<String> zeds;\n+\n+        public BarNamed(@Name(\"foo\") String foo)\n+        {\n+            this.foo = foo;\n+        }\n+\n+        public void addZed(String zed)\n+        {\n+            if (zeds == null)\n+                zeds = new ArrayList<>();\n+            zeds.add(zed);\n+        }\n+\n+        public List<String> getZeds()\n+        {\n+            return zeds;\n+        }\n+\n+        public String getFoo()\n+        {\n+            return foo;\n+        }\n+    }\n+\n+    @Test\n+    public void testConfiguredWithNamedArg() throws Exception\n+    {\n+        XmlConfiguration xmlFoo = asXmlConfiguration(\"foo.xml\",\n+            \"<Configure>\\n\" +\n+                \"  <New id=\\\"foo\\\" class=\\\"java.lang.String\\\">\\n\" +\n+                \"    <Arg>foozball</Arg>\\n\" +\n+                \"  </New>\\n\" +\n+                \"</Configure>\");\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foo\\\"><Ref refid=\\\"foo\\\"/></Arg>\\n\" +\n+                \"</Configure>\");\n+\n+        try (StdErrCapture logCapture = new StdErrCapture(XmlConfiguration.class))\n+        {\n+            Map<String, Object> idMap = mimicXmlConfigurationMain(xmlFoo, xmlBar);\n+            Object obj = idMap.get(\"bar\");\n+            assertThat(\"BarNamed instance created\", obj, instanceOf(BarNamed.class));\n+            BarNamed bar = (BarNamed)obj;\n+            assertThat(\"BarNamed has foo\", bar.getFoo(), is(\"foozball\"));\n+\n+            List<String> warnLogs = logCapture.getLines()\n+                .stream().filter(line -> line.contains(\":WARN:\"))\n+                .collect(Collectors.toList());\n+\n+            assertThat(\"WARN logs size\", warnLogs.size(), is(0));\n+        }\n+    }\n+\n+    @Test\n+    public void testConfiguredWithArgNotUsingName() throws Exception\n+    {\n+        XmlConfiguration xmlFoo = asXmlConfiguration(\"foo.xml\",\n+            \"<Configure>\\n\" +\n+                \"  <New id=\\\"foo\\\" class=\\\"java.lang.String\\\">\\n\" +\n+                \"    <Arg>foozball</Arg>\\n\" +\n+                \"  </New>\\n\" +\n+                \"</Configure>\");\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg><Ref refid=\\\"foo\\\"/></Arg>\\n\" + // no name specified\n+                \"</Configure>\");\n+\n+        try (StdErrCapture logCapture = new StdErrCapture(XmlConfiguration.class))\n+        {\n+            Map<String, Object> idMap = mimicXmlConfigurationMain(xmlFoo, xmlBar);\n+            Object obj = idMap.get(\"bar\");\n+            assertThat(\"BarNamed instance created\", obj, instanceOf(BarNamed.class));\n+            BarNamed bar = (BarNamed)obj;\n+            assertThat(\"BarNamed has foo\", bar.getFoo(), is(\"foozball\"));\n+\n+            List<String> warnLogs = logCapture.getLines()\n+                .stream().filter(line -> line.contains(\":WARN:\"))\n+                .collect(Collectors.toList());\n+\n+            assertThat(\"WARN logs size\", warnLogs.size(), is(0));\n+        }\n+    }\n+\n+    @Test\n+    public void testConfiguredWithBadNamedArg() throws Exception\n+    {\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foozball\\\">foozball</Arg>\\n\" + // wrong name specified\n+                \"</Configure>\");\n+\n+        IllegalStateException cause = assertThrows(IllegalStateException.class, () ->\n+            mimicXmlConfigurationMain(xmlBar));\n+\n+        assertThat(\"Cause message\", cause.getMessage(), containsString(\"No matching constructor\"));\n+    }\n+\n+    @Test\n+    public void testConfiguredWithTooManyNamedArgs() throws Exception\n+    {\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foo\\\">foozball</Arg>\\n\" +\n+                \"  <Arg name=\\\"foo\\\">soccer</Arg>\\n\" + // neither should win\n+                \"</Configure>\");\n+\n+        IllegalStateException cause = assertThrows(IllegalStateException.class, () ->\n+            mimicXmlConfigurationMain(xmlBar));\n+\n+        assertThat(\"Cause message\", cause.getMessage(), containsString(\"No matching constructor\"));\n+    }\n+\n+    @Test\n+    public void testConfiguredSameWithNamedArgTwice() throws Exception\n+    {\n+        XmlConfiguration xmlFoo = asXmlConfiguration(\"foo.xml\",\n+            \"<Configure>\\n\" +\n+                \"  <New id=\\\"foo\\\" class=\\\"java.lang.String\\\">\\n\" +\n+                \"    <Arg>foozball</Arg>\\n\" +\n+                \"  </New>\\n\" +\n+                \"</Configure>\");\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foo\\\"><Ref refid=\\\"foo\\\"/></Arg>\\n\" +\n+                \"</Configure>\");\n+        XmlConfiguration xmlAddZed = asXmlConfiguration(\"zed.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foo\\\">baz</Arg>\\n\" + // the invalid line\n+                \"  <Call name=\\\"addZed\\\">\\n\" +\n+                \"    <Arg>plain-zero</Arg>\\n\" +\n+                \"  </Call>\\n\" +\n+                \"</Configure>\");\n+\n+        try (StdErrCapture logCapture = new StdErrCapture(XmlConfiguration.class))\n+        {\n+            Map<String, Object> idMap = mimicXmlConfigurationMain(xmlFoo, xmlBar, xmlAddZed);\n+            Object obj = idMap.get(\"bar\");\n+            assertThat(\"BarNamed instance created\", obj, instanceOf(BarNamed.class));\n+            BarNamed bar = (BarNamed)obj;\n+            assertThat(\"BarNamed has foo\", bar.getFoo(), is(\"foozball\"));\n+            List<String> zeds = bar.getZeds();\n+            assertThat(\"BarNamed has zeds\", zeds, not(empty()));\n+            assertThat(\"Zeds[0]\", zeds.get(0), is(\"plain-zero\"));\n+\n+            List<String> warnLogs = logCapture.getLines()\n+                .stream().filter(line -> line.contains(\":WARN:\"))\n+                .collect(Collectors.toList());\n+\n+            assertThat(\"WARN logs count\", warnLogs.size(), is(1));\n+\n+            String actualWarn = warnLogs.get(0);\n+            assertThat(\"WARN logs\", actualWarn,\n+                allOf(containsString(\"Ignored arg <Arg name=\"),\n+                    containsString(\"zed.xml\")\n+                ));\n+        }\n+    }\n+\n+    /**\n+     * This mimics the XML load behavior in XmlConfiguration.main(String ... args)\n+     */\n+    private Map<String, Object> mimicXmlConfigurationMain(XmlConfiguration... configurations) throws Exception\n+    {\n+        XmlConfiguration last = null;\n+        for (XmlConfiguration configuration : configurations)\n+        {\n+            if (last != null)\n+                configuration.getIdMap().putAll(last.getIdMap());\n+            configuration.configure();\n+            last = configuration;\n+        }\n+        return last.getIdMap();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad3149c07a1530c5c560bdad4e4dc4efb015349d"}, "originalPosition": 214}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM0MzUxMQ==", "bodyText": "@gregw pointed out that the Configure_9_3.dtd (and Configure_10_0.dtd) does not allow a <Arg> anywhere but the start of the element list.\n\n  \n    \n      jetty.project/jetty-xml/src/main/resources/org/eclipse/jetty/xml/configure_10_0.dtd\n    \n    \n        Lines 45 to 46\n      in\n      678385b\n    \n    \n    \n    \n\n        \n          \n           <!ELEMENT Configure (Arg*,(%CONFIG;)*) > \n        \n\n        \n          \n           <!ATTLIST Configure %IMPLIEDCLASSATTR; %IDATTR; >", "url": "https://github.com/eclipse/jetty.project/pull/4632#discussion_r390343511", "createdAt": "2020-03-10T14:14:37Z", "author": {"login": "joakime"}, "path": "jetty-xml/src/test/java/org/eclipse/jetty/xml/XmlConfigurationTest.java", "diffHunk": "@@ -1309,6 +1318,185 @@ public void testJettyStandardIdsAndPropertiesAndJettyHomeUriAndJettyBaseUri() th\n         }\n     }\n \n+    public static class BarNamed\n+    {\n+        private String foo;\n+        private List<String> zeds;\n+\n+        public BarNamed(@Name(\"foo\") String foo)\n+        {\n+            this.foo = foo;\n+        }\n+\n+        public void addZed(String zed)\n+        {\n+            if (zeds == null)\n+                zeds = new ArrayList<>();\n+            zeds.add(zed);\n+        }\n+\n+        public List<String> getZeds()\n+        {\n+            return zeds;\n+        }\n+\n+        public String getFoo()\n+        {\n+            return foo;\n+        }\n+    }\n+\n+    @Test\n+    public void testConfiguredWithNamedArg() throws Exception\n+    {\n+        XmlConfiguration xmlFoo = asXmlConfiguration(\"foo.xml\",\n+            \"<Configure>\\n\" +\n+                \"  <New id=\\\"foo\\\" class=\\\"java.lang.String\\\">\\n\" +\n+                \"    <Arg>foozball</Arg>\\n\" +\n+                \"  </New>\\n\" +\n+                \"</Configure>\");\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foo\\\"><Ref refid=\\\"foo\\\"/></Arg>\\n\" +\n+                \"</Configure>\");\n+\n+        try (StdErrCapture logCapture = new StdErrCapture(XmlConfiguration.class))\n+        {\n+            Map<String, Object> idMap = mimicXmlConfigurationMain(xmlFoo, xmlBar);\n+            Object obj = idMap.get(\"bar\");\n+            assertThat(\"BarNamed instance created\", obj, instanceOf(BarNamed.class));\n+            BarNamed bar = (BarNamed)obj;\n+            assertThat(\"BarNamed has foo\", bar.getFoo(), is(\"foozball\"));\n+\n+            List<String> warnLogs = logCapture.getLines()\n+                .stream().filter(line -> line.contains(\":WARN:\"))\n+                .collect(Collectors.toList());\n+\n+            assertThat(\"WARN logs size\", warnLogs.size(), is(0));\n+        }\n+    }\n+\n+    @Test\n+    public void testConfiguredWithArgNotUsingName() throws Exception\n+    {\n+        XmlConfiguration xmlFoo = asXmlConfiguration(\"foo.xml\",\n+            \"<Configure>\\n\" +\n+                \"  <New id=\\\"foo\\\" class=\\\"java.lang.String\\\">\\n\" +\n+                \"    <Arg>foozball</Arg>\\n\" +\n+                \"  </New>\\n\" +\n+                \"</Configure>\");\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg><Ref refid=\\\"foo\\\"/></Arg>\\n\" + // no name specified\n+                \"</Configure>\");\n+\n+        try (StdErrCapture logCapture = new StdErrCapture(XmlConfiguration.class))\n+        {\n+            Map<String, Object> idMap = mimicXmlConfigurationMain(xmlFoo, xmlBar);\n+            Object obj = idMap.get(\"bar\");\n+            assertThat(\"BarNamed instance created\", obj, instanceOf(BarNamed.class));\n+            BarNamed bar = (BarNamed)obj;\n+            assertThat(\"BarNamed has foo\", bar.getFoo(), is(\"foozball\"));\n+\n+            List<String> warnLogs = logCapture.getLines()\n+                .stream().filter(line -> line.contains(\":WARN:\"))\n+                .collect(Collectors.toList());\n+\n+            assertThat(\"WARN logs size\", warnLogs.size(), is(0));\n+        }\n+    }\n+\n+    @Test\n+    public void testConfiguredWithBadNamedArg() throws Exception\n+    {\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foozball\\\">foozball</Arg>\\n\" + // wrong name specified\n+                \"</Configure>\");\n+\n+        IllegalStateException cause = assertThrows(IllegalStateException.class, () ->\n+            mimicXmlConfigurationMain(xmlBar));\n+\n+        assertThat(\"Cause message\", cause.getMessage(), containsString(\"No matching constructor\"));\n+    }\n+\n+    @Test\n+    public void testConfiguredWithTooManyNamedArgs() throws Exception\n+    {\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foo\\\">foozball</Arg>\\n\" +\n+                \"  <Arg name=\\\"foo\\\">soccer</Arg>\\n\" + // neither should win\n+                \"</Configure>\");\n+\n+        IllegalStateException cause = assertThrows(IllegalStateException.class, () ->\n+            mimicXmlConfigurationMain(xmlBar));\n+\n+        assertThat(\"Cause message\", cause.getMessage(), containsString(\"No matching constructor\"));\n+    }\n+\n+    @Test\n+    public void testConfiguredSameWithNamedArgTwice() throws Exception\n+    {\n+        XmlConfiguration xmlFoo = asXmlConfiguration(\"foo.xml\",\n+            \"<Configure>\\n\" +\n+                \"  <New id=\\\"foo\\\" class=\\\"java.lang.String\\\">\\n\" +\n+                \"    <Arg>foozball</Arg>\\n\" +\n+                \"  </New>\\n\" +\n+                \"</Configure>\");\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foo\\\"><Ref refid=\\\"foo\\\"/></Arg>\\n\" +\n+                \"</Configure>\");\n+        XmlConfiguration xmlAddZed = asXmlConfiguration(\"zed.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foo\\\">baz</Arg>\\n\" + // the invalid line\n+                \"  <Call name=\\\"addZed\\\">\\n\" +\n+                \"    <Arg>plain-zero</Arg>\\n\" +\n+                \"  </Call>\\n\" +\n+                \"</Configure>\");\n+\n+        try (StdErrCapture logCapture = new StdErrCapture(XmlConfiguration.class))\n+        {\n+            Map<String, Object> idMap = mimicXmlConfigurationMain(xmlFoo, xmlBar, xmlAddZed);\n+            Object obj = idMap.get(\"bar\");\n+            assertThat(\"BarNamed instance created\", obj, instanceOf(BarNamed.class));\n+            BarNamed bar = (BarNamed)obj;\n+            assertThat(\"BarNamed has foo\", bar.getFoo(), is(\"foozball\"));\n+            List<String> zeds = bar.getZeds();\n+            assertThat(\"BarNamed has zeds\", zeds, not(empty()));\n+            assertThat(\"Zeds[0]\", zeds.get(0), is(\"plain-zero\"));\n+\n+            List<String> warnLogs = logCapture.getLines()\n+                .stream().filter(line -> line.contains(\":WARN:\"))\n+                .collect(Collectors.toList());\n+\n+            assertThat(\"WARN logs count\", warnLogs.size(), is(1));\n+\n+            String actualWarn = warnLogs.get(0);\n+            assertThat(\"WARN logs\", actualWarn,\n+                allOf(containsString(\"Ignored arg <Arg name=\"),\n+                    containsString(\"zed.xml\")\n+                ));\n+        }\n+    }\n+\n+    /**\n+     * This mimics the XML load behavior in XmlConfiguration.main(String ... args)\n+     */\n+    private Map<String, Object> mimicXmlConfigurationMain(XmlConfiguration... configurations) throws Exception\n+    {\n+        XmlConfiguration last = null;\n+        for (XmlConfiguration configuration : configurations)\n+        {\n+            if (last != null)\n+                configuration.getIdMap().putAll(last.getIdMap());\n+            configuration.configure();\n+            last = configuration;\n+        }\n+        return last.getIdMap();\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM0MjA1NA=="}, "originalCommit": {"oid": "ad3149c07a1530c5c560bdad4e4dc4efb015349d"}, "originalPosition": 214}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM0NDE3NA==", "bodyText": "A test that is expected to fail in this scenario is dependent on the dtd used (or not used) I would think.", "url": "https://github.com/eclipse/jetty.project/pull/4632#discussion_r390344174", "createdAt": "2020-03-10T14:15:33Z", "author": {"login": "joakime"}, "path": "jetty-xml/src/test/java/org/eclipse/jetty/xml/XmlConfigurationTest.java", "diffHunk": "@@ -1309,6 +1318,185 @@ public void testJettyStandardIdsAndPropertiesAndJettyHomeUriAndJettyBaseUri() th\n         }\n     }\n \n+    public static class BarNamed\n+    {\n+        private String foo;\n+        private List<String> zeds;\n+\n+        public BarNamed(@Name(\"foo\") String foo)\n+        {\n+            this.foo = foo;\n+        }\n+\n+        public void addZed(String zed)\n+        {\n+            if (zeds == null)\n+                zeds = new ArrayList<>();\n+            zeds.add(zed);\n+        }\n+\n+        public List<String> getZeds()\n+        {\n+            return zeds;\n+        }\n+\n+        public String getFoo()\n+        {\n+            return foo;\n+        }\n+    }\n+\n+    @Test\n+    public void testConfiguredWithNamedArg() throws Exception\n+    {\n+        XmlConfiguration xmlFoo = asXmlConfiguration(\"foo.xml\",\n+            \"<Configure>\\n\" +\n+                \"  <New id=\\\"foo\\\" class=\\\"java.lang.String\\\">\\n\" +\n+                \"    <Arg>foozball</Arg>\\n\" +\n+                \"  </New>\\n\" +\n+                \"</Configure>\");\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foo\\\"><Ref refid=\\\"foo\\\"/></Arg>\\n\" +\n+                \"</Configure>\");\n+\n+        try (StdErrCapture logCapture = new StdErrCapture(XmlConfiguration.class))\n+        {\n+            Map<String, Object> idMap = mimicXmlConfigurationMain(xmlFoo, xmlBar);\n+            Object obj = idMap.get(\"bar\");\n+            assertThat(\"BarNamed instance created\", obj, instanceOf(BarNamed.class));\n+            BarNamed bar = (BarNamed)obj;\n+            assertThat(\"BarNamed has foo\", bar.getFoo(), is(\"foozball\"));\n+\n+            List<String> warnLogs = logCapture.getLines()\n+                .stream().filter(line -> line.contains(\":WARN:\"))\n+                .collect(Collectors.toList());\n+\n+            assertThat(\"WARN logs size\", warnLogs.size(), is(0));\n+        }\n+    }\n+\n+    @Test\n+    public void testConfiguredWithArgNotUsingName() throws Exception\n+    {\n+        XmlConfiguration xmlFoo = asXmlConfiguration(\"foo.xml\",\n+            \"<Configure>\\n\" +\n+                \"  <New id=\\\"foo\\\" class=\\\"java.lang.String\\\">\\n\" +\n+                \"    <Arg>foozball</Arg>\\n\" +\n+                \"  </New>\\n\" +\n+                \"</Configure>\");\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg><Ref refid=\\\"foo\\\"/></Arg>\\n\" + // no name specified\n+                \"</Configure>\");\n+\n+        try (StdErrCapture logCapture = new StdErrCapture(XmlConfiguration.class))\n+        {\n+            Map<String, Object> idMap = mimicXmlConfigurationMain(xmlFoo, xmlBar);\n+            Object obj = idMap.get(\"bar\");\n+            assertThat(\"BarNamed instance created\", obj, instanceOf(BarNamed.class));\n+            BarNamed bar = (BarNamed)obj;\n+            assertThat(\"BarNamed has foo\", bar.getFoo(), is(\"foozball\"));\n+\n+            List<String> warnLogs = logCapture.getLines()\n+                .stream().filter(line -> line.contains(\":WARN:\"))\n+                .collect(Collectors.toList());\n+\n+            assertThat(\"WARN logs size\", warnLogs.size(), is(0));\n+        }\n+    }\n+\n+    @Test\n+    public void testConfiguredWithBadNamedArg() throws Exception\n+    {\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foozball\\\">foozball</Arg>\\n\" + // wrong name specified\n+                \"</Configure>\");\n+\n+        IllegalStateException cause = assertThrows(IllegalStateException.class, () ->\n+            mimicXmlConfigurationMain(xmlBar));\n+\n+        assertThat(\"Cause message\", cause.getMessage(), containsString(\"No matching constructor\"));\n+    }\n+\n+    @Test\n+    public void testConfiguredWithTooManyNamedArgs() throws Exception\n+    {\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foo\\\">foozball</Arg>\\n\" +\n+                \"  <Arg name=\\\"foo\\\">soccer</Arg>\\n\" + // neither should win\n+                \"</Configure>\");\n+\n+        IllegalStateException cause = assertThrows(IllegalStateException.class, () ->\n+            mimicXmlConfigurationMain(xmlBar));\n+\n+        assertThat(\"Cause message\", cause.getMessage(), containsString(\"No matching constructor\"));\n+    }\n+\n+    @Test\n+    public void testConfiguredSameWithNamedArgTwice() throws Exception\n+    {\n+        XmlConfiguration xmlFoo = asXmlConfiguration(\"foo.xml\",\n+            \"<Configure>\\n\" +\n+                \"  <New id=\\\"foo\\\" class=\\\"java.lang.String\\\">\\n\" +\n+                \"    <Arg>foozball</Arg>\\n\" +\n+                \"  </New>\\n\" +\n+                \"</Configure>\");\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foo\\\"><Ref refid=\\\"foo\\\"/></Arg>\\n\" +\n+                \"</Configure>\");\n+        XmlConfiguration xmlAddZed = asXmlConfiguration(\"zed.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foo\\\">baz</Arg>\\n\" + // the invalid line\n+                \"  <Call name=\\\"addZed\\\">\\n\" +\n+                \"    <Arg>plain-zero</Arg>\\n\" +\n+                \"  </Call>\\n\" +\n+                \"</Configure>\");\n+\n+        try (StdErrCapture logCapture = new StdErrCapture(XmlConfiguration.class))\n+        {\n+            Map<String, Object> idMap = mimicXmlConfigurationMain(xmlFoo, xmlBar, xmlAddZed);\n+            Object obj = idMap.get(\"bar\");\n+            assertThat(\"BarNamed instance created\", obj, instanceOf(BarNamed.class));\n+            BarNamed bar = (BarNamed)obj;\n+            assertThat(\"BarNamed has foo\", bar.getFoo(), is(\"foozball\"));\n+            List<String> zeds = bar.getZeds();\n+            assertThat(\"BarNamed has zeds\", zeds, not(empty()));\n+            assertThat(\"Zeds[0]\", zeds.get(0), is(\"plain-zero\"));\n+\n+            List<String> warnLogs = logCapture.getLines()\n+                .stream().filter(line -> line.contains(\":WARN:\"))\n+                .collect(Collectors.toList());\n+\n+            assertThat(\"WARN logs count\", warnLogs.size(), is(1));\n+\n+            String actualWarn = warnLogs.get(0);\n+            assertThat(\"WARN logs\", actualWarn,\n+                allOf(containsString(\"Ignored arg <Arg name=\"),\n+                    containsString(\"zed.xml\")\n+                ));\n+        }\n+    }\n+\n+    /**\n+     * This mimics the XML load behavior in XmlConfiguration.main(String ... args)\n+     */\n+    private Map<String, Object> mimicXmlConfigurationMain(XmlConfiguration... configurations) throws Exception\n+    {\n+        XmlConfiguration last = null;\n+        for (XmlConfiguration configuration : configurations)\n+        {\n+            if (last != null)\n+                configuration.getIdMap().putAll(last.getIdMap());\n+            configuration.configure();\n+            last = configuration;\n+        }\n+        return last.getIdMap();\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM0MjA1NA=="}, "originalCommit": {"oid": "ad3149c07a1530c5c560bdad4e4dc4efb015349d"}, "originalPosition": 214}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM0NTQ2NQ==", "bodyText": "Then shouldn't we do the same for Call and New? I don't think the DTD has the same enforcement for those.", "url": "https://github.com/eclipse/jetty.project/pull/4632#discussion_r390345465", "createdAt": "2020-03-10T14:17:17Z", "author": {"login": "sbordet"}, "path": "jetty-xml/src/test/java/org/eclipse/jetty/xml/XmlConfigurationTest.java", "diffHunk": "@@ -1309,6 +1318,185 @@ public void testJettyStandardIdsAndPropertiesAndJettyHomeUriAndJettyBaseUri() th\n         }\n     }\n \n+    public static class BarNamed\n+    {\n+        private String foo;\n+        private List<String> zeds;\n+\n+        public BarNamed(@Name(\"foo\") String foo)\n+        {\n+            this.foo = foo;\n+        }\n+\n+        public void addZed(String zed)\n+        {\n+            if (zeds == null)\n+                zeds = new ArrayList<>();\n+            zeds.add(zed);\n+        }\n+\n+        public List<String> getZeds()\n+        {\n+            return zeds;\n+        }\n+\n+        public String getFoo()\n+        {\n+            return foo;\n+        }\n+    }\n+\n+    @Test\n+    public void testConfiguredWithNamedArg() throws Exception\n+    {\n+        XmlConfiguration xmlFoo = asXmlConfiguration(\"foo.xml\",\n+            \"<Configure>\\n\" +\n+                \"  <New id=\\\"foo\\\" class=\\\"java.lang.String\\\">\\n\" +\n+                \"    <Arg>foozball</Arg>\\n\" +\n+                \"  </New>\\n\" +\n+                \"</Configure>\");\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foo\\\"><Ref refid=\\\"foo\\\"/></Arg>\\n\" +\n+                \"</Configure>\");\n+\n+        try (StdErrCapture logCapture = new StdErrCapture(XmlConfiguration.class))\n+        {\n+            Map<String, Object> idMap = mimicXmlConfigurationMain(xmlFoo, xmlBar);\n+            Object obj = idMap.get(\"bar\");\n+            assertThat(\"BarNamed instance created\", obj, instanceOf(BarNamed.class));\n+            BarNamed bar = (BarNamed)obj;\n+            assertThat(\"BarNamed has foo\", bar.getFoo(), is(\"foozball\"));\n+\n+            List<String> warnLogs = logCapture.getLines()\n+                .stream().filter(line -> line.contains(\":WARN:\"))\n+                .collect(Collectors.toList());\n+\n+            assertThat(\"WARN logs size\", warnLogs.size(), is(0));\n+        }\n+    }\n+\n+    @Test\n+    public void testConfiguredWithArgNotUsingName() throws Exception\n+    {\n+        XmlConfiguration xmlFoo = asXmlConfiguration(\"foo.xml\",\n+            \"<Configure>\\n\" +\n+                \"  <New id=\\\"foo\\\" class=\\\"java.lang.String\\\">\\n\" +\n+                \"    <Arg>foozball</Arg>\\n\" +\n+                \"  </New>\\n\" +\n+                \"</Configure>\");\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg><Ref refid=\\\"foo\\\"/></Arg>\\n\" + // no name specified\n+                \"</Configure>\");\n+\n+        try (StdErrCapture logCapture = new StdErrCapture(XmlConfiguration.class))\n+        {\n+            Map<String, Object> idMap = mimicXmlConfigurationMain(xmlFoo, xmlBar);\n+            Object obj = idMap.get(\"bar\");\n+            assertThat(\"BarNamed instance created\", obj, instanceOf(BarNamed.class));\n+            BarNamed bar = (BarNamed)obj;\n+            assertThat(\"BarNamed has foo\", bar.getFoo(), is(\"foozball\"));\n+\n+            List<String> warnLogs = logCapture.getLines()\n+                .stream().filter(line -> line.contains(\":WARN:\"))\n+                .collect(Collectors.toList());\n+\n+            assertThat(\"WARN logs size\", warnLogs.size(), is(0));\n+        }\n+    }\n+\n+    @Test\n+    public void testConfiguredWithBadNamedArg() throws Exception\n+    {\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foozball\\\">foozball</Arg>\\n\" + // wrong name specified\n+                \"</Configure>\");\n+\n+        IllegalStateException cause = assertThrows(IllegalStateException.class, () ->\n+            mimicXmlConfigurationMain(xmlBar));\n+\n+        assertThat(\"Cause message\", cause.getMessage(), containsString(\"No matching constructor\"));\n+    }\n+\n+    @Test\n+    public void testConfiguredWithTooManyNamedArgs() throws Exception\n+    {\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foo\\\">foozball</Arg>\\n\" +\n+                \"  <Arg name=\\\"foo\\\">soccer</Arg>\\n\" + // neither should win\n+                \"</Configure>\");\n+\n+        IllegalStateException cause = assertThrows(IllegalStateException.class, () ->\n+            mimicXmlConfigurationMain(xmlBar));\n+\n+        assertThat(\"Cause message\", cause.getMessage(), containsString(\"No matching constructor\"));\n+    }\n+\n+    @Test\n+    public void testConfiguredSameWithNamedArgTwice() throws Exception\n+    {\n+        XmlConfiguration xmlFoo = asXmlConfiguration(\"foo.xml\",\n+            \"<Configure>\\n\" +\n+                \"  <New id=\\\"foo\\\" class=\\\"java.lang.String\\\">\\n\" +\n+                \"    <Arg>foozball</Arg>\\n\" +\n+                \"  </New>\\n\" +\n+                \"</Configure>\");\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foo\\\"><Ref refid=\\\"foo\\\"/></Arg>\\n\" +\n+                \"</Configure>\");\n+        XmlConfiguration xmlAddZed = asXmlConfiguration(\"zed.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foo\\\">baz</Arg>\\n\" + // the invalid line\n+                \"  <Call name=\\\"addZed\\\">\\n\" +\n+                \"    <Arg>plain-zero</Arg>\\n\" +\n+                \"  </Call>\\n\" +\n+                \"</Configure>\");\n+\n+        try (StdErrCapture logCapture = new StdErrCapture(XmlConfiguration.class))\n+        {\n+            Map<String, Object> idMap = mimicXmlConfigurationMain(xmlFoo, xmlBar, xmlAddZed);\n+            Object obj = idMap.get(\"bar\");\n+            assertThat(\"BarNamed instance created\", obj, instanceOf(BarNamed.class));\n+            BarNamed bar = (BarNamed)obj;\n+            assertThat(\"BarNamed has foo\", bar.getFoo(), is(\"foozball\"));\n+            List<String> zeds = bar.getZeds();\n+            assertThat(\"BarNamed has zeds\", zeds, not(empty()));\n+            assertThat(\"Zeds[0]\", zeds.get(0), is(\"plain-zero\"));\n+\n+            List<String> warnLogs = logCapture.getLines()\n+                .stream().filter(line -> line.contains(\":WARN:\"))\n+                .collect(Collectors.toList());\n+\n+            assertThat(\"WARN logs count\", warnLogs.size(), is(1));\n+\n+            String actualWarn = warnLogs.get(0);\n+            assertThat(\"WARN logs\", actualWarn,\n+                allOf(containsString(\"Ignored arg <Arg name=\"),\n+                    containsString(\"zed.xml\")\n+                ));\n+        }\n+    }\n+\n+    /**\n+     * This mimics the XML load behavior in XmlConfiguration.main(String ... args)\n+     */\n+    private Map<String, Object> mimicXmlConfigurationMain(XmlConfiguration... configurations) throws Exception\n+    {\n+        XmlConfiguration last = null;\n+        for (XmlConfiguration configuration : configurations)\n+        {\n+            if (last != null)\n+                configuration.getIdMap().putAll(last.getIdMap());\n+            configuration.configure();\n+            last = configuration;\n+        }\n+        return last.getIdMap();\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM0MjA1NA=="}, "originalCommit": {"oid": "ad3149c07a1530c5c560bdad4e4dc4efb015349d"}, "originalPosition": 214}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM0NzMzMA==", "bodyText": "Opened #4658 for these new test cases.\nAlso <Call>\n\n  \n    \n      jetty.project/jetty-xml/src/main/resources/org/eclipse/jetty/xml/configure_10_0.dtd\n    \n    \n        Lines 168 to 169\n      in\n      678385b\n    \n    \n    \n    \n\n        \n          \n           <!ELEMENT Call (Id?,Name?,Class?,Arg*,(%CONFIG;)*) > \n        \n\n        \n          \n           <!ATTLIST Call %ARGATTR; %IMPLIEDNAMEATTR; %IMPLIEDCLASSATTR; %IDATTR; > \n        \n    \n  \n\n\nAnd <New>\n\n  \n    \n      jetty.project/jetty-xml/src/main/resources/org/eclipse/jetty/xml/configure_10_0.dtd\n    \n    \n        Lines 209 to 210\n      in\n      678385b\n    \n    \n    \n    \n\n        \n          \n           <!ELEMENT New (Id?,Name?,Class?,Arg*,(%CONFIG;)*) > \n        \n\n        \n          \n           <!ATTLIST New %IDATTR; %IMPLIEDCLASSATTR; %ARGATTR; >", "url": "https://github.com/eclipse/jetty.project/pull/4632#discussion_r390347330", "createdAt": "2020-03-10T14:19:39Z", "author": {"login": "joakime"}, "path": "jetty-xml/src/test/java/org/eclipse/jetty/xml/XmlConfigurationTest.java", "diffHunk": "@@ -1309,6 +1318,185 @@ public void testJettyStandardIdsAndPropertiesAndJettyHomeUriAndJettyBaseUri() th\n         }\n     }\n \n+    public static class BarNamed\n+    {\n+        private String foo;\n+        private List<String> zeds;\n+\n+        public BarNamed(@Name(\"foo\") String foo)\n+        {\n+            this.foo = foo;\n+        }\n+\n+        public void addZed(String zed)\n+        {\n+            if (zeds == null)\n+                zeds = new ArrayList<>();\n+            zeds.add(zed);\n+        }\n+\n+        public List<String> getZeds()\n+        {\n+            return zeds;\n+        }\n+\n+        public String getFoo()\n+        {\n+            return foo;\n+        }\n+    }\n+\n+    @Test\n+    public void testConfiguredWithNamedArg() throws Exception\n+    {\n+        XmlConfiguration xmlFoo = asXmlConfiguration(\"foo.xml\",\n+            \"<Configure>\\n\" +\n+                \"  <New id=\\\"foo\\\" class=\\\"java.lang.String\\\">\\n\" +\n+                \"    <Arg>foozball</Arg>\\n\" +\n+                \"  </New>\\n\" +\n+                \"</Configure>\");\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foo\\\"><Ref refid=\\\"foo\\\"/></Arg>\\n\" +\n+                \"</Configure>\");\n+\n+        try (StdErrCapture logCapture = new StdErrCapture(XmlConfiguration.class))\n+        {\n+            Map<String, Object> idMap = mimicXmlConfigurationMain(xmlFoo, xmlBar);\n+            Object obj = idMap.get(\"bar\");\n+            assertThat(\"BarNamed instance created\", obj, instanceOf(BarNamed.class));\n+            BarNamed bar = (BarNamed)obj;\n+            assertThat(\"BarNamed has foo\", bar.getFoo(), is(\"foozball\"));\n+\n+            List<String> warnLogs = logCapture.getLines()\n+                .stream().filter(line -> line.contains(\":WARN:\"))\n+                .collect(Collectors.toList());\n+\n+            assertThat(\"WARN logs size\", warnLogs.size(), is(0));\n+        }\n+    }\n+\n+    @Test\n+    public void testConfiguredWithArgNotUsingName() throws Exception\n+    {\n+        XmlConfiguration xmlFoo = asXmlConfiguration(\"foo.xml\",\n+            \"<Configure>\\n\" +\n+                \"  <New id=\\\"foo\\\" class=\\\"java.lang.String\\\">\\n\" +\n+                \"    <Arg>foozball</Arg>\\n\" +\n+                \"  </New>\\n\" +\n+                \"</Configure>\");\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg><Ref refid=\\\"foo\\\"/></Arg>\\n\" + // no name specified\n+                \"</Configure>\");\n+\n+        try (StdErrCapture logCapture = new StdErrCapture(XmlConfiguration.class))\n+        {\n+            Map<String, Object> idMap = mimicXmlConfigurationMain(xmlFoo, xmlBar);\n+            Object obj = idMap.get(\"bar\");\n+            assertThat(\"BarNamed instance created\", obj, instanceOf(BarNamed.class));\n+            BarNamed bar = (BarNamed)obj;\n+            assertThat(\"BarNamed has foo\", bar.getFoo(), is(\"foozball\"));\n+\n+            List<String> warnLogs = logCapture.getLines()\n+                .stream().filter(line -> line.contains(\":WARN:\"))\n+                .collect(Collectors.toList());\n+\n+            assertThat(\"WARN logs size\", warnLogs.size(), is(0));\n+        }\n+    }\n+\n+    @Test\n+    public void testConfiguredWithBadNamedArg() throws Exception\n+    {\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foozball\\\">foozball</Arg>\\n\" + // wrong name specified\n+                \"</Configure>\");\n+\n+        IllegalStateException cause = assertThrows(IllegalStateException.class, () ->\n+            mimicXmlConfigurationMain(xmlBar));\n+\n+        assertThat(\"Cause message\", cause.getMessage(), containsString(\"No matching constructor\"));\n+    }\n+\n+    @Test\n+    public void testConfiguredWithTooManyNamedArgs() throws Exception\n+    {\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foo\\\">foozball</Arg>\\n\" +\n+                \"  <Arg name=\\\"foo\\\">soccer</Arg>\\n\" + // neither should win\n+                \"</Configure>\");\n+\n+        IllegalStateException cause = assertThrows(IllegalStateException.class, () ->\n+            mimicXmlConfigurationMain(xmlBar));\n+\n+        assertThat(\"Cause message\", cause.getMessage(), containsString(\"No matching constructor\"));\n+    }\n+\n+    @Test\n+    public void testConfiguredSameWithNamedArgTwice() throws Exception\n+    {\n+        XmlConfiguration xmlFoo = asXmlConfiguration(\"foo.xml\",\n+            \"<Configure>\\n\" +\n+                \"  <New id=\\\"foo\\\" class=\\\"java.lang.String\\\">\\n\" +\n+                \"    <Arg>foozball</Arg>\\n\" +\n+                \"  </New>\\n\" +\n+                \"</Configure>\");\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foo\\\"><Ref refid=\\\"foo\\\"/></Arg>\\n\" +\n+                \"</Configure>\");\n+        XmlConfiguration xmlAddZed = asXmlConfiguration(\"zed.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foo\\\">baz</Arg>\\n\" + // the invalid line\n+                \"  <Call name=\\\"addZed\\\">\\n\" +\n+                \"    <Arg>plain-zero</Arg>\\n\" +\n+                \"  </Call>\\n\" +\n+                \"</Configure>\");\n+\n+        try (StdErrCapture logCapture = new StdErrCapture(XmlConfiguration.class))\n+        {\n+            Map<String, Object> idMap = mimicXmlConfigurationMain(xmlFoo, xmlBar, xmlAddZed);\n+            Object obj = idMap.get(\"bar\");\n+            assertThat(\"BarNamed instance created\", obj, instanceOf(BarNamed.class));\n+            BarNamed bar = (BarNamed)obj;\n+            assertThat(\"BarNamed has foo\", bar.getFoo(), is(\"foozball\"));\n+            List<String> zeds = bar.getZeds();\n+            assertThat(\"BarNamed has zeds\", zeds, not(empty()));\n+            assertThat(\"Zeds[0]\", zeds.get(0), is(\"plain-zero\"));\n+\n+            List<String> warnLogs = logCapture.getLines()\n+                .stream().filter(line -> line.contains(\":WARN:\"))\n+                .collect(Collectors.toList());\n+\n+            assertThat(\"WARN logs count\", warnLogs.size(), is(1));\n+\n+            String actualWarn = warnLogs.get(0);\n+            assertThat(\"WARN logs\", actualWarn,\n+                allOf(containsString(\"Ignored arg <Arg name=\"),\n+                    containsString(\"zed.xml\")\n+                ));\n+        }\n+    }\n+\n+    /**\n+     * This mimics the XML load behavior in XmlConfiguration.main(String ... args)\n+     */\n+    private Map<String, Object> mimicXmlConfigurationMain(XmlConfiguration... configurations) throws Exception\n+    {\n+        XmlConfiguration last = null;\n+        for (XmlConfiguration configuration : configurations)\n+        {\n+            if (last != null)\n+                configuration.getIdMap().putAll(last.getIdMap());\n+            configuration.configure();\n+            last = configuration;\n+        }\n+        return last.getIdMap();\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM0MjA1NA=="}, "originalCommit": {"oid": "ad3149c07a1530c5c560bdad4e4dc4efb015349d"}, "originalPosition": 214}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM1MDI3Ng==", "bodyText": "Also opened #4659 for the missing Id?,Name?,Class?,Arg* in the <Configure> section on Configure_10_0.dtd", "url": "https://github.com/eclipse/jetty.project/pull/4632#discussion_r390350276", "createdAt": "2020-03-10T14:23:26Z", "author": {"login": "joakime"}, "path": "jetty-xml/src/test/java/org/eclipse/jetty/xml/XmlConfigurationTest.java", "diffHunk": "@@ -1309,6 +1318,185 @@ public void testJettyStandardIdsAndPropertiesAndJettyHomeUriAndJettyBaseUri() th\n         }\n     }\n \n+    public static class BarNamed\n+    {\n+        private String foo;\n+        private List<String> zeds;\n+\n+        public BarNamed(@Name(\"foo\") String foo)\n+        {\n+            this.foo = foo;\n+        }\n+\n+        public void addZed(String zed)\n+        {\n+            if (zeds == null)\n+                zeds = new ArrayList<>();\n+            zeds.add(zed);\n+        }\n+\n+        public List<String> getZeds()\n+        {\n+            return zeds;\n+        }\n+\n+        public String getFoo()\n+        {\n+            return foo;\n+        }\n+    }\n+\n+    @Test\n+    public void testConfiguredWithNamedArg() throws Exception\n+    {\n+        XmlConfiguration xmlFoo = asXmlConfiguration(\"foo.xml\",\n+            \"<Configure>\\n\" +\n+                \"  <New id=\\\"foo\\\" class=\\\"java.lang.String\\\">\\n\" +\n+                \"    <Arg>foozball</Arg>\\n\" +\n+                \"  </New>\\n\" +\n+                \"</Configure>\");\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foo\\\"><Ref refid=\\\"foo\\\"/></Arg>\\n\" +\n+                \"</Configure>\");\n+\n+        try (StdErrCapture logCapture = new StdErrCapture(XmlConfiguration.class))\n+        {\n+            Map<String, Object> idMap = mimicXmlConfigurationMain(xmlFoo, xmlBar);\n+            Object obj = idMap.get(\"bar\");\n+            assertThat(\"BarNamed instance created\", obj, instanceOf(BarNamed.class));\n+            BarNamed bar = (BarNamed)obj;\n+            assertThat(\"BarNamed has foo\", bar.getFoo(), is(\"foozball\"));\n+\n+            List<String> warnLogs = logCapture.getLines()\n+                .stream().filter(line -> line.contains(\":WARN:\"))\n+                .collect(Collectors.toList());\n+\n+            assertThat(\"WARN logs size\", warnLogs.size(), is(0));\n+        }\n+    }\n+\n+    @Test\n+    public void testConfiguredWithArgNotUsingName() throws Exception\n+    {\n+        XmlConfiguration xmlFoo = asXmlConfiguration(\"foo.xml\",\n+            \"<Configure>\\n\" +\n+                \"  <New id=\\\"foo\\\" class=\\\"java.lang.String\\\">\\n\" +\n+                \"    <Arg>foozball</Arg>\\n\" +\n+                \"  </New>\\n\" +\n+                \"</Configure>\");\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg><Ref refid=\\\"foo\\\"/></Arg>\\n\" + // no name specified\n+                \"</Configure>\");\n+\n+        try (StdErrCapture logCapture = new StdErrCapture(XmlConfiguration.class))\n+        {\n+            Map<String, Object> idMap = mimicXmlConfigurationMain(xmlFoo, xmlBar);\n+            Object obj = idMap.get(\"bar\");\n+            assertThat(\"BarNamed instance created\", obj, instanceOf(BarNamed.class));\n+            BarNamed bar = (BarNamed)obj;\n+            assertThat(\"BarNamed has foo\", bar.getFoo(), is(\"foozball\"));\n+\n+            List<String> warnLogs = logCapture.getLines()\n+                .stream().filter(line -> line.contains(\":WARN:\"))\n+                .collect(Collectors.toList());\n+\n+            assertThat(\"WARN logs size\", warnLogs.size(), is(0));\n+        }\n+    }\n+\n+    @Test\n+    public void testConfiguredWithBadNamedArg() throws Exception\n+    {\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foozball\\\">foozball</Arg>\\n\" + // wrong name specified\n+                \"</Configure>\");\n+\n+        IllegalStateException cause = assertThrows(IllegalStateException.class, () ->\n+            mimicXmlConfigurationMain(xmlBar));\n+\n+        assertThat(\"Cause message\", cause.getMessage(), containsString(\"No matching constructor\"));\n+    }\n+\n+    @Test\n+    public void testConfiguredWithTooManyNamedArgs() throws Exception\n+    {\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foo\\\">foozball</Arg>\\n\" +\n+                \"  <Arg name=\\\"foo\\\">soccer</Arg>\\n\" + // neither should win\n+                \"</Configure>\");\n+\n+        IllegalStateException cause = assertThrows(IllegalStateException.class, () ->\n+            mimicXmlConfigurationMain(xmlBar));\n+\n+        assertThat(\"Cause message\", cause.getMessage(), containsString(\"No matching constructor\"));\n+    }\n+\n+    @Test\n+    public void testConfiguredSameWithNamedArgTwice() throws Exception\n+    {\n+        XmlConfiguration xmlFoo = asXmlConfiguration(\"foo.xml\",\n+            \"<Configure>\\n\" +\n+                \"  <New id=\\\"foo\\\" class=\\\"java.lang.String\\\">\\n\" +\n+                \"    <Arg>foozball</Arg>\\n\" +\n+                \"  </New>\\n\" +\n+                \"</Configure>\");\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foo\\\"><Ref refid=\\\"foo\\\"/></Arg>\\n\" +\n+                \"</Configure>\");\n+        XmlConfiguration xmlAddZed = asXmlConfiguration(\"zed.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foo\\\">baz</Arg>\\n\" + // the invalid line\n+                \"  <Call name=\\\"addZed\\\">\\n\" +\n+                \"    <Arg>plain-zero</Arg>\\n\" +\n+                \"  </Call>\\n\" +\n+                \"</Configure>\");\n+\n+        try (StdErrCapture logCapture = new StdErrCapture(XmlConfiguration.class))\n+        {\n+            Map<String, Object> idMap = mimicXmlConfigurationMain(xmlFoo, xmlBar, xmlAddZed);\n+            Object obj = idMap.get(\"bar\");\n+            assertThat(\"BarNamed instance created\", obj, instanceOf(BarNamed.class));\n+            BarNamed bar = (BarNamed)obj;\n+            assertThat(\"BarNamed has foo\", bar.getFoo(), is(\"foozball\"));\n+            List<String> zeds = bar.getZeds();\n+            assertThat(\"BarNamed has zeds\", zeds, not(empty()));\n+            assertThat(\"Zeds[0]\", zeds.get(0), is(\"plain-zero\"));\n+\n+            List<String> warnLogs = logCapture.getLines()\n+                .stream().filter(line -> line.contains(\":WARN:\"))\n+                .collect(Collectors.toList());\n+\n+            assertThat(\"WARN logs count\", warnLogs.size(), is(1));\n+\n+            String actualWarn = warnLogs.get(0);\n+            assertThat(\"WARN logs\", actualWarn,\n+                allOf(containsString(\"Ignored arg <Arg name=\"),\n+                    containsString(\"zed.xml\")\n+                ));\n+        }\n+    }\n+\n+    /**\n+     * This mimics the XML load behavior in XmlConfiguration.main(String ... args)\n+     */\n+    private Map<String, Object> mimicXmlConfigurationMain(XmlConfiguration... configurations) throws Exception\n+    {\n+        XmlConfiguration last = null;\n+        for (XmlConfiguration configuration : configurations)\n+        {\n+            if (last != null)\n+                configuration.getIdMap().putAll(last.getIdMap());\n+            configuration.configure();\n+            last = configuration;\n+        }\n+        return last.getIdMap();\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM0MjA1NA=="}, "originalCommit": {"oid": "ad3149c07a1530c5c560bdad4e4dc4efb015349d"}, "originalPosition": 214}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM1NDI0Mw==", "bodyText": "@sbordet we had such a test, but that is invalid XML against the DTD.  I don't think we should be required to process non-valid XML\nNote that I'm doing a cleanup in 10 - see #4656", "url": "https://github.com/eclipse/jetty.project/pull/4632#discussion_r390354243", "createdAt": "2020-03-10T14:28:21Z", "author": {"login": "gregw"}, "path": "jetty-xml/src/test/java/org/eclipse/jetty/xml/XmlConfigurationTest.java", "diffHunk": "@@ -1309,6 +1318,185 @@ public void testJettyStandardIdsAndPropertiesAndJettyHomeUriAndJettyBaseUri() th\n         }\n     }\n \n+    public static class BarNamed\n+    {\n+        private String foo;\n+        private List<String> zeds;\n+\n+        public BarNamed(@Name(\"foo\") String foo)\n+        {\n+            this.foo = foo;\n+        }\n+\n+        public void addZed(String zed)\n+        {\n+            if (zeds == null)\n+                zeds = new ArrayList<>();\n+            zeds.add(zed);\n+        }\n+\n+        public List<String> getZeds()\n+        {\n+            return zeds;\n+        }\n+\n+        public String getFoo()\n+        {\n+            return foo;\n+        }\n+    }\n+\n+    @Test\n+    public void testConfiguredWithNamedArg() throws Exception\n+    {\n+        XmlConfiguration xmlFoo = asXmlConfiguration(\"foo.xml\",\n+            \"<Configure>\\n\" +\n+                \"  <New id=\\\"foo\\\" class=\\\"java.lang.String\\\">\\n\" +\n+                \"    <Arg>foozball</Arg>\\n\" +\n+                \"  </New>\\n\" +\n+                \"</Configure>\");\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foo\\\"><Ref refid=\\\"foo\\\"/></Arg>\\n\" +\n+                \"</Configure>\");\n+\n+        try (StdErrCapture logCapture = new StdErrCapture(XmlConfiguration.class))\n+        {\n+            Map<String, Object> idMap = mimicXmlConfigurationMain(xmlFoo, xmlBar);\n+            Object obj = idMap.get(\"bar\");\n+            assertThat(\"BarNamed instance created\", obj, instanceOf(BarNamed.class));\n+            BarNamed bar = (BarNamed)obj;\n+            assertThat(\"BarNamed has foo\", bar.getFoo(), is(\"foozball\"));\n+\n+            List<String> warnLogs = logCapture.getLines()\n+                .stream().filter(line -> line.contains(\":WARN:\"))\n+                .collect(Collectors.toList());\n+\n+            assertThat(\"WARN logs size\", warnLogs.size(), is(0));\n+        }\n+    }\n+\n+    @Test\n+    public void testConfiguredWithArgNotUsingName() throws Exception\n+    {\n+        XmlConfiguration xmlFoo = asXmlConfiguration(\"foo.xml\",\n+            \"<Configure>\\n\" +\n+                \"  <New id=\\\"foo\\\" class=\\\"java.lang.String\\\">\\n\" +\n+                \"    <Arg>foozball</Arg>\\n\" +\n+                \"  </New>\\n\" +\n+                \"</Configure>\");\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg><Ref refid=\\\"foo\\\"/></Arg>\\n\" + // no name specified\n+                \"</Configure>\");\n+\n+        try (StdErrCapture logCapture = new StdErrCapture(XmlConfiguration.class))\n+        {\n+            Map<String, Object> idMap = mimicXmlConfigurationMain(xmlFoo, xmlBar);\n+            Object obj = idMap.get(\"bar\");\n+            assertThat(\"BarNamed instance created\", obj, instanceOf(BarNamed.class));\n+            BarNamed bar = (BarNamed)obj;\n+            assertThat(\"BarNamed has foo\", bar.getFoo(), is(\"foozball\"));\n+\n+            List<String> warnLogs = logCapture.getLines()\n+                .stream().filter(line -> line.contains(\":WARN:\"))\n+                .collect(Collectors.toList());\n+\n+            assertThat(\"WARN logs size\", warnLogs.size(), is(0));\n+        }\n+    }\n+\n+    @Test\n+    public void testConfiguredWithBadNamedArg() throws Exception\n+    {\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foozball\\\">foozball</Arg>\\n\" + // wrong name specified\n+                \"</Configure>\");\n+\n+        IllegalStateException cause = assertThrows(IllegalStateException.class, () ->\n+            mimicXmlConfigurationMain(xmlBar));\n+\n+        assertThat(\"Cause message\", cause.getMessage(), containsString(\"No matching constructor\"));\n+    }\n+\n+    @Test\n+    public void testConfiguredWithTooManyNamedArgs() throws Exception\n+    {\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foo\\\">foozball</Arg>\\n\" +\n+                \"  <Arg name=\\\"foo\\\">soccer</Arg>\\n\" + // neither should win\n+                \"</Configure>\");\n+\n+        IllegalStateException cause = assertThrows(IllegalStateException.class, () ->\n+            mimicXmlConfigurationMain(xmlBar));\n+\n+        assertThat(\"Cause message\", cause.getMessage(), containsString(\"No matching constructor\"));\n+    }\n+\n+    @Test\n+    public void testConfiguredSameWithNamedArgTwice() throws Exception\n+    {\n+        XmlConfiguration xmlFoo = asXmlConfiguration(\"foo.xml\",\n+            \"<Configure>\\n\" +\n+                \"  <New id=\\\"foo\\\" class=\\\"java.lang.String\\\">\\n\" +\n+                \"    <Arg>foozball</Arg>\\n\" +\n+                \"  </New>\\n\" +\n+                \"</Configure>\");\n+        XmlConfiguration xmlBar = asXmlConfiguration(\"bar.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foo\\\"><Ref refid=\\\"foo\\\"/></Arg>\\n\" +\n+                \"</Configure>\");\n+        XmlConfiguration xmlAddZed = asXmlConfiguration(\"zed.xml\",\n+            \"<Configure id=\\\"bar\\\" class=\\\"\" + BarNamed.class.getName() + \"\\\">\\n\" +\n+                \"  <Arg name=\\\"foo\\\">baz</Arg>\\n\" + // the invalid line\n+                \"  <Call name=\\\"addZed\\\">\\n\" +\n+                \"    <Arg>plain-zero</Arg>\\n\" +\n+                \"  </Call>\\n\" +\n+                \"</Configure>\");\n+\n+        try (StdErrCapture logCapture = new StdErrCapture(XmlConfiguration.class))\n+        {\n+            Map<String, Object> idMap = mimicXmlConfigurationMain(xmlFoo, xmlBar, xmlAddZed);\n+            Object obj = idMap.get(\"bar\");\n+            assertThat(\"BarNamed instance created\", obj, instanceOf(BarNamed.class));\n+            BarNamed bar = (BarNamed)obj;\n+            assertThat(\"BarNamed has foo\", bar.getFoo(), is(\"foozball\"));\n+            List<String> zeds = bar.getZeds();\n+            assertThat(\"BarNamed has zeds\", zeds, not(empty()));\n+            assertThat(\"Zeds[0]\", zeds.get(0), is(\"plain-zero\"));\n+\n+            List<String> warnLogs = logCapture.getLines()\n+                .stream().filter(line -> line.contains(\":WARN:\"))\n+                .collect(Collectors.toList());\n+\n+            assertThat(\"WARN logs count\", warnLogs.size(), is(1));\n+\n+            String actualWarn = warnLogs.get(0);\n+            assertThat(\"WARN logs\", actualWarn,\n+                allOf(containsString(\"Ignored arg <Arg name=\"),\n+                    containsString(\"zed.xml\")\n+                ));\n+        }\n+    }\n+\n+    /**\n+     * This mimics the XML load behavior in XmlConfiguration.main(String ... args)\n+     */\n+    private Map<String, Object> mimicXmlConfigurationMain(XmlConfiguration... configurations) throws Exception\n+    {\n+        XmlConfiguration last = null;\n+        for (XmlConfiguration configuration : configurations)\n+        {\n+            if (last != null)\n+                configuration.getIdMap().putAll(last.getIdMap());\n+            configuration.configure();\n+            last = configuration;\n+        }\n+        return last.getIdMap();\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM0MjA1NA=="}, "originalCommit": {"oid": "ad3149c07a1530c5c560bdad4e4dc4efb015349d"}, "originalPosition": 214}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2654, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}