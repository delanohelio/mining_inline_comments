{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3NzkxMTc0", "number": 580, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMjoyMzo1MVrOED2SDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwODo1MzoxNFrOEGQi0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNDcwNTQxOnYy", "diffSide": "RIGHT", "path": "snomed/com.b2international.snowowl.validation.snomed/src/main/resources/scripts/rule671.groovy", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMjoyMzo1MVrOGhGyyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNToxMDo1OVrOGihxeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM2NzQ5Nw==", "bodyText": "Loading all members from that refset to memory will kill the process, please use scrolling.", "url": "https://github.com/b2ihealthcare/snow-owl/pull/580#discussion_r437367497", "createdAt": "2020-06-09T12:23:51Z", "author": {"login": "cmark"}, "path": "snomed/com.b2international.snowowl.validation.snomed/src/main/resources/scripts/rule671.groovy", "diffHunk": "@@ -0,0 +1,55 @@\n+package scripts;\n+\n+import com.b2international.index.query.Expressions\n+import com.b2international.index.query.Query\n+import com.b2international.index.query.Expressions.ExpressionBuilder\n+import com.b2international.index.revision.RevisionSearcher\n+import com.b2international.snowowl.core.ComponentIdentifier\n+import com.b2international.snowowl.core.date.EffectiveTimes\n+import com.b2international.snowowl.snomed.common.SnomedRf2Headers\n+import com.b2international.snowowl.snomed.common.SnomedTerminologyComponentConstants\n+import com.b2international.snowowl.snomed.common.SnomedConstants.Concepts\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedConceptDocument\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedRefSetMemberIndexEntry\n+import com.google.common.collect.Maps\n+import com.google.common.collect.Sets\n+\n+final Set<ComponentIdentifier> issues = Sets.newHashSet()\n+final RevisionSearcher searcher = ctx.service(RevisionSearcher.class)\n+\n+ExpressionBuilder filterExpressionBuilder = Expressions.builder()\n+\t\t.filter(SnomedConceptDocument.Expressions.inactive())\n+\n+if (params.isUnpublishedOnly) {\n+\tfilterExpressionBuilder.filter(SnomedConceptDocument.Expressions.effectiveTime(EffectiveTimes.UNSET_EFFECTIVE_TIME))\n+}\n+\n+Map<String, SnomedRefSetMemberIndexEntry> members = Maps.newHashMap()\n+\n+Query<String> queryRefsetMembers =Query.select(SnomedRefSetMemberIndexEntry.class)\n+\t\t.from(SnomedRefSetMemberIndexEntry.class)\n+\t\t.where(SnomedRefSetMemberIndexEntry.Expressions.referenceSetId(Concepts.REFSET_CONCEPT_INACTIVITY_INDICATOR))\n+\t\t.limit(Integer.MAX_VALUE)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "916882c85fedea52f1913f2f0fb81d95a5b37517"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg1Nzc2Mw==", "bodyText": "Done", "url": "https://github.com/b2ihealthcare/snow-owl/pull/580#discussion_r438857763", "createdAt": "2020-06-11T15:10:27Z", "author": {"login": "molnarlaura"}, "path": "snomed/com.b2international.snowowl.validation.snomed/src/main/resources/scripts/rule671.groovy", "diffHunk": "@@ -0,0 +1,55 @@\n+package scripts;\n+\n+import com.b2international.index.query.Expressions\n+import com.b2international.index.query.Query\n+import com.b2international.index.query.Expressions.ExpressionBuilder\n+import com.b2international.index.revision.RevisionSearcher\n+import com.b2international.snowowl.core.ComponentIdentifier\n+import com.b2international.snowowl.core.date.EffectiveTimes\n+import com.b2international.snowowl.snomed.common.SnomedRf2Headers\n+import com.b2international.snowowl.snomed.common.SnomedTerminologyComponentConstants\n+import com.b2international.snowowl.snomed.common.SnomedConstants.Concepts\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedConceptDocument\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedRefSetMemberIndexEntry\n+import com.google.common.collect.Maps\n+import com.google.common.collect.Sets\n+\n+final Set<ComponentIdentifier> issues = Sets.newHashSet()\n+final RevisionSearcher searcher = ctx.service(RevisionSearcher.class)\n+\n+ExpressionBuilder filterExpressionBuilder = Expressions.builder()\n+\t\t.filter(SnomedConceptDocument.Expressions.inactive())\n+\n+if (params.isUnpublishedOnly) {\n+\tfilterExpressionBuilder.filter(SnomedConceptDocument.Expressions.effectiveTime(EffectiveTimes.UNSET_EFFECTIVE_TIME))\n+}\n+\n+Map<String, SnomedRefSetMemberIndexEntry> members = Maps.newHashMap()\n+\n+Query<String> queryRefsetMembers =Query.select(SnomedRefSetMemberIndexEntry.class)\n+\t\t.from(SnomedRefSetMemberIndexEntry.class)\n+\t\t.where(SnomedRefSetMemberIndexEntry.Expressions.referenceSetId(Concepts.REFSET_CONCEPT_INACTIVITY_INDICATOR))\n+\t\t.limit(Integer.MAX_VALUE)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM2NzQ5Nw=="}, "originalCommit": {"oid": "916882c85fedea52f1913f2f0fb81d95a5b37517"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg1ODEwNA==", "bodyText": "Done", "url": "https://github.com/b2ihealthcare/snow-owl/pull/580#discussion_r438858104", "createdAt": "2020-06-11T15:10:59Z", "author": {"login": "molnarlaura"}, "path": "snomed/com.b2international.snowowl.validation.snomed/src/main/resources/scripts/rule671.groovy", "diffHunk": "@@ -0,0 +1,55 @@\n+package scripts;\n+\n+import com.b2international.index.query.Expressions\n+import com.b2international.index.query.Query\n+import com.b2international.index.query.Expressions.ExpressionBuilder\n+import com.b2international.index.revision.RevisionSearcher\n+import com.b2international.snowowl.core.ComponentIdentifier\n+import com.b2international.snowowl.core.date.EffectiveTimes\n+import com.b2international.snowowl.snomed.common.SnomedRf2Headers\n+import com.b2international.snowowl.snomed.common.SnomedTerminologyComponentConstants\n+import com.b2international.snowowl.snomed.common.SnomedConstants.Concepts\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedConceptDocument\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedRefSetMemberIndexEntry\n+import com.google.common.collect.Maps\n+import com.google.common.collect.Sets\n+\n+final Set<ComponentIdentifier> issues = Sets.newHashSet()\n+final RevisionSearcher searcher = ctx.service(RevisionSearcher.class)\n+\n+ExpressionBuilder filterExpressionBuilder = Expressions.builder()\n+\t\t.filter(SnomedConceptDocument.Expressions.inactive())\n+\n+if (params.isUnpublishedOnly) {\n+\tfilterExpressionBuilder.filter(SnomedConceptDocument.Expressions.effectiveTime(EffectiveTimes.UNSET_EFFECTIVE_TIME))\n+}\n+\n+Map<String, SnomedRefSetMemberIndexEntry> members = Maps.newHashMap()\n+\n+Query<String> queryRefsetMembers =Query.select(SnomedRefSetMemberIndexEntry.class)\n+\t\t.from(SnomedRefSetMemberIndexEntry.class)\n+\t\t.where(SnomedRefSetMemberIndexEntry.Expressions.referenceSetId(Concepts.REFSET_CONCEPT_INACTIVITY_INDICATOR))\n+\t\t.limit(Integer.MAX_VALUE)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM2NzQ5Nw=="}, "originalCommit": {"oid": "916882c85fedea52f1913f2f0fb81d95a5b37517"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNDcwNzE1OnYy", "diffSide": "RIGHT", "path": "snomed/com.b2international.snowowl.validation.snomed/src/main/resources/scripts/rule671.groovy", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMjoyNDoxMFrOGhGz6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMjoyNDoxMFrOGhGz6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM2Nzc4NQ==", "bodyText": "Remove sysout.", "url": "https://github.com/b2ihealthcare/snow-owl/pull/580#discussion_r437367785", "createdAt": "2020-06-09T12:24:10Z", "author": {"login": "cmark"}, "path": "snomed/com.b2international.snowowl.validation.snomed/src/main/resources/scripts/rule671.groovy", "diffHunk": "@@ -0,0 +1,55 @@\n+package scripts;\n+\n+import com.b2international.index.query.Expressions\n+import com.b2international.index.query.Query\n+import com.b2international.index.query.Expressions.ExpressionBuilder\n+import com.b2international.index.revision.RevisionSearcher\n+import com.b2international.snowowl.core.ComponentIdentifier\n+import com.b2international.snowowl.core.date.EffectiveTimes\n+import com.b2international.snowowl.snomed.common.SnomedRf2Headers\n+import com.b2international.snowowl.snomed.common.SnomedTerminologyComponentConstants\n+import com.b2international.snowowl.snomed.common.SnomedConstants.Concepts\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedConceptDocument\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedRefSetMemberIndexEntry\n+import com.google.common.collect.Maps\n+import com.google.common.collect.Sets\n+\n+final Set<ComponentIdentifier> issues = Sets.newHashSet()\n+final RevisionSearcher searcher = ctx.service(RevisionSearcher.class)\n+\n+ExpressionBuilder filterExpressionBuilder = Expressions.builder()\n+\t\t.filter(SnomedConceptDocument.Expressions.inactive())\n+\n+if (params.isUnpublishedOnly) {\n+\tfilterExpressionBuilder.filter(SnomedConceptDocument.Expressions.effectiveTime(EffectiveTimes.UNSET_EFFECTIVE_TIME))\n+}\n+\n+Map<String, SnomedRefSetMemberIndexEntry> members = Maps.newHashMap()\n+\n+Query<String> queryRefsetMembers =Query.select(SnomedRefSetMemberIndexEntry.class)\n+\t\t.from(SnomedRefSetMemberIndexEntry.class)\n+\t\t.where(SnomedRefSetMemberIndexEntry.Expressions.referenceSetId(Concepts.REFSET_CONCEPT_INACTIVITY_INDICATOR))\n+\t\t.limit(Integer.MAX_VALUE)\n+\t\t.build()\n+\n+searcher.search(queryRefsetMembers).forEach({SnomedRefSetMemberIndexEntry member ->\n+\tmembers.put(member.getReferencedComponentId(), member)\n+\n+})\n+\n+Query<String> queryConcepts = Query.select(SnomedConceptDocument.class)\n+\t\t.from(SnomedConceptDocument.class)\n+\t\t.where(filterExpressionBuilder.build())\n+\t\t.limit(Integer.MAX_VALUE)\n+\t\t.build()\n+\n+searcher.search(queryConcepts).forEach({SnomedConceptDocument concept ->\n+\tString inactivationIndicatorId = (String) members.get(concept.getId()).getProperties().get(SnomedRf2Headers.FIELD_VALUE_ID);\n+\tprintln(inactivationIndicatorId)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "916882c85fedea52f1913f2f0fb81d95a5b37517"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNDcxNTEzOnYy", "diffSide": "RIGHT", "path": "snomed/com.b2international.snowowl.validation.snomed/src/main/resources/scripts/rule671.groovy", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMjoyNToyNFrOGhG4Yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMzowMDozNlrOGhIc4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM2ODkzMQ==", "bodyText": "Always compare the constant to the variable, in all cases. Concepts.PENDING_MOVE.equals(myVar)", "url": "https://github.com/b2ihealthcare/snow-owl/pull/580#discussion_r437368931", "createdAt": "2020-06-09T12:25:24Z", "author": {"login": "cmark"}, "path": "snomed/com.b2international.snowowl.validation.snomed/src/main/resources/scripts/rule671.groovy", "diffHunk": "@@ -0,0 +1,55 @@\n+package scripts;\n+\n+import com.b2international.index.query.Expressions\n+import com.b2international.index.query.Query\n+import com.b2international.index.query.Expressions.ExpressionBuilder\n+import com.b2international.index.revision.RevisionSearcher\n+import com.b2international.snowowl.core.ComponentIdentifier\n+import com.b2international.snowowl.core.date.EffectiveTimes\n+import com.b2international.snowowl.snomed.common.SnomedRf2Headers\n+import com.b2international.snowowl.snomed.common.SnomedTerminologyComponentConstants\n+import com.b2international.snowowl.snomed.common.SnomedConstants.Concepts\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedConceptDocument\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedRefSetMemberIndexEntry\n+import com.google.common.collect.Maps\n+import com.google.common.collect.Sets\n+\n+final Set<ComponentIdentifier> issues = Sets.newHashSet()\n+final RevisionSearcher searcher = ctx.service(RevisionSearcher.class)\n+\n+ExpressionBuilder filterExpressionBuilder = Expressions.builder()\n+\t\t.filter(SnomedConceptDocument.Expressions.inactive())\n+\n+if (params.isUnpublishedOnly) {\n+\tfilterExpressionBuilder.filter(SnomedConceptDocument.Expressions.effectiveTime(EffectiveTimes.UNSET_EFFECTIVE_TIME))\n+}\n+\n+Map<String, SnomedRefSetMemberIndexEntry> members = Maps.newHashMap()\n+\n+Query<String> queryRefsetMembers =Query.select(SnomedRefSetMemberIndexEntry.class)\n+\t\t.from(SnomedRefSetMemberIndexEntry.class)\n+\t\t.where(SnomedRefSetMemberIndexEntry.Expressions.referenceSetId(Concepts.REFSET_CONCEPT_INACTIVITY_INDICATOR))\n+\t\t.limit(Integer.MAX_VALUE)\n+\t\t.build()\n+\n+searcher.search(queryRefsetMembers).forEach({SnomedRefSetMemberIndexEntry member ->\n+\tmembers.put(member.getReferencedComponentId(), member)\n+\n+})\n+\n+Query<String> queryConcepts = Query.select(SnomedConceptDocument.class)\n+\t\t.from(SnomedConceptDocument.class)\n+\t\t.where(filterExpressionBuilder.build())\n+\t\t.limit(Integer.MAX_VALUE)\n+\t\t.build()\n+\n+searcher.search(queryConcepts).forEach({SnomedConceptDocument concept ->\n+\tString inactivationIndicatorId = (String) members.get(concept.getId()).getProperties().get(SnomedRf2Headers.FIELD_VALUE_ID);\n+\tprintln(inactivationIndicatorId)\n+\tif (!(inactivationIndicatorId.equals(Concepts.PENDING_MOVE)|| inactivationIndicatorId.equals(Concepts.LIMITED) ||", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "916882c85fedea52f1913f2f0fb81d95a5b37517"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM5NDY1Ng==", "bodyText": "Done", "url": "https://github.com/b2ihealthcare/snow-owl/pull/580#discussion_r437394656", "createdAt": "2020-06-09T13:00:36Z", "author": {"login": "molnarlaura"}, "path": "snomed/com.b2international.snowowl.validation.snomed/src/main/resources/scripts/rule671.groovy", "diffHunk": "@@ -0,0 +1,55 @@\n+package scripts;\n+\n+import com.b2international.index.query.Expressions\n+import com.b2international.index.query.Query\n+import com.b2international.index.query.Expressions.ExpressionBuilder\n+import com.b2international.index.revision.RevisionSearcher\n+import com.b2international.snowowl.core.ComponentIdentifier\n+import com.b2international.snowowl.core.date.EffectiveTimes\n+import com.b2international.snowowl.snomed.common.SnomedRf2Headers\n+import com.b2international.snowowl.snomed.common.SnomedTerminologyComponentConstants\n+import com.b2international.snowowl.snomed.common.SnomedConstants.Concepts\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedConceptDocument\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedRefSetMemberIndexEntry\n+import com.google.common.collect.Maps\n+import com.google.common.collect.Sets\n+\n+final Set<ComponentIdentifier> issues = Sets.newHashSet()\n+final RevisionSearcher searcher = ctx.service(RevisionSearcher.class)\n+\n+ExpressionBuilder filterExpressionBuilder = Expressions.builder()\n+\t\t.filter(SnomedConceptDocument.Expressions.inactive())\n+\n+if (params.isUnpublishedOnly) {\n+\tfilterExpressionBuilder.filter(SnomedConceptDocument.Expressions.effectiveTime(EffectiveTimes.UNSET_EFFECTIVE_TIME))\n+}\n+\n+Map<String, SnomedRefSetMemberIndexEntry> members = Maps.newHashMap()\n+\n+Query<String> queryRefsetMembers =Query.select(SnomedRefSetMemberIndexEntry.class)\n+\t\t.from(SnomedRefSetMemberIndexEntry.class)\n+\t\t.where(SnomedRefSetMemberIndexEntry.Expressions.referenceSetId(Concepts.REFSET_CONCEPT_INACTIVITY_INDICATOR))\n+\t\t.limit(Integer.MAX_VALUE)\n+\t\t.build()\n+\n+searcher.search(queryRefsetMembers).forEach({SnomedRefSetMemberIndexEntry member ->\n+\tmembers.put(member.getReferencedComponentId(), member)\n+\n+})\n+\n+Query<String> queryConcepts = Query.select(SnomedConceptDocument.class)\n+\t\t.from(SnomedConceptDocument.class)\n+\t\t.where(filterExpressionBuilder.build())\n+\t\t.limit(Integer.MAX_VALUE)\n+\t\t.build()\n+\n+searcher.search(queryConcepts).forEach({SnomedConceptDocument concept ->\n+\tString inactivationIndicatorId = (String) members.get(concept.getId()).getProperties().get(SnomedRf2Headers.FIELD_VALUE_ID);\n+\tprintln(inactivationIndicatorId)\n+\tif (!(inactivationIndicatorId.equals(Concepts.PENDING_MOVE)|| inactivationIndicatorId.equals(Concepts.LIMITED) ||", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM2ODkzMQ=="}, "originalCommit": {"oid": "916882c85fedea52f1913f2f0fb81d95a5b37517"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0MTc1NzI5OnYy", "diffSide": "RIGHT", "path": "snomed/com.b2international.snowowl.validation.snomed/src/main/resources/scripts/rule671.groovy", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMDowOTozNVrOGjrxag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNjo0NzoxNVrOGkkTvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDA3MDUwNg==", "bodyText": "The unpublished filter should be added to the inactivation indicator members query, not to the concept nor to the descriptions query.", "url": "https://github.com/b2ihealthcare/snow-owl/pull/580#discussion_r440070506", "createdAt": "2020-06-15T10:09:35Z", "author": {"login": "cmark"}, "path": "snomed/com.b2international.snowowl.validation.snomed/src/main/resources/scripts/rule671.groovy", "diffHunk": "@@ -0,0 +1,74 @@\n+package scripts;\n+\n+import com.b2international.index.Hits\n+import com.b2international.index.query.Expressions\n+import com.b2international.index.query.Query\n+import com.b2international.index.query.Expressions.ExpressionBuilder\n+import com.b2international.index.revision.RevisionSearcher\n+import com.b2international.snowowl.core.ComponentIdentifier\n+import com.b2international.snowowl.core.date.EffectiveTimes\n+import com.b2international.snowowl.snomed.common.SnomedRf2Headers\n+import com.b2international.snowowl.snomed.common.SnomedTerminologyComponentConstants\n+import com.b2international.snowowl.snomed.common.SnomedConstants.Concepts\n+import com.b2international.snowowl.snomed.core.domain.SnomedDescription\n+import com.b2international.snowowl.snomed.core.domain.SnomedDescriptions\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedConceptDocument\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedRefSetMemberIndexEntry\n+import com.b2international.snowowl.snomed.datastore.request.SnomedRequests\n+import com.google.common.collect.Lists\n+import com.google.common.collect.Maps\n+import com.google.common.collect.Sets\n+\n+final Set<ComponentIdentifier> issues = Sets.newHashSet()\n+final RevisionSearcher searcher = ctx.service(RevisionSearcher.class)\n+\n+ExpressionBuilder filterExpressionBuilder = Expressions.builder()\n+\t\t.filter(SnomedConceptDocument.Expressions.inactive())\n+\n+if (params.isUnpublishedOnly) {\n+\tfilterExpressionBuilder.filter(SnomedConceptDocument.Expressions.effectiveTime(EffectiveTimes.UNSET_EFFECTIVE_TIME))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d46e459801c3ac1385e44cfeec1ae31d4299b9a"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk5Njc5OA==", "bodyText": "Done", "url": "https://github.com/b2ihealthcare/snow-owl/pull/580#discussion_r440996798", "createdAt": "2020-06-16T16:47:15Z", "author": {"login": "molnarlaura"}, "path": "snomed/com.b2international.snowowl.validation.snomed/src/main/resources/scripts/rule671.groovy", "diffHunk": "@@ -0,0 +1,74 @@\n+package scripts;\n+\n+import com.b2international.index.Hits\n+import com.b2international.index.query.Expressions\n+import com.b2international.index.query.Query\n+import com.b2international.index.query.Expressions.ExpressionBuilder\n+import com.b2international.index.revision.RevisionSearcher\n+import com.b2international.snowowl.core.ComponentIdentifier\n+import com.b2international.snowowl.core.date.EffectiveTimes\n+import com.b2international.snowowl.snomed.common.SnomedRf2Headers\n+import com.b2international.snowowl.snomed.common.SnomedTerminologyComponentConstants\n+import com.b2international.snowowl.snomed.common.SnomedConstants.Concepts\n+import com.b2international.snowowl.snomed.core.domain.SnomedDescription\n+import com.b2international.snowowl.snomed.core.domain.SnomedDescriptions\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedConceptDocument\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedRefSetMemberIndexEntry\n+import com.b2international.snowowl.snomed.datastore.request.SnomedRequests\n+import com.google.common.collect.Lists\n+import com.google.common.collect.Maps\n+import com.google.common.collect.Sets\n+\n+final Set<ComponentIdentifier> issues = Sets.newHashSet()\n+final RevisionSearcher searcher = ctx.service(RevisionSearcher.class)\n+\n+ExpressionBuilder filterExpressionBuilder = Expressions.builder()\n+\t\t.filter(SnomedConceptDocument.Expressions.inactive())\n+\n+if (params.isUnpublishedOnly) {\n+\tfilterExpressionBuilder.filter(SnomedConceptDocument.Expressions.effectiveTime(EffectiveTimes.UNSET_EFFECTIVE_TIME))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDA3MDUwNg=="}, "originalCommit": {"oid": "9d46e459801c3ac1385e44cfeec1ae31d4299b9a"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0MTc2MDI1OnYy", "diffSide": "RIGHT", "path": "snomed/com.b2international.snowowl.validation.snomed/src/main/resources/scripts/rule671.groovy", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMDoxMDozMVrOGjrzSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNjo0Nzo0NVrOGkkVAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDA3MDk4NQ==", "bodyText": "Use Set for distinct values and when you don't actually need the index.", "url": "https://github.com/b2ihealthcare/snow-owl/pull/580#discussion_r440070985", "createdAt": "2020-06-15T10:10:31Z", "author": {"login": "cmark"}, "path": "snomed/com.b2international.snowowl.validation.snomed/src/main/resources/scripts/rule671.groovy", "diffHunk": "@@ -0,0 +1,74 @@\n+package scripts;\n+\n+import com.b2international.index.Hits\n+import com.b2international.index.query.Expressions\n+import com.b2international.index.query.Query\n+import com.b2international.index.query.Expressions.ExpressionBuilder\n+import com.b2international.index.revision.RevisionSearcher\n+import com.b2international.snowowl.core.ComponentIdentifier\n+import com.b2international.snowowl.core.date.EffectiveTimes\n+import com.b2international.snowowl.snomed.common.SnomedRf2Headers\n+import com.b2international.snowowl.snomed.common.SnomedTerminologyComponentConstants\n+import com.b2international.snowowl.snomed.common.SnomedConstants.Concepts\n+import com.b2international.snowowl.snomed.core.domain.SnomedDescription\n+import com.b2international.snowowl.snomed.core.domain.SnomedDescriptions\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedConceptDocument\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedRefSetMemberIndexEntry\n+import com.b2international.snowowl.snomed.datastore.request.SnomedRequests\n+import com.google.common.collect.Lists\n+import com.google.common.collect.Maps\n+import com.google.common.collect.Sets\n+\n+final Set<ComponentIdentifier> issues = Sets.newHashSet()\n+final RevisionSearcher searcher = ctx.service(RevisionSearcher.class)\n+\n+ExpressionBuilder filterExpressionBuilder = Expressions.builder()\n+\t\t.filter(SnomedConceptDocument.Expressions.inactive())\n+\n+if (params.isUnpublishedOnly) {\n+\tfilterExpressionBuilder.filter(SnomedConceptDocument.Expressions.effectiveTime(EffectiveTimes.UNSET_EFFECTIVE_TIME))\n+}\n+\n+List<String> inactiveIds = Lists.newArrayList()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d46e459801c3ac1385e44cfeec1ae31d4299b9a"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk5NzEyMQ==", "bodyText": "Done", "url": "https://github.com/b2ihealthcare/snow-owl/pull/580#discussion_r440997121", "createdAt": "2020-06-16T16:47:45Z", "author": {"login": "molnarlaura"}, "path": "snomed/com.b2international.snowowl.validation.snomed/src/main/resources/scripts/rule671.groovy", "diffHunk": "@@ -0,0 +1,74 @@\n+package scripts;\n+\n+import com.b2international.index.Hits\n+import com.b2international.index.query.Expressions\n+import com.b2international.index.query.Query\n+import com.b2international.index.query.Expressions.ExpressionBuilder\n+import com.b2international.index.revision.RevisionSearcher\n+import com.b2international.snowowl.core.ComponentIdentifier\n+import com.b2international.snowowl.core.date.EffectiveTimes\n+import com.b2international.snowowl.snomed.common.SnomedRf2Headers\n+import com.b2international.snowowl.snomed.common.SnomedTerminologyComponentConstants\n+import com.b2international.snowowl.snomed.common.SnomedConstants.Concepts\n+import com.b2international.snowowl.snomed.core.domain.SnomedDescription\n+import com.b2international.snowowl.snomed.core.domain.SnomedDescriptions\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedConceptDocument\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedRefSetMemberIndexEntry\n+import com.b2international.snowowl.snomed.datastore.request.SnomedRequests\n+import com.google.common.collect.Lists\n+import com.google.common.collect.Maps\n+import com.google.common.collect.Sets\n+\n+final Set<ComponentIdentifier> issues = Sets.newHashSet()\n+final RevisionSearcher searcher = ctx.service(RevisionSearcher.class)\n+\n+ExpressionBuilder filterExpressionBuilder = Expressions.builder()\n+\t\t.filter(SnomedConceptDocument.Expressions.inactive())\n+\n+if (params.isUnpublishedOnly) {\n+\tfilterExpressionBuilder.filter(SnomedConceptDocument.Expressions.effectiveTime(EffectiveTimes.UNSET_EFFECTIVE_TIME))\n+}\n+\n+List<String> inactiveIds = Lists.newArrayList()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDA3MDk4NQ=="}, "originalCommit": {"oid": "9d46e459801c3ac1385e44cfeec1ae31d4299b9a"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0MTc3NTgzOnYy", "diffSide": "RIGHT", "path": "snomed/com.b2international.snowowl.validation.snomed/src/main/resources/scripts/rule671.groovy", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMDoxNToxOFrOGjr9UQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNjo0Nzo0MFrOGkkUzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDA3MzU1Mw==", "bodyText": "This Map variable still references only a single indicator per description, which is okay, but due to the nature of authoring in Snow Owl, it is possible that two or more indicators exists. There is a rule that checks and reports duplications in refsets, so here you don't need another check, but you have to check all existing members for all descriptions.", "url": "https://github.com/b2ihealthcare/snow-owl/pull/580#discussion_r440073553", "createdAt": "2020-06-15T10:15:18Z", "author": {"login": "cmark"}, "path": "snomed/com.b2international.snowowl.validation.snomed/src/main/resources/scripts/rule671.groovy", "diffHunk": "@@ -0,0 +1,74 @@\n+package scripts;\n+\n+import com.b2international.index.Hits\n+import com.b2international.index.query.Expressions\n+import com.b2international.index.query.Query\n+import com.b2international.index.query.Expressions.ExpressionBuilder\n+import com.b2international.index.revision.RevisionSearcher\n+import com.b2international.snowowl.core.ComponentIdentifier\n+import com.b2international.snowowl.core.date.EffectiveTimes\n+import com.b2international.snowowl.snomed.common.SnomedRf2Headers\n+import com.b2international.snowowl.snomed.common.SnomedTerminologyComponentConstants\n+import com.b2international.snowowl.snomed.common.SnomedConstants.Concepts\n+import com.b2international.snowowl.snomed.core.domain.SnomedDescription\n+import com.b2international.snowowl.snomed.core.domain.SnomedDescriptions\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedConceptDocument\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedRefSetMemberIndexEntry\n+import com.b2international.snowowl.snomed.datastore.request.SnomedRequests\n+import com.google.common.collect.Lists\n+import com.google.common.collect.Maps\n+import com.google.common.collect.Sets\n+\n+final Set<ComponentIdentifier> issues = Sets.newHashSet()\n+final RevisionSearcher searcher = ctx.service(RevisionSearcher.class)\n+\n+ExpressionBuilder filterExpressionBuilder = Expressions.builder()\n+\t\t.filter(SnomedConceptDocument.Expressions.inactive())\n+\n+if (params.isUnpublishedOnly) {\n+\tfilterExpressionBuilder.filter(SnomedConceptDocument.Expressions.effectiveTime(EffectiveTimes.UNSET_EFFECTIVE_TIME))\n+}\n+\n+List<String> inactiveIds = Lists.newArrayList()\n+\n+searcher.scroll(Query.select(String.class)\n+\t\t.from(SnomedConceptDocument.class)\n+\t\t.fields(SnomedConceptDocument.Fields.ID)\n+\t\t.where(filterExpressionBuilder.build())\n+\t\t.limit(10_000)\n+\t\t.build())\n+\t\t.each({id ->\n+\t\t\tinactiveIds.add(id[0])\n+\t\t})\n+\n+Map<String, SnomedRefSetMemberIndexEntry> members = Maps.newHashMap()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d46e459801c3ac1385e44cfeec1ae31d4299b9a"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk5NzA3MA==", "bodyText": "Done", "url": "https://github.com/b2ihealthcare/snow-owl/pull/580#discussion_r440997070", "createdAt": "2020-06-16T16:47:40Z", "author": {"login": "molnarlaura"}, "path": "snomed/com.b2international.snowowl.validation.snomed/src/main/resources/scripts/rule671.groovy", "diffHunk": "@@ -0,0 +1,74 @@\n+package scripts;\n+\n+import com.b2international.index.Hits\n+import com.b2international.index.query.Expressions\n+import com.b2international.index.query.Query\n+import com.b2international.index.query.Expressions.ExpressionBuilder\n+import com.b2international.index.revision.RevisionSearcher\n+import com.b2international.snowowl.core.ComponentIdentifier\n+import com.b2international.snowowl.core.date.EffectiveTimes\n+import com.b2international.snowowl.snomed.common.SnomedRf2Headers\n+import com.b2international.snowowl.snomed.common.SnomedTerminologyComponentConstants\n+import com.b2international.snowowl.snomed.common.SnomedConstants.Concepts\n+import com.b2international.snowowl.snomed.core.domain.SnomedDescription\n+import com.b2international.snowowl.snomed.core.domain.SnomedDescriptions\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedConceptDocument\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedRefSetMemberIndexEntry\n+import com.b2international.snowowl.snomed.datastore.request.SnomedRequests\n+import com.google.common.collect.Lists\n+import com.google.common.collect.Maps\n+import com.google.common.collect.Sets\n+\n+final Set<ComponentIdentifier> issues = Sets.newHashSet()\n+final RevisionSearcher searcher = ctx.service(RevisionSearcher.class)\n+\n+ExpressionBuilder filterExpressionBuilder = Expressions.builder()\n+\t\t.filter(SnomedConceptDocument.Expressions.inactive())\n+\n+if (params.isUnpublishedOnly) {\n+\tfilterExpressionBuilder.filter(SnomedConceptDocument.Expressions.effectiveTime(EffectiveTimes.UNSET_EFFECTIVE_TIME))\n+}\n+\n+List<String> inactiveIds = Lists.newArrayList()\n+\n+searcher.scroll(Query.select(String.class)\n+\t\t.from(SnomedConceptDocument.class)\n+\t\t.fields(SnomedConceptDocument.Fields.ID)\n+\t\t.where(filterExpressionBuilder.build())\n+\t\t.limit(10_000)\n+\t\t.build())\n+\t\t.each({id ->\n+\t\t\tinactiveIds.add(id[0])\n+\t\t})\n+\n+Map<String, SnomedRefSetMemberIndexEntry> members = Maps.newHashMap()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDA3MzU1Mw=="}, "originalCommit": {"oid": "9d46e459801c3ac1385e44cfeec1ae31d4299b9a"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0MTc4NjQyOnYy", "diffSide": "RIGHT", "path": "snomed/com.b2international.snowowl.validation.snomed/src/main/resources/scripts/rule671.groovy", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMDoxODozNFrOGjsD9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNjo0NzozN1rOGkkUrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDA3NTI1NQ==", "bodyText": "Missing unpublished filter.\nIt would be much faster to construct a filter query instead of manually checking every 300.000 indicators each time we hit validate.\nYou can also execute two queries:\nOne for active descriptions where the value is not in the allowed set.\nAnother for inactive descriptions, where you don't have an indicator (hint: negate filter clauses).", "url": "https://github.com/b2ihealthcare/snow-owl/pull/580#discussion_r440075255", "createdAt": "2020-06-15T10:18:34Z", "author": {"login": "cmark"}, "path": "snomed/com.b2international.snowowl.validation.snomed/src/main/resources/scripts/rule671.groovy", "diffHunk": "@@ -0,0 +1,74 @@\n+package scripts;\n+\n+import com.b2international.index.Hits\n+import com.b2international.index.query.Expressions\n+import com.b2international.index.query.Query\n+import com.b2international.index.query.Expressions.ExpressionBuilder\n+import com.b2international.index.revision.RevisionSearcher\n+import com.b2international.snowowl.core.ComponentIdentifier\n+import com.b2international.snowowl.core.date.EffectiveTimes\n+import com.b2international.snowowl.snomed.common.SnomedRf2Headers\n+import com.b2international.snowowl.snomed.common.SnomedTerminologyComponentConstants\n+import com.b2international.snowowl.snomed.common.SnomedConstants.Concepts\n+import com.b2international.snowowl.snomed.core.domain.SnomedDescription\n+import com.b2international.snowowl.snomed.core.domain.SnomedDescriptions\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedConceptDocument\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedRefSetMemberIndexEntry\n+import com.b2international.snowowl.snomed.datastore.request.SnomedRequests\n+import com.google.common.collect.Lists\n+import com.google.common.collect.Maps\n+import com.google.common.collect.Sets\n+\n+final Set<ComponentIdentifier> issues = Sets.newHashSet()\n+final RevisionSearcher searcher = ctx.service(RevisionSearcher.class)\n+\n+ExpressionBuilder filterExpressionBuilder = Expressions.builder()\n+\t\t.filter(SnomedConceptDocument.Expressions.inactive())\n+\n+if (params.isUnpublishedOnly) {\n+\tfilterExpressionBuilder.filter(SnomedConceptDocument.Expressions.effectiveTime(EffectiveTimes.UNSET_EFFECTIVE_TIME))\n+}\n+\n+List<String> inactiveIds = Lists.newArrayList()\n+\n+searcher.scroll(Query.select(String.class)\n+\t\t.from(SnomedConceptDocument.class)\n+\t\t.fields(SnomedConceptDocument.Fields.ID)\n+\t\t.where(filterExpressionBuilder.build())\n+\t\t.limit(10_000)\n+\t\t.build())\n+\t\t.each({id ->\n+\t\t\tinactiveIds.add(id[0])\n+\t\t})\n+\n+Map<String, SnomedRefSetMemberIndexEntry> members = Maps.newHashMap()\n+\n+searcher.scroll(Query.select(SnomedRefSetMemberIndexEntry.class)\n+\t\t.from(SnomedRefSetMemberIndexEntry.class)\n+\t\t.where(SnomedRefSetMemberIndexEntry.Expressions.referenceSetId(Concepts.REFSET_DESCRIPTION_INACTIVITY_INDICATOR))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d46e459801c3ac1385e44cfeec1ae31d4299b9a"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk5NzAzNw==", "bodyText": "Done", "url": "https://github.com/b2ihealthcare/snow-owl/pull/580#discussion_r440997037", "createdAt": "2020-06-16T16:47:37Z", "author": {"login": "molnarlaura"}, "path": "snomed/com.b2international.snowowl.validation.snomed/src/main/resources/scripts/rule671.groovy", "diffHunk": "@@ -0,0 +1,74 @@\n+package scripts;\n+\n+import com.b2international.index.Hits\n+import com.b2international.index.query.Expressions\n+import com.b2international.index.query.Query\n+import com.b2international.index.query.Expressions.ExpressionBuilder\n+import com.b2international.index.revision.RevisionSearcher\n+import com.b2international.snowowl.core.ComponentIdentifier\n+import com.b2international.snowowl.core.date.EffectiveTimes\n+import com.b2international.snowowl.snomed.common.SnomedRf2Headers\n+import com.b2international.snowowl.snomed.common.SnomedTerminologyComponentConstants\n+import com.b2international.snowowl.snomed.common.SnomedConstants.Concepts\n+import com.b2international.snowowl.snomed.core.domain.SnomedDescription\n+import com.b2international.snowowl.snomed.core.domain.SnomedDescriptions\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedConceptDocument\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedRefSetMemberIndexEntry\n+import com.b2international.snowowl.snomed.datastore.request.SnomedRequests\n+import com.google.common.collect.Lists\n+import com.google.common.collect.Maps\n+import com.google.common.collect.Sets\n+\n+final Set<ComponentIdentifier> issues = Sets.newHashSet()\n+final RevisionSearcher searcher = ctx.service(RevisionSearcher.class)\n+\n+ExpressionBuilder filterExpressionBuilder = Expressions.builder()\n+\t\t.filter(SnomedConceptDocument.Expressions.inactive())\n+\n+if (params.isUnpublishedOnly) {\n+\tfilterExpressionBuilder.filter(SnomedConceptDocument.Expressions.effectiveTime(EffectiveTimes.UNSET_EFFECTIVE_TIME))\n+}\n+\n+List<String> inactiveIds = Lists.newArrayList()\n+\n+searcher.scroll(Query.select(String.class)\n+\t\t.from(SnomedConceptDocument.class)\n+\t\t.fields(SnomedConceptDocument.Fields.ID)\n+\t\t.where(filterExpressionBuilder.build())\n+\t\t.limit(10_000)\n+\t\t.build())\n+\t\t.each({id ->\n+\t\t\tinactiveIds.add(id[0])\n+\t\t})\n+\n+Map<String, SnomedRefSetMemberIndexEntry> members = Maps.newHashMap()\n+\n+searcher.scroll(Query.select(SnomedRefSetMemberIndexEntry.class)\n+\t\t.from(SnomedRefSetMemberIndexEntry.class)\n+\t\t.where(SnomedRefSetMemberIndexEntry.Expressions.referenceSetId(Concepts.REFSET_DESCRIPTION_INACTIVITY_INDICATOR))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDA3NTI1NQ=="}, "originalCommit": {"oid": "9d46e459801c3ac1385e44cfeec1ae31d4299b9a"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0MTc5ODY5OnYy", "diffSide": "RIGHT", "path": "snomed/com.b2international.snowowl.validation.snomed/src/test/java/com/b2international/snowowl/validation/snomed/GenericValidationRuleTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMDoyMjozNlrOGjsL7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNjo0NzozMVrOGkkUbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDA3NzI5Mw==", "bodyText": "There is no test for active description with incorrect indicator value in the refset.\nThere is no test for inactive description without any indicator value in the refset.", "url": "https://github.com/b2ihealthcare/snow-owl/pull/580#discussion_r440077293", "createdAt": "2020-06-15T10:22:36Z", "author": {"login": "cmark"}, "path": "snomed/com.b2international.snowowl.validation.snomed/src/test/java/com/b2international/snowowl/validation/snomed/GenericValidationRuleTest.java", "diffHunk": "@@ -499,5 +499,36 @@ public void rule670() throws Exception {\n \t\tassertAffectedComponents(issues, \n \t\t\t\tComponentIdentifier.of(SnomedTerminologyComponentConstants.CONCEPT_NUMBER, Concepts.IS_A));\n \t}\n+\n+\t@Test\n+\tpublic void rule671() throws Exception {\n+\t\tfinal String ruleId = \"671\";\n+\t\tindexRule(ruleId);\n+\t\t\n+\t\tString conceptId = generateConceptId();\n+\t\tSnomedDescriptionIndexEntry fsn = description(generateDescriptionId(), Concepts.FULLY_SPECIFIED_NAME, \"Fully specified name 3 (tag)\")\n+\t\t\t\t.conceptId(conceptId)\n+\t\t\t\t.acceptability(Concepts.REFSET_LANGUAGE_TYPE_ES, Acceptability.PREFERRED)\n+\t\t\t\t.build();\n+\t\tSnomedDescriptionIndexEntry pt = description(generateDescriptionId(), Concepts.SYNONYM, \"Preferred term 3\")\n+\t\t\t\t.acceptability(Concepts.REFSET_LANGUAGE_TYPE_ES, Acceptability.PREFERRED)\n+\t\t\t\t.conceptId(conceptId)\n+\t\t\t\t.build();\n+\t\tSnomedRefSetMemberIndexEntry ptMember = member(pt.getId(), SnomedTerminologyComponentConstants.DESCRIPTION_NUMBER, Concepts.REFSET_DESCRIPTION_INACTIVITY_INDICATOR).valueId(Concepts.CONCEPT_NON_CURRENT).build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d46e459801c3ac1385e44cfeec1ae31d4299b9a"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk5Njk3Mg==", "bodyText": "Done", "url": "https://github.com/b2ihealthcare/snow-owl/pull/580#discussion_r440996972", "createdAt": "2020-06-16T16:47:31Z", "author": {"login": "molnarlaura"}, "path": "snomed/com.b2international.snowowl.validation.snomed/src/test/java/com/b2international/snowowl/validation/snomed/GenericValidationRuleTest.java", "diffHunk": "@@ -499,5 +499,36 @@ public void rule670() throws Exception {\n \t\tassertAffectedComponents(issues, \n \t\t\t\tComponentIdentifier.of(SnomedTerminologyComponentConstants.CONCEPT_NUMBER, Concepts.IS_A));\n \t}\n+\n+\t@Test\n+\tpublic void rule671() throws Exception {\n+\t\tfinal String ruleId = \"671\";\n+\t\tindexRule(ruleId);\n+\t\t\n+\t\tString conceptId = generateConceptId();\n+\t\tSnomedDescriptionIndexEntry fsn = description(generateDescriptionId(), Concepts.FULLY_SPECIFIED_NAME, \"Fully specified name 3 (tag)\")\n+\t\t\t\t.conceptId(conceptId)\n+\t\t\t\t.acceptability(Concepts.REFSET_LANGUAGE_TYPE_ES, Acceptability.PREFERRED)\n+\t\t\t\t.build();\n+\t\tSnomedDescriptionIndexEntry pt = description(generateDescriptionId(), Concepts.SYNONYM, \"Preferred term 3\")\n+\t\t\t\t.acceptability(Concepts.REFSET_LANGUAGE_TYPE_ES, Acceptability.PREFERRED)\n+\t\t\t\t.conceptId(conceptId)\n+\t\t\t\t.build();\n+\t\tSnomedRefSetMemberIndexEntry ptMember = member(pt.getId(), SnomedTerminologyComponentConstants.DESCRIPTION_NUMBER, Concepts.REFSET_DESCRIPTION_INACTIVITY_INDICATOR).valueId(Concepts.CONCEPT_NON_CURRENT).build();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDA3NzI5Mw=="}, "originalCommit": {"oid": "9d46e459801c3ac1385e44cfeec1ae31d4299b9a"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0OTk3OTcxOnYy", "diffSide": "RIGHT", "path": "snomed/com.b2international.snowowl.validation.snomed/src/main/resources/scripts/rule671.groovy", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwODo1MzoxNFrOGk8OtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwODo1OToyNVrOGk8eeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM4ODcyNA==", "bodyText": "Rename this variable to activeDescriptionIndicatorIds.", "url": "https://github.com/b2ihealthcare/snow-owl/pull/580#discussion_r441388724", "createdAt": "2020-06-17T08:53:14Z", "author": {"login": "cmark"}, "path": "snomed/com.b2international.snowowl.validation.snomed/src/main/resources/scripts/rule671.groovy", "diffHunk": "@@ -0,0 +1,93 @@\n+package scripts;\n+\n+import com.b2international.index.query.Expressions\n+import com.b2international.index.query.Query\n+import com.b2international.index.query.Expressions.ExpressionBuilder\n+import com.b2international.index.revision.RevisionSearcher\n+import com.b2international.snowowl.core.ComponentIdentifier\n+import com.b2international.snowowl.core.date.EffectiveTimes\n+import com.b2international.snowowl.snomed.common.SnomedTerminologyComponentConstants\n+import com.b2international.snowowl.snomed.common.SnomedConstants.Concepts\n+import com.b2international.snowowl.snomed.core.domain.SnomedDescription\n+import com.b2international.snowowl.snomed.core.domain.SnomedDescriptions\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedConceptDocument\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedDescriptionIndexEntry\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedRefSetMemberIndexEntry\n+import com.b2international.snowowl.snomed.datastore.request.SnomedRequests\n+import com.google.common.collect.ArrayListMultimap\n+import com.google.common.collect.ImmutableList\n+import com.google.common.collect.Lists\n+import com.google.common.collect.Sets\n+\n+final Set<ComponentIdentifier> issues = Sets.newHashSet()\n+final RevisionSearcher searcher = ctx.service(RevisionSearcher.class)\n+final List<String> filterIndicatorIds = ImmutableList.of(Concepts.PENDING_MOVE, Concepts.LIMITED, Concepts.CONCEPT_NON_CURRENT)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91e2695eb858b19268b50ff626e2139831b81e25"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM5Mjc2MQ==", "bodyText": "Done", "url": "https://github.com/b2ihealthcare/snow-owl/pull/580#discussion_r441392761", "createdAt": "2020-06-17T08:59:25Z", "author": {"login": "molnarlaura"}, "path": "snomed/com.b2international.snowowl.validation.snomed/src/main/resources/scripts/rule671.groovy", "diffHunk": "@@ -0,0 +1,93 @@\n+package scripts;\n+\n+import com.b2international.index.query.Expressions\n+import com.b2international.index.query.Query\n+import com.b2international.index.query.Expressions.ExpressionBuilder\n+import com.b2international.index.revision.RevisionSearcher\n+import com.b2international.snowowl.core.ComponentIdentifier\n+import com.b2international.snowowl.core.date.EffectiveTimes\n+import com.b2international.snowowl.snomed.common.SnomedTerminologyComponentConstants\n+import com.b2international.snowowl.snomed.common.SnomedConstants.Concepts\n+import com.b2international.snowowl.snomed.core.domain.SnomedDescription\n+import com.b2international.snowowl.snomed.core.domain.SnomedDescriptions\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedConceptDocument\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedDescriptionIndexEntry\n+import com.b2international.snowowl.snomed.datastore.index.entry.SnomedRefSetMemberIndexEntry\n+import com.b2international.snowowl.snomed.datastore.request.SnomedRequests\n+import com.google.common.collect.ArrayListMultimap\n+import com.google.common.collect.ImmutableList\n+import com.google.common.collect.Lists\n+import com.google.common.collect.Sets\n+\n+final Set<ComponentIdentifier> issues = Sets.newHashSet()\n+final RevisionSearcher searcher = ctx.service(RevisionSearcher.class)\n+final List<String> filterIndicatorIds = ImmutableList.of(Concepts.PENDING_MOVE, Concepts.LIMITED, Concepts.CONCEPT_NON_CURRENT)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM4ODcyNA=="}, "originalCommit": {"oid": "91e2695eb858b19268b50ff626e2139831b81e25"}, "originalPosition": 24}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1765, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}