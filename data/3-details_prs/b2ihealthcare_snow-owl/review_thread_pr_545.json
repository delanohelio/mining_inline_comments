{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA5MTczNTIw", "number": 545, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwNzoxMTo0M1rOD2hekQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwOTozNToyNVrOD2lczQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU4NDk4MTkzOnYy", "diffSide": "LEFT", "path": "docker/Dockerfile", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwNzoxMTo0M1rOGMUGZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwOTo1MDo1MVrOGMak6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTU2NTQxMw==", "bodyText": "Set the old default values to the arguments, so anyone who comes to this repo can build the image with just docker build ..\nI know Nexus is something that's still required, we will remove that dependency in the next iteration of the docker build process.", "url": "https://github.com/b2ihealthcare/snow-owl/pull/545#discussion_r415565413", "createdAt": "2020-04-27T07:11:43Z", "author": {"login": "cmark"}, "path": "docker/Dockerfile", "diffHunk": "@@ -40,22 +42,22 @@ EXPOSE 2036 8080\n \n LABEL org.label-schema.build-date=\"${BUILD_TIMESTAMP}\" \\\n   org.label-schema.vcs-ref=\"${GIT_REVISION}\" \\\n-  org.label-schema.version=\"${VERSION}\" \\\n+  org.label-schema.version=\"${TAG}\" \\\n   org.label-schema.license=\"Apache-2.0\" \\\n-  org.label-schema.name=\"Snow Owl OSS\" \\\n+  org.label-schema.name=\"${PRODUCT_NAME}\" \\\n   org.label-schema.schema-version=\"1.0\" \\\n-  org.label-schema.url=\"https://github.com/b2ihealthcare/snow-owl\" \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c9288c7a83ca89ce88dc6f31129653876364e14"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY0NTgzMQ==", "bodyText": "Default values are set for arguments so the image can be built as before", "url": "https://github.com/b2ihealthcare/snow-owl/pull/545#discussion_r415645831", "createdAt": "2020-04-27T09:12:59Z", "author": {"login": "nagyo"}, "path": "docker/Dockerfile", "diffHunk": "@@ -40,22 +42,22 @@ EXPOSE 2036 8080\n \n LABEL org.label-schema.build-date=\"${BUILD_TIMESTAMP}\" \\\n   org.label-schema.vcs-ref=\"${GIT_REVISION}\" \\\n-  org.label-schema.version=\"${VERSION}\" \\\n+  org.label-schema.version=\"${TAG}\" \\\n   org.label-schema.license=\"Apache-2.0\" \\\n-  org.label-schema.name=\"Snow Owl OSS\" \\\n+  org.label-schema.name=\"${PRODUCT_NAME}\" \\\n   org.label-schema.schema-version=\"1.0\" \\\n-  org.label-schema.url=\"https://github.com/b2ihealthcare/snow-owl\" \\", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTU2NTQxMw=="}, "originalCommit": {"oid": "9c9288c7a83ca89ce88dc6f31129653876364e14"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY3MTUyOA==", "bodyText": "I see them now, okay.", "url": "https://github.com/b2ihealthcare/snow-owl/pull/545#discussion_r415671528", "createdAt": "2020-04-27T09:50:51Z", "author": {"login": "cmark"}, "path": "docker/Dockerfile", "diffHunk": "@@ -40,22 +42,22 @@ EXPOSE 2036 8080\n \n LABEL org.label-schema.build-date=\"${BUILD_TIMESTAMP}\" \\\n   org.label-schema.vcs-ref=\"${GIT_REVISION}\" \\\n-  org.label-schema.version=\"${VERSION}\" \\\n+  org.label-schema.version=\"${TAG}\" \\\n   org.label-schema.license=\"Apache-2.0\" \\\n-  org.label-schema.name=\"Snow Owl OSS\" \\\n+  org.label-schema.name=\"${PRODUCT_NAME}\" \\\n   org.label-schema.schema-version=\"1.0\" \\\n-  org.label-schema.url=\"https://github.com/b2ihealthcare/snow-owl\" \\", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTU2NTQxMw=="}, "originalCommit": {"oid": "9c9288c7a83ca89ce88dc6f31129653876364e14"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU4NTYzMjc3OnYy", "diffSide": "RIGHT", "path": "Jenkinsfile", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwOTozNToyNVrOGMZ80g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwOTo0MToyOFrOGMaMbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY2MTI2Ng==", "bodyText": "Is there a default value given for the registry in the docker build job?", "url": "https://github.com/b2ihealthcare/snow-owl/pull/545#discussion_r415661266", "createdAt": "2020-04-27T09:35:25Z", "author": {"login": "apeteri"}, "path": "Jenkinsfile", "diffHunk": "@@ -39,52 +31,30 @@ node('docker') {\n \t\t\t\t\tsh \"mvn clean deploy -Dmaven.test.skip=${skipTests} -Dmaven.install.skip=true -Dtycho.localArtifacts=ignore\"\n \t\t\t\t}\n \t\t\t}\n-\n+\t\t\t\n \t\t}\n+\t\t\n+\t}\n \n-\t\tif (currentBuild.resultIsBetterOrEqualTo('SUCCESS')) {\n-\n-\t\t\tstage('Find artifact') {\n-\n-\t\t\t\tdef artifact = findFiles(glob: \"releng/com.b2international.snowowl.server.update/target/snow-owl-oss*.tar.gz\")[0]\n-\t\t\t\tsh '\\\\cp -f -t ${WORKSPACE}/docker '+artifact.path+''\n-\t\t\t\tserverArtifact = artifact.name\n-\n-\t\t\t}\n-\n-\t\t\tdef buildArgs = \"--build-arg SNOWOWL_INSTALL_PACKAGE=${serverArtifact}\\\n-\t\t\t\t\t--build-arg BUILD_TIMESTAMP=\\\"${BUILD_TIMESTAMP}\\\"\\\n-\t\t\t\t\t--build-arg VERSION=${tag}\\\n-\t\t\t\t\t--build-arg GIT_REVISION=${revision} ./docker\"\n-\n-\t\t\tstage('Build docker image') {\n-\n-\t\t\t\tdocker.withRegistry('', '0f4c3f31-b252-4104-928a-286eeeb075dc') {\n-\n-\t\t\t\t\tdef image = docker.build(\"b2ihealthcare/snow-owl-oss:${tag}\", \"${buildArgs}\")\n-\t\t\t\t\timage.push()\n-\n-\t\t\t\t\tif (!currentVersion.contains(\"SNAPSHOT\")) {\n-\t\t\t\t\t\timage.push(\"latest\")\n-\t\t\t\t\t}\n-\n-\t\t\t\t}\n-\n-\t\t\t}\n-\n-\t\t\tstage('Clean up') {\n-\t\t\t\tsh 'rm -fv docker/*.tar.gz'\n-\t\t\t\tsh 'docker system prune --force --all --volumes'\n-\t\t\t}\n-\n-\t\t}\n+\tif (currentBuild.resultIsBetterOrEqualTo('SUCCESS')) {\n+\t\t\n+\t\tbuild job: 'snow-owl-docker-build', parameters: [\n+\t\t\tstring(name: 'groupId', value: 'com.b2international.snowowl'),\n+\t\t\tstring(name: 'artifactId', value: 'com.b2international.snowowl.server.update'),\n+\t\t\tstring(name: 'artifactVersion', value: currentVersion),\n+\t\t\tstring(name: 'classifier', value: 'oss'),\n+\t\t\tstring(name: 'extension', value: 'tar.gz'),\n+\t\t\tstring(name: 'imageClassifier', value: 'oss'),\n+\t\t\tstring(name: 'gitRevision', value: revision),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c9288c7a83ca89ce88dc6f31129653876364e14"}, "originalPosition": 104}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY2NTI2MA==", "bodyText": "yes, empty registry means hub.docker.com", "url": "https://github.com/b2ihealthcare/snow-owl/pull/545#discussion_r415665260", "createdAt": "2020-04-27T09:41:28Z", "author": {"login": "nagyo"}, "path": "Jenkinsfile", "diffHunk": "@@ -39,52 +31,30 @@ node('docker') {\n \t\t\t\t\tsh \"mvn clean deploy -Dmaven.test.skip=${skipTests} -Dmaven.install.skip=true -Dtycho.localArtifacts=ignore\"\n \t\t\t\t}\n \t\t\t}\n-\n+\t\t\t\n \t\t}\n+\t\t\n+\t}\n \n-\t\tif (currentBuild.resultIsBetterOrEqualTo('SUCCESS')) {\n-\n-\t\t\tstage('Find artifact') {\n-\n-\t\t\t\tdef artifact = findFiles(glob: \"releng/com.b2international.snowowl.server.update/target/snow-owl-oss*.tar.gz\")[0]\n-\t\t\t\tsh '\\\\cp -f -t ${WORKSPACE}/docker '+artifact.path+''\n-\t\t\t\tserverArtifact = artifact.name\n-\n-\t\t\t}\n-\n-\t\t\tdef buildArgs = \"--build-arg SNOWOWL_INSTALL_PACKAGE=${serverArtifact}\\\n-\t\t\t\t\t--build-arg BUILD_TIMESTAMP=\\\"${BUILD_TIMESTAMP}\\\"\\\n-\t\t\t\t\t--build-arg VERSION=${tag}\\\n-\t\t\t\t\t--build-arg GIT_REVISION=${revision} ./docker\"\n-\n-\t\t\tstage('Build docker image') {\n-\n-\t\t\t\tdocker.withRegistry('', '0f4c3f31-b252-4104-928a-286eeeb075dc') {\n-\n-\t\t\t\t\tdef image = docker.build(\"b2ihealthcare/snow-owl-oss:${tag}\", \"${buildArgs}\")\n-\t\t\t\t\timage.push()\n-\n-\t\t\t\t\tif (!currentVersion.contains(\"SNAPSHOT\")) {\n-\t\t\t\t\t\timage.push(\"latest\")\n-\t\t\t\t\t}\n-\n-\t\t\t\t}\n-\n-\t\t\t}\n-\n-\t\t\tstage('Clean up') {\n-\t\t\t\tsh 'rm -fv docker/*.tar.gz'\n-\t\t\t\tsh 'docker system prune --force --all --volumes'\n-\t\t\t}\n-\n-\t\t}\n+\tif (currentBuild.resultIsBetterOrEqualTo('SUCCESS')) {\n+\t\t\n+\t\tbuild job: 'snow-owl-docker-build', parameters: [\n+\t\t\tstring(name: 'groupId', value: 'com.b2international.snowowl'),\n+\t\t\tstring(name: 'artifactId', value: 'com.b2international.snowowl.server.update'),\n+\t\t\tstring(name: 'artifactVersion', value: currentVersion),\n+\t\t\tstring(name: 'classifier', value: 'oss'),\n+\t\t\tstring(name: 'extension', value: 'tar.gz'),\n+\t\t\tstring(name: 'imageClassifier', value: 'oss'),\n+\t\t\tstring(name: 'gitRevision', value: revision),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY2MTI2Ng=="}, "originalCommit": {"oid": "9c9288c7a83ca89ce88dc6f31129653876364e14"}, "originalPosition": 104}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1739, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}