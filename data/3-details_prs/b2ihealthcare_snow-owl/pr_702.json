{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExNTQyMjcw", "number": 702, "title": "SO-4345: Map compare improvements", "bodyText": "", "createdAt": "2020-10-28T13:22:08Z", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702", "merged": true, "mergeCommit": {"oid": "33bf86c17915c910adeefed7f757c76aa5d1d727"}, "closed": true, "closedAt": "2020-10-28T20:41:55Z", "author": {"login": "molnarlaura"}, "timelineItems": {"totalCount": 38, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWSIsCgH2gAyNTExNTQyMjcwOjUyMDViMmNiOTQ0Yjc2YWVlODBhMjk3YjMwMWExMDQwZTc5ZTE0NmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXDx_sgFqTUxOTA2NjI0MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5205b2cb944b76aee80a297b301a1040e79e146f", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/5205b2cb944b76aee80a297b301a1040e79e146f", "committedDate": "2020-10-26T10:51:21Z", "message": "SO-4345: add enum for config props"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8c528b9c050a31b6cc5d60f6a478fafaec63e9d", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/f8c528b9c050a31b6cc5d60f6a478fafaec63e9d", "committedDate": "2020-10-26T10:51:44Z", "message": "SO-4345: add ability to configure map compare props"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8173e65eef294ae1dd2590e73690659a93c152a0", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/8173e65eef294ae1dd2590e73690659a93c152a0", "committedDate": "2020-10-26T16:05:08Z", "message": "SO-4345: add map compare equivalence logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebfac4f3a0458fdbb6879814c2c2deb0bbe31234", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/ebfac4f3a0458fdbb6879814c2c2deb0bbe31234", "committedDate": "2020-10-26T16:06:39Z", "message": "SO-4345: add ability to compare based on compare config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80a5f542df5dbaf87bf09c0612562715a16c291d", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/80a5f542df5dbaf87bf09c0612562715a16c291d", "committedDate": "2020-10-26T16:07:50Z", "message": "SO-4345: create constants for easier usage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1d7e82db94d15203434acd56173ed094c62a7a4", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/b1d7e82db94d15203434acd56173ed094c62a7a4", "committedDate": "2020-10-26T16:10:04Z", "message": "Merge remote-tracking branch 'origin/7.x' into improvement/SO-4345-configure-map-compare-props"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19b0af039d09a8598553e6686ff321c7426a02db", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/19b0af039d09a8598553e6686ff321c7426a02db", "committedDate": "2020-10-26T17:07:06Z", "message": "SO-4345: fix compare logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94d4df797bf47f8e8400e26aaa9631a6ee95aeb6", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/94d4df797bf47f8e8400e26aaa9631a6ee95aeb6", "committedDate": "2020-10-26T18:29:18Z", "message": "SO-4345: remove equal mappings first and then search for changed ones"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1f04800395a2eef98c2b33ebe7bae37cd5b8c60", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/e1f04800395a2eef98c2b33ebe7bae37cd5b8c60", "committedDate": "2020-10-27T10:14:31Z", "message": "SO-4345: fix compare logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79ae332d1eff26560ea9b0cfe898f6d3fcc1e6a3", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/79ae332d1eff26560ea9b0cfe898f6d3fcc1e6a3", "committedDate": "2020-10-27T10:40:23Z", "message": "Merge remote-tracking branch 'origin/7.x' into improvement/SO-4345-configure-map-compare-props"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c00f4998ed343d805fe40f7d559df44bedea223c", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/c00f4998ed343d805fe40f7d559df44bedea223c", "committedDate": "2020-10-27T11:02:59Z", "message": "SO-4345: use source and target for checking equivalence as well"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71ef0151494b5cc1d3bb86a39d2a6731ccaab3b1", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/71ef0151494b5cc1d3bb86a39d2a6731ccaab3b1", "committedDate": "2020-10-27T11:09:09Z", "message": "SO-4345: add equivalence class for source mapping equivalence"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ddf800c79743c280e8bc3e1df1b5ebe3c5bf17a", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/2ddf800c79743c280e8bc3e1df1b5ebe3c5bf17a", "committedDate": "2020-10-27T13:27:06Z", "message": "SO-4345: change compare logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3707b08f083e26656a5021db218b6b530c41b71b", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/3707b08f083e26656a5021db218b6b530c41b71b", "committedDate": "2020-10-27T17:14:37Z", "message": "SO-4345: fix compare logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "476128a81f84cf9ab9f070ce9802c49971df81ce", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/476128a81f84cf9ab9f070ce9802c49971df81ce", "committedDate": "2020-10-27T17:17:30Z", "message": "Merge remote-tracking branch 'origin/7.x' into improvement/SO-4345-configure-map-compare-props"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3feaf340a77d20eeb415ed87b740043c44c35c04", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/3feaf340a77d20eeb415ed87b740043c44c35c04", "committedDate": "2020-10-27T17:27:34Z", "message": "SO-4345: remove unnecessary code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc2eec96deaee2b6be95b41051a510a11913907c", "author": {"user": {"login": "bbanfai", "name": "Balazs Banfai"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/fc2eec96deaee2b6be95b41051a510a11913907c", "committedDate": "2020-10-27T18:21:22Z", "message": "SO-4345 Comments added."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6cd2bb79343b8a4d940c1e0c7935b45e7f977711", "author": {"user": {"login": "bbanfai", "name": "Balazs Banfai"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/6cd2bb79343b8a4d940c1e0c7935b45e7f977711", "committedDate": "2020-10-27T21:37:19Z", "message": "SO-4345 Added alternative solution."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0877c751d9eb7ab887e108d5a8410340c3c4bab", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/f0877c751d9eb7ab887e108d5a8410340c3c4bab", "committedDate": "2020-10-28T08:34:28Z", "message": "SO-4345: change the unchanged label to Same"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e9eb282776575ef8f1869a8a84174c3a2f2fa4f", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/1e9eb282776575ef8f1869a8a84174c3a2f2fa4f", "committedDate": "2020-10-28T09:39:43Z", "message": "SO-4345: remove alternative logic and extract common method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0a7b26d04930c9b18d36f913a9f5fb9b4ffe912", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/a0a7b26d04930c9b18d36f913a9f5fb9b4ffe912", "committedDate": "2020-10-28T12:08:10Z", "message": "SO-4345: add priority for changekind"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6ef4ed94bec0755e66d91594112308e2b03d397", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/d6ef4ed94bec0755e66d91594112308e2b03d397", "committedDate": "2020-10-28T12:08:29Z", "message": "SO-4345: extract common method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54ab82037b70c5bcb9460421a993d8cf2f9c5648", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/54ab82037b70c5bcb9460421a993d8cf2f9c5648", "committedDate": "2020-10-28T12:09:33Z", "message": "SO-4345: count number of total unchanged as well, limit later"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f789fd8b8b9a3d2a5ae3a3ad220c3b754261be56", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/f789fd8b8b9a3d2a5ae3a3ad220c3b754261be56", "committedDate": "2020-10-28T12:15:07Z", "message": "Merge remote-tracking branch 'origin/7.x' into improvement/SO-4345-configure-map-compare-props"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e812ebec21fe2c985bf8186f7fcdde407897e083", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/e812ebec21fe2c985bf8186f7fcdde407897e083", "committedDate": "2020-10-28T12:36:21Z", "message": "SO-4345: use sets.difference() to get unique mappings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c184d5ce1264ef16ed2168d2feb7348eb45ae00", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/2c184d5ce1264ef16ed2168d2feb7348eb45ae00", "committedDate": "2020-10-28T13:11:16Z", "message": "SO-4345: set default limit to the size of sets to compare"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92b432465110940cca0177f2fafe14eb71e3e561", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/92b432465110940cca0177f2fafe14eb71e3e561", "committedDate": "2020-10-28T14:06:29Z", "message": "SO-4345: make class final"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b400bb87af81e37d8204610c8c2dd17be5d5b4b", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/0b400bb87af81e37d8204610c8c2dd17be5d5b4b", "committedDate": "2020-10-28T14:06:54Z", "message": "SO-4345: make field private"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4NjgyNzAy", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#pullrequestreview-518682702", "createdAt": "2020-10-28T13:52:27Z", "commit": {"oid": "2c184d5ce1264ef16ed2168d2feb7348eb45ae00"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMzo1MjoyN1rOHprHGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNDowOTo0NVrOHpr8MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ1OTk5NQ==", "bodyText": "This parameter should be an option, not a mandatory parameter. By default compare by ComponentURI (CodeSystem + Code).", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513459995", "createdAt": "2020-10-28T13:52:27Z", "author": {"login": "cmark"}, "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/codesystem/CodeSystemRequests.java", "diffHunk": "@@ -105,8 +107,8 @@ public static AllCodeSystemSearchRequestBuilder prepareSearchAllCodeSystems(){\n \t\treturn new AllCodeSystemSearchRequestBuilder();\n \t}\n \t\n-\tpublic static ConceptMapCompareRequestBuilder prepareConceptMapCompare(ComponentURI baseConceptMapURI, ComponentURI compareConceptMapURI){\n-\t\treturn new ConceptMapCompareRequestBuilder(baseConceptMapURI, compareConceptMapURI);\n+\tpublic static ConceptMapCompareRequestBuilder prepareConceptMapCompare(ComponentURI baseConceptMapURI, ComponentURI compareConceptMapURI, Set<ConceptMapCompareConfigurationProperties> selectedConfig){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c184d5ce1264ef16ed2168d2feb7348eb45ae00"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ2MDg2NQ==", "bodyText": "How about using the enum ordinal as priority? If that's not good, then how about using int  for the priority field?", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513460865", "createdAt": "2020-10-28T13:53:38Z", "author": {"login": "cmark"}, "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/compare/ConceptMapCompareChangeKind.java", "diffHunk": "@@ -21,29 +21,35 @@\n  * @since 7.11\n  */\n public enum ConceptMapCompareChangeKind {\n-\tPRESENT(\"Present\"),\n-\tMISSING(\"Missing\"),\n+\tPRESENT(\"Present\", \"2\"),\n+\tMISSING(\"Missing\", \"1\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c184d5ce1264ef16ed2168d2feb7348eb45ae00"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ2MTM0NQ==", "bodyText": "\u26a0\ufe0f Fix the indentation!", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513461345", "createdAt": "2020-10-28T13:54:17Z", "author": {"login": "cmark"}, "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/compare/ConceptMapCompareConfigurationProperties.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/*\n+ * Copyright 2020 B2i Healthcare Pte Ltd, http://b2i.sg\n+ * \n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.b2international.snowowl.core.compare;\n+\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.function.BiFunction;\n+\n+import com.b2international.snowowl.core.domain.ConceptMapMapping;\n+import com.google.common.collect.ImmutableSet;\n+\n+/**\n+ * @since 7.11\n+ */\n+public enum ConceptMapCompareConfigurationProperties {\n+\n+\tCODE_SYSTEM(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c184d5ce1264ef16ed2168d2feb7348eb45ae00"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ2MjYzMA==", "bodyText": "Use List.copyOf() if possible.", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513462630", "createdAt": "2020-10-28T13:55:53Z", "author": {"login": "cmark"}, "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/compare/ConceptMapCompareResult.java", "diffHunk": "@@ -36,27 +33,27 @@\n \tprivate final int totalAdded;\n \tprivate final int totalRemoved;\n \tprivate final int totalChanged;\n+\tprivate final int totalUnchanged;\n \tprivate final int limit;\n \t\n \tprivate final List<ConceptMapMapping> addedMembers;\n \tprivate final List<ConceptMapMapping> removedMembers;\n \t\n-\tprivate final Multimap<ConceptMapMapping, ConceptMapMapping> changedMembers;\n+\tprivate final List<ConceptMapMapping> changedMembers;\n \tprivate final List<ConceptMapMapping> unchangedMembers;\n \t\n-\tpublic ConceptMapCompareResult(List<ConceptMapMapping> addedMembers, List<ConceptMapMapping> removedMembers, Multimap<ConceptMapMapping, ConceptMapMapping> changedMembers, Set<ConceptMapMapping> unchangedMembers, int limit) {\n+\tpublic ConceptMapCompareResult(List<ConceptMapMapping> addedMembers, List<ConceptMapMapping> removedMembers, List<ConceptMapMapping> changedMembers, Set<ConceptMapMapping> unchangedMembers, int limit) {\n \t\t\n-\t\tthis.addedMembers = addedMembers.stream().limit(limit).collect(toList());\n-\t\tthis.removedMembers = removedMembers.stream().limit(limit).collect(toList());\n+\t\tthis.addedMembers = addedMembers.stream().collect(toList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c184d5ce1264ef16ed2168d2feb7348eb45ae00"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ2Mjg3OA==", "bodyText": "Same here.", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513462878", "createdAt": "2020-10-28T13:56:12Z", "author": {"login": "cmark"}, "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/compare/ConceptMapCompareResult.java", "diffHunk": "@@ -36,27 +33,27 @@\n \tprivate final int totalAdded;\n \tprivate final int totalRemoved;\n \tprivate final int totalChanged;\n+\tprivate final int totalUnchanged;\n \tprivate final int limit;\n \t\n \tprivate final List<ConceptMapMapping> addedMembers;\n \tprivate final List<ConceptMapMapping> removedMembers;\n \t\n-\tprivate final Multimap<ConceptMapMapping, ConceptMapMapping> changedMembers;\n+\tprivate final List<ConceptMapMapping> changedMembers;\n \tprivate final List<ConceptMapMapping> unchangedMembers;\n \t\n-\tpublic ConceptMapCompareResult(List<ConceptMapMapping> addedMembers, List<ConceptMapMapping> removedMembers, Multimap<ConceptMapMapping, ConceptMapMapping> changedMembers, Set<ConceptMapMapping> unchangedMembers, int limit) {\n+\tpublic ConceptMapCompareResult(List<ConceptMapMapping> addedMembers, List<ConceptMapMapping> removedMembers, List<ConceptMapMapping> changedMembers, Set<ConceptMapMapping> unchangedMembers, int limit) {\n \t\t\n-\t\tthis.addedMembers = addedMembers.stream().limit(limit).collect(toList());\n-\t\tthis.removedMembers = removedMembers.stream().limit(limit).collect(toList());\n+\t\tthis.addedMembers = addedMembers.stream().collect(toList());\n+\t\tthis.removedMembers = removedMembers.stream().collect(toList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c184d5ce1264ef16ed2168d2feb7348eb45ae00"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ2Mjk1Ng==", "bodyText": "Same here.", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513462956", "createdAt": "2020-10-28T13:56:17Z", "author": {"login": "cmark"}, "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/compare/ConceptMapCompareResult.java", "diffHunk": "@@ -36,27 +33,27 @@\n \tprivate final int totalAdded;\n \tprivate final int totalRemoved;\n \tprivate final int totalChanged;\n+\tprivate final int totalUnchanged;\n \tprivate final int limit;\n \t\n \tprivate final List<ConceptMapMapping> addedMembers;\n \tprivate final List<ConceptMapMapping> removedMembers;\n \t\n-\tprivate final Multimap<ConceptMapMapping, ConceptMapMapping> changedMembers;\n+\tprivate final List<ConceptMapMapping> changedMembers;\n \tprivate final List<ConceptMapMapping> unchangedMembers;\n \t\n-\tpublic ConceptMapCompareResult(List<ConceptMapMapping> addedMembers, List<ConceptMapMapping> removedMembers, Multimap<ConceptMapMapping, ConceptMapMapping> changedMembers, Set<ConceptMapMapping> unchangedMembers, int limit) {\n+\tpublic ConceptMapCompareResult(List<ConceptMapMapping> addedMembers, List<ConceptMapMapping> removedMembers, List<ConceptMapMapping> changedMembers, Set<ConceptMapMapping> unchangedMembers, int limit) {\n \t\t\n-\t\tthis.addedMembers = addedMembers.stream().limit(limit).collect(toList());\n-\t\tthis.removedMembers = removedMembers.stream().limit(limit).collect(toList());\n+\t\tthis.addedMembers = addedMembers.stream().collect(toList());\n+\t\tthis.removedMembers = removedMembers.stream().collect(toList());\n \t\t\n-\t\tBuilder<ConceptMapMapping, ConceptMapMapping> limitedMembers = ImmutableMultimap.builder();\n-\t\tchangedMembers.entries().stream().limit(limit).forEach(limitedMembers::put);\n-\t\tthis.changedMembers = limitedMembers.build();\n+\t\tthis.changedMembers = changedMembers.stream().collect(toList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c184d5ce1264ef16ed2168d2feb7348eb45ae00"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ2Mzc0Ng==", "bodyText": "Magic number! Divided by two? Why (because of counting both base and compare side of the change)? Please add a comment.", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513463746", "createdAt": "2020-10-28T13:57:13Z", "author": {"login": "cmark"}, "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/compare/ConceptMapCompareResult.java", "diffHunk": "@@ -36,27 +33,27 @@\n \tprivate final int totalAdded;\n \tprivate final int totalRemoved;\n \tprivate final int totalChanged;\n+\tprivate final int totalUnchanged;\n \tprivate final int limit;\n \t\n \tprivate final List<ConceptMapMapping> addedMembers;\n \tprivate final List<ConceptMapMapping> removedMembers;\n \t\n-\tprivate final Multimap<ConceptMapMapping, ConceptMapMapping> changedMembers;\n+\tprivate final List<ConceptMapMapping> changedMembers;\n \tprivate final List<ConceptMapMapping> unchangedMembers;\n \t\n-\tpublic ConceptMapCompareResult(List<ConceptMapMapping> addedMembers, List<ConceptMapMapping> removedMembers, Multimap<ConceptMapMapping, ConceptMapMapping> changedMembers, Set<ConceptMapMapping> unchangedMembers, int limit) {\n+\tpublic ConceptMapCompareResult(List<ConceptMapMapping> addedMembers, List<ConceptMapMapping> removedMembers, List<ConceptMapMapping> changedMembers, Set<ConceptMapMapping> unchangedMembers, int limit) {\n \t\t\n-\t\tthis.addedMembers = addedMembers.stream().limit(limit).collect(toList());\n-\t\tthis.removedMembers = removedMembers.stream().limit(limit).collect(toList());\n+\t\tthis.addedMembers = addedMembers.stream().collect(toList());\n+\t\tthis.removedMembers = removedMembers.stream().collect(toList());\n \t\t\n-\t\tBuilder<ConceptMapMapping, ConceptMapMapping> limitedMembers = ImmutableMultimap.builder();\n-\t\tchangedMembers.entries().stream().limit(limit).forEach(limitedMembers::put);\n-\t\tthis.changedMembers = limitedMembers.build();\n+\t\tthis.changedMembers = changedMembers.stream().collect(toList());\n \t\tthis.unchangedMembers = ImmutableList.copyOf(unchangedMembers);\n \t\t\n \t\tthis.totalAdded = addedMembers.size();\n \t\tthis.totalRemoved = removedMembers.size();\n-\t\tthis.totalChanged = changedMembers.values().size();\n+\t\tthis.totalChanged = changedMembers.size()/2;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c184d5ce1264ef16ed2168d2feb7348eb45ae00"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ3MDE3Mw==", "bodyText": "Add a @NotEmpty validation annotation and also a default value set in the corresponding builder.", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513470173", "createdAt": "2020-10-28T14:05:24Z", "author": {"login": "cmark"}, "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/request/ConceptMapCompareRequest.java", "diffHunk": "@@ -16,44 +16,48 @@\n package com.b2international.snowowl.core.request;\n \n import java.util.List;\n-import java.util.Objects;\n import java.util.Set;\n+import java.util.stream.Collectors;\n \n import javax.validation.constraints.Min;\n \n import com.b2international.snowowl.core.codesystem.CodeSystemRequests;\n+import com.b2international.snowowl.core.compare.ConceptMapCompareConfigurationProperties;\n import com.b2international.snowowl.core.compare.ConceptMapCompareResult;\n+import com.b2international.snowowl.core.compare.MapCompareSourceAndTargetEquivalence;\n import com.b2international.snowowl.core.domain.BranchContext;\n import com.b2international.snowowl.core.domain.ConceptMapMapping;\n import com.b2international.snowowl.core.domain.ConceptMapMappings;\n import com.b2international.snowowl.core.uri.ComponentURI;\n+import com.google.common.base.Equivalence.Wrapper;\n import com.google.common.collect.ArrayListMultimap;\n-import com.google.common.collect.HashMultimap;\n import com.google.common.collect.ListMultimap;\n import com.google.common.collect.Lists;\n-import com.google.common.collect.Multimap;\n import com.google.common.collect.Sets;\n import com.google.common.collect.Sets.SetView;\n \n /**\n * @since 7.8\n */\n public final class ConceptMapCompareRequest extends ResourceRequest<BranchContext, ConceptMapCompareResult> {\n+\tpublic static final int DEFAULT_MEMBER_COMPARE_LIMIT = 50_000;\n \t\n \tprivate static final long serialVersionUID = 1L;\n \t\n \tprivate static final int DEFAULT_MEMBER_SCROLL_LIMIT = 10_000;\n \t\n \tprivate final ComponentURI baseConceptMapURI;\n \tprivate final ComponentURI compareConceptMapURI;\n+\tprivate final Set<ConceptMapCompareConfigurationProperties> selectedConfig;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c184d5ce1264ef16ed2168d2feb7348eb45ae00"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ3MjM2MQ==", "bodyText": "Where do you use this? 5000 is set on the corresponding builder.", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513472361", "createdAt": "2020-10-28T14:08:17Z", "author": {"login": "cmark"}, "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/request/ConceptMapCompareRequest.java", "diffHunk": "@@ -16,44 +16,48 @@\n package com.b2international.snowowl.core.request;\n \n import java.util.List;\n-import java.util.Objects;\n import java.util.Set;\n+import java.util.stream.Collectors;\n \n import javax.validation.constraints.Min;\n \n import com.b2international.snowowl.core.codesystem.CodeSystemRequests;\n+import com.b2international.snowowl.core.compare.ConceptMapCompareConfigurationProperties;\n import com.b2international.snowowl.core.compare.ConceptMapCompareResult;\n+import com.b2international.snowowl.core.compare.MapCompareSourceAndTargetEquivalence;\n import com.b2international.snowowl.core.domain.BranchContext;\n import com.b2international.snowowl.core.domain.ConceptMapMapping;\n import com.b2international.snowowl.core.domain.ConceptMapMappings;\n import com.b2international.snowowl.core.uri.ComponentURI;\n+import com.google.common.base.Equivalence.Wrapper;\n import com.google.common.collect.ArrayListMultimap;\n-import com.google.common.collect.HashMultimap;\n import com.google.common.collect.ListMultimap;\n import com.google.common.collect.Lists;\n-import com.google.common.collect.Multimap;\n import com.google.common.collect.Sets;\n import com.google.common.collect.Sets.SetView;\n \n /**\n * @since 7.8\n */\n public final class ConceptMapCompareRequest extends ResourceRequest<BranchContext, ConceptMapCompareResult> {\n+\tpublic static final int DEFAULT_MEMBER_COMPARE_LIMIT = 50_000;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c184d5ce1264ef16ed2168d2feb7348eb45ae00"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ3MjgwOQ==", "bodyText": "Are we using this now? I'm not seeing any statement nor filter that uses this value.", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513472809", "createdAt": "2020-10-28T14:08:50Z", "author": {"login": "cmark"}, "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/request/ConceptMapCompareRequest.java", "diffHunk": "@@ -16,44 +16,48 @@\n package com.b2international.snowowl.core.request;\n \n import java.util.List;\n-import java.util.Objects;\n import java.util.Set;\n+import java.util.stream.Collectors;\n \n import javax.validation.constraints.Min;\n \n import com.b2international.snowowl.core.codesystem.CodeSystemRequests;\n+import com.b2international.snowowl.core.compare.ConceptMapCompareConfigurationProperties;\n import com.b2international.snowowl.core.compare.ConceptMapCompareResult;\n+import com.b2international.snowowl.core.compare.MapCompareSourceAndTargetEquivalence;\n import com.b2international.snowowl.core.domain.BranchContext;\n import com.b2international.snowowl.core.domain.ConceptMapMapping;\n import com.b2international.snowowl.core.domain.ConceptMapMappings;\n import com.b2international.snowowl.core.uri.ComponentURI;\n+import com.google.common.base.Equivalence.Wrapper;\n import com.google.common.collect.ArrayListMultimap;\n-import com.google.common.collect.HashMultimap;\n import com.google.common.collect.ListMultimap;\n import com.google.common.collect.Lists;\n-import com.google.common.collect.Multimap;\n import com.google.common.collect.Sets;\n import com.google.common.collect.Sets.SetView;\n \n /**\n * @since 7.8\n */\n public final class ConceptMapCompareRequest extends ResourceRequest<BranchContext, ConceptMapCompareResult> {\n+\tpublic static final int DEFAULT_MEMBER_COMPARE_LIMIT = 50_000;\n \t\n \tprivate static final long serialVersionUID = 1L;\n \t\n \tprivate static final int DEFAULT_MEMBER_SCROLL_LIMIT = 10_000;\n \t\n \tprivate final ComponentURI baseConceptMapURI;\n \tprivate final ComponentURI compareConceptMapURI;\n+\tprivate final Set<ConceptMapCompareConfigurationProperties> selectedConfig;\n \t\n \t@Min(0)\n \tprivate int limit;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c184d5ce1264ef16ed2168d2feb7348eb45ae00"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ3MzA0Nw==", "bodyText": "5000 limit is present in this class.", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513473047", "createdAt": "2020-10-28T14:09:06Z", "author": {"login": "cmark"}, "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/request/ConceptMapCompareRequestBuilder.java", "diffHunk": "@@ -30,20 +33,23 @@\n \t", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c184d5ce1264ef16ed2168d2feb7348eb45ae00"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ3MzU4NQ==", "bodyText": "This can be the default value of the config field in the ConceptMap Compare API.", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513473585", "createdAt": "2020-10-28T14:09:45Z", "author": {"login": "cmark"}, "path": "snomed/com.b2international.snowowl.snomed.core.rest.tests/src/com/b2international/snowowl/snomed/core/rest/compare/SnomedMapTypeReferenceSetCompareTest.java", "diffHunk": "@@ -88,15 +89,15 @@ public void compareEqualSimpleMapTypeReferenceSets() {\n \t\tComponentURI baseURI = createURI(rf1Id);\n \t\tComponentURI compareURI = createURI(rf2Id);\n \t\t\n-\t\tConceptMapCompareResult result = CodeSystemRequests.prepareConceptMapCompare(baseURI, compareURI)\n+\t\tConceptMapCompareResult result = CodeSystemRequests.prepareConceptMapCompare(baseURI, compareURI, ConceptMapCompareConfigurationProperties.DEFAULT_SELECTED_PROPERTIES)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c184d5ce1264ef16ed2168d2feb7348eb45ae00"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "178aac210ccd9d2b53ab5fdae2f391045e758f64", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/178aac210ccd9d2b53ab5fdae2f391045e758f64", "committedDate": "2020-10-28T14:16:57Z", "message": "SO-4345: change hashCode logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9166f7983ebe9d63e96d40f185d1010970d337b1", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/9166f7983ebe9d63e96d40f185d1010970d337b1", "committedDate": "2020-10-28T14:18:44Z", "message": "SO-4345: add notempty annotation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2920d67e4b55914eef5255633ed5331ef9c36228", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/2920d67e4b55914eef5255633ed5331ef9c36228", "committedDate": "2020-10-28T14:23:09Z", "message": "SO-4345: add notempty annotation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c53eba8f1950333bdc6dc23ac783a05c965d203", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/2c53eba8f1950333bdc6dc23ac783a05c965d203", "committedDate": "2020-10-28T14:59:01Z", "message": "SO-4345: add limited members and total numbers to result"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "513d1abf18c1c2e86d567246d2b8a3bc143904be", "author": {"user": {"login": "molnarlaura", "name": "Laura Alexandra Moln\u00e1r"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/513d1abf18c1c2e86d567246d2b8a3bc143904be", "committedDate": "2020-10-28T15:44:50Z", "message": "SO-4345: use default compare config if there is any set"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36f71c741acd1f858abdc4ca67c0bb326ccac517", "author": {"user": {"login": "cmark", "name": "Mark Czotter"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/36f71c741acd1f858abdc4ca67c0bb326ccac517", "committedDate": "2020-10-28T15:46:29Z", "message": "Merge remote-tracking branch 'origin/7.x' into improvement/SO-4345-configure-map-compare-props"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aea24e0a46dc3dc263fc59982f497f3e96b286ad", "author": {"user": {"login": "cmark", "name": "Mark Czotter"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/aea24e0a46dc3dc263fc59982f497f3e96b286ad", "committedDate": "2020-10-28T16:56:33Z", "message": "SO-4345: handle limit properly on server-side ConceptMap compare\n\nReturn a single list of result items instead of kind specific mapping\nchange lists."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d54a1baf8c2dc8bb972753018693d0dc015299d5", "author": {"user": {"login": "cmark", "name": "Mark Czotter"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/d54a1baf8c2dc8bb972753018693d0dc015299d5", "committedDate": "2020-10-28T19:48:53Z", "message": "SO-4345: fix compile errors...\n\n...in ConceptMapCompareSnomedMapTypeReferenceSetTest"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5MDY2MjQw", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#pullrequestreview-519066240", "createdAt": "2020-10-28T20:41:49Z", "commit": {"oid": "d54a1baf8c2dc8bb972753018693d0dc015299d5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4912, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}