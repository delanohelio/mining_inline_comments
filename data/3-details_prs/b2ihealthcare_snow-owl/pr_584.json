{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyNDM5MDY5", "number": 584, "title": "SO-4100: Extra concept non-current member fix", "bodyText": "When inactivating-reactivating and inactivating the concept again, there will be only a single inactivation reason member on each component.\nWhen reactivating the concept its descriptions with \"Concept non-current\" indicator will be deleted.", "createdAt": "2020-06-10T13:00:39Z", "url": "https://github.com/b2ihealthcare/snow-owl/pull/584", "merged": true, "mergeCommit": {"oid": "9d4fc8e9905e1df04e53d5140e7b63a315b06e7a"}, "closed": true, "closedAt": "2020-06-17T10:14:47Z", "author": {"login": "adeakgabi"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcp43szAH2gAyNDMyNDM5MDY5OjNmODlkYWZjYzg3MWZjZDc1ZjRjYTUzMzA1MzNjYWRkYjBlYTkwNzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsHDkZgFqTQzMjI1NjQ1Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3f89dafcc871fcd75f4ca5330533caddb0ea9077", "author": {"user": {"login": "adeakgabi", "name": "Gabriella Deak"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/3f89dafcc871fcd75f4ca5330533caddb0ea9077", "committedDate": "2020-06-10T12:32:30Z", "message": "SO-4100:Check if description already exists...\n\n...in Description Inactivation Indicator refset to not create duplicate\nmembers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61003c8552676e12fe5690cdd31186ee27c83b4b", "author": {"user": {"login": "adeakgabi", "name": "Gabriella Deak"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/61003c8552676e12fe5690cdd31186ee27c83b4b", "committedDate": "2020-06-10T12:40:49Z", "message": "Merge remote-tracking branch 'origin/7.x' into SO-4100-extra-concept-non-current-member-fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NDI4NTE4", "url": "https://github.com/b2ihealthcare/snow-owl/pull/584#pullrequestreview-428428518", "createdAt": "2020-06-10T21:06:49Z", "commit": {"oid": "61003c8552676e12fe5690cdd31186ee27c83b4b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQyMTowNjo0OVrOGiGWEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQyMTowNjo0OVrOGiGWEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQwODcyMQ==", "bodyText": "Do we actually need all indicators when there is an inactivated Concept? This can be really costly.\nI suggest limiting the number of loaded indicators to the actually used set (descriptions of inactivated concepts and only active inactivation members).\nAlso, any duplicates that are present in the dataset will be omitted by the code, since this HashMap can only reference a single member by the referenced component, while a referenced component can have more than one indicator (active, inactive, potential duplicates).", "url": "https://github.com/b2ihealthcare/snow-owl/pull/584#discussion_r438408721", "createdAt": "2020-06-10T21:06:49Z", "author": {"login": "cmark"}, "path": "snomed/com.b2international.snowowl.snomed.datastore/src/com/b2international/snowowl/snomed/datastore/index/change/ComponentInactivationChangeProcessor.java", "diffHunk": "@@ -83,6 +84,14 @@ public void process(StagingArea staging, RevisionSearcher searcher) throws IOExc\n \t\t\t\tchangedMembersByReferencedComponentId.put(((SnomedRefSetMemberIndexEntry) diff.newRevision).getReferencedComponentId(), diff);\n \t\t\t});\n \t\t\t\n+\t\t\tMap<String, SnomedRefSetMemberIndexEntry> refSetMembers = Maps.newHashMap();\n+\t\t\tfor (Hits<SnomedRefSetMemberIndexEntry> hits : searcher.scroll(Query.select(SnomedRefSetMemberIndexEntry.class) ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61003c8552676e12fe5690cdd31186ee27c83b4b"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d384670da16537549609426788b0b0db3b60da5", "author": {"user": {"login": "adeakgabi", "name": "Gabriella Deak"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/5d384670da16537549609426788b0b0db3b60da5", "committedDate": "2020-06-11T12:20:02Z", "message": "SO-4100: Use multimap for refSetMembers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "727ba5b062beb26b381e090a33545e0f1935c508", "author": {"user": {"login": "adeakgabi", "name": "Gabriella Deak"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/727ba5b062beb26b381e090a33545e0f1935c508", "committedDate": "2020-06-11T12:29:12Z", "message": "SO-4100: Filter for active members and members...\n\n...with Concept non-current inactivation indicator"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNTE0MDUy", "url": "https://github.com/b2ihealthcare/snow-owl/pull/584#pullrequestreview-430514052", "createdAt": "2020-06-15T10:25:20Z", "commit": {"oid": "727ba5b062beb26b381e090a33545e0f1935c508"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMDoyNToyMFrOGjsRnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMDoyNToyMFrOGjsRnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDA3ODc0OQ==", "bodyText": "Can we restrict the number loaded members to just the necessary set of members?\nHow about restricting to the actually read values, descriptions in the transaction?", "url": "https://github.com/b2ihealthcare/snow-owl/pull/584#discussion_r440078749", "createdAt": "2020-06-15T10:25:20Z", "author": {"login": "cmark"}, "path": "snomed/com.b2international.snowowl.snomed.datastore/src/com/b2international/snowowl/snomed/datastore/index/change/ComponentInactivationChangeProcessor.java", "diffHunk": "@@ -83,6 +85,21 @@ public void process(StagingArea staging, RevisionSearcher searcher) throws IOExc\n \t\t\t\tchangedMembersByReferencedComponentId.put(((SnomedRefSetMemberIndexEntry) diff.newRevision).getReferencedComponentId(), diff);\n \t\t\t});\n \t\t\t\n+\t\t\tfinal ImmutableSet<String> valueIds = ImmutableSet.of(Concepts.CONCEPT_NON_CURRENT);\n+\t\t\tfinal Expression expression = Expressions.builder()\n+\t\t\t\t\t.filter(SnomedRefSetMemberIndexEntry.Expressions.referenceSetId(Concepts.REFSET_DESCRIPTION_INACTIVITY_INDICATOR))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "727ba5b062beb26b381e090a33545e0f1935c508"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27b145ec4ab29b6c850cc6068fefe600907e06a4", "author": {"user": {"login": "adeakgabi", "name": "Gabriella Deak"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/27b145ec4ab29b6c850cc6068fefe600907e06a4", "committedDate": "2020-06-15T13:02:39Z", "message": "SO-4100: Add filter for description type...\n\n...referenced component"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db5b9e282224603eef012d849cf5c90ff00cbd42", "author": {"user": {"login": "adeakgabi", "name": "Gabriella Deak"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/db5b9e282224603eef012d849cf5c90ff00cbd42", "committedDate": "2020-06-15T13:08:12Z", "message": "SO-4100: Remove filter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "328a632e15e3e88500c3b6d82c2b8b414f7c244d", "author": {"user": {"login": "adeakgabi", "name": "Gabriella Deak"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/328a632e15e3e88500c3b6d82c2b8b414f7c244d", "committedDate": "2020-06-16T07:36:04Z", "message": "SO-4100: Add filter by referencedComponentIds"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29b3d2c4ffc47fa9687a8265b49299269003c5ed", "author": {"user": {"login": "cmark", "name": "Mark Czotter"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/29b3d2c4ffc47fa9687a8265b49299269003c5ed", "committedDate": "2020-06-16T13:39:34Z", "message": "SO-4100: extract inactivation/reactivation test cases to another class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0eef8c95397f2feb015a24da10d25e9a47ec542b", "author": {"user": {"login": "cmark", "name": "Mark Czotter"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/0eef8c95397f2feb015a24da10d25e9a47ec542b", "committedDate": "2020-06-16T14:04:28Z", "message": "SO-4100: add description status/indicator checks to inactivation tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fdbe58bee81b99bcf6c7a26bad5812c8560bd217", "author": {"user": {"login": "cmark", "name": "Mark Czotter"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/fdbe58bee81b99bcf6c7a26bad5812c8560bd217", "committedDate": "2020-06-16T17:04:39Z", "message": "SO-4100 #resolve"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMjUwNjAw", "url": "https://github.com/b2ihealthcare/snow-owl/pull/584#pullrequestreview-432250600", "createdAt": "2020-06-17T10:04:11Z", "commit": {"oid": "fdbe58bee81b99bcf6c7a26bad5812c8560bd217"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMjU2NDU2", "url": "https://github.com/b2ihealthcare/snow-owl/pull/584#pullrequestreview-432256456", "createdAt": "2020-06-17T10:11:59Z", "commit": {"oid": "fdbe58bee81b99bcf6c7a26bad5812c8560bd217"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4997, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}