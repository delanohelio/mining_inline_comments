{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4NjI4Mjkz", "number": 723, "title": "Fix default doc sorting issues", "bodyText": "This PR fixes the issues after migrated to _doc sorting in commit 44d4218\n\nRevert some of the logic to still use _id for searchAfter based paging if no ID field (the new ID annotation) is defined for the mapping.\nUse _doc as a tiebreaker for localScroll and for and in case of explicit scroll API use.", "createdAt": "2020-11-27T13:58:09Z", "url": "https://github.com/b2ihealthcare/snow-owl/pull/723", "merged": true, "mergeCommit": {"oid": "e129d204edd8789181738a563a221434c1154a90"}, "closed": true, "closedAt": "2020-11-27T15:03:53Z", "author": {"login": "cmark"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdgn7KkAH2gAyNTI4NjI4MjkzOjIyNDliM2MwZWQ5ZDNjMTQ1MjA2MTM2ODE3MTllMDEwZDZhNDljM2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdgo7LPgH2gAyNTI4NjI4MjkzOjMxYThkN2UzNTkzY2Q3ZTVkNDZjNGQ1MmEyMWY1NDQ3ZWYyNGY0MTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2249b3c0ed9d3c14520613681719e010d6a49c3b", "author": {"user": {"login": "cmark", "name": "Mark Czotter"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/2249b3c0ed9d3c14520613681719e010d6a49c3b", "committedDate": "2020-11-27T13:53:44Z", "message": "[index] fix _doc sorting issues\n\nUsing _doc is only allowed when using ES scroll paging API.\nFor searchAfter based paging and standard searches we will fall back to\nthe current ID field configured in the mapping or if none found to the\n_id which is deprecated in ES 7.x and will be removed from Snow Owl as\nsoon as Elasticsearch removes it (probably in 8.0)."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbd24973e04eb3a84fe521511fc97bba6c4c39cb", "author": {"user": {"login": "cmark", "name": "Mark Czotter"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/bbd24973e04eb3a84fe521511fc97bba6c4c39cb", "committedDate": "2020-11-27T13:55:02Z", "message": "[core] where possible use the ID annotation instead of relying to _id"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "115153c77c045a897e204c5e6033583c20987774", "author": {"user": {"login": "cmark", "name": "Mark Czotter"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/115153c77c045a897e204c5e6033583c20987774", "committedDate": "2020-11-27T14:16:12Z", "message": "[index] add ID annotation to all documents that can support it\n\nReport any other mapping that does not define its own ID field."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwMDMwMDkw", "url": "https://github.com/b2ihealthcare/snow-owl/pull/723#pullrequestreview-540030090", "createdAt": "2020-11-27T14:44:47Z", "commit": {"oid": "115153c77c045a897e204c5e6033583c20987774"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNDo0NDo0OFrOH7AyEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNDo0NDo0OFrOH7AyEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTY0MDg0OQ==", "bodyText": "Please add the fall-through marker back; it is hard to spot the absence of a break statement, sometimes even with the comment present \ud83d\ude04\ud83d\udc53", "url": "https://github.com/b2ihealthcare/snow-owl/pull/723#discussion_r531640849", "createdAt": "2020-11-27T14:44:48Z", "author": {"login": "apeteri"}, "path": "commons/com.b2international.index/src/com/b2international/index/es/EsDocumentSearcher.java", "diffHunk": "@@ -397,8 +396,14 @@ private void addSort(DocumentMapping mapping, SearchSourceBuilder reqSource, Sor\n \t\t\t\t\t// XXX: default order for scores is *descending*\n \t\t\t\t\treqSource.sort(SortBuilders.scoreSort().order(sortOrder)); \n \t\t\t\t\tbreak;\n-\t\t\t\tcase DocumentMapping._DOC: //$FALL-THROUGH$\n-\t\t\t\t\tfield = DocumentMapping._DOC;\n+\t\t\t\tcase \"_default\":", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "115153c77c045a897e204c5e6033583c20987774"}, "originalPosition": 54}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31a8d7e3593cd7e5d46c4d52a21f5447ef24f412", "author": {"user": {"login": "cmark", "name": "Mark Czotter"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/31a8d7e3593cd7e5d46c4d52a21f5447ef24f412", "committedDate": "2020-11-27T15:03:39Z", "message": "[index] add back //$FALL-THROUGH$ marker"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4851, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}