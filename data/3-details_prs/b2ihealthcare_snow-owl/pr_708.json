{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2NzMwMjI2", "number": 708, "title": "SO-4285 Validate request changes", "bodyText": "", "createdAt": "2020-11-06T13:02:43Z", "url": "https://github.com/b2ihealthcare/snow-owl/pull/708", "merged": true, "mergeCommit": {"oid": "02965f258a90fd3d37e92d8312e8fe8673c4f8ca"}, "closed": true, "closedAt": "2020-11-18T18:52:46Z", "author": {"login": "AAAlinaaa"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZ2lJBgH2gAyNTE2NzMwMjI2OmY4M2ZmMjYwNmJiZWJlODEwYTljZjJlNmFmMzMzZDJlMWE0ODE5NGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddyzmNgFqTUzMzc3NDM1OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f83ff2606bbebe810a9cf2e6af333d2e1a48194f", "author": {"user": {"login": "AAAlinaaa", "name": null}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/f83ff2606bbebe810a9cf2e6af333d2e1a48194f", "committedDate": "2020-11-06T13:00:47Z", "message": "SO-4285: Add componentURI to validation issues during validate requests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b5eea9882f1b0d0b2250c5f5b3fa07661d97d8d", "author": {"user": {"login": "AAAlinaaa", "name": null}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/4b5eea9882f1b0d0b2250c5f5b3fa07661d97d8d", "committedDate": "2020-11-06T13:01:34Z", "message": "SO-4285: Add new validation configuration constants"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2NjE1Mzg3", "url": "https://github.com/b2ihealthcare/snow-owl/pull/708#pullrequestreview-526615387", "createdAt": "2020-11-09T20:09:43Z", "commit": {"oid": "4b5eea9882f1b0d0b2250c5f5b3fa07661d97d8d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQyMDowOTo0M1rOHv_wag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQyMDoxMzoxMVrOHv_4LQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA4OTcwNg==", "bodyText": "Why do you need both?", "url": "https://github.com/b2ihealthcare/snow-owl/pull/708#discussion_r520089706", "createdAt": "2020-11-09T20:09:43Z", "author": {"login": "cmark"}, "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/internal/validation/ValidationConfiguration.java", "diffHunk": "@@ -29,6 +29,8 @@\n \tpublic static final String IS_UNPUBLISHED_ONLY = \"isUnpublishedOnly\";\n \tpublic static final String USE_FSN = \"useFsn\";\n \tpublic static final String LOCALES = \"extendedLocales\";\n+\tpublic static final String CODE_SYSTEMS = \"codeSystems\";\n+\tpublic static final String CODE_SYSTEM = \"codeSystem\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b5eea9882f1b0d0b2250c5f5b3fa07661d97d8d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA5MDUzNw==", "bodyText": "Let's have a factory method on ComponentURI that receives a ComponentIdentifier, so it's easier to convert one from the other. Add it to the other PR #707", "url": "https://github.com/b2ihealthcare/snow-owl/pull/708#discussion_r520090537", "createdAt": "2020-11-09T20:11:09Z", "author": {"login": "cmark"}, "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/validation/ValidateRequest.java", "diffHunk": "@@ -159,34 +155,29 @@ private ValidationResult doValidate(BranchContext context, Writer index) throws\n \t\t\t\t\t\tfinal Collection<ComponentIdentifier> ruleWhiteListEntries = whiteListedEntries.removeAll(ruleId);\n \t\t\t\t\t\tfinal String toolingId = rules.stream().filter(rule -> ruleId.equals(rule.getId())).findFirst().get().getToolingId();\n \t\t\t\t\t\tfor (ValidationIssueDetails issueDetails : ruleIssues.issueDetails) {\n+\t\t\t\t\t\t\tfinal ValidationIssue validationIssue;\n \t\t\t\t\t\t\tComponentIdentifier componentIdentifier = issueDetails.affectedComponentId;\n \t\t\t\t\t\t\t\n \t\t\t\t\t\t\tif (!existingIsssuesByComponentIdentifier.containsKey(componentIdentifier)) {\n-\t\t\t\t\t\t\t\tfinal ValidationIssue validationIssue = new ValidationIssue(\n+\t\t\t\t\t\t\t\tvalidationIssue = new ValidationIssue(\n \t\t\t\t\t\t\t\t\t\tUUID.randomUUID().toString(),\n \t\t\t\t\t\t\t\t\t\truleId,\n-\t\t\t\t\t\t\t\t\t\tbranchPath,\n-\t\t\t\t\t\t\t\t\t\tcomponentIdentifier,\n+\t\t\t\t\t\t\t\t\t\tComponentURI.of(codeSystemURI, componentIdentifier.getTerminologyComponentId(), componentIdentifier.getComponentId()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b5eea9882f1b0d0b2250c5f5b3fa07661d97d8d"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA5MTY5Mw==", "bodyText": "This should be added to the core tests, it should not part of the SNOMED CT Validation Rule module.", "url": "https://github.com/b2ihealthcare/snow-owl/pull/708#discussion_r520091693", "createdAt": "2020-11-09T20:13:11Z", "author": {"login": "cmark"}, "path": "snomed/com.b2international.snowowl.validation.snomed/src/test/java/com/b2international/snowowl/validation/snomed/GenericValidationRuleTest.java", "diffHunk": "@@ -59,6 +60,24 @@\n @RunWith(Parameterized.class)\n public class GenericValidationRuleTest extends BaseGenericValidationRuleTest {\n \t\n+\t@Test\n+\tpublic void codeSystemURITest() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b5eea9882f1b0d0b2250c5f5b3fa07661d97d8d"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "122ded67cd55f5bf1783c5d565a1d012d8d79a23", "author": {"user": {"login": "AAAlinaaa", "name": null}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/122ded67cd55f5bf1783c5d565a1d012d8d79a23", "committedDate": "2020-11-13T09:26:27Z", "message": "SO-4285: Remove no longer needed validation configuration constants"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20ba6981154e837cb5be6d3a72c9ab4509c0aa6b", "author": {"user": {"login": "AAAlinaaa", "name": null}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/20ba6981154e837cb5be6d3a72c9ab4509c0aa6b", "committedDate": "2020-11-13T09:58:02Z", "message": "SO-4285: Rename constructor parameter to indicate it accepts a URI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "033ccf30fe1d17324bcd33ed3f8346b2d6fb8c11", "author": {"user": {"login": "AAAlinaaa", "name": null}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/033ccf30fe1d17324bcd33ed3f8346b2d6fb8c11", "committedDate": "2020-11-13T10:15:39Z", "message": "SO-4285: Add further componentURI parse tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f049feb5e56d2d9edd241f92321e1fd0bc8699d", "author": {"user": {"login": "AAAlinaaa", "name": null}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/1f049feb5e56d2d9edd241f92321e1fd0bc8699d", "committedDate": "2020-11-13T10:56:25Z", "message": "SO-4285: Add id argument check, id argument test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5130a425b686b4b6d1064e9af2d274f6f003591", "author": {"user": {"login": "AAAlinaaa", "name": null}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/d5130a425b686b4b6d1064e9af2d274f6f003591", "committedDate": "2020-11-13T12:49:34Z", "message": "SO-4285: Add ComponentURI factory method that accepts ...\n\n... ComponentIdentifiers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e3debccd0452391febf4302df92f7ee640832f5", "author": {"user": {"login": "AAAlinaaa", "name": null}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/9e3debccd0452391febf4302df92f7ee640832f5", "committedDate": "2020-11-13T12:50:41Z", "message": "Merge branch 'issue/SO-4285-component_uri_constructor_changes' into issue/SO-4285-validate_request_changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce6a6f70d78388206741dfaa0b2ba9e1672c31fe", "author": {"user": {"login": "AAAlinaaa", "name": null}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/ce6a6f70d78388206741dfaa0b2ba9e1672c31fe", "committedDate": "2020-11-13T12:59:22Z", "message": "SO-4285: Use new ComponentURI constructor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6cccbacd3e9df1271a86c8dac338629731e11a53", "author": {"user": {"login": "AAAlinaaa", "name": null}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/6cccbacd3e9df1271a86c8dac338629731e11a53", "committedDate": "2020-11-13T17:19:11Z", "message": "SO-4285: Commit progress on switching from branchPath to CodeSystemURI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19cbba04cc75828bc7eeabbdb840001465ce1035", "author": {"user": {"login": "AAAlinaaa", "name": null}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/19cbba04cc75828bc7eeabbdb840001465ce1035", "committedDate": "2020-11-16T00:04:26Z", "message": "SO-4285: Use CodeSystemURIs in handling issue delete requests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bb1116d139ba7789eb294d72c817e07cf0fb4ca", "author": {"user": {"login": "AAAlinaaa", "name": null}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/9bb1116d139ba7789eb294d72c817e07cf0fb4ca", "committedDate": "2020-11-16T11:02:25Z", "message": "SO-4285: Base unique validation job id creation on code system URIs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "588abbacf289e839b021e64c4ba24abc1ee53354", "author": {"user": {"login": "AAAlinaaa", "name": null}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/588abbacf289e839b021e64c4ba24abc1ee53354", "committedDate": "2020-11-16T11:03:18Z", "message": "SO-4285: Update validations REST API to use CodeSystemURIs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyMzIzNzA2", "url": "https://github.com/b2ihealthcare/snow-owl/pull/708#pullrequestreview-532323706", "createdAt": "2020-11-17T12:44:46Z", "commit": {"oid": "588abbacf289e839b021e64c4ba24abc1ee53354"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxMjo0NDo0NlrOH0zI2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNjozOToxN1rOH0-WQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTEyNTg1MQ==", "bodyText": "No need to wrap into CodeSystemURI here.", "url": "https://github.com/b2ihealthcare/snow-owl/pull/708#discussion_r525125851", "createdAt": "2020-11-17T12:44:46Z", "author": {"login": "cmark"}, "path": "core/com.b2international.snowowl.core.rest/src/com/b2international/snowowl/core/rest/validation/RepositoryValidationRestService.java", "diffHunk": "@@ -109,16 +110,16 @@ public RepositoryValidationRestService(String repositoryId) {\n \t\t\t@RequestBody \n \t\t\tfinal ValidationRestInput validationInput) {\n \n-\t\tfinal String uniqueJobId = ValidationRequests.createUniqueValidationJobKey(repositoryId, validationInput.getBranchPath());\n+\t\tfinal String uniqueJobId = ValidationRequests.createUniqueValidationJobKey(validationInput.getCodeSystemURI());\n \t\t\n \t\tfinal String jobId = ValidationRequests\n \t\t\t\t.prepareValidate()\n \t\t\t\t.setRuleParameters(ImmutableMap.of(\n \t\t\t\t\tValidationConfiguration.IS_UNPUBLISHED_ONLY, validationInput.isUnpublishedOnly()\n \t\t\t\t))\n \t\t\t\t.setRuleIds(validationInput.getRuleIds())\n-\t\t\t\t.build(repositoryId, validationInput.getBranchPath())\n-\t\t\t\t.runAsJobWithRestart(uniqueJobId, String.format(\"Validating branch '%s'\", validationInput.getBranchPath()))\n+\t\t\t\t.build(new CodeSystemURI(validationInput.getCodeSystemURI()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "588abbacf289e839b021e64c4ba24abc1ee53354"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTEyNzM1MA==", "bodyText": "This changes the API in a non-backward compatible manner, please keep the branchPath argument and make it deprecated.\nIntroduce a new resource argument instead of the codeSystemURI and mark it as a replacement of the branchPath.\nRead order should be, resource first, if that is empty then fall back to branchPath.", "url": "https://github.com/b2ihealthcare/snow-owl/pull/708#discussion_r525127350", "createdAt": "2020-11-17T12:47:28Z", "author": {"login": "cmark"}, "path": "core/com.b2international.snowowl.core.rest/src/com/b2international/snowowl/core/rest/validation/ValidationRestInput.java", "diffHunk": "@@ -25,19 +25,19 @@\n public class ValidationRestInput {\n \n \t@NotEmpty\n-\tprivate String branchPath;\n+\tprivate String codeSystemURI;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "588abbacf289e839b021e64c4ba24abc1ee53354"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMwOTUwNA==", "bodyText": "Swap left and right of the equals check.", "url": "https://github.com/b2ihealthcare/snow-owl/pull/708#discussion_r525309504", "createdAt": "2020-11-17T16:39:17Z", "author": {"login": "cmark"}, "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/uri/ComponentURI.java", "diffHunk": "@@ -104,18 +104,29 @@ public final ComponentIdentifier toComponentIdentifier() {\n \t\treturn ComponentIdentifier.of(terminologyComponentId(), identifier());\n \t}\n \n-\tprivate ComponentURI(CodeSystemURI codeSystem, short terminologyComponentId, String identifier) {\n-\t\tcheckNotNull(codeSystem, \"Codesystem argument should not be null.\");\n+\tprivate ComponentURI(CodeSystemURI codeSystemURI, short terminologyComponentId, String identifier) {\n+\t\tcheckNotNull(codeSystemURI, \"Codesystem argument should not be null.\");\n \t\tcheckArgument(terminologyComponentId >= TerminologyRegistry.UNSPECIFIED_NUMBER_SHORT,\n \t\t\t\t\"Terminology component id should be either unspecified (-1) or greater than zero. Got: '%s'.\", terminologyComponentId);\n-\t\tthis.codeSystemUri = codeSystem;\n+\t\tboolean isUnspecified = codeSystemURI.getCodeSystem().equals(TerminologyRegistry.UNSPECIFIED) ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "588abbacf289e839b021e64c4ba24abc1ee53354"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64433ea7e92278ce7d268a0c2b9687e261e10d3d", "author": {"user": {"login": "cmark", "name": "Mark Czotter"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/64433ea7e92278ce7d268a0c2b9687e261e10d3d", "committedDate": "2020-11-18T15:12:57Z", "message": "Merge branch '7.x' into issue/SO-4285-validate_request_changes\n\nConflicts:\n\tcore/com.b2international.snowowl.core.tests/src/com/b2international/snowowl/core/uri/ComponentURITest.java\n\tcore/com.b2international.snowowl.core/src/com/b2international/snowowl/core/uri/ComponentURI.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffb3cf210a94ba52ac025a68d63737916d3aebeb", "author": {"user": {"login": "cmark", "name": "Mark Czotter"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/ffb3cf210a94ba52ac025a68d63737916d3aebeb", "committedDate": "2020-11-18T15:50:41Z", "message": "SO-4285: make validation REST API backward compatible"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "446bb13395fad86a4892285252349f8166c81e33", "author": {"user": {"login": "cmark", "name": "Mark Czotter"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/446bb13395fad86a4892285252349f8166c81e33", "committedDate": "2020-11-18T17:25:30Z", "message": "SO-4285: rename codeSystemURI to resourceURI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b02fb2553c24651d00d76868a5db47e0c2542270", "author": {"user": {"login": "cmark", "name": "Mark Czotter"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/b02fb2553c24651d00d76868a5db47e0c2542270", "committedDate": "2020-11-18T18:22:51Z", "message": "SO-4285: fix failed SnomedQueryValidationRuleEvaluatorTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92478e7be4342ed0bfa63878c586117de82b540f", "author": {"user": {"login": "cmark", "name": "Mark Czotter"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/92478e7be4342ed0bfa63878c586117de82b540f", "committedDate": "2020-11-18T18:46:00Z", "message": "SO-4285: fix backward compatibility issues in ValidationIssue\n\nRename componentURI to affectedComponentURI.\nFix a few naming issues.\nReduce old ctor visibility."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzNzc0MzU5", "url": "https://github.com/b2ihealthcare/snow-owl/pull/708#pullrequestreview-533774359", "createdAt": "2020-11-18T18:52:39Z", "commit": {"oid": "92478e7be4342ed0bfa63878c586117de82b540f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4842, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}