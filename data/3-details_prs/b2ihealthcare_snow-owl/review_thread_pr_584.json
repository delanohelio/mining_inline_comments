{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyNDM5MDY5", "number": 584, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQyMTowNjo0OVrOEEdffg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMDoyNToyMFrOEFeqeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMTEyOTU4OnYy", "diffSide": "RIGHT", "path": "snomed/com.b2international.snowowl.snomed.datastore/src/com/b2international/snowowl/snomed/datastore/index/change/ComponentInactivationChangeProcessor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQyMTowNjo0OVrOGiGWEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQyMTowNjo0OVrOGiGWEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQwODcyMQ==", "bodyText": "Do we actually need all indicators when there is an inactivated Concept? This can be really costly.\nI suggest limiting the number of loaded indicators to the actually used set (descriptions of inactivated concepts and only active inactivation members).\nAlso, any duplicates that are present in the dataset will be omitted by the code, since this HashMap can only reference a single member by the referenced component, while a referenced component can have more than one indicator (active, inactive, potential duplicates).", "url": "https://github.com/b2ihealthcare/snow-owl/pull/584#discussion_r438408721", "createdAt": "2020-06-10T21:06:49Z", "author": {"login": "cmark"}, "path": "snomed/com.b2international.snowowl.snomed.datastore/src/com/b2international/snowowl/snomed/datastore/index/change/ComponentInactivationChangeProcessor.java", "diffHunk": "@@ -83,6 +84,14 @@ public void process(StagingArea staging, RevisionSearcher searcher) throws IOExc\n \t\t\t\tchangedMembersByReferencedComponentId.put(((SnomedRefSetMemberIndexEntry) diff.newRevision).getReferencedComponentId(), diff);\n \t\t\t});\n \t\t\t\n+\t\t\tMap<String, SnomedRefSetMemberIndexEntry> refSetMembers = Maps.newHashMap();\n+\t\t\tfor (Hits<SnomedRefSetMemberIndexEntry> hits : searcher.scroll(Query.select(SnomedRefSetMemberIndexEntry.class) ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61003c8552676e12fe5690cdd31186ee27c83b4b"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0MTgwNzMwOnYy", "diffSide": "RIGHT", "path": "snomed/com.b2international.snowowl.snomed.datastore/src/com/b2international/snowowl/snomed/datastore/index/change/ComponentInactivationChangeProcessor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMDoyNToyMFrOGjsRnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMDoyNToyMFrOGjsRnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDA3ODc0OQ==", "bodyText": "Can we restrict the number loaded members to just the necessary set of members?\nHow about restricting to the actually read values, descriptions in the transaction?", "url": "https://github.com/b2ihealthcare/snow-owl/pull/584#discussion_r440078749", "createdAt": "2020-06-15T10:25:20Z", "author": {"login": "cmark"}, "path": "snomed/com.b2international.snowowl.snomed.datastore/src/com/b2international/snowowl/snomed/datastore/index/change/ComponentInactivationChangeProcessor.java", "diffHunk": "@@ -83,6 +85,21 @@ public void process(StagingArea staging, RevisionSearcher searcher) throws IOExc\n \t\t\t\tchangedMembersByReferencedComponentId.put(((SnomedRefSetMemberIndexEntry) diff.newRevision).getReferencedComponentId(), diff);\n \t\t\t});\n \t\t\t\n+\t\t\tfinal ImmutableSet<String> valueIds = ImmutableSet.of(Concepts.CONCEPT_NON_CURRENT);\n+\t\t\tfinal Expression expression = Expressions.builder()\n+\t\t\t\t\t.filter(SnomedRefSetMemberIndexEntry.Expressions.referenceSetId(Concepts.REFSET_DESCRIPTION_INACTIVITY_INDICATOR))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "727ba5b062beb26b381e090a33545e0f1935c508"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1769, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}