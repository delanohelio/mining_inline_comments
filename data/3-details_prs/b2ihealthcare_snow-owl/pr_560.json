{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5NTMxODY4", "number": 560, "title": "Improve iconId calculation to handle new semantic types", "bodyText": "An identifier is extracted from the semantic tag of the concept's first active FSN (language code can not be taken into account as it is not stored on preferred descriptions).\nIf an icon with the concept's semantic tag identifier exists, it will be used as the concept's iconId\nOtherwise, a BFS search visits all direct and indirect ancestor concepts, and checks whether an icon exists for the visited concept ID. Only the \"closest\" of such concepts are taken into account, unless an ancestor is reachable by different IS A routes.\nIf multiple IDs remain to pick from, the smallest SCTID wins, using String comparison semantics, otherwise the only result is used, or if no appropriate ID could be found, the identifier of Snomed CT Concept.", "createdAt": "2020-05-18T14:16:10Z", "url": "https://github.com/b2ihealthcare/snow-owl/pull/560", "merged": true, "mergeCommit": {"oid": "c65605655a1c6db69d8baf2b34456f1de35a51f8"}, "closed": true, "closedAt": "2020-05-19T09:19:50Z", "author": {"login": "apeteri"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABciNsVhAH2gAyNDE5NTMxODY4OmIxZTAxZTE2MDVhOWUyOGZmOTYzNTFiMjE3NmE0ZmRjN2U5ZGYyMmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABciwqPGgFqTQxNDI0Mjc3Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b1e01e1605a9e28ff96351b2176a4fdc7e9df22d", "author": {"user": {"login": "apeteri", "name": "Andr\u00e1s P\u00e9teri"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/b1e01e1605a9e28ff96351b2176a4fdc7e9df22d", "committedDate": "2020-05-17T16:16:42Z", "message": "SO-4051: Update icon ID computation logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2131d62d203f295a6c62ac63b0a09ca576a65e1d", "author": {"user": {"login": "apeteri", "name": "Andr\u00e1s P\u00e9teri"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/2131d62d203f295a6c62ac63b0a09ca576a65e1d", "committedDate": "2020-05-17T16:24:06Z", "message": "SO-4051: Add placeholder icons for semantic tags that should be...\n\n...used as icon IDs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96f5d9d5ee1ccaedcd070afd6e4aee6f864b93bf", "author": {"user": {"login": "apeteri", "name": "Andr\u00e1s P\u00e9teri"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/96f5d9d5ee1ccaedcd070afd6e4aee6f864b93bf", "committedDate": "2020-05-18T13:51:35Z", "message": "SO-4051: Treat FSN changes as source relationship changes\n\nTheir direct and indirect ancestors need to be added to the taxonomy so\nthat the concept's iconId can be recalculated."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe5b83865827adfb8ea79d639832246072758b08", "author": {"user": {"login": "apeteri", "name": "Andr\u00e1s P\u00e9teri"}}, "url": "https://github.com/b2ihealthcare/snow-owl/commit/fe5b83865827adfb8ea79d639832246072758b08", "committedDate": "2020-05-18T14:07:43Z", "message": "SO-4051: Add icon placeholder for \"product\" semantic tag as well\n\nThis will help choosing the correct icon for drug-device combination\nproducts."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0MjQyNzc2", "url": "https://github.com/b2ihealthcare/snow-owl/pull/560#pullrequestreview-414242776", "createdAt": "2020-05-19T08:59:26Z", "commit": {"oid": "fe5b83865827adfb8ea79d639832246072758b08"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwODo1OToyNlrOGXWuMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwODo1OToyNlrOGXWuMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE0MjcwNg==", "bodyText": "\u26a0\ufe0f Missing active check?", "url": "https://github.com/b2ihealthcare/snow-owl/pull/560#discussion_r427142706", "createdAt": "2020-05-19T08:59:26Z", "author": {"login": "cmark"}, "path": "snomed/com.b2international.snowowl.snomed.datastore/src/com/b2international/snowowl/snomed/datastore/index/change/SnomedRepositoryPreCommitHook.java", "diffHunk": "@@ -152,6 +153,32 @@ protected void preUpdateDocuments(StagingArea staging, RevisionSearcher index) t\n \t\t\t}\n \t\t}\n \t\t\n+\t\tstaging.getRemovedObjects(SnomedDescriptionIndexEntry.class).forEach(removedDescription -> {\n+\t\t\tif (removedDescription.isFsn() && removedDescription.isActive()) {\n+\t\t\t\tstatedSourceIds.add(removedDescription.getConceptId());\n+\t\t\t\tinferredSourceIds.add(removedDescription.getConceptId());\n+\t\t\t}\n+\t\t});\n+\t\t\n+\t\tstaging.getChangedRevisions(SnomedDescriptionIndexEntry.class, Set.of(\n+\t\t\t\tSnomedDescriptionIndexEntry.Fields.ACTIVE,\n+\t\t\t\tSnomedDescriptionIndexEntry.Fields.TERM)).forEach(diff -> {\n+\n+\t\t\tSnomedDescriptionIndexEntry newRevision = (SnomedDescriptionIndexEntry) diff.newRevision;\n+\t\t\t\n+\t\t\tif (newRevision.isFsn()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe5b83865827adfb8ea79d639832246072758b08"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4979, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}