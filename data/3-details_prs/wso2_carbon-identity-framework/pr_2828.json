{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5Nzg0NDk5", "number": 2828, "title": "Add tenant-qualified URL support for endpoints", "bodyText": "Proposed changes in this pull request\nAdd a service for resolving URLs and tenant-qualifying endpoints.\nTenant-qualify SAML metadata.\nfixes: wso2/product-is#7900", "createdAt": "2020-03-17T11:39:47Z", "url": "https://github.com/wso2/carbon-identity-framework/pull/2828", "merged": true, "mergeCommit": {"oid": "c7948a546cc9450194a6d1ad8d1a22cbbf605efe"}, "closed": true, "closedAt": "2020-03-18T10:48:18Z", "author": {"login": "chamathns"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOgPr3gH2gAyMzg5Nzg0NDk5Ojg2ZTE1NmE2MGVmZmEyZDRmYmZjNWUxYTgxZjhiYTQ5MzEwNzEwOTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcO0riBAFqTM3NjczMTk0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "86e156a60effa2d4fbfc5e1a81f8ba4931071097", "author": {"user": {"login": "omindu", "name": "Omindu Rathnaweera"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/86e156a60effa2d4fbfc5e1a81f8ba4931071097", "committedDate": "2020-03-17T10:35:07Z", "message": "Support for tenant qualified URLs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c776eb463a7f1b586b893aa0630dd913f5be93b", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/8c776eb463a7f1b586b893aa0630dd913f5be93b", "committedDate": "2020-03-17T10:38:36Z", "message": "tenant-qualify SAML metadata and endpoints"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed31b860296306d089c9a6efdbc725329d59973b", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/ed31b860296306d089c9a6efdbc725329d59973b", "committedDate": "2020-03-17T10:40:14Z", "message": "add enableTenantQualifiedURLs configuration"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MDA3NzM1", "url": "https://github.com/wso2/carbon-identity-framework/pull/2828#pullrequestreview-376007735", "createdAt": "2020-03-17T12:58:15Z", "commit": {"oid": "ed31b860296306d089c9a6efdbc725329d59973b"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMjo1ODoxNVrOF3bCnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMzowNDo0MFrOF3bRag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY1OTAzNw==", "bodyText": "Shall we remove the new line? WDYT?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2828#discussion_r393659037", "createdAt": "2020-03-17T12:58:15Z", "author": {"login": "somindatommy"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultURLResolverService.java", "diffHunk": "@@ -0,0 +1,201 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.internal.IdentityCoreServiceComponent;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+\n+import java.net.MalformedURLException;\n+import java.net.SocketException;\n+import java.net.URL;\n+import java.util.Map;\n+\n+import static org.wso2.carbon.identity.core.util.IdentityTenantUtil.isTenantURLSupportEnabled;\n+\n+/**\n+ * URL Resolver service implementation.\n+ */\n+public class DefaultURLResolverService implements URLResolverService {\n+\n+    @Override\n+    public String resolveUrl(String url, boolean addProxyContextPath, boolean addWebContextRoot,\n+                             Map<String, Object> properties) throws URLResolverException {\n+\n+        try {\n+            URL parsedUrl = new URL(url);\n+            StringBuilder urlBuilder = new StringBuilder(parsedUrl.getProtocol())\n+                    .append(\"://\")\n+                    .append(parsedUrl.getHost())\n+                    .append(\":\")\n+                    .append(parsedUrl.getPort());\n+            appendContextToUri(parsedUrl.getPath(), addProxyContextPath, addWebContextRoot, urlBuilder,\n+                    false);\n+            return urlBuilder.toString();\n+\n+        } catch (MalformedURLException e) {\n+            throw new URLResolverException(\"Error while parsing the URL: \" + url, e);\n+        }\n+    }\n+\n+    @Override\n+    public String resolveUrlContext(String urlContext, boolean addProxyContextPath, boolean addWebContextRoot,\n+                                    boolean addTenantQueryParamInLegacyMode, Map<String, Object> properties)\n+            throws URLResolverException {\n+\n+        String hostName = getHostName();\n+        String mgtTransport = CarbonUtils.getManagementTransport();\n+        int mgtTransportPort = getMgtTransportPort(mgtTransport);\n+\n+        if (hostName.endsWith(\"/\")) {\n+            hostName = hostName.substring(0, hostName.length() - 1);\n+        }\n+        StringBuilder serverUrl = new StringBuilder(mgtTransport).append(\"://\").append(hostName.toLowerCase());\n+        // If it's well known HTTPS port, skip adding port.\n+        if (mgtTransportPort != IdentityCoreConstants.DEFAULT_HTTPS_PORT) {\n+            serverUrl.append(\":\").append(mgtTransportPort);\n+        }\n+\n+        appendContextToUri(urlContext, addProxyContextPath, addWebContextRoot, serverUrl, addTenantQueryParamInLegacyMode);\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed31b860296306d089c9a6efdbc725329d59973b"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY1OTYwNA==", "bodyText": "Can we make this contant variable?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2828#discussion_r393659604", "createdAt": "2020-03-17T12:59:09Z", "author": {"login": "somindatommy"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultURLResolverService.java", "diffHunk": "@@ -0,0 +1,201 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.internal.IdentityCoreServiceComponent;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+\n+import java.net.MalformedURLException;\n+import java.net.SocketException;\n+import java.net.URL;\n+import java.util.Map;\n+\n+import static org.wso2.carbon.identity.core.util.IdentityTenantUtil.isTenantURLSupportEnabled;\n+\n+/**\n+ * URL Resolver service implementation.\n+ */\n+public class DefaultURLResolverService implements URLResolverService {\n+\n+    @Override\n+    public String resolveUrl(String url, boolean addProxyContextPath, boolean addWebContextRoot,\n+                             Map<String, Object> properties) throws URLResolverException {\n+\n+        try {\n+            URL parsedUrl = new URL(url);\n+            StringBuilder urlBuilder = new StringBuilder(parsedUrl.getProtocol())\n+                    .append(\"://\")\n+                    .append(parsedUrl.getHost())\n+                    .append(\":\")\n+                    .append(parsedUrl.getPort());\n+            appendContextToUri(parsedUrl.getPath(), addProxyContextPath, addWebContextRoot, urlBuilder,\n+                    false);\n+            return urlBuilder.toString();\n+\n+        } catch (MalformedURLException e) {\n+            throw new URLResolverException(\"Error while parsing the URL: \" + url, e);\n+        }\n+    }\n+\n+    @Override\n+    public String resolveUrlContext(String urlContext, boolean addProxyContextPath, boolean addWebContextRoot,\n+                                    boolean addTenantQueryParamInLegacyMode, Map<String, Object> properties)\n+            throws URLResolverException {\n+\n+        String hostName = getHostName();\n+        String mgtTransport = CarbonUtils.getManagementTransport();\n+        int mgtTransportPort = getMgtTransportPort(mgtTransport);\n+\n+        if (hostName.endsWith(\"/\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed31b860296306d089c9a6efdbc725329d59973b"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY2MDc3NA==", "bodyText": "Shall we remove the extra new line?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2828#discussion_r393660774", "createdAt": "2020-03-17T13:01:13Z", "author": {"login": "somindatommy"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultURLResolverService.java", "diffHunk": "@@ -0,0 +1,201 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.internal.IdentityCoreServiceComponent;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+\n+import java.net.MalformedURLException;\n+import java.net.SocketException;\n+import java.net.URL;\n+import java.util.Map;\n+\n+import static org.wso2.carbon.identity.core.util.IdentityTenantUtil.isTenantURLSupportEnabled;\n+\n+/**\n+ * URL Resolver service implementation.\n+ */\n+public class DefaultURLResolverService implements URLResolverService {\n+\n+    @Override\n+    public String resolveUrl(String url, boolean addProxyContextPath, boolean addWebContextRoot,\n+                             Map<String, Object> properties) throws URLResolverException {\n+\n+        try {\n+            URL parsedUrl = new URL(url);\n+            StringBuilder urlBuilder = new StringBuilder(parsedUrl.getProtocol())\n+                    .append(\"://\")\n+                    .append(parsedUrl.getHost())\n+                    .append(\":\")\n+                    .append(parsedUrl.getPort());\n+            appendContextToUri(parsedUrl.getPath(), addProxyContextPath, addWebContextRoot, urlBuilder,\n+                    false);\n+            return urlBuilder.toString();\n+\n+        } catch (MalformedURLException e) {\n+            throw new URLResolverException(\"Error while parsing the URL: \" + url, e);\n+        }\n+    }\n+\n+    @Override\n+    public String resolveUrlContext(String urlContext, boolean addProxyContextPath, boolean addWebContextRoot,\n+                                    boolean addTenantQueryParamInLegacyMode, Map<String, Object> properties)\n+            throws URLResolverException {\n+\n+        String hostName = getHostName();\n+        String mgtTransport = CarbonUtils.getManagementTransport();\n+        int mgtTransportPort = getMgtTransportPort(mgtTransport);\n+\n+        if (hostName.endsWith(\"/\")) {\n+            hostName = hostName.substring(0, hostName.length() - 1);\n+        }\n+        StringBuilder serverUrl = new StringBuilder(mgtTransport).append(\"://\").append(hostName.toLowerCase());\n+        // If it's well known HTTPS port, skip adding port.\n+        if (mgtTransportPort != IdentityCoreConstants.DEFAULT_HTTPS_PORT) {\n+            serverUrl.append(\":\").append(mgtTransportPort);\n+        }\n+\n+        appendContextToUri(urlContext, addProxyContextPath, addWebContextRoot, serverUrl, addTenantQueryParamInLegacyMode);\n+\n+        return serverUrl.toString();\n+    }\n+\n+    private int getMgtTransportPort(String mgtTransport) {\n+\n+        AxisConfiguration axisConfiguration = IdentityCoreServiceComponent.getConfigurationContextService().\n+                getServerConfigContext().getAxisConfiguration();\n+        int mgtTransportPort = CarbonUtils.getTransportProxyPort(axisConfiguration, mgtTransport);\n+        if (mgtTransportPort <= 0) {\n+            mgtTransportPort = CarbonUtils.getTransportPort(axisConfiguration, mgtTransport);\n+        }\n+        return mgtTransportPort;\n+    }\n+\n+    private String getHostName() throws URLResolverException {\n+\n+        String hostName = ServerConfiguration.getInstance().getFirstProperty(IdentityCoreConstants.HOST_NAME);\n+        try {\n+            if (hostName == null) {\n+                hostName = NetworkUtils.getLocalHostname();\n+            }\n+        } catch (SocketException e) {\n+            throw new URLResolverException(\"Error while trying to read hostname.\", e);\n+        }\n+        return hostName;\n+    }\n+\n+    private void appendWebContextRoot(StringBuilder serverUrl) {\n+\n+        String webContextRoot = ServerConfiguration.getInstance().getFirstProperty(IdentityCoreConstants\n+                .WEB_CONTEXT_ROOT);\n+        // If webContextRoot is defined then append it.\n+        if (StringUtils.isNotBlank(webContextRoot)) {\n+            if (webContextRoot.trim().charAt(0) != '/') {\n+                serverUrl.append(\"/\").append(webContextRoot.trim());\n+            } else {\n+                serverUrl.append(webContextRoot.trim());\n+            }\n+        }\n+    }\n+\n+    private void appendProxyContextPath(StringBuilder serverUrl) {\n+\n+        String proxyContextPath = ServerConfiguration.getInstance().getFirstProperty(IdentityCoreConstants\n+                .PROXY_CONTEXT_PATH);\n+        // If ProxyContextPath is defined then append it.\n+        if (StringUtils.isNotBlank(proxyContextPath)) {\n+            if (proxyContextPath.trim().charAt(0) != '/') {\n+                serverUrl.append(\"/\").append(proxyContextPath.trim());\n+            } else {\n+                serverUrl.append(proxyContextPath.trim());\n+            }\n+        }\n+    }\n+\n+    private void appendTenantAsPathParam(StringBuilder serverUrl) {\n+\n+        String tenantDomain = IdentityTenantUtil.getTenantDomainFromContext();\n+        if (StringUtils.isBlank(tenantDomain)) {\n+            tenantDomain = PrivilegedCarbonContext.getThreadLocalCarbonContext().getTenantDomain();\n+        }\n+        if (tenantDomain != null) {\n+            if (serverUrl.toString().endsWith(\"/\")) {\n+                serverUrl.append(\"t/\").append(tenantDomain);\n+            } else {\n+                serverUrl.append(\"/t/\").append(tenantDomain);\n+            }\n+        }\n+    }\n+\n+    private void appendTenantAsQueryParam(StringBuilder serverUrl) {\n+\n+        String tenantDomain = IdentityTenantUtil.getTenantDomainFromContext();\n+        if (!StringUtils.isBlank(tenantDomain)) {\n+            if (!MultitenantConstants.SUPER_TENANT_DOMAIN_NAME.equalsIgnoreCase(tenantDomain)) {\n+                serverUrl.append(\"?\").append(MultitenantConstants.TENANT_DOMAIN).append(\"=\").append(tenantDomain);\n+            }\n+        }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed31b860296306d089c9a6efdbc725329d59973b"}, "originalPosition": 160}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY2MjE2MA==", "bodyText": "Shall we format the method comment?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2828#discussion_r393662160", "createdAt": "2020-03-17T13:03:33Z", "author": {"login": "somindatommy"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/URLResolverService.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import java.util.Map;\n+\n+/**\n+ * This interface is defined to resolve a provided URL or a URL context by adding a proxy context path, web context\n+ * root, and the tenant domain as specified. The URL would be resolved for the tenant domain by either adding the tenant\n+ * context to the path or adding a tenant parameter (legacy mode).\n+ */\n+public interface URLResolverService {\n+\n+    /**\n+     * This method is used to return a URL with a proxy context path, a web context root and the tenant domain (If", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed31b860296306d089c9a6efdbc725329d59973b"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY2MjgyNg==", "bodyText": "Shall we format other comments as well in other methods?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2828#discussion_r393662826", "createdAt": "2020-03-17T13:04:40Z", "author": {"login": "somindatommy"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/URLResolverService.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import java.util.Map;\n+\n+/**\n+ * This interface is defined to resolve a provided URL or a URL context by adding a proxy context path, web context\n+ * root, and the tenant domain as specified. The URL would be resolved for the tenant domain by either adding the tenant\n+ * context to the path or adding a tenant parameter (legacy mode).\n+ */\n+public interface URLResolverService {\n+\n+    /**\n+     * This method is used to return a URL with a proxy context path, a web context root and the tenant domain (If", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY2MjE2MA=="}, "originalCommit": {"oid": "ed31b860296306d089c9a6efdbc725329d59973b"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MjQ2NTA5", "url": "https://github.com/wso2/carbon-identity-framework/pull/2828#pullrequestreview-376246509", "createdAt": "2020-03-17T17:21:17Z", "commit": {"oid": "ed31b860296306d089c9a6efdbc725329d59973b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzoyMToxN1rOF3mWQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzoyMToxN1rOF3mWQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg0NDI5MA==", "bodyText": "Shall we check for an empty hostname rather than just checking null", "url": "https://github.com/wso2/carbon-identity-framework/pull/2828#discussion_r393844290", "createdAt": "2020-03-17T17:21:17Z", "author": {"login": "malithie"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultURLResolverService.java", "diffHunk": "@@ -0,0 +1,201 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.internal.IdentityCoreServiceComponent;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+\n+import java.net.MalformedURLException;\n+import java.net.SocketException;\n+import java.net.URL;\n+import java.util.Map;\n+\n+import static org.wso2.carbon.identity.core.util.IdentityTenantUtil.isTenantURLSupportEnabled;\n+\n+/**\n+ * URL Resolver service implementation.\n+ */\n+public class DefaultURLResolverService implements URLResolverService {\n+\n+    @Override\n+    public String resolveUrl(String url, boolean addProxyContextPath, boolean addWebContextRoot,\n+                             Map<String, Object> properties) throws URLResolverException {\n+\n+        try {\n+            URL parsedUrl = new URL(url);\n+            StringBuilder urlBuilder = new StringBuilder(parsedUrl.getProtocol())\n+                    .append(\"://\")\n+                    .append(parsedUrl.getHost())\n+                    .append(\":\")\n+                    .append(parsedUrl.getPort());\n+            appendContextToUri(parsedUrl.getPath(), addProxyContextPath, addWebContextRoot, urlBuilder,\n+                    false);\n+            return urlBuilder.toString();\n+\n+        } catch (MalformedURLException e) {\n+            throw new URLResolverException(\"Error while parsing the URL: \" + url, e);\n+        }\n+    }\n+\n+    @Override\n+    public String resolveUrlContext(String urlContext, boolean addProxyContextPath, boolean addWebContextRoot,\n+                                    boolean addTenantQueryParamInLegacyMode, Map<String, Object> properties)\n+            throws URLResolverException {\n+\n+        String hostName = getHostName();\n+        String mgtTransport = CarbonUtils.getManagementTransport();\n+        int mgtTransportPort = getMgtTransportPort(mgtTransport);\n+\n+        if (hostName.endsWith(\"/\")) {\n+            hostName = hostName.substring(0, hostName.length() - 1);\n+        }\n+        StringBuilder serverUrl = new StringBuilder(mgtTransport).append(\"://\").append(hostName.toLowerCase());\n+        // If it's well known HTTPS port, skip adding port.\n+        if (mgtTransportPort != IdentityCoreConstants.DEFAULT_HTTPS_PORT) {\n+            serverUrl.append(\":\").append(mgtTransportPort);\n+        }\n+\n+        appendContextToUri(urlContext, addProxyContextPath, addWebContextRoot, serverUrl, addTenantQueryParamInLegacyMode);\n+\n+        return serverUrl.toString();\n+    }\n+\n+    private int getMgtTransportPort(String mgtTransport) {\n+\n+        AxisConfiguration axisConfiguration = IdentityCoreServiceComponent.getConfigurationContextService().\n+                getServerConfigContext().getAxisConfiguration();\n+        int mgtTransportPort = CarbonUtils.getTransportProxyPort(axisConfiguration, mgtTransport);\n+        if (mgtTransportPort <= 0) {\n+            mgtTransportPort = CarbonUtils.getTransportPort(axisConfiguration, mgtTransport);\n+        }\n+        return mgtTransportPort;\n+    }\n+\n+    private String getHostName() throws URLResolverException {\n+\n+        String hostName = ServerConfiguration.getInstance().getFirstProperty(IdentityCoreConstants.HOST_NAME);\n+        try {\n+            if (hostName == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed31b860296306d089c9a6efdbc725329d59973b"}, "originalPosition": 100}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MjQ3NzQ0", "url": "https://github.com/wso2/carbon-identity-framework/pull/2828#pullrequestreview-376247744", "createdAt": "2020-03-17T17:22:46Z", "commit": {"oid": "ed31b860296306d089c9a6efdbc725329d59973b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzoyMjo0NlrOF3mZ5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzoyMjo0NlrOF3mZ5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg0NTIyMA==", "bodyText": "Is it reading hostname. This should denote that trying to resolve hostname from system", "url": "https://github.com/wso2/carbon-identity-framework/pull/2828#discussion_r393845220", "createdAt": "2020-03-17T17:22:46Z", "author": {"login": "malithie"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultURLResolverService.java", "diffHunk": "@@ -0,0 +1,201 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.internal.IdentityCoreServiceComponent;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+\n+import java.net.MalformedURLException;\n+import java.net.SocketException;\n+import java.net.URL;\n+import java.util.Map;\n+\n+import static org.wso2.carbon.identity.core.util.IdentityTenantUtil.isTenantURLSupportEnabled;\n+\n+/**\n+ * URL Resolver service implementation.\n+ */\n+public class DefaultURLResolverService implements URLResolverService {\n+\n+    @Override\n+    public String resolveUrl(String url, boolean addProxyContextPath, boolean addWebContextRoot,\n+                             Map<String, Object> properties) throws URLResolverException {\n+\n+        try {\n+            URL parsedUrl = new URL(url);\n+            StringBuilder urlBuilder = new StringBuilder(parsedUrl.getProtocol())\n+                    .append(\"://\")\n+                    .append(parsedUrl.getHost())\n+                    .append(\":\")\n+                    .append(parsedUrl.getPort());\n+            appendContextToUri(parsedUrl.getPath(), addProxyContextPath, addWebContextRoot, urlBuilder,\n+                    false);\n+            return urlBuilder.toString();\n+\n+        } catch (MalformedURLException e) {\n+            throw new URLResolverException(\"Error while parsing the URL: \" + url, e);\n+        }\n+    }\n+\n+    @Override\n+    public String resolveUrlContext(String urlContext, boolean addProxyContextPath, boolean addWebContextRoot,\n+                                    boolean addTenantQueryParamInLegacyMode, Map<String, Object> properties)\n+            throws URLResolverException {\n+\n+        String hostName = getHostName();\n+        String mgtTransport = CarbonUtils.getManagementTransport();\n+        int mgtTransportPort = getMgtTransportPort(mgtTransport);\n+\n+        if (hostName.endsWith(\"/\")) {\n+            hostName = hostName.substring(0, hostName.length() - 1);\n+        }\n+        StringBuilder serverUrl = new StringBuilder(mgtTransport).append(\"://\").append(hostName.toLowerCase());\n+        // If it's well known HTTPS port, skip adding port.\n+        if (mgtTransportPort != IdentityCoreConstants.DEFAULT_HTTPS_PORT) {\n+            serverUrl.append(\":\").append(mgtTransportPort);\n+        }\n+\n+        appendContextToUri(urlContext, addProxyContextPath, addWebContextRoot, serverUrl, addTenantQueryParamInLegacyMode);\n+\n+        return serverUrl.toString();\n+    }\n+\n+    private int getMgtTransportPort(String mgtTransport) {\n+\n+        AxisConfiguration axisConfiguration = IdentityCoreServiceComponent.getConfigurationContextService().\n+                getServerConfigContext().getAxisConfiguration();\n+        int mgtTransportPort = CarbonUtils.getTransportProxyPort(axisConfiguration, mgtTransport);\n+        if (mgtTransportPort <= 0) {\n+            mgtTransportPort = CarbonUtils.getTransportPort(axisConfiguration, mgtTransport);\n+        }\n+        return mgtTransportPort;\n+    }\n+\n+    private String getHostName() throws URLResolverException {\n+\n+        String hostName = ServerConfiguration.getInstance().getFirstProperty(IdentityCoreConstants.HOST_NAME);\n+        try {\n+            if (hostName == null) {\n+                hostName = NetworkUtils.getLocalHostname();\n+            }\n+        } catch (SocketException e) {\n+            throw new URLResolverException(\"Error while trying to read hostname.\", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed31b860296306d089c9a6efdbc725329d59973b"}, "originalPosition": 104}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MjUwMzgy", "url": "https://github.com/wso2/carbon-identity-framework/pull/2828#pullrequestreview-376250382", "createdAt": "2020-03-17T17:25:58Z", "commit": {"oid": "ed31b860296306d089c9a6efdbc725329d59973b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzoyNTo1OFrOF3mhwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzoyNTo1OFrOF3mhwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg0NzIzMg==", "bodyText": "We will be having this empty check everywhere right. What if we move this to the same util.\n@mefarazath WDYT?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2828#discussion_r393847232", "createdAt": "2020-03-17T17:25:58Z", "author": {"login": "malithie"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultURLResolverService.java", "diffHunk": "@@ -0,0 +1,201 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.internal.IdentityCoreServiceComponent;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+\n+import java.net.MalformedURLException;\n+import java.net.SocketException;\n+import java.net.URL;\n+import java.util.Map;\n+\n+import static org.wso2.carbon.identity.core.util.IdentityTenantUtil.isTenantURLSupportEnabled;\n+\n+/**\n+ * URL Resolver service implementation.\n+ */\n+public class DefaultURLResolverService implements URLResolverService {\n+\n+    @Override\n+    public String resolveUrl(String url, boolean addProxyContextPath, boolean addWebContextRoot,\n+                             Map<String, Object> properties) throws URLResolverException {\n+\n+        try {\n+            URL parsedUrl = new URL(url);\n+            StringBuilder urlBuilder = new StringBuilder(parsedUrl.getProtocol())\n+                    .append(\"://\")\n+                    .append(parsedUrl.getHost())\n+                    .append(\":\")\n+                    .append(parsedUrl.getPort());\n+            appendContextToUri(parsedUrl.getPath(), addProxyContextPath, addWebContextRoot, urlBuilder,\n+                    false);\n+            return urlBuilder.toString();\n+\n+        } catch (MalformedURLException e) {\n+            throw new URLResolverException(\"Error while parsing the URL: \" + url, e);\n+        }\n+    }\n+\n+    @Override\n+    public String resolveUrlContext(String urlContext, boolean addProxyContextPath, boolean addWebContextRoot,\n+                                    boolean addTenantQueryParamInLegacyMode, Map<String, Object> properties)\n+            throws URLResolverException {\n+\n+        String hostName = getHostName();\n+        String mgtTransport = CarbonUtils.getManagementTransport();\n+        int mgtTransportPort = getMgtTransportPort(mgtTransport);\n+\n+        if (hostName.endsWith(\"/\")) {\n+            hostName = hostName.substring(0, hostName.length() - 1);\n+        }\n+        StringBuilder serverUrl = new StringBuilder(mgtTransport).append(\"://\").append(hostName.toLowerCase());\n+        // If it's well known HTTPS port, skip adding port.\n+        if (mgtTransportPort != IdentityCoreConstants.DEFAULT_HTTPS_PORT) {\n+            serverUrl.append(\":\").append(mgtTransportPort);\n+        }\n+\n+        appendContextToUri(urlContext, addProxyContextPath, addWebContextRoot, serverUrl, addTenantQueryParamInLegacyMode);\n+\n+        return serverUrl.toString();\n+    }\n+\n+    private int getMgtTransportPort(String mgtTransport) {\n+\n+        AxisConfiguration axisConfiguration = IdentityCoreServiceComponent.getConfigurationContextService().\n+                getServerConfigContext().getAxisConfiguration();\n+        int mgtTransportPort = CarbonUtils.getTransportProxyPort(axisConfiguration, mgtTransport);\n+        if (mgtTransportPort <= 0) {\n+            mgtTransportPort = CarbonUtils.getTransportPort(axisConfiguration, mgtTransport);\n+        }\n+        return mgtTransportPort;\n+    }\n+\n+    private String getHostName() throws URLResolverException {\n+\n+        String hostName = ServerConfiguration.getInstance().getFirstProperty(IdentityCoreConstants.HOST_NAME);\n+        try {\n+            if (hostName == null) {\n+                hostName = NetworkUtils.getLocalHostname();\n+            }\n+        } catch (SocketException e) {\n+            throw new URLResolverException(\"Error while trying to read hostname.\", e);\n+        }\n+        return hostName;\n+    }\n+\n+    private void appendWebContextRoot(StringBuilder serverUrl) {\n+\n+        String webContextRoot = ServerConfiguration.getInstance().getFirstProperty(IdentityCoreConstants\n+                .WEB_CONTEXT_ROOT);\n+        // If webContextRoot is defined then append it.\n+        if (StringUtils.isNotBlank(webContextRoot)) {\n+            if (webContextRoot.trim().charAt(0) != '/') {\n+                serverUrl.append(\"/\").append(webContextRoot.trim());\n+            } else {\n+                serverUrl.append(webContextRoot.trim());\n+            }\n+        }\n+    }\n+\n+    private void appendProxyContextPath(StringBuilder serverUrl) {\n+\n+        String proxyContextPath = ServerConfiguration.getInstance().getFirstProperty(IdentityCoreConstants\n+                .PROXY_CONTEXT_PATH);\n+        // If ProxyContextPath is defined then append it.\n+        if (StringUtils.isNotBlank(proxyContextPath)) {\n+            if (proxyContextPath.trim().charAt(0) != '/') {\n+                serverUrl.append(\"/\").append(proxyContextPath.trim());\n+            } else {\n+                serverUrl.append(proxyContextPath.trim());\n+            }\n+        }\n+    }\n+\n+    private void appendTenantAsPathParam(StringBuilder serverUrl) {\n+\n+        String tenantDomain = IdentityTenantUtil.getTenantDomainFromContext();\n+        if (StringUtils.isBlank(tenantDomain)) {\n+            tenantDomain = PrivilegedCarbonContext.getThreadLocalCarbonContext().getTenantDomain();\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed31b860296306d089c9a6efdbc725329d59973b"}, "originalPosition": 142}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MjU2MTgw", "url": "https://github.com/wso2/carbon-identity-framework/pull/2828#pullrequestreview-376256180", "createdAt": "2020-03-17T17:32:53Z", "commit": {"oid": "ed31b860296306d089c9a6efdbc725329d59973b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzozMjo1NFrOF3mzfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzozMjo1NFrOF3mzfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg1MTc3Mg==", "bodyText": "Better to rename the reference name accordingly", "url": "https://github.com/wso2/carbon-identity-framework/pull/2828#discussion_r393851772", "createdAt": "2020-03-17T17:32:54Z", "author": {"login": "malithie"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/util/IdentityCoreConstants.java", "diffHunk": "@@ -28,6 +28,8 @@\n     public static final String FILE_NAME_REGEX = \"FileNameRegEx\";\n     public static final String PORTS_OFFSET = \"Ports.Offset\";\n \n+    public static final String TENANT_NAME_FROM_CONTEXT = \"TenantNameFromContext\";\n+    public static final String ENABLE_TENANT_QUALIFIED_URL_SUPPORT = \"EnableTenantQualifiedUrls\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed31b860296306d089c9a6efdbc725329d59973b"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MjU2ODI2", "url": "https://github.com/wso2/carbon-identity-framework/pull/2828#pullrequestreview-376256826", "createdAt": "2020-03-17T17:33:40Z", "commit": {"oid": "ed31b860296306d089c9a6efdbc725329d59973b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzozMzo0MFrOF3m1iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzozMzo0MFrOF3m1iw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg1MjI5OQ==", "bodyText": "What if we rename the method to match with the config", "url": "https://github.com/wso2/carbon-identity-framework/pull/2828#discussion_r393852299", "createdAt": "2020-03-17T17:33:40Z", "author": {"login": "malithie"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/util/IdentityTenantUtil.java", "diffHunk": "@@ -320,4 +320,25 @@ public static int getTenantIdOfUser(String username) throws IdentityRuntimeExcep\n             return tenantId;\n         }\n     }\n+\n+    /**\n+     * Get the tenant name from the thread local properties.\n+     *\n+     * @return Tenant name from the context.\n+     */\n+    public static String getTenantDomainFromContext() {\n+        String tenantDomain = (String) IdentityUtil.threadLocalProperties.get().get\n+                (IdentityCoreConstants.TENANT_NAME_FROM_CONTEXT);\n+        return tenantDomain;\n+    }\n+\n+    /**\n+     * Checks whether the tenant URL support is enabled.\n+     *\n+     * @return true if the config is set to true, false otherwise.\n+     */\n+    public static boolean isTenantURLSupportEnabled() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed31b860296306d089c9a6efdbc725329d59973b"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MjYxNjQ4", "url": "https://github.com/wso2/carbon-identity-framework/pull/2828#pullrequestreview-376261648", "createdAt": "2020-03-17T17:39:39Z", "commit": {"oid": "ed31b860296306d089c9a6efdbc725329d59973b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzozOTo0MFrOF3nERw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzozOTo0MFrOF3nERw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg1NjA3MQ==", "bodyText": "I think this config should change. Can we check with @pulasthi7", "url": "https://github.com/wso2/carbon-identity-framework/pull/2828#discussion_r393856071", "createdAt": "2020-03-17T17:39:40Z", "author": {"login": "malithie"}, "path": "features/identity-core/org.wso2.carbon.identity.core.server.feature/resources/identity.xml.j2", "diffHunk": "@@ -1913,6 +1913,8 @@\n     -->\n     <EnableFederatedUserAssociation>{{user.association.enable_for_federated_users}}</EnableFederatedUserAssociation>\n \n+    <EnableTenantQualifiedUrls>{{tenant.url_support_enable}}</EnableTenantQualifiedUrls>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed31b860296306d089c9a6efdbc725329d59973b"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f6342ef09b98348a076679ea6921b3af02019d0", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/4f6342ef09b98348a076679ea6921b3af02019d0", "committedDate": "2020-03-18T04:43:20Z", "message": "fix minor issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NjI1ODIz", "url": "https://github.com/wso2/carbon-identity-framework/pull/2828#pullrequestreview-376625823", "createdAt": "2020-03-18T07:47:12Z", "commit": {"oid": "4f6342ef09b98348a076679ea6921b3af02019d0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQwNzo0NzoxMlrOF35YxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQwNzo0NzoxMlrOF35YxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDE1NjIyOA==", "bodyText": "isTenantQualifiedUrlsEnabled\nOtherwise the method defines an action but it should denote it's a check", "url": "https://github.com/wso2/carbon-identity-framework/pull/2828#discussion_r394156228", "createdAt": "2020-03-18T07:47:12Z", "author": {"login": "malithie"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/util/IdentityTenantUtil.java", "diffHunk": "@@ -320,4 +320,26 @@ public static int getTenantIdOfUser(String username) throws IdentityRuntimeExcep\n             return tenantId;\n         }\n     }\n+\n+    /**\n+     * Get the tenant name from the thread local properties.\n+     *\n+     * @return Tenant name from the context.\n+     */\n+    public static String getTenantDomainFromContext() {\n+\n+        String tenantDomain = (String) IdentityUtil.threadLocalProperties.get().get\n+                (IdentityCoreConstants.TENANT_NAME_FROM_CONTEXT);\n+        return tenantDomain;\n+    }\n+\n+    /**\n+     * Checks whether the tenant URL support is enabled.\n+     *\n+     * @return true if the config is set to true, false otherwise.\n+     */\n+    public static boolean enableTenantQualifiedUrls() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f6342ef09b98348a076679ea6921b3af02019d0"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24f444bad5d86c0cb0bdbe2dd16519a0788f8339", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/24f444bad5d86c0cb0bdbe2dd16519a0788f8339", "committedDate": "2020-03-18T08:07:31Z", "message": "Add a resource context for the SAML metadata endpoint\nAdd the SAML metadata servlet to the ContextRewrite Valve"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "133d67554290274f43fdd297bde18fb7a9ade77b", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/133d67554290274f43fdd297bde18fb7a9ade77b", "committedDate": "2020-03-18T08:07:32Z", "message": "fixes for minor issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f0fc761d958805cc001377a34e06a0ccfb700f6", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/1f0fc761d958805cc001377a34e06a0ccfb700f6", "committedDate": "2020-03-18T08:23:03Z", "message": "fix the configuration for enabling tenant-qualified URLs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NzMxOTQ2", "url": "https://github.com/wso2/carbon-identity-framework/pull/2828#pullrequestreview-376731946", "createdAt": "2020-03-18T10:23:38Z", "commit": {"oid": "1f0fc761d958805cc001377a34e06a0ccfb700f6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2298, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}