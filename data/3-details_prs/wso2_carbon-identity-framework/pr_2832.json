{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxMDUyNDAx", "number": 2832, "title": "Add support for adding the tenant domain as a path param in legacy mode.", "bodyText": "Proposed changes in this pull request\n$subject.\nFix wso2/product-is#7939", "createdAt": "2020-03-19T14:55:52Z", "url": "https://github.com/wso2/carbon-identity-framework/pull/2832", "merged": true, "mergeCommit": {"oid": "e95d94d0d98d56c07a4e1ca564a8b5d25c9607f7"}, "closed": true, "closedAt": "2020-03-23T17:43:36Z", "author": {"login": "chamathns"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcPNPeggH2gAyMzkxMDUyNDAxOmQ5ODI4YjIwNWExYzRiN2NmYTg4NGViNDc5MWQ0NDg2YjhmNjAxYzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQh-CdAFqTM3OTY3MTA2Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d9828b205a1c4b7cfa884eb4791d4486b8f601c8", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/d9828b205a1c4b7cfa884eb4791d4486b8f601c8", "committedDate": "2020-03-19T15:00:37Z", "message": "Add support for adding the tenant domain as a path param in legacy mode."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "66a9a6d8b751845129f26c4466da63e220cc7c16", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/66a9a6d8b751845129f26c4466da63e220cc7c16", "committedDate": "2020-03-19T14:52:57Z", "message": "Add support for adding the tenant domain as a path param in legacy mode."}, "afterCommit": {"oid": "d9828b205a1c4b7cfa884eb4791d4486b8f601c8", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/d9828b205a1c4b7cfa884eb4791d4486b8f601c8", "committedDate": "2020-03-19T15:00:37Z", "message": "Add support for adding the tenant domain as a path param in legacy mode."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d0dea2b88bdd1fe5b98567b5a45ef1224129dcb", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/6d0dea2b88bdd1fe5b98567b5a45ef1224129dcb", "committedDate": "2020-03-22T07:22:41Z", "message": "Add tests for resolveURL method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5MTE3NjAy", "url": "https://github.com/wso2/carbon-identity-framework/pull/2832#pullrequestreview-379117602", "createdAt": "2020-03-23T03:47:16Z", "commit": {"oid": "6d0dea2b88bdd1fe5b98567b5a45ef1224129dcb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QwMzo0NzoxNlrOF52KTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QwMzo0NzoxNlrOF52KTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjIwMDUyNw==", "bodyText": "Better if the conditions are switched so it's more meaningful.", "url": "https://github.com/wso2/carbon-identity-framework/pull/2832#discussion_r396200527", "createdAt": "2020-03-23T03:47:16Z", "author": {"login": "malithie"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultURLResolverService.java", "diffHunk": "@@ -140,7 +141,23 @@ private void appendTenantAsPathParam(StringBuilder serverUrl) {\n         if (StringUtils.isBlank(tenantDomain)) {\n             tenantDomain = PrivilegedCarbonContext.getThreadLocalCarbonContext().getTenantDomain();\n         }\n-        if (tenantDomain != null) {\n+        if (StringUtils.isNotBlank(tenantDomain)) {\n+            if (serverUrl.toString().endsWith(\"/\")) {\n+                serverUrl.append(\"t/\").append(tenantDomain);\n+            } else {\n+                serverUrl.append(\"/t/\").append(tenantDomain);\n+            }\n+        }\n+    }\n+\n+    private void appendTenantPathParamInLegacyMode(StringBuilder serverUrl) {\n+\n+        String tenantDomain = IdentityTenantUtil.getTenantDomainFromContext();\n+        if (StringUtils.isBlank(tenantDomain)) {\n+            tenantDomain = PrivilegedCarbonContext.getThreadLocalCarbonContext().getTenantDomain();\n+        }\n+        if (!MultitenantConstants.SUPER_TENANT_DOMAIN_NAME.equalsIgnoreCase(tenantDomain) &&\n+                StringUtils.isNotBlank(tenantDomain)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d0dea2b88bdd1fe5b98567b5a45ef1224129dcb"}, "originalPosition": 58}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5MTE4MTQ3", "url": "https://github.com/wso2/carbon-identity-framework/pull/2832#pullrequestreview-379118147", "createdAt": "2020-03-23T03:49:54Z", "commit": {"oid": "6d0dea2b88bdd1fe5b98567b5a45ef1224129dcb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QwMzo0OTo1NFrOF52MFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QwMzo0OTo1NFrOF52MFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjIwMDk4Mw==", "bodyText": "Maybe we can rename this to indicate legacy mode operation as well so that it is consistent", "url": "https://github.com/wso2/carbon-identity-framework/pull/2832#discussion_r396200983", "createdAt": "2020-03-23T03:49:54Z", "author": {"login": "malithie"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultURLResolverService.java", "diffHunk": "@@ -152,7 +169,7 @@ private void appendTenantAsPathParam(StringBuilder serverUrl) {\n     private void appendTenantAsQueryParam(StringBuilder serverUrl) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d0dea2b88bdd1fe5b98567b5a45ef1224129dcb"}, "originalPosition": 63}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f61ab749bb2fda1b6149ea747699118897d0d5ad", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/f61ab749bb2fda1b6149ea747699118897d0d5ad", "committedDate": "2020-03-23T04:13:41Z", "message": "Resolve minor issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NjcxMDYy", "url": "https://github.com/wso2/carbon-identity-framework/pull/2832#pullrequestreview-379671062", "createdAt": "2020-03-23T17:43:30Z", "commit": {"oid": "f61ab749bb2fda1b6149ea747699118897d0d5ad"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2304, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}