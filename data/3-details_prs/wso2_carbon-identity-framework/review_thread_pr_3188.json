{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEwNDg0MjI5", "number": 3188, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxOTowMzo0OVrOEygf1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxOTowMzo0OVrOEygf1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxMzk2NjkzOnYy", "diffSide": "RIGHT", "path": "components/role-mgt/org.wso2.carbon.identity.role.mgt.core/src/main/java/org/wso2/carbon/identity/role/mgt/core/dao/RoleDAOImpl.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxOTowMzo0OVrOHpMOFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwNzozMzo0N1rOHpdFhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjk1Mzg3OA==", "bodyText": "is the new tenant domain different from the previous one? if so we may not need to start the tenant flow here at all", "url": "https://github.com/wso2/carbon-identity-framework/pull/3188#discussion_r512953878", "createdAt": "2020-10-27T19:03:49Z", "author": {"login": "pulasthi7"}, "path": "components/role-mgt/org.wso2.carbon.identity.role.mgt.core/src/main/java/org/wso2/carbon/identity/role/mgt/core/dao/RoleDAOImpl.java", "diffHunk": "@@ -1081,9 +1081,11 @@ public RoleBasicInfo setPermissionsForRole(String roleID, List<String> permissio\n             return new RoleBasicInfo(roleID, roleName);\n         }\n         try {\n+            String loggedInUser = CarbonContext.getThreadLocalCarbonContext().getUsername();\n             PrivilegedCarbonContext.startTenantFlow();\n             PrivilegedCarbonContext carbonContext = PrivilegedCarbonContext.getThreadLocalCarbonContext();\n             carbonContext.setTenantDomain(tenantDomain, true);\n+            carbonContext.setUsername(loggedInUser);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebfda5c82724bb8c63d96054597beaeb819174cb"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzE3NzUwOA==", "bodyText": "It could be different due to deviations of certain flows. This flow needs to be started for the required tenant to make sure these operations are carried out for the intended tenant.", "url": "https://github.com/wso2/carbon-identity-framework/pull/3188#discussion_r513177508", "createdAt": "2020-10-28T04:44:16Z", "author": {"login": "ashendes"}, "path": "components/role-mgt/org.wso2.carbon.identity.role.mgt.core/src/main/java/org/wso2/carbon/identity/role/mgt/core/dao/RoleDAOImpl.java", "diffHunk": "@@ -1081,9 +1081,11 @@ public RoleBasicInfo setPermissionsForRole(String roleID, List<String> permissio\n             return new RoleBasicInfo(roleID, roleName);\n         }\n         try {\n+            String loggedInUser = CarbonContext.getThreadLocalCarbonContext().getUsername();\n             PrivilegedCarbonContext.startTenantFlow();\n             PrivilegedCarbonContext carbonContext = PrivilegedCarbonContext.getThreadLocalCarbonContext();\n             carbonContext.setTenantDomain(tenantDomain, true);\n+            carbonContext.setUsername(loggedInUser);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjk1Mzg3OA=="}, "originalCommit": {"oid": "ebfda5c82724bb8c63d96054597beaeb819174cb"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzIzMDIxMw==", "bodyText": "No deviations of the flow was discovered. Hence the tenant flow initiation was removed in 29de1b6", "url": "https://github.com/wso2/carbon-identity-framework/pull/3188#discussion_r513230213", "createdAt": "2020-10-28T07:33:47Z", "author": {"login": "ashendes"}, "path": "components/role-mgt/org.wso2.carbon.identity.role.mgt.core/src/main/java/org/wso2/carbon/identity/role/mgt/core/dao/RoleDAOImpl.java", "diffHunk": "@@ -1081,9 +1081,11 @@ public RoleBasicInfo setPermissionsForRole(String roleID, List<String> permissio\n             return new RoleBasicInfo(roleID, roleName);\n         }\n         try {\n+            String loggedInUser = CarbonContext.getThreadLocalCarbonContext().getUsername();\n             PrivilegedCarbonContext.startTenantFlow();\n             PrivilegedCarbonContext carbonContext = PrivilegedCarbonContext.getThreadLocalCarbonContext();\n             carbonContext.setTenantDomain(tenantDomain, true);\n+            carbonContext.setUsername(loggedInUser);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjk1Mzg3OA=="}, "originalCommit": {"oid": "ebfda5c82724bb8c63d96054597beaeb819174cb"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2489, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}