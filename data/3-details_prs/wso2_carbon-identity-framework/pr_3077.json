{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwNzI4NTk4", "number": 3077, "title": "Enhanced the xacml policy loading flow from filesystem preserving the default flow", "bodyText": "Fixes wso2/product-is#9207\nEnhance the XACML policy loading flow from the filesystem, preserving the default flow. 75% improvement in the policy loading time is observed.\nThis enhanced loading flow will be used when starting the server with the following property.\n./wso2server.sh -DenableEnhancedXACMLLoading=true\n\nor by adding it to the wso2server.sh file.", "createdAt": "2020-08-20T07:38:44Z", "url": "https://github.com/wso2/carbon-identity-framework/pull/3077", "merged": true, "mergeCommit": {"oid": "c98d23e585242c2d0075eae52f341829d8dc7c49"}, "closed": true, "closedAt": "2020-09-06T07:41:44Z", "author": {"login": "ashendes"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdArKNJAH2gAyNDcwNzI4NTk4OjE2NDQ4NmM0NzUyZjgyNDc3NTQzYTVjYWExM2E5YzUyNzY4OGQwM2U=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHthuOAFqTQ4NjQ2MjM3NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "164486c4752f82477543a5caa13a9c527688d03e", "author": {"user": {"login": "ashendes", "name": "Ashen Kavinda De Silva"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/164486c4752f82477543a5caa13a9c527688d03e", "committedDate": "2020-08-20T07:34:18Z", "message": "Enhanced the xacml policy loading flow from filesystem"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0ODEwMTcy", "url": "https://github.com/wso2/carbon-identity-framework/pull/3077#pullrequestreview-474810172", "createdAt": "2020-08-25T20:01:41Z", "commit": {"oid": "164486c4752f82477543a5caa13a9c527688d03e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxNDkyNjA5", "url": "https://github.com/wso2/carbon-identity-framework/pull/3077#pullrequestreview-481492609", "createdAt": "2020-09-03T04:58:24Z", "commit": {"oid": "164486c4752f82477543a5caa13a9c527688d03e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzMTE5OTYz", "url": "https://github.com/wso2/carbon-identity-framework/pull/3077#pullrequestreview-483119963", "createdAt": "2020-09-06T07:41:35Z", "commit": {"oid": "164486c4752f82477543a5caa13a9c527688d03e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2NDYyMDM5", "url": "https://github.com/wso2/carbon-identity-framework/pull/3077#pullrequestreview-486462039", "createdAt": "2020-09-11T04:16:02Z", "commit": {"oid": "164486c4752f82477543a5caa13a9c527688d03e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwNDoxNjowMlrOHQNr5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwNDoxNjowMlrOHQNr5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njc2MzQ5NA==", "bodyText": "Complete the javadoc with descriptions", "url": "https://github.com/wso2/carbon-identity-framework/pull/3077#discussion_r486763494", "createdAt": "2020-09-11T04:16:02Z", "author": {"login": "sachiniWettasinghe"}, "path": "components/entitlement/org.wso2.carbon.identity.entitlement/src/main/java/org/wso2/carbon/identity/entitlement/internal/EntitlementServiceComponent.java", "diffHunk": "@@ -307,6 +317,36 @@ protected void activate(ComponentContext ctxt) {\n         }\n     }\n \n+    /**\n+     * Adds policy files with unique policyIDs to the registry.\n+     *\n+     * @param policyIdList\n+     * @param fileList\n+     * @return\n+     * @throws IOException\n+     */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "164486c4752f82477543a5caa13a9c527688d03e"}, "originalPosition": 90}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2NDYyMzc0", "url": "https://github.com/wso2/carbon-identity-framework/pull/3077#pullrequestreview-486462374", "createdAt": "2020-09-11T04:17:16Z", "commit": {"oid": "164486c4752f82477543a5caa13a9c527688d03e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwNDoxNzoxNlrOHQNs7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwNDoxNzoxNlrOHQNs7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njc2Mzc1Ng==", "bodyText": "Format the comment by starting with a capital letter and ending with a '.'. And add a meaningful sentence here.", "url": "https://github.com/wso2/carbon-identity-framework/pull/3077#discussion_r486763756", "createdAt": "2020-09-11T04:17:16Z", "author": {"login": "sachiniWettasinghe"}, "path": "components/entitlement/org.wso2.carbon.identity.entitlement/src/main/java/org/wso2/carbon/identity/entitlement/internal/EntitlementServiceComponent.java", "diffHunk": "@@ -307,6 +317,36 @@ protected void activate(ComponentContext ctxt) {\n         }\n     }\n \n+    /**\n+     * Adds policy files with unique policyIDs to the registry.\n+     *\n+     * @param policyIdList\n+     * @param fileList\n+     * @return\n+     * @throws IOException\n+     */\n+    private boolean addPolicyFiles(List<String> policyIdList, File[] fileList) throws IOException {\n+\n+        boolean customPolicies = false;\n+        for (File policyFile : fileList) {\n+            if (policyFile.isFile()) {\n+                PolicyDTO policyDTO = new PolicyDTO();\n+                policyDTO.setPolicy(FileUtils.readFileToString(policyFile));\n+                if (!policyIdList.contains(policyDTO.getPolicyId())) {\n+                    try {\n+                        EntitlementUtil.addFilesystemPolicy(policyDTO, registryService\n+                                .getGovernanceSystemRegistry(), true);\n+                    } catch (Exception e) {\n+                        // log and ignore", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "164486c4752f82477543a5caa13a9c527688d03e"}, "originalPosition": 103}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2186, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}