{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExNjk0Nzc4", "number": 3201, "title": "Handle adding existing claim dialect URI", "bodyText": "Part of the fix for wso2/product-is#9821\nApproach\nThrow a client error if the dialect is already existing.", "createdAt": "2020-10-28T16:52:10Z", "url": "https://github.com/wso2/carbon-identity-framework/pull/3201", "merged": true, "mergeCommit": {"oid": "18dd8429bc54c2bb5427eb4f140ec91f6d01c7fe"}, "closed": true, "closedAt": "2020-10-29T09:23:22Z", "author": {"login": "somindatommy"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdW91NlAH2gAyNTExNjk0Nzc4OjJlM2Y2YTY2MDg0ZjdjMjU1NDlmZDM2MzhmZDMyZWU2OWE2YzU3NmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXKHVGgFqTUxOTMxODM2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2e3f6a66084f7c25549fd3638fd32ee69a6c576e", "author": {"user": {"login": "somindatommy", "name": "Sominda Gamage"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/2e3f6a66084f7c25549fd3638fd32ee69a6c576e", "committedDate": "2020-10-28T13:45:54Z", "message": "Handle adding existing claim dialect URI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a6854f90b76b965c6a84ca7d21c6bf2090a6249", "author": {"user": {"login": "somindatommy", "name": "Sominda Gamage"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/4a6854f90b76b965c6a84ca7d21c6bf2090a6249", "committedDate": "2020-10-28T16:56:50Z", "message": "Refactoring static imports"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4OTMyODg5", "url": "https://github.com/wso2/carbon-identity-framework/pull/3201#pullrequestreview-518932889", "createdAt": "2020-10-28T17:47:10Z", "commit": {"oid": "4a6854f90b76b965c6a84ca7d21c6bf2090a6249"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNzo0NzoxMFrOHp2Ybg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNzo0NzoxMFrOHp2Ybg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzY0NDY1NA==", "bodyText": "since we are using contains() below, better to use a set here which will be efficient", "url": "https://github.com/wso2/carbon-identity-framework/pull/3201#discussion_r513644654", "createdAt": "2020-10-28T17:47:10Z", "author": {"login": "pulasthi7"}, "path": "components/claim-mgt/org.wso2.carbon.identity.claim.metadata.mgt/src/main/java/org/wso2/carbon/identity/claim/metadata/mgt/ClaimMetadataManagementServiceImpl.java", "diffHunk": "@@ -82,11 +87,23 @@ public void addClaimDialect(ClaimDialect claimDialect, String tenantDomain) thro\n         if (claimDialect == null || StringUtils.isBlank(claimDialect.getClaimDialectURI())) {\n             throw new ClaimMetadataClientException(ERROR_CODE_EMPTY_CLAIM_DIALECT);\n         }\n+        if (StringUtils.isBlank(tenantDomain)) {\n+            throw new ClaimMetadataClientException(ERROR_CODE_EMPTY_TENANT_DOMAIN);\n+        }\n+        int tenantId = IdentityTenantUtil.getTenantId(tenantDomain);\n+        if (tenantId == MultitenantConstants.INVALID_TENANT_ID) {\n+            throw new ClaimMetadataClientException(ERROR_CODE_INVALID_TENANT_DOMAIN.getCode(),\n+                    String.format(ERROR_CODE_INVALID_TENANT_DOMAIN.getMessage(), tenantDomain));\n+        }\n \n-        // TODO : validate claim dialect already exists?\n+        List<ClaimDialect> claimDialects = this.claimDialectDAO.getClaimDialects(tenantId);\n+        List<String> claimDialectUris = claimDialects.stream().map(ClaimDialect::getClaimDialectURI).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a6854f90b76b965c6a84ca7d21c6bf2090a6249"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e892da0880f754ef15e877f078706ba84d41dd8e", "author": {"user": {"login": "somindatommy", "name": "Sominda Gamage"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/e892da0880f754ef15e877f078706ba84d41dd8e", "committedDate": "2020-10-28T18:41:18Z", "message": "Addressing comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5MzE4MzY3", "url": "https://github.com/wso2/carbon-identity-framework/pull/3201#pullrequestreview-519318367", "createdAt": "2020-10-29T04:04:33Z", "commit": {"oid": "e892da0880f754ef15e877f078706ba84d41dd8e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2159, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}