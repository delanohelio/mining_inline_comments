{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ3OTM5NDE4", "number": 3017, "title": "Add additional authentication related parameters to publish", "bodyText": "Added the following functionalities\n\nadd the constructor to pass the error code.\nadd error code comply with the current error codes from FW.\nadd custom params for Analytics\n\nResolves wso2/product-is#8667", "createdAt": "2020-07-12T18:47:02Z", "url": "https://github.com/wso2/carbon-identity-framework/pull/3017", "merged": true, "mergeCommit": {"oid": "92d92e74b372d898d56c5188b23e43854b291c11"}, "closed": true, "closedAt": "2020-07-15T13:52:20Z", "author": {"login": "Sathiyakugan"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc00aDiABqjM1NDM3NTU2MTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQ3EBsAFqTUwNTcyNTQ5NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e03b4cef00a3808f134c926b27b0132802abcdff", "author": {"user": {"login": "Sathiyakugan", "name": "Sathiyakugan"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/e03b4cef00a3808f134c926b27b0132802abcdff", "committedDate": "2020-07-12T18:44:47Z", "message": "Add additional authentication related parameters to publish"}, "afterCommit": {"oid": "e4b57d145c8fad9afae49fdf09d2021387123222", "author": {"user": {"login": "Sathiyakugan", "name": "Sathiyakugan"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/e4b57d145c8fad9afae49fdf09d2021387123222", "committedDate": "2020-07-14T11:32:43Z", "message": "Add additional authentication related parameters to publish"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e4b57d145c8fad9afae49fdf09d2021387123222", "author": {"user": {"login": "Sathiyakugan", "name": "Sathiyakugan"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/e4b57d145c8fad9afae49fdf09d2021387123222", "committedDate": "2020-07-14T11:32:43Z", "message": "Add additional authentication related parameters to publish"}, "afterCommit": {"oid": "53e990cacd5b29e7e3abbb108e185bed596355cc", "author": {"user": {"login": "Sathiyakugan", "name": "Sathiyakugan"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/53e990cacd5b29e7e3abbb108e185bed596355cc", "committedDate": "2020-07-14T11:36:26Z", "message": "Add additional authentication related parameters to publish"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "53e990cacd5b29e7e3abbb108e185bed596355cc", "author": {"user": {"login": "Sathiyakugan", "name": "Sathiyakugan"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/53e990cacd5b29e7e3abbb108e185bed596355cc", "committedDate": "2020-07-14T11:36:26Z", "message": "Add additional authentication related parameters to publish"}, "afterCommit": {"oid": "5ec3d6e17910c9bd5547cd88823efd8c0de01389", "author": {"user": {"login": "Sathiyakugan", "name": "Sathiyakugan"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/5ec3d6e17910c9bd5547cd88823efd8c0de01389", "committedDate": "2020-07-14T11:39:11Z", "message": "Add additional authentication related parameters to publish"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NjE1MTU2", "url": "https://github.com/wso2/carbon-identity-framework/pull/3017#pullrequestreview-448615156", "createdAt": "2020-07-15T04:09:50Z", "commit": {"oid": "5ec3d6e17910c9bd5547cd88823efd8c0de01389"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwNDowOTo1MFrOGxtgYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwNDowOTo1MFrOGxtgYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc3ODk3OQ==", "bodyText": "You should add these configurations to the j2 file and default.json file as well", "url": "https://github.com/wso2/carbon-identity-framework/pull/3017#discussion_r454778979", "createdAt": "2020-07-15T04:09:50Z", "author": {"login": "nilasini"}, "path": "features/identity-event/org.wso2.carbon.identity.event.server.feature/resources/identity-event.properties", "diffHunk": "@@ -119,3 +119,9 @@ OIDCLogoutEventHandler.subscription.1=SESSION_TERMINATE\n OIDCLogoutEventHandler.enable=true\n module.name.21=tenantRegistrationVerificationHandler\n tenantRegistrationVerificationHandler.subscription.1=PRE_SET_USER_CLAIMS\n+module.name.22=analyticsLoginDataPublisherV110\n+analyticsLoginDataPublisherV110.subscription.1=AUTHENTICATION_STEP_SUCCESS", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ec3d6e17910c9bd5547cd88823efd8c0de01389"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5ec3d6e17910c9bd5547cd88823efd8c0de01389", "author": {"user": {"login": "Sathiyakugan", "name": "Sathiyakugan"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/5ec3d6e17910c9bd5547cd88823efd8c0de01389", "committedDate": "2020-07-14T11:39:11Z", "message": "Add additional authentication related parameters to publish"}, "afterCommit": {"oid": "6fc8713e47078db1e466cfaabda3caa05757dfc7", "author": {"user": {"login": "Sathiyakugan", "name": "Sathiyakugan"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/6fc8713e47078db1e466cfaabda3caa05757dfc7", "committedDate": "2020-07-15T05:22:22Z", "message": "Add additional authentication related parameters to publish"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6fc8713e47078db1e466cfaabda3caa05757dfc7", "author": {"user": {"login": "Sathiyakugan", "name": "Sathiyakugan"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/6fc8713e47078db1e466cfaabda3caa05757dfc7", "committedDate": "2020-07-15T05:22:22Z", "message": "Add additional authentication related parameters to publish"}, "afterCommit": {"oid": "454aad61e1e1eba5e0446d63bd49db7b42abf7c7", "author": {"user": {"login": "Sathiyakugan", "name": "Sathiyakugan"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/454aad61e1e1eba5e0446d63bd49db7b42abf7c7", "committedDate": "2020-07-15T05:28:00Z", "message": "Add additional authentication related parameters to publish"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NjUxMjg1", "url": "https://github.com/wso2/carbon-identity-framework/pull/3017#pullrequestreview-448651285", "createdAt": "2020-07-15T06:03:11Z", "commit": {"oid": "454aad61e1e1eba5e0446d63bd49db7b42abf7c7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwNjowMzoxMVrOGxvfUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwNjowMzoxMVrOGxvfUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDgxMTQ3Mg==", "bodyText": "Changing the method signature will effect several places. Did you able to check those places?", "url": "https://github.com/wso2/carbon-identity-framework/pull/3017#discussion_r454811472", "createdAt": "2020-07-15T06:03:11Z", "author": {"login": "ShanChathusanda93"}, "path": "components/authentication-framework/org.wso2.carbon.identity.application.authentication.framework/src/main/java/org/wso2/carbon/identity/application/authentication/framework/AbstractApplicationAuthenticator.java", "diffHunk": "@@ -153,43 +155,77 @@ protected boolean isStepHasMultiOption(AuthenticationContext context) {\n         return stepHasMultiOption;\n     }\n \n-    protected void publishAuthenticationStepAttempt(HttpServletRequest request, AuthenticationContext context,\n-                                                  User user, boolean success) {\n+    protected void publishAuthenticationStepAttemptSuccess(HttpServletRequest request, AuthenticationContext context,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "454aad61e1e1eba5e0446d63bd49db7b42abf7c7"}, "originalPosition": 33}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "454aad61e1e1eba5e0446d63bd49db7b42abf7c7", "author": {"user": {"login": "Sathiyakugan", "name": "Sathiyakugan"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/454aad61e1e1eba5e0446d63bd49db7b42abf7c7", "committedDate": "2020-07-15T05:28:00Z", "message": "Add additional authentication related parameters to publish"}, "afterCommit": {"oid": "ed25e71b0cba74eade83573b46d7750f8b440747", "author": {"user": {"login": "Sathiyakugan", "name": "Sathiyakugan"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/ed25e71b0cba74eade83573b46d7750f8b440747", "committedDate": "2020-07-15T07:37:26Z", "message": "Add additional authentication related parameters to publish"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NzQzNTU2", "url": "https://github.com/wso2/carbon-identity-framework/pull/3017#pullrequestreview-448743556", "createdAt": "2020-07-15T08:35:57Z", "commit": {"oid": "ed25e71b0cba74eade83573b46d7750f8b440747"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwODozNTo1N1rOGx0CNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwODozNTo1N1rOGx0CNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDg4NTk0MA==", "bodyText": "enabling analyticsLoginDataPublisherV110 property is missing?", "url": "https://github.com/wso2/carbon-identity-framework/pull/3017#discussion_r454885940", "createdAt": "2020-07-15T08:35:57Z", "author": {"login": "nilasini"}, "path": "features/identity-event/org.wso2.carbon.identity.event.server.feature/resources/org.wso2.carbon.identity.event.server.feature.default.json", "diffHunk": "@@ -134,6 +134,8 @@\n     \"PRE_SET_CHALLENGE_QUESTION_ANSWERS\",\n     \"POST_SET_CHALLENGE_QUESTION_ANSWERS\"\n   ],\n+  \"identity_mgt.events.schemes.analyticsLoginDataPublisherV110.module_index\": \"22\",\n+  \"identity_mgt.events.schemes.analyticsLoginDataPublisherV110.subscriptions\": \"$ref{authentication.analytics.publish_authentication_event_types}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed25e71b0cba74eade83573b46d7750f8b440747"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ed25e71b0cba74eade83573b46d7750f8b440747", "author": {"user": {"login": "Sathiyakugan", "name": "Sathiyakugan"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/ed25e71b0cba74eade83573b46d7750f8b440747", "committedDate": "2020-07-15T07:37:26Z", "message": "Add additional authentication related parameters to publish"}, "afterCommit": {"oid": "3f2f7d1e88585a515f22c7c6bdf5ae07cc242814", "author": {"user": {"login": "Sathiyakugan", "name": "Sathiyakugan"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/3f2f7d1e88585a515f22c7c6bdf5ae07cc242814", "committedDate": "2020-07-15T09:34:12Z", "message": "Add additional authentication related parameters to publish"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7199b6ef5d88df549011bdaa279ecd6be46c8c8c", "author": {"user": {"login": "Sathiyakugan", "name": "Sathiyakugan"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/7199b6ef5d88df549011bdaa279ecd6be46c8c8c", "committedDate": "2020-07-15T09:36:55Z", "message": "Add additional authentication related parameters to publish"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3f2f7d1e88585a515f22c7c6bdf5ae07cc242814", "author": {"user": {"login": "Sathiyakugan", "name": "Sathiyakugan"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/3f2f7d1e88585a515f22c7c6bdf5ae07cc242814", "committedDate": "2020-07-15T09:34:12Z", "message": "Add additional authentication related parameters to publish"}, "afterCommit": {"oid": "7199b6ef5d88df549011bdaa279ecd6be46c8c8c", "author": {"user": {"login": "Sathiyakugan", "name": "Sathiyakugan"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/7199b6ef5d88df549011bdaa279ecd6be46c8c8c", "committedDate": "2020-07-15T09:36:55Z", "message": "Add additional authentication related parameters to publish"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4Nzk5NDgy", "url": "https://github.com/wso2/carbon-identity-framework/pull/3017#pullrequestreview-448799482", "createdAt": "2020-07-15T09:49:14Z", "commit": {"oid": "7199b6ef5d88df549011bdaa279ecd6be46c8c8c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1NzI0NzAy", "url": "https://github.com/wso2/carbon-identity-framework/pull/3017#pullrequestreview-505724702", "createdAt": "2020-10-09T14:28:17Z", "commit": {"oid": "7199b6ef5d88df549011bdaa279ecd6be46c8c8c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNDoyODoxN1rOHfMHwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNDoyODoxN1rOHfMHwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ2NjQ5OA==", "bodyText": "We can use a multiline comment here.", "url": "https://github.com/wso2/carbon-identity-framework/pull/3017#discussion_r502466498", "createdAt": "2020-10-09T14:28:17Z", "author": {"login": "ivantha"}, "path": "components/authentication-framework/org.wso2.carbon.identity.application.authentication.framework/src/main/java/org/wso2/carbon/identity/application/authentication/framework/AbstractApplicationAuthenticator.java", "diffHunk": "@@ -179,17 +187,32 @@ protected void publishAuthenticationStepAttempt(HttpServletRequest request, Auth\n             if (success) {\n                 authnDataPublisherProxy.publishAuthenticationStepSuccess(request, context,\n                         unmodifiableParamMap);\n+                // Resetting the authenticator start time to null since the step event is Success and for the next\n+                // step event start time will be added in DefaultStepHandler handle method.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7199b6ef5d88df549011bdaa279ecd6be46c8c8c"}, "originalPosition": 47}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1NzI0OTEy", "url": "https://github.com/wso2/carbon-identity-framework/pull/3017#pullrequestreview-505724912", "createdAt": "2020-10-09T14:28:32Z", "commit": {"oid": "7199b6ef5d88df549011bdaa279ecd6be46c8c8c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNDoyODozMlrOHfMIdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNDoyODozMlrOHfMIdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ2NjY3OA==", "bodyText": "Same as https://github.com/wso2/carbon-identity-framework/pull/3017/files#r502466498", "url": "https://github.com/wso2/carbon-identity-framework/pull/3017#discussion_r502466678", "createdAt": "2020-10-09T14:28:32Z", "author": {"login": "ivantha"}, "path": "components/authentication-framework/org.wso2.carbon.identity.application.authentication.framework/src/main/java/org/wso2/carbon/identity/application/authentication/framework/AbstractApplicationAuthenticator.java", "diffHunk": "@@ -179,17 +187,32 @@ protected void publishAuthenticationStepAttempt(HttpServletRequest request, Auth\n             if (success) {\n                 authnDataPublisherProxy.publishAuthenticationStepSuccess(request, context,\n                         unmodifiableParamMap);\n+                // Resetting the authenticator start time to null since the step event is Success and for the next\n+                // step event start time will be added in DefaultStepHandler handle method.\n+                context.setAnalyticsData(FrameworkConstants.AnalyticsData.CURRENT_AUTHENTICATOR_START_TIME, null);\n \n             } else {\n                 authnDataPublisherProxy.publishAuthenticationStepFailure(request, context,\n                         unmodifiableParamMap);\n+                // Resetting the authenticator start time to current time since the step event is failure and retrying\n+                // the event duration will be counted as a new step.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7199b6ef5d88df549011bdaa279ecd6be46c8c8c"}, "originalPosition": 54}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1NzI1NDk1", "url": "https://github.com/wso2/carbon-identity-framework/pull/3017#pullrequestreview-505725495", "createdAt": "2020-10-09T14:29:11Z", "commit": {"oid": "7199b6ef5d88df549011bdaa279ecd6be46c8c8c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNDoyOToxMVrOHfMKIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNDoyOToxMVrOHfMKIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ2NzEwNA==", "bodyText": "It is better to add a doc comment for this method even if it is private.", "url": "https://github.com/wso2/carbon-identity-framework/pull/3017#discussion_r502467104", "createdAt": "2020-10-09T14:29:11Z", "author": {"login": "ivantha"}, "path": "components/authentication-framework/org.wso2.carbon.identity.application.authentication.framework/src/main/java/org/wso2/carbon/identity/application/authentication/framework/AbstractApplicationAuthenticator.java", "diffHunk": "@@ -179,17 +187,32 @@ protected void publishAuthenticationStepAttempt(HttpServletRequest request, Auth\n             if (success) {\n                 authnDataPublisherProxy.publishAuthenticationStepSuccess(request, context,\n                         unmodifiableParamMap);\n+                // Resetting the authenticator start time to null since the step event is Success and for the next\n+                // step event start time will be added in DefaultStepHandler handle method.\n+                context.setAnalyticsData(FrameworkConstants.AnalyticsData.CURRENT_AUTHENTICATOR_START_TIME, null);\n \n             } else {\n                 authnDataPublisherProxy.publishAuthenticationStepFailure(request, context,\n                         unmodifiableParamMap);\n+                // Resetting the authenticator start time to current time since the step event is failure and retrying\n+                // the event duration will be counted as a new step.\n+                context.setAnalyticsData(\n+                        FrameworkConstants.AnalyticsData.CURRENT_AUTHENTICATOR_START_TIME, System.currentTimeMillis());\n             }\n         }\n     }\n \n+    private void publishAuthenticationStepAttemptFailure(HttpServletRequest request, AuthenticationContext context,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7199b6ef5d88df549011bdaa279ecd6be46c8c8c"}, "originalPosition": 61}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2233, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}