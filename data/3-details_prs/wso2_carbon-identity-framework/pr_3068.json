{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4NTYyMTM3", "number": 3068, "title": "Add user-functionality-mgt component.", "bodyText": "Proposed changes in this pull request\n\nIntroduce new component, user-functionality-mgt\nIntroduce a new service to manage the status of functions against a user.\n\nThe new service, \u201cUser Functionality Manager\u201d, would have the following APIs.\n\nlock(String userId, int tenantId, String functionalityIdentifier, long timeToLock, String functionalityLockReasonCode, String functionalityLockReason)\nTo lock a functionality for a certain user. This would set the lockStatus property for the FunctionalityLockStatus to be TRUE.\n\nlock(\"1acbed90-7e5f-44cd-b18f-00330df1a30c\", -1234, \"SecurityQuestionBasedPasswordRecovery\", 300000, \"PWR-10006\", \"Exceeded maximum attempts\")\n\n\ngetLockStatus(String userId, int tenantId, String functionalityIdentifier) : FunctionalityLockStatus\nWould return the FunctionalityLockStatus for user. FunctionalityLockStatus object would have the lockStatus, unlockTime, LockReasonCode and the LockReason.\n\ngetLockStatus(\"1acbed90-7e5f-44cd-b18f-00330df1a30c\", -1234, \"SecurityQuestionBasedPasswordRecovery\")\n\nreturns FunctionalityLockStatus object for the functionality \"SecurityQuestionBasedPasswordRecovery\", for user \"1acbed90-7e5f-44cd-b18f-00330df1a30c\".\n\nFunctionalityLockStatus:\nlockStatus: true\nunlockTime: 1592149491\nLockReasonCode: \"PWR-10006\"\nLockReason: \"Exceeded maximum attempts\"\n\n\nunlock(String userId, int tenantId, String functionalityIdentifier)\nWould unlock the functionality for a user.\n\nunlock(\"1acbed90-7e5f-44cd-b18f-00330df1a30c\", -1234, \"SecurityQuestionBasedPasswordRecovery\")\n\nUnlocks the functionality, \"SecurityQuestionBasedPasswordRecovery\" for user, \"1acbed90-7e5f-44cd-b18f-00330df1a30c\".\n\n\ngetProperties(String userId, int tenantId, String functionalityIdentifier) : Map<String, String>\nReturns the properties of the user-functionality mapping. These properties may include invalid attempts counts, functionality lockout counts, etc.\n\ngetProperties(\"1acbed90-7e5f-44cd-b18f-00330df1a30c\", -1234, \"SecurityQuestionBasedPasswordRecovery\")\n\nReturns a <String, String> Map of the properties of the functionality of \"SecurityQuestionBasedPasswordRecovery\" for user, \"1acbed90-7e5f-44cd-b18f-00330df1a30c\".\n\nfunctionality properties:\n\"currentAttempts\": \"3\"\n\"lockoutCount\": \"1\"\n\n\nsetProperties(String userId, int tenantId, String functionalityIdentifier, Map<String, String> functionalityLockProperties)\nSet the properties of the user-functionality mapping. These properties may include invalid attempts counts, functionality lockout counts, etc.\n\nsetProperties(\"1acbed90-7e5f-44cd-b18f-00330df1a30c\", -1234, \"SecurityQuestionBasedPasswordRecovery\", functionalityLockProperties)\n\nfunctionalityLockProperties:\n\"currentAttempts\": \"5\"\n\"lockoutCount\": \"2\"\n\n\ndeleteAllPropertiesForUser(String userId, int tenantId, String functionalityIdentifier)\nDeletes all the properties that are related to a certain user-functionality mapping identified by the user id, tenant id and the functionality identifier.\n\ndeleteAllPropertiesForUser(\"1acbed90-7e5f-44cd-b18f-00330df1a30c\", -1234, \"SecurityQuestionBasedPasswordRecovery\")\n\nDeletes all the functionality properties of  \"SecurityQuestionBasedPasswordRecovery\" for user \"1acbed90-7e5f-44cd-b18f-00330df1a30c\". \n\n\ndeletePropertiesForUser(String userId, int tenantId, String functionalityIdentifier, Set propertiesToDelete)\nDeletes a certain list of properties indicated by the propertiesToDelete set that are related to a certain user-functionality mapping identified by the user id, tenant id and the functionality identifier.\n\ndeletePropertiesForUser(\"1acbed90-7e5f-44cd-b18f-00330df1a30c\", -1234, \"SecurityQuestionBasedPasswordRecovery\", propertiesToDelete)\n\nDeletes a set of functionality properties of  \"SecurityQuestionBasedPasswordRecovery\" for user \"1acbed90-7e5f-44cd-b18f-00330df1a30c\". \n\nSet<String> propertiesToDelete:\n\"currentAttempts\"\n\n\ndeleteAllMappingsForTenant(int tenantId)\nDeletes all the user-functionality mappings of a tenant.\n\ndeleteAllMappingsForTenant(-1234)\n\n\ndeleteAllPropertiesForTenant(int tenantId)\nDeletes all the per-user functionality properties for a tenant.\n\ndeleteAllPropertiesForTenant(-1234)\n\nIntroduce the configuration, \u201cenable_per_user_functionality_locking\u201d in the deployment.toml.\nBy default, this configuration would be set to true.\nWhen the configuration is set to true, The new service, \u201cUserFunctionalityManager\u201d, could be invoked at instances where there is a need to lock a certain functionality for a user.\nRelated Issues\nwso2/product-is#1935", "createdAt": "2020-08-17T03:47:06Z", "url": "https://github.com/wso2/carbon-identity-framework/pull/3068", "merged": true, "mergeCommit": {"oid": "934ab4719c7920298a029f5808308d5982ab5fca"}, "closed": true, "closedAt": "2020-08-31T10:06:02Z", "author": {"login": "chamathns"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc_qGHMAH2gAyNDY4NTYyMTM3OmI4MTYyNmU4Mjk0OGNmYWJmZTRhY2E2ODFiYjI4ODBlMzRhOWIzYmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdEP1mLgFqTQ3ODQ3NjE4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b81626e82948cfabfe4aca681bb2880e34a9b3ba", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/b81626e82948cfabfe4aca681bb2880e34a9b3ba", "committedDate": "2020-08-17T03:46:00Z", "message": "Add user-functionality-mgt component."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4MTY4NTk1", "url": "https://github.com/wso2/carbon-identity-framework/pull/3068#pullrequestreview-468168595", "createdAt": "2020-08-17T05:16:18Z", "commit": {"oid": "b81626e82948cfabfe4aca681bb2880e34a9b3ba"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d11b9b60ba1bd96dc451b5c7b24cea28eaf6b3f1", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/d11b9b60ba1bd96dc451b5c7b24cea28eaf6b3f1", "committedDate": "2020-08-18T08:53:34Z", "message": "Merge branch 'master' of https://github.com/wso2/carbon-identity-framework into user-functionality-mgt-patch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c11fceeb405e08baf8f4160a7161a4f60aeeb7f1", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/c11fceeb405e08baf8f4160a7161a4f60aeeb7f1", "committedDate": "2020-08-18T08:56:37Z", "message": "update dependencies for user-functionality-mgt component."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwMDg4NTQ2", "url": "https://github.com/wso2/carbon-identity-framework/pull/3068#pullrequestreview-470088546", "createdAt": "2020-08-19T02:50:29Z", "commit": {"oid": "c11fceeb405e08baf8f4160a7161a4f60aeeb7f1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwMjo1MDoyOVrOHCuPoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwMjo1MDoyOVrOHCuPoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjYxNjg2NA==", "bodyText": "Shouldn't we have this enabled by default?", "url": "https://github.com/wso2/carbon-identity-framework/pull/3068#discussion_r472616864", "createdAt": "2020-08-19T02:50:29Z", "author": {"login": "mefarazath"}, "path": "features/identity-core/org.wso2.carbon.identity.core.server.feature/resources/org.wso2.carbon.identity.core.server.feature.default.json", "diffHunk": "@@ -456,6 +457,7 @@\n   \"resource_access_control.scim2_me_post_method.keep_resource\": true,\n \n   \"user.association.enable_for_federated_users\": false,\n+  \"user.enable_per_user_functionality_locking\": false,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c11fceeb405e08baf8f4160a7161a4f60aeeb7f1"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwMDg5NDU3", "url": "https://github.com/wso2/carbon-identity-framework/pull/3068#pullrequestreview-470089457", "createdAt": "2020-08-19T02:53:42Z", "commit": {"oid": "c11fceeb405e08baf8f4160a7161a4f60aeeb7f1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwMjo1Mzo0MlrOHCuXyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwMjo1Mzo0MlrOHCuXyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjYxODk1Mw==", "bodyText": "Why do we need this static variable?", "url": "https://github.com/wso2/carbon-identity-framework/pull/3068#discussion_r472618953", "createdAt": "2020-08-19T02:53:42Z", "author": {"login": "mefarazath"}, "path": "components/user-functionality-mgt/org.wso2.carbon.identity.user.functionality.mgt/src/main/java/org/wso2/carbon/identity/user/functionality/mgt/model/FunctionalityLockStatus.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.user.functionality.mgt.model;\n+\n+/**\n+ * A data model class to define the functionality lock status element.\n+ */\n+public class FunctionalityLockStatus {\n+\n+    public static final FunctionalityLockStatus UNLOCKED_STATUS = new FunctionalityLockStatus(false, 0, null, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c11fceeb405e08baf8f4160a7161a4f60aeeb7f1"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "faa532a1bc453c66bfd89afda06a8e91d812ac06", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/faa532a1bc453c66bfd89afda06a8e91d812ac06", "committedDate": "2020-08-19T06:21:00Z", "message": "Merge branch 'master' of https://github.com/wso2/carbon-identity-framework into user-functionality-mgt-patch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "070f6a447843fda5466793249c8b0ece83405edd", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/070f6a447843fda5466793249c8b0ece83405edd", "committedDate": "2020-08-19T06:22:59Z", "message": "update dependencies for user-functionality-mgt component."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "073a4d94ee356bae1c50a0a82cbf1c3700e82994", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/073a4d94ee356bae1c50a0a82cbf1c3700e82994", "committedDate": "2020-08-21T03:53:16Z", "message": "Merge branch 'master' of https://github.com/wso2/carbon-identity-framework into user-functionality-mgt-patch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09bc825b878792bdebcb12c4192dbbcb0eda64c6", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/09bc825b878792bdebcb12c4192dbbcb0eda64c6", "committedDate": "2020-08-21T03:59:10Z", "message": "update dependencies for user-functionality-mgt component."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3641437ebf81d2b4bbc1d7c4df7ac1ac01f8b110", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/3641437ebf81d2b4bbc1d7c4df7ac1ac01f8b110", "committedDate": "2020-08-21T03:59:48Z", "message": "enable per-user functionality mgt by default"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "867a99f03b21653d5a469ca02998e916ee293bda", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/867a99f03b21653d5a469ca02998e916ee293bda", "committedDate": "2020-08-24T15:22:07Z", "message": "Merge branch 'master' of https://github.com/wso2/carbon-identity-framework into user-functionality-mgt-patch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d34ded57c1adfd17a15599f5b1552aefba2f746", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/4d34ded57c1adfd17a15599f5b1552aefba2f746", "committedDate": "2020-08-25T06:13:37Z", "message": "update dependencies for user-functionality-mgt component."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3186ec35e294c52f1ed5858dabd671c590cff769", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/3186ec35e294c52f1ed5858dabd671c590cff769", "committedDate": "2020-08-26T05:21:51Z", "message": "Merge branch 'master' of https://github.com/wso2/carbon-identity-framework into user-functionality-mgt-patch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9eb37e5d4cd4aae6615634f1610fee10c3e387b3", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/9eb37e5d4cd4aae6615634f1610fee10c3e387b3", "committedDate": "2020-08-30T06:56:52Z", "message": "Merge branch 'master' of https://github.com/wso2/carbon-identity-framework into user-functionality-mgt-patch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88e85505d57ddb87c98125193df14115db60c7af", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/88e85505d57ddb87c98125193df14115db60c7af", "committedDate": "2020-08-31T06:48:04Z", "message": "update dependencies"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4NDY2NjA4", "url": "https://github.com/wso2/carbon-identity-framework/pull/3068#pullrequestreview-478466608", "createdAt": "2020-08-31T09:44:27Z", "commit": {"oid": "88e85505d57ddb87c98125193df14115db60c7af"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4NDc2MTg5", "url": "https://github.com/wso2/carbon-identity-framework/pull/3068#pullrequestreview-478476189", "createdAt": "2020-08-31T10:00:03Z", "commit": {"oid": "88e85505d57ddb87c98125193df14115db60c7af"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2254, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}