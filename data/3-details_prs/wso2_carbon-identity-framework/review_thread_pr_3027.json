{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU1NjI1MDk2", "number": 3027, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxMjoyNzo1OFrOERzc8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMjoyMzo1N1rOEkB5SQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg3MTA0MjQzOnYy", "diffSide": "RIGHT", "path": "components/identity-core/org.wso2.carbon.identity.base/src/main/java/org/wso2/carbon/identity/base/IdentityConstants.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxMjoyNzo1OFrOG2teZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNlQxMzoyNjowN1rOG3MYjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDAyMTM0OA==", "bodyText": "let;s make the constructor of this class private", "url": "https://github.com/wso2/carbon-identity-framework/pull/3027#discussion_r460021348", "createdAt": "2020-07-24T12:27:58Z", "author": {"login": "emswbandara"}, "path": "components/identity-core/org.wso2.carbon.identity.base/src/main/java/org/wso2/carbon/identity/base/IdentityConstants.java", "diffHunk": "@@ -513,4 +513,16 @@ private IdentityConstants() {\n         public static final String MAX_AGE = \"CORS.MaxAge\";\n         public static final String TAG_REQUESTS = \"CORS.TagRequests\";\n     }\n+\n+    /**\n+     * Contains the constants related to Legacy Feature config elements.\n+     */\n+    public static class LegacyFeatureConfigElements {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64fcfeee2bf79f05de345706ce2aa327df885978"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDUyNzc1Nw==", "bodyText": "Why do we need to make this constructor private? I need to access this constructor from out of this package.", "url": "https://github.com/wso2/carbon-identity-framework/pull/3027#discussion_r460527757", "createdAt": "2020-07-26T13:26:07Z", "author": {"login": "GANGANI"}, "path": "components/identity-core/org.wso2.carbon.identity.base/src/main/java/org/wso2/carbon/identity/base/IdentityConstants.java", "diffHunk": "@@ -513,4 +513,16 @@ private IdentityConstants() {\n         public static final String MAX_AGE = \"CORS.MaxAge\";\n         public static final String TAG_REQUESTS = \"CORS.TagRequests\";\n     }\n+\n+    /**\n+     * Contains the constants related to Legacy Feature config elements.\n+     */\n+    public static class LegacyFeatureConfigElements {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDAyMTM0OA=="}, "originalCommit": {"oid": "64fcfeee2bf79f05de345706ce2aa327df885978"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg3MTA5NTI3OnYy", "diffSide": "RIGHT", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/util/IdentityConfigParser.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxMjo0NToyMVrOG2t-gg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNlQxMzoyNjozM1rOG3MYrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDAyOTU3MA==", "bodyText": "shouldn't this be <LegacyFeature>", "url": "https://github.com/wso2/carbon-identity-framework/pull/3027#discussion_r460029570", "createdAt": "2020-07-24T12:45:21Z", "author": {"login": "emswbandara"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/util/IdentityConfigParser.java", "diffHunk": "@@ -374,6 +386,60 @@ private void buildCookieConfig()    {\n         }\n     }\n \n+    public void buildLegacyFeatureConfig() {\n+\n+        LegacyFeatureConfig legacyFeatureConfig;\n+        OMElement legacyFeaturesConfigElement =\n+                this.getConfigElement(IdentityConstants.LegacyFeatureConfigElements.LEGACY_FEATURE_CONFIG);\n+        if (legacyFeaturesConfigElement != null) {\n+\n+            int legacyFeaturesConfigElementIndex = 0;\n+            Iterator<OMElement> legacyFeatures = legacyFeaturesConfigElement.\n+                    getChildrenWithName(getQNameWithIdentityNS(IdentityConstants.\n+                            LegacyFeatureConfigElements.LEGACY_FEATURE));\n+            if (legacyFeatures != null) {\n+                while (legacyFeatures.hasNext()) {\n+                    legacyFeaturesConfigElementIndex += 1;\n+                    OMElement legacyFeature = legacyFeatures.next();\n+\n+                    OMElement legacyFeatureIdElement = legacyFeature.getFirstChildWithName(getQNameWithIdentityNS(\n+                            IdentityConstants.LegacyFeatureConfigElements.LEGACY_FEATURE_ID));\n+                    OMElement legacyFeatureVersionElement = legacyFeature.getFirstChildWithName(getQNameWithIdentityNS(\n+                            IdentityConstants.LegacyFeatureConfigElements.LEGACY_FEATURE_VERSION));\n+                    OMElement legacyFeatureEnableElement = legacyFeature.getFirstChildWithName(getQNameWithIdentityNS(\n+                            IdentityConstants.LegacyFeatureConfigElements.LEGACY_FEATURE_ENABLE));\n+\n+                    String legacyFeatureId;\n+                    String legacyFeatureVersion;\n+                    boolean isLegacyFeatureEnable = false;\n+                    if (legacyFeatureIdElement != null && legacyFeatureVersionElement != null\n+                            && legacyFeatureEnableElement != null) {\n+                        legacyFeatureId = legacyFeatureIdElement.getText();\n+                        if (StringUtils.isNotBlank(legacyFeatureId)) {\n+                            legacyFeatureId = legacyFeatureId.trim();\n+                        }\n+                        legacyFeatureVersion = legacyFeatureVersionElement.getText();\n+                        if (StringUtils.isNotBlank(legacyFeatureVersion)) {\n+                            legacyFeatureVersion = legacyFeatureVersion.trim();\n+                        }\n+                        String legacyFeatureEnable = legacyFeatureEnableElement.getText();\n+                        if (StringUtils.isNotBlank(legacyFeatureEnable)) {\n+                            isLegacyFeatureEnable = Boolean.parseBoolean(legacyFeatureEnable.trim());\n+                        }\n+\n+                        String legacyFeatureConfigKey = legacyFeatureId + legacyFeatureVersion;\n+                        legacyFeatureConfig = new LegacyFeatureConfig(legacyFeatureId, legacyFeatureVersion,\n+                                isLegacyFeatureEnable);\n+                        legacyFeatureConfigurationHolder.put(legacyFeatureConfigKey, legacyFeatureConfig);\n+                    } else {\n+                        log.warn(\"Configured <Feature> element at index: \" + legacyFeaturesConfigElementIndex +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64fcfeee2bf79f05de345706ce2aa327df885978"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDUyNzc5MQ==", "bodyText": "Fixed 76ad8e0", "url": "https://github.com/wso2/carbon-identity-framework/pull/3027#discussion_r460527791", "createdAt": "2020-07-26T13:26:33Z", "author": {"login": "GANGANI"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/util/IdentityConfigParser.java", "diffHunk": "@@ -374,6 +386,60 @@ private void buildCookieConfig()    {\n         }\n     }\n \n+    public void buildLegacyFeatureConfig() {\n+\n+        LegacyFeatureConfig legacyFeatureConfig;\n+        OMElement legacyFeaturesConfigElement =\n+                this.getConfigElement(IdentityConstants.LegacyFeatureConfigElements.LEGACY_FEATURE_CONFIG);\n+        if (legacyFeaturesConfigElement != null) {\n+\n+            int legacyFeaturesConfigElementIndex = 0;\n+            Iterator<OMElement> legacyFeatures = legacyFeaturesConfigElement.\n+                    getChildrenWithName(getQNameWithIdentityNS(IdentityConstants.\n+                            LegacyFeatureConfigElements.LEGACY_FEATURE));\n+            if (legacyFeatures != null) {\n+                while (legacyFeatures.hasNext()) {\n+                    legacyFeaturesConfigElementIndex += 1;\n+                    OMElement legacyFeature = legacyFeatures.next();\n+\n+                    OMElement legacyFeatureIdElement = legacyFeature.getFirstChildWithName(getQNameWithIdentityNS(\n+                            IdentityConstants.LegacyFeatureConfigElements.LEGACY_FEATURE_ID));\n+                    OMElement legacyFeatureVersionElement = legacyFeature.getFirstChildWithName(getQNameWithIdentityNS(\n+                            IdentityConstants.LegacyFeatureConfigElements.LEGACY_FEATURE_VERSION));\n+                    OMElement legacyFeatureEnableElement = legacyFeature.getFirstChildWithName(getQNameWithIdentityNS(\n+                            IdentityConstants.LegacyFeatureConfigElements.LEGACY_FEATURE_ENABLE));\n+\n+                    String legacyFeatureId;\n+                    String legacyFeatureVersion;\n+                    boolean isLegacyFeatureEnable = false;\n+                    if (legacyFeatureIdElement != null && legacyFeatureVersionElement != null\n+                            && legacyFeatureEnableElement != null) {\n+                        legacyFeatureId = legacyFeatureIdElement.getText();\n+                        if (StringUtils.isNotBlank(legacyFeatureId)) {\n+                            legacyFeatureId = legacyFeatureId.trim();\n+                        }\n+                        legacyFeatureVersion = legacyFeatureVersionElement.getText();\n+                        if (StringUtils.isNotBlank(legacyFeatureVersion)) {\n+                            legacyFeatureVersion = legacyFeatureVersion.trim();\n+                        }\n+                        String legacyFeatureEnable = legacyFeatureEnableElement.getText();\n+                        if (StringUtils.isNotBlank(legacyFeatureEnable)) {\n+                            isLegacyFeatureEnable = Boolean.parseBoolean(legacyFeatureEnable.trim());\n+                        }\n+\n+                        String legacyFeatureConfigKey = legacyFeatureId + legacyFeatureVersion;\n+                        legacyFeatureConfig = new LegacyFeatureConfig(legacyFeatureId, legacyFeatureVersion,\n+                                isLegacyFeatureEnable);\n+                        legacyFeatureConfigurationHolder.put(legacyFeatureConfigKey, legacyFeatureConfig);\n+                    } else {\n+                        log.warn(\"Configured <Feature> element at index: \" + legacyFeaturesConfigElementIndex +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDAyOTU3MA=="}, "originalCommit": {"oid": "64fcfeee2bf79f05de345706ce2aa327df885978"}, "originalPosition": 90}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg3MTEwMDk3OnYy", "diffSide": "RIGHT", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/util/IdentityUtil.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxMjo0NzowOVrOG2uCCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNlQxMzoyODoyOVrOG3MZhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDAzMDQ3NA==", "bodyText": "add nullcheck on legacyFeatureId and legacyFeatureVersion. If Id is null, return. However feature version can be allowed to be null in the case of identity/connect/dcr. That should be handled properly", "url": "https://github.com/wso2/carbon-identity-framework/pull/3027#discussion_r460030474", "createdAt": "2020-07-24T12:47:09Z", "author": {"login": "emswbandara"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/util/IdentityUtil.java", "diffHunk": "@@ -214,11 +216,41 @@ public static IdentityCookieConfig getIdentityCookieConfig(String cookieName) {\n         return identityCookiesConfigurationHolder;\n     }\n \n+    /**\n+     * This method can use to check whether the legacy feature for the given legacy feature id is enabled or not\n+     *\n+     * @param legacyFeatureId      Legacy feature id.\n+     * @param legacyFeatureVersion Legacy feature version.\n+     * @return Whether the legacy feature is enabled or not.\n+     */\n+    public static boolean isLegacyFeatureEnabled(String legacyFeatureId, String legacyFeatureVersion) {\n+\n+        String legacyFeatureConfig = legacyFeatureId.trim() + legacyFeatureVersion.trim();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64fcfeee2bf79f05de345706ce2aa327df885978"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDUyODAwNw==", "bodyText": "Fixed 76ad8e0", "url": "https://github.com/wso2/carbon-identity-framework/pull/3027#discussion_r460528007", "createdAt": "2020-07-26T13:28:29Z", "author": {"login": "GANGANI"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/util/IdentityUtil.java", "diffHunk": "@@ -214,11 +216,41 @@ public static IdentityCookieConfig getIdentityCookieConfig(String cookieName) {\n         return identityCookiesConfigurationHolder;\n     }\n \n+    /**\n+     * This method can use to check whether the legacy feature for the given legacy feature id is enabled or not\n+     *\n+     * @param legacyFeatureId      Legacy feature id.\n+     * @param legacyFeatureVersion Legacy feature version.\n+     * @return Whether the legacy feature is enabled or not.\n+     */\n+    public static boolean isLegacyFeatureEnabled(String legacyFeatureId, String legacyFeatureVersion) {\n+\n+        String legacyFeatureConfig = legacyFeatureId.trim() + legacyFeatureVersion.trim();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDAzMDQ3NA=="}, "originalCommit": {"oid": "64fcfeee2bf79f05de345706ce2aa327df885978"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg3MTEwNDMyOnYy", "diffSide": "RIGHT", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/util/IdentityUtil.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxMjo0ODoxNlrOG2uEGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNlQxMzoyNzo1NFrOG3MZRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDAzMTAwMQ==", "bodyText": "let's log the version also", "url": "https://github.com/wso2/carbon-identity-framework/pull/3027#discussion_r460031001", "createdAt": "2020-07-24T12:48:16Z", "author": {"login": "emswbandara"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/util/IdentityUtil.java", "diffHunk": "@@ -214,11 +216,41 @@ public static IdentityCookieConfig getIdentityCookieConfig(String cookieName) {\n         return identityCookiesConfigurationHolder;\n     }\n \n+    /**\n+     * This method can use to check whether the legacy feature for the given legacy feature id is enabled or not\n+     *\n+     * @param legacyFeatureId      Legacy feature id.\n+     * @param legacyFeatureVersion Legacy feature version.\n+     * @return Whether the legacy feature is enabled or not.\n+     */\n+    public static boolean isLegacyFeatureEnabled(String legacyFeatureId, String legacyFeatureVersion) {\n+\n+        String legacyFeatureConfig = legacyFeatureId.trim() + legacyFeatureVersion.trim();\n+        if (StringUtils.isNotBlank(legacyFeatureConfig)) {\n+            LegacyFeatureConfig legacyFeatureConfiguration =\n+                    legacyFeatureConfigurationHolder.get(legacyFeatureConfig);\n+            if (legacyFeatureConfiguration != null && legacyFeatureConfiguration.isEnabled()) {\n+                if (log.isDebugEnabled()) {\n+                    log.debug(\"Legacy feature id: \" + legacyFeatureConfiguration.getId() +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64fcfeee2bf79f05de345706ce2aa327df885978"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDUyNzk0Mg==", "bodyText": "Fixed 76ad8e0", "url": "https://github.com/wso2/carbon-identity-framework/pull/3027#discussion_r460527942", "createdAt": "2020-07-26T13:27:54Z", "author": {"login": "GANGANI"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/util/IdentityUtil.java", "diffHunk": "@@ -214,11 +216,41 @@ public static IdentityCookieConfig getIdentityCookieConfig(String cookieName) {\n         return identityCookiesConfigurationHolder;\n     }\n \n+    /**\n+     * This method can use to check whether the legacy feature for the given legacy feature id is enabled or not\n+     *\n+     * @param legacyFeatureId      Legacy feature id.\n+     * @param legacyFeatureVersion Legacy feature version.\n+     * @return Whether the legacy feature is enabled or not.\n+     */\n+    public static boolean isLegacyFeatureEnabled(String legacyFeatureId, String legacyFeatureVersion) {\n+\n+        String legacyFeatureConfig = legacyFeatureId.trim() + legacyFeatureVersion.trim();\n+        if (StringUtils.isNotBlank(legacyFeatureConfig)) {\n+            LegacyFeatureConfig legacyFeatureConfiguration =\n+                    legacyFeatureConfigurationHolder.get(legacyFeatureConfig);\n+            if (legacyFeatureConfiguration != null && legacyFeatureConfiguration.isEnabled()) {\n+                if (log.isDebugEnabled()) {\n+                    log.debug(\"Legacy feature id: \" + legacyFeatureConfiguration.getId() +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDAzMTAwMQ=="}, "originalCommit": {"oid": "64fcfeee2bf79f05de345706ce2aa327df885978"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg3MTEwNzcwOnYy", "diffSide": "RIGHT", "path": "features/identity-core/org.wso2.carbon.identity.core.server.feature/resources/identity.xml.j2", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxMjo0OToyN1rOG2uGOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNlQxMzoyODoxMVrOG3MZWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDAzMTU0Nw==", "bodyText": "dont't we need to add the default set of features that we decided to deprecate to default.json?", "url": "https://github.com/wso2/carbon-identity-framework/pull/3027#discussion_r460031547", "createdAt": "2020-07-24T12:49:27Z", "author": {"login": "emswbandara"}, "path": "features/identity-core/org.wso2.carbon.identity.core.server.feature/resources/identity.xml.j2", "diffHunk": "@@ -2223,4 +2223,14 @@\n         <MaxAge>{{cors.max_age}}</MaxAge>\n         <TagRequests>{{cors.tag_requests}}</TagRequests>\n     </CORS>\n+\n+    <LegacyFeatures>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64fcfeee2bf79f05de345706ce2aa327df885978"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDUyNzk2MQ==", "bodyText": "Fixed 76ad8e0", "url": "https://github.com/wso2/carbon-identity-framework/pull/3027#discussion_r460527961", "createdAt": "2020-07-26T13:28:11Z", "author": {"login": "GANGANI"}, "path": "features/identity-core/org.wso2.carbon.identity.core.server.feature/resources/identity.xml.j2", "diffHunk": "@@ -2223,4 +2223,14 @@\n         <MaxAge>{{cors.max_age}}</MaxAge>\n         <TagRequests>{{cors.tag_requests}}</TagRequests>\n     </CORS>\n+\n+    <LegacyFeatures>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDAzMTU0Nw=="}, "originalCommit": {"oid": "64fcfeee2bf79f05de345706ce2aa327df885978"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNjM3MzA1OnYy", "diffSide": "RIGHT", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/util/IdentityConfigParser.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNVQxNzoxODozM1rOHNjLgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQxMTowOTo1N1rOHQ0cXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzk2OTkyMg==", "bodyText": "Java doc comment for a public method missing", "url": "https://github.com/wso2/carbon-identity-framework/pull/3027#discussion_r483969922", "createdAt": "2020-09-05T17:18:33Z", "author": {"login": "senthalan"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/util/IdentityConfigParser.java", "diffHunk": "@@ -374,6 +386,60 @@ private void buildCookieConfig()    {\n         }\n     }\n \n+    public void buildLegacyFeatureConfig() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76ad8e0307b509aefc1c7e7716756ad143850105"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM5ODQ5NA==", "bodyText": "Fixed 0b1c211", "url": "https://github.com/wso2/carbon-identity-framework/pull/3027#discussion_r487398494", "createdAt": "2020-09-12T11:09:57Z", "author": {"login": "GANGANI"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/util/IdentityConfigParser.java", "diffHunk": "@@ -374,6 +386,60 @@ private void buildCookieConfig()    {\n         }\n     }\n \n+    public void buildLegacyFeatureConfig() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzk2OTkyMg=="}, "originalCommit": {"oid": "76ad8e0307b509aefc1c7e7716756ad143850105"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0ODcyODgxOnYy", "diffSide": "RIGHT", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/util/IdentityConfigParser.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQwNjowMDo0NFrOHQy69w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQxMTowNjozMlrOHQ0bWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM3MzU1OQ==", "bodyText": "wasn't better to add a seperater between the feature id and version.", "url": "https://github.com/wso2/carbon-identity-framework/pull/3027#discussion_r487373559", "createdAt": "2020-09-12T06:00:44Z", "author": {"login": "senthalan"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/util/IdentityConfigParser.java", "diffHunk": "@@ -374,6 +386,60 @@ private void buildCookieConfig()    {\n         }\n     }\n \n+    public void buildLegacyFeatureConfig() {\n+\n+        LegacyFeatureConfig legacyFeatureConfig;\n+        OMElement legacyFeaturesConfigElement =\n+                this.getConfigElement(IdentityConstants.LegacyFeatureConfigElements.LEGACY_FEATURE_CONFIG);\n+        if (legacyFeaturesConfigElement != null) {\n+\n+            int legacyFeaturesConfigElementIndex = 0;\n+            Iterator<OMElement> legacyFeatures = legacyFeaturesConfigElement.\n+                    getChildrenWithName(getQNameWithIdentityNS(IdentityConstants.\n+                            LegacyFeatureConfigElements.LEGACY_FEATURE));\n+            if (legacyFeatures != null) {\n+                while (legacyFeatures.hasNext()) {\n+                    legacyFeaturesConfigElementIndex += 1;\n+                    OMElement legacyFeature = legacyFeatures.next();\n+\n+                    OMElement legacyFeatureIdElement = legacyFeature.getFirstChildWithName(getQNameWithIdentityNS(\n+                            IdentityConstants.LegacyFeatureConfigElements.LEGACY_FEATURE_ID));\n+                    OMElement legacyFeatureVersionElement = legacyFeature.getFirstChildWithName(getQNameWithIdentityNS(\n+                            IdentityConstants.LegacyFeatureConfigElements.LEGACY_FEATURE_VERSION));\n+                    OMElement legacyFeatureEnableElement = legacyFeature.getFirstChildWithName(getQNameWithIdentityNS(\n+                            IdentityConstants.LegacyFeatureConfigElements.LEGACY_FEATURE_ENABLE));\n+\n+                    String legacyFeatureId;\n+                    String legacyFeatureVersion;\n+                    boolean isLegacyFeatureEnable = false;\n+                    if (legacyFeatureIdElement != null && legacyFeatureVersionElement != null\n+                            && legacyFeatureEnableElement != null) {\n+                        legacyFeatureId = legacyFeatureIdElement.getText();\n+                        if (StringUtils.isNotBlank(legacyFeatureId)) {\n+                            legacyFeatureId = legacyFeatureId.trim();\n+                        }\n+                        legacyFeatureVersion = legacyFeatureVersionElement.getText();\n+                        if (StringUtils.isNotBlank(legacyFeatureVersion)) {\n+                            legacyFeatureVersion = legacyFeatureVersion.trim();\n+                        }\n+                        String legacyFeatureEnable = legacyFeatureEnableElement.getText();\n+                        if (StringUtils.isNotBlank(legacyFeatureEnable)) {\n+                            isLegacyFeatureEnable = Boolean.parseBoolean(legacyFeatureEnable.trim());\n+                        }\n+\n+                        String legacyFeatureConfigKey = legacyFeatureId + legacyFeatureVersion;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76ad8e0307b509aefc1c7e7716756ad143850105"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM5ODIzNQ==", "bodyText": "In https://github.com/GANGANI/carbon-identity-framework/blob/76ad8e0307b509aefc1c7e7716756ad143850105/components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/util/IdentityUtil.java#L228-L236, this Map value was used. Since some configs do not have a feature version, adding a separator would not be appropriate when retrieving the value from the Map. WDYT?", "url": "https://github.com/wso2/carbon-identity-framework/pull/3027#discussion_r487398235", "createdAt": "2020-09-12T11:06:32Z", "author": {"login": "GANGANI"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/util/IdentityConfigParser.java", "diffHunk": "@@ -374,6 +386,60 @@ private void buildCookieConfig()    {\n         }\n     }\n \n+    public void buildLegacyFeatureConfig() {\n+\n+        LegacyFeatureConfig legacyFeatureConfig;\n+        OMElement legacyFeaturesConfigElement =\n+                this.getConfigElement(IdentityConstants.LegacyFeatureConfigElements.LEGACY_FEATURE_CONFIG);\n+        if (legacyFeaturesConfigElement != null) {\n+\n+            int legacyFeaturesConfigElementIndex = 0;\n+            Iterator<OMElement> legacyFeatures = legacyFeaturesConfigElement.\n+                    getChildrenWithName(getQNameWithIdentityNS(IdentityConstants.\n+                            LegacyFeatureConfigElements.LEGACY_FEATURE));\n+            if (legacyFeatures != null) {\n+                while (legacyFeatures.hasNext()) {\n+                    legacyFeaturesConfigElementIndex += 1;\n+                    OMElement legacyFeature = legacyFeatures.next();\n+\n+                    OMElement legacyFeatureIdElement = legacyFeature.getFirstChildWithName(getQNameWithIdentityNS(\n+                            IdentityConstants.LegacyFeatureConfigElements.LEGACY_FEATURE_ID));\n+                    OMElement legacyFeatureVersionElement = legacyFeature.getFirstChildWithName(getQNameWithIdentityNS(\n+                            IdentityConstants.LegacyFeatureConfigElements.LEGACY_FEATURE_VERSION));\n+                    OMElement legacyFeatureEnableElement = legacyFeature.getFirstChildWithName(getQNameWithIdentityNS(\n+                            IdentityConstants.LegacyFeatureConfigElements.LEGACY_FEATURE_ENABLE));\n+\n+                    String legacyFeatureId;\n+                    String legacyFeatureVersion;\n+                    boolean isLegacyFeatureEnable = false;\n+                    if (legacyFeatureIdElement != null && legacyFeatureVersionElement != null\n+                            && legacyFeatureEnableElement != null) {\n+                        legacyFeatureId = legacyFeatureIdElement.getText();\n+                        if (StringUtils.isNotBlank(legacyFeatureId)) {\n+                            legacyFeatureId = legacyFeatureId.trim();\n+                        }\n+                        legacyFeatureVersion = legacyFeatureVersionElement.getText();\n+                        if (StringUtils.isNotBlank(legacyFeatureVersion)) {\n+                            legacyFeatureVersion = legacyFeatureVersion.trim();\n+                        }\n+                        String legacyFeatureEnable = legacyFeatureEnableElement.getText();\n+                        if (StringUtils.isNotBlank(legacyFeatureEnable)) {\n+                            isLegacyFeatureEnable = Boolean.parseBoolean(legacyFeatureEnable.trim());\n+                        }\n+\n+                        String legacyFeatureConfigKey = legacyFeatureId + legacyFeatureVersion;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM3MzU1OQ=="}, "originalCommit": {"oid": "76ad8e0307b509aefc1c7e7716756ad143850105"}, "originalPosition": 85}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2MjE1MjQxOnYy", "diffSide": "RIGHT", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/util/IdentityUtil.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMjoyMzo1N1rOHSuRWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNTozOTozOVrOHS28WA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM5NDUyMw==", "bodyText": "Shall we change it as:\nlog.debug(\"Legacy feature is not configured or the configured legacy feature is empty. \" +\n\"Hence returning false.\");", "url": "https://github.com/wso2/carbon-identity-framework/pull/3027#discussion_r489394523", "createdAt": "2020-09-16T12:23:57Z", "author": {"login": "dewniMW"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/util/IdentityUtil.java", "diffHunk": "@@ -214,11 +216,50 @@ public static IdentityCookieConfig getIdentityCookieConfig(String cookieName) {\n         return identityCookiesConfigurationHolder;\n     }\n \n+    /**\n+     * This method can use to check whether the legacy feature for the given legacy feature id is enabled or not\n+     *\n+     * @param legacyFeatureId      Legacy feature id.\n+     * @param legacyFeatureVersion Legacy feature version.\n+     * @return Whether the legacy feature is enabled or not.\n+     */\n+    public static boolean isLegacyFeatureEnabled(String legacyFeatureId, String legacyFeatureVersion) {\n+\n+        String legacyFeatureConfig;\n+        if (StringUtils.isBlank(legacyFeatureId)) {\n+            return false;\n+        }\n+        if (StringUtils.isBlank(legacyFeatureVersion)) {\n+            legacyFeatureConfig = legacyFeatureId.trim();\n+        } else {\n+            legacyFeatureConfig = legacyFeatureId.trim() + legacyFeatureVersion.trim();\n+        }\n+        if (StringUtils.isNotBlank(legacyFeatureConfig)) {\n+            LegacyFeatureConfig legacyFeatureConfiguration =\n+                    legacyFeatureConfigurationHolder.get(legacyFeatureConfig);\n+            if (legacyFeatureConfiguration != null && legacyFeatureConfiguration.isEnabled()) {\n+                if (log.isDebugEnabled()) {\n+                    log.debug(\"Legacy feature id: \" + legacyFeatureConfiguration.getId() +\n+                            \" legacy feature version : \" + legacyFeatureConfiguration.getVersion() +\n+                            \" is enabled: \" + legacyFeatureConfiguration.isEnabled());\n+                }\n+                return legacyFeatureConfiguration.isEnabled();\n+            }\n+\n+            if (log.isDebugEnabled()) {\n+                log.debug(\"legacy feature is not configured or the configured legacy feature is empty. \" +\n+                        \"Hence returning false \");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76ad8e0307b509aefc1c7e7716756ad143850105"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTUzNjYwMA==", "bodyText": "Fixed 62f2f6e", "url": "https://github.com/wso2/carbon-identity-framework/pull/3027#discussion_r489536600", "createdAt": "2020-09-16T15:39:39Z", "author": {"login": "GANGANI"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/util/IdentityUtil.java", "diffHunk": "@@ -214,11 +216,50 @@ public static IdentityCookieConfig getIdentityCookieConfig(String cookieName) {\n         return identityCookiesConfigurationHolder;\n     }\n \n+    /**\n+     * This method can use to check whether the legacy feature for the given legacy feature id is enabled or not\n+     *\n+     * @param legacyFeatureId      Legacy feature id.\n+     * @param legacyFeatureVersion Legacy feature version.\n+     * @return Whether the legacy feature is enabled or not.\n+     */\n+    public static boolean isLegacyFeatureEnabled(String legacyFeatureId, String legacyFeatureVersion) {\n+\n+        String legacyFeatureConfig;\n+        if (StringUtils.isBlank(legacyFeatureId)) {\n+            return false;\n+        }\n+        if (StringUtils.isBlank(legacyFeatureVersion)) {\n+            legacyFeatureConfig = legacyFeatureId.trim();\n+        } else {\n+            legacyFeatureConfig = legacyFeatureId.trim() + legacyFeatureVersion.trim();\n+        }\n+        if (StringUtils.isNotBlank(legacyFeatureConfig)) {\n+            LegacyFeatureConfig legacyFeatureConfiguration =\n+                    legacyFeatureConfigurationHolder.get(legacyFeatureConfig);\n+            if (legacyFeatureConfiguration != null && legacyFeatureConfiguration.isEnabled()) {\n+                if (log.isDebugEnabled()) {\n+                    log.debug(\"Legacy feature id: \" + legacyFeatureConfiguration.getId() +\n+                            \" legacy feature version : \" + legacyFeatureConfiguration.getVersion() +\n+                            \" is enabled: \" + legacyFeatureConfiguration.isEnabled());\n+                }\n+                return legacyFeatureConfiguration.isEnabled();\n+            }\n+\n+            if (log.isDebugEnabled()) {\n+                log.debug(\"legacy feature is not configured or the configured legacy feature is empty. \" +\n+                        \"Hence returning false \");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM5NDUyMw=="}, "originalCommit": {"oid": "76ad8e0307b509aefc1c7e7716756ad143850105"}, "originalPosition": 52}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2630, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}