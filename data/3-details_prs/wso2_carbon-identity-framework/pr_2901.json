{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA5ODk3OTE0", "number": 2901, "title": "Refactor isValidCallbackURL API", "bodyText": "Resolves wso2/product-is#8130", "createdAt": "2020-04-28T05:49:59Z", "url": "https://github.com/wso2/carbon-identity-framework/pull/2901", "merged": true, "mergeCommit": {"oid": "ca90a46b0a7d4153e936b47b2278b6f556fdf400"}, "closed": true, "closedAt": "2020-04-28T14:58:44Z", "author": {"login": "ashensw"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccB44oAH2gAyNDA5ODk3OTE0OjAxMjNmZmIwMjkxZWJmNTczYmI2ODZmMmJjZDk4MTVlMGY5NjNlYjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccCpDogFqTQwMTc2Mzg0MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0123ffb0291ebf573bb686f2bcd9815e0f963eb9", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/0123ffb0291ebf573bb686f2bcd9815e0f963eb9", "committedDate": "2020-04-28T11:08:00Z", "message": "Refactor isValidCallbackURL API"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0b46fa1c7a9a363581d9700534e557fe3e131236", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/0b46fa1c7a9a363581d9700534e557fe3e131236", "committedDate": "2020-04-28T05:46:17Z", "message": "Refactor isValidCallbackURL API"}, "afterCommit": {"oid": "020eb987c17bd8bbd9cbdf772fa6aeca44819550", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/020eb987c17bd8bbd9cbdf772fa6aeca44819550", "committedDate": "2020-04-28T11:10:54Z", "message": "Refactor url building logic"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxNzQ4NTU2", "url": "https://github.com/wso2/carbon-identity-framework/pull/2901#pullrequestreview-401748556", "createdAt": "2020-04-28T11:36:39Z", "commit": {"oid": "020eb987c17bd8bbd9cbdf772fa6aeca44819550"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxMTozNjozOVrOGNPugg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxMTozNjozOVrOGNPugg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU0MjMzOA==", "bodyText": "Let's remove this additional line", "url": "https://github.com/wso2/carbon-identity-framework/pull/2901#discussion_r416542338", "createdAt": "2020-04-28T11:36:39Z", "author": {"login": "malithie"}, "path": "components/identity-mgt/org.wso2.carbon.identity.mgt.endpoint.util/src/main/java/org/wso2/carbon/identity/mgt/endpoint/util/IdentityManagementEndpointUtil.java", "diffHunk": "@@ -660,30 +660,33 @@ public static String getBasePath(String tenantDomain, String context) throws Api\n     /**\n      * Get base path URL for API clients.\n      *\n-     * @param tenantDomain          tenant Domain.\n+     * @param tenantDomain          Tenant Domain.\n      * @param context               URL context.\n-     * @param isEndpointTenantAware whether the endpoint is tenant aware.\n-     * @return base path.\n+     * @param isEndpointTenantAware Whether the endpoint is tenant aware.\n+     * @return Base path.\n      * @throws ApiException ApiException.\n      */\n     public static String getBasePath(String tenantDomain, String context, boolean isEndpointTenantAware)\n             throws ApiException {\n \n         String basePath;\n+        String serverUrl = IdentityManagementServiceUtil.getInstance().getContextURLFromFile();\n         try {\n-            if (IdentityTenantUtil.isTenantQualifiedUrlsEnabled()) {\n-                basePath = ServiceURLBuilder.create().addPath(context).build().getAbsoluteInternalURL();\n-            } else {\n-                String serverUrl = IdentityManagementServiceUtil.getInstance().getContextURLFromFile();\n-                if (StringUtils.isBlank(serverUrl)) {\n-                    serverUrl = ServiceURLBuilder.create().build().getAbsoluteInternalURL();\n-                }\n-                if (StringUtils.isNotBlank(tenantDomain) && !MultitenantConstants.SUPER_TENANT_DOMAIN_NAME\n-                        .equalsIgnoreCase(tenantDomain) && isEndpointTenantAware) {\n-                    basePath = serverUrl + \"/t/\" + tenantDomain + context;\n+            if (StringUtils.isBlank(serverUrl)) {\n+                if (IdentityTenantUtil.isTenantQualifiedUrlsEnabled()) {\n+                    basePath = ServiceURLBuilder.create().addPath(context).build().getAbsoluteInternalURL();\n                 } else {\n-                    basePath = serverUrl + context;\n+                    serverUrl = ServiceURLBuilder.create().build().getAbsoluteInternalURL();\n+                    if (StringUtils.isNotBlank(tenantDomain) && !MultitenantConstants.SUPER_TENANT_DOMAIN_NAME\n+                            .equalsIgnoreCase(tenantDomain) && isEndpointTenantAware) {\n+                        basePath = serverUrl + \"/t/\" + tenantDomain + context;\n+                    } else {\n+                        basePath = serverUrl + context;\n+                    }\n                 }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "020eb987c17bd8bbd9cbdf772fa6aeca44819550"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a531917fa1d4ac0034e6add902218b8f8a14f98", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/5a531917fa1d4ac0034e6add902218b8f8a14f98", "committedDate": "2020-04-28T11:46:46Z", "message": "Refactor url building logic"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "020eb987c17bd8bbd9cbdf772fa6aeca44819550", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/020eb987c17bd8bbd9cbdf772fa6aeca44819550", "committedDate": "2020-04-28T11:10:54Z", "message": "Refactor url building logic"}, "afterCommit": {"oid": "5a531917fa1d4ac0034e6add902218b8f8a14f98", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/5a531917fa1d4ac0034e6add902218b8f8a14f98", "committedDate": "2020-04-28T11:46:46Z", "message": "Refactor url building logic"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxNzYzODQx", "url": "https://github.com/wso2/carbon-identity-framework/pull/2901#pullrequestreview-401763841", "createdAt": "2020-04-28T12:00:37Z", "commit": {"oid": "5a531917fa1d4ac0034e6add902218b8f8a14f98"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2364, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}