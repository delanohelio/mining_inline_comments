{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyOTYxNTEz", "number": 2734, "title": "XACML standard policy editor does not work as expected for 'equals-with-regexp-match", "bodyText": "Fixes wso2/product-is#7479\nAs per the specification [1] for regular expressions (Match evaluations) in the rule's condition element, the match semantics can be expressed as an element in a condition by using the \u201curn:oasis:names:tc:xacml:3.0:function:any-of\u201d function, as follows:\n<Apply FunctionId=\u201durn:oasis:names:tc:xacml:3.0:function:any-of\u201d>\n\n    <Function\n\nFunctionId=\u201durn:oasis:names:tc:xacml:1.0:function:string-regexp-match\u201d/>\n\n    <AttributeValue DataType=\u201dhttp://www.w3.org/2001/XMLSchema#string\u201d>\n\n        John.*\n\n    </AttributeValue>\n\n    <AttributeDesignator\n\n         Category=\"urn:oasis:names:tc:xacml:1.0:subject-category:access-subject\"\n\n         AttributeId=\u201durn:oasis:names:tc:xacml:1.0:subject:subject-id\u201d\n\n         DataType=\u201dhttp://www.w3.org/2001/XMLSchema#string\u201d/>\n\n</Apply>\n\nCurrently we support Match evaluations only in the rule's target element. This PR provides provides support for applying the same on rule's condition element by following the above semantics.\nThis works successfully using the Write Policy in XML option. However since our Try It tool provides some limited set of capabilities (e.g. currently it allows to specify multiple AttributeValues using the comma seperator in a single field. Therefore using commas in the attribute value is currently not supported. We will consider this as an improvement to our Try It tool to add support to provide multiple attribute value fields. Therefore for testing purposes we can use the editor to create XACML requests using the 'Create Request Using Editor' option.\n[1] http://docs.oasis-open.org/xacml/3.0/xacml-3.0-core-spec-os-en.html#_Toc325047249", "createdAt": "2020-02-10T06:26:12Z", "url": "https://github.com/wso2/carbon-identity-framework/pull/2734", "merged": true, "mergeCommit": {"oid": "3ce3fd284cda025ef2d8bca44c63c1b7b98088ea"}, "closed": true, "closedAt": "2020-02-10T08:48:24Z", "author": {"login": "emswbandara"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcC3P1IAFqTM1NTcxMzU1Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcC3WAogH2gAyMzcyOTYxNTEzOjliZThiNjkyMWMwNTg0YmQyMTBlNDViZWQzMGVkMGU2MGE4YzE0YTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NzEzNTUz", "url": "https://github.com/wso2/carbon-identity-framework/pull/2734#pullrequestreview-355713553", "createdAt": "2020-02-10T06:35:59Z", "commit": {"oid": "650f0ea55dfd968ac934a5e1e0e2f582b811ae91"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwNjozNjowMFrOFnbWBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwNjozNjowMFrOFnbWBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njg4Njc5MA==", "bodyText": "Shall we move this to a constant file", "url": "https://github.com/wso2/carbon-identity-framework/pull/2734#discussion_r376886790", "createdAt": "2020-02-10T06:36:00Z", "author": {"login": "Kanapriya"}, "path": "components/entitlement/org.wso2.carbon.identity.entitlement.ui/src/main/java/org/wso2/carbon/identity/entitlement/ui/util/PolicyEditorUtil.java", "diffHunk": "@@ -1270,6 +1272,36 @@ public static ApplyElementDTO processGreaterLessThanFunctions(String function, S\n         }\n     }\n \n+    /**\n+     * Process regexp-match functions.\n+     *\n+     * @param function       Function name.\n+     * @param dataType       Data type.\n+     * @param attributeValue Attribute Value.\n+     * @param designatorDTO  AttributeDesignator information.\n+     * @return ApplyElementDTO.\n+     */\n+    public static ApplyElementDTO processRegexpFunctions(String function, String dataType, String attributeValue,\n+                                                         AttributeDesignatorDTO designatorDTO) {\n+\n+        if (PolicyConstants.Functions.FUNCTION_EQUAL_MATCH_REGEXP.equals(function)) {\n+            ApplyElementDTO applyElementDTO = new ApplyElementDTO();\n+            applyElementDTO.setFunctionId(PolicyConstants.XACMLData.FUNCTION_ANY_OF);\n+            if (applyElementMap.containsKey(attributeValue)) {\n+                applyElementDTO.setApplyElement(applyElementMap.get(attributeValue));\n+            } else {\n+                AttributeValueElementDTO valueElementDTO = new AttributeValueElementDTO();\n+                valueElementDTO.setAttributeDataType(dataType);\n+                valueElementDTO.setAttributeValue(attributeValue);\n+                applyElementDTO.setAttributeValueElementDTO(valueElementDTO);\n+            }\n+            applyElementDTO.setFunctionFunctionId(processFunction(\"regexp-match\", dataType));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "650f0ea55dfd968ac934a5e1e0e2f582b811ae91"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NzEzNTc5", "url": "https://github.com/wso2/carbon-identity-framework/pull/2734#pullrequestreview-355713579", "createdAt": "2020-02-10T06:36:04Z", "commit": {"oid": "650f0ea55dfd968ac934a5e1e0e2f582b811ae91"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9be8b6921c0584bd210e45bed30ed0e60a8c14a4", "author": {"user": {"login": "emswbandara", "name": "Sathya Bandara"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/9be8b6921c0584bd210e45bed30ed0e60a8c14a4", "committedDate": "2020-02-10T06:42:45Z", "message": "XACML standard policy editor does not work as expected for 'equals-with-regexp-match"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2387, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}