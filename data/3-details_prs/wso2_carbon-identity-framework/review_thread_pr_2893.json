{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3Nzk3NzQ1", "number": 2893, "reviewThreads": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNjo0Mzo0NVrOD4H2QQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMDozMzowMlrOEHEgwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwMTc1NDI1OnYy", "diffSide": "RIGHT", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/dao/IdPManagementDAO.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNjo0Mzo0NVrOGOxnPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNjo0Mzo0NVrOGOxnPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE0NjExMA==", "bodyText": "Add new line", "url": "https://github.com/wso2/carbon-identity-framework/pull/2893#discussion_r418146110", "createdAt": "2020-04-30T16:43:45Z", "author": {"login": "omindu"}, "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/dao/IdPManagementDAO.java", "diffHunk": "@@ -2834,6 +2834,31 @@ public void deleteIdP(String idPName, int tenantId, String tenantDomain)\n         }\n     }\n \n+    /**\n+     * Delete all IDPs of a given tenant id.\n+     *\n+     * @param tenantId Id of the tenant\n+     * @throws IdentityProviderManagementException\n+     */\n+    public void deleteIdPs(int tenantId) throws IdentityProviderManagementException {\n+        PreparedStatement prepStmt = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30ba551303b56e0f156141fadd1aa645d1ccf358"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwMTc1ODA5OnYy", "diffSide": "RIGHT", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/listener/AbstractIdentityProviderMgtListener.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNjo0NDozN1rOGOxphQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNjo0NDozN1rOGOxphQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE0NjY5Mw==", "bodyText": "Add new line", "url": "https://github.com/wso2/carbon-identity-framework/pull/2893#discussion_r418146693", "createdAt": "2020-04-30T16:44:37Z", "author": {"login": "omindu"}, "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/listener/AbstractIdentityProviderMgtListener.java", "diffHunk": "@@ -61,6 +61,17 @@ public boolean doPreDeleteIdP(String idPName, String tenantDomain) throws Identi\n         return true;\n     }\n \n+    /**\n+     * Additional actions before deleting all IdPs of a given tenant id.\n+     *\n+     * @param tenantDomain Tenant domain to delete IdPs.\n+     * @return\n+     * @throws IdentityProviderManagementException\n+     */\n+    public boolean doPreDeleteIdPsByTenantDomain(String tenantDomain) throws IdentityProviderManagementException {\n+        return true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30ba551303b56e0f156141fadd1aa645d1ccf358"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwMTc1ODkyOnYy", "diffSide": "RIGHT", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/listener/AbstractIdentityProviderMgtListener.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNjo0NDo1MFrOGOxqDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNjo0NDo1MFrOGOxqDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE0NjgyOA==", "bodyText": "Add new line", "url": "https://github.com/wso2/carbon-identity-framework/pull/2893#discussion_r418146828", "createdAt": "2020-04-30T16:44:50Z", "author": {"login": "omindu"}, "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/listener/AbstractIdentityProviderMgtListener.java", "diffHunk": "@@ -71,6 +82,17 @@ public boolean doPostDeleteIdP(String idPName, String tenantDomain) throws Ident\n         return true;\n     }\n \n+    /**\n+     * Additional actions after deleting IdPs of a given tenant id.\n+     *\n+     * @param tenantDomain Tenant domain to delete IdPs.\n+     * @return\n+     * @throws IdentityProviderManagementException\n+     */\n+    public boolean doPostDeleteIdPsByTenantDomain(String tenantDomain) throws IdentityProviderManagementException {\n+        return true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30ba551303b56e0f156141fadd1aa645d1ccf358"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MDMwMzYwOnYy", "diffSide": "RIGHT", "path": "components/application-mgt/org.wso2.carbon.identity.application.mgt/src/main/java/org/wso2/carbon/identity/application/mgt/listener/ApplicationIdentityProviderMgtListener.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwOTowNTowMlrOGXW8sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwOTowNTowMlrOGXW8sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE0NjQxOQ==", "bodyText": "rename to doPostDeleteIdPs(String tenantDomain)", "url": "https://github.com/wso2/carbon-identity-framework/pull/2893#discussion_r427146419", "createdAt": "2020-05-19T09:05:02Z", "author": {"login": "IsuraD"}, "path": "components/application-mgt/org.wso2.carbon.identity.application.mgt/src/main/java/org/wso2/carbon/identity/application/mgt/listener/ApplicationIdentityProviderMgtListener.java", "diffHunk": "@@ -172,6 +172,25 @@ public boolean doPostDeleteIdP(String idPName, String tenantDomain) throws Ident\n         return super.doPostDeleteIdP(idPName, tenantDomain);\n     }\n \n+    /**\n+     * Clear SP cache after deleting IDPs.\n+     *\n+     * @param tenantDomain Tenant domain to delete IdPs.\n+     * @return\n+     * @throws IdentityProviderManagementException\n+     */\n+    @Override\n+    public boolean doPostDeleteIdPsByTenantDomain(String tenantDomain) throws IdentityProviderManagementException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "759585d8fd0fb8933be8d51a69d02ea34c9e3a96"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MDMwNTU0OnYy", "diffSide": "RIGHT", "path": "components/application-mgt/org.wso2.carbon.identity.application.mgt/src/main/java/org/wso2/carbon/identity/application/mgt/listener/ApplicationIdentityProviderMgtListener.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwOTowNToyOFrOGXW92g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxMToxNDo1M1rOGdG-pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE0NjcxNA==", "bodyText": "shall we load the SPs of this tenant clear cache separately?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2893#discussion_r427146714", "createdAt": "2020-05-19T09:05:28Z", "author": {"login": "IsuraD"}, "path": "components/application-mgt/org.wso2.carbon.identity.application.mgt/src/main/java/org/wso2/carbon/identity/application/mgt/listener/ApplicationIdentityProviderMgtListener.java", "diffHunk": "@@ -172,6 +172,25 @@ public boolean doPostDeleteIdP(String idPName, String tenantDomain) throws Ident\n         return super.doPostDeleteIdP(idPName, tenantDomain);\n     }\n \n+    /**\n+     * Clear SP cache after deleting IDPs.\n+     *\n+     * @param tenantDomain Tenant domain to delete IdPs.\n+     * @return\n+     * @throws IdentityProviderManagementException\n+     */\n+    @Override\n+    public boolean doPostDeleteIdPsByTenantDomain(String tenantDomain) throws IdentityProviderManagementException {\n+\n+        // Clear the SP cache since deleted IDP might have contained association with SPs.\n+        IdentityServiceProviderCache.getInstance().clear();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "759585d8fd0fb8933be8d51a69d02ea34c9e3a96"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE3NTE4OA==", "bodyText": "Caches will be cleared in the SP deletion", "url": "https://github.com/wso2/carbon-identity-framework/pull/2893#discussion_r433175188", "createdAt": "2020-06-01T11:11:57Z", "author": {"login": "sumedhe"}, "path": "components/application-mgt/org.wso2.carbon.identity.application.mgt/src/main/java/org/wso2/carbon/identity/application/mgt/listener/ApplicationIdentityProviderMgtListener.java", "diffHunk": "@@ -172,6 +172,25 @@ public boolean doPostDeleteIdP(String idPName, String tenantDomain) throws Ident\n         return super.doPostDeleteIdP(idPName, tenantDomain);\n     }\n \n+    /**\n+     * Clear SP cache after deleting IDPs.\n+     *\n+     * @param tenantDomain Tenant domain to delete IdPs.\n+     * @return\n+     * @throws IdentityProviderManagementException\n+     */\n+    @Override\n+    public boolean doPostDeleteIdPsByTenantDomain(String tenantDomain) throws IdentityProviderManagementException {\n+\n+        // Clear the SP cache since deleted IDP might have contained association with SPs.\n+        IdentityServiceProviderCache.getInstance().clear();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE0NjcxNA=="}, "originalCommit": {"oid": "759585d8fd0fb8933be8d51a69d02ea34c9e3a96"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE3NjIzMA==", "bodyText": "Lets remove this", "url": "https://github.com/wso2/carbon-identity-framework/pull/2893#discussion_r433176230", "createdAt": "2020-06-01T11:14:53Z", "author": {"login": "IsuraD"}, "path": "components/application-mgt/org.wso2.carbon.identity.application.mgt/src/main/java/org/wso2/carbon/identity/application/mgt/listener/ApplicationIdentityProviderMgtListener.java", "diffHunk": "@@ -172,6 +172,25 @@ public boolean doPostDeleteIdP(String idPName, String tenantDomain) throws Ident\n         return super.doPostDeleteIdP(idPName, tenantDomain);\n     }\n \n+    /**\n+     * Clear SP cache after deleting IDPs.\n+     *\n+     * @param tenantDomain Tenant domain to delete IdPs.\n+     * @return\n+     * @throws IdentityProviderManagementException\n+     */\n+    @Override\n+    public boolean doPostDeleteIdPsByTenantDomain(String tenantDomain) throws IdentityProviderManagementException {\n+\n+        // Clear the SP cache since deleted IDP might have contained association with SPs.\n+        IdentityServiceProviderCache.getInstance().clear();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE0NjcxNA=="}, "originalCommit": {"oid": "759585d8fd0fb8933be8d51a69d02ea34c9e3a96"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MDMxMjMzOnYy", "diffSide": "RIGHT", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdentityProviderManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwOTowNzowN1rOGXXCBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwOTowNzowN1rOGXXCBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE0Nzc4MQ==", "bodyText": "deleteIdPs(String tenantDomain)", "url": "https://github.com/wso2/carbon-identity-framework/pull/2893#discussion_r427147781", "createdAt": "2020-05-19T09:07:07Z", "author": {"login": "IsuraD"}, "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdentityProviderManager.java", "diffHunk": "@@ -2096,6 +2096,40 @@ public void deleteIdP(String idPName, String tenantDomain) throws IdentityProvid\n         }\n     }\n \n+    /**\n+     * Delete all Identity Providers from a given tenant\n+     *\n+     * @param tenantDomain Domain of the tenant\n+     * @throws IdentityProviderManagementException\n+     */\n+    @Override\n+    public void deleteIdPsByTenantDomain(String tenantDomain) throws IdentityProviderManagementException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "759585d8fd0fb8933be8d51a69d02ea34c9e3a96"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5ODI4MjA1OnYy", "diffSide": "RIGHT", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdentityProviderManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxMToxNjoxMlrOGdHArw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxMToxNjoxMlrOGdHArw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE3Njc1MQ==", "bodyText": "rename to doPreDeleteIdPs", "url": "https://github.com/wso2/carbon-identity-framework/pull/2893#discussion_r433176751", "createdAt": "2020-06-01T11:16:12Z", "author": {"login": "IsuraD"}, "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdentityProviderManager.java", "diffHunk": "@@ -2094,6 +2094,40 @@ public void deleteIdP(String idPName, String tenantDomain) throws IdentityProvid\n         }\n     }\n \n+    /**\n+     * Delete all Identity Providers from a given tenant\n+     *\n+     * @param tenantDomain Domain of the tenant\n+     * @throws IdentityProviderManagementException\n+     */\n+    @Override\n+    public void deleteIdPs(String tenantDomain) throws IdentityProviderManagementException {\n+\n+        // Invoking the pre listeners.\n+        Collection<IdentityProviderMgtListener> listeners = IdPManagementServiceComponent.getIdpMgtListeners();\n+        for (IdentityProviderMgtListener listener : listeners) {\n+            if (listener.isEnable() && !listener.doPreDeleteIdPsByTenantDomain(tenantDomain)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f40ddc83bc5bb13879e6fb7395991d054584938"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0NjA1NDAwOnYy", "diffSide": "RIGHT", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdentityProviderManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMDo0ODoxNFrOGkVzZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMDo0ODoxNFrOGkVzZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDc1OTE0Mg==", "bodyText": "Missing full stop. Shall we keep the format of the comments? WDYT?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2893#discussion_r440759142", "createdAt": "2020-06-16T10:48:14Z", "author": {"login": "ShanChathusanda93"}, "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdentityProviderManager.java", "diffHunk": "@@ -2094,6 +2094,40 @@ public void deleteIdP(String idPName, String tenantDomain) throws IdentityProvid\n         }\n     }\n \n+    /**\n+     * Delete all Identity Providers from a given tenant", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "445d96defb10208fd2a2c61d4b2d5e4705e5ffbc"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0NjA3MTE1OnYy", "diffSide": "RIGHT", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/listener/AbstractIdentityProviderMgtListener.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMDo1Mjo0M1rOGkV9jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMDo1Mjo0M1rOGkV9jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDc2MTc0Mw==", "bodyText": "In other places for params full stop is not used. It is better if we can maintain single format for comments. WDYT?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2893#discussion_r440761743", "createdAt": "2020-06-16T10:52:43Z", "author": {"login": "ShanChathusanda93"}, "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/listener/AbstractIdentityProviderMgtListener.java", "diffHunk": "@@ -61,6 +61,18 @@ public boolean doPreDeleteIdP(String idPName, String tenantDomain) throws Identi\n         return true;\n     }\n \n+    /**\n+     * Additional actions before deleting all IdPs of a given tenant id.\n+     *\n+     * @param tenantDomain Tenant domain to delete IdPs.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "445d96defb10208fd2a2c61d4b2d5e4705e5ffbc"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0NjA3Mzc0OnYy", "diffSide": "RIGHT", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/listener/IDPMgtAuditLogger.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMDo1MzozNVrOGkV_Tg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMDo1MzozNVrOGkV_Tg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDc2MjE5MA==", "bodyText": "Shall we add the method comment here? If so please check the other places as well.", "url": "https://github.com/wso2/carbon-identity-framework/pull/2893#discussion_r440762190", "createdAt": "2020-06-16T10:53:35Z", "author": {"login": "ShanChathusanda93"}, "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/listener/IDPMgtAuditLogger.java", "diffHunk": "@@ -69,14 +69,20 @@ public boolean doPostUpdateIdP(String oldIdPName, IdentityProvider identityProvi\n \n     @Override\n     public boolean doPostDeleteIdP(String idPName, String tenantDomain) throws IdentityProviderManagementException {\n-        if(StringUtils.isEmpty(idPName)){\n+        if (StringUtils.isEmpty(idPName)) {\n             idPName = \"Undefined\";\n         }\n         audit.info(String.format(AUDIT_MESSAGE, getUser(), \"delete\", UserCoreUtil.addTenantDomainToEntry\n                 (idPName, tenantDomain), null, SUCCESS));\n         return true;\n     }\n \n+    @Override\n+    public boolean doPostDeleteIdPs(String tenantDomain) throws IdentityProviderManagementException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "445d96defb10208fd2a2c61d4b2d5e4705e5ffbc"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MzgwNjY4OnYy", "diffSide": "RIGHT", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/dao/IdPManagementDAO.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNzowMToxOVrOGliHLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNzowMToxOVrOGliHLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAwOTM5MA==", "bodyText": "shall we use try with resource so that the connection and prepared statements are automatically closed?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2893#discussion_r442009390", "createdAt": "2020-06-18T07:01:19Z", "author": {"login": "madurangasiriwardena"}, "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/dao/IdPManagementDAO.java", "diffHunk": "@@ -2858,6 +2858,32 @@ public void deleteIdP(String idPName, int tenantId, String tenantDomain)\n         }\n     }\n \n+    /**\n+     * Delete all IDPs of a given tenant id.\n+     *\n+     * @param tenantId Id of the tenant\n+     * @throws IdentityProviderManagementException\n+     */\n+    public void deleteIdPs(int tenantId) throws IdentityProviderManagementException {\n+\n+        PreparedStatement prepStmt = null;\n+        String query = IdPManagementConstants.SQLQueries.DELETE_ALL_IDP_BY_TENANT_ID_SQL;\n+        Connection conn = IdentityDatabaseUtil.getDBConnection(true);\n+        try {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "706fc27a5b1fa81ed95f33ad708af20a93b95244"}, "originalPosition": 79}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MzgwOTc0OnYy", "diffSide": "RIGHT", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/dao/CacheBackedIdPMgtDAO.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNzowMjozMFrOGliJIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNzowMjozMFrOGliJIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAwOTg5MA==", "bodyText": "formatting issue.", "url": "https://github.com/wso2/carbon-identity-framework/pull/2893#discussion_r442009890", "createdAt": "2020-06-18T07:02:30Z", "author": {"login": "madurangasiriwardena"}, "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/dao/CacheBackedIdPMgtDAO.java", "diffHunk": "@@ -464,14 +461,27 @@ public void deleteIdP(String idPName, int tenantId, String tenantDomain)\n             clearIdpCache(idPName, tenantId, tenantDomain);\n         } else {\n             if (log.isDebugEnabled()) {\n-                log.debug(String.format(\"IDP:%s of tenantDomain:%s is not found is cache or DB\", idPName, tenantDomain));\n+                log.debug(String.format(\"IDP:%s of tenantDomain:%s is not found is cache or DB\",\n+                        idPName, tenantDomain));\n             }\n         }\n+    }\n \n+    /**\n+     * Delete all IDPs of given tenant Id.\n+     *\n+     * @param tenantId Id of the tenant\n+     * @throws IdentityProviderManagementException\n+     */\n+    public void deleteIdPsByTenantID(int tenantId)  throws IdentityProviderManagementException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "706fc27a5b1fa81ed95f33ad708af20a93b95244"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MzgxMjA5OnYy", "diffSide": "RIGHT", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/dao/CacheBackedIdPMgtDAO.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNzowMzoyMFrOGliKnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxOTo1OToyNFrOGl-POw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAxMDI2OQ==", "bodyText": "do we need to clear the cache as well?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2893#discussion_r442010269", "createdAt": "2020-06-18T07:03:20Z", "author": {"login": "madurangasiriwardena"}, "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/dao/CacheBackedIdPMgtDAO.java", "diffHunk": "@@ -464,14 +461,27 @@ public void deleteIdP(String idPName, int tenantId, String tenantDomain)\n             clearIdpCache(idPName, tenantId, tenantDomain);\n         } else {\n             if (log.isDebugEnabled()) {\n-                log.debug(String.format(\"IDP:%s of tenantDomain:%s is not found is cache or DB\", idPName, tenantDomain));\n+                log.debug(String.format(\"IDP:%s of tenantDomain:%s is not found is cache or DB\",\n+                        idPName, tenantDomain));\n             }\n         }\n+    }\n \n+    /**\n+     * Delete all IDPs of given tenant Id.\n+     *\n+     * @param tenantId Id of the tenant\n+     * @throws IdentityProviderManagementException\n+     */\n+    public void deleteIdPsByTenantID(int tenantId)  throws IdentityProviderManagementException {\n \n-\n+        idPMgtDAO.deleteIdPs(tenantId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "706fc27a5b1fa81ed95f33ad708af20a93b95244"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ3MDIwMw==", "bodyText": "It was decided not to delete the caches here, because of the overhead coming after clearing all IDP caches.", "url": "https://github.com/wso2/carbon-identity-framework/pull/2893#discussion_r442470203", "createdAt": "2020-06-18T19:59:24Z", "author": {"login": "sumedhe"}, "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/dao/CacheBackedIdPMgtDAO.java", "diffHunk": "@@ -464,14 +461,27 @@ public void deleteIdP(String idPName, int tenantId, String tenantDomain)\n             clearIdpCache(idPName, tenantId, tenantDomain);\n         } else {\n             if (log.isDebugEnabled()) {\n-                log.debug(String.format(\"IDP:%s of tenantDomain:%s is not found is cache or DB\", idPName, tenantDomain));\n+                log.debug(String.format(\"IDP:%s of tenantDomain:%s is not found is cache or DB\",\n+                        idPName, tenantDomain));\n             }\n         }\n+    }\n \n+    /**\n+     * Delete all IDPs of given tenant Id.\n+     *\n+     * @param tenantId Id of the tenant\n+     * @throws IdentityProviderManagementException\n+     */\n+    public void deleteIdPsByTenantID(int tenantId)  throws IdentityProviderManagementException {\n \n-\n+        idPMgtDAO.deleteIdPs(tenantId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAxMDI2OQ=="}, "originalCommit": {"oid": "706fc27a5b1fa81ed95f33ad708af20a93b95244"}, "originalPosition": 72}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MzgyODYyOnYy", "diffSide": "RIGHT", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/dao/IdPManagementDAO.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNzowOTowMlrOGliUqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNzowOTowMlrOGliUqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAxMjg0MA==", "bodyText": "Shall we rename this method as deleteIdPsByTenantID to make this consistent with CacheBackedIdPMgtDAO", "url": "https://github.com/wso2/carbon-identity-framework/pull/2893#discussion_r442012840", "createdAt": "2020-06-18T07:09:02Z", "author": {"login": "madurangasiriwardena"}, "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/dao/IdPManagementDAO.java", "diffHunk": "@@ -2858,6 +2858,32 @@ public void deleteIdP(String idPName, int tenantId, String tenantDomain)\n         }\n     }\n \n+    /**\n+     * Delete all IDPs of a given tenant id.\n+     *\n+     * @param tenantId Id of the tenant\n+     * @throws IdentityProviderManagementException\n+     */\n+    public void deleteIdPs(int tenantId) throws IdentityProviderManagementException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "706fc27a5b1fa81ed95f33ad708af20a93b95244"}, "originalPosition": 74}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1Mzk5NzkxOnYy", "diffSide": "RIGHT", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/listener/IDPMgtAuditLogger.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwODowMDowMVrOGlj_Gg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQyMDozNjoxNVrOGl_UdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA0MDA5MA==", "bodyText": "Do we need to log anything related to this operation?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2893#discussion_r442040090", "createdAt": "2020-06-18T08:00:01Z", "author": {"login": "madurangasiriwardena"}, "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/listener/IDPMgtAuditLogger.java", "diffHunk": "@@ -67,16 +67,37 @@ public boolean doPostUpdateIdP(String oldIdPName, IdentityProvider identityProvi\n         return true;\n     }\n \n+    /**\n+     * Post delete of IDP.\n+     *\n+     * @param idPName Name of the IDP\n+     * @param tenantDomain Tenant Domain\n+     * @return\n+     * @throws IdentityProviderManagementException\n+     */\n     @Override\n     public boolean doPostDeleteIdP(String idPName, String tenantDomain) throws IdentityProviderManagementException {\n-        if(StringUtils.isEmpty(idPName)){\n+        if (StringUtils.isEmpty(idPName)) {\n             idPName = \"Undefined\";\n         }\n         audit.info(String.format(AUDIT_MESSAGE, getUser(), \"delete\", UserCoreUtil.addTenantDomainToEntry\n                 (idPName, tenantDomain), null, SUCCESS));\n         return true;\n     }\n \n+    /**\n+     * Additional actions after deleting IdPs of a given tenant id.\n+     *\n+     * @param tenantDomain Tenant domain to delete IdPs\n+     * @return\n+     * @throws IdentityProviderManagementException\n+     */\n+    @Override\n+    public boolean doPostDeleteIdPs(String tenantDomain) throws IdentityProviderManagementException {\n+\n+        return super.doPostDeleteIdPs(tenantDomain);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "706fc27a5b1fa81ed95f33ad708af20a93b95244"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ4NzkyNA==", "bodyText": "I will add an audit log here", "url": "https://github.com/wso2/carbon-identity-framework/pull/2893#discussion_r442487924", "createdAt": "2020-06-18T20:36:15Z", "author": {"login": "sumedhe"}, "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/listener/IDPMgtAuditLogger.java", "diffHunk": "@@ -67,16 +67,37 @@ public boolean doPostUpdateIdP(String oldIdPName, IdentityProvider identityProvi\n         return true;\n     }\n \n+    /**\n+     * Post delete of IDP.\n+     *\n+     * @param idPName Name of the IDP\n+     * @param tenantDomain Tenant Domain\n+     * @return\n+     * @throws IdentityProviderManagementException\n+     */\n     @Override\n     public boolean doPostDeleteIdP(String idPName, String tenantDomain) throws IdentityProviderManagementException {\n-        if(StringUtils.isEmpty(idPName)){\n+        if (StringUtils.isEmpty(idPName)) {\n             idPName = \"Undefined\";\n         }\n         audit.info(String.format(AUDIT_MESSAGE, getUser(), \"delete\", UserCoreUtil.addTenantDomainToEntry\n                 (idPName, tenantDomain), null, SUCCESS));\n         return true;\n     }\n \n+    /**\n+     * Additional actions after deleting IdPs of a given tenant id.\n+     *\n+     * @param tenantDomain Tenant domain to delete IdPs\n+     * @return\n+     * @throws IdentityProviderManagementException\n+     */\n+    @Override\n+    public boolean doPostDeleteIdPs(String tenantDomain) throws IdentityProviderManagementException {\n+\n+        return super.doPostDeleteIdPs(tenantDomain);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA0MDA5MA=="}, "originalCommit": {"oid": "706fc27a5b1fa81ed95f33ad708af20a93b95244"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NDAwOTQyOnYy", "diffSide": "RIGHT", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/util/IdPManagementConstants.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwODowMzozMlrOGlkG0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQyMDozNjo0OFrOGl_VcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA0MjA2Ng==", "bodyText": "Will all the resources related to IDP cleared from this?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2893#discussion_r442042066", "createdAt": "2020-06-18T08:03:32Z", "author": {"login": "madurangasiriwardena"}, "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/util/IdPManagementConstants.java", "diffHunk": "@@ -286,6 +286,8 @@\n \n         public static final String DELETE_IDP_SQL = \"DELETE FROM IDP WHERE (TENANT_ID=? AND NAME=?)\";\n \n+        public static final String DELETE_ALL_IDP_BY_TENANT_ID_SQL = \"DELETE FROM IDP WHERE TENANT_ID = ?\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "706fc27a5b1fa81ed95f33ad708af20a93b95244"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ4ODE3Nw==", "bodyText": "Yes. Other relevant resources also get deleted with ON CASCADE. The same method was followed in deleting a single IDP also.", "url": "https://github.com/wso2/carbon-identity-framework/pull/2893#discussion_r442488177", "createdAt": "2020-06-18T20:36:48Z", "author": {"login": "sumedhe"}, "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/util/IdPManagementConstants.java", "diffHunk": "@@ -286,6 +286,8 @@\n \n         public static final String DELETE_IDP_SQL = \"DELETE FROM IDP WHERE (TENANT_ID=? AND NAME=?)\";\n \n+        public static final String DELETE_ALL_IDP_BY_TENANT_ID_SQL = \"DELETE FROM IDP WHERE TENANT_ID = ?\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA0MjA2Ng=="}, "originalCommit": {"oid": "706fc27a5b1fa81ed95f33ad708af20a93b95244"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1ODQ5MjE5OnYy", "diffSide": "RIGHT", "path": "components/provisioning/org.wso2.carbon.identity.provisioning/src/main/java/org/wso2/carbon/identity/provisioning/listener/ProvisioningIdentityProviderMgtListener.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMDozMjoyMFrOGmQI8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMDozMjoyMFrOGmQI8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjc2MzUwNQ==", "bodyText": "This affects to all the tenants. Lets skip removing from  ProvisioningConnectorCache", "url": "https://github.com/wso2/carbon-identity-framework/pull/2893#discussion_r442763505", "createdAt": "2020-06-19T10:32:20Z", "author": {"login": "IsuraD"}, "path": "components/provisioning/org.wso2.carbon.identity.provisioning/src/main/java/org/wso2/carbon/identity/provisioning/listener/ProvisioningIdentityProviderMgtListener.java", "diffHunk": "@@ -56,6 +56,23 @@ public boolean doPreDeleteIdP(String idPName, String tenantDomain) throws Identi\n         return true;\n     }\n \n+    /**\n+     * Clear Provisioning Connector Cache before deleting IDPs.\n+     *\n+     * @param tenantDomain Tenant domain to delete IdPs.\n+     * @return\n+     * @throws IdentityProviderManagementException\n+     */\n+    @Override\n+    public boolean doPreDeleteIdPs(String tenantDomain) throws IdentityProviderManagementException {\n+\n+        ProvisioningConnectorCache.getInstance().clear();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9eccfb54b5b48293ff9e46bcdc5b6cd00818683a"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1ODQ5NDA4OnYy", "diffSide": "RIGHT", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/dao/IdPManagementDAO.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMDozMzowMlrOGmQKKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMDozMzowMlrOGmQKKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjc2MzgxNg==", "bodyText": "rename to public void deleteIdPs(int tenantId)", "url": "https://github.com/wso2/carbon-identity-framework/pull/2893#discussion_r442763816", "createdAt": "2020-06-19T10:33:02Z", "author": {"login": "IsuraD"}, "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/dao/IdPManagementDAO.java", "diffHunk": "@@ -2858,6 +2859,25 @@ public void deleteIdP(String idPName, int tenantId, String tenantDomain)\n         }\n     }\n \n+    /**\n+     * Delete all IDPs of a given tenant id.\n+     *\n+     * @param tenantId Id of the tenant\n+     * @throws IdentityProviderManagementException\n+     */\n+    public void deleteIdPsByTenantId(int tenantId) throws IdentityProviderManagementException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9eccfb54b5b48293ff9e46bcdc5b6cd00818683a"}, "originalPosition": 82}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2327, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}