{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3MzQ3MTQ0", "number": 3227, "title": "Clear configuration management service cache after replace operation", "bodyText": "Proposed changes in this pull request\nThe configuration management service doesn't clear the cache after a replace operation. This PR implements the cache entry deletion after the execution of the replaceResource method.\nCloses wso2/product-is#9560", "createdAt": "2020-11-08T18:12:06Z", "url": "https://github.com/wso2/carbon-identity-framework/pull/3227", "merged": true, "mergeCommit": {"oid": "cc2e821830d92f64e7dd73f71d8c5c3c296c4e2c"}, "closed": true, "closedAt": "2020-11-09T07:56:48Z", "author": {"login": "ivantha"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdalmjkAFqTUyNTgzODg1Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdamvxHABqjM5NzExNzg5Njc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1ODM4ODUy", "url": "https://github.com/wso2/carbon-identity-framework/pull/3227#pullrequestreview-525838852", "createdAt": "2020-11-08T19:47:53Z", "commit": {"oid": "c70031c5e8cb2626ceb434418d0c098e17c0213e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1ODM5MDI1", "url": "https://github.com/wso2/carbon-identity-framework/pull/3227#pullrequestreview-525839025", "createdAt": "2020-11-08T19:50:02Z", "commit": {"oid": "c70031c5e8cb2626ceb434418d0c098e17c0213e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQxOTo1MDowMlrOHvZ3nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQxOTo1MDowMlrOHvZ3nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ2ODk1OQ==", "bodyText": "Isn't this log entry incorrect? We are clearing the cache here.", "url": "https://github.com/wso2/carbon-identity-framework/pull/3227#discussion_r519468959", "createdAt": "2020-11-08T19:50:02Z", "author": {"login": "JKAUSHALYA"}, "path": "components/configuration-mgt/org.wso2.carbon.identity.configuration.mgt.core/src/main/java/org/wso2/carbon/identity/configuration/mgt/core/dao/impl/CachedBackedConfigurationDAO.java", "diffHunk": "@@ -403,4 +404,44 @@ private void addResourceToCache(Resource resource) throws ConfigurationManagemen\n             PrivilegedCarbonContext.endTenantFlow();\n         }\n     }\n+\n+    private void deleteResourceFromCache(Resource resource) throws ConfigurationManagementException {\n+\n+        if (resource == null) {\n+            return;\n+        }\n+\n+        int tenantId;\n+        try {\n+            tenantId = ConfigurationManagerComponentDataHolder.getInstance().getRealmService()\n+                    .getTenantManager().getTenantId(MultitenantConstants.SUPER_TENANT_DOMAIN_NAME);\n+        } catch (UserStoreException e) {\n+            throw new ConfigurationManagementException(\"Error when setting tenant domain. \",\n+                    ConfigurationConstants.ErrorMessages.ERROR_CODE_UNEXPECTED.getCode(), e);\n+        }\n+\n+        try {\n+            PrivilegedCarbonContext.startTenantFlow();\n+            PrivilegedCarbonContext.getThreadLocalCarbonContext()\n+                    .setTenantDomain(MultitenantConstants.SUPER_TENANT_DOMAIN_NAME);\n+            PrivilegedCarbonContext.getThreadLocalCarbonContext().setTenantId(tenantId);\n+\n+            ResourceByIdCacheKey resourceByIdCacheKey = new ResourceByIdCacheKey(resource.getResourceId(),\n+                    resource.getTenantDomain());\n+            ResourceByNameCacheKey resourceByNameCacheKey = new ResourceByNameCacheKey(resource.getResourceName(),\n+                    resource.getTenantDomain());\n+\n+            if (log.isDebugEnabled()) {\n+                String message = String.format(\"Following two cache entries created. 1. Resource by name cache %s, 2.\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c70031c5e8cb2626ceb434418d0c098e17c0213e"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "594170c762fccc79217d5e7070a94b599f72fab0", "author": {"user": {"login": "ivantha", "name": "Ivantha"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/594170c762fccc79217d5e7070a94b599f72fab0", "committedDate": "2020-11-08T21:07:34Z", "message": "Configuration manager clear caching on replace operation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c70031c5e8cb2626ceb434418d0c098e17c0213e", "author": {"user": {"login": "ivantha", "name": "Ivantha"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/c70031c5e8cb2626ceb434418d0c098e17c0213e", "committedDate": "2020-11-08T18:09:37Z", "message": "Configuration manager clear caching on replace operation\n\nCloses https://github.com/wso2/product-is/issues/9560"}, "afterCommit": {"oid": "594170c762fccc79217d5e7070a94b599f72fab0", "author": {"user": {"login": "ivantha", "name": "Ivantha"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/594170c762fccc79217d5e7070a94b599f72fab0", "committedDate": "2020-11-08T21:07:34Z", "message": "Configuration manager clear caching on replace operation"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2169, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}