{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzNzg5MTEx", "number": 2838, "title": "Add support for including tenant domain as a parameter in URLResolverService", "bodyText": "Proposed changes in this pull request\nOverload the current method implementations to accommodate tenant domain as a parameter in URLResolverService.\nImprovement for: #2828\nRelated to: wso2/product-is#7902", "createdAt": "2020-03-25T19:39:16Z", "url": "https://github.com/wso2/carbon-identity-framework/pull/2838", "merged": true, "mergeCommit": {"oid": "95b83a1ba1cf536cfdb8f460f59fa8f65f50d654"}, "closed": true, "closedAt": "2020-03-27T05:51:17Z", "author": {"login": "chamathns"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRMvREgH2gAyMzkzNzg5MTExOjM4ZjJiMDI2NWI1NzUzZGZkZjY3NzI2ZDVlNGUxMjg0MDdmZTAyMzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRqLMXAFqTM4MjU5NDQ5NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "38f2b0265b5753dfdf67726d5e4e128407fe0237", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/38f2b0265b5753dfdf67726d5e4e128407fe0237", "committedDate": "2020-03-25T19:33:17Z", "message": "Overloading url resolver methods to add tenantDomain param."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87b59ba1ca0f33796dc641e045fb79dda26c68c6", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/87b59ba1ca0f33796dc641e045fb79dda26c68c6", "committedDate": "2020-03-26T02:59:49Z", "message": "Add tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNjc0Mjg4", "url": "https://github.com/wso2/carbon-identity-framework/pull/2838#pullrequestreview-381674288", "createdAt": "2020-03-26T03:08:37Z", "commit": {"oid": "87b59ba1ca0f33796dc641e045fb79dda26c68c6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQwMzowODozN1rOF712uA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQwMzowODozN1rOF712uA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI5MjY2NA==", "bodyText": "Shall we have a new API to accept tenant domain.\nWondering if there is s real necessity of it as well.\nIn addition, we should have an API without legacy mode params as well. So new consumers don't need to worry about populating such.", "url": "https://github.com/wso2/carbon-identity-framework/pull/2838#discussion_r398292664", "createdAt": "2020-03-26T03:08:37Z", "author": {"login": "malithie"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultURLResolverService.java", "diffHunk": "@@ -40,7 +40,7 @@\n public class DefaultURLResolverService implements URLResolverService {\n \n     @Override\n-    public String resolveUrl(String url, boolean addProxyContextPath, boolean addWebContextRoot,\n+    public String resolveUrl(String url, String tenantDomain, boolean addProxyContextPath, boolean addWebContextRoot,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87b59ba1ca0f33796dc641e045fb79dda26c68c6"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8244288ee50935fdd84f2c6403d35e5a0b233c8e", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/8244288ee50935fdd84f2c6403d35e5a0b233c8e", "committedDate": "2020-03-26T06:21:08Z", "message": "add APIs for URLResolverService"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxOTc5ODAx", "url": "https://github.com/wso2/carbon-identity-framework/pull/2838#pullrequestreview-381979801", "createdAt": "2020-03-26T12:56:29Z", "commit": {"oid": "8244288ee50935fdd84f2c6403d35e5a0b233c8e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMjo1NjozMFrOF8FjOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMjo1NjozMFrOF8FjOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU0OTgxOQ==", "bodyText": "Shall we move this tenant resolving logic to a single method and reuse ?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2838#discussion_r398549819", "createdAt": "2020-03-26T12:56:30Z", "author": {"login": "malithie"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultURLResolverService.java", "diffHunk": "@@ -135,11 +168,13 @@ private void appendProxyContextPath(StringBuilder serverUrl) {\n         }\n     }\n \n-    private void appendTenantAsPathParam(StringBuilder serverUrl) {\n+    private void appendTenantAsPathParam(StringBuilder serverUrl, String tenantDomain) {\n \n-        String tenantDomain = IdentityTenantUtil.getTenantDomainFromContext();\n         if (StringUtils.isBlank(tenantDomain)) {\n-            tenantDomain = PrivilegedCarbonContext.getThreadLocalCarbonContext().getTenantDomain();\n+            tenantDomain = IdentityTenantUtil.getTenantDomainFromContext();\n+            if (StringUtils.isBlank(tenantDomain)) {\n+                tenantDomain = PrivilegedCarbonContext.getThreadLocalCarbonContext().getTenantDomain();\n+            }\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8244288ee50935fdd84f2c6403d35e5a0b233c8e"}, "originalPosition": 89}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d67375248c97f9fd4e107e2177bca7b17bd48a8", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/4d67375248c97f9fd4e107e2177bca7b17bd48a8", "committedDate": "2020-03-26T15:29:47Z", "message": "Fix issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNTQwMjY2", "url": "https://github.com/wso2/carbon-identity-framework/pull/2838#pullrequestreview-382540266", "createdAt": "2020-03-27T02:18:07Z", "commit": {"oid": "4d67375248c97f9fd4e107e2177bca7b17bd48a8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMjoxODowN1rOF8g6sQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMjoxODowN1rOF8g6sQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk5ODE5Mw==", "bodyText": "Is there a reason to not use the resolving method.\nLooks like some checks/steps missed here", "url": "https://github.com/wso2/carbon-identity-framework/pull/2838#discussion_r398998193", "createdAt": "2020-03-27T02:18:07Z", "author": {"login": "malithie"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultURLResolverService.java", "diffHunk": "@@ -166,16 +193,29 @@ private void appendTenantPathParamInLegacyMode(StringBuilder serverUrl) {\n         }\n     }\n \n-    private void appendTenantQueryParamInLegacyMode(StringBuilder serverUrl) {\n+    private void appendTenantQueryParamInLegacyMode(StringBuilder serverUrl, String tenantDomain) {\n \n-        String tenantDomain = IdentityTenantUtil.getTenantDomainFromContext();\n+        if (StringUtils.isBlank(tenantDomain)) {\n+            tenantDomain = IdentityTenantUtil.getTenantDomainFromContext();\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d67375248c97f9fd4e107e2177bca7b17bd48a8"}, "originalPosition": 115}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37235681dc38b4c6c0078ecb3a6c22bc67809ae6", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/37235681dc38b4c6c0078ecb3a6c22bc67809ae6", "committedDate": "2020-03-27T03:44:15Z", "message": "Resolve minor issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNTk0NDk1", "url": "https://github.com/wso2/carbon-identity-framework/pull/2838#pullrequestreview-382594495", "createdAt": "2020-03-27T05:51:02Z", "commit": {"oid": "37235681dc38b4c6c0078ecb3a6c22bc67809ae6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2314, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}