{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQzNDQwMDc0", "number": 3299, "title": "Add service and DB support to add/replace a resource with a file", "bodyText": "Proposed changes in this pull request\nResolves part of wso2/product-is#10744\nIn order to support the feature wso2/product-is#9771, a notification seder should be added as a resource as well as a resource file at once.\n\nThe input properties of notification-senders API POST request will be saved as the attributes of a resource to return in the notification-senders API responses.\nAlso, an event publisher file is generated with the input values and save as a file of the resource. It is used when loading tenant wise event publisher loading flow.\n\nHowever, the current configuration-mgt service doesn't support adding a file along with the resource add. addFile() operation is separated as there is a separate endpoint to manage the resource files in configuration-mgt REST API.\nIf the existing two services (resource add, file add) are executed sequentially in the notification-senders API scenario, rolling back on one request failure is difficult to handle accurately at the API level.\nAfter Merging this PR\n\n Bump Identity framework version in identity-api-server", "createdAt": "2020-12-21T12:00:08Z", "url": "https://github.com/wso2/carbon-identity-framework/pull/3299", "merged": true, "mergeCommit": {"oid": "f4d7810e73c5d4d8882ad79ba6df006c11da0a69"}, "closed": true, "closedAt": "2020-12-23T17:56:23Z", "author": {"login": "AnuradhaSK"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdoUvpYgBqjQxMzU2ODM2MjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdpDCtIAFqTU1ODE1MDU0NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "166e7fde12e6ac2022c363e8af608b9cd544f96b", "author": {"user": {"login": "AnuradhaSK", "name": "Anuradha Karunarathna"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/166e7fde12e6ac2022c363e8af608b9cd544f96b", "committedDate": "2020-12-21T11:47:21Z", "message": "add service and DB support to add/replace a resource with a file"}, "afterCommit": {"oid": "eb5cc32aae1effe46aaf3decb22a5f973bc4d96c", "author": {"user": {"login": "AnuradhaSK", "name": "Anuradha Karunarathna"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/eb5cc32aae1effe46aaf3decb22a5f973bc4d96c", "committedDate": "2020-12-21T12:04:00Z", "message": "add service and DB support to add/replace a resource with a file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2NDY2ODQy", "url": "https://github.com/wso2/carbon-identity-framework/pull/3299#pullrequestreview-556466842", "createdAt": "2020-12-21T15:35:00Z", "commit": {"oid": "eb5cc32aae1effe46aaf3decb22a5f973bc4d96c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNTozNTowMFrOIJcXRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNTozNTowMFrOIJcXRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njc3MjgwNw==", "bodyText": "Do we need to add default implementation for the newly introduced methods to this interface.", "url": "https://github.com/wso2/carbon-identity-framework/pull/3299#discussion_r546772807", "createdAt": "2020-12-21T15:35:00Z", "author": {"login": "ayshsandu"}, "path": "components/configuration-mgt/org.wso2.carbon.identity.configuration.mgt.core/src/main/java/org/wso2/carbon/identity/configuration/mgt/core/ConfigurationManager.java", "diffHunk": "@@ -119,6 +119,20 @@ Resources getTenantResources(String tenantDomain, Condition searchCondition) thr\n      */\n     Resource addResource(String resourceTypeName, ResourceAdd resourceAdd) throws ConfigurationManagementException;\n \n+    /**\n+     * This API is used to create the given resource including a file.\n+     *\n+     * @param resourceTypeName Name of the {@link ResourceType}.\n+     * @param resourceAdd      Request to create the {@link Resource}.\n+     * @param resourceAdd      Name of the {@link ResourceFile}\n+     * @param fileName         {@link InputStream} representing the file.\n+     * @return 201 created. Returns {@link Resource} created.\n+     * @throws ConfigurationManagementException Resource management exception.\n+     */\n+    Resource addResourceWithFile(String resourceTypeName, ResourceAdd resourceAdd, String fileName,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb5cc32aae1effe46aaf3decb22a5f973bc4d96c"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf04dd3cbd325b6d606d9821a67a1278ba9e9cda", "author": {"user": {"login": "AnuradhaSK", "name": "Anuradha Karunarathna"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/bf04dd3cbd325b6d606d9821a67a1278ba9e9cda", "committedDate": "2020-12-22T06:14:26Z", "message": "add service and DB support to add/replace a resource with a file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5d503afd4850d7534a2ae4ba3af7bcb36fce2b2", "author": {"user": {"login": "AnuradhaSK", "name": "Anuradha Karunarathna"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/b5d503afd4850d7534a2ae4ba3af7bcb36fce2b2", "committedDate": "2020-12-22T06:14:27Z", "message": "add default implementations to newly added Java APIs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d85f5a3ff6b61326ec4f6fee706d155e776308a0", "author": {"user": {"login": "AnuradhaSK", "name": "Anuradha Karunarathna"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/d85f5a3ff6b61326ec4f6fee706d155e776308a0", "committedDate": "2020-12-22T06:14:27Z", "message": "fix formatting issues"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7d912deaadda3eb50b8983d110da078558ece9ef", "author": {"user": {"login": "AnuradhaSK", "name": "Anuradha Karunarathna"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/7d912deaadda3eb50b8983d110da078558ece9ef", "committedDate": "2020-12-22T04:53:27Z", "message": "fix formatting issues"}, "afterCommit": {"oid": "d85f5a3ff6b61326ec4f6fee706d155e776308a0", "author": {"user": {"login": "AnuradhaSK", "name": "Anuradha Karunarathna"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/d85f5a3ff6b61326ec4f6fee706d155e776308a0", "committedDate": "2020-12-22T06:14:27Z", "message": "fix formatting issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2OTcyMDM0", "url": "https://github.com/wso2/carbon-identity-framework/pull/3299#pullrequestreview-556972034", "createdAt": "2020-12-22T10:21:14Z", "commit": {"oid": "d85f5a3ff6b61326ec4f6fee706d155e776308a0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxMDoyMToxNFrOIJ2ANg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxMDoyMToxNFrOIJ2ANg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzE5Mjg4Ng==", "bodyText": "Formatting check all method comments", "url": "https://github.com/wso2/carbon-identity-framework/pull/3299#discussion_r547192886", "createdAt": "2020-12-22T10:21:14Z", "author": {"login": "Buddhimah"}, "path": "components/configuration-mgt/org.wso2.carbon.identity.configuration.mgt.core/src/main/java/org/wso2/carbon/identity/configuration/mgt/core/dao/ConfigurationDAO.java", "diffHunk": "@@ -115,6 +115,17 @@ Resource getResourceByName(int tenantId, String resourceTypeId, String name)\n      */\n     void addResource(Resource resource) throws ConfigurationManagementException;\n \n+    /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d85f5a3ff6b61326ec4f6fee706d155e776308a0"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2OTU0MDA5", "url": "https://github.com/wso2/carbon-identity-framework/pull/3299#pullrequestreview-556954009", "createdAt": "2020-12-22T09:53:24Z", "commit": {"oid": "d85f5a3ff6b61326ec4f6fee706d155e776308a0"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwOTo1OTo0NlrOIJ1WPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxMDoxMjo1MVrOIJ1vYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzE4MjE0Mg==", "bodyText": "Pass a resource with file details", "url": "https://github.com/wso2/carbon-identity-framework/pull/3299#discussion_r547182142", "createdAt": "2020-12-22T09:59:46Z", "author": {"login": "AnuradhaSK"}, "path": "components/configuration-mgt/org.wso2.carbon.identity.configuration.mgt.core/src/main/java/org/wso2/carbon/identity/configuration/mgt/core/ConfigurationManager.java", "diffHunk": "@@ -119,6 +120,22 @@ Resources getTenantResources(String tenantDomain, Condition searchCondition) thr\n      */\n     Resource addResource(String resourceTypeName, ResourceAdd resourceAdd) throws ConfigurationManagementException;\n \n+    /**\n+     * This API is used to create the given resource including a file.\n+     *\n+     * @param resourceTypeName Name of the {@link ResourceType}.\n+     * @param resourceAdd      Request to create the {@link Resource}.\n+     * @param resourceAdd      Name of the {@link ResourceFile}\n+     * @param fileName         {@link InputStream} representing the file.\n+     * @return 201 created. Returns {@link Resource} created.\n+     * @throws ConfigurationManagementException Resource management exception.\n+     */\n+    default Resource addResourceWithFile(String resourceTypeName, ResourceAdd resourceAdd, String fileName,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d85f5a3ff6b61326ec4f6fee706d155e776308a0"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzE4NzY1MA==", "bodyText": "remove this check", "url": "https://github.com/wso2/carbon-identity-framework/pull/3299#discussion_r547187650", "createdAt": "2020-12-22T10:11:06Z", "author": {"login": "AnuradhaSK"}, "path": "components/configuration-mgt/org.wso2.carbon.identity.configuration.mgt.core/src/main/java/org/wso2/carbon/identity/configuration/mgt/core/ConfigurationManagerImpl.java", "diffHunk": "@@ -244,6 +244,26 @@ public Resource addResource(String resourceTypeName, ResourceAdd resourceAdd)\n         return resource;\n     }\n \n+    @Override\n+    public Resource addResourceWithFile(String resourceTypeName, ResourceAdd resourceAdd, String fileName,\n+                                        InputStream fileStream) throws ConfigurationManagementException {\n+\n+        checkFeatureStatus();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d85f5a3ff6b61326ec4f6fee706d155e776308a0"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzE4ODA5Mw==", "bodyText": "add info log", "url": "https://github.com/wso2/carbon-identity-framework/pull/3299#discussion_r547188093", "createdAt": "2020-12-22T10:11:58Z", "author": {"login": "AnuradhaSK"}, "path": "components/configuration-mgt/org.wso2.carbon.identity.configuration.mgt.core/src/main/java/org/wso2/carbon/identity/configuration/mgt/core/ConfigurationManagerImpl.java", "diffHunk": "@@ -244,6 +244,26 @@ public Resource addResource(String resourceTypeName, ResourceAdd resourceAdd)\n         return resource;\n     }\n \n+    @Override\n+    public Resource addResourceWithFile(String resourceTypeName, ResourceAdd resourceAdd, String fileName,\n+                                        InputStream fileStream) throws ConfigurationManagementException {\n+\n+        checkFeatureStatus();\n+        validateResourceCreateWithFileRequest(resourceTypeName, resourceAdd, fileName, fileStream);\n+        Resource resource = generateResourceFromRequest(resourceTypeName, resourceAdd);\n+        resource.setHasFile(true);\n+        String resourceId = generateUniqueID();\n+        if (log.isDebugEnabled()) {\n+            log.debug(\"Resource id generated: \" + resourceId);\n+        }\n+        resource.setResourceId(resourceId);\n+        this.getConfigurationDAO().addResourceWithFile(resource, fileName, fileStream);\n+        if (log.isDebugEnabled()) {\n+            log.debug(resourceAdd.getName() + \" resource created successfully.\");\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d85f5a3ff6b61326ec4f6fee706d155e776308a0"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzE4ODU3Nw==", "bodyText": "Improvement:  audit logs", "url": "https://github.com/wso2/carbon-identity-framework/pull/3299#discussion_r547188577", "createdAt": "2020-12-22T10:12:51Z", "author": {"login": "AnuradhaSK"}, "path": "components/configuration-mgt/org.wso2.carbon.identity.configuration.mgt.core/src/main/java/org/wso2/carbon/identity/configuration/mgt/core/ConfigurationManagerImpl.java", "diffHunk": "@@ -244,6 +244,26 @@ public Resource addResource(String resourceTypeName, ResourceAdd resourceAdd)\n         return resource;\n     }\n \n+    @Override\n+    public Resource addResourceWithFile(String resourceTypeName, ResourceAdd resourceAdd, String fileName,\n+                                        InputStream fileStream) throws ConfigurationManagementException {\n+\n+        checkFeatureStatus();\n+        validateResourceCreateWithFileRequest(resourceTypeName, resourceAdd, fileName, fileStream);\n+        Resource resource = generateResourceFromRequest(resourceTypeName, resourceAdd);\n+        resource.setHasFile(true);\n+        String resourceId = generateUniqueID();\n+        if (log.isDebugEnabled()) {\n+            log.debug(\"Resource id generated: \" + resourceId);\n+        }\n+        resource.setResourceId(resourceId);\n+        this.getConfigurationDAO().addResourceWithFile(resource, fileName, fileStream);\n+        if (log.isDebugEnabled()) {\n+            log.debug(resourceAdd.getName() + \" resource created successfully.\");\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzE4ODA5Mw=="}, "originalCommit": {"oid": "d85f5a3ff6b61326ec4f6fee706d155e776308a0"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1741f1feb8e720cb738e8a96ad964174020220a1", "author": {"user": {"login": "AnuradhaSK", "name": "Anuradha Karunarathna"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/1741f1feb8e720cb738e8a96ad964174020220a1", "committedDate": "2020-12-22T20:49:36Z", "message": "support java api and DAO layer to add/replace resource objects with/without files. Remove config-mgt feature enable check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3NjQ0MzI1", "url": "https://github.com/wso2/carbon-identity-framework/pull/3299#pullrequestreview-557644325", "createdAt": "2020-12-23T05:12:46Z", "commit": {"oid": "1741f1feb8e720cb738e8a96ad964174020220a1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwNToxMjo0N1rOIKR2Sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwNToxMjo0N1rOIKR2Sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzY0OTA5OQ==", "bodyText": "Do you need to add both debug and info logs here. Isn't info log enough?", "url": "https://github.com/wso2/carbon-identity-framework/pull/3299#discussion_r547649099", "createdAt": "2020-12-23T05:12:47Z", "author": {"login": "ayshsandu"}, "path": "components/configuration-mgt/org.wso2.carbon.identity.configuration.mgt.core/src/main/java/org/wso2/carbon/identity/configuration/mgt/core/ConfigurationManagerImpl.java", "diffHunk": "@@ -244,14 +232,29 @@ public Resource addResource(String resourceTypeName, ResourceAdd resourceAdd)\n         return resource;\n     }\n \n+    @Override\n+    public Resource addResource(String resourceTypeName, Resource resource) throws ConfigurationManagementException {\n+\n+        validateResourceCreateRequest(resourceTypeName, resource);\n+        String resourceId = generateUniqueID();\n+        if (log.isDebugEnabled()) {\n+            log.debug(\"Resource id generated: \" + resourceId);\n+        }\n+        resource.setResourceId(resourceId);\n+        this.getConfigurationDAO().addResource(resource);\n+        if (log.isDebugEnabled()) {\n+            log.debug(resource.getResourceName() + \" resource created successfully.\");\n+        }\n+        log.info(\"Resource: \" + resource.getResourceName() + \" added successfully\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1741f1feb8e720cb738e8a96ad964174020220a1"}, "originalPosition": 71}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3NjQ0ODA1", "url": "https://github.com/wso2/carbon-identity-framework/pull/3299#pullrequestreview-557644805", "createdAt": "2020-12-23T05:14:47Z", "commit": {"oid": "1741f1feb8e720cb738e8a96ad964174020220a1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwNToxNDo0N1rOIKR8eA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwNToxNDo0N1rOIKR8eA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzY1MDY4MA==", "bodyText": "Info log is enough, no need both info and debug logs.", "url": "https://github.com/wso2/carbon-identity-framework/pull/3299#discussion_r547650680", "createdAt": "2020-12-23T05:14:47Z", "author": {"login": "ayshsandu"}, "path": "components/configuration-mgt/org.wso2.carbon.identity.configuration.mgt.core/src/main/java/org/wso2/carbon/identity/configuration/mgt/core/ConfigurationManagerImpl.java", "diffHunk": "@@ -263,13 +266,26 @@ public Resource replaceResource(String resourceTypeName, ResourceAdd resourceAdd\n         return resource;\n     }\n \n+    @Override\n+    public Resource replaceResource(String resourceTypeName, Resource resource)\n+            throws ConfigurationManagementException {\n+\n+        validateResourceReplaceRequest(resourceTypeName, resource);\n+        String resourceId = generateResourceId(resourceTypeName, resource.getResourceName());\n+        resource.setResourceId(resourceId);\n+        this.getConfigurationDAO().replaceResourceWithFiles(resource);\n+        if (log.isDebugEnabled()) {\n+            log.debug(resource.getResourceName() + \" resource created successfully.\");\n+        }\n+        log.info(resource.getResourceName() + \" resource created successfully.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1741f1feb8e720cb738e8a96ad964174020220a1"}, "originalPosition": 101}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3NjQ1MDI0", "url": "https://github.com/wso2/carbon-identity-framework/pull/3299#pullrequestreview-557645024", "createdAt": "2020-12-23T05:15:40Z", "commit": {"oid": "1741f1feb8e720cb738e8a96ad964174020220a1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwNToxNTo0MVrOIKR-7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwNToxNTo0MVrOIKR-7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzY1MTMwOQ==", "bodyText": "Add a method description on what validations are done inside the method.", "url": "https://github.com/wso2/carbon-identity-framework/pull/3299#discussion_r547651309", "createdAt": "2020-12-23T05:15:41Z", "author": {"login": "ayshsandu"}, "path": "components/configuration-mgt/org.wso2.carbon.identity.configuration.mgt.core/src/main/java/org/wso2/carbon/identity/configuration/mgt/core/ConfigurationManagerImpl.java", "diffHunk": "@@ -531,6 +531,39 @@ private void validateResourceCreateRequest(String resourceTypeName, ResourceAdd\n         }\n     }\n \n+    private void validateResourceCreateRequest(String resourceTypeName, Resource resource)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1741f1feb8e720cb738e8a96ad964174020220a1"}, "originalPosition": 191}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3NjQ2OTc3", "url": "https://github.com/wso2/carbon-identity-framework/pull/3299#pullrequestreview-557646977", "createdAt": "2020-12-23T05:23:15Z", "commit": {"oid": "1741f1feb8e720cb738e8a96ad964174020220a1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwNToyMzoxNVrOIKSTVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwNToyMzoxNVrOIKSTVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzY1NjUzNA==", "bodyText": "\"fileStream is invalid.\" -> \"Filestream is invalid or empty.\"", "url": "https://github.com/wso2/carbon-identity-framework/pull/3299#discussion_r547656534", "createdAt": "2020-12-23T05:23:15Z", "author": {"login": "ayshsandu"}, "path": "components/configuration-mgt/org.wso2.carbon.identity.configuration.mgt.core/src/main/java/org/wso2/carbon/identity/configuration/mgt/core/ConfigurationManagerImpl.java", "diffHunk": "@@ -531,6 +531,39 @@ private void validateResourceCreateRequest(String resourceTypeName, ResourceAdd\n         }\n     }\n \n+    private void validateResourceCreateRequest(String resourceTypeName, Resource resource)\n+            throws ConfigurationManagementException {\n+\n+        if (StringUtils.isEmpty(resourceTypeName) || StringUtils.isEmpty(resource.getResourceName())) {\n+            throw handleClientException(ERROR_CODE_RESOURCE_ADD_REQUEST_INVALID, null);\n+        }\n+        if (isResourceExists(resourceTypeName, resource.getResourceName())) {\n+            throw handleClientException(ERROR_CODE_RESOURCE_ALREADY_EXISTS, resource.getResourceName());\n+        }\n+        if (CollectionUtils.isNotEmpty(resource.getFiles())) {\n+            List<ResourceFile> files = resource.getFiles();\n+            for (ResourceFile file : files) {\n+                if (StringUtils.isEmpty(file.getId())) {\n+                    file.setId(generateUniqueID());\n+                }\n+                if (StringUtils.isEmpty(file.getName())) {\n+                    String fileIdentifiers = String.format(\"Resource type: %s, resourceName: %s\", resourceTypeName,\n+                            resource.getResourceName());\n+                    throw handleClientException(ERROR_CODE_FILE_IDENTIFIERS_REQUIRED, fileIdentifiers);\n+                }\n+                if (file.getInputStream() == null) {\n+                    throw handleClientException(ERROR_CODE_FILE_IDENTIFIERS_REQUIRED, \"fileStream is invalid.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1741f1feb8e720cb738e8a96ad964174020220a1"}, "originalPosition": 212}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3NjQ3Mjc4", "url": "https://github.com/wso2/carbon-identity-framework/pull/3299#pullrequestreview-557647278", "createdAt": "2020-12-23T05:24:19Z", "commit": {"oid": "1741f1feb8e720cb738e8a96ad964174020220a1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwNToyNDoxOVrOIKSWHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwNToyNDoxOVrOIKSWHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzY1NzI0Nw==", "bodyText": "\"fileStream is invalid.\" -> \"Filestream is invalid or empty.\"", "url": "https://github.com/wso2/carbon-identity-framework/pull/3299#discussion_r547657247", "createdAt": "2020-12-23T05:24:19Z", "author": {"login": "ayshsandu"}, "path": "components/configuration-mgt/org.wso2.carbon.identity.configuration.mgt.core/src/main/java/org/wso2/carbon/identity/configuration/mgt/core/ConfigurationManagerImpl.java", "diffHunk": "@@ -594,6 +625,39 @@ private void validateResourceReplaceRequest(String resourceTypeName, ResourceAdd\n         }\n     }\n \n+    private void validateResourceReplaceRequest(String resourceTypeName, Resource resource)\n+            throws ConfigurationManagementException {\n+\n+        if (StringUtils.isEmpty(resourceTypeName)) {\n+            throw handleClientException(ERROR_CODE_RESOURCE_ADD_REQUEST_INVALID, null);\n+        }\n+        if (!isResourceExists(resourceTypeName, resource.getResourceName())) {\n+            throw handleClientException(ERROR_CODE_RESOURCE_DOES_NOT_EXISTS, resource.getResourceName());\n+        }\n+        if (CollectionUtils.isNotEmpty(resource.getFiles())) {\n+            List<ResourceFile> files = resource.getFiles();\n+            for (ResourceFile file : files) {\n+                if (StringUtils.isEmpty(file.getId())) {\n+                    file.setId(generateUniqueID());\n+                }\n+                if (StringUtils.isEmpty(file.getName())) {\n+                    String fileIdentifiers = String.format(\"Resource type: %s, resourceName: %s\", resourceTypeName,\n+                            resource.getResourceName());\n+                    throw handleClientException(ERROR_CODE_FILE_IDENTIFIERS_REQUIRED, fileIdentifiers);\n+                }\n+                if (file.getInputStream() == null) {\n+                    throw handleClientException(ERROR_CODE_FILE_IDENTIFIERS_REQUIRED, \"fileStream is invalid.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1741f1feb8e720cb738e8a96ad964174020220a1"}, "originalPosition": 261}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3NjQ3NDQ3", "url": "https://github.com/wso2/carbon-identity-framework/pull/3299#pullrequestreview-557647447", "createdAt": "2020-12-23T05:24:56Z", "commit": {"oid": "1741f1feb8e720cb738e8a96ad964174020220a1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8a058aafc752688f344f981f63374479a6afa18", "author": {"user": {"login": "AnuradhaSK", "name": "Anuradha Karunarathna"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/d8a058aafc752688f344f981f63374479a6afa18", "committedDate": "2020-12-23T07:41:41Z", "message": "address review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4MTUwNTQ0", "url": "https://github.com/wso2/carbon-identity-framework/pull/3299#pullrequestreview-558150544", "createdAt": "2020-12-23T18:00:48Z", "commit": {"oid": "d8a058aafc752688f344f981f63374479a6afa18"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2141, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}