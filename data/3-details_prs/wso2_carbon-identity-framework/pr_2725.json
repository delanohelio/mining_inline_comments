{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxMzgyNjYw", "number": 2725, "title": "Fix application and internal role count from framework level", "bodyText": "Proposed changes in this pull request\n\nFixes wso2/product-is#7470.\n\nApproach taken\n\nThe newly implemented getRoleCount method delegates counting logic to the user store manager. But for internal or application roles, counting should be done with the corresponding tables in the identity database, not with the user store manager. Therefore, the logic to retrieve internal user role count from the user store manager is removed, and the previous implementation is restored.", "createdAt": "2020-02-05T13:47:17Z", "url": "https://github.com/wso2/carbon-identity-framework/pull/2725", "merged": true, "mergeCommit": {"oid": "e9f6bfe69e6ac452838d7e6b12c8a48353f0514b"}, "closed": true, "closedAt": "2020-02-07T12:31:47Z", "author": {"login": "tharindu-bandara"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBWFYqAH2gAyMzcxMzgyNjYwOmIyZjZkY2QzODRhM2RkYzc1MTBmZmEyMmQ4ZmJhNTc1ZjA4MGFiZjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcB-eh4AFqTM1NTEyMjk5MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b2f6dcd384a3ddc7510ffa22d8fba575f080abf8", "author": {"user": {"login": "tharindu-bandara", "name": "Tharindu Bandara"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/b2f6dcd384a3ddc7510ffa22d8fba575f080abf8", "committedDate": "2020-02-05T13:23:48Z", "message": "Revert the logic for application and internal role count."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0Mzg4NDg4", "url": "https://github.com/wso2/carbon-identity-framework/pull/2725#pullrequestreview-354388488", "createdAt": "2020-02-06T11:43:39Z", "commit": {"oid": "b2f6dcd384a3ddc7510ffa22d8fba575f080abf8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxMTo0Mzo0MFrOFmYRjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxMTo0Mzo0MFrOFmYRjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc4NzkxOQ==", "bodyText": "Need to use the hybrid role manager instead.", "url": "https://github.com/wso2/carbon-identity-framework/pull/2725#discussion_r375787919", "createdAt": "2020-02-06T11:43:40Z", "author": {"login": "tharindu-bandara"}, "path": "components/user-store/org.wso2.carbon.identity.user.store.count/src/main/java/org/wso2/carbon/identity/user/store/count/UserStoreCountService.java", "diffHunk": "@@ -86,13 +86,10 @@\n             roleCounts[i] = new PairDTO(userStoreDomain, Long.toString(count));\n             i++;\n         }\n-        String internalDomainFilter = UserCoreConstants.INTERNAL_DOMAIN + UserCoreConstants.DOMAIN_SEPARATOR + filter;\n-        String applicationDomainFilter = InternalStoreCountConstants.APPLICATION_DOMAIN +\n-                UserCoreConstants.DOMAIN_SEPARATOR + filter;\n-        roleCounts[i] = new PairDTO(UserCoreConstants.INTERNAL_DOMAIN, String.valueOf(\n-                getRoleCount(internalDomainFilter)));\n-        roleCounts[++i] = new PairDTO(InternalStoreCountConstants.APPLICATION_DOMAIN, String.valueOf(\n-                getRoleCount(applicationDomainFilter)));\n+        roleCounts[i] =  new PairDTO(UserCoreConstants.INTERNAL_DOMAIN, String.valueOf(\n+                UserStoreCountUtils.getInternalRoleCount(filter)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2f6dcd384a3ddc7510ffa22d8fba575f080abf8"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1MTIyOTkw", "url": "https://github.com/wso2/carbon-identity-framework/pull/2725#pullrequestreview-355122990", "createdAt": "2020-02-07T12:27:28Z", "commit": {"oid": "b2f6dcd384a3ddc7510ffa22d8fba575f080abf8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2381, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}