{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxMjk1MjUz", "number": 2953, "title": "Implement workflow deletion on tenant deletion", "bodyText": "Proposed changes in this pull request\nImplement the deletion of workflows when a Tenant gets deleted\nFixes: #2952", "createdAt": "2020-05-21T11:14:32Z", "url": "https://github.com/wso2/carbon-identity-framework/pull/2953", "merged": true, "mergeCommit": {"oid": "d5c6c4d4af9d9caf93ab8e60fe5fd2b0f8bcd832"}, "closed": true, "closedAt": "2020-07-13T05:14:52Z", "author": {"login": "sumedhe"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjbuehAH2gAyNDIxMjk1MjUzOjEwNDdhOTBjNDhjMjA2OThjZDlkNmE5YThjZWE1ZDM1MWU1N2FjMTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABds7aVcAFqTU2MTI3OTc3MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1047a90c48c20698cd9d6a9a8cea5d351e57ac10", "author": {"user": {"login": "sumedhe", "name": "Sumedhe Dissanayake"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/1047a90c48c20698cd9d6a9a8cea5d351e57ac10", "committedDate": "2020-05-21T11:11:38Z", "message": "Implement workflow deletion on tenant deletion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d554363572c36bb88f80674cafd5c0994023b6c", "author": {"user": {"login": "sumedhe", "name": "Sumedhe Dissanayake"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/7d554363572c36bb88f80674cafd5c0994023b6c", "committedDate": "2020-05-21T11:42:18Z", "message": "Fix minor issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3Njg4MTcw", "url": "https://github.com/wso2/carbon-identity-framework/pull/2953#pullrequestreview-417688170", "createdAt": "2020-05-25T12:48:07Z", "commit": {"oid": "7d554363572c36bb88f80674cafd5c0994023b6c"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMjo0ODowN1rOGaADFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMjo1MToxMVrOGaAIDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkxNjk1MA==", "bodyText": "Shall we add a new line after the method signature to follow the format? WDYT?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2953#discussion_r429916950", "createdAt": "2020-05-25T12:48:07Z", "author": {"login": "ShanChathusanda93"}, "path": "components/workflow-mgt/org.wso2.carbon.identity.workflow.mgt/src/main/java/org/wso2/carbon/identity/workflow/mgt/WorkflowManagementAdminService.java", "diffHunk": "@@ -327,6 +327,21 @@ public void removeWorkflow(String id) throws WorkflowException {\n         }\n     }\n \n+    /**\n+     * Remove workflows by a given tenant id.\n+     *\n+     * @param tenantId Id of workflow to remove\n+     * @throws WorkflowException\n+     */\n+    public void removeWorkflows(int tenantId) throws WorkflowException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d554363572c36bb88f80674cafd5c0994023b6c"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkxODIyMw==", "bodyText": "Shall we add a new line after the method signature?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2953#discussion_r429918223", "createdAt": "2020-05-25T12:51:11Z", "author": {"login": "ShanChathusanda93"}, "path": "components/workflow-mgt/org.wso2.carbon.identity.workflow.mgt/src/main/java/org/wso2/carbon/identity/workflow/mgt/listener/WorkflowTenantMgtListener.java", "diffHunk": "@@ -0,0 +1,70 @@\n+package org.wso2.carbon.identity.workflow.mgt.listener;\n+\n+import org.wso2.carbon.identity.workflow.mgt.exception.WorkflowException;\n+import org.wso2.carbon.identity.workflow.mgt.internal.WorkflowServiceDataHolder;\n+import org.wso2.carbon.stratos.common.beans.TenantInfoBean;\n+import org.wso2.carbon.stratos.common.exception.StratosException;\n+import org.wso2.carbon.stratos.common.listeners.TenantMgtListener;\n+\n+/**\n+ * Workflow Tenant Management Listener.\n+ */\n+public class WorkflowTenantMgtListener implements TenantMgtListener {\n+    private static final int EXEC_ORDER = 12;\n+\n+    @Override\n+    public void onTenantCreate(TenantInfoBean tenantInfoBean) throws StratosException {\n+\n+    }\n+\n+    @Override\n+    public void onTenantUpdate(TenantInfoBean tenantInfoBean) throws StratosException {\n+\n+    }\n+\n+    @Override\n+    public void onTenantDelete(int i) {\n+\n+    }\n+\n+    @Override\n+    public void onTenantRename(int i, String s, String s2) throws StratosException {\n+\n+    }\n+\n+    @Override\n+    public void onTenantInitialActivation(int i) throws StratosException {\n+\n+    }\n+\n+    @Override\n+    public void onTenantActivation(int i) throws StratosException {\n+\n+    }\n+\n+    @Override\n+    public void onTenantDeactivation(int i) throws StratosException {\n+\n+    }\n+\n+    @Override\n+    public void onSubscriptionPlanChange(int i, String s, String s2) throws StratosException {\n+\n+    }\n+\n+    @Override\n+    public int getListenerOrder() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d554363572c36bb88f80674cafd5c0994023b6c"}, "originalPosition": 56}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "48e5f428c8cc1f8526aa7d3f6b102e03d94d92a6", "author": {"user": {"login": "sumedhe", "name": "Sumedhe Dissanayake"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/48e5f428c8cc1f8526aa7d3f6b102e03d94d92a6", "committedDate": "2020-05-29T07:19:35Z", "message": "Fix minor issues"}, "afterCommit": {"oid": "a00ca8830f1455650957bed82380b7f37fb451ce", "author": {"user": {"login": "sumedhe", "name": "Sumedhe Dissanayake"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/a00ca8830f1455650957bed82380b7f37fb451ce", "committedDate": "2020-05-29T07:21:14Z", "message": "Fix minor issues"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a00ca8830f1455650957bed82380b7f37fb451ce", "author": {"user": {"login": "sumedhe", "name": "Sumedhe Dissanayake"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/a00ca8830f1455650957bed82380b7f37fb451ce", "committedDate": "2020-05-29T07:21:14Z", "message": "Fix minor issues"}, "afterCommit": {"oid": "bb6c928b4a175847054763a19549aacd10199a8e", "author": {"user": {"login": "sumedhe", "name": "Sumedhe Dissanayake"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/bb6c928b4a175847054763a19549aacd10199a8e", "committedDate": "2020-05-29T07:53:18Z", "message": "Fix minor issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzMDcyNTMx", "url": "https://github.com/wso2/carbon-identity-framework/pull/2953#pullrequestreview-433072531", "createdAt": "2020-06-18T08:49:36Z", "commit": {"oid": "bb6c928b4a175847054763a19549aacd10199a8e"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwODo0OTozNlrOGll0Vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwODo1Mjo0MFrOGll8Iw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA3MDEwMg==", "bodyText": "use try with resource for the connection and the prepared statement. Fix in all the places.", "url": "https://github.com/wso2/carbon-identity-framework/pull/2953#discussion_r442070102", "createdAt": "2020-06-18T08:49:36Z", "author": {"login": "madurangasiriwardena"}, "path": "components/workflow-mgt/org.wso2.carbon.identity.workflow.mgt/src/main/java/org/wso2/carbon/identity/workflow/mgt/dao/WorkflowDAO.java", "diffHunk": "@@ -137,6 +137,30 @@ public void removeWorkflow(String workflowId) throws InternalWorkflowException {\n         }\n     }\n \n+    /**\n+     * Remove all workflows of a given tenant id.\n+     *\n+     * @param tenantId Id of the tenant\n+     * @throws InternalWorkflowException\n+     */\n+    public void removeWorkflowByTenantId(int tenantId) throws InternalWorkflowException {\n+\n+        Connection connection = IdentityDatabaseUtil.getDBConnection(true);\n+        PreparedStatement prepStmt = null;\n+        String query = SQLConstants.DELETE_WORKFLOW_BY_TENANT_ID_QUERY;\n+        try {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb6c928b4a175847054763a19549aacd10199a8e"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA3MjA5OQ==", "bodyText": "Isn't there an abstract listener that removes the requirement of overriding all the methods?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2953#discussion_r442072099", "createdAt": "2020-06-18T08:52:40Z", "author": {"login": "madurangasiriwardena"}, "path": "components/workflow-mgt/org.wso2.carbon.identity.workflow.mgt/src/main/java/org/wso2/carbon/identity/workflow/mgt/listener/WorkflowTenantMgtListener.java", "diffHunk": "@@ -0,0 +1,89 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.workflow.mgt.listener;\n+\n+import org.wso2.carbon.identity.workflow.mgt.exception.WorkflowException;\n+import org.wso2.carbon.identity.workflow.mgt.internal.WorkflowServiceDataHolder;\n+import org.wso2.carbon.stratos.common.beans.TenantInfoBean;\n+import org.wso2.carbon.stratos.common.exception.StratosException;\n+import org.wso2.carbon.stratos.common.listeners.TenantMgtListener;\n+\n+/**\n+ * Workflow Tenant Management Listener.\n+ */\n+public class WorkflowTenantMgtListener implements TenantMgtListener {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb6c928b4a175847054763a19549aacd10199a8e"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzOTU5NzM5", "url": "https://github.com/wso2/carbon-identity-framework/pull/2953#pullrequestreview-433959739", "createdAt": "2020-06-19T10:11:01Z", "commit": {"oid": "bb6c928b4a175847054763a19549aacd10199a8e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMDoxMTowMVrOGmPisw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMDoxMTowMVrOGmPisw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjc1MzcxNQ==", "bodyText": "rename to public void removeWorkflowParams(int tenantId)", "url": "https://github.com/wso2/carbon-identity-framework/pull/2953#discussion_r442753715", "createdAt": "2020-06-19T10:11:01Z", "author": {"login": "IsuraD"}, "path": "components/workflow-mgt/org.wso2.carbon.identity.workflow.mgt/src/main/java/org/wso2/carbon/identity/workflow/mgt/dao/WorkflowDAO.java", "diffHunk": "@@ -232,7 +256,30 @@ public void removeWorkflowParams(String workflowId) throws InternalWorkflowExcep\n         }\n     }\n \n+    /**\n+     * Clear all the parameters of all the workflows of a given tenant.\n+     *\n+     * @param tenantId Id of the tenant\n+     * @throws InternalWorkflowException\n+     */\n+    public void removeWorkflowParamsByTenantId(int tenantId) throws InternalWorkflowException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb6c928b4a175847054763a19549aacd10199a8e"}, "originalPosition": 59}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzOTU5ODkw", "url": "https://github.com/wso2/carbon-identity-framework/pull/2953#pullrequestreview-433959890", "createdAt": "2020-06-19T10:11:17Z", "commit": {"oid": "bb6c928b4a175847054763a19549aacd10199a8e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMDoxMToxN1rOGmPjMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMDoxMToxN1rOGmPjMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjc1Mzg0MQ==", "bodyText": "Rename to public void removeWorkflows(int tenantId)", "url": "https://github.com/wso2/carbon-identity-framework/pull/2953#discussion_r442753841", "createdAt": "2020-06-19T10:11:17Z", "author": {"login": "IsuraD"}, "path": "components/workflow-mgt/org.wso2.carbon.identity.workflow.mgt/src/main/java/org/wso2/carbon/identity/workflow/mgt/dao/WorkflowDAO.java", "diffHunk": "@@ -137,6 +137,30 @@ public void removeWorkflow(String workflowId) throws InternalWorkflowException {\n         }\n     }\n \n+    /**\n+     * Remove all workflows of a given tenant id.\n+     *\n+     * @param tenantId Id of the tenant\n+     * @throws InternalWorkflowException\n+     */\n+    public void removeWorkflowByTenantId(int tenantId) throws InternalWorkflowException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb6c928b4a175847054763a19549aacd10199a8e"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12fbf8f7c88c6d2603327181d5543b0a1329cdd4", "author": {"user": {"login": "sumedhe", "name": "Sumedhe Dissanayake"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/12fbf8f7c88c6d2603327181d5543b0a1329cdd4", "committedDate": "2020-06-21T19:42:56Z", "message": "Fix minor issues"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bb6c928b4a175847054763a19549aacd10199a8e", "author": {"user": {"login": "sumedhe", "name": "Sumedhe Dissanayake"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/bb6c928b4a175847054763a19549aacd10199a8e", "committedDate": "2020-05-29T07:53:18Z", "message": "Fix minor issues"}, "afterCommit": {"oid": "12fbf8f7c88c6d2603327181d5543b0a1329cdd4", "author": {"user": {"login": "sumedhe", "name": "Sumedhe Dissanayake"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/12fbf8f7c88c6d2603327181d5543b0a1329cdd4", "committedDate": "2020-06-21T19:42:56Z", "message": "Fix minor issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2OTg1Njgx", "url": "https://github.com/wso2/carbon-identity-framework/pull/2953#pullrequestreview-446985681", "createdAt": "2020-07-13T05:14:44Z", "commit": {"oid": "12fbf8f7c88c6d2603327181d5543b0a1329cdd4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMjc0OTc4", "url": "https://github.com/wso2/carbon-identity-framework/pull/2953#pullrequestreview-561274978", "createdAt": "2021-01-04T19:15:45Z", "commit": {"oid": "12fbf8f7c88c6d2603327181d5543b0a1329cdd4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxOToxNTo0NVrOIN9uOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxOToxNTo0NVrOIN9uOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTUxMzY1Ng==", "bodyText": "Fix the comments properly. Check all the places.", "url": "https://github.com/wso2/carbon-identity-framework/pull/2953#discussion_r551513656", "createdAt": "2021-01-04T19:15:45Z", "author": {"login": "ashensw"}, "path": "components/workflow-mgt/org.wso2.carbon.identity.workflow.mgt/src/main/java/org/wso2/carbon/identity/workflow/mgt/WorkflowManagementAdminService.java", "diffHunk": "@@ -327,6 +327,22 @@ public void removeWorkflow(String id) throws WorkflowException {\n         }\n     }\n \n+    /**\n+     * Remove workflows by a given tenant id.\n+     *\n+     * @param tenantId Id of workflow to remove\n+     * @throws WorkflowException", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12fbf8f7c88c6d2603327181d5543b0a1329cdd4"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMjc2MTYx", "url": "https://github.com/wso2/carbon-identity-framework/pull/2953#pullrequestreview-561276161", "createdAt": "2021-01-04T19:17:30Z", "commit": {"oid": "12fbf8f7c88c6d2603327181d5543b0a1329cdd4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxOToxNzozMFrOIN9x5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxOToxNzozMFrOIN9x5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTUxNDU5OQ==", "bodyText": "Is this semicolon needed?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2953#discussion_r551514599", "createdAt": "2021-01-04T19:17:30Z", "author": {"login": "ashensw"}, "path": "components/workflow-mgt/org.wso2.carbon.identity.workflow.mgt/src/main/java/org/wso2/carbon/identity/workflow/mgt/WorkflowManagementService.java", "diffHunk": "@@ -142,6 +142,16 @@ void addAssociation(String associationName, String workflowId, String eventId, S\n      */\n     void removeWorkflow(String id) throws WorkflowException;\n \n+    /**\n+     * Remove all workflows by tenant id.\n+     *\n+     * @param tenantId  Id of the tenant\n+     * @throws WorkflowException\n+     */\n+    default void removeWorkflows(int tenantId) throws WorkflowException {\n+\n+    };", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12fbf8f7c88c6d2603327181d5543b0a1329cdd4"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMjc3MTA3", "url": "https://github.com/wso2/carbon-identity-framework/pull/2953#pullrequestreview-561277107", "createdAt": "2021-01-04T19:18:56Z", "commit": {"oid": "12fbf8f7c88c6d2603327181d5543b0a1329cdd4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxOToxODo1NlrOIN90rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxOToxODo1NlrOIN90rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTUxNTMxMA==", "bodyText": "The comments should start with a capital and end with a full stop. Fix all the other comments accordingly.", "url": "https://github.com/wso2/carbon-identity-framework/pull/2953#discussion_r551515310", "createdAt": "2021-01-04T19:18:56Z", "author": {"login": "ashensw"}, "path": "components/workflow-mgt/org.wso2.carbon.identity.workflow.mgt/src/main/java/org/wso2/carbon/identity/workflow/mgt/WorkflowManagementServiceImpl.java", "diffHunk": "@@ -472,6 +473,39 @@ public void removeWorkflow(String workflowId) throws WorkflowException {\n         }\n     }\n \n+    /**\n+     * Remove all workflows by tenant id.\n+     *\n+     * @param tenantId  Id of the tenant\n+     * @throws WorkflowException\n+     */\n+    @Override\n+    public void removeWorkflows(int tenantId) throws WorkflowException {\n+\n+        if (log.isDebugEnabled()) {\n+            log.debug(\"Deleting all workflows of tenant: \" + tenantId);\n+        }\n+\n+        List<WorkflowListener> workflowListenerList = WorkflowServiceDataHolder.getInstance().getWorkflowListenerList();\n+\n+        // Invoke onPreDelete on workflow listeners", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12fbf8f7c88c6d2603327181d5543b0a1329cdd4"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMjc4MjI2", "url": "https://github.com/wso2/carbon-identity-framework/pull/2953#pullrequestreview-561278226", "createdAt": "2021-01-04T19:20:41Z", "commit": {"oid": "12fbf8f7c88c6d2603327181d5543b0a1329cdd4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxOToyMDo0MlrOIN94IQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxOToyMDo0MlrOIN94IQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTUxNjE5Mw==", "bodyText": "Where the errorMessage is defined?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2953#discussion_r551516193", "createdAt": "2021-01-04T19:20:42Z", "author": {"login": "ashensw"}, "path": "components/workflow-mgt/org.wso2.carbon.identity.workflow.mgt/src/main/java/org/wso2/carbon/identity/workflow/mgt/dao/WorkflowDAO.java", "diffHunk": "@@ -137,6 +137,26 @@ public void removeWorkflow(String workflowId) throws InternalWorkflowException {\n         }\n     }\n \n+    /**\n+     * Remove all workflows of a given tenant id.\n+     *\n+     * @param tenantId Id of the tenant\n+     * @throws InternalWorkflowException\n+     */\n+    public void removeWorkflows(int tenantId) throws InternalWorkflowException {\n+\n+        try (Connection connection = IdentityDatabaseUtil.getDBConnection(true)) {\n+            try (PreparedStatement prepStmt = connection.prepareStatement(SQLConstants\n+                    .DELETE_WORKFLOW_BY_TENANT_ID_QUERY)) {\n+                prepStmt.setInt(1, tenantId);\n+                prepStmt.executeUpdate();\n+                IdentityDatabaseUtil.commitTransaction(connection);\n+            }\n+        } catch (SQLException e) {\n+            throw new InternalWorkflowException(errorMessage, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12fbf8f7c88c6d2603327181d5543b0a1329cdd4"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMjc4Mjg4", "url": "https://github.com/wso2/carbon-identity-framework/pull/2953#pullrequestreview-561278288", "createdAt": "2021-01-04T19:20:48Z", "commit": {"oid": "12fbf8f7c88c6d2603327181d5543b0a1329cdd4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxOToyMDo0OFrOIN94TA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxOToyMDo0OFrOIN94TA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTUxNjIzNg==", "bodyText": "Where the errorMessage is defined?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2953#discussion_r551516236", "createdAt": "2021-01-04T19:20:48Z", "author": {"login": "ashensw"}, "path": "components/workflow-mgt/org.wso2.carbon.identity.workflow.mgt/src/main/java/org/wso2/carbon/identity/workflow/mgt/dao/WorkflowDAO.java", "diffHunk": "@@ -232,7 +252,26 @@ public void removeWorkflowParams(String workflowId) throws InternalWorkflowExcep\n         }\n     }\n \n+    /**\n+     * Clear all the parameters of all the workflows of a given tenant.\n+     *\n+     * @param tenantId Id of the tenant\n+     * @throws InternalWorkflowException\n+     */\n+    public void removeWorkflowParams(int tenantId) throws InternalWorkflowException {\n \n+        try (Connection connection = IdentityDatabaseUtil.getDBConnection(true)) {\n+            try (PreparedStatement prepStmt = connection.prepareStatement(SQLConstants\n+                    .DELETE_WORKFLOW_PARAMS_BY_TENANT_ID_QUERY)) {\n+                prepStmt.setInt(1, tenantId);\n+                prepStmt.executeUpdate();\n+                IdentityDatabaseUtil.commitTransaction(connection);\n+            }\n+        } catch (SQLException e) {\n+            throw new InternalWorkflowException(errorMessage, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12fbf8f7c88c6d2603327181d5543b0a1329cdd4"}, "originalPosition": 65}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMjc5MjQ5", "url": "https://github.com/wso2/carbon-identity-framework/pull/2953#pullrequestreview-561279249", "createdAt": "2021-01-04T19:22:17Z", "commit": {"oid": "12fbf8f7c88c6d2603327181d5543b0a1329cdd4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxOToyMjoxN1rOIN97OQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxOToyMjoxN1rOIN97OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTUxNjk4NQ==", "bodyText": "Fix the comments properly.", "url": "https://github.com/wso2/carbon-identity-framework/pull/2953#discussion_r551516985", "createdAt": "2021-01-04T19:22:17Z", "author": {"login": "ashensw"}, "path": "components/workflow-mgt/org.wso2.carbon.identity.workflow.mgt/src/main/java/org/wso2/carbon/identity/workflow/mgt/listener/WorkflowTenantMgtListener.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.workflow.mgt.listener;\n+\n+import org.wso2.carbon.identity.core.AbstractIdentityTenantMgtListener;\n+import org.wso2.carbon.identity.workflow.mgt.exception.WorkflowException;\n+import org.wso2.carbon.identity.workflow.mgt.internal.WorkflowServiceDataHolder;\n+import org.wso2.carbon.stratos.common.exception.StratosException;\n+\n+/**\n+ * Workflow Tenant Management Listener.\n+ */\n+public class WorkflowTenantMgtListener extends AbstractIdentityTenantMgtListener {\n+    private static final int EXEC_ORDER = 12;\n+\n+    /**\n+     * Get listener order.\n+     *\n+     * @return", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12fbf8f7c88c6d2603327181d5543b0a1329cdd4"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMjc5Nzcx", "url": "https://github.com/wso2/carbon-identity-framework/pull/2953#pullrequestreview-561279771", "createdAt": "2021-01-04T19:23:04Z", "commit": {"oid": "12fbf8f7c88c6d2603327181d5543b0a1329cdd4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxOToyMzowNFrOIN98tQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxOToyMzowNFrOIN98tQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTUxNzM2NQ==", "bodyText": "Let's add a new line here.", "url": "https://github.com/wso2/carbon-identity-framework/pull/2953#discussion_r551517365", "createdAt": "2021-01-04T19:23:04Z", "author": {"login": "ashensw"}, "path": "components/workflow-mgt/org.wso2.carbon.identity.workflow.mgt/src/main/java/org/wso2/carbon/identity/workflow/mgt/listener/WorkflowTenantMgtListener.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.workflow.mgt.listener;\n+\n+import org.wso2.carbon.identity.core.AbstractIdentityTenantMgtListener;\n+import org.wso2.carbon.identity.workflow.mgt.exception.WorkflowException;\n+import org.wso2.carbon.identity.workflow.mgt.internal.WorkflowServiceDataHolder;\n+import org.wso2.carbon.stratos.common.exception.StratosException;\n+\n+/**\n+ * Workflow Tenant Management Listener.\n+ */\n+public class WorkflowTenantMgtListener extends AbstractIdentityTenantMgtListener {\n+    private static final int EXEC_ORDER = 12;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12fbf8f7c88c6d2603327181d5543b0a1329cdd4"}, "originalPosition": 30}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2283, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}