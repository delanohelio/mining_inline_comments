{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyMjM0MDY4", "number": 2869, "title": "Improve URL resolving logic in ConfigurationFacade", "bodyText": "Minor refactoring", "createdAt": "2020-04-11T19:11:27Z", "url": "https://github.com/wso2/carbon-identity-framework/pull/2869", "merged": true, "mergeCommit": {"oid": "762d4c5517eb5b5a28cb3959ad80aaddc22df650"}, "closed": true, "closedAt": "2020-04-21T02:18:36Z", "author": {"login": "mefarazath"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcWwtNBAFqTM5MTgxNTE3MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZqHiVAFqTM5Njk0MTgyMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxODE1MTcw", "url": "https://github.com/wso2/carbon-identity-framework/pull/2869#pullrequestreview-391815170", "createdAt": "2020-04-12T02:17:13Z", "commit": {"oid": "15324511c9d1afb2713abf4f41933fb9ec0b665c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQwMjoxNzoxM1rOGERijg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQwMjoxNzoxM1rOGERijg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzEzNDg2Mg==", "bodyText": "There's a small concern here.\nWe should read from file only when it's not tenant url supported mode right.\nIf it's tenant url supported, context is always a path, that will be resolved to an absolute URL from the URL builder.\nIf tenant url not supported only we will have to worry about, the context read from the file is absolute or not.", "url": "https://github.com/wso2/carbon-identity-framework/pull/2869#discussion_r407134862", "createdAt": "2020-04-12T02:17:13Z", "author": {"login": "malithie"}, "path": "components/authentication-framework/org.wso2.carbon.identity.application.authentication.framework/src/main/java/org/wso2/carbon/identity/application/authentication/framework/config/ConfigurationFacade.java", "diffHunk": "@@ -263,28 +266,60 @@ public int getMaxLoginAttemptCount() {\n \n     private String buildUrl(String defaultContext, Supplier<String> getValueFromFileBasedConfig) {\n \n-        String url;\n-        if (IdentityTenantUtil.isTenantQualifiedUrlsEnabled()) {\n-            url = buildTenantQualifiedUrl(defaultContext);\n+        if (log.isDebugEnabled()) {\n+            log.debug(\"Building url for context: \" + defaultContext);\n+        }\n+\n+        String context = defaultContext;\n+\n+        String urlFromFileBasedConfig = getValueFromFileBasedConfig.get();\n+        if (StringUtils.isNotBlank(urlFromFileBasedConfig)) {\n+            // If the file based config is set, then we have to build the URL based on that.\n+            if (log.isDebugEnabled()) {\n+                log.debug(\"URL from file based config: \" + urlFromFileBasedConfig);\n+            }\n+            context = urlFromFileBasedConfig;\n+        }\n+\n+        if (isUrlAbsolute(context)) {\n+            if (log.isDebugEnabled()) {\n+                log.debug(\"URL: \" + context + \" is absolute. Returning it as the resolved URL.\");\n+            }\n+            return context;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15324511c9d1afb2713abf4f41933fb9ec0b665c"}, "originalPosition": 47}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "15324511c9d1afb2713abf4f41933fb9ec0b665c", "author": {"user": {"login": "mefarazath", "name": "Farasath Ahamed"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/15324511c9d1afb2713abf4f41933fb9ec0b665c", "committedDate": "2020-04-11T19:08:21Z", "message": "Improve URL resolving logic in ConfigurationFacade"}, "afterCommit": {"oid": "0d3677615acfd59fe8fe7aa2c655b0bc7c5dc30e", "author": {"user": {"login": "mefarazath", "name": "Farasath Ahamed"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/0d3677615acfd59fe8fe7aa2c655b0bc7c5dc30e", "committedDate": "2020-04-15T11:19:29Z", "message": "Improve ConfigurationFacade url resolving logic"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0d3677615acfd59fe8fe7aa2c655b0bc7c5dc30e", "author": {"user": {"login": "mefarazath", "name": "Farasath Ahamed"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/0d3677615acfd59fe8fe7aa2c655b0bc7c5dc30e", "committedDate": "2020-04-15T11:19:29Z", "message": "Improve ConfigurationFacade url resolving logic"}, "afterCommit": {"oid": "0d599dc5f0f711a40f5dde89a9c0d2ceb717eb1b", "author": {"user": {"login": "mefarazath", "name": "Farasath Ahamed"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/0d599dc5f0f711a40f5dde89a9c0d2ceb717eb1b", "committedDate": "2020-04-15T14:30:18Z", "message": "Improve ConfigurationFacade url resolving logic"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0d599dc5f0f711a40f5dde89a9c0d2ceb717eb1b", "author": {"user": {"login": "mefarazath", "name": "Farasath Ahamed"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/0d599dc5f0f711a40f5dde89a9c0d2ceb717eb1b", "committedDate": "2020-04-15T14:30:18Z", "message": "Improve ConfigurationFacade url resolving logic"}, "afterCommit": {"oid": "8010b0d493cc127e6d9081b906d9c8192b5b5e8b", "author": {"user": {"login": "mefarazath", "name": "Farasath Ahamed"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/8010b0d493cc127e6d9081b906d9c8192b5b5e8b", "committedDate": "2020-04-20T08:17:02Z", "message": "Improve ConfigurationFacade url resolving logic"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8010b0d493cc127e6d9081b906d9c8192b5b5e8b", "author": {"user": {"login": "mefarazath", "name": "Farasath Ahamed"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/8010b0d493cc127e6d9081b906d9c8192b5b5e8b", "committedDate": "2020-04-20T08:17:02Z", "message": "Improve ConfigurationFacade url resolving logic"}, "afterCommit": {"oid": "6695c51811fd00989cd520b6b4195561406b17ff", "author": {"user": {"login": "mefarazath", "name": "Farasath Ahamed"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/6695c51811fd00989cd520b6b4195561406b17ff", "committedDate": "2020-04-20T08:20:57Z", "message": "Improve ConfigurationFacade url resolving logic"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6695c51811fd00989cd520b6b4195561406b17ff", "author": {"user": {"login": "mefarazath", "name": "Farasath Ahamed"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/6695c51811fd00989cd520b6b4195561406b17ff", "committedDate": "2020-04-20T08:20:57Z", "message": "Improve ConfigurationFacade url resolving logic"}, "afterCommit": {"oid": "4d3aa75f857ac129e829bab94d6ab433e2114a05", "author": {"user": {"login": "mefarazath", "name": "Farasath Ahamed"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/4d3aa75f857ac129e829bab94d6ab433e2114a05", "committedDate": "2020-04-20T08:29:27Z", "message": "Improve ConfigurationFacade url resolving logic"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2Mjg5MDQx", "url": "https://github.com/wso2/carbon-identity-framework/pull/2869#pullrequestreview-396289041", "createdAt": "2020-04-20T09:30:43Z", "commit": {"oid": "4d3aa75f857ac129e829bab94d6ab433e2114a05"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwOTozMDo0M1rOGILnCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwOTozMDo0M1rOGILnCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTIzMjAwOQ==", "bodyText": "Should we return the default context here.\nShouldn't that be a absolute public ?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2869#discussion_r411232009", "createdAt": "2020-04-20T09:30:43Z", "author": {"login": "malithie"}, "path": "components/authentication-framework/org.wso2.carbon.identity.application.authentication.framework/src/main/java/org/wso2/carbon/identity/application/authentication/framework/config/ConfigurationFacade.java", "diffHunk": "@@ -263,28 +263,25 @@ public int getMaxLoginAttemptCount() {\n \n     private String buildUrl(String defaultContext, Supplier<String> getValueFromFileBasedConfig) {\n \n-        String url;\n         if (IdentityTenantUtil.isTenantQualifiedUrlsEnabled()) {\n-            url = buildTenantQualifiedUrl(defaultContext);\n+            return buildAbsoluteUrl(defaultContext);\n         } else {\n-            String authenticationEndpointURLInFile = getValueFromFileBasedConfig.get();\n-            if (StringUtils.isNotBlank(authenticationEndpointURLInFile)) {\n-                // Use the value configured in the file.\n-                url = authenticationEndpointURLInFile;\n+            String urlFromFileBasedConfig = getValueFromFileBasedConfig.get();\n+            if (StringUtils.isNotBlank(urlFromFileBasedConfig)) {\n+                // If the file based URL is set, then we have to return the file based URL.\n+                return urlFromFileBasedConfig;\n             } else {\n-                // Use the default context.\n-                url = defaultContext;\n+                return defaultContext;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d3aa75f857ac129e829bab94d6ab433e2114a05"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2MjkwMzM3", "url": "https://github.com/wso2/carbon-identity-framework/pull/2869#pullrequestreview-396290337", "createdAt": "2020-04-20T09:32:26Z", "commit": {"oid": "4d3aa75f857ac129e829bab94d6ab433e2114a05"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwOTozMjoyNlrOGILrbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwOTozMjoyNlrOGILrbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTIzMzEzNA==", "bodyText": "I would prefer if this exception can be thrown and handled at the public API layer", "url": "https://github.com/wso2/carbon-identity-framework/pull/2869#discussion_r411233134", "createdAt": "2020-04-20T09:32:26Z", "author": {"login": "malithie"}, "path": "components/authentication-framework/org.wso2.carbon.identity.application.authentication.framework/src/main/java/org/wso2/carbon/identity/application/authentication/framework/config/ConfigurationFacade.java", "diffHunk": "@@ -263,28 +263,25 @@ public int getMaxLoginAttemptCount() {\n \n     private String buildUrl(String defaultContext, Supplier<String> getValueFromFileBasedConfig) {\n \n-        String url;\n         if (IdentityTenantUtil.isTenantQualifiedUrlsEnabled()) {\n-            url = buildTenantQualifiedUrl(defaultContext);\n+            return buildAbsoluteUrl(defaultContext);\n         } else {\n-            String authenticationEndpointURLInFile = getValueFromFileBasedConfig.get();\n-            if (StringUtils.isNotBlank(authenticationEndpointURLInFile)) {\n-                // Use the value configured in the file.\n-                url = authenticationEndpointURLInFile;\n+            String urlFromFileBasedConfig = getValueFromFileBasedConfig.get();\n+            if (StringUtils.isNotBlank(urlFromFileBasedConfig)) {\n+                // If the file based URL is set, then we have to return the file based URL.\n+                return urlFromFileBasedConfig;\n             } else {\n-                // Use the default context.\n-                url = defaultContext;\n+                return defaultContext;\n             }\n         }\n-        return url;\n     }\n \n-    private String buildTenantQualifiedUrl(String context) {\n+    private String buildAbsoluteUrl(String context) {\n \n         try {\n             return ServiceURLBuilder.create().addPath(context).build().getAbsolutePublicURL();\n         } catch (URLBuilderException e) {\n-            throw new IdentityRuntimeException(\"Error while building url for context: \" + context);\n+            throw new IdentityRuntimeException(\"Error while building tenant qualified url for context: \" + context);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d3aa75f857ac129e829bab94d6ab433e2114a05"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09a831b7c267be6ef2cd28c6a0ce12b8568345e7", "author": {"user": {"login": "mefarazath", "name": "Farasath Ahamed"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/09a831b7c267be6ef2cd28c6a0ce12b8568345e7", "committedDate": "2020-04-20T17:37:15Z", "message": "Improve ConfigurationFacade url resolving logic"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4d3aa75f857ac129e829bab94d6ab433e2114a05", "author": {"user": {"login": "mefarazath", "name": "Farasath Ahamed"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/4d3aa75f857ac129e829bab94d6ab433e2114a05", "committedDate": "2020-04-20T08:29:27Z", "message": "Improve ConfigurationFacade url resolving logic"}, "afterCommit": {"oid": "09a831b7c267be6ef2cd28c6a0ce12b8568345e7", "author": {"user": {"login": "mefarazath", "name": "Farasath Ahamed"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/09a831b7c267be6ef2cd28c6a0ce12b8568345e7", "committedDate": "2020-04-20T17:37:15Z", "message": "Improve ConfigurationFacade url resolving logic"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2OTQxODIy", "url": "https://github.com/wso2/carbon-identity-framework/pull/2869#pullrequestreview-396941822", "createdAt": "2020-04-21T02:18:26Z", "commit": {"oid": "09a831b7c267be6ef2cd28c6a0ce12b8568345e7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2346, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}