{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2MTQ5NzA4", "number": 2886, "title": "Introduce tenant qualified url support for accountrecovery endpoint", "bodyText": "Proposed changes in this pull request\n\nResolves wso2/product-is#8565", "createdAt": "2020-04-20T15:55:18Z", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886", "merged": true, "mergeCommit": {"oid": "c32507f8cdde1c0d2b8027086f6c44ea6fc60a10"}, "closed": true, "closedAt": "2020-04-24T13:39:19Z", "author": {"login": "ashensw"}, "timelineItems": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZhN7QABqjMyNTI0MjkyNDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcawuB7AFqTM5OTkwNDY4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0e980eda86ebb4c67c8d689902acf948170e61dc", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/0e980eda86ebb4c67c8d689902acf948170e61dc", "committedDate": "2020-04-20T15:50:22Z", "message": "Introduce tenant qualified url support"}, "afterCommit": {"oid": "ce3b8a40ad8fd5f34bfe4f96f7628e8930b2e4b4", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/ce3b8a40ad8fd5f34bfe4f96f7628e8930b2e4b4", "committedDate": "2020-04-20T15:55:58Z", "message": "Introduce tenant qualified url support"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ce3b8a40ad8fd5f34bfe4f96f7628e8930b2e4b4", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/ce3b8a40ad8fd5f34bfe4f96f7628e8930b2e4b4", "committedDate": "2020-04-20T15:55:58Z", "message": "Introduce tenant qualified url support"}, "afterCommit": {"oid": "e1206ad39be6dd2b7fdc4f721496ce58bfd75539", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/e1206ad39be6dd2b7fdc4f721496ce58bfd75539", "committedDate": "2020-04-20T16:05:37Z", "message": "Introduce tenant qualified url support"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NjEwMjQw", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#pullrequestreview-396610240", "createdAt": "2020-04-20T16:20:06Z", "commit": {"oid": "e1206ad39be6dd2b7fdc4f721496ce58bfd75539"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNjoyMDowNlrOGIcu6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNjoyMDowNlrOGIcu6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUxMjU1NA==", "bodyText": "Wouldn't it be better to log the error?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r411512554", "createdAt": "2020-04-20T16:20:06Z", "author": {"login": "mefarazath"}, "path": "components/authentication-framework/org.wso2.carbon.identity.application.authentication.endpoint.util/src/main/java/org/wso2/carbon/identity/application/authentication/endpoint/util/AuthenticationEndpointUtil.java", "diffHunk": "@@ -193,5 +195,20 @@ public static String customi18n(ResourceBundle resourceBundle, String key) {\n             return i18nBase64(resourceBundle, key);\n         }\n     }\n+\n+    /**\n+     * Build Tenant Qualified Url.\n+     *\n+     * @param context Context.\n+     * @return Tenant Qualified Url.\n+     */\n+    public static String buildTenantQualifiedUrl(String context) {\n+\n+        try {\n+            return ServiceURLBuilder.create().addPath(context).build().getAbsoluteInternalURL();\n+        } catch (URLBuilderException e) {\n+            return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e1206ad39be6dd2b7fdc4f721496ce58bfd75539"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NjExNjg0", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#pullrequestreview-396611684", "createdAt": "2020-04-20T16:21:54Z", "commit": {"oid": "e1206ad39be6dd2b7fdc4f721496ce58bfd75539"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNjoyMTo1NFrOGIcz7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNjoyMTo1NFrOGIcz7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUxMzgzOA==", "bodyText": "Can't we throw the error and handle at the places where we consume the API?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r411513838", "createdAt": "2020-04-20T16:21:54Z", "author": {"login": "mefarazath"}, "path": "components/identity-mgt/org.wso2.carbon.identity.mgt.endpoint.util/src/main/java/org/wso2/carbon/identity/mgt/endpoint/util/IdentityManagementEndpointUtil.java", "diffHunk": "@@ -641,4 +643,19 @@ public static void setOptions(ServiceClient client, String accessUsername, Strin\n \n         IdentityManagementServiceUtil.setAutheticationOptions(client, accessUsername, accessPassword);\n     }\n+\n+    /**\n+     * Build Tenant Qualified Url.\n+     *\n+     * @param context Context.\n+     * @return Tenant Qualified Url.\n+     */\n+    public static String buildTenantQualifiedUrl(String context) {\n+\n+        try {\n+            return ServiceURLBuilder.create().addPath(context).build().getAbsoluteInternalURL();\n+        } catch (URLBuilderException e) {\n+            throw new IdentityRuntimeException(\"Error while building url for context: \" + context);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e1206ad39be6dd2b7fdc4f721496ce58bfd75539"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NjEyNDc2", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#pullrequestreview-396612476", "createdAt": "2020-04-20T16:22:46Z", "commit": {"oid": "e1206ad39be6dd2b7fdc4f721496ce58bfd75539"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNjoyMjo0NlrOGIc2VQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNjoyMjo0NlrOGIc2VQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUxNDQ1Mw==", "bodyText": "Can't we the buildTenantQualifiedUrl() method here too?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r411514453", "createdAt": "2020-04-20T16:22:46Z", "author": {"login": "mefarazath"}, "path": "components/identity-mgt/org.wso2.carbon.identity.mgt.endpoint.util/src/main/java/org/wso2/carbon/identity/mgt/endpoint/util/client/api/SecurityQuestionApi.java", "diffHunk": "@@ -193,9 +194,12 @@ public InitiateAllQuestionResponse securityQuestionsGet(String username, String\n             tenantDomain = MultitenantConstants.SUPER_TENANT_DOMAIN_NAME;\n         }\n \n-        if (!MultitenantConstants.SUPER_TENANT_DOMAIN_NAME.equalsIgnoreCase(tenantDomain)) {\n-            basePath = IdentityManagementEndpointUtil.buildEndpointUrl(\"t/\" + tenantDomain +\n+        if (IdentityTenantUtil.isTenantQualifiedUrlsEnabled()) {\n+            basePath = IdentityManagementEndpointUtil.buildTenantQualifiedUrl(\n                     IdentityManagementEndpointConstants.UserInfoRecovery.RECOVERY_API_RELATIVE_PATH);\n+        } else if (!MultitenantConstants.SUPER_TENANT_DOMAIN_NAME.equalsIgnoreCase(tenantDomain)) {\n+            basePath = IdentityManagementEndpointUtil.buildEndpointUrl(\"t/\" + tenantDomain", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e1206ad39be6dd2b7fdc4f721496ce58bfd75539"}, "originalPosition": 18}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e1206ad39be6dd2b7fdc4f721496ce58bfd75539", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/e1206ad39be6dd2b7fdc4f721496ce58bfd75539", "committedDate": "2020-04-20T16:05:37Z", "message": "Introduce tenant qualified url support"}, "afterCommit": {"oid": "c12964893c9330f741a6031911c5405af9261d43", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/c12964893c9330f741a6031911c5405af9261d43", "committedDate": "2020-04-20T17:44:19Z", "message": "Introduce tenant qualified url support"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c12964893c9330f741a6031911c5405af9261d43", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/c12964893c9330f741a6031911c5405af9261d43", "committedDate": "2020-04-20T17:44:19Z", "message": "Introduce tenant qualified url support"}, "afterCommit": {"oid": "f997550670be2707855183e6973da2660b1de5a7", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/f997550670be2707855183e6973da2660b1de5a7", "committedDate": "2020-04-20T18:54:08Z", "message": "Introduce tenant qualified url support"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2OTM1OTIz", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#pullrequestreview-396935923", "createdAt": "2020-04-21T01:58:30Z", "commit": {"oid": "f997550670be2707855183e6973da2660b1de5a7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwMTo1ODozMFrOGIvBjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwMTo1ODozMFrOGIvBjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTgxMjIzOQ==", "bodyText": "Actually this is not just building a tenant qualified url right. Based on the mode it may or not. I think we have to rename this method", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r411812239", "createdAt": "2020-04-21T01:58:30Z", "author": {"login": "malithie"}, "path": "components/authentication-framework/org.wso2.carbon.identity.application.authentication.endpoint.util/src/main/java/org/wso2/carbon/identity/application/authentication/endpoint/util/AuthenticationEndpointUtil.java", "diffHunk": "@@ -193,5 +195,17 @@ public static String customi18n(ResourceBundle resourceBundle, String key) {\n             return i18nBase64(resourceBundle, key);\n         }\n     }\n+\n+    /**\n+     * Build Tenant Qualified Url.\n+     *\n+     * @param context Context.\n+     * @return Tenant Qualified Url.\n+     * @throws URLBuilderException URLBuilderException.\n+     */\n+    public static String buildTenantQualifiedUrl(String context) throws URLBuilderException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f997550670be2707855183e6973da2660b1de5a7"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2OTM2NjMw", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#pullrequestreview-396936630", "createdAt": "2020-04-21T02:00:44Z", "commit": {"oid": "f997550670be2707855183e6973da2660b1de5a7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwMjowMDo0NFrOGIvEhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwMjowMDo0NFrOGIvEhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTgxMjk5Ng==", "bodyText": "At non tenated mode will this API return a tenanted URL.\nUser portal url was always tenanted I guess", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r411812996", "createdAt": "2020-04-21T02:00:44Z", "author": {"login": "malithie"}, "path": "components/identity-mgt/org.wso2.carbon.identity.mgt.endpoint.util/src/main/java/org/wso2/carbon/identity/mgt/endpoint/util/IdentityManagementEndpointUtil.java", "diffHunk": "@@ -140,7 +141,13 @@ public static final String getUserPortalUrl(String userPortalUrl) {\n         if (StringUtils.isNotBlank(userPortalUrl)) {\n             return userPortalUrl;\n         }\n-        return IdentityUtil.getServerURL(IdentityManagementEndpointConstants.USER_PORTAL_URL, true, true);\n+        try {\n+            return ServiceURLBuilder.create().addPath(IdentityManagementEndpointConstants.USER_PORTAL_URL).build()\n+                    .getAbsolutePublicURL();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f997550670be2707855183e6973da2660b1de5a7"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2OTQwNjM1", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#pullrequestreview-396940635", "createdAt": "2020-04-21T02:14:34Z", "commit": {"oid": "f997550670be2707855183e6973da2660b1de5a7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwMjoxNDozNFrOGIvWMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwMjoxNDozNFrOGIvWMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTgxNzUyMg==", "bodyText": "What is this 'isEndpointTenantAware' property is used for ?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r411817522", "createdAt": "2020-04-21T02:14:34Z", "author": {"login": "malithie"}, "path": "components/identity-mgt/org.wso2.carbon.identity.mgt.endpoint.util/src/main/java/org/wso2/carbon/identity/mgt/endpoint/util/client/api/UsernameRecoveryApi.java", "diffHunk": "@@ -233,4 +224,17 @@ public void recoverUsernamePost(List<UserClaim> claim, String tenantDomain, Bool\n     return apiClient.invokeAPI(localVarPath, \"GET\", localVarQueryParams, null, localVarHeaderParams, localVarFormParams,\n             localVarAccept, localVarContentType, localVarAuthNames, localVarReturnType);\n   }\n+\n+  private void setBasePath(boolean isEndpointTenantAware, String tenantDomain) {\n+\n+    if (IdentityTenantUtil.isTenantQualifiedUrlsEnabled()) {\n+      basePath = IdentityManagementEndpointUtil\n+              .buildTenantQualifiedUrl(IdentityManagementEndpointConstants.UserInfoRecovery.USER_API_RELATIVE_PATH);\n+    } else if (isEndpointTenantAware && !MultitenantConstants.SUPER_TENANT_DOMAIN_NAME.equalsIgnoreCase(tenantDomain)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f997550670be2707855183e6973da2660b1de5a7"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2OTk0NzM1", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#pullrequestreview-396994735", "createdAt": "2020-04-21T05:22:47Z", "commit": {"oid": "f997550670be2707855183e6973da2660b1de5a7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNToyMjo0N1rOGIzA4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNToyMjo0N1rOGIzA4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTg3NzYwMg==", "bodyText": "Cant't we make  \"t/\" as a constant? Since it s been used in several places.", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r411877602", "createdAt": "2020-04-21T05:22:47Z", "author": {"login": "denuwanthi"}, "path": "components/identity-mgt/org.wso2.carbon.identity.mgt.endpoint.util/src/main/java/org/wso2/carbon/identity/mgt/endpoint/util/client/api/SelfRegisterApi.java", "diffHunk": "@@ -240,4 +226,16 @@ public void validateCodePostCall(CodeValidationRequest code) throws ApiException\n         };\n         apiClient.invokeAPI(localVarPath, \"POST\", localVarQueryParams, localVarPostBody, localVarHeaderParams, localVarFormParams, localVarAccept, localVarContentType, localVarAuthNames, localVarReturnType);\n     }\n+\n+    private void setBasePath(String tenantDomain) {\n+\n+        if (IdentityTenantUtil.isTenantQualifiedUrlsEnabled()) {\n+            basePath = IdentityManagementEndpointUtil.buildTenantQualifiedUrl(\n+                    IdentityManagementEndpointConstants.UserInfoRecovery.USER_API_RELATIVE_PATH);\n+        } else if (!MultitenantConstants.SUPER_TENANT_DOMAIN_NAME.equalsIgnoreCase(tenantDomain)) {\n+            basePath = IdentityManagementEndpointUtil.buildEndpointUrl(\n+                    \"t/\" + tenantDomain + IdentityManagementEndpointConstants.UserInfoRecovery.USER_API_RELATIVE_PATH);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f997550670be2707855183e6973da2660b1de5a7"}, "originalPosition": 62}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f997550670be2707855183e6973da2660b1de5a7", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/f997550670be2707855183e6973da2660b1de5a7", "committedDate": "2020-04-20T18:54:08Z", "message": "Introduce tenant qualified url support"}, "afterCommit": {"oid": "8e0ad720c332ee220af8ad53f7feda563431622a", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/8e0ad720c332ee220af8ad53f7feda563431622a", "committedDate": "2020-04-21T11:23:26Z", "message": "Introduce tenant qualified url support"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8e0ad720c332ee220af8ad53f7feda563431622a", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/8e0ad720c332ee220af8ad53f7feda563431622a", "committedDate": "2020-04-21T11:23:26Z", "message": "Introduce tenant qualified url support"}, "afterCommit": {"oid": "ad997b026eac17d876d2d6d2cf6617706afa881f", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/ad997b026eac17d876d2d6d2cf6617706afa881f", "committedDate": "2020-04-21T11:31:04Z", "message": "Introduce tenant qualified url support"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ad997b026eac17d876d2d6d2cf6617706afa881f", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/ad997b026eac17d876d2d6d2cf6617706afa881f", "committedDate": "2020-04-21T11:31:04Z", "message": "Introduce tenant qualified url support"}, "afterCommit": {"oid": "a0c479294072596f956ea15e710e3e5e41600d17", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/a0c479294072596f956ea15e710e3e5e41600d17", "committedDate": "2020-04-21T17:41:20Z", "message": "Introduce tenant qualified url support"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a0c479294072596f956ea15e710e3e5e41600d17", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/a0c479294072596f956ea15e710e3e5e41600d17", "committedDate": "2020-04-21T17:41:20Z", "message": "Introduce tenant qualified url support"}, "afterCommit": {"oid": "b5b87069d988a729cf9efae55d27278790f1ac57", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/b5b87069d988a729cf9efae55d27278790f1ac57", "committedDate": "2020-04-21T20:45:49Z", "message": "Introduce tenant qualified url support"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b5b87069d988a729cf9efae55d27278790f1ac57", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/b5b87069d988a729cf9efae55d27278790f1ac57", "committedDate": "2020-04-21T20:45:49Z", "message": "Introduce tenant qualified url support"}, "afterCommit": {"oid": "82904d38da983fc62ef813a624ba46b9dfd49dca", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/82904d38da983fc62ef813a624ba46b9dfd49dca", "committedDate": "2020-04-22T09:19:10Z", "message": "Introduce tenant qualified url support"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "82904d38da983fc62ef813a624ba46b9dfd49dca", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/82904d38da983fc62ef813a624ba46b9dfd49dca", "committedDate": "2020-04-22T09:19:10Z", "message": "Introduce tenant qualified url support"}, "afterCommit": {"oid": "9b61a7af6412b27e211e0dcd0bf35463e488b088", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/9b61a7af6412b27e211e0dcd0bf35463e488b088", "committedDate": "2020-04-22T19:44:05Z", "message": "Introduce tenant qualified url support"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4ODE2NTIw", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#pullrequestreview-398816520", "createdAt": "2020-04-23T07:10:29Z", "commit": {"oid": "9b61a7af6412b27e211e0dcd0bf35463e488b088"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwNzoxMDoyOVrOGKaElw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwNzoxMDoyOVrOGKaElw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU2NjEwMw==", "bodyText": "Rather than depending on the tenant domain passed and addressing the legacy mode, we should rely only on the configuration.\nBecause, later some might use the same method in an unintended way", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r413566103", "createdAt": "2020-04-23T07:10:29Z", "author": {"login": "malithie"}, "path": "components/identity-mgt/org.wso2.carbon.identity.mgt.endpoint.util/src/main/java/org/wso2/carbon/identity/mgt/endpoint/util/IdentityManagementEndpointUtil.java", "diffHunk": "@@ -513,12 +522,34 @@ public static String getURLEncodedCallback(String callbackUrl) throws URISyntaxE\n         return encodedQueryMap;\n     }\n \n+    /**\n+     * Construct the server URL depending on the path and the resource name.\n+     *\n+     * @param tenantDomain tenant Domain.\n+     * @param context      context of the url.\n+     * @return endpoint url.\n+     */\n+    public static String buildServerUrl(String tenantDomain, String context) throws URLBuilderException {\n+\n+        String serverUrl = IdentityManagementServiceUtil.getInstance().getContextURL();\n+        if (StringUtils.isBlank(serverUrl)) {\n+            return ServiceURLBuilder.create().addPath(context).build().getAbsoluteInternalURL();\n+        } else if (StringUtils.isBlank(tenantDomain)) {\n+            return serverUrl + context;\n+        } else {\n+            return serverUrl + \"/t/\" + tenantDomain + context;\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b61a7af6412b27e211e0dcd0bf35463e488b088"}, "originalPosition": 74}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4ODE5ODQ2", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#pullrequestreview-398819846", "createdAt": "2020-04-23T07:15:52Z", "commit": {"oid": "9b61a7af6412b27e211e0dcd0bf35463e488b088"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwNzoxNTo1MlrOGKaQig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwNzoxNTo1MlrOGKaQig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU2OTE2Mg==", "bodyText": "We are calling an internal method any way right. No need of using 'IdentityManagementEndpointUtil'", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r413569162", "createdAt": "2020-04-23T07:15:52Z", "author": {"login": "malithie"}, "path": "components/identity-mgt/org.wso2.carbon.identity.mgt.endpoint.util/src/main/java/org/wso2/carbon/identity/mgt/endpoint/util/IdentityManagementEndpointUtil.java", "diffHunk": "@@ -641,4 +664,57 @@ public static void setOptions(ServiceClient client, String accessUsername, Strin\n \n         IdentityManagementServiceUtil.setAutheticationOptions(client, accessUsername, accessPassword);\n     }\n+\n+    /**\n+     * Get base path URL for API clients.\n+     *\n+     * @param tenantDomain tenant Domain.\n+     * @param context      URL context.\n+     * @return base path.\n+     * @throws ApiException ApiException.\n+     */\n+    public static String getBasePath(String tenantDomain, String context) throws ApiException {\n+\n+        String basePath = null;\n+        try {\n+            if (IdentityTenantUtil.isTenantQualifiedUrlsEnabled()) {\n+                basePath = ServiceURLBuilder.create().addPath(context).build().getAbsoluteInternalURL();\n+            } else {\n+                if (!MultitenantConstants.SUPER_TENANT_DOMAIN_NAME.equalsIgnoreCase(tenantDomain)) {\n+                    basePath = IdentityManagementEndpointUtil.buildServerUrl(tenantDomain, context);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b61a7af6412b27e211e0dcd0bf35463e488b088"}, "originalPosition": 131}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4ODIwMDA1", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#pullrequestreview-398820005", "createdAt": "2020-04-23T07:16:06Z", "commit": {"oid": "9b61a7af6412b27e211e0dcd0bf35463e488b088"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwNzoxNjowNlrOGKaRPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwNzoxNjowNlrOGKaRPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU2OTM0MA==", "bodyText": "Same above applies here", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r413569340", "createdAt": "2020-04-23T07:16:06Z", "author": {"login": "malithie"}, "path": "components/identity-mgt/org.wso2.carbon.identity.mgt.endpoint.util/src/main/java/org/wso2/carbon/identity/mgt/endpoint/util/IdentityManagementEndpointUtil.java", "diffHunk": "@@ -641,4 +664,57 @@ public static void setOptions(ServiceClient client, String accessUsername, Strin\n \n         IdentityManagementServiceUtil.setAutheticationOptions(client, accessUsername, accessPassword);\n     }\n+\n+    /**\n+     * Get base path URL for API clients.\n+     *\n+     * @param tenantDomain tenant Domain.\n+     * @param context      URL context.\n+     * @return base path.\n+     * @throws ApiException ApiException.\n+     */\n+    public static String getBasePath(String tenantDomain, String context) throws ApiException {\n+\n+        String basePath = null;\n+        try {\n+            if (IdentityTenantUtil.isTenantQualifiedUrlsEnabled()) {\n+                basePath = ServiceURLBuilder.create().addPath(context).build().getAbsoluteInternalURL();\n+            } else {\n+                if (!MultitenantConstants.SUPER_TENANT_DOMAIN_NAME.equalsIgnoreCase(tenantDomain)) {\n+                    basePath = IdentityManagementEndpointUtil.buildServerUrl(tenantDomain, context);\n+                }\n+            }\n+        } catch (URLBuilderException e) {\n+            throw new ApiException(\"Error while building url for context: \" + context);\n+        }\n+        return basePath;\n+    }\n+\n+    /**\n+     * Get base path URL for API clients.\n+     *\n+     * @param tenantDomain          tenant Domain.\n+     * @param context               URL context.\n+     * @param isEndpointTenantAware whether the endpoint is tenant aware.\n+     * @return base path.\n+     * @throws ApiException ApiException.\n+     */\n+    public static String getBasePath(String tenantDomain, String context, boolean isEndpointTenantAware)\n+            throws ApiException {\n+\n+        String basePath = null;\n+        try {\n+            if (IdentityTenantUtil.isTenantQualifiedUrlsEnabled()) {\n+                basePath = ServiceURLBuilder.create().addPath(context).build().getAbsoluteInternalURL();\n+            } else {\n+                if (isEndpointTenantAware && !MultitenantConstants.SUPER_TENANT_DOMAIN_NAME\n+                        .equalsIgnoreCase(tenantDomain)) {\n+                    basePath = IdentityManagementEndpointUtil.buildServerUrl(tenantDomain, context);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b61a7af6412b27e211e0dcd0bf35463e488b088"}, "originalPosition": 159}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4ODI1MzQ5", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#pullrequestreview-398825349", "createdAt": "2020-04-23T07:24:24Z", "commit": {"oid": "9b61a7af6412b27e211e0dcd0bf35463e488b088"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwNzoyNDoyNFrOGKakUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwNzoyNDoyNFrOGKakUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU3NDIyNA==", "bodyText": "what's the reason to put .* here", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r413574224", "createdAt": "2020-04-23T07:24:24Z", "author": {"login": "malithie"}, "path": "features/identity-core/org.wso2.carbon.identity.core.server.feature/resources/org.wso2.carbon.identity.core.server.feature.default.json", "diffHunk": "@@ -276,7 +276,7 @@\n   \"identity_mgt.user_self_registration.lock_on_creation\": true,\n   \"identity_mgt.user_self_registration.enable_recaptcha\": true,\n   \"identity_mgt.user_self_registration.verification_email_validity\": \"$ref{identity_mgt.default_mail_validity_period}\",\n-  \"identity_mgt.user_self_registration.callback_url\": \"${carbon.protocol}://${carbon.host}:${carbon.management.port}/authenticationendpoint/login.do\",\n+  \"identity_mgt.user_self_registration.callback_url\": \".*\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b61a7af6412b27e211e0dcd0bf35463e488b088"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9b61a7af6412b27e211e0dcd0bf35463e488b088", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/9b61a7af6412b27e211e0dcd0bf35463e488b088", "committedDate": "2020-04-22T19:44:05Z", "message": "Introduce tenant qualified url support"}, "afterCommit": {"oid": "70741561b83a981ba9cc5641a791f0a4a2619158", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/70741561b83a981ba9cc5641a791f0a4a2619158", "committedDate": "2020-04-23T19:40:25Z", "message": "Introduce tenant qualified url support"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5ODQ5MDMw", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#pullrequestreview-399849030", "createdAt": "2020-04-24T11:04:33Z", "commit": {"oid": "70741561b83a981ba9cc5641a791f0a4a2619158"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMTowNDozM1rOGLSb1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMTowNDozM1rOGLSb1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ4OTU1OA==", "bodyText": "Is this kept for the legacy behavior", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r414489558", "createdAt": "2020-04-24T11:04:33Z", "author": {"login": "malithie"}, "path": "components/identity-mgt/org.wso2.carbon.identity.mgt.endpoint.util/src/main/java/org/wso2/carbon/identity/mgt/endpoint/util/IdentityManagementServiceUtil.java", "diffHunk": "@@ -123,6 +124,7 @@ public void init() {\n                     .APP_PASSWORD).toCharArray();\n             String serviceContextURL = properties\n                     .getProperty(IdentityManagementEndpointConstants.ServiceConfigConstants.SERVICE_CONTEXT_URL);\n+            contextURL = serviceContextURL;\n             this.serviceContextURL = StringUtils.isBlank(serviceContextURL) ? IdentityUtil.getServerURL(\n                     IdentityUtil.getServicePath(), true, true) : serviceContextURL;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70741561b83a981ba9cc5641a791f0a4a2619158"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5ODYwODI4", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#pullrequestreview-399860828", "createdAt": "2020-04-24T11:23:50Z", "commit": {"oid": "70741561b83a981ba9cc5641a791f0a4a2619158"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMToyMzo1MFrOGLTFnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMToyMzo1MFrOGLTFnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUwMDI1Mg==", "bodyText": "Not used ?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r414500252", "createdAt": "2020-04-24T11:23:50Z", "author": {"login": "malithie"}, "path": "components/identity-mgt/org.wso2.carbon.identity.mgt.endpoint.util/src/main/java/org/wso2/carbon/identity/mgt/endpoint/util/client/api/PasswordRecoveryApi.java", "diffHunk": "@@ -245,6 +235,7 @@ public InitiateAllQuestionResponse securityQuestionsGet(String username, String\n      * @param resetPasswordRequest key, password and optional metadata properties (required)\n      * @throws ApiException if fails to make API call\n      */\n+    @Deprecated", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70741561b83a981ba9cc5641a791f0a4a2619158"}, "originalPosition": 47}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "70741561b83a981ba9cc5641a791f0a4a2619158", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/70741561b83a981ba9cc5641a791f0a4a2619158", "committedDate": "2020-04-23T19:40:25Z", "message": "Introduce tenant qualified url support"}, "afterCommit": {"oid": "8b88b940f4661b55b23a95bc69519c8a5245cb1f", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/8b88b940f4661b55b23a95bc69519c8a5245cb1f", "committedDate": "2020-04-24T11:36:37Z", "message": "Introduce tenant qualified url support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa9721dd8ab266d128d0b71fb0843711ce6add64", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/fa9721dd8ab266d128d0b71fb0843711ce6add64", "committedDate": "2020-04-24T12:30:07Z", "message": "Introduce tenant qualified url support"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8b88b940f4661b55b23a95bc69519c8a5245cb1f", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/8b88b940f4661b55b23a95bc69519c8a5245cb1f", "committedDate": "2020-04-24T11:36:37Z", "message": "Introduce tenant qualified url support"}, "afterCommit": {"oid": "fa9721dd8ab266d128d0b71fb0843711ce6add64", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/fa9721dd8ab266d128d0b71fb0843711ce6add64", "committedDate": "2020-04-24T12:30:07Z", "message": "Introduce tenant qualified url support"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5OTA0Njgw", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#pullrequestreview-399904680", "createdAt": "2020-04-24T12:33:50Z", "commit": {"oid": "fa9721dd8ab266d128d0b71fb0843711ce6add64"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2356, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}