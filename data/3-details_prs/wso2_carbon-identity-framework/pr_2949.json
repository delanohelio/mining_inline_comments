{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwNTk0NzE3", "number": 2949, "title": "Resolving the internal service URL for internal API calls", "bodyText": "Proposed changes in this pull request\nThis PR changes will resolve the internal service URL for internal API calls. An optional config is introduced in \u201cidentity.xml\u201d for the internal hostname as <ServerHostName>  with the default value \u201clocalhost\u201d. It will be configurable from deployment.toml if necessary.\nRelates to wso2/product-is#8194\nSample configurations are as follows,\n\nConfiguration in identity.xml.j2 file\n\n<ServerHostName>{{server.internal_hostname}}</ServerHostName>\n\n\nConfiguration in deployment.toml\n\n[server]\ninternal_hostname = \u201cinternal.wso2.is\u201d\n\nThis configuration will be utilized at the service url builder utility to build the internal absolute url of a service endpoint, that will be consumed at places that will generate internal calls. As of now, we have accountrecoveryendpoint invoking internal API calls.", "createdAt": "2020-05-20T08:33:05Z", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949", "merged": true, "mergeCommit": {"oid": "4dc810efe77fbf296f3cb10098e4fec465562312"}, "closed": true, "closedAt": "2020-06-09T08:19:21Z", "author": {"login": "GANGANI"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjC8_0AH2gAyNDIwNTk0NzE3OmYxMzk2MTQ2M2M4ZDU1ZjlkYzM0ZjFkNzI2N2VhOWRmMGM3MjBiYjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJawahAFqTQ4OTUzMTk5NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f13961463c8d55f9dc34f1d7267ea9df0c720bb3", "author": {"user": {"login": "GANGANI", "name": "Gangani Chamika"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/f13961463c8d55f9dc34f1d7267ea9df0c720bb3", "committedDate": "2020-05-20T06:19:52Z", "message": "Add internal host name for Identity Server internal calls"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff1134cb99178dc4975174f4a118c383d77a98cc", "author": {"user": {"login": "GANGANI", "name": "Gangani Chamika"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/ff1134cb99178dc4975174f4a118c383d77a98cc", "committedDate": "2020-05-20T06:19:52Z", "message": "Change server host name config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1bbefbaec98cbd9d3a0e3f8ced9652ad9972cac2", "author": {"user": {"login": "GANGANI", "name": "Gangani Chamika"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/1bbefbaec98cbd9d3a0e3f8ced9652ad9972cac2", "committedDate": "2020-05-20T06:41:34Z", "message": "Add server host name configuration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7a399735c7ad1ba30adb421551337a8dd62e428f", "author": {"user": {"login": "GANGANI", "name": "Gangani Chamika"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/7a399735c7ad1ba30adb421551337a8dd62e428f", "committedDate": "2020-05-20T06:17:35Z", "message": "Change server host name config"}, "afterCommit": {"oid": "1bbefbaec98cbd9d3a0e3f8ced9652ad9972cac2", "author": {"user": {"login": "GANGANI", "name": "Gangani Chamika"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/1bbefbaec98cbd9d3a0e3f8ced9652ad9972cac2", "committedDate": "2020-05-20T06:41:34Z", "message": "Add server host name configuration"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1MTk4NTc4", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#pullrequestreview-415198578", "createdAt": "2020-05-20T10:27:30Z", "commit": {"oid": "1bbefbaec98cbd9d3a0e3f8ced9652ad9972cac2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMDoyNzozMFrOGYFODQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMDoyNzozMFrOGYFODQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzkwNDUyNQ==", "bodyText": "Shall we change the below variable name also to absolutePublicUrl?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#discussion_r427904525", "createdAt": "2020-05-20T10:27:30Z", "author": {"login": "ashensw"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/internal/DefaultServiceURLBuilder.java", "diffHunk": "@@ -418,7 +442,7 @@ public String getRelativeInternalURL() {\n             return relativeInternalUrl;\n         }\n \n-        private String fetchAbsoluteUrl() throws URLBuilderException {\n+        private String fetchAbsolutePublicUrl() throws URLBuilderException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1bbefbaec98cbd9d3a0e3f8ced9652ad9972cac2"}, "originalPosition": 105}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1MjAwMTEz", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#pullrequestreview-415200113", "createdAt": "2020-05-20T10:29:33Z", "commit": {"oid": "1bbefbaec98cbd9d3a0e3f8ced9652ad9972cac2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMDoyOTozNFrOGYFS1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMDoyOTozNFrOGYFS1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzkwNTc0OQ==", "bodyText": "Shall we add a separate test case to cover getAbsoluteInternalURL as well?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#discussion_r427905749", "createdAt": "2020-05-20T10:29:34Z", "author": {"login": "ashensw"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/test/java/org/wso2/carbon/identity/core/internal/DefaultServiceURLBuilderTest.java", "diffHunk": "@@ -311,20 +311,20 @@ public void testGetAbsoluteURL(String protocol, String hostName, int port, Strin\n                                 \"fragment\").addFragmentParameter(\"key2\", \"fragment\").addFragmentParameter(\"key3\",\n                                 \"fragment\").addFragmentParameter(\"key4\", \"fragment\").addParameter(\"key1\", \"v\")\n                                 .addParameter(\"key2\", \"v\").addParameter(\"key3\", \"v\").addParameter(\"key4\", \"v\").build()\n-                                .getAbsoluteInternalURL();\n+                                .getAbsolutePublicURL();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1bbefbaec98cbd9d3a0e3f8ced9652ad9972cac2"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "718c68995f4548bc59738aff6b21337e7d8164ea", "author": {"user": {"login": "GANGANI", "name": "Gangani Chamika"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/718c68995f4548bc59738aff6b21337e7d8164ea", "committedDate": "2020-05-20T11:22:30Z", "message": "Refactor variable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b1d2672a9098a2553b55ed732619275bc23ae27", "author": {"user": {"login": "GANGANI", "name": "Gangani Chamika"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/2b1d2672a9098a2553b55ed732619275bc23ae27", "committedDate": "2020-06-03T05:32:32Z", "message": "Add unit tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MDA1NTk5", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#pullrequestreview-426005599", "createdAt": "2020-06-08T08:17:26Z", "commit": {"oid": "2b1d2672a9098a2553b55ed732619275bc23ae27"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwODoxNzoyNlrOGgTgpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwODoyNzowNFrOGgT0rQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjUyNzI3MA==", "bodyText": "here code from line 244 to 256 seems to be duplicated from code in line 226 to 238.. shall we move it to a common method?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#discussion_r436527270", "createdAt": "2020-06-08T08:17:26Z", "author": {"login": "emswbandara"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/internal/DefaultServiceURLBuilder.java", "diffHunk": "@@ -236,6 +238,24 @@ private String fetchHostName() throws URLBuilderException {\n         return hostName;\n     }\n \n+    private String fetchInternalHostName() throws URLBuilderException {\n+\n+        String internalHostName = IdentityUtil.getProperty(IdentityCoreConstants.SERVER_HOST_NAME);\n+        try {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b1d2672a9098a2553b55ed732619275bc23ae27"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjUyNzk5Mw==", "bodyText": "can protocol be null here? if so handle null check.", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#discussion_r436527993", "createdAt": "2020-06-08T08:18:54Z", "author": {"login": "emswbandara"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/internal/DefaultServiceURLBuilder.java", "diffHunk": "@@ -418,17 +442,30 @@ public String getRelativeInternalURL() {\n             return relativeInternalUrl;\n         }\n \n-        private String fetchAbsoluteUrl() throws URLBuilderException {\n+        private String fetchAbsolutePublicUrl() throws URLBuilderException {\n+\n+            StringBuilder absolutePublicUrl = new StringBuilder();\n+            absolutePublicUrl.append(protocol).append(\"://\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b1d2672a9098a2553b55ed732619275bc23ae27"}, "originalPosition": 115}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjUyODA2Mw==", "bodyText": "can hostName be null here? if so handle null check.", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#discussion_r436528063", "createdAt": "2020-06-08T08:19:05Z", "author": {"login": "emswbandara"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/internal/DefaultServiceURLBuilder.java", "diffHunk": "@@ -418,17 +442,30 @@ public String getRelativeInternalURL() {\n             return relativeInternalUrl;\n         }\n \n-        private String fetchAbsoluteUrl() throws URLBuilderException {\n+        private String fetchAbsolutePublicUrl() throws URLBuilderException {\n+\n+            StringBuilder absolutePublicUrl = new StringBuilder();\n+            absolutePublicUrl.append(protocol).append(\"://\");\n+            absolutePublicUrl.append(hostName.toLowerCase());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b1d2672a9098a2553b55ed732619275bc23ae27"}, "originalPosition": 116}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjUzMDk5MQ==", "bodyText": "use standard comment format add space after // and add fullstop at end.", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#discussion_r436530991", "createdAt": "2020-06-08T08:24:33Z", "author": {"login": "emswbandara"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/test/java/org/wso2/carbon/identity/core/internal/DefaultServiceURLBuilderTest.java", "diffHunk": "@@ -304,6 +347,52 @@ public void testGetAbsoluteURL(String protocol, String hostName, int port, Strin\n \n         String absoluteUrl = null;\n \n+        try {\n+            if (MapUtils.isNotEmpty(parameters) && MapUtils.isNotEmpty(fragmentParams)) {\n+                absoluteUrl =\n+                        ServiceURLBuilder.create().addPath(urlPath).setFragment(fragment).addFragmentParameter(\"key1\",\n+                                \"fragment\").addFragmentParameter(\"key2\", \"fragment\").addFragmentParameter(\"key3\",\n+                                \"fragment\").addFragmentParameter(\"key4\", \"fragment\").addParameter(\"key1\", \"v\")\n+                                .addParameter(\"key2\", \"v\").addParameter(\"key3\", \"v\").addParameter(\"key4\", \"v\").build()\n+                                .getAbsolutePublicURL();\n+            } else if (MapUtils.isNotEmpty(fragmentParams)){\n+                absoluteUrl =\n+                        ServiceURLBuilder.create().addPath(urlPath).setFragment(fragment).addFragmentParameter(\"key1\",\n+                                \"fragment\").addFragmentParameter(\"key2\", \"fragment\").addFragmentParameter(\"key3\",\n+                                \"fragment\").addFragmentParameter(\"key4\", \"fragment\").build().getAbsolutePublicURL();\n+            } else if (MapUtils.isNotEmpty(parameters)){\n+                absoluteUrl =\n+                        ServiceURLBuilder.create().addPath(urlPath).setFragment(fragment).addParameter(\"key1\", \"v\")\n+                                .addParameter(\"key2\", \"v\").addParameter(\"key3\", \"v\").addParameter(\"key4\", \"v\").build()\n+                                .getAbsolutePublicURL();\n+            } else {\n+                absoluteUrl =\n+                        ServiceURLBuilder.create().addPath(urlPath).setFragment(fragment).build().getAbsolutePublicURL();\n+            }\n+\n+        } catch (URLBuilderException e) {\n+            //Mock behaviour, hence ignored", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b1d2672a9098a2553b55ed732619275bc23ae27"}, "originalPosition": 128}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjUzMTgwNg==", "bodyText": "add space after <!-- and before -->", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#discussion_r436531806", "createdAt": "2020-06-08T08:25:59Z", "author": {"login": "emswbandara"}, "path": "features/identity-core/org.wso2.carbon.identity.core.server.feature/resources/identity.xml.j2", "diffHunk": "@@ -70,6 +70,9 @@\n         <TrustManagerType>{{key_mgt.trust_manager_type}}</TrustManagerType>\n     </Security>\n \n+    <!--This configuration is to resolve the internal service URL for internal API calls-->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b1d2672a9098a2553b55ed732619275bc23ae27"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjUzMjM5Nw==", "bodyText": "Also please add the config to identity.xml as well\nhttps://github.com/wso2/carbon-identity-framework/blob/2b1d2672a9098a2553b55ed732619275bc23ae27/features/identity-core/org.wso2.carbon.identity.core.server.feature/resources/identity.xml", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#discussion_r436532397", "createdAt": "2020-06-08T08:27:04Z", "author": {"login": "emswbandara"}, "path": "features/identity-core/org.wso2.carbon.identity.core.server.feature/resources/identity.xml.j2", "diffHunk": "@@ -70,6 +70,9 @@\n         <TrustManagerType>{{key_mgt.trust_manager_type}}</TrustManagerType>\n     </Security>\n \n+    <!--This configuration is to resolve the internal service URL for internal API calls-->", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjUzMTgwNg=="}, "originalCommit": {"oid": "2b1d2672a9098a2553b55ed732619275bc23ae27"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c97e69333943613c0cac9c3e6dd5c2f1eab66fd", "author": {"user": {"login": "GANGANI", "name": "Gangani Chamika"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/0c97e69333943613c0cac9c3e6dd5c2f1eab66fd", "committedDate": "2020-06-08T11:00:09Z", "message": "Address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MTQ0Nzk4", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#pullrequestreview-426144798", "createdAt": "2020-06-08T11:39:26Z", "commit": {"oid": "0c97e69333943613c0cac9c3e6dd5c2f1eab66fd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxMTozOToyNlrOGgZ6Xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxMTozOToyNlrOGgZ6Xw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjYzMjE1OQ==", "bodyText": "let's add the null check for internalHostName as well.", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#discussion_r436632159", "createdAt": "2020-06-08T11:39:26Z", "author": {"login": "emswbandara"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/internal/DefaultServiceURLBuilder.java", "diffHunk": "@@ -418,17 +435,42 @@ public String getRelativeInternalURL() {\n             return relativeInternalUrl;\n         }\n \n-        private String fetchAbsoluteUrl() throws URLBuilderException {\n+        private String fetchAbsolutePublicUrl() throws URLBuilderException {\n+\n+            StringBuilder absolutePublicUrl = new StringBuilder();\n+            if (StringUtils.isBlank(protocol)) {\n+                throw new URLBuilderException(\"Protocol of service URL is not available\");\n+            }\n+            if (StringUtils.isBlank(hostName)) {\n+                throw new URLBuilderException(\"Hostname of service URL is not available\");\n+            }\n+            absolutePublicUrl.append(protocol).append(\"://\");\n+            absolutePublicUrl.append(hostName.toLowerCase());\n+            // If it's well known HTTPS port, skip adding port.\n+            if (port != IdentityCoreConstants.DEFAULT_HTTPS_PORT) {\n+                absolutePublicUrl.append(\":\").append(port);\n+            }\n+            absolutePublicUrl.append(fetchRelativePublicUrl());\n+            return absolutePublicUrl.toString();\n+        }\n+\n+        private String fetchAbsoluteInternalUrl() throws URLBuilderException {\n \n-            StringBuilder absoluteUrl = new StringBuilder();\n-            absoluteUrl.append(protocol).append(\"://\");\n-            absoluteUrl.append(hostName.toLowerCase());\n+            StringBuilder absoluteInternalUrl = new StringBuilder();\n+            if (StringUtils.isBlank(protocol)) {\n+                throw new URLBuilderException(\"Protocol of service URL is not available\");\n+            }\n+            if (StringUtils.isBlank(hostName)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c97e69333943613c0cac9c3e6dd5c2f1eab66fd"}, "originalPosition": 133}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MTQ1MTQ1", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#pullrequestreview-426145145", "createdAt": "2020-06-08T11:39:59Z", "commit": {"oid": "0c97e69333943613c0cac9c3e6dd5c2f1eab66fd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a8092b90d4e91354b326e60bdef0c9b34ef10cb", "author": {"user": {"login": "GANGANI", "name": "Gangani Chamika"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/7a8092b90d4e91354b326e60bdef0c9b34ef10cb", "committedDate": "2020-06-08T11:41:51Z", "message": "Null check for internal host name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MjE2ODM0", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#pullrequestreview-426216834", "createdAt": "2020-06-08T13:09:52Z", "commit": {"oid": "7a8092b90d4e91354b326e60bdef0c9b34ef10cb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxMzowOTo1M1rOGgdDug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxMzowOTo1M1rOGgdDug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjY4MzcwNg==", "bodyText": "Shall we rename this for proxyHostName", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#discussion_r436683706", "createdAt": "2020-06-08T13:09:53Z", "author": {"login": "malithie"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/internal/DefaultServiceURLBuilder.java", "diffHunk": "@@ -252,29 +265,33 @@ private Integer fetchPort() {\n \n         private String protocol;\n         private String hostName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a8092b90d4e91354b326e60bdef0c9b34ef10cb"}, "originalPosition": 47}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MjE3NDQy", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#pullrequestreview-426217442", "createdAt": "2020-06-08T13:10:33Z", "commit": {"oid": "7a8092b90d4e91354b326e60bdef0c9b34ef10cb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxMzoxMDozM1rOGgdGQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxMzoxMDozM1rOGgdGQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjY4NDM1NQ==", "bodyText": "Also this one as fetchProxyHostName", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#discussion_r436684355", "createdAt": "2020-06-08T13:10:33Z", "author": {"login": "malithie"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/internal/DefaultServiceURLBuilder.java", "diffHunk": "@@ -80,14 +81,15 @@ public ServiceURL build() throws URLBuilderException {\n \n         String protocol = fetchProtocol();\n         String hostName = fetchHostName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a8092b90d4e91354b326e60bdef0c9b34ef10cb"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "505c8f4e1f9f23a167ac4bac3b67bac5bab186cc", "author": {"user": {"login": "GANGANI", "name": "Gangani Chamika"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/505c8f4e1f9f23a167ac4bac3b67bac5bab186cc", "committedDate": "2020-06-08T13:55:39Z", "message": "Refactor proxy host name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2ODk2MzI5", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#pullrequestreview-426896329", "createdAt": "2020-06-09T08:19:04Z", "commit": {"oid": "505c8f4e1f9f23a167ac4bac3b67bac5bab186cc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3NzI5Mjk1", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#pullrequestreview-487729295", "createdAt": "2020-09-14T13:02:15Z", "commit": {"oid": "505c8f4e1f9f23a167ac4bac3b67bac5bab186cc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxMzowMjoxNVrOHRSrxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxMzowMjoxNVrOHRSrxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg5Mzk1OA==", "bodyText": "This component did not go in a released product version yet right? We have changed the interface method name here.", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#discussion_r487893958", "createdAt": "2020-09-14T13:02:15Z", "author": {"login": "janakamarasena"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/ServiceURL.java", "diffHunk": "@@ -37,7 +37,7 @@\n      *\n      * @return String of the host name.\n      */\n-    String getHostName();\n+    String getProxyHostName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "505c8f4e1f9f23a167ac4bac3b67bac5bab186cc"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3NzMwODI1", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#pullrequestreview-487730825", "createdAt": "2020-09-14T13:04:09Z", "commit": {"oid": "505c8f4e1f9f23a167ac4bac3b67bac5bab186cc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxMzowNDowOVrOHRSwRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxMzowNDowOVrOHRSwRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg5NTEwOA==", "bodyText": "Add a fullstop at the end. Check other places as well.", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#discussion_r487895108", "createdAt": "2020-09-14T13:04:09Z", "author": {"login": "janakamarasena"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/internal/DefaultServiceURLBuilder.java", "diffHunk": "@@ -418,17 +435,42 @@ public String getRelativeInternalURL() {\n             return relativeInternalUrl;\n         }\n \n-        private String fetchAbsoluteUrl() throws URLBuilderException {\n+        private String fetchAbsolutePublicUrl() throws URLBuilderException {\n+\n+            StringBuilder absolutePublicUrl = new StringBuilder();\n+            if (StringUtils.isBlank(protocol)) {\n+                throw new URLBuilderException(\"Protocol of service URL is not available\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "505c8f4e1f9f23a167ac4bac3b67bac5bab186cc"}, "originalPosition": 131}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3NzMxNDE5", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#pullrequestreview-487731419", "createdAt": "2020-09-14T13:04:51Z", "commit": {"oid": "505c8f4e1f9f23a167ac4bac3b67bac5bab186cc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxMzowNDo1MVrOHRSx9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxMzowNDo1MVrOHRSx9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg5NTU0MA==", "bodyText": "get \"https\" to a constant and reuse in other places as well.", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#discussion_r487895540", "createdAt": "2020-09-14T13:04:51Z", "author": {"login": "janakamarasena"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/test/java/org/wso2/carbon/identity/core/internal/DefaultServiceURLBuilderTest.java", "diffHunk": "@@ -199,7 +203,7 @@ public void testAddFragmentParameter() {\n     public void testAddFragmentParameters() {\n \n         String fragment = null;\n-\n+        when(CarbonUtils.getManagementTransport()).thenReturn(\"https\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "505c8f4e1f9f23a167ac4bac3b67bac5bab186cc"}, "originalPosition": 65}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NTI4Mjc4", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#pullrequestreview-489528278", "createdAt": "2020-09-16T11:27:27Z", "commit": {"oid": "505c8f4e1f9f23a167ac4bac3b67bac5bab186cc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMToyNzoyN1rOHSsYLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMToyNzoyN1rOHSsYLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM2MzUwMg==", "bodyText": "End with a full stop", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#discussion_r489363502", "createdAt": "2020-09-16T11:27:27Z", "author": {"login": "Abilashini"}, "path": "components/authentication-framework/org.wso2.carbon.identity.application.authentication.framework/src/test/resources/repository/conf/identity/identity.xml", "diffHunk": "@@ -71,6 +71,9 @@\n         <TrustManagerType>SunX509</TrustManagerType>\n     </Security>\n \n+    <!--This configuration is to resolve the internal service URL for internal API calls-->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "505c8f4e1f9f23a167ac4bac3b67bac5bab186cc"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NTI5MDM2", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#pullrequestreview-489529036", "createdAt": "2020-09-16T11:28:37Z", "commit": {"oid": "505c8f4e1f9f23a167ac4bac3b67bac5bab186cc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMToyODozN1rOHSsaXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMToyODozN1rOHSsaXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM2NDA2MA==", "bodyText": "Exceeds 120 characters", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#discussion_r489364060", "createdAt": "2020-09-16T11:28:37Z", "author": {"login": "Abilashini"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/internal/DefaultServiceURLBuilder.java", "diffHunk": "@@ -79,15 +80,16 @@ public ServiceURLBuilder addPath(String... paths) {\n     public ServiceURL build() throws URLBuilderException {\n \n         String protocol = fetchProtocol();\n-        String hostName = fetchHostName();\n+        String proxyHostName = fetchProxyHostName();\n+        String internalHostName = fetchInternalHostName();\n         int port = fetchPort();\n         String tenantDomain = resolveTenantDomain();\n         String proxyContextPath = ServerConfiguration.getInstance().getFirstProperty(PROXY_CONTEXT_PATH);\n         String resolvedFragment = buildFragment(fragment, fragmentParams);\n         String urlPath = getResolvedUrlPath(tenantDomain);\n \n-        return new ServiceURLImpl(protocol, hostName, port, tenantDomain, proxyContextPath, urlPath, parameters,\n-                resolvedFragment);\n+        return new ServiceURLImpl(protocol, proxyHostName, internalHostName, port, tenantDomain, proxyContextPath, urlPath,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "505c8f4e1f9f23a167ac4bac3b67bac5bab186cc"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NTMxNzQx", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#pullrequestreview-489531741", "createdAt": "2020-09-16T11:32:37Z", "commit": {"oid": "505c8f4e1f9f23a167ac4bac3b67bac5bab186cc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMTozMjozN1rOHSsing==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMTozMjozN1rOHSsing==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM2NjE3NA==", "bodyText": "full stop", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#discussion_r489366174", "createdAt": "2020-09-16T11:32:37Z", "author": {"login": "Abilashini"}, "path": "features/identity-core/org.wso2.carbon.identity.core.server.feature/resources/identity.xml", "diffHunk": "@@ -73,6 +73,9 @@\n         <UserStorePasswordEncryption>InternalKeyStore</UserStorePasswordEncryption>\n     </Security>\n \n+    <!-- This configuration is to resolve the internal service URL for internal API calls -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "505c8f4e1f9f23a167ac4bac3b67bac5bab186cc"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NTMxOTk1", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#pullrequestreview-489531995", "createdAt": "2020-09-16T11:32:58Z", "commit": {"oid": "505c8f4e1f9f23a167ac4bac3b67bac5bab186cc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMTozMjo1OFrOHSsjQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMTozMjo1OFrOHSsjQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM2NjMzNg==", "bodyText": "full stop", "url": "https://github.com/wso2/carbon-identity-framework/pull/2949#discussion_r489366336", "createdAt": "2020-09-16T11:32:58Z", "author": {"login": "Abilashini"}, "path": "features/identity-core/org.wso2.carbon.identity.core.server.feature/resources/identity.xml.j2", "diffHunk": "@@ -70,6 +70,9 @@\n         <TrustManagerType>{{key_mgt.trust_manager_type}}</TrustManagerType>\n     </Security>\n \n+    <!-- This configuration is to resolve the internal service URL for internal API calls -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "505c8f4e1f9f23a167ac4bac3b67bac5bab186cc"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2281, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}