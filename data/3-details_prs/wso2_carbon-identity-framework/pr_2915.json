{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDExMzQ3ODUw", "number": 2915, "title": "Implement deletion of all consents of a tenant on tenant deletion", "bodyText": "Proposed changes in this pull request\nAll Purposes, Purposes Categories, PII Categories, and Receipts created under a tenant should get deleted in the tenant deletion process.\nCloses #2914\nPrerequisites\nwso2/carbon-consent-management#175", "createdAt": "2020-04-30T10:59:47Z", "url": "https://github.com/wso2/carbon-identity-framework/pull/2915", "merged": true, "mergeCommit": {"oid": "eba355e8e30c9f4fe617bd22124441b3e2b40b65"}, "closed": true, "closedAt": "2020-06-19T10:29:22Z", "author": {"login": "sumedhe"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjcFLpABqjMzNjAzMzI0OTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdsvCMLAFqTU2MDc4MDQ0NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f233722a80bb69a94ba7ad0ede558ef5c3e39436", "author": {"user": {"login": "sumedhe", "name": "Sumedhe Dissanayake"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/f233722a80bb69a94ba7ad0ede558ef5c3e39436", "committedDate": "2020-04-30T10:55:36Z", "message": "Implement deletion of all consents of a tenant on tenant deletion"}, "afterCommit": {"oid": "b320a216f972fb2c511824844604352d24e30778", "author": {"user": {"login": "sumedhe", "name": "Sumedhe Dissanayake"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/b320a216f972fb2c511824844604352d24e30778", "committedDate": "2020-05-21T11:36:08Z", "message": "Implement consents deletion on tenant deletion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxMzg3MzE2", "url": "https://github.com/wso2/carbon-identity-framework/pull/2915#pullrequestreview-431387316", "createdAt": "2020-06-16T10:55:20Z", "commit": {"oid": "b320a216f972fb2c511824844604352d24e30778"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMDo1NToyMFrOGkWCsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMDo1NToyMFrOGkWCsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDc2MzA1OA==", "bodyText": "Shall we add the method comment here?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2915#discussion_r440763058", "createdAt": "2020-06-16T10:55:20Z", "author": {"login": "ShanChathusanda93"}, "path": "components/consent-mgt/org.wso2.carbon.identity.consent.mgt/src/main/java/org/wso2/carbon/identity/consent/mgt/listener/TenantConsentMgtListener.java", "diffHunk": "@@ -44,6 +45,35 @@ public void onTenantCreate(TenantInfoBean tenantInfoBean) throws StratosExceptio\n         }\n     }\n \n+    @Override\n+    public void onPreDelete(int tenantId) throws StratosException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b320a216f972fb2c511824844604352d24e30778"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bd18c58ffbcfa3dcc96b48c40f3c9a3e0263595", "author": {"user": {"login": "sumedhe", "name": "Sumedhe Dissanayake"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/7bd18c58ffbcfa3dcc96b48c40f3c9a3e0263595", "committedDate": "2020-06-16T19:51:46Z", "message": "Implement consents deletion on tenant deletion"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b320a216f972fb2c511824844604352d24e30778", "author": {"user": {"login": "sumedhe", "name": "Sumedhe Dissanayake"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/b320a216f972fb2c511824844604352d24e30778", "committedDate": "2020-05-21T11:36:08Z", "message": "Implement consents deletion on tenant deletion"}, "afterCommit": {"oid": "7bd18c58ffbcfa3dcc96b48c40f3c9a3e0263595", "author": {"user": {"login": "sumedhe", "name": "Sumedhe Dissanayake"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/7bd18c58ffbcfa3dcc96b48c40f3c9a3e0263595", "committedDate": "2020-06-16T19:51:46Z", "message": "Implement consents deletion on tenant deletion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzMDg3MDMy", "url": "https://github.com/wso2/carbon-identity-framework/pull/2915#pullrequestreview-433087032", "createdAt": "2020-06-18T09:07:07Z", "commit": {"oid": "7bd18c58ffbcfa3dcc96b48c40f3c9a3e0263595"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzOTcwNjcz", "url": "https://github.com/wso2/carbon-identity-framework/pull/2915#pullrequestreview-433970673", "createdAt": "2020-06-19T10:29:07Z", "commit": {"oid": "7bd18c58ffbcfa3dcc96b48c40f3c9a3e0263595"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwNzgwNDE0", "url": "https://github.com/wso2/carbon-identity-framework/pull/2915#pullrequestreview-560780414", "createdAt": "2021-01-04T04:57:41Z", "commit": {"oid": "7bd18c58ffbcfa3dcc96b48c40f3c9a3e0263595"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwNDo1Nzo0MVrOINllHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwNDo1Nzo0MVrOINllHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTExODEwOA==", "bodyText": "Complete the javadoc comments. Add the specific Exception type. and also the param descriptions should start with a capital letter and end with a full stop.", "url": "https://github.com/wso2/carbon-identity-framework/pull/2915#discussion_r551118108", "createdAt": "2021-01-04T04:57:41Z", "author": {"login": "sachiniWettasinghe"}, "path": "components/consent-mgt/org.wso2.carbon.identity.consent.mgt/src/main/java/org/wso2/carbon/identity/consent/mgt/listener/TenantConsentMgtListener.java", "diffHunk": "@@ -44,6 +45,41 @@ public void onTenantCreate(TenantInfoBean tenantInfoBean) throws StratosExceptio\n         }\n     }\n \n+    /**\n+     * Delete all consents belongs to a given tenant before deleting the tenant.\n+     *\n+     * @param tenantId Id of the tenant\n+     * @throws StratosException", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7bd18c58ffbcfa3dcc96b48c40f3c9a3e0263595"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwNzgwNDQ0", "url": "https://github.com/wso2/carbon-identity-framework/pull/2915#pullrequestreview-560780444", "createdAt": "2021-01-04T04:57:49Z", "commit": {"oid": "7bd18c58ffbcfa3dcc96b48c40f3c9a3e0263595"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwNDo1Nzo1MFrOINllLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwNDo1Nzo1MFrOINllLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTExODEyNA==", "bodyText": "Complete the javadoc comments.", "url": "https://github.com/wso2/carbon-identity-framework/pull/2915#discussion_r551118124", "createdAt": "2021-01-04T04:57:50Z", "author": {"login": "sachiniWettasinghe"}, "path": "components/consent-mgt/org.wso2.carbon.identity.consent.mgt/src/main/java/org/wso2/carbon/identity/consent/mgt/listener/TenantConsentMgtListener.java", "diffHunk": "@@ -44,6 +45,41 @@ public void onTenantCreate(TenantInfoBean tenantInfoBean) throws StratosExceptio\n         }\n     }\n \n+    /**\n+     * Delete all consents belongs to a given tenant before deleting the tenant.\n+     *\n+     * @param tenantId Id of the tenant\n+     * @throws StratosException\n+     */\n+    @Override\n+    public void onPreDelete(int tenantId) throws StratosException {\n+\n+        if (log.isDebugEnabled()) {\n+            log.info(\"Deleting all consents of the tenant: \" + tenantId);\n+        }\n+        deleteAllConsents(tenantId);\n+    }\n+\n+    /**\n+     * Delete all consents belongs to a given tenant id.\n+     *\n+     * @param tenantId Id of the tenant\n+     * @throws StratosException", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7bd18c58ffbcfa3dcc96b48c40f3c9a3e0263595"}, "originalPosition": 40}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2371, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}