{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEwNDg0MjI5", "number": 3188, "title": "Redundant tenant flow initiation removed when setting permission in the scim2/Roles endpoint", "bodyText": "Purpose\n\nResolves wso2/product-is#9874\n\nApproach\n\nThe set role permissions method fails when setting admin permissions as the logged in user is not passed to the new tenant flow started for the purpose. Starting a new tenant flow is not necessary in this instance as the context does not change from the previous one.", "createdAt": "2020-10-27T05:37:42Z", "url": "https://github.com/wso2/carbon-identity-framework/pull/3188", "merged": true, "mergeCommit": {"oid": "802193f923064a1c46e62413001b68ea2c778500"}, "closed": true, "closedAt": "2020-10-29T04:09:30Z", "author": {"login": "ashendes"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWiJ9OgH2gAyNTEwNDg0MjI5OmViZmRhNWM4MjcyNGJiOGM2M2Q5NjA1NDU5N2JlYWViODE5MTc0Y2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdW-teKgFqTUxODc0NTI3NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ebfda5c82724bb8c63d96054597beaeb819174cb", "author": {"user": {"login": "ashendes", "name": "Ashen Kavinda De Silva"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/ebfda5c82724bb8c63d96054597beaeb819174cb", "committedDate": "2020-10-27T05:31:13Z", "message": "Context user maintained for subsequent tenant flow in the scim2/Roles endpoint."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NDUxMTA0", "url": "https://github.com/wso2/carbon-identity-framework/pull/3188#pullrequestreview-517451104", "createdAt": "2020-10-27T08:31:56Z", "commit": {"oid": "ebfda5c82724bb8c63d96054597beaeb819174cb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4MDQ2NDIy", "url": "https://github.com/wso2/carbon-identity-framework/pull/3188#pullrequestreview-518046422", "createdAt": "2020-10-27T19:03:48Z", "commit": {"oid": "ebfda5c82724bb8c63d96054597beaeb819174cb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxOTowMzo0OVrOHpMOFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxOTowMzo0OVrOHpMOFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjk1Mzg3OA==", "bodyText": "is the new tenant domain different from the previous one? if so we may not need to start the tenant flow here at all", "url": "https://github.com/wso2/carbon-identity-framework/pull/3188#discussion_r512953878", "createdAt": "2020-10-27T19:03:49Z", "author": {"login": "pulasthi7"}, "path": "components/role-mgt/org.wso2.carbon.identity.role.mgt.core/src/main/java/org/wso2/carbon/identity/role/mgt/core/dao/RoleDAOImpl.java", "diffHunk": "@@ -1081,9 +1081,11 @@ public RoleBasicInfo setPermissionsForRole(String roleID, List<String> permissio\n             return new RoleBasicInfo(roleID, roleName);\n         }\n         try {\n+            String loggedInUser = CarbonContext.getThreadLocalCarbonContext().getUsername();\n             PrivilegedCarbonContext.startTenantFlow();\n             PrivilegedCarbonContext carbonContext = PrivilegedCarbonContext.getThreadLocalCarbonContext();\n             carbonContext.setTenantDomain(tenantDomain, true);\n+            carbonContext.setUsername(loggedInUser);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebfda5c82724bb8c63d96054597beaeb819174cb"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ba4ffd6a2ef1b19fa66c5abd37e072d31c0837e", "author": {"user": {"login": "ashendes", "name": "Ashen Kavinda De Silva"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/4ba4ffd6a2ef1b19fa66c5abd37e072d31c0837e", "committedDate": "2020-10-28T05:26:57Z", "message": "Full permission tree check added when setting all permissions by an a non super-admin user."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29de1b6baa48638a10cab8b287ff872932450233", "author": {"user": {"login": "ashendes", "name": "Ashen Kavinda De Silva"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/29de1b6baa48638a10cab8b287ff872932450233", "committedDate": "2020-10-28T06:58:42Z", "message": "Redundant tenant flow initiation removed."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4Mzg5MzE3", "url": "https://github.com/wso2/carbon-identity-framework/pull/3188#pullrequestreview-518389317", "createdAt": "2020-10-28T07:42:10Z", "commit": {"oid": "29de1b6baa48638a10cab8b287ff872932450233"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4NzQ1Mjc1", "url": "https://github.com/wso2/carbon-identity-framework/pull/3188#pullrequestreview-518745275", "createdAt": "2020-10-28T14:47:21Z", "commit": {"oid": "29de1b6baa48638a10cab8b287ff872932450233"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2151, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}