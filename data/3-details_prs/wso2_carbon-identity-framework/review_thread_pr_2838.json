{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzNzg5MTEx", "number": 2838, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQwMzowODozN1rODreZvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMjoxODowN1rODr5oVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2OTEzNDcxOnYy", "diffSide": "RIGHT", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultURLResolverService.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQwMzowODozN1rOF712uA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMjoxNTo0OVrOF8g4iQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI5MjY2NA==", "bodyText": "Shall we have a new API to accept tenant domain.\nWondering if there is s real necessity of it as well.\nIn addition, we should have an API without legacy mode params as well. So new consumers don't need to worry about populating such.", "url": "https://github.com/wso2/carbon-identity-framework/pull/2838#discussion_r398292664", "createdAt": "2020-03-26T03:08:37Z", "author": {"login": "malithie"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultURLResolverService.java", "diffHunk": "@@ -40,7 +40,7 @@\n public class DefaultURLResolverService implements URLResolverService {\n \n     @Override\n-    public String resolveUrl(String url, boolean addProxyContextPath, boolean addWebContextRoot,\n+    public String resolveUrl(String url, String tenantDomain, boolean addProxyContextPath, boolean addWebContextRoot,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87b59ba1ca0f33796dc641e045fb79dda26c68c6"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI5NzA0Ng==", "bodyText": "We have a new API for this at the IdentityUtil.class\nThere's an another API available at IdentityUtil without legacy mode params. Do we need to have these at the DefaultURLResolverService level too?\nThere is a need for this because there are instances where tenantDomain is directly available as a attribute (for an instance, while tenant creation). So then, with this change, we don't need to meddle with the ThreadLocal or the CarbonContext to get the tenant domain.", "url": "https://github.com/wso2/carbon-identity-framework/pull/2838#discussion_r398297046", "createdAt": "2020-03-26T03:25:49Z", "author": {"login": "chamathns"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultURLResolverService.java", "diffHunk": "@@ -40,7 +40,7 @@\n public class DefaultURLResolverService implements URLResolverService {\n \n     @Override\n-    public String resolveUrl(String url, boolean addProxyContextPath, boolean addWebContextRoot,\n+    public String resolveUrl(String url, String tenantDomain, boolean addProxyContextPath, boolean addWebContextRoot,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI5MjY2NA=="}, "originalCommit": {"oid": "87b59ba1ca0f33796dc641e045fb79dda26c68c6"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk5NzY0MQ==", "bodyText": "But the API should be clean.\nSo looks like this is addressed", "url": "https://github.com/wso2/carbon-identity-framework/pull/2838#discussion_r398997641", "createdAt": "2020-03-27T02:15:49Z", "author": {"login": "malithie"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultURLResolverService.java", "diffHunk": "@@ -40,7 +40,7 @@\n public class DefaultURLResolverService implements URLResolverService {\n \n     @Override\n-    public String resolveUrl(String url, boolean addProxyContextPath, boolean addWebContextRoot,\n+    public String resolveUrl(String url, String tenantDomain, boolean addProxyContextPath, boolean addWebContextRoot,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI5MjY2NA=="}, "originalCommit": {"oid": "87b59ba1ca0f33796dc641e045fb79dda26c68c6"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MDc4MjE2OnYy", "diffSide": "RIGHT", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultURLResolverService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMjo1NjozMFrOF8FjOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMjo1NjozMFrOF8FjOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU0OTgxOQ==", "bodyText": "Shall we move this tenant resolving logic to a single method and reuse ?", "url": "https://github.com/wso2/carbon-identity-framework/pull/2838#discussion_r398549819", "createdAt": "2020-03-26T12:56:30Z", "author": {"login": "malithie"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultURLResolverService.java", "diffHunk": "@@ -135,11 +168,13 @@ private void appendProxyContextPath(StringBuilder serverUrl) {\n         }\n     }\n \n-    private void appendTenantAsPathParam(StringBuilder serverUrl) {\n+    private void appendTenantAsPathParam(StringBuilder serverUrl, String tenantDomain) {\n \n-        String tenantDomain = IdentityTenantUtil.getTenantDomainFromContext();\n         if (StringUtils.isBlank(tenantDomain)) {\n-            tenantDomain = PrivilegedCarbonContext.getThreadLocalCarbonContext().getTenantDomain();\n+            tenantDomain = IdentityTenantUtil.getTenantDomainFromContext();\n+            if (StringUtils.isBlank(tenantDomain)) {\n+                tenantDomain = PrivilegedCarbonContext.getThreadLocalCarbonContext().getTenantDomain();\n+            }\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8244288ee50935fdd84f2c6403d35e5a0b233c8e"}, "originalPosition": 89}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MzU5NTcyOnYy", "diffSide": "RIGHT", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultURLResolverService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMjoxODowN1rOF8g6sQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMjoxODowN1rOF8g6sQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk5ODE5Mw==", "bodyText": "Is there a reason to not use the resolving method.\nLooks like some checks/steps missed here", "url": "https://github.com/wso2/carbon-identity-framework/pull/2838#discussion_r398998193", "createdAt": "2020-03-27T02:18:07Z", "author": {"login": "malithie"}, "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultURLResolverService.java", "diffHunk": "@@ -166,16 +193,29 @@ private void appendTenantPathParamInLegacyMode(StringBuilder serverUrl) {\n         }\n     }\n \n-    private void appendTenantQueryParamInLegacyMode(StringBuilder serverUrl) {\n+    private void appendTenantQueryParamInLegacyMode(StringBuilder serverUrl, String tenantDomain) {\n \n-        String tenantDomain = IdentityTenantUtil.getTenantDomainFromContext();\n+        if (StringUtils.isBlank(tenantDomain)) {\n+            tenantDomain = IdentityTenantUtil.getTenantDomainFromContext();\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d67375248c97f9fd4e107e2177bca7b17bd48a8"}, "originalPosition": 115}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2261, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}