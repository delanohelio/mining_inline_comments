{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3MzQ3MTQ0", "number": 3227, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQxOTo1MDowMlrOE2i--w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQxOTo1MDowMlrOE2i--w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1NjMxNzM5OnYy", "diffSide": "RIGHT", "path": "components/configuration-mgt/org.wso2.carbon.identity.configuration.mgt.core/src/main/java/org/wso2/carbon/identity/configuration/mgt/core/dao/impl/CachedBackedConfigurationDAO.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQxOTo1MDowMlrOHvZ3nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQyMTowODoxMFrOHvaYRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ2ODk1OQ==", "bodyText": "Isn't this log entry incorrect? We are clearing the cache here.", "url": "https://github.com/wso2/carbon-identity-framework/pull/3227#discussion_r519468959", "createdAt": "2020-11-08T19:50:02Z", "author": {"login": "JKAUSHALYA"}, "path": "components/configuration-mgt/org.wso2.carbon.identity.configuration.mgt.core/src/main/java/org/wso2/carbon/identity/configuration/mgt/core/dao/impl/CachedBackedConfigurationDAO.java", "diffHunk": "@@ -403,4 +404,44 @@ private void addResourceToCache(Resource resource) throws ConfigurationManagemen\n             PrivilegedCarbonContext.endTenantFlow();\n         }\n     }\n+\n+    private void deleteResourceFromCache(Resource resource) throws ConfigurationManagementException {\n+\n+        if (resource == null) {\n+            return;\n+        }\n+\n+        int tenantId;\n+        try {\n+            tenantId = ConfigurationManagerComponentDataHolder.getInstance().getRealmService()\n+                    .getTenantManager().getTenantId(MultitenantConstants.SUPER_TENANT_DOMAIN_NAME);\n+        } catch (UserStoreException e) {\n+            throw new ConfigurationManagementException(\"Error when setting tenant domain. \",\n+                    ConfigurationConstants.ErrorMessages.ERROR_CODE_UNEXPECTED.getCode(), e);\n+        }\n+\n+        try {\n+            PrivilegedCarbonContext.startTenantFlow();\n+            PrivilegedCarbonContext.getThreadLocalCarbonContext()\n+                    .setTenantDomain(MultitenantConstants.SUPER_TENANT_DOMAIN_NAME);\n+            PrivilegedCarbonContext.getThreadLocalCarbonContext().setTenantId(tenantId);\n+\n+            ResourceByIdCacheKey resourceByIdCacheKey = new ResourceByIdCacheKey(resource.getResourceId(),\n+                    resource.getTenantDomain());\n+            ResourceByNameCacheKey resourceByNameCacheKey = new ResourceByNameCacheKey(resource.getResourceName(),\n+                    resource.getTenantDomain());\n+\n+            if (log.isDebugEnabled()) {\n+                String message = String.format(\"Following two cache entries created. 1. Resource by name cache %s, 2.\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c70031c5e8cb2626ceb434418d0c098e17c0213e"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ3NzMxNw==", "bodyText": "@JKAUSHALYA Sorry. Fixed.", "url": "https://github.com/wso2/carbon-identity-framework/pull/3227#discussion_r519477317", "createdAt": "2020-11-08T21:08:10Z", "author": {"login": "ivantha"}, "path": "components/configuration-mgt/org.wso2.carbon.identity.configuration.mgt.core/src/main/java/org/wso2/carbon/identity/configuration/mgt/core/dao/impl/CachedBackedConfigurationDAO.java", "diffHunk": "@@ -403,4 +404,44 @@ private void addResourceToCache(Resource resource) throws ConfigurationManagemen\n             PrivilegedCarbonContext.endTenantFlow();\n         }\n     }\n+\n+    private void deleteResourceFromCache(Resource resource) throws ConfigurationManagementException {\n+\n+        if (resource == null) {\n+            return;\n+        }\n+\n+        int tenantId;\n+        try {\n+            tenantId = ConfigurationManagerComponentDataHolder.getInstance().getRealmService()\n+                    .getTenantManager().getTenantId(MultitenantConstants.SUPER_TENANT_DOMAIN_NAME);\n+        } catch (UserStoreException e) {\n+            throw new ConfigurationManagementException(\"Error when setting tenant domain. \",\n+                    ConfigurationConstants.ErrorMessages.ERROR_CODE_UNEXPECTED.getCode(), e);\n+        }\n+\n+        try {\n+            PrivilegedCarbonContext.startTenantFlow();\n+            PrivilegedCarbonContext.getThreadLocalCarbonContext()\n+                    .setTenantDomain(MultitenantConstants.SUPER_TENANT_DOMAIN_NAME);\n+            PrivilegedCarbonContext.getThreadLocalCarbonContext().setTenantId(tenantId);\n+\n+            ResourceByIdCacheKey resourceByIdCacheKey = new ResourceByIdCacheKey(resource.getResourceId(),\n+                    resource.getTenantDomain());\n+            ResourceByNameCacheKey resourceByNameCacheKey = new ResourceByNameCacheKey(resource.getResourceName(),\n+                    resource.getTenantDomain());\n+\n+            if (log.isDebugEnabled()) {\n+                String message = String.format(\"Following two cache entries created. 1. Resource by name cache %s, 2.\" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ2ODk1OQ=="}, "originalCommit": {"oid": "c70031c5e8cb2626ceb434418d0c098e17c0213e"}, "originalPosition": 40}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2507, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}