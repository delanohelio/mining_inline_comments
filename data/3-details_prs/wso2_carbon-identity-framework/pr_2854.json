{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk4MDk0ODU2", "number": 2854, "title": "Add Config to get allowed userstore types", "bodyText": "Fixes wso2/product-is#8022\nFollowing config needs to be introduced to identity.xml\n<AllowedUserstores>\n  <AllowedUserstore>org.wso2.carbon.user.core.jdbc.UniqueIDJDBCUserStoreManager</AllowedUserstore>\n  <AllowedUserstore>org.wso2.carbon.user.core.jdbc.JDBCUserStoreManager</AllowedUserstore>\n</AllowedUserstores>\n\nNeed to configure the templated config from deployment.toml as follows.\n[[allowed_userstore]]\nclass = \"org.wso2.carbon.user.core.jdbc.UniqueIDJDBCUserStoreManager\"\n[[allowed_userstore]]  \nclass = \"org.wso2.carbon.user.core.jdbc.JDBCUserStoreManager\"", "createdAt": "2020-04-03T10:34:38Z", "url": "https://github.com/wso2/carbon-identity-framework/pull/2854", "merged": true, "mergeCommit": {"oid": "9d8d92bf1b374f78fb45b60023d5f602e32fb1a3"}, "closed": true, "closedAt": "2020-04-06T05:51:59Z", "author": {"login": "emswbandara"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcT-jAyAFqTM4NzE0Mzg1MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcU2ugHAH2gAyMzk4MDk0ODU2OmY1YmU4NjdlNjAyYmM5OTEyZjJkMzAxMGE1OTViYTVhN2E1ZmY1ZjY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3MTQzODUx", "url": "https://github.com/wso2/carbon-identity-framework/pull/2854#pullrequestreview-387143851", "createdAt": "2020-04-03T10:39:06Z", "commit": {"oid": "cc22d4f4514a685fc0ba36de7245b3d534499d7d"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxMDozOTowNlrOGAQB0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxMDo0Mjo1MlrOGAQIzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjkxNTc5Mw==", "bodyText": "getAllowedUserstors - Typo", "url": "https://github.com/wso2/carbon-identity-framework/pull/2854#discussion_r402915793", "createdAt": "2020-04-03T10:39:06Z", "author": {"login": "thanujalk"}, "path": "components/user-store/org.wso2.carbon.identity.user.store.configuration/src/main/java/org/wso2/carbon/identity/user/store/configuration/UserStoreConfigServiceImpl.java", "diffHunk": "@@ -249,7 +249,18 @@ public UserStoreDTO getUserStore(String domain) throws IdentityUserStoreMgtExcep\n     @Override\n     public Set<String> getAvailableUserStoreClasses() throws IdentityUserStoreMgtException {\n \n-        return UserStoreManagerRegistry.getUserStoreManagerClasses();\n+        return getAllowedUserstoreClasses(UserStoreManagerRegistry.getUserStoreManagerClasses());\n+    }\n+\n+    private Set<String> getAllowedUserstoreClasses(Set<String> userstores) {\n+\n+        Set<String> allowedUserstores = UserStoreConfigListenersHolder.getInstance().getAllowedUserstors();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc22d4f4514a685fc0ba36de7245b3d534499d7d"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjkxNjU0MA==", "bodyText": "Shall we introduce a constant for \"AllowedUserstores\"", "url": "https://github.com/wso2/carbon-identity-framework/pull/2854#discussion_r402916540", "createdAt": "2020-04-03T10:40:39Z", "author": {"login": "thanujalk"}, "path": "components/user-store/org.wso2.carbon.identity.user.store.configuration/src/main/java/org/wso2/carbon/identity/user/store/configuration/internal/UserStoreConfigComponent.java", "diffHunk": "@@ -219,4 +227,36 @@ protected void unsetUserStoreConfigListenerService(UserStoreConfigListener userS\n \n         UserStoreConfigListenersHolder.getInstance().unsetUserStoreConfigListenerService(userStoreConfigListener);\n     }\n+\n+    private void readAllowedUserstoreConfiguration() {\n+\n+        IdentityConfigParser configParser = IdentityConfigParser.getInstance();\n+        // Read allowed userstore configurations.\n+        OMElement userstoresConfig = configParser.getConfigElement(\"AllowedUserstores\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc22d4f4514a685fc0ba36de7245b3d534499d7d"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjkxNjg5OQ==", "bodyText": "can use ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2854#discussion_r402916899", "createdAt": "2020-04-03T10:41:23Z", "author": {"login": "thanujalk"}, "path": "components/user-store/org.wso2.carbon.identity.user.store.configuration/src/main/java/org/wso2/carbon/identity/user/store/configuration/internal/UserStoreConfigComponent.java", "diffHunk": "@@ -219,4 +227,36 @@ protected void unsetUserStoreConfigListenerService(UserStoreConfigListener userS\n \n         UserStoreConfigListenersHolder.getInstance().unsetUserStoreConfigListenerService(userStoreConfigListener);\n     }\n+\n+    private void readAllowedUserstoreConfiguration() {\n+\n+        IdentityConfigParser configParser = IdentityConfigParser.getInstance();\n+        // Read allowed userstore configurations.\n+        OMElement userstoresConfig = configParser.getConfigElement(\"AllowedUserstores\");\n+        if (userstoresConfig == null) {\n+            if (log.isDebugEnabled()) {\n+                log.debug(\"'AllowedUserstores' config not found.\");\n+            }\n+            return;\n+        }\n+        Set<String> allowedUserstores = new HashSet<>();\n+        Iterator userstoreItr = userstoresConfig.getChildrenWithLocalName(\"AllowedUserstore\");\n+        int allowedUserstoreCount = 0;\n+        if (userstoreItr != null) {\n+            while (userstoreItr.hasNext()) {\n+                OMElement userstoreConfig = (OMElement) userstoreItr.next();\n+                String allowedUserstore = userstoreConfig.getText();\n+                if (StringUtils.isNotBlank(allowedUserstore)) {\n+                    allowedUserstores.add(allowedUserstore);\n+                    allowedUserstoreCount++;\n+                }\n+            }\n+        }\n+        if (!(allowedUserstoreCount > 0)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc22d4f4514a685fc0ba36de7245b3d534499d7d"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjkxNzU4Mg==", "bodyText": "Typo", "url": "https://github.com/wso2/carbon-identity-framework/pull/2854#discussion_r402917582", "createdAt": "2020-04-03T10:42:52Z", "author": {"login": "thanujalk"}, "path": "components/user-store/org.wso2.carbon.identity.user.store.configuration/src/main/java/org/wso2/carbon/identity/user/store/configuration/internal/UserStoreConfigListenersHolder.java", "diffHunk": "@@ -69,4 +71,14 @@ public UserStoreConfigService getUserStoreConfigService() {\n         return userStoreConfigService;\n     }\n \n+    public Set<String> getAllowedUserstors() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc22d4f4514a685fc0ba36de7245b3d534499d7d"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3MTU3MzU4", "url": "https://github.com/wso2/carbon-identity-framework/pull/2854#pullrequestreview-387157358", "createdAt": "2020-04-03T11:01:05Z", "commit": {"oid": "6d29c979b8483200d9b9ce20cd946001915a2e26"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d15751eb43e54af38d2317f726fc1290234626e", "author": {"user": {"login": "emswbandara", "name": "Sathya Bandara"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/5d15751eb43e54af38d2317f726fc1290234626e", "committedDate": "2020-04-03T11:24:26Z", "message": "Add Config to get allowed userstore types"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3MzU1MjIz", "url": "https://github.com/wso2/carbon-identity-framework/pull/2854#pullrequestreview-387355223", "createdAt": "2020-04-03T15:23:12Z", "commit": {"oid": "5d15751eb43e54af38d2317f726fc1290234626e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNToyMzoxM1rOGAaPFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNToyMzoxM1rOGAaPFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA4MzAyOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                        org.apache.axiom.om\n          \n          \n            \n                                        org.apache.axiom.om; version=\"${axiom.osgi.version.range}\"\n          \n      \n    \n    \n  \n\nAdd the version range for the package import.", "url": "https://github.com/wso2/carbon-identity-framework/pull/2854#discussion_r403083028", "createdAt": "2020-04-03T15:23:13Z", "author": {"login": "deshankoswatte"}, "path": "components/user-store/org.wso2.carbon.identity.user.store.configuration/pom.xml", "diffHunk": "@@ -122,7 +122,8 @@\n                             org.wso2.carbon.utils; version=\"${carbon.kernel.package.import.version.range}\",\n                             org.wso2.carbon.identity.base; version=\"${carbon.identity.package.import.version.range}\",\n                             org.wso2.carbon.identity.core.*; version=\"${carbon.identity.package.import.version.range}\",\n-                            org.osgi.framework; version=\"${osgi.framework.imp.pkg.version.range}\"\n+                            org.osgi.framework; version=\"${osgi.framework.imp.pkg.version.range}\",\n+                            org.apache.axiom.om", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d15751eb43e54af38d2317f726fc1290234626e"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5be867e602bc9912f2d3010a595ba5a7a5ff5f6", "author": {"user": {"login": "emswbandara", "name": "Sathya Bandara"}}, "url": "https://github.com/wso2/carbon-identity-framework/commit/f5be867e602bc9912f2d3010a595ba5a7a5ff5f6", "committedDate": "2020-04-06T04:10:14Z", "message": "Template config for allowed userstores"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2328, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}