{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2NDc2MjIx", "number": 502, "title": "[Bugs] Improve photos support", "bodyText": "Towards #310, #487\n\nFix regression: photo doesn't load\nFix bug: remote path contained \"N/A\" instead of formId when creating a new observation instead of editing old one\nFix bug: bottom sheet dialog not dismissing after making a selection\nUse UUID as filename in order to support multiple photos (in upcoming PRs)\nEnqueue photos for upload when synchronizing response deltas\nRemove local file after uploading to remote storage successfully", "createdAt": "2020-06-18T13:31:55Z", "url": "https://github.com/google/ground-android/pull/502", "merged": true, "mergeCommit": {"oid": "1a1246f0a55404c0fe3ed98ea83c1b35dfc594e4"}, "closed": true, "closedAt": "2020-06-23T13:34:17Z", "author": {"login": "shobhitagarwal1612"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsbYB5AH2gAyNDM2NDc2MjIxOmY1M2FjMzZhOGI4ZmM2Njk3ZmFhY2FkZWJjMWEzNDM3MjljZWM1ZDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuFfVcgFqTQzNTc4MzA5Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f53ac36a8b8fc6697faacadebc1a343729cec5d8", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/f53ac36a8b8fc6697faacadebc1a343729cec5d8", "committedDate": "2020-06-18T09:52:26Z", "message": "Cherry-pick regression fix from #475"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0aaf1063898c600b1ecb4134126123f6f6ae1f59", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/0aaf1063898c600b1ecb4134126123f6f6ae1f59", "committedDate": "2020-06-18T10:04:15Z", "message": "Use UUID as filenames for photos & remove sync to remote\n\nNeeded for multi-photo support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67d7f0853b559e89cae554c3f05d1f5d3bd2b717", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/67d7f0853b559e89cae554c3f05d1f5d3bd2b717", "committedDate": "2020-06-18T11:10:12Z", "message": "Enqueue photo upload when uploading observation mutations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef6607f1c8201f2d53b285d5ee1fba3ef45eed9e", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/ef6607f1c8201f2d53b285d5ee1fba3ef45eed9e", "committedDate": "2020-06-18T11:15:07Z", "message": "Fix bug : Sometimes uploaded media path contains \"n/a\""}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93a4a5f79cf513fe67b5fd5078f91b69c048c2af", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/93a4a5f79cf513fe67b5fd5078f91b69c048c2af", "committedDate": "2020-06-18T11:32:30Z", "message": "Improve code readability"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7fc93428289d0706480850de1e1eef6bad49a4b", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/b7fc93428289d0706480850de1e1eef6bad49a4b", "committedDate": "2020-06-18T13:10:03Z", "message": "Fix photo dialog not dismissing after select\n\n-  Use recycler view in photo dialog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b6c1d8c7e601a685040a5c7693f705c9c425bfb", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/4b6c1d8c7e601a685040a5c7693f705c9c425bfb", "committedDate": "2020-06-18T13:20:48Z", "message": "Fix variable name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1acc2311a825e9f538c756d9e2edba9c1e099a6", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/c1acc2311a825e9f538c756d9e2edba9c1e099a6", "committedDate": "2020-06-18T13:21:37Z", "message": "Delete local file after uploading to remote storage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b16958e0ad24b1c07f9cef5d5a7be7e29d783584", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/b16958e0ad24b1c07f9cef5d5a7be7e29d783584", "committedDate": "2020-06-18T16:11:55Z", "message": "Merge branch 'master' into multiple_photos_support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "849a385a73ca0e2b158654952c0797c3ebdcb772", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/849a385a73ca0e2b158654952c0797c3ebdcb772", "committedDate": "2020-06-18T18:40:51Z", "message": "Merge branch 'master' into multiple_photos_support"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MTAzMDA3", "url": "https://github.com/google/ground-android/pull/502#pullrequestreview-434103007", "createdAt": "2020-06-19T14:03:41Z", "commit": {"oid": "b7fc93428289d0706480850de1e1eef6bad49a4b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNDowMzo0MVrOGmV_3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNDowMzo0MVrOGmV_3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg1OTQ4Nw==", "bodyText": "Typo. Should be ADD_PHOTO_LIST here and throughout.", "url": "https://github.com/google/ground-android/pull/502#discussion_r442859487", "createdAt": "2020-06-19T14:03:41Z", "author": {"login": "dturner"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/AddPhotoDialogAdapter.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd.ui.editobservation;\n+\n+import android.view.LayoutInflater;\n+import android.view.View;\n+import android.view.View.OnClickListener;\n+import android.view.ViewGroup;\n+import androidx.annotation.NonNull;\n+import androidx.recyclerview.widget.RecyclerView;\n+import com.google.android.gnd.R;\n+import com.google.android.gnd.databinding.AddPhotoListItemBinding;\n+\n+public class AddPhotoDialogAdapter extends RecyclerView.Adapter<AddPhotoDialogAdapter.ViewHolder> {\n+\n+  public static final int CAMERA = 1;\n+  public static final int STORAGE = 2;\n+\n+  private static final int[][] ADD_PHOTO_LISt = {\n+    {R.string.action_camera, R.drawable.ic_photo_camera, CAMERA},\n+    {R.string.action_storage, R.drawable.ic_sd_storage, STORAGE}\n+  };\n+\n+  private ItemClickListener listener;\n+\n+  public AddPhotoDialogAdapter(ItemClickListener listener) {\n+    this.listener = listener;\n+  }\n+\n+  @NonNull\n+  @Override\n+  public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {\n+    AddPhotoListItemBinding binding =\n+        AddPhotoListItemBinding.inflate(LayoutInflater.from(parent.getContext()), parent, false);\n+    return new ViewHolder(binding, listener);\n+  }\n+\n+  @Override\n+  public void onBindViewHolder(@NonNull ViewHolder holder, int position) {\n+    holder.binding.textView.setText(ADD_PHOTO_LISt[position][0]);\n+    holder.binding.imageView.setImageResource(ADD_PHOTO_LISt[position][1]);\n+    holder.type = ADD_PHOTO_LISt[position][2];\n+  }\n+\n+  @Override\n+  public int getItemCount() {\n+    return ADD_PHOTO_LISt.length;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7fc93428289d0706480850de1e1eef6bad49a4b"}, "originalPosition": 61}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MTA1OTAy", "url": "https://github.com/google/ground-android/pull/502#pullrequestreview-434105902", "createdAt": "2020-06-19T14:07:43Z", "commit": {"oid": "b7fc93428289d0706480850de1e1eef6bad49a4b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNDowNzo0NFrOGmWILg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNDowNzo0NFrOGmWILg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg2MTYxNA==", "bodyText": "It's not immediately clear what these constants are for. Maybe change to PHOTO_SOURCE_CAMERA and PHOTO_SOURCE_STORAGE", "url": "https://github.com/google/ground-android/pull/502#discussion_r442861614", "createdAt": "2020-06-19T14:07:44Z", "author": {"login": "dturner"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/AddPhotoDialogAdapter.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd.ui.editobservation;\n+\n+import android.view.LayoutInflater;\n+import android.view.View;\n+import android.view.View.OnClickListener;\n+import android.view.ViewGroup;\n+import androidx.annotation.NonNull;\n+import androidx.recyclerview.widget.RecyclerView;\n+import com.google.android.gnd.R;\n+import com.google.android.gnd.databinding.AddPhotoListItemBinding;\n+\n+public class AddPhotoDialogAdapter extends RecyclerView.Adapter<AddPhotoDialogAdapter.ViewHolder> {\n+\n+  public static final int CAMERA = 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7fc93428289d0706480850de1e1eef6bad49a4b"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MTExNzY5", "url": "https://github.com/google/ground-android/pull/502#pullrequestreview-434111769", "createdAt": "2020-06-19T14:15:45Z", "commit": {"oid": "b7fc93428289d0706480850de1e1eef6bad49a4b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNDoxNTo0NVrOGmWYqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNDoxNTo0NVrOGmWYqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg2NTgzNA==", "bodyText": "Maybe change this to PHOTO_SOURCE_RESOURCES.\nYou could also create a separate inner class e.g. class PhotoStorageResource { int actionStringResourceId, int iconResourceId, int sourceType } and instead make this private static final ArrayList<PhotoStringResource> = { ... }; // list of possible photo sources and their associated resources", "url": "https://github.com/google/ground-android/pull/502#discussion_r442865834", "createdAt": "2020-06-19T14:15:45Z", "author": {"login": "dturner"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/AddPhotoDialogAdapter.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd.ui.editobservation;\n+\n+import android.view.LayoutInflater;\n+import android.view.View;\n+import android.view.View.OnClickListener;\n+import android.view.ViewGroup;\n+import androidx.annotation.NonNull;\n+import androidx.recyclerview.widget.RecyclerView;\n+import com.google.android.gnd.R;\n+import com.google.android.gnd.databinding.AddPhotoListItemBinding;\n+\n+public class AddPhotoDialogAdapter extends RecyclerView.Adapter<AddPhotoDialogAdapter.ViewHolder> {\n+\n+  public static final int CAMERA = 1;\n+  public static final int STORAGE = 2;\n+\n+  private static final int[][] ADD_PHOTO_LISt = {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7fc93428289d0706480850de1e1eef6bad49a4b"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MTE0MTc2", "url": "https://github.com/google/ground-android/pull/502#pullrequestreview-434114176", "createdAt": "2020-06-19T14:19:05Z", "commit": {"oid": "849a385a73ca0e2b158654952c0797c3ebdcb772"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea11d40eba8d25e81144e257c31797216ce33025", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/ea11d40eba8d25e81144e257c31797216ce33025", "committedDate": "2020-06-19T15:32:39Z", "message": "Create inner data class for PhotoStorageResource"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1NzgzMDkz", "url": "https://github.com/google/ground-android/pull/502#pullrequestreview-435783093", "createdAt": "2020-06-23T13:30:21Z", "commit": {"oid": "ea11d40eba8d25e81144e257c31797216ce33025"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1570, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}