{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4MTE1MTM5", "number": 469, "title": "[Refactor] Refactor edit observation package", "bodyText": "@gino-m PTAL.\nI've tried to keep the commits clean and concise for review purpose.", "createdAt": "2020-05-14T16:40:14Z", "url": "https://github.com/google/ground-android/pull/469", "merged": true, "mergeCommit": {"oid": "6b1c43144e1e54b9edc12485f628a5385a16cd21"}, "closed": true, "closedAt": "2020-05-19T18:18:41Z", "author": {"login": "shobhitagarwal1612"}, "timelineItems": {"totalCount": 46, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchL_VZgH2gAyNDE4MTE1MTM5OmIyODFhY2Y0MWY1OGIwM2JlM2VkZjIwMjI3YjQxNDA5NTYzMmM0N2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABci4opHgFqTQxNDcwNzU2OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b281acf41f58b03be3edf20227b414095632c47b", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/b281acf41f58b03be3edf20227b414095632c47b", "committedDate": "2020-05-14T11:43:43Z", "message": "Add factory class for generating view bindings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b3a6f53c58d2f8a077cb17d4d0d32fc8057017a", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/7b3a6f53c58d2f8a077cb17d4d0d32fc8057017a", "committedDate": "2020-05-14T12:14:13Z", "message": "Move inflate calls to factory class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "684e262e6a2e25bd530b279680af63458f06e5d9", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/684e262e6a2e25bd530b279680af63458f06e5d9", "committedDate": "2020-05-14T12:20:34Z", "message": "Create custom style for FieldView and refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b98be4fd9e5452d161e03b8c13ed50f2be189376", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/b98be4fd9e5452d161e03b8c13ed50f2be189376", "committedDate": "2020-05-14T12:22:45Z", "message": "Remove unused parameter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ad7b11457524850affbdc8deede92733d66d4f2", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/0ad7b11457524850affbdc8deede92733d66d4f2", "committedDate": "2020-05-14T12:28:01Z", "message": "Add empty view model classes for each ViewDataBinding"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9583ac4ce945daece26bab38681e93db7f72575", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/a9583ac4ce945daece26bab38681e93db7f72575", "committedDate": "2020-05-14T12:50:34Z", "message": "Attach binding to layout during inflate call"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41e99f45d920b534c7ca48be92afb0ca41b6017e", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/41e99f45d920b534c7ca48be92afb0ca41b6017e", "committedDate": "2020-05-14T13:03:05Z", "message": "Return ViewModels instead of ViewDataBinding objects"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b57ba8de29678c5666fae6f437b1612980f50fc9", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/b57ba8de29678c5666fae6f437b1612980f50fc9", "committedDate": "2020-05-14T13:40:45Z", "message": "Add fields to AbstractFieldViewModel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5dc0439348c61686b728cac0f851125a08a78192", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/5dc0439348c61686b728cac0f851125a08a78192", "committedDate": "2020-05-14T13:42:04Z", "message": "Update constructor of child view models"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37e620b7d3865ddcb43233ef58696b62194a3f9f", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/37e620b7d3865ddcb43233ef58696b62194a3f9f", "committedDate": "2020-05-14T13:49:01Z", "message": "Bind text_input_field to it's view model"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17320c53fcc1d0ace3ef674638a11e2f9c23b666", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/17320c53fcc1d0ace3ef674638a11e2f9c23b666", "committedDate": "2020-05-14T13:54:22Z", "message": "Bind multiple_choice_input_field to it's view model"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c2427e16e24fa087c91119c570852ce9b3af77e", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/1c2427e16e24fa087c91119c570852ce9b3af77e", "committedDate": "2020-05-14T14:00:20Z", "message": "Bind photo_input_field to it's view model"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e1e67f57b556392d64683b2a512c7db55bbebbe", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/0e1e67f57b556392d64683b2a512c7db55bbebbe", "committedDate": "2020-05-14T14:02:21Z", "message": "Remove unused binding adapters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea9459ab576a12bd5c1d32f97ddb6be546af80ff", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/ea9459ab576a12bd5c1d32f97ddb6be546af80ff", "committedDate": "2020-05-14T14:03:18Z", "message": "Remove obsolete init call from PhotoFieldViewModel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16ff72386125e9f685e95654bdea9b391da9cd92", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/16ff72386125e9f685e95654bdea9b391da9cd92", "committedDate": "2020-05-14T14:11:23Z", "message": "Subscribe to dialog clicks from PhotoFieldViewModel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7df1bb5d02e18e21cb2a63f8c19bc450a5c2b368", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/7df1bb5d02e18e21cb2a63f8c19bc450a5c2b368", "committedDate": "2020-05-14T14:14:56Z", "message": "Subscribe to dialog clicks from MultipleChoiceViewModel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1605437ee41fbed50128d1aa1a72d57e87661c32", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/1605437ee41fbed50128d1aa1a72d57e87661c32", "committedDate": "2020-05-14T14:20:06Z", "message": "Remove extra check for bottom sheet dialog.\n\n - We need to do this globally and a more generic solution is needed."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12522f7ea183722b43497c8fd295161dba08106d", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/12522f7ea183722b43497c8fd295161dba08106d", "committedDate": "2020-05-14T15:05:24Z", "message": "Use behavior processor for updating response text"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebf7e28e289dc0026c337c1f1287c325bb1782fd", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/ebf7e28e289dc0026c337c1f1287c325bb1782fd", "committedDate": "2020-05-14T15:18:34Z", "message": "Load current response in multiple choice dialog from its view model"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "898e94f599eb76b008eb2150fccd02c070ae9c67", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/898e94f599eb76b008eb2150fccd02c070ae9c67", "committedDate": "2020-05-14T15:44:32Z", "message": "Update view model responses"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93aac4619adf15bbab84f4766110dc327540f1e6", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/93aac4619adf15bbab84f4766110dc327540f1e6", "committedDate": "2020-05-14T15:45:54Z", "message": "Remove unused collection"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "028a8a19fa32cd570791e05141cfb44ea64b17bc", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/028a8a19fa32cd570791e05141cfb44ea64b17bc", "committedDate": "2020-05-14T16:25:52Z", "message": "Reorder methods in EditObservationFragment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db6afe7188d9d7a86be102d74ed7b200fa91833b", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/db6afe7188d9d7a86be102d74ed7b200fa91833b", "committedDate": "2020-05-14T17:50:52Z", "message": "Null check for photo response"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5070702bbb2069fd80bca1289b177b99966677eb", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/5070702bbb2069fd80bca1289b177b99966677eb", "committedDate": "2020-05-14T16:39:13Z", "message": "Reorder methods, reduce visibility and remove unused methods"}, "afterCommit": {"oid": "db6afe7188d9d7a86be102d74ed7b200fa91833b", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/db6afe7188d9d7a86be102d74ed7b200fa91833b", "committedDate": "2020-05-14T17:50:52Z", "message": "Null check for photo response"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "905803684844eeda27430b4630e389e88e01d208", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/905803684844eeda27430b4630e389e88e01d208", "committedDate": "2020-05-14T17:55:38Z", "message": "Remove useless parenthesis"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e6904b0d96f47ddbf4b72191281e704538f6ca1", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/8e6904b0d96f47ddbf4b72191281e704538f6ca1", "committedDate": "2020-05-15T08:13:40Z", "message": "Use generics for creating view binding"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4ce93140d6f7ac813d2ae372cdcb8397654b28d", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/c4ce93140d6f7ac813d2ae372cdcb8397654b28d", "committedDate": "2020-05-15T09:26:12Z", "message": "Remove factory class and create static methods for clarity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03128d63a26761f507377eabb649221dd4e47480", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/03128d63a26761f507377eabb649221dd4e47480", "committedDate": "2020-05-15T10:12:13Z", "message": "Fix error handling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8f5a9d6ace9e69a8200d9b3a3c52d7f9e9fd0ad", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/b8f5a9d6ace9e69a8200d9b3a3c52d7f9e9fd0ad", "committedDate": "2020-05-15T10:39:41Z", "message": "Create validator class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e69947d8476a03506d71b4dc5028685523f6fd09", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/e69947d8476a03506d71b4dc5028685523f6fd09", "committedDate": "2020-05-15T10:42:55Z", "message": "Remove onFocusChanged. Response and error are updated with each change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e1844eeb0521cb61a05a36e3ba684eebfe092d1", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/2e1844eeb0521cb61a05a36e3ba684eebfe092d1", "committedDate": "2020-05-16T16:17:15Z", "message": "Refactor EditObservationViewModel to use Validator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef021fa6fd27edc330de21f2748217c92aaccf92", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/ef021fa6fd27edc330de21f2748217c92aaccf92", "committedDate": "2020-05-16T16:18:18Z", "message": "Make FieldViewModel dumb and set error via fragment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "020589b826ee2dcfd80ed46a53e09daee4d2fc62", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/020589b826ee2dcfd80ed46a53e09daee4d2fc62", "committedDate": "2020-05-16T16:20:51Z", "message": "Cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1fb40016ca4fa4de2f0070238de5cd6fe0610146", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/1fb40016ca4fa4de2f0070238de5cd6fe0610146", "committedDate": "2020-05-16T16:25:06Z", "message": "Use field instead of FieldId to prevent extra call"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32a8cd51ceacf8e36d27c0e1a0722b2a9d45c90e", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/32a8cd51ceacf8e36d27c0e1a0722b2a9d45c90e", "committedDate": "2020-05-16T16:27:45Z", "message": "Fix checkstyle issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6dd53321f39da81340b472d9930836307da6051b", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/6dd53321f39da81340b472d9930836307da6051b", "committedDate": "2020-05-16T16:30:03Z", "message": "Invert negation: pmd error"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMTkzODEy", "url": "https://github.com/google/ground-android/pull/469#pullrequestreview-413193812", "createdAt": "2020-05-17T20:00:25Z", "commit": {"oid": "6dd53321f39da81340b472d9930836307da6051b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QyMDowMDoyNVrOGWjN5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QyMDowNjozMFrOGWjQNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI5ODg1NA==", "bodyText": "View business logic generally belongs in ViewModels. Any reason not to include this in the AbstractFieldViewModel class?", "url": "https://github.com/google/ground-android/pull/469#discussion_r426298854", "createdAt": "2020-05-17T20:00:25Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/common/ResponseValidator.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd.ui.common;\n+\n+import android.content.res.Resources;\n+import com.google.android.gnd.GndApplication;\n+import com.google.android.gnd.R;\n+import com.google.android.gnd.model.form.Field;\n+import com.google.android.gnd.model.observation.Response;\n+import java8.util.Optional;\n+import javax.annotation.Nullable;\n+import javax.inject.Inject;\n+import javax.inject.Singleton;\n+\n+@Singleton\n+public class ResponseValidator {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6dd53321f39da81340b472d9930836307da6051b"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI5ODkzNQ==", "bodyText": "We've been using Optional instead of null for internal APIs. Can we do the same here for consistency?", "url": "https://github.com/google/ground-android/pull/469#discussion_r426298935", "createdAt": "2020-05-17T20:01:17Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/common/ResponseValidator.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd.ui.common;\n+\n+import android.content.res.Resources;\n+import com.google.android.gnd.GndApplication;\n+import com.google.android.gnd.R;\n+import com.google.android.gnd.model.form.Field;\n+import com.google.android.gnd.model.observation.Response;\n+import java8.util.Optional;\n+import javax.annotation.Nullable;\n+import javax.inject.Inject;\n+import javax.inject.Singleton;\n+\n+@Singleton\n+public class ResponseValidator {\n+\n+  private final Resources resources;\n+\n+  @Inject\n+  ResponseValidator(GndApplication application) {\n+    this.resources = application.getResources();\n+  }\n+\n+  // TODO: Check valid response values\n+  @Nullable\n+  public String validate(Field field, Optional<Response> response) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6dd53321f39da81340b472d9930836307da6051b"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI5OTE1OA==", "bodyText": "Can you add a TODO to add a reference to Field to Response? We have these associations in other parts of our internal model, so would make sense there as well.", "url": "https://github.com/google/ground-android/pull/469#discussion_r426299158", "createdAt": "2020-05-17T20:03:18Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/AbstractFieldViewModel.java", "diffHunk": "@@ -0,0 +1,77 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd.ui.editobservation;\n+\n+import androidx.lifecycle.LiveData;\n+import androidx.lifecycle.LiveDataReactiveStreams;\n+import androidx.lifecycle.MutableLiveData;\n+import com.google.android.gnd.model.form.Field;\n+import com.google.android.gnd.model.observation.Response;\n+import com.google.android.gnd.ui.common.AbstractViewModel;\n+import io.reactivex.Single;\n+import io.reactivex.processors.BehaviorProcessor;\n+import java8.util.Optional;\n+\n+public class AbstractFieldViewModel extends AbstractViewModel {\n+\n+  private final LiveData<Optional<Response>> response;\n+  private final LiveData<String> responseText;\n+  private final MutableLiveData<String> error = new MutableLiveData<>();\n+  private final BehaviorProcessor<Optional<Response>> responseSubject = BehaviorProcessor.create();\n+\n+  private Field field;\n+\n+  AbstractFieldViewModel() {\n+    responseText =\n+        LiveDataReactiveStreams.fromPublisher(\n+            responseSubject.distinctUntilChanged().switchMapSingle(this::getDetailsText));\n+    response = LiveDataReactiveStreams.fromPublisher(responseSubject.distinctUntilChanged());\n+  }\n+\n+  void init(Field field, Optional<Response> response) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6dd53321f39da81340b472d9930836307da6051b"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI5OTQ0Ng==", "bodyText": "Rather than have getViewModelClass and getFieldLayoutId, can we instead have a FieldViewFactory class that will inflate the appropriate view and viewmodel? This fragment can coordinate the returned views by getting their viewmodels with DataBindingUtil. Wdyt?", "url": "https://github.com/google/ground-android/pull/469#discussion_r426299446", "createdAt": "2020-05-17T20:06:30Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationFragment.java", "diffHunk": "@@ -65,8 +70,31 @@\n   private SingleSelectDialogFactory singleSelectDialogFactory;\n   private MultiSelectDialogFactory multiSelectDialogFactory;\n \n-  @Nullable private EditObservationBottomSheetBinding addPhotoBottomSheetBinding;\n-  @Nullable private BottomSheetDialog bottomSheetDialog;\n+  private static Class<? extends AbstractFieldViewModel> getViewModelClass(Field.Type fieldType) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6dd53321f39da81340b472d9930836307da6051b"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMTk0NTA3", "url": "https://github.com/google/ground-android/pull/469#pullrequestreview-413194507", "createdAt": "2020-05-17T20:10:29Z", "commit": {"oid": "6dd53321f39da81340b472d9930836307da6051b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QyMDoxMDoyOVrOGWjRhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QyMDoxMDoyOVrOGWjRhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI5OTc4MA==", "bodyText": "Please add Javadoc to classes and relevant public methods.", "url": "https://github.com/google/ground-android/pull/469#discussion_r426299780", "createdAt": "2020-05-17T20:10:29Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/AbstractFieldViewModel.java", "diffHunk": "@@ -0,0 +1,77 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd.ui.editobservation;\n+\n+import androidx.lifecycle.LiveData;\n+import androidx.lifecycle.LiveDataReactiveStreams;\n+import androidx.lifecycle.MutableLiveData;\n+import com.google.android.gnd.model.form.Field;\n+import com.google.android.gnd.model.observation.Response;\n+import com.google.android.gnd.ui.common.AbstractViewModel;\n+import io.reactivex.Single;\n+import io.reactivex.processors.BehaviorProcessor;\n+import java8.util.Optional;\n+\n+public class AbstractFieldViewModel extends AbstractViewModel {\n+\n+  private final LiveData<Optional<Response>> response;\n+  private final LiveData<String> responseText;\n+  private final MutableLiveData<String> error = new MutableLiveData<>();\n+  private final BehaviorProcessor<Optional<Response>> responseSubject = BehaviorProcessor.create();\n+\n+  private Field field;\n+\n+  AbstractFieldViewModel() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6dd53321f39da81340b472d9930836307da6051b"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMTk0NTY4", "url": "https://github.com/google/ground-android/pull/469#pullrequestreview-413194568", "createdAt": "2020-05-17T20:11:12Z", "commit": {"oid": "6dd53321f39da81340b472d9930836307da6051b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QyMDoxMToxMlrOGWjR0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QyMDoxMToxMlrOGWjR0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI5OTg1Nw==", "bodyText": "Style nit: Please use capital case with final period in comments. Example: \"Please use capital case with final period in comments.\" :)", "url": "https://github.com/google/ground-android/pull/469#discussion_r426299857", "createdAt": "2020-05-17T20:11:12Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationFragment.java", "diffHunk": "@@ -119,116 +147,107 @@ private void handleSaveResult(EditObservationViewModel.SaveResult saveResult) {\n     }\n   }\n \n-  private void rebuildForm(Form form) {\n-    formLayout.removeAllViews();\n-    for (Element element : form.getElements()) {\n-      switch (element.getType()) {\n-        case FIELD:\n-          addField(element.getField());\n-          break;\n-        default:\n-          Timber.d(\"%s elements not yet supported\", element.getType());\n-          break;\n-      }\n-    }\n-  }\n+  private <V extends AbstractFieldViewModel> V addFieldViewModel(Field field) {\n+    V fieldViewModel = (V) viewModelFactory.create(getViewModelClass(field.getType()));\n \n-  private void addField(Field field) {\n-    switch (field.getType()) {\n-      case TEXT:\n-        addTextField(field);\n-        break;\n-      case MULTIPLE_CHOICE:\n-        addMultipleChoiceField(field);\n-        break;\n-      case PHOTO:\n-        addPhotoField(field);\n-        break;\n-      default:\n-        Timber.w(\"Unimplemented field type: %s\", field.getType());\n-        break;\n+    // load field and current response\n+    fieldViewModel.init(field, viewModel.getResponse(field.getId()));\n+\n+    // handle UI interactions\n+    if (fieldViewModel instanceof PhotoFieldViewModel) {\n+      observeSelectPhotoClicks((PhotoFieldViewModel) fieldViewModel);\n+    } else if (fieldViewModel instanceof MultipleChoiceFieldViewModel) {\n+      observeMultipleChoiceClicks((MultipleChoiceFieldViewModel) fieldViewModel);\n     }\n-  }\n \n-  private void addTextField(Field field) {\n-    TextInputFieldBinding binding =\n-        TextInputFieldBinding.inflate(getLayoutInflater(), formLayout, false);\n-    binding.setViewModel(viewModel);\n-    binding.setLifecycleOwner(this);\n-    binding.setField(field);\n-    formLayout.addView(binding.getRoot());\n-    assignGeneratedId(binding.getRoot().findViewById(R.id.text_input_edit_text));\n-  }\n+    // subscribe to response updates", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6dd53321f39da81340b472d9930836307da6051b"}, "originalPosition": 122}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c822095b27bffa876747fecf74f3741cb9bcea8", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/2c822095b27bffa876747fecf74f3741cb9bcea8", "committedDate": "2020-05-18T05:49:32Z", "message": "Return Optional<String> instead of String for consistency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4a40af5a04f151b666880b94423305b14cdb5b8", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/d4a40af5a04f151b666880b94423305b14cdb5b8", "committedDate": "2020-05-18T06:33:44Z", "message": "Move view and VM creation to FieldViewFactory\n\n - Inject Fragment and ViewModelFactory instead of instantiating ourselves\n - Return ViewDataBinding instead of ViewModel. This would allow early failure if any binding doesn't contain the expected view model object."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa96c89344d3dd686bcb3d68ada1c1a492ab44fc", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/aa96c89344d3dd686bcb3d68ada1c1a492ab44fc", "committedDate": "2020-05-18T06:45:36Z", "message": "Add javadocs and comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0f4243659d6b06c0ddd9e012e838dcac399ff25", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/b0f4243659d6b06c0ddd9e012e838dcac399ff25", "committedDate": "2020-05-18T06:48:34Z", "message": "Remove obvious comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f53766ebcf486e58389960fbdbea03cbffa14358", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/f53766ebcf486e58389960fbdbea03cbffa14358", "committedDate": "2020-05-18T22:01:43Z", "message": "Merge branch 'master' into refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b42aa1649f1876c388103404e7ab136bba459a79", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/b42aa1649f1876c388103404e7ab136bba459a79", "committedDate": "2020-05-19T06:00:19Z", "message": "Refactor error handling\n\n - Remove validator class\n - Move logic for set errors to FieldViewModel\n - Clean EditObservationViewModel"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NzA3NTY4", "url": "https://github.com/google/ground-android/pull/469#pullrequestreview-414707568", "createdAt": "2020-05-19T18:18:35Z", "commit": {"oid": "b42aa1649f1876c388103404e7ab136bba459a79"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1554, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}