{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDczMjQyOTY4", "number": 569, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQwNzoyNzoxN1rOEccpXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQwNzo0NDowNFrOEcdARw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4MjY0OTI1OnYy", "diffSide": "RIGHT", "path": "gnd/src/androidTest/java/com/google/android/gnd/AddFeatureTest.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQwNzoyNzoxN1rOHG_SBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMToxOTo1OFrOHHHe5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5MDMxMA==", "bodyText": "Close parenthesis at the same level as the first character of the line that opens it. Not a hard rule but I think it's the trend now.\nTo avoid bikeshedding like this I recommend you install spotless. It's 10 lines in your build.gradle file that will save a lot of time.", "url": "https://github.com/google/ground-android/pull/569#discussion_r477090310", "createdAt": "2020-08-26T07:27:17Z", "author": {"login": "JoseAlcerreca"}, "path": "gnd/src/androidTest/java/com/google/android/gnd/AddFeatureTest.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd;\n+\n+import static androidx.test.espresso.Espresso.onData;\n+import static androidx.test.espresso.Espresso.onView;\n+import static androidx.test.espresso.action.ViewActions.click;\n+import static androidx.test.espresso.assertion.ViewAssertions.matches;\n+import static androidx.test.espresso.matcher.ViewMatchers.isCompletelyDisplayed;\n+import static androidx.test.espresso.matcher.ViewMatchers.withId;\n+import static androidx.test.espresso.matcher.ViewMatchers.withText;\n+import static org.hamcrest.CoreMatchers.allOf;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.Matchers.instanceOf;\n+import static org.hamcrest.Matchers.not;\n+\n+import android.content.Context;\n+import androidx.room.Room;\n+import androidx.test.core.app.ActivityScenario;\n+import androidx.test.ext.junit.rules.ActivityScenarioRule;\n+import com.google.android.gnd.persistence.local.LocalDatabaseModule;\n+import com.google.android.gnd.persistence.local.room.LocalDatabase;\n+import com.google.android.gnd.persistence.remote.FakeRemoteDataStore;\n+import com.google.android.gnd.persistence.remote.FakeRemoteStorageManager;\n+import com.google.android.gnd.persistence.remote.RemoteDataStore;\n+import com.google.android.gnd.persistence.remote.RemoteStorageManager;\n+import com.google.android.gnd.persistence.remote.RemoteStorageModule;\n+import com.google.android.gnd.persistence.uuid.FakeUuidGenerator;\n+import com.google.android.gnd.persistence.uuid.OfflineUuidGenerator;\n+import com.google.android.gnd.system.auth.AuthenticationManager;\n+import com.google.android.gnd.system.auth.AuthenticationModule;\n+import com.google.android.gnd.system.auth.FakeAuthenticationManager;\n+import dagger.Binds;\n+import dagger.Module;\n+import dagger.Provides;\n+import dagger.hilt.InstallIn;\n+import dagger.hilt.android.components.ApplicationComponent;\n+import dagger.hilt.android.qualifiers.ApplicationContext;\n+import dagger.hilt.android.testing.HiltAndroidRule;\n+import dagger.hilt.android.testing.HiltAndroidTest;\n+import dagger.hilt.android.testing.UninstallModules;\n+import javax.inject.Singleton;\n+import org.junit.Rule;\n+import org.junit.Test;\n+\n+@UninstallModules({AuthenticationModule.class, RemoteStorageModule.class,\n+  LocalDatabaseModule.class})\n+@HiltAndroidTest\n+public class AddFeatureTest {\n+\n+  // Ensures that the Hilt component is initialized before running the ActivityScenarioRule.\n+  public @Rule(order = 0)\n+  HiltAndroidRule hiltRule = new HiltAndroidRule(this);\n+\n+  // Sets the preferences so no login is required and an active project is selected.\n+  public @Rule(order = 1)\n+  SetPreferencesRule preferencesRule = new SetPreferencesRule();\n+\n+  public @Rule(order = 2)\n+  ActivityScenarioRule scenarioRule =\n+    new ActivityScenarioRule(MainActivity.class);\n+\n+  @Module\n+  @InstallIn(ApplicationComponent.class)\n+  abstract class TestDependenciesModule {\n+\n+    @Binds\n+    @Singleton\n+    abstract AuthenticationManager bindAuthenticationManager(\n+      FakeAuthenticationManager authenticationManager);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6fba2a175151d91d2fc2e23403008dcb3155d13a"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIxNDAxNg==", "bodyText": "We're already using checkstyle with the google java style guide, however, there is no rule for this. I tried trawling through the docs to see if it's easy to add, but tbh after 15 mins of researching I didn't think it was worth it.", "url": "https://github.com/google/ground-android/pull/569#discussion_r477214016", "createdAt": "2020-08-26T10:58:54Z", "author": {"login": "dturner"}, "path": "gnd/src/androidTest/java/com/google/android/gnd/AddFeatureTest.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd;\n+\n+import static androidx.test.espresso.Espresso.onData;\n+import static androidx.test.espresso.Espresso.onView;\n+import static androidx.test.espresso.action.ViewActions.click;\n+import static androidx.test.espresso.assertion.ViewAssertions.matches;\n+import static androidx.test.espresso.matcher.ViewMatchers.isCompletelyDisplayed;\n+import static androidx.test.espresso.matcher.ViewMatchers.withId;\n+import static androidx.test.espresso.matcher.ViewMatchers.withText;\n+import static org.hamcrest.CoreMatchers.allOf;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.Matchers.instanceOf;\n+import static org.hamcrest.Matchers.not;\n+\n+import android.content.Context;\n+import androidx.room.Room;\n+import androidx.test.core.app.ActivityScenario;\n+import androidx.test.ext.junit.rules.ActivityScenarioRule;\n+import com.google.android.gnd.persistence.local.LocalDatabaseModule;\n+import com.google.android.gnd.persistence.local.room.LocalDatabase;\n+import com.google.android.gnd.persistence.remote.FakeRemoteDataStore;\n+import com.google.android.gnd.persistence.remote.FakeRemoteStorageManager;\n+import com.google.android.gnd.persistence.remote.RemoteDataStore;\n+import com.google.android.gnd.persistence.remote.RemoteStorageManager;\n+import com.google.android.gnd.persistence.remote.RemoteStorageModule;\n+import com.google.android.gnd.persistence.uuid.FakeUuidGenerator;\n+import com.google.android.gnd.persistence.uuid.OfflineUuidGenerator;\n+import com.google.android.gnd.system.auth.AuthenticationManager;\n+import com.google.android.gnd.system.auth.AuthenticationModule;\n+import com.google.android.gnd.system.auth.FakeAuthenticationManager;\n+import dagger.Binds;\n+import dagger.Module;\n+import dagger.Provides;\n+import dagger.hilt.InstallIn;\n+import dagger.hilt.android.components.ApplicationComponent;\n+import dagger.hilt.android.qualifiers.ApplicationContext;\n+import dagger.hilt.android.testing.HiltAndroidRule;\n+import dagger.hilt.android.testing.HiltAndroidTest;\n+import dagger.hilt.android.testing.UninstallModules;\n+import javax.inject.Singleton;\n+import org.junit.Rule;\n+import org.junit.Test;\n+\n+@UninstallModules({AuthenticationModule.class, RemoteStorageModule.class,\n+  LocalDatabaseModule.class})\n+@HiltAndroidTest\n+public class AddFeatureTest {\n+\n+  // Ensures that the Hilt component is initialized before running the ActivityScenarioRule.\n+  public @Rule(order = 0)\n+  HiltAndroidRule hiltRule = new HiltAndroidRule(this);\n+\n+  // Sets the preferences so no login is required and an active project is selected.\n+  public @Rule(order = 1)\n+  SetPreferencesRule preferencesRule = new SetPreferencesRule();\n+\n+  public @Rule(order = 2)\n+  ActivityScenarioRule scenarioRule =\n+    new ActivityScenarioRule(MainActivity.class);\n+\n+  @Module\n+  @InstallIn(ApplicationComponent.class)\n+  abstract class TestDependenciesModule {\n+\n+    @Binds\n+    @Singleton\n+    abstract AuthenticationManager bindAuthenticationManager(\n+      FakeAuthenticationManager authenticationManager);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5MDMxMA=="}, "originalCommit": {"oid": "6fba2a175151d91d2fc2e23403008dcb3155d13a"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIyNDY3OQ==", "bodyText": "@gino-m Any thoughts on this? If it's an easy add it's probably worth adding a rule for this, just for code consistency.", "url": "https://github.com/google/ground-android/pull/569#discussion_r477224679", "createdAt": "2020-08-26T11:19:58Z", "author": {"login": "dturner"}, "path": "gnd/src/androidTest/java/com/google/android/gnd/AddFeatureTest.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd;\n+\n+import static androidx.test.espresso.Espresso.onData;\n+import static androidx.test.espresso.Espresso.onView;\n+import static androidx.test.espresso.action.ViewActions.click;\n+import static androidx.test.espresso.assertion.ViewAssertions.matches;\n+import static androidx.test.espresso.matcher.ViewMatchers.isCompletelyDisplayed;\n+import static androidx.test.espresso.matcher.ViewMatchers.withId;\n+import static androidx.test.espresso.matcher.ViewMatchers.withText;\n+import static org.hamcrest.CoreMatchers.allOf;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.Matchers.instanceOf;\n+import static org.hamcrest.Matchers.not;\n+\n+import android.content.Context;\n+import androidx.room.Room;\n+import androidx.test.core.app.ActivityScenario;\n+import androidx.test.ext.junit.rules.ActivityScenarioRule;\n+import com.google.android.gnd.persistence.local.LocalDatabaseModule;\n+import com.google.android.gnd.persistence.local.room.LocalDatabase;\n+import com.google.android.gnd.persistence.remote.FakeRemoteDataStore;\n+import com.google.android.gnd.persistence.remote.FakeRemoteStorageManager;\n+import com.google.android.gnd.persistence.remote.RemoteDataStore;\n+import com.google.android.gnd.persistence.remote.RemoteStorageManager;\n+import com.google.android.gnd.persistence.remote.RemoteStorageModule;\n+import com.google.android.gnd.persistence.uuid.FakeUuidGenerator;\n+import com.google.android.gnd.persistence.uuid.OfflineUuidGenerator;\n+import com.google.android.gnd.system.auth.AuthenticationManager;\n+import com.google.android.gnd.system.auth.AuthenticationModule;\n+import com.google.android.gnd.system.auth.FakeAuthenticationManager;\n+import dagger.Binds;\n+import dagger.Module;\n+import dagger.Provides;\n+import dagger.hilt.InstallIn;\n+import dagger.hilt.android.components.ApplicationComponent;\n+import dagger.hilt.android.qualifiers.ApplicationContext;\n+import dagger.hilt.android.testing.HiltAndroidRule;\n+import dagger.hilt.android.testing.HiltAndroidTest;\n+import dagger.hilt.android.testing.UninstallModules;\n+import javax.inject.Singleton;\n+import org.junit.Rule;\n+import org.junit.Test;\n+\n+@UninstallModules({AuthenticationModule.class, RemoteStorageModule.class,\n+  LocalDatabaseModule.class})\n+@HiltAndroidTest\n+public class AddFeatureTest {\n+\n+  // Ensures that the Hilt component is initialized before running the ActivityScenarioRule.\n+  public @Rule(order = 0)\n+  HiltAndroidRule hiltRule = new HiltAndroidRule(this);\n+\n+  // Sets the preferences so no login is required and an active project is selected.\n+  public @Rule(order = 1)\n+  SetPreferencesRule preferencesRule = new SetPreferencesRule();\n+\n+  public @Rule(order = 2)\n+  ActivityScenarioRule scenarioRule =\n+    new ActivityScenarioRule(MainActivity.class);\n+\n+  @Module\n+  @InstallIn(ApplicationComponent.class)\n+  abstract class TestDependenciesModule {\n+\n+    @Binds\n+    @Singleton\n+    abstract AuthenticationManager bindAuthenticationManager(\n+      FakeAuthenticationManager authenticationManager);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5MDMxMA=="}, "originalCommit": {"oid": "6fba2a175151d91d2fc2e23403008dcb3155d13a"}, "originalPosition": 84}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4MjY1Mzc0OnYy", "diffSide": "RIGHT", "path": "gnd/src/androidTest/java/com/google/android/gnd/AddFeatureTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQwNzoyODo0MFrOHG_U1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQwNzoyODo0MFrOHG_U1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5MTAzMQ==", "bodyText": "I don't think this is super idiomatic. I would move these modules to their own files or put them at the bottom of this file. I've opened this file to read the tests, not to read the setup. The only reason you would put a class inside another class is if you need to access the parent from the child.", "url": "https://github.com/google/ground-android/pull/569#discussion_r477091031", "createdAt": "2020-08-26T07:28:40Z", "author": {"login": "JoseAlcerreca"}, "path": "gnd/src/androidTest/java/com/google/android/gnd/AddFeatureTest.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd;\n+\n+import static androidx.test.espresso.Espresso.onData;\n+import static androidx.test.espresso.Espresso.onView;\n+import static androidx.test.espresso.action.ViewActions.click;\n+import static androidx.test.espresso.assertion.ViewAssertions.matches;\n+import static androidx.test.espresso.matcher.ViewMatchers.isCompletelyDisplayed;\n+import static androidx.test.espresso.matcher.ViewMatchers.withId;\n+import static androidx.test.espresso.matcher.ViewMatchers.withText;\n+import static org.hamcrest.CoreMatchers.allOf;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.Matchers.instanceOf;\n+import static org.hamcrest.Matchers.not;\n+\n+import android.content.Context;\n+import androidx.room.Room;\n+import androidx.test.core.app.ActivityScenario;\n+import androidx.test.ext.junit.rules.ActivityScenarioRule;\n+import com.google.android.gnd.persistence.local.LocalDatabaseModule;\n+import com.google.android.gnd.persistence.local.room.LocalDatabase;\n+import com.google.android.gnd.persistence.remote.FakeRemoteDataStore;\n+import com.google.android.gnd.persistence.remote.FakeRemoteStorageManager;\n+import com.google.android.gnd.persistence.remote.RemoteDataStore;\n+import com.google.android.gnd.persistence.remote.RemoteStorageManager;\n+import com.google.android.gnd.persistence.remote.RemoteStorageModule;\n+import com.google.android.gnd.persistence.uuid.FakeUuidGenerator;\n+import com.google.android.gnd.persistence.uuid.OfflineUuidGenerator;\n+import com.google.android.gnd.system.auth.AuthenticationManager;\n+import com.google.android.gnd.system.auth.AuthenticationModule;\n+import com.google.android.gnd.system.auth.FakeAuthenticationManager;\n+import dagger.Binds;\n+import dagger.Module;\n+import dagger.Provides;\n+import dagger.hilt.InstallIn;\n+import dagger.hilt.android.components.ApplicationComponent;\n+import dagger.hilt.android.qualifiers.ApplicationContext;\n+import dagger.hilt.android.testing.HiltAndroidRule;\n+import dagger.hilt.android.testing.HiltAndroidTest;\n+import dagger.hilt.android.testing.UninstallModules;\n+import javax.inject.Singleton;\n+import org.junit.Rule;\n+import org.junit.Test;\n+\n+@UninstallModules({AuthenticationModule.class, RemoteStorageModule.class,\n+  LocalDatabaseModule.class})\n+@HiltAndroidTest\n+public class AddFeatureTest {\n+\n+  // Ensures that the Hilt component is initialized before running the ActivityScenarioRule.\n+  public @Rule(order = 0)\n+  HiltAndroidRule hiltRule = new HiltAndroidRule(this);\n+\n+  // Sets the preferences so no login is required and an active project is selected.\n+  public @Rule(order = 1)\n+  SetPreferencesRule preferencesRule = new SetPreferencesRule();\n+\n+  public @Rule(order = 2)\n+  ActivityScenarioRule scenarioRule =\n+    new ActivityScenarioRule(MainActivity.class);\n+\n+  @Module\n+  @InstallIn(ApplicationComponent.class)\n+  abstract class TestDependenciesModule {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6fba2a175151d91d2fc2e23403008dcb3155d13a"}, "originalPosition": 79}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4MjY1OTIxOnYy", "diffSide": "RIGHT", "path": "gnd/src/androidTest/java/com/google/android/gnd/AddFeatureTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQwNzozMDoxMVrOHG_YKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMToxODozOVrOHHHcNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5MTg4Mw==", "bodyText": "Weird throws here, is it needed?", "url": "https://github.com/google/ground-android/pull/569#discussion_r477091883", "createdAt": "2020-08-26T07:30:11Z", "author": {"login": "JoseAlcerreca"}, "path": "gnd/src/androidTest/java/com/google/android/gnd/AddFeatureTest.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd;\n+\n+import static androidx.test.espresso.Espresso.onData;\n+import static androidx.test.espresso.Espresso.onView;\n+import static androidx.test.espresso.action.ViewActions.click;\n+import static androidx.test.espresso.assertion.ViewAssertions.matches;\n+import static androidx.test.espresso.matcher.ViewMatchers.isCompletelyDisplayed;\n+import static androidx.test.espresso.matcher.ViewMatchers.withId;\n+import static androidx.test.espresso.matcher.ViewMatchers.withText;\n+import static org.hamcrest.CoreMatchers.allOf;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.Matchers.instanceOf;\n+import static org.hamcrest.Matchers.not;\n+\n+import android.content.Context;\n+import androidx.room.Room;\n+import androidx.test.core.app.ActivityScenario;\n+import androidx.test.ext.junit.rules.ActivityScenarioRule;\n+import com.google.android.gnd.persistence.local.LocalDatabaseModule;\n+import com.google.android.gnd.persistence.local.room.LocalDatabase;\n+import com.google.android.gnd.persistence.remote.FakeRemoteDataStore;\n+import com.google.android.gnd.persistence.remote.FakeRemoteStorageManager;\n+import com.google.android.gnd.persistence.remote.RemoteDataStore;\n+import com.google.android.gnd.persistence.remote.RemoteStorageManager;\n+import com.google.android.gnd.persistence.remote.RemoteStorageModule;\n+import com.google.android.gnd.persistence.uuid.FakeUuidGenerator;\n+import com.google.android.gnd.persistence.uuid.OfflineUuidGenerator;\n+import com.google.android.gnd.system.auth.AuthenticationManager;\n+import com.google.android.gnd.system.auth.AuthenticationModule;\n+import com.google.android.gnd.system.auth.FakeAuthenticationManager;\n+import dagger.Binds;\n+import dagger.Module;\n+import dagger.Provides;\n+import dagger.hilt.InstallIn;\n+import dagger.hilt.android.components.ApplicationComponent;\n+import dagger.hilt.android.qualifiers.ApplicationContext;\n+import dagger.hilt.android.testing.HiltAndroidRule;\n+import dagger.hilt.android.testing.HiltAndroidTest;\n+import dagger.hilt.android.testing.UninstallModules;\n+import javax.inject.Singleton;\n+import org.junit.Rule;\n+import org.junit.Test;\n+\n+@UninstallModules({AuthenticationModule.class, RemoteStorageModule.class,\n+  LocalDatabaseModule.class})\n+@HiltAndroidTest\n+public class AddFeatureTest {\n+\n+  // Ensures that the Hilt component is initialized before running the ActivityScenarioRule.\n+  public @Rule(order = 0)\n+  HiltAndroidRule hiltRule = new HiltAndroidRule(this);\n+\n+  // Sets the preferences so no login is required and an active project is selected.\n+  public @Rule(order = 1)\n+  SetPreferencesRule preferencesRule = new SetPreferencesRule();\n+\n+  public @Rule(order = 2)\n+  ActivityScenarioRule scenarioRule =\n+    new ActivityScenarioRule(MainActivity.class);\n+\n+  @Module\n+  @InstallIn(ApplicationComponent.class)\n+  abstract class TestDependenciesModule {\n+\n+    @Binds\n+    @Singleton\n+    abstract AuthenticationManager bindAuthenticationManager(\n+      FakeAuthenticationManager authenticationManager);\n+\n+    @Binds\n+    @Singleton\n+    abstract RemoteDataStore bindRemoteDataStore(FakeRemoteDataStore remoteDataStore);\n+\n+    @Binds\n+    @Singleton\n+    abstract RemoteStorageManager bindRemoteStorageManager(\n+      FakeRemoteStorageManager remoteStorageManager);\n+\n+    @Binds\n+    @Singleton\n+    abstract OfflineUuidGenerator offlineUuidGenerator(FakeUuidGenerator uuidGenerator);\n+  }\n+\n+  @InstallIn(ApplicationComponent.class)\n+  @Module\n+  public class LocalDatabaseModule {\n+\n+    @Provides\n+    @Singleton\n+    LocalDatabase localDatabase(@ApplicationContext Context context) {\n+      return Room.inMemoryDatabaseBuilder(context, LocalDatabase.class).build();\n+    }\n+  }\n+\n+  // Given: a logged in user - with an active project with no map markers.\n+  // When: they tap on the centre of the map.\n+  // Then: nothing happens - the feature fragment is not displayed.\n+  @Test\n+  public void tappingCrosshairOnEmptyMapDoesNothing() throws InterruptedException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6fba2a175151d91d2fc2e23403008dcb3155d13a"}, "originalPosition": 115}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIyMzk4OQ==", "bodyText": "I used to have a Thread.sleep in that method but it was removed so the InterruptedException can also be removed. Good spot, thanks.", "url": "https://github.com/google/ground-android/pull/569#discussion_r477223989", "createdAt": "2020-08-26T11:18:39Z", "author": {"login": "dturner"}, "path": "gnd/src/androidTest/java/com/google/android/gnd/AddFeatureTest.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd;\n+\n+import static androidx.test.espresso.Espresso.onData;\n+import static androidx.test.espresso.Espresso.onView;\n+import static androidx.test.espresso.action.ViewActions.click;\n+import static androidx.test.espresso.assertion.ViewAssertions.matches;\n+import static androidx.test.espresso.matcher.ViewMatchers.isCompletelyDisplayed;\n+import static androidx.test.espresso.matcher.ViewMatchers.withId;\n+import static androidx.test.espresso.matcher.ViewMatchers.withText;\n+import static org.hamcrest.CoreMatchers.allOf;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.Matchers.instanceOf;\n+import static org.hamcrest.Matchers.not;\n+\n+import android.content.Context;\n+import androidx.room.Room;\n+import androidx.test.core.app.ActivityScenario;\n+import androidx.test.ext.junit.rules.ActivityScenarioRule;\n+import com.google.android.gnd.persistence.local.LocalDatabaseModule;\n+import com.google.android.gnd.persistence.local.room.LocalDatabase;\n+import com.google.android.gnd.persistence.remote.FakeRemoteDataStore;\n+import com.google.android.gnd.persistence.remote.FakeRemoteStorageManager;\n+import com.google.android.gnd.persistence.remote.RemoteDataStore;\n+import com.google.android.gnd.persistence.remote.RemoteStorageManager;\n+import com.google.android.gnd.persistence.remote.RemoteStorageModule;\n+import com.google.android.gnd.persistence.uuid.FakeUuidGenerator;\n+import com.google.android.gnd.persistence.uuid.OfflineUuidGenerator;\n+import com.google.android.gnd.system.auth.AuthenticationManager;\n+import com.google.android.gnd.system.auth.AuthenticationModule;\n+import com.google.android.gnd.system.auth.FakeAuthenticationManager;\n+import dagger.Binds;\n+import dagger.Module;\n+import dagger.Provides;\n+import dagger.hilt.InstallIn;\n+import dagger.hilt.android.components.ApplicationComponent;\n+import dagger.hilt.android.qualifiers.ApplicationContext;\n+import dagger.hilt.android.testing.HiltAndroidRule;\n+import dagger.hilt.android.testing.HiltAndroidTest;\n+import dagger.hilt.android.testing.UninstallModules;\n+import javax.inject.Singleton;\n+import org.junit.Rule;\n+import org.junit.Test;\n+\n+@UninstallModules({AuthenticationModule.class, RemoteStorageModule.class,\n+  LocalDatabaseModule.class})\n+@HiltAndroidTest\n+public class AddFeatureTest {\n+\n+  // Ensures that the Hilt component is initialized before running the ActivityScenarioRule.\n+  public @Rule(order = 0)\n+  HiltAndroidRule hiltRule = new HiltAndroidRule(this);\n+\n+  // Sets the preferences so no login is required and an active project is selected.\n+  public @Rule(order = 1)\n+  SetPreferencesRule preferencesRule = new SetPreferencesRule();\n+\n+  public @Rule(order = 2)\n+  ActivityScenarioRule scenarioRule =\n+    new ActivityScenarioRule(MainActivity.class);\n+\n+  @Module\n+  @InstallIn(ApplicationComponent.class)\n+  abstract class TestDependenciesModule {\n+\n+    @Binds\n+    @Singleton\n+    abstract AuthenticationManager bindAuthenticationManager(\n+      FakeAuthenticationManager authenticationManager);\n+\n+    @Binds\n+    @Singleton\n+    abstract RemoteDataStore bindRemoteDataStore(FakeRemoteDataStore remoteDataStore);\n+\n+    @Binds\n+    @Singleton\n+    abstract RemoteStorageManager bindRemoteStorageManager(\n+      FakeRemoteStorageManager remoteStorageManager);\n+\n+    @Binds\n+    @Singleton\n+    abstract OfflineUuidGenerator offlineUuidGenerator(FakeUuidGenerator uuidGenerator);\n+  }\n+\n+  @InstallIn(ApplicationComponent.class)\n+  @Module\n+  public class LocalDatabaseModule {\n+\n+    @Provides\n+    @Singleton\n+    LocalDatabase localDatabase(@ApplicationContext Context context) {\n+      return Room.inMemoryDatabaseBuilder(context, LocalDatabase.class).build();\n+    }\n+  }\n+\n+  // Given: a logged in user - with an active project with no map markers.\n+  // When: they tap on the centre of the map.\n+  // Then: nothing happens - the feature fragment is not displayed.\n+  @Test\n+  public void tappingCrosshairOnEmptyMapDoesNothing() throws InterruptedException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5MTg4Mw=="}, "originalCommit": {"oid": "6fba2a175151d91d2fc2e23403008dcb3155d13a"}, "originalPosition": 115}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4MjcwMzg0OnYy", "diffSide": "RIGHT", "path": "gnd/src/androidTest/java/com/google/android/gnd/AddFeatureTest.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQwNzo0Mjo1N1rOHG_zPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNjoxMzo1NVrOHIXk5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5ODgxMw==", "bodyText": "Have you tried idling resources? Given you're dealing with maps and fragments it might be tricky", "url": "https://github.com/google/ground-android/pull/569#discussion_r477098813", "createdAt": "2020-08-26T07:42:57Z", "author": {"login": "JoseAlcerreca"}, "path": "gnd/src/androidTest/java/com/google/android/gnd/AddFeatureTest.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd;\n+\n+import static androidx.test.espresso.Espresso.onData;\n+import static androidx.test.espresso.Espresso.onView;\n+import static androidx.test.espresso.action.ViewActions.click;\n+import static androidx.test.espresso.assertion.ViewAssertions.matches;\n+import static androidx.test.espresso.matcher.ViewMatchers.isCompletelyDisplayed;\n+import static androidx.test.espresso.matcher.ViewMatchers.withId;\n+import static androidx.test.espresso.matcher.ViewMatchers.withText;\n+import static org.hamcrest.CoreMatchers.allOf;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.Matchers.instanceOf;\n+import static org.hamcrest.Matchers.not;\n+\n+import android.content.Context;\n+import androidx.room.Room;\n+import androidx.test.core.app.ActivityScenario;\n+import androidx.test.ext.junit.rules.ActivityScenarioRule;\n+import com.google.android.gnd.persistence.local.LocalDatabaseModule;\n+import com.google.android.gnd.persistence.local.room.LocalDatabase;\n+import com.google.android.gnd.persistence.remote.FakeRemoteDataStore;\n+import com.google.android.gnd.persistence.remote.FakeRemoteStorageManager;\n+import com.google.android.gnd.persistence.remote.RemoteDataStore;\n+import com.google.android.gnd.persistence.remote.RemoteStorageManager;\n+import com.google.android.gnd.persistence.remote.RemoteStorageModule;\n+import com.google.android.gnd.persistence.uuid.FakeUuidGenerator;\n+import com.google.android.gnd.persistence.uuid.OfflineUuidGenerator;\n+import com.google.android.gnd.system.auth.AuthenticationManager;\n+import com.google.android.gnd.system.auth.AuthenticationModule;\n+import com.google.android.gnd.system.auth.FakeAuthenticationManager;\n+import dagger.Binds;\n+import dagger.Module;\n+import dagger.Provides;\n+import dagger.hilt.InstallIn;\n+import dagger.hilt.android.components.ApplicationComponent;\n+import dagger.hilt.android.qualifiers.ApplicationContext;\n+import dagger.hilt.android.testing.HiltAndroidRule;\n+import dagger.hilt.android.testing.HiltAndroidTest;\n+import dagger.hilt.android.testing.UninstallModules;\n+import javax.inject.Singleton;\n+import org.junit.Rule;\n+import org.junit.Test;\n+\n+@UninstallModules({AuthenticationModule.class, RemoteStorageModule.class,\n+  LocalDatabaseModule.class})\n+@HiltAndroidTest\n+public class AddFeatureTest {\n+\n+  // Ensures that the Hilt component is initialized before running the ActivityScenarioRule.\n+  public @Rule(order = 0)\n+  HiltAndroidRule hiltRule = new HiltAndroidRule(this);\n+\n+  // Sets the preferences so no login is required and an active project is selected.\n+  public @Rule(order = 1)\n+  SetPreferencesRule preferencesRule = new SetPreferencesRule();\n+\n+  public @Rule(order = 2)\n+  ActivityScenarioRule scenarioRule =\n+    new ActivityScenarioRule(MainActivity.class);\n+\n+  @Module\n+  @InstallIn(ApplicationComponent.class)\n+  abstract class TestDependenciesModule {\n+\n+    @Binds\n+    @Singleton\n+    abstract AuthenticationManager bindAuthenticationManager(\n+      FakeAuthenticationManager authenticationManager);\n+\n+    @Binds\n+    @Singleton\n+    abstract RemoteDataStore bindRemoteDataStore(FakeRemoteDataStore remoteDataStore);\n+\n+    @Binds\n+    @Singleton\n+    abstract RemoteStorageManager bindRemoteStorageManager(\n+      FakeRemoteStorageManager remoteStorageManager);\n+\n+    @Binds\n+    @Singleton\n+    abstract OfflineUuidGenerator offlineUuidGenerator(FakeUuidGenerator uuidGenerator);\n+  }\n+\n+  @InstallIn(ApplicationComponent.class)\n+  @Module\n+  public class LocalDatabaseModule {\n+\n+    @Provides\n+    @Singleton\n+    LocalDatabase localDatabase(@ApplicationContext Context context) {\n+      return Room.inMemoryDatabaseBuilder(context, LocalDatabase.class).build();\n+    }\n+  }\n+\n+  // Given: a logged in user - with an active project with no map markers.\n+  // When: they tap on the centre of the map.\n+  // Then: nothing happens - the feature fragment is not displayed.\n+  @Test\n+  public void tappingCrosshairOnEmptyMapDoesNothing() throws InterruptedException {\n+    ActivityScenario<MainActivity> scenario = scenarioRule.getScenario();\n+\n+    // Tap on the crosshair at the centre of the map.\n+    onView(withId(R.id.map_crosshairs)).perform(click());\n+\n+    // Verify that the title is not displayed.\n+    onView(withId(R.id.feature_title)).check(matches(not(isCompletelyDisplayed())));\n+  }\n+\n+  // Given: a logged in user - with an active project which doesn't direct the user to add an\n+  // observation when adding a feature.\n+  // When: they tap the \"Add feature\" FAB and choose a feature type.\n+  // Then: the observation marker is displayed on the map screen.\n+  @Test\n+  public void addFeatureWithNoFields() throws InterruptedException {\n+    ActivityScenario<MainActivity> scenario = scenarioRule.getScenario();\n+\n+    // Tap on the \"Add feature\" button.\n+    onView(withId(R.id.add_feature_btn)).perform(click());\n+\n+    // Tap on the layer type.\n+    onData(allOf(is(instanceOf(String.class)), is(FakeData.LAYER_NO_FIELDS_NAME))).perform(click());\n+\n+    // Tap on the crosshair at the centre of the map.\n+    onView(withId(R.id.map_crosshairs)).perform(click());\n+\n+    // TODO: figure out how to remove this\n+    //  It's probably because the feature fragment animation does not block the test and the\n+    //  feature title isn't updated until the animation has completed (and it isn't disabled by the\n+    //  normal `transition_animation_scale 0` etc commands).\n+    Thread.sleep(100);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6fba2a175151d91d2fc2e23403008dcb3155d13a"}, "originalPosition": 146}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIyNDI2NQ==", "bodyText": "I think your idea for an AnimationManager which switches off animations for testing is probably the best one.", "url": "https://github.com/google/ground-android/pull/569#discussion_r477224265", "createdAt": "2020-08-26T11:19:08Z", "author": {"login": "dturner"}, "path": "gnd/src/androidTest/java/com/google/android/gnd/AddFeatureTest.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd;\n+\n+import static androidx.test.espresso.Espresso.onData;\n+import static androidx.test.espresso.Espresso.onView;\n+import static androidx.test.espresso.action.ViewActions.click;\n+import static androidx.test.espresso.assertion.ViewAssertions.matches;\n+import static androidx.test.espresso.matcher.ViewMatchers.isCompletelyDisplayed;\n+import static androidx.test.espresso.matcher.ViewMatchers.withId;\n+import static androidx.test.espresso.matcher.ViewMatchers.withText;\n+import static org.hamcrest.CoreMatchers.allOf;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.Matchers.instanceOf;\n+import static org.hamcrest.Matchers.not;\n+\n+import android.content.Context;\n+import androidx.room.Room;\n+import androidx.test.core.app.ActivityScenario;\n+import androidx.test.ext.junit.rules.ActivityScenarioRule;\n+import com.google.android.gnd.persistence.local.LocalDatabaseModule;\n+import com.google.android.gnd.persistence.local.room.LocalDatabase;\n+import com.google.android.gnd.persistence.remote.FakeRemoteDataStore;\n+import com.google.android.gnd.persistence.remote.FakeRemoteStorageManager;\n+import com.google.android.gnd.persistence.remote.RemoteDataStore;\n+import com.google.android.gnd.persistence.remote.RemoteStorageManager;\n+import com.google.android.gnd.persistence.remote.RemoteStorageModule;\n+import com.google.android.gnd.persistence.uuid.FakeUuidGenerator;\n+import com.google.android.gnd.persistence.uuid.OfflineUuidGenerator;\n+import com.google.android.gnd.system.auth.AuthenticationManager;\n+import com.google.android.gnd.system.auth.AuthenticationModule;\n+import com.google.android.gnd.system.auth.FakeAuthenticationManager;\n+import dagger.Binds;\n+import dagger.Module;\n+import dagger.Provides;\n+import dagger.hilt.InstallIn;\n+import dagger.hilt.android.components.ApplicationComponent;\n+import dagger.hilt.android.qualifiers.ApplicationContext;\n+import dagger.hilt.android.testing.HiltAndroidRule;\n+import dagger.hilt.android.testing.HiltAndroidTest;\n+import dagger.hilt.android.testing.UninstallModules;\n+import javax.inject.Singleton;\n+import org.junit.Rule;\n+import org.junit.Test;\n+\n+@UninstallModules({AuthenticationModule.class, RemoteStorageModule.class,\n+  LocalDatabaseModule.class})\n+@HiltAndroidTest\n+public class AddFeatureTest {\n+\n+  // Ensures that the Hilt component is initialized before running the ActivityScenarioRule.\n+  public @Rule(order = 0)\n+  HiltAndroidRule hiltRule = new HiltAndroidRule(this);\n+\n+  // Sets the preferences so no login is required and an active project is selected.\n+  public @Rule(order = 1)\n+  SetPreferencesRule preferencesRule = new SetPreferencesRule();\n+\n+  public @Rule(order = 2)\n+  ActivityScenarioRule scenarioRule =\n+    new ActivityScenarioRule(MainActivity.class);\n+\n+  @Module\n+  @InstallIn(ApplicationComponent.class)\n+  abstract class TestDependenciesModule {\n+\n+    @Binds\n+    @Singleton\n+    abstract AuthenticationManager bindAuthenticationManager(\n+      FakeAuthenticationManager authenticationManager);\n+\n+    @Binds\n+    @Singleton\n+    abstract RemoteDataStore bindRemoteDataStore(FakeRemoteDataStore remoteDataStore);\n+\n+    @Binds\n+    @Singleton\n+    abstract RemoteStorageManager bindRemoteStorageManager(\n+      FakeRemoteStorageManager remoteStorageManager);\n+\n+    @Binds\n+    @Singleton\n+    abstract OfflineUuidGenerator offlineUuidGenerator(FakeUuidGenerator uuidGenerator);\n+  }\n+\n+  @InstallIn(ApplicationComponent.class)\n+  @Module\n+  public class LocalDatabaseModule {\n+\n+    @Provides\n+    @Singleton\n+    LocalDatabase localDatabase(@ApplicationContext Context context) {\n+      return Room.inMemoryDatabaseBuilder(context, LocalDatabase.class).build();\n+    }\n+  }\n+\n+  // Given: a logged in user - with an active project with no map markers.\n+  // When: they tap on the centre of the map.\n+  // Then: nothing happens - the feature fragment is not displayed.\n+  @Test\n+  public void tappingCrosshairOnEmptyMapDoesNothing() throws InterruptedException {\n+    ActivityScenario<MainActivity> scenario = scenarioRule.getScenario();\n+\n+    // Tap on the crosshair at the centre of the map.\n+    onView(withId(R.id.map_crosshairs)).perform(click());\n+\n+    // Verify that the title is not displayed.\n+    onView(withId(R.id.feature_title)).check(matches(not(isCompletelyDisplayed())));\n+  }\n+\n+  // Given: a logged in user - with an active project which doesn't direct the user to add an\n+  // observation when adding a feature.\n+  // When: they tap the \"Add feature\" FAB and choose a feature type.\n+  // Then: the observation marker is displayed on the map screen.\n+  @Test\n+  public void addFeatureWithNoFields() throws InterruptedException {\n+    ActivityScenario<MainActivity> scenario = scenarioRule.getScenario();\n+\n+    // Tap on the \"Add feature\" button.\n+    onView(withId(R.id.add_feature_btn)).perform(click());\n+\n+    // Tap on the layer type.\n+    onData(allOf(is(instanceOf(String.class)), is(FakeData.LAYER_NO_FIELDS_NAME))).perform(click());\n+\n+    // Tap on the crosshair at the centre of the map.\n+    onView(withId(R.id.map_crosshairs)).perform(click());\n+\n+    // TODO: figure out how to remove this\n+    //  It's probably because the feature fragment animation does not block the test and the\n+    //  feature title isn't updated until the animation has completed (and it isn't disabled by the\n+    //  normal `transition_animation_scale 0` etc commands).\n+    Thread.sleep(100);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5ODgxMw=="}, "originalCommit": {"oid": "6fba2a175151d91d2fc2e23403008dcb3155d13a"}, "originalPosition": 146}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQ4NzM3Nw==", "bodyText": "In iosched animation is disabled manually for the bottom sheet: https://github.com/google/iosched/blob/89df01ebc19d9a46495baac4690c2ebfa74946dc/mobile/src/main/java/com/google/samples/apps/iosched/widget/BottomSheetBehavior.kt#L209 (thanks @JoseAlcerreca)", "url": "https://github.com/google/ground-android/pull/569#discussion_r478487377", "createdAt": "2020-08-27T15:02:03Z", "author": {"login": "dturner"}, "path": "gnd/src/androidTest/java/com/google/android/gnd/AddFeatureTest.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd;\n+\n+import static androidx.test.espresso.Espresso.onData;\n+import static androidx.test.espresso.Espresso.onView;\n+import static androidx.test.espresso.action.ViewActions.click;\n+import static androidx.test.espresso.assertion.ViewAssertions.matches;\n+import static androidx.test.espresso.matcher.ViewMatchers.isCompletelyDisplayed;\n+import static androidx.test.espresso.matcher.ViewMatchers.withId;\n+import static androidx.test.espresso.matcher.ViewMatchers.withText;\n+import static org.hamcrest.CoreMatchers.allOf;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.Matchers.instanceOf;\n+import static org.hamcrest.Matchers.not;\n+\n+import android.content.Context;\n+import androidx.room.Room;\n+import androidx.test.core.app.ActivityScenario;\n+import androidx.test.ext.junit.rules.ActivityScenarioRule;\n+import com.google.android.gnd.persistence.local.LocalDatabaseModule;\n+import com.google.android.gnd.persistence.local.room.LocalDatabase;\n+import com.google.android.gnd.persistence.remote.FakeRemoteDataStore;\n+import com.google.android.gnd.persistence.remote.FakeRemoteStorageManager;\n+import com.google.android.gnd.persistence.remote.RemoteDataStore;\n+import com.google.android.gnd.persistence.remote.RemoteStorageManager;\n+import com.google.android.gnd.persistence.remote.RemoteStorageModule;\n+import com.google.android.gnd.persistence.uuid.FakeUuidGenerator;\n+import com.google.android.gnd.persistence.uuid.OfflineUuidGenerator;\n+import com.google.android.gnd.system.auth.AuthenticationManager;\n+import com.google.android.gnd.system.auth.AuthenticationModule;\n+import com.google.android.gnd.system.auth.FakeAuthenticationManager;\n+import dagger.Binds;\n+import dagger.Module;\n+import dagger.Provides;\n+import dagger.hilt.InstallIn;\n+import dagger.hilt.android.components.ApplicationComponent;\n+import dagger.hilt.android.qualifiers.ApplicationContext;\n+import dagger.hilt.android.testing.HiltAndroidRule;\n+import dagger.hilt.android.testing.HiltAndroidTest;\n+import dagger.hilt.android.testing.UninstallModules;\n+import javax.inject.Singleton;\n+import org.junit.Rule;\n+import org.junit.Test;\n+\n+@UninstallModules({AuthenticationModule.class, RemoteStorageModule.class,\n+  LocalDatabaseModule.class})\n+@HiltAndroidTest\n+public class AddFeatureTest {\n+\n+  // Ensures that the Hilt component is initialized before running the ActivityScenarioRule.\n+  public @Rule(order = 0)\n+  HiltAndroidRule hiltRule = new HiltAndroidRule(this);\n+\n+  // Sets the preferences so no login is required and an active project is selected.\n+  public @Rule(order = 1)\n+  SetPreferencesRule preferencesRule = new SetPreferencesRule();\n+\n+  public @Rule(order = 2)\n+  ActivityScenarioRule scenarioRule =\n+    new ActivityScenarioRule(MainActivity.class);\n+\n+  @Module\n+  @InstallIn(ApplicationComponent.class)\n+  abstract class TestDependenciesModule {\n+\n+    @Binds\n+    @Singleton\n+    abstract AuthenticationManager bindAuthenticationManager(\n+      FakeAuthenticationManager authenticationManager);\n+\n+    @Binds\n+    @Singleton\n+    abstract RemoteDataStore bindRemoteDataStore(FakeRemoteDataStore remoteDataStore);\n+\n+    @Binds\n+    @Singleton\n+    abstract RemoteStorageManager bindRemoteStorageManager(\n+      FakeRemoteStorageManager remoteStorageManager);\n+\n+    @Binds\n+    @Singleton\n+    abstract OfflineUuidGenerator offlineUuidGenerator(FakeUuidGenerator uuidGenerator);\n+  }\n+\n+  @InstallIn(ApplicationComponent.class)\n+  @Module\n+  public class LocalDatabaseModule {\n+\n+    @Provides\n+    @Singleton\n+    LocalDatabase localDatabase(@ApplicationContext Context context) {\n+      return Room.inMemoryDatabaseBuilder(context, LocalDatabase.class).build();\n+    }\n+  }\n+\n+  // Given: a logged in user - with an active project with no map markers.\n+  // When: they tap on the centre of the map.\n+  // Then: nothing happens - the feature fragment is not displayed.\n+  @Test\n+  public void tappingCrosshairOnEmptyMapDoesNothing() throws InterruptedException {\n+    ActivityScenario<MainActivity> scenario = scenarioRule.getScenario();\n+\n+    // Tap on the crosshair at the centre of the map.\n+    onView(withId(R.id.map_crosshairs)).perform(click());\n+\n+    // Verify that the title is not displayed.\n+    onView(withId(R.id.feature_title)).check(matches(not(isCompletelyDisplayed())));\n+  }\n+\n+  // Given: a logged in user - with an active project which doesn't direct the user to add an\n+  // observation when adding a feature.\n+  // When: they tap the \"Add feature\" FAB and choose a feature type.\n+  // Then: the observation marker is displayed on the map screen.\n+  @Test\n+  public void addFeatureWithNoFields() throws InterruptedException {\n+    ActivityScenario<MainActivity> scenario = scenarioRule.getScenario();\n+\n+    // Tap on the \"Add feature\" button.\n+    onView(withId(R.id.add_feature_btn)).perform(click());\n+\n+    // Tap on the layer type.\n+    onData(allOf(is(instanceOf(String.class)), is(FakeData.LAYER_NO_FIELDS_NAME))).perform(click());\n+\n+    // Tap on the crosshair at the centre of the map.\n+    onView(withId(R.id.map_crosshairs)).perform(click());\n+\n+    // TODO: figure out how to remove this\n+    //  It's probably because the feature fragment animation does not block the test and the\n+    //  feature title isn't updated until the animation has completed (and it isn't disabled by the\n+    //  normal `transition_animation_scale 0` etc commands).\n+    Thread.sleep(100);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5ODgxMw=="}, "originalCommit": {"oid": "6fba2a175151d91d2fc2e23403008dcb3155d13a"}, "originalPosition": 146}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODUzNjkzMw==", "bodyText": "I tried taking the current version of BottomSheetBehavior and modifying it so that animations are disabled. This resulted in the test passing without Thread.sleep on my Pixel 4A but still failing on the emulator (tried API 23 and 29). I feel like there's a background thread being spun up somewhere after tapping on the map pin which delays the display of the bottom sheet just long enough for the test to fail.", "url": "https://github.com/google/ground-android/pull/569#discussion_r478536933", "createdAt": "2020-08-27T16:13:55Z", "author": {"login": "dturner"}, "path": "gnd/src/androidTest/java/com/google/android/gnd/AddFeatureTest.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd;\n+\n+import static androidx.test.espresso.Espresso.onData;\n+import static androidx.test.espresso.Espresso.onView;\n+import static androidx.test.espresso.action.ViewActions.click;\n+import static androidx.test.espresso.assertion.ViewAssertions.matches;\n+import static androidx.test.espresso.matcher.ViewMatchers.isCompletelyDisplayed;\n+import static androidx.test.espresso.matcher.ViewMatchers.withId;\n+import static androidx.test.espresso.matcher.ViewMatchers.withText;\n+import static org.hamcrest.CoreMatchers.allOf;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.Matchers.instanceOf;\n+import static org.hamcrest.Matchers.not;\n+\n+import android.content.Context;\n+import androidx.room.Room;\n+import androidx.test.core.app.ActivityScenario;\n+import androidx.test.ext.junit.rules.ActivityScenarioRule;\n+import com.google.android.gnd.persistence.local.LocalDatabaseModule;\n+import com.google.android.gnd.persistence.local.room.LocalDatabase;\n+import com.google.android.gnd.persistence.remote.FakeRemoteDataStore;\n+import com.google.android.gnd.persistence.remote.FakeRemoteStorageManager;\n+import com.google.android.gnd.persistence.remote.RemoteDataStore;\n+import com.google.android.gnd.persistence.remote.RemoteStorageManager;\n+import com.google.android.gnd.persistence.remote.RemoteStorageModule;\n+import com.google.android.gnd.persistence.uuid.FakeUuidGenerator;\n+import com.google.android.gnd.persistence.uuid.OfflineUuidGenerator;\n+import com.google.android.gnd.system.auth.AuthenticationManager;\n+import com.google.android.gnd.system.auth.AuthenticationModule;\n+import com.google.android.gnd.system.auth.FakeAuthenticationManager;\n+import dagger.Binds;\n+import dagger.Module;\n+import dagger.Provides;\n+import dagger.hilt.InstallIn;\n+import dagger.hilt.android.components.ApplicationComponent;\n+import dagger.hilt.android.qualifiers.ApplicationContext;\n+import dagger.hilt.android.testing.HiltAndroidRule;\n+import dagger.hilt.android.testing.HiltAndroidTest;\n+import dagger.hilt.android.testing.UninstallModules;\n+import javax.inject.Singleton;\n+import org.junit.Rule;\n+import org.junit.Test;\n+\n+@UninstallModules({AuthenticationModule.class, RemoteStorageModule.class,\n+  LocalDatabaseModule.class})\n+@HiltAndroidTest\n+public class AddFeatureTest {\n+\n+  // Ensures that the Hilt component is initialized before running the ActivityScenarioRule.\n+  public @Rule(order = 0)\n+  HiltAndroidRule hiltRule = new HiltAndroidRule(this);\n+\n+  // Sets the preferences so no login is required and an active project is selected.\n+  public @Rule(order = 1)\n+  SetPreferencesRule preferencesRule = new SetPreferencesRule();\n+\n+  public @Rule(order = 2)\n+  ActivityScenarioRule scenarioRule =\n+    new ActivityScenarioRule(MainActivity.class);\n+\n+  @Module\n+  @InstallIn(ApplicationComponent.class)\n+  abstract class TestDependenciesModule {\n+\n+    @Binds\n+    @Singleton\n+    abstract AuthenticationManager bindAuthenticationManager(\n+      FakeAuthenticationManager authenticationManager);\n+\n+    @Binds\n+    @Singleton\n+    abstract RemoteDataStore bindRemoteDataStore(FakeRemoteDataStore remoteDataStore);\n+\n+    @Binds\n+    @Singleton\n+    abstract RemoteStorageManager bindRemoteStorageManager(\n+      FakeRemoteStorageManager remoteStorageManager);\n+\n+    @Binds\n+    @Singleton\n+    abstract OfflineUuidGenerator offlineUuidGenerator(FakeUuidGenerator uuidGenerator);\n+  }\n+\n+  @InstallIn(ApplicationComponent.class)\n+  @Module\n+  public class LocalDatabaseModule {\n+\n+    @Provides\n+    @Singleton\n+    LocalDatabase localDatabase(@ApplicationContext Context context) {\n+      return Room.inMemoryDatabaseBuilder(context, LocalDatabase.class).build();\n+    }\n+  }\n+\n+  // Given: a logged in user - with an active project with no map markers.\n+  // When: they tap on the centre of the map.\n+  // Then: nothing happens - the feature fragment is not displayed.\n+  @Test\n+  public void tappingCrosshairOnEmptyMapDoesNothing() throws InterruptedException {\n+    ActivityScenario<MainActivity> scenario = scenarioRule.getScenario();\n+\n+    // Tap on the crosshair at the centre of the map.\n+    onView(withId(R.id.map_crosshairs)).perform(click());\n+\n+    // Verify that the title is not displayed.\n+    onView(withId(R.id.feature_title)).check(matches(not(isCompletelyDisplayed())));\n+  }\n+\n+  // Given: a logged in user - with an active project which doesn't direct the user to add an\n+  // observation when adding a feature.\n+  // When: they tap the \"Add feature\" FAB and choose a feature type.\n+  // Then: the observation marker is displayed on the map screen.\n+  @Test\n+  public void addFeatureWithNoFields() throws InterruptedException {\n+    ActivityScenario<MainActivity> scenario = scenarioRule.getScenario();\n+\n+    // Tap on the \"Add feature\" button.\n+    onView(withId(R.id.add_feature_btn)).perform(click());\n+\n+    // Tap on the layer type.\n+    onData(allOf(is(instanceOf(String.class)), is(FakeData.LAYER_NO_FIELDS_NAME))).perform(click());\n+\n+    // Tap on the crosshair at the centre of the map.\n+    onView(withId(R.id.map_crosshairs)).perform(click());\n+\n+    // TODO: figure out how to remove this\n+    //  It's probably because the feature fragment animation does not block the test and the\n+    //  feature title isn't updated until the animation has completed (and it isn't disabled by the\n+    //  normal `transition_animation_scale 0` etc commands).\n+    Thread.sleep(100);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5ODgxMw=="}, "originalCommit": {"oid": "6fba2a175151d91d2fc2e23403008dcb3155d13a"}, "originalPosition": 146}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4MjcwNTQ3OnYy", "diffSide": "RIGHT", "path": "gnd/src/androidTest/java/com/google/android/gnd/CustomTestRunner.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQwNzo0MzoyNlrOHG_0PA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMToxNzoyM1rOHHHZpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5OTA2OA==", "bodyText": "Was this kind of indentation allowed in Java? D:", "url": "https://github.com/google/ground-android/pull/569#discussion_r477099068", "createdAt": "2020-08-26T07:43:26Z", "author": {"login": "JoseAlcerreca"}, "path": "gnd/src/androidTest/java/com/google/android/gnd/CustomTestRunner.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd;\n+\n+import android.app.Application;\n+import android.content.Context;\n+import androidx.test.runner.AndroidJUnitRunner;\n+import dagger.hilt.android.testing.HiltTestApplication;\n+import timber.log.Timber;\n+import timber.log.Timber.DebugTree;\n+\n+public class CustomTestRunner extends AndroidJUnitRunner {\n+\n+  @Override\n+  public Application newApplication(ClassLoader cl, String className,\n+    Context context)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6fba2a175151d91d2fc2e23403008dcb3155d13a"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIyMzMzNA==", "bodyText": "Nope :) All fixed now.", "url": "https://github.com/google/ground-android/pull/569#discussion_r477223334", "createdAt": "2020-08-26T11:17:23Z", "author": {"login": "dturner"}, "path": "gnd/src/androidTest/java/com/google/android/gnd/CustomTestRunner.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd;\n+\n+import android.app.Application;\n+import android.content.Context;\n+import androidx.test.runner.AndroidJUnitRunner;\n+import dagger.hilt.android.testing.HiltTestApplication;\n+import timber.log.Timber;\n+import timber.log.Timber.DebugTree;\n+\n+public class CustomTestRunner extends AndroidJUnitRunner {\n+\n+  @Override\n+  public Application newApplication(ClassLoader cl, String className,\n+    Context context)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5OTA2OA=="}, "originalCommit": {"oid": "6fba2a175151d91d2fc2e23403008dcb3155d13a"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4MjcwNzkxOnYy", "diffSide": "RIGHT", "path": "gnd/src/androidTest/java/com/google/android/gnd/persistence/remote/FakeRemoteDataStore.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQwNzo0NDowNFrOHG_1og==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQwNzo0NDowNFrOHG_1og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5OTQyNg==", "bodyText": "same line", "url": "https://github.com/google/ground-android/pull/569#discussion_r477099426", "createdAt": "2020-08-26T07:44:04Z", "author": {"login": "JoseAlcerreca"}, "path": "gnd/src/androidTest/java/com/google/android/gnd/persistence/remote/FakeRemoteDataStore.java", "diffHunk": "@@ -0,0 +1,87 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd.persistence.remote;\n+\n+import com.google.android.gnd.FakeData;\n+import com.google.android.gnd.model.Mutation;\n+import com.google.android.gnd.model.Project;\n+import com.google.android.gnd.model.User;\n+import com.google.android.gnd.model.feature.Feature;\n+import com.google.android.gnd.model.layer.Layer;\n+import com.google.android.gnd.model.layer.Style;\n+import com.google.android.gnd.model.observation.Observation;\n+import com.google.android.gnd.rx.ValueOrError;\n+import com.google.common.collect.ImmutableCollection;\n+import com.google.common.collect.ImmutableList;\n+import io.reactivex.Completable;\n+import io.reactivex.Flowable;\n+import io.reactivex.Single;\n+import java.util.Collections;\n+import java.util.List;\n+import javax.inject.Inject;\n+\n+public class FakeRemoteDataStore implements RemoteDataStore {\n+\n+  private final Layer layerWithNoFields = Layer.newBuilder()\n+    .setId(FakeData.LAYER_NO_FIELDS_ID)\n+    .setName(FakeData.LAYER_NO_FIELDS_NAME)\n+    .setDefaultStyle(Style.builder()\n+      .setColor(FakeData.LAYER_NO_FIELDS_COLOR)\n+      .build())\n+    .build();\n+\n+  private final Project testProject = Project.newBuilder()\n+    .setId(FakeData.PROJECT_ID)\n+    .setTitle(FakeData.PROJECT_TITLE)\n+    .setDescription(FakeData.PROJECT_DESCRIPTION)\n+    .putLayer(FakeData.LAYER_NO_FIELDS_ID, layerWithNoFields)\n+    .build();\n+\n+  @Inject\n+  FakeRemoteDataStore() {\n+  }\n+\n+  @Override\n+  public Single<List<Project>> loadProjectSummaries(\n+    User user) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6fba2a175151d91d2fc2e23403008dcb3155d13a"}, "originalPosition": 60}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2530, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}