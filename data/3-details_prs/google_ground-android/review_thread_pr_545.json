{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ5ODc5MTU1", "number": 545, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwNTozODo0NFrOEPZv2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNDo1NTozNVrOEP9Uhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0NTg1OTQ1OnYy", "diffSide": "RIGHT", "path": ".idea/codeStyles/Project.xml", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwNTozODo0NFrOGzF_UA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQwNTo1ODozOVrOGzs0Iw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjIyODY4OA==", "bodyText": "I think these changes are harmless as these formatting settings are not for java or xml files.\nDo they appear back if you manually revert these changes?", "url": "https://github.com/google/ground-android/pull/545#discussion_r456228688", "createdAt": "2020-07-17T05:38:44Z", "author": {"login": "shobhitagarwal1612"}, "path": ".idea/codeStyles/Project.xml", "diffHunk": "@@ -79,9 +79,33 @@\n         <pair source=\"c\" header=\"h\" fileNamingConvention=\"NONE\" />\n       </extensions>\n     </Objective-C-extensions>\n+    <DBN-PSQL>\n+      <case-options enabled=\"true\">\n+        <option name=\"KEYWORD_CASE\" value=\"lower\" />\n+        <option name=\"FUNCTION_CASE\" value=\"lower\" />\n+        <option name=\"PARAMETER_CASE\" value=\"lower\" />\n+        <option name=\"DATATYPE_CASE\" value=\"lower\" />\n+        <option name=\"OBJECT_CASE\" value=\"preserve\" />\n+      </case-options>\n+      <formatting-settings enabled=\"false\" />\n+    </DBN-PSQL>\n     <Python>\n       <option name=\"USE_CONTINUATION_INDENT_FOR_ARGUMENTS\" value=\"true\" />\n     </Python>\n+    <DBN-SQL>\n+      <case-options enabled=\"true\">\n+        <option name=\"KEYWORD_CASE\" value=\"lower\" />\n+        <option name=\"FUNCTION_CASE\" value=\"lower\" />\n+        <option name=\"PARAMETER_CASE\" value=\"lower\" />\n+        <option name=\"DATATYPE_CASE\" value=\"lower\" />\n+        <option name=\"OBJECT_CASE\" value=\"preserve\" />\n+      </case-options>\n+      <formatting-settings enabled=\"false\">\n+        <option name=\"STATEMENT_SPACING\" value=\"one_line\" />\n+        <option name=\"CLAUSE_CHOP_DOWN\" value=\"chop_down_if_statement_long\" />\n+        <option name=\"ITERATION_ELEMENTS_WRAPPING\" value=\"chop_down_if_not_single\" />\n+      </formatting-settings>\n+    </DBN-SQL>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c8b9b38b9f5e8cbab5801623340acf5b57a4613"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjU3OTUxNQ==", "bodyText": "They do.. I can't seem to remove them :/", "url": "https://github.com/google/ground-android/pull/545#discussion_r456579515", "createdAt": "2020-07-17T17:33:37Z", "author": {"login": "gino-m"}, "path": ".idea/codeStyles/Project.xml", "diffHunk": "@@ -79,9 +79,33 @@\n         <pair source=\"c\" header=\"h\" fileNamingConvention=\"NONE\" />\n       </extensions>\n     </Objective-C-extensions>\n+    <DBN-PSQL>\n+      <case-options enabled=\"true\">\n+        <option name=\"KEYWORD_CASE\" value=\"lower\" />\n+        <option name=\"FUNCTION_CASE\" value=\"lower\" />\n+        <option name=\"PARAMETER_CASE\" value=\"lower\" />\n+        <option name=\"DATATYPE_CASE\" value=\"lower\" />\n+        <option name=\"OBJECT_CASE\" value=\"preserve\" />\n+      </case-options>\n+      <formatting-settings enabled=\"false\" />\n+    </DBN-PSQL>\n     <Python>\n       <option name=\"USE_CONTINUATION_INDENT_FOR_ARGUMENTS\" value=\"true\" />\n     </Python>\n+    <DBN-SQL>\n+      <case-options enabled=\"true\">\n+        <option name=\"KEYWORD_CASE\" value=\"lower\" />\n+        <option name=\"FUNCTION_CASE\" value=\"lower\" />\n+        <option name=\"PARAMETER_CASE\" value=\"lower\" />\n+        <option name=\"DATATYPE_CASE\" value=\"lower\" />\n+        <option name=\"OBJECT_CASE\" value=\"preserve\" />\n+      </case-options>\n+      <formatting-settings enabled=\"false\">\n+        <option name=\"STATEMENT_SPACING\" value=\"one_line\" />\n+        <option name=\"CLAUSE_CHOP_DOWN\" value=\"chop_down_if_statement_long\" />\n+        <option name=\"ITERATION_ELEMENTS_WRAPPING\" value=\"chop_down_if_not_single\" />\n+      </formatting-settings>\n+    </DBN-SQL>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjIyODY4OA=="}, "originalCommit": {"oid": "9c8b9b38b9f5e8cbab5801623340acf5b57a4613"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg2NDgwMw==", "bodyText": "Let's ignore it for now and keep the changes", "url": "https://github.com/google/ground-android/pull/545#discussion_r456864803", "createdAt": "2020-07-19T05:58:39Z", "author": {"login": "shobhitagarwal1612"}, "path": ".idea/codeStyles/Project.xml", "diffHunk": "@@ -79,9 +79,33 @@\n         <pair source=\"c\" header=\"h\" fileNamingConvention=\"NONE\" />\n       </extensions>\n     </Objective-C-extensions>\n+    <DBN-PSQL>\n+      <case-options enabled=\"true\">\n+        <option name=\"KEYWORD_CASE\" value=\"lower\" />\n+        <option name=\"FUNCTION_CASE\" value=\"lower\" />\n+        <option name=\"PARAMETER_CASE\" value=\"lower\" />\n+        <option name=\"DATATYPE_CASE\" value=\"lower\" />\n+        <option name=\"OBJECT_CASE\" value=\"preserve\" />\n+      </case-options>\n+      <formatting-settings enabled=\"false\" />\n+    </DBN-PSQL>\n     <Python>\n       <option name=\"USE_CONTINUATION_INDENT_FOR_ARGUMENTS\" value=\"true\" />\n     </Python>\n+    <DBN-SQL>\n+      <case-options enabled=\"true\">\n+        <option name=\"KEYWORD_CASE\" value=\"lower\" />\n+        <option name=\"FUNCTION_CASE\" value=\"lower\" />\n+        <option name=\"PARAMETER_CASE\" value=\"lower\" />\n+        <option name=\"DATATYPE_CASE\" value=\"lower\" />\n+        <option name=\"OBJECT_CASE\" value=\"preserve\" />\n+      </case-options>\n+      <formatting-settings enabled=\"false\">\n+        <option name=\"STATEMENT_SPACING\" value=\"one_line\" />\n+        <option name=\"CLAUSE_CHOP_DOWN\" value=\"chop_down_if_statement_long\" />\n+        <option name=\"ITERATION_ELEMENTS_WRAPPING\" value=\"chop_down_if_not_single\" />\n+      </formatting-settings>\n+    </DBN-SQL>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjIyODY4OA=="}, "originalCommit": {"oid": "9c8b9b38b9f5e8cbab5801623340acf5b57a4613"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0NTg2OTI3OnYy", "diffSide": "RIGHT", "path": "gnd/build.gradle", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwNTo0Mzo1M1rOGzGFAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNTo1Mjo0M1rOG0UgeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjIzMDE0Nw==", "bodyText": "IIUC, updating heap size is necessary if build is slow. Were there any significant performance improvements after this change? I haven't faced any build performance issues recently", "url": "https://github.com/google/ground-android/pull/545#discussion_r456230147", "createdAt": "2020-07-17T05:43:53Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/build.gradle", "diffHunk": "@@ -83,6 +83,9 @@ android {\n         dataBinding true\n         viewBinding true\n     }\n+    dexOptions {\n+        javaMaxHeapSize \"4g\"\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c8b9b38b9f5e8cbab5801623340acf5b57a4613"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUxNTEyOQ==", "bodyText": "Build was failing with \"OutOfMemoryError: GC overhead limit exceeded\". I upped the heap size to get it to pass. Ok to keep it?", "url": "https://github.com/google/ground-android/pull/545#discussion_r457515129", "createdAt": "2020-07-20T15:52:43Z", "author": {"login": "gino-m"}, "path": "gnd/build.gradle", "diffHunk": "@@ -83,6 +83,9 @@ android {\n         dataBinding true\n         viewBinding true\n     }\n+    dexOptions {\n+        javaMaxHeapSize \"4g\"\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjIzMDE0Nw=="}, "originalCommit": {"oid": "9c8b9b38b9f5e8cbab5801623340acf5b57a4613"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0NTg3OTcyOnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/model/form/Option.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwNTo0OToyOFrOGzGLLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNDozMDoxNVrOGzVRrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjIzMTcyNg==", "bodyText": "Does this mean code is deprecated now?", "url": "https://github.com/google/ground-android/pull/545#discussion_r456231726", "createdAt": "2020-07-17T05:49:28Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/src/main/java/com/google/android/gnd/model/form/Option.java", "diffHunk": "@@ -16,12 +16,16 @@\n \n package com.google.android.gnd.model.form;\n \n+import androidx.annotation.NonNull;\n import com.google.auto.value.AutoValue;\n import javax.annotation.Nullable;\n \n /** Describes a single valid option to a multiple choice question. */\n @AutoValue\n public abstract class Option {\n+  @NonNull\n+  public abstract String getId();\n+\n   @Nullable\n   public abstract String getCode();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c8b9b38b9f5e8cbab5801623340acf5b57a4613"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ3OTE1MA==", "bodyText": "Nope.. code is an optional, language neutral value, used for analysis. So if the survey is in five languages, for example, values can be still be compared.", "url": "https://github.com/google/ground-android/pull/545#discussion_r456479150", "createdAt": "2020-07-17T14:30:15Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/model/form/Option.java", "diffHunk": "@@ -16,12 +16,16 @@\n \n package com.google.android.gnd.model.form;\n \n+import androidx.annotation.NonNull;\n import com.google.auto.value.AutoValue;\n import javax.annotation.Nullable;\n \n /** Describes a single valid option to a multiple choice question. */\n @AutoValue\n public abstract class Option {\n+  @NonNull\n+  public abstract String getId();\n+\n   @Nullable\n   public abstract String getCode();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjIzMTcyNg=="}, "originalCommit": {"oid": "9c8b9b38b9f5e8cbab5801623340acf5b57a4613"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0NTg4NjMyOnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/persistence/local/room/RoomLocalDataStore.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwNTo1Mjo0NlrOGzGPBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNzozMzowOFrOGzbY1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjIzMjcwOA==", "bodyText": "Can we revert this back?", "url": "https://github.com/google/ground-android/pull/545#discussion_r456232708", "createdAt": "2020-07-17T05:52:46Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/src/main/java/com/google/android/gnd/persistence/local/room/RoomLocalDataStore.java", "diffHunk": "@@ -340,24 +341,26 @@ public Completable mergeFeature(Feature feature) {\n         .subscribeOn(schedulers.io());\n   }\n \n+  @SuppressLint(\"TimberArgCount\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c8b9b38b9f5e8cbab5801623340acf5b57a4613"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjU3OTI4Nw==", "bodyText": "Done!", "url": "https://github.com/google/ground-android/pull/545#discussion_r456579287", "createdAt": "2020-07-17T17:33:08Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/persistence/local/room/RoomLocalDataStore.java", "diffHunk": "@@ -340,24 +341,26 @@ public Completable mergeFeature(Feature feature) {\n         .subscribeOn(schedulers.io());\n   }\n \n+  @SuppressLint(\"TimberArgCount\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjIzMjcwOA=="}, "originalCommit": {"oid": "9c8b9b38b9f5e8cbab5801623340acf5b57a4613"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0NTkwMTkyOnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/persistence/local/room/RoomLocalDataStore.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwNjowMDoyNlrOGzGYEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNDo1MzoyMlrOGz4CYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjIzNTAyNA==", "bodyText": "If we traceback the call, this observation is fetched from local db in getObservations() and isn't mutated in the path. Maybe we should revert this back too. Unless I am missing some point, can you please check?", "url": "https://github.com/google/ground-android/pull/545#discussion_r456235024", "createdAt": "2020-07-17T06:00:26Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/src/main/java/com/google/android/gnd/persistence/local/room/RoomLocalDataStore.java", "diffHunk": "@@ -340,24 +341,26 @@ public Completable mergeFeature(Feature feature) {\n         .subscribeOn(schedulers.io());\n   }\n \n+  @SuppressLint(\"TimberArgCount\")\n   @Transaction\n   @Override\n   public Completable mergeObservation(Observation observation) {\n     ObservationEntity observationEntity = ObservationEntity.fromObservation(observation);\n     return observationMutationDao\n         .findByObservationId(observation.getId())\n-        .flatMapCompletable(mutations -> mergeObservation(observationEntity, mutations));\n+        .flatMapCompletable(mutations -> mergeObservation(observationEntity, mutations))\n+        .subscribeOn(schedulers.io());\n   }\n \n   private Completable mergeObservation(\n       ObservationEntity observation, List<ObservationMutationEntity> mutations) {\n     if (mutations.isEmpty()) {\n-      return Completable.complete();\n+      return observationDao.insertOrUpdate(observation);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c8b9b38b9f5e8cbab5801623340acf5b57a4613"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjU3NDA4Mg==", "bodyText": "Observations are being fetched from the remote db in ObservationRepository line 97, not the local one; previous they were not being written at all unless there were related mutations; not sure how this was ever working, unless something changed.", "url": "https://github.com/google/ground-android/pull/545#discussion_r456574082", "createdAt": "2020-07-17T17:22:12Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/persistence/local/room/RoomLocalDataStore.java", "diffHunk": "@@ -340,24 +341,26 @@ public Completable mergeFeature(Feature feature) {\n         .subscribeOn(schedulers.io());\n   }\n \n+  @SuppressLint(\"TimberArgCount\")\n   @Transaction\n   @Override\n   public Completable mergeObservation(Observation observation) {\n     ObservationEntity observationEntity = ObservationEntity.fromObservation(observation);\n     return observationMutationDao\n         .findByObservationId(observation.getId())\n-        .flatMapCompletable(mutations -> mergeObservation(observationEntity, mutations));\n+        .flatMapCompletable(mutations -> mergeObservation(observationEntity, mutations))\n+        .subscribeOn(schedulers.io());\n   }\n \n   private Completable mergeObservation(\n       ObservationEntity observation, List<ObservationMutationEntity> mutations) {\n     if (mutations.isEmpty()) {\n-      return Completable.complete();\n+      return observationDao.insertOrUpdate(observation);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjIzNTAyNA=="}, "originalCommit": {"oid": "9c8b9b38b9f5e8cbab5801623340acf5b57a4613"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzA0ODY3Mg==", "bodyText": "Thanks for pointing that out!", "url": "https://github.com/google/ground-android/pull/545#discussion_r457048672", "createdAt": "2020-07-20T04:53:22Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/src/main/java/com/google/android/gnd/persistence/local/room/RoomLocalDataStore.java", "diffHunk": "@@ -340,24 +341,26 @@ public Completable mergeFeature(Feature feature) {\n         .subscribeOn(schedulers.io());\n   }\n \n+  @SuppressLint(\"TimberArgCount\")\n   @Transaction\n   @Override\n   public Completable mergeObservation(Observation observation) {\n     ObservationEntity observationEntity = ObservationEntity.fromObservation(observation);\n     return observationMutationDao\n         .findByObservationId(observation.getId())\n-        .flatMapCompletable(mutations -> mergeObservation(observationEntity, mutations));\n+        .flatMapCompletable(mutations -> mergeObservation(observationEntity, mutations))\n+        .subscribeOn(schedulers.io());\n   }\n \n   private Completable mergeObservation(\n       ObservationEntity observation, List<ObservationMutationEntity> mutations) {\n     if (mutations.isEmpty()) {\n-      return Completable.complete();\n+      return observationDao.insertOrUpdate(observation);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjIzNTAyNA=="}, "originalCommit": {"oid": "9c8b9b38b9f5e8cbab5801623340acf5b57a4613"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0NTk1NzU3OnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/persistence/remote/firestore/schema/LayerConverter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwNjoyNTo1OFrOGzG4Og==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNzoyNzo1NlrOGzbPDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjI0MzI1OA==", "bodyText": "StyleNestedObject is converted back to Style in the next step. Better to create instance of Style instead of StyleNestefObject in \"orElse\" block.\n    Style style =\n        Optional.ofNullable(obj.getDefaultStyle())\n            .map(StyleConverter::toStyle)\n            .orElse(\n                Style.builder().setColor(Optional.ofNullable(obj.getColor()).orElse(FALLBACK_COLOR)).build());\n\n    layer\n        .setId(id)\n        .setListHeading(getLocalizedMessage(obj.getListHeading()))\n        .setItemLabel(getLocalizedMessage(obj.getItemLabel()))\n        .setDefaultStyle(style);", "url": "https://github.com/google/ground-android/pull/545#discussion_r456243258", "createdAt": "2020-07-17T06:25:58Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/src/main/java/com/google/android/gnd/persistence/remote/firestore/schema/LayerConverter.java", "diffHunk": "@@ -20,25 +20,28 @@\n \n import android.util.Log;\n import com.google.android.gnd.model.layer.Layer;\n-import com.google.android.gnd.model.layer.Style;\n+import java8.util.Optional;\n \n /** Converts between Firestore documents and {@link Layer} instances. */\n class LayerConverter {\n   private static final String TAG = LayerConverter.class.getSimpleName();\n \n   /** Black marker used when default remote data is corrupt or missing. */\n-  private static final Style DEFAULT_DEFAULT_STYLE = Style.builder().setColor(\"#000000\").build();\n+  private static final String FALLBACK_COLOR = \"#000000\";\n \n   static Layer toLayer(String id, LayerNestedObject obj) {\n     Layer.Builder layer = Layer.newBuilder();\n+    // Use \"color\" field until web UI is updated:\n+    // TODO(https://github.com/google/ground-platform/issues/402): Remove fallback once updated in\n+    // web client.\n+    StyleNestedObject style =\n+        Optional.ofNullable(obj.getDefaultStyle())\n+            .orElse(\n+                new StyleNestedObject(Optional.ofNullable(obj.getColor()).orElse(FALLBACK_COLOR)));\n     layer\n         .setId(id)\n-        .setListHeading(getLocalizedMessage(obj.getListHeading()))\n-        .setItemLabel(getLocalizedMessage(obj.getItemLabel()))\n-        .setDefaultStyle(\n-            obj.getDefaultStyle() == null\n-                ? DEFAULT_DEFAULT_STYLE\n-                : StyleConverter.toStyle(obj.getDefaultStyle()));\n+        .setName(getLocalizedMessage(obj.getName()))\n+        .setDefaultStyle(StyleConverter.toStyle(style));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c8b9b38b9f5e8cbab5801623340acf5b57a4613"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjU3Njc4Mw==", "bodyText": "The two are functionally equivalent, and the cost of conversion is approx. 0, so I opted for creating a default input instead of output. Happy to change this, just wanted to mention it since in general we want to avoid over-optimizing code at the cost of readability.", "url": "https://github.com/google/ground-android/pull/545#discussion_r456576783", "createdAt": "2020-07-17T17:27:56Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/persistence/remote/firestore/schema/LayerConverter.java", "diffHunk": "@@ -20,25 +20,28 @@\n \n import android.util.Log;\n import com.google.android.gnd.model.layer.Layer;\n-import com.google.android.gnd.model.layer.Style;\n+import java8.util.Optional;\n \n /** Converts between Firestore documents and {@link Layer} instances. */\n class LayerConverter {\n   private static final String TAG = LayerConverter.class.getSimpleName();\n \n   /** Black marker used when default remote data is corrupt or missing. */\n-  private static final Style DEFAULT_DEFAULT_STYLE = Style.builder().setColor(\"#000000\").build();\n+  private static final String FALLBACK_COLOR = \"#000000\";\n \n   static Layer toLayer(String id, LayerNestedObject obj) {\n     Layer.Builder layer = Layer.newBuilder();\n+    // Use \"color\" field until web UI is updated:\n+    // TODO(https://github.com/google/ground-platform/issues/402): Remove fallback once updated in\n+    // web client.\n+    StyleNestedObject style =\n+        Optional.ofNullable(obj.getDefaultStyle())\n+            .orElse(\n+                new StyleNestedObject(Optional.ofNullable(obj.getColor()).orElse(FALLBACK_COLOR)));\n     layer\n         .setId(id)\n-        .setListHeading(getLocalizedMessage(obj.getListHeading()))\n-        .setItemLabel(getLocalizedMessage(obj.getItemLabel()))\n-        .setDefaultStyle(\n-            obj.getDefaultStyle() == null\n-                ? DEFAULT_DEFAULT_STYLE\n-                : StyleConverter.toStyle(obj.getDefaultStyle()));\n+        .setName(getLocalizedMessage(obj.getName()))\n+        .setDefaultStyle(StyleConverter.toStyle(style));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjI0MzI1OA=="}, "originalCommit": {"oid": "9c8b9b38b9f5e8cbab5801623340acf5b57a4613"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1MTY4Nzc1OnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/persistence/local/room/RoomLocalDataStore.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNDo1NTozNVrOGz4GYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNTo1MTo0MlrOG0UdVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzA0OTY5OQ==", "bodyText": "Please remove this unused import", "url": "https://github.com/google/ground-android/pull/545#discussion_r457049699", "createdAt": "2020-07-20T04:55:35Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/src/main/java/com/google/android/gnd/persistence/local/room/RoomLocalDataStore.java", "diffHunk": "@@ -20,6 +20,7 @@\n import static com.google.android.gnd.util.ImmutableSetCollector.toImmutableSet;\n import static java8.util.stream.StreamSupport.stream;\n \n+import android.annotation.SuppressLint;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2390fb8ff850da8e895a1484edab9a652121f5e0"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUxNDMyNA==", "bodyText": "Done.", "url": "https://github.com/google/ground-android/pull/545#discussion_r457514324", "createdAt": "2020-07-20T15:51:42Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/persistence/local/room/RoomLocalDataStore.java", "diffHunk": "@@ -20,6 +20,7 @@\n import static com.google.android.gnd.util.ImmutableSetCollector.toImmutableSet;\n import static java8.util.stream.StreamSupport.stream;\n \n+import android.annotation.SuppressLint;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzA0OTY5OQ=="}, "originalCommit": {"oid": "2390fb8ff850da8e895a1484edab9a652121f5e0"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2508, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}