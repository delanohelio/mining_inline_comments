{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0NTcyMjA4", "number": 524, "title": "Refactor ObservationRepository", "bodyText": "Closes #523\nMove boilerplate code for generating mutations to ObservationRepository", "createdAt": "2020-07-06T06:38:56Z", "url": "https://github.com/google/ground-android/pull/524", "merged": true, "mergeCommit": {"oid": "802e34a94caff4b8ff9c31b3460e186047c11b4f"}, "closed": true, "closedAt": "2020-07-06T11:08:24Z", "author": {"login": "shobhitagarwal1612"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyKpyDgH2gAyNDQ0NTcyMjA4OjUwMGEyYjUxZWU1Y2RkMjU3OGM1ZWRjZWQwNTcxMzYwNTdhMWMxYzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcyPPnuAFqTQ0Mjk4MTEyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "500a2b51ee5cdd2578c5edced057136057a1c1c9", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/500a2b51ee5cdd2578c5edced057136057a1c1c9", "committedDate": "2020-07-06T05:46:59Z", "message": "Replace log -> timber"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5619a91501624758471e1583162538df2da7a32", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/c5619a91501624758471e1583162538df2da7a32", "committedDate": "2020-07-06T06:28:50Z", "message": "Add method to add observation mutation in ObservationRepository"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7069b638f84d9aa3121177e4dc1748bcfb61140a", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/7069b638f84d9aa3121177e4dc1748bcfb61140a", "committedDate": "2020-07-06T06:30:56Z", "message": "Remove annotation Singleton\n\nWe are not initializing anything except injecting a bunch of more dependencies. So, maintaining a singleton doesn't provide any benefits and it's better to free memory."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cda60a1eee89dc8446bb8bdc1b5013fd24ae1912", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/cda60a1eee89dc8446bb8bdc1b5013fd24ae1912", "committedDate": "2020-07-06T06:32:32Z", "message": "Simplify EditObservationViewModel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b58b5aba771579bec909844ab9c0c420fa2ba201", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/b58b5aba771579bec909844ab9c0c420fa2ba201", "committedDate": "2020-07-06T06:43:19Z", "message": "Merge branch 'master' into cleanup2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyOTgxMDQ3", "url": "https://github.com/google/ground-android/pull/524#pullrequestreview-442981047", "createdAt": "2020-07-06T11:07:47Z", "commit": {"oid": "b58b5aba771579bec909844ab9c0c420fa2ba201"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxMTowNzo0N1rOGtS5Sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxMTowNzo0N1rOGtS5Sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE0ODY4Mw==", "bodyText": "Just an observation, the viewmodel's saveProgressVisibility property could be refactored to isSaving and the visibility logic could then be handled in the layout XML using databinding e.g. android:visibility=\"@{viewmodel.isSaving ? View.VISIBLE : View.GONE}\"", "url": "https://github.com/google/ground-android/pull/524#discussion_r450148683", "createdAt": "2020-07-06T11:07:47Z", "author": {"login": "dturner"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationViewModel.java", "diffHunk": "@@ -303,21 +293,13 @@ private void onObservationLoaded(Observation observation) {\n   }\n \n   private Single<Event<SaveResult>> save() {\n-    savingProgressVisibility.setValue(View.VISIBLE);\n-    ObservationMutation observationMutation =\n-        ObservationMutation.builder()\n-            .setType(isNew ? ObservationMutation.Type.CREATE : ObservationMutation.Type.UPDATE)\n-            .setProjectId(originalObservation.getProject().getId())\n-            .setFeatureId(originalObservation.getFeature().getId())\n-            .setLayerId(originalObservation.getFeature().getLayer().getId())\n-            .setObservationId(originalObservation.getId())\n-            .setFormId(originalObservation.getForm().getId())\n-            .setResponseDeltas(getResponseDeltas())\n-            .setClientTimestamp(new Date())\n-            .setUserId(authManager.getCurrentUser().getId())\n-            .build();\n+    if (originalObservation == null) {\n+      return Single.error(new IllegalStateException(\"Observation is null\"));\n+    }\n+\n     return observationRepository\n-        .applyAndEnqueue(observationMutation)\n+        .addObservationMutation(originalObservation, getResponseDeltas(), isNew)\n+        .doOnSubscribe(disposable -> savingProgressVisibility.setValue(View.VISIBLE))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b58b5aba771579bec909844ab9c0c420fa2ba201"}, "originalPosition": 83}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyOTgxMTIw", "url": "https://github.com/google/ground-android/pull/524#pullrequestreview-442981120", "createdAt": "2020-07-06T11:07:56Z", "commit": {"oid": "b58b5aba771579bec909844ab9c0c420fa2ba201"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1592, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}