{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4MTk1Mzcx", "number": 565, "title": "[View/add/edit observations] Sort fields by `index` defined in form", "bodyText": "Fixes #396.", "createdAt": "2020-08-14T21:43:05Z", "url": "https://github.com/google/ground-android/pull/565", "merged": true, "mergeCommit": {"oid": "eea4133892e7d95ebe65b7ccc05ae29af4fef5cf"}, "closed": true, "closedAt": "2020-08-19T20:47:44Z", "author": {"login": "gino-m"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-7VFegH2gAyNDY4MTk1MzcxOjQ0NDQ4NzBlNjIzMDMxZWUwMDZkYTIyM2U2NTY5YWU0NzZkMGVjZTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAh5MBAFqTQ3MDkyNTY5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4444870e623031ee006da223e6569ae476d0ece5", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/4444870e623031ee006da223e6569ae476d0ece5", "committedDate": "2020-08-14T21:16:49Z", "message": "Add `index` to form field elements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b29a3812e92f61bb051c35407c7f3b5df4f2f1e", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/7b29a3812e92f61bb051c35407c7f3b5df4f2f1e", "committedDate": "2020-08-14T21:41:15Z", "message": "Sort form elements by index in UIs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75ad60c373d7704a7aac0798450e1eda356c4918", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/75ad60c373d7704a7aac0798450e1eda356c4918", "committedDate": "2020-08-14T21:41:33Z", "message": "Merge branch 'master' of https://github.com/google/ground-android into fix-field-order"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edd0d8154c25897c2d9c404265421bb1ff62d787", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/edd0d8154c25897c2d9c404265421bb1ff62d787", "committedDate": "2020-08-15T10:07:26Z", "message": "Merge branch 'master' into fix-field-order"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3OTYyNjg3", "url": "https://github.com/google/ground-android/pull/565#pullrequestreview-467962687", "createdAt": "2020-08-15T10:17:17Z", "commit": {"oid": "edd0d8154c25897c2d9c404265421bb1ff62d787"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNVQxMDoxNzoxN1rOHBJRiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNVQxMDoyNjozOVrOHBJUUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk2MjU2OQ==", "bodyText": "How about getElementsSorted() --> getSortedElements()?", "url": "https://github.com/google/ground-android/pull/565#discussion_r470962569", "createdAt": "2020-08-15T10:17:17Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/src/main/java/com/google/android/gnd/model/form/Form.java", "diffHunk": "@@ -35,6 +37,12 @@\n \n   public abstract ImmutableList<Element> getElements();\n \n+  public ImmutableList<Element> getElementsSorted() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "edd0d8154c25897c2d9c404265421bb1ff62d787"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk2Mjc3Ng==", "bodyText": "Can we please make this @NonNull? It would remove the extra complexity of having to deal with all fallbacks", "url": "https://github.com/google/ground-android/pull/565#discussion_r470962776", "createdAt": "2020-08-15T10:20:05Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/src/main/java/com/google/android/gnd/persistence/local/room/entity/FieldEntity.java", "diffHunk": "@@ -52,6 +52,11 @@\n   @ColumnInfo(name = \"id\")\n   public abstract String getId();\n \n+  @CopyAnnotations\n+  @Nullable\n+  @ColumnInfo(name = \"index\")\n+  public abstract Integer getIndex();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "edd0d8154c25897c2d9c404265421bb1ff62d787"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk2MzI4MA==", "bodyText": "What if we make index a required field? If the online form generator always adds an index then there would be no need to take care of adding this attribute manually. Wdyt?", "url": "https://github.com/google/ground-android/pull/565#discussion_r470963280", "createdAt": "2020-08-15T10:26:39Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/src/main/java/com/google/android/gnd/model/form/Element.java", "diffHunk": "@@ -30,6 +31,21 @@\n     FIELD\n   }\n \n+  public int getIndex() {\n+    switch (getType()) {\n+      case FIELD:\n+        // Fall back to hash code id on missing index; the order won't necessarily be correct\n+        // but at least it will be stable.\n+        return Optional.ofNullable(getField().getIndex())\n+            .orElseGet(() -> getField().getId().hashCode());\n+      case UNKNOWN:\n+        // Intentional fall-through.\n+      default:\n+        // Fall back for unknown / bad index.\n+        return hashCode();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "edd0d8154c25897c2d9c404265421bb1ff62d787"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21fdeb73356333852d956d5e837fb432224fb919", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/21fdeb73356333852d956d5e837fb432224fb919", "committedDate": "2020-08-18T16:35:42Z", "message": "Make field index in local db required / non-null"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eff2520c74fd4db0ac66837d5479965f1b9c40ef", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/eff2520c74fd4db0ac66837d5479965f1b9c40ef", "committedDate": "2020-08-18T17:16:37Z", "message": "Make field index required in model"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd905a23d86e6234cd599390aa69744dfaec1c1b", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/bd905a23d86e6234cd599390aa69744dfaec1c1b", "committedDate": "2020-08-18T17:16:45Z", "message": "Merge remote-tracking branch 'origin/fix-field-order' into fix-field-order"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5NzE0Mzg1", "url": "https://github.com/google/ground-android/pull/565#pullrequestreview-469714385", "createdAt": "2020-08-18T18:23:15Z", "commit": {"oid": "bd905a23d86e6234cd599390aa69744dfaec1c1b"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46f3236c7518a035afb498334927a6c4f5282aed", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/46f3236c7518a035afb498334927a6c4f5282aed", "committedDate": "2020-08-19T15:14:09Z", "message": "Merge branch 'master' into fix-field-order"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5358f57369c026d92e36eca11658366460be82c", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/a5358f57369c026d92e36eca11658366460be82c", "committedDate": "2020-08-19T15:28:16Z", "message": "Remove unused import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a512bf4cd994670d0d8bb5e116c4384e5b67d71", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/9a512bf4cd994670d0d8bb5e116c4384e5b67d71", "committedDate": "2020-08-19T15:37:20Z", "message": "Merge remote-tracking branch 'origin/fix-field-order' into fix-field-order"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49e854384b015d19cd1d6f40c2afa8ac32312397", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/49e854384b015d19cd1d6f40c2afa8ac32312397", "committedDate": "2020-08-19T19:46:40Z", "message": "Add comment to getIndex()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b78793bf045446f96c030032ab30bb1b8fbe3fb1", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/b78793bf045446f96c030032ab30bb1b8fbe3fb1", "committedDate": "2020-08-19T20:18:07Z", "message": "Fix missing index field in test Field object"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwOTI1Njk4", "url": "https://github.com/google/ground-android/pull/565#pullrequestreview-470925698", "createdAt": "2020-08-19T20:46:34Z", "commit": {"oid": "b78793bf045446f96c030032ab30bb1b8fbe3fb1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1604, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}