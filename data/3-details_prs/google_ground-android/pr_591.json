{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA0NjI1MDc1", "number": 591, "title": "[Code cleanup] Refactor HomeScreenViewModel", "bodyText": "Replace disposeOnClear with LiveData for add feature requests\nExpose handler to fragment for UI interactions\nAdd tests for FeatureRepository\n\n@gino-m  PTAL", "createdAt": "2020-10-16T06:39:30Z", "url": "https://github.com/google/ground-android/pull/591", "merged": true, "mergeCommit": {"oid": "e9c8289dcaf86036ceeabfc6afd2782531381e07"}, "closed": true, "closedAt": "2020-11-05T17:13:12Z", "author": {"login": "shobhitagarwal1612"}, "timelineItems": {"totalCount": 39, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdTArCIABqjM4ODQ4MzA4NDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZjVe2gFqTUyNDMyMjIyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a306b5fc59b7d4f7541c20a7820503ba7e0d810b", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/a306b5fc59b7d4f7541c20a7820503ba7e0d810b", "committedDate": "2020-10-16T06:40:45Z", "message": "Remove fixed TODO"}, "afterCommit": {"oid": "f8ca2f2f7358b27f46ade30ad57a19f62690715d", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/f8ca2f2f7358b27f46ade30ad57a19f62690715d", "committedDate": "2020-10-16T06:48:38Z", "message": "Remove TODO"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMzU0NTAx", "url": "https://github.com/google/ground-android/pull/591#pullrequestreview-511354501", "createdAt": "2020-10-19T00:42:43Z", "commit": {"oid": "f8ca2f2f7358b27f46ade30ad57a19f62690715d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwMDo0Mjo0M1rOHjymwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwMDo0Mjo1NlrOHjynng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzI5MTMyOQ==", "bodyText": "A more specific error message would be helpful here, but broader question - why would we ever call this with Optional.empty() in the first place?", "url": "https://github.com/google/ground-android/pull/591#discussion_r507291329", "createdAt": "2020-10-19T00:42:43Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/home/HomeScreenFragment.java", "diffHunk": "@@ -121,6 +123,15 @@ public void onCreate(@Nullable Bundle savedInstanceState) {\n     projectSelectorViewModel = getViewModel(ProjectSelectorViewModel.class);\n   }\n \n+  private void onFeatureAdded(Optional<Feature> feature) {\n+    feature.ifPresentOrElse(\n+        viewModel::onAddFeature,\n+        () -> {\n+          // TODO: Show an error message to the user.\n+          Timber.e(\"Couldn't add feature.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f8ca2f2f7358b27f46ade30ad57a19f62690715d"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzI5MTU1MA==", "bodyText": "Same question here.", "url": "https://github.com/google/ground-android/pull/591#discussion_r507291550", "createdAt": "2020-10-19T00:42:56Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/home/HomeScreenViewModel.java", "diffHunk": "@@ -50,46 +47,41 @@\n   /** The state and value of the currently active project (loading, loaded, etc.). */\n   private final LiveData<Loadable<Project>> activeProject;\n \n-  private final PublishSubject<Feature> addFeatureClicks;\n   // TODO: Move into MapContainersViewModel\n   private final MutableLiveData<Event<Point>> addFeatureDialogRequests;\n   // TODO: Move into FeatureDetailsViewModel.\n   private final MutableLiveData<Action> openDrawerRequests;\n   private final MutableLiveData<BottomSheetState> bottomSheetState;\n \n+  private final FlowableProcessor<Feature> addFeatureClicks = PublishProcessor.create();\n+  private final FlowableProcessor<Feature> updateFeatureRequests = PublishProcessor.create();\n   private final FlowableProcessor<Feature> deleteFeatureRequests = PublishProcessor.create();\n-  private final LiveData<Boolean> deleteFeature;\n \n-  private final FlowableProcessor<Feature> updateFeatureRequests = PublishProcessor.create();\n+  private final LiveData<Optional<Feature>> addFeature;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f8ca2f2f7358b27f46ade30ad57a19f62690715d"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e5981c21068992ecd07a25be1de089db87de02e", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/7e5981c21068992ecd07a25be1de089db87de02e", "committedDate": "2020-10-19T05:03:37Z", "message": "Replace disposeOnClear with LiveData for add feature requests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f91b9b8a9afd40d7368b20a8c0fe6569a7dc962", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/2f91b9b8a9afd40d7368b20a8c0fe6569a7dc962", "committedDate": "2020-10-19T05:03:37Z", "message": "Remove schedulers dependency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1819f8084efe80a1f732243f00debf23f9265f4f", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/1819f8084efe80a1f732243f00debf23f9265f4f", "committedDate": "2020-10-19T05:03:37Z", "message": "Remove TODO"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d364bf3b5f71ce09a5e66a633b766d0e151dd56f", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/d364bf3b5f71ce09a5e66a633b766d0e151dd56f", "committedDate": "2020-10-19T05:47:47Z", "message": "Log errors to timber"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e23338ca01b3ec2d2b8d413fee1829828f43de1", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/6e23338ca01b3ec2d2b8d413fee1829828f43de1", "committedDate": "2020-10-19T05:49:26Z", "message": "Return Flowable instead of Completable from FeatureRepository\n\n * This allows us to update the UI according to current state"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93f878cd43d3ab35bb7038ac42d8ca866bdb429f", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/93f878cd43d3ab35bb7038ac42d8ca866bdb429f", "committedDate": "2020-10-19T05:50:20Z", "message": "Simplify HomeScreenViewModel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "474cc65d43b3efddebac5f2fce7ead1b4ebcb11f", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/474cc65d43b3efddebac5f2fce7ead1b4ebcb11f", "committedDate": "2020-10-19T05:50:59Z", "message": "Update View and show error message to the user"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6316ee2bae746d95fed442fdf26c4f9df7221a6", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/a6316ee2bae746d95fed442fdf26c4f9df7221a6", "committedDate": "2020-10-19T06:01:27Z", "message": "Add method doc for apply and enqueue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "672417a01365f5dc620f4e40e302e77a3a10aa17", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/672417a01365f5dc620f4e40e302e77a3a10aa17", "committedDate": "2020-10-19T06:23:30Z", "message": "Add test class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "743c48d233b444dc87109df2fb47d49ba144d3d5", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/743c48d233b444dc87109df2fb47d49ba144d3d5", "committedDate": "2020-10-19T07:18:42Z", "message": "Add mockito-core gradle dependency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "113bca3a110bfb62216ac1b1450d7c6d797c2d2c", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/113bca3a110bfb62216ac1b1450d7c6d797c2d2c", "committedDate": "2020-10-19T08:17:07Z", "message": "Reorder lines in Loadable and ValueOrError"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9ce1d525f451c822f57a80f94da80b9c48cb965", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/a9ce1d525f451c822f57a80f94da80b9c48cb965", "committedDate": "2020-10-19T08:18:37Z", "message": "Override comparators for Loadable and ValueOrError\n\n * This is needed for comparing output of tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2858d69f6017da46bc84badcb5c37d89e0b34ef", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/f2858d69f6017da46bc84badcb5c37d89e0b34ef", "committedDate": "2020-10-19T09:32:23Z", "message": "Add tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d55e71907466ecbe585cf6a7dc54a498c0c6d1ef", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/d55e71907466ecbe585cf6a7dc54a498c0c6d1ef", "committedDate": "2020-10-19T05:02:39Z", "message": "Merge branch 'master' into cleanup2"}, "afterCommit": {"oid": "f2858d69f6017da46bc84badcb5c37d89e0b34ef", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/f2858d69f6017da46bc84badcb5c37d89e0b34ef", "committedDate": "2020-10-19T09:32:23Z", "message": "Add tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "266cd5dd970ed82f9a6d49a4d5ba951c5205477f", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/266cd5dd970ed82f9a6d49a4d5ba951c5205477f", "committedDate": "2020-10-19T09:39:34Z", "message": "Add handler for default cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82a09e2aa3b8095bd5badffd41bf2e401041cf2f", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/82a09e2aa3b8095bd5badffd41bf2e401041cf2f", "committedDate": "2020-10-19T20:28:58Z", "message": "Merge branch 'master' into cleanup2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb45ae340735dd7d849cbdc5605f0e535b6ba6ee", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/cb45ae340735dd7d849cbdc5605f0e535b6ba6ee", "committedDate": "2020-10-19T20:34:13Z", "message": "Remove unused InstantTaskExecutorRule"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5NTA0OTE2", "url": "https://github.com/google/ground-android/pull/591#pullrequestreview-519504916", "createdAt": "2020-10-29T10:02:32Z", "commit": {"oid": "cb45ae340735dd7d849cbdc5605f0e535b6ba6ee"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMDowMjozM1rOHqUiVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMDowNTo0NFrOHqUqHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDEzODcxMQ==", "bodyText": "I've experimented with pushing the Flowable<Loadable<>> down in the stack like this in the past, and while it simplifies usage, it also complicates the semantics of the internal API; these methods no longer simply do work and then either complete or return an error, but rather they stream status. This is slightly harder for clients of these methods to understand, and is really only introduced here because of how the UI streams emit state. It also is questionable whether this simplifies the code, since the transformation to a Flowable still has to happen somewhere.\nCan we wrap the state higher up in the stack instead, as close to the subscription as possible?\nAlso note that Loadable is modeled around the action of something being loaded from the database, not creating, updating, and deleting.", "url": "https://github.com/google/ground-android/pull/591#discussion_r514138711", "createdAt": "2020-10-29T10:02:33Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/repository/FeatureRepository.java", "diffHunk": "@@ -127,21 +127,33 @@ private FeatureMutation fromFeature(Feature feature, Type type) {\n   }\n \n   // TODO(#80): Update UI to provide FeatureMutations instead of Features here.\n-  public Completable createFeature(Feature feature) {\n-    return applyAndEnqueue(fromFeature(feature, Type.CREATE));\n+  public Flowable<Loadable<Feature>> createFeature(Feature feature) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb45ae340735dd7d849cbdc5605f0e535b6ba6ee"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDEzOTE3Mw==", "bodyText": "This is a transformation method that will return a new instance. It's assumed that the error in the Loadable will be handled somewhere, so printing the error to the log here will result in duplicate outputs in the log.", "url": "https://github.com/google/ground-android/pull/591#discussion_r514139173", "createdAt": "2020-10-29T10:03:20Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/rx/Loadable.java", "diffHunk": "@@ -58,17 +52,10 @@ private Loadable(LoadState state, @Nullable T data, Throwable error) {\n   }\n \n   public static <T> Loadable<T> error(Throwable t) {\n+    Timber.e(t);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb45ae340735dd7d849cbdc5605f0e535b6ba6ee"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDEzOTcyNg==", "bodyText": "In the future, please reorder method in a separate PR if possible, since mixing actual changes with reorders makes it hard to tell what was changed vs moved.", "url": "https://github.com/google/ground-android/pull/591#discussion_r514139726", "createdAt": "2020-10-29T10:04:12Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/rx/Loadable.java", "diffHunk": "@@ -98,6 +85,15 @@ public boolean isLoaded() {\n         .startWith(Loadable.loading());\n   }\n \n+  public LoadState getState() {\n+    return state;\n+  }\n+\n+  public boolean isLoaded() {\n+    return state == LoadState.LOADED;\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb45ae340735dd7d849cbdc5605f0e535b6ba6ee"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE0MDYyOA==", "bodyText": "What are equals() and hasCode() ever used? If not, please remove.", "url": "https://github.com/google/ground-android/pull/591#discussion_r514140628", "createdAt": "2020-10-29T10:05:37Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/rx/Loadable.java", "diffHunk": "@@ -106,4 +102,29 @@ public String toString() {\n       return state.toString();\n     }\n   }\n+\n+  @Override\n+  public boolean equals(Object o) {\n+    if (this == o) {\n+      return true;\n+    }\n+    if (!(o instanceof Loadable)) {\n+      return false;\n+    }\n+    Loadable<?> loadable = (Loadable<?>) o;\n+    return getState() == loadable.getState();\n+  }\n+\n+  @Override\n+  public int hashCode() {\n+    return Objects.hash(getState());\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb45ae340735dd7d849cbdc5605f0e535b6ba6ee"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE0MDcwMg==", "bodyText": "What are equals() and hasCode() ever used? If not, please remove.", "url": "https://github.com/google/ground-android/pull/591#discussion_r514140702", "createdAt": "2020-10-29T10:05:44Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/rx/ValueOrError.java", "diffHunk": "@@ -72,4 +62,38 @@ public String toString() {\n   public static <T> Observable<T> ignoreErrors(Observable<ValueOrError<T>> observable) {\n     return observable.filter(voe -> voe.value().isPresent()).map(voe -> voe.value().get());\n   }\n+\n+  public Optional<T> value() {\n+    return Optional.ofNullable(value);\n+  }\n+\n+  public Optional<Throwable> error() {\n+    if (error != null) {\n+      Timber.e(error);\n+    }\n+    return Optional.ofNullable(error);\n+  }\n+\n+  @NonNull\n+  @Override\n+  public String toString() {\n+    return error().map(t -> \"Error: \" + t).orElse(\"Value: \" + value);\n+  }\n+\n+  @Override\n+  public boolean equals(Object o) {\n+    if (this == o) {\n+      return true;\n+    }\n+    if (!(o instanceof ValueOrError)) {\n+      return false;\n+    }\n+    ValueOrError<?> that = (ValueOrError<?>) o;\n+    return Objects.equals(value, that.value) && Objects.equals(error, that.error);\n+  }\n+\n+  @Override\n+  public int hashCode() {\n+    return Objects.hash(value, error);\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb45ae340735dd7d849cbdc5605f0e535b6ba6ee"}, "originalPosition": 71}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6d8b4cbe0ff56c337b09b42bbbab05d401f11a7", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/a6d8b4cbe0ff56c337b09b42bbbab05d401f11a7", "committedDate": "2020-10-29T13:51:10Z", "message": "Merge branch 'master' into cleanup2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "afcbe614e70ce87dcfdba4984cf3e23358963025", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/afcbe614e70ce87dcfdba4984cf3e23358963025", "committedDate": "2020-10-29T13:51:51Z", "message": "Remove timber call"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2167258b210a01cacfd66a614c0e419e734598c7", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/2167258b210a01cacfd66a614c0e419e734598c7", "committedDate": "2020-11-01T08:48:11Z", "message": "Merge branch 'master' into cleanup2\n\n# Conflicts:\n#\tgnd/src/main/java/com/google/android/gnd/ui/home/HomeScreenViewModel.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42676c27da166670bec81a0a46c00e2ada1d0111", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/42676c27da166670bec81a0a46c00e2ada1d0111", "committedDate": "2020-11-01T17:01:04Z", "message": "Add helper method to convert Completable to Single<Boolean>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e5b2897363b992ddebe92013332309714950006", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/5e5b2897363b992ddebe92013332309714950006", "committedDate": "2020-11-01T17:01:49Z", "message": "Revert FeatureRepository to return Completable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c219b3aed75f73100c1ec9234a47615477b63e9", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/6c219b3aed75f73100c1ec9234a47615477b63e9", "committedDate": "2020-11-01T17:05:14Z", "message": "Refactor HomeScreen\n\n * Remove loadable for state and use a separate LiveData for emitting errors\n * Move navigator for addNewObservation to fragment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06a7b04877b8b345c0eb8964b77881fefe15d071", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/06a7b04877b8b345c0eb8964b77881fefe15d071", "committedDate": "2020-11-01T17:10:09Z", "message": "Update unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0c3febd5ae1ce7a917bfb6d1930cb2b3e843d66", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/b0c3febd5ae1ce7a917bfb6d1930cb2b3e843d66", "committedDate": "2020-11-01T17:12:40Z", "message": "Revert changes to Loadable & ValueOrError"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22e38338fb2cda43e9cd64f74ffed87f63fda8d0", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/22e38338fb2cda43e9cd64f74ffed87f63fda8d0", "committedDate": "2020-11-01T17:17:55Z", "message": "Pass along throwable instead of parsing error message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "520aded3695cb8b08564063afa93d949eb26571a", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/520aded3695cb8b08564063afa93d949eb26571a", "committedDate": "2020-11-01T17:23:33Z", "message": "Remove javadoc (causes checkstyle error)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMjU1Mzgy", "url": "https://github.com/google/ground-android/pull/591#pullrequestreview-521255382", "createdAt": "2020-11-01T19:54:16Z", "commit": {"oid": "520aded3695cb8b08564063afa93d949eb26571a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQxOTo1NDoxNlrOHrxpxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQxOTo1NDoxNlrOHrxpxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY2NDMyNA==", "bodyText": "This method is actually doing a lot more than just converting the Completable to a Single; it's returning whether the Single completed successfully, and is causing a side effect on the provided Consumer. I'd suggest a few improvements to make this clearer:\n\nGive the method a more explicit name, like toBooleanSingle() to indicate this is doing something special.\nCall the callback param for when it's actually invoked (onError).\nIf this is every called with null exceptionConsumer (I didn't see it on a quick scan), create a separate override of this method without the Consumer (i.e. toBooleanSingle(Completable) and toBooleanSingle(Completable, onErro).\nAdd minimal Javadoc explaining these semantics (esp. since the method is public.", "url": "https://github.com/google/ground-android/pull/591#discussion_r515664324", "createdAt": "2020-11-01T19:54:16Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/rx/RxCompletable.java", "diffHunk": "@@ -45,4 +49,17 @@ public static Completable completeOrError(\n           }\n         });\n   }\n+\n+  public static Single<Boolean> toSingle(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "520aded3695cb8b08564063afa93d949eb26571a"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMjU1NTQw", "url": "https://github.com/google/ground-android/pull/591#pullrequestreview-521255540", "createdAt": "2020-11-01T19:56:30Z", "commit": {"oid": "520aded3695cb8b08564063afa93d949eb26571a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQxOTo1NjozMFrOHrxq0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQxOTo1NjozMFrOHrxq0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY2NDU5Mw==", "bodyText": "This Javadoc isn't needed since the code is self-explanatory, and the method is internal/private.", "url": "https://github.com/google/ground-android/pull/591#discussion_r515664593", "createdAt": "2020-11-01T19:56:30Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/home/HomeScreenFragment.java", "diffHunk": "@@ -121,22 +124,37 @@ public void onCreate(@Nullable Bundle savedInstanceState) {\n     projectSelectorViewModel = getViewModel(ProjectSelectorViewModel.class);\n   }\n \n+  private void onFeatureAdded(Feature feature) {\n+    feature.getLayer().getForm().ifPresent(formId -> addNewObservation(feature));\n+  }\n+\n+  private void addNewObservation(Feature feature) {\n+    String projectId = feature.getProject().getId();\n+    String featureId = feature.getId();\n+    String formId = feature.getLayer().getForm().get().getId();\n+    navigator.addObservation(projectId, featureId, formId);\n+  }\n+\n+  /** This is only possible after updating the location of the feature. So, reset the UI. */\n   private void onFeatureUpdated(Boolean result) {\n     if (result) {\n-      Toast.makeText(getContext(), \"Done\", Toast.LENGTH_SHORT).show();\n       mapContainerFragment.setDefaultMode();\n-    } else {\n-      Timber.e(\"Failed to update feature\");\n     }\n   }\n \n+  /** Hide the bottom sheet as deleting a feature also removes child observations. */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "520aded3695cb8b08564063afa93d949eb26571a"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMjU1NjMy", "url": "https://github.com/google/ground-android/pull/591#pullrequestreview-521255632", "createdAt": "2020-11-01T19:57:49Z", "commit": {"oid": "520aded3695cb8b08564063afa93d949eb26571a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQxOTo1Nzo0OVrOHrxrWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQxOTo1ODo0MlrOHrxroQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY2NDczMQ==", "bodyText": "I would avoid showing the specific exception message to the user, since a) we don't have control over what is show, and b) we'll probably need to whole stack track to diagnose the problem anyway. Also, better to have a fixed message that can be translated if necessary.", "url": "https://github.com/google/ground-android/pull/591#discussion_r515664731", "createdAt": "2020-11-01T19:57:49Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/home/HomeScreenFragment.java", "diffHunk": "@@ -121,22 +124,37 @@ public void onCreate(@Nullable Bundle savedInstanceState) {\n     projectSelectorViewModel = getViewModel(ProjectSelectorViewModel.class);\n   }\n \n+  private void onFeatureAdded(Feature feature) {\n+    feature.getLayer().getForm().ifPresent(formId -> addNewObservation(feature));\n+  }\n+\n+  private void addNewObservation(Feature feature) {\n+    String projectId = feature.getProject().getId();\n+    String featureId = feature.getId();\n+    String formId = feature.getLayer().getForm().get().getId();\n+    navigator.addObservation(projectId, featureId, formId);\n+  }\n+\n+  /** This is only possible after updating the location of the feature. So, reset the UI. */\n   private void onFeatureUpdated(Boolean result) {\n     if (result) {\n-      Toast.makeText(getContext(), \"Done\", Toast.LENGTH_SHORT).show();\n       mapContainerFragment.setDefaultMode();\n-    } else {\n-      Timber.e(\"Failed to update feature\");\n     }\n   }\n \n+  /** Hide the bottom sheet as deleting a feature also removes child observations. */\n   private void onFeatureDeleted(Boolean result) {\n     if (result) {\n       // TODO: Re-position map to default location after successful deletion.\n       hideBottomSheet();\n     }\n   }\n \n+  /** Generic handler to display error messages to the user. */\n+  private void onError(Throwable throwable) {\n+    Toast.makeText(getContext(), \"Error: \" + throwable.getMessage(), Toast.LENGTH_SHORT).show();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "520aded3695cb8b08564063afa93d949eb26571a"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY2NDgwMQ==", "bodyText": "Can we add a suffix to the names of these LiveData so that it's clearer when emit values? Also, we've been following the convention that streams that can emit more than one value are named in plural (e.g.  addFeatureResults).", "url": "https://github.com/google/ground-android/pull/591#discussion_r515664801", "createdAt": "2020-11-01T19:58:42Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/home/HomeScreenViewModel.java", "diffHunk": "@@ -53,74 +52,63 @@\n   /** The state and value of the currently active project (loading, loaded, etc.). */\n   private final LiveData<Loadable<Project>> activeProject;\n \n-  private final PublishSubject<Feature> addFeatureClicks;\n   // TODO: Move into MapContainersViewModel\n   private final MutableLiveData<Event<Point>> addFeatureDialogRequests;\n   // TODO: Move into FeatureDetailsViewModel.\n   private final MutableLiveData<Action> openDrawerRequests;\n   private final MutableLiveData<BottomSheetState> bottomSheetState;\n \n+  private final FlowableProcessor<Feature> addFeatureClicks = PublishProcessor.create();\n+  private final FlowableProcessor<Feature> updateFeatureRequests = PublishProcessor.create();\n   private final FlowableProcessor<Feature> deleteFeatureRequests = PublishProcessor.create();\n-  private final LiveData<Boolean> deleteFeature;\n \n-  private final FlowableProcessor<Feature> updateFeatureRequests = PublishProcessor.create();\n+  private final LiveData<Feature> addFeature;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "520aded3695cb8b08564063afa93d949eb26571a"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73f9fd2fa267e73670292f4c78d49fb27e8f32f7", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/73f9fd2fa267e73670292f4c78d49fb27e8f32f7", "committedDate": "2020-11-03T06:47:17Z", "message": "Merge branch 'master' into cleanup2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5fbea2cdb17f8adacf87bd0c93dafc501a2d4f63", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/5fbea2cdb17f8adacf87bd0c93dafc501a2d4f63", "committedDate": "2020-11-03T06:51:03Z", "message": "Log exception to timber and show static error message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd48dbc5f4de61201c5fafcd728dddb90f27e783", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/fd48dbc5f4de61201c5fafcd728dddb90f27e783", "committedDate": "2020-11-03T06:56:18Z", "message": "Improve variable names to follow the convention"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4335b5cf52dc81a50ce5d32a83b605a5d913f83b", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/4335b5cf52dc81a50ce5d32a83b605a5d913f83b", "committedDate": "2020-11-03T07:20:17Z", "message": "Rename toSingle to toBooleanSingle, override it for nullable consumers and add javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f63ab61d874356abaf923ee3d67ba3f3f184759a", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/f63ab61d874356abaf923ee3d67ba3f3f184759a", "committedDate": "2020-11-03T15:47:01Z", "message": "Merge branch 'master' into cleanup2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MzIyMjI1", "url": "https://github.com/google/ground-android/pull/591#pullrequestreview-524322225", "createdAt": "2020-11-05T14:35:29Z", "commit": {"oid": "f63ab61d874356abaf923ee3d67ba3f3f184759a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1631, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}