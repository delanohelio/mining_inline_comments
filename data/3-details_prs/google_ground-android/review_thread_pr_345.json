{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxNDE2MDc3", "number": 345, "reviewThreads": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMjowOToyMFrODdf8yQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxNjo1MTozOVrODeh1Jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyMjU4NzYxOnYy", "diffSide": "RIGHT", "path": "gnd/build.gradle", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMjowOToyMFrOFmI6mA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMjowOToyMFrOFmI6mA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTUzNjI4MA==", "bodyText": "Please explain what Picasso is and what it's used for.", "url": "https://github.com/google/ground-android/pull/345#discussion_r375536280", "createdAt": "2020-02-05T22:09:20Z", "author": {"login": "gino-m"}, "path": "gnd/build.gradle", "diffHunk": "@@ -176,6 +176,9 @@ dependencies {\n     // Guava\n     implementation \"com.google.guava:guava:$project.guavaVersion\"\n \n+    // Picasso", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7560afd16655ed6d5daa8e9c5bc0c58a40d54080"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyMjU5MTEyOnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/persistence/remote/FirestoreStorageManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMjoxMDo0M1rOFmI8xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMjoxMDo0M1rOFmI8xw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTUzNjgzOQ==", "bodyText": "Can we instead inject FirebaseStorage or StorageReference to make it mockable in tests?", "url": "https://github.com/google/ground-android/pull/345#discussion_r375536839", "createdAt": "2020-02-05T22:10:43Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/persistence/remote/FirestoreStorageManager.java", "diffHunk": "@@ -39,20 +35,18 @@\n \n   private static final String TAG = FirestoreStorageManager.class.getName();\n   private static final String MEDIA_ROOT_DIR = \"uploaded_media\";\n-  private final SimpleDateFormat dateFormat =\n-      new SimpleDateFormat(\"yyyyMMddHHmmss\", Locale.getDefault());\n \n   @Inject\n   FirestoreStorageManager() {}\n \n   /** Returns a reference to the default Storage bucket. */\n-  private FirebaseStorage getStorage() {\n-    return FirebaseStorage.getInstance();\n+  private StorageReference getBaseReference() {\n+    return FirebaseStorage.getInstance().getReference();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7560afd16655ed6d5daa8e9c5bc0c58a40d54080"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyMjU5Nzc2OnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/persistence/remote/FirestoreStorageManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMjoxMzoyNlrOFmJBCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOFQwNTo0Mjo0MVrOFnPUOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTUzNzkyOQ==", "bodyText": "Please use the util class RxTask.toMaybe() instead.", "url": "https://github.com/google/ground-android/pull/345#discussion_r375537929", "createdAt": "2020-02-05T22:13:26Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/persistence/remote/FirestoreStorageManager.java", "diffHunk": "@@ -61,34 +55,27 @@ private StorageReference getRootMediaDir() {\n    * @param fileName Name of the uploaded media\n    */\n   private StorageReference createReference(String fileName) {\n-    return getRootMediaDir().child(fileName + '-' + getFilenameSuffix());\n+    return getRootMediaDir().child(fileName);\n   }\n \n-  /** Converts current timestamp to a string to be used a suffix for uploading media. */\n-  private String getFilenameSuffix() {\n-    return dateFormat.format(new Date());\n+  public Maybe<Uri> getDownloadUrl(String path) {\n+    return Maybe.create(\n+        emitter ->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7560afd16655ed6d5daa8e9c5bc0c58a40d54080"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjY4OTcyMQ==", "bodyText": "This can't be used here as the Uri is fetched asynchronously.", "url": "https://github.com/google/ground-android/pull/345#discussion_r376689721", "createdAt": "2020-02-08T05:42:41Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/src/main/java/com/google/android/gnd/persistence/remote/FirestoreStorageManager.java", "diffHunk": "@@ -61,34 +55,27 @@ private StorageReference getRootMediaDir() {\n    * @param fileName Name of the uploaded media\n    */\n   private StorageReference createReference(String fileName) {\n-    return getRootMediaDir().child(fileName + '-' + getFilenameSuffix());\n+    return getRootMediaDir().child(fileName);\n   }\n \n-  /** Converts current timestamp to a string to be used a suffix for uploading media. */\n-  private String getFilenameSuffix() {\n-    return dateFormat.format(new Date());\n+  public Maybe<Uri> getDownloadUrl(String path) {\n+    return Maybe.create(\n+        emitter ->", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTUzNzkyOQ=="}, "originalCommit": {"oid": "7560afd16655ed6d5daa8e9c5bc0c58a40d54080"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyMjU5OTQ0OnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/persistence/remote/FirestoreStorageManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMjoxNDowNVrOFmJCEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMjoxNDowNVrOFmJCEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTUzODE5Mg==", "bodyText": "What's the difference between file and fileName? Please rename to something self explanatory and/or explain in JavaDoc.", "url": "https://github.com/google/ground-android/pull/345#discussion_r375538192", "createdAt": "2020-02-05T22:14:05Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/persistence/remote/FirestoreStorageManager.java", "diffHunk": "@@ -61,34 +55,27 @@ private StorageReference getRootMediaDir() {\n    * @param fileName Name of the uploaded media\n    */\n   private StorageReference createReference(String fileName) {\n-    return getRootMediaDir().child(fileName + '-' + getFilenameSuffix());\n+    return getRootMediaDir().child(fileName);\n   }\n \n-  /** Converts current timestamp to a string to be used a suffix for uploading media. */\n-  private String getFilenameSuffix() {\n-    return dateFormat.format(new Date());\n+  public Maybe<Uri> getDownloadUrl(String path) {\n+    return Maybe.create(\n+        emitter ->\n+            getBaseReference()\n+                .child(path)\n+                .getDownloadUrl()\n+                .addOnSuccessListener(emitter::onSuccess)\n+                .addOnFailureListener(emitter::onError));\n   }\n \n   /** Upload file to Firebase Storage. */\n-  public void uploadMediaFromFile(File file, String fileName) {\n+  public String uploadMediaFromFile(File file, String fileName) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7560afd16655ed6d5daa8e9c5bc0c58a40d54080"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyMjYwMjAzOnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationFragment.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMjoxNToxMVrOFmJDvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMjoxNToxMVrOFmJDvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTUzODYyMQ==", "bodyText": "Please add JavaDoc describing this method's behavior.", "url": "https://github.com/google/ground-android/pull/345#discussion_r375538621", "createdAt": "2020-02-05T22:15:11Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationFragment.java", "diffHunk": "@@ -199,12 +201,25 @@ public void onMapChanged(ObservableMap<String, Response> sender, String key) {\n   }\n \n   private void updateBitmap(ImageView imageView, String path) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7560afd16655ed6d5daa8e9c5bc0c58a40d54080"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyMjYwNjYyOnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationViewModel.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMjoxNjo1NlrOFmJGfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMjoxNjo1NlrOFmJGfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTUzOTMyNQ==", "bodyText": "Do I understand correctly that we're currently relying on Firebase to manage offline support?\nIf so, can we add a TODO and a bug to implement our own offline photos functionality using Android Workers and the local db?", "url": "https://github.com/google/ground-android/pull/345#discussion_r375539325", "createdAt": "2020-02-05T22:16:56Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationViewModel.java", "diffHunk": "@@ -238,10 +251,31 @@ private Completable handlePhotoCaptureResult(String fieldId) {\n         .ignoreElements();\n   }\n \n-  private Observable<File> saveBitmapAndUpdateResponse(Observable<Bitmap> source, String fieldId) {\n+  private Observable<String> saveBitmapAndUpdateResponse(\n+      Observable<Bitmap> source, String fieldId) {\n     return source\n         .map(bitmap -> fileUtil.saveBitmap(bitmap, fieldId + \".jpg\"))\n-        .doOnNext(file -> onTextChanged(form.getValue().getField(fieldId).get(), file.getPath()));\n+        .map(\n+            file -> {\n+              // If offline, Firebase will automatically upload the image when the network\n+              // connectivity is  re-established.\n+              String remotePath = getRemoteImageDir() + file.getName();\n+              return firestoreStorageManager.uploadMediaFromFile(file, remotePath);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7560afd16655ed6d5daa8e9c5bc0c58a40d54080"}, "originalPosition": 83}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyMjYyMDkyOnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationViewModel.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMjoyMjozMlrOFmJPjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMjoyMjozMlrOFmJPjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU0MTY0Ng==", "bodyText": "Alternatively, you can recast  this as getRemoteImagePath(filename) and use:\nreturn String.join(File.separator, args.getProjectId(), args.getFormId(), filename);", "url": "https://github.com/google/ground-android/pull/345#discussion_r375541646", "createdAt": "2020-02-05T22:22:32Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationViewModel.java", "diffHunk": "@@ -238,10 +251,31 @@ private Completable handlePhotoCaptureResult(String fieldId) {\n         .ignoreElements();\n   }\n \n-  private Observable<File> saveBitmapAndUpdateResponse(Observable<Bitmap> source, String fieldId) {\n+  private Observable<String> saveBitmapAndUpdateResponse(\n+      Observable<Bitmap> source, String fieldId) {\n     return source\n         .map(bitmap -> fileUtil.saveBitmap(bitmap, fieldId + \".jpg\"))\n-        .doOnNext(file -> onTextChanged(form.getValue().getField(fieldId).get(), file.getPath()));\n+        .map(\n+            file -> {\n+              // If offline, Firebase will automatically upload the image when the network\n+              // connectivity is  re-established.\n+              String remotePath = getRemoteImageDir() + file.getName();\n+              return firestoreStorageManager.uploadMediaFromFile(file, remotePath);\n+            })\n+        .doOnNext(\n+            url -> {\n+              // update observable response map\n+              onTextChanged(form.getValue().getField(fieldId).get(), url);\n+            });\n+  }\n+\n+  private String getRemoteImageDir() {\n+    return args.getProjectId()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7560afd16655ed6d5daa8e9c5bc0c58a40d54080"}, "originalPosition": 93}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyMjYyNTUwOnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/ui/util/FileUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMjoyNDoyMVrOFmJSbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMjoyNDoyMVrOFmJSbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU0MjM4MA==", "bodyText": "=> getFile?", "url": "https://github.com/google/ground-android/pull/345#discussion_r375542380", "createdAt": "2020-02-05T22:24:21Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/util/FileUtil.java", "diffHunk": "@@ -52,14 +51,11 @@ public File saveBitmap(Bitmap bitmap, String filename) throws IOException {\n     return file;\n   }\n \n-  /** Load bitmap from a file path. */\n-  @Nullable\n-  public static Bitmap createBitmapFromPath(String path) {\n-    File file = new File(path);\n+  public File getFileFromFilename(String filename) throws FileNotFoundException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7560afd16655ed6d5daa8e9c5bc0c58a40d54080"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyMjYyODAyOnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationFragment.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMjoyNToxOFrOFmJT_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMjoyNToxOFrOFmJT_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU0Mjc4MQ==", "bodyText": "Refactor splitting filename into its own method, also for consistency with logic for building filename.", "url": "https://github.com/google/ground-android/pull/345#discussion_r375542781", "createdAt": "2020-02-05T22:25:18Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationFragment.java", "diffHunk": "@@ -199,12 +201,25 @@ public void onMapChanged(ObservableMap<String, Response> sender, String key) {\n   }\n \n   private void updateBitmap(ImageView imageView, String path) {\n-    Bitmap bitmap = FileUtil.createBitmapFromPath(path);\n-    if (bitmap != null) {\n-      // TODO: Bitmap doesn't get loaded\n-      imageView.setImageBitmap(bitmap);\n-      Toast.makeText(getContext(), \"Photo added\", Toast.LENGTH_SHORT).show();\n-    }\n+    // TODO: Image doesn't load into the imageview\n+    viewModel\n+        .getFirestoreDownloadUrl(path)\n+        .observeOn(AndroidSchedulers.mainThread())\n+        .doOnSuccess(\n+            uri -> {\n+              // Load the file from firestore storage\n+              Picasso.get().load(uri).into(imageView);\n+            })\n+        .doOnError(\n+            throwable -> {\n+              // Load file locally\n+              String[] splits = path.split(\"/\");\n+              Picasso.get()\n+                  .load(fileUtil.getFileFromFilename(splits[splits.length - 1]))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7560afd16655ed6d5daa8e9c5bc0c58a40d54080"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyMjYyODQ2OnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationFragment.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMjoyNToyNlrOFmJUNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMjoyNToyNlrOFmJUNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU0MjgzOQ==", "bodyText": "Replace \"/\" with File.separator.", "url": "https://github.com/google/ground-android/pull/345#discussion_r375542839", "createdAt": "2020-02-05T22:25:26Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationFragment.java", "diffHunk": "@@ -199,12 +201,25 @@ public void onMapChanged(ObservableMap<String, Response> sender, String key) {\n   }\n \n   private void updateBitmap(ImageView imageView, String path) {\n-    Bitmap bitmap = FileUtil.createBitmapFromPath(path);\n-    if (bitmap != null) {\n-      // TODO: Bitmap doesn't get loaded\n-      imageView.setImageBitmap(bitmap);\n-      Toast.makeText(getContext(), \"Photo added\", Toast.LENGTH_SHORT).show();\n-    }\n+    // TODO: Image doesn't load into the imageview\n+    viewModel\n+        .getFirestoreDownloadUrl(path)\n+        .observeOn(AndroidSchedulers.mainThread())\n+        .doOnSuccess(\n+            uri -> {\n+              // Load the file from firestore storage\n+              Picasso.get().load(uri).into(imageView);\n+            })\n+        .doOnError(\n+            throwable -> {\n+              // Load file locally\n+              String[] splits = path.split(\"/\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7560afd16655ed6d5daa8e9c5bc0c58a40d54080"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMzM2NTUxOnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/GndApplicationModule.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxNjo0ODowM1rOFntfIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxNjo0ODowM1rOFntfIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzE4NDAzMg==", "bodyText": "Firestore != Firebase Storage; please rename to something more appropriate, e.g. firebaseStorageReference.", "url": "https://github.com/google/ground-android/pull/345#discussion_r377184032", "createdAt": "2020-02-10T16:48:03Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/GndApplicationModule.java", "diffHunk": "@@ -120,6 +122,13 @@ static FirebaseFirestore firebaseFirestore(FirebaseFirestoreSettings settings) {\n     return firestore;\n   }\n \n+  /** Returns a reference to the default Storage bucket. */\n+  @Provides\n+  @Singleton\n+  static StorageReference baseFirestoreReference() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de1ae6f6e3912cf544fada530fd3509704df63b9"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMzM4MTUxOnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationViewModel.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxNjo1MTozOVrOFnto6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNzowNjoyMlrOFoRZpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzE4NjUzNw==", "bodyText": "Are we filtering by JPG?\nAlso, is it possible to upload more than one image for a particular field? If so fieldId alone won't unique.", "url": "https://github.com/google/ground-android/pull/345#discussion_r377186537", "createdAt": "2020-02-10T16:51:39Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationViewModel.java", "diffHunk": "@@ -238,10 +253,46 @@ private Completable handlePhotoCaptureResult(String fieldId) {\n         .ignoreElements();\n   }\n \n-  private Observable<File> saveBitmapAndUpdateResponse(Observable<Bitmap> source, String fieldId) {\n+  private Observable<String> saveBitmapAndUpdateResponse(\n+      Observable<Bitmap> source, String fieldId) {\n     return source\n         .map(bitmap -> fileUtil.saveBitmap(bitmap, fieldId + \".jpg\"))\n-        .doOnNext(file -> onTextChanged(form.getValue().getField(fieldId).get(), file.getPath()));\n+        .map(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de1ae6f6e3912cf544fada530fd3509704df63b9"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ1NzUzMA==", "bodyText": "No, we save the bitmap as a .jpg file and that gets uploaded.\nCurrently, one field can have only one photo. So, the old one gets overwritten if re-uploaded.", "url": "https://github.com/google/ground-android/pull/345#discussion_r377457530", "createdAt": "2020-02-11T06:07:10Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationViewModel.java", "diffHunk": "@@ -238,10 +253,46 @@ private Completable handlePhotoCaptureResult(String fieldId) {\n         .ignoreElements();\n   }\n \n-  private Observable<File> saveBitmapAndUpdateResponse(Observable<Bitmap> source, String fieldId) {\n+  private Observable<String> saveBitmapAndUpdateResponse(\n+      Observable<Bitmap> source, String fieldId) {\n     return source\n         .map(bitmap -> fileUtil.saveBitmap(bitmap, fieldId + \".jpg\"))\n-        .doOnNext(file -> onTextChanged(form.getValue().getField(fieldId).get(), file.getPath()));\n+        .map(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzE4NjUzNw=="}, "originalCommit": {"oid": "de1ae6f6e3912cf544fada530fd3509704df63b9"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc3MTk2MQ==", "bodyText": "I think that's ok as a starting point. We can see if more are needed. Thanks!", "url": "https://github.com/google/ground-android/pull/345#discussion_r377771961", "createdAt": "2020-02-11T17:05:32Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationViewModel.java", "diffHunk": "@@ -238,10 +253,46 @@ private Completable handlePhotoCaptureResult(String fieldId) {\n         .ignoreElements();\n   }\n \n-  private Observable<File> saveBitmapAndUpdateResponse(Observable<Bitmap> source, String fieldId) {\n+  private Observable<String> saveBitmapAndUpdateResponse(\n+      Observable<Bitmap> source, String fieldId) {\n     return source\n         .map(bitmap -> fileUtil.saveBitmap(bitmap, fieldId + \".jpg\"))\n-        .doOnNext(file -> onTextChanged(form.getValue().getField(fieldId).get(), file.getPath()));\n+        .map(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzE4NjUzNw=="}, "originalCommit": {"oid": "de1ae6f6e3912cf544fada530fd3509704df63b9"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc3MjQ1NA==", "bodyText": "I also wonder if we'll get into trouble if users uploading PNG and GIF from their device - let's remember test this.", "url": "https://github.com/google/ground-android/pull/345#discussion_r377772454", "createdAt": "2020-02-11T17:06:22Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationViewModel.java", "diffHunk": "@@ -238,10 +253,46 @@ private Completable handlePhotoCaptureResult(String fieldId) {\n         .ignoreElements();\n   }\n \n-  private Observable<File> saveBitmapAndUpdateResponse(Observable<Bitmap> source, String fieldId) {\n+  private Observable<String> saveBitmapAndUpdateResponse(\n+      Observable<Bitmap> source, String fieldId) {\n     return source\n         .map(bitmap -> fileUtil.saveBitmap(bitmap, fieldId + \".jpg\"))\n-        .doOnNext(file -> onTextChanged(form.getValue().getField(fieldId).get(), file.getPath()));\n+        .map(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzE4NjUzNw=="}, "originalCommit": {"oid": "de1ae6f6e3912cf544fada530fd3509704df63b9"}, "originalPosition": 87}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2606, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}