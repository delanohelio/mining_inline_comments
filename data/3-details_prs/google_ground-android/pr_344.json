{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwMTM0NDg4", "number": 344, "title": "[Observation list] Remove form tab header", "bodyText": "", "createdAt": "2020-02-03T05:52:48Z", "url": "https://github.com/google/ground-android/pull/344", "merged": true, "mergeCommit": {"oid": "b911fef2e7319bb2cf2848eb3a50b2232310b747"}, "closed": true, "closedAt": "2020-02-25T18:48:06Z", "author": {"login": "gino-m"}, "timelineItems": {"totalCount": 30, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcAEqS5AH2gAyMzcwMTM0NDg4OmVlMTI4MmMyMTIyMGUyZmQ3MGYyZWNlYmJlZjY5ZTRmODU5NTZkNWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcH1M0FgFqTM2NDI4NzgwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ee1282c21220e2fd70f2ecebbef69e4f85956d5d", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/ee1282c21220e2fd70f2ecebbef69e4f85956d5d", "committedDate": "2020-02-01T14:31:54Z", "message": "Remove form selector in feature sheet"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11836382a257535a78d57fce9486a9d5de38a4e6", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/11836382a257535a78d57fce9486a9d5de38a4e6", "committedDate": "2020-02-02T04:42:08Z", "message": "Add separator line to feature sheet"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "665ebeeab3f013a4d4d8b4bf5d1b20c32497bac5", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/665ebeeab3f013a4d4d8b4bf5d1b20c32497bac5", "committedDate": "2020-02-02T04:42:45Z", "message": "Increase feature sheet header cutout size"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14976e0c7c7917ab6548c2a536fd066316dc99ff", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/14976e0c7c7917ab6548c2a536fd066316dc99ff", "committedDate": "2020-02-02T04:43:40Z", "message": "Increase feature sheet header height"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce1604f5daf6a9b1ce2ddcf573b30b3416429751", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/ce1604f5daf6a9b1ce2ddcf573b30b3416429751", "committedDate": "2020-02-03T03:11:48Z", "message": "Set activity background color to help debugging layouts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "660df352cd682ee202caa36909cb6f2a1474b496", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/660df352cd682ee202caa36909cb6f2a1474b496", "committedDate": "2020-02-03T03:12:50Z", "message": "Delete form tab pager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2bce2f1a5935a6165c8ff51f3272a7b1034375e8", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/2bce2f1a5935a6165c8ff51f3272a7b1034375e8", "committedDate": "2020-02-03T05:38:34Z", "message": "Reposition obs list progress spinner"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57e155e11e5427826285459f4eaad62cca98b63e", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/57e155e11e5427826285459f4eaad62cca98b63e", "committedDate": "2020-02-03T05:39:26Z", "message": "Tweak Gradle build args"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27b85d61bdcc01cb92eda043a25b0421ce1b13fb", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/27b85d61bdcc01cb92eda043a25b0421ce1b13fb", "committedDate": "2020-02-03T05:40:49Z", "message": "Fix obs list background"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "125479e5bd0e5eebae1b7e35eca4041f4e0b7a3f", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/125479e5bd0e5eebae1b7e35eca4041f4e0b7a3f", "committedDate": "2020-02-03T06:22:49Z", "message": "Remove form change logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0e764d73824e925d660c65874868525b3f211d9", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/f0e764d73824e925d660c65874868525b3f211d9", "committedDate": "2020-02-03T06:31:35Z", "message": "Add comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb56545b594dfebafd9230fcf9d43e77f66ac524", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/bb56545b594dfebafd9230fcf9d43e77f66ac524", "committedDate": "2020-02-03T07:23:40Z", "message": "Merge branch 'master' into rm-multi-form"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyNTMzNzA0", "url": "https://github.com/google/ground-android/pull/344#pullrequestreview-352533704", "createdAt": "2020-02-03T20:16:59Z", "commit": {"oid": "bb56545b594dfebafd9230fcf9d43e77f66ac524"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QyMDoxNjo1OVrOFk-lqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QyMDozMzowMFrOFk_Bjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDMxODUwNw==", "bodyText": "This seems unrelated to the overall PR--what's the impetus for this change?\nLooks like this lets us assemble a debug build w/o enforcing style etc. checks?\nLGTM, just calling it out in case it slipped into this PR accidentally.", "url": "https://github.com/google/ground-android/pull/344#discussion_r374318507", "createdAt": "2020-02-03T20:16:59Z", "author": {"login": "scolsen"}, "path": "gnd/build.gradle", "diffHunk": "@@ -205,7 +205,3 @@ apply plugin: 'com.google.gms.google-services'\n task checkCode(type: GradleBuild) {\n     dependsOn 'checkstyle', 'lintDebug', 'pmd', 'spotbugs'\n }\n-\n-afterEvaluate {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb56545b594dfebafd9230fcf9d43e77f66ac524"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDMxOTU0OA==", "bodyText": "Add TODO to show a message to the user?", "url": "https://github.com/google/ground-android/pull/344#discussion_r374319548", "createdAt": "2020-02-03T20:19:19Z", "author": {"login": "scolsen"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/home/HomeScreenViewModel.java", "diffHunk": "@@ -148,31 +147,28 @@ public void onBottomSheetHidden() {\n     addObservationButtonVisibility.setValue(View.GONE);\n   }\n \n-  public void onFormChange(Form form) {\n-    this.selectedForm = form;\n-  }\n-\n   public void addObservation() {\n     FeatureSheetState state = featureSheetState.getValue();\n     if (state == null) {\n       Log.e(TAG, \"Missing featureSheetState\");\n       return;\n     }\n-    if (selectedForm == null) {\n-      Log.e(TAG, \"Missing form\");\n-      return;\n-    }\n     Feature feature = state.getFeature();\n     if (feature == null) {\n       Log.e(TAG, \"Missing feature\");\n       return;\n     }\n+    ImmutableList<Form> forms = feature.getLayer().getForms();\n+    if (forms.isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb56545b594dfebafd9230fcf9d43e77f66ac524"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDMyMjA3MA==", "bodyText": "This method is redundant now -- delete?", "url": "https://github.com/google/ground-android/pull/344#discussion_r374322070", "createdAt": "2020-02-03T20:24:47Z", "author": {"login": "scolsen"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/home/featuresheet/FeatureSheetFragment.java", "diffHunk": "@@ -76,23 +69,13 @@ public View onCreateView(\n   @Override\n   public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {\n     super.onViewCreated(view, savedInstanceState);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb56545b594dfebafd9230fcf9d43e77f66ac524"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDMyNDM4MA==", "bodyText": "Are we eventually going to support multiple forms again, or will forms eventually become form?", "url": "https://github.com/google/ground-android/pull/344#discussion_r374324380", "createdAt": "2020-02-03T20:30:08Z", "author": {"login": "scolsen"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/home/featuresheet/ObservationListViewModel.java", "diffHunk": "@@ -59,14 +59,22 @@ public ObservationListViewModel(ObservationRepository observationRepository) {\n   }\n \n   /** Loads a list of observations associated with a given feature. */\n-  public void loadObservationList(Feature feature, Form form) {\n+  public void loadObservationList(Feature feature) {\n+    ImmutableList<Form> forms = feature.getLayer().getForms();\n     loadObservations(\n-        feature.getProject(), feature.getLayer().getId(), form.getId(), feature.getId());\n+        feature.getProject(),\n+        forms.isEmpty() ? Optional.empty() : Optional.of(forms.get(0).getId()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb56545b594dfebafd9230fcf9d43e77f66ac524"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDMyNTY0Ng==", "bodyText": "nit: Parallelize parameter positions?\nloadObservations:: project, formId, featureId\nObservationListRequest: project, featureId, formId\nSwap feature and form in one or the other?", "url": "https://github.com/google/ground-android/pull/344#discussion_r374325646", "createdAt": "2020-02-03T20:33:00Z", "author": {"login": "scolsen"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/home/featuresheet/ObservationListViewModel.java", "diffHunk": "@@ -76,22 +84,16 @@ public void loadObservationList(Feature feature, Form form) {\n     return Single.just(ImmutableList.of());\n   }\n \n-  private void loadObservations(Project project, String layerId, String formId, String featureId) {\n-    Optional<Form> form = project.getLayer(layerId).flatMap(pt -> pt.getForm(formId));\n-    if (!form.isPresent()) {\n-      // TODO: Show error.\n-      return;\n-    }\n-    // TODO: Use project id instead of object.\n+  private void loadObservations(Project project, Optional<String> formId, String featureId) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb56545b594dfebafd9230fcf9d43e77f66ac524"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2ff242e3f65a593502804a2f59c6afd7d8fa988", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/f2ff242e3f65a593502804a2f59c6afd7d8fa988", "committedDate": "2020-02-04T05:25:56Z", "message": "Restore accidentally deleted checkCode trigger"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48ba1b763941beff0615739b64366edea6bd681a", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/48ba1b763941beff0615739b64366edea6bd681a", "committedDate": "2020-02-04T05:27:04Z", "message": "Delete redundant override"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3af513c6c790cefb67f00a5a2f66527c05158515", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/3af513c6c790cefb67f00a5a2f66527c05158515", "committedDate": "2020-02-04T05:29:09Z", "message": "Consistent order of method args"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c0828038426b52cba476303c13f43a870431491", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/3c0828038426b52cba476303c13f43a870431491", "committedDate": "2020-02-04T05:29:55Z", "message": "Restore final newline"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66f2baa1bd9de08ffbcbbce650cf15e37afbedcd", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/66f2baa1bd9de08ffbcbbce650cf15e37afbedcd", "committedDate": "2020-02-04T05:30:55Z", "message": "Merge branch 'rm-multi-form' of https://github.com/gino-m/ground-android into rm-multi-form"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ceaef7015953b7a3f4bd174742361a824bf27e2", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/8ceaef7015953b7a3f4bd174742361a824bf27e2", "committedDate": "2020-02-04T05:32:55Z", "message": "Add TODO"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMDU2ODY5", "url": "https://github.com/google/ground-android/pull/344#pullrequestreview-353056869", "createdAt": "2020-02-04T15:16:18Z", "commit": {"oid": "8ceaef7015953b7a3f4bd174742361a824bf27e2"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56cfa3df66cd7312961db3633c0fd06e919750c1", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/56cfa3df66cd7312961db3633c0fd06e919750c1", "committedDate": "2020-02-04T18:03:15Z", "message": "Move support for multiple forms to persistence layers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f55159ad71f7ac0e00fc88c7ba2d013385a66bc", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/7f55159ad71f7ac0e00fc88c7ba2d013385a66bc", "committedDate": "2020-02-07T06:14:44Z", "message": "Revert \"Set activity background color to help debugging layouts\"\n\nThis reverts commit ce1604f5"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fccd716be68b368f54f4506a6882e0430716a376", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/fccd716be68b368f54f4506a6882e0430716a376", "committedDate": "2020-02-11T02:29:20Z", "message": "Merge branch 'master' into rm-multi-form"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a81f9eb957f823af765682de83dc926ac6b436b", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/8a81f9eb957f823af765682de83dc926ac6b436b", "committedDate": "2020-02-24T16:29:51Z", "message": "Merge branch 'master' of https://github.com/google/ground-android into rm-multi-form\n\n# Conflicts:\n#\tgnd/src/main/java/com/google/android/gnd/persistence/remote/firestore/LayerDoc.java\n#\tgnd/src/main/res/layout/feature_sheet_frag.xml\n#\tgradle.properties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d78377b6e5e1d31060a41dc0148dd4566693e8df", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/d78377b6e5e1d31060a41dc0148dd4566693e8df", "committedDate": "2020-02-24T16:29:59Z", "message": "Merge remote-tracking branch 'origin/rm-multi-form' into rm-multi-form"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0a3234f8e001774d70cb4fe909c851486048a01", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/f0a3234f8e001774d70cb4fe909c851486048a01", "committedDate": "2020-02-24T16:31:35Z", "message": "Fix duplicate namespace added on merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77c43648ffbe024116564687a9fd032869c5b117", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/77c43648ffbe024116564687a9fd032869c5b117", "committedDate": "2020-02-24T16:37:10Z", "message": "Update to latest Layer model, warn on multiple forms"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "beefe26d0b5d2d339ec7e058b55428a94c6e113f", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/beefe26d0b5d2d339ec7e058b55428a94c6e113f", "committedDate": "2020-02-24T21:59:07Z", "message": "Merge branch 'master' into rm-multi-form"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1416852e88bc9b12980cf01618e4844c51a9a50d", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/1416852e88bc9b12980cf01618e4844c51a9a50d", "committedDate": "2020-02-24T22:01:03Z", "message": "Merge branch 'master' into rm-multi-form"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0Mjg3ODAw", "url": "https://github.com/google/ground-android/pull/344#pullrequestreview-364287800", "createdAt": "2020-02-25T16:48:58Z", "commit": {"oid": "1416852e88bc9b12980cf01618e4844c51a9a50d"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjo0ODo1OFrOFuNI_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjo0ODo1OFrOFuNI_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk5NDExMQ==", "bodyText": "Doesn't the fact that this is nullable obviate the use of the ArrayList or any type with an empty state? Is it possible for us to remove the potential null--or is that necessary because of unknowns in the firebase side (random data wipes, etc.)\nI'm guessing it's the latter, so not blocking on this.", "url": "https://github.com/google/ground-android/pull/344#discussion_r383994111", "createdAt": "2020-02-25T16:48:58Z", "author": {"login": "scolsen"}, "path": "gnd/src/main/java/com/google/android/gnd/persistence/remote/firestore/schema/LayerConverter.java", "diffHunk": "@@ -33,10 +35,12 @@ static Layer toLayer(String id, LayerNestedObject obj) {\n     if (obj.getDefaultStyle() != null) {\n       layer.setDefaultStyle(StyleConverter.toStyle(obj.getDefaultStyle()));\n     }\n-    if (obj.getForms() != null) {\n-      Maps.forEach(\n-          obj.getForms(),\n-          (formId, formDoc) -> layer.addForm(FormConverter.toForm(formId, formDoc)));\n+    if (obj.getForms() != null && !obj.getForms().isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1416852e88bc9b12980cf01618e4844c51a9a50d"}, "originalPosition": 24}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1698, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}