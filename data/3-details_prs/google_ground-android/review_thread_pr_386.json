{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3MTMzNTgz", "number": 386, "reviewThreads": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNTowMDozOFrODngHxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNTo1Njo0MFrODoyE3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyNzQ3MzM1OnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationViewModel.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNTowMDozOFrOF1iXRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNTowMDozOFrOF1iXRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY4MTg2Mg==", "bodyText": "With Timber can we now just do to following?\nTimber.v(\"onResponseChanged: %s = '%s'\", field.getId(), Response.toString(newResponse));", "url": "https://github.com/google/ground-android/pull/386#discussion_r391681862", "createdAt": "2020-03-12T15:00:38Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationViewModel.java", "diffHunk": "@@ -196,14 +196,13 @@ public void initialize(EditObservationFragmentArgs args) {\n   }\n \n   public void onTextChanged(Field field, String text) {\n-    Log.v(TAG, \"onTextChanged: \" + field.getId());\n+    Timber.v(\"onTextChanged: %s\", field.getId());\n \n     onResponseChanged(field, TextResponse.fromString(text));\n   }\n \n   public void onResponseChanged(Field field, Optional<Response> newResponse) {\n-    Log.v(\n-        TAG, \"onResponseChanged: \" + field.getId() + \" = '\" + Response.toString(newResponse) + \"'\");\n+    Timber.v(\"onResponseChanged: \" + field.getId() + \" = '\" + Response.toString(newResponse) + \"'\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b06e2d163a89223d91d5913ed3f12478e4f6dd28"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyNzQ3NDkxOnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationViewModel.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNTowMDo1M1rOF1iYIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNTowMDo1M1rOF1iYIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY4MjA4Mw==", "bodyText": "Same here", "url": "https://github.com/google/ground-android/pull/386#discussion_r391682083", "createdAt": "2020-03-12T15:00:53Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationViewModel.java", "diffHunk": "@@ -392,12 +391,12 @@ private void refreshResponseMap(Observation obs) {\n \n   private ImmutableList<ResponseDelta> getResponseDeltas() {\n     if (originalObservation == null) {\n-      Log.e(TAG, \"Response diff attempted before observation loaded\");\n+      Timber.e(\"Response diff attempted before observation loaded\");\n       return ImmutableList.of();\n     }\n     ImmutableList.Builder<ResponseDelta> deltas = ImmutableList.builder();\n     ResponseMap originalResponses = originalObservation.getResponses();\n-    Log.v(TAG, \"Responses:\\n Before: \" + originalResponses + \" \\nAfter:  \" + responses);\n+    Timber.v(\"Responses:\\n Before: \" + originalResponses + \" \\nAfter:  \" + responses);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b06e2d163a89223d91d5913ed3f12478e4f6dd28"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyODgwODIzOnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/ui/common/BindingAdapters.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQyMToxNDo0NVrOF1vhDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMDo0MjozMFrOF3FAcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg5NzM1Nw==", "bodyText": "This is a lot of logic to be doing inside a binding adapter, especially the hiding/showing of the parent view. Can we instead define a separate view widget that can be tested and implemented independently? It could have its own ViewModel with LiveData containing the actual image to display. Wdyt?", "url": "https://github.com/google/ground-android/pull/386#discussion_r391897357", "createdAt": "2020-03-12T21:14:45Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/common/BindingAdapters.java", "diffHunk": "@@ -118,4 +125,29 @@ public static void setOnFocusChangeListener(\n   public static void setOnShowDialogListener(MultipleChoiceFieldLayout view, Runnable listener) {\n     view.setOnShowDialogListener(listener);\n   }\n+\n+  @BindingAdapter({\"bind:storageManager\", \"bind:response\"})\n+  public static void bindPhoto(ImageView view, StorageManager storageManager, Response response) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73aad5e1620e52b649974ca9f1ff850f4ce48380"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjA1ODQ0OA==", "bodyText": "Makes sense. Then we can reuse it at other places as well.", "url": "https://github.com/google/ground-android/pull/386#discussion_r392058448", "createdAt": "2020-03-13T07:00:06Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/common/BindingAdapters.java", "diffHunk": "@@ -118,4 +125,29 @@ public static void setOnFocusChangeListener(\n   public static void setOnShowDialogListener(MultipleChoiceFieldLayout view, Runnable listener) {\n     view.setOnShowDialogListener(listener);\n   }\n+\n+  @BindingAdapter({\"bind:storageManager\", \"bind:response\"})\n+  public static void bindPhoto(ImageView view, StorageManager storageManager, Response response) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg5NzM1Nw=="}, "originalCommit": {"oid": "73aad5e1620e52b649974ca9f1ff850f4ce48380"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjIxNzI5MA==", "bodyText": "I've added a custom view + a view model for it. But this is again having the original problem of image view not getting updated (nor the visibility of it's container). Can you please have a look? I tried debugging it but couldn't find anything useful. 81d1df1", "url": "https://github.com/google/ground-android/pull/386#discussion_r392217290", "createdAt": "2020-03-13T13:11:17Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/common/BindingAdapters.java", "diffHunk": "@@ -118,4 +125,29 @@ public static void setOnFocusChangeListener(\n   public static void setOnShowDialogListener(MultipleChoiceFieldLayout view, Runnable listener) {\n     view.setOnShowDialogListener(listener);\n   }\n+\n+  @BindingAdapter({\"bind:storageManager\", \"bind:response\"})\n+  public static void bindPhoto(ImageView view, StorageManager storageManager, Response response) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg5NzM1Nw=="}, "originalCommit": {"oid": "73aad5e1620e52b649974ca9f1ff850f4ce48380"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI5ODAzNA==", "bodyText": "Great job finding this issue, I looked over the weekend but didn't find it!\nDo you think we can let the binding take a Uri instead of a StorageManager and response to prevent having so much logic in the binder?", "url": "https://github.com/google/ground-android/pull/386#discussion_r393298034", "createdAt": "2020-03-16T20:42:30Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/common/BindingAdapters.java", "diffHunk": "@@ -118,4 +125,29 @@ public static void setOnFocusChangeListener(\n   public static void setOnShowDialogListener(MultipleChoiceFieldLayout view, Runnable listener) {\n     view.setOnShowDialogListener(listener);\n   }\n+\n+  @BindingAdapter({\"bind:storageManager\", \"bind:response\"})\n+  public static void bindPhoto(ImageView view, StorageManager storageManager, Response response) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg5NzM1Nw=="}, "originalCommit": {"oid": "73aad5e1620e52b649974ca9f1ff850f4ce48380"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMTQxNzA3OnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/ui/common/BindingAdapters.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNTozODowMFrOF2IZiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNzo1NzowMFrOF2NTRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMwNTAzMg==", "bodyText": "Do we want to set the placeholder here in case Uri is null?", "url": "https://github.com/google/ground-android/pull/386#discussion_r392305032", "createdAt": "2020-03-13T15:38:00Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/common/BindingAdapters.java", "diffHunk": "@@ -118,4 +129,13 @@ public static void setOnFocusChangeListener(\n   public static void setOnShowDialogListener(MultipleChoiceFieldLayout view, Runnable listener) {\n     view.setOnShowDialogListener(listener);\n   }\n+\n+  @BindingAdapter(\"bind:uri\")\n+  public static void bindUri(ImageView view, Uri uri) {\n+    if (uri == null) {\n+      return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb9c85c81d3c1d25456bfcbb421411820aefb4e3"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjM1NTcxMA==", "bodyText": "Ideally, when this happens the visibility of MaterialCard should be set to GONE", "url": "https://github.com/google/ground-android/pull/386#discussion_r392355710", "createdAt": "2020-03-13T17:00:51Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/common/BindingAdapters.java", "diffHunk": "@@ -118,4 +129,13 @@ public static void setOnFocusChangeListener(\n   public static void setOnShowDialogListener(MultipleChoiceFieldLayout view, Runnable listener) {\n     view.setOnShowDialogListener(listener);\n   }\n+\n+  @BindingAdapter(\"bind:uri\")\n+  public static void bindUri(ImageView view, Uri uri) {\n+    if (uri == null) {\n+      return;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMwNTAzMg=="}, "originalCommit": {"oid": "eb9c85c81d3c1d25456bfcbb421411820aefb4e3"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjM4NTM0OQ==", "bodyText": "When could this actually be null? If it happens, the widget's previous state will remain. At some point, when it's made visible, the old state will show even though Uri is null, which is obviously incorrect. It would seem we'd want the state of the widget to match to current field binding, but I may be missing a piece!", "url": "https://github.com/google/ground-android/pull/386#discussion_r392385349", "createdAt": "2020-03-13T17:57:00Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/common/BindingAdapters.java", "diffHunk": "@@ -118,4 +129,13 @@ public static void setOnFocusChangeListener(\n   public static void setOnShowDialogListener(MultipleChoiceFieldLayout view, Runnable listener) {\n     view.setOnShowDialogListener(listener);\n   }\n+\n+  @BindingAdapter(\"bind:uri\")\n+  public static void bindUri(ImageView view, Uri uri) {\n+    if (uri == null) {\n+      return;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMwNTAzMg=="}, "originalCommit": {"oid": "eb9c85c81d3c1d25456bfcbb421411820aefb4e3"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMTQ1NjczOnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationFragment.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNTo0ODo1MlrOF2IzTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNTo0ODo1MlrOF2IzTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMxMTYyOA==", "bodyText": "This will get the (single) view model associated with this fragment. Instead, we want a different viewmodel for each field instance. For that you'll probably want to use viewModelFactory.create()", "url": "https://github.com/google/ground-android/pull/386#discussion_r392311628", "createdAt": "2020-03-13T15:48:52Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationFragment.java", "diffHunk": "@@ -176,26 +174,13 @@ public void addPhotoField(Field field) {\n     PhotoInputFieldBinding binding =\n         PhotoInputFieldBinding.inflate(getLayoutInflater(), formLayout, false);\n     binding.setLifecycleOwner(this);\n+    PhotoViewViewModel photoViewViewModel = getViewModel(PhotoViewViewModel.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb9c85c81d3c1d25456bfcbb421411820aefb4e3"}, "originalPosition": 78}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMTQ2MjYzOnYy", "diffSide": "RIGHT", "path": "gnd/src/main/res/layout/photo_input_field.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNTo1MDozOFrOF2I3HA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNTo1MDozOFrOF2I3HA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMxMjYwNA==", "bodyText": "Can the input field be better encapsulated to not have visibility to its container? Since it has its own ViewModel, could it get all of its view state from there?", "url": "https://github.com/google/ground-android/pull/386#discussion_r392312604", "createdAt": "2020-03-13T15:50:38Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/res/layout/photo_input_field.xml", "diffHunk": "@@ -26,6 +26,12 @@\n     <variable\n       name=\"fragment\"\n       type=\"com.google.android.gnd.ui.editobservation.EditObservationFragment\" />\n+    <variable", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb9c85c81d3c1d25456bfcbb421411820aefb4e3"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMTQ2NzU0OnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/system/StorageManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNTo1MjowNlrOF2I6Yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNTo1MjowNlrOF2I6Yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMxMzQ0Mg==", "bodyText": "For once main functionality is working - please use Rx instead of Callbacks. Helper in RxTask can be used to createa Single<Uri> that this method returns, for example.", "url": "https://github.com/google/ground-android/pull/386#discussion_r392313442", "createdAt": "2020-03-13T15:52:06Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/system/StorageManager.java", "diffHunk": "@@ -120,35 +116,24 @@ private File getLocalFileFromDestinationPath(String destinationPath)\n     return fileUtil.getFile(splits[splits.length - 1]);\n   }\n \n+  private Uri getFileUriFromDestinationPath(String destinationPath) throws FileNotFoundException {\n+    File file = getLocalFileFromDestinationPath(destinationPath);\n+    return Uri.fromFile(file);\n+  }\n+\n   /**\n    * Load photo from the provided destination path.\n    *\n    * <p>If the image is not uploaded yet, then parse the filename from path and load the file from\n    * local storage.\n    *\n-   * @param imageView Placeholder for photo field\n    * @param destinationPath Destination path of the uploaded photo\n    */\n-  public void loadPhotoFromDestinationPath(ImageView imageView, String destinationPath) {\n+  public void loadPhotoFromDestinationPath(String destinationPath, Callback callback) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb9c85c81d3c1d25456bfcbb421411820aefb4e3"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMTQ2OTEwOnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/system/StorageManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNTo1MjozM1rOF2I7Ww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNTo1MjozM1rOF2I7Ww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMxMzY5MQ==", "bodyText": "Load = Download in this case? Please be specific here.", "url": "https://github.com/google/ground-android/pull/386#discussion_r392313691", "createdAt": "2020-03-13T15:52:33Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/system/StorageManager.java", "diffHunk": "@@ -120,35 +116,24 @@ private File getLocalFileFromDestinationPath(String destinationPath)\n     return fileUtil.getFile(splits[splits.length - 1]);\n   }\n \n+  private Uri getFileUriFromDestinationPath(String destinationPath) throws FileNotFoundException {\n+    File file = getLocalFileFromDestinationPath(destinationPath);\n+    return Uri.fromFile(file);\n+  }\n+\n   /**\n    * Load photo from the provided destination path.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb9c85c81d3c1d25456bfcbb421411820aefb4e3"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMTUxMDk5OnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/ui/common/photoview/PhotoView.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNjowMTozMFrOF2JV6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNjowMTozMFrOF2JV6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMyMDQ5MA==", "bodyText": "Since Views are tightly bound to the Android OS and running VM, in general we're trying keep views as \"dumb\" as possible. This way we can test all/most business logic using ViewModels and upstream classes only. So ideally the views would delegate interaction with custom model classes or logic to the ViewModel. In most cases, that means the View can go away altogether, leaving us with just a layout and viewmodel. Would that be possible in this case?", "url": "https://github.com/google/ground-android/pull/386#discussion_r392320490", "createdAt": "2020-03-13T16:01:30Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/common/photoview/PhotoView.java", "diffHunk": "@@ -0,0 +1,58 @@\n+package com.google.android.gnd.ui.common.photoview;\n+\n+import android.content.Context;\n+import android.net.Uri;\n+import android.util.AttributeSet;\n+import android.view.LayoutInflater;\n+import androidx.fragment.app.Fragment;\n+import com.google.android.gnd.databinding.PhotoViewBinding;\n+import com.google.android.gnd.model.observation.Response;\n+import com.google.android.gnd.system.StorageManager;\n+import com.google.android.material.card.MaterialCardView;\n+import javax.annotation.Nullable;\n+import javax.inject.Inject;\n+\n+public class PhotoView extends MaterialCardView {\n+\n+  private final PhotoViewBinding binding;\n+\n+  @Inject StorageManager storageManager;\n+\n+  @Nullable private Response response;\n+\n+  public PhotoView(Context context) {\n+    this(context, null);\n+  }\n+\n+  public PhotoView(Context context, AttributeSet attrs) {\n+    this(context, attrs, 0);\n+  }\n+\n+  public PhotoView(Context context, AttributeSet attrs, int defStyleAttr) {\n+    super(context, attrs, defStyleAttr);\n+\n+    LayoutInflater inflater =\n+        (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);\n+    binding = PhotoViewBinding.inflate(inflater);\n+  }\n+\n+  public void setResponse(@Nullable Response response) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb9c85c81d3c1d25456bfcbb421411820aefb4e3"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMTUxNDY0OnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/ui/common/photoview/PhotoView.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNjowMjozNlrOF2JYZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNjowMjozNlrOF2JYZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMyMTEyNw==", "bodyText": "In a non-Rx world we'd probably just use Consumer<Uri> instead, but in our case we can just use an Observable.", "url": "https://github.com/google/ground-android/pull/386#discussion_r392321127", "createdAt": "2020-03-13T16:02:36Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/common/photoview/PhotoView.java", "diffHunk": "@@ -0,0 +1,58 @@\n+package com.google.android.gnd.ui.common.photoview;\n+\n+import android.content.Context;\n+import android.net.Uri;\n+import android.util.AttributeSet;\n+import android.view.LayoutInflater;\n+import androidx.fragment.app.Fragment;\n+import com.google.android.gnd.databinding.PhotoViewBinding;\n+import com.google.android.gnd.model.observation.Response;\n+import com.google.android.gnd.system.StorageManager;\n+import com.google.android.material.card.MaterialCardView;\n+import javax.annotation.Nullable;\n+import javax.inject.Inject;\n+\n+public class PhotoView extends MaterialCardView {\n+\n+  private final PhotoViewBinding binding;\n+\n+  @Inject StorageManager storageManager;\n+\n+  @Nullable private Response response;\n+\n+  public PhotoView(Context context) {\n+    this(context, null);\n+  }\n+\n+  public PhotoView(Context context, AttributeSet attrs) {\n+    this(context, attrs, 0);\n+  }\n+\n+  public PhotoView(Context context, AttributeSet attrs, int defStyleAttr) {\n+    super(context, attrs, defStyleAttr);\n+\n+    LayoutInflater inflater =\n+        (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);\n+    binding = PhotoViewBinding.inflate(inflater);\n+  }\n+\n+  public void setResponse(@Nullable Response response) {\n+    this.response = response;\n+  }\n+\n+  public void setFragment(Fragment fragment) {\n+    binding.setLifecycleOwner(fragment);\n+  }\n+\n+  public void setViewModel(PhotoViewViewModel viewModel) {\n+    if (viewModel == null) {\n+      return;\n+    }\n+    viewModel.setResponse(response);\n+    binding.setViewModel(viewModel);\n+  }\n+\n+  public interface Callback {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb9c85c81d3c1d25456bfcbb421411820aefb4e3"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMTUxOTU0OnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/ui/common/photoview/PhotoViewViewModel.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNjowNDowMlrOF2JbdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNjowNDowMlrOF2JbdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMyMTkwOA==", "bodyText": "Naming: PhotoFieldViewModel, to make it clear that this is specific to photo fields in forms, not just any photo widget?", "url": "https://github.com/google/ground-android/pull/386#discussion_r392321908", "createdAt": "2020-03-13T16:04:02Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/common/photoview/PhotoViewViewModel.java", "diffHunk": "@@ -0,0 +1,52 @@\n+package com.google.android.gnd.ui.common.photoview;\n+\n+import android.net.Uri;\n+import android.view.View;\n+import androidx.databinding.ObservableInt;\n+import androidx.lifecycle.LiveData;\n+import androidx.lifecycle.MutableLiveData;\n+import com.google.android.gnd.model.form.Field;\n+import com.google.android.gnd.model.observation.Response;\n+import com.google.android.gnd.system.StorageManager;\n+import com.google.android.gnd.ui.common.AbstractViewModel;\n+import javax.inject.Inject;\n+\n+public class PhotoViewViewModel extends AbstractViewModel {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb9c85c81d3c1d25456bfcbb421411820aefb4e3"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMTUyMjczOnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/ui/common/photoview/PhotoViewViewModel.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNjowNDo1NlrOF2JdiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNjowNTozOVrOF2JfEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMyMjQ0MA==", "bodyText": "This should probably be calling this \"visibility\" instead given the value it returns and how it's used.", "url": "https://github.com/google/ground-android/pull/386#discussion_r392322440", "createdAt": "2020-03-13T16:04:56Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/common/photoview/PhotoViewViewModel.java", "diffHunk": "@@ -0,0 +1,52 @@\n+package com.google.android.gnd.ui.common.photoview;\n+\n+import android.net.Uri;\n+import android.view.View;\n+import androidx.databinding.ObservableInt;\n+import androidx.lifecycle.LiveData;\n+import androidx.lifecycle.MutableLiveData;\n+import com.google.android.gnd.model.form.Field;\n+import com.google.android.gnd.model.observation.Response;\n+import com.google.android.gnd.system.StorageManager;\n+import com.google.android.gnd.ui.common.AbstractViewModel;\n+import javax.inject.Inject;\n+\n+public class PhotoViewViewModel extends AbstractViewModel {\n+\n+  private final StorageManager storageManager;\n+  private final MutableLiveData<Uri> destinationPath = new MutableLiveData<Uri>();\n+  private final ObservableInt isDestinationPathAvailable = new ObservableInt(View.GONE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb9c85c81d3c1d25456bfcbb421411820aefb4e3"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMyMjgzMw==", "bodyText": "Also, we should use LiveData since ObservableInt isn't Lifecycle aware.", "url": "https://github.com/google/ground-android/pull/386#discussion_r392322833", "createdAt": "2020-03-13T16:05:39Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/common/photoview/PhotoViewViewModel.java", "diffHunk": "@@ -0,0 +1,52 @@\n+package com.google.android.gnd.ui.common.photoview;\n+\n+import android.net.Uri;\n+import android.view.View;\n+import androidx.databinding.ObservableInt;\n+import androidx.lifecycle.LiveData;\n+import androidx.lifecycle.MutableLiveData;\n+import com.google.android.gnd.model.form.Field;\n+import com.google.android.gnd.model.observation.Response;\n+import com.google.android.gnd.system.StorageManager;\n+import com.google.android.gnd.ui.common.AbstractViewModel;\n+import javax.inject.Inject;\n+\n+public class PhotoViewViewModel extends AbstractViewModel {\n+\n+  private final StorageManager storageManager;\n+  private final MutableLiveData<Uri> destinationPath = new MutableLiveData<Uri>();\n+  private final ObservableInt isDestinationPathAvailable = new ObservableInt(View.GONE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMyMjQ0MA=="}, "originalCommit": {"oid": "eb9c85c81d3c1d25456bfcbb421411820aefb4e3"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMTUzNDk1OnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/ui/common/photoview/PhotoView.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNjowODoyNlrOF2JlUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNjowODoyNlrOF2JlUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMyNDQzMg==", "bodyText": "LayoutInflater inflater = LayoutInflater.from(context); can be used here instead.", "url": "https://github.com/google/ground-android/pull/386#discussion_r392324432", "createdAt": "2020-03-13T16:08:26Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/common/photoview/PhotoView.java", "diffHunk": "@@ -0,0 +1,58 @@\n+package com.google.android.gnd.ui.common.photoview;\n+\n+import android.content.Context;\n+import android.net.Uri;\n+import android.util.AttributeSet;\n+import android.view.LayoutInflater;\n+import androidx.fragment.app.Fragment;\n+import com.google.android.gnd.databinding.PhotoViewBinding;\n+import com.google.android.gnd.model.observation.Response;\n+import com.google.android.gnd.system.StorageManager;\n+import com.google.android.material.card.MaterialCardView;\n+import javax.annotation.Nullable;\n+import javax.inject.Inject;\n+\n+public class PhotoView extends MaterialCardView {\n+\n+  private final PhotoViewBinding binding;\n+\n+  @Inject StorageManager storageManager;\n+\n+  @Nullable private Response response;\n+\n+  public PhotoView(Context context) {\n+    this(context, null);\n+  }\n+\n+  public PhotoView(Context context, AttributeSet attrs) {\n+    this(context, attrs, 0);\n+  }\n+\n+  public PhotoView(Context context, AttributeSet attrs, int defStyleAttr) {\n+    super(context, attrs, defStyleAttr);\n+\n+    LayoutInflater inflater =\n+        (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb9c85c81d3c1d25456bfcbb421411820aefb4e3"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNzkwMDA4OnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/system/StorageManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMDo0ODo0MlrOF3FO3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMjo0MzozMlrOF3IM_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzMwMTcyNQ==", "bodyText": "This method is UI-specific so should probably be defined in the UI layer (e.g., the Fragment) or related helper.", "url": "https://github.com/google/ground-android/pull/386#discussion_r393301725", "createdAt": "2020-03-16T20:48:42Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/system/StorageManager.java", "diffHunk": "@@ -82,7 +78,7 @@ private Completable sendPhotoPickerIntent() {\n                   Intent intent = new Intent(Intent.ACTION_GET_CONTENT);\n                   intent.setType(\"image/*\");\n                   activity.startActivityForResult(intent, PICK_PHOTO_REQUEST_CODE);\n-                  Log.d(TAG, \"file picker intent sent\");\n+                  Timber.d(\"file picker intent sent\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb9c85c81d3c1d25456bfcbb421411820aefb4e3"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM1MDM5Nw==", "bodyText": "Added a TODO for future refactoring", "url": "https://github.com/google/ground-android/pull/386#discussion_r393350397", "createdAt": "2020-03-16T22:43:32Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/src/main/java/com/google/android/gnd/system/StorageManager.java", "diffHunk": "@@ -82,7 +78,7 @@ private Completable sendPhotoPickerIntent() {\n                   Intent intent = new Intent(Intent.ACTION_GET_CONTENT);\n                   intent.setType(\"image/*\");\n                   activity.startActivityForResult(intent, PICK_PHOTO_REQUEST_CODE);\n-                  Log.d(TAG, \"file picker intent sent\");\n+                  Timber.d(\"file picker intent sent\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzMwMTcyNQ=="}, "originalCommit": {"oid": "eb9c85c81d3c1d25456bfcbb421411820aefb4e3"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNzkwNTUxOnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/system/StorageManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMDo1MDozNVrOF3FSdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMjo0Mzo1N1rOF3INrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzMwMjY0Ng==", "bodyText": "Sorry if I mentioned it before, but this probably won't work. Since you need to properly manage the returned disposable, we only subscribe to streams in lifecycle-aware contexts like Fragments. The right thing to do here I believe, would be to return a Single, which can be created using RxTask.", "url": "https://github.com/google/ground-android/pull/386#discussion_r393302646", "createdAt": "2020-03-16T20:50:35Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/system/StorageManager.java", "diffHunk": "@@ -120,35 +116,24 @@ private File getLocalFileFromDestinationPath(String destinationPath)\n     return fileUtil.getFile(splits[splits.length - 1]);\n   }\n \n+  private Uri getFileUriFromDestinationPath(String destinationPath) throws FileNotFoundException {\n+    File file = getLocalFileFromDestinationPath(destinationPath);\n+    return Uri.fromFile(file);\n+  }\n+\n   /**\n    * Load photo from the provided destination path.\n    *\n    * <p>If the image is not uploaded yet, then parse the filename from path and load the file from\n    * local storage.\n    *\n-   * @param imageView Placeholder for photo field\n    * @param destinationPath Destination path of the uploaded photo\n    */\n-  public void loadPhotoFromDestinationPath(ImageView imageView, String destinationPath) {\n+  public void loadPhotoFromDestinationPath(String destinationPath, Callback callback) {\n     firestoreStorageManager\n         .getDownloadUrl(destinationPath)\n-        .doOnSuccess(\n-            uri -> {\n-              // Load the file from Firestore Storage\n-              Picasso.get()\n-                  .load(uri)\n-                  .placeholder(R.drawable.ic_photo_grey_600_24dp)\n-                  .into(imageView);\n-            })\n-        .doOnError(\n-            throwable -> {\n-              // Load file locally\n-              File file = getLocalFileFromDestinationPath(destinationPath);\n-              Picasso.get()\n-                  .load(file)\n-                  .placeholder(R.drawable.ic_photo_grey_600_24dp)\n-                  .into(imageView);\n-            })\n+        .doOnSuccess(callback::run)\n+        .doOnError(throwable -> callback.run(getFileUriFromDestinationPath(destinationPath)))\n         .subscribe();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb9c85c81d3c1d25456bfcbb421411820aefb4e3"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM1MDU3NA==", "bodyText": "Thanks for catching this! This simplified the code greatly.", "url": "https://github.com/google/ground-android/pull/386#discussion_r393350574", "createdAt": "2020-03-16T22:43:57Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/src/main/java/com/google/android/gnd/system/StorageManager.java", "diffHunk": "@@ -120,35 +116,24 @@ private File getLocalFileFromDestinationPath(String destinationPath)\n     return fileUtil.getFile(splits[splits.length - 1]);\n   }\n \n+  private Uri getFileUriFromDestinationPath(String destinationPath) throws FileNotFoundException {\n+    File file = getLocalFileFromDestinationPath(destinationPath);\n+    return Uri.fromFile(file);\n+  }\n+\n   /**\n    * Load photo from the provided destination path.\n    *\n    * <p>If the image is not uploaded yet, then parse the filename from path and load the file from\n    * local storage.\n    *\n-   * @param imageView Placeholder for photo field\n    * @param destinationPath Destination path of the uploaded photo\n    */\n-  public void loadPhotoFromDestinationPath(ImageView imageView, String destinationPath) {\n+  public void loadPhotoFromDestinationPath(String destinationPath, Callback callback) {\n     firestoreStorageManager\n         .getDownloadUrl(destinationPath)\n-        .doOnSuccess(\n-            uri -> {\n-              // Load the file from Firestore Storage\n-              Picasso.get()\n-                  .load(uri)\n-                  .placeholder(R.drawable.ic_photo_grey_600_24dp)\n-                  .into(imageView);\n-            })\n-        .doOnError(\n-            throwable -> {\n-              // Load file locally\n-              File file = getLocalFileFromDestinationPath(destinationPath);\n-              Picasso.get()\n-                  .load(file)\n-                  .placeholder(R.drawable.ic_photo_grey_600_24dp)\n-                  .into(imageView);\n-            })\n+        .doOnSuccess(callback::run)\n+        .doOnError(throwable -> callback.run(getFileUriFromDestinationPath(destinationPath)))\n         .subscribe();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzMwMjY0Ng=="}, "originalCommit": {"oid": "eb9c85c81d3c1d25456bfcbb421411820aefb4e3"}, "originalPosition": 79}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNzkxMTY3OnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/ui/common/photoview/PhotoView.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMDo1MjoxOFrOF3FWBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMjo0NDoyNVrOF3IOOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzMwMzU1OA==", "bodyText": "It's probably my fault for being vague in previous comments, but we're generally trying to avoid creating custom Views unless absolutely necessary, since they're hard to test and easy to get wrong (as you discovered)! Instead, could this view be reduced to a layout xml that can be included in the photo_input_field layout, which in turn gets added by the Fragment?", "url": "https://github.com/google/ground-android/pull/386#discussion_r393303558", "createdAt": "2020-03-16T20:52:18Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/common/photoview/PhotoView.java", "diffHunk": "@@ -0,0 +1,58 @@\n+package com.google.android.gnd.ui.common.photoview;\n+\n+import android.content.Context;\n+import android.net.Uri;\n+import android.util.AttributeSet;\n+import android.view.LayoutInflater;\n+import androidx.fragment.app.Fragment;\n+import com.google.android.gnd.databinding.PhotoViewBinding;\n+import com.google.android.gnd.model.observation.Response;\n+import com.google.android.gnd.system.StorageManager;\n+import com.google.android.material.card.MaterialCardView;\n+import javax.annotation.Nullable;\n+import javax.inject.Inject;\n+\n+public class PhotoView extends MaterialCardView {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb9c85c81d3c1d25456bfcbb421411820aefb4e3"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM1MDcxNA==", "bodyText": "Thanks for the idea. It all looks better than the first approach I took.", "url": "https://github.com/google/ground-android/pull/386#discussion_r393350714", "createdAt": "2020-03-16T22:44:25Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/common/photoview/PhotoView.java", "diffHunk": "@@ -0,0 +1,58 @@\n+package com.google.android.gnd.ui.common.photoview;\n+\n+import android.content.Context;\n+import android.net.Uri;\n+import android.util.AttributeSet;\n+import android.view.LayoutInflater;\n+import androidx.fragment.app.Fragment;\n+import com.google.android.gnd.databinding.PhotoViewBinding;\n+import com.google.android.gnd.model.observation.Response;\n+import com.google.android.gnd.system.StorageManager;\n+import com.google.android.material.card.MaterialCardView;\n+import javax.annotation.Nullable;\n+import javax.inject.Inject;\n+\n+public class PhotoView extends MaterialCardView {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzMwMzU1OA=="}, "originalCommit": {"oid": "eb9c85c81d3c1d25456bfcbb421411820aefb4e3"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MDgxNjY0OnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/ui/common/BindingAdapters.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNTozODo0N1rOF3h8xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNjowNToyNVrOF3jLzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc3MjIzMA==", "bodyText": "Do we need to handle error states here? Will failing to load the URI cause the application to crash?", "url": "https://github.com/google/ground-android/pull/386#discussion_r393772230", "createdAt": "2020-03-17T15:38:47Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/common/BindingAdapters.java", "diffHunk": "@@ -118,4 +126,9 @@ public static void setOnFocusChangeListener(\n   public static void setOnShowDialogListener(MultipleChoiceFieldLayout view, Runnable listener) {\n     view.setOnShowDialogListener(listener);\n   }\n+\n+  @BindingAdapter(\"imageUri\")\n+  public static void bindUri(ImageView view, Uri uri) {\n+    Picasso.get().load(uri).placeholder(R.drawable.ic_photo_grey_600_24dp).into(view);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df8cf46086a03c08f384ffc47bf651eff228ddf4"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc5MTU0Nw==", "bodyText": "No, that's why we have a placeholder. If anything unexpected happens, the app doesn't crash and the imageview just displays placeholder.\nI tested network not available and null cases", "url": "https://github.com/google/ground-android/pull/386#discussion_r393791547", "createdAt": "2020-03-17T16:04:06Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/common/BindingAdapters.java", "diffHunk": "@@ -118,4 +126,9 @@ public static void setOnFocusChangeListener(\n   public static void setOnShowDialogListener(MultipleChoiceFieldLayout view, Runnable listener) {\n     view.setOnShowDialogListener(listener);\n   }\n+\n+  @BindingAdapter(\"imageUri\")\n+  public static void bindUri(ImageView view, Uri uri) {\n+    Picasso.get().load(uri).placeholder(R.drawable.ic_photo_grey_600_24dp).into(view);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc3MjIzMA=="}, "originalCommit": {"oid": "df8cf46086a03c08f384ffc47bf651eff228ddf4"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc5MjQ2Mg==", "bodyText": "Great, thanks for checking! Could you kindly add a comment for posterity since it's not obvious at first glance?", "url": "https://github.com/google/ground-android/pull/386#discussion_r393792462", "createdAt": "2020-03-17T16:05:25Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/common/BindingAdapters.java", "diffHunk": "@@ -118,4 +126,9 @@ public static void setOnFocusChangeListener(\n   public static void setOnShowDialogListener(MultipleChoiceFieldLayout view, Runnable listener) {\n     view.setOnShowDialogListener(listener);\n   }\n+\n+  @BindingAdapter(\"imageUri\")\n+  public static void bindUri(ImageView view, Uri uri) {\n+    Picasso.get().load(uri).placeholder(R.drawable.ic_photo_grey_600_24dp).into(view);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc3MjIzMA=="}, "originalCommit": {"oid": "df8cf46086a03c08f384ffc47bf651eff228ddf4"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MDgyNTQ4OnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/ui/common/ViewModelModule.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNTo0MDo0M1rOF3iCYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNTo0MDo0M1rOF3iCYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc3MzY2Nw==", "bodyText": "Naming nit: Our classes follow the pattern FooView and FooViewModel, which would make this class here \"PhotoViewModel\". To make it clear this is specifically a photo in a form field, PhotoFieldView and PhotoFieldViewModel might be more appropriate.", "url": "https://github.com/google/ground-android/pull/386#discussion_r393773667", "createdAt": "2020-03-17T15:40:43Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/common/ViewModelModule.java", "diffHunk": "@@ -96,6 +97,11 @@\n   @ViewModelKey(EditObservationViewModel.class)\n   abstract ViewModel bindEditObservationViewModel(EditObservationViewModel viewModel);\n \n+  @Binds\n+  @IntoMap\n+  @ViewModelKey(PhotoFieldViewModel.class)\n+  abstract ViewModel bindPhotoViewViewModel(PhotoFieldViewModel viewModel);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df8cf46086a03c08f384ffc47bf651eff228ddf4"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MDg0MDgwOnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/PhotoFieldViewModel.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNTo0MzoyOVrOF3iLlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNTo0MzoyOVrOF3iLlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc3NjAyMA==", "bodyText": "Nit: Please use a more specific method name like updateField. In general avoid capital case in Java method names (updateUi instead of updateUI).", "url": "https://github.com/google/ground-android/pull/386#discussion_r393776020", "createdAt": "2020-03-17T15:43:29Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/PhotoFieldViewModel.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd.ui.editobservation;\n+\n+import android.net.Uri;\n+import android.view.View;\n+import androidx.databinding.ObservableMap;\n+import androidx.databinding.ObservableMap.OnMapChangedCallback;\n+import androidx.lifecycle.LiveData;\n+import androidx.lifecycle.MutableLiveData;\n+import com.google.android.gnd.model.form.Field;\n+import com.google.android.gnd.model.observation.Response;\n+import com.google.android.gnd.system.StorageManager;\n+import com.google.android.gnd.ui.common.AbstractViewModel;\n+import javax.inject.Inject;\n+\n+public class PhotoFieldViewModel extends AbstractViewModel {\n+\n+  private final StorageManager storageManager;\n+  private final MutableLiveData<Uri> destinationPath = new MutableLiveData<>();\n+  private final MutableLiveData<Integer> photoPreviewVisibility = new MutableLiveData<>(View.GONE);\n+\n+  @Inject\n+  PhotoFieldViewModel(StorageManager storageManager) {\n+    this.storageManager = storageManager;\n+  }\n+\n+  public LiveData<Uri> getDestinationPath() {\n+    return destinationPath;\n+  }\n+\n+  public MutableLiveData<Integer> photoPreviewVisibility() {\n+    return photoPreviewVisibility;\n+  }\n+\n+  public void init(Field field, ObservableMap<String, Response> responses) {\n+    // Load last saved value\n+    updateUI(responses.get(field.getId()), field);\n+\n+    // Observe response updates\n+    responses.addOnMapChangedCallback(\n+        new OnMapChangedCallback<ObservableMap<String, Response>, String, Response>() {\n+          @Override\n+          public void onMapChanged(ObservableMap<String, Response> sender, String key) {\n+            if (key.equals(field.getId())) {\n+              updateUI(sender.get(key), field);\n+            }\n+          }\n+        });\n+  }\n+\n+  private void updateUI(Response response, Field field) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df8cf46086a03c08f384ffc47bf651eff228ddf4"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MDg2MDIwOnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/PhotoFieldViewModel.java", "isResolved": true, "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNTo0Nzo0NVrOF3iYIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMDo1NzoyNlrOF3txSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc3OTIzMg==", "bodyText": "This will accumulate subscriptions in the viewmodel ad infinitum every time a photo is changed during the viewmodel's lifecycle. That's probably ok in practice since the user will never likely do this so many times we'll run out of memory, but it is a form of memory leak that as a general rule we're designing to avoid.\nThe \"right\", safe way to do this would be to create a PublishSubject<Optional<String>> destinationPath class member that emits the path or empty when this method is called. Then in the constructor, you would define LiveData<Optional<Uri>> uri using something like:\n  this.uri = LiveDataReactiveStreams.fromPublisher(\n    destinationPath.switchMap(path -> path.map(storageManager::loadUriFromDestinationPath).orElse(Observable.of(Optional.empty()))));\nVisibility could be defined in a similar way:\n  this.uri = LiveDataReactiveStreams.fromPublisher(\n    destinationPath.map(path -> path.isPresent() ? View..VISIBLE : View.GONE));\nThis method would then simply call destinationPath.onNext with either Optional.empty() or the URI.\nWdyt?", "url": "https://github.com/google/ground-android/pull/386#discussion_r393779232", "createdAt": "2020-03-17T15:47:45Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/PhotoFieldViewModel.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd.ui.editobservation;\n+\n+import android.net.Uri;\n+import android.view.View;\n+import androidx.databinding.ObservableMap;\n+import androidx.databinding.ObservableMap.OnMapChangedCallback;\n+import androidx.lifecycle.LiveData;\n+import androidx.lifecycle.MutableLiveData;\n+import com.google.android.gnd.model.form.Field;\n+import com.google.android.gnd.model.observation.Response;\n+import com.google.android.gnd.system.StorageManager;\n+import com.google.android.gnd.ui.common.AbstractViewModel;\n+import javax.inject.Inject;\n+\n+public class PhotoFieldViewModel extends AbstractViewModel {\n+\n+  private final StorageManager storageManager;\n+  private final MutableLiveData<Uri> destinationPath = new MutableLiveData<>();\n+  private final MutableLiveData<Integer> photoPreviewVisibility = new MutableLiveData<>(View.GONE);\n+\n+  @Inject\n+  PhotoFieldViewModel(StorageManager storageManager) {\n+    this.storageManager = storageManager;\n+  }\n+\n+  public LiveData<Uri> getDestinationPath() {\n+    return destinationPath;\n+  }\n+\n+  public MutableLiveData<Integer> photoPreviewVisibility() {\n+    return photoPreviewVisibility;\n+  }\n+\n+  public void init(Field field, ObservableMap<String, Response> responses) {\n+    // Load last saved value\n+    updateUI(responses.get(field.getId()), field);\n+\n+    // Observe response updates\n+    responses.addOnMapChangedCallback(\n+        new OnMapChangedCallback<ObservableMap<String, Response>, String, Response>() {\n+          @Override\n+          public void onMapChanged(ObservableMap<String, Response> sender, String key) {\n+            if (key.equals(field.getId())) {\n+              updateUI(sender.get(key), field);\n+            }\n+          }\n+        });\n+  }\n+\n+  private void updateUI(Response response, Field field) {\n+    if (response == null) {\n+      photoPreviewVisibility.setValue(View.GONE);\n+    } else {\n+      String value = response.getDetailsText(field);\n+      if (value.isEmpty()) {\n+        photoPreviewVisibility.setValue(View.GONE);\n+      } else {\n+        photoPreviewVisibility.setValue(View.VISIBLE);\n+        disposeOnClear(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df8cf46086a03c08f384ffc47bf651eff228ddf4"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc5ODM1MQ==", "bodyText": "Looks so clean. \u2728", "url": "https://github.com/google/ground-android/pull/386#discussion_r393798351", "createdAt": "2020-03-17T16:13:25Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/PhotoFieldViewModel.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd.ui.editobservation;\n+\n+import android.net.Uri;\n+import android.view.View;\n+import androidx.databinding.ObservableMap;\n+import androidx.databinding.ObservableMap.OnMapChangedCallback;\n+import androidx.lifecycle.LiveData;\n+import androidx.lifecycle.MutableLiveData;\n+import com.google.android.gnd.model.form.Field;\n+import com.google.android.gnd.model.observation.Response;\n+import com.google.android.gnd.system.StorageManager;\n+import com.google.android.gnd.ui.common.AbstractViewModel;\n+import javax.inject.Inject;\n+\n+public class PhotoFieldViewModel extends AbstractViewModel {\n+\n+  private final StorageManager storageManager;\n+  private final MutableLiveData<Uri> destinationPath = new MutableLiveData<>();\n+  private final MutableLiveData<Integer> photoPreviewVisibility = new MutableLiveData<>(View.GONE);\n+\n+  @Inject\n+  PhotoFieldViewModel(StorageManager storageManager) {\n+    this.storageManager = storageManager;\n+  }\n+\n+  public LiveData<Uri> getDestinationPath() {\n+    return destinationPath;\n+  }\n+\n+  public MutableLiveData<Integer> photoPreviewVisibility() {\n+    return photoPreviewVisibility;\n+  }\n+\n+  public void init(Field field, ObservableMap<String, Response> responses) {\n+    // Load last saved value\n+    updateUI(responses.get(field.getId()), field);\n+\n+    // Observe response updates\n+    responses.addOnMapChangedCallback(\n+        new OnMapChangedCallback<ObservableMap<String, Response>, String, Response>() {\n+          @Override\n+          public void onMapChanged(ObservableMap<String, Response> sender, String key) {\n+            if (key.equals(field.getId())) {\n+              updateUI(sender.get(key), field);\n+            }\n+          }\n+        });\n+  }\n+\n+  private void updateUI(Response response, Field field) {\n+    if (response == null) {\n+      photoPreviewVisibility.setValue(View.GONE);\n+    } else {\n+      String value = response.getDetailsText(field);\n+      if (value.isEmpty()) {\n+        photoPreviewVisibility.setValue(View.GONE);\n+      } else {\n+        photoPreviewVisibility.setValue(View.VISIBLE);\n+        disposeOnClear(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc3OTIzMg=="}, "originalCommit": {"oid": "df8cf46086a03c08f384ffc47bf651eff228ddf4"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc5OTEzOQ==", "bodyText": "\ud83c\udf1f", "url": "https://github.com/google/ground-android/pull/386#discussion_r393799139", "createdAt": "2020-03-17T16:14:30Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/PhotoFieldViewModel.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd.ui.editobservation;\n+\n+import android.net.Uri;\n+import android.view.View;\n+import androidx.databinding.ObservableMap;\n+import androidx.databinding.ObservableMap.OnMapChangedCallback;\n+import androidx.lifecycle.LiveData;\n+import androidx.lifecycle.MutableLiveData;\n+import com.google.android.gnd.model.form.Field;\n+import com.google.android.gnd.model.observation.Response;\n+import com.google.android.gnd.system.StorageManager;\n+import com.google.android.gnd.ui.common.AbstractViewModel;\n+import javax.inject.Inject;\n+\n+public class PhotoFieldViewModel extends AbstractViewModel {\n+\n+  private final StorageManager storageManager;\n+  private final MutableLiveData<Uri> destinationPath = new MutableLiveData<>();\n+  private final MutableLiveData<Integer> photoPreviewVisibility = new MutableLiveData<>(View.GONE);\n+\n+  @Inject\n+  PhotoFieldViewModel(StorageManager storageManager) {\n+    this.storageManager = storageManager;\n+  }\n+\n+  public LiveData<Uri> getDestinationPath() {\n+    return destinationPath;\n+  }\n+\n+  public MutableLiveData<Integer> photoPreviewVisibility() {\n+    return photoPreviewVisibility;\n+  }\n+\n+  public void init(Field field, ObservableMap<String, Response> responses) {\n+    // Load last saved value\n+    updateUI(responses.get(field.getId()), field);\n+\n+    // Observe response updates\n+    responses.addOnMapChangedCallback(\n+        new OnMapChangedCallback<ObservableMap<String, Response>, String, Response>() {\n+          @Override\n+          public void onMapChanged(ObservableMap<String, Response> sender, String key) {\n+            if (key.equals(field.getId())) {\n+              updateUI(sender.get(key), field);\n+            }\n+          }\n+        });\n+  }\n+\n+  private void updateUI(Response response, Field field) {\n+    if (response == null) {\n+      photoPreviewVisibility.setValue(View.GONE);\n+    } else {\n+      String value = response.getDetailsText(field);\n+      if (value.isEmpty()) {\n+        photoPreviewVisibility.setValue(View.GONE);\n+      } else {\n+        photoPreviewVisibility.setValue(View.VISIBLE);\n+        disposeOnClear(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc3OTIzMg=="}, "originalCommit": {"oid": "df8cf46086a03c08f384ffc47bf651eff228ddf4"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg1Njg3NA==", "bodyText": "I am having a hard time creating the uri LiveData object.\nFor visibility, the below code works\n    photoPreviewVisibility =\n        LiveDataReactiveStreams.fromPublisher(\n            destinationPath\n                .map(path -> path.isPresent() ? View.VISIBLE : View.GONE)\n                .toFlowable(BackpressureStrategy.LATEST));\n\nBut for Uri, I can't get the correct RxChain\nloadUriFromDestinationPath(path) returns Single<Uri>", "url": "https://github.com/google/ground-android/pull/386#discussion_r393856874", "createdAt": "2020-03-17T17:40:53Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/PhotoFieldViewModel.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd.ui.editobservation;\n+\n+import android.net.Uri;\n+import android.view.View;\n+import androidx.databinding.ObservableMap;\n+import androidx.databinding.ObservableMap.OnMapChangedCallback;\n+import androidx.lifecycle.LiveData;\n+import androidx.lifecycle.MutableLiveData;\n+import com.google.android.gnd.model.form.Field;\n+import com.google.android.gnd.model.observation.Response;\n+import com.google.android.gnd.system.StorageManager;\n+import com.google.android.gnd.ui.common.AbstractViewModel;\n+import javax.inject.Inject;\n+\n+public class PhotoFieldViewModel extends AbstractViewModel {\n+\n+  private final StorageManager storageManager;\n+  private final MutableLiveData<Uri> destinationPath = new MutableLiveData<>();\n+  private final MutableLiveData<Integer> photoPreviewVisibility = new MutableLiveData<>(View.GONE);\n+\n+  @Inject\n+  PhotoFieldViewModel(StorageManager storageManager) {\n+    this.storageManager = storageManager;\n+  }\n+\n+  public LiveData<Uri> getDestinationPath() {\n+    return destinationPath;\n+  }\n+\n+  public MutableLiveData<Integer> photoPreviewVisibility() {\n+    return photoPreviewVisibility;\n+  }\n+\n+  public void init(Field field, ObservableMap<String, Response> responses) {\n+    // Load last saved value\n+    updateUI(responses.get(field.getId()), field);\n+\n+    // Observe response updates\n+    responses.addOnMapChangedCallback(\n+        new OnMapChangedCallback<ObservableMap<String, Response>, String, Response>() {\n+          @Override\n+          public void onMapChanged(ObservableMap<String, Response> sender, String key) {\n+            if (key.equals(field.getId())) {\n+              updateUI(sender.get(key), field);\n+            }\n+          }\n+        });\n+  }\n+\n+  private void updateUI(Response response, Field field) {\n+    if (response == null) {\n+      photoPreviewVisibility.setValue(View.GONE);\n+    } else {\n+      String value = response.getDetailsText(field);\n+      if (value.isEmpty()) {\n+        photoPreviewVisibility.setValue(View.GONE);\n+      } else {\n+        photoPreviewVisibility.setValue(View.VISIBLE);\n+        disposeOnClear(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc3OTIzMg=="}, "originalCommit": {"oid": "df8cf46086a03c08f384ffc47bf651eff228ddf4"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg2NzAzOQ==", "bodyText": "If you replace destinationPath with a PublishProcessor you can get rid of the .toFlowable. Looking into the right syntax for your case now.", "url": "https://github.com/google/ground-android/pull/386#discussion_r393867039", "createdAt": "2020-03-17T17:57:09Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/PhotoFieldViewModel.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd.ui.editobservation;\n+\n+import android.net.Uri;\n+import android.view.View;\n+import androidx.databinding.ObservableMap;\n+import androidx.databinding.ObservableMap.OnMapChangedCallback;\n+import androidx.lifecycle.LiveData;\n+import androidx.lifecycle.MutableLiveData;\n+import com.google.android.gnd.model.form.Field;\n+import com.google.android.gnd.model.observation.Response;\n+import com.google.android.gnd.system.StorageManager;\n+import com.google.android.gnd.ui.common.AbstractViewModel;\n+import javax.inject.Inject;\n+\n+public class PhotoFieldViewModel extends AbstractViewModel {\n+\n+  private final StorageManager storageManager;\n+  private final MutableLiveData<Uri> destinationPath = new MutableLiveData<>();\n+  private final MutableLiveData<Integer> photoPreviewVisibility = new MutableLiveData<>(View.GONE);\n+\n+  @Inject\n+  PhotoFieldViewModel(StorageManager storageManager) {\n+    this.storageManager = storageManager;\n+  }\n+\n+  public LiveData<Uri> getDestinationPath() {\n+    return destinationPath;\n+  }\n+\n+  public MutableLiveData<Integer> photoPreviewVisibility() {\n+    return photoPreviewVisibility;\n+  }\n+\n+  public void init(Field field, ObservableMap<String, Response> responses) {\n+    // Load last saved value\n+    updateUI(responses.get(field.getId()), field);\n+\n+    // Observe response updates\n+    responses.addOnMapChangedCallback(\n+        new OnMapChangedCallback<ObservableMap<String, Response>, String, Response>() {\n+          @Override\n+          public void onMapChanged(ObservableMap<String, Response> sender, String key) {\n+            if (key.equals(field.getId())) {\n+              updateUI(sender.get(key), field);\n+            }\n+          }\n+        });\n+  }\n+\n+  private void updateUI(Response response, Field field) {\n+    if (response == null) {\n+      photoPreviewVisibility.setValue(View.GONE);\n+    } else {\n+      String value = response.getDetailsText(field);\n+      if (value.isEmpty()) {\n+        photoPreviewVisibility.setValue(View.GONE);\n+      } else {\n+        photoPreviewVisibility.setValue(View.VISIBLE);\n+        disposeOnClear(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc3OTIzMg=="}, "originalCommit": {"oid": "df8cf46086a03c08f384ffc47bf651eff228ddf4"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg3NDQxNQ==", "bodyText": "Sorry, forgot to mention that after the refactor loadUriFromDestinationPath could now be misleading - it doesn't actually load any data, it just gets the download URL, so it should probably be renamed accordingly (getDownloadUrl could work!)", "url": "https://github.com/google/ground-android/pull/386#discussion_r393874415", "createdAt": "2020-03-17T18:09:09Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/PhotoFieldViewModel.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd.ui.editobservation;\n+\n+import android.net.Uri;\n+import android.view.View;\n+import androidx.databinding.ObservableMap;\n+import androidx.databinding.ObservableMap.OnMapChangedCallback;\n+import androidx.lifecycle.LiveData;\n+import androidx.lifecycle.MutableLiveData;\n+import com.google.android.gnd.model.form.Field;\n+import com.google.android.gnd.model.observation.Response;\n+import com.google.android.gnd.system.StorageManager;\n+import com.google.android.gnd.ui.common.AbstractViewModel;\n+import javax.inject.Inject;\n+\n+public class PhotoFieldViewModel extends AbstractViewModel {\n+\n+  private final StorageManager storageManager;\n+  private final MutableLiveData<Uri> destinationPath = new MutableLiveData<>();\n+  private final MutableLiveData<Integer> photoPreviewVisibility = new MutableLiveData<>(View.GONE);\n+\n+  @Inject\n+  PhotoFieldViewModel(StorageManager storageManager) {\n+    this.storageManager = storageManager;\n+  }\n+\n+  public LiveData<Uri> getDestinationPath() {\n+    return destinationPath;\n+  }\n+\n+  public MutableLiveData<Integer> photoPreviewVisibility() {\n+    return photoPreviewVisibility;\n+  }\n+\n+  public void init(Field field, ObservableMap<String, Response> responses) {\n+    // Load last saved value\n+    updateUI(responses.get(field.getId()), field);\n+\n+    // Observe response updates\n+    responses.addOnMapChangedCallback(\n+        new OnMapChangedCallback<ObservableMap<String, Response>, String, Response>() {\n+          @Override\n+          public void onMapChanged(ObservableMap<String, Response> sender, String key) {\n+            if (key.equals(field.getId())) {\n+              updateUI(sender.get(key), field);\n+            }\n+          }\n+        });\n+  }\n+\n+  private void updateUI(Response response, Field field) {\n+    if (response == null) {\n+      photoPreviewVisibility.setValue(View.GONE);\n+    } else {\n+      String value = response.getDetailsText(field);\n+      if (value.isEmpty()) {\n+        photoPreviewVisibility.setValue(View.GONE);\n+      } else {\n+        photoPreviewVisibility.setValue(View.VISIBLE);\n+        disposeOnClear(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc3OTIzMg=="}, "originalCommit": {"oid": "df8cf46086a03c08f384ffc47bf651eff228ddf4"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg4NDQ3Ng==", "bodyText": "I'd probably do this:\n  private final LiveData<Uri> uri;\n  private final BehaviorProcessor<String> destinationPath = BehaviorProcessor.create();\n\n  @Inject\n  PhotoFieldViewModel(StorageManager storageManager) {\n    this.storageManager = storageManager;\n    this.uri =\n        LiveDataReactiveStreams.fromPublisher(\n            destinationPath.switchMapSingle(this::getDownloadUrl));\n  }\n\n  private Single<Uri> getDownloadUrl(String path) {\n    return path.isEmpty() ? Single.just(Uri.EMPTY) : storageManager.getDownloadUrl(path);\n  }\nA few things to note:\n\nUri and String already have non-null representations of an \"empty\" state, so using those instead of introducing another edge state with Optional simplifies this logic. The binding may need to be updated to handle this case.\nUse switchMapSingle to introduce a single into the stream\nUse *Processor to get a Flowable straight away\nUsing BehaviorProcessor to cache the last value. Late subscribers will get the last value of the Uri.\n\nHTH!", "url": "https://github.com/google/ground-android/pull/386#discussion_r393884476", "createdAt": "2020-03-17T18:26:10Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/PhotoFieldViewModel.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd.ui.editobservation;\n+\n+import android.net.Uri;\n+import android.view.View;\n+import androidx.databinding.ObservableMap;\n+import androidx.databinding.ObservableMap.OnMapChangedCallback;\n+import androidx.lifecycle.LiveData;\n+import androidx.lifecycle.MutableLiveData;\n+import com.google.android.gnd.model.form.Field;\n+import com.google.android.gnd.model.observation.Response;\n+import com.google.android.gnd.system.StorageManager;\n+import com.google.android.gnd.ui.common.AbstractViewModel;\n+import javax.inject.Inject;\n+\n+public class PhotoFieldViewModel extends AbstractViewModel {\n+\n+  private final StorageManager storageManager;\n+  private final MutableLiveData<Uri> destinationPath = new MutableLiveData<>();\n+  private final MutableLiveData<Integer> photoPreviewVisibility = new MutableLiveData<>(View.GONE);\n+\n+  @Inject\n+  PhotoFieldViewModel(StorageManager storageManager) {\n+    this.storageManager = storageManager;\n+  }\n+\n+  public LiveData<Uri> getDestinationPath() {\n+    return destinationPath;\n+  }\n+\n+  public MutableLiveData<Integer> photoPreviewVisibility() {\n+    return photoPreviewVisibility;\n+  }\n+\n+  public void init(Field field, ObservableMap<String, Response> responses) {\n+    // Load last saved value\n+    updateUI(responses.get(field.getId()), field);\n+\n+    // Observe response updates\n+    responses.addOnMapChangedCallback(\n+        new OnMapChangedCallback<ObservableMap<String, Response>, String, Response>() {\n+          @Override\n+          public void onMapChanged(ObservableMap<String, Response> sender, String key) {\n+            if (key.equals(field.getId())) {\n+              updateUI(sender.get(key), field);\n+            }\n+          }\n+        });\n+  }\n+\n+  private void updateUI(Response response, Field field) {\n+    if (response == null) {\n+      photoPreviewVisibility.setValue(View.GONE);\n+    } else {\n+      String value = response.getDetailsText(field);\n+      if (value.isEmpty()) {\n+        photoPreviewVisibility.setValue(View.GONE);\n+      } else {\n+        photoPreviewVisibility.setValue(View.VISIBLE);\n+        disposeOnClear(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc3OTIzMg=="}, "originalCommit": {"oid": "df8cf46086a03c08f384ffc47bf651eff228ddf4"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk2NTg5Nw==", "bodyText": "To be precise, I can't convert Single to Optional in the below chain. The only way I can think of doing it in the below code is by subscribing loadUriFromDestinationPath inside map but that would defeat the entire purpose of this refactor.\n    uri =\n        LiveDataReactiveStreams.fromPublisher(\n            Flowable.fromPublisher(destinationPath)\n                .map(Optional::get)\n                .map(storageManager::loadUriFromDestinationPath));", "url": "https://github.com/google/ground-android/pull/386#discussion_r393965897", "createdAt": "2020-03-17T20:57:26Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/PhotoFieldViewModel.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd.ui.editobservation;\n+\n+import android.net.Uri;\n+import android.view.View;\n+import androidx.databinding.ObservableMap;\n+import androidx.databinding.ObservableMap.OnMapChangedCallback;\n+import androidx.lifecycle.LiveData;\n+import androidx.lifecycle.MutableLiveData;\n+import com.google.android.gnd.model.form.Field;\n+import com.google.android.gnd.model.observation.Response;\n+import com.google.android.gnd.system.StorageManager;\n+import com.google.android.gnd.ui.common.AbstractViewModel;\n+import javax.inject.Inject;\n+\n+public class PhotoFieldViewModel extends AbstractViewModel {\n+\n+  private final StorageManager storageManager;\n+  private final MutableLiveData<Uri> destinationPath = new MutableLiveData<>();\n+  private final MutableLiveData<Integer> photoPreviewVisibility = new MutableLiveData<>(View.GONE);\n+\n+  @Inject\n+  PhotoFieldViewModel(StorageManager storageManager) {\n+    this.storageManager = storageManager;\n+  }\n+\n+  public LiveData<Uri> getDestinationPath() {\n+    return destinationPath;\n+  }\n+\n+  public MutableLiveData<Integer> photoPreviewVisibility() {\n+    return photoPreviewVisibility;\n+  }\n+\n+  public void init(Field field, ObservableMap<String, Response> responses) {\n+    // Load last saved value\n+    updateUI(responses.get(field.getId()), field);\n+\n+    // Observe response updates\n+    responses.addOnMapChangedCallback(\n+        new OnMapChangedCallback<ObservableMap<String, Response>, String, Response>() {\n+          @Override\n+          public void onMapChanged(ObservableMap<String, Response> sender, String key) {\n+            if (key.equals(field.getId())) {\n+              updateUI(sender.get(key), field);\n+            }\n+          }\n+        });\n+  }\n+\n+  private void updateUI(Response response, Field field) {\n+    if (response == null) {\n+      photoPreviewVisibility.setValue(View.GONE);\n+    } else {\n+      String value = response.getDetailsText(field);\n+      if (value.isEmpty()) {\n+        photoPreviewVisibility.setValue(View.GONE);\n+      } else {\n+        photoPreviewVisibility.setValue(View.VISIBLE);\n+        disposeOnClear(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc3OTIzMg=="}, "originalCommit": {"oid": "df8cf46086a03c08f384ffc47bf651eff228ddf4"}, "originalPosition": 75}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MDg2Mzc0OnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/PhotoFieldViewModel.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNTo0ODoyOVrOF3iaXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNjoxNTowOVrOF3jnnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc3OTgwNg==", "bodyText": "I'm a bit confused by the naming here - it appears Uris are loaded from destination paths, therefore they're not equivalent. If that's the case, shouldn't this be called uri instead?", "url": "https://github.com/google/ground-android/pull/386#discussion_r393779806", "createdAt": "2020-03-17T15:48:29Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/PhotoFieldViewModel.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd.ui.editobservation;\n+\n+import android.net.Uri;\n+import android.view.View;\n+import androidx.databinding.ObservableMap;\n+import androidx.databinding.ObservableMap.OnMapChangedCallback;\n+import androidx.lifecycle.LiveData;\n+import androidx.lifecycle.MutableLiveData;\n+import com.google.android.gnd.model.form.Field;\n+import com.google.android.gnd.model.observation.Response;\n+import com.google.android.gnd.system.StorageManager;\n+import com.google.android.gnd.ui.common.AbstractViewModel;\n+import javax.inject.Inject;\n+\n+public class PhotoFieldViewModel extends AbstractViewModel {\n+\n+  private final StorageManager storageManager;\n+  private final MutableLiveData<Uri> destinationPath = new MutableLiveData<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df8cf46086a03c08f384ffc47bf651eff228ddf4"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc5ODg1Nw==", "bodyText": "My bad, thanks for pointing it out", "url": "https://github.com/google/ground-android/pull/386#discussion_r393798857", "createdAt": "2020-03-17T16:14:07Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/PhotoFieldViewModel.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd.ui.editobservation;\n+\n+import android.net.Uri;\n+import android.view.View;\n+import androidx.databinding.ObservableMap;\n+import androidx.databinding.ObservableMap.OnMapChangedCallback;\n+import androidx.lifecycle.LiveData;\n+import androidx.lifecycle.MutableLiveData;\n+import com.google.android.gnd.model.form.Field;\n+import com.google.android.gnd.model.observation.Response;\n+import com.google.android.gnd.system.StorageManager;\n+import com.google.android.gnd.ui.common.AbstractViewModel;\n+import javax.inject.Inject;\n+\n+public class PhotoFieldViewModel extends AbstractViewModel {\n+\n+  private final StorageManager storageManager;\n+  private final MutableLiveData<Uri> destinationPath = new MutableLiveData<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc3OTgwNg=="}, "originalCommit": {"oid": "df8cf46086a03c08f384ffc47bf651eff228ddf4"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc5OTU4MA==", "bodyText": "Np! Thanks for all the careful code hygiene overall!", "url": "https://github.com/google/ground-android/pull/386#discussion_r393799580", "createdAt": "2020-03-17T16:15:09Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/PhotoFieldViewModel.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd.ui.editobservation;\n+\n+import android.net.Uri;\n+import android.view.View;\n+import androidx.databinding.ObservableMap;\n+import androidx.databinding.ObservableMap.OnMapChangedCallback;\n+import androidx.lifecycle.LiveData;\n+import androidx.lifecycle.MutableLiveData;\n+import com.google.android.gnd.model.form.Field;\n+import com.google.android.gnd.model.observation.Response;\n+import com.google.android.gnd.system.StorageManager;\n+import com.google.android.gnd.ui.common.AbstractViewModel;\n+import javax.inject.Inject;\n+\n+public class PhotoFieldViewModel extends AbstractViewModel {\n+\n+  private final StorageManager storageManager;\n+  private final MutableLiveData<Uri> destinationPath = new MutableLiveData<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc3OTgwNg=="}, "originalCommit": {"oid": "df8cf46086a03c08f384ffc47bf651eff228ddf4"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MDkwMDc4OnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/ui/observationdetails/ObservationDetailsFragment.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNTo1Njo0MFrOF3iyzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxNzo1MjozOVrOF4QgyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc4NjA2MQ==", "bodyText": "Same here - subscriptions should only be made inside lifecycle methods so they can be properly disposed of in their equivalent end lifecycle methods. To do this safely, you can create a PublishSubject in the view model that gets exposed to the fragment as a LiveData. Let's discuss if it's not clear how to do this here.", "url": "https://github.com/google/ground-android/pull/386#discussion_r393786061", "createdAt": "2020-03-17T15:56:40Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/observationdetails/ObservationDetailsFragment.java", "diffHunk": "@@ -159,7 +163,18 @@ private void addField(Field field, Observation observation) {\n                 binding.fieldValue.setVisibility(View.GONE);\n                 binding.imagePreview.setVisibility(View.VISIBLE);\n \n-                storageManager.loadPhotoFromDestinationPath(binding.imagePreview, value);\n+                storageManager", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df8cf46086a03c08f384ffc47bf651eff228ddf4"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUzNTExMg==", "bodyText": "Added a TODO", "url": "https://github.com/google/ground-android/pull/386#discussion_r394535112", "createdAt": "2020-03-18T17:52:39Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/observationdetails/ObservationDetailsFragment.java", "diffHunk": "@@ -159,7 +163,18 @@ private void addField(Field field, Observation observation) {\n                 binding.fieldValue.setVisibility(View.GONE);\n                 binding.imagePreview.setVisibility(View.VISIBLE);\n \n-                storageManager.loadPhotoFromDestinationPath(binding.imagePreview, value);\n+                storageManager", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc4NjA2MQ=="}, "originalCommit": {"oid": "df8cf46086a03c08f384ffc47bf651eff228ddf4"}, "originalPosition": 54}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2629, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}