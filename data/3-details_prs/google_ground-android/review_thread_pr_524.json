{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0NTcyMjA4", "number": 524, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxMTowNzo0N1rOELpCwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxMTowNzo0N1rOELpCwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNjQyMjQwOnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationViewModel.java", "isResolved": false, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxMTowNzo0N1rOGtS5Sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNDoyODoxMlrOGtZs_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE0ODY4Mw==", "bodyText": "Just an observation, the viewmodel's saveProgressVisibility property could be refactored to isSaving and the visibility logic could then be handled in the layout XML using databinding e.g. android:visibility=\"@{viewmodel.isSaving ? View.VISIBLE : View.GONE}\"", "url": "https://github.com/google/ground-android/pull/524#discussion_r450148683", "createdAt": "2020-07-06T11:07:47Z", "author": {"login": "dturner"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationViewModel.java", "diffHunk": "@@ -303,21 +293,13 @@ private void onObservationLoaded(Observation observation) {\n   }\n \n   private Single<Event<SaveResult>> save() {\n-    savingProgressVisibility.setValue(View.VISIBLE);\n-    ObservationMutation observationMutation =\n-        ObservationMutation.builder()\n-            .setType(isNew ? ObservationMutation.Type.CREATE : ObservationMutation.Type.UPDATE)\n-            .setProjectId(originalObservation.getProject().getId())\n-            .setFeatureId(originalObservation.getFeature().getId())\n-            .setLayerId(originalObservation.getFeature().getLayer().getId())\n-            .setObservationId(originalObservation.getId())\n-            .setFormId(originalObservation.getForm().getId())\n-            .setResponseDeltas(getResponseDeltas())\n-            .setClientTimestamp(new Date())\n-            .setUserId(authManager.getCurrentUser().getId())\n-            .build();\n+    if (originalObservation == null) {\n+      return Single.error(new IllegalStateException(\"Observation is null\"));\n+    }\n+\n     return observationRepository\n-        .applyAndEnqueue(observationMutation)\n+        .addObservationMutation(originalObservation, getResponseDeltas(), isNew)\n+        .doOnSubscribe(disposable -> savingProgressVisibility.setValue(View.VISIBLE))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b58b5aba771579bec909844ab9c0c420fa2ba201"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE1Njg3Nw==", "bodyText": "Thanks for the comment! We are already using databinding for toggling the visibility. The only difference is, currently the binded object is an integer type whose value is equal to one of the visibility values. And in this scenario, we would use a boolean type instead with the suggested refactor. Any particular reason for using boolean over integer type?", "url": "https://github.com/google/ground-android/pull/524#discussion_r450156877", "createdAt": "2020-07-06T11:26:28Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationViewModel.java", "diffHunk": "@@ -303,21 +293,13 @@ private void onObservationLoaded(Observation observation) {\n   }\n \n   private Single<Event<SaveResult>> save() {\n-    savingProgressVisibility.setValue(View.VISIBLE);\n-    ObservationMutation observationMutation =\n-        ObservationMutation.builder()\n-            .setType(isNew ? ObservationMutation.Type.CREATE : ObservationMutation.Type.UPDATE)\n-            .setProjectId(originalObservation.getProject().getId())\n-            .setFeatureId(originalObservation.getFeature().getId())\n-            .setLayerId(originalObservation.getFeature().getLayer().getId())\n-            .setObservationId(originalObservation.getId())\n-            .setFormId(originalObservation.getForm().getId())\n-            .setResponseDeltas(getResponseDeltas())\n-            .setClientTimestamp(new Date())\n-            .setUserId(authManager.getCurrentUser().getId())\n-            .build();\n+    if (originalObservation == null) {\n+      return Single.error(new IllegalStateException(\"Observation is null\"));\n+    }\n+\n     return observationRepository\n-        .applyAndEnqueue(observationMutation)\n+        .addObservationMutation(originalObservation, getResponseDeltas(), isNew)\n+        .doOnSubscribe(disposable -> savingProgressVisibility.setValue(View.VISIBLE))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE0ODY4Mw=="}, "originalCommit": {"oid": "b58b5aba771579bec909844ab9c0c420fa2ba201"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE2NDE5Mg==", "bodyText": "Yeah, it's really only a minor thing. The reason for using boolean over integer is that it represents the 2 saving states: \"saving\" and \"not saving\".\nCurrently the savingProgressVisibility integer maps to the 3 possible visibility states: visible, invisible and gone. We don't seem to use \"invisible\" so refactoring to isSaving.setValue(true) makes the code (albeit only slightly) more readable.", "url": "https://github.com/google/ground-android/pull/524#discussion_r450164192", "createdAt": "2020-07-06T11:42:33Z", "author": {"login": "dturner"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationViewModel.java", "diffHunk": "@@ -303,21 +293,13 @@ private void onObservationLoaded(Observation observation) {\n   }\n \n   private Single<Event<SaveResult>> save() {\n-    savingProgressVisibility.setValue(View.VISIBLE);\n-    ObservationMutation observationMutation =\n-        ObservationMutation.builder()\n-            .setType(isNew ? ObservationMutation.Type.CREATE : ObservationMutation.Type.UPDATE)\n-            .setProjectId(originalObservation.getProject().getId())\n-            .setFeatureId(originalObservation.getFeature().getId())\n-            .setLayerId(originalObservation.getFeature().getLayer().getId())\n-            .setObservationId(originalObservation.getId())\n-            .setFormId(originalObservation.getForm().getId())\n-            .setResponseDeltas(getResponseDeltas())\n-            .setClientTimestamp(new Date())\n-            .setUserId(authManager.getCurrentUser().getId())\n-            .build();\n+    if (originalObservation == null) {\n+      return Single.error(new IllegalStateException(\"Observation is null\"));\n+    }\n+\n     return observationRepository\n-        .applyAndEnqueue(observationMutation)\n+        .addObservationMutation(originalObservation, getResponseDeltas(), isNew)\n+        .doOnSubscribe(disposable -> savingProgressVisibility.setValue(View.VISIBLE))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE0ODY4Mw=="}, "originalCommit": {"oid": "b58b5aba771579bec909844ab9c0c420fa2ba201"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE2NTc3OA==", "bodyText": "I did the refactor on ObservationListViewModel - see what you think :) https://github.com/shobhitagarwal1612/ground-android/pull/1/files", "url": "https://github.com/google/ground-android/pull/524#discussion_r450165778", "createdAt": "2020-07-06T11:45:58Z", "author": {"login": "dturner"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationViewModel.java", "diffHunk": "@@ -303,21 +293,13 @@ private void onObservationLoaded(Observation observation) {\n   }\n \n   private Single<Event<SaveResult>> save() {\n-    savingProgressVisibility.setValue(View.VISIBLE);\n-    ObservationMutation observationMutation =\n-        ObservationMutation.builder()\n-            .setType(isNew ? ObservationMutation.Type.CREATE : ObservationMutation.Type.UPDATE)\n-            .setProjectId(originalObservation.getProject().getId())\n-            .setFeatureId(originalObservation.getFeature().getId())\n-            .setLayerId(originalObservation.getFeature().getLayer().getId())\n-            .setObservationId(originalObservation.getId())\n-            .setFormId(originalObservation.getForm().getId())\n-            .setResponseDeltas(getResponseDeltas())\n-            .setClientTimestamp(new Date())\n-            .setUserId(authManager.getCurrentUser().getId())\n-            .build();\n+    if (originalObservation == null) {\n+      return Single.error(new IllegalStateException(\"Observation is null\"));\n+    }\n+\n     return observationRepository\n-        .applyAndEnqueue(observationMutation)\n+        .addObservationMutation(originalObservation, getResponseDeltas(), isNew)\n+        .doOnSubscribe(disposable -> savingProgressVisibility.setValue(View.VISIBLE))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE0ODY4Mw=="}, "originalCommit": {"oid": "b58b5aba771579bec909844ab9c0c420fa2ba201"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE2ODA0Nw==", "bodyText": "I like this better. Thanks for the suggestion!\nWould you like to open a PR with the proposed changes? If not, then I'd be more than happy to do it on your behalf. \ud83d\ude04", "url": "https://github.com/google/ground-android/pull/524#discussion_r450168047", "createdAt": "2020-07-06T11:50:52Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationViewModel.java", "diffHunk": "@@ -303,21 +293,13 @@ private void onObservationLoaded(Observation observation) {\n   }\n \n   private Single<Event<SaveResult>> save() {\n-    savingProgressVisibility.setValue(View.VISIBLE);\n-    ObservationMutation observationMutation =\n-        ObservationMutation.builder()\n-            .setType(isNew ? ObservationMutation.Type.CREATE : ObservationMutation.Type.UPDATE)\n-            .setProjectId(originalObservation.getProject().getId())\n-            .setFeatureId(originalObservation.getFeature().getId())\n-            .setLayerId(originalObservation.getFeature().getLayer().getId())\n-            .setObservationId(originalObservation.getId())\n-            .setFormId(originalObservation.getForm().getId())\n-            .setResponseDeltas(getResponseDeltas())\n-            .setClientTimestamp(new Date())\n-            .setUserId(authManager.getCurrentUser().getId())\n-            .build();\n+    if (originalObservation == null) {\n+      return Single.error(new IllegalStateException(\"Observation is null\"));\n+    }\n+\n     return observationRepository\n-        .applyAndEnqueue(observationMutation)\n+        .addObservationMutation(originalObservation, getResponseDeltas(), isNew)\n+        .doOnSubscribe(disposable -> savingProgressVisibility.setValue(View.VISIBLE))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE0ODY4Mw=="}, "originalCommit": {"oid": "b58b5aba771579bec909844ab9c0c420fa2ba201"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE5OTE0Nw==", "bodyText": "I'm happy to do it. Will do shortly.", "url": "https://github.com/google/ground-android/pull/524#discussion_r450199147", "createdAt": "2020-07-06T12:52:55Z", "author": {"login": "dturner"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationViewModel.java", "diffHunk": "@@ -303,21 +293,13 @@ private void onObservationLoaded(Observation observation) {\n   }\n \n   private Single<Event<SaveResult>> save() {\n-    savingProgressVisibility.setValue(View.VISIBLE);\n-    ObservationMutation observationMutation =\n-        ObservationMutation.builder()\n-            .setType(isNew ? ObservationMutation.Type.CREATE : ObservationMutation.Type.UPDATE)\n-            .setProjectId(originalObservation.getProject().getId())\n-            .setFeatureId(originalObservation.getFeature().getId())\n-            .setLayerId(originalObservation.getFeature().getLayer().getId())\n-            .setObservationId(originalObservation.getId())\n-            .setFormId(originalObservation.getForm().getId())\n-            .setResponseDeltas(getResponseDeltas())\n-            .setClientTimestamp(new Date())\n-            .setUserId(authManager.getCurrentUser().getId())\n-            .build();\n+    if (originalObservation == null) {\n+      return Single.error(new IllegalStateException(\"Observation is null\"));\n+    }\n+\n     return observationRepository\n-        .applyAndEnqueue(observationMutation)\n+        .addObservationMutation(originalObservation, getResponseDeltas(), isNew)\n+        .doOnSubscribe(disposable -> savingProgressVisibility.setValue(View.VISIBLE))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE0ODY4Mw=="}, "originalCommit": {"oid": "b58b5aba771579bec909844ab9c0c420fa2ba201"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDI2MDIyMQ==", "bodyText": "#529", "url": "https://github.com/google/ground-android/pull/524#discussion_r450260221", "createdAt": "2020-07-06T14:28:12Z", "author": {"login": "dturner"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/EditObservationViewModel.java", "diffHunk": "@@ -303,21 +293,13 @@ private void onObservationLoaded(Observation observation) {\n   }\n \n   private Single<Event<SaveResult>> save() {\n-    savingProgressVisibility.setValue(View.VISIBLE);\n-    ObservationMutation observationMutation =\n-        ObservationMutation.builder()\n-            .setType(isNew ? ObservationMutation.Type.CREATE : ObservationMutation.Type.UPDATE)\n-            .setProjectId(originalObservation.getProject().getId())\n-            .setFeatureId(originalObservation.getFeature().getId())\n-            .setLayerId(originalObservation.getFeature().getLayer().getId())\n-            .setObservationId(originalObservation.getId())\n-            .setFormId(originalObservation.getForm().getId())\n-            .setResponseDeltas(getResponseDeltas())\n-            .setClientTimestamp(new Date())\n-            .setUserId(authManager.getCurrentUser().getId())\n-            .build();\n+    if (originalObservation == null) {\n+      return Single.error(new IllegalStateException(\"Observation is null\"));\n+    }\n+\n     return observationRepository\n-        .applyAndEnqueue(observationMutation)\n+        .addObservationMutation(originalObservation, getResponseDeltas(), isNew)\n+        .doOnSubscribe(disposable -> savingProgressVisibility.setValue(View.VISIBLE))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE0ODY4Mw=="}, "originalCommit": {"oid": "b58b5aba771579bec909844ab9c0c420fa2ba201"}, "originalPosition": 83}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2502, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}