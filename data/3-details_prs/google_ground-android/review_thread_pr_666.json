{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ0NTc2NTM2", "number": 666, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxNDozMTowNFrOFImEHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxNToyMToxNVrOFInBfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0NTU2NTczOnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/ui/home/AddFeatureDialogFragment.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxNDozMTowNFrOIKmaow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxNDozMTowNFrOIKmaow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzk4NjA4Mw==", "bodyText": "@NonNull is the default now, so these annotations can be removed.", "url": "https://github.com/google/ground-android/pull/666#discussion_r547986083", "createdAt": "2020-12-23T14:31:04Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/home/AddFeatureDialogFragment.java", "diffHunk": "@@ -21,107 +21,74 @@\n \n import android.app.Dialog;\n import android.os.Bundle;\n+import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n import androidx.appcompat.app.AlertDialog;\n import androidx.fragment.app.FragmentManager;\n import com.google.android.gnd.R;\n-import com.google.android.gnd.model.AuditInfo;\n import com.google.android.gnd.model.Project;\n-import com.google.android.gnd.model.feature.Feature;\n-import com.google.android.gnd.model.feature.Point;\n import com.google.android.gnd.model.layer.Layer;\n-import com.google.android.gnd.persistence.uuid.OfflineUuidGenerator;\n-import com.google.android.gnd.rx.Loadable;\n-import com.google.android.gnd.system.auth.AuthenticationManager;\n import com.google.android.gnd.ui.common.AbstractDialogFragment;\n-import com.google.android.gnd.ui.home.mapcontainer.MapContainerViewModel;\n-import com.google.android.gnd.ui.map.CameraPosition;\n import com.google.common.collect.ImmutableList;\n import dagger.hilt.android.AndroidEntryPoint;\n-import io.reactivex.Maybe;\n-import io.reactivex.subjects.MaybeSubject;\n import java8.util.Objects;\n import javax.inject.Inject;\n+import timber.log.Timber;\n \n @AndroidEntryPoint\n public class AddFeatureDialogFragment extends AbstractDialogFragment {\n+\n   private static final String TAG = AddFeatureDialogFragment.class.getSimpleName();\n-  private final OfflineUuidGenerator uuidGenerator;\n-  private final AuthenticationManager authManager;\n \n-  private final MaybeSubject<Feature> addFeatureRequestSubject = MaybeSubject.create();\n-  private HomeScreenViewModel homeScreenViewModel;\n-  private MapContainerViewModel mapContainerViewModel;\n+  @Nullable private Project project;\n+  @Nullable private LayerSelectedListener listener;\n \n   @Inject\n-  public AddFeatureDialogFragment(\n-      OfflineUuidGenerator uuidGenerator, AuthenticationManager authManager) {\n-    this.uuidGenerator = uuidGenerator;\n-    this.authManager = authManager;\n-  }\n-\n-  @Override\n-  public void onCreate(@Nullable Bundle savedInstanceState) {\n-    super.onCreate(savedInstanceState);\n-    // TODO: Move into new AddFeatureDialogViewModel?\n-    this.homeScreenViewModel = getViewModel(HomeScreenViewModel.class);\n-    this.mapContainerViewModel = getViewModel(MapContainerViewModel.class);\n-  }\n+  public AddFeatureDialogFragment() {}\n \n-  public Maybe<Feature> show(FragmentManager fragmentManager) {\n+  public void show(\n+      @NonNull Project project,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3477afd7f36ee481fdce80a24b96670082efaa84"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0NTU2NzY5OnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/ui/home/AddFeatureDialogFragment.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxNDozMTozOVrOIKmbvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxNDozMTozOVrOIKmbvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzk4NjM2Nw==", "bodyText": "Same here.", "url": "https://github.com/google/ground-android/pull/666#discussion_r547986367", "createdAt": "2020-12-23T14:31:39Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/home/AddFeatureDialogFragment.java", "diffHunk": "@@ -21,107 +21,74 @@\n \n import android.app.Dialog;\n import android.os.Bundle;\n+import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n import androidx.appcompat.app.AlertDialog;\n import androidx.fragment.app.FragmentManager;\n import com.google.android.gnd.R;\n-import com.google.android.gnd.model.AuditInfo;\n import com.google.android.gnd.model.Project;\n-import com.google.android.gnd.model.feature.Feature;\n-import com.google.android.gnd.model.feature.Point;\n import com.google.android.gnd.model.layer.Layer;\n-import com.google.android.gnd.persistence.uuid.OfflineUuidGenerator;\n-import com.google.android.gnd.rx.Loadable;\n-import com.google.android.gnd.system.auth.AuthenticationManager;\n import com.google.android.gnd.ui.common.AbstractDialogFragment;\n-import com.google.android.gnd.ui.home.mapcontainer.MapContainerViewModel;\n-import com.google.android.gnd.ui.map.CameraPosition;\n import com.google.common.collect.ImmutableList;\n import dagger.hilt.android.AndroidEntryPoint;\n-import io.reactivex.Maybe;\n-import io.reactivex.subjects.MaybeSubject;\n import java8.util.Objects;\n import javax.inject.Inject;\n+import timber.log.Timber;\n \n @AndroidEntryPoint\n public class AddFeatureDialogFragment extends AbstractDialogFragment {\n+\n   private static final String TAG = AddFeatureDialogFragment.class.getSimpleName();\n-  private final OfflineUuidGenerator uuidGenerator;\n-  private final AuthenticationManager authManager;\n \n-  private final MaybeSubject<Feature> addFeatureRequestSubject = MaybeSubject.create();\n-  private HomeScreenViewModel homeScreenViewModel;\n-  private MapContainerViewModel mapContainerViewModel;\n+  @Nullable private Project project;\n+  @Nullable private LayerSelectedListener listener;\n \n   @Inject\n-  public AddFeatureDialogFragment(\n-      OfflineUuidGenerator uuidGenerator, AuthenticationManager authManager) {\n-    this.uuidGenerator = uuidGenerator;\n-    this.authManager = authManager;\n-  }\n-\n-  @Override\n-  public void onCreate(@Nullable Bundle savedInstanceState) {\n-    super.onCreate(savedInstanceState);\n-    // TODO: Move into new AddFeatureDialogViewModel?\n-    this.homeScreenViewModel = getViewModel(HomeScreenViewModel.class);\n-    this.mapContainerViewModel = getViewModel(MapContainerViewModel.class);\n-  }\n+  public AddFeatureDialogFragment() {}\n \n-  public Maybe<Feature> show(FragmentManager fragmentManager) {\n+  public void show(\n+      @NonNull Project project,\n+      @NonNull FragmentManager fragmentManager,\n+      @NonNull LayerSelectedListener listener) {\n+    this.project = project;\n+    this.listener = listener;\n     show(fragmentManager, TAG);\n-    return addFeatureRequestSubject;\n   }\n \n+  @NonNull", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3477afd7f36ee481fdce80a24b96670082efaa84"}, "originalPosition": 68}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0NTU5Mjg2OnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/ui/home/HomeScreenViewModel.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxNDo0MDowOVrOIKmqVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxNDo0MDowOVrOIKmqVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzk5MDEwMQ==", "bodyText": "Instantiating a new features, assigning UUID and AuditInfo sounds like a job for the FeatureRepository. Can we move this there? (newFeature?)", "url": "https://github.com/google/ground-android/pull/666#discussion_r547990101", "createdAt": "2020-12-23T14:40:09Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/home/HomeScreenViewModel.java", "diffHunk": "@@ -148,6 +159,20 @@ public void addFeature(Feature feature) {\n     addFeatureClicks.onNext(feature);\n   }\n \n+  public void addFeature(Project project, Layer layer, Point point) {\n+    AuditInfo auditInfo = AuditInfo.now(authManager.getCurrentUser());\n+    Feature feature =\n+        Feature.newBuilder()\n+            .setId(uuidGenerator.generateUuid())\n+            .setProject(project)\n+            .setLayer(layer)\n+            .setPoint(point)\n+            .setCreated(auditInfo)\n+            .setLastModified(auditInfo)\n+            .build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3477afd7f36ee481fdce80a24b96670082efaa84"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0NTcyMDU3OnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/ui/home/AddFeatureDialogFragment.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxNToyMDozM1rOIKn1Hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNFQwNTowNDo1MlrOIK-rjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODAwOTI0Ng==", "bodyText": "The listener reference should be removed to prevent memory leaks when the dialog is closed to prevent memory leaks. @dturner Please cmiiw.", "url": "https://github.com/google/ground-android/pull/666#discussion_r548009246", "createdAt": "2020-12-23T15:20:33Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/home/AddFeatureDialogFragment.java", "diffHunk": "@@ -21,107 +21,74 @@\n \n import android.app.Dialog;\n import android.os.Bundle;\n+import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n import androidx.appcompat.app.AlertDialog;\n import androidx.fragment.app.FragmentManager;\n import com.google.android.gnd.R;\n-import com.google.android.gnd.model.AuditInfo;\n import com.google.android.gnd.model.Project;\n-import com.google.android.gnd.model.feature.Feature;\n-import com.google.android.gnd.model.feature.Point;\n import com.google.android.gnd.model.layer.Layer;\n-import com.google.android.gnd.persistence.uuid.OfflineUuidGenerator;\n-import com.google.android.gnd.rx.Loadable;\n-import com.google.android.gnd.system.auth.AuthenticationManager;\n import com.google.android.gnd.ui.common.AbstractDialogFragment;\n-import com.google.android.gnd.ui.home.mapcontainer.MapContainerViewModel;\n-import com.google.android.gnd.ui.map.CameraPosition;\n import com.google.common.collect.ImmutableList;\n import dagger.hilt.android.AndroidEntryPoint;\n-import io.reactivex.Maybe;\n-import io.reactivex.subjects.MaybeSubject;\n import java8.util.Objects;\n import javax.inject.Inject;\n+import timber.log.Timber;\n \n @AndroidEntryPoint\n public class AddFeatureDialogFragment extends AbstractDialogFragment {\n+\n   private static final String TAG = AddFeatureDialogFragment.class.getSimpleName();\n-  private final OfflineUuidGenerator uuidGenerator;\n-  private final AuthenticationManager authManager;\n \n-  private final MaybeSubject<Feature> addFeatureRequestSubject = MaybeSubject.create();\n-  private HomeScreenViewModel homeScreenViewModel;\n-  private MapContainerViewModel mapContainerViewModel;\n+  @Nullable private Project project;\n+  @Nullable private LayerSelectedListener listener;\n \n   @Inject\n-  public AddFeatureDialogFragment(\n-      OfflineUuidGenerator uuidGenerator, AuthenticationManager authManager) {\n-    this.uuidGenerator = uuidGenerator;\n-    this.authManager = authManager;\n-  }\n-\n-  @Override\n-  public void onCreate(@Nullable Bundle savedInstanceState) {\n-    super.onCreate(savedInstanceState);\n-    // TODO: Move into new AddFeatureDialogViewModel?\n-    this.homeScreenViewModel = getViewModel(HomeScreenViewModel.class);\n-    this.mapContainerViewModel = getViewModel(MapContainerViewModel.class);\n-  }\n+  public AddFeatureDialogFragment() {}\n \n-  public Maybe<Feature> show(FragmentManager fragmentManager) {\n+  public void show(\n+      @NonNull Project project,\n+      @NonNull FragmentManager fragmentManager,\n+      @NonNull LayerSelectedListener listener) {\n+    this.project = project;\n+    this.listener = listener;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3477afd7f36ee481fdce80a24b96670082efaa84"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODM4MzYzMA==", "bodyText": "Removed the reference on destroy.", "url": "https://github.com/google/ground-android/pull/666#discussion_r548383630", "createdAt": "2020-12-24T05:04:52Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/home/AddFeatureDialogFragment.java", "diffHunk": "@@ -21,107 +21,74 @@\n \n import android.app.Dialog;\n import android.os.Bundle;\n+import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n import androidx.appcompat.app.AlertDialog;\n import androidx.fragment.app.FragmentManager;\n import com.google.android.gnd.R;\n-import com.google.android.gnd.model.AuditInfo;\n import com.google.android.gnd.model.Project;\n-import com.google.android.gnd.model.feature.Feature;\n-import com.google.android.gnd.model.feature.Point;\n import com.google.android.gnd.model.layer.Layer;\n-import com.google.android.gnd.persistence.uuid.OfflineUuidGenerator;\n-import com.google.android.gnd.rx.Loadable;\n-import com.google.android.gnd.system.auth.AuthenticationManager;\n import com.google.android.gnd.ui.common.AbstractDialogFragment;\n-import com.google.android.gnd.ui.home.mapcontainer.MapContainerViewModel;\n-import com.google.android.gnd.ui.map.CameraPosition;\n import com.google.common.collect.ImmutableList;\n import dagger.hilt.android.AndroidEntryPoint;\n-import io.reactivex.Maybe;\n-import io.reactivex.subjects.MaybeSubject;\n import java8.util.Objects;\n import javax.inject.Inject;\n+import timber.log.Timber;\n \n @AndroidEntryPoint\n public class AddFeatureDialogFragment extends AbstractDialogFragment {\n+\n   private static final String TAG = AddFeatureDialogFragment.class.getSimpleName();\n-  private final OfflineUuidGenerator uuidGenerator;\n-  private final AuthenticationManager authManager;\n \n-  private final MaybeSubject<Feature> addFeatureRequestSubject = MaybeSubject.create();\n-  private HomeScreenViewModel homeScreenViewModel;\n-  private MapContainerViewModel mapContainerViewModel;\n+  @Nullable private Project project;\n+  @Nullable private LayerSelectedListener listener;\n \n   @Inject\n-  public AddFeatureDialogFragment(\n-      OfflineUuidGenerator uuidGenerator, AuthenticationManager authManager) {\n-    this.uuidGenerator = uuidGenerator;\n-    this.authManager = authManager;\n-  }\n-\n-  @Override\n-  public void onCreate(@Nullable Bundle savedInstanceState) {\n-    super.onCreate(savedInstanceState);\n-    // TODO: Move into new AddFeatureDialogViewModel?\n-    this.homeScreenViewModel = getViewModel(HomeScreenViewModel.class);\n-    this.mapContainerViewModel = getViewModel(MapContainerViewModel.class);\n-  }\n+  public AddFeatureDialogFragment() {}\n \n-  public Maybe<Feature> show(FragmentManager fragmentManager) {\n+  public void show(\n+      @NonNull Project project,\n+      @NonNull FragmentManager fragmentManager,\n+      @NonNull LayerSelectedListener listener) {\n+    this.project = project;\n+    this.listener = listener;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODAwOTI0Ng=="}, "originalCommit": {"oid": "3477afd7f36ee481fdce80a24b96670082efaa84"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0NTcyMjg2OnYy", "diffSide": "RIGHT", "path": "gnd/src/main/java/com/google/android/gnd/ui/home/AddFeatureDialogFragment.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxNToyMToxNVrOIKn2dw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxNToyMToxNVrOIKn2dw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODAwOTU5MQ==", "bodyText": "Instead of defining a custom functional interface, you should be able to use Consumer<Layer>.", "url": "https://github.com/google/ground-android/pull/666#discussion_r548009591", "createdAt": "2020-12-23T15:21:15Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/home/AddFeatureDialogFragment.java", "diffHunk": "@@ -21,107 +21,74 @@\n \n import android.app.Dialog;\n import android.os.Bundle;\n+import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n import androidx.appcompat.app.AlertDialog;\n import androidx.fragment.app.FragmentManager;\n import com.google.android.gnd.R;\n-import com.google.android.gnd.model.AuditInfo;\n import com.google.android.gnd.model.Project;\n-import com.google.android.gnd.model.feature.Feature;\n-import com.google.android.gnd.model.feature.Point;\n import com.google.android.gnd.model.layer.Layer;\n-import com.google.android.gnd.persistence.uuid.OfflineUuidGenerator;\n-import com.google.android.gnd.rx.Loadable;\n-import com.google.android.gnd.system.auth.AuthenticationManager;\n import com.google.android.gnd.ui.common.AbstractDialogFragment;\n-import com.google.android.gnd.ui.home.mapcontainer.MapContainerViewModel;\n-import com.google.android.gnd.ui.map.CameraPosition;\n import com.google.common.collect.ImmutableList;\n import dagger.hilt.android.AndroidEntryPoint;\n-import io.reactivex.Maybe;\n-import io.reactivex.subjects.MaybeSubject;\n import java8.util.Objects;\n import javax.inject.Inject;\n+import timber.log.Timber;\n \n @AndroidEntryPoint\n public class AddFeatureDialogFragment extends AbstractDialogFragment {\n+\n   private static final String TAG = AddFeatureDialogFragment.class.getSimpleName();\n-  private final OfflineUuidGenerator uuidGenerator;\n-  private final AuthenticationManager authManager;\n \n-  private final MaybeSubject<Feature> addFeatureRequestSubject = MaybeSubject.create();\n-  private HomeScreenViewModel homeScreenViewModel;\n-  private MapContainerViewModel mapContainerViewModel;\n+  @Nullable private Project project;\n+  @Nullable private LayerSelectedListener listener;\n \n   @Inject\n-  public AddFeatureDialogFragment(\n-      OfflineUuidGenerator uuidGenerator, AuthenticationManager authManager) {\n-    this.uuidGenerator = uuidGenerator;\n-    this.authManager = authManager;\n-  }\n-\n-  @Override\n-  public void onCreate(@Nullable Bundle savedInstanceState) {\n-    super.onCreate(savedInstanceState);\n-    // TODO: Move into new AddFeatureDialogViewModel?\n-    this.homeScreenViewModel = getViewModel(HomeScreenViewModel.class);\n-    this.mapContainerViewModel = getViewModel(MapContainerViewModel.class);\n-  }\n+  public AddFeatureDialogFragment() {}\n \n-  public Maybe<Feature> show(FragmentManager fragmentManager) {\n+  public void show(\n+      @NonNull Project project,\n+      @NonNull FragmentManager fragmentManager,\n+      @NonNull LayerSelectedListener listener) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3477afd7f36ee481fdce80a24b96670082efaa84"}, "originalPosition": 61}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2431, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}