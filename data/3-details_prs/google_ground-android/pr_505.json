{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwODkyMDQ2", "number": 505, "title": "Migrate codebase from Dagger to Hilt", "bodyText": "Hilt is a new DI framework for Android built on top of Dagger. It provides the same features in a simplified way by removing much of the heavy lifting associated with Dagger.\nThis PR migrates the Ground codebase from Dagger and dagger.android to Hilt. I followed the migration guide here and had some help from Manuel Vivo.\nHere's the summary of work:\n\nMigrate from GndApplicationComponent to Hilt's ApplicationComponent\nUse @AndroidEntryPoint to install activities and fragments into Hilt's corresponding components\nRemove dagger.android dependencies\nMigrate GndWorkerFactory to Jetpack's HiltWorkerFactory", "createdAt": "2020-06-27T10:18:09Z", "url": "https://github.com/google/ground-android/pull/505", "merged": true, "mergeCommit": {"oid": "fb29556eb11af93b186ca56a7bed858ff7f4b06b"}, "closed": true, "closedAt": "2020-06-30T20:02:08Z", "author": {"login": "dturner"}, "timelineItems": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuvn4jAH2gAyNDQwODkyMDQ2OjBmYjliM2M5NzdiYWZkMDk3NjllOGRkNDgxMDg4ODE0YzAwYjIwNDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwbSWyAFqTQ0MDM0MzYyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0fb9b3c977bafd09769e8dd481088814c00b2046", "author": {"user": {"login": "dturner", "name": "Don Turner"}}, "url": "https://github.com/google/ground-android/commit/0fb9b3c977bafd09769e8dd481088814c00b2046", "committedDate": "2020-06-25T14:35:42Z", "message": "Add Hilt dependencies"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd6bc120bc371904a79b781353710e85f13e83b8", "author": {"user": {"login": "dturner", "name": "Don Turner"}}, "url": "https://github.com/google/ground-android/commit/cd6bc120bc371904a79b781353710e85f13e83b8", "committedDate": "2020-06-25T15:43:14Z", "message": "Migrate to Hilt ApplicationComponent"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c82c34c5639e76ec849bad1dce983fa856209804", "author": {"user": {"login": "dturner", "name": "Don Turner"}}, "url": "https://github.com/google/ground-android/commit/c82c34c5639e76ec849bad1dce983fa856209804", "committedDate": "2020-06-25T15:51:47Z", "message": "Migrate to using Hilt Activity and Fragment components"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a90339e4b51093fb888a57607225e9af50aa582", "author": {"user": {"login": "dturner", "name": "Don Turner"}}, "url": "https://github.com/google/ground-android/commit/2a90339e4b51093fb888a57607225e9af50aa582", "committedDate": "2020-06-25T16:12:55Z", "message": "Remove Dagger Android dependencies"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2bd68e33450e7c9e82aff29587c3bf2059ac5792", "author": {"user": {"login": "dturner", "name": "Don Turner"}}, "url": "https://github.com/google/ground-android/commit/2bd68e33450e7c9e82aff29587c3bf2059ac5792", "committedDate": "2020-06-25T16:23:27Z", "message": "Removing redundant classes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac19b61e1108c5ae17a9cc89b1f6106fb8141f54", "author": {"user": {"login": "dturner", "name": "Don Turner"}}, "url": "https://github.com/google/ground-android/commit/ac19b61e1108c5ae17a9cc89b1f6106fb8141f54", "committedDate": "2020-06-26T21:26:48Z", "message": "Remove Dagger dependencies and commmented out code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2439d4d13b3a93dbc1322aaeaaa2bf0f07065e7", "author": {"user": {"login": "dturner", "name": "Don Turner"}}, "url": "https://github.com/google/ground-android/commit/c2439d4d13b3a93dbc1322aaeaaa2bf0f07065e7", "committedDate": "2020-06-26T22:13:34Z", "message": "Replace GndWorkerFactory with HiltWorkerFactory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec50db26fdc01a849d5f65cd21739e9374cb984a", "author": {"user": {"login": "dturner", "name": "Don Turner"}}, "url": "https://github.com/google/ground-android/commit/ec50db26fdc01a849d5f65cd21739e9374cb984a", "committedDate": "2020-06-27T09:56:57Z", "message": "Fix blank screen on startup by scoping Navigator to Activity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eefd2165ef0309bf2ec78cd778a25c4db6b4d391", "author": {"user": {"login": "dturner", "name": "Don Turner"}}, "url": "https://github.com/google/ground-android/commit/eefd2165ef0309bf2ec78cd778a25c4db6b4d391", "committedDate": "2020-06-27T09:57:19Z", "message": "Remove old modules"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0243bbc6aa03fa18fa2129c06272ee65ed560c5", "author": {"user": {"login": "dturner", "name": "Don Turner"}}, "url": "https://github.com/google/ground-android/commit/a0243bbc6aa03fa18fa2129c06272ee65ed560c5", "committedDate": "2020-06-27T10:34:54Z", "message": "Remove commented out code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f990c7822cff88dfe0322bbb28e429d02bf67366", "author": {"user": {"login": "dturner", "name": "Don Turner"}}, "url": "https://github.com/google/ground-android/commit/f990c7822cff88dfe0322bbb28e429d02bf67366", "committedDate": "2020-06-27T10:35:29Z", "message": "Add back @ActivityScoped to classes where it was accidentally removed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4ODAxMTkw", "url": "https://github.com/google/ground-android/pull/505#pullrequestreview-438801190", "createdAt": "2020-06-28T18:04:02Z", "commit": {"oid": "f990c7822cff88dfe0322bbb28e429d02bf67366"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4ODAxNDA1", "url": "https://github.com/google/ground-android/pull/505#pullrequestreview-438801405", "createdAt": "2020-06-28T18:07:07Z", "commit": {"oid": "f990c7822cff88dfe0322bbb28e429d02bf67366"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "544079b790d7c69ba04d412c1c44a2f59af58121", "author": {"user": {"login": "dturner", "name": "Don Turner"}}, "url": "https://github.com/google/ground-android/commit/544079b790d7c69ba04d412c1c44a2f59af58121", "committedDate": "2020-06-28T19:48:33Z", "message": "Fix checkstyle issue - line length"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9e306889a16d0bec87a61095e9299bd9d68a157f", "author": {"user": {"login": "dturner", "name": "Don Turner"}}, "url": "https://github.com/google/ground-android/commit/9e306889a16d0bec87a61095e9299bd9d68a157f", "committedDate": "2020-06-29T10:58:59Z", "message": "Migrate robolectric tests"}, "afterCommit": {"oid": "9dcc1da4d10465ff13b7adfdea23295a22567bb5", "author": {"user": {"login": "dturner", "name": "Don Turner"}}, "url": "https://github.com/google/ground-android/commit/9dcc1da4d10465ff13b7adfdea23295a22567bb5", "committedDate": "2020-06-29T11:04:16Z", "message": "Migrate robolectric tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f0f425729e7f789f199a6be2c71a5e582d44816", "author": {"user": {"login": "dturner", "name": "Don Turner"}}, "url": "https://github.com/google/ground-android/commit/8f0f425729e7f789f199a6be2c71a5e582d44816", "committedDate": "2020-06-29T11:16:49Z", "message": "Migrate robolectric tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9dcc1da4d10465ff13b7adfdea23295a22567bb5", "author": {"user": {"login": "dturner", "name": "Don Turner"}}, "url": "https://github.com/google/ground-android/commit/9dcc1da4d10465ff13b7adfdea23295a22567bb5", "committedDate": "2020-06-29T11:04:16Z", "message": "Migrate robolectric tests"}, "afterCommit": {"oid": "8f0f425729e7f789f199a6be2c71a5e582d44816", "author": {"user": {"login": "dturner", "name": "Don Turner"}}, "url": "https://github.com/google/ground-android/commit/8f0f425729e7f789f199a6be2c71a5e582d44816", "committedDate": "2020-06-29T11:16:49Z", "message": "Migrate robolectric tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79c2bc2c73eaed5fd2a5fad340e5bfd3f1a560c9", "author": {"user": {"login": "dturner", "name": "Don Turner"}}, "url": "https://github.com/google/ground-android/commit/79c2bc2c73eaed5fd2a5fad340e5bfd3f1a560c9", "committedDate": "2020-06-29T11:36:50Z", "message": "Remove the default WorkManager initializer (which was causing lintDebug to fail)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "decbe2a9bd850bd12915930382e2511648dc64a5", "author": {"user": {"login": "dturner", "name": "Don Turner"}}, "url": "https://github.com/google/ground-android/commit/decbe2a9bd850bd12915930382e2511648dc64a5", "committedDate": "2020-06-29T13:12:13Z", "message": "Fix PMD errors. Remove unused imports & change MainActivity super.onCreate call order"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5MTY3NDI4", "url": "https://github.com/google/ground-android/pull/505#pullrequestreview-439167428", "createdAt": "2020-06-29T13:54:43Z", "commit": {"oid": "decbe2a9bd850bd12915930382e2511648dc64a5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxMzo1NDo0M1rOGqSFtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxNDowMjo1OFrOGqSdnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk4OTc0OA==", "bodyText": "daggerVersion can be removed from this list now", "url": "https://github.com/google/ground-android/pull/505#discussion_r446989748", "createdAt": "2020-06-29T13:54:43Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/build.gradle", "diffHunk": "@@ -29,6 +30,7 @@ project.ext {\n     daggerVersion = \"2.27\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "decbe2a9bd850bd12915930382e2511648dc64a5"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk5MDkyOA==", "bodyText": "Sorry for nit-picking. But can we please remove the parentheses for consistency across all dependencies?", "url": "https://github.com/google/ground-android/pull/505#discussion_r446990928", "createdAt": "2020-06-29T13:56:17Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/build.gradle", "diffHunk": "@@ -136,14 +141,15 @@ dependencies {\n     implementation 'com.google.firebase:firebase-storage:19.1.1'\n     implementation 'com.google.firebase:firebase-crashlytics:17.0.1'\n \n-    // Dagger\n-    implementation \"com.google.dagger:dagger:$project.daggerVersion\"\n-    implementation \"com.google.dagger:dagger-android:$project.daggerVersion\"\n-    implementation \"com.google.dagger:dagger-android-support:$project.daggerVersion\"\n-    annotationProcessor \"com.google.dagger:dagger-android-processor:$project.daggerVersion\"\n-    annotationProcessor \"com.google.dagger:dagger-compiler:$project.daggerVersion\"\n-    testAnnotationProcessor \"com.google.dagger:dagger-compiler:$project.daggerVersion\"\n-    androidTestAnnotationProcessor \"com.google.dagger:dagger-compiler:$project.daggerVersion\"\n+    // Hilt\n+    implementation(\"com.google.dagger:hilt-android:$project.hiltVersion\")\n+    implementation(\"androidx.hilt:hilt-lifecycle-viewmodel:$project.hiltJetpackVersion\")\n+    implementation(\"androidx.hilt:hilt-work:$project.hiltJetpackVersion\")\n+    androidTestImplementation(\"com.google.dagger:hilt-android-testing:$project.hiltVersion\")\n+    annotationProcessor(\"com.google.dagger:hilt-android-compiler:$project.hiltVersion\")\n+    annotationProcessor(\"androidx.hilt:hilt-compiler:$project.hiltJetpackVersion\")\n+    androidTestAnnotationProcessor(\"com.google.dagger:hilt-android-compiler:$project.hiltVersion\")\n+    androidTestAnnotationProcessor(\"androidx.hilt:hilt-compiler:$project.hiltJetpackVersion\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "decbe2a9bd850bd12915930382e2511648dc64a5"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk5MjI3Mw==", "bodyText": "Can we please move these up with rest of the hilt dependencies?", "url": "https://github.com/google/ground-android/pull/505#discussion_r446992273", "createdAt": "2020-06-29T13:58:04Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/build.gradle", "diffHunk": "@@ -206,6 +212,8 @@ dependencies {\n     testImplementation 'androidx.test:core:1.2.0'\n     testImplementation 'org.robolectric:robolectric:4.3.1'\n     testImplementation 'android.arch.core:core-testing:1.1.1'\n+    testImplementation 'com.google.dagger:hilt-android-testing:2.28-alpha'\n+    testAnnotationProcessor 'com.google.dagger:hilt-android-compiler:2.28-alpha'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "decbe2a9bd850bd12915930382e2511648dc64a5"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk5NTA4OQ==", "bodyText": "I am curious why this is needed? I understand that this is useful when we have to do some custom initialization, but I am not sure that we do. Do we?", "url": "https://github.com/google/ground-android/pull/505#discussion_r446995089", "createdAt": "2020-06-29T14:01:55Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/src/main/AndroidManifest.xml", "diffHunk": "@@ -70,18 +70,11 @@\n       android:name=\"org.apache.http.legacy\"\n       android:required=\"false\" />\n \n-    <!--\n-      Disable WorkManagerInitializer so that we can initialize ourselves in GndApplication setting\n-      custom GndWorkerFactory to perform Dagger injection.\n-      TODO(github.com/google/dagger/issues/1183): Remove this if and when Worker inject is supported\n-      natively.\n-    -->\n+    <!-- Remove the default WorkManager initializer since we are providing our own -->\n     <provider\n       android:name=\"androidx.work.impl.WorkManagerInitializer\"\n-      android:authorities=\"com.google.android.gnd.workmanager-init\"\n-      android:enabled=\"false\"\n-      android:exported=\"false\"\n-      tools:replace=\"android:authorities\" />\n+      android:authorities=\"${applicationId}.workmanager-init\"\n+      tools:node=\"remove\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "decbe2a9bd850bd12915930382e2511648dc64a5"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk5NTg2OA==", "bodyText": "We should update this comment as it is out-of-date now", "url": "https://github.com/google/ground-android/pull/505#discussion_r446995868", "createdAt": "2020-06-29T14:02:58Z", "author": {"login": "shobhitagarwal1612"}, "path": "gnd/src/main/java/com/google/android/gnd/GndApplication.java", "diffHunk": "@@ -16,30 +16,31 @@\n \n package com.google.android.gnd;\n \n+import android.app.Application;\n import android.content.Context;\n import android.os.StrictMode;\n import android.util.Log;\n import androidx.annotation.NonNull;\n+import androidx.hilt.work.HiltWorkerFactory;\n import androidx.multidex.MultiDex;\n import androidx.work.Configuration;\n-import androidx.work.WorkManager;\n import com.akaita.java.rxjava2debug.RxJava2Debug;\n import com.facebook.stetho.Stetho;\n-import com.google.android.gnd.inject.GndWorkerFactory;\n import com.google.android.gnd.rx.RxDebug;\n import com.google.firebase.crashlytics.FirebaseCrashlytics;\n-import dagger.android.AndroidInjector;\n-import dagger.android.support.DaggerApplication;\n+import dagger.hilt.android.HiltAndroidApp;\n import io.reactivex.plugins.RxJavaPlugins;\n import javax.inject.Inject;\n+import org.jetbrains.annotations.NotNull;\n import timber.log.Timber;\n \n // TODO: When implementing background data sync service, we'll need to inject a Service here; we\n // should then extend DaggerApplication instead. If MultiDex is still needed, we can install it\n // without extending MultiDexApplication.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "decbe2a9bd850bd12915930382e2511648dc64a5"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3efe2628d43870844e549ee4bdeae4482cd44eb", "author": {"user": {"login": "dturner", "name": "Don Turner"}}, "url": "https://github.com/google/ground-android/commit/a3efe2628d43870844e549ee4bdeae4482cd44eb", "committedDate": "2020-06-29T14:47:25Z", "message": "Remove daggerVersion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "079a732d2fc2f14b40420b388f6acd653a2da6c4", "author": {"user": {"login": "dturner", "name": "Don Turner"}}, "url": "https://github.com/google/ground-android/commit/079a732d2fc2f14b40420b388f6acd653a2da6c4", "committedDate": "2020-06-29T14:49:06Z", "message": "Remove parenthesis"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f053399a68c1d1cf0847eef403bd37aa4c0516fc", "author": {"user": {"login": "dturner", "name": "Don Turner"}}, "url": "https://github.com/google/ground-android/commit/f053399a68c1d1cf0847eef403bd37aa4c0516fc", "committedDate": "2020-06-29T15:36:19Z", "message": "Fix crash by initializing WorkManager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "698fdc1206f5106a2e2c51fa5fc1f534f0db82fd", "author": {"user": {"login": "dturner", "name": "Don Turner"}}, "url": "https://github.com/google/ground-android/commit/698fdc1206f5106a2e2c51fa5fc1f534f0db82fd", "committedDate": "2020-06-29T16:21:35Z", "message": "Remove comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b9503210d9645b9331b9e26dce284309b63f92b", "author": {"user": {"login": "dturner", "name": "Don Turner"}}, "url": "https://github.com/google/ground-android/commit/6b9503210d9645b9331b9e26dce284309b63f92b", "committedDate": "2020-06-29T16:23:50Z", "message": "Group hilt dependencies together"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NzM1NzU0", "url": "https://github.com/google/ground-android/pull/505#pullrequestreview-439735754", "createdAt": "2020-06-30T07:21:20Z", "commit": {"oid": "6b9503210d9645b9331b9e26dce284309b63f92b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f7433a8ecf5e1ead030223abfa67396bfca3f56", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/2f7433a8ecf5e1ead030223abfa67396bfca3f56", "committedDate": "2020-06-30T19:15:11Z", "message": "Merge branch 'master' into hilt-migration"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwMzQzNjI4", "url": "https://github.com/google/ground-android/pull/505#pullrequestreview-440343628", "createdAt": "2020-06-30T20:01:56Z", "commit": {"oid": "2f7433a8ecf5e1ead030223abfa67396bfca3f56"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1572, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}