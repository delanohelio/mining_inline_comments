{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3MTUxNzU1", "number": 574, "title": "Rename Tile -> TileSource", "bodyText": "TileSource better captures what this object represents--some URL and eventually file path that points to a file that contains tileset data that we can render on the map as an overlay. The old name, Tile, suggests that the object represents a single tile, at a single zoom level, while the tileset files we use actually are pyramidal and contain tiles at multiple zoom levels.\n@gino-m @shobhitagarwal1612\nFixes #400.", "createdAt": "2020-09-01T15:13:09Z", "url": "https://github.com/google/ground-android/pull/574", "merged": true, "mergeCommit": {"oid": "d94e12b952dfe3089058bd8e2bc304fc1b8f8ebe"}, "closed": true, "closedAt": "2020-09-01T17:31:03Z", "author": {"login": "scolsen"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdEo4q3AH2gAyNDc3MTUxNzU1OmZhYWM0NWViNTZhZjQ0ZmZkMDNlZjUzN2RjODEzZmQ3YjVlYjRiZjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdEq3-UgFqTQ3OTk2NzkxOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "faac45eb56af44ffd03ef537dc813fd7b5eb4bf7", "author": {"user": {"login": "scolsen", "name": "Scott Olsen"}}, "url": "https://github.com/google/ground-android/commit/faac45eb56af44ffd03ef537dc813fd7b5eb4bf7", "committedDate": "2020-09-01T15:11:02Z", "message": "Rename Tile -> TileSource\n\nTileSource better captures what this object represents--some URL and eventually file path that points to a file that contains tileset data that we can render on the map as an overlay. The old name, Tile, suggests that the object represents a single tile, at a single zoom level, while the tileset files we use actually are pyramidal and contain tiles at multiple zoom levels."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5ODgwNTIz", "url": "https://github.com/google/ground-android/pull/574#pullrequestreview-479880523", "createdAt": "2020-09-01T15:48:03Z", "commit": {"oid": "faac45eb56af44ffd03ef537dc813fd7b5eb4bf7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxNTo0ODowM1rOHK81mw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxNTo1MDoyMVrOHK87xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTI0NDU3MQ==", "bodyText": "Naming nit: You download tiles from a tile source, so maybe this would make more sense as \"downloadTiles\"?", "url": "https://github.com/google/ground-android/pull/574#discussion_r481244571", "createdAt": "2020-09-01T15:48:03Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/persistence/sync/TileSourceDownloadWorker.java", "diffHunk": "@@ -170,7 +172,7 @@ private Completable processTiles(ImmutableList<Tile> pendingTiles) {\n                 case IN_PROGRESS:\n                 case FAILED:\n                 default:\n-                  return downloadTile(t);\n+                  return downloadTileSource(t);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "faac45eb56af44ffd03ef537dc813fd7b5eb4bf7"}, "originalPosition": 147}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTI0NTAzNA==", "bodyText": "Same comment here - the issue isn't that tiles couldn't be download from the tile source, so I'd still expect this to be a TileDownloadException.", "url": "https://github.com/google/ground-android/pull/574#discussion_r481245034", "createdAt": "2020-09-01T15:48:46Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/persistence/sync/TileSourceDownloadWorker.java", "diffHunk": "@@ -209,8 +212,8 @@ public String getNotificationTitle() {\n     return getApplicationContext().getString(R.string.downloading_tiles);\n   }\n \n-  static class TileDownloadException extends RuntimeException {\n-    TileDownloadException(String msg, Throwable e) {\n+  static class TileSourceDownloadException extends RuntimeException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "faac45eb56af44ffd03ef537dc813fd7b5eb4bf7"}, "originalPosition": 186}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTI0NTEwNQ==", "bodyText": "Same here.", "url": "https://github.com/google/ground-android/pull/574#discussion_r481245105", "createdAt": "2020-09-01T15:48:51Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/repository/OfflineAreaRepository.java", "diffHunk": "@@ -47,7 +47,7 @@\n import timber.log.Timber;\n \n public class OfflineAreaRepository {\n-  private final TileDownloadWorkManager tileDownloadWorkManager;\n+  private final TileSourceDownloadWorkManager tileSourceDownloadWorkManager;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "faac45eb56af44ffd03ef537dc813fd7b5eb4bf7"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTI0NTM3Ng==", "bodyText": "Same - we download tiles, not tile sources.", "url": "https://github.com/google/ground-android/pull/574#discussion_r481245376", "createdAt": "2020-09-01T15:49:15Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/repository/OfflineAreaRepository.java", "diffHunk": "@@ -94,36 +94,36 @@ private File downloadOfflineBaseMapSource(OfflineBaseMapSource offlineBaseMapSou\n     return localFile;\n   }\n \n-  /** Enqueue a single area and its tiles for download. */\n-  private Completable enqueueDownload(OfflineArea area, ImmutableList<Tile> tiles) {\n+  /** Enqueue a single area and its tile sources for download. */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "faac45eb56af44ffd03ef537dc813fd7b5eb4bf7"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTI0NjE1MA==", "bodyText": "This case is a little be trickier - it's not clear how to describe that we're \"getting all tile sources for which all tiles have been downloaded\", so I think it's ok as-is.", "url": "https://github.com/google/ground-android/pull/574#discussion_r481246150", "createdAt": "2020-09-01T15:50:21Z", "author": {"login": "gino-m"}, "path": "gnd/src/main/java/com/google/android/gnd/repository/OfflineAreaRepository.java", "diffHunk": "@@ -164,25 +164,26 @@ public Completable addAreaAndEnqueue(LatLngBounds bounds) {\n     return localDataStore.getOfflineAreaById(offlineAreaId);\n   }\n \n-  public Flowable<ImmutableSet<Tile>> getIntersectingDownloadedTilesOnceAndStream(\n+  public Flowable<ImmutableSet<TileSource>> getIntersectingDownloadedTileSourcesOnceAndStream(\n       OfflineArea offlineArea) {\n-    return getBaseMapTiles(offlineArea)\n+    return getBaseMapTileSources(offlineArea)\n         .flatMapPublisher(\n             tiles ->\n-                getDownloadedTilesOnceAndStream()\n+                getDownloadedTileSourcesOnceAndStream()\n                     .map(ts -> stream(ts).filter(tiles::contains).collect(toImmutableSet())))\n-        // If no tiles are found, we report the area takes up 0.0mb on the device.\n-        .doOnError(throwable -> Timber.d(throwable, \"no tiles found for area %s\", offlineArea))\n+        // If no tile sources are found, we report the area takes up 0.0mb on the device.\n+        .doOnError(\n+            throwable -> Timber.d(throwable, \"no tile sources found for area %s\", offlineArea))\n         .onErrorReturn(__ -> ImmutableSet.of());\n   }\n \n-  public Flowable<ImmutableSet<Tile>> getDownloadedTilesOnceAndStream() {\n+  public Flowable<ImmutableSet<TileSource>> getDownloadedTileSourcesOnceAndStream() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "faac45eb56af44ffd03ef537dc813fd7b5eb4bf7"}, "originalPosition": 123}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5OTY3OTE4", "url": "https://github.com/google/ground-android/pull/574#pullrequestreview-479967918", "createdAt": "2020-09-01T17:30:05Z", "commit": {"oid": "faac45eb56af44ffd03ef537dc813fd7b5eb4bf7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1616, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}