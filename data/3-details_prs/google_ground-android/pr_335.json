{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3Nzg4NTA2", "number": 335, "title": "[Cleanup] Split up GndDirestore", "bodyText": "Closes #322, work towards #323.  Depends on #326.", "createdAt": "2020-01-28T01:45:57Z", "url": "https://github.com/google/ground-android/pull/335", "merged": true, "mergeCommit": {"oid": "ca7f0e1a97f718faf00eb373f8ad4f07001bfff1"}, "closed": true, "closedAt": "2020-01-29T21:37:15Z", "author": {"login": "gino-m"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb-nAuBgH2gAyMzY3Nzg4NTA2OjlkODY1YmUzNmI5MDA5MWQxNzliMDBkODExNjRkNWU4ZjA1M2JlYWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_MwmPAH2gAyMzY3Nzg4NTA2OjA4MDIxNzNlM2IyODU5ZWZmMmJhMzQyZmRjNzhlMDlhN2E3NjU2MDI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9d865be36b90091d179b00d81164d5e8f053beae", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/9d865be36b90091d179b00d81164d5e8f053beae", "committedDate": "2020-01-28T01:25:19Z", "message": "Rename GndFirestore to GroundFirestore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "763554225955118faa8be0331ed134577d8b028e", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/763554225955118faa8be0331ed134577d8b028e", "committedDate": "2020-01-28T01:25:19Z", "message": "Move GroundFirestore into new schema package"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea39e161fd6a68ed763561654014837bdf676807", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/ea39e161fd6a68ed763561654014837bdf676807", "committedDate": "2020-01-28T01:26:38Z", "message": "Remove unused records() method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1fb6f3323dc842246a75bf520bef2b74dbe7c62d", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/1fb6f3323dc842246a75bf520bef2b74dbe7c62d", "committedDate": "2020-01-28T01:33:53Z", "message": "Fix Javadoc typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "398e4136854147bf5b4b2572be037a645c34ef8e", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/398e4136854147bf5b4b2572be037a645c34ef8e", "committedDate": "2020-01-28T01:34:44Z", "message": "Refactor QuerySnapshot converter methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7306d2e8febac52d228e949854267142b6ea5e41", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/7306d2e8febac52d228e949854267142b6ea5e41", "committedDate": "2020-01-28T01:37:03Z", "message": "Extract RecordDocumentReference from GroundFirestore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1464b0c242bd860df2e3a90b0a56e0350e02c46d", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/1464b0c242bd860df2e3a90b0a56e0350e02c46d", "committedDate": "2020-01-28T01:37:32Z", "message": "Extract RecordsCollectionReference from GroundFirestore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8c17490febf4eda7a685aad75e294db3697d4cb", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/f8c17490febf4eda7a685aad75e294db3697d4cb", "committedDate": "2020-01-28T01:38:03Z", "message": "Extract FeatureDocumentReference from GroundFirestore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97a1d8a9fbf857726f16be16ee8887bcc3dcb3ce", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/97a1d8a9fbf857726f16be16ee8887bcc3dcb3ce", "committedDate": "2020-01-28T01:38:26Z", "message": "Extract FeaturesCollectionReference from GroundFirestore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d17bd1c7e7c84044f7f3d7ec285c7fcd7c0fe38", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/8d17bd1c7e7c84044f7f3d7ec285c7fcd7c0fe38", "committedDate": "2020-01-28T01:39:30Z", "message": "Extract ProjectDocumentReference from GroundFirestore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14db2d9aed37668cd0e059e473a51df0fb54c6ae", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/14db2d9aed37668cd0e059e473a51df0fb54c6ae", "committedDate": "2020-01-28T01:39:46Z", "message": "Extract ProjectsCollectionReference from GroundFirestore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aefc89d63ec34896abc1f7e5ccd6b496413306bb", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/aefc89d63ec34896abc1f7e5ccd6b496413306bb", "committedDate": "2020-01-28T01:41:45Z", "message": "Limit visibility of constructors to package"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97548b924ac73f256770c87a1a1558b50c05ffd5", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/97548b924ac73f256770c87a1a1558b50c05ffd5", "committedDate": "2020-01-28T18:54:13Z", "message": "Merge branch 'master' into split-gnd-firestore"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwNDI0MDUw", "url": "https://github.com/google/ground-android/pull/335#pullrequestreview-350424050", "createdAt": "2020-01-29T21:07:05Z", "commit": {"oid": "97548b924ac73f256770c87a1a1558b50c05ffd5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQyMTowNzowNVrOFjXgew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQyMTowNzowNVrOFjXgew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjYyOTYyNw==", "bodyText": "What's the behavior of this in the case of\n\nNo Read Access\nError on the Firebase side.\n\nMy hunch is improper permissions == Single and Firebase error == Single.Error\nis that correct?", "url": "https://github.com/google/ground-android/pull/335#discussion_r372629627", "createdAt": "2020-01-29T21:07:05Z", "author": {"login": "scolsen"}, "path": "gnd/src/main/java/com/google/android/gnd/persistence/remote/firestore/schema/ProjectsCollectionReference.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd.persistence.remote.firestore.schema;\n+\n+import com.google.android.gnd.model.Project;\n+import com.google.android.gnd.model.User;\n+import com.google.android.gnd.persistence.remote.firestore.ProjectDoc;\n+import com.google.android.gnd.persistence.remote.firestore.base.FluentCollectionReference;\n+import com.google.firebase.firestore.CollectionReference;\n+import com.google.firebase.firestore.FieldPath;\n+import io.reactivex.Single;\n+import java.util.List;\n+\n+public class ProjectsCollectionReference extends FluentCollectionReference {\n+  private static final String ACL_FIELD = \"acl\";\n+  private static final String READ_ACCESS = \"r\";\n+\n+  ProjectsCollectionReference(CollectionReference ref) {\n+    super(ref);\n+  }\n+\n+  public ProjectDocumentReference project(String id) {\n+    return new ProjectDocumentReference(reference().document(id));\n+  }\n+\n+  public Single<List<Project>> getReadable(User user) {\n+    return runQuery(\n+        reference().whereArrayContains(FieldPath.of(ACL_FIELD, user.getEmail()), READ_ACCESS),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97548b924ac73f256770c87a1a1558b50c05ffd5"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwNDMyODQw", "url": "https://github.com/google/ground-android/pull/335#pullrequestreview-350432840", "createdAt": "2020-01-29T21:22:04Z", "commit": {"oid": "97548b924ac73f256770c87a1a1558b50c05ffd5"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be7e9ef554766d3256f82104f9511e21775c70a4", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/be7e9ef554766d3256f82104f9511e21775c70a4", "committedDate": "2020-01-29T21:23:00Z", "message": "Merge branch 'master' into split-gnd-firestore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0802173e3b2859eff2ba342fdc78e09a7a765602", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/0802173e3b2859eff2ba342fdc78e09a7a765602", "committedDate": "2020-01-29T21:24:06Z", "message": "Merge branch 'master' into split-gnd-firestore"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1685, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}