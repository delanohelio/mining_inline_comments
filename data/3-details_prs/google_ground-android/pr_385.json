{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1MzM3NzM4", "number": 385, "title": "[Map] Refactor map adapter", "bodyText": "Cleaning up map adapter in preparation for #357 and #364. Main changes:\n\n MapAdapter interface uses MapPin as an abstraction instead of higher level Feature objects, making it easier to implement alternate map providers.\n We split generated of icon bitmaps out of MapPin to allow the map to update them on the fly (e.g., based on zoom level in #364.\n Odds and ends: cleanup unused code, better naming, Javadoc, etc.", "createdAt": "2020-03-09T00:55:43Z", "url": "https://github.com/google/ground-android/pull/385", "merged": true, "mergeCommit": {"oid": "830faa143b0b3b9bc8a764f2d1f61e220e192fb6"}, "closed": true, "closedAt": "2020-03-18T18:55:38Z", "author": {"login": "gino-m"}, "timelineItems": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcLdwexgH2gAyMzg1MzM3NzM4OmRkMDkwYmJiYTAzZDgwZTUwNjVhYTNhMWYxMDllNmFmOTFlNDE1YTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcO73R2AFqTM3NzE0MjcyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dd090bbba03d80e5065aa3a1f109e6af91e415a2", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/dd090bbba03d80e5065aa3a1f109e6af91e415a2", "committedDate": "2020-03-07T23:59:27Z", "message": "Move conversion to/from GMS LatLng into Maps SDK adapter class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "725a4a8c37d69873c15729e41f0968b3f0a226c3", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/725a4a8c37d69873c15729e41f0968b3f0a226c3", "committedDate": "2020-03-08T22:30:55Z", "message": "Rename updateMarkers to setFeatures"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3c629d6f72222c2f97849cbe4e6a1113947d6a2", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/c3c629d6f72222c2f97849cbe4e6a1113947d6a2", "committedDate": "2020-03-08T22:33:28Z", "message": "Add Javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "052a84781b52d7ea1108bbdec16d2d7aafe86c6a", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/052a84781b52d7ea1108bbdec16d2d7aafe86c6a", "committedDate": "2020-03-08T22:35:11Z", "message": "Rename getCameraPosition to getCameraMoves"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2cae2f80738d3304cfe0c0c15004c840eabc46b6", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/2cae2f80738d3304cfe0c0c15004c840eabc46b6", "committedDate": "2020-03-08T22:37:54Z", "message": "Rename getCenter to getCameraTarget"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9aae682a368a427b6a370f055ec3337b5e0bc6c", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/c9aae682a368a427b6a370f055ec3337b5e0bc6c", "committedDate": "2020-03-08T22:43:24Z", "message": "Update Javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b176702193825e69e2f39c9e9e952901ab51acf0", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/b176702193825e69e2f39c9e9e952901ab51acf0", "committedDate": "2020-03-08T23:12:41Z", "message": "Move MapAdapter to top level"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5272e8b409361e2e0e93c947d88a96a5f05fd0e8", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/5272e8b409361e2e0e93c947d88a96a5f05fd0e8", "committedDate": "2020-03-08T23:19:39Z", "message": "Add JavaDoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3658321379bdf273538ee57cdc92dfc28c48097", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/c3658321379bdf273538ee57cdc92dfc28c48097", "committedDate": "2020-03-08T23:47:04Z", "message": "Rename MapMarker to MapPin to disambiguate with GMS Marker class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf1935f20068410498a08183ca4e7979cd184d97", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/cf1935f20068410498a08183ca4e7979cd184d97", "committedDate": "2020-03-08T23:47:16Z", "message": "Make Feature required in MapPin, make MapPin required in Marker"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd2788c4d7ee286bd0ceb5977b1320d7e1d2be89", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/fd2788c4d7ee286bd0ceb5977b1320d7e1d2be89", "committedDate": "2020-03-08T23:56:11Z", "message": "Replace marker cache with Set, since we never access by id"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b833c479f0c227e5f5cbe4163242c4bbd52d061", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/0b833c479f0c227e5f5cbe4163242c4bbd52d061", "committedDate": "2020-03-08T23:57:45Z", "message": "Inline getMapPin method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff7b92fb42f0a4be5264e144f421464409e5c81c", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/ff7b92fb42f0a4be5264e144f421464409e5c81c", "committedDate": "2020-03-09T00:02:02Z", "message": "Remove unused highlighted and pendingWrites marker states"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "231f01e87ec81174ab3f6dd3621efdf7ca8674a4", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/231f01e87ec81174ab3f6dd3621efdf7ca8674a4", "committedDate": "2020-03-09T00:42:40Z", "message": "Fix Javadoc typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f16d3a96b0485c58e92858a208611ed12ae7ec22", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/f16d3a96b0485c58e92858a208611ed12ae7ec22", "committedDate": "2020-03-09T00:43:42Z", "message": "Update MapsAdapter to accept MapPins instead of Features"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c7dbb8b599bc5e4480bbe578d1e222b21b3e314", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/5c7dbb8b599bc5e4480bbe578d1e222b21b3e314", "committedDate": "2020-03-09T00:52:40Z", "message": "Move creation of MapPins into ViewModel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9416796a64c6b840f9a0fde539fd44c7402c70d", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/f9416796a64c6b840f9a0fde539fd44c7402c70d", "committedDate": "2020-03-10T02:05:31Z", "message": "Fix PMD warnings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3a75fd4c6fb18a500d53361ce8f5337502401d0", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/f3a75fd4c6fb18a500d53361ce8f5337502401d0", "committedDate": "2020-03-12T16:54:06Z", "message": "Merge branch 'master' into refactor-map-adapter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MDM1MDU2", "url": "https://github.com/google/ground-android/pull/385#pullrequestreview-377035056", "createdAt": "2020-03-18T16:29:49Z", "commit": {"oid": "f3a75fd4c6fb18a500d53361ce8f5337502401d0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxNjoyOTo0OVrOF4NMsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxNjoyOTo0OVrOF4NMsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ4MDgxOA==", "bodyText": "I'm guessing we can't use this::toMapPins here because it's a static method? gtk!", "url": "https://github.com/google/ground-android/pull/385#discussion_r394480818", "createdAt": "2020-03-18T16:29:49Z", "author": {"login": "scolsen"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/home/mapcontainer/MapContainerViewModel.java", "diffHunk": "@@ -78,12 +81,13 @@\n     // TODO: Clear feature markers when project is deactivated.\n     // TODO: Since we depend on project stream from repo anyway, this transformation can be moved\n     // into the repo?\n-    this.features =\n+    this.mapPins =\n         LiveDataReactiveStreams.fromPublisher(\n             projectRepository\n                 .getActiveProjectOnceAndStream()\n                 .map(Loadable::value)\n-                .switchMap(this::getFeaturesStream));\n+                .switchMap(this::getFeaturesStream)\n+                .map(MapContainerViewModel::toMapPins));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3a75fd4c6fb18a500d53361ce8f5337502401d0"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c89834addd438e03ffc4dab4ec50adc370cf6a2", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/9c89834addd438e03ffc4dab4ec50adc370cf6a2", "committedDate": "2020-03-18T16:33:32Z", "message": "Merge branch 'master' into refactor-map-adapter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MDM2MTcw", "url": "https://github.com/google/ground-android/pull/385#pullrequestreview-377036170", "createdAt": "2020-03-18T16:31:10Z", "commit": {"oid": "f3a75fd4c6fb18a500d53361ce8f5337502401d0"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxNjozMToxMFrOF4NP9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxNjozODo0N1rOF4Nj7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ4MTY1Mg==", "bodyText": "Rename mapMarker to mapPin?", "url": "https://github.com/google/ground-android/pull/385#discussion_r394481652", "createdAt": "2020-03-18T16:31:10Z", "author": {"login": "scolsen"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/home/mapcontainer/MapContainerViewModel.java", "diffHunk": "@@ -162,7 +179,7 @@ public void onMapDrag(Point newCameraPosition) {\n     }\n   }\n \n-  public void onMarkerClick(MapMarker mapMarker) {\n+  public void onMarkerClick(MapPin mapMarker) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3a75fd4c6fb18a500d53361ce8f5337502401d0"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ4Njc2Ng==", "bodyText": "The getViewport method didn't get ported over to the MapAdapter!  I'll need it for offlineareas. It was unused up to this PR tough, so I'm happy to reimplement. Just an FYI.", "url": "https://github.com/google/ground-android/pull/385#discussion_r394486766", "createdAt": "2020-03-18T16:38:47Z", "author": {"login": "scolsen"}, "path": "gnd/src/main/java/com/google/android/gnd/ui/map/MapProvider.java", "diffHunk": "@@ -32,36 +25,4 @@\n   Fragment getFragment();\n \n   Single<MapAdapter> getMapAdapter();\n-\n-  /**\n-   * Interface defining map interactions and events. This a separate class from {@link MapProvider}\n-   * so that it can be returned asynchronously by {@link MapProvider#getMapAdapter()} if necessary.\n-   */\n-  interface MapAdapter {\n-\n-    Observable<MapMarker> getMarkerClicks();\n-\n-    Observable<Point> getDragInteractions();\n-\n-    Observable<Point> getCameraPosition();\n-\n-    void enable();\n-\n-    void disable();\n-\n-    void moveCamera(Point point);\n-\n-    void moveCamera(Point point, float zoomLevel);\n-\n-    Point getCenter();\n-\n-    float getCurrentZoomLevel();\n-\n-    @SuppressLint(\"MissingPermission\")\n-    void enableCurrentLocationIndicator();\n-\n-    void updateMarkers(ImmutableSet<Feature> features);\n-\n-    LatLngBounds getViewport();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c89834addd438e03ffc4dab4ec50adc370cf6a2"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f1aabf9cc09e6b5c2ff255c4f274eee6c68d2e2", "author": {"user": {"login": "shobhitagarwal1612", "name": "Shobhit Agarwal"}}, "url": "https://github.com/google/ground-android/commit/2f1aabf9cc09e6b5c2ff255c4f274eee6c68d2e2", "committedDate": "2020-03-18T17:58:22Z", "message": "Merge branch 'master' into refactor-map-adapter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d714255ac0af0766a1f5f3c5b0bb2b8234d71d8", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/8d714255ac0af0766a1f5f3c5b0bb2b8234d71d8", "committedDate": "2020-03-18T18:34:21Z", "message": "Rename variable to \"pin\""}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e09b346da79c59b64376e9c8dea350f66924847", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/0e09b346da79c59b64376e9c8dea350f66924847", "committedDate": "2020-03-18T18:34:38Z", "message": "Merge remote-tracking branch 'origin/refactor-map-adapter' into refactor-map-adapter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4c29f71b4db8510d844283177aa1a5067d9687e", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/f4c29f71b4db8510d844283177aa1a5067d9687e", "committedDate": "2020-03-18T18:35:03Z", "message": "Fix missing import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07a062465f3c7cbbfa670d155f178980e81fe29a", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/07a062465f3c7cbbfa670d155f178980e81fe29a", "committedDate": "2020-03-18T18:37:38Z", "message": "Restore getViewPort() MapAdapter interface method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50ce8fa307213cf5d9e0dc702fdc228bc0dee659", "author": {"user": {"login": "gino-m", "name": "Gino Miceli"}}, "url": "https://github.com/google/ground-android/commit/50ce8fa307213cf5d9e0dc702fdc228bc0dee659", "committedDate": "2020-03-18T18:40:08Z", "message": "Add missing period in JavaDoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MTQyNzIw", "url": "https://github.com/google/ground-android/pull/385#pullrequestreview-377142720", "createdAt": "2020-03-18T18:45:48Z", "commit": {"oid": "50ce8fa307213cf5d9e0dc702fdc228bc0dee659"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1725, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}