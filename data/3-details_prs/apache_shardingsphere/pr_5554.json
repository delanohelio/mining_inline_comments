{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2NjEzODgy", "number": 5554, "title": "Improve unit test coverage of sharding-orchestration#etcd", "bodyText": "For #5489\nChanges proposed in this pull request:\n\nImprove the unit test coverage of sharding-orchestration-center-etcd", "createdAt": "2020-05-12T09:51:04Z", "url": "https://github.com/apache/shardingsphere/pull/5554", "merged": true, "mergeCommit": {"oid": "421f26b28e977ac6309f6755b5917de2da5c0330"}, "closed": true, "closedAt": "2020-05-13T03:28:28Z", "author": {"login": "menghaoranss"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcfj4VwgH2gAyNDE2NjEzODgyOjIxZjk2MjBmYmRhM2FjN2FkMzYzNzlhOTdkMTFhMTliOGYzNTlkNzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgwTWLAFqTQxMDU2MzAyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "21f9620fbda3ac7ad36379a97d11a19b8f359d73", "author": {"user": {"login": "menghaoranss", "name": "Haoran Meng"}}, "url": "https://github.com/apache/shardingsphere/commit/21f9620fbda3ac7ad36379a97d11a19b8f359d73", "committedDate": "2020-05-09T10:25:57Z", "message": "add unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39960a5a7bd6e35ba460c676bbb4a963a8b8a8e2", "author": {"user": {"login": "menghaoranss", "name": "Haoran Meng"}}, "url": "https://github.com/apache/shardingsphere/commit/39960a5a7bd6e35ba460c676bbb4a963a8b8a8e2", "committedDate": "2020-05-11T02:33:48Z", "message": "Merge remote-tracking branch 'origin/master' into ut-etcd"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "463271ebdca13c9efc753024d7532e08136ba7c2", "author": {"user": {"login": "menghaoranss", "name": "Haoran Meng"}}, "url": "https://github.com/apache/shardingsphere/commit/463271ebdca13c9efc753024d7532e08136ba7c2", "committedDate": "2020-05-12T09:36:44Z", "message": "unit test with exception"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9593d4ca8c227c637864ed479ad57e0fa759af13", "author": {"user": {"login": "menghaoranss", "name": "Haoran Meng"}}, "url": "https://github.com/apache/shardingsphere/commit/9593d4ca8c227c637864ed479ad57e0fa759af13", "committedDate": "2020-05-12T09:42:10Z", "message": "resolve checkstyle problems"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12b6823857fe5aa43e2b7547556e608619f23bac", "author": {"user": {"login": "menghaoranss", "name": "Haoran Meng"}}, "url": "https://github.com/apache/shardingsphere/commit/12b6823857fe5aa43e2b7547556e608619f23bac", "committedDate": "2020-05-12T09:44:09Z", "message": "Merge remote-tracking branch 'origin/master' into ut-etcd"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMDY3NjE5", "url": "https://github.com/apache/shardingsphere/pull/5554#pullrequestreview-410067619", "createdAt": "2020-05-12T13:56:10Z", "commit": {"oid": "12b6823857fe5aa43e2b7547556e608619f23bac"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMzo1NjoxMFrOGUH4Kw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMzo1NjoxMFrOGUH4Kw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzc1Mzc3MQ==", "bodyText": "assertTrue", "url": "https://github.com/apache/shardingsphere/pull/5554#discussion_r423753771", "createdAt": "2020-05-12T13:56:10Z", "author": {"login": "kimmking"}, "path": "sharding-orchestration/sharding-orchestration-center/sharding-orchestration-center-etcd/src/test/java/org/apache/shardingsphere/orchestration/center/instance/EtcdCenterRepositoryTest.java", "diffHunk": "@@ -163,4 +168,83 @@ public void assertDelete() {\n         centerRepository.delete(\"key\");\n         verify(kv).delete(ByteSequence.from(\"key\", Charsets.UTF_8));\n     }\n+    \n+    @Test\n+    public void assertPersist() {\n+        centerRepository.persist(\"key1\", \"value1\");\n+        verify(kv).put(any(ByteSequence.class), any(ByteSequence.class));\n+    }\n+    \n+    @Test\n+    public void assertClose() {\n+        centerRepository.close();\n+        verify(client).close();\n+    }\n+    \n+    @Test\n+    public void assertGetType() {\n+        assertThat(centerRepository.getType(), is(CENTER_TYPE));\n+    }\n+    \n+    @Test\n+    public void assertInit() {\n+        CenterConfiguration configuration = new CenterConfiguration(CENTER_TYPE);\n+        configuration.setServerLists(\"127.0.0.1\");\n+        Properties properties = new Properties();\n+        centerRepository.setProperties(properties);\n+        centerRepository.init(configuration);\n+        assertThat(centerRepository.getProperties(), is(properties));\n+    }\n+    \n+    @Test\n+    @SneakyThrows\n+    public void assertGetKeyWhenThrowInterruptedException() {\n+        doThrow(InterruptedException.class).when(getFuture).get();\n+        try {\n+            centerRepository.get(\"key\");\n+            // CHECKSTYLE:OFF\n+        } catch (final Exception ex) {\n+            // CHECKSTYLE:ON\n+            assertThat(ex instanceof InterruptedException, is(true));\n+        }\n+    }\n+    \n+    @Test\n+    @SneakyThrows\n+    public void assertGetKeyWhenThrowExecutionException() {\n+        doThrow(ExecutionException.class).when(getFuture).get();\n+        try {\n+            centerRepository.get(\"key\");\n+            // CHECKSTYLE:OFF\n+        } catch (final Exception ex) {\n+            // CHECKSTYLE:ON\n+            assertThat(ex instanceof ExecutionException, is(true));\n+        }\n+    }\n+    \n+    @Test\n+    @SneakyThrows\n+    public void assertGetChildrenKeysWhenThrowInterruptedException() {\n+        doThrow(InterruptedException.class).when(getFuture).get();\n+        try {\n+            centerRepository.getChildrenKeys(\"/key/key1\");\n+            // CHECKSTYLE:OFF\n+        } catch (final Exception ex) {\n+            // CHECKSTYLE:ON\n+            assertThat(ex instanceof InterruptedException, is(true));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12b6823857fe5aa43e2b7547556e608619f23bac"}, "originalPosition": 100}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d3c51e07835308fc23fce34aab3c85fe930df2e", "author": {"user": {"login": "menghaoranss", "name": "Haoran Meng"}}, "url": "https://github.com/apache/shardingsphere/commit/5d3c51e07835308fc23fce34aab3c85fe930df2e", "committedDate": "2020-05-12T14:12:22Z", "message": "use assertTrue instead of assertThat"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNTYzMDI3", "url": "https://github.com/apache/shardingsphere/pull/5554#pullrequestreview-410563027", "createdAt": "2020-05-13T03:28:14Z", "commit": {"oid": "5d3c51e07835308fc23fce34aab3c85fe930df2e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3605, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}