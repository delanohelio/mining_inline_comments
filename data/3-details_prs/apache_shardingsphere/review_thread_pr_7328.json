{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgxODc5NzAz", "number": 7328, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMDozNToyNlrOEhLyhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMDozNjoyOFrOEhLz1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMjMxNjIyOnYy", "diffSide": "RIGHT", "path": "shardingsphere-integration-test/shardingsphere-test-suite/src/test/java/org/apache/shardingsphere/dbtest/engine/dql/BaseDQLIT.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMDozNToyNlrOHOW-0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMDozNToyNlrOHOW-0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDgxODY0MA==", "bodyText": "// TODO comment is required.", "url": "https://github.com/apache/shardingsphere/pull/7328#discussion_r484818640", "createdAt": "2020-09-08T10:35:26Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-integration-test/shardingsphere-test-suite/src/test/java/org/apache/shardingsphere/dbtest/engine/dql/BaseDQLIT.java", "diffHunk": "@@ -123,6 +123,9 @@ private void assertMetaData(final ResultSetMetaData actualMetaData, final List<D\n         if (\"shadow\".equals(getRuleType())) {\n             return;\n         }\n+        if (0 == actualMetaData.getColumnCount()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9bac92f83aa16a73f4fcfd63ac6296f596dba45"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMjMxNzAyOnYy", "diffSide": "RIGHT", "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-binder/src/main/java/org/apache/shardingsphere/sql/parser/binder/metadata/schema/SchemaMetaDataLoader.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMDozNTozOVrOHOW_UA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMDozNTozOVrOHOW_UA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDgxODc2OA==", "bodyText": "// TODO comment is required.", "url": "https://github.com/apache/shardingsphere/pull/7328#discussion_r484818768", "createdAt": "2020-09-08T10:35:39Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-binder/src/main/java/org/apache/shardingsphere/sql/parser/binder/metadata/schema/SchemaMetaDataLoader.java", "diffHunk": "@@ -87,22 +78,11 @@ public static SchemaMetaData load(final DataSource dataSource, final int maxConn\n         if (tableNames.isEmpty()) {\n             return new SchemaMetaData(Collections.emptyMap());\n         }\n-        List<List<String>> tableGroups = Lists.partition(tableNames, Math.max(tableNames.size() / maxConnectionCount, 1));\n-        Map<String, TableMetaData> tableMetaDataMap = 1 == tableGroups.size()\n-                ? load(dataSource.getConnection(), tableGroups.get(0), databaseType) : asyncLoad(dataSource, maxConnectionCount, tableNames, tableGroups, databaseType);\n+        Map<String, TableMetaData> tableMetaDataMap = new HashMap<>(tableNames.size(), 1);\n+        tableNames.forEach(tableName -> tableMetaDataMap.put(tableName, new TableMetaData(Collections.emptyList(), Collections.emptyList())));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9bac92f83aa16a73f4fcfd63ac6296f596dba45"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMjMxNzcxOnYy", "diffSide": "RIGHT", "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-binder/src/main/java/org/apache/shardingsphere/sql/parser/binder/metadata/table/TableMetaDataLoader.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMDozNTo1NVrOHOW_xA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMDozNTo1NVrOHOW_xA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDgxODg4NA==", "bodyText": "// TODO comment is required.", "url": "https://github.com/apache/shardingsphere/pull/7328#discussion_r484818884", "createdAt": "2020-09-08T10:35:55Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-binder/src/main/java/org/apache/shardingsphere/sql/parser/binder/metadata/table/TableMetaDataLoader.java", "diffHunk": "@@ -54,6 +55,24 @@\n         }\n     }\n     \n+    /**\n+     * Load table without column and index meta data, this is for unconfigured table.\n+     *\n+     * @param dataSource data source\n+     * @param table table name\n+     * @param databaseType database type\n+     * @return table meta data\n+     * @throws SQLException SQL exception\n+     */\n+    public static Optional<TableMetaData> loadWithoutColumnMetaData(final DataSource dataSource, final String table, final String databaseType) throws SQLException {\n+        try (MetaDataConnection connection = new MetaDataConnection(dataSource.getConnection())) {\n+            if (!isTableExist(connection, table, databaseType)) {\n+                return Optional.empty();\n+            }\n+            return Optional.of(new TableMetaData(Collections.emptyList(), Collections.emptyList()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9bac92f83aa16a73f4fcfd63ac6296f596dba45"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMjMxOTU5OnYy", "diffSide": "RIGHT", "path": "shardingsphere-infra/shardingsphere-infra-common/src/main/java/org/apache/shardingsphere/infra/metadata/refresh/impl/CreateTableStatementMetaDataRefreshStrategy.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMDozNjoyOFrOHOXA1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMDozNjoyOFrOHOXA1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDgxOTE1OQ==", "bodyText": "// TODO comment is required.", "url": "https://github.com/apache/shardingsphere/pull/7328#discussion_r484819159", "createdAt": "2020-09-08T10:36:28Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-infra/shardingsphere-infra-common/src/main/java/org/apache/shardingsphere/infra/metadata/refresh/impl/CreateTableStatementMetaDataRefreshStrategy.java", "diffHunk": "@@ -53,7 +53,7 @@ public void refreshMetaData(final ShardingSphereMetaData metaData, final Databas\n     private void refreshUnconfiguredMetaData(final ShardingSphereMetaData metaData, \n                                              final DatabaseType databaseType, final Map<String, DataSource> dataSourceMap, final String tableName) throws SQLException {\n         for (Entry<String, DataSource> entry : dataSourceMap.entrySet()) {\n-            Optional<TableMetaData> tableMetaData = TableMetaDataLoader.load(entry.getValue(), tableName, databaseType.getName());\n+            Optional<TableMetaData> tableMetaData = TableMetaDataLoader.loadWithoutColumnMetaData(entry.getValue(), tableName, databaseType.getName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9bac92f83aa16a73f4fcfd63ac6296f596dba45"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 721, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}