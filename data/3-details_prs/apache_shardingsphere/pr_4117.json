{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5MDE3Mzgx", "number": 4117, "title": "add visitor for dal", "bodyText": "fix for #3914\nChanges proposed in this pull request:\n\nadd visitor for desc\nadd visitor for ShowDatabases\nadd visitor for ShowTables\nadd visitor for ShowColumns\nadd visitor for ShowIndex\nadd visitor for ShowCreateTable", "createdAt": "2020-01-30T11:17:12Z", "url": "https://github.com/apache/shardingsphere/pull/4117", "merged": true, "mergeCommit": {"oid": "6fe9eb007f6b071c72010616e6a7c5f70383a672"}, "closed": true, "closedAt": "2020-02-05T04:20:36Z", "author": {"login": "jingshanglu"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_Yl96gH2gAyMzY5MDE3MzgxOjJiOWZmNDAyZDg3OTM1MDU0M2E3YmZiNjI1ZTRlMjcyM2I3YzUxYjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBOT6xAFqTM1MzQ1ODM0OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2b9ff402d879350543a7bfb625e4e2723b7c51b1", "author": {"user": null}, "url": "https://github.com/apache/shardingsphere/commit/2b9ff402d879350543a7bfb625e4e2723b7c51b1", "committedDate": "2020-01-30T11:11:21Z", "message": "add visitor for dal"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "615d42b25553e4ea4b3451b5744b6307b6820e8b", "author": {"user": {"login": "jingshanglu", "name": "JingShang Lu"}}, "url": "https://github.com/apache/shardingsphere/commit/615d42b25553e4ea4b3451b5744b6307b6820e8b", "committedDate": "2020-01-30T11:20:21Z", "message": "Merge branch 'master' into dal"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxMzI0MzU0", "url": "https://github.com/apache/shardingsphere/pull/4117#pullrequestreview-351324354", "createdAt": "2020-01-31T07:10:35Z", "commit": {"oid": "615d42b25553e4ea4b3451b5744b6307b6820e8b"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQwNzoxMDozNVrOFkC9wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQwNzoxNToxNFrOFkDB-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM0MTYzNA==", "bodyText": "visit(ctx.tableName()) should return TableSegment not LiteralValue .", "url": "https://github.com/apache/shardingsphere/pull/4117#discussion_r373341634", "createdAt": "2020-01-31T07:10:35Z", "author": {"login": "SteNicholas"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-mysql/src/main/java/org/apache/shardingsphere/sql/parser/MySQLVisitor.java", "diffHunk": "@@ -153,6 +165,41 @@ public ASTNode visitUse(final UseContext ctx) {\n         useStatement.setSchema(schema.getLiteral());\n         return useStatement;\n     }\n+\n+    @Override\n+    public ASTNode visitDesc(final DescContext ctx) {\n+        LiteralValue tablename = (LiteralValue) visit(ctx.tableName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "615d42b25553e4ea4b3451b5744b6307b6820e8b"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM0MTk0NA==", "bodyText": "sql-case of db-types=\"PostgreSQL\" should be removed, test for visitor is based on MySQL.", "url": "https://github.com/apache/shardingsphere/pull/4117#discussion_r373341944", "createdAt": "2020-01-31T07:11:58Z", "author": {"login": "SteNicholas"}, "path": "sharding-sql-test/src/main/resources/sql/visitor/dal/show.xml", "diffHunk": "@@ -0,0 +1,30 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  ~ Licensed to the Apache Software Foundation (ASF) under one or more\n+  ~ contributor license agreements.  See the NOTICE file distributed with\n+  ~ this work for additional information regarding copyright ownership.\n+  ~ The ASF licenses this file to You under the Apache License, Version 2.0\n+  ~ (the \"License\"); you may not use this file except in compliance with\n+  ~ the License.  You may obtain a copy of the License at\n+  ~\n+  ~     http://www.apache.org/licenses/LICENSE-2.0\n+  ~\n+  ~ Unless required by applicable law or agreed to in writing, software\n+  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n+  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  ~ See the License for the specific language governing permissions and\n+  ~ limitations under the License.\n+  -->\n+\n+<sql-cases>\n+    <sql-case id=\"show_table_status\" value=\"SHOW TABLE STATUS\" db-types=\"MySQL\" />\n+    <sql-case id=\"show_index_with_index_with_table\" value=\"SHOW INDEX FROM t_order\" db-types=\"MySQL\" />\n+    <sql-case id=\"show_index_with_indexes_with_table_and_database\" value=\"SHOW INDEXES FROM t_order FROM sharding_db\" db-types=\"MySQL\" />\n+    <sql-case id=\"show_index_with_keys_with_database_and_table\" value=\"SHOW KEYS FROM sharding_db.t_order\" db-types=\"MySQL\" />\n+    <sql-case id=\"show_index_with_table_back_quotes\" value=\"SHOW INDEXES FROM `t_order` FROM sharding_db\" db-types=\"MySQL\" />\n+    <sql-case id=\"show_index_with_database_back_quotes\" value=\"SHOW INDEXES FROM t_order FROM `sharding_db`\" db-types=\"MySQL\" />\n+    <sql-case id=\"show_index_with_back_quotes\" value=\"SHOW KEYS FROM `sharding_db`.`t_order`\" db-types=\"MySQL\" />\n+    <sql-case id=\"show_all\" value=\"SHOW ALL\" db-types=\"PostgreSQL\" />\n+    <sql-case id=\"show_server_version\" value=\"SHOW SERVER_VERSION\" db-types=\"PostgreSQL\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "615d42b25553e4ea4b3451b5744b6307b6820e8b"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM0MjM3Nw==", "bodyText": "Recover to origin style.", "url": "https://github.com/apache/shardingsphere/pull/4117#discussion_r373342377", "createdAt": "2020-01-31T07:13:38Z", "author": {"login": "SteNicholas"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-mysql/src/main/java/org/apache/shardingsphere/sql/parser/MySQLVisitor.java", "diffHunk": "@@ -169,7 +216,42 @@ public ASTNode visitShowTableStatus(final ShowTableStatusContext ctx) {\n         }\n         return showTableStatusStatement;\n     }\n-    ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "615d42b25553e4ea4b3451b5744b6307b6820e8b"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM0MjcxNA==", "bodyText": "Same to above.", "url": "https://github.com/apache/shardingsphere/pull/4117#discussion_r373342714", "createdAt": "2020-01-31T07:15:14Z", "author": {"login": "SteNicholas"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-mysql/src/main/java/org/apache/shardingsphere/sql/parser/MySQLVisitor.java", "diffHunk": "@@ -169,7 +216,42 @@ public ASTNode visitShowTableStatus(final ShowTableStatusContext ctx) {\n         }\n         return showTableStatusStatement;\n     }\n-    \n+\n+    @Override\n+    public ASTNode visitShowColumns(final ShowColumnsContext ctx) {\n+        ShowColumnsStatement showColumnsStatement = new ShowColumnsStatement();\n+        FromSchemaContext fromSchemaContext = ctx.fromSchema();\n+        ShowLikeContext showLikeContext = ctx.showLike();\n+        if (null != fromSchemaContext) {\n+            FromSchemaSegment fromSchemaSegment = (FromSchemaSegment) visit(ctx.fromSchema());\n+            showColumnsStatement.getAllSQLSegments().add(fromSchemaSegment);\n+        }\n+        if (null != showLikeContext) {\n+            ShowLikeSegment showLikeSegment = (ShowLikeSegment) visit(ctx.showLike());\n+            showColumnsStatement.getAllSQLSegments().add(showLikeSegment);\n+        }\n+        return showColumnsStatement;\n+    }\n+\n+    @Override\n+    public ASTNode visitShowIndex(final ShowIndexContext ctx) {\n+        ShowIndexStatement showIndexStatement = new ShowIndexStatement();\n+        FromSchemaContext fromSchemaContext = ctx.fromSchema();\n+        if (null != fromSchemaContext) {\n+            FromSchemaSegment fromSchemaSegment = (FromSchemaSegment) visit(ctx.fromSchema());\n+            showIndexStatement.getAllSQLSegments().add(fromSchemaSegment);\n+        }\n+        return showIndexStatement;\n+    }\n+\n+    @Override\n+    public ASTNode visitShowCreateTable(final ShowCreateTableContext ctx) {\n+        ShowCreateTableStatement showCreateTableStatement = new ShowCreateTableStatement();\n+        LiteralValue tablename = (LiteralValue) visit(ctx.tableName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "615d42b25553e4ea4b3451b5744b6307b6820e8b"}, "originalPosition": 109}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5434576d186a520e63aab4c534be08a8a3210a38", "author": {"user": null}, "url": "https://github.com/apache/shardingsphere/commit/5434576d186a520e63aab4c534be08a8a3210a38", "committedDate": "2020-02-02T16:38:03Z", "message": "delete some test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e52388a5365df926bded5380546cc98bafb6d2c", "author": {"user": null}, "url": "https://github.com/apache/shardingsphere/commit/5e52388a5365df926bded5380546cc98bafb6d2c", "committedDate": "2020-02-02T16:39:20Z", "message": "Merge branch 'dal' of https://github.com/jingshanglu/incubator-shardingsphere into dal"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "905a7d546e31c9ee3e6130bbfc506f06c046be1a", "author": {"user": {"login": "jingshanglu", "name": "JingShang Lu"}}, "url": "https://github.com/apache/shardingsphere/commit/905a7d546e31c9ee3e6130bbfc506f06c046be1a", "committedDate": "2020-02-02T16:44:58Z", "message": "Merge branch 'master' into dal"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxOTUzNzQw", "url": "https://github.com/apache/shardingsphere/pull/4117#pullrequestreview-351953740", "createdAt": "2020-02-02T16:54:59Z", "commit": {"oid": "905a7d546e31c9ee3e6130bbfc506f06c046be1a"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMlQxNjo1NDo1OVrOFkimNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMlQxNjo1Nzo1OFrOFkinCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg1OTg5Mg==", "bodyText": "Variable name of showCreateTableStatement should be result.", "url": "https://github.com/apache/shardingsphere/pull/4117#discussion_r373859892", "createdAt": "2020-02-02T16:54:59Z", "author": {"login": "SteNicholas"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-mysql/src/main/java/org/apache/shardingsphere/sql/parser/MySQLVisitor.java", "diffHunk": "@@ -237,7 +284,42 @@ public ASTNode visitShowTableStatus(final ShowTableStatusContext ctx) {\n         }\n         return showTableStatusStatement;\n     }\n-    \n+\n+    @Override\n+    public ASTNode visitShowColumns(final ShowColumnsContext ctx) {\n+        ShowColumnsStatement showColumnsStatement = new ShowColumnsStatement();\n+        FromSchemaContext fromSchemaContext = ctx.fromSchema();\n+        ShowLikeContext showLikeContext = ctx.showLike();\n+        if (null != fromSchemaContext) {\n+            FromSchemaSegment fromSchemaSegment = (FromSchemaSegment) visit(ctx.fromSchema());\n+            showColumnsStatement.getAllSQLSegments().add(fromSchemaSegment);\n+        }\n+        if (null != showLikeContext) {\n+            ShowLikeSegment showLikeSegment = (ShowLikeSegment) visit(ctx.showLike());\n+            showColumnsStatement.getAllSQLSegments().add(showLikeSegment);\n+        }\n+        return showColumnsStatement;\n+    }\n+\n+    @Override\n+    public ASTNode visitShowIndex(final ShowIndexContext ctx) {\n+        ShowIndexStatement showIndexStatement = new ShowIndexStatement();\n+        FromSchemaContext fromSchemaContext = ctx.fromSchema();\n+        if (null != fromSchemaContext) {\n+            FromSchemaSegment fromSchemaSegment = (FromSchemaSegment) visit(ctx.fromSchema());\n+            showIndexStatement.getAllSQLSegments().add(fromSchemaSegment);\n+        }\n+        return showIndexStatement;\n+    }\n+\n+    @Override\n+    public ASTNode visitShowCreateTable(final ShowCreateTableContext ctx) {\n+        ShowCreateTableStatement showCreateTableStatement = new ShowCreateTableStatement();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "905a7d546e31c9ee3e6130bbfc506f06c046be1a"}, "originalPosition": 108}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg1OTk2MQ==", "bodyText": "Variable of tableName is recommended to named table.", "url": "https://github.com/apache/shardingsphere/pull/4117#discussion_r373859961", "createdAt": "2020-02-02T16:55:52Z", "author": {"login": "SteNicholas"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-engine/src/main/java/org/apache/shardingsphere/sql/parser/sql/statement/dal/dialect/mysql/DescribeStatement.java", "diffHunk": "@@ -17,12 +17,19 @@\n \n package org.apache.shardingsphere.sql.parser.sql.statement.dal.dialect.mysql;\n \n+import lombok.Getter;\n+import lombok.Setter;\n+import org.apache.shardingsphere.sql.parser.sql.segment.generic.TableSegment;\n import org.apache.shardingsphere.sql.parser.sql.statement.dal.DALStatement;\n \n /**\n  * Describe statement.\n  *\n  * @author zhangliang\n  */\n+@Getter\n+@Setter\n public final class DescribeStatement extends DALStatement {\n+\n+    private TableSegment tableName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "905a7d546e31c9ee3e6130bbfc506f06c046be1a"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg2MDAyMw==", "bodyText": "Variable name of describeStatement should be result.", "url": "https://github.com/apache/shardingsphere/pull/4117#discussion_r373860023", "createdAt": "2020-02-02T16:56:39Z", "author": {"login": "SteNicholas"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-mysql/src/main/java/org/apache/shardingsphere/sql/parser/MySQLVisitor.java", "diffHunk": "@@ -221,6 +233,41 @@ public ASTNode visitUse(final UseContext ctx) {\n         useStatement.setSchema(schema.getLiteral());\n         return useStatement;\n     }\n+\n+    @Override\n+    public ASTNode visitDesc(final DescContext ctx) {\n+        TableSegment tablename = (TableSegment) visit(ctx.tableName());\n+        DescribeStatement describeStatement = new DescribeStatement();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "905a7d546e31c9ee3e6130bbfc506f06c046be1a"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg2MDA0Nw==", "bodyText": "Variable name of showDatabasesStatement should be result.", "url": "https://github.com/apache/shardingsphere/pull/4117#discussion_r373860047", "createdAt": "2020-02-02T16:57:02Z", "author": {"login": "SteNicholas"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-mysql/src/main/java/org/apache/shardingsphere/sql/parser/MySQLVisitor.java", "diffHunk": "@@ -221,6 +233,41 @@ public ASTNode visitUse(final UseContext ctx) {\n         useStatement.setSchema(schema.getLiteral());\n         return useStatement;\n     }\n+\n+    @Override\n+    public ASTNode visitDesc(final DescContext ctx) {\n+        TableSegment tablename = (TableSegment) visit(ctx.tableName());\n+        DescribeStatement describeStatement = new DescribeStatement();\n+        describeStatement.setTableName(tablename);\n+        return describeStatement;\n+    }\n+\n+    @Override\n+    public ASTNode visitShowDatabases(final ShowDatabasesContext ctx) {\n+        ShowDatabasesStatement showDatabasesStatement = new ShowDatabasesStatement();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "905a7d546e31c9ee3e6130bbfc506f06c046be1a"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg2MDA4MQ==", "bodyText": "Variable name of showTablesStatement should be result.", "url": "https://github.com/apache/shardingsphere/pull/4117#discussion_r373860081", "createdAt": "2020-02-02T16:57:27Z", "author": {"login": "SteNicholas"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-mysql/src/main/java/org/apache/shardingsphere/sql/parser/MySQLVisitor.java", "diffHunk": "@@ -221,6 +233,41 @@ public ASTNode visitUse(final UseContext ctx) {\n         useStatement.setSchema(schema.getLiteral());\n         return useStatement;\n     }\n+\n+    @Override\n+    public ASTNode visitDesc(final DescContext ctx) {\n+        TableSegment tablename = (TableSegment) visit(ctx.tableName());\n+        DescribeStatement describeStatement = new DescribeStatement();\n+        describeStatement.setTableName(tablename);\n+        return describeStatement;\n+    }\n+\n+    @Override\n+    public ASTNode visitShowDatabases(final ShowDatabasesContext ctx) {\n+        ShowDatabasesStatement showDatabasesStatement = new ShowDatabasesStatement();\n+        ShowLikeContext showLikeContext = ctx.showLike();\n+        if (null != showLikeContext) {\n+            ShowLikeSegment showLikeSegment = (ShowLikeSegment) visit(ctx.showLike());\n+            showDatabasesStatement.getAllSQLSegments().add(showLikeSegment);\n+        }\n+        return showDatabasesStatement;\n+    }\n+\n+    @Override\n+    public ASTNode visitShowTables(final ShowTablesContext ctx) {\n+        ShowTablesStatement showTablesStatement = new ShowTablesStatement();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "905a7d546e31c9ee3e6130bbfc506f06c046be1a"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg2MDA5OQ==", "bodyText": "Similar to above.", "url": "https://github.com/apache/shardingsphere/pull/4117#discussion_r373860099", "createdAt": "2020-02-02T16:57:50Z", "author": {"login": "SteNicholas"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-mysql/src/main/java/org/apache/shardingsphere/sql/parser/MySQLVisitor.java", "diffHunk": "@@ -237,7 +284,42 @@ public ASTNode visitShowTableStatus(final ShowTableStatusContext ctx) {\n         }\n         return showTableStatusStatement;\n     }\n-    \n+\n+    @Override\n+    public ASTNode visitShowColumns(final ShowColumnsContext ctx) {\n+        ShowColumnsStatement showColumnsStatement = new ShowColumnsStatement();\n+        FromSchemaContext fromSchemaContext = ctx.fromSchema();\n+        ShowLikeContext showLikeContext = ctx.showLike();\n+        if (null != fromSchemaContext) {\n+            FromSchemaSegment fromSchemaSegment = (FromSchemaSegment) visit(ctx.fromSchema());\n+            showColumnsStatement.getAllSQLSegments().add(fromSchemaSegment);\n+        }\n+        if (null != showLikeContext) {\n+            ShowLikeSegment showLikeSegment = (ShowLikeSegment) visit(ctx.showLike());\n+            showColumnsStatement.getAllSQLSegments().add(showLikeSegment);\n+        }\n+        return showColumnsStatement;\n+    }\n+\n+    @Override\n+    public ASTNode visitShowIndex(final ShowIndexContext ctx) {\n+        ShowIndexStatement showIndexStatement = new ShowIndexStatement();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "905a7d546e31c9ee3e6130bbfc506f06c046be1a"}, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg2MDEwNA==", "bodyText": "Similar to above.", "url": "https://github.com/apache/shardingsphere/pull/4117#discussion_r373860104", "createdAt": "2020-02-02T16:57:58Z", "author": {"login": "SteNicholas"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-mysql/src/main/java/org/apache/shardingsphere/sql/parser/MySQLVisitor.java", "diffHunk": "@@ -237,7 +284,42 @@ public ASTNode visitShowTableStatus(final ShowTableStatusContext ctx) {\n         }\n         return showTableStatusStatement;\n     }\n-    \n+\n+    @Override\n+    public ASTNode visitShowColumns(final ShowColumnsContext ctx) {\n+        ShowColumnsStatement showColumnsStatement = new ShowColumnsStatement();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "905a7d546e31c9ee3e6130bbfc506f06c046be1a"}, "originalPosition": 81}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f5f9add7774a29dbb47286f04eada4b94caeeae", "author": {"user": null}, "url": "https://github.com/apache/shardingsphere/commit/8f5f9add7774a29dbb47286f04eada4b94caeeae", "committedDate": "2020-02-03T03:05:32Z", "message": "fix code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3512e83f57f5904458c227b06c69a175b93c709", "author": {"user": null}, "url": "https://github.com/apache/shardingsphere/commit/f3512e83f57f5904458c227b06c69a175b93c709", "committedDate": "2020-02-03T03:06:01Z", "message": "Merge branch 'dal' of https://github.com/jingshanglu/incubator-shardingsphere into dal"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMDEwMTI4", "url": "https://github.com/apache/shardingsphere/pull/4117#pullrequestreview-352010128", "createdAt": "2020-02-03T03:54:56Z", "commit": {"oid": "f3512e83f57f5904458c227b06c69a175b93c709"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QwMzo1NDo1N1rOFkl2ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QwNDowMToxNVrOFkl6Zw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzkxMzI1MQ==", "bodyText": "visitTable() is necessary, right?", "url": "https://github.com/apache/shardingsphere/pull/4117#discussion_r373913251", "createdAt": "2020-02-03T03:54:57Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-mysql/src/main/java/org/apache/shardingsphere/sql/parser/MySQLVisitor.java", "diffHunk": "@@ -217,27 +229,97 @@\n     @Override\n     public ASTNode visitUse(final UseContext ctx) {\n         LiteralValue schema = (LiteralValue) visit(ctx.schemaName());\n-        UseStatement useStatement = new UseStatement();\n-        useStatement.setSchema(schema.getLiteral());\n-        return useStatement;\n+        UseStatement result = new UseStatement();\n+        result.setSchema(schema.getLiteral());\n+        return result;\n+    }\n+\n+    @Override\n+    public ASTNode visitDesc(final DescContext ctx) {\n+        TableSegment table = (TableSegment) visit(ctx.tableName());\n+        DescribeStatement result = new DescribeStatement();\n+        result.setTable(table);\n+        return result;\n+    }\n+\n+    @Override\n+    public ASTNode visitShowDatabases(final ShowDatabasesContext ctx) {\n+        ShowDatabasesStatement result = new ShowDatabasesStatement();\n+        ShowLikeContext showLikeContext = ctx.showLike();\n+        if (null != showLikeContext) {\n+            ShowLikeSegment showLikeSegment = (ShowLikeSegment) visit(ctx.showLike());\n+            result.getAllSQLSegments().add(showLikeSegment);\n+        }\n+        return result;\n+    }\n+\n+    @Override\n+    public ASTNode visitShowTables(final ShowTablesContext ctx) {\n+        ShowTablesStatement result = new ShowTablesStatement();\n+        FromSchemaContext fromSchemaContext = ctx.fromSchema();\n+        ShowLikeContext showLikeContext = ctx.showLike();\n+        if (null != fromSchemaContext) {\n+            FromSchemaSegment fromSchemaSegment = (FromSchemaSegment) visit(ctx.fromSchema());\n+            result.getAllSQLSegments().add(fromSchemaSegment);\n+        }\n+        if (null != showLikeContext) {\n+            ShowLikeSegment showLikeSegment = (ShowLikeSegment) visit(ctx.showLike());\n+            result.getAllSQLSegments().add(showLikeSegment);\n+        }\n+        return result;\n     }\n     \n     @Override\n     public ASTNode visitShowTableStatus(final ShowTableStatusContext ctx) {\n-        ShowTableStatusStatement showTableStatusStatement = new ShowTableStatusStatement();\n+        ShowTableStatusStatement result = new ShowTableStatusStatement();\n         FromSchemaContext fromSchemaContext = ctx.fromSchema();\n         ShowLikeContext showLikeContext = ctx.showLike();\n         if (null != fromSchemaContext) {\n             FromSchemaSegment fromSchemaSegment = (FromSchemaSegment) visit(ctx.fromSchema());\n-            showTableStatusStatement.getAllSQLSegments().add(fromSchemaSegment);\n+            result.getAllSQLSegments().add(fromSchemaSegment);\n         }\n         if (null != showLikeContext) {\n             ShowLikeSegment showLikeSegment = (ShowLikeSegment) visit(ctx.showLike());\n-            showTableStatusStatement.getAllSQLSegments().add(showLikeSegment);\n+            result.getAllSQLSegments().add(showLikeSegment);\n         }\n-        return showTableStatusStatement;\n+        return result;\n     }\n-    \n+\n+    @Override\n+    public ASTNode visitShowColumns(final ShowColumnsContext ctx) {\n+        ShowColumnsStatement result = new ShowColumnsStatement();\n+        FromSchemaContext fromSchemaContext = ctx.fromSchema();\n+        ShowLikeContext showLikeContext = ctx.showLike();\n+        if (null != fromSchemaContext) {\n+            FromSchemaSegment fromSchemaSegment = (FromSchemaSegment) visit(ctx.fromSchema());\n+            result.getAllSQLSegments().add(fromSchemaSegment);\n+        }\n+        if (null != showLikeContext) {\n+            ShowLikeSegment showLikeSegment = (ShowLikeSegment) visit(ctx.showLike());\n+            result.getAllSQLSegments().add(showLikeSegment);\n+        }\n+        return result;\n+    }\n+\n+    @Override\n+    public ASTNode visitShowIndex(final ShowIndexContext ctx) {\n+        ShowIndexStatement result = new ShowIndexStatement();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3512e83f57f5904458c227b06c69a175b93c709"}, "originalPosition": 117}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzkxMzU1Mw==", "bodyText": "How to handle the rule fromTable_ of showColumns in DALStatement.g4? Please notice change the name of fromTable_ once visit it.", "url": "https://github.com/apache/shardingsphere/pull/4117#discussion_r373913553", "createdAt": "2020-02-03T03:57:00Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-mysql/src/main/java/org/apache/shardingsphere/sql/parser/MySQLVisitor.java", "diffHunk": "@@ -217,27 +229,97 @@\n     @Override\n     public ASTNode visitUse(final UseContext ctx) {\n         LiteralValue schema = (LiteralValue) visit(ctx.schemaName());\n-        UseStatement useStatement = new UseStatement();\n-        useStatement.setSchema(schema.getLiteral());\n-        return useStatement;\n+        UseStatement result = new UseStatement();\n+        result.setSchema(schema.getLiteral());\n+        return result;\n+    }\n+\n+    @Override\n+    public ASTNode visitDesc(final DescContext ctx) {\n+        TableSegment table = (TableSegment) visit(ctx.tableName());\n+        DescribeStatement result = new DescribeStatement();\n+        result.setTable(table);\n+        return result;\n+    }\n+\n+    @Override\n+    public ASTNode visitShowDatabases(final ShowDatabasesContext ctx) {\n+        ShowDatabasesStatement result = new ShowDatabasesStatement();\n+        ShowLikeContext showLikeContext = ctx.showLike();\n+        if (null != showLikeContext) {\n+            ShowLikeSegment showLikeSegment = (ShowLikeSegment) visit(ctx.showLike());\n+            result.getAllSQLSegments().add(showLikeSegment);\n+        }\n+        return result;\n+    }\n+\n+    @Override\n+    public ASTNode visitShowTables(final ShowTablesContext ctx) {\n+        ShowTablesStatement result = new ShowTablesStatement();\n+        FromSchemaContext fromSchemaContext = ctx.fromSchema();\n+        ShowLikeContext showLikeContext = ctx.showLike();\n+        if (null != fromSchemaContext) {\n+            FromSchemaSegment fromSchemaSegment = (FromSchemaSegment) visit(ctx.fromSchema());\n+            result.getAllSQLSegments().add(fromSchemaSegment);\n+        }\n+        if (null != showLikeContext) {\n+            ShowLikeSegment showLikeSegment = (ShowLikeSegment) visit(ctx.showLike());\n+            result.getAllSQLSegments().add(showLikeSegment);\n+        }\n+        return result;\n     }\n     \n     @Override\n     public ASTNode visitShowTableStatus(final ShowTableStatusContext ctx) {\n-        ShowTableStatusStatement showTableStatusStatement = new ShowTableStatusStatement();\n+        ShowTableStatusStatement result = new ShowTableStatusStatement();\n         FromSchemaContext fromSchemaContext = ctx.fromSchema();\n         ShowLikeContext showLikeContext = ctx.showLike();\n         if (null != fromSchemaContext) {\n             FromSchemaSegment fromSchemaSegment = (FromSchemaSegment) visit(ctx.fromSchema());\n-            showTableStatusStatement.getAllSQLSegments().add(fromSchemaSegment);\n+            result.getAllSQLSegments().add(fromSchemaSegment);\n         }\n         if (null != showLikeContext) {\n             ShowLikeSegment showLikeSegment = (ShowLikeSegment) visit(ctx.showLike());\n-            showTableStatusStatement.getAllSQLSegments().add(showLikeSegment);\n+            result.getAllSQLSegments().add(showLikeSegment);\n         }\n-        return showTableStatusStatement;\n+        return result;\n     }\n-    \n+\n+    @Override\n+    public ASTNode visitShowColumns(final ShowColumnsContext ctx) {\n+        ShowColumnsStatement result = new ShowColumnsStatement();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3512e83f57f5904458c227b06c69a175b93c709"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzkxNDIxNQ==", "bodyText": "It seems the remainding rules of DALStatement are just showOtherandsetVariable`, right?", "url": "https://github.com/apache/shardingsphere/pull/4117#discussion_r373914215", "createdAt": "2020-02-03T04:01:15Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-mysql/src/main/java/org/apache/shardingsphere/sql/parser/MySQLVisitor.java", "diffHunk": "@@ -217,27 +229,97 @@\n     @Override\n     public ASTNode visitUse(final UseContext ctx) {\n         LiteralValue schema = (LiteralValue) visit(ctx.schemaName());\n-        UseStatement useStatement = new UseStatement();\n-        useStatement.setSchema(schema.getLiteral());\n-        return useStatement;\n+        UseStatement result = new UseStatement();\n+        result.setSchema(schema.getLiteral());\n+        return result;\n+    }\n+\n+    @Override\n+    public ASTNode visitDesc(final DescContext ctx) {\n+        TableSegment table = (TableSegment) visit(ctx.tableName());\n+        DescribeStatement result = new DescribeStatement();\n+        result.setTable(table);\n+        return result;\n+    }\n+\n+    @Override\n+    public ASTNode visitShowDatabases(final ShowDatabasesContext ctx) {\n+        ShowDatabasesStatement result = new ShowDatabasesStatement();\n+        ShowLikeContext showLikeContext = ctx.showLike();\n+        if (null != showLikeContext) {\n+            ShowLikeSegment showLikeSegment = (ShowLikeSegment) visit(ctx.showLike());\n+            result.getAllSQLSegments().add(showLikeSegment);\n+        }\n+        return result;\n+    }\n+\n+    @Override\n+    public ASTNode visitShowTables(final ShowTablesContext ctx) {\n+        ShowTablesStatement result = new ShowTablesStatement();\n+        FromSchemaContext fromSchemaContext = ctx.fromSchema();\n+        ShowLikeContext showLikeContext = ctx.showLike();\n+        if (null != fromSchemaContext) {\n+            FromSchemaSegment fromSchemaSegment = (FromSchemaSegment) visit(ctx.fromSchema());\n+            result.getAllSQLSegments().add(fromSchemaSegment);\n+        }\n+        if (null != showLikeContext) {\n+            ShowLikeSegment showLikeSegment = (ShowLikeSegment) visit(ctx.showLike());\n+            result.getAllSQLSegments().add(showLikeSegment);\n+        }\n+        return result;\n     }\n     \n     @Override\n     public ASTNode visitShowTableStatus(final ShowTableStatusContext ctx) {\n-        ShowTableStatusStatement showTableStatusStatement = new ShowTableStatusStatement();\n+        ShowTableStatusStatement result = new ShowTableStatusStatement();\n         FromSchemaContext fromSchemaContext = ctx.fromSchema();\n         ShowLikeContext showLikeContext = ctx.showLike();\n         if (null != fromSchemaContext) {\n             FromSchemaSegment fromSchemaSegment = (FromSchemaSegment) visit(ctx.fromSchema());\n-            showTableStatusStatement.getAllSQLSegments().add(fromSchemaSegment);\n+            result.getAllSQLSegments().add(fromSchemaSegment);\n         }\n         if (null != showLikeContext) {\n             ShowLikeSegment showLikeSegment = (ShowLikeSegment) visit(ctx.showLike());\n-            showTableStatusStatement.getAllSQLSegments().add(showLikeSegment);\n+            result.getAllSQLSegments().add(showLikeSegment);\n         }\n-        return showTableStatusStatement;\n+        return result;\n     }\n-    \n+\n+    @Override\n+    public ASTNode visitShowColumns(final ShowColumnsContext ctx) {\n+        ShowColumnsStatement result = new ShowColumnsStatement();\n+        FromSchemaContext fromSchemaContext = ctx.fromSchema();\n+        ShowLikeContext showLikeContext = ctx.showLike();\n+        if (null != fromSchemaContext) {\n+            FromSchemaSegment fromSchemaSegment = (FromSchemaSegment) visit(ctx.fromSchema());\n+            result.getAllSQLSegments().add(fromSchemaSegment);\n+        }\n+        if (null != showLikeContext) {\n+            ShowLikeSegment showLikeSegment = (ShowLikeSegment) visit(ctx.showLike());\n+            result.getAllSQLSegments().add(showLikeSegment);\n+        }\n+        return result;\n+    }\n+\n+    @Override\n+    public ASTNode visitShowIndex(final ShowIndexContext ctx) {\n+        ShowIndexStatement result = new ShowIndexStatement();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzkxMzI1MQ=="}, "originalCommit": {"oid": "f3512e83f57f5904458c227b06c69a175b93c709"}, "originalPosition": 117}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e3d4ae2f6ef08f49ca7cd26ee8038f79f71c8e4", "author": {"user": null}, "url": "https://github.com/apache/shardingsphere/commit/9e3d4ae2f6ef08f49ca7cd26ee8038f79f71c8e4", "committedDate": "2020-02-03T09:55:12Z", "message": "fix visitor for dal"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d81c0d18bd83bd555ef82be361adc715da1e9e64", "author": {"user": null}, "url": "https://github.com/apache/shardingsphere/commit/d81c0d18bd83bd555ef82be361adc715da1e9e64", "committedDate": "2020-02-03T10:11:59Z", "message": "check DALStatement.g4"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c677f55ac22f27275f6e2d0ce57970826d592eec", "author": {"user": null}, "url": "https://github.com/apache/shardingsphere/commit/c677f55ac22f27275f6e2d0ce57970826d592eec", "committedDate": "2020-02-04T07:09:00Z", "message": "fix for dal test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca3f2fd884e8a373537aa2c863c30dba19c4a260", "author": {"user": null}, "url": "https://github.com/apache/shardingsphere/commit/ca3f2fd884e8a373537aa2c863c30dba19c4a260", "committedDate": "2020-02-04T07:51:02Z", "message": "merge from upstream/master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d7d03dcdaf1dcb806ccbb37ae7a328c8b38655b", "author": {"user": null}, "url": "https://github.com/apache/shardingsphere/commit/6d7d03dcdaf1dcb806ccbb37ae7a328c8b38655b", "committedDate": "2020-02-04T09:17:29Z", "message": "for merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b66cfc954d94d72ce4dd315ec3ece91f01c0f76", "author": {"user": null}, "url": "https://github.com/apache/shardingsphere/commit/2b66cfc954d94d72ce4dd315ec3ece91f01c0f76", "committedDate": "2020-02-04T11:25:13Z", "message": "merge from upstream master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2164099a86462df3bad4ecf234cbf3dca281f8ff", "author": {"user": null}, "url": "https://github.com/apache/shardingsphere/commit/2164099a86462df3bad4ecf234cbf3dca281f8ff", "committedDate": "2020-02-04T11:29:42Z", "message": "Merge remote-tracking branch 'upstream/master' into dal"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f3dce84499ce78603792a57f4567d27e919e807", "author": {"user": null}, "url": "https://github.com/apache/shardingsphere/commit/8f3dce84499ce78603792a57f4567d27e919e807", "committedDate": "2020-02-05T02:09:35Z", "message": "fix for test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e46a1357b62f10c11345a32c61c5746949a19d0", "author": {"user": {"login": "jingshanglu", "name": "JingShang Lu"}}, "url": "https://github.com/apache/shardingsphere/commit/4e46a1357b62f10c11345a32c61c5746949a19d0", "committedDate": "2020-02-05T03:08:51Z", "message": "Merge branch 'master' into dal"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzNDU2MDY2", "url": "https://github.com/apache/shardingsphere/pull/4117#pullrequestreview-353456066", "createdAt": "2020-02-05T04:09:23Z", "commit": {"oid": "4e46a1357b62f10c11345a32c61c5746949a19d0"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwNDowOToyM1rOFlrRRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwNDoxODozN1rOFlrXtw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA1MDU2NQ==", "bodyText": "It is better to rename it to table.", "url": "https://github.com/apache/shardingsphere/pull/4117#discussion_r375050565", "createdAt": "2020-02-05T04:09:23Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-mysql/src/main/java/org/apache/shardingsphere/sql/parser/sql/segment/dal/FromTableSegment.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.shardingsphere.sql.parser.sql.segment.dal;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+import org.apache.shardingsphere.sql.parser.core.constant.QuoteCharacter;\n+import org.apache.shardingsphere.sql.parser.sql.segment.SQLSegment;\n+import org.apache.shardingsphere.sql.parser.sql.segment.generic.TableAvailable;\n+import org.apache.shardingsphere.sql.parser.sql.segment.generic.TableSegment;\n+\n+@Setter\n+@Getter\n+public class FromTableSegment implements SQLSegment, TableAvailable {\n+\n+    private int startIndex;\n+\n+    private int stopIndex;\n+\n+    private TableSegment pattern;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e46a1357b62f10c11345a32c61c5746949a19d0"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA1MTA1MA==", "bodyText": "Since FromTableSegment is not handled in rewriteEngine, Show columns from t_order could not be rewriten to correct sql. You can have a try.", "url": "https://github.com/apache/shardingsphere/pull/4117#discussion_r375051050", "createdAt": "2020-02-05T04:11:59Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-mysql/src/main/java/org/apache/shardingsphere/sql/parser/MySQLVisitor.java", "diffHunk": "@@ -227,27 +241,120 @@\n     @Override\n     public ASTNode visitUse(final UseContext ctx) {\n         LiteralValue schema = (LiteralValue) visit(ctx.schemaName());\n-        UseStatement useStatement = new UseStatement();\n-        useStatement.setSchema(schema.getLiteral());\n-        return useStatement;\n+        UseStatement result = new UseStatement();\n+        result.setSchema(schema.getLiteral());\n+        return result;\n+    }\n+\n+    @Override\n+    public ASTNode visitDesc(final DescContext ctx) {\n+        TableSegment table = (TableSegment) visit(ctx.tableName());\n+        DescribeStatement result = new DescribeStatement();\n+        result.setTable(table);\n+        return result;\n+    }\n+\n+    @Override\n+    public ASTNode visitShowDatabases(final ShowDatabasesContext ctx) {\n+        ShowDatabasesStatement result = new ShowDatabasesStatement();\n+        ShowLikeContext showLikeContext = ctx.showLike();\n+        if (null != showLikeContext) {\n+            ShowLikeSegment showLikeSegment = (ShowLikeSegment) visit(ctx.showLike());\n+            result.getAllSQLSegments().add(showLikeSegment);\n+        }\n+        return result;\n+    }\n+\n+    @Override\n+    public ASTNode visitShowTables(final ShowTablesContext ctx) {\n+        ShowTablesStatement result = new ShowTablesStatement();\n+        FromSchemaContext fromSchemaContext = ctx.fromSchema();\n+        ShowLikeContext showLikeContext = ctx.showLike();\n+        if (null != fromSchemaContext) {\n+            FromSchemaSegment fromSchemaSegment = (FromSchemaSegment) visit(ctx.fromSchema());\n+            result.getAllSQLSegments().add(fromSchemaSegment);\n+        }\n+        if (null != showLikeContext) {\n+            ShowLikeSegment showLikeSegment = (ShowLikeSegment) visit(ctx.showLike());\n+            result.getAllSQLSegments().add(showLikeSegment);\n+        }\n+        return result;\n     }\n     \n     @Override\n     public ASTNode visitShowTableStatus(final ShowTableStatusContext ctx) {\n-        ShowTableStatusStatement showTableStatusStatement = new ShowTableStatusStatement();\n+        ShowTableStatusStatement result = new ShowTableStatusStatement();\n         FromSchemaContext fromSchemaContext = ctx.fromSchema();\n         ShowLikeContext showLikeContext = ctx.showLike();\n         if (null != fromSchemaContext) {\n             FromSchemaSegment fromSchemaSegment = (FromSchemaSegment) visit(ctx.fromSchema());\n-            showTableStatusStatement.getAllSQLSegments().add(fromSchemaSegment);\n+            result.getAllSQLSegments().add(fromSchemaSegment);\n         }\n         if (null != showLikeContext) {\n             ShowLikeSegment showLikeSegment = (ShowLikeSegment) visit(ctx.showLike());\n-            showTableStatusStatement.getAllSQLSegments().add(showLikeSegment);\n+            result.getAllSQLSegments().add(showLikeSegment);\n         }\n-        return showTableStatusStatement;\n+        return result;\n     }\n-    \n+\n+    @Override\n+    public ASTNode visitShowColumns(final ShowColumnsContext ctx) {\n+        ShowColumnsStatement result = new ShowColumnsStatement();\n+        FromTableContext fromTableContext = ctx.fromTable();\n+        FromSchemaContext fromSchemaContext = ctx.fromSchema();\n+        ShowLikeContext showLikeContext = ctx.showLike();\n+        if (null != fromTableContext) {\n+            FromTableSegment fromTableSegment = (FromTableSegment) visit(fromTableContext);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e46a1357b62f10c11345a32c61c5746949a19d0"}, "originalPosition": 133}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA1MTE4Mg==", "bodyText": "Same with the above one.", "url": "https://github.com/apache/shardingsphere/pull/4117#discussion_r375051182", "createdAt": "2020-02-05T04:12:47Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-mysql/src/main/java/org/apache/shardingsphere/sql/parser/MySQLVisitor.java", "diffHunk": "@@ -227,27 +241,120 @@\n     @Override\n     public ASTNode visitUse(final UseContext ctx) {\n         LiteralValue schema = (LiteralValue) visit(ctx.schemaName());\n-        UseStatement useStatement = new UseStatement();\n-        useStatement.setSchema(schema.getLiteral());\n-        return useStatement;\n+        UseStatement result = new UseStatement();\n+        result.setSchema(schema.getLiteral());\n+        return result;\n+    }\n+\n+    @Override\n+    public ASTNode visitDesc(final DescContext ctx) {\n+        TableSegment table = (TableSegment) visit(ctx.tableName());\n+        DescribeStatement result = new DescribeStatement();\n+        result.setTable(table);\n+        return result;\n+    }\n+\n+    @Override\n+    public ASTNode visitShowDatabases(final ShowDatabasesContext ctx) {\n+        ShowDatabasesStatement result = new ShowDatabasesStatement();\n+        ShowLikeContext showLikeContext = ctx.showLike();\n+        if (null != showLikeContext) {\n+            ShowLikeSegment showLikeSegment = (ShowLikeSegment) visit(ctx.showLike());\n+            result.getAllSQLSegments().add(showLikeSegment);\n+        }\n+        return result;\n+    }\n+\n+    @Override\n+    public ASTNode visitShowTables(final ShowTablesContext ctx) {\n+        ShowTablesStatement result = new ShowTablesStatement();\n+        FromSchemaContext fromSchemaContext = ctx.fromSchema();\n+        ShowLikeContext showLikeContext = ctx.showLike();\n+        if (null != fromSchemaContext) {\n+            FromSchemaSegment fromSchemaSegment = (FromSchemaSegment) visit(ctx.fromSchema());\n+            result.getAllSQLSegments().add(fromSchemaSegment);\n+        }\n+        if (null != showLikeContext) {\n+            ShowLikeSegment showLikeSegment = (ShowLikeSegment) visit(ctx.showLike());\n+            result.getAllSQLSegments().add(showLikeSegment);\n+        }\n+        return result;\n     }\n     \n     @Override\n     public ASTNode visitShowTableStatus(final ShowTableStatusContext ctx) {\n-        ShowTableStatusStatement showTableStatusStatement = new ShowTableStatusStatement();\n+        ShowTableStatusStatement result = new ShowTableStatusStatement();\n         FromSchemaContext fromSchemaContext = ctx.fromSchema();\n         ShowLikeContext showLikeContext = ctx.showLike();\n         if (null != fromSchemaContext) {\n             FromSchemaSegment fromSchemaSegment = (FromSchemaSegment) visit(ctx.fromSchema());\n-            showTableStatusStatement.getAllSQLSegments().add(fromSchemaSegment);\n+            result.getAllSQLSegments().add(fromSchemaSegment);\n         }\n         if (null != showLikeContext) {\n             ShowLikeSegment showLikeSegment = (ShowLikeSegment) visit(ctx.showLike());\n-            showTableStatusStatement.getAllSQLSegments().add(showLikeSegment);\n+            result.getAllSQLSegments().add(showLikeSegment);\n         }\n-        return showTableStatusStatement;\n+        return result;\n     }\n-    \n+\n+    @Override\n+    public ASTNode visitShowColumns(final ShowColumnsContext ctx) {\n+        ShowColumnsStatement result = new ShowColumnsStatement();\n+        FromTableContext fromTableContext = ctx.fromTable();\n+        FromSchemaContext fromSchemaContext = ctx.fromSchema();\n+        ShowLikeContext showLikeContext = ctx.showLike();\n+        if (null != fromTableContext) {\n+            FromTableSegment fromTableSegment = (FromTableSegment) visit(fromTableContext);\n+            result.setTable(fromTableSegment.getPattern());\n+            result.getAllSQLSegments().add(fromTableSegment);\n+        }\n+        if (null != fromSchemaContext) {\n+            FromSchemaSegment fromSchemaSegment = (FromSchemaSegment) visit(ctx.fromSchema());\n+            result.getAllSQLSegments().add(fromSchemaSegment);\n+        }\n+        if (null != showLikeContext) {\n+            ShowLikeSegment showLikeSegment = (ShowLikeSegment) visit(ctx.showLike());\n+            result.getAllSQLSegments().add(showLikeSegment);\n+        }\n+        return result;\n+    }\n+\n+    @Override\n+    public ASTNode visitShowIndex(final ShowIndexContext ctx) {\n+        ShowIndexStatement result = new ShowIndexStatement();\n+        FromSchemaContext fromSchemaContext = ctx.fromSchema();\n+        FromTableContext fromTableContext = ctx.fromTable();\n+        if (null != fromSchemaContext) {\n+            SchemaNameContext schemaNameContext = fromSchemaContext.schemaName();\n+            LiteralValue schema = (LiteralValue) visit(schemaNameContext);\n+            SchemaSegment schemaSegment = new SchemaSegment(schemaNameContext.start.getStartIndex(), schemaNameContext.stop.getStopIndex(), schema.getLiteral());\n+            result.getAllSQLSegments().add(schemaSegment);\n+        }\n+        if (null != fromTableContext) {\n+            FromTableSegment fromTableSegment = (FromTableSegment) visitFromTable(fromTableContext);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e46a1357b62f10c11345a32c61c5746949a19d0"}, "originalPosition": 160}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA1MTM3NQ==", "bodyText": "Invalid blank line. Please delete it.", "url": "https://github.com/apache/shardingsphere/pull/4117#discussion_r375051375", "createdAt": "2020-02-05T04:13:53Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-mysql/src/main/java/org/apache/shardingsphere/sql/parser/sql/segment/dal/FromTableSegment.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.shardingsphere.sql.parser.sql.segment.dal;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+import org.apache.shardingsphere.sql.parser.core.constant.QuoteCharacter;\n+import org.apache.shardingsphere.sql.parser.sql.segment.SQLSegment;\n+import org.apache.shardingsphere.sql.parser.sql.segment.generic.TableAvailable;\n+import org.apache.shardingsphere.sql.parser.sql.segment.generic.TableSegment;\n+\n+@Setter\n+@Getter\n+public class FromTableSegment implements SQLSegment, TableAvailable {\n+\n+    private int startIndex;\n+\n+    private int stopIndex;\n+\n+    private TableSegment pattern;\n+\n+    @Override\n+    public String getTableName() {\n+        return pattern.getTableName();\n+    }\n+\n+    @Override\n+    public QuoteCharacter getTableQuoteCharacter() {\n+        return QuoteCharacter.NONE;\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e46a1357b62f10c11345a32c61c5746949a19d0"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA1MTU3Mw==", "bodyText": "A blank line should be added above this line.", "url": "https://github.com/apache/shardingsphere/pull/4117#discussion_r375051573", "createdAt": "2020-02-05T04:15:02Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-engine/src/main/java/org/apache/shardingsphere/sql/parser/sql/statement/dal/dialect/mysql/ShowColumnsStatement.java", "diffHunk": "@@ -17,12 +17,18 @@\n \n package org.apache.shardingsphere.sql.parser.sql.statement.dal.dialect.mysql;\n \n+import lombok.Getter;\n+import lombok.Setter;\n+import org.apache.shardingsphere.sql.parser.sql.segment.generic.TableSegment;\n import org.apache.shardingsphere.sql.parser.sql.statement.dal.DALStatement;\n \n /**\n  * Show columns statement.\n  *\n  * @author zhangliang\n  */\n+@Setter\n+@Getter\n public final class ShowColumnsStatement extends DALStatement {\n+    private TableSegment table;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e46a1357b62f10c11345a32c61c5746949a19d0"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA1MjA4Nw==", "bodyText": "The name of this variable should be result.", "url": "https://github.com/apache/shardingsphere/pull/4117#discussion_r375052087", "createdAt": "2020-02-05T04:17:47Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-mysql/src/main/java/org/apache/shardingsphere/sql/parser/MySQLVisitor.java", "diffHunk": "@@ -227,27 +241,120 @@\n     @Override\n     public ASTNode visitUse(final UseContext ctx) {\n         LiteralValue schema = (LiteralValue) visit(ctx.schemaName());\n-        UseStatement useStatement = new UseStatement();\n-        useStatement.setSchema(schema.getLiteral());\n-        return useStatement;\n+        UseStatement result = new UseStatement();\n+        result.setSchema(schema.getLiteral());\n+        return result;\n+    }\n+\n+    @Override\n+    public ASTNode visitDesc(final DescContext ctx) {\n+        TableSegment table = (TableSegment) visit(ctx.tableName());\n+        DescribeStatement result = new DescribeStatement();\n+        result.setTable(table);\n+        return result;\n+    }\n+\n+    @Override\n+    public ASTNode visitShowDatabases(final ShowDatabasesContext ctx) {\n+        ShowDatabasesStatement result = new ShowDatabasesStatement();\n+        ShowLikeContext showLikeContext = ctx.showLike();\n+        if (null != showLikeContext) {\n+            ShowLikeSegment showLikeSegment = (ShowLikeSegment) visit(ctx.showLike());\n+            result.getAllSQLSegments().add(showLikeSegment);\n+        }\n+        return result;\n+    }\n+\n+    @Override\n+    public ASTNode visitShowTables(final ShowTablesContext ctx) {\n+        ShowTablesStatement result = new ShowTablesStatement();\n+        FromSchemaContext fromSchemaContext = ctx.fromSchema();\n+        ShowLikeContext showLikeContext = ctx.showLike();\n+        if (null != fromSchemaContext) {\n+            FromSchemaSegment fromSchemaSegment = (FromSchemaSegment) visit(ctx.fromSchema());\n+            result.getAllSQLSegments().add(fromSchemaSegment);\n+        }\n+        if (null != showLikeContext) {\n+            ShowLikeSegment showLikeSegment = (ShowLikeSegment) visit(ctx.showLike());\n+            result.getAllSQLSegments().add(showLikeSegment);\n+        }\n+        return result;\n     }\n     \n     @Override\n     public ASTNode visitShowTableStatus(final ShowTableStatusContext ctx) {\n-        ShowTableStatusStatement showTableStatusStatement = new ShowTableStatusStatement();\n+        ShowTableStatusStatement result = new ShowTableStatusStatement();\n         FromSchemaContext fromSchemaContext = ctx.fromSchema();\n         ShowLikeContext showLikeContext = ctx.showLike();\n         if (null != fromSchemaContext) {\n             FromSchemaSegment fromSchemaSegment = (FromSchemaSegment) visit(ctx.fromSchema());\n-            showTableStatusStatement.getAllSQLSegments().add(fromSchemaSegment);\n+            result.getAllSQLSegments().add(fromSchemaSegment);\n         }\n         if (null != showLikeContext) {\n             ShowLikeSegment showLikeSegment = (ShowLikeSegment) visit(ctx.showLike());\n-            showTableStatusStatement.getAllSQLSegments().add(showLikeSegment);\n+            result.getAllSQLSegments().add(showLikeSegment);\n         }\n-        return showTableStatusStatement;\n+        return result;\n     }\n-    \n+\n+    @Override\n+    public ASTNode visitShowColumns(final ShowColumnsContext ctx) {\n+        ShowColumnsStatement result = new ShowColumnsStatement();\n+        FromTableContext fromTableContext = ctx.fromTable();\n+        FromSchemaContext fromSchemaContext = ctx.fromSchema();\n+        ShowLikeContext showLikeContext = ctx.showLike();\n+        if (null != fromTableContext) {\n+            FromTableSegment fromTableSegment = (FromTableSegment) visit(fromTableContext);\n+            result.setTable(fromTableSegment.getPattern());\n+            result.getAllSQLSegments().add(fromTableSegment);\n+        }\n+        if (null != fromSchemaContext) {\n+            FromSchemaSegment fromSchemaSegment = (FromSchemaSegment) visit(ctx.fromSchema());\n+            result.getAllSQLSegments().add(fromSchemaSegment);\n+        }\n+        if (null != showLikeContext) {\n+            ShowLikeSegment showLikeSegment = (ShowLikeSegment) visit(ctx.showLike());\n+            result.getAllSQLSegments().add(showLikeSegment);\n+        }\n+        return result;\n+    }\n+\n+    @Override\n+    public ASTNode visitShowIndex(final ShowIndexContext ctx) {\n+        ShowIndexStatement result = new ShowIndexStatement();\n+        FromSchemaContext fromSchemaContext = ctx.fromSchema();\n+        FromTableContext fromTableContext = ctx.fromTable();\n+        if (null != fromSchemaContext) {\n+            SchemaNameContext schemaNameContext = fromSchemaContext.schemaName();\n+            LiteralValue schema = (LiteralValue) visit(schemaNameContext);\n+            SchemaSegment schemaSegment = new SchemaSegment(schemaNameContext.start.getStartIndex(), schemaNameContext.stop.getStopIndex(), schema.getLiteral());\n+            result.getAllSQLSegments().add(schemaSegment);\n+        }\n+        if (null != fromTableContext) {\n+            FromTableSegment fromTableSegment = (FromTableSegment) visitFromTable(fromTableContext);\n+            TableSegment tableSegment = fromTableSegment.getPattern();\n+            result.setTable(tableSegment);\n+            result.getAllSQLSegments().add(tableSegment);\n+        }\n+        return result;\n+    }\n+\n+    @Override\n+    public ASTNode visitShowCreateTable(final ShowCreateTableContext ctx) {\n+        ShowCreateTableStatement result = new ShowCreateTableStatement();\n+        TableSegment table = (TableSegment) visit(ctx.tableName());\n+        result.setTable(table);\n+        return result;\n+    }\n+\n+    @Override\n+    public ASTNode visitFromTable(final FromTableContext ctx) {\n+        FromTableSegment fromTableSegment = new FromTableSegment();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e46a1357b62f10c11345a32c61c5746949a19d0"}, "originalPosition": 178}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA1MjIxNQ==", "bodyText": "Please check whether there is simiar issue here. Thx.", "url": "https://github.com/apache/shardingsphere/pull/4117#discussion_r375052215", "createdAt": "2020-02-05T04:18:37Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-mysql/src/main/java/org/apache/shardingsphere/sql/parser/MySQLVisitor.java", "diffHunk": "@@ -227,27 +241,120 @@\n     @Override\n     public ASTNode visitUse(final UseContext ctx) {\n         LiteralValue schema = (LiteralValue) visit(ctx.schemaName());\n-        UseStatement useStatement = new UseStatement();\n-        useStatement.setSchema(schema.getLiteral());\n-        return useStatement;\n+        UseStatement result = new UseStatement();\n+        result.setSchema(schema.getLiteral());\n+        return result;\n+    }\n+\n+    @Override\n+    public ASTNode visitDesc(final DescContext ctx) {\n+        TableSegment table = (TableSegment) visit(ctx.tableName());\n+        DescribeStatement result = new DescribeStatement();\n+        result.setTable(table);\n+        return result;\n+    }\n+\n+    @Override\n+    public ASTNode visitShowDatabases(final ShowDatabasesContext ctx) {\n+        ShowDatabasesStatement result = new ShowDatabasesStatement();\n+        ShowLikeContext showLikeContext = ctx.showLike();\n+        if (null != showLikeContext) {\n+            ShowLikeSegment showLikeSegment = (ShowLikeSegment) visit(ctx.showLike());\n+            result.getAllSQLSegments().add(showLikeSegment);\n+        }\n+        return result;\n+    }\n+\n+    @Override\n+    public ASTNode visitShowTables(final ShowTablesContext ctx) {\n+        ShowTablesStatement result = new ShowTablesStatement();\n+        FromSchemaContext fromSchemaContext = ctx.fromSchema();\n+        ShowLikeContext showLikeContext = ctx.showLike();\n+        if (null != fromSchemaContext) {\n+            FromSchemaSegment fromSchemaSegment = (FromSchemaSegment) visit(ctx.fromSchema());\n+            result.getAllSQLSegments().add(fromSchemaSegment);\n+        }\n+        if (null != showLikeContext) {\n+            ShowLikeSegment showLikeSegment = (ShowLikeSegment) visit(ctx.showLike());\n+            result.getAllSQLSegments().add(showLikeSegment);\n+        }\n+        return result;\n     }\n     \n     @Override\n     public ASTNode visitShowTableStatus(final ShowTableStatusContext ctx) {\n-        ShowTableStatusStatement showTableStatusStatement = new ShowTableStatusStatement();\n+        ShowTableStatusStatement result = new ShowTableStatusStatement();\n         FromSchemaContext fromSchemaContext = ctx.fromSchema();\n         ShowLikeContext showLikeContext = ctx.showLike();\n         if (null != fromSchemaContext) {\n             FromSchemaSegment fromSchemaSegment = (FromSchemaSegment) visit(ctx.fromSchema());\n-            showTableStatusStatement.getAllSQLSegments().add(fromSchemaSegment);\n+            result.getAllSQLSegments().add(fromSchemaSegment);\n         }\n         if (null != showLikeContext) {\n             ShowLikeSegment showLikeSegment = (ShowLikeSegment) visit(ctx.showLike());\n-            showTableStatusStatement.getAllSQLSegments().add(showLikeSegment);\n+            result.getAllSQLSegments().add(showLikeSegment);\n         }\n-        return showTableStatusStatement;\n+        return result;\n     }\n-    \n+\n+    @Override\n+    public ASTNode visitShowColumns(final ShowColumnsContext ctx) {\n+        ShowColumnsStatement result = new ShowColumnsStatement();\n+        FromTableContext fromTableContext = ctx.fromTable();\n+        FromSchemaContext fromSchemaContext = ctx.fromSchema();\n+        ShowLikeContext showLikeContext = ctx.showLike();\n+        if (null != fromTableContext) {\n+            FromTableSegment fromTableSegment = (FromTableSegment) visit(fromTableContext);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA1MTA1MA=="}, "originalCommit": {"oid": "4e46a1357b62f10c11345a32c61c5746949a19d0"}, "originalPosition": 133}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzNDU4MzQ5", "url": "https://github.com/apache/shardingsphere/pull/4117#pullrequestreview-353458349", "createdAt": "2020-02-05T04:20:26Z", "commit": {"oid": "4e46a1357b62f10c11345a32c61c5746949a19d0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4171, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}