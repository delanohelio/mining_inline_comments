{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyOTg1MDUx", "number": 6002, "title": "AbstractConnectionAdapter implement Connection#isValid(int) method", "bodyText": "Fixes #5882.\nChanges proposed in this pull request:\n\nAbstractConnectionAdapter implement Connection#isValid(int timeout) method\nCircuitBreakerConnection implement Connection#isValid(int timeout) method\nShardingSphereConnectionTest", "createdAt": "2020-06-11T10:28:44Z", "url": "https://github.com/apache/shardingsphere/pull/6002", "merged": true, "mergeCommit": {"oid": "b72bf57b4d84489561b68c4e2f627e53319e82d2"}, "closed": true, "closedAt": "2020-07-22T13:02:33Z", "author": {"login": "WEIZIBIN"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqLyHmABqjM0MzM1NDAzMzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3aeKwAFqTQ1MzI5MzYyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "573e239586cd1cba1a009e3fe414502e33ba9fa7", "author": {"user": {"login": "WEIZIBIN", "name": "DanielWei"}}, "url": "https://github.com/apache/shardingsphere/commit/573e239586cd1cba1a009e3fe414502e33ba9fa7", "committedDate": "2020-06-11T10:24:56Z", "message": "ShardingSphereConnection implement Connection#isValid(int) method"}, "afterCommit": {"oid": "6a1660d8b725b25fe19db00a9172e6cc7fa51430", "author": {"user": {"login": "WEIZIBIN", "name": "DanielWei"}}, "url": "https://github.com/apache/shardingsphere/commit/6a1660d8b725b25fe19db00a9172e6cc7fa51430", "committedDate": "2020-06-11T10:34:09Z", "message": "AbstractConnectionAdapter implement Connection#isValid(int) method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c191c9571ab5a2e9e6d3f0c0f84c8bb6cd36d851", "author": {"user": {"login": "WEIZIBIN", "name": "DanielWei"}}, "url": "https://github.com/apache/shardingsphere/commit/c191c9571ab5a2e9e6d3f0c0f84c8bb6cd36d851", "committedDate": "2020-06-11T11:24:42Z", "message": "AbstractConnectionAdapter implement Connection#isValid(int) method"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6a1660d8b725b25fe19db00a9172e6cc7fa51430", "author": {"user": {"login": "WEIZIBIN", "name": "DanielWei"}}, "url": "https://github.com/apache/shardingsphere/commit/6a1660d8b725b25fe19db00a9172e6cc7fa51430", "committedDate": "2020-06-11T10:34:09Z", "message": "AbstractConnectionAdapter implement Connection#isValid(int) method"}, "afterCommit": {"oid": "c191c9571ab5a2e9e6d3f0c0f84c8bb6cd36d851", "author": {"user": {"login": "WEIZIBIN", "name": "DanielWei"}}, "url": "https://github.com/apache/shardingsphere/commit/c191c9571ab5a2e9e6d3f0c0f84c8bb6cd36d851", "committedDate": "2020-06-11T11:24:42Z", "message": "AbstractConnectionAdapter implement Connection#isValid(int) method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4OTU1NTQ4", "url": "https://github.com/apache/shardingsphere/pull/6002#pullrequestreview-428955548", "createdAt": "2020-06-11T14:14:16Z", "commit": {"oid": "c191c9571ab5a2e9e6d3f0c0f84c8bb6cd36d851"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNDoxNDoxNlrOGifW2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNDoxNTowNlrOGifZHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgxODUyMw==", "bodyText": "why true?", "url": "https://github.com/apache/shardingsphere/pull/6002#discussion_r438818523", "createdAt": "2020-06-11T14:14:16Z", "author": {"login": "kimmking"}, "path": "shardingsphere-jdbc/shardingsphere-jdbc-orchestration/src/main/java/org/apache/shardingsphere/driver/orchestration/internal/circuit/connection/CircuitBreakerConnection.java", "diffHunk": "@@ -127,7 +128,12 @@ public PreparedStatement prepareStatement(final String sql, final int[] columnIn\n     public PreparedStatement prepareStatement(final String sql, final String[] columnNames) {\n         return new CircuitBreakerPreparedStatement();\n     }\n-    \n+\n+    @Override\n+    public boolean isValid(final int timeout) throws SQLException {\n+        return true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c191c9571ab5a2e9e6d3f0c0f84c8bb6cd36d851"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgxOTEwMA==", "bodyText": "is there some cases need return true, such as m-s?", "url": "https://github.com/apache/shardingsphere/pull/6002#discussion_r438819100", "createdAt": "2020-06-11T14:15:06Z", "author": {"login": "kimmking"}, "path": "shardingsphere-jdbc/shardingsphere-jdbc-core/src/main/java/org/apache/shardingsphere/driver/jdbc/adapter/AbstractConnectionAdapter.java", "diffHunk": "@@ -239,6 +239,16 @@ public final void setTransactionIsolation(final int level) throws SQLException {\n         recordMethodInvocation(Connection.class, \"setTransactionIsolation\", new Class[]{int.class}, new Object[]{level});\n         forceExecuteTemplate.execute(cachedConnections.values(), connection -> connection.setTransactionIsolation(level));\n     }\n+\n+    @Override\n+    public final boolean isValid(final int timeout) throws SQLException {\n+        for (Connection connection : cachedConnections.values()) {\n+            if (!connection.isValid(timeout)) {\n+                return false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c191c9571ab5a2e9e6d3f0c0f84c8bb6cd36d851"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzMjkzNjIz", "url": "https://github.com/apache/shardingsphere/pull/6002#pullrequestreview-453293623", "createdAt": "2020-07-22T13:02:24Z", "commit": {"oid": "c191c9571ab5a2e9e6d3f0c0f84c8bb6cd36d851"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4949, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}