{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYwNDUwNDg1", "number": 3906, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwNjo1Mjo1OFrODWwMFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwOTo0MTozM1rODWyliQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1MTg0Nzg5OnYy", "diffSide": "RIGHT", "path": "sharding-jdbc/sharding-jdbc-core/src/main/java/org/apache/shardingsphere/shardingjdbc/jdbc/core/statement/ShadowPreparedStatement.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwNjo1Mjo1OFrOFbsR_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwNjo1Mjo1OFrOFbsR_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDU4MTM3NQ==", "bodyText": "isShadowSql should name as isShadowSQL", "url": "https://github.com/apache/shardingsphere/pull/3906#discussion_r364581375", "createdAt": "2020-01-09T06:52:58Z", "author": {"login": "terrymanu"}, "path": "sharding-jdbc/sharding-jdbc-core/src/main/java/org/apache/shardingsphere/shardingjdbc/jdbc/core/statement/ShadowPreparedStatement.java", "diffHunk": "@@ -66,11 +66,11 @@\n     \n     private final String sql;\n     \n-    private ShadowJudgementEngine shadowJudgementEngine;\n-    \n     private PreparedStatement preparedStatement;\n     \n     private ResultSet resultSet;\n+\n+    private boolean isShadowSql;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01c5eb8001cbe24ed7271ab4aef9b0c7b50f528f"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1MjIzMzYzOnYy", "diffSide": "RIGHT", "path": "sharding-integration-test/sharding-jdbc-test/src/test/resources/integrate/env/shadow/sharding-rule.yaml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwOTozOToyMVrOFbv2UA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwOTozOToyMVrOFbv2UA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDYzOTgyNA==", "bodyText": "We need a blank line for the end of file", "url": "https://github.com/apache/shardingsphere/pull/3906#discussion_r364639824", "createdAt": "2020-01-09T09:39:21Z", "author": {"login": "terrymanu"}, "path": "sharding-integration-test/sharding-jdbc-test/src/test/resources/integrate/env/shadow/sharding-rule.yaml", "diffHunk": "@@ -36,7 +36,4 @@ shadowRule:\n           column: item_id\n     defaultDataSourceName: db\n     defaultTableStrategy:\n-      none:\n-\n-props:\n-  sql.show: true\n\\ No newline at end of file\n+      none:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fad9b32a6f38d175f972e8caa6724a6975dcf57"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1MjIzNTg2OnYy", "diffSide": "RIGHT", "path": "sharding-jdbc/sharding-jdbc-core/src/main/java/org/apache/shardingsphere/shardingjdbc/jdbc/core/connection/ShadowConnection.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwOTo0MDowM1rOFbv3ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQwNzowMDoyNVrOFcLpPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDY0MDE2Mw==", "bodyText": "Can we use lombok's @getter to instead of it?", "url": "https://github.com/apache/shardingsphere/pull/3906#discussion_r364640163", "createdAt": "2020-01-09T09:40:03Z", "author": {"login": "terrymanu"}, "path": "sharding-jdbc/sharding-jdbc-core/src/main/java/org/apache/shardingsphere/shardingjdbc/jdbc/core/connection/ShadowConnection.java", "diffHunk": "@@ -93,13 +102,14 @@ public PreparedStatement prepareStatement(final String sql, final String[] colum\n     \n     @Override\n     public void setAutoCommit(final boolean autoCommit) throws SQLException {\n+        this.autoCommit = autoCommit;\n         actualConnection.setAutoCommit(autoCommit);\n         shadowConnection.setAutoCommit(autoCommit);\n     }\n     \n     @Override\n     public boolean getAutoCommit() {\n-        return false;\n+        return autoCommit;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fad9b32a6f38d175f972e8caa6724a6975dcf57"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTA5NTIyOA==", "bodyText": "getAutoCommit()\u3001isClosed()\u3001isReadOnly() extends from Connection interface , can not use\nlombok's @getter to instead of them.", "url": "https://github.com/apache/shardingsphere/pull/3906#discussion_r365095228", "createdAt": "2020-01-10T07:00:25Z", "author": {"login": "yanyzy"}, "path": "sharding-jdbc/sharding-jdbc-core/src/main/java/org/apache/shardingsphere/shardingjdbc/jdbc/core/connection/ShadowConnection.java", "diffHunk": "@@ -93,13 +102,14 @@ public PreparedStatement prepareStatement(final String sql, final String[] colum\n     \n     @Override\n     public void setAutoCommit(final boolean autoCommit) throws SQLException {\n+        this.autoCommit = autoCommit;\n         actualConnection.setAutoCommit(autoCommit);\n         shadowConnection.setAutoCommit(autoCommit);\n     }\n     \n     @Override\n     public boolean getAutoCommit() {\n-        return false;\n+        return autoCommit;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDY0MDE2Mw=="}, "originalCommit": {"oid": "9fad9b32a6f38d175f972e8caa6724a6975dcf57"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1MjIzNjU3OnYy", "diffSide": "RIGHT", "path": "sharding-jdbc/sharding-jdbc-core/src/main/java/org/apache/shardingsphere/shardingjdbc/jdbc/core/connection/ShadowConnection.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwOTo0MDoxMVrOFbv4CA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwOTo0MDoxMVrOFbv4CA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDY0MDI2NA==", "bodyText": "Can we use lombok's @getter to instead of it?", "url": "https://github.com/apache/shardingsphere/pull/3906#discussion_r364640264", "createdAt": "2020-01-09T09:40:11Z", "author": {"login": "terrymanu"}, "path": "sharding-jdbc/sharding-jdbc-core/src/main/java/org/apache/shardingsphere/shardingjdbc/jdbc/core/connection/ShadowConnection.java", "diffHunk": "@@ -116,13 +126,14 @@ public void rollback() throws SQLException {\n     \n     @Override\n     public void close() throws SQLException {\n+        closed = true;\n         actualConnection.close();\n         shadowConnection.close();\n     }\n     \n     @Override\n     public boolean isClosed() {\n-        return false;\n+        return closed;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fad9b32a6f38d175f972e8caa6724a6975dcf57"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1MjIzNjg0OnYy", "diffSide": "RIGHT", "path": "sharding-jdbc/sharding-jdbc-core/src/main/java/org/apache/shardingsphere/shardingjdbc/jdbc/core/connection/ShadowConnection.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwOTo0MDoxN1rOFbv4LQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwOTo0MDoxN1rOFbv4LQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDY0MDMwMQ==", "bodyText": "Can we use lombok's @getter to instead of it?", "url": "https://github.com/apache/shardingsphere/pull/3906#discussion_r364640301", "createdAt": "2020-01-09T09:40:17Z", "author": {"login": "terrymanu"}, "path": "sharding-jdbc/sharding-jdbc-core/src/main/java/org/apache/shardingsphere/shardingjdbc/jdbc/core/connection/ShadowConnection.java", "diffHunk": "@@ -132,24 +143,26 @@ public DatabaseMetaData getMetaData() throws SQLException {\n     \n     @Override\n     public void setReadOnly(final boolean readOnly) throws SQLException {\n+        this.readOnly = readOnly;\n         actualConnection.setReadOnly(readOnly);\n         shadowConnection.setReadOnly(readOnly);\n     }\n     \n     @Override\n     public boolean isReadOnly() {\n-        return false;\n+        return readOnly;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fad9b32a6f38d175f972e8caa6724a6975dcf57"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1MjIzNzE0OnYy", "diffSide": "RIGHT", "path": "sharding-jdbc/sharding-jdbc-core/src/main/java/org/apache/shardingsphere/shardingjdbc/jdbc/core/connection/ShadowConnection.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwOTo0MDoyM1rOFbv4WA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwOTo0MDoyM1rOFbv4WA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDY0MDM0NA==", "bodyText": "Can we use lombok's @getter to instead of it?", "url": "https://github.com/apache/shardingsphere/pull/3906#discussion_r364640344", "createdAt": "2020-01-09T09:40:23Z", "author": {"login": "terrymanu"}, "path": "sharding-jdbc/sharding-jdbc-core/src/main/java/org/apache/shardingsphere/shardingjdbc/jdbc/core/connection/ShadowConnection.java", "diffHunk": "@@ -132,24 +143,26 @@ public DatabaseMetaData getMetaData() throws SQLException {\n     \n     @Override\n     public void setReadOnly(final boolean readOnly) throws SQLException {\n+        this.readOnly = readOnly;\n         actualConnection.setReadOnly(readOnly);\n         shadowConnection.setReadOnly(readOnly);\n     }\n     \n     @Override\n     public boolean isReadOnly() {\n-        return false;\n+        return readOnly;\n     }\n \n     @Override\n     public void setTransactionIsolation(final int level) throws SQLException {\n+        transactionIsolation = level;\n         actualConnection.setTransactionIsolation(level);\n         shadowConnection.setTransactionIsolation(level);\n     }\n     \n     @Override\n     public int getTransactionIsolation() {\n-        return 0;\n+        return transactionIsolation;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fad9b32a6f38d175f972e8caa6724a6975dcf57"}, "originalPosition": 80}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1MjIzODk3OnYy", "diffSide": "RIGHT", "path": "sharding-jdbc/sharding-jdbc-core/src/main/java/org/apache/shardingsphere/shardingjdbc/jdbc/core/connection/ShadowConnection.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwOTo0MDo1NFrOFbv5bQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwOTo0MDo1NFrOFbv5bQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDY0MDYyMQ==", "bodyText": "Is it correct for default value forever?", "url": "https://github.com/apache/shardingsphere/pull/3906#discussion_r364640621", "createdAt": "2020-01-09T09:40:54Z", "author": {"login": "terrymanu"}, "path": "sharding-jdbc/sharding-jdbc-core/src/main/java/org/apache/shardingsphere/shardingjdbc/jdbc/core/connection/ShadowConnection.java", "diffHunk": "@@ -169,6 +182,6 @@ public void setHoldability(final int holdability) throws SQLException {\n     \n     @Override\n     public int getHoldability() {\n-        return 0;\n+        return ResultSet.CLOSE_CURSORS_AT_COMMIT;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fad9b32a6f38d175f972e8caa6724a6975dcf57"}, "originalPosition": 89}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1MjI0MDczOnYy", "diffSide": "RIGHT", "path": "sharding-jdbc/sharding-jdbc-core/src/main/java/org/apache/shardingsphere/shardingjdbc/jdbc/core/statement/ShadowStatement.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwOTo0MTozM1rOFbv6mA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwOTo0MTozM1rOFbv6mA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDY0MDkyMA==", "bodyText": "We should name as result for return value", "url": "https://github.com/apache/shardingsphere/pull/3906#discussion_r364640920", "createdAt": "2020-01-09T09:41:33Z", "author": {"login": "terrymanu"}, "path": "sharding-jdbc/sharding-jdbc-core/src/main/java/org/apache/shardingsphere/shardingjdbc/jdbc/core/statement/ShadowStatement.java", "diffHunk": "@@ -181,7 +183,8 @@ private Statement getStatementAndReplay(final String sql) throws SQLException {\n         SQLStatement sqlStatement = connection.getRuntimeContext().getParseEngine().parse(sql, false);\n         sqlStatementContext = SQLStatementContextFactory.newInstance(getRelationMetas(connection.getRuntimeContext().getMetaData().getTables()), sql, Collections.emptyList(), sqlStatement);\n         ShadowJudgementEngine shadowJudgementEngine = new SimpleJudgementEngine(connection.getRuntimeContext().getRule(), sqlStatementContext);\n-        statement = shadowStatementGenerator.createStatement(shadowJudgementEngine);\n+        isShadowSQL = shadowJudgementEngine.isShadowSQL();\n+        statement = shadowStatementGenerator.createStatement();\n         return statement;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fad9b32a6f38d175f972e8caa6724a6975dcf57"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 999, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}