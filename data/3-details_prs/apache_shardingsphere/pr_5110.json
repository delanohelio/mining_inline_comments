{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwODA3NTI2", "number": 5110, "title": "add support for test of JoinSpecfication", "bodyText": "ref #4885.\nChanges proposed in this pull request:\n\nadd support for test of JoinSpecfication", "createdAt": "2020-04-08T12:04:56Z", "url": "https://github.com/apache/shardingsphere/pull/5110", "merged": true, "mergeCommit": {"oid": "da48e1fdf99a437374a557609cc1cc2beb860d21"}, "closed": true, "closedAt": "2020-04-10T05:05:44Z", "author": {"login": "jingshanglu"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVl1FtAH2gAyNDAwODA3NTI2OjA5ZTM0MGM3YThkZjdlZGY4MjMzYjUwMzA4ZDAzNzY0OWMwN2VhZDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcWJ6jXgFqTM5MTI2NzY4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "09e340c7a8df7edf8233b50308d037649c07ead7", "author": {"user": {"login": "jingshanglu", "name": "JingShang Lu"}}, "url": "https://github.com/apache/shardingsphere/commit/09e340c7a8df7edf8233b50308d037649c07ead7", "committedDate": "2020-04-08T11:02:58Z", "message": "add support for test of JoinSpecfication"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b823ea2cbacebcae560ae27198efe76993a31d3", "author": {"user": {"login": "jingshanglu", "name": "JingShang Lu"}}, "url": "https://github.com/apache/shardingsphere/commit/4b823ea2cbacebcae560ae27198efe76993a31d3", "committedDate": "2020-04-08T12:01:48Z", "message": "fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNjY3MTAx", "url": "https://github.com/apache/shardingsphere/pull/5110#pullrequestreview-390667101", "createdAt": "2020-04-09T10:17:17Z", "commit": {"oid": "4b823ea2cbacebcae560ae27198efe76993a31d3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMDoxNzoxN1rOGDSnGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMDozMDo0MVrOGDTCkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjEwMzgzMw==", "bodyText": "Why is the expr visited twice?", "url": "https://github.com/apache/shardingsphere/pull/5110#discussion_r406103833", "createdAt": "2020-04-09T10:17:17Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-dialect/shardingsphere-sql-parser-mysql/src/main/java/org/apache/shardingsphere/sql/parser/mysql/visitor/impl/MySQLDMLVisitor.java", "diffHunk": "@@ -551,16 +551,21 @@ public ASTNode visitJoinSpecification(final JoinSpecificationContext ctx) {\n         if (null != ctx.expr()) {\n             ASTNode expr = visit(ctx.expr());\n             if (expr instanceof PredicateSegment) {\n-                PredicateSegment predicate = (PredicateSegment) expr;\n-                result.setPredicateSegment(predicate);\n+                result.setPredicateSegment((PredicateSegment) expr);\n+                AndPredicate andPredicate = new AndPredicate();\n+                andPredicate.getPredicates().add((PredicateSegment) expr);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b823ea2cbacebcae560ae27198efe76993a31d3"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjEwODU0Mw==", "bodyText": "Those functions are the same as these in WhereClauseAssert. My suggestion is to extract PredicatesAssert, which will be used by WhereClauseAssert and this one.", "url": "https://github.com/apache/shardingsphere/pull/5110#discussion_r406108543", "createdAt": "2020-04-09T10:26:24Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-test/src/test/java/org/apache/shardingsphere/sql/parser/integrate/asserts/segment/JoinSpecificationAssert.java", "diffHunk": "@@ -37,5 +64,142 @@\n      * @param expected expected JoinSpecification\n      */\n     public static void assertIs(final SQLCaseAssertContext assertContext, final JoinSpecificationSegment actual, final ExpectedJoinSpecification expected) {\n+        assertThat(assertContext.getText(\"startindex assert error\"), actual.getStartIndex(), is(expected.getStartIndex()));\n+        assertThat(assertContext.getText(\"stopindex assert error\"), actual.getStopIndex(), is(expected.getStopIndex()));\n+        assertAndPredicates(assertContext, actual.getAndPredicates(), expected.getAndPredicates());\n+    \n+    }\n+    \n+    private static void assertAndPredicates(final SQLCaseAssertContext assertContext, final Collection<AndPredicate> actual, final List<ExpectedAndPredicate> expected) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b823ea2cbacebcae560ae27198efe76993a31d3"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjEwOTU3OQ==", "bodyText": "This sentence has the same meaning as line 58, please delete it.", "url": "https://github.com/apache/shardingsphere/pull/5110#discussion_r406109579", "createdAt": "2020-04-09T10:28:20Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-test/src/test/java/org/apache/shardingsphere/sql/parser/integrate/asserts/segment/table/JoinTableAssert.java", "diffHunk": "@@ -44,14 +46,21 @@\n      */\n     public static void assertIs(final SQLCaseAssertContext assertContext, final JoinedTableSegment actual, final ExpectedJoinTable expected) {\n         TableFactorAssert.assertIs(assertContext, actual.getTableFactor(), expected.getTableFactor());\n-        JoinSpecificationAssert.assertIs(assertContext, actual.getJoinSpecification(), expected.getJoinSpecification());\n+        if (null != actual.getJoinSpecification()) {\n+            JoinSpecificationAssert.assertIs(assertContext, actual.getJoinSpecification(), expected.getJoinSpecification());\n+        }\n     }\n     \n     public static void assertIs(final SQLCaseAssertContext assertContext, final List<JoinedTableSegment> actual, final List<ExpectedJoinTable> expected) {\n         assertThat(assertContext.getText(\"JoinTable size assert error\"), actual.size(), is(null == expected ? 0 : expected.size()));\n         for (int i = 0; i < actual.size(); i++) {\n             TableFactorAssert.assertIs(assertContext, actual.get(i).getTableFactor(), expected.get(i).getTableFactor());\n-            JoinSpecificationAssert.assertIs(assertContext, actual.get(i).getJoinSpecification(), expected.get(i).getJoinSpecification());\n+            if (null != expected.get(i).getJoinSpecification()) {\n+                assertNotNull(assertContext.getText(\"Actual JoinSpecification segment should exist.\"), actual.get(i).getJoinSpecification());\n+                JoinSpecificationAssert.assertIs(assertContext, actual.get(i).getJoinSpecification(), expected.get(i).getJoinSpecification());\n+            } else {\n+                assertNull(assertContext.getText(\"Actual JoinSpecification segment should not exist.\"), actual.get(i).getJoinSpecification());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b823ea2cbacebcae560ae27198efe76993a31d3"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjExMDg2Nw==", "bodyText": "Where are these SQL Cases?", "url": "https://github.com/apache/shardingsphere/pull/5110#discussion_r406110867", "createdAt": "2020-04-09T10:30:41Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-test/src/test/resources/sql/dml/select-or.xml", "diffHunk": "@@ -291,6 +291,26 @@\n                 <table-factor>\n                     <table name=\"t_order_item\" alias=\"i\" start-index=\"31\" stop-index=\"42\" />\n                 </table-factor>\n+                <joinSpecification>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b823ea2cbacebcae560ae27198efe76993a31d3"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3316905f3e5392254801ab081a4548f5def22a2d", "author": {"user": {"login": "jingshanglu", "name": "JingShang Lu"}}, "url": "https://github.com/apache/shardingsphere/commit/3316905f3e5392254801ab081a4548f5def22a2d", "committedDate": "2020-04-09T12:34:44Z", "message": "extract PredicatesAssert"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxMjM5NzY3", "url": "https://github.com/apache/shardingsphere/pull/5110#pullrequestreview-391239767", "createdAt": "2020-04-10T02:37:17Z", "commit": {"oid": "3316905f3e5392254801ab081a4548f5def22a2d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQwMjozNzoxN1rOGDvbIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQwMjozNzoxN1rOGDvbIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU3NTkwNg==", "bodyText": "If so, could we reomve private PredicateSegment predicateSegment;?", "url": "https://github.com/apache/shardingsphere/pull/5110#discussion_r406575906", "createdAt": "2020-04-10T02:37:17Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-dialect/shardingsphere-sql-parser-mysql/src/main/java/org/apache/shardingsphere/sql/parser/mysql/visitor/impl/MySQLDMLVisitor.java", "diffHunk": "@@ -551,16 +551,21 @@ public ASTNode visitJoinSpecification(final JoinSpecificationContext ctx) {\n         if (null != ctx.expr()) {\n             ASTNode expr = visit(ctx.expr());\n             if (expr instanceof PredicateSegment) {\n-                PredicateSegment predicate = (PredicateSegment) expr;\n-                result.setPredicateSegment(predicate);\n+                result.setPredicateSegment((PredicateSegment) expr);\n+                AndPredicate andPredicate = new AndPredicate();\n+                andPredicate.getPredicates().add((PredicateSegment) expr);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjEwMzgzMw=="}, "originalCommit": {"oid": "4b823ea2cbacebcae560ae27198efe76993a31d3"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxMjY3Njg4", "url": "https://github.com/apache/shardingsphere/pull/5110#pullrequestreview-391267688", "createdAt": "2020-04-10T05:05:31Z", "commit": {"oid": "3316905f3e5392254801ab081a4548f5def22a2d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3704, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}