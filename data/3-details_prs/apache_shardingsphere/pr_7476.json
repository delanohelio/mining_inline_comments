{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3NzYzMDE1", "number": 7476, "title": "Rewrite derived projection from orderby", "bodyText": "Fixes #5857.\nChanges proposed in this pull request:\n\nfix rewrite derived projection from orderby", "createdAt": "2020-09-16T06:28:33Z", "url": "https://github.com/apache/shardingsphere/pull/7476", "merged": true, "mergeCommit": {"oid": "2c98ce46a7f4a57a1b5eede378310a708939d53f"}, "closed": true, "closedAt": "2020-09-21T11:15:02Z", "author": {"login": "jingshanglu"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJE2-IgH2gAyNDg3NzYzMDE1OmY3M2E5ZmQzY2VkNGQyMzNmZTg4MDRkM2M4NmNjOWMxOWY1MWE1Njg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLBfmCgFqTQ5MjQ5MjA3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f73a9fd3ced4d233fe8804d3c86cc9c19f51a568", "author": {"user": {"login": "jingshanglu", "name": "JingShang Lu"}}, "url": "https://github.com/apache/shardingsphere/commit/f73a9fd3ced4d233fe8804d3c86cc9c19f51a568", "committedDate": "2020-09-15T10:02:13Z", "message": "fix rewrite for derived orderBy projection"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "370d242fc29e9dbede7c9436e87780e43641ab40", "author": {"user": {"login": "jingshanglu", "name": "JingShang Lu"}}, "url": "https://github.com/apache/shardingsphere/commit/370d242fc29e9dbede7c9436e87780e43641ab40", "committedDate": "2020-09-16T06:20:57Z", "message": "Merge remote-tracking branch 'upstream/master' into rewrite-derived-projection"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8bec8e408b71ff53b2d5002129a82c61104fe8e", "author": {"user": {"login": "jingshanglu", "name": "JingShang Lu"}}, "url": "https://github.com/apache/shardingsphere/commit/d8bec8e408b71ff53b2d5002129a82c61104fe8e", "committedDate": "2020-09-16T06:24:33Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f47333d785beee245e5bf63646ee0693280c796", "author": {"user": {"login": "jingshanglu", "name": "JingShang Lu"}}, "url": "https://github.com/apache/shardingsphere/commit/3f47333d785beee245e5bf63646ee0693280c796", "committedDate": "2020-09-16T08:15:55Z", "message": "fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NDIwNDc0", "url": "https://github.com/apache/shardingsphere/pull/7476#pullrequestreview-489420474", "createdAt": "2020-09-16T09:01:29Z", "commit": {"oid": "3f47333d785beee245e5bf63646ee0693280c796"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwOTowMToyOVrOHSnQ7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwOTowNzowM1rOHSnecQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI3OTcyNw==", "bodyText": "The code's cyclomatic complexity is pretty high, it is better to extract serval private method for nested loop and if statement", "url": "https://github.com/apache/shardingsphere/pull/7476#discussion_r489279727", "createdAt": "2020-09-16T09:01:29Z", "author": {"login": "terrymanu"}, "path": "shardingsphere-features/shardingsphere-sharding/shardingsphere-sharding-rewrite/src/main/java/org/apache/shardingsphere/sharding/rewrite/token/generator/impl/ProjectionsTokenGenerator.java", "diffHunk": "@@ -44,17 +60,26 @@ public boolean isGenerateSQLToken(final SQLStatementContext sqlStatementContext)\n     \n     @Override\n     public ProjectionsToken generateSQLToken(final SelectStatementContext selectStatementContext) {\n-        Collection<String> derivedProjectionTexts = getDerivedProjectionTexts(selectStatementContext);\n+        Map<RouteUnit, Collection<String>> derivedProjectionTexts = getDerivedProjectionTexts(selectStatementContext);\n         return new ProjectionsToken(selectStatementContext.getProjectionsContext().getStopIndex() + 1 + \" \".length(), derivedProjectionTexts);\n     }\n     \n-    private Collection<String> getDerivedProjectionTexts(final SelectStatementContext selectStatementContext) {\n-        Collection<String> result = new LinkedList<>();\n-        for (Projection each : selectStatementContext.getProjectionsContext().getProjections()) {\n-            if (each instanceof AggregationProjection && !((AggregationProjection) each).getDerivedAggregationProjections().isEmpty()) {\n-                result.addAll(((AggregationProjection) each).getDerivedAggregationProjections().stream().map(this::getDerivedProjectionText).collect(Collectors.toList()));\n-            } else if (each instanceof DerivedProjection) {\n-                result.add(getDerivedProjectionText(each));\n+    private Map<RouteUnit, Collection<String>> getDerivedProjectionTexts(final SelectStatementContext selectStatementContext) {\n+        Map<RouteUnit, Collection<String>> result = new HashMap<>();\n+        for (RouteUnit routeUnit : routeContext.getRouteResult().getRouteUnits()) {\n+            result.put(routeUnit, new LinkedList<>());\n+            for (Projection each : selectStatementContext.getProjectionsContext().getProjections()) {\n+                if (each instanceof AggregationProjection && !((AggregationProjection) each).getDerivedAggregationProjections().isEmpty()) {\n+                    result.get(routeUnit).addAll(((AggregationProjection) each).getDerivedAggregationProjections().stream().map(this::getDerivedProjectionText).collect(Collectors.toList()));\n+                } else if (each instanceof DerivedProjection) {\n+                    if (!(((DerivedProjection) each).getRealProjection() instanceof ColumnOrderByItemSegment)) {\n+                        result.get(routeUnit).add(getDerivedProjectionText(each));\n+                        continue;\n+                    }\n+                    TableExtractUtils utils = new TableExtractUtils();\n+                    utils.extractTablesFromSelect(selectStatementContext.getSqlStatement());\n+                    result.get(routeUnit).add(getDerivedProjectionTextFromColumnOrderByItemSegment((DerivedProjection) each, utils, routeUnit));\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f47333d785beee245e5bf63646ee0693280c796"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI4MDI1NQ==", "bodyText": "The return value should be newColumnOrderByItem", "url": "https://github.com/apache/shardingsphere/pull/7476#discussion_r489280255", "createdAt": "2020-09-16T09:02:13Z", "author": {"login": "terrymanu"}, "path": "shardingsphere-features/shardingsphere-sharding/shardingsphere-sharding-rewrite/src/main/java/org/apache/shardingsphere/sharding/rewrite/token/generator/impl/ProjectionsTokenGenerator.java", "diffHunk": "@@ -67,4 +92,40 @@ private String getDerivedProjectionText(final Projection projection) {\n         }\n         return projection.getExpression() + \" AS \" + projection.getAlias().get() + \" \";\n     }\n+    \n+    private String getDerivedProjectionTextFromColumnOrderByItemSegment(final DerivedProjection projection, final TableExtractUtils utils, final RouteUnit routeUnit) {\n+        Preconditions.checkState(projection.getAlias().isPresent());\n+        Preconditions.checkState(projection.getRealProjection() instanceof ColumnOrderByItemSegment);\n+        ColumnOrderByItemSegment columnOrderByItemSegment = (ColumnOrderByItemSegment) projection.getRealProjection();\n+        ColumnOrderByItemSegment newColumnOrderByItem = generateNewColumnOrderByItem(columnOrderByItemSegment, routeUnit, utils);\n+        return newColumnOrderByItem.getText() + \" AS \" + projection.getAlias().get() + \" \";\n+    }\n+    \n+    private Optional<String> getActualTables(final RouteUnit routeUnit, final String logicalTableName) {\n+        for (RouteMapper each : routeUnit.getTableMappers()) {\n+            if (each.getLogicName().equalsIgnoreCase(logicalTableName)) {\n+                return Optional.of(each.getActualName());\n+            }\n+        }\n+        return Optional.empty();\n+    }\n+\n+    private ColumnOrderByItemSegment generateNewColumnOrderByItem(final ColumnOrderByItemSegment old, final RouteUnit routeUnit, final TableExtractUtils utils) {\n+        Optional<OwnerSegment> ownerSegment = old.getColumn().getOwner();\n+        if (!ownerSegment.isPresent()) {\n+            return old;\n+        }\n+        if (!utils.needRewrite(ownerSegment.get())) {\n+            return old;\n+        }\n+        Optional<String> actualTableName = getActualTables(routeUnit, ownerSegment.get().getIdentifier().getValue());\n+        Preconditions.checkState(actualTableName.isPresent());\n+        ColumnSegment newColumnSegment = new ColumnSegment(0, 0, old.getColumn().getIdentifier());\n+        IdentifierValue newOwnerIdentifier = new IdentifierValue(ownerSegment.get().getIdentifier().getQuoteCharacter().getStartDelimiter()\n+                + actualTableName.get() + ownerSegment.get().getIdentifier().getQuoteCharacter().getEndDelimiter());\n+        OwnerSegment newOwner = new OwnerSegment(0, 0, newOwnerIdentifier);\n+        newColumnSegment.setOwner(newOwner);\n+        ColumnOrderByItemSegment newColumnOrderByItem = new ColumnOrderByItemSegment(newColumnSegment, old.getOrderDirection());\n+        return newColumnOrderByItem;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f47333d785beee245e5bf63646ee0693280c796"}, "originalPosition": 115}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI4MDg0Mw==", "bodyText": "String with + is not good practice, it is better to replace to String.format or StringBuilder", "url": "https://github.com/apache/shardingsphere/pull/7476#discussion_r489280843", "createdAt": "2020-09-16T09:03:09Z", "author": {"login": "terrymanu"}, "path": "shardingsphere-features/shardingsphere-sharding/shardingsphere-sharding-rewrite/src/main/java/org/apache/shardingsphere/sharding/rewrite/token/generator/impl/ProjectionsTokenGenerator.java", "diffHunk": "@@ -67,4 +92,40 @@ private String getDerivedProjectionText(final Projection projection) {\n         }\n         return projection.getExpression() + \" AS \" + projection.getAlias().get() + \" \";\n     }\n+    \n+    private String getDerivedProjectionTextFromColumnOrderByItemSegment(final DerivedProjection projection, final TableExtractUtils utils, final RouteUnit routeUnit) {\n+        Preconditions.checkState(projection.getAlias().isPresent());\n+        Preconditions.checkState(projection.getRealProjection() instanceof ColumnOrderByItemSegment);\n+        ColumnOrderByItemSegment columnOrderByItemSegment = (ColumnOrderByItemSegment) projection.getRealProjection();\n+        ColumnOrderByItemSegment newColumnOrderByItem = generateNewColumnOrderByItem(columnOrderByItemSegment, routeUnit, utils);\n+        return newColumnOrderByItem.getText() + \" AS \" + projection.getAlias().get() + \" \";\n+    }\n+    \n+    private Optional<String> getActualTables(final RouteUnit routeUnit, final String logicalTableName) {\n+        for (RouteMapper each : routeUnit.getTableMappers()) {\n+            if (each.getLogicName().equalsIgnoreCase(logicalTableName)) {\n+                return Optional.of(each.getActualName());\n+            }\n+        }\n+        return Optional.empty();\n+    }\n+\n+    private ColumnOrderByItemSegment generateNewColumnOrderByItem(final ColumnOrderByItemSegment old, final RouteUnit routeUnit, final TableExtractUtils utils) {\n+        Optional<OwnerSegment> ownerSegment = old.getColumn().getOwner();\n+        if (!ownerSegment.isPresent()) {\n+            return old;\n+        }\n+        if (!utils.needRewrite(ownerSegment.get())) {\n+            return old;\n+        }\n+        Optional<String> actualTableName = getActualTables(routeUnit, ownerSegment.get().getIdentifier().getValue());\n+        Preconditions.checkState(actualTableName.isPresent());\n+        ColumnSegment newColumnSegment = new ColumnSegment(0, 0, old.getColumn().getIdentifier());\n+        IdentifierValue newOwnerIdentifier = new IdentifierValue(ownerSegment.get().getIdentifier().getQuoteCharacter().getStartDelimiter()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f47333d785beee245e5bf63646ee0693280c796"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI4MTM5MA==", "bodyText": "The object Map<RouteUnit, Collection> it too hard to understand, can you consider about to create a new object to describe it?", "url": "https://github.com/apache/shardingsphere/pull/7476#discussion_r489281390", "createdAt": "2020-09-16T09:04:07Z", "author": {"login": "terrymanu"}, "path": "shardingsphere-features/shardingsphere-sharding/shardingsphere-sharding-rewrite/src/main/java/org/apache/shardingsphere/sharding/rewrite/token/pojo/ProjectionsToken.java", "diffHunk": "@@ -18,26 +18,29 @@\n package org.apache.shardingsphere.sharding.rewrite.token.pojo;\n \n import org.apache.shardingsphere.infra.rewrite.sql.token.pojo.Attachable;\n+import org.apache.shardingsphere.infra.rewrite.sql.token.pojo.RouteUnitAware;\n import org.apache.shardingsphere.infra.rewrite.sql.token.pojo.SQLToken;\n+import org.apache.shardingsphere.infra.route.context.RouteUnit;\n \n import java.util.Collection;\n+import java.util.Map;\n \n /**\n  * Projections token.\n  */\n-public final class ProjectionsToken extends SQLToken implements Attachable {\n+public final class ProjectionsToken extends SQLToken implements Attachable, RouteUnitAware {\n     \n-    private final Collection<String> projections;\n+    private final Map<RouteUnit, Collection<String>> projections;\n     \n-    public ProjectionsToken(final int startIndex, final Collection<String> projections) {\n+    public ProjectionsToken(final int startIndex, final Map<RouteUnit, Collection<String>> projections) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f47333d785beee245e5bf63646ee0693280c796"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI4MjQ4Ng==", "bodyText": "what mean of realProjection? For my understanding, derived projection do not have real projection, can you rename it as correct name?", "url": "https://github.com/apache/shardingsphere/pull/7476#discussion_r489282486", "createdAt": "2020-09-16T09:05:53Z", "author": {"login": "terrymanu"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-binder/src/main/java/org/apache/shardingsphere/sql/parser/binder/segment/select/projection/impl/DerivedProjection.java", "diffHunk": "@@ -38,6 +39,8 @@\n     \n     private final String alias;\n     \n+    private final SQLSegment realProjection;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f47333d785beee245e5bf63646ee0693280c796"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI4MzE4NQ==", "bodyText": "Util class should be final and static", "url": "https://github.com/apache/shardingsphere/pull/7476#discussion_r489283185", "createdAt": "2020-09-16T09:07:03Z", "author": {"login": "terrymanu"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-statement/src/main/java/org/apache/shardingsphere/sql/parser/sql/common/util/TableExtractUtils.java", "diffHunk": "@@ -198,7 +198,12 @@ public void extractTablesFromUpdate(final UpdateStatement updateStatement) {\n         }\n     }\n     \n-    private boolean needRewrite(final OwnerSegment owner) {\n+    /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f47333d785beee245e5bf63646ee0693280c796"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba897f3b3dc98c9d8ccf449b07b7e4e02f004d5c", "author": {"user": {"login": "jingshanglu", "name": "JingShang Lu"}}, "url": "https://github.com/apache/shardingsphere/commit/ba897f3b3dc98c9d8ccf449b07b7e4e02f004d5c", "committedDate": "2020-09-16T09:37:28Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e97226878a90b17a986cc4f6e2a30748fba1aba8", "author": {"user": {"login": "jingshanglu", "name": "JingShang Lu"}}, "url": "https://github.com/apache/shardingsphere/commit/e97226878a90b17a986cc4f6e2a30748fba1aba8", "committedDate": "2020-09-16T10:01:50Z", "message": "fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NTk2MjQ4", "url": "https://github.com/apache/shardingsphere/pull/7476#pullrequestreview-489596248", "createdAt": "2020-09-16T12:58:04Z", "commit": {"oid": "e97226878a90b17a986cc4f6e2a30748fba1aba8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMjo1ODowNFrOHSvkEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMjo1ODowNFrOHSvkEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQxNTY5OA==", "bodyText": "How about to avoid using + with string", "url": "https://github.com/apache/shardingsphere/pull/7476#discussion_r489415698", "createdAt": "2020-09-16T12:58:04Z", "author": {"login": "terrymanu"}, "path": "shardingsphere-features/shardingsphere-sharding/shardingsphere-sharding-rewrite/src/main/java/org/apache/shardingsphere/sharding/rewrite/token/generator/impl/ProjectionsTokenGenerator.java", "diffHunk": "@@ -67,4 +90,41 @@ private String getDerivedProjectionText(final Projection projection) {\n         }\n         return projection.getExpression() + \" AS \" + projection.getAlias().get() + \" \";\n     }\n+    \n+    private String getDerivedProjectionTextFromColumnOrderByItemSegment(final DerivedProjection projection, final TableExtractUtils utils, final RouteUnit routeUnit) {\n+        Preconditions.checkState(projection.getAlias().isPresent());\n+        Preconditions.checkState(projection.getProjection() instanceof ColumnOrderByItemSegment);\n+        ColumnOrderByItemSegment columnOrderByItemSegment = (ColumnOrderByItemSegment) projection.getProjection();\n+        ColumnOrderByItemSegment newColumnOrderByItem = generateNewColumnOrderByItem(columnOrderByItemSegment, routeUnit, utils);\n+        return newColumnOrderByItem.getText() + \" AS \" + projection.getAlias().get() + \" \";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e97226878a90b17a986cc4f6e2a30748fba1aba8"}, "originalPosition": 85}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NTk3NjIx", "url": "https://github.com/apache/shardingsphere/pull/7476#pullrequestreview-489597621", "createdAt": "2020-09-16T12:59:34Z", "commit": {"oid": "e97226878a90b17a986cc4f6e2a30748fba1aba8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMjo1OTozNFrOHSvoKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMzowMToxMlrOHSvs2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQxNjc0NQ==", "bodyText": "It is invalid if util class has state, please consider change class name", "url": "https://github.com/apache/shardingsphere/pull/7476#discussion_r489416745", "createdAt": "2020-09-16T12:59:34Z", "author": {"login": "terrymanu"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-statement/src/main/java/org/apache/shardingsphere/sql/parser/sql/common/util/TableExtractUtils.java", "diffHunk": "@@ -198,7 +198,12 @@ public void extractTablesFromUpdate(final UpdateStatement updateStatement) {\n         }\n     }\n     \n-    private boolean needRewrite(final OwnerSegment owner) {\n+    /**", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI4MzE4NQ=="}, "originalCommit": {"oid": "3f47333d785beee245e5bf63646ee0693280c796"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQxNzE2Nw==", "bodyText": "original projection maybe a better name", "url": "https://github.com/apache/shardingsphere/pull/7476#discussion_r489417167", "createdAt": "2020-09-16T13:00:05Z", "author": {"login": "terrymanu"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-binder/src/main/java/org/apache/shardingsphere/sql/parser/binder/segment/select/projection/impl/DerivedProjection.java", "diffHunk": "@@ -38,6 +39,8 @@\n     \n     private final String alias;\n     \n+    private final SQLSegment projection;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e97226878a90b17a986cc4f6e2a30748fba1aba8"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQxNzk0NQ==", "bodyText": "t too hard to understand, what is the Collection?\nIt is better to make the code for read easier.", "url": "https://github.com/apache/shardingsphere/pull/7476#discussion_r489417945", "createdAt": "2020-09-16T13:01:12Z", "author": {"login": "terrymanu"}, "path": "shardingsphere-features/shardingsphere-sharding/shardingsphere-sharding-rewrite/src/main/java/org/apache/shardingsphere/sharding/rewrite/token/pojo/ProjectionsToken.java", "diffHunk": "@@ -18,26 +18,29 @@\n package org.apache.shardingsphere.sharding.rewrite.token.pojo;\n \n import org.apache.shardingsphere.infra.rewrite.sql.token.pojo.Attachable;\n+import org.apache.shardingsphere.infra.rewrite.sql.token.pojo.RouteUnitAware;\n import org.apache.shardingsphere.infra.rewrite.sql.token.pojo.SQLToken;\n+import org.apache.shardingsphere.infra.route.context.RouteUnit;\n \n import java.util.Collection;\n+import java.util.Map;\n \n /**\n  * Projections token.\n  */\n-public final class ProjectionsToken extends SQLToken implements Attachable {\n+public final class ProjectionsToken extends SQLToken implements Attachable, RouteUnitAware {\n     \n-    private final Collection<String> projections;\n+    private final Map<RouteUnit, Collection<String>> projections;\n     \n-    public ProjectionsToken(final int startIndex, final Collection<String> projections) {\n+    public ProjectionsToken(final int startIndex, final Map<RouteUnit, Collection<String>> projections) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI4MTM5MA=="}, "originalCommit": {"oid": "3f47333d785beee245e5bf63646ee0693280c796"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0edca34ae9af8db68a8ca12dee33d14e883b722", "author": {"user": {"login": "jingshanglu", "name": "JingShang Lu"}}, "url": "https://github.com/apache/shardingsphere/commit/a0edca34ae9af8db68a8ca12dee33d14e883b722", "committedDate": "2020-09-17T02:48:43Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c462ca50f5ab5a8984ca352516be777e371bcc53", "author": {"user": {"login": "jingshanglu", "name": "JingShang Lu"}}, "url": "https://github.com/apache/shardingsphere/commit/c462ca50f5ab5a8984ca352516be777e371bcc53", "committedDate": "2020-09-17T02:53:56Z", "message": "fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwODExMTQy", "url": "https://github.com/apache/shardingsphere/pull/7476#pullrequestreview-490811142", "createdAt": "2020-09-17T17:03:41Z", "commit": {"oid": "c462ca50f5ab5a8984ca352516be777e371bcc53"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxNzowMzo0MlrOHTs4PQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxNzowMzo0MlrOHTs4PQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDQyMDI4NQ==", "bodyText": "Please rename variable name utils because of there is no any relationship with variable name and class type.", "url": "https://github.com/apache/shardingsphere/pull/7476#discussion_r490420285", "createdAt": "2020-09-17T17:03:42Z", "author": {"login": "terrymanu"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-binder/src/main/java/org/apache/shardingsphere/sql/parser/binder/statement/dml/UpdateStatementContext.java", "diffHunk": "@@ -42,16 +42,16 @@\n     \n     public UpdateStatementContext(final UpdateStatement sqlStatement) {\n         super(sqlStatement);\n-        TableExtractUtils utils = new TableExtractUtils();\n+        TableExtractor utils = new TableExtractor();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c462ca50f5ab5a8984ca352516be777e371bcc53"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d0368b3e2b40a17d22a3025dd86499e5df675da", "author": {"user": {"login": "jingshanglu", "name": "JingShang Lu"}}, "url": "https://github.com/apache/shardingsphere/commit/5d0368b3e2b40a17d22a3025dd86499e5df675da", "committedDate": "2020-09-18T01:13:01Z", "message": "fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNTkxNjEw", "url": "https://github.com/apache/shardingsphere/pull/7476#pullrequestreview-491591610", "createdAt": "2020-09-18T15:57:37Z", "commit": {"oid": "5d0368b3e2b40a17d22a3025dd86499e5df675da"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxNTo1NzozN1rOHUS8VQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxNTo1NzozN1rOHUS8VQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTA0MzkyNQ==", "bodyText": "Is the class TableExtractor suitable in util package?\nif it is not an util class, please move it to correct package.", "url": "https://github.com/apache/shardingsphere/pull/7476#discussion_r491043925", "createdAt": "2020-09-18T15:57:37Z", "author": {"login": "terrymanu"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-statement/src/main/java/org/apache/shardingsphere/sql/parser/sql/common/util/TableExtractor.java", "diffHunk": "@@ -46,7 +46,7 @@\n import java.util.LinkedList;\n import java.util.Optional;\n \n-public final class TableExtractUtils {\n+public final class TableExtractor {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d0368b3e2b40a17d22a3025dd86499e5df675da"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0fe9c70b19323142b5e7abaf49bb3c2849366fbc", "author": {"user": {"login": "jingshanglu", "name": "JingShang Lu"}}, "url": "https://github.com/apache/shardingsphere/commit/0fe9c70b19323142b5e7abaf49bb3c2849366fbc", "committedDate": "2020-09-21T09:49:25Z", "message": "merge from upstream master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfda4390014151e9faf60ba0589cb3a91f8c7e9d", "author": {"user": {"login": "jingshanglu", "name": "JingShang Lu"}}, "url": "https://github.com/apache/shardingsphere/commit/cfda4390014151e9faf60ba0589cb3a91f8c7e9d", "committedDate": "2020-09-21T09:52:32Z", "message": "change package of TableExtractor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyNDkyMDc3", "url": "https://github.com/apache/shardingsphere/pull/7476#pullrequestreview-492492077", "createdAt": "2020-09-21T11:14:49Z", "commit": {"oid": "cfda4390014151e9faf60ba0589cb3a91f8c7e9d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4030, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}