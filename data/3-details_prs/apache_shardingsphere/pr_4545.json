{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgyMDU3NDEx", "number": 4545, "title": "Issue2010", "bodyText": "Fixes #2010  .\nChanges proposed in this pull request:\n\nsupport connectionInitSqls config of dbcp and druid connection pool via spring-boot\nsupport connectionInitSqls config of dbcp and druid while using orchestration\n\nThe following configurations of connectionInitSqls has been verified using dbcp and druid connection pools:\n\nspringboot\n\nspring.shardingsphere.datasource.ds_0.connectionInitSqls=set names utf8mb4;,set serverTimezone=UTC;\n\n\nyaml\n\nconnectionInitSqls:\n      - set names utf8mb4;\n      - set serverTimezone=UTC;\n\n\nnamespace\n\n<property name=\"connectionInitSqls\">\n            <list>\n                <value>set names utf8mb4;</value>\n                <value>set serverTimezone=UTC;</value>\n            </list>\n</property>\n\n\nUsing the local and zookeeper config center, the connectionInitSqls is uploaded to the config center as:\n\nconnectionInitSqls:\n      - set names utf8mb4;\n      - set serverTimezone=UTC;\n\n\nConfigure connectionInitSqls using only Configuration Center\nConfigure connectionInitSqls with UI", "createdAt": "2020-03-01T15:22:43Z", "url": "https://github.com/apache/shardingsphere/pull/4545", "merged": true, "mergeCommit": {"oid": "6e7f42b3cade967f341bdd56ccddea819a74aa75"}, "closed": true, "closedAt": "2020-03-05T08:36:44Z", "author": {"login": "menghaoranss"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIuUQVAH2gAyMzgyMDU3NDExOjVmZTg0NzBiNGFiZmU3ODg3MjhlYjRkYzU5NmM1NDBhY2VhNTAwZWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKmXtigH2gAyMzgyMDU3NDExOmQyZmNkYjMwNGRjMTY1YjY0ZmM3ZGRkOTZlMDM5NmM5NTlhZjM2OTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5fe8470b4abfe788728eb4dc596c540acea500eb", "author": {"user": {"login": "menghaoranss", "name": "Haoran Meng"}}, "url": "https://github.com/apache/shardingsphere/commit/5fe8470b4abfe788728eb4dc596c540acea500eb", "committedDate": "2020-02-28T11:35:14Z", "message": "for#2010, support connectionInitSqls config for druid"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23ec332dc3632e324aac4bf5537a01a0fb193df1", "author": {"user": {"login": "menghaoranss", "name": "Haoran Meng"}}, "url": "https://github.com/apache/shardingsphere/commit/23ec332dc3632e324aac4bf5537a01a0fb193df1", "committedDate": "2020-03-01T14:26:12Z", "message": "Merge remote-tracking branch 'origin/master' into issue2010"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2OTEyMzY5", "url": "https://github.com/apache/shardingsphere/pull/4545#pullrequestreview-366912369", "createdAt": "2020-03-02T01:39:06Z", "commit": {"oid": "23ec332dc3632e324aac4bf5537a01a0fb193df1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQwMTozOTowNlrOFwRsKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQwMTozOTowNlrOFwRsKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjE2NTgwMg==", "bodyText": "Here is an integration test.\nI suggestion:\n\nif do this way, it's neccesary to use HikariDataSource instead of BasicDatasource.\ncreat a table in h2 db, and set an insert sql to initSql, then check it work well by a select and compare.\n\nOr another approach:\njust mock a jdbc driver behind HikariDataSource, check hikariDataSource send the initSql to mock jdbc connection/statement.", "url": "https://github.com/apache/shardingsphere/pull/4545#discussion_r386165802", "createdAt": "2020-03-02T01:39:06Z", "author": {"login": "kimmking"}, "path": "shardingsphere-underlying/shardingsphere-common/src/test/java/org/apache/shardingsphere/underlying/common/config/DataSourceConfigurationTest.java", "diffHunk": "@@ -83,4 +88,25 @@ public void assertAddAlias() {\n         assertThat(actual.getProperties().get(\"jdbcUrl\"), is(actual.getProperties().get(\"url\")));\n         assertThat(actual.getProperties().get(\"username\"), is(actual.getProperties().get(\"user\")));\n     }\n+    \n+    @Test\n+    public void assertGetDataSourceConfigurationWithConnectionInitSqls() throws SQLException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23ec332dc3632e324aac4bf5537a01a0fb193df1"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3MTQwNDc3", "url": "https://github.com/apache/shardingsphere/pull/4545#pullrequestreview-367140477", "createdAt": "2020-03-02T11:50:10Z", "commit": {"oid": "23ec332dc3632e324aac4bf5537a01a0fb193df1"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5MzA3NTAx", "url": "https://github.com/apache/shardingsphere/pull/4545#pullrequestreview-369307501", "createdAt": "2020-03-05T05:44:42Z", "commit": {"oid": "23ec332dc3632e324aac4bf5537a01a0fb193df1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea13cacaf3c7ba64564d30a1fad7e6c9f6b67c27", "author": {"user": {"login": "menghaoranss", "name": "Haoran Meng"}}, "url": "https://github.com/apache/shardingsphere/commit/ea13cacaf3c7ba64564d30a1fad7e6c9f6b67c27", "committedDate": "2020-03-05T07:12:36Z", "message": "Merge branch 'master' into issue2010"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e69c4695bb93371dda821c1e2578ac8051b5a44", "author": {"user": {"login": "menghaoranss", "name": "Haoran Meng"}}, "url": "https://github.com/apache/shardingsphere/commit/4e69c4695bb93371dda821c1e2578ac8051b5a44", "committedDate": "2020-03-05T07:27:01Z", "message": "Merge remote-tracking branch 'origin/master' into issue2010"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2fcdb304dc165b64fc7ddd96e0396c959af3699", "author": {"user": {"login": "menghaoranss", "name": "Haoran Meng"}}, "url": "https://github.com/apache/shardingsphere/commit/d2fcdb304dc165b64fc7ddd96e0396c959af3699", "committedDate": "2020-03-05T07:27:37Z", "message": "Merge remote-tracking branch 'origin/issue2010' into issue2010"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3881, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}