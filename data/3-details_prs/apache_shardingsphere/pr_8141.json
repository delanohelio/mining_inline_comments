{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5NTU3OTM3", "number": 8141, "title": "Use mock to instead of TestShardingRule and TestTableRule in DataNodesTest class", "bodyText": "Fixes #8067.\nChanges proposed in this pull request:\n\nUse mock to instead of TestShardingRule and TestTableRule in DataNodesTest class.", "createdAt": "2020-11-12T01:45:37Z", "url": "https://github.com/apache/shardingsphere/pull/8141", "merged": true, "mergeCommit": {"oid": "739e0b5362c5aaaeaa8f40a921e60aca6626ae9a"}, "closed": true, "closedAt": "2020-11-19T06:51:23Z", "author": {"login": "wenweibin"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZsOnqAH2gAyNTE5NTU3OTM3OjYzOWRiZjZkMmYyMmE4ODVmNzI1NzgzOGJjNzAzZmQ5YmVkZWJhYzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdd9FRCAFqTUzNDEyMzg1Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "639dbf6d2f22a885f7257838bc703fd9bedebac4", "author": {"user": {"login": "wenweibin", "name": "wenweibin"}}, "url": "https://github.com/apache/shardingsphere/commit/639dbf6d2f22a885f7257838bc703fd9bedebac4", "committedDate": "2020-11-06T00:57:08Z", "message": "Improve mysql Call Statement definition and Visitor #7791"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7f401c3b1e8134509acf0f9fd0e3e7f4b06be43", "author": {"user": {"login": "wenweibin", "name": "wenweibin"}}, "url": "https://github.com/apache/shardingsphere/commit/c7f401c3b1e8134509acf0f9fd0e3e7f4b06be43", "committedDate": "2020-11-06T01:16:22Z", "message": "Improve mysql Call Statement definition and Visitor #7791"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1748ebc730f9d1fbe187433cc30adbcc26588824", "author": {"user": {"login": "wenweibin", "name": "wenweibin"}}, "url": "https://github.com/apache/shardingsphere/commit/1748ebc730f9d1fbe187433cc30adbcc26588824", "committedDate": "2020-11-06T01:21:32Z", "message": "Improve mysql Call Statement definition and Visitor #7791"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5fa9b9aa3c5e482759bf1bb4d2080a91a46d50d0", "author": {"user": {"login": "wenweibin", "name": "wenweibin"}}, "url": "https://github.com/apache/shardingsphere/commit/5fa9b9aa3c5e482759bf1bb4d2080a91a46d50d0", "committedDate": "2020-11-06T01:59:00Z", "message": "Improve mysql Call Statement definition and Visitor #7791"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56cb245fdb53bda42336666b3a31ebcf6c066c48", "author": {"user": {"login": "wenweibin", "name": "wenweibin"}}, "url": "https://github.com/apache/shardingsphere/commit/56cb245fdb53bda42336666b3a31ebcf6c066c48", "committedDate": "2020-11-12T00:57:37Z", "message": "Merge branch 'master' of https://github.com/apache/shardingsphere into 7791"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd5e1aeadaa834346612c3e4dc2e8ca7ba2340f8", "author": {"user": {"login": "wenweibin", "name": "wenweibin"}}, "url": "https://github.com/apache/shardingsphere/commit/bd5e1aeadaa834346612c3e4dc2e8ca7ba2340f8", "committedDate": "2020-11-12T01:42:25Z", "message": "Use mock to instead of TestShardingRule and TestTableRule in DataNodesTest class"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5ODgzMzQx", "url": "https://github.com/apache/shardingsphere/pull/8141#pullrequestreview-529883341", "createdAt": "2020-11-13T08:57:01Z", "commit": {"oid": "bd5e1aeadaa834346612c3e4dc2e8ca7ba2340f8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QwODo1NzowMlrOHyl48A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QwODo1NzowMlrOHyl48A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjgxMTYzMg==", "bodyText": "keep four blank.", "url": "https://github.com/apache/shardingsphere/pull/8141#discussion_r522811632", "createdAt": "2020-11-13T08:57:02Z", "author": {"login": "kimmking"}, "path": "shardingsphere-infra/shardingsphere-infra-common/src/test/java/org/apache/shardingsphere/infra/rule/DataNodesTest.java", "diffHunk": "@@ -40,59 +39,60 @@\n import static org.mockito.Mockito.when;\n \n public final class DataNodesTest {\n-    ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd5e1aeadaa834346612c3e4dc2e8ca7ba2340f8"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef2a176893a8b4d4beab76d611570b95954fdc18", "author": {"user": {"login": "wenweibin", "name": "wenweibin"}}, "url": "https://github.com/apache/shardingsphere/commit/ef2a176893a8b4d4beab76d611570b95954fdc18", "committedDate": "2020-11-13T09:58:04Z", "message": "format-add four blank at empty line"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwOTAxMjE1", "url": "https://github.com/apache/shardingsphere/pull/8141#pullrequestreview-530901215", "createdAt": "2020-11-16T03:36:40Z", "commit": {"oid": "ef2a176893a8b4d4beab76d611570b95954fdc18"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwMzozNjo0MFrOHznTAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwMzozNjo0MFrOHznTAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzg4MzI2Ng==", "bodyText": "Hi @wenweibin\nDo you think TestShardingSphereRule is no longer needed? If so, please delete them. Thanks.", "url": "https://github.com/apache/shardingsphere/pull/8141#discussion_r523883266", "createdAt": "2020-11-16T03:36:40Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-infra/shardingsphere-infra-common/src/test/java/org/apache/shardingsphere/infra/rule/DataNodesTest.java", "diffHunk": "@@ -79,18 +77,19 @@ public void assertGetDataNodeGroups() {\n     }\n     \n     private DataNodes getRoutedRuleDataNodes() {\n-        TestTableRule tableRule1 = new TestTableRule(dataSourceNames1, logicTableName1);\n-        TestTableRule tableRule2 = new TestTableRule(dataSourceNames2, logicTableName2);\n-        List<TestTableRule> tableRules = Arrays.asList(tableRule1, tableRule2);\n-        ShardingSphereRule rule1 = new TestShardingRule(tableRules);\n+        Map<String, Collection<DataNode>> nodeMap = new HashMap<>();\n+        nodeMap.put(logicTableName1, getExpectedDataNodes(dataSourceNames1, logicTableName1));\n+        nodeMap.put(logicTableName2, getExpectedDataNodes(dataSourceNames2, logicTableName2));\n+        DataNodeContainedRule rule1 = mock(DataNodeContainedRule.class);\n+        when(rule1.getAllDataNodes()).thenReturn(nodeMap);\n         Map<String, Collection<String>> dataSourceMapper = Collections.singletonMap(logicDataSourceName, replicaDataSourceNames);\n         DataSourceContainedRule rule2 = mock(DataSourceContainedRule.class);\n         when(rule2.getDataSourceMapper()).thenReturn(dataSourceMapper);\n         return new DataNodes(Arrays.asList(rule1, rule2));\n     }\n     \n     private DataNodes getNonRoutedRuleDataNodes() {\n-        return new DataNodes(Collections.singleton(new TestShardingSphereRule()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef2a176893a8b4d4beab76d611570b95954fdc18"}, "originalPosition": 54}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzMDcxMjUw", "url": "https://github.com/apache/shardingsphere/pull/8141#pullrequestreview-533071250", "createdAt": "2020-11-18T03:07:39Z", "commit": {"oid": "ef2a176893a8b4d4beab76d611570b95954fdc18"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "999e1c92245d31841c8dd7bc8fac9db4bcaa20e0", "author": {"user": {"login": "wenweibin", "name": "wenweibin"}}, "url": "https://github.com/apache/shardingsphere/commit/999e1c92245d31841c8dd7bc8fac9db4bcaa20e0", "committedDate": "2020-11-18T09:41:42Z", "message": "Merge branch 'master' of https://github.com/apache/shardingsphere into 8067"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce49f0baa21146e62c9715bb105b328e4d8259ee", "author": {"user": {"login": "wenweibin", "name": "wenweibin"}}, "url": "https://github.com/apache/shardingsphere/commit/ce49f0baa21146e62c9715bb105b328e4d8259ee", "committedDate": "2020-11-18T09:47:36Z", "message": "delete unused TestShardingRule.java and TestTableRule.java file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0MTIzODUz", "url": "https://github.com/apache/shardingsphere/pull/8141#pullrequestreview-534123853", "createdAt": "2020-11-19T06:51:00Z", "commit": {"oid": "ce49f0baa21146e62c9715bb105b328e4d8259ee"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4338, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}