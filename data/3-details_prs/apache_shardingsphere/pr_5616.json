{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4MzQ5MjQy", "number": 5616, "title": "Issue 5428 for SchemaChangedListenerTest.java", "bodyText": "For #5428 .\nChanges proposed in this pull request:\n\nMove inline string to yaml file in resource folder\nAdd method to read yaml as string", "createdAt": "2020-05-15T03:04:49Z", "url": "https://github.com/apache/shardingsphere/pull/5616", "merged": true, "mergeCommit": {"oid": "5e5044513f807225ecbe6a3a9b0a636eafe1deb2"}, "closed": true, "closedAt": "2020-05-15T09:20:55Z", "author": {"login": "hitnewbee"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchXqBfAH2gAyNDE4MzQ5MjQyOjE2YzdmN2E0MTU3MTRlYzFjYTY5NDJmMjIxZGRlOWYwNDFmMzIwMjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcheiGhgFqTQxMjQ4NDAzMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "16c7f7a415714ec1ca6942f221dde9f041f32026", "author": {"user": {"login": "hitnewbee", "name": null}}, "url": "https://github.com/apache/shardingsphere/commit/16c7f7a415714ec1ca6942f221dde9f041f32026", "committedDate": "2020-05-15T01:19:18Z", "message": "Merge pull request #1 from apache/master\n\nPull from Main"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "338d2feb036d0e421047280dcdb6441c569fc001", "author": {"user": {"login": "hitnewbee", "name": null}}, "url": "https://github.com/apache/shardingsphere/commit/338d2feb036d0e421047280dcdb6441c569fc001", "committedDate": "2020-05-15T01:41:51Z", "message": "add yaml file to replace inline string"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09c6332b10e446f0dbe9a064d7b458c46013148d", "author": {"user": {"login": "hitnewbee", "name": null}}, "url": "https://github.com/apache/shardingsphere/commit/09c6332b10e446f0dbe9a064d7b458c46013148d", "committedDate": "2020-05-15T02:58:37Z", "message": "read yaml into string"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01e3f54627c982e6c65b7fbd0132f2d7293c38a1", "author": {"user": {"login": "hitnewbee", "name": null}}, "url": "https://github.com/apache/shardingsphere/commit/01e3f54627c982e6c65b7fbd0132f2d7293c38a1", "committedDate": "2020-05-15T02:59:15Z", "message": "modify yaml file to dynamic rules"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMzIzNDUx", "url": "https://github.com/apache/shardingsphere/pull/5616#pullrequestreview-412323451", "createdAt": "2020-05-15T03:29:10Z", "commit": {"oid": "01e3f54627c982e6c65b7fbd0132f2d7293c38a1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwMzoyOToxMFrOGV1STw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwMzoyOToxMFrOGV1STw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTU0NjMxOQ==", "bodyText": "Why need to skip comment here? Can snake yaml process the comment?", "url": "https://github.com/apache/shardingsphere/pull/5616#discussion_r425546319", "createdAt": "2020-05-15T03:29:10Z", "author": {"login": "terrymanu"}, "path": "sharding-orchestration/sharding-orchestration-core/sharding-orchestration-core-configcenter/src/test/java/org/apache/shardingsphere/orchestration/core/configcenter/listener/SchemaChangedListenerTest.java", "diffHunk": "@@ -120,16 +83,33 @@ public void assertCreateIgnoredEvent() {\n     }\n     \n     @Test\n-    public void assertCreateDataSourceChangedEventForExistedSchema() {\n-        DataChangedEvent dataChangedEvent = new DataChangedEvent(\"/test/config/schema/sharding_db/datasource\", DATA_SOURCE_YAML, ChangedType.UPDATED);\n+    public void assertCreateDataSourceChangedEventForExistedSchema() throws IOException {\n+        String dataSource = readYamlIntoString(DATA_SOURCE_YAML);\n+        DataChangedEvent dataChangedEvent = new DataChangedEvent(\"/test/config/schema/sharding_db/datasource\", dataSource, ChangedType.UPDATED);\n         ShardingOrchestrationEvent actual = schemaChangedListener.createShardingOrchestrationEvent(dataChangedEvent);\n         assertThat(actual, instanceOf(DataSourceChangedEvent.class));\n         assertThat(((DataSourceChangedEvent) actual).getShardingSchemaName(), is(\"sharding_db\"));\n     }\n+\n+    private String readYamlIntoString(final String yamlFile) throws IOException {\n+        File file = new File(Preconditions.checkNotNull(getClass().getClassLoader().getResource(yamlFile), \"file resource `%s` must not be null.\", yamlFile).getFile());\n+        StringBuilder yamlContent = new StringBuilder();\n+        FileReader fileReader = new FileReader(file);\n+        BufferedReader reader = new BufferedReader(fileReader);\n+        String line;\n+        while (null != (line = reader.readLine())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01e3f54627c982e6c65b7fbd0132f2d7293c38a1"}, "originalPosition": 117}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMzIzNzAy", "url": "https://github.com/apache/shardingsphere/pull/5616#pullrequestreview-412323702", "createdAt": "2020-05-15T03:30:04Z", "commit": {"oid": "01e3f54627c982e6c65b7fbd0132f2d7293c38a1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwMzozMDowNFrOGV1TMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwMzozMDowNFrOGV1TMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTU0NjU0Nw==", "bodyText": "Please leave a new line in the end of file", "url": "https://github.com/apache/shardingsphere/pull/5616#discussion_r425546547", "createdAt": "2020-05-15T03:30:04Z", "author": {"login": "terrymanu"}, "path": "sharding-orchestration/sharding-orchestration-core/sharding-orchestration-core-configcenter/src/test/resources/sharding-rule.yaml", "diffHunk": "@@ -0,0 +1,30 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+\n+rules:\n+- !!org.apache.shardingsphere.sharding.yaml.config.YamlShardingRuleConfiguration\n+  tables:\n+    t_order:\n+      logicTable: t_order\n+      actualDataNodes: ds_${0..1}.t_order_${0..1}\n+      tableStrategy:\n+        standard:\n+          shardingAlgorithm:\n+            type: INLINE\n+            props:\n+              algorithm.expression: t_order_${order_id % 2}\n+          shardingColumn: order_id", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01e3f54627c982e6c65b7fbd0132f2d7293c38a1"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48fced5754b080d41ca53ebbd8b235003e0591d3", "author": {"user": {"login": "hitnewbee", "name": null}}, "url": "https://github.com/apache/shardingsphere/commit/48fced5754b080d41ca53ebbd8b235003e0591d3", "committedDate": "2020-05-15T06:49:04Z", "message": "add a new line at the end of file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f865027594cf7ffe37d10847c7b2d2fbfa514fa7", "author": {"user": {"login": "hitnewbee", "name": null}}, "url": "https://github.com/apache/shardingsphere/commit/f865027594cf7ffe37d10847c7b2d2fbfa514fa7", "committedDate": "2020-05-15T06:56:24Z", "message": "use snake yaml instead of File"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e162ce159a4e220312f60d07de36959817cf3a7a", "author": {"user": {"login": "hitnewbee", "name": null}}, "url": "https://github.com/apache/shardingsphere/commit/e162ce159a4e220312f60d07de36959817cf3a7a", "committedDate": "2020-05-15T07:01:55Z", "message": "Merge branch 'master' into issue-5428"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a6736b969d0cd7edc7df8ff2697cbf9902258aa", "author": {"user": {"login": "hitnewbee", "name": null}}, "url": "https://github.com/apache/shardingsphere/commit/1a6736b969d0cd7edc7df8ff2697cbf9902258aa", "committedDate": "2020-05-15T07:04:58Z", "message": "resolve confilct"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16e5dc5d33f9c47af3a429771b600e1321c1b835", "author": {"user": {"login": "hitnewbee", "name": null}}, "url": "https://github.com/apache/shardingsphere/commit/16e5dc5d33f9c47af3a429771b600e1321c1b835", "committedDate": "2020-05-15T07:54:07Z", "message": "remove unuse throw & checkstyle fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNDg0MDMy", "url": "https://github.com/apache/shardingsphere/pull/5616#pullrequestreview-412484032", "createdAt": "2020-05-15T09:19:59Z", "commit": {"oid": "16e5dc5d33f9c47af3a429771b600e1321c1b835"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3623, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}