{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1MjU3NDE5", "number": 4996, "title": "add sharding.transaction.seata.at.enable config to compatible with se\u2026", "bodyText": "when sharding.transaction.seata.at.enable = false,  SeataATShardingTransactionManager will be disabled, in this way original seata global transaction across services will compatible with shardingsphere since TransactionalSQLExecutionHook can transport global txId in multi-threads.\nuser should pay attention that @ShardingTransactionType(TransactionType.BASE) should not been introduced in original seata global transaction across services\nfor #4991", "createdAt": "2020-03-29T14:04:50Z", "url": "https://github.com/apache/shardingsphere/pull/4996", "merged": true, "mergeCommit": {"oid": "25a12d5f79da711b694a6b8b864c3a8d2fca4ed4"}, "closed": true, "closedAt": "2020-03-30T03:54:19Z", "author": {"login": "cherrylzhao"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcSaPdOAH2gAyMzk1MjU3NDE5OjY1NzE1MGFkNGVhNjEwNTQwZTY0ZTQ0ZWU3ZGExZjI5MGVmMGQ5NmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcSmTTqAFqTM4MzUxNTkyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "657150ad4ea610540e64e44ee7da1f290ef0d96f", "author": {"user": {"login": "cherrylzhao", "name": "zhaojun"}}, "url": "https://github.com/apache/shardingsphere/commit/657150ad4ea610540e64e44ee7da1f290ef0d96f", "committedDate": "2020-03-29T13:51:08Z", "message": "add sharding.transaction.seata.at.enable config to compatible with seata global transaction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac36182d547d0d61de0f9e874d21f0635446dfad", "author": {"user": {"login": "cherrylzhao", "name": "zhaojun"}}, "url": "https://github.com/apache/shardingsphere/commit/ac36182d547d0d61de0f9e874d21f0635446dfad", "committedDate": "2020-03-29T14:05:44Z", "message": "for checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNTA2ODgz", "url": "https://github.com/apache/shardingsphere/pull/4996#pullrequestreview-383506883", "createdAt": "2020-03-30T03:13:37Z", "commit": {"oid": "ac36182d547d0d61de0f9e874d21f0635446dfad"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwMzoxMzozN1rOF9YUeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwMzoxNzoxNFrOF9YXSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkwNTkxMg==", "bodyText": "Constant for literal\uff1f", "url": "https://github.com/apache/shardingsphere/pull/4996#discussion_r399905912", "createdAt": "2020-03-30T03:13:37Z", "author": {"login": "kimmking"}, "path": "sharding-transaction/sharding-transaction-base/sharding-transaction-base-seata-at/src/main/java/org/apache/shardingsphere/transaction/base/seata/at/SeataATShardingTransactionManager.java", "diffHunk": "@@ -47,34 +47,56 @@\n     \n     private final Map<String, DataSource> dataSourceMap = new HashMap<>();\n     \n-    private final FileConfiguration configuration = new FileConfiguration(\"seata.conf\");\n+    private final String applicationId;\n+    \n+    private final String transactionServiceGroup;\n+    \n+    private final boolean enableSeataAT;\n+    \n+    public SeataATShardingTransactionManager() {\n+        FileConfiguration configuration = new FileConfiguration(\"seata.conf\");\n+        enableSeataAT = configuration.getBoolean(\"sharding.transaction.seata.at.enable\", true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac36182d547d0d61de0f9e874d21f0635446dfad"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkwNjYzMg==", "bodyText": "If turn off this flag, seata client is not initialized and seat-at is disabled?", "url": "https://github.com/apache/shardingsphere/pull/4996#discussion_r399906632", "createdAt": "2020-03-30T03:17:14Z", "author": {"login": "kimmking"}, "path": "sharding-transaction/sharding-transaction-base/sharding-transaction-base-seata-at/src/main/java/org/apache/shardingsphere/transaction/base/seata/at/SeataATShardingTransactionManager.java", "diffHunk": "@@ -47,34 +47,56 @@\n     \n     private final Map<String, DataSource> dataSourceMap = new HashMap<>();\n     \n-    private final FileConfiguration configuration = new FileConfiguration(\"seata.conf\");\n+    private final String applicationId;\n+    \n+    private final String transactionServiceGroup;\n+    \n+    private final boolean enableSeataAT;\n+    \n+    public SeataATShardingTransactionManager() {\n+        FileConfiguration configuration = new FileConfiguration(\"seata.conf\");\n+        enableSeataAT = configuration.getBoolean(\"sharding.transaction.seata.at.enable\", true);\n+        applicationId = configuration.getConfig(\"client.application.id\");\n+        transactionServiceGroup = configuration.getConfig(\"client.transaction.service.group\", \"default\");\n+    }\n     \n     @Override\n     public void init(final DatabaseType databaseType, final Collection<ResourceDataSource> resourceDataSources) {\n-        initSeataRPCClient();\n-        for (ResourceDataSource each : resourceDataSources) {\n-            dataSourceMap.put(each.getOriginalName(), new DataSourceProxy(each.getDataSource()));\n+        if (enableSeataAT) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac36182d547d0d61de0f9e874d21f0635446dfad"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNTE1OTI3", "url": "https://github.com/apache/shardingsphere/pull/4996#pullrequestreview-383515927", "createdAt": "2020-03-30T03:54:12Z", "commit": {"oid": "ac36182d547d0d61de0f9e874d21f0635446dfad"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3748, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}