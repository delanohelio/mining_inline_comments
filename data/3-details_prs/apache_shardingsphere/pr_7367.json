{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyOTEyOTU1", "number": 7367, "title": "Support oracle connect descriptor url", "bodyText": "Fixes #7195\nChanges proposed in this pull request:\n\nsupport oracle rac (connect descriptor url style) see detail", "createdAt": "2020-09-09T15:07:18Z", "url": "https://github.com/apache/shardingsphere/pull/7367", "merged": true, "mergeCommit": {"oid": "5d8fdd4d29e082f5db4e13ff6e1195d146e3613c"}, "closed": true, "closedAt": "2020-09-11T11:07:28Z", "author": {"login": "xbkaishui"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHNlhHgH2gAyNDgyOTEyOTU1OjY5NTMwZjcyMTdmMjBiODU0OWUwZWVhNTJmZTVmODA2YTMzMmQwMGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHzZLhAFqTQ4NjcxMjc4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "69530f7217f20b8549e0eea52fe5f806a332d00b", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/shardingsphere/commit/69530f7217f20b8549e0eea52fe5f806a332d00b", "committedDate": "2020-09-09T15:04:27Z", "message": "support oracle connect descriptor url see\uff1ahttps://docs.oracle.com/en/database/oracle/oracle-database/18/netag/identifying-and-accessing-database.html#GUID-2BDF9E52-4147-4F46-84E2-A5AE1018A373"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1NTIzNzQ3", "url": "https://github.com/apache/shardingsphere/pull/7367#pullrequestreview-485523747", "createdAt": "2020-09-10T02:30:52Z", "commit": {"oid": "69530f7217f20b8549e0eea52fe5f806a332d00b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwMjozMDo1MlrOHPgrqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwMjozNTowOVrOHPgv0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjAyNjE1NQ==", "bodyText": "Could we merge two of the patterns?", "url": "https://github.com/apache/shardingsphere/pull/7367#discussion_r486026155", "createdAt": "2020-09-10T02:30:52Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-infra/shardingsphere-infra-common/src/main/java/org/apache/shardingsphere/infra/database/metadata/dialect/OracleDataSourceMetaData.java", "diffHunk": "@@ -33,24 +33,39 @@\n     \n     private static final int DEFAULT_PORT = 1521;\n     \n-    private final String hostName;\n+    private String hostName;\n     \n-    private final int port;\n+    private int port;\n     \n-    private final String catalog;\n+    private String catalog;\n     \n-    private final String schema;\n+    private String schema;\n     \n-    private final Pattern pattern = Pattern.compile(\"jdbc:oracle:(thin|oci|kprb):@(//)?([\\\\w\\\\-\\\\.]+):?([0-9]*)[:/]([\\\\w\\\\-]+)\", Pattern.CASE_INSENSITIVE);\n+    private final Pattern thinUrlPattern = Pattern.compile(\"jdbc:oracle:(thin|oci|kprb):@(//)?([\\\\w\\\\-\\\\.]+):?([0-9]*)[:/]([\\\\w\\\\-]+)\", Pattern.CASE_INSENSITIVE);\n+    \n+    private final Pattern connectDescriptorUrlPattern = Pattern.compile(\"jdbc:oracle:(thin|oci|kprb):@[(\\\\w\\\\s=)]+HOST\\\\s*=\\\\s*(\\\\d+(\\\\.\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69530f7217f20b8549e0eea52fe5f806a332d00b"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjAyNzIxOA==", "bodyText": "Why did you remove the final?", "url": "https://github.com/apache/shardingsphere/pull/7367#discussion_r486027218", "createdAt": "2020-09-10T02:35:09Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-infra/shardingsphere-infra-common/src/main/java/org/apache/shardingsphere/infra/database/metadata/dialect/OracleDataSourceMetaData.java", "diffHunk": "@@ -33,24 +33,39 @@\n     \n     private static final int DEFAULT_PORT = 1521;\n     \n-    private final String hostName;\n+    private String hostName;\n     \n-    private final int port;\n+    private int port;\n     \n-    private final String catalog;\n+    private String catalog;\n     \n-    private final String schema;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69530f7217f20b8549e0eea52fe5f806a332d00b"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4cbc45aa6c22b25225974f7f7556a4182e14286d", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/shardingsphere/commit/4cbc45aa6c22b25225974f7f7556a4182e14286d", "committedDate": "2020-09-10T10:06:26Z", "message": "change variable to final"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2NDM4MTc3", "url": "https://github.com/apache/shardingsphere/pull/7367#pullrequestreview-486438177", "createdAt": "2020-09-11T02:49:31Z", "commit": {"oid": "4cbc45aa6c22b25225974f7f7556a4182e14286d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwMjo0OTozMVrOHQMY-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwMjo0OTozMVrOHQMY-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njc0MjI2NQ==", "bodyText": "Hi, why did you rename it as thinUrlPattern? Did you quote it somewhere?", "url": "https://github.com/apache/shardingsphere/pull/7367#discussion_r486742265", "createdAt": "2020-09-11T02:49:31Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-infra/shardingsphere-infra-common/src/main/java/org/apache/shardingsphere/infra/database/metadata/dialect/OracleDataSourceMetaData.java", "diffHunk": "@@ -41,12 +41,23 @@\n     \n     private final String schema;\n     \n-    private final Pattern pattern = Pattern.compile(\"jdbc:oracle:(thin|oci|kprb):@(//)?([\\\\w\\\\-\\\\.]+):?([0-9]*)[:/]([\\\\w\\\\-]+)\", Pattern.CASE_INSENSITIVE);\n+    private final Pattern thinUrlPattern = Pattern.compile(\"jdbc:oracle:(thin|oci|kprb):@(//)?([\\\\w\\\\-\\\\.]+):?([0-9]*)[:/]([\\\\w\\\\-]+)\", Pattern.CASE_INSENSITIVE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4cbc45aa6c22b25225974f7f7556a4182e14286d"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2NDQ3MzUy", "url": "https://github.com/apache/shardingsphere/pull/7367#pullrequestreview-486447352", "createdAt": "2020-09-11T03:22:33Z", "commit": {"oid": "4cbc45aa6c22b25225974f7f7556a4182e14286d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwMzoyMjozM1rOHQM5fQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwMzoyMjozM1rOHQM5fQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njc1MDU4OQ==", "bodyText": "It seems not so concise. How about this programing clip?\nCollection<Matcher> matchers;\nfor each `matchers`\nif each.find() {\n}\nend\nthrow new Exception", "url": "https://github.com/apache/shardingsphere/pull/7367#discussion_r486750589", "createdAt": "2020-09-11T03:22:33Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-infra/shardingsphere-infra-common/src/main/java/org/apache/shardingsphere/infra/database/metadata/dialect/OracleDataSourceMetaData.java", "diffHunk": "@@ -41,12 +41,23 @@\n     \n     private final String schema;\n     \n-    private final Pattern pattern = Pattern.compile(\"jdbc:oracle:(thin|oci|kprb):@(//)?([\\\\w\\\\-\\\\.]+):?([0-9]*)[:/]([\\\\w\\\\-]+)\", Pattern.CASE_INSENSITIVE);\n+    private final Pattern thinUrlPattern = Pattern.compile(\"jdbc:oracle:(thin|oci|kprb):@(//)?([\\\\w\\\\-\\\\.]+):?([0-9]*)[:/]([\\\\w\\\\-]+)\", Pattern.CASE_INSENSITIVE);\n+    \n+    private final Pattern connectDescriptorUrlPattern = Pattern.compile(\"jdbc:oracle:(thin|oci|kprb):@[(\\\\w\\\\s=)]+HOST\\\\s*=\\\\s*(\\\\d+(\\\\.\"\n+            + \"((2(5[0-5]|[0-4]\\\\d))|[0-1]?\\\\d{1,2})){3}).*PORT\\\\s*=\\\\s*(\\\\d+).*SERVICE_NAME\\\\s*=\\\\s*(\\\\w+)\\\\)\");\n     \n     public OracleDataSourceMetaData(final String url, final String username) {\n-        Matcher matcher = pattern.matcher(url);\n+        Matcher matcher = thinUrlPattern.matcher(url);\n         if (!matcher.find()) {\n-            throw new UnrecognizedDatabaseURLException(url, pattern.pattern());\n+            matcher = connectDescriptorUrlPattern.matcher(url);\n+            if (!matcher.find()) {\n+                throw new UnrecognizedDatabaseURLException(url, connectDescriptorUrlPattern.pattern());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4cbc45aa6c22b25225974f7f7556a4182e14286d"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acfca7769627082d7f276b99002fe15cb563dcfa", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/shardingsphere/commit/acfca7769627082d7f276b99002fe15cb563dcfa", "committedDate": "2020-09-11T03:54:46Z", "message": "adjust code structure"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2NzEyNzgz", "url": "https://github.com/apache/shardingsphere/pull/7367#pullrequestreview-486712783", "createdAt": "2020-09-11T11:07:22Z", "commit": {"oid": "acfca7769627082d7f276b99002fe15cb563dcfa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4076, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}