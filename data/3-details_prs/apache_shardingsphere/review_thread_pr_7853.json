{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2MDYxNTU4", "number": 7853, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQwNDowOToyMlrOEvlzNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQwNDowOToyMlrOEvlzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4MzM3ODQ0OnYy", "diffSide": "RIGHT", "path": "shardingsphere-features/shardingsphere-sharding/shardingsphere-sharding-route/src/main/java/org/apache/shardingsphere/sharding/route/engine/validator/ddl/impl/ShardingCreateProcedureStatementValidator.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQwNDowOToyMlrOHkp6Pw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQwNDo1OTo1OFrOHkqrkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODE5NzQzOQ==", "bodyText": "Hi @strongduanmu\nI know this PR is a time-consuming job, Very appreciated your initiative!\nCreate procedure, function, view is a troublesome but user-liked issue that sometimes frustrates me to think about it. You are the pioneer for this challenging one, so I wish you could improve it step by step for a satisfying solution.\nAt present, I can see the create view is narrowed to those single tables (no sharding tables, broadcast tables) , isn't it? It seems a critical first step for me, and I will give my +1 vote.\nHowever, here It looks like you enable create function, procedure on the sharding table as well, right? Do you think these SQL could work well on all the sharding tables and single tables? Or are there any restrictions?\nLook forward to hearing from you.\nBest,\nTrista", "url": "https://github.com/apache/shardingsphere/pull/7853#discussion_r508197439", "createdAt": "2020-10-20T04:09:22Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-features/shardingsphere-sharding/shardingsphere-sharding-route/src/main/java/org/apache/shardingsphere/sharding/route/engine/validator/ddl/impl/ShardingCreateProcedureStatementValidator.java", "diffHunk": "@@ -42,7 +44,9 @@ public void preValidate(final ShardingRule shardingRule, final SQLStatementConte\n         routineBodySegment.ifPresent(routineBody -> {\n             TableExtractor extractor = new TableExtractor();\n             validateTableNotExist(metaData, extractor.extractNotExistTableFromRoutineBody(routineBody));\n-            validateShardingTable(metaData, extractor.extractExistTableFromRoutineBody(routineBody));\n+            Collection<SimpleTableSegment> existTables = extractor.extractExistTableFromRoutineBody(routineBody);\n+            validateShardingTable(metaData, existTables);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57dde13aba6df195f2e2e9203d68a874457f8fbf"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODIxMDA2Nw==", "bodyText": "Hi @strongduanmu\nI know this PR is a time-consuming job, Very appreciated your initiative!\nCreate procedure, function, view is a troublesome but user-liked issue that sometimes frustrates me to think about it. You are the pioneer for this challenging one, so I wish you could improve it step by step for a satisfying solution.\nAt present, I can see the create view is narrowed to those single tables (no sharding tables, broadcast tables) , isn't it? It seems a critical first step for me, and I will give my +1 vote.\nHowever, here It looks like you enable create function, procedure on the sharding table as well, right? Do you think these SQL could work well on all the sharding tables and single tables? Or are there any restrictions?\nLook forward to hearing from you.\nBest,\nTrista\n\n@tristaZero The create function and create procedure statements have previously added a validator to limit the use of the sharding table. This pr is only to modify the routing way of the create function and create procedure statements and change it to all databases routing. \ud83d\ude02", "url": "https://github.com/apache/shardingsphere/pull/7853#discussion_r508210067", "createdAt": "2020-10-20T04:59:58Z", "author": {"login": "strongduanmu"}, "path": "shardingsphere-features/shardingsphere-sharding/shardingsphere-sharding-route/src/main/java/org/apache/shardingsphere/sharding/route/engine/validator/ddl/impl/ShardingCreateProcedureStatementValidator.java", "diffHunk": "@@ -42,7 +44,9 @@ public void preValidate(final ShardingRule shardingRule, final SQLStatementConte\n         routineBodySegment.ifPresent(routineBody -> {\n             TableExtractor extractor = new TableExtractor();\n             validateTableNotExist(metaData, extractor.extractNotExistTableFromRoutineBody(routineBody));\n-            validateShardingTable(metaData, extractor.extractExistTableFromRoutineBody(routineBody));\n+            Collection<SimpleTableSegment> existTables = extractor.extractExistTableFromRoutineBody(routineBody);\n+            validateShardingTable(metaData, existTables);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODE5NzQzOQ=="}, "originalCommit": {"oid": "57dde13aba6df195f2e2e9203d68a874457f8fbf"}, "originalPosition": 18}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 597, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}