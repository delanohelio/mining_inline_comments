{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxMDc1MTA4", "number": 7740, "title": "support create, alter, drop, select view statement", "bodyText": "Fixes #7138.\nChanges proposed in this pull request:\n\nsupport create, alter, drop statement\nadd create, alter view validator\nadd view_type in SchemaMetaDataLoader to support select view", "createdAt": "2020-10-11T04:05:07Z", "url": "https://github.com/apache/shardingsphere/pull/7740", "merged": true, "mergeCommit": {"oid": "101378ed8d2aee68752c9523a3efc416c8ed6a5d"}, "closed": true, "closedAt": "2020-10-13T03:19:47Z", "author": {"login": "strongduanmu"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdRXR0xAH2gAyNTAxMDc1MTA4OjUxMjgzN2IzMDRmMWQzOWM4NDdiZGRjZWMwMDIyNDMxOWQ0MWRiZGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdR_4aVgFqTUwNzA0MTA1NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "512837b304f1d39c847bddcec00224319d41dbdf", "author": {"user": {"login": "strongduanmu", "name": "Zhengqiang Duan"}}, "url": "https://github.com/apache/shardingsphere/commit/512837b304f1d39c847bddcec00224319d41dbdf", "committedDate": "2020-10-11T04:01:14Z", "message": "support create, alter, drop, select view statement"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d40f65bfc98f7ac94f2ed4388e9b525fbe7f7910", "author": {"user": {"login": "strongduanmu", "name": "Zhengqiang Duan"}}, "url": "https://github.com/apache/shardingsphere/commit/d40f65bfc98f7ac94f2ed4388e9b525fbe7f7910", "committedDate": "2020-10-11T05:12:49Z", "message": "fix unit test error"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MTY4MTY1", "url": "https://github.com/apache/shardingsphere/pull/7740#pullrequestreview-506168165", "createdAt": "2020-10-11T11:02:21Z", "commit": {"oid": "d40f65bfc98f7ac94f2ed4388e9b525fbe7f7910"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMVQxMTowMjoyMlrOHfmlOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMVQxMTowMjoyMlrOHfmlOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjkwMDAyNQ==", "bodyText": "Is this class just for some of the unsupported DDLSQLStataments?  In that case, do you think an abstract class to carry these functions will be better?\nStatementValidatorUtil gives me a  feeling that it is born for all the statements.", "url": "https://github.com/apache/shardingsphere/pull/7740#discussion_r502900025", "createdAt": "2020-10-11T11:02:22Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-features/shardingsphere-sharding/shardingsphere-sharding-route/src/main/java/org/apache/shardingsphere/sharding/route/engine/validator/util/StatementValidatorUtil.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.shardingsphere.sharding.route.engine.validator.util;\n+\n+import lombok.AccessLevel;\n+import lombok.NoArgsConstructor;\n+import org.apache.shardingsphere.infra.exception.ShardingSphereException;\n+import org.apache.shardingsphere.infra.metadata.ShardingSphereMetaData;\n+import org.apache.shardingsphere.sharding.route.engine.exception.NoSuchTableException;\n+import org.apache.shardingsphere.sharding.route.engine.exception.TableExistsException;\n+import org.apache.shardingsphere.sql.parser.sql.common.segment.generic.table.SimpleTableSegment;\n+\n+import java.util.Collection;\n+import java.util.Map;\n+\n+/**\n+ * Statement validator utility class.\n+ */\n+@NoArgsConstructor(access = AccessLevel.PRIVATE)\n+public final class StatementValidatorUtil {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d40f65bfc98f7ac94f2ed4388e9b525fbe7f7910"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MTY4ODgy", "url": "https://github.com/apache/shardingsphere/pull/7740#pullrequestreview-506168882", "createdAt": "2020-10-11T11:11:49Z", "commit": {"oid": "d40f65bfc98f7ac94f2ed4388e9b525fbe7f7910"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMVQxMToxMTo1MFrOHfmpRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMVQxMToxMTo1MFrOHfmpRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjkwMTA2Mg==", "bodyText": "If Create view SQL can work well for single table currently, do you think ShardingUnconfiguredTablesRoutingEngine will be a better match?", "url": "https://github.com/apache/shardingsphere/pull/7740#discussion_r502901062", "createdAt": "2020-10-11T11:11:50Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-features/shardingsphere-sharding/shardingsphere-sharding-route/src/main/java/org/apache/shardingsphere/sharding/route/engine/validator/ShardingStatementValidatorFactory.java", "diffHunk": "@@ -66,6 +73,25 @@\n         if (sqlStatement instanceof CreateProcedureStatement) {\n             return Optional.of(new ShardingCreateProcedureStatementValidator());\n         }\n+        if (sqlStatement instanceof CreateViewStatement) {\n+            return Optional.of(new ShardingCreateViewStatementValidator());\n+        }\n+        if (sqlStatement instanceof AlterViewStatement) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d40f65bfc98f7ac94f2ed4388e9b525fbe7f7910"}, "originalPosition": 54}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87a889a26c45c69a2fa9479127331635e3618dd3", "author": {"user": {"login": "strongduanmu", "name": "Zhengqiang Duan"}}, "url": "https://github.com/apache/shardingsphere/commit/87a889a26c45c69a2fa9479127331635e3618dd3", "committedDate": "2020-10-11T14:00:08Z", "message": "resolve code conflict"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "102f78601455b438093363fabc8b23c64b985c82", "author": {"user": {"login": "strongduanmu", "name": "Zhengqiang Duan"}}, "url": "https://github.com/apache/shardingsphere/commit/102f78601455b438093363fabc8b23c64b985c82", "committedDate": "2020-10-12T12:09:09Z", "message": "extract ShardingDDLStatementValidator and ShardingDMLStatementValidator to carry common functions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77d3d83e2c18cc5f7e72ec97b6954563438282c8", "author": {"user": {"login": "strongduanmu", "name": "Zhengqiang Duan"}}, "url": "https://github.com/apache/shardingsphere/commit/77d3d83e2c18cc5f7e72ec97b6954563438282c8", "committedDate": "2020-10-12T16:33:20Z", "message": "modify route engine to ShardingUnconfiguredTablesRoutingEngine"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05cffa61e4f9b4c8b6844d0caa2e388c1a07455b", "author": {"user": {"login": "strongduanmu", "name": "Zhengqiang Duan"}}, "url": "https://github.com/apache/shardingsphere/commit/05cffa61e4f9b4c8b6844d0caa2e388c1a07455b", "committedDate": "2020-10-12T17:06:39Z", "message": "resolve code conflict"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MDQxMDU1", "url": "https://github.com/apache/shardingsphere/pull/7740#pullrequestreview-507041055", "createdAt": "2020-10-13T03:17:18Z", "commit": {"oid": "05cffa61e4f9b4c8b6844d0caa2e388c1a07455b"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwMzoxNzoxOFrOHgT8Wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwMzoxODozMVrOHgT9Uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY0MzIyNg==", "bodyText": "Oh, you did it!", "url": "https://github.com/apache/shardingsphere/pull/7740#discussion_r503643226", "createdAt": "2020-10-13T03:17:18Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-features/shardingsphere-sharding/shardingsphere-sharding-route/src/main/java/org/apache/shardingsphere/sharding/route/engine/validator/dml/ShardingDMLStatementValidator.java", "diffHunk": "@@ -0,0 +1,41 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.shardingsphere.sharding.route.engine.validator.dml;\n+\n+import org.apache.shardingsphere.infra.binder.statement.SQLStatementContext;\n+import org.apache.shardingsphere.infra.binder.type.TableAvailable;\n+import org.apache.shardingsphere.infra.exception.ShardingSphereException;\n+import org.apache.shardingsphere.sharding.route.engine.validator.ShardingStatementValidator;\n+import org.apache.shardingsphere.sql.parser.sql.common.statement.SQLStatement;\n+\n+/**\n+ * Sharding dml statement validator.\n+ */\n+public abstract class ShardingDMLStatementValidator<T extends SQLStatement> implements ShardingStatementValidator<T> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05cffa61e4f9b4c8b6844d0caa2e388c1a07455b"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY0MzQ3NQ==", "bodyText": "Why do we need VIEW_TYPE?", "url": "https://github.com/apache/shardingsphere/pull/7740#discussion_r503643475", "createdAt": "2020-10-13T03:18:31Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-infra/shardingsphere-infra-common/src/main/java/org/apache/shardingsphere/infra/metadata/model/schema/model/schema/SchemaMetaDataLoader.java", "diffHunk": "@@ -42,6 +42,8 @@\n     \n     private static final String TABLE_TYPE = \"TABLE\";\n     \n+    private static final String VIEW_TYPE = \"VIEW\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05cffa61e4f9b4c8b6844d0caa2e388c1a07455b"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3962, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}