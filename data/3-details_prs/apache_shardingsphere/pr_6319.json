{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ3Mjg1OTkz", "number": 6319, "title": "fix for rewrite of subquery", "bodyText": "", "createdAt": "2020-07-10T07:52:41Z", "url": "https://github.com/apache/shardingsphere/pull/6319", "merged": true, "mergeCommit": {"oid": "9c877df6a7b7581b27ead72ffeed7e9595ed2017"}, "closed": true, "closedAt": "2020-07-13T08:59:22Z", "author": {"login": "jingshanglu"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcze0FsAH2gAyNDQ3Mjg1OTkzOjBkYjkwMjQxZmNjNWFkMzAxZDMzZGYxMzRlZTVhYWJlYzk3ODExMmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc0dmVqAFqTQ0NzA1OTgyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0db90241fcc5ad301d33df134ee5aabec978112e", "author": {"user": {"login": "jingshanglu", "name": "JingShang Lu"}}, "url": "https://github.com/apache/shardingsphere/commit/0db90241fcc5ad301d33df134ee5aabec978112e", "committedDate": "2020-07-10T07:50:16Z", "message": "fix for rewrite of subquery"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3MDAzMTQ1", "url": "https://github.com/apache/shardingsphere/pull/6319#pullrequestreview-447003145", "createdAt": "2020-07-13T06:11:10Z", "commit": {"oid": "0db90241fcc5ad301d33df134ee5aabec978112e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QwNjoxMToxMFrOGwcoJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QwNjoxNDowM1rOGwcrNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzQ1Mzg2Mg==", "bodyText": "It seems two of those statements can be merged into one. Please simplify it.", "url": "https://github.com/apache/shardingsphere/pull/6319#discussion_r453453862", "createdAt": "2020-07-13T06:11:10Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-binder/src/main/java/org/apache/shardingsphere/sql/parser/binder/statement/dml/SelectStatementContext.java", "diffHunk": "@@ -192,42 +193,32 @@ public boolean isSameGroupByAndOrderByItems() {\n     \n     @Override\n     public Collection<SimpleTableSegment> getAllTables() {\n-        Collection<SimpleTableSegment> result = new LinkedList<>(getSimpleTableSegments());\n-        if (getSqlStatement().getWhere().isPresent()) {\n-            result.addAll(getAllTablesFromWhere(getSqlStatement().getWhere().get()));\n-        }\n-        result.addAll(getAllTablesFromProjections(getSqlStatement().getProjections()));\n-        if (getSqlStatement().getGroupBy().isPresent()) {\n-            result.addAll(getAllTablesFromOrderByItems(getSqlStatement().getGroupBy().get().getGroupByItems()));\n-        }\n-        if (getSqlStatement().getOrderBy().isPresent()) {\n-            result.addAll(getAllTablesFromOrderByItems(getSqlStatement().getOrderBy().get().getOrderByItems()));\n-        }\n+        Collection<SimpleTableSegment> result = getTableFromSelect(getSqlStatement());\n         return result;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0db90241fcc5ad301d33df134ee5aabec978112e"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzQ1NDY0Nw==", "bodyText": "Are there other cases covering more the subqueries?", "url": "https://github.com/apache/shardingsphere/pull/6319#discussion_r453454647", "createdAt": "2020-07-13T06:14:03Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-features/shardingsphere-sharding/shardingsphere-sharding-rewrite/src/test/resources/sharding/select.xml", "diffHunk": "@@ -28,8 +28,8 @@\n     </rewrite-assertion>\n \n     <rewrite-assertion id=\"select_with_subquery\" db-type=\"MySQL\">\n-        <input sql=\"SELECT * FROM (select * from t_account where account_id=?) a WHERE account_id = 100\" parameters=\"100\" />\n-        <output sql=\"SELECT * FROM (select * from t_account_0 where account_id=?) a WHERE account_id = 100\" parameters=\"100\" />\n+        <input sql=\"SELECT * FROM (select t_account.account_id from t_account where t_account.account_id=?) a WHERE account_id = 100\" parameters=\"100\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0db90241fcc5ad301d33df134ee5aabec978112e"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "282ffa6d995577e5b171ff4169f27806d930b765", "author": {"user": {"login": "jingshanglu", "name": "JingShang Lu"}}, "url": "https://github.com/apache/shardingsphere/commit/282ffa6d995577e5b171ff4169f27806d930b765", "committedDate": "2020-07-13T06:42:04Z", "message": "add some test case"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3MDU5ODI4", "url": "https://github.com/apache/shardingsphere/pull/6319#pullrequestreview-447059828", "createdAt": "2020-07-13T08:59:16Z", "commit": {"oid": "282ffa6d995577e5b171ff4169f27806d930b765"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4879, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}