{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2MDYxNTU4", "number": 7853, "title": "support mysql create and drop view refresh meta data", "bodyText": "Ref #7138.\nChanges proposed in this pull request:\n\nsupport mysql create and drop view refresh meta data\nmodify routing way of mysql function and procedure statements to all databases route", "createdAt": "2020-10-19T15:11:59Z", "url": "https://github.com/apache/shardingsphere/pull/7853", "merged": true, "mergeCommit": {"oid": "e4428d6a4fb312a4579e8320e4e019b5d05dc5cc"}, "closed": true, "closedAt": "2020-10-20T06:04:06Z", "author": {"login": "strongduanmu"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUFAnTgH2gAyNTA2MDYxNTU4OmUzNTY1ZGYwZDI1ODE2MjAxMmI5N2YzYzJhMDJhYzg1YjI3YWU4MDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUSbZOAFqTUxMjM1NTMzMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e3565df0d258162012b97f3c2a02ac85b27ae803", "author": {"user": {"login": "strongduanmu", "name": "Zhengqiang Duan"}}, "url": "https://github.com/apache/shardingsphere/commit/e3565df0d258162012b97f3c2a02ac85b27ae803", "committedDate": "2020-10-19T14:25:55Z", "message": "support create and drop view refresh meta data"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57dde13aba6df195f2e2e9203d68a874457f8fbf", "author": {"user": {"login": "strongduanmu", "name": "Zhengqiang Duan"}}, "url": "https://github.com/apache/shardingsphere/commit/57dde13aba6df195f2e2e9203d68a874457f8fbf", "committedDate": "2020-10-19T15:03:50Z", "message": "support function and procedure all databases route"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyMzE2OTE4", "url": "https://github.com/apache/shardingsphere/pull/7853#pullrequestreview-512316918", "createdAt": "2020-10-20T04:09:22Z", "commit": {"oid": "57dde13aba6df195f2e2e9203d68a874457f8fbf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQwNDowOToyMlrOHkp6Pw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQwNDowOToyMlrOHkp6Pw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODE5NzQzOQ==", "bodyText": "Hi @strongduanmu\nI know this PR is a time-consuming job, Very appreciated your initiative!\nCreate procedure, function, view is a troublesome but user-liked issue that sometimes frustrates me to think about it. You are the pioneer for this challenging one, so I wish you could improve it step by step for a satisfying solution.\nAt present, I can see the create view is narrowed to those single tables (no sharding tables, broadcast tables) , isn't it? It seems a critical first step for me, and I will give my +1 vote.\nHowever, here It looks like you enable create function, procedure on the sharding table as well, right? Do you think these SQL could work well on all the sharding tables and single tables? Or are there any restrictions?\nLook forward to hearing from you.\nBest,\nTrista", "url": "https://github.com/apache/shardingsphere/pull/7853#discussion_r508197439", "createdAt": "2020-10-20T04:09:22Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-features/shardingsphere-sharding/shardingsphere-sharding-route/src/main/java/org/apache/shardingsphere/sharding/route/engine/validator/ddl/impl/ShardingCreateProcedureStatementValidator.java", "diffHunk": "@@ -42,7 +44,9 @@ public void preValidate(final ShardingRule shardingRule, final SQLStatementConte\n         routineBodySegment.ifPresent(routineBody -> {\n             TableExtractor extractor = new TableExtractor();\n             validateTableNotExist(metaData, extractor.extractNotExistTableFromRoutineBody(routineBody));\n-            validateShardingTable(metaData, extractor.extractExistTableFromRoutineBody(routineBody));\n+            Collection<SimpleTableSegment> existTables = extractor.extractExistTableFromRoutineBody(routineBody);\n+            validateShardingTable(metaData, existTables);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57dde13aba6df195f2e2e9203d68a874457f8fbf"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyMzIwOTYx", "url": "https://github.com/apache/shardingsphere/pull/7853#pullrequestreview-512320961", "createdAt": "2020-10-20T04:23:47Z", "commit": {"oid": "57dde13aba6df195f2e2e9203d68a874457f8fbf"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e12eb802ac84741f093bda89653420c9614095b", "author": {"user": {"login": "strongduanmu", "name": "Zhengqiang Duan"}}, "url": "https://github.com/apache/shardingsphere/commit/3e12eb802ac84741f093bda89653420c9614095b", "committedDate": "2020-10-20T05:04:25Z", "message": "resolve conflict"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyMzU1MzMy", "url": "https://github.com/apache/shardingsphere/pull/7853#pullrequestreview-512355332", "createdAt": "2020-10-20T06:03:56Z", "commit": {"oid": "3e12eb802ac84741f093bda89653420c9614095b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3916, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}