{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1MjU3NDE5", "number": 4996, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwMzoxMzozN1rODsfzGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwMzoxNzoxNFrODsf1BA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3OTg0OTIwOnYy", "diffSide": "RIGHT", "path": "sharding-transaction/sharding-transaction-base/sharding-transaction-base-seata-at/src/main/java/org/apache/shardingsphere/transaction/base/seata/at/SeataATShardingTransactionManager.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwMzoxMzozN1rOF9YUeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwODowMjoyN1rOF9d48Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkwNTkxMg==", "bodyText": "Constant for literal\uff1f", "url": "https://github.com/apache/shardingsphere/pull/4996#discussion_r399905912", "createdAt": "2020-03-30T03:13:37Z", "author": {"login": "kimmking"}, "path": "sharding-transaction/sharding-transaction-base/sharding-transaction-base-seata-at/src/main/java/org/apache/shardingsphere/transaction/base/seata/at/SeataATShardingTransactionManager.java", "diffHunk": "@@ -47,34 +47,56 @@\n     \n     private final Map<String, DataSource> dataSourceMap = new HashMap<>();\n     \n-    private final FileConfiguration configuration = new FileConfiguration(\"seata.conf\");\n+    private final String applicationId;\n+    \n+    private final String transactionServiceGroup;\n+    \n+    private final boolean enableSeataAT;\n+    \n+    public SeataATShardingTransactionManager() {\n+        FileConfiguration configuration = new FileConfiguration(\"seata.conf\");\n+        enableSeataAT = configuration.getBoolean(\"sharding.transaction.seata.at.enable\", true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac36182d547d0d61de0f9e874d21f0635446dfad"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk5NzE2OQ==", "bodyText": "I'll fix it in next PR", "url": "https://github.com/apache/shardingsphere/pull/4996#discussion_r399997169", "createdAt": "2020-03-30T08:02:27Z", "author": {"login": "cherrylzhao"}, "path": "sharding-transaction/sharding-transaction-base/sharding-transaction-base-seata-at/src/main/java/org/apache/shardingsphere/transaction/base/seata/at/SeataATShardingTransactionManager.java", "diffHunk": "@@ -47,34 +47,56 @@\n     \n     private final Map<String, DataSource> dataSourceMap = new HashMap<>();\n     \n-    private final FileConfiguration configuration = new FileConfiguration(\"seata.conf\");\n+    private final String applicationId;\n+    \n+    private final String transactionServiceGroup;\n+    \n+    private final boolean enableSeataAT;\n+    \n+    public SeataATShardingTransactionManager() {\n+        FileConfiguration configuration = new FileConfiguration(\"seata.conf\");\n+        enableSeataAT = configuration.getBoolean(\"sharding.transaction.seata.at.enable\", true);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkwNTkxMg=="}, "originalCommit": {"oid": "ac36182d547d0d61de0f9e874d21f0635446dfad"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3OTg1NDEyOnYy", "diffSide": "RIGHT", "path": "sharding-transaction/sharding-transaction-base/sharding-transaction-base-seata-at/src/main/java/org/apache/shardingsphere/transaction/base/seata/at/SeataATShardingTransactionManager.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwMzoxNzoxNFrOF9YXSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwODowNDo0N1rOF9d-DQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkwNjYzMg==", "bodyText": "If turn off this flag, seata client is not initialized and seat-at is disabled?", "url": "https://github.com/apache/shardingsphere/pull/4996#discussion_r399906632", "createdAt": "2020-03-30T03:17:14Z", "author": {"login": "kimmking"}, "path": "sharding-transaction/sharding-transaction-base/sharding-transaction-base-seata-at/src/main/java/org/apache/shardingsphere/transaction/base/seata/at/SeataATShardingTransactionManager.java", "diffHunk": "@@ -47,34 +47,56 @@\n     \n     private final Map<String, DataSource> dataSourceMap = new HashMap<>();\n     \n-    private final FileConfiguration configuration = new FileConfiguration(\"seata.conf\");\n+    private final String applicationId;\n+    \n+    private final String transactionServiceGroup;\n+    \n+    private final boolean enableSeataAT;\n+    \n+    public SeataATShardingTransactionManager() {\n+        FileConfiguration configuration = new FileConfiguration(\"seata.conf\");\n+        enableSeataAT = configuration.getBoolean(\"sharding.transaction.seata.at.enable\", true);\n+        applicationId = configuration.getConfig(\"client.application.id\");\n+        transactionServiceGroup = configuration.getConfig(\"client.transaction.service.group\", \"default\");\n+    }\n     \n     @Override\n     public void init(final DatabaseType databaseType, final Collection<ResourceDataSource> resourceDataSources) {\n-        initSeataRPCClient();\n-        for (ResourceDataSource each : resourceDataSources) {\n-            dataSourceMap.put(each.getOriginalName(), new DataSourceProxy(each.getDataSource()));\n+        if (enableSeataAT) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac36182d547d0d61de0f9e874d21f0635446dfad"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk5ODQ3Nw==", "bodyText": "yes it is\uff0cmeantime physical datasource will not be wrapped to seata DataSourceProxy", "url": "https://github.com/apache/shardingsphere/pull/4996#discussion_r399998477", "createdAt": "2020-03-30T08:04:47Z", "author": {"login": "cherrylzhao"}, "path": "sharding-transaction/sharding-transaction-base/sharding-transaction-base-seata-at/src/main/java/org/apache/shardingsphere/transaction/base/seata/at/SeataATShardingTransactionManager.java", "diffHunk": "@@ -47,34 +47,56 @@\n     \n     private final Map<String, DataSource> dataSourceMap = new HashMap<>();\n     \n-    private final FileConfiguration configuration = new FileConfiguration(\"seata.conf\");\n+    private final String applicationId;\n+    \n+    private final String transactionServiceGroup;\n+    \n+    private final boolean enableSeataAT;\n+    \n+    public SeataATShardingTransactionManager() {\n+        FileConfiguration configuration = new FileConfiguration(\"seata.conf\");\n+        enableSeataAT = configuration.getBoolean(\"sharding.transaction.seata.at.enable\", true);\n+        applicationId = configuration.getConfig(\"client.application.id\");\n+        transactionServiceGroup = configuration.getConfig(\"client.transaction.service.group\", \"default\");\n+    }\n     \n     @Override\n     public void init(final DatabaseType databaseType, final Collection<ResourceDataSource> resourceDataSources) {\n-        initSeataRPCClient();\n-        for (ResourceDataSource each : resourceDataSources) {\n-            dataSourceMap.put(each.getOriginalName(), new DataSourceProxy(each.getDataSource()));\n+        if (enableSeataAT) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkwNjYzMg=="}, "originalCommit": {"oid": "ac36182d547d0d61de0f9e874d21f0635446dfad"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1104, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}