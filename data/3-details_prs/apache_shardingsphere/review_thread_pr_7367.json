{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyOTEyOTU1", "number": 7367, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwMjozMDo1MlrOEh7MXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwMzoyMjozM1rOEiXeTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0MDA4Mjg3OnYy", "diffSide": "RIGHT", "path": "shardingsphere-infra/shardingsphere-infra-common/src/main/java/org/apache/shardingsphere/infra/database/metadata/dialect/OracleDataSourceMetaData.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwMjozMDo1MlrOHPgrqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMzoyODo1NFrOHPzmLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjAyNjE1NQ==", "bodyText": "Could we merge two of the patterns?", "url": "https://github.com/apache/shardingsphere/pull/7367#discussion_r486026155", "createdAt": "2020-09-10T02:30:52Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-infra/shardingsphere-infra-common/src/main/java/org/apache/shardingsphere/infra/database/metadata/dialect/OracleDataSourceMetaData.java", "diffHunk": "@@ -33,24 +33,39 @@\n     \n     private static final int DEFAULT_PORT = 1521;\n     \n-    private final String hostName;\n+    private String hostName;\n     \n-    private final int port;\n+    private int port;\n     \n-    private final String catalog;\n+    private String catalog;\n     \n-    private final String schema;\n+    private String schema;\n     \n-    private final Pattern pattern = Pattern.compile(\"jdbc:oracle:(thin|oci|kprb):@(//)?([\\\\w\\\\-\\\\.]+):?([0-9]*)[:/]([\\\\w\\\\-]+)\", Pattern.CASE_INSENSITIVE);\n+    private final Pattern thinUrlPattern = Pattern.compile(\"jdbc:oracle:(thin|oci|kprb):@(//)?([\\\\w\\\\-\\\\.]+):?([0-9]*)[:/]([\\\\w\\\\-]+)\", Pattern.CASE_INSENSITIVE);\n+    \n+    private final Pattern connectDescriptorUrlPattern = Pattern.compile(\"jdbc:oracle:(thin|oci|kprb):@[(\\\\w\\\\s=)]+HOST\\\\s*=\\\\s*(\\\\d+(\\\\.\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69530f7217f20b8549e0eea52fe5f806a332d00b"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjAzMzA2Mg==", "bodyText": "hard be, this is refer to oracle JDBC driver's implementation", "url": "https://github.com/apache/shardingsphere/pull/7367#discussion_r486033062", "createdAt": "2020-09-10T02:57:01Z", "author": {"login": "xbkaishui"}, "path": "shardingsphere-infra/shardingsphere-infra-common/src/main/java/org/apache/shardingsphere/infra/database/metadata/dialect/OracleDataSourceMetaData.java", "diffHunk": "@@ -33,24 +33,39 @@\n     \n     private static final int DEFAULT_PORT = 1521;\n     \n-    private final String hostName;\n+    private String hostName;\n     \n-    private final int port;\n+    private int port;\n     \n-    private final String catalog;\n+    private String catalog;\n     \n-    private final String schema;\n+    private String schema;\n     \n-    private final Pattern pattern = Pattern.compile(\"jdbc:oracle:(thin|oci|kprb):@(//)?([\\\\w\\\\-\\\\.]+):?([0-9]*)[:/]([\\\\w\\\\-]+)\", Pattern.CASE_INSENSITIVE);\n+    private final Pattern thinUrlPattern = Pattern.compile(\"jdbc:oracle:(thin|oci|kprb):@(//)?([\\\\w\\\\-\\\\.]+):?([0-9]*)[:/]([\\\\w\\\\-]+)\", Pattern.CASE_INSENSITIVE);\n+    \n+    private final Pattern connectDescriptorUrlPattern = Pattern.compile(\"jdbc:oracle:(thin|oci|kprb):@[(\\\\w\\\\s=)]+HOST\\\\s*=\\\\s*(\\\\d+(\\\\.\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjAyNjE1NQ=="}, "originalCommit": {"oid": "69530f7217f20b8549e0eea52fe5f806a332d00b"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjAzMzc0NA==", "bodyText": "As you know. those are totally different, those have different patterns and different group counts", "url": "https://github.com/apache/shardingsphere/pull/7367#discussion_r486033744", "createdAt": "2020-09-10T02:59:35Z", "author": {"login": "xbkaishui"}, "path": "shardingsphere-infra/shardingsphere-infra-common/src/main/java/org/apache/shardingsphere/infra/database/metadata/dialect/OracleDataSourceMetaData.java", "diffHunk": "@@ -33,24 +33,39 @@\n     \n     private static final int DEFAULT_PORT = 1521;\n     \n-    private final String hostName;\n+    private String hostName;\n     \n-    private final int port;\n+    private int port;\n     \n-    private final String catalog;\n+    private String catalog;\n     \n-    private final String schema;\n+    private String schema;\n     \n-    private final Pattern pattern = Pattern.compile(\"jdbc:oracle:(thin|oci|kprb):@(//)?([\\\\w\\\\-\\\\.]+):?([0-9]*)[:/]([\\\\w\\\\-]+)\", Pattern.CASE_INSENSITIVE);\n+    private final Pattern thinUrlPattern = Pattern.compile(\"jdbc:oracle:(thin|oci|kprb):@(//)?([\\\\w\\\\-\\\\.]+):?([0-9]*)[:/]([\\\\w\\\\-]+)\", Pattern.CASE_INSENSITIVE);\n+    \n+    private final Pattern connectDescriptorUrlPattern = Pattern.compile(\"jdbc:oracle:(thin|oci|kprb):@[(\\\\w\\\\s=)]+HOST\\\\s*=\\\\s*(\\\\d+(\\\\.\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjAyNjE1NQ=="}, "originalCommit": {"oid": "69530f7217f20b8549e0eea52fe5f806a332d00b"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjMzNjA0Nw==", "bodyText": "done", "url": "https://github.com/apache/shardingsphere/pull/7367#discussion_r486336047", "createdAt": "2020-09-10T13:28:54Z", "author": {"login": "xbkaishui"}, "path": "shardingsphere-infra/shardingsphere-infra-common/src/main/java/org/apache/shardingsphere/infra/database/metadata/dialect/OracleDataSourceMetaData.java", "diffHunk": "@@ -33,24 +33,39 @@\n     \n     private static final int DEFAULT_PORT = 1521;\n     \n-    private final String hostName;\n+    private String hostName;\n     \n-    private final int port;\n+    private int port;\n     \n-    private final String catalog;\n+    private String catalog;\n     \n-    private final String schema;\n+    private String schema;\n     \n-    private final Pattern pattern = Pattern.compile(\"jdbc:oracle:(thin|oci|kprb):@(//)?([\\\\w\\\\-\\\\.]+):?([0-9]*)[:/]([\\\\w\\\\-]+)\", Pattern.CASE_INSENSITIVE);\n+    private final Pattern thinUrlPattern = Pattern.compile(\"jdbc:oracle:(thin|oci|kprb):@(//)?([\\\\w\\\\-\\\\.]+):?([0-9]*)[:/]([\\\\w\\\\-]+)\", Pattern.CASE_INSENSITIVE);\n+    \n+    private final Pattern connectDescriptorUrlPattern = Pattern.compile(\"jdbc:oracle:(thin|oci|kprb):@[(\\\\w\\\\s=)]+HOST\\\\s*=\\\\s*(\\\\d+(\\\\.\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjAyNjE1NQ=="}, "originalCommit": {"oid": "69530f7217f20b8549e0eea52fe5f806a332d00b"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0MDA4OTYxOnYy", "diffSide": "LEFT", "path": "shardingsphere-infra/shardingsphere-infra-common/src/main/java/org/apache/shardingsphere/infra/database/metadata/dialect/OracleDataSourceMetaData.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwMjozNTowOVrOHPgv0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMzoyODo1OVrOHPzmbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjAyNzIxOA==", "bodyText": "Why did you remove the final?", "url": "https://github.com/apache/shardingsphere/pull/7367#discussion_r486027218", "createdAt": "2020-09-10T02:35:09Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-infra/shardingsphere-infra-common/src/main/java/org/apache/shardingsphere/infra/database/metadata/dialect/OracleDataSourceMetaData.java", "diffHunk": "@@ -33,24 +33,39 @@\n     \n     private static final int DEFAULT_PORT = 1521;\n     \n-    private final String hostName;\n+    private String hostName;\n     \n-    private final int port;\n+    private int port;\n     \n-    private final String catalog;\n+    private String catalog;\n     \n-    private final String schema;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69530f7217f20b8549e0eea52fe5f806a332d00b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjAzMzUxOQ==", "bodyText": "it is used in method matchWithConnectDescriptorPattern, which is not in constructor method", "url": "https://github.com/apache/shardingsphere/pull/7367#discussion_r486033519", "createdAt": "2020-09-10T02:58:41Z", "author": {"login": "xbkaishui"}, "path": "shardingsphere-infra/shardingsphere-infra-common/src/main/java/org/apache/shardingsphere/infra/database/metadata/dialect/OracleDataSourceMetaData.java", "diffHunk": "@@ -33,24 +33,39 @@\n     \n     private static final int DEFAULT_PORT = 1521;\n     \n-    private final String hostName;\n+    private String hostName;\n     \n-    private final int port;\n+    private int port;\n     \n-    private final String catalog;\n+    private String catalog;\n     \n-    private final String schema;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjAyNzIxOA=="}, "originalCommit": {"oid": "69530f7217f20b8549e0eea52fe5f806a332d00b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjMzNjEwOA==", "bodyText": "done", "url": "https://github.com/apache/shardingsphere/pull/7367#discussion_r486336108", "createdAt": "2020-09-10T13:28:59Z", "author": {"login": "xbkaishui"}, "path": "shardingsphere-infra/shardingsphere-infra-common/src/main/java/org/apache/shardingsphere/infra/database/metadata/dialect/OracleDataSourceMetaData.java", "diffHunk": "@@ -33,24 +33,39 @@\n     \n     private static final int DEFAULT_PORT = 1521;\n     \n-    private final String hostName;\n+    private String hostName;\n     \n-    private final int port;\n+    private int port;\n     \n-    private final String catalog;\n+    private String catalog;\n     \n-    private final String schema;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjAyNzIxOA=="}, "originalCommit": {"oid": "69530f7217f20b8549e0eea52fe5f806a332d00b"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0NDY1OTg4OnYy", "diffSide": "RIGHT", "path": "shardingsphere-infra/shardingsphere-infra-common/src/main/java/org/apache/shardingsphere/infra/database/metadata/dialect/OracleDataSourceMetaData.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwMjo0OTozMVrOHQMY-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwMjo0OTozMVrOHQMY-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njc0MjI2NQ==", "bodyText": "Hi, why did you rename it as thinUrlPattern? Did you quote it somewhere?", "url": "https://github.com/apache/shardingsphere/pull/7367#discussion_r486742265", "createdAt": "2020-09-11T02:49:31Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-infra/shardingsphere-infra-common/src/main/java/org/apache/shardingsphere/infra/database/metadata/dialect/OracleDataSourceMetaData.java", "diffHunk": "@@ -41,12 +41,23 @@\n     \n     private final String schema;\n     \n-    private final Pattern pattern = Pattern.compile(\"jdbc:oracle:(thin|oci|kprb):@(//)?([\\\\w\\\\-\\\\.]+):?([0-9]*)[:/]([\\\\w\\\\-]+)\", Pattern.CASE_INSENSITIVE);\n+    private final Pattern thinUrlPattern = Pattern.compile(\"jdbc:oracle:(thin|oci|kprb):@(//)?([\\\\w\\\\-\\\\.]+):?([0-9]*)[:/]([\\\\w\\\\-]+)\", Pattern.CASE_INSENSITIVE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4cbc45aa6c22b25225974f7f7556a4182e14286d"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0NDcxNjI5OnYy", "diffSide": "RIGHT", "path": "shardingsphere-infra/shardingsphere-infra-common/src/main/java/org/apache/shardingsphere/infra/database/metadata/dialect/OracleDataSourceMetaData.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwMzoyMjozM1rOHQM5fQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwMzoyMjozM1rOHQM5fQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njc1MDU4OQ==", "bodyText": "It seems not so concise. How about this programing clip?\nCollection<Matcher> matchers;\nfor each `matchers`\nif each.find() {\n}\nend\nthrow new Exception", "url": "https://github.com/apache/shardingsphere/pull/7367#discussion_r486750589", "createdAt": "2020-09-11T03:22:33Z", "author": {"login": "tristaZero"}, "path": "shardingsphere-infra/shardingsphere-infra-common/src/main/java/org/apache/shardingsphere/infra/database/metadata/dialect/OracleDataSourceMetaData.java", "diffHunk": "@@ -41,12 +41,23 @@\n     \n     private final String schema;\n     \n-    private final Pattern pattern = Pattern.compile(\"jdbc:oracle:(thin|oci|kprb):@(//)?([\\\\w\\\\-\\\\.]+):?([0-9]*)[:/]([\\\\w\\\\-]+)\", Pattern.CASE_INSENSITIVE);\n+    private final Pattern thinUrlPattern = Pattern.compile(\"jdbc:oracle:(thin|oci|kprb):@(//)?([\\\\w\\\\-\\\\.]+):?([0-9]*)[:/]([\\\\w\\\\-]+)\", Pattern.CASE_INSENSITIVE);\n+    \n+    private final Pattern connectDescriptorUrlPattern = Pattern.compile(\"jdbc:oracle:(thin|oci|kprb):@[(\\\\w\\\\s=)]+HOST\\\\s*=\\\\s*(\\\\d+(\\\\.\"\n+            + \"((2(5[0-5]|[0-4]\\\\d))|[0-1]?\\\\d{1,2})){3}).*PORT\\\\s*=\\\\s*(\\\\d+).*SERVICE_NAME\\\\s*=\\\\s*(\\\\w+)\\\\)\");\n     \n     public OracleDataSourceMetaData(final String url, final String username) {\n-        Matcher matcher = pattern.matcher(url);\n+        Matcher matcher = thinUrlPattern.matcher(url);\n         if (!matcher.find()) {\n-            throw new UnrecognizedDatabaseURLException(url, pattern.pattern());\n+            matcher = connectDescriptorUrlPattern.matcher(url);\n+            if (!matcher.find()) {\n+                throw new UnrecognizedDatabaseURLException(url, connectDescriptorUrlPattern.pattern());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4cbc45aa6c22b25225974f7f7556a4182e14286d"}, "originalPosition": 17}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 742, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}