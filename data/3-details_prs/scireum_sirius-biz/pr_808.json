{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzNTk3NDg0", "number": 808, "title": "Introduction of translation entities", "bodyText": "Adds a generic translation entity that can be included in any type of entity by implementing the provided Translatable interface. Any field of an entity using this interface can be translated into any of the supported languages.\ncaches will be added in a next stage to reduce the amount of database requests", "createdAt": "2020-07-02T15:36:15Z", "url": "https://github.com/scireum/sirius-biz/pull/808", "merged": true, "mergeCommit": {"oid": "a93514c2e5490ccc7235118fbcd898c5912f28e0"}, "closed": true, "closedAt": "2020-07-27T14:59:15Z", "author": {"login": "cschierle"}, "timelineItems": {"totalCount": 58, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcxAFYdgH2gAyNDQzNTk3NDg0OmI0MjI5OGRlNTU1ZTI1YjE3ODgyNTU0NTVmZDk5NDEzNGE5N2IxNTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5CaxWgH2gAyNDQzNTk3NDg0OmJiYzlhYzNkNTA3NDk0NGVmZDhiOGI1ZDBjMjAzZDdiMjVkNzNkOTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b42298de555e25b1788255455fd994134a97b159", "author": {"user": {"login": "cschierle", "name": "Christian Schierle"}}, "url": "https://github.com/scireum/sirius-biz/commit/b42298de555e25b1788255455fd994134a97b159", "committedDate": "2020-07-02T14:54:15Z", "message": "Adds translation entity\n\nFixes: SIRI-228"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d91c8a06efdaaae90da094c8435fcc6ac606eee", "author": {"user": {"login": "cschierle", "name": "Christian Schierle"}}, "url": "https://github.com/scireum/sirius-biz/commit/6d91c8a06efdaaae90da094c8435fcc6ac606eee", "committedDate": "2020-07-02T14:59:03Z", "message": "Adds Translatable interface and access wrappers for mongodb and jdbc for use in other entities\n\nFixes: SIRI-228"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a9a0cb9fe2f002aacfd4dac6d4b7edc0e5962b0", "author": {"user": {"login": "cschierle", "name": "Christian Schierle"}}, "url": "https://github.com/scireum/sirius-biz/commit/8a9a0cb9fe2f002aacfd4dac6d4b7edc0e5962b0", "committedDate": "2020-07-02T15:31:01Z", "message": "Adds tests\n\nFixes: SIRI-228"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65ef9166c3a26098cdf075fdb0c4ab43f60f0837", "author": {"user": {"login": "cschierle", "name": "Christian Schierle"}}, "url": "https://github.com/scireum/sirius-biz/commit/65ef9166c3a26098cdf075fdb0c4ab43f60f0837", "committedDate": "2020-07-02T15:32:14Z", "message": "Typos"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc5c9a6cd0b9e99fbb21b94b4bafc02a620f297f", "author": {"user": {"login": "cschierle", "name": "Christian Schierle"}}, "url": "https://github.com/scireum/sirius-biz/commit/cc5c9a6cd0b9e99fbb21b94b4bafc02a620f297f", "committedDate": "2020-07-06T11:29:03Z", "message": "Adds smarter access and deletion functionality\n\nFixes: SIRI-228"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1800d6c23c6eeb22029b7ac3669a2e6425e7e97", "author": {"user": {"login": "cschierle", "name": "Christian Schierle"}}, "url": "https://github.com/scireum/sirius-biz/commit/e1800d6c23c6eeb22029b7ac3669a2e6425e7e97", "committedDate": "2020-07-06T11:30:03Z", "message": "Updates tests\n\nFixes: SIRI-228"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf7f67ec9721daa29f8eee9fc869b9304ebedbc2", "author": {"user": {"login": "cschierle", "name": "Christian Schierle"}}, "url": "https://github.com/scireum/sirius-biz/commit/bf7f67ec9721daa29f8eee9fc869b9304ebedbc2", "committedDate": "2020-07-06T11:33:59Z", "message": "Merge remote-tracking branch 'origin/master' into csc/SIRI-228_TranslationEntity"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzMDQ5NzE0", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-443049714", "createdAt": "2020-07-06T12:57:05Z", "commit": {"oid": "e1800d6c23c6eeb22029b7ac3669a2e6425e7e97"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0NDQ0NTU1", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-444444555", "createdAt": "2020-07-08T06:25:18Z", "commit": {"oid": "e1800d6c23c6eeb22029b7ac3669a2e6425e7e97"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNjoyNToxOVrOGuZxvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNjozMDoyNVrOGuZ59w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMxMDAxMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Optional<MongoTranslation> translation = fetchTranslation(field, lang);\n          \n          \n            \n                    translation.ifPresent(mongoTranslation -> mango.delete(mongoTranslation));\n          \n          \n            \n                    fetchTranslation(field, lang).ifPresent(mango::delete);", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r451310013", "createdAt": "2020-07-08T06:25:19Z", "author": {"login": "qw3ry"}, "path": "src/main/java/sirius/biz/translations/mongo/MongoTranslations.java", "diffHunk": "@@ -0,0 +1,105 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.translations.mongo;\n+\n+import sirius.biz.translations.BasicTranslations;\n+import sirius.biz.translations.Translation;\n+import sirius.biz.translations.TranslationData;\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.Mapping;\n+import sirius.kernel.commons.Strings;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+/**\n+ * Stores translations into the appropriate collections of the underlying MongoDB.\n+ */\n+public class MongoTranslations extends BasicTranslations<MongoTranslation> {\n+\n+    public MongoTranslations(BaseEntity<?> owner) {\n+        super(owner);\n+    }\n+\n+    @Override\n+    public void updateText(Mapping field, String lang, String text) {\n+        MongoTranslation translation = findOrCreateTranslation(field, lang, text);\n+\n+        if (Strings.isEmpty(text)) {\n+            deleteText(field, lang);\n+            return;\n+        }\n+\n+        translation.getTranslationData().setText(text);\n+\n+        mango.update(translation);\n+    }\n+\n+    @Override\n+    public void deleteText(Mapping field, String lang) {\n+        Optional<MongoTranslation> translation = fetchTranslation(field, lang);\n+        translation.ifPresent(mongoTranslation -> mango.delete(mongoTranslation));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e1800d6c23c6eeb22029b7ac3669a2e6425e7e97"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMxMDcxMg==", "bodyText": "Why not empty list instead of empty optional? Saves a lot of extra code in the calls to this method", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r451310712", "createdAt": "2020-07-08T06:27:09Z", "author": {"login": "qw3ry"}, "path": "src/main/java/sirius/biz/translations/BasicTranslations.java", "diffHunk": "@@ -0,0 +1,174 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.translations;\n+\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.Composite;\n+import sirius.db.mixing.FieldLookupCache;\n+import sirius.db.mixing.Mapping;\n+import sirius.db.mixing.annotations.Transient;\n+import sirius.kernel.di.std.ConfigValue;\n+import sirius.kernel.di.std.Part;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.Set;\n+\n+/**\n+ * Provides database independent specifications for functionality to access and edit translations for an entity.\n+ *\n+ * @param <T> the translation entity type used by a concrete subclass\n+ */\n+public abstract class BasicTranslations<T extends BaseEntity<?> & Translation> extends Composite {\n+\n+    @Transient\n+    protected BaseEntity<?> owner;\n+\n+    @Transient\n+    @ConfigValue(\"mixing.multiLanguageStrings.supportedLanguages\")\n+    protected static Set<String> supportedLanguages;\n+\n+    @Transient\n+    @Part\n+    private static FieldLookupCache fieldLookupCache;\n+\n+    protected BasicTranslations(BaseEntity<?> owner) {\n+        this.owner = owner;\n+    }\n+\n+    /**\n+     * Provides a validator so translations can only be added for supported languages.\n+     *\n+     * @param lang the language code in question\n+     * @return true if language is supported by the system, false otherwise\n+     */\n+    protected boolean isSupportedLanguage(String lang) {\n+        return supportedLanguages.contains(lang);\n+    }\n+\n+    /**\n+     * Updates the translation for the given field and language, or adds a new translation if it does not exist.\n+     * <p>\n+     * Note that an existing translation is deleted when calling this with empty text.\n+     *\n+     * @param field {@link Mapping} of the translated field\n+     * @param lang  language code\n+     * @param text  translated text for the given language\n+     */\n+    public abstract void updateText(Mapping field, String lang, String text);\n+\n+    /**\n+     * Deletes the translation for the given field and language\n+     *\n+     * @param field {@link Mapping} of the translated field\n+     * @param lang  code of the language to be deleted\n+     */\n+    public abstract void deleteText(Mapping field, String lang);\n+\n+    /**\n+     * Deletes all translations for the given field\n+     *\n+     * @param field {@link Mapping} of the translated field\n+     */\n+    public abstract void deleteAllTexts(Mapping field);\n+\n+    /**\n+     * Checks, if the given language is supported by the system and returns the translation for the given parameters,\n+     * or creates a new one if none exists.\n+     *\n+     * @param field {@link Mapping} of the translated field\n+     * @param lang  language code\n+     * @param text  translated text for the given language\n+     * @return the translation entity matching the database in use (Mongo or SQL), null if language not supported\n+     */\n+    protected abstract T findOrCreateTranslation(Mapping field, String lang, String text);\n+\n+    /**\n+     * Gets the translated text for the given field and language.\n+     *\n+     * @param field {@link Mapping} of the translated field\n+     * @param lang  language code\n+     * @return {@link Optional} with translated text for the given language, or empty if none is found\n+     */\n+    public Optional<String> getText(Mapping field, String lang) {\n+        if (!isSupportedLanguage(lang)) {\n+            return Optional.empty();\n+        }\n+\n+        Optional<T> translation = fetchTranslation(field, lang);\n+        return translation.map(t -> t.getTranslationData().getText());\n+    }\n+\n+    /**\n+     * Returns the translated text for the given field and language. Uses fallback language if no translation is found.\n+     * If the fallback also has no translation, the default text from the owner entity is returned.\n+     *\n+     * @param field        {@link Mapping} of the translated field\n+     * @param lang         language code\n+     * @param fallbackLang language code for fallback\n+     * @return translated text for the given language, fallback, or the default text from owner entity\n+     */\n+    public String getRequiredText(Mapping field, String lang, String fallbackLang) {\n+        Optional<String> text = getText(field, lang);\n+        if (!text.isPresent()) {\n+            text = getText(field, fallbackLang);\n+            if (!text.isPresent()) {\n+                return fetchDefaultText(field);\n+            }\n+        }\n+        return text.get();\n+    }\n+\n+    /**\n+     * Fetches the default text by querying {@link sirius.db.mixing.FieldLookupCache} for the owner entity's given field.\n+     *\n+     * @param field {@link Mapping field} to fetch the the text from\n+     * @return the text as String, or null if lookup was unsuccessful\n+     */\n+    protected String fetchDefaultText(Mapping field) {\n+        return fieldLookupCache.lookup(owner.getClass(), owner.getId(), field).asString();\n+    }\n+\n+    /**\n+     * Returns all available translated texts for the given field.\n+     *\n+     * @param field {@link Mapping} of the translated field\n+     * @return a {@link Map} of all translated texts with corresponding language code as key, empty map if none present\n+     */\n+    public Map<String, String> getAllTexts(Mapping field) {\n+        Optional<List<T>> translations = fetchAllTranslations(field);\n+        if (!translations.isPresent()) {\n+            return new HashMap<>();\n+        }\n+        Map<String, String> translatedTexts = new HashMap<>();\n+        for (T t : translations.get()) {\n+            translatedTexts.put(t.getTranslationData().getLang(), t.getTranslationData().getText());\n+        }\n+        return translatedTexts;\n+    }\n+\n+    /**\n+     * Looks up the translation entity for the database in use (e.g. MongoDB or SQL).\n+     *\n+     * @param field {@link Mapping} of the translated field\n+     * @param lang  language code\n+     * @return the resolved translation entity wrapped as optional or an empty optional if the value couldn't be resolved\n+     */\n+    protected abstract Optional<T> fetchTranslation(Mapping field, String lang);\n+\n+    /**\n+     * Looks up and returns all available {@link Translation translation} entities for the given field\n+     *\n+     * @param field {@link Mapping} of the translated field\n+     * @return {@link Optional} with a {@link java.util.List} of all {@link Translation translations}, or empty if none are found", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e1800d6c23c6eeb22029b7ac3669a2e6425e7e97"}, "originalPosition": 171}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMxMTM4Mg==", "bodyText": "for example here:\nMap<String, String> translatedTexts = new HashMap<>();\nfor (T t : fetchAllTranslations(field)) {\n    translatedTexts.put(t.getTranslationData().getLang(), t.getTranslationData().getText());\n}\nreturn translatedTexts;", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r451311382", "createdAt": "2020-07-08T06:28:52Z", "author": {"login": "qw3ry"}, "path": "src/main/java/sirius/biz/translations/BasicTranslations.java", "diffHunk": "@@ -0,0 +1,174 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.translations;\n+\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.Composite;\n+import sirius.db.mixing.FieldLookupCache;\n+import sirius.db.mixing.Mapping;\n+import sirius.db.mixing.annotations.Transient;\n+import sirius.kernel.di.std.ConfigValue;\n+import sirius.kernel.di.std.Part;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.Set;\n+\n+/**\n+ * Provides database independent specifications for functionality to access and edit translations for an entity.\n+ *\n+ * @param <T> the translation entity type used by a concrete subclass\n+ */\n+public abstract class BasicTranslations<T extends BaseEntity<?> & Translation> extends Composite {\n+\n+    @Transient\n+    protected BaseEntity<?> owner;\n+\n+    @Transient\n+    @ConfigValue(\"mixing.multiLanguageStrings.supportedLanguages\")\n+    protected static Set<String> supportedLanguages;\n+\n+    @Transient\n+    @Part\n+    private static FieldLookupCache fieldLookupCache;\n+\n+    protected BasicTranslations(BaseEntity<?> owner) {\n+        this.owner = owner;\n+    }\n+\n+    /**\n+     * Provides a validator so translations can only be added for supported languages.\n+     *\n+     * @param lang the language code in question\n+     * @return true if language is supported by the system, false otherwise\n+     */\n+    protected boolean isSupportedLanguage(String lang) {\n+        return supportedLanguages.contains(lang);\n+    }\n+\n+    /**\n+     * Updates the translation for the given field and language, or adds a new translation if it does not exist.\n+     * <p>\n+     * Note that an existing translation is deleted when calling this with empty text.\n+     *\n+     * @param field {@link Mapping} of the translated field\n+     * @param lang  language code\n+     * @param text  translated text for the given language\n+     */\n+    public abstract void updateText(Mapping field, String lang, String text);\n+\n+    /**\n+     * Deletes the translation for the given field and language\n+     *\n+     * @param field {@link Mapping} of the translated field\n+     * @param lang  code of the language to be deleted\n+     */\n+    public abstract void deleteText(Mapping field, String lang);\n+\n+    /**\n+     * Deletes all translations for the given field\n+     *\n+     * @param field {@link Mapping} of the translated field\n+     */\n+    public abstract void deleteAllTexts(Mapping field);\n+\n+    /**\n+     * Checks, if the given language is supported by the system and returns the translation for the given parameters,\n+     * or creates a new one if none exists.\n+     *\n+     * @param field {@link Mapping} of the translated field\n+     * @param lang  language code\n+     * @param text  translated text for the given language\n+     * @return the translation entity matching the database in use (Mongo or SQL), null if language not supported\n+     */\n+    protected abstract T findOrCreateTranslation(Mapping field, String lang, String text);\n+\n+    /**\n+     * Gets the translated text for the given field and language.\n+     *\n+     * @param field {@link Mapping} of the translated field\n+     * @param lang  language code\n+     * @return {@link Optional} with translated text for the given language, or empty if none is found\n+     */\n+    public Optional<String> getText(Mapping field, String lang) {\n+        if (!isSupportedLanguage(lang)) {\n+            return Optional.empty();\n+        }\n+\n+        Optional<T> translation = fetchTranslation(field, lang);\n+        return translation.map(t -> t.getTranslationData().getText());\n+    }\n+\n+    /**\n+     * Returns the translated text for the given field and language. Uses fallback language if no translation is found.\n+     * If the fallback also has no translation, the default text from the owner entity is returned.\n+     *\n+     * @param field        {@link Mapping} of the translated field\n+     * @param lang         language code\n+     * @param fallbackLang language code for fallback\n+     * @return translated text for the given language, fallback, or the default text from owner entity\n+     */\n+    public String getRequiredText(Mapping field, String lang, String fallbackLang) {\n+        Optional<String> text = getText(field, lang);\n+        if (!text.isPresent()) {\n+            text = getText(field, fallbackLang);\n+            if (!text.isPresent()) {\n+                return fetchDefaultText(field);\n+            }\n+        }\n+        return text.get();\n+    }\n+\n+    /**\n+     * Fetches the default text by querying {@link sirius.db.mixing.FieldLookupCache} for the owner entity's given field.\n+     *\n+     * @param field {@link Mapping field} to fetch the the text from\n+     * @return the text as String, or null if lookup was unsuccessful\n+     */\n+    protected String fetchDefaultText(Mapping field) {\n+        return fieldLookupCache.lookup(owner.getClass(), owner.getId(), field).asString();\n+    }\n+\n+    /**\n+     * Returns all available translated texts for the given field.\n+     *\n+     * @param field {@link Mapping} of the translated field\n+     * @return a {@link Map} of all translated texts with corresponding language code as key, empty map if none present\n+     */\n+    public Map<String, String> getAllTexts(Mapping field) {\n+        Optional<List<T>> translations = fetchAllTranslations(field);\n+        if (!translations.isPresent()) {\n+            return new HashMap<>();\n+        }\n+        Map<String, String> translatedTexts = new HashMap<>();\n+        for (T t : translations.get()) {\n+            translatedTexts.put(t.getTranslationData().getLang(), t.getTranslationData().getText());\n+        }\n+        return translatedTexts;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e1800d6c23c6eeb22029b7ac3669a2e6425e7e97"}, "originalPosition": 155}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMxMjExOQ==", "bodyText": "Or here\nfor (SQLTranslation translation : fetchAllTranslations(field)) {\n    oma.delete(translation);\n}", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r451312119", "createdAt": "2020-07-08T06:30:25Z", "author": {"login": "qw3ry"}, "path": "src/main/java/sirius/biz/translations/jdbc/SQLTranslations.java", "diffHunk": "@@ -0,0 +1,105 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.translations.jdbc;\n+\n+import sirius.biz.translations.BasicTranslations;\n+import sirius.biz.translations.Translation;\n+import sirius.biz.translations.TranslationData;\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.Mapping;\n+import sirius.kernel.commons.Strings;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+/**\n+ * Stores translations into the appropriate collections of the underlying JDBC database.\n+ */\n+public class SQLTranslations extends BasicTranslations<SQLTranslation> {\n+\n+    public SQLTranslations(BaseEntity<?> owner) {\n+        super(owner);\n+    }\n+\n+    @Override\n+    public void updateText(Mapping field, String lang, String text) {\n+        SQLTranslation translation = findOrCreateTranslation(field, lang, text);\n+\n+        if (Strings.isEmpty(text)) {\n+            deleteText(field, lang);\n+            return;\n+        }\n+\n+        translation.getTranslationData().setText(text);\n+\n+        oma.update(translation);\n+    }\n+\n+    @Override\n+    public void deleteText(Mapping field, String lang) {\n+        Optional<SQLTranslation> translation = fetchTranslation(field, lang);\n+        translation.ifPresent(sqlTranslation -> oma.delete(sqlTranslation));\n+    }\n+\n+    @Override\n+    public void deleteAllTexts(Mapping field) {\n+        Optional<List<SQLTranslation>> translations = fetchAllTranslations(field);\n+        if (translations.isPresent()) {\n+            for (SQLTranslation translation : translations.get()) {\n+                oma.delete(translation);\n+            }\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e1800d6c23c6eeb22029b7ac3669a2e6425e7e97"}, "originalPosition": 57}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f9d11761d9cf573841ce2cc7782b0a59bdf695f", "author": {"user": {"login": "cschierle", "name": "Christian Schierle"}}, "url": "https://github.com/scireum/sirius-biz/commit/1f9d11761d9cf573841ce2cc7782b0a59bdf695f", "committedDate": "2020-07-09T06:44:56Z", "message": "Update src/main/java/sirius/biz/translations/mongo/MongoTranslations.java\n\nCo-authored-by: tbe <tbe@scireum.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b34ab74e9d05dd28225f7f79b25dfdb5e1fa2d6f", "author": {"user": {"login": "cschierle", "name": "Christian Schierle"}}, "url": "https://github.com/scireum/sirius-biz/commit/b34ab74e9d05dd28225f7f79b25dfdb5e1fa2d6f", "committedDate": "2020-07-09T06:58:30Z", "message": "Simplifies unnecessary code\n\nFixes: SIRI-228"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6aa4875b9b27895fd08d823dd99a1f03d430aaf8", "author": {"user": {"login": "cschierle", "name": "Christian Schierle"}}, "url": "https://github.com/scireum/sirius-biz/commit/6aa4875b9b27895fd08d823dd99a1f03d430aaf8", "committedDate": "2020-07-09T06:59:04Z", "message": "Merge remote-tracking branch 'origin/csc/SIRI-228_TranslationEntity' into csc/SIRI-228_TranslationEntity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f02398954cf44531ddafd4ef1b7f6f5409046a2c", "author": {"user": {"login": "cschierle", "name": "Christian Schierle"}}, "url": "https://github.com/scireum/sirius-biz/commit/f02398954cf44531ddafd4ef1b7f6f5409046a2c", "committedDate": "2020-07-09T07:01:29Z", "message": "Merge remote-tracking branch 'origin/master' into csc/SIRI-228_TranslationEntity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0231722325da0f516aa706796c1b75ef4119e0d3", "author": {"user": {"login": "cschierle", "name": "Christian Schierle"}}, "url": "https://github.com/scireum/sirius-biz/commit/0231722325da0f516aa706796c1b75ef4119e0d3", "committedDate": "2020-07-09T07:33:42Z", "message": "Ensures that translations are deleted when their owner is removed\n\nFixes: SIRI-228"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MzYyMTI2", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-445362126", "createdAt": "2020-07-09T07:38:36Z", "commit": {"oid": "0231722325da0f516aa706796c1b75ef4119e0d3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MzcxODYz", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-445371863", "createdAt": "2020-07-09T07:52:26Z", "commit": {"oid": "0231722325da0f516aa706796c1b75ef4119e0d3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNzo1MjoyNlrOGvFw_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNzo1NTozOFrOGvF3_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjAzMDcxNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Ensures that if the owner entity is deleted, all of its translations are deleted as well\n          \n          \n            \n                 * Ensures that translations are cascaded-deleted upon deletion of the owner entity.", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r452030716", "createdAt": "2020-07-09T07:52:26Z", "author": {"login": "idlira"}, "path": "src/main/java/sirius/biz/translations/BasicTranslations.java", "diffHunk": "@@ -44,6 +45,12 @@ protected BasicTranslations(BaseEntity<?> owner) {\n         this.owner = owner;\n     }\n \n+    /**\n+     * Ensures that if the owner entity is deleted, all of its translations are deleted as well", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0231722325da0f516aa706796c1b75ef4119e0d3"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjAzMjQ1MA==", "bodyText": "It's possible to delete all in a single command based on filter instead of looping and deleting one by one.", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r452032450", "createdAt": "2020-07-09T07:55:32Z", "author": {"login": "idlira"}, "path": "src/main/java/sirius/biz/translations/mongo/MongoTranslations.java", "diffHunk": "@@ -29,6 +28,15 @@ public MongoTranslations(BaseEntity<?> owner) {\n         super(owner);\n     }\n \n+    @Override\n+    protected void deleteAllTranslations() {\n+        for (MongoTranslation t : mango.select(MongoTranslation.class)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0231722325da0f516aa706796c1b75ef4119e0d3"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjAzMjUxMQ==", "bodyText": "It's possible to delete all in a single command based on filter instead of looping and deleting one by one.", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r452032511", "createdAt": "2020-07-09T07:55:38Z", "author": {"login": "idlira"}, "path": "src/main/java/sirius/biz/translations/jdbc/SQLTranslations.java", "diffHunk": "@@ -29,6 +28,15 @@ public SQLTranslations(BaseEntity<?> owner) {\n         super(owner);\n     }\n \n+    @Override\n+    protected void deleteAllTranslations() {\n+        for (SQLTranslation t : oma.select(SQLTranslation.class)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0231722325da0f516aa706796c1b75ef4119e0d3"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ef1e6d18537b0fba835f940dd905b576648ea5c", "author": {"user": {"login": "cschierle", "name": "Christian Schierle"}}, "url": "https://github.com/scireum/sirius-biz/commit/5ef1e6d18537b0fba835f940dd905b576648ea5c", "committedDate": "2020-07-09T08:10:21Z", "message": "Update src/main/java/sirius/biz/translations/BasicTranslations.java\n\nCo-authored-by: Idevaldo De Lira <54799255+idlira@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "756886e9bee7347121c5dacdaf96f1bd80699b58", "author": {"user": {"login": "cschierle", "name": "Christian Schierle"}}, "url": "https://github.com/scireum/sirius-biz/commit/756886e9bee7347121c5dacdaf96f1bd80699b58", "committedDate": "2020-07-13T06:44:59Z", "message": "Simplifies and renames cascaded delete\n\nFixes: SIRI-228"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b656dd9e06356e1eefd41739d6d1c2fc3a74e950", "author": {"user": {"login": "cschierle", "name": "Christian Schierle"}}, "url": "https://github.com/scireum/sirius-biz/commit/b656dd9e06356e1eefd41739d6d1c2fc3a74e950", "committedDate": "2020-07-13T08:38:18Z", "message": "Merge remote-tracking branch 'origin/master' into csc/SIRI-228_TranslationEntity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d755b6f1da79bebd44ac99dfa5cc24b3f53f2ec6", "author": {"user": {"login": "cschierle", "name": "Christian Schierle"}}, "url": "https://github.com/scireum/sirius-biz/commit/d755b6f1da79bebd44ac99dfa5cc24b3f53f2ec6", "committedDate": "2020-07-13T09:19:54Z", "message": "Fixes faulty reference\n\nFixes: SIRI-228"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5", "author": {"user": {"login": "cschierle", "name": "Christian Schierle"}}, "url": "https://github.com/scireum/sirius-biz/commit/b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5", "committedDate": "2020-07-13T09:20:58Z", "message": "Removes unused field\n\nFixes: SIRI-228"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3MDk2NDI4", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-447096428", "createdAt": "2020-07-13T09:45:09Z", "commit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NzU1NDQ4", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-448755448", "createdAt": "2020-07-15T08:51:40Z", "commit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NzE2Nzk4", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-449716798", "createdAt": "2020-07-16T10:23:15Z", "commit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMzQyMjk4", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-451342298", "createdAt": "2020-07-20T07:01:25Z", "commit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzowMToyNlrOGz772g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzowMToyNlrOGz772g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzExMjUzOA==", "bodyText": "maybe use a more generic config name here?", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r457112538", "createdAt": "2020-07-20T07:01:26Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/translations/BasicTranslations.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.translations;\n+\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.Composite;\n+import sirius.db.mixing.FieldLookupCache;\n+import sirius.db.mixing.Mapping;\n+import sirius.db.mixing.annotations.AfterDelete;\n+import sirius.db.mixing.annotations.Transient;\n+import sirius.kernel.di.std.ConfigValue;\n+import sirius.kernel.di.std.Part;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.Set;\n+\n+/**\n+ * Provides database independent specifications for functionality to access and edit translations for an entity.\n+ *\n+ * @param <T> the translation entity type used by a concrete subclass\n+ */\n+public abstract class BasicTranslations<T extends BaseEntity<?> & Translation> extends Composite {\n+\n+    @Transient\n+    protected BaseEntity<?> owner;\n+\n+    @Transient\n+    @ConfigValue(\"mixing.multiLanguageStrings.supportedLanguages\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMzQzMzE1", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-451343315", "createdAt": "2020-07-20T07:03:25Z", "commit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzowMzoyNVrOGz8ATg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzowMzoyNVrOGz8ATg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzExMzY3OA==", "bodyText": "why not directly read from the owner? owner.getDescriptor.getProperty(field).getValue(owner) or the like ? maybe check if the value is fetched and else fallback to the fieldLookupCache otherwise(??)", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r457113678", "createdAt": "2020-07-20T07:03:25Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/translations/BasicTranslations.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.translations;\n+\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.Composite;\n+import sirius.db.mixing.FieldLookupCache;\n+import sirius.db.mixing.Mapping;\n+import sirius.db.mixing.annotations.AfterDelete;\n+import sirius.db.mixing.annotations.Transient;\n+import sirius.kernel.di.std.ConfigValue;\n+import sirius.kernel.di.std.Part;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.Set;\n+\n+/**\n+ * Provides database independent specifications for functionality to access and edit translations for an entity.\n+ *\n+ * @param <T> the translation entity type used by a concrete subclass\n+ */\n+public abstract class BasicTranslations<T extends BaseEntity<?> & Translation> extends Composite {\n+\n+    @Transient\n+    protected BaseEntity<?> owner;\n+\n+    @Transient\n+    @ConfigValue(\"mixing.multiLanguageStrings.supportedLanguages\")\n+    protected static Set<String> supportedLanguages;\n+\n+    @Transient\n+    @Part\n+    private static FieldLookupCache fieldLookupCache;\n+\n+    protected BasicTranslations(BaseEntity<?> owner) {\n+        this.owner = owner;\n+    }\n+\n+    /**\n+     * Ensures that translations are cascaded-deleted upon deletion of the owner entity.\n+     */\n+    @AfterDelete\n+    protected abstract void removeTranslations();\n+\n+    /**\n+     * Provides a validator so translations can only be added for supported languages.\n+     *\n+     * @param lang the language code in question\n+     * @return true if language is supported by the system, false otherwise\n+     */\n+    protected boolean isSupportedLanguage(String lang) {\n+        return supportedLanguages.contains(lang);\n+    }\n+\n+    /**\n+     * Updates the translation for the given field and language, or adds a new translation if it does not exist.\n+     * <p>\n+     * Note that an existing translation is deleted when calling this with empty text.\n+     *\n+     * @param field {@link Mapping} of the translated field\n+     * @param lang  language code\n+     * @param text  translated text for the given language\n+     */\n+    public abstract void updateText(Mapping field, String lang, String text);\n+\n+    /**\n+     * Deletes the translation for the given field and language\n+     *\n+     * @param field {@link Mapping} of the translated field\n+     * @param lang  code of the language to be deleted\n+     */\n+    public abstract void deleteText(Mapping field, String lang);\n+\n+    /**\n+     * Deletes all translations for the given field\n+     *\n+     * @param field {@link Mapping} of the translated field\n+     */\n+    public abstract void deleteAllTexts(Mapping field);\n+\n+    /**\n+     * Checks, if the given language is supported by the system and returns the translation for the given parameters,\n+     * or creates a new one if none exists.\n+     *\n+     * @param field {@link Mapping} of the translated field\n+     * @param lang  language code\n+     * @param text  translated text for the given language\n+     * @return the translation entity matching the database in use (Mongo or SQL), null if language not supported\n+     */\n+    protected abstract T findOrCreateTranslation(Mapping field, String lang, String text);\n+\n+    /**\n+     * Gets the translated text for the given field and language.\n+     *\n+     * @param field {@link Mapping} of the translated field\n+     * @param lang  language code\n+     * @return {@link Optional} with translated text for the given language, or empty if none is found\n+     */\n+    public Optional<String> getText(Mapping field, String lang) {\n+        if (!isSupportedLanguage(lang)) {\n+            return Optional.empty();\n+        }\n+\n+        Optional<T> translation = fetchTranslation(field, lang);\n+        return translation.map(t -> t.getTranslationData().getText());\n+    }\n+\n+    /**\n+     * Returns the translated text for the given field and language. Uses fallback language if no translation is found.\n+     * If the fallback also has no translation, the default text from the owner entity is returned.\n+     *\n+     * @param field        {@link Mapping} of the translated field\n+     * @param lang         language code\n+     * @param fallbackLang language code for fallback\n+     * @return translated text for the given language, fallback, or the default text from owner entity\n+     */\n+    public String getRequiredText(Mapping field, String lang, String fallbackLang) {\n+        Optional<String> text = getText(field, lang);\n+        if (!text.isPresent()) {\n+            text = getText(field, fallbackLang);\n+            if (!text.isPresent()) {\n+                return fetchDefaultText(field);\n+            }\n+        }\n+        return text.get();\n+    }\n+\n+    /**\n+     * Fetches the default text by querying {@link sirius.db.mixing.FieldLookupCache} for the owner entity's given field.\n+     *\n+     * @param field {@link Mapping field} to fetch the the text from\n+     * @return the text as String, or null if lookup was unsuccessful\n+     */\n+    protected String fetchDefaultText(Mapping field) {\n+        return fieldLookupCache.lookup(owner.getClass(), owner.getId(), field).asString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "originalPosition": 144}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMzQ0MDEw", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-451344010", "createdAt": "2020-07-20T07:04:42Z", "commit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzowNDo0MlrOGz8DeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzowNDo0MlrOGz8DeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzExNDQ4OA==", "bodyText": "why not place this also in TranslationData?", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r457114488", "createdAt": "2020-07-20T07:04:42Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/translations/Translation.java", "diffHunk": "@@ -0,0 +1,30 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.translations;\n+\n+import sirius.db.mixing.Mapping;\n+\n+/**\n+ * Provides constants and methods that have to be present in any Translation entity\n+ */\n+public interface Translation {\n+    /**\n+     * Contains the unique name of the entity this translation belongs to.\n+     */\n+    Mapping OWNER = Mapping.named(\"owner\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMzQ0NDMz", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-451344433", "createdAt": "2020-07-20T07:05:28Z", "commit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzowNToyOFrOGz8FfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzowNToyOFrOGz8FfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzExNTAwNA==", "bodyText": "index on owner, field, lang ??", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r457115004", "createdAt": "2020-07-20T07:05:28Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/translations/jdbc/SQLTranslation.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.translations.jdbc;\n+\n+import sirius.biz.translations.Translation;\n+import sirius.biz.translations.TranslationData;\n+import sirius.db.jdbc.SQLEntity;\n+\n+/**\n+ * Stores translations as a table.\n+ * <p>\n+ * Note that translations should only be accessed via siblings of {@link sirius.biz.translations.BasicTranslations}.\n+ */\n+public class SQLTranslation extends SQLEntity implements Translation {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMzQ0NjEx", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-451344611", "createdAt": "2020-07-20T07:05:47Z", "commit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzowNTo0OFrOGz8GNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzowNTo0OFrOGz8GNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzExNTE5MQ==", "bodyText": "exception(?)", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r457115191", "createdAt": "2020-07-20T07:05:48Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/translations/jdbc/SQLTranslations.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.translations.jdbc;\n+\n+import sirius.biz.translations.BasicTranslations;\n+import sirius.biz.translations.Translation;\n+import sirius.biz.translations.TranslationData;\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.Mapping;\n+import sirius.kernel.commons.Strings;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Optional;\n+\n+/**\n+ * Stores translations into the appropriate collections of the underlying JDBC database.\n+ */\n+public class SQLTranslations extends BasicTranslations<SQLTranslation> {\n+\n+    public SQLTranslations(BaseEntity<?> owner) {\n+        super(owner);\n+    }\n+\n+    @Override\n+    protected void removeTranslations() {\n+        oma.select(SQLTranslation.class).eq(Translation.OWNER, owner.getUniqueName()).delete();\n+    }\n+\n+    @Override\n+    public void updateText(Mapping field, String lang, String text) {\n+        SQLTranslation translation = findOrCreateTranslation(field, lang, text);\n+\n+        if (Strings.isEmpty(text)) {\n+            deleteText(field, lang);\n+            return;\n+        }\n+\n+        translation.getTranslationData().setText(text);\n+\n+        oma.update(translation);\n+    }\n+\n+    @Override\n+    public void deleteText(Mapping field, String lang) {\n+        fetchTranslation(field, lang).ifPresent(oma::delete);\n+    }\n+\n+    @Override\n+    public void deleteAllTexts(Mapping field) {\n+        for (SQLTranslation translation : fetchAllTranslations(field)) {\n+            oma.delete(translation);\n+        }\n+    }\n+\n+    @Override\n+    protected SQLTranslation findOrCreateTranslation(Mapping field, String lang, String text) {\n+        if (!isSupportedLanguage(lang)) {\n+            return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "originalPosition": 65}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMzQ1Mjg1", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-451345285", "createdAt": "2020-07-20T07:06:56Z", "commit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzowNjo1NlrOGz8JDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzowNjo1NlrOGz8JDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzExNTkxOA==", "bodyText": "either mark as Nonnull and don't care or Objects.requireNonNull or the like - there is no sane API case for supporting null values here(?)", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r457115918", "createdAt": "2020-07-20T07:06:56Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/translations/jdbc/SQLTranslations.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.translations.jdbc;\n+\n+import sirius.biz.translations.BasicTranslations;\n+import sirius.biz.translations.Translation;\n+import sirius.biz.translations.TranslationData;\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.Mapping;\n+import sirius.kernel.commons.Strings;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Optional;\n+\n+/**\n+ * Stores translations into the appropriate collections of the underlying JDBC database.\n+ */\n+public class SQLTranslations extends BasicTranslations<SQLTranslation> {\n+\n+    public SQLTranslations(BaseEntity<?> owner) {\n+        super(owner);\n+    }\n+\n+    @Override\n+    protected void removeTranslations() {\n+        oma.select(SQLTranslation.class).eq(Translation.OWNER, owner.getUniqueName()).delete();\n+    }\n+\n+    @Override\n+    public void updateText(Mapping field, String lang, String text) {\n+        SQLTranslation translation = findOrCreateTranslation(field, lang, text);\n+\n+        if (Strings.isEmpty(text)) {\n+            deleteText(field, lang);\n+            return;\n+        }\n+\n+        translation.getTranslationData().setText(text);\n+\n+        oma.update(translation);\n+    }\n+\n+    @Override\n+    public void deleteText(Mapping field, String lang) {\n+        fetchTranslation(field, lang).ifPresent(oma::delete);\n+    }\n+\n+    @Override\n+    public void deleteAllTexts(Mapping field) {\n+        for (SQLTranslation translation : fetchAllTranslations(field)) {\n+            oma.delete(translation);\n+        }\n+    }\n+\n+    @Override\n+    protected SQLTranslation findOrCreateTranslation(Mapping field, String lang, String text) {\n+        if (!isSupportedLanguage(lang)) {\n+            return null;\n+        }\n+\n+        Optional<SQLTranslation> translation = fetchTranslation(field, lang);\n+\n+        if (translation.isPresent()) {\n+            return translation.get();\n+        } else {\n+            SQLTranslation sqlTranslation = new SQLTranslation();\n+            sqlTranslation.setOwner(owner.getUniqueName());\n+            sqlTranslation.getTranslationData().setField(field.getName());\n+            sqlTranslation.getTranslationData().setLang(lang);\n+            return sqlTranslation;\n+        }\n+    }\n+\n+    @Override\n+    protected Optional<SQLTranslation> fetchTranslation(Mapping field, String lang) {\n+        if (field == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "originalPosition": 83}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMzQ1MzM0", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-451345334", "createdAt": "2020-07-20T07:07:01Z", "commit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzowNzowMlrOGz8JPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzowNzowMlrOGz8JPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzExNTk2Ng==", "bodyText": "s.a.", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r457115966", "createdAt": "2020-07-20T07:07:02Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/translations/jdbc/SQLTranslations.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.translations.jdbc;\n+\n+import sirius.biz.translations.BasicTranslations;\n+import sirius.biz.translations.Translation;\n+import sirius.biz.translations.TranslationData;\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.Mapping;\n+import sirius.kernel.commons.Strings;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Optional;\n+\n+/**\n+ * Stores translations into the appropriate collections of the underlying JDBC database.\n+ */\n+public class SQLTranslations extends BasicTranslations<SQLTranslation> {\n+\n+    public SQLTranslations(BaseEntity<?> owner) {\n+        super(owner);\n+    }\n+\n+    @Override\n+    protected void removeTranslations() {\n+        oma.select(SQLTranslation.class).eq(Translation.OWNER, owner.getUniqueName()).delete();\n+    }\n+\n+    @Override\n+    public void updateText(Mapping field, String lang, String text) {\n+        SQLTranslation translation = findOrCreateTranslation(field, lang, text);\n+\n+        if (Strings.isEmpty(text)) {\n+            deleteText(field, lang);\n+            return;\n+        }\n+\n+        translation.getTranslationData().setText(text);\n+\n+        oma.update(translation);\n+    }\n+\n+    @Override\n+    public void deleteText(Mapping field, String lang) {\n+        fetchTranslation(field, lang).ifPresent(oma::delete);\n+    }\n+\n+    @Override\n+    public void deleteAllTexts(Mapping field) {\n+        for (SQLTranslation translation : fetchAllTranslations(field)) {\n+            oma.delete(translation);\n+        }\n+    }\n+\n+    @Override\n+    protected SQLTranslation findOrCreateTranslation(Mapping field, String lang, String text) {\n+        if (!isSupportedLanguage(lang)) {\n+            return null;\n+        }\n+\n+        Optional<SQLTranslation> translation = fetchTranslation(field, lang);\n+\n+        if (translation.isPresent()) {\n+            return translation.get();\n+        } else {\n+            SQLTranslation sqlTranslation = new SQLTranslation();\n+            sqlTranslation.setOwner(owner.getUniqueName());\n+            sqlTranslation.getTranslationData().setField(field.getName());\n+            sqlTranslation.getTranslationData().setLang(lang);\n+            return sqlTranslation;\n+        }\n+    }\n+\n+    @Override\n+    protected Optional<SQLTranslation> fetchTranslation(Mapping field, String lang) {\n+        if (field == null) {\n+            return Optional.empty();\n+        } else {\n+            return Optional.ofNullable(oma.select(SQLTranslation.class)\n+                                          .eq(Translation.OWNER, owner.getUniqueName())\n+                                          .eq(Translation.TRANSLATION_DATA.inner(TranslationData.FIELD),\n+                                              field.getName())\n+                                          .eq(Translation.TRANSLATION_DATA.inner(TranslationData.LANG), lang)\n+                                          .queryFirst());\n+        }\n+    }\n+\n+    @Override\n+    protected List<SQLTranslation> fetchAllTranslations(Mapping field) {\n+        if (field == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "originalPosition": 97}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMzQ1NDA0", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-451345404", "createdAt": "2020-07-20T07:07:09Z", "commit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzowNzoxMFrOGz8JjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzowNzoxMFrOGz8JjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzExNjA0NA==", "bodyText": "index", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r457116044", "createdAt": "2020-07-20T07:07:10Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/translations/mongo/MongoTranslation.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.translations.mongo;\n+\n+import sirius.biz.translations.Translation;\n+import sirius.biz.translations.TranslationData;\n+import sirius.db.mongo.MongoEntity;\n+\n+/**\n+ * Stores translations as a collection.\n+ * <p>\n+ * Note that translations should only be accessed via siblings of {@link sirius.biz.translations.BasicTranslations}.\n+ */\n+public class MongoTranslation extends MongoEntity implements Translation {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMzQ2MjM1", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-451346235", "createdAt": "2020-07-20T07:08:40Z", "commit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzowODo0MFrOGz8NBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzowODo0MFrOGz8NBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzExNjkzMw==", "bodyText": "handle empty -> delete before this...", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r457116933", "createdAt": "2020-07-20T07:08:40Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/translations/jdbc/SQLTranslations.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.translations.jdbc;\n+\n+import sirius.biz.translations.BasicTranslations;\n+import sirius.biz.translations.Translation;\n+import sirius.biz.translations.TranslationData;\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.Mapping;\n+import sirius.kernel.commons.Strings;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Optional;\n+\n+/**\n+ * Stores translations into the appropriate collections of the underlying JDBC database.\n+ */\n+public class SQLTranslations extends BasicTranslations<SQLTranslation> {\n+\n+    public SQLTranslations(BaseEntity<?> owner) {\n+        super(owner);\n+    }\n+\n+    @Override\n+    protected void removeTranslations() {\n+        oma.select(SQLTranslation.class).eq(Translation.OWNER, owner.getUniqueName()).delete();\n+    }\n+\n+    @Override\n+    public void updateText(Mapping field, String lang, String text) {\n+        SQLTranslation translation = findOrCreateTranslation(field, lang, text);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMzQ2NTM4", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-451346538", "createdAt": "2020-07-20T07:09:14Z", "commit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzowOToxNFrOGz8OSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzowOToxNFrOGz8OSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzExNzI1OA==", "bodyText": "delete per oma.deleteStatement api?", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r457117258", "createdAt": "2020-07-20T07:09:14Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/translations/jdbc/SQLTranslations.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.translations.jdbc;\n+\n+import sirius.biz.translations.BasicTranslations;\n+import sirius.biz.translations.Translation;\n+import sirius.biz.translations.TranslationData;\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.Mapping;\n+import sirius.kernel.commons.Strings;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Optional;\n+\n+/**\n+ * Stores translations into the appropriate collections of the underlying JDBC database.\n+ */\n+public class SQLTranslations extends BasicTranslations<SQLTranslation> {\n+\n+    public SQLTranslations(BaseEntity<?> owner) {\n+        super(owner);\n+    }\n+\n+    @Override\n+    protected void removeTranslations() {\n+        oma.select(SQLTranslation.class).eq(Translation.OWNER, owner.getUniqueName()).delete();\n+    }\n+\n+    @Override\n+    public void updateText(Mapping field, String lang, String text) {\n+        SQLTranslation translation = findOrCreateTranslation(field, lang, text);\n+\n+        if (Strings.isEmpty(text)) {\n+            deleteText(field, lang);\n+            return;\n+        }\n+\n+        translation.getTranslationData().setText(text);\n+\n+        oma.update(translation);\n+    }\n+\n+    @Override\n+    public void deleteText(Mapping field, String lang) {\n+        fetchTranslation(field, lang).ifPresent(oma::delete);\n+    }\n+\n+    @Override\n+    public void deleteAllTexts(Mapping field) {\n+        for (SQLTranslation translation : fetchAllTranslations(field)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "originalPosition": 57}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMzQ2ODYy", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-451346862", "createdAt": "2020-07-20T07:09:52Z", "commit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzowOTo1MlrOGz8P4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzowOTo1MlrOGz8P4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzExNzY2Nw==", "bodyText": "delete per oma.deleteStatementAPI + write to journal of owner if journaled", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r457117667", "createdAt": "2020-07-20T07:09:52Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/translations/jdbc/SQLTranslations.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.translations.jdbc;\n+\n+import sirius.biz.translations.BasicTranslations;\n+import sirius.biz.translations.Translation;\n+import sirius.biz.translations.TranslationData;\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.Mapping;\n+import sirius.kernel.commons.Strings;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Optional;\n+\n+/**\n+ * Stores translations into the appropriate collections of the underlying JDBC database.\n+ */\n+public class SQLTranslations extends BasicTranslations<SQLTranslation> {\n+\n+    public SQLTranslations(BaseEntity<?> owner) {\n+        super(owner);\n+    }\n+\n+    @Override\n+    protected void removeTranslations() {\n+        oma.select(SQLTranslation.class).eq(Translation.OWNER, owner.getUniqueName()).delete();\n+    }\n+\n+    @Override\n+    public void updateText(Mapping field, String lang, String text) {\n+        SQLTranslation translation = findOrCreateTranslation(field, lang, text);\n+\n+        if (Strings.isEmpty(text)) {\n+            deleteText(field, lang);\n+            return;\n+        }\n+\n+        translation.getTranslationData().setText(text);\n+\n+        oma.update(translation);\n+    }\n+\n+    @Override\n+    public void deleteText(Mapping field, String lang) {\n+        fetchTranslation(field, lang).ifPresent(oma::delete);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMzQ3OTQx", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-451347941", "createdAt": "2020-07-20T07:11:40Z", "commit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzoxMTo0MVrOGz8Udw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzoxMTo0MVrOGz8Udw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzExODgzOQ==", "bodyText": "first delete then check + create otherwise", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r457118839", "createdAt": "2020-07-20T07:11:41Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/translations/mongo/MongoTranslations.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.translations.mongo;\n+\n+import sirius.biz.translations.BasicTranslations;\n+import sirius.biz.translations.Translation;\n+import sirius.biz.translations.TranslationData;\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.Mapping;\n+import sirius.kernel.commons.Strings;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Optional;\n+\n+/**\n+ * Stores translations into the appropriate collections of the underlying MongoDB.\n+ */\n+public class MongoTranslations extends BasicTranslations<MongoTranslation> {\n+\n+    public MongoTranslations(BaseEntity<?> owner) {\n+        super(owner);\n+    }\n+\n+    @Override\n+    protected void removeTranslations() {\n+        mango.select(MongoTranslation.class).eq(Translation.OWNER, owner.getUniqueName()).delete();\n+    }\n+\n+    @Override\n+    public void updateText(Mapping field, String lang, String text) {\n+        MongoTranslation translation = findOrCreateTranslation(field, lang, text);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMzQ4MDk0", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-451348094", "createdAt": "2020-07-20T07:11:57Z", "commit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzoxMTo1N1rOGz8VIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzoxMTo1N1rOGz8VIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzExOTAwOQ==", "bodyText": "update journal", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r457119009", "createdAt": "2020-07-20T07:11:57Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/translations/mongo/MongoTranslations.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.translations.mongo;\n+\n+import sirius.biz.translations.BasicTranslations;\n+import sirius.biz.translations.Translation;\n+import sirius.biz.translations.TranslationData;\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.Mapping;\n+import sirius.kernel.commons.Strings;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Optional;\n+\n+/**\n+ * Stores translations into the appropriate collections of the underlying MongoDB.\n+ */\n+public class MongoTranslations extends BasicTranslations<MongoTranslation> {\n+\n+    public MongoTranslations(BaseEntity<?> owner) {\n+        super(owner);\n+    }\n+\n+    @Override\n+    protected void removeTranslations() {\n+        mango.select(MongoTranslation.class).eq(Translation.OWNER, owner.getUniqueName()).delete();\n+    }\n+\n+    @Override\n+    public void updateText(Mapping field, String lang, String text) {\n+        MongoTranslation translation = findOrCreateTranslation(field, lang, text);\n+\n+        if (Strings.isEmpty(text)) {\n+            deleteText(field, lang);\n+            return;\n+        }\n+\n+        translation.getTranslationData().setText(text);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMzQ4MjQ4", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-451348248", "createdAt": "2020-07-20T07:12:12Z", "commit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzoxMjoxMlrOGz8VzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzoxMjoxMlrOGz8VzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzExOTE4MA==", "bodyText": "mongo.delete() + journal", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r457119180", "createdAt": "2020-07-20T07:12:12Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/translations/mongo/MongoTranslations.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.translations.mongo;\n+\n+import sirius.biz.translations.BasicTranslations;\n+import sirius.biz.translations.Translation;\n+import sirius.biz.translations.TranslationData;\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.Mapping;\n+import sirius.kernel.commons.Strings;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Optional;\n+\n+/**\n+ * Stores translations into the appropriate collections of the underlying MongoDB.\n+ */\n+public class MongoTranslations extends BasicTranslations<MongoTranslation> {\n+\n+    public MongoTranslations(BaseEntity<?> owner) {\n+        super(owner);\n+    }\n+\n+    @Override\n+    protected void removeTranslations() {\n+        mango.select(MongoTranslation.class).eq(Translation.OWNER, owner.getUniqueName()).delete();\n+    }\n+\n+    @Override\n+    public void updateText(Mapping field, String lang, String text) {\n+        MongoTranslation translation = findOrCreateTranslation(field, lang, text);\n+\n+        if (Strings.isEmpty(text)) {\n+            deleteText(field, lang);\n+            return;\n+        }\n+\n+        translation.getTranslationData().setText(text);\n+\n+        mango.update(translation);\n+    }\n+\n+    @Override\n+    public void deleteText(Mapping field, String lang) {\n+        fetchTranslation(field, lang).ifPresent(mango::delete);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMzQ4MzAy", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-451348302", "createdAt": "2020-07-20T07:12:18Z", "commit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzoxMjoxOFrOGz8WBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzoxMjoxOFrOGz8WBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzExOTIzNg==", "bodyText": "s.a.", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r457119236", "createdAt": "2020-07-20T07:12:18Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/translations/mongo/MongoTranslations.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.translations.mongo;\n+\n+import sirius.biz.translations.BasicTranslations;\n+import sirius.biz.translations.Translation;\n+import sirius.biz.translations.TranslationData;\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.Mapping;\n+import sirius.kernel.commons.Strings;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Optional;\n+\n+/**\n+ * Stores translations into the appropriate collections of the underlying MongoDB.\n+ */\n+public class MongoTranslations extends BasicTranslations<MongoTranslation> {\n+\n+    public MongoTranslations(BaseEntity<?> owner) {\n+        super(owner);\n+    }\n+\n+    @Override\n+    protected void removeTranslations() {\n+        mango.select(MongoTranslation.class).eq(Translation.OWNER, owner.getUniqueName()).delete();\n+    }\n+\n+    @Override\n+    public void updateText(Mapping field, String lang, String text) {\n+        MongoTranslation translation = findOrCreateTranslation(field, lang, text);\n+\n+        if (Strings.isEmpty(text)) {\n+            deleteText(field, lang);\n+            return;\n+        }\n+\n+        translation.getTranslationData().setText(text);\n+\n+        mango.update(translation);\n+    }\n+\n+    @Override\n+    public void deleteText(Mapping field, String lang) {\n+        fetchTranslation(field, lang).ifPresent(mango::delete);\n+    }\n+\n+    @Override\n+    public void deleteAllTexts(Mapping field) {\n+        for (MongoTranslation translation : fetchAllTranslations(field)) {\n+            mango.delete(translation);\n+        }\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMzQ4NTA2", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-451348506", "createdAt": "2020-07-20T07:12:38Z", "commit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzoxMjozOFrOGz8W4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzoxMjozOFrOGz8W4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzExOTQ1OQ==", "bodyText": "s.a.", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r457119459", "createdAt": "2020-07-20T07:12:38Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/translations/mongo/MongoTranslations.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.translations.mongo;\n+\n+import sirius.biz.translations.BasicTranslations;\n+import sirius.biz.translations.Translation;\n+import sirius.biz.translations.TranslationData;\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.Mapping;\n+import sirius.kernel.commons.Strings;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Optional;\n+\n+/**\n+ * Stores translations into the appropriate collections of the underlying MongoDB.\n+ */\n+public class MongoTranslations extends BasicTranslations<MongoTranslation> {\n+\n+    public MongoTranslations(BaseEntity<?> owner) {\n+        super(owner);\n+    }\n+\n+    @Override\n+    protected void removeTranslations() {\n+        mango.select(MongoTranslation.class).eq(Translation.OWNER, owner.getUniqueName()).delete();\n+    }\n+\n+    @Override\n+    public void updateText(Mapping field, String lang, String text) {\n+        MongoTranslation translation = findOrCreateTranslation(field, lang, text);\n+\n+        if (Strings.isEmpty(text)) {\n+            deleteText(field, lang);\n+            return;\n+        }\n+\n+        translation.getTranslationData().setText(text);\n+\n+        mango.update(translation);\n+    }\n+\n+    @Override\n+    public void deleteText(Mapping field, String lang) {\n+        fetchTranslation(field, lang).ifPresent(mango::delete);\n+    }\n+\n+    @Override\n+    public void deleteAllTexts(Mapping field) {\n+        for (MongoTranslation translation : fetchAllTranslations(field)) {\n+            mango.delete(translation);\n+        }\n+    }\n+\n+    @Override\n+    protected MongoTranslation findOrCreateTranslation(Mapping field, String lang, String text) {\n+        if (!isSupportedLanguage(lang)) {\n+            return null;\n+        }\n+\n+        Optional<MongoTranslation> translation = fetchTranslation(field, lang);\n+\n+        if (translation.isPresent()) {\n+            return translation.get();\n+        } else {\n+            MongoTranslation mongoTranslation = new MongoTranslation();\n+            mongoTranslation.setOwner(owner.getUniqueName());\n+            mongoTranslation.getTranslationData().setField(field.getName());\n+            mongoTranslation.getTranslationData().setLang(lang);\n+            return mongoTranslation;\n+        }\n+    }\n+\n+    @Override\n+    protected Optional<MongoTranslation> fetchTranslation(Mapping field, String lang) {\n+        if (field == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "originalPosition": 83}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMzQ4NzUz", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-451348753", "createdAt": "2020-07-20T07:13:02Z", "commit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzoxMzowMlrOGz8X2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzoxMzowMlrOGz8X2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzExOTcwNQ==", "bodyText": "thats what Query.first() (in contrast to Query.queryFirst()) does.. :)", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r457119705", "createdAt": "2020-07-20T07:13:02Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/translations/mongo/MongoTranslations.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.translations.mongo;\n+\n+import sirius.biz.translations.BasicTranslations;\n+import sirius.biz.translations.Translation;\n+import sirius.biz.translations.TranslationData;\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.Mapping;\n+import sirius.kernel.commons.Strings;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Optional;\n+\n+/**\n+ * Stores translations into the appropriate collections of the underlying MongoDB.\n+ */\n+public class MongoTranslations extends BasicTranslations<MongoTranslation> {\n+\n+    public MongoTranslations(BaseEntity<?> owner) {\n+        super(owner);\n+    }\n+\n+    @Override\n+    protected void removeTranslations() {\n+        mango.select(MongoTranslation.class).eq(Translation.OWNER, owner.getUniqueName()).delete();\n+    }\n+\n+    @Override\n+    public void updateText(Mapping field, String lang, String text) {\n+        MongoTranslation translation = findOrCreateTranslation(field, lang, text);\n+\n+        if (Strings.isEmpty(text)) {\n+            deleteText(field, lang);\n+            return;\n+        }\n+\n+        translation.getTranslationData().setText(text);\n+\n+        mango.update(translation);\n+    }\n+\n+    @Override\n+    public void deleteText(Mapping field, String lang) {\n+        fetchTranslation(field, lang).ifPresent(mango::delete);\n+    }\n+\n+    @Override\n+    public void deleteAllTexts(Mapping field) {\n+        for (MongoTranslation translation : fetchAllTranslations(field)) {\n+            mango.delete(translation);\n+        }\n+    }\n+\n+    @Override\n+    protected MongoTranslation findOrCreateTranslation(Mapping field, String lang, String text) {\n+        if (!isSupportedLanguage(lang)) {\n+            return null;\n+        }\n+\n+        Optional<MongoTranslation> translation = fetchTranslation(field, lang);\n+\n+        if (translation.isPresent()) {\n+            return translation.get();\n+        } else {\n+            MongoTranslation mongoTranslation = new MongoTranslation();\n+            mongoTranslation.setOwner(owner.getUniqueName());\n+            mongoTranslation.getTranslationData().setField(field.getName());\n+            mongoTranslation.getTranslationData().setLang(lang);\n+            return mongoTranslation;\n+        }\n+    }\n+\n+    @Override\n+    protected Optional<MongoTranslation> fetchTranslation(Mapping field, String lang) {\n+        if (field == null) {\n+            return Optional.empty();\n+        } else {\n+            return Optional.ofNullable(mango.select(MongoTranslation.class)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "originalPosition": 86}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMzQ4ODQw", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-451348840", "createdAt": "2020-07-20T07:13:12Z", "commit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzoxMzoxMlrOGz8YVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzoxMzoxMlrOGz8YVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzExOTgyOA==", "bodyText": "s.a.", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r457119828", "createdAt": "2020-07-20T07:13:12Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/translations/mongo/MongoTranslations.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.translations.mongo;\n+\n+import sirius.biz.translations.BasicTranslations;\n+import sirius.biz.translations.Translation;\n+import sirius.biz.translations.TranslationData;\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.Mapping;\n+import sirius.kernel.commons.Strings;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Optional;\n+\n+/**\n+ * Stores translations into the appropriate collections of the underlying MongoDB.\n+ */\n+public class MongoTranslations extends BasicTranslations<MongoTranslation> {\n+\n+    public MongoTranslations(BaseEntity<?> owner) {\n+        super(owner);\n+    }\n+\n+    @Override\n+    protected void removeTranslations() {\n+        mango.select(MongoTranslation.class).eq(Translation.OWNER, owner.getUniqueName()).delete();\n+    }\n+\n+    @Override\n+    public void updateText(Mapping field, String lang, String text) {\n+        MongoTranslation translation = findOrCreateTranslation(field, lang, text);\n+\n+        if (Strings.isEmpty(text)) {\n+            deleteText(field, lang);\n+            return;\n+        }\n+\n+        translation.getTranslationData().setText(text);\n+\n+        mango.update(translation);\n+    }\n+\n+    @Override\n+    public void deleteText(Mapping field, String lang) {\n+        fetchTranslation(field, lang).ifPresent(mango::delete);\n+    }\n+\n+    @Override\n+    public void deleteAllTexts(Mapping field) {\n+        for (MongoTranslation translation : fetchAllTranslations(field)) {\n+            mango.delete(translation);\n+        }\n+    }\n+\n+    @Override\n+    protected MongoTranslation findOrCreateTranslation(Mapping field, String lang, String text) {\n+        if (!isSupportedLanguage(lang)) {\n+            return null;\n+        }\n+\n+        Optional<MongoTranslation> translation = fetchTranslation(field, lang);\n+\n+        if (translation.isPresent()) {\n+            return translation.get();\n+        } else {\n+            MongoTranslation mongoTranslation = new MongoTranslation();\n+            mongoTranslation.setOwner(owner.getUniqueName());\n+            mongoTranslation.getTranslationData().setField(field.getName());\n+            mongoTranslation.getTranslationData().setLang(lang);\n+            return mongoTranslation;\n+        }\n+    }\n+\n+    @Override\n+    protected Optional<MongoTranslation> fetchTranslation(Mapping field, String lang) {\n+        if (field == null) {\n+            return Optional.empty();\n+        } else {\n+            return Optional.ofNullable(mango.select(MongoTranslation.class)\n+                                            .eq(Translation.OWNER, owner.getUniqueName())\n+                                            .eq(Translation.TRANSLATION_DATA.inner(TranslationData.FIELD),\n+                                                field.getName())\n+                                            .eq(Translation.TRANSLATION_DATA.inner(TranslationData.LANG), lang)\n+                                            .queryFirst());\n+        }\n+    }\n+\n+    @Override\n+    protected List<MongoTranslation> fetchAllTranslations(Mapping field) {\n+        if (field == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "originalPosition": 97}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMzQ5MDk0", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-451349094", "createdAt": "2020-07-20T07:13:34Z", "commit": {"oid": "b0623dc63040ecead8d4d4b2e6bc9c90f5fec8b5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70037615abd2d6314122b10cced6f21aa32a3c01", "author": {"user": {"login": "cschierle", "name": "Christian Schierle"}}, "url": "https://github.com/scireum/sirius-biz/commit/70037615abd2d6314122b10cced6f21aa32a3c01", "committedDate": "2020-07-23T08:09:34Z", "message": "Moves owner to TranslationData\n\nFixes: SIRI-228"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36bcce604a758bb154bfcf124a431abd7a039d35", "author": {"user": {"login": "cschierle", "name": "Christian Schierle"}}, "url": "https://github.com/scireum/sirius-biz/commit/36bcce604a758bb154bfcf124a431abd7a039d35", "committedDate": "2020-07-23T08:16:46Z", "message": "Moves common update logic to base class\n\nFixes: SIRI-228"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee5b15659b5975dd9aaf9a5176b86ff308634de4", "author": {"user": {"login": "cschierle", "name": "Christian Schierle"}}, "url": "https://github.com/scireum/sirius-biz/commit/ee5b15659b5975dd9aaf9a5176b86ff308634de4", "committedDate": "2020-07-23T08:57:27Z", "message": "Adds index\n\nFixes: SIRI-228"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f976644e96b7ae9cf09cb318878998784083fdc5", "author": {"user": {"login": "cschierle", "name": "Christian Schierle"}}, "url": "https://github.com/scireum/sirius-biz/commit/f976644e96b7ae9cf09cb318878998784083fdc5", "committedDate": "2020-07-23T09:51:26Z", "message": "Improves db interactions and error handling\n\nFixes: SIRI-228"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b578a474dc63e32c21c396278d3c3463f4f5504", "author": {"user": {"login": "cschierle", "name": "Christian Schierle"}}, "url": "https://github.com/scireum/sirius-biz/commit/5b578a474dc63e32c21c396278d3c3463f4f5504", "committedDate": "2020-07-23T10:18:54Z", "message": "Writes to journaled owners' journal when translations are updated or deleted\n\nFixes: SIRI-228"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0MTcyOTIz", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-454172923", "createdAt": "2020-07-23T14:12:10Z", "commit": {"oid": "5b578a474dc63e32c21c396278d3c3463f4f5504"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNDoxMjoxMVrOG2MclA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNDoxMjoxMVrOG2MclA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTQ4MDIxMg==", "bodyText": "I'd skip that - this might silently suppress a bug we'd rather want to surface here....", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r459480212", "createdAt": "2020-07-23T14:12:11Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/translations/jdbc/SQLTranslations.java", "diffHunk": "@@ -0,0 +1,131 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.translations.jdbc;\n+\n+import sirius.biz.protocol.JournalData;\n+import sirius.biz.protocol.Journaled;\n+import sirius.biz.translations.BasicTranslations;\n+import sirius.biz.translations.Translation;\n+import sirius.biz.translations.TranslationData;\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.Mapping;\n+import sirius.db.mixing.Mixing;\n+import sirius.kernel.health.Exceptions;\n+\n+import javax.annotation.Nonnull;\n+import java.sql.SQLException;\n+import java.util.List;\n+import java.util.Optional;\n+\n+/**\n+ * Stores translations into the appropriate collections of the underlying JDBC database.\n+ */\n+public class SQLTranslations extends BasicTranslations<SQLTranslation> {\n+\n+    public SQLTranslations(BaseEntity<?> owner) {\n+        super(owner);\n+    }\n+\n+    @Override\n+    protected void removeTranslations() {\n+        oma.select(SQLTranslation.class)\n+           .eq(Translation.TRANSLATION_DATA.inner(TranslationData.OWNER), owner.getUniqueName())\n+           .delete();\n+    }\n+\n+    @Override\n+    protected void updateTranslation(SQLTranslation translation) {\n+        oma.update(translation);\n+    }\n+\n+    @Override\n+    public void deleteText(@Nonnull Mapping field, String lang) {\n+        try {\n+            oma.deleteStatement(SQLTranslation.class)\n+               .where(Translation.TRANSLATION_DATA.inner(TranslationData.OWNER), owner.getUniqueName())\n+               .where(Translation.TRANSLATION_DATA.inner(TranslationData.FIELD), field.getName())\n+               .where(Translation.TRANSLATION_DATA.inner(TranslationData.LANG), lang)\n+               .executeUpdate();\n+\n+            if (owner instanceof Journaled) {\n+                JournalData.addJournalEntry(owner,\n+                                            \"Deleted translated text for \" + field.getName() + \" (\" + lang + \")\");\n+            }\n+        } catch (SQLException e) {\n+            throw Exceptions.handle()\n+                            .to(Mixing.LOG)\n+                            .error(e)\n+                            .withSystemErrorMessage(\"Failed to delete a translation text for %s: %s (%s)\",\n+                                                    owner.getUniqueName(),\n+                                                    field.getName(),\n+                                                    lang)\n+                            .handle();\n+        }\n+    }\n+\n+    @Override\n+    public void deleteAllTexts(@Nonnull Mapping field) {\n+        try {\n+            oma.deleteStatement(SQLTranslation.class)\n+               .where(Translation.TRANSLATION_DATA.inner(TranslationData.OWNER), owner.getUniqueName())\n+               .where(Translation.TRANSLATION_DATA.inner(TranslationData.FIELD), field.getName())\n+               .executeUpdate();\n+\n+            if (owner instanceof Journaled) {\n+                JournalData.addJournalEntry(owner, \"Deleted all translated texts for \" + field.getName());\n+            }\n+        } catch (SQLException e) {\n+            throw Exceptions.handle()\n+                            .to(Mixing.LOG)\n+                            .error(e)\n+                            .withSystemErrorMessage(\"Failed to delete translation texts for %s: %s\",\n+                                                    owner.getUniqueName(),\n+                                                    field.getName())\n+                            .handle();\n+        }\n+    }\n+\n+    @Override\n+    protected SQLTranslation findOrCreateTranslation(@Nonnull Mapping field, String lang, String text) {\n+        if (!isSupportedLanguage(lang)) {\n+            throw new IllegalArgumentException(\n+                    \"lang must be a language code supported by the system (supportedLanguages)!\");\n+        }\n+\n+        Optional<SQLTranslation> translation = fetchTranslation(field, lang);\n+\n+        if (translation.isPresent()) {\n+            return translation.get();\n+        } else {\n+            SQLTranslation sqlTranslation = new SQLTranslation();\n+            sqlTranslation.getTranslationData().setOwner(owner.getUniqueName());\n+            sqlTranslation.getTranslationData().setField(field.getName());\n+            sqlTranslation.getTranslationData().setLang(lang);\n+            return sqlTranslation;\n+        }\n+    }\n+\n+    @Override\n+    protected Optional<SQLTranslation> fetchTranslation(@Nonnull Mapping field, String lang) {\n+        return oma.select(SQLTranslation.class)\n+                  .eq(Translation.TRANSLATION_DATA.inner(TranslationData.OWNER), owner.getUniqueName())\n+                  .eq(Translation.TRANSLATION_DATA.inner(TranslationData.FIELD), field.getName())\n+                  .eq(Translation.TRANSLATION_DATA.inner(TranslationData.LANG), lang)\n+                  .first();\n+    }\n+\n+    @Override\n+    protected List<SQLTranslation> fetchAllTranslations(@Nonnull Mapping field) {\n+        return oma.select(SQLTranslation.class)\n+                  .eq(Translation.TRANSLATION_DATA.inner(TranslationData.OWNER), owner.getUniqueName())\n+                  .eq(Translation.TRANSLATION_DATA.inner(TranslationData.FIELD), field.getName())\n+                  .limit(supportedLanguages.size())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b578a474dc63e32c21c396278d3c3463f4f5504"}, "originalPosition": 128}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0MTc0MjQ3", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-454174247", "createdAt": "2020-07-23T14:13:36Z", "commit": {"oid": "5b578a474dc63e32c21c396278d3c3463f4f5504"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNDoxMzozNlrOG2MgpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNDoxMzozNlrOG2MgpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTQ4MTI1Mw==", "bodyText": "couldn't we move the journal entries for delete here?", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r459481253", "createdAt": "2020-07-23T14:13:36Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/translations/BasicTranslations.java", "diffHunk": "@@ -0,0 +1,223 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.translations;\n+\n+import sirius.biz.protocol.JournalData;\n+import sirius.biz.protocol.Journaled;\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.Composite;\n+import sirius.db.mixing.FieldLookupCache;\n+import sirius.db.mixing.Mapping;\n+import sirius.db.mixing.annotations.AfterDelete;\n+import sirius.db.mixing.annotations.Transient;\n+import sirius.kernel.commons.Strings;\n+import sirius.kernel.di.std.ConfigValue;\n+import sirius.kernel.di.std.Part;\n+\n+import javax.annotation.Nonnull;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.Set;\n+\n+/**\n+ * Provides database independent specifications for functionality to access and edit translations for an entity.\n+ *\n+ * @param <T> the translation entity type used by a concrete subclass\n+ */\n+public abstract class BasicTranslations<T extends BaseEntity<?> & Translation> extends Composite {\n+\n+    @Transient\n+    protected BaseEntity<?> owner;\n+\n+    @Transient\n+    @ConfigValue(\"mixing.multiLanguageStrings.supportedLanguages\")\n+    protected static Set<String> supportedLanguages;\n+\n+    @Transient\n+    @Part\n+    private static FieldLookupCache fieldLookupCache;\n+\n+    protected BasicTranslations(BaseEntity<?> owner) {\n+        this.owner = owner;\n+    }\n+\n+    /**\n+     * Ensures that translations are cascaded-deleted upon deletion of the owner entity.\n+     */\n+    @AfterDelete\n+    protected abstract void removeTranslations();\n+\n+    /**\n+     * Provides a validator so translations can only be added for supported languages.\n+     *\n+     * @param lang the language code in question\n+     * @return true if language is supported by the system, false otherwise\n+     */\n+    protected boolean isSupportedLanguage(String lang) {\n+        return supportedLanguages.contains(lang);\n+    }\n+\n+    /**\n+     * Updates the translation for the given field and language, or adds a new translation if it does not exist.\n+     * <p>\n+     * Note that an existing translation is deleted when calling this with empty text.\n+     * <p>\n+     * Also note that this will emit an {@link sirius.biz.protocol.JournalEntry} to\n+     * {@link sirius.biz.protocol.Journaled} owners keeping track of the changes made to their translations.\n+     *\n+     * @param field {@link Mapping} of the translated field\n+     * @param lang  language code\n+     * @param text  translated text for the given language\n+     */\n+    public void updateText(@Nonnull Mapping field, String lang, String text) {\n+        if (Strings.isEmpty(text)) {\n+            deleteText(field, lang);\n+            return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b578a474dc63e32c21c396278d3c3463f4f5504"}, "originalPosition": 83}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0MTc1Mzk4", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-454175398", "createdAt": "2020-07-23T14:14:50Z", "commit": {"oid": "5b578a474dc63e32c21c396278d3c3463f4f5504"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNDoxNDo1MFrOG2Mj0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNDoxNDo1MFrOG2Mj0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTQ4MjA2Nw==", "bodyText": "shouldn't we also place a @AfterDelete handler here, which wipes all texts (without logging to the journal)?", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r459482067", "createdAt": "2020-07-23T14:14:50Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/translations/BasicTranslations.java", "diffHunk": "@@ -0,0 +1,223 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.translations;\n+\n+import sirius.biz.protocol.JournalData;\n+import sirius.biz.protocol.Journaled;\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.Composite;\n+import sirius.db.mixing.FieldLookupCache;\n+import sirius.db.mixing.Mapping;\n+import sirius.db.mixing.annotations.AfterDelete;\n+import sirius.db.mixing.annotations.Transient;\n+import sirius.kernel.commons.Strings;\n+import sirius.kernel.di.std.ConfigValue;\n+import sirius.kernel.di.std.Part;\n+\n+import javax.annotation.Nonnull;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.Set;\n+\n+/**\n+ * Provides database independent specifications for functionality to access and edit translations for an entity.\n+ *\n+ * @param <T> the translation entity type used by a concrete subclass\n+ */\n+public abstract class BasicTranslations<T extends BaseEntity<?> & Translation> extends Composite {\n+\n+    @Transient\n+    protected BaseEntity<?> owner;\n+\n+    @Transient\n+    @ConfigValue(\"mixing.multiLanguageStrings.supportedLanguages\")\n+    protected static Set<String> supportedLanguages;\n+\n+    @Transient\n+    @Part\n+    private static FieldLookupCache fieldLookupCache;\n+\n+    protected BasicTranslations(BaseEntity<?> owner) {\n+        this.owner = owner;\n+    }\n+\n+    /**\n+     * Ensures that translations are cascaded-deleted upon deletion of the owner entity.\n+     */\n+    @AfterDelete\n+    protected abstract void removeTranslations();\n+\n+    /**\n+     * Provides a validator so translations can only be added for supported languages.\n+     *\n+     * @param lang the language code in question\n+     * @return true if language is supported by the system, false otherwise\n+     */\n+    protected boolean isSupportedLanguage(String lang) {\n+        return supportedLanguages.contains(lang);\n+    }\n+\n+    /**\n+     * Updates the translation for the given field and language, or adds a new translation if it does not exist.\n+     * <p>\n+     * Note that an existing translation is deleted when calling this with empty text.\n+     * <p>\n+     * Also note that this will emit an {@link sirius.biz.protocol.JournalEntry} to\n+     * {@link sirius.biz.protocol.Journaled} owners keeping track of the changes made to their translations.\n+     *\n+     * @param field {@link Mapping} of the translated field\n+     * @param lang  language code\n+     * @param text  translated text for the given language\n+     */\n+    public void updateText(@Nonnull Mapping field, String lang, String text) {\n+        if (Strings.isEmpty(text)) {\n+            deleteText(field, lang);\n+            return;\n+        }\n+\n+        T translation = findOrCreateTranslation(field, lang, text);\n+        translation.getTranslationData().setText(text);\n+        updateTranslation(translation);\n+\n+        if (owner instanceof Journaled) {\n+            JournalData.addJournalEntry(owner,\n+                                        String.format(\"Updated translated text for %s (%s): '%s'\",\n+                                                      field.getName(),\n+                                                      lang,\n+                                                      text));\n+        }\n+    }\n+\n+    /**\n+     * Forwards updates on the given translation entity to the database in use.\n+     *\n+     * @param translation the translation entity to update\n+     */\n+    protected abstract void updateTranslation(T translation);\n+\n+    /**\n+     * Deletes the translation for the given field and language.\n+     * <p>\n+     * Note that this will also emit an {@link sirius.biz.protocol.JournalEntry} to\n+     * {@link sirius.biz.protocol.Journaled} owners keeping track of the changes made to their translations.\n+     *\n+     * @param field {@link Mapping} of the translated field\n+     * @param lang  code of the language to be deleted\n+     */\n+    public abstract void deleteText(@Nonnull Mapping field, String lang);\n+\n+    /**\n+     * Deletes all translations for the given field.\n+     * <p>\n+     * Note that this will also emit an {@link sirius.biz.protocol.JournalEntry} to\n+     * {@link sirius.biz.protocol.Journaled} owners keeping track of the changes made to their translations.\n+     *\n+     * @param field {@link Mapping} of the translated field\n+     */\n+    public abstract void deleteAllTexts(@Nonnull Mapping field);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b578a474dc63e32c21c396278d3c3463f4f5504"}, "originalPosition": 125}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0MTc2OTE0", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-454176914", "createdAt": "2020-07-23T14:16:24Z", "commit": {"oid": "5b578a474dc63e32c21c396278d3c3463f4f5504"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNDoxNjoyNFrOG2MouQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNDoxNjoyNFrOG2MouQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTQ4MzMyMQ==", "bodyText": "coundn' t we use mongo.delete().eq....eq...().executeFor(...) here?", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r459483321", "createdAt": "2020-07-23T14:16:24Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/translations/mongo/MongoTranslations.java", "diffHunk": "@@ -0,0 +1,102 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.translations.mongo;\n+\n+import sirius.biz.protocol.JournalData;\n+import sirius.biz.protocol.Journaled;\n+import sirius.biz.translations.BasicTranslations;\n+import sirius.biz.translations.Translation;\n+import sirius.biz.translations.TranslationData;\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.Mapping;\n+\n+import javax.annotation.Nonnull;\n+import java.util.List;\n+import java.util.Optional;\n+\n+/**\n+ * Stores translations into the appropriate collections of the underlying MongoDB.\n+ */\n+public class MongoTranslations extends BasicTranslations<MongoTranslation> {\n+\n+    public MongoTranslations(BaseEntity<?> owner) {\n+        super(owner);\n+    }\n+\n+    @Override\n+    protected void removeTranslations() {\n+        mango.select(MongoTranslation.class)\n+             .eq(Translation.TRANSLATION_DATA.inner(TranslationData.OWNER), owner.getUniqueName())\n+             .delete();\n+    }\n+\n+    @Override\n+    protected void updateTranslation(MongoTranslation translation) {\n+        mango.update(translation);\n+    }\n+\n+    @Override\n+    public void deleteText(@Nonnull Mapping field, String lang) {\n+        fetchTranslation(field, lang).ifPresent(mongoTranslation -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b578a474dc63e32c21c396278d3c3463f4f5504"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0MTc3MDQ4", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-454177048", "createdAt": "2020-07-23T14:16:33Z", "commit": {"oid": "5b578a474dc63e32c21c396278d3c3463f4f5504"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNDoxNjozM1rOG2MpJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNDoxNjozM1rOG2MpJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTQ4MzQzMQ==", "bodyText": "s.a.", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r459483431", "createdAt": "2020-07-23T14:16:33Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/translations/mongo/MongoTranslations.java", "diffHunk": "@@ -0,0 +1,102 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.translations.mongo;\n+\n+import sirius.biz.protocol.JournalData;\n+import sirius.biz.protocol.Journaled;\n+import sirius.biz.translations.BasicTranslations;\n+import sirius.biz.translations.Translation;\n+import sirius.biz.translations.TranslationData;\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.Mapping;\n+\n+import javax.annotation.Nonnull;\n+import java.util.List;\n+import java.util.Optional;\n+\n+/**\n+ * Stores translations into the appropriate collections of the underlying MongoDB.\n+ */\n+public class MongoTranslations extends BasicTranslations<MongoTranslation> {\n+\n+    public MongoTranslations(BaseEntity<?> owner) {\n+        super(owner);\n+    }\n+\n+    @Override\n+    protected void removeTranslations() {\n+        mango.select(MongoTranslation.class)\n+             .eq(Translation.TRANSLATION_DATA.inner(TranslationData.OWNER), owner.getUniqueName())\n+             .delete();\n+    }\n+\n+    @Override\n+    protected void updateTranslation(MongoTranslation translation) {\n+        mango.update(translation);\n+    }\n+\n+    @Override\n+    public void deleteText(@Nonnull Mapping field, String lang) {\n+        fetchTranslation(field, lang).ifPresent(mongoTranslation -> {\n+            mango.delete(mongoTranslation);\n+            if (owner instanceof Journaled) {\n+                JournalData.addJournalEntry(owner,\n+                                            \"Deleted translated text for \" + field.getName() + \" (\" + lang + \")\");\n+            }\n+        });\n+    }\n+\n+    @Override\n+    public void deleteAllTexts(@Nonnull Mapping field) {\n+        for (MongoTranslation translation : fetchAllTranslations(field)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b578a474dc63e32c21c396278d3c3463f4f5504"}, "originalPosition": 57}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0MTc3MzY3", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-454177367", "createdAt": "2020-07-23T14:16:53Z", "commit": {"oid": "5b578a474dc63e32c21c396278d3c3463f4f5504"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d13d90a4cf7e72116f4a62572ae0d5b9b704576a", "author": {"user": {"login": "cschierle", "name": "Christian Schierle"}}, "url": "https://github.com/scireum/sirius-biz/commit/d13d90a4cf7e72116f4a62572ae0d5b9b704576a", "committedDate": "2020-07-27T06:05:02Z", "message": "Removes query size limit\n\nFixes: SIRI-228"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "204e0a534f8f9066a9d0f36ee8ed7a1c82dcf72d", "author": {"user": {"login": "cschierle", "name": "Christian Schierle"}}, "url": "https://github.com/scireum/sirius-biz/commit/204e0a534f8f9066a9d0f36ee8ed7a1c82dcf72d", "committedDate": "2020-07-27T13:45:21Z", "message": "Reduces framework overhead for deletions\n\nFixes: SIRI-228"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1ODA5MTkx", "url": "https://github.com/scireum/sirius-biz/pull/808#pullrequestreview-455809191", "createdAt": "2020-07-27T14:00:44Z", "commit": {"oid": "204e0a534f8f9066a9d0f36ee8ed7a1c82dcf72d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxNDowMDo0NFrOG3jzTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxNDowMToyN1rOG3j1GA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkxMTQzNg==", "bodyText": "mongo.delete^^", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r460911436", "createdAt": "2020-07-27T14:00:44Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/translations/mongo/MongoTranslations.java", "diffHunk": "@@ -0,0 +1,108 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.translations.mongo;\n+\n+import sirius.biz.protocol.JournalData;\n+import sirius.biz.protocol.Journaled;\n+import sirius.biz.translations.BasicTranslations;\n+import sirius.biz.translations.Translation;\n+import sirius.biz.translations.TranslationData;\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.Mapping;\n+import sirius.db.mongo.Mongo;\n+import sirius.kernel.di.std.Part;\n+\n+import javax.annotation.Nonnull;\n+import java.util.List;\n+import java.util.Optional;\n+\n+/**\n+ * Stores translations into the appropriate collections of the underlying MongoDB.\n+ */\n+public class MongoTranslations extends BasicTranslations<MongoTranslation> {\n+\n+    public MongoTranslations(BaseEntity<?> owner) {\n+        super(owner);\n+    }\n+\n+    @Part\n+    private static Mongo mongo;\n+\n+    @Override\n+    protected void removeTranslations() {\n+        mango.select(MongoTranslation.class)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "204e0a534f8f9066a9d0f36ee8ed7a1c82dcf72d"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkxMTg5Ng==", "bodyText": "oma.deleteStatement", "url": "https://github.com/scireum/sirius-biz/pull/808#discussion_r460911896", "createdAt": "2020-07-27T14:01:27Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/translations/jdbc/SQLTranslations.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.translations.jdbc;\n+\n+import sirius.biz.protocol.JournalData;\n+import sirius.biz.protocol.Journaled;\n+import sirius.biz.translations.BasicTranslations;\n+import sirius.biz.translations.Translation;\n+import sirius.biz.translations.TranslationData;\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.Mapping;\n+import sirius.db.mixing.Mixing;\n+import sirius.kernel.health.Exceptions;\n+\n+import javax.annotation.Nonnull;\n+import java.sql.SQLException;\n+import java.util.List;\n+import java.util.Optional;\n+\n+/**\n+ * Stores translations into the appropriate collections of the underlying JDBC database.\n+ */\n+public class SQLTranslations extends BasicTranslations<SQLTranslation> {\n+\n+    public SQLTranslations(BaseEntity<?> owner) {\n+        super(owner);\n+    }\n+\n+    @Override\n+    protected void removeTranslations() {\n+        oma.select(SQLTranslation.class)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "204e0a534f8f9066a9d0f36ee8ed7a1c82dcf72d"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbc9ac3d5074944efd8b8b5d0c203d7b25d73d93", "author": {"user": {"login": "cschierle", "name": "Christian Schierle"}}, "url": "https://github.com/scireum/sirius-biz/commit/bbc9ac3d5074944efd8b8b5d0c203d7b25d73d93", "committedDate": "2020-07-27T14:08:49Z", "message": "Reduces framework overhead for deletions\n\nFixes: SIRI-228"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4358, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}