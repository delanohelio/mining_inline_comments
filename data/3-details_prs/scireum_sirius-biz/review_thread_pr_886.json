{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4MzAyNjE2", "number": 886, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMDoxOToyMFrOEx1b4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNy0wNVQwNjo1Mjo1MlrOGSIWIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwNjkxMTcwOnYy", "diffSide": "RIGHT", "path": "src/main/java/sirius/biz/tycho/updates/UpdatesController.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMDoxOToyMFrOHoJALw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMDoxOToyMFrOHoJALw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg1MjU5MQ==", "bodyText": "Codeformat", "url": "https://github.com/scireum/sirius-biz/pull/886#discussion_r511852591", "createdAt": "2020-10-26T10:19:20Z", "author": {"login": "sabieber"}, "path": "src/main/java/sirius/biz/tycho/updates/UpdatesController.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.tycho.updates;\n+\n+import sirius.biz.web.BizController;\n+import sirius.kernel.di.std.Part;\n+import sirius.kernel.di.std.Register;\n+import sirius.tagliatelle.Tagliatelle;\n+import sirius.tagliatelle.compiler.CompileException;\n+import sirius.web.controller.Controller;\n+import sirius.web.controller.Routed;\n+import sirius.web.http.WebContext;\n+import sirius.web.services.JSONStructuredOutput;\n+\n+@Register(classes = Controller.class)\n+public class UpdatesController extends BizController {\n+\n+    @Part\n+    private UpdateManager updateManager;\n+\n+@Part", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86756d99f63fed8259ae22e9c186d7fa2662a975"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwNjkxNDk1OnYy", "diffSide": "RIGHT", "path": "src/main/java/sirius/biz/tycho/updates/UpdateManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMDoyMDoxM1rOHoJCFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMDoyMDoxM1rOHoJCFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg1MzA3Ng==", "bodyText": "Hardcoded?", "url": "https://github.com/scireum/sirius-biz/pull/886#discussion_r511853076", "createdAt": "2020-10-26T10:20:13Z", "author": {"login": "sabieber"}, "path": "src/main/java/sirius/biz/tycho/updates/UpdateManager.java", "diffHunk": "@@ -0,0 +1,92 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.tycho.updates;\n+\n+import sirius.biz.analytics.flags.ExecutionFlags;\n+import sirius.kernel.commons.Limit;\n+import sirius.kernel.di.std.Part;\n+import sirius.kernel.di.std.Register;\n+import sirius.kernel.xml.StructuredNode;\n+import sirius.kernel.xml.XMLCall;\n+\n+import javax.xml.xpath.XPathExpressionException;\n+import java.io.IOException;\n+import java.net.URL;\n+import java.time.LocalDateTime;\n+import java.time.Period;\n+import java.time.format.DateTimeFormatter;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Optional;\n+\n+@Register(classes = UpdateManager.class)\n+public class UpdateManager {\n+\n+    @Part\n+    private ExecutionFlags executionFlags;\n+\n+    private List<UpdateInfo> updates = Collections.emptyList();\n+    private LocalDateTime lastFetch;\n+\n+    public boolean hasUpdates(String reference) {\n+        if (getUpdates().isEmpty()) {\n+            return false;\n+        }\n+\n+        Optional<LocalDateTime> lastView = executionFlags.readExecutionFlag(reference, \"updates-last-view\");\n+        if (!lastView.isPresent()) {\n+            return true;\n+        }\n+\n+        LocalDateTime limit = LocalDateTime.now().minusMonths(3);\n+\n+        return getUpdates().stream()\n+                           .filter(update -> update.getTimestamp().isAfter(limit))\n+                           .findFirst()\n+                           .filter(update -> update.getTimestamp().isAfter(lastView.get()))\n+                           .isPresent();\n+    }\n+\n+    public List<UpdateInfo> getUpdates() {\n+        LocalDateTime limit = LocalDateTime.now().minusDays(1);\n+        if (lastFetch == null || lastFetch.isBefore(limit)) {\n+            fetchUpdates();\n+        }\n+\n+        return Collections.unmodifiableList(updates);\n+    }\n+\n+    private void fetchUpdates() {\n+        try {\n+            Limit limit = new Limit(0, 5);\n+            List<UpdateInfo> nextUpdates = new ArrayList<>();\n+            XMLCall call = XMLCall.to(new URL(\"https://blog.scireum.de/feed\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86756d99f63fed8259ae22e9c186d7fa2662a975"}, "originalPosition": 70}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwNjkxNjE0OnYy", "diffSide": "RIGHT", "path": "src/main/java/sirius/biz/tycho/updates/UpdatesController.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMDoyMDozMFrOHoJCtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMDoyMDozMFrOHoJCtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg1MzIzNg==", "bodyText": "Whats this?", "url": "https://github.com/scireum/sirius-biz/pull/886#discussion_r511853236", "createdAt": "2020-10-26T10:20:30Z", "author": {"login": "sabieber"}, "path": "src/main/java/sirius/biz/tycho/updates/UpdatesController.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.tycho.updates;\n+\n+import sirius.biz.web.BizController;\n+import sirius.kernel.di.std.Part;\n+import sirius.kernel.di.std.Register;\n+import sirius.tagliatelle.Tagliatelle;\n+import sirius.tagliatelle.compiler.CompileException;\n+import sirius.web.controller.Controller;\n+import sirius.web.controller.Routed;\n+import sirius.web.http.WebContext;\n+import sirius.web.services.JSONStructuredOutput;\n+\n+@Register(classes = Controller.class)\n+public class UpdatesController extends BizController {\n+\n+    @Part\n+    private UpdateManager updateManager;\n+\n+@Part\n+private Tagliatelle tagliatelle;\n+\n+    @Routed(value = \"/tycho/updates\", jsonCall = true)\n+    public void checkForUpdates(WebContext webContext, JSONStructuredOutput output) throws CompileException {\n+        tagliatelle.resolve(\"/kb/IKGVF.html.pasta\").get().getPragma(\"tag\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86756d99f63fed8259ae22e9c186d7fa2662a975"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDIxNjY0MjkwOnYy", "diffSide": "RIGHT", "path": "src/main/resources/component-biz.conf", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNy0wNVQwNjo1Mjo1MlrOJ470uA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNy0wNVQwNjo1Mjo1MlrOJ470uA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MzY4MDE4NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                # Specifies the ATOM feed to fethc news from\n          \n          \n            \n                # Specifies the ATOM feed to fetch news from", "url": "https://github.com/scireum/sirius-biz/pull/886#discussion_r663680184", "createdAt": "2021-07-05T06:52:52Z", "author": {"login": "sabieber"}, "path": "src/main/resources/component-biz.conf", "diffHunk": "@@ -1592,6 +1593,21 @@ redis {\n     }\n }\n \n+# Configures the feed from which updates / news for the Tycho UI are loaded.\n+tycho.updates {\n+\n+    # Specifies the ATOM feed to fethc news from", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "358c85babc6ace2ae0d594af3dad1f2d9c6beeff"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1808, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}