{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4MzU4Njgz", "number": 836, "title": "BREAKING: Only loads fields from requests when matching param is given", "bodyText": "We dont want to reset a field to null when no parameter is given in the request that matches the field.\nWe also use get instead of getParameters here as it takes the WebContext::attributes into account which allows to semi-inject parameters before loading (e.g. for providing a default value when no parameter is given).\nFixes: OX-6055", "createdAt": "2020-07-29T10:55:09Z", "url": "https://github.com/scireum/sirius-biz/pull/836", "merged": true, "mergeCommit": {"oid": "3d7484e7f6286ce1616bb2e1c52d4e56f63e72d1"}, "closed": true, "closedAt": "2020-07-29T14:44:46Z", "author": {"login": "sabieber"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5oxULAH2gAyNDU4MzU4NjgzOjM3YzYwODZkYjYzOGMwNTE1NmQ0YjFjZjk5OWY0NTNjMjM5OTlmZjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5sH_bgFqTQ1NzU5NTEwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "37c6086db638c05156d4b1cf999f453c23999ff1", "author": {"user": {"login": "sabieber", "name": "Sascha Bieberstein"}}, "url": "https://github.com/scireum/sirius-biz/commit/37c6086db638c05156d4b1cf999f453c23999ff1", "committedDate": "2020-07-29T10:49:50Z", "message": "Only loads fields from requests when matching param is given\n\nWe dont want to reset a field to null when no parameter is given in the request that matches the field.\nWe also use `get` instead of `getParameters` here as it takes the `WebContext::attributes` into account which allows to semi-inject parameters before loading (e.g. for providing a default value when no parameter is given).\n\nFixes: OX-6055"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76f5953936aede3bdb2077f4bacb78762c6e0846", "author": {"user": {"login": "sabieber", "name": "Sascha Bieberstein"}}, "url": "https://github.com/scireum/sirius-biz/commit/76f5953936aede3bdb2077f4bacb78762c6e0846", "committedDate": "2020-07-29T10:54:13Z", "message": "Codestyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NDEzOTcw", "url": "https://github.com/scireum/sirius-biz/pull/836#pullrequestreview-457413970", "createdAt": "2020-07-29T11:00:06Z", "commit": {"oid": "76f5953936aede3bdb2077f4bacb78762c6e0846"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NDI0Mzcz", "url": "https://github.com/scireum/sirius-biz/pull/836#pullrequestreview-457424373", "createdAt": "2020-07-29T11:17:33Z", "commit": {"oid": "76f5953936aede3bdb2077f4bacb78762c6e0846"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NDMzMDM0", "url": "https://github.com/scireum/sirius-biz/pull/836#pullrequestreview-457433034", "createdAt": "2020-07-29T11:31:31Z", "commit": {"oid": "37c6086db638c05156d4b1cf999f453c23999ff1"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMTozMTozMlrOG40Tzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMTo0MToyN1rOG40mEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjIzMDQ3OQ==", "bodyText": "this comment makes more sense inside right before or inside the if", "url": "https://github.com/scireum/sirius-biz/pull/836#discussion_r462230479", "createdAt": "2020-07-29T11:31:32Z", "author": {"login": "meg1502"}, "path": "src/main/java/sirius/biz/web/BizController.java", "diffHunk": "@@ -256,11 +257,19 @@ protected void load(WebContext ctx, BaseEntity<?> entity, List<Mapping> properti\n             Property property = entity.getDescriptor().getProperty(columnProperty);\n             String propertyName = property.getName();\n \n+            // If the parameter is not present in the request we just skip it to prevent resetting the field to null", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37c6086db638c05156d4b1cf999f453c23999ff1"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjIzNTE1Mw==", "bodyText": "this looks weird, maybe long term we should look at properties only parsing a Value and the properties that actually support multiple values to look for a list inside of the value", "url": "https://github.com/scireum/sirius-biz/pull/836#discussion_r462235153", "createdAt": "2020-07-29T11:41:27Z", "author": {"login": "meg1502"}, "path": "src/main/java/sirius/biz/web/BizController.java", "diffHunk": "@@ -256,11 +257,19 @@ protected void load(WebContext ctx, BaseEntity<?> entity, List<Mapping> properti\n             Property property = entity.getDescriptor().getProperty(columnProperty);\n             String propertyName = property.getName();\n \n+            // If the parameter is not present in the request we just skip it to prevent resetting the field to null\n+            final Value parameterValue = ctx.get(propertyName);\n+            if (parameterValue.isNull()) {\n+                continue;\n+            }\n+\n             try {\n-                property.parseValues(entity, Values.of(ctx.getParameters(propertyName)));\n+                property.parseValues(entity,\n+                                     Values.of(parameterValue.get(List.class,\n+                                                                  Collections.singletonList(parameterValue.get()))));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37c6086db638c05156d4b1cf999f453c23999ff1"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NDM5OTUy", "url": "https://github.com/scireum/sirius-biz/pull/836#pullrequestreview-457439952", "createdAt": "2020-07-29T11:42:04Z", "commit": {"oid": "76f5953936aede3bdb2077f4bacb78762c6e0846"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3bf18b463d533610c70350a4114efb3f1d6d7eab", "author": {"user": {"login": "sabieber", "name": "Sascha Bieberstein"}}, "url": "https://github.com/scireum/sirius-biz/commit/3bf18b463d533610c70350a4114efb3f1d6d7eab", "committedDate": "2020-07-29T11:47:58Z", "message": "Codestyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NDk1NTQx", "url": "https://github.com/scireum/sirius-biz/pull/836#pullrequestreview-457495541", "createdAt": "2020-07-29T13:00:17Z", "commit": {"oid": "3bf18b463d533610c70350a4114efb3f1d6d7eab"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NTcyNzYy", "url": "https://github.com/scireum/sirius-biz/pull/836#pullrequestreview-457572762", "createdAt": "2020-07-29T14:22:24Z", "commit": {"oid": "3bf18b463d533610c70350a4114efb3f1d6d7eab"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxNDoyMjoyNFrOG464jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxNDoyMjoyNFrOG464jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjMzODE5MQ==", "bodyText": "couldn't this be handled via a stream + filter or a sub method + return?", "url": "https://github.com/scireum/sirius-biz/pull/836#discussion_r462338191", "createdAt": "2020-07-29T14:22:24Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/web/BizController.java", "diffHunk": "@@ -222,46 +221,54 @@ public static String getBaseUrl() {\n     /**\n      * Fetches all <tt>autoloaded</tt> fields of the given entity from the given request and populates the entity.\n      *\n-     * @param ctx    the request to read parameters from\n-     * @param entity the entity to fill\n+     * @param webContext the request to read parameters from\n+     * @param entity     the entity to fill\n      * @see Autoloaded\n      */\n-    protected void load(WebContext ctx, BaseEntity<?> entity) {\n+    protected void load(WebContext webContext, BaseEntity<?> entity) {\n         List<Mapping> columns = entity.getDescriptor()\n                                       .getProperties()\n                                       .stream()\n-                                      .filter(property -> shouldAutoload(ctx, property))\n+                                      .filter(property -> shouldAutoload(webContext, property))\n                                       .map(Property::getName)\n                                       .map(Mapping::named)\n                                       .collect(Collectors.toList());\n \n-        load(ctx, entity, columns);\n+        load(webContext, entity, columns);\n     }\n \n     /**\n      * Reads the given properties from the given request and populates the given entity.\n      *\n-     * @param ctx        the request to read parameters from\n+     * @param webContext the request to read parameters from\n      * @param entity     the entity to fill\n      * @param properties the list of properties to transfer\n      */\n-    protected void load(WebContext ctx, BaseEntity<?> entity, Mapping... properties) {\n-        load(ctx, entity, Arrays.asList(properties));\n+    protected void load(WebContext webContext, BaseEntity<?> entity, Mapping... properties) {\n+        load(webContext, entity, Arrays.asList(properties));\n     }\n \n-    protected void load(WebContext ctx, BaseEntity<?> entity, List<Mapping> properties) {\n+    protected void load(WebContext webContext, BaseEntity<?> entity, List<Mapping> properties) {\n         boolean hasError = false;\n \n         for (Mapping columnProperty : properties) {\n             Property property = entity.getDescriptor().getProperty(columnProperty);\n             String propertyName = property.getName();\n \n+            final Value parameterValue = webContext.get(propertyName);\n+            if (parameterValue.isNull()) {\n+                // If the parameter is not present in the request we just skip it to prevent resetting the field to null\n+                continue;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3bf18b463d533610c70350a4114efb3f1d6d7eab"}, "originalPosition": 91}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NTc0MDI3", "url": "https://github.com/scireum/sirius-biz/pull/836#pullrequestreview-457574027", "createdAt": "2020-07-29T14:23:40Z", "commit": {"oid": "3bf18b463d533610c70350a4114efb3f1d6d7eab"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0e93cf5626f0d52fd02f21ea7c8024a95cc4607", "author": {"user": {"login": "sabieber", "name": "Sascha Bieberstein"}}, "url": "https://github.com/scireum/sirius-biz/commit/a0e93cf5626f0d52fd02f21ea7c8024a95cc4607", "committedDate": "2020-07-29T14:34:12Z", "message": "Extracts method for better readability"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NTkxNzE4", "url": "https://github.com/scireum/sirius-biz/pull/836#pullrequestreview-457591718", "createdAt": "2020-07-29T14:41:00Z", "commit": {"oid": "a0e93cf5626f0d52fd02f21ea7c8024a95cc4607"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxNDo0MTowMFrOG47yLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxNDo0MTowMFrOG47yLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjM1Mjk0Mw==", "bodyText": "maybe invert here so that true = success and false = failure?", "url": "https://github.com/scireum/sirius-biz/pull/836#discussion_r462352943", "createdAt": "2020-07-29T14:41:00Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/web/BizController.java", "diffHunk": "@@ -272,6 +264,28 @@ protected void load(WebContext ctx, BaseEntity<?> entity, List<Mapping> properti\n         }\n     }\n \n+    private boolean tryLoadProperty(WebContext webContext, BaseEntity<?> entity, Property property) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a0e93cf5626f0d52fd02f21ea7c8024a95cc4607"}, "originalPosition": 103}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72242c53f1869c8eb0e6287ce020c110b5f87c59", "author": {"user": {"login": "sabieber", "name": "Sascha Bieberstein"}}, "url": "https://github.com/scireum/sirius-biz/commit/72242c53f1869c8eb0e6287ce020c110b5f87c59", "committedDate": "2020-07-29T14:43:30Z", "message": "Codestyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NTk1MTA1", "url": "https://github.com/scireum/sirius-biz/pull/836#pullrequestreview-457595105", "createdAt": "2020-07-29T14:44:19Z", "commit": {"oid": "72242c53f1869c8eb0e6287ce020c110b5f87c59"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4397, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}