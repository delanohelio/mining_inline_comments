{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0MDU1MTY0", "number": 664, "title": "Allows for a BooleanParameter to be nullable/optional", "bodyText": "There are cases where we need to know if the parameter is selected at all and not always default to false.\nDefault value is false unless markNullable is used.\nFixes: OX-5522", "createdAt": "2020-01-17T09:47:07Z", "url": "https://github.com/scireum/sirius-biz/pull/664", "merged": true, "mergeCommit": {"oid": "e89679a22c5e84e5418c9a77bee4a44e2d0e8890"}, "closed": true, "closedAt": "2020-01-17T10:45:43Z", "author": {"login": "idlira"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb7LljVAH2gAyMzY0MDU1MTY0OmRmZTYwZjQwZGFlZjM2YzRhOTAwMzQxYzBhOTE1N2JmNGJkYmM2ZTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb7MYo3AFqTM0NDQ5NTU2NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dfe60f40daef36c4a900341c0a9157bf4bdbc6e5", "author": {"user": {"login": "idlira", "name": "Idevaldo De Lira"}}, "url": "https://github.com/scireum/sirius-biz/commit/dfe60f40daef36c4a900341c0a9157bf4bdbc6e5", "committedDate": "2020-01-17T09:46:26Z", "message": "Allows for a BooleanParameter to be nullable/optional\n\nThere are cases where we need to know if the parameter is selected at all and not always default to false.\nDefault value is false unless markNullable is used.\n\nFixes: OX-5522"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0NDY1MDI2", "url": "https://github.com/scireum/sirius-biz/pull/664#pullrequestreview-344465026", "createdAt": "2020-01-17T09:48:22Z", "commit": {"oid": "dfe60f40daef36c4a900341c0a9157bf4bdbc6e5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0NDcwNTc0", "url": "https://github.com/scireum/sirius-biz/pull/664#pullrequestreview-344470574", "createdAt": "2020-01-17T09:57:31Z", "commit": {"oid": "dfe60f40daef36c4a900341c0a9157bf4bdbc6e5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QwOTo1NzozMVrOFez_tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QxMDowNTozNlrOFe0Now==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg1MzQ5NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            \"A boolean parameter must not be marked as required as it is inherently so. Use markNullable() to make the parameter optional\");\n          \n          \n            \n                            \"A boolean parameter must not be marked as required as it is inherently so. Use markNullable() to make the parameter optional.\");", "url": "https://github.com/scireum/sirius-biz/pull/664#discussion_r367853495", "createdAt": "2020-01-17T09:57:31Z", "author": {"login": "meg1502"}, "path": "src/main/java/sirius/biz/jobs/params/BooleanParameter.java", "diffHunk": "@@ -47,18 +50,41 @@ protected String checkAndTransformValue(Value input) {\n         if (isRequired() && !input.asBoolean()) {\n             return null;\n         }\n-\n+        if (nullable && !resolveFromString(input).isPresent()) {\n+            return null;\n+        }\n         return NLS.toMachineString(input.asBoolean());\n     }\n \n+    /**\n+     * Marks the parameter as boolean.\n+     * <p>\n+     * This allows for a tri-state boolean where a job parameter can also receive\n+     * {@code null} when a value is not selected instead of being defaulted to false.\n+     *\n+     * @return the parameter itself for fluent method calls\n+     */\n+    public BooleanParameter markNullable() {\n+        this.nullable = true;\n+        return self();\n+    }\n+\n     @Override\n     public BooleanParameter markRequired() {\n         throw new UnsupportedOperationException(\n-                \"A boolean parameter must not be marked as required as it is inherently so!\");\n+                \"A boolean parameter must not be marked as required as it is inherently so. Use markNullable() to make the parameter optional\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfe60f40daef36c4a900341c0a9157bf4bdbc6e5"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg1NzA1OQ==", "bodyText": "this does not match the parsing of input.asBoolean which is used when the parameter is required, as $NLS.yes is also considerd as true (and $NLS.no as false)\n->\nif the parameter is required i will get true for \"yes\"\nif the parameter is nullable i will get null for \"yes\"", "url": "https://github.com/scireum/sirius-biz/pull/664#discussion_r367857059", "createdAt": "2020-01-17T10:05:36Z", "author": {"login": "meg1502"}, "path": "src/main/java/sirius/biz/jobs/params/BooleanParameter.java", "diffHunk": "@@ -47,18 +50,41 @@ protected String checkAndTransformValue(Value input) {\n         if (isRequired() && !input.asBoolean()) {\n             return null;\n         }\n-\n+        if (nullable && !resolveFromString(input).isPresent()) {\n+            return null;\n+        }\n         return NLS.toMachineString(input.asBoolean());\n     }\n \n+    /**\n+     * Marks the parameter as boolean.\n+     * <p>\n+     * This allows for a tri-state boolean where a job parameter can also receive\n+     * {@code null} when a value is not selected instead of being defaulted to false.\n+     *\n+     * @return the parameter itself for fluent method calls\n+     */\n+    public BooleanParameter markNullable() {\n+        this.nullable = true;\n+        return self();\n+    }\n+\n     @Override\n     public BooleanParameter markRequired() {\n         throw new UnsupportedOperationException(\n-                \"A boolean parameter must not be marked as required as it is inherently so!\");\n+                \"A boolean parameter must not be marked as required as it is inherently so. Use markNullable() to make the parameter optional\");\n     }\n \n     @Override\n-    protected Optional<Boolean> resolveFromString(Value input) {\n+    public boolean isRequired() {\n+        return !nullable;\n+    }\n+\n+    @Override\n+    protected Optional<Boolean> resolveFromString(@Nonnull Value input) {\n+        if (nullable && !(\"true\".equalsIgnoreCase(input.asString()) || \"false\".equalsIgnoreCase(input.asString()))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfe60f40daef36c4a900341c0a9157bf4bdbc6e5"}, "originalPosition": 56}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6730a9ec67f2c2a18c70d68d9e501e0d528155ea", "author": {"user": {"login": "idlira", "name": "Idevaldo De Lira"}}, "url": "https://github.com/scireum/sirius-biz/commit/6730a9ec67f2c2a18c70d68d9e501e0d528155ea", "committedDate": "2020-01-17T10:10:12Z", "message": "Typo\n\nCo-Authored-By: meg1502 <meg@scireum.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13fa64260f1f8bbcaafd3956d861eeb91db282db", "author": {"user": {"login": "idlira", "name": "Idevaldo De Lira"}}, "url": "https://github.com/scireum/sirius-biz/commit/13fa64260f1f8bbcaafd3956d861eeb91db282db", "committedDate": "2020-01-17T10:27:04Z", "message": "Returns optional only when the value is not filled\n\nThis way it behaves the same as in the non-nullable case.\nStrings such as yes, no will still be evaluated as boolean.\nForeign strings will be evaluated as false."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0NDg4MTg4", "url": "https://github.com/scireum/sirius-biz/pull/664#pullrequestreview-344488188", "createdAt": "2020-01-17T10:28:54Z", "commit": {"oid": "13fa64260f1f8bbcaafd3956d861eeb91db282db"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0NDk1NTY1", "url": "https://github.com/scireum/sirius-biz/pull/664#pullrequestreview-344495565", "createdAt": "2020-01-17T10:42:14Z", "commit": {"oid": "13fa64260f1f8bbcaafd3956d861eeb91db282db"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4492, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}