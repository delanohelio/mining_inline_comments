{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1NTAwODgy", "number": 817, "title": "Fix an issue creating files in the storage", "bodyText": "The findOrCreateByPath method was skipping the file creation if a previous find was issued which did not find any file (leaving the cache with null for the desired key).\nThis caused subsequent calls to the cache to deliver null instead of try calling the ValueComputer in order to create a new file.\nFixes: OX-5973", "createdAt": "2020-07-07T15:48:46Z", "url": "https://github.com/scireum/sirius-biz/pull/817", "merged": true, "mergeCommit": {"oid": "8ecaecec2db0702d2f47c4fe7e996f1f27928d36"}, "closed": true, "closedAt": "2020-07-08T09:13:19Z", "author": {"login": "idlira"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcynz8oAH2gAyNDQ1NTAwODgyOjRhZGQzMTA1N2QyMzlmNzhiM2FhYjRjOTFkMGM5N2NjZDdiYTk4NDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcy2zNNAFqTQ0NDU1NzkxMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4add31057d239f78b3aab4c91d0c97ccd7ba9847", "author": {"user": {"login": "idlira", "name": "Idevaldo De Lira"}}, "url": "https://github.com/scireum/sirius-biz/commit/4add31057d239f78b3aab4c91d0c97ccd7ba9847", "committedDate": "2020-07-07T15:45:20Z", "message": "Fix an issue creating files in the storage\n\nThe find or create method was skipping the file creation if a previous find was issue which did not find any file (leaving the cache with null for the desired key).\n\nThis caused subsequent calls to the cache to deliver null instead of forcedly call the valuecomputer in order to create a new file.\n\nFixes: OX-5973"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0c3a9e3992336aa1479b6f18b934f44a0232b61", "author": {"user": {"login": "idlira", "name": "Idevaldo De Lira"}}, "url": "https://github.com/scireum/sirius-biz/commit/f0c3a9e3992336aa1479b6f18b934f44a0232b61", "committedDate": "2020-07-07T15:48:24Z", "message": "Fix a variable usage\n\nFixes: OX-5973"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MDI1MzA1", "url": "https://github.com/scireum/sirius-biz/pull/817#pullrequestreview-444025305", "createdAt": "2020-07-07T15:50:30Z", "commit": {"oid": "f0c3a9e3992336aa1479b6f18b934f44a0232b61"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MDI1OTM3", "url": "https://github.com/scireum/sirius-biz/pull/817#pullrequestreview-444025937", "createdAt": "2020-07-07T15:51:11Z", "commit": {"oid": "f0c3a9e3992336aa1479b6f18b934f44a0232b61"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNTo1MToxMVrOGuE6tg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNTo1MToxMVrOGuE6tg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk2ODI0Ng==", "bodyText": "why not\n Blob blob = fetchOrCreateByPath(tenantId, path);\nblobByPathCache.put(key, blob);", "url": "https://github.com/scireum/sirius-biz/pull/817#discussion_r450968246", "createdAt": "2020-07-07T15:51:11Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/storage/layer2/BasicBlobStorageSpace.java", "diffHunk": "@@ -373,8 +373,13 @@ public Blob findOrCreateByPath(String tenantId, String path) {\n             throw new IllegalArgumentException(\"An empty path was provided!\");\n         }\n \n-        return blobByPathCache.get(determinePathCacheKey(tenantId, path),\n-                                   ignored -> fetchOrCreateByPath(tenantId, path));\n+        String key = determinePathCacheKey(tenantId, path);\n+        Blob blob = blobByPathCache.get(key);\n+        if (blob == null) {\n+            blobByPathCache.remove(key);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0c3a9e3992336aa1479b6f18b934f44a0232b61"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MDI2MTAz", "url": "https://github.com/scireum/sirius-biz/pull/817#pullrequestreview-444026103", "createdAt": "2020-07-07T15:51:23Z", "commit": {"oid": "f0c3a9e3992336aa1479b6f18b934f44a0232b61"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0NDE4NjM0", "url": "https://github.com/scireum/sirius-biz/pull/817#pullrequestreview-444418634", "createdAt": "2020-07-08T05:15:36Z", "commit": {"oid": "f0c3a9e3992336aa1479b6f18b934f44a0232b61"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0NDY3ODYx", "url": "https://github.com/scireum/sirius-biz/pull/817#pullrequestreview-444467861", "createdAt": "2020-07-08T07:10:45Z", "commit": {"oid": "f0c3a9e3992336aa1479b6f18b934f44a0232b61"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0NTU3OTEw", "url": "https://github.com/scireum/sirius-biz/pull/817#pullrequestreview-444557910", "createdAt": "2020-07-08T09:13:06Z", "commit": {"oid": "f0c3a9e3992336aa1479b6f18b934f44a0232b61"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4370, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}