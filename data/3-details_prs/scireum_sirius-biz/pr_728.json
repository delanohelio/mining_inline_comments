{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3MTMwNjcw", "number": 728, "title": "Updates the tokenizer settings for SearchableEntity and PrefixSearchableEntity", "bodyText": "The searchField only contains tokenized data solely for the purpose\nof index lookups. There is no benefit of storing or retrieving this\ndata in either an ES field or the _source itself.\nHowever, this is a breaking change, as this leads to a re-index\nfor subclasses of this entity.", "createdAt": "2020-04-22T08:27:11Z", "url": "https://github.com/scireum/sirius-biz/pull/728", "merged": true, "mergeCommit": {"oid": "0668d962cddc535a2eaf75f34f26410315de50bc"}, "closed": true, "closedAt": "2020-06-09T11:02:16Z", "author": {"login": "andyHa"}, "timelineItems": {"totalCount": 30, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcaD-CBgH2gAyNDA3MTMwNjcwOmRjZDgzOTA5YTJkOTIyMTIzYWNhYzg4NjAyNTVjNWZhZTM2MThiYjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcphaY0AFqTQyNjk0NDEyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dcd83909a2d922123acac8860255c5fae3618bb9", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/dcd83909a2d922123acac8860255c5fae3618bb9", "committedDate": "2020-04-22T08:25:35Z", "message": "BREAKING CHANGE: Changes the index settings for SearchableEntities.\n\nThe searchField only contains tokenized data solely for the purpose\nof index lookups. There is no benefit of storing or retrieving this\ndata in either an ES field or the _source itself.\n\nHowever, this is a breaking change, as this leads to a re-index\nfor subclasses of this entity."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3OTY1NDc0", "url": "https://github.com/scireum/sirius-biz/pull/728#pullrequestreview-397965474", "createdAt": "2020-04-22T08:35:16Z", "commit": {"oid": "dcd83909a2d922123acac8860255c5fae3618bb9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3OTcxMjM5", "url": "https://github.com/scireum/sirius-biz/pull/728#pullrequestreview-397971239", "createdAt": "2020-04-22T08:42:26Z", "commit": {"oid": "dcd83909a2d922123acac8860255c5fae3618bb9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4MTAzMDE2", "url": "https://github.com/scireum/sirius-biz/pull/728#pullrequestreview-398103016", "createdAt": "2020-04-22T11:39:25Z", "commit": {"oid": "dcd83909a2d922123acac8860255c5fae3618bb9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwODc3Njk3", "url": "https://github.com/scireum/sirius-biz/pull/728#pullrequestreview-410877697", "createdAt": "2020-05-13T12:35:54Z", "commit": {"oid": "dcd83909a2d922123acac8860255c5fae3618bb9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1MTA4ODU2", "url": "https://github.com/scireum/sirius-biz/pull/728#pullrequestreview-415108856", "createdAt": "2020-05-20T08:32:59Z", "commit": {"oid": "dcd83909a2d922123acac8860255c5fae3618bb9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ff114db7c5e0cb7cbd3d1bb71196e08ef35eeab", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/6ff114db7c5e0cb7cbd3d1bb71196e08ef35eeab", "committedDate": "2020-06-02T17:22:46Z", "message": "Merge remote-tracking branch 'origin/master' into aha/make-searchable-entities-great-again"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87ef11ae9b9e60b1021c622b5ae3004d83a8741a", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/87ef11ae9b9e60b1021c622b5ae3004d83a8741a", "committedDate": "2020-06-02T21:04:53Z", "message": "Uses the new tokenization framework for SearchableEntities."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ece5b3a7fe84b210a8204450ba0414805b762db", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/3ece5b3a7fe84b210a8204450ba0414805b762db", "committedDate": "2020-06-02T21:06:50Z", "message": "Adds a remark which encourages the user to fill storage.sharedSecret.\n\nWe also now prevent a startup warning in case it is not filled\n(as the framework might be unused). If required, the framework\nwill emit an appropriate warning itself."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "334f1181c5dfb8c15cfb7bb8794954686ce1de29", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/334f1181c5dfb8c15cfb7bb8794954686ce1de29", "committedDate": "2020-06-02T21:07:46Z", "message": " Uses the new tokenizer framework for PrefixSearchableEntities."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMjc0MDg5", "url": "https://github.com/scireum/sirius-biz/pull/728#pullrequestreview-423274089", "createdAt": "2020-06-03T07:09:35Z", "commit": {"oid": "334f1181c5dfb8c15cfb7bb8794954686ce1de29"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QwNzowOTozNVrOGeOzJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QwNzowOTozNVrOGeOzJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDM1MjkzNA==", "bodyText": "W\u00e4rs ned vllt sauberer wenn man da nen Consumer f\u00fcr Strings bekommt, der dann automatisch den Tokenizer daf\u00fcr aufruft? Also einfach damit man ned selbst addContentAsTokens aufrufen muss und vor allem keinen Pfusch mit dem Tokenizer machen kann", "url": "https://github.com/scireum/sirius-biz/pull/728#discussion_r434352934", "createdAt": "2020-06-03T07:09:35Z", "author": {"login": "sabieber"}, "path": "src/main/java/sirius/biz/mongo/PrefixSearchableEntity.java", "diffHunk": "@@ -66,51 +49,52 @@ protected void updateSearchField() {\n \n         getSearchPrefixes().clear();\n \n+        Tokenizer tokenizer = createPrefixTokenizer();\n         this.getDescriptor()\n             .getProperties()\n             .stream()\n             .filter(p -> p.getAnnotation(PrefixSearchContent.class).isPresent())\n             .map(p -> p.tryAs(PrefixSearchableContentConsumer.class).orElse((entity, consumer) -> {\n                 consumer.accept(p.getValue(this));\n             }))\n-            .forEach(consumer -> consumer.accept(this, this::addContentAsTokens));\n+            .forEach(consumer -> consumer.accept(this, value -> addContentAsTokens(tokenizer, value)));\n+\n+        addCustomSearchPrefixes(tokenizer);\n+    }\n+\n+    /**\n+     * Adds custom fields as search prefixes.\n+     * <p>\n+     * This method is empty by default and intended to be overwritten by sub classes.\n+     */\n+    protected void addCustomSearchPrefixes(Tokenizer tokenizer) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "334f1181c5dfb8c15cfb7bb8794954686ce1de29"}, "originalPosition": 62}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db2ae02c77304c688c9f5ed3348fdee573028567", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/db2ae02c77304c688c9f5ed3348fdee573028567", "committedDate": "2020-06-03T08:15:42Z", "message": "Simplifies the API used to provide custom search prefixes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMzIzMTUw", "url": "https://github.com/scireum/sirius-biz/pull/728#pullrequestreview-423323150", "createdAt": "2020-06-03T08:19:13Z", "commit": {"oid": "db2ae02c77304c688c9f5ed3348fdee573028567"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzNDY3MDA3", "url": "https://github.com/scireum/sirius-biz/pull/728#pullrequestreview-423467007", "createdAt": "2020-06-03T11:39:30Z", "commit": {"oid": "db2ae02c77304c688c9f5ed3348fdee573028567"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0beb069a23a833edba7d0b3dbb99ad02f2a42f94", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/0beb069a23a833edba7d0b3dbb99ad02f2a42f94", "committedDate": "2020-06-05T07:02:11Z", "message": "Updates to the simpler API of the Tokenizer."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70004ea9f39aad5cdc4998e6b64dfc27689732d4", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/70004ea9f39aad5cdc4998e6b64dfc27689732d4", "committedDate": "2020-06-05T07:04:56Z", "message": "Keeps the search contents in the _source field.\n\nOtherwise we'd had to re-tokenized the data\nin every update, which isn't guaranteed by the\nframework.\n\nTherefore this would open up a bunch of dataloss\nproblems when using this entity in certain circumstances.\nAlso, loading the field isn't that expensive anyway as it should\nbe quite small for most entities."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "472a28a8fabc9dccfad7a92ae1bdf50103f36601", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/472a28a8fabc9dccfad7a92ae1bdf50103f36601", "committedDate": "2020-06-05T07:05:11Z", "message": "Updates to the latest sirius-kernel."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebcd9c596c3f984b46ce981817c811ad5c244170", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/ebcd9c596c3f984b46ce981817c811ad5c244170", "committedDate": "2020-06-05T07:05:20Z", "message": "Merge remote-tracking branch 'origin/master' into aha/make-searchable-entities-great-again"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da3b5ffd1e595fbbd2676d3381b5abae7f79e16a", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/da3b5ffd1e595fbbd2676d3381b5abae7f79e16a", "committedDate": "2020-06-05T07:07:43Z", "message": "Uses the proper ToLowercaseProcessor and adds a JavaDoc."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c05b740e90bbe09ae0c0aae7fee34874fa94cea", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/6c05b740e90bbe09ae0c0aae7fee34874fa94cea", "committedDate": "2020-06-05T07:30:13Z", "message": "Adapts to the new API of Tokenizer in sirius-db."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d39995164388ecc4c138e4a325a805865e743dca", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/d39995164388ecc4c138e4a325a805865e743dca", "committedDate": "2020-06-05T07:29:23Z", "message": "Adapts to the new API of Tokenierz in sirius-db."}, "afterCommit": {"oid": "6c05b740e90bbe09ae0c0aae7fee34874fa94cea", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/6c05b740e90bbe09ae0c0aae7fee34874fa94cea", "committedDate": "2020-06-05T07:30:13Z", "message": "Adapts to the new API of Tokenizer in sirius-db."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51bd1a8d2925fc812e6c0c80571ef2c485170118", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/51bd1a8d2925fc812e6c0c80571ef2c485170118", "committedDate": "2020-06-09T07:58:29Z", "message": "Removes Controller from all @Registers."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7cc4e64d619f4bff23f6f0f69c11c0ae53549b4a", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/7cc4e64d619f4bff23f6f0f69c11c0ae53549b4a", "committedDate": "2020-06-09T07:58:41Z", "message": "Merge remote-tracking branch 'origin/master' into aha/make-searchable-entities-great-again"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c285c8febd1555666d8d040d71c8b92a8f531a4f", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/c285c8febd1555666d8d040d71c8b92a8f531a4f", "committedDate": "2020-06-09T08:20:04Z", "message": "Improves imports and fixes sonarlint inspections."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2OTA2NzEy", "url": "https://github.com/scireum/sirius-biz/pull/728#pullrequestreview-426906712", "createdAt": "2020-06-09T08:31:37Z", "commit": {"oid": "c285c8febd1555666d8d040d71c8b92a8f531a4f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2OTA4Njg4", "url": "https://github.com/scireum/sirius-biz/pull/728#pullrequestreview-426908688", "createdAt": "2020-06-09T08:33:58Z", "commit": {"oid": "c285c8febd1555666d8d040d71c8b92a8f531a4f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9044a21749b3011d0a458963928c83e52222951a", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/9044a21749b3011d0a458963928c83e52222951a", "committedDate": "2020-06-09T08:43:16Z", "message": "Updates to the latest sirius dependencies."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "949b80dc122ed7b836b0e7ef91eeb008001d0041", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/949b80dc122ed7b836b0e7ef91eeb008001d0041", "committedDate": "2020-06-09T09:06:30Z", "message": "Removes prematurely committed code."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2OTQzNDM1", "url": "https://github.com/scireum/sirius-biz/pull/728#pullrequestreview-426943435", "createdAt": "2020-06-09T09:12:14Z", "commit": {"oid": "949b80dc122ed7b836b0e7ef91eeb008001d0041"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2OTQ0MTIz", "url": "https://github.com/scireum/sirius-biz/pull/728#pullrequestreview-426944123", "createdAt": "2020-06-09T09:12:40Z", "commit": {"oid": "949b80dc122ed7b836b0e7ef91eeb008001d0041"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4455, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}