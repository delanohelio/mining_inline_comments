{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxOTY3OTgz", "number": 760, "title": "Updates regarting ImportHandlers and ImportJobs.", "bodyText": "", "createdAt": "2020-05-22T14:59:11Z", "url": "https://github.com/scireum/sirius-biz/pull/760", "merged": true, "mergeCommit": {"oid": "91b67c4913e859a2070b5e8badfcbe0d59e644cc"}, "closed": true, "closedAt": "2020-05-25T06:12:53Z", "author": {"login": "andyHa"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjzIFMgH2gAyNDIxOTY3OTgzOjliZmIyMzMwNzI3ODdiZjkyZjQ4NGUzOTdiNTAyZTZkZmFkNjEwMTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABckp2JCAFqTQxNzQ3NjE1OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9bfb233072787bf92f484e397b502e6dfad61011", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/9bfb233072787bf92f484e397b502e6dfad61011", "committedDate": "2020-05-22T14:27:25Z", "message": "Updates to the latest sirius dependencies."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bad78307e0c5acc44c1e804ce1a98e667e9cf3ea", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/bad78307e0c5acc44c1e804ce1a98e667e9cf3ea", "committedDate": "2020-05-22T14:28:17Z", "message": "Uses SmartQuery.iterateBlockwise where suitable."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48fa33f05fd84b6cc1b0bd67d307a9ef0df70777", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/48fa33f05fd84b6cc1b0bd67d307a9ef0df70777", "committedDate": "2020-05-22T14:28:48Z", "message": "Code style.\n\nConstructors of abstract classes shouldn't be public."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87507347f32c096ab2cd968b7f4efa1ab52f57e8", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/87507347f32c096ab2cd968b7f4efa1ab52f57e8", "committedDate": "2020-05-22T14:28:59Z", "message": "Fixes a JavaDoc."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba7ec2b87318c8c0dcd87fb57512751ecee387e9", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/ba7ec2b87318c8c0dcd87fb57512751ecee387e9", "committedDate": "2020-05-22T14:30:29Z", "message": "Removes unnecessary code.\n\nThis has also been removed for SQLUserAccountImportHandler.\nThe same effect can now be achieved by invoking the method\nMongoTenantAware.skipTenantCheck() before saving the entity."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "673191c13eff2a75347e0aa294b5a3ca2b48a7ad", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/673191c13eff2a75347e0aa294b5a3ca2b48a7ad", "committedDate": "2020-05-22T14:31:07Z", "message": "Adds a common enum which can be used to control how missing entities are resolved."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0889bd2ac20159475a4e79c916350ec200ccab97", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/0889bd2ac20159475a4e79c916350ec200ccab97", "committedDate": "2020-05-22T14:53:15Z", "message": "Merge remote-tracking branch 'origin/master' into aha/io-update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4fef7f86dac5c6fe1a7b44fdcb40190313ee23b", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/b4fef7f86dac5c6fe1a7b44fdcb40190313ee23b", "committedDate": "2020-05-22T14:55:06Z", "message": "Moves the import transactions framework from SellSite to sirius-biz.\n\nThe framework is product agnostic and has a great potential\nto be re-used."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af4f95d57197f4faca501649b1a8470e4b8c4b50", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/af4f95d57197f4faca501649b1a8470e4b8c4b50", "committedDate": "2020-05-22T14:55:41Z", "message": "Provides translations for a common enum."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1107cbea7328ec7faf210d1c78585638a36af2f", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/f1107cbea7328ec7faf210d1c78585638a36af2f", "committedDate": "2020-05-22T14:57:32Z", "message": "Provides a base class for an sync import.\n\nSuch an import is intended to be used when working\nwith relational entities (entities representing a relation\nbetween other entities). These entities are often\nsynchronized in the ways described by SyncMode.\n\nThe EntityImportSyncJob provides the bulk load of\nthe implementation required to perform these."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2OTkzNjI1", "url": "https://github.com/scireum/sirius-biz/pull/760#pullrequestreview-416993625", "createdAt": "2020-05-22T15:19:58Z", "commit": {"oid": "b4fef7f86dac5c6fe1a7b44fdcb40190313ee23b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNToxOTo1OFrOGZa-Tg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNToyNzoxN1rOGZbNfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTMwOTUxOA==", "bodyText": "find den feldname nicht gut, wieso nicht einfach transactionId oder importId oder sowas in die Richtung?", "url": "https://github.com/scireum/sirius-biz/pull/760#discussion_r429309518", "createdAt": "2020-05-22T15:19:58Z", "author": {"login": "sabieber"}, "path": "src/main/java/sirius/biz/importer/txn/ImportTransactionData.java", "diffHunk": "@@ -0,0 +1,41 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.importer.txn;\n+\n+import sirius.biz.importer.AutoImport;\n+import sirius.biz.protocol.NoJournal;\n+import sirius.db.mixing.Composite;\n+import sirius.db.mixing.Mapping;\n+\n+/**\n+ * Contains an import transaction id.\n+ * <p>\n+ * This is used by the {@link ImportTransactionHelper} to identify and delete all unchanged\n+ * entities after an update transaction has beend completed.\n+ * <p>\n+ * Note that appropriate index should be added to the embedding entity.\n+ */\n+public class ImportTransactionData extends Composite {\n+\n+    /**\n+     * Represents the last import transaction id which was used to modify the owning entity.\n+     */\n+    public static final Mapping TXN_ID = Mapping.named(\"txnId\");\n+    @AutoImport\n+    @NoJournal\n+    private long txnId = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4fef7f86dac5c6fe1a7b44fdcb40190313ee23b"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTMxMTA1MA==", "bodyText": "Bzw rein theoretisch ginge ja wahrscheinlich auch nur ID weils ja n composite ist", "url": "https://github.com/scireum/sirius-biz/pull/760#discussion_r429311050", "createdAt": "2020-05-22T15:22:55Z", "author": {"login": "sabieber"}, "path": "src/main/java/sirius/biz/importer/txn/ImportTransactionData.java", "diffHunk": "@@ -0,0 +1,41 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.importer.txn;\n+\n+import sirius.biz.importer.AutoImport;\n+import sirius.biz.protocol.NoJournal;\n+import sirius.db.mixing.Composite;\n+import sirius.db.mixing.Mapping;\n+\n+/**\n+ * Contains an import transaction id.\n+ * <p>\n+ * This is used by the {@link ImportTransactionHelper} to identify and delete all unchanged\n+ * entities after an update transaction has beend completed.\n+ * <p>\n+ * Note that appropriate index should be added to the embedding entity.\n+ */\n+public class ImportTransactionData extends Composite {\n+\n+    /**\n+     * Represents the last import transaction id which was used to modify the owning entity.\n+     */\n+    public static final Mapping TXN_ID = Mapping.named(\"txnId\");\n+    @AutoImport\n+    @NoJournal\n+    private long txnId = 0;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTMwOTUxOA=="}, "originalCommit": {"oid": "b4fef7f86dac5c6fe1a7b44fdcb40190313ee23b"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTMxMjI5Nw==", "bodyText": "Find den Namen irgendwie nicht sehr deskriptiv, wieso nicht sowas wie TransactionalEntitiyImportJob oder RelationalEntityImportJob?", "url": "https://github.com/scireum/sirius-biz/pull/760#discussion_r429312297", "createdAt": "2020-05-22T15:25:17Z", "author": {"login": "sabieber"}, "path": "src/main/java/sirius/biz/jobs/batch/file/EntityImportSyncJob.java", "diffHunk": "@@ -0,0 +1,234 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.jobs.batch.file;\n+\n+import sirius.biz.importer.format.ImportDictionary;\n+import sirius.biz.importer.txn.ImportTransactionHelper;\n+import sirius.biz.importer.txn.ImportTransactionalEntity;\n+import sirius.biz.jobs.params.BooleanParameter;\n+import sirius.biz.jobs.params.EnumParameter;\n+import sirius.biz.process.ProcessContext;\n+import sirius.biz.storage.layer3.FileParameter;\n+import sirius.biz.tenants.Tenants;\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.EntityDescriptor;\n+import sirius.db.mixing.Mixing;\n+import sirius.db.mixing.query.Query;\n+import sirius.kernel.commons.Context;\n+import sirius.kernel.commons.Watch;\n+import sirius.kernel.di.std.Part;\n+import sirius.kernel.health.Exceptions;\n+import sirius.kernel.health.HandledException;\n+import sirius.kernel.nls.NLS;\n+import sirius.web.data.LineBasedProcessor;\n+\n+import java.io.InputStream;\n+import java.util.concurrent.TimeUnit;\n+import java.util.function.BiConsumer;\n+import java.util.function.Consumer;\n+\n+/**\n+ * Provides a job for importing line based files (CSV, Excel) as relational entities.\n+ * <p>\n+ * This job behaves alomost exactly like {@link EntityImportJob}. The only difference is that it is suited for\n+ * \"relational\" entities (entities which represent a relation between two other entities). Theser are often\n+ * synchronized as described by {@link SyncMode}, which is handled by this implementation.\n+ * <p>\n+ * To support an ideal operation, such entities should implement {@link ImportTransactionalEntity} to that the\n+ * framework can provide efficient delta updates.\n+ *\n+ * @param <E> the type of entities being imported by this job\n+ * @param <Q> the generic type of queries for the entities being procesed\n+ */\n+public class EntityImportSyncJob<E extends BaseEntity<?> & ImportTransactionalEntity, Q extends Query<Q, E, ?>>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1107cbea7328ec7faf210d1c78585638a36af2f"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTMxMjY2NQ==", "bodyText": "sollten parts ned eher \u00fcber klassenfelder?", "url": "https://github.com/scireum/sirius-biz/pull/760#discussion_r429312665", "createdAt": "2020-05-22T15:25:55Z", "author": {"login": "sabieber"}, "path": "src/main/java/sirius/biz/jobs/batch/file/EntityImportSyncJob.java", "diffHunk": "@@ -0,0 +1,234 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.jobs.batch.file;\n+\n+import sirius.biz.importer.format.ImportDictionary;\n+import sirius.biz.importer.txn.ImportTransactionHelper;\n+import sirius.biz.importer.txn.ImportTransactionalEntity;\n+import sirius.biz.jobs.params.BooleanParameter;\n+import sirius.biz.jobs.params.EnumParameter;\n+import sirius.biz.process.ProcessContext;\n+import sirius.biz.storage.layer3.FileParameter;\n+import sirius.biz.tenants.Tenants;\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.EntityDescriptor;\n+import sirius.db.mixing.Mixing;\n+import sirius.db.mixing.query.Query;\n+import sirius.kernel.commons.Context;\n+import sirius.kernel.commons.Watch;\n+import sirius.kernel.di.std.Part;\n+import sirius.kernel.health.Exceptions;\n+import sirius.kernel.health.HandledException;\n+import sirius.kernel.nls.NLS;\n+import sirius.web.data.LineBasedProcessor;\n+\n+import java.io.InputStream;\n+import java.util.concurrent.TimeUnit;\n+import java.util.function.BiConsumer;\n+import java.util.function.Consumer;\n+\n+/**\n+ * Provides a job for importing line based files (CSV, Excel) as relational entities.\n+ * <p>\n+ * This job behaves alomost exactly like {@link EntityImportJob}. The only difference is that it is suited for\n+ * \"relational\" entities (entities which represent a relation between two other entities). Theser are often\n+ * synchronized as described by {@link SyncMode}, which is handled by this implementation.\n+ * <p>\n+ * To support an ideal operation, such entities should implement {@link ImportTransactionalEntity} to that the\n+ * framework can provide efficient delta updates.\n+ *\n+ * @param <E> the type of entities being imported by this job\n+ * @param <Q> the generic type of queries for the entities being procesed\n+ */\n+public class EntityImportSyncJob<E extends BaseEntity<?> & ImportTransactionalEntity, Q extends Query<Q, E, ?>>\n+        extends DictionaryBasedImportJob {\n+\n+    protected final EntityDescriptor descriptor;\n+    protected Consumer<Context> contextExtender;\n+    protected ImportTransactionHelper importTransactionHelper;\n+    protected Class<E> type;\n+    protected SyncMode mode;\n+    protected BiConsumer<ProcessContext, Q> queryTuner;\n+\n+    @Part\n+    private static Mixing mixing;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1107cbea7328ec7faf210d1c78585638a36af2f"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTMxMzQwNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private void createorUpdateEntity(E entity, Context context, Watch watch) {\n          \n          \n            \n                private void createOrUpdateEntity(E entity, Context context, Watch watch) {\n          \n      \n    \n    \n  \n\nund halt an den anderen stellen auch", "url": "https://github.com/scireum/sirius-biz/pull/760#discussion_r429313405", "createdAt": "2020-05-22T15:27:17Z", "author": {"login": "sabieber"}, "path": "src/main/java/sirius/biz/jobs/batch/file/EntityImportSyncJob.java", "diffHunk": "@@ -0,0 +1,234 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.jobs.batch.file;\n+\n+import sirius.biz.importer.format.ImportDictionary;\n+import sirius.biz.importer.txn.ImportTransactionHelper;\n+import sirius.biz.importer.txn.ImportTransactionalEntity;\n+import sirius.biz.jobs.params.BooleanParameter;\n+import sirius.biz.jobs.params.EnumParameter;\n+import sirius.biz.process.ProcessContext;\n+import sirius.biz.storage.layer3.FileParameter;\n+import sirius.biz.tenants.Tenants;\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.EntityDescriptor;\n+import sirius.db.mixing.Mixing;\n+import sirius.db.mixing.query.Query;\n+import sirius.kernel.commons.Context;\n+import sirius.kernel.commons.Watch;\n+import sirius.kernel.di.std.Part;\n+import sirius.kernel.health.Exceptions;\n+import sirius.kernel.health.HandledException;\n+import sirius.kernel.nls.NLS;\n+import sirius.web.data.LineBasedProcessor;\n+\n+import java.io.InputStream;\n+import java.util.concurrent.TimeUnit;\n+import java.util.function.BiConsumer;\n+import java.util.function.Consumer;\n+\n+/**\n+ * Provides a job for importing line based files (CSV, Excel) as relational entities.\n+ * <p>\n+ * This job behaves alomost exactly like {@link EntityImportJob}. The only difference is that it is suited for\n+ * \"relational\" entities (entities which represent a relation between two other entities). Theser are often\n+ * synchronized as described by {@link SyncMode}, which is handled by this implementation.\n+ * <p>\n+ * To support an ideal operation, such entities should implement {@link ImportTransactionalEntity} to that the\n+ * framework can provide efficient delta updates.\n+ *\n+ * @param <E> the type of entities being imported by this job\n+ * @param <Q> the generic type of queries for the entities being procesed\n+ */\n+public class EntityImportSyncJob<E extends BaseEntity<?> & ImportTransactionalEntity, Q extends Query<Q, E, ?>>\n+        extends DictionaryBasedImportJob {\n+\n+    protected final EntityDescriptor descriptor;\n+    protected Consumer<Context> contextExtender;\n+    protected ImportTransactionHelper importTransactionHelper;\n+    protected Class<E> type;\n+    protected SyncMode mode;\n+    protected BiConsumer<ProcessContext, Q> queryTuner;\n+\n+    @Part\n+    private static Mixing mixing;\n+\n+    @Part\n+    private static Tenants<?, ?, ?> rawTenants;\n+\n+    /**\n+     * Creates a new job for the given factory, name and process.\n+     *\n+     * @param fileParameter        the parameter which is used to derive the import file from\n+     * @param ignoreEmptyParameter the parameter which is used to determine if empty values should be ignored\n+     * @param syncModeParameter    the parameter which is used to determine the {@link SyncMode} to use\n+     * @param type                 the type of entities being imported\n+     * @param dictionary           the import dictionary to use\n+     * @param process              the process context itself\n+     * @param factoryName          the name of the factory which created this job\n+     */\n+    public EntityImportSyncJob(FileParameter fileParameter,\n+                               BooleanParameter ignoreEmptyParameter,\n+                               EnumParameter<SyncMode> syncModeParameter,\n+                               Class<E> type,\n+                               ImportDictionary dictionary,\n+                               ProcessContext process,\n+                               String factoryName) {\n+        super(fileParameter, ignoreEmptyParameter, dictionary, process);\n+        this.importer.setFactoryName(factoryName);\n+        this.importTransactionHelper = importer.findHelper(ImportTransactionHelper.class);\n+        this.mode = process.getParameter(syncModeParameter).orElse(SyncMode.NEW_AND_UPDATE_ONLY);\n+        this.type = type;\n+        this.descriptor = mixing.getDescriptor(type);\n+    }\n+\n+    /**\n+     * Specifies a context extender which can be used to transfer job parameters into the import context.\n+     *\n+     * @param contextExtender the extender to specify\n+     * @return the import job itself for fluent method calls\n+     */\n+    public EntityImportSyncJob<E, Q> withContextExtender(Consumer<Context> contextExtender) {\n+        this.contextExtender = contextExtender;\n+        return this;\n+    }\n+\n+    public EntityImportSyncJob<E, Q> withDeleteQueryTuner(BiConsumer<ProcessContext, Q> queryTuner) {\n+        this.queryTuner = queryTuner;\n+        return this;\n+    }\n+\n+    @Override\n+    protected void executeForStream(String filename, InputStream in) throws Exception {\n+        importTransactionHelper.start();\n+        LineBasedProcessor.create(filename, in).run(this, error -> {\n+            process.handle(error);\n+            return true;\n+        });\n+        commitImportTransaction();\n+    }\n+\n+    /**\n+     * Commits the import transaction by deleting all untouched entities.\n+     */\n+    protected void commitImportTransaction() {\n+        if (mode != SyncMode.SYNC) {\n+            return;\n+        }\n+\n+        Watch watch = Watch.start();\n+        importTransactionHelper.deleteUnmarked(type, this::tuneImportTransactionDeleteQuery, entity -> {\n+            process.addTiming(NLS.get(\"EntityImportJob.entityDeleted\"), watch.elapsed(TimeUnit.MILLISECONDS, true));\n+        });\n+    }\n+\n+    /**\n+     * Tunes the delete query of the import transaction so that all untouched entities will be deleted.\n+     *\n+     * @param deleteQuery the query to enhance\n+     */\n+    protected void tuneImportTransactionDeleteQuery(Q deleteQuery) {\n+        queryTuner.accept(process, deleteQuery);\n+    }\n+\n+    @Override\n+    protected final void handleRow(int index, Context context) {\n+        Watch watch = Watch.start();\n+\n+        if (contextExtender != null) {\n+            contextExtender.accept(context);\n+        }\n+\n+        E entity = findAndLoad(context);\n+        if (mode == SyncMode.DELETE_EXISTING) {\n+            if (!entity.isNew()) {\n+                importer.deleteNow(entity);\n+                process.addTiming(NLS.get(\"EntityImportJob.entityDeleted\"), watch.elapsedMillis());\n+            }\n+        } else {\n+            createorUpdateEntity(entity, context, watch);\n+        }\n+    }\n+\n+    private void createorUpdateEntity(E entity, Context context, Watch watch) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1107cbea7328ec7faf210d1c78585638a36af2f"}, "originalPosition": 159}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MDAyNzM3", "url": "https://github.com/scireum/sirius-biz/pull/760#pullrequestreview-417002737", "createdAt": "2020-05-22T15:32:40Z", "commit": {"oid": "f1107cbea7328ec7faf210d1c78585638a36af2f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNTozMjo0MFrOGZbYgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNTozODo1NlrOGZblIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTMxNjIyNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * \"relational\" entities (entities which represent a relation between two other entities). Theser are often\n          \n          \n            \n             * \"relational\" entities (entities which represent a relation between two other entities). These are often", "url": "https://github.com/scireum/sirius-biz/pull/760#discussion_r429316224", "createdAt": "2020-05-22T15:32:40Z", "author": {"login": "mkeckmkeck"}, "path": "src/main/java/sirius/biz/jobs/batch/file/EntityImportSyncJob.java", "diffHunk": "@@ -0,0 +1,234 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.jobs.batch.file;\n+\n+import sirius.biz.importer.format.ImportDictionary;\n+import sirius.biz.importer.txn.ImportTransactionHelper;\n+import sirius.biz.importer.txn.ImportTransactionalEntity;\n+import sirius.biz.jobs.params.BooleanParameter;\n+import sirius.biz.jobs.params.EnumParameter;\n+import sirius.biz.process.ProcessContext;\n+import sirius.biz.storage.layer3.FileParameter;\n+import sirius.biz.tenants.Tenants;\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.EntityDescriptor;\n+import sirius.db.mixing.Mixing;\n+import sirius.db.mixing.query.Query;\n+import sirius.kernel.commons.Context;\n+import sirius.kernel.commons.Watch;\n+import sirius.kernel.di.std.Part;\n+import sirius.kernel.health.Exceptions;\n+import sirius.kernel.health.HandledException;\n+import sirius.kernel.nls.NLS;\n+import sirius.web.data.LineBasedProcessor;\n+\n+import java.io.InputStream;\n+import java.util.concurrent.TimeUnit;\n+import java.util.function.BiConsumer;\n+import java.util.function.Consumer;\n+\n+/**\n+ * Provides a job for importing line based files (CSV, Excel) as relational entities.\n+ * <p>\n+ * This job behaves alomost exactly like {@link EntityImportJob}. The only difference is that it is suited for\n+ * \"relational\" entities (entities which represent a relation between two other entities). Theser are often", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1107cbea7328ec7faf210d1c78585638a36af2f"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTMxNjQxMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * To support an ideal operation, such entities should implement {@link ImportTransactionalEntity} to that the\n          \n          \n            \n             * To support an efficient operation, such entities should implement {@link ImportTransactionalEntity} to that the", "url": "https://github.com/scireum/sirius-biz/pull/760#discussion_r429316413", "createdAt": "2020-05-22T15:33:04Z", "author": {"login": "mkeckmkeck"}, "path": "src/main/java/sirius/biz/jobs/batch/file/EntityImportSyncJob.java", "diffHunk": "@@ -0,0 +1,234 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.jobs.batch.file;\n+\n+import sirius.biz.importer.format.ImportDictionary;\n+import sirius.biz.importer.txn.ImportTransactionHelper;\n+import sirius.biz.importer.txn.ImportTransactionalEntity;\n+import sirius.biz.jobs.params.BooleanParameter;\n+import sirius.biz.jobs.params.EnumParameter;\n+import sirius.biz.process.ProcessContext;\n+import sirius.biz.storage.layer3.FileParameter;\n+import sirius.biz.tenants.Tenants;\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.EntityDescriptor;\n+import sirius.db.mixing.Mixing;\n+import sirius.db.mixing.query.Query;\n+import sirius.kernel.commons.Context;\n+import sirius.kernel.commons.Watch;\n+import sirius.kernel.di.std.Part;\n+import sirius.kernel.health.Exceptions;\n+import sirius.kernel.health.HandledException;\n+import sirius.kernel.nls.NLS;\n+import sirius.web.data.LineBasedProcessor;\n+\n+import java.io.InputStream;\n+import java.util.concurrent.TimeUnit;\n+import java.util.function.BiConsumer;\n+import java.util.function.Consumer;\n+\n+/**\n+ * Provides a job for importing line based files (CSV, Excel) as relational entities.\n+ * <p>\n+ * This job behaves alomost exactly like {@link EntityImportJob}. The only difference is that it is suited for\n+ * \"relational\" entities (entities which represent a relation between two other entities). Theser are often\n+ * synchronized as described by {@link SyncMode}, which is handled by this implementation.\n+ * <p>\n+ * To support an ideal operation, such entities should implement {@link ImportTransactionalEntity} to that the", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1107cbea7328ec7faf210d1c78585638a36af2f"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTMxODk1MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Only updates existing entities.\n          \n          \n            \n                 * Creates new entities and also updates existing ones.", "url": "https://github.com/scireum/sirius-biz/pull/760#discussion_r429318950", "createdAt": "2020-05-22T15:38:04Z", "author": {"login": "mkeckmkeck"}, "path": "src/main/java/sirius/biz/jobs/batch/file/SyncMode.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.jobs.batch.file;\n+\n+import sirius.kernel.nls.NLS;\n+\n+/**\n+ * Declares the modes of operation for an {@link EntityImportJob}.\n+ */\n+public enum SyncMode {\n+\n+    /**\n+     * Only updates existing entities.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1107cbea7328ec7faf210d1c78585638a36af2f"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTMxOTQ1Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Creates new entities and also updates existing ones.\n          \n          \n            \n                 * Creates new entities, updates existing ones and deletes outdated entities.", "url": "https://github.com/scireum/sirius-biz/pull/760#discussion_r429319456", "createdAt": "2020-05-22T15:38:56Z", "author": {"login": "mkeckmkeck"}, "path": "src/main/java/sirius/biz/jobs/batch/file/SyncMode.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.jobs.batch.file;\n+\n+import sirius.kernel.nls.NLS;\n+\n+/**\n+ * Declares the modes of operation for an {@link EntityImportJob}.\n+ */\n+public enum SyncMode {\n+\n+    /**\n+     * Only updates existing entities.\n+     */\n+    NEW_AND_UPDATE_ONLY,\n+\n+    /**\n+     * Only updates existing entities.\n+     */\n+    UPDATE_ONLY,\n+\n+    /**\n+     * Only creates new entities.\n+     */\n+    NEW_ONLY,\n+\n+    /**\n+     * Creates new entities and also updates existing ones.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1107cbea7328ec7faf210d1c78585638a36af2f"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e2ace6436ed322bd7de670b7d25a442ef67f7ff", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/6e2ace6436ed322bd7de670b7d25a442ef67f7ff", "committedDate": "2020-05-22T15:52:34Z", "message": "Apply suggestions from code review\n\nCo-authored-by: Matthias Keck <60612914+mkeckmkeck@users.noreply.github.com>\nCo-authored-by: Sascha Bieberstein <sabieber@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2997a36cf90471ea66af06a16799a5f795e1ffb0", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/2997a36cf90471ea66af06a16799a5f795e1ffb0", "committedDate": "2020-05-22T15:52:51Z", "message": "Merge remote-tracking branch 'origin/master' into aha/io-update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02ce493d19cb00ae9d9181762578c2dbdaf63645", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/02ce493d19cb00ae9d9181762578c2dbdaf63645", "committedDate": "2020-05-22T15:55:46Z", "message": "Changes based on PR review comments."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MDIxMzI2", "url": "https://github.com/scireum/sirius-biz/pull/760#pullrequestreview-417021326", "createdAt": "2020-05-22T15:59:14Z", "commit": {"oid": "02ce493d19cb00ae9d9181762578c2dbdaf63645"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3NDU3ODk1", "url": "https://github.com/scireum/sirius-biz/pull/760#pullrequestreview-417457895", "createdAt": "2020-05-25T05:07:13Z", "commit": {"oid": "02ce493d19cb00ae9d9181762578c2dbdaf63645"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3NDc2MTU4", "url": "https://github.com/scireum/sirius-biz/pull/760#pullrequestreview-417476158", "createdAt": "2020-05-25T06:12:36Z", "commit": {"oid": "02ce493d19cb00ae9d9181762578c2dbdaf63645"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4294, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}