{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyNDE0NTk3", "number": 866, "title": "Adds ability to validate XML files against specified XSD files", "bodyText": "Fixes: SIRI-255", "createdAt": "2020-09-24T12:34:07Z", "url": "https://github.com/scireum/sirius-biz/pull/866", "merged": true, "mergeCommit": {"oid": "795ef27ec89130c940fff88f13d19cd4a039ace1"}, "closed": true, "closedAt": "2020-09-29T15:07:26Z", "author": {"login": "fhaScireum"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMAW_HAH2gAyNDkyNDE0NTk3OjkwMDEwNjdiYWRmOWY2ZGMxNDAzZDVlOGFiMDg4M2QyOTg5MGUyNmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNo92ygFqTQ5ODUyNTI3NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9001067badf9f6dc1403d5e8ab0883d29890e26a", "author": {"user": {"login": "fhaScireum", "name": "Florian H\u00e4fner"}}, "url": "https://github.com/scireum/sirius-biz/commit/9001067badf9f6dc1403d5e8ab0883d29890e26a", "committedDate": "2020-09-24T12:29:26Z", "message": "Adds a simple class to validate xml files\n\n- Fixes: SIRI-255"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ecf2a509274825346a212e5e1e1a432cf6e3aed4", "author": {"user": {"login": "fhaScireum", "name": "Florian H\u00e4fner"}}, "url": "https://github.com/scireum/sirius-biz/commit/ecf2a509274825346a212e5e1e1a432cf6e3aed4", "committedDate": "2020-09-24T12:32:50Z", "message": "Adds ability to validate xml files before import\n\n- Overwrites methods of parent class as each file has to be read twice in case of validation\n- Adds requireValidFile as a hidden parameter that prevents an import in case of errors during validation\n- Adds logic to read xsd files located in the resource directory and validate xml files against the specified xsd\n\n- Fixes: SIRI-255"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15733117aa35b7fef04bcf848ed3d8587525850c", "author": {"user": {"login": "fhaScireum", "name": "Florian H\u00e4fner"}}, "url": "https://github.com/scireum/sirius-biz/commit/15733117aa35b7fef04bcf848ed3d8587525850c", "committedDate": "2020-09-24T12:33:12Z", "message": "Adds translations for new NLS keys\n\n- Fixes: SIRI-255"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NTI2NjM4", "url": "https://github.com/scireum/sirius-biz/pull/866#pullrequestreview-495526638", "createdAt": "2020-09-24T12:40:00Z", "commit": {"oid": "15733117aa35b7fef04bcf848ed3d8587525850c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxMjo0MDowMFrOHXYrXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxMjo0MDowMFrOHXYrXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI4MzYxNA==", "bodyText": "only add if getXsdResourcePath() != null?", "url": "https://github.com/scireum/sirius-biz/pull/866#discussion_r494283614", "createdAt": "2020-09-24T12:40:00Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/jobs/batch/file/XMLImportJobFactory.java", "diffHunk": "@@ -8,13 +8,27 @@\n \n package sirius.biz.jobs.batch.file;\n \n+import sirius.biz.jobs.params.BooleanParameter;\n+import sirius.biz.jobs.params.Parameter;\n import sirius.biz.process.ProcessContext;\n \n+import java.util.function.Consumer;\n+\n /**\n  * Provides a base implementation for batch jobs which import XML files using a {@link XMLImportJob}.\n  */\n public abstract class XMLImportJobFactory extends FileImportJobFactory {\n \n+    protected final BooleanParameter requireValidFile =\n+            new BooleanParameter(\"requireValidFile\", \"$XMLImportJobFactory.requireValidFile\").hidden()\n+                                                                                                       .logInSystem();\n+\n+    @Override\n+    protected void collectParameters(Consumer<Parameter<?, ?>> parameterCollector) {\n+        parameterCollector.accept(requireValidFile);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15733117aa35b7fef04bcf848ed3d8587525850c"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NTI3MzAx", "url": "https://github.com/scireum/sirius-biz/pull/866#pullrequestreview-495527301", "createdAt": "2020-09-24T12:40:47Z", "commit": {"oid": "15733117aa35b7fef04bcf848ed3d8587525850c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxMjo0MDo0N1rOHXYtOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxMjo0MDo0N1rOHXYtOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI4NDA4OQ==", "bodyText": "Why is this simple and what would be a complex one?", "url": "https://github.com/scireum/sirius-biz/pull/866#discussion_r494284089", "createdAt": "2020-09-24T12:40:47Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/jobs/batch/file/SimpleXMLValidator.java", "diffHunk": "@@ -0,0 +1,126 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.jobs.batch.file;\n+\n+import org.xml.sax.ErrorHandler;\n+import org.xml.sax.SAXException;\n+import org.xml.sax.SAXParseException;\n+import sirius.biz.process.ProcessContext;\n+import sirius.biz.process.logs.ProcessLog;\n+import sirius.kernel.commons.Monoflop;\n+import sirius.kernel.commons.Strings;\n+import sirius.kernel.health.Exceptions;\n+import sirius.web.security.UserContext;\n+\n+import javax.xml.XMLConstants;\n+import javax.xml.transform.Source;\n+import javax.xml.validation.Schema;\n+import javax.xml.validation.SchemaFactory;\n+import javax.xml.validation.Validator;\n+import java.io.IOException;\n+import java.util.Locale;\n+\n+/**\n+ * wra\n+ */\n+public class SimpleXMLValidator {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15733117aa35b7fef04bcf848ed3d8587525850c"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NTI3NjA1", "url": "https://github.com/scireum/sirius-biz/pull/866#pullrequestreview-495527605", "createdAt": "2020-09-24T12:41:09Z", "commit": {"oid": "15733117aa35b7fef04bcf848ed3d8587525850c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxMjo0MTowOVrOHXYuEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxMjo0MTowOVrOHXYuEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI4NDMwNQ==", "bodyText": ":)", "url": "https://github.com/scireum/sirius-biz/pull/866#discussion_r494284305", "createdAt": "2020-09-24T12:41:09Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/jobs/batch/file/SimpleXMLValidator.java", "diffHunk": "@@ -0,0 +1,126 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.jobs.batch.file;\n+\n+import org.xml.sax.ErrorHandler;\n+import org.xml.sax.SAXException;\n+import org.xml.sax.SAXParseException;\n+import sirius.biz.process.ProcessContext;\n+import sirius.biz.process.logs.ProcessLog;\n+import sirius.kernel.commons.Monoflop;\n+import sirius.kernel.commons.Strings;\n+import sirius.kernel.health.Exceptions;\n+import sirius.web.security.UserContext;\n+\n+import javax.xml.XMLConstants;\n+import javax.xml.transform.Source;\n+import javax.xml.validation.Schema;\n+import javax.xml.validation.SchemaFactory;\n+import javax.xml.validation.Validator;\n+import java.io.IOException;\n+import java.util.Locale;\n+\n+/**\n+ * wra", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15733117aa35b7fef04bcf848ed3d8587525850c"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NTI3NzY3", "url": "https://github.com/scireum/sirius-biz/pull/866#pullrequestreview-495527767", "createdAt": "2020-09-24T12:41:22Z", "commit": {"oid": "15733117aa35b7fef04bcf848ed3d8587525850c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NTI2Nzk4", "url": "https://github.com/scireum/sirius-biz/pull/866#pullrequestreview-495526798", "createdAt": "2020-09-24T12:40:13Z", "commit": {"oid": "15733117aa35b7fef04bcf848ed3d8587525850c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxMjo0MDoxM1rOHXYr2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxMjo0NTo0N1rOHXY4zQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI4MzczNw==", "bodyText": "Add javadoc", "url": "https://github.com/scireum/sirius-biz/pull/866#discussion_r494283737", "createdAt": "2020-09-24T12:40:13Z", "author": {"login": "bwiedmann"}, "path": "src/main/java/sirius/biz/jobs/batch/file/SimpleXMLValidator.java", "diffHunk": "@@ -0,0 +1,126 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.jobs.batch.file;\n+\n+import org.xml.sax.ErrorHandler;\n+import org.xml.sax.SAXException;\n+import org.xml.sax.SAXParseException;\n+import sirius.biz.process.ProcessContext;\n+import sirius.biz.process.logs.ProcessLog;\n+import sirius.kernel.commons.Monoflop;\n+import sirius.kernel.commons.Strings;\n+import sirius.kernel.health.Exceptions;\n+import sirius.web.security.UserContext;\n+\n+import javax.xml.XMLConstants;\n+import javax.xml.transform.Source;\n+import javax.xml.validation.Schema;\n+import javax.xml.validation.SchemaFactory;\n+import javax.xml.validation.Validator;\n+import java.io.IOException;\n+import java.util.Locale;\n+\n+/**\n+ * wra", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15733117aa35b7fef04bcf848ed3d8587525850c"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI4NzA1Mw==", "bodyText": "Du willst damit ja ausdr\u00fccken dass diese nicht gegen das XSD Schema validierte oder? Gerne noch etwas sprechender formulieren \ud83d\udc4d", "url": "https://github.com/scireum/sirius-biz/pull/866#discussion_r494287053", "createdAt": "2020-09-24T12:45:47Z", "author": {"login": "bwiedmann"}, "path": "src/main/resources/biz_de.properties", "diffHunk": "@@ -821,3 +821,6 @@ VirtualObject.rename = Umbenennen\n VirtualObject.replaceContents = Inhalt ersetzen\n VirtualObject.unreference = Referenzierung l\u00f6schen\n VirtualObject.versions = Versionen\n+XMLImportJob.importCanceled = Der Import der Datei '${fileName}' wurde verhindert, da diese invalide ist.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15733117aa35b7fef04bcf848ed3d8587525850c"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc406a6cafe105e8f67f79ece8eb35a03d859666", "author": {"user": {"login": "fhaScireum", "name": "Florian H\u00e4fner"}}, "url": "https://github.com/scireum/sirius-biz/commit/fc406a6cafe105e8f67f79ece8eb35a03d859666", "committedDate": "2020-09-24T13:14:24Z", "message": "Moves xsd resource path to the factory as it's the same for each job execution and enables checking them before adding the hidden boolean parameter.\n\nAlso clarifies why the xml file is invalid.\n\n- Fixes: SIRI-255"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NTU4NDk0", "url": "https://github.com/scireum/sirius-biz/pull/866#pullrequestreview-495558494", "createdAt": "2020-09-24T13:16:50Z", "commit": {"oid": "fc406a6cafe105e8f67f79ece8eb35a03d859666"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxMzoxNjo1MFrOHXaKxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxMzoxNzo0NFrOHXaNRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDMwODAzOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            XMLImportJob.importCanceled = Der Import der Datei '${fileName}' wurde verhindert, da diese gegen\u00fcber dem hinterlegten XML Schema ung\u00fcltig ist.\n          \n          \n            \n            XMLImportJob.importCanceled = Der Import der Datei '${fileName}' wurde abgebrochen, da diese gegen\u00fcber dem vordefinierte XML Schema ung\u00fcltig ist.", "url": "https://github.com/scireum/sirius-biz/pull/866#discussion_r494308038", "createdAt": "2020-09-24T13:16:50Z", "author": {"login": "idlira"}, "path": "src/main/resources/biz_de.properties", "diffHunk": "@@ -821,6 +821,6 @@ VirtualObject.rename = Umbenennen\n VirtualObject.replaceContents = Inhalt ersetzen\n VirtualObject.unreference = Referenzierung l\u00f6schen\n VirtualObject.versions = Versionen\n-XMLImportJob.importCanceled = Der Import der Datei '${fileName}' wurde verhindert, da diese invalide ist.\n+XMLImportJob.importCanceled = Der Import der Datei '${fileName}' wurde verhindert, da diese gegen\u00fcber dem hinterlegten XML Schema ung\u00fcltig ist.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fc406a6cafe105e8f67f79ece8eb35a03d859666"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDMwODY3OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            XMLImportJob.importCanceled = Importing the file '${fileName}' was prevented as the file is invalid against the stored XML Schema.\n          \n          \n            \n            XMLImportJob.importCanceled = Importing the file '${fileName}' was cancelled as the file is invalid against the defined XML Schema.", "url": "https://github.com/scireum/sirius-biz/pull/866#discussion_r494308678", "createdAt": "2020-09-24T13:17:44Z", "author": {"login": "idlira"}, "path": "src/main/resources/biz_en.properties", "diffHunk": "@@ -777,6 +777,6 @@ VirtualObject.rename = Rename\n VirtualObject.replaceContents = Replace contents\n VirtualObject.unreference = Delete reference\n VirtualObject.versions = Versions\n-XMLImportJob.importCanceled = Importing the file '${fileName}' was prevented as the file is invalid.\n+XMLImportJob.importCanceled = Importing the file '${fileName}' was prevented as the file is invalid against the stored XML Schema.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fc406a6cafe105e8f67f79ece8eb35a03d859666"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d549b0202a054ad6f79d6d478f4ceaa912b6327c", "author": {"user": {"login": "fhaScireum", "name": "Florian H\u00e4fner"}}, "url": "https://github.com/scireum/sirius-biz/commit/d549b0202a054ad6f79d6d478f4ceaa912b6327c", "committedDate": "2020-09-24T13:21:19Z", "message": "Update src/main/resources/biz_de.properties\n\nCo-authored-by: Idevaldo De Lira <ili@scireum.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2b1de2d9fcc68add056abdcd1023d5b9b16a632", "author": {"user": {"login": "fhaScireum", "name": "Florian H\u00e4fner"}}, "url": "https://github.com/scireum/sirius-biz/commit/e2b1de2d9fcc68add056abdcd1023d5b9b16a632", "committedDate": "2020-09-24T13:21:26Z", "message": "Update src/main/resources/biz_en.properties\n\nCo-authored-by: Idevaldo De Lira <ili@scireum.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NTY0NDE1", "url": "https://github.com/scireum/sirius-biz/pull/866#pullrequestreview-495564415", "createdAt": "2020-09-24T13:23:16Z", "commit": {"oid": "e2b1de2d9fcc68add056abdcd1023d5b9b16a632"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NTY4MTQ5", "url": "https://github.com/scireum/sirius-biz/pull/866#pullrequestreview-495568149", "createdAt": "2020-09-24T13:27:02Z", "commit": {"oid": "e2b1de2d9fcc68add056abdcd1023d5b9b16a632"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NjEzNTg0", "url": "https://github.com/scireum/sirius-biz/pull/866#pullrequestreview-495613584", "createdAt": "2020-09-24T14:08:56Z", "commit": {"oid": "e2b1de2d9fcc68add056abdcd1023d5b9b16a632"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52877fc69bf384b99c0cc7c5fb0445721a6ef085", "author": {"user": {"login": "fhaScireum", "name": "Florian H\u00e4fner"}}, "url": "https://github.com/scireum/sirius-biz/commit/52877fc69bf384b99c0cc7c5fb0445721a6ef085", "committedDate": "2020-09-24T14:27:33Z", "message": "Allows to change the visibility of a parameter to normal in case extended factories want to show a certain parameter\n\n- Fixes: SIRI-255"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NjM0NzQz", "url": "https://github.com/scireum/sirius-biz/pull/866#pullrequestreview-495634743", "createdAt": "2020-09-24T14:29:18Z", "commit": {"oid": "52877fc69bf384b99c0cc7c5fb0445721a6ef085"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NjM2MzYx", "url": "https://github.com/scireum/sirius-biz/pull/866#pullrequestreview-495636361", "createdAt": "2020-09-24T14:30:52Z", "commit": {"oid": "52877fc69bf384b99c0cc7c5fb0445721a6ef085"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "721604dac8e8af7f755b84fbf1502a7002177aba", "author": {"user": {"login": "fhaScireum", "name": "Florian H\u00e4fner"}}, "url": "https://github.com/scireum/sirius-biz/commit/721604dac8e8af7f755b84fbf1502a7002177aba", "committedDate": "2020-09-24T14:32:30Z", "message": "Logs the parameter normally as non admin users may be able to set the parameter (if made visible in extended jobs)\n\n- Fixes: SIRI-255"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NjU1Nzg3", "url": "https://github.com/scireum/sirius-biz/pull/866#pullrequestreview-495655787", "createdAt": "2020-09-24T14:49:42Z", "commit": {"oid": "721604dac8e8af7f755b84fbf1502a7002177aba"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2MTE0NzM0", "url": "https://github.com/scireum/sirius-biz/pull/866#pullrequestreview-496114734", "createdAt": "2020-09-25T05:12:51Z", "commit": {"oid": "721604dac8e8af7f755b84fbf1502a7002177aba"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwNToxMjo1MlrOHX1Ncg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwNToxNDowN1rOHX1Opw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc1MTA5MA==", "bodyText": "Error handler will only handle SAXParseException. So we will swallow IOExceptions here.", "url": "https://github.com/scireum/sirius-biz/pull/866#discussion_r494751090", "createdAt": "2020-09-25T05:12:52Z", "author": {"login": "mkeckmkeck"}, "path": "src/main/java/sirius/biz/jobs/batch/file/XMLValidator.java", "diffHunk": "@@ -0,0 +1,126 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.jobs.batch.file;\n+\n+import org.xml.sax.ErrorHandler;\n+import org.xml.sax.SAXException;\n+import org.xml.sax.SAXParseException;\n+import sirius.biz.process.ProcessContext;\n+import sirius.biz.process.logs.ProcessLog;\n+import sirius.kernel.commons.Monoflop;\n+import sirius.kernel.commons.Strings;\n+import sirius.kernel.health.Exceptions;\n+import sirius.web.security.UserContext;\n+\n+import javax.xml.XMLConstants;\n+import javax.xml.transform.Source;\n+import javax.xml.validation.Schema;\n+import javax.xml.validation.SchemaFactory;\n+import javax.xml.validation.Validator;\n+import java.io.IOException;\n+import java.util.Locale;\n+\n+/**\n+ * Validates an XML source against an XSD source and keeps track if any error occurred during validation.\n+ */\n+public class XMLValidator {\n+\n+    private final ProcessContext process;\n+\n+    /**\n+     * Creates a validator that logs errors into the given process context.\n+     *\n+     * @param process the context to log errors into\n+     */\n+    public XMLValidator(ProcessContext process) {\n+        this.process = process;\n+    }\n+\n+    /**\n+     * Determines if the \u00a0{@link Source xml source} is valid by validating it with the given {@link Source xsd source}.\n+     *\n+     * @param xml the XML source to be validated\n+     * @param xsd the XSD source used as the schema for the validator\n+     * @return <tt>true</tt> if the xml source is valid, <tt>false</tt> otherwise\n+     * @throws SAXException in case of an invalid xsd source\n+     */\n+    public boolean validate(Source xml, Source xsd) throws SAXException {\n+        SchemaFactory schemaFactory = SchemaFactory.newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);\n+        Schema schema = schemaFactory.newSchema(xsd);\n+\n+        Validator validator = schema.newValidator();\n+        String language = UserContext.getCurrentUser().getLang();\n+        // Apply a workaround for using the english translations as those are not stored in an extra \"en\" resource\n+        // bundle but in the root one instead.\n+        Locale locale = Strings.areEqual(language, \"en\") ? Locale.ROOT : new Locale(language);\n+        validator.setProperty(\"http://apache.org/xml/properties/locale\", locale);\n+\n+        XMLValidatorErrorHandler errorHandler = new XMLValidatorErrorHandler(process);\n+        validator.setErrorHandler(errorHandler);\n+\n+        try {\n+            validator.validate(xml);\n+        } catch (SAXParseException | IOException e) {\n+            // Cause of the exception is already logged via validator's error handler.\n+            Exceptions.ignore(e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "721604dac8e8af7f755b84fbf1502a7002177aba"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc1MTM5OQ==", "bodyText": "Is therre a use case for having a validation on xml file import and ignoring the result? If not, then why not just use the xsdPath parameter to determine if a validation should happen?", "url": "https://github.com/scireum/sirius-biz/pull/866#discussion_r494751399", "createdAt": "2020-09-25T05:14:07Z", "author": {"login": "mkeckmkeck"}, "path": "src/main/java/sirius/biz/jobs/batch/file/XMLImportJob.java", "diffHunk": "@@ -27,6 +47,93 @@\n      */\n     protected XMLImportJob(XMLImportJobFactory factory, ProcessContext process) {\n         super(factory.fileParameter, process);\n+        requireValidFile = process.getParameter(factory.requireValidFile).orElse(false);\n+        xsdResourcePath = factory.getXsdResourcePath();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "721604dac8e8af7f755b84fbf1502a7002177aba"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a22f927b9c3779d7b31b9edac6a6d2e20beeb68c", "author": {"user": {"login": "idlira", "name": "Idevaldo De Lira"}}, "url": "https://github.com/scireum/sirius-biz/commit/a22f927b9c3779d7b31b9edac6a6d2e20beeb68c", "committedDate": "2020-09-29T11:57:01Z", "message": "Logs IOExceptions to the process errors and fails the xml validation\n\nFixes: SIRI-256"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NDY3MTgx", "url": "https://github.com/scireum/sirius-biz/pull/866#pullrequestreview-498467181", "createdAt": "2020-09-29T13:27:57Z", "commit": {"oid": "a22f927b9c3779d7b31b9edac6a6d2e20beeb68c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c403a0a7fd94770a6262d6f9b7b58c98f4e06009", "author": {"user": {"login": "idlira", "name": "Idevaldo De Lira"}}, "url": "https://github.com/scireum/sirius-biz/commit/c403a0a7fd94770a6262d6f9b7b58c98f4e06009", "committedDate": "2020-09-29T14:19:16Z", "message": "Merge remote-tracking branch 'origin/master' into fha/SIRI-255-XSD-Validation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NTI1Mjc0", "url": "https://github.com/scireum/sirius-biz/pull/866#pullrequestreview-498525274", "createdAt": "2020-09-29T14:22:01Z", "commit": {"oid": "c403a0a7fd94770a6262d6f9b7b58c98f4e06009"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4180, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}