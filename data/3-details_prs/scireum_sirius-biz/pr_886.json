{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4MzAyNjE2", "number": 886, "title": "Tycho: Updates Framework", "bodyText": "", "createdAt": "2020-10-22T13:43:49Z", "url": "https://github.com/scireum/sirius-biz/pull/886", "merged": true, "mergeCommit": {"oid": "972eb550488a71970d7380a73c56f63dfec8024c"}, "closed": true, "closedAt": "2021-07-19T08:11:07Z", "author": {"login": "andyHa"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVB957AH2gAyNTA4MzAyNjE2Ojg2NzU2ZDk5ZjYzZmVkODI1OWFlMjJlOWMxODZkN2ZhMjY2MmE5NzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABer3QBwgH2gAyNTA4MzAyNjE2OmU3ZjI3MmM5YTlhZDllYWQzMjkxMjY5OWUxMGJlY2ZhM2M0YTczOTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "86756d99f63fed8259ae22e9c186d7fa2662a975", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/86756d99f63fed8259ae22e9c186d7fa2662a975", "committedDate": "2020-10-22T13:27:10Z", "message": "Provides an initial implementation of the updates framework."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2NjM1NjQ3", "url": "https://github.com/scireum/sirius-biz/pull/886#pullrequestreview-516635647", "createdAt": "2020-10-26T10:19:20Z", "commit": {"oid": "86756d99f63fed8259ae22e9c186d7fa2662a975"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMDoxOToyMFrOHoJALw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMDoyMDozMFrOHoJCtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg1MjU5MQ==", "bodyText": "Codeformat", "url": "https://github.com/scireum/sirius-biz/pull/886#discussion_r511852591", "createdAt": "2020-10-26T10:19:20Z", "author": {"login": "sabieber"}, "path": "src/main/java/sirius/biz/tycho/updates/UpdatesController.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.tycho.updates;\n+\n+import sirius.biz.web.BizController;\n+import sirius.kernel.di.std.Part;\n+import sirius.kernel.di.std.Register;\n+import sirius.tagliatelle.Tagliatelle;\n+import sirius.tagliatelle.compiler.CompileException;\n+import sirius.web.controller.Controller;\n+import sirius.web.controller.Routed;\n+import sirius.web.http.WebContext;\n+import sirius.web.services.JSONStructuredOutput;\n+\n+@Register(classes = Controller.class)\n+public class UpdatesController extends BizController {\n+\n+    @Part\n+    private UpdateManager updateManager;\n+\n+@Part", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86756d99f63fed8259ae22e9c186d7fa2662a975"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg1MzA3Ng==", "bodyText": "Hardcoded?", "url": "https://github.com/scireum/sirius-biz/pull/886#discussion_r511853076", "createdAt": "2020-10-26T10:20:13Z", "author": {"login": "sabieber"}, "path": "src/main/java/sirius/biz/tycho/updates/UpdateManager.java", "diffHunk": "@@ -0,0 +1,92 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.tycho.updates;\n+\n+import sirius.biz.analytics.flags.ExecutionFlags;\n+import sirius.kernel.commons.Limit;\n+import sirius.kernel.di.std.Part;\n+import sirius.kernel.di.std.Register;\n+import sirius.kernel.xml.StructuredNode;\n+import sirius.kernel.xml.XMLCall;\n+\n+import javax.xml.xpath.XPathExpressionException;\n+import java.io.IOException;\n+import java.net.URL;\n+import java.time.LocalDateTime;\n+import java.time.Period;\n+import java.time.format.DateTimeFormatter;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Optional;\n+\n+@Register(classes = UpdateManager.class)\n+public class UpdateManager {\n+\n+    @Part\n+    private ExecutionFlags executionFlags;\n+\n+    private List<UpdateInfo> updates = Collections.emptyList();\n+    private LocalDateTime lastFetch;\n+\n+    public boolean hasUpdates(String reference) {\n+        if (getUpdates().isEmpty()) {\n+            return false;\n+        }\n+\n+        Optional<LocalDateTime> lastView = executionFlags.readExecutionFlag(reference, \"updates-last-view\");\n+        if (!lastView.isPresent()) {\n+            return true;\n+        }\n+\n+        LocalDateTime limit = LocalDateTime.now().minusMonths(3);\n+\n+        return getUpdates().stream()\n+                           .filter(update -> update.getTimestamp().isAfter(limit))\n+                           .findFirst()\n+                           .filter(update -> update.getTimestamp().isAfter(lastView.get()))\n+                           .isPresent();\n+    }\n+\n+    public List<UpdateInfo> getUpdates() {\n+        LocalDateTime limit = LocalDateTime.now().minusDays(1);\n+        if (lastFetch == null || lastFetch.isBefore(limit)) {\n+            fetchUpdates();\n+        }\n+\n+        return Collections.unmodifiableList(updates);\n+    }\n+\n+    private void fetchUpdates() {\n+        try {\n+            Limit limit = new Limit(0, 5);\n+            List<UpdateInfo> nextUpdates = new ArrayList<>();\n+            XMLCall call = XMLCall.to(new URL(\"https://blog.scireum.de/feed\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86756d99f63fed8259ae22e9c186d7fa2662a975"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg1MzIzNg==", "bodyText": "Whats this?", "url": "https://github.com/scireum/sirius-biz/pull/886#discussion_r511853236", "createdAt": "2020-10-26T10:20:30Z", "author": {"login": "sabieber"}, "path": "src/main/java/sirius/biz/tycho/updates/UpdatesController.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.tycho.updates;\n+\n+import sirius.biz.web.BizController;\n+import sirius.kernel.di.std.Part;\n+import sirius.kernel.di.std.Register;\n+import sirius.tagliatelle.Tagliatelle;\n+import sirius.tagliatelle.compiler.CompileException;\n+import sirius.web.controller.Controller;\n+import sirius.web.controller.Routed;\n+import sirius.web.http.WebContext;\n+import sirius.web.services.JSONStructuredOutput;\n+\n+@Register(classes = Controller.class)\n+public class UpdatesController extends BizController {\n+\n+    @Part\n+    private UpdateManager updateManager;\n+\n+@Part\n+private Tagliatelle tagliatelle;\n+\n+    @Routed(value = \"/tycho/updates\", jsonCall = true)\n+    public void checkForUpdates(WebContext webContext, JSONStructuredOutput output) throws CompileException {\n+        tagliatelle.resolve(\"/kb/IKGVF.html.pasta\").get().getPragma(\"tag\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86756d99f63fed8259ae22e9c186d7fa2662a975"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c0f8e9cd303f7248b536e06b9b7518020b27a0a", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/7c0f8e9cd303f7248b536e06b9b7518020b27a0a", "committedDate": "2021-06-30T06:51:25Z", "message": "Merge remote-tracking branch 'origin/develop' into aha/tycho-updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21cd5cd6b66d84c2ce1d02aeba74eb13c75c210c", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/21cd5cd6b66d84c2ce1d02aeba74eb13c75c210c", "committedDate": "2021-07-02T08:52:19Z", "message": "Merge remote-tracking branch 'origin/develop' into aha/tycho-updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8939e038247841c79e9a72fb32da3dcf221921f", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/c8939e038247841c79e9a72fb32da3dcf221921f", "committedDate": "2021-07-02T20:15:53Z", "message": "Provides a generic dashboard as main entry-point of Tycho apps."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29c894285ef510b3cd75540eac87ed5bfca6c322", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/29c894285ef510b3cd75540eac87ed5bfca6c322", "committedDate": "2021-07-02T20:16:50Z", "message": "Provides extensions for common help topics."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e643a2342466d1890cf1bb42b4bdc279910a4b5a", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/e643a2342466d1890cf1bb42b4bdc279910a4b5a", "committedDate": "2021-07-02T20:17:49Z", "message": "Improves the security for accessTokens used by the academy.\n\nBy only using a hash of the user-id, tokens might be generated elsewhere\nand used here. Therefor we add a custom suffix to make them unique."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b4973e11171f028e6d4869ca6838ffde639f2d5", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/0b4973e11171f028e6d4869ca6838ffde639f2d5", "committedDate": "2021-07-02T20:18:08Z", "message": "Adds a random academy video to the dashboard sidebar."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "358c85babc6ace2ae0d594af3dad1f2d9c6beeff", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/358c85babc6ace2ae0d594af3dad1f2d9c6beeff", "committedDate": "2021-07-02T20:21:13Z", "message": "Finalizes the updates framework.\n\nThis loads news from an ATOM feed and shows them to the users of the\nTycho UI."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4a9117cf481ded312cb38f68b07836f69cdf4141", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/4a9117cf481ded312cb38f68b07836f69cdf4141", "committedDate": "2021-07-01T22:35:16Z", "message": "TMPCMT"}, "afterCommit": {"oid": "358c85babc6ace2ae0d594af3dad1f2d9c6beeff", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/358c85babc6ace2ae0d594af3dad1f2d9c6beeff", "committedDate": "2021-07-02T20:21:13Z", "message": "Finalizes the updates framework.\n\nThis loads news from an ATOM feed and shows them to the users of the\nTycho UI."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Njk4ODQ4MTk0", "url": "https://github.com/scireum/sirius-biz/pull/886#pullrequestreview-698848194", "createdAt": "2021-07-05T06:52:52Z", "commit": {"oid": "358c85babc6ace2ae0d594af3dad1f2d9c6beeff"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNy0wNVQwNjo1Mjo1MlrOJ470uA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNy0wNVQwNjo1Mjo1MlrOJ470uA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MzY4MDE4NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                # Specifies the ATOM feed to fethc news from\n          \n          \n            \n                # Specifies the ATOM feed to fetch news from", "url": "https://github.com/scireum/sirius-biz/pull/886#discussion_r663680184", "createdAt": "2021-07-05T06:52:52Z", "author": {"login": "sabieber"}, "path": "src/main/resources/component-biz.conf", "diffHunk": "@@ -1592,6 +1593,21 @@ redis {\n     }\n }\n \n+# Configures the feed from which updates / news for the Tycho UI are loaded.\n+tycho.updates {\n+\n+    # Specifies the ATOM feed to fethc news from", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "358c85babc6ace2ae0d594af3dad1f2d9c6beeff"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01f8fa685e1ccc0049d9866b8a771851ce1d0c8c", "author": {"user": {"login": "sabieber", "name": "Sascha Bieberstein"}}, "url": "https://github.com/scireum/sirius-biz/commit/01f8fa685e1ccc0049d9866b8a771851ce1d0c8c", "committedDate": "2021-07-05T06:53:44Z", "message": "Typo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Njk4OTIyMTQ1", "url": "https://github.com/scireum/sirius-biz/pull/886#pullrequestreview-698922145", "createdAt": "2021-07-05T08:25:14Z", "commit": {"oid": "01f8fa685e1ccc0049d9866b8a771851ce1d0c8c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56670dbac80c9ff0ce0a00f75ac68baea24f52cd", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/56670dbac80c9ff0ce0a00f75ac68baea24f52cd", "committedDate": "2021-07-06T14:27:13Z", "message": "Merge remote-tracking branch 'origin/develop' into aha/tycho-updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a410cbb8761c630f6519ad618606df99e0629fe9", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/a410cbb8761c630f6519ad618606df99e0629fe9", "committedDate": "2021-07-08T15:09:51Z", "message": "Prevents a template error in case a framework is disabled."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec93a87cfa786ced9a80a39ef9d4bdc87078b400", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/ec93a87cfa786ced9a80a39ef9d4bdc87078b400", "committedDate": "2021-07-08T15:19:21Z", "message": "Fixes startup warnings."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9705148a65d09a95f9fd2387824048410238fe0", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/f9705148a65d09a95f9fd2387824048410238fe0", "committedDate": "2021-07-08T15:24:56Z", "message": "Removes a leftover bracket."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b0f4793c9b2e18835f282483b487cee292434e4", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/9b0f4793c9b2e18835f282483b487cee292434e4", "committedDate": "2021-07-19T07:34:48Z", "message": "Updates to the latest sirius dependencies."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a398f5354b21a4f44ebe131cdb50f0e53a6d8a0", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/0a398f5354b21a4f44ebe131cdb50f0e53a6d8a0", "committedDate": "2021-07-19T07:36:28Z", "message": "Merge remote-tracking branch 'origin/develop' into aha/tycho-updates\n\n# Conflicts:\n#\tpom.xml\n#\tsrc/main/resources/biz_de.properties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7e08b731bb620ad8041c1b3326a62818a8c7473", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/f7e08b731bb620ad8041c1b3326a62818a8c7473", "committedDate": "2021-07-19T08:02:54Z", "message": "Updates to the correct sirius version."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7f272c9a9ad9ead32912699e10becfa3c4a7396", "author": {"user": {"login": "andyHa", "name": "Andreas Haufler"}}, "url": "https://github.com/scireum/sirius-biz/commit/e7f272c9a9ad9ead32912699e10becfa3c4a7396", "committedDate": "2021-07-19T08:09:25Z", "message": "Merge remote-tracking branch 'origin/develop' into aha/tycho-updates\n\n# Conflicts:\n#\tpom.xml"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4211, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}