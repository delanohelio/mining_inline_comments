{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzMjk4MzI4", "number": 913, "title": "Fixes for Jobs and Parameters", "bodyText": "Fixes some bugs found with the breaking changes introduced with #904\n\nFileImportJob considers archives\nXSD validation re-enabled in XML exports+imports\nEnhancement: ability to run more than one pass over an XML file with a different set of handlers\n\nFixes: OX-6341", "createdAt": "2020-11-18T16:13:42Z", "url": "https://github.com/scireum/sirius-biz/pull/913", "merged": true, "mergeCommit": {"oid": "47eea9f8e7fbdbdc014547519e7d84b2c67f5a19"}, "closed": true, "closedAt": "2020-11-19T15:08:30Z", "author": {"login": "idlira"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdduxBYgH2gAyNTIzMjk4MzI4OmZiMDI3MzQxNmY3OWFlMmVjNTI2ZTU3ZTMwZjgyZmVmZGNiNzA5ZjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeCHl8AH2gAyNTIzMjk4MzI4OjRlNmNmODAxNjRjZWUzMWUyYWJhZTUzODVjNjJlZjc4ZDA3ZjYyOWE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fb0273416f79ae2ec526e57e30f82fefdcb709f6", "author": {"user": {"login": "idlira", "name": "Idevaldo De Lira"}}, "url": "https://github.com/scireum/sirius-biz/commit/fb0273416f79ae2ec526e57e30f82fefdcb709f6", "committedDate": "2020-11-18T14:10:13Z", "message": "Consume archives in file import jobs\n\nFixes: OX-6341"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91a5a58c17189943fcd367a292e7184f41237ece", "author": {"user": {"login": "idlira", "name": "Idevaldo De Lira"}}, "url": "https://github.com/scireum/sirius-biz/commit/91a5a58c17189943fcd367a292e7184f41237ece", "committedDate": "2020-11-18T15:54:30Z", "message": "Fixes XSD validation on XML import jobs\n\nThe main job provides a builder which is then filled with entries by the target factory.\n\nValue is collected from the context using the parameter name\n\nFixes: OX-6341"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "881a745c0d9213059f4c080d8c10189748355642", "author": {"user": {"login": "idlira", "name": "Idevaldo De Lira"}}, "url": "https://github.com/scireum/sirius-biz/commit/881a745c0d9213059f4c080d8c10189748355642", "committedDate": "2020-11-18T16:11:31Z", "message": "Fixes XSD validation on XML export jobs\n\nThe main job provides a builder which is then set visible or not depending if xsds were provided by the calling factory.\n\nValue is collected from the context using the parameter name\n\nFixes: OX-6341"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzNjE0NTIx", "url": "https://github.com/scireum/sirius-biz/pull/913#pullrequestreview-533614521", "createdAt": "2020-11-18T16:14:57Z", "commit": {"oid": "881a745c0d9213059f4c080d8c10189748355642"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNjoxNDo1N1rOH11q9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNjoxNDo1N1rOH11q9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjIxNTkyNQ==", "bodyText": "make a method and return a fresh instance each time? this avoids accidentally modifying a shared object", "url": "https://github.com/scireum/sirius-biz/pull/913#discussion_r526215925", "createdAt": "2020-11-18T16:14:57Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/jobs/batch/file/XMLExportJobFactory.java", "diffHunk": "@@ -20,16 +20,16 @@\n  */\n public abstract class XMLExportJobFactory extends FileExportJobFactory {\n \n-    protected final Parameter<Boolean> requireValidFile =\n+    protected final BooleanParameter requireValidFileBuilder =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "881a745c0d9213059f4c080d8c10189748355642"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzNjE2OTI3", "url": "https://github.com/scireum/sirius-biz/pull/913#pullrequestreview-533616927", "createdAt": "2020-11-18T16:17:21Z", "commit": {"oid": "881a745c0d9213059f4c080d8c10189748355642"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNjoxNzoyMVrOH11yAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNjoxNzoyMVrOH11yAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjIxNzcyOQ==", "bodyText": "provide a factory method and or the name as shared constant.\nmaybe also prevent a lookup in the string list for when reading the parameter as the verification is done before and the value can be assumed to be correct. in other words a SelectStringParameter should behave like a StringParameter when it comes to reading the value from the job...", "url": "https://github.com/scireum/sirius-biz/pull/913#discussion_r526217729", "createdAt": "2020-11-18T16:17:21Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/jobs/batch/file/XMLImportJob.java", "diffHunk": "@@ -31,9 +30,9 @@\n  */\n public abstract class XMLImportJob extends FileImportJob {\n \n-    public static final Parameter<String> XSD_SCHEMA_PARAMETER =\n+    protected static final SelectStringParameter XSD_SCHEMA_PARAMETER_BUILDER =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "881a745c0d9213059f4c080d8c10189748355642"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzNjE3ODc1", "url": "https://github.com/scireum/sirius-biz/pull/913#pullrequestreview-533617875", "createdAt": "2020-11-18T16:18:19Z", "commit": {"oid": "881a745c0d9213059f4c080d8c10189748355642"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNjoxODoxOVrOH110wQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNjoxODoxOVrOH110wQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjIxODQzMw==", "bodyText": "i think its better to share the name as a constant than sharing a mutable builder - as this is very easy to get wrong...(modify global state unintentionally)", "url": "https://github.com/scireum/sirius-biz/pull/913#discussion_r526218433", "createdAt": "2020-11-18T16:18:19Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/jobs/params/ParameterBuilder.java", "diffHunk": "@@ -261,7 +261,7 @@ protected V require(Map<String, String> context) {\n      *\n      * @return the name of the parameter\n      */\n-    protected String getName() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "881a745c0d9213059f4c080d8c10189748355642"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d66daa6a906c18b1ce3ef23c0d65e178233ebe6b", "author": {"user": {"login": "idlira", "name": "Idevaldo De Lira"}}, "url": "https://github.com/scireum/sirius-biz/commit/d66daa6a906c18b1ce3ef23c0d65e178233ebe6b", "committedDate": "2020-11-18T16:46:45Z", "message": "Refactors the parameter creation for XML jobs\n\nthe import job provides a static method to initialize a new parameter\n\nthe export job handles it internally as the parameter is rendered based on provided XSD paths\n\nFixes: OX-6341"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe0908ed6ecf37f06368d6c7bfa3dd2b65f243b7", "author": {"user": {"login": "idlira", "name": "Idevaldo De Lira"}}, "url": "https://github.com/scireum/sirius-biz/commit/fe0908ed6ecf37f06368d6c7bfa3dd2b65f243b7", "committedDate": "2020-11-18T18:11:31Z", "message": "Adds the ability to perform several passes over an xml file\n\nregisterHandlers provides the pass current being performed. Also it expects now a consumer instead of providing the raw XMLreader\n\nFixes: OX-6341"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0MTUyNjE4", "url": "https://github.com/scireum/sirius-biz/pull/913#pullrequestreview-534152618", "createdAt": "2020-11-19T07:48:07Z", "commit": {"oid": "fe0908ed6ecf37f06368d6c7bfa3dd2b65f243b7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2abe7f48e7de831aa3832928d128ba1a3604976c", "author": {"user": {"login": "idlira", "name": "Idevaldo De Lira"}}, "url": "https://github.com/scireum/sirius-biz/commit/2abe7f48e7de831aa3832928d128ba1a3604976c", "committedDate": "2020-11-19T10:22:53Z", "message": "Uses a list of registered handler consumers instead of passes\n\nDifferent code, same effect but more Javaish...\n\nFixes: OX-6341"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0Mjg3ODE1", "url": "https://github.com/scireum/sirius-biz/pull/913#pullrequestreview-534287815", "createdAt": "2020-11-19T10:40:15Z", "commit": {"oid": "2abe7f48e7de831aa3832928d128ba1a3604976c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMDo0MDoxNlrOH2W3-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMDo0MDoxNlrOH2W3-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc1OTkyOA==", "bodyText": "why not keep this parameter this is a simple boolean and commonly needs no customization..", "url": "https://github.com/scireum/sirius-biz/pull/913#discussion_r526759928", "createdAt": "2020-11-19T10:40:16Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/jobs/batch/file/XMLExportJobFactory.java", "diffHunk": "@@ -20,16 +20,15 @@\n  */\n public abstract class XMLExportJobFactory extends FileExportJobFactory {\n \n-    protected final Parameter<Boolean> requireValidFile =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2abe7f48e7de831aa3832928d128ba1a3604976c"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0MjkwNTEy", "url": "https://github.com/scireum/sirius-biz/pull/913#pullrequestreview-534290512", "createdAt": "2020-11-19T10:43:36Z", "commit": {"oid": "2abe7f48e7de831aa3832928d128ba1a3604976c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMDo0MzozN1rOH2XAmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMDo0MzozN1rOH2XAmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc2MjEzNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        for (Consumer<BiConsumer<String, NodeHandler>> handlerConsumer : fetchHandlersList()) {\n          \n          \n            \n                        for (Consumer<BiConsumer<String, NodeHandler>> processingStage : fetchStages()) {", "url": "https://github.com/scireum/sirius-biz/pull/913#discussion_r526762137", "createdAt": "2020-11-19T10:43:37Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/jobs/batch/file/XMLImportJob.java", "diffHunk": "@@ -47,14 +49,21 @@\n      */\n     protected XMLImportJob(ProcessContext process) {\n         super(process);\n-        validationXsdPath = process.getParameter(XSD_SCHEMA_PARAMETER).orElse(null);\n+        validationXsdPath = process.get(XSD_SCHEMA_PARAMETER_NAME).asString();\n+    }\n+\n+    protected static SelectStringParameter createSchemaParameter() {\n+        return new SelectStringParameter(XSD_SCHEMA_PARAMETER_NAME, \"$XMLImportJobFactory.xsdSchema\").withDescription(\n+                \"$XMLImportJobFactory.xsdSchema.help\");\n     }\n \n     @Override\n     protected void executeForStream(String filename, Producer<InputStream> inputSupplier) throws Exception {\n         if (isValid(inputSupplier)) {\n-            try (InputStream inputStream = inputSupplier.create()) {\n-                executeForValidStream(inputStream);\n+            for (Consumer<BiConsumer<String, NodeHandler>> handlerConsumer : fetchHandlersList()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2abe7f48e7de831aa3832928d128ba1a3604976c"}, "originalPosition": 55}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0MjkwNzM0", "url": "https://github.com/scireum/sirius-biz/pull/913#pullrequestreview-534290734", "createdAt": "2020-11-19T10:43:53Z", "commit": {"oid": "2abe7f48e7de831aa3832928d128ba1a3604976c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMDo0Mzo1M1rOH2XBNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMDo0Mzo1M1rOH2XBNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc2MjI5NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                executeForValidStream(inputStream, handlerConsumer);\n          \n          \n            \n                                executeProcessingStage(inputStream, stage);", "url": "https://github.com/scireum/sirius-biz/pull/913#discussion_r526762295", "createdAt": "2020-11-19T10:43:53Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/jobs/batch/file/XMLImportJob.java", "diffHunk": "@@ -47,14 +49,21 @@\n      */\n     protected XMLImportJob(ProcessContext process) {\n         super(process);\n-        validationXsdPath = process.getParameter(XSD_SCHEMA_PARAMETER).orElse(null);\n+        validationXsdPath = process.get(XSD_SCHEMA_PARAMETER_NAME).asString();\n+    }\n+\n+    protected static SelectStringParameter createSchemaParameter() {\n+        return new SelectStringParameter(XSD_SCHEMA_PARAMETER_NAME, \"$XMLImportJobFactory.xsdSchema\").withDescription(\n+                \"$XMLImportJobFactory.xsdSchema.help\");\n     }\n \n     @Override\n     protected void executeForStream(String filename, Producer<InputStream> inputSupplier) throws Exception {\n         if (isValid(inputSupplier)) {\n-            try (InputStream inputStream = inputSupplier.create()) {\n-                executeForValidStream(inputStream);\n+            for (Consumer<BiConsumer<String, NodeHandler>> handlerConsumer : fetchHandlersList()) {\n+                try (InputStream inputStream = inputSupplier.create()) {\n+                    executeForValidStream(inputStream, handlerConsumer);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2abe7f48e7de831aa3832928d128ba1a3604976c"}, "originalPosition": 57}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0MjkxMDYy", "url": "https://github.com/scireum/sirius-biz/pull/913#pullrequestreview-534291062", "createdAt": "2020-11-19T10:44:19Z", "commit": {"oid": "2abe7f48e7de831aa3832928d128ba1a3604976c"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e491315996629e9b8b34e4e1bcda551e4d9adab7", "author": {"user": {"login": "idlira", "name": "Idevaldo De Lira"}}, "url": "https://github.com/scireum/sirius-biz/commit/e491315996629e9b8b34e4e1bcda551e4d9adab7", "committedDate": "2020-11-19T11:46:59Z", "message": "Simplifies declaration and usage of parameters\n\nFixes: OX-6341"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6076344ff30721951fd2d444f20186fbf485c177", "author": {"user": {"login": "idlira", "name": "Idevaldo De Lira"}}, "url": "https://github.com/scireum/sirius-biz/commit/6076344ff30721951fd2d444f20186fbf485c177", "committedDate": "2020-11-19T11:49:18Z", "message": "Skips unnecessary validation\n\nWhich is already performed by checkAndTransformValue. This way we can properly override job parameters with fresh created instances (as soon as they share the same name)\n\nFixes: OX-6341"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f4b50cb375c895f300d3d4e902120ae03ca5213", "author": {"user": {"login": "idlira", "name": "Idevaldo De Lira"}}, "url": "https://github.com/scireum/sirius-biz/commit/8f4b50cb375c895f300d3d4e902120ae03ca5213", "committedDate": "2020-11-19T11:53:51Z", "message": "Renames some methods\n\nCalling it \"stage\" each pass performed over an xml file\n\nFixes: OX-6341"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0MzU3NjU4", "url": "https://github.com/scireum/sirius-biz/pull/913#pullrequestreview-534357658", "createdAt": "2020-11-19T12:01:44Z", "commit": {"oid": "8f4b50cb375c895f300d3d4e902120ae03ca5213"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0MzY2MDI0", "url": "https://github.com/scireum/sirius-biz/pull/913#pullrequestreview-534366024", "createdAt": "2020-11-19T12:06:07Z", "commit": {"oid": "8f4b50cb375c895f300d3d4e902120ae03ca5213"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cf28e5e3dfd1cbc2262a5632123fa22b4c3c1b1", "author": {"user": {"login": "idlira", "name": "Idevaldo De Lira"}}, "url": "https://github.com/scireum/sirius-biz/commit/0cf28e5e3dfd1cbc2262a5632123fa22b4c3c1b1", "committedDate": "2020-11-19T12:06:32Z", "message": "Defaults to not validate when the parameters has not been collected\n\nFixes: OX-6341"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0MzczNzQ4", "url": "https://github.com/scireum/sirius-biz/pull/913#pullrequestreview-534373748", "createdAt": "2020-11-19T12:17:05Z", "commit": {"oid": "0cf28e5e3dfd1cbc2262a5632123fa22b4c3c1b1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0MzkzNTAz", "url": "https://github.com/scireum/sirius-biz/pull/913#pullrequestreview-534393503", "createdAt": "2020-11-19T12:33:33Z", "commit": {"oid": "0cf28e5e3dfd1cbc2262a5632123fa22b4c3c1b1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e6cf80164cee31e2abae5385c62ef78d07f629a", "author": {"user": {"login": "idlira", "name": "Idevaldo De Lira"}}, "url": "https://github.com/scireum/sirius-biz/commit/4e6cf80164cee31e2abae5385c62ef78d07f629a", "committedDate": "2020-11-19T12:43:04Z", "message": "Corrected JavaDoc\n\nFixes: OX-6341"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4251, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}