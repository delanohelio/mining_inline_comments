{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI3NDQ3ODg5", "number": 924, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxNDo1NDoyOFrOE9Q8Aw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxNDo1ODoxMFrOE9RC-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyNjc2MDk5OnYy", "diffSide": "RIGHT", "path": "src/main/java/sirius/biz/storage/layer3/VirtualFileSystem.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxNDo1NDoyOFrOH53DWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxNDo1NDoyOFrOH53DWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQzMjg1Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * {@link sirius.biz.storage.layer3.downlink.ssh.SSHServer} which grant access per FTP, SFTP or SCP.\n          \n          \n            \n                 * {@link sirius.biz.storage.layer3.downlink.ssh.SSHServer} which grants access per FTP, SFTP or SCP.", "url": "https://github.com/scireum/sirius-biz/pull/924#discussion_r530432857", "createdAt": "2020-11-25T14:54:28Z", "author": {"login": "mkeckmkeck"}, "path": "src/main/java/sirius/biz/storage/layer3/VirtualFileSystem.java", "diffHunk": "@@ -29,6 +29,12 @@\n @Register(classes = VirtualFileSystem.class)\n public class VirtualFileSystem {\n \n+    /**\n+     * Defines the name of the sub scope used by the {@link sirius.biz.storage.layer3.downlink.ftp.FTPServer} and\n+     * {@link sirius.biz.storage.layer3.downlink.ssh.SSHServer} which grant access per FTP, SFTP or SCP.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a4b4d4c824aa608be23a142fe03068c8fe4a293"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyNjc2NTg0OnYy", "diffSide": "RIGHT", "path": "src/main/java/sirius/biz/storage/layer3/downlink/ftp/BridgeUserManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxNDo1NToyNlrOH53GYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxNDo1NToyNlrOH53GYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQzMzYzMw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            throw new AuthenticationFailedException(\"The required sub scope is not enabled for this use.\");\n          \n          \n            \n                            throw new AuthenticationFailedException(\"The required sub scope is not enabled for this user.\");", "url": "https://github.com/scireum/sirius-biz/pull/924#discussion_r530433633", "createdAt": "2020-11-25T14:55:26Z", "author": {"login": "mkeckmkeck"}, "path": "src/main/java/sirius/biz/storage/layer3/downlink/ftp/BridgeUserManager.java", "diffHunk": "@@ -94,6 +95,11 @@ public BridgeUser authenticate(Authentication authentication) throws Authenticat\n                 StorageUtils.LOG.FINE(\"Layer 3/FTP: Invalid credentails...\");\n                 throw new AuthenticationFailedException(\"Invalid credentials.\");\n             }\n+\n+            if (!authUser.isSubScopeEnabled(VirtualFileSystem.SUB_SCOPE_VFS)) {\n+                throw new AuthenticationFailedException(\"The required sub scope is not enabled for this use.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a4b4d4c824aa608be23a142fe03068c8fe4a293"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyNjc3ODgyOnYy", "diffSide": "RIGHT", "path": "src/main/java/sirius/biz/storage/layer3/downlink/ssh/SSHServer.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxNDo1ODoxMFrOH53Oow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxNTowMTo1NVrOH53Zpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQzNTc0Nw==", "bodyText": "Maybe log on Info?", "url": "https://github.com/scireum/sirius-biz/pull/924#discussion_r530435747", "createdAt": "2020-11-25T14:58:10Z", "author": {"login": "mkeckmkeck"}, "path": "src/main/java/sirius/biz/storage/layer3/downlink/ssh/SSHServer.java", "diffHunk": "@@ -137,25 +137,34 @@ private boolean authenticate(String username, String password, ServerSession ses\n             username = scopeAndUsername.getSecond();\n         }\n \n-\n         boolean locked =\n                 UserContext.getCurrentScope().tryAs(MaintenanceInfo.class).map(MaintenanceInfo::isLocked).orElse(false);\n         if (locked) {\n             return false;\n         }\n \n         if (StorageUtils.LOG.isFINE()) {\n-            StorageUtils.LOG.FINE(\"Layer 3/FTP: Trying to authenticate user: \" + username);\n+            StorageUtils.LOG.FINE(\"Layer 3/SSH: Trying to authenticate user: \" + username);\n         }\n \n         UserInfo authUser = UserContext.get().getUserManager().findUserByCredentials(null, username, password);\n+\n+        if (authUser == null) {\n+            return false;\n+        }\n+\n+        if (!authUser.isSubScopeEnabled(VirtualFileSystem.SUB_SCOPE_VFS)) {\n+            StorageUtils.LOG.FINE(\"Layer 3/SSH: The required sub scope is not enabled for: \" + username);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a4b4d4c824aa608be23a142fe03068c8fe4a293"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQzODU2Nw==", "bodyText": "all other auth relevant messages are FINE as well therefore I used the same level here...", "url": "https://github.com/scireum/sirius-biz/pull/924#discussion_r530438567", "createdAt": "2020-11-25T15:01:55Z", "author": {"login": "andyHa"}, "path": "src/main/java/sirius/biz/storage/layer3/downlink/ssh/SSHServer.java", "diffHunk": "@@ -137,25 +137,34 @@ private boolean authenticate(String username, String password, ServerSession ses\n             username = scopeAndUsername.getSecond();\n         }\n \n-\n         boolean locked =\n                 UserContext.getCurrentScope().tryAs(MaintenanceInfo.class).map(MaintenanceInfo::isLocked).orElse(false);\n         if (locked) {\n             return false;\n         }\n \n         if (StorageUtils.LOG.isFINE()) {\n-            StorageUtils.LOG.FINE(\"Layer 3/FTP: Trying to authenticate user: \" + username);\n+            StorageUtils.LOG.FINE(\"Layer 3/SSH: Trying to authenticate user: \" + username);\n         }\n \n         UserInfo authUser = UserContext.get().getUserManager().findUserByCredentials(null, username, password);\n+\n+        if (authUser == null) {\n+            return false;\n+        }\n+\n+        if (!authUser.isSubScopeEnabled(VirtualFileSystem.SUB_SCOPE_VFS)) {\n+            StorageUtils.LOG.FINE(\"Layer 3/SSH: The required sub scope is not enabled for: \" + username);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQzNTc0Nw=="}, "originalCommit": {"oid": "4a4b4d4c824aa608be23a142fe03068c8fe4a293"}, "originalPosition": 39}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1860, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}