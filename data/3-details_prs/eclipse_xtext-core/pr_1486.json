{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2MDI0NTI3", "number": 1486, "title": "Added support for Java stub generation in the JUnitFragment", "bodyText": "junitSupport = {\n generateStub = false\n}\n\nNo stub is generated\njunitSupport = {\n generateStub = true\n}\n\nJUnit stub is generated in Xtend\njunitSupport = {\n generateStub = true\n generateXtendStub = true\n}\n\nJUnit stub is generated in Xtend\njunitSupport = {\n generateStub = true\n generateXtendStub = false\n}\n\nJUnit stub is generated in Java\nSigned-off-by: nbhusare neerajbhusare@gmail.com", "createdAt": "2020-05-11T10:49:08Z", "url": "https://github.com/eclipse/xtext-core/pull/1486", "merged": true, "mergeCommit": {"oid": "19606f4e5cb414f099b4743387c334542e653ecb"}, "closed": true, "closedAt": "2020-05-14T07:39:44Z", "author": {"login": "nbhusare"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgNqdUAFqTQwOTA3NDAwMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABchIf0tgFqTQxMTU0MDAyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MDc0MDAy", "url": "https://github.com/eclipse/xtext-core/pull/1486#pullrequestreview-409074002", "createdAt": "2020-05-11T11:06:47Z", "commit": {"oid": "2d3a34c94f06fc1736fbd36373763585ef2c90ae"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxMTowNjo0N1rOGTXlGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxMTowNjo0N1rOGTXlGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjk2MjQ1OQ==", "bodyText": "wonder if we should call super.setGenerateXtendStub too", "url": "https://github.com/eclipse/xtext-core/pull/1486#discussion_r422962459", "createdAt": "2020-05-11T11:06:47Z", "author": {"login": "cdietrich"}, "path": "org.eclipse.xtext.xtext.generator/src/org/eclipse/xtext/xtext/generator/junit/JUnitFragment.xtend", "diffHunk": "@@ -18,40 +18,51 @@ import org.eclipse.xtext.xtext.generator.XtextGeneratorNaming\n import org.eclipse.xtext.xtext.generator.model.FileAccessFactory\n import org.eclipse.xtext.xtext.generator.model.JavaFileAccess\n import org.eclipse.xtext.xtext.generator.model.TypeReference\n+import org.eclipse.xtext.xtext.generator.util.BooleanGeneratorOption\n \n import static extension org.eclipse.xtext.GrammarUtil.*\n \n /**\n  * @since 2.14\n  */\n class JUnitFragment extends AbstractStubGeneratingFragment {\n-\t\n+\n \t@Inject extension XtextGeneratorNaming\n \t@Inject FileAccessFactory fileAccessFactory\n-\t\n+\n \t@Accessors(PUBLIC_SETTER)\n \tboolean useDeprecatedClasses\n-\t\n+\n \t@Accessors(PUBLIC_SETTER)\n \tboolean skipXbaseTestingPackage\n-\t\n+\n \tJUnitVersion junitVersion = JUnitVersion.JUNIT_4\n \t\n-\tdef void setJunitVersion (String version) {\n-\t\tjunitVersion = JUnitVersion.fromString(version)\n+\tfinal BooleanGeneratorOption generateXtendStub = new BooleanGeneratorOption(true);\n+\t\n+\toverride boolean isGenerateXtendStub() {\n+\t\treturn generateXtendStub.get();\n \t}\n \t\n+\toverride setGenerateXtendStub(boolean generateXtendStub) {\n+\t\tthis.generateXtendStub.set(generateXtendStub);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d3a34c94f06fc1736fbd36373763585ef2c90ae"}, "originalPosition": 49}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MjI4NTkw", "url": "https://github.com/eclipse/xtext-core/pull/1486#pullrequestreview-409228590", "createdAt": "2020-05-11T14:31:20Z", "commit": {"oid": "2d3a34c94f06fc1736fbd36373763585ef2c90ae"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNDozMToyMFrOGTe63Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNDozMToyMFrOGTe63Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzA4MjcxNw==", "bodyText": "This field here smells like a hack.\nCan we instead call setGenerateXtendStub(false) from our constructor and use the BooleanGenOption from the super class?", "url": "https://github.com/eclipse/xtext-core/pull/1486#discussion_r423082717", "createdAt": "2020-05-11T14:31:20Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.xtext.generator/src/org/eclipse/xtext/xtext/generator/junit/JUnitFragment.xtend", "diffHunk": "@@ -18,40 +18,51 @@ import org.eclipse.xtext.xtext.generator.XtextGeneratorNaming\n import org.eclipse.xtext.xtext.generator.model.FileAccessFactory\n import org.eclipse.xtext.xtext.generator.model.JavaFileAccess\n import org.eclipse.xtext.xtext.generator.model.TypeReference\n+import org.eclipse.xtext.xtext.generator.util.BooleanGeneratorOption\n \n import static extension org.eclipse.xtext.GrammarUtil.*\n \n /**\n  * @since 2.14\n  */\n class JUnitFragment extends AbstractStubGeneratingFragment {\n-\t\n+\n \t@Inject extension XtextGeneratorNaming\n \t@Inject FileAccessFactory fileAccessFactory\n-\t\n+\n \t@Accessors(PUBLIC_SETTER)\n \tboolean useDeprecatedClasses\n-\t\n+\n \t@Accessors(PUBLIC_SETTER)\n \tboolean skipXbaseTestingPackage\n-\t\n+\n \tJUnitVersion junitVersion = JUnitVersion.JUNIT_4\n \t\n-\tdef void setJunitVersion (String version) {\n-\t\tjunitVersion = JUnitVersion.fromString(version)\n+\tfinal BooleanGeneratorOption generateXtendStub = new BooleanGeneratorOption(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d3a34c94f06fc1736fbd36373763585ef2c90ae"}, "originalPosition": 42}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2d3a34c94f06fc1736fbd36373763585ef2c90ae", "author": {"user": {"login": "nbhusare", "name": "Neeraj Bhusare"}}, "url": "https://github.com/eclipse/xtext-core/commit/2d3a34c94f06fc1736fbd36373763585ef2c90ae", "committedDate": "2020-05-11T10:40:29Z", "message": "Added support for Java stub generation\n\nSigned-off-by: nbhusare <neerajbhusare@gmail.com>"}, "afterCommit": {"oid": "ad35a77cb65d9e1747923650df223576c9d18858", "author": {"user": {"login": "nbhusare", "name": "Neeraj Bhusare"}}, "url": "https://github.com/eclipse/xtext-core/commit/ad35a77cb65d9e1747923650df223576c9d18858", "committedDate": "2020-05-12T08:32:21Z", "message": "Added support for Java stub generation\n\nSigned-off-by: nbhusare <neerajbhusare@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5ODU3NzAy", "url": "https://github.com/eclipse/xtext-core/pull/1486#pullrequestreview-409857702", "createdAt": "2020-05-12T09:21:47Z", "commit": {"oid": "ad35a77cb65d9e1747923650df223576c9d18858"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwOToyMTo0N1rOGT94Rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwOToyMjoyNFrOGT95vw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU4OTk1OA==", "bodyText": "A small comment why this was done could be helpful since we don't have decent test coverage", "url": "https://github.com/eclipse/xtext-core/pull/1486#discussion_r423589958", "createdAt": "2020-05-12T09:21:47Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.xtext.generator/src/org/eclipse/xtext/xtext/generator/junit/JUnitFragment.xtend", "diffHunk": "@@ -25,33 +25,38 @@ import static extension org.eclipse.xtext.GrammarUtil.*\n  * @since 2.14\n  */\n class JUnitFragment extends AbstractStubGeneratingFragment {\n-\t\n+\n \t@Inject extension XtextGeneratorNaming\n \t@Inject FileAccessFactory fileAccessFactory\n-\t\n+\n \t@Accessors(PUBLIC_SETTER)\n \tboolean useDeprecatedClasses\n-\t\n+\n \t@Accessors(PUBLIC_SETTER)\n \tboolean skipXbaseTestingPackage\n-\t\n+\n \tJUnitVersion junitVersion = JUnitVersion.JUNIT_4\n \t\n-\tdef void setJunitVersion (String version) {\n-\t\tjunitVersion = JUnitVersion.fromString(version)\n+\t\n+\tnew() {\n+\t\tgenerateXtendStub = true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad35a77cb65d9e1747923650df223576c9d18858"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU5MDMzNQ==", "bodyText": "Shall we create Strings.join(..) instead?", "url": "https://github.com/eclipse/xtext-core/pull/1486#discussion_r423590335", "createdAt": "2020-05-12T09:22:24Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.xtext.generator/src/org/eclipse/xtext/xtext/generator/junit/JUnitFragment.xtend", "diffHunk": "@@ -147,7 +157,54 @@ class JUnitFragment extends AbstractStubGeneratingFragment {\n \t\t\t}\n \t\t''')\n \t}\n-\t\n+\n+\tdef protected JavaFileAccess generateJavaExampleRuntimeTest() {\n+\t\tval xtextRunner = new TypeReference(testingPackage + \".XtextRunner\")\n+\t\tval runWith = new TypeReference(\"org.junit.runner.RunWith\")\n+\t\tval extendWith = new TypeReference(\"org.junit.jupiter.api.extension.ExtendWith\")\n+\t\tval injectionExtension = new TypeReference(\"org.eclipse.xtext.testing.extensions.InjectionExtension\")\n+\t\tval injectWith = new TypeReference(testingPackage + \".InjectWith\")\n+\t\tval parseHelper = new TypeReference(testingPackage + \".util.ParseHelper\")\n+\t\tval test = switch (junitVersion) {\n+\t\t\tcase JUnitVersion.JUNIT_4: new TypeReference(\"org.junit.Test\")\n+\t\t\tcase JUnitVersion.JUNIT_5: new TypeReference(\"org.junit.jupiter.api.Test\")\n+\t\t}\n+\t\tval assert = switch (junitVersion) {\n+\t\t\tcase JUnitVersion.JUNIT_4: new TypeReference(\"org.junit.Assert\")\n+\t\t\tcase JUnitVersion.JUNIT_5: new TypeReference(\"org.junit.jupiter.api.Assertions\")\n+\t\t}\n+\t\tval rootType = new TypeReference(grammar.rules.head.type.classifier as EClass, grammar.eResource.resourceSet)\n+\t\tval list = new TypeReference(\"java.util.List\")\n+\t\tval diagnostic = new TypeReference(\"org.eclipse.emf.ecore.resource\", \"Resource.Diagnostic\")\n+\t\tval iterableExtensions = new TypeReference(\"org.eclipse.xtext.xbase.lib.IterableExtensions\")\n+\t\treturn fileAccessFactory.createJavaFile(exampleRuntimeTest, '''\n+\t\t\t\ufffdIF junitVersion==JUnitVersion.JUNIT_4\ufffd\n+\t\t\t\t@\ufffdrunWith\ufffd(\ufffdxtextRunner\ufffd.class)\n+\t\t\t\ufffdENDIF\ufffd\n+\t\t\t\ufffdIF junitVersion==JUnitVersion.JUNIT_5\ufffd\n+\t\t\t\t@\ufffdextendWith\ufffd(\ufffdinjectionExtension\ufffd.class)\n+\t\t\t\ufffdENDIF\ufffd\n+\t\t\t@\ufffdinjectWith\ufffd(\ufffdinjectorProvider\ufffd.class)\n+\t\t\tpublic class \ufffdexampleRuntimeTest\ufffd {\n+\t\t\t\t@\ufffdInject\ufffd\n+\t\t\t\tprivate \ufffdparseHelper\ufffd<\ufffdrootType\ufffd> parseHelper;\n+\t\t\t\t\n+\t\t\t\t@\ufffdtest\ufffd\n+\t\t\t\tpublic void loadModel() throws Exception {\n+\t\t\t\t\tModel result = parseHelper.parse(\"Hello Xtext!\");\n+\t\t\t\t\t\ufffdassert\ufffd.assertNotNull(result);\n+\t\t\t\t\t\ufffdlist\ufffd<\ufffddiagnostic\ufffd> errors = result.eResource().getErrors();\n+\t\t\t\t\t\ufffdIF junitVersion==JUnitVersion.JUNIT_4\ufffd\n+\t\t\t\t\t\t\ufffdassert\ufffd.assertTrue(\"Unexpected errors: \" + \ufffditerableExtensions\ufffd.join(errors, \", \"), errors.isEmpty());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad35a77cb65d9e1747923650df223576c9d18858"}, "originalPosition": 165}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6490c2070deb0755f8c0e11aa4b5c36717ed41aa", "author": {"user": {"login": "nbhusare", "name": "Neeraj Bhusare"}}, "url": "https://github.com/eclipse/xtext-core/commit/6490c2070deb0755f8c0e11aa4b5c36717ed41aa", "committedDate": "2020-05-12T13:37:28Z", "message": "Added support for Java stub generation\n\nSigned-off-by: nbhusare <neerajbhusare@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ad35a77cb65d9e1747923650df223576c9d18858", "author": {"user": {"login": "nbhusare", "name": "Neeraj Bhusare"}}, "url": "https://github.com/eclipse/xtext-core/commit/ad35a77cb65d9e1747923650df223576c9d18858", "committedDate": "2020-05-12T08:32:21Z", "message": "Added support for Java stub generation\n\nSigned-off-by: nbhusare <neerajbhusare@gmail.com>"}, "afterCommit": {"oid": "6490c2070deb0755f8c0e11aa4b5c36717ed41aa", "author": {"user": {"login": "nbhusare", "name": "Neeraj Bhusare"}}, "url": "https://github.com/eclipse/xtext-core/commit/6490c2070deb0755f8c0e11aa4b5c36717ed41aa", "committedDate": "2020-05-12T13:37:28Z", "message": "Added support for Java stub generation\n\nSigned-off-by: nbhusare <neerajbhusare@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExNTQwMDI3", "url": "https://github.com/eclipse/xtext-core/pull/1486#pullrequestreview-411540027", "createdAt": "2020-05-14T07:39:35Z", "commit": {"oid": "6490c2070deb0755f8c0e11aa4b5c36717ed41aa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4791, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}