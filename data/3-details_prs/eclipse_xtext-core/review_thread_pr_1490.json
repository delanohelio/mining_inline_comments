{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2Mjc0NjEx", "number": 1490, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxODo1MDozNVrOD7XKoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNjo0OTo0MlrOD7g0vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNTcyMTI4OnYy", "diffSide": "RIGHT", "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/rename/RenameService2.xtend", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxODo1MDozNVrOGTo-wQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzozMjo0NVrOGT5tEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI0NzU1Mw==", "bodyText": "shouldt we consult linkingHelper.getRuleNameFrom(updatable.getCrossReference()) e.g. as in referenceupdater.getQualifiedName", "url": "https://github.com/eclipse/xtext-core/pull/1490#discussion_r423247553", "createdAt": "2020-05-11T18:50:35Z", "author": {"login": "cdietrich"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/rename/RenameService2.xtend", "diffHunk": "@@ -219,6 +222,14 @@ class RenameService2 implements IRenameService2 {\n \t\treturn null\n \t}\n \n+\tprotected def String getConvertedValue(EObject grammarElement, ILeafNode leaf) {\n+\t\tswitch (grammarElement) {\n+\t\t\tRuleCall: valueConverterService.toValue(leaf.text, grammarElement.rule.name, leaf).toString()\n+\t\t\tCrossReference: getConvertedValue(grammarElement.terminal, leaf)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "afe2878506ea5e8ec2367401ab843130120bf1c6"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUwMDA5Mg==", "bodyText": "Maybe even use org.eclipse.xtext.linking.impl.LinkingHelper.getCrossRefNodeAsString(INode, boolean) and find a proper cross ref node starting at the leaf node.", "url": "https://github.com/eclipse/xtext-core/pull/1490#discussion_r423500092", "createdAt": "2020-05-12T06:50:51Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/rename/RenameService2.xtend", "diffHunk": "@@ -219,6 +222,14 @@ class RenameService2 implements IRenameService2 {\n \t\treturn null\n \t}\n \n+\tprotected def String getConvertedValue(EObject grammarElement, ILeafNode leaf) {\n+\t\tswitch (grammarElement) {\n+\t\t\tRuleCall: valueConverterService.toValue(leaf.text, grammarElement.rule.name, leaf).toString()\n+\t\t\tCrossReference: getConvertedValue(grammarElement.terminal, leaf)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI0NzU1Mw=="}, "originalCommit": {"oid": "afe2878506ea5e8ec2367401ab843130120bf1c6"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUyMTU1Mw==", "bodyText": "As you wish.", "url": "https://github.com/eclipse/xtext-core/pull/1490#discussion_r423521553", "createdAt": "2020-05-12T07:32:45Z", "author": {"login": "JanKoehnlein"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/rename/RenameService2.xtend", "diffHunk": "@@ -219,6 +222,14 @@ class RenameService2 implements IRenameService2 {\n \t\treturn null\n \t}\n \n+\tprotected def String getConvertedValue(EObject grammarElement, ILeafNode leaf) {\n+\t\tswitch (grammarElement) {\n+\t\t\tRuleCall: valueConverterService.toValue(leaf.text, grammarElement.rule.name, leaf).toString()\n+\t\t\tCrossReference: getConvertedValue(grammarElement.terminal, leaf)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI0NzU1Mw=="}, "originalCommit": {"oid": "afe2878506ea5e8ec2367401ab843130120bf1c6"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNzI4OTA4OnYy", "diffSide": "RIGHT", "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/rename/RenameService2.xtend", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNjo0NDoyMFrOGT4N7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzozMzowNlrOGT5t9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQ5NzE5OA==", "bodyText": "Probably beyond this small bugfix here, but the rename infrastructure appears to be based on the assumption that IDs are comprised of leaf nodes and ignores the fact that MyId: ID | 'someKeyword'; or VersionedId: ID '-''(' INT ')'; are valid identifiers, too.", "url": "https://github.com/eclipse/xtext-core/pull/1490#discussion_r423497198", "createdAt": "2020-05-12T06:44:20Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/rename/RenameService2.xtend", "diffHunk": "@@ -197,11 +200,11 @@ class RenameService2 implements IRenameService2 {\n \t\t\t\t\tif (element !== null && !element.eIsProxy) {\n \t\t\t\t\t\tval leaf = NodeModelUtils.findLeafNodeAtOffset(rootNode, candidateOffset)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "afe2878506ea5e8ec2367401ab843130120bf1c6"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUyMTc4MA==", "bodyText": "The truth is, quoted IDs don't even work with qualified names (as a datatype rule), unless you have registered a special value converter. My goal was to cover the basic behavior of the default ID rule. I think the method doPrepareRename is small enough to be overridden for more specific use cases.", "url": "https://github.com/eclipse/xtext-core/pull/1490#discussion_r423521780", "createdAt": "2020-05-12T07:33:06Z", "author": {"login": "JanKoehnlein"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/rename/RenameService2.xtend", "diffHunk": "@@ -197,11 +200,11 @@ class RenameService2 implements IRenameService2 {\n \t\t\t\t\tif (element !== null && !element.eIsProxy) {\n \t\t\t\t\t\tval leaf = NodeModelUtils.findLeafNodeAtOffset(rootNode, candidateOffset)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQ5NzE5OA=="}, "originalCommit": {"oid": "afe2878506ea5e8ec2367401ab843130120bf1c6"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNzI5MjU0OnYy", "diffSide": "RIGHT", "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/rename/RenameService2.xtend", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNjo0NTozM1rOGT4QEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzozMzoxNVrOGT5uOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQ5Nzc0NQ==", "bodyText": "Given that this is already quite a bit of complexity in the logic, please change the variable name to better reflect what it is now.", "url": "https://github.com/eclipse/xtext-core/pull/1490#discussion_r423497745", "createdAt": "2020-05-12T06:45:33Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/rename/RenameService2.xtend", "diffHunk": "@@ -197,11 +200,11 @@ class RenameService2 implements IRenameService2 {\n \t\t\t\t\tif (element !== null && !element.eIsProxy) {\n \t\t\t\t\t\tval leaf = NodeModelUtils.findLeafNodeAtOffset(rootNode, candidateOffset)\n \t\t\t\t\t\tif (leaf !== null && leaf.isIdentifier) {\n-\t\t\t\t\t\t\tval leafText = NodeModelUtils.getTokenText(leaf)\n+\t\t\t\t\t\t\tval leafText = getConvertedValue(leaf.grammarElement, leaf)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "afe2878506ea5e8ec2367401ab843130120bf1c6"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUyMTg0OA==", "bodyText": "Done_", "url": "https://github.com/eclipse/xtext-core/pull/1490#discussion_r423521848", "createdAt": "2020-05-12T07:33:15Z", "author": {"login": "JanKoehnlein"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/rename/RenameService2.xtend", "diffHunk": "@@ -197,11 +200,11 @@ class RenameService2 implements IRenameService2 {\n \t\t\t\t\tif (element !== null && !element.eIsProxy) {\n \t\t\t\t\t\tval leaf = NodeModelUtils.findLeafNodeAtOffset(rootNode, candidateOffset)\n \t\t\t\t\t\tif (leaf !== null && leaf.isIdentifier) {\n-\t\t\t\t\t\t\tval leafText = NodeModelUtils.getTokenText(leaf)\n+\t\t\t\t\t\t\tval leafText = getConvertedValue(leaf.grammarElement, leaf)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQ5Nzc0NQ=="}, "originalCommit": {"oid": "afe2878506ea5e8ec2367401ab843130120bf1c6"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNzMwMzY2OnYy", "diffSide": "RIGHT", "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/rename/RenameService2.xtend", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNjo0OTo0MlrOGT4XNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzo0MDozM1rOGT59pw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQ5OTU3NQ==", "bodyText": "toValue() on a leaf node could throw a value converter exception if the leaf node was used in a data type rule e.g.\nIntAsID: INT; with 999999999999999999.\nThe value converter exception is not caught / handled in doPrepareRename", "url": "https://github.com/eclipse/xtext-core/pull/1490#discussion_r423499575", "createdAt": "2020-05-12T06:49:42Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/rename/RenameService2.xtend", "diffHunk": "@@ -219,6 +222,14 @@ class RenameService2 implements IRenameService2 {\n \t\treturn null\n \t}\n \n+\tprotected def String getConvertedValue(EObject grammarElement, ILeafNode leaf) {\n+\t\tswitch (grammarElement) {\n+\t\t\tRuleCall: valueConverterService.toValue(leaf.text, grammarElement.rule.name, leaf).toString()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "afe2878506ea5e8ec2367401ab843130120bf1c6"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUyNTc5OQ==", "bodyText": "Would you really expect rename to work OOTB when integers are used as names?\nAnyway, I added some code to handle this.", "url": "https://github.com/eclipse/xtext-core/pull/1490#discussion_r423525799", "createdAt": "2020-05-12T07:40:33Z", "author": {"login": "JanKoehnlein"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/rename/RenameService2.xtend", "diffHunk": "@@ -219,6 +222,14 @@ class RenameService2 implements IRenameService2 {\n \t\treturn null\n \t}\n \n+\tprotected def String getConvertedValue(EObject grammarElement, ILeafNode leaf) {\n+\t\tswitch (grammarElement) {\n+\t\t\tRuleCall: valueConverterService.toValue(leaf.text, grammarElement.rule.name, leaf).toString()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQ5OTU3NQ=="}, "originalCommit": {"oid": "afe2878506ea5e8ec2367401ab843130120bf1c6"}, "originalPosition": 37}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1125, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}