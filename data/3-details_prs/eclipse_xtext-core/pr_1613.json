{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2NTg2NjIx", "number": 1613, "title": "Java based formatter2 API and Xtext formatter", "bodyText": "Not yet complete. Wait with merging before everything is done. But can be already reviewed to a certain degree.", "createdAt": "2020-11-06T08:24:35Z", "url": "https://github.com/eclipse/xtext-core/pull/1613", "merged": true, "mergeCommit": {"oid": "14c2ec10f3dd679a7d959c287f861d571d1e7ddc"}, "closed": true, "closedAt": "2020-11-16T08:47:07Z", "author": {"login": "ArneDeutsch"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZzbirgFqTUyNDk3OTY4Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABddAz58ABqjM5OTkwNTAwNjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0OTc5Njgz", "url": "https://github.com/eclipse/xtext-core/pull/1613#pullrequestreview-524979683", "createdAt": "2020-11-06T09:20:35Z", "commit": {"oid": "d7c9adaa595ff54bcc448efa2d40fa29a8f70120"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwOToyMDozNVrOHumHaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwOToyMDozNVrOHumHaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODYyMTAzNQ==", "bodyText": "FormatterTestLanguageJavaFormatter?", "url": "https://github.com/eclipse/xtext-core/pull/1613#discussion_r518621035", "createdAt": "2020-11-06T09:20:35Z", "author": {"login": "cdietrich"}, "path": "org.eclipse.xtext.tests/src/org/eclipse/xtext/formatting2/internal/JavaFormatter.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 itemis AG (http://www.itemis.eu) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.formatting2.internal;\n+\n+import org.eclipse.xtext.formatting2.AbstractJavaFormatter;\n+import org.eclipse.xtext.formatting2.IFormattableDocument;\n+import org.eclipse.xtext.formatting2.internal.formattertestlanguage.IDList;\n+import org.eclipse.xtext.formatting2.internal.services.FormatterTestLanguageGrammarAccess;\n+\n+import com.google.inject.Inject;\n+\n+/**\n+ * @author Arne Deutsch - Initial contribution and API\n+ */\n+public class JavaFormatter extends AbstractJavaFormatter {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7c9adaa595ff54bcc448efa2d40fa29a8f70120"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0OTgwNTUz", "url": "https://github.com/eclipse/xtext-core/pull/1613#pullrequestreview-524980553", "createdAt": "2020-11-06T09:21:51Z", "commit": {"oid": "d7c9adaa595ff54bcc448efa2d40fa29a8f70120"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwOToyMTo1MlrOHumKLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwOToyMTo1MlrOHumKLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODYyMTc0MQ==", "bodyText": "add @since 2.24 to class", "url": "https://github.com/eclipse/xtext-core/pull/1613#discussion_r518621741", "createdAt": "2020-11-06T09:21:52Z", "author": {"login": "cdietrich"}, "path": "org.eclipse.xtext/src/org/eclipse/xtext/formatting2/AbstractJavaFormatter.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 itemis AG (http://www.itemis.eu) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.formatting2;\n+\n+import java.util.Collections;\n+\n+import org.eclipse.emf.ecore.EObject;\n+import org.eclipse.xtext.formatting2.regionaccess.IEObjectRegion;\n+import org.eclipse.xtext.formatting2.regionaccess.IHiddenRegion;\n+import org.eclipse.xtext.formatting2.regionaccess.ISemanticRegion;\n+import org.eclipse.xtext.formatting2.regionaccess.ISemanticRegionFinder;\n+import org.eclipse.xtext.formatting2.regionaccess.ISemanticRegionsFinder;\n+import org.eclipse.xtext.resource.XtextResource;\n+import org.eclipse.xtext.util.Exceptions;\n+import org.eclipse.xtext.util.PolymorphicDispatcher;\n+import org.eclipse.xtext.util.PolymorphicDispatcher.ErrorHandler;\n+\n+import com.google.common.annotations.Beta;\n+\n+/**\n+ * <p>\n+ * This is an abstract base class for language-specific formatters, intended to be extended with a java class.\n+ * </p>\n+ * <p>\n+ * It is working very much like {@link AbstractFormatter2} but does support additional methods to simplify java\n+ * formatter code.\n+ * </p>\n+ * <p>\n+ * the \"_format\" methods are called by reflection. The name is important as well as there are exactly two arguments\n+ * whereas the first one is of the element type you like to format and the second one of type\n+ * {@link IFormattableDocument}. The methods should be protected.\n+ * </p>\n+ * <p>\n+ * Example code for a java formatter:\n+ * \n+ * <pre>\n+ * import static org.xtext.example.mydsl.myDsl.MyDslPackage.Literals.*;\n+ * \n+ * public class MyDslFormatter2 extends AbstractJavaFormatter {\n+ * \tprotected void _format(Model model, IFormattableDocument doc) {\n+ * \t\tfor (Parent parent : model.getParents())\n+ * \t\t\tdoc.format(parent);\n+ * \t}\n+ * \n+ * \tprotected void _format(Parent parent, IFormattableDocument doc) {\n+ * \t\tdoc.prepend(regionFor(parent).keyword(\"parent\"), it -> it.noSpace());\n+ * \t\tdoc.append(regionFor(parent).keyword(\"parent\"), it -> it.oneSpace());\n+ * \t\tdoc.append(regionFor(parent).feature(PARENT__NAME), it -> it.oneSpace());\n+ * \t\tdoc.prepend(regionFor(parent).keyword(\"{\"), it -> it.oneSpace());\n+ * \t\tdoc.append(regionFor(parent).keyword(\"{\"), it -> it.newLine());\n+ * \t\tdoc.interior(regionFor(parent).keyword(\"{\"), regionFor(parent).keyword(\"}\"), it -> it.indent());\n+ * \t\tdoc.append(regionFor(parent).keyword(\"}\"), it -> it.setNewLines(1, 1, 2));\n+ * \t\tfor (Child child : parent.getChildren())\n+ * \t\t\tdoc.format(child);\n+ * \t}\n+ * \n+ * \tprotected void _format(Child child, IFormattableDocument doc) {\n+ * \t\tdoc.append(regionFor(child).keyword(\"child\"), it -> it.oneSpace());\n+ * \t\tdoc.append(regionFor(child).feature(CHILD__NAME), it -> it.newLine());\n+ * \t}\n+ * }\n+ * </pre>\n+ * </p>\n+ * <p>\n+ * This is suitable for the following grammar:\n+ * \n+ * <pre>\n+ * grammar org.xtext.example.mydsl.MyDsl with org.eclipse.xtext.common.Terminals\n+ * \n+ * generate myDsl \"http://www.xtext.org/example/mydsl/MyDsl\"\n+ * \n+ * Model: parents+=Parent*;\n+ * Parent: 'parent' name=ID '!' ('{' children+=Child* '}')?;\n+ * Child: 'child' name=ID;\n+ * </pre>\n+ * </p>\n+ */\n+@Beta", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7c9adaa595ff54bcc448efa2d40fa29a8f70120"}, "originalPosition": 84}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MjQxODg2", "url": "https://github.com/eclipse/xtext-core/pull/1613#pullrequestreview-525241886", "createdAt": "2020-11-06T15:12:01Z", "commit": {"oid": "2c57b15e9666c2510b96c98a26da244b5ac85b9d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNToxMjowMVrOHux5aQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNToxMjowMVrOHux5aQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgxNDA1Nw==", "bodyText": "api change?", "url": "https://github.com/eclipse/xtext-core/pull/1613#discussion_r518814057", "createdAt": "2020-11-06T15:12:01Z", "author": {"login": "cdietrich"}, "path": "org.eclipse.xtext.xtext.generator/src/org/eclipse/xtext/xtext/generator/formatting/Formatter2Fragment2.xtend", "diffHunk": "@@ -72,11 +73,11 @@ class Formatter2Fragment2 extends AbstractStubGeneratingFragment {\n \t}\n \n \tprotected def doGenerateStubFile() {\n-\t\tval xtendFile = doGetXtendStubFile\n-\t\txtendFile?.writeTo(projectConfig.runtime.src)\n+\t\tval file = doGetStubFile\n+\t\tfile?.writeTo(projectConfig.runtime.src)\n \t}\n \n-\tprotected def doGetXtendStubFile() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c57b15e9666c2510b96c98a26da244b5ac85b9d"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MjQyNjIx", "url": "https://github.com/eclipse/xtext-core/pull/1613#pullrequestreview-525242621", "createdAt": "2020-11-06T15:12:51Z", "commit": {"oid": "2c57b15e9666c2510b96c98a26da244b5ac85b9d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNToxMjo1MlrOHux7iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNToxMjo1MlrOHux7iw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgxNDYwMw==", "bodyText": "intended?", "url": "https://github.com/eclipse/xtext-core/pull/1613#discussion_r518814603", "createdAt": "2020-11-06T15:12:52Z", "author": {"login": "cdietrich"}, "path": "org.eclipse.xtext/META-INF/MANIFEST.MF", "diffHunk": "@@ -54,17 +41,7 @@ Export-Package: org.eclipse.xtext,\n    org.eclipse.xtext.tests\",\n  org.eclipse.xtext.formatting2.internal;x-friends:=\"org.eclipse.xtext.tests,\n    org.eclipse.xtend.core\",\n- org.eclipse.xtext.formatting2.regionaccess;x-friends:=\"org.eclipse.xtext.ide,\n-   org.eclipse.xtext.ide.tests,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c57b15e9666c2510b96c98a26da244b5ac85b9d"}, "originalPosition": 27}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2c57b15e9666c2510b96c98a26da244b5ac85b9d", "author": {"user": {"login": "ArneDeutsch", "name": "Arne Deutsch"}}, "url": "https://github.com/eclipse/xtext-core/commit/2c57b15e9666c2510b96c98a26da244b5ac85b9d", "committedDate": "2020-11-06T15:08:18Z", "message": "Review adaptions.\n\nSigned-off-by: Arne Deutsch <Arne.Deutsch@itemis.de>"}, "afterCommit": {"oid": "a2c79c9da75c4d24b28561be8f53b93c63475432", "author": {"user": {"login": "ArneDeutsch", "name": "Arne Deutsch"}}, "url": "https://github.com/eclipse/xtext-core/commit/a2c79c9da75c4d24b28561be8f53b93c63475432", "committedDate": "2020-11-06T15:25:06Z", "message": "Review adaptions.\n\nSigned-off-by: Arne Deutsch <Arne.Deutsch@itemis.de>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a2c79c9da75c4d24b28561be8f53b93c63475432", "author": {"user": {"login": "ArneDeutsch", "name": "Arne Deutsch"}}, "url": "https://github.com/eclipse/xtext-core/commit/a2c79c9da75c4d24b28561be8f53b93c63475432", "committedDate": "2020-11-06T15:25:06Z", "message": "Review adaptions.\n\nSigned-off-by: Arne Deutsch <Arne.Deutsch@itemis.de>"}, "afterCommit": {"oid": "15b7f0603b9b4a3c1fa9674e40d882d5d74adb4d", "author": {"user": {"login": "ArneDeutsch", "name": "Arne Deutsch"}}, "url": "https://github.com/eclipse/xtext-core/commit/15b7f0603b9b4a3c1fa9674e40d882d5d74adb4d", "committedDate": "2020-11-06T15:32:56Z", "message": "Review adaptions.\n\nSigned-off-by: Arne Deutsch <Arne.Deutsch@itemis.de>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "15b7f0603b9b4a3c1fa9674e40d882d5d74adb4d", "author": {"user": {"login": "ArneDeutsch", "name": "Arne Deutsch"}}, "url": "https://github.com/eclipse/xtext-core/commit/15b7f0603b9b4a3c1fa9674e40d882d5d74adb4d", "committedDate": "2020-11-06T15:32:56Z", "message": "Review adaptions.\n\nSigned-off-by: Arne Deutsch <Arne.Deutsch@itemis.de>"}, "afterCommit": {"oid": "cd6cff9c8b4d0260370c315ed5990bd158065a30", "author": {"user": {"login": "ArneDeutsch", "name": "Arne Deutsch"}}, "url": "https://github.com/eclipse/xtext-core/commit/cd6cff9c8b4d0260370c315ed5990bd158065a30", "committedDate": "2020-11-06T15:42:05Z", "message": "Review adaptions.\n\nSigned-off-by: Arne Deutsch <Arne.Deutsch@itemis.de>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cd6cff9c8b4d0260370c315ed5990bd158065a30", "author": {"user": {"login": "ArneDeutsch", "name": "Arne Deutsch"}}, "url": "https://github.com/eclipse/xtext-core/commit/cd6cff9c8b4d0260370c315ed5990bd158065a30", "committedDate": "2020-11-06T15:42:05Z", "message": "Review adaptions.\n\nSigned-off-by: Arne Deutsch <Arne.Deutsch@itemis.de>"}, "afterCommit": {"oid": "f1cc75a192a65128aa66f1fa5865c18cb93ddb19", "author": {"user": {"login": "ArneDeutsch", "name": "Arne Deutsch"}}, "url": "https://github.com/eclipse/xtext-core/commit/f1cc75a192a65128aa66f1fa5865c18cb93ddb19", "committedDate": "2020-11-06T16:16:49Z", "message": "Review adaptions.\n\nSigned-off-by: Arne Deutsch <Arne.Deutsch@itemis.de>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f1cc75a192a65128aa66f1fa5865c18cb93ddb19", "author": {"user": {"login": "ArneDeutsch", "name": "Arne Deutsch"}}, "url": "https://github.com/eclipse/xtext-core/commit/f1cc75a192a65128aa66f1fa5865c18cb93ddb19", "committedDate": "2020-11-06T16:16:49Z", "message": "Review adaptions.\n\nSigned-off-by: Arne Deutsch <Arne.Deutsch@itemis.de>"}, "afterCommit": {"oid": "8ef51221232d8954bf64f27b72e055034cc76bcd", "author": {"user": {"login": "ArneDeutsch", "name": "Arne Deutsch"}}, "url": "https://github.com/eclipse/xtext-core/commit/8ef51221232d8954bf64f27b72e055034cc76bcd", "committedDate": "2020-11-06T16:26:51Z", "message": "Review adaptions.\n\nSigned-off-by: Arne Deutsch <Arne.Deutsch@itemis.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4MDI3NTE0", "url": "https://github.com/eclipse/xtext-core/pull/1613#pullrequestreview-528027514", "createdAt": "2020-11-11T10:01:13Z", "commit": {"oid": "8ef51221232d8954bf64f27b72e055034cc76bcd"}, "state": "COMMENTED", "comments": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxMDowMToxM1rOHxGUkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxMDoxODowMFrOHxG6PA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI0NTg0Mg==", "bodyText": "I know it's a test, but for documentation purpose it would be good to find a better name for it", "url": "https://github.com/eclipse/xtext-core/pull/1613#discussion_r521245842", "createdAt": "2020-11-11T10:01:13Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.tests/src/org/eclipse/xtext/formatting2/internal/FormatterTestLanguageJavaFormatter.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 itemis AG (http://www.itemis.eu) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.formatting2.internal;\n+\n+import org.eclipse.xtext.formatting2.AbstractJavaFormatter;\n+import org.eclipse.xtext.formatting2.IFormattableDocument;\n+import org.eclipse.xtext.formatting2.internal.formattertestlanguage.IDList;\n+import org.eclipse.xtext.formatting2.internal.services.FormatterTestLanguageGrammarAccess;\n+\n+import com.google.inject.Inject;\n+\n+/**\n+ * @author Arne Deutsch - Initial contribution and API\n+ */\n+public class FormatterTestLanguageJavaFormatter extends AbstractJavaFormatter {\n+\n+\t@Inject\n+\tFormatterTestLanguageGrammarAccess grammar;\n+\n+\tprotected void format(IDList list, IFormattableDocument doc) {\n+\t\tdoc.prepend(regionFor(list).keyword(\"idlist\"), it -> it.noSpace());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ef51221232d8954bf64f27b72e055034cc76bcd"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI0NjYyNQ==", "bodyText": "Can this become a reusable utility if we inject the interface of the formatter instead of the concrete type?", "url": "https://github.com/eclipse/xtext-core/pull/1613#discussion_r521246625", "createdAt": "2020-11-11T10:02:31Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.tests/src/org/eclipse/xtext/formatting2/internal/JavaFormatterTestHelper.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 itemis AG (http://www.itemis.eu) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.formatting2.internal;\n+\n+import org.eclipse.xtext.formatting2.IFormatter2;\n+import org.eclipse.xtext.testing.formatter.FormatterTestHelper;\n+import org.eclipse.xtext.testing.formatter.FormatterTestRequest;\n+\n+import com.google.inject.Inject;\n+\n+/**\n+ * @author Arne Deutsch - Initial contribution and API\n+ */\n+public class JavaFormatterTestHelper extends FormatterTestHelper {\n+\n+\t@Inject\n+\tprivate FormatterTestLanguageJavaFormatter formatter;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ef51221232d8954bf64f27b72e055034cc76bcd"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI0ODA5NA==", "bodyText": "As far as I can tell, AbstractXtextTests was meant to be used for various test languages in this test bundle. Having a method load(URI) that expects the resource to point to an Xtext grammar file, appears to be wrong.", "url": "https://github.com/eclipse/xtext-core/pull/1613#discussion_r521248094", "createdAt": "2020-11-11T10:05:03Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.tests/src/org/eclipse/xtext/tests/AbstractXtextTests.java", "diffHunk": "@@ -390,6 +397,30 @@ protected String readFileIntoString(String filePath) throws IOException {\n \t\tthrow new IllegalStateException(\"May not happen, but helps to suppress false positives in eclipse' control flow analysis.\");\n \t}\n \n+\tprotected Grammar load(URI uri) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ef51221232d8954bf64f27b72e055034cc76bcd"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI0ODM3OA==", "bodyText": "Can this go to some of the various Serialization test utils?", "url": "https://github.com/eclipse/xtext-core/pull/1613#discussion_r521248378", "createdAt": "2020-11-11T10:05:29Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.tests/src/org/eclipse/xtext/tests/AbstractXtextTests.java", "diffHunk": "@@ -390,6 +397,30 @@ protected String readFileIntoString(String filePath) throws IOException {\n \t\tthrow new IllegalStateException(\"May not happen, but helps to suppress false positives in eclipse' control flow analysis.\");\n \t}\n \n+\tprotected Grammar load(URI uri) {\n+\t\tXtextResourceSet rs = new XtextResourceSet();\n+\t\treturn (Grammar) rs.getResource(uri, true).getContents().get(0);\n+\t}\n+\n+\tprotected List<Pair<EObject, ICompositeNode>> detachNodeModel(EObject eObject) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ef51221232d8954bf64f27b72e055034cc76bcd"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI0ODkyMg==", "bodyText": "This file is very hard to review because of the changed indentation of the test expectation. Can you please restore the original indentation?", "url": "https://github.com/eclipse/xtext-core/pull/1613#discussion_r521248922", "createdAt": "2020-11-11T10:06:25Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.tests/src/org/eclipse/xtext/xtext/GrammarFlatteningTest.xtend", "diffHunk": "@@ -3,7 +3,7 @@\n  * This program and the accompanying materials are made available under the", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ef51221232d8954bf64f27b72e055034cc76bcd"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI1MTAxOA==", "bodyText": "Personally I wouldn't consider this to be API.", "url": "https://github.com/eclipse/xtext-core/pull/1613#discussion_r521251018", "createdAt": "2020-11-11T10:09:58Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.xtext.generator/src/org/eclipse/xtext/xtext/generator/formatting/Formatter2Fragment2.xtend", "diffHunk": "@@ -72,11 +73,11 @@ class Formatter2Fragment2 extends AbstractStubGeneratingFragment {\n \t}\n \n \tprotected def doGenerateStubFile() {\n-\t\tval xtendFile = doGetXtendStubFile\n-\t\txtendFile?.writeTo(projectConfig.runtime.src)\n+\t\tval file = doGetStubFile\n+\t\tfile?.writeTo(projectConfig.runtime.src)\n \t}\n \n-\tprotected def doGetXtendStubFile() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgxNDA1Nw=="}, "originalCommit": {"oid": "2c57b15e9666c2510b96c98a26da244b5ac85b9d"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI1MjA2NA==", "bodyText": "Hmm I would have expected something like // TODO: implement for Person, Description at the bottom according to the fragment implementation. But maybe we can just remove that TODO from the fragment.", "url": "https://github.com/eclipse/xtext-core/pull/1613#discussion_r521252064", "createdAt": "2020-11-11T10:11:46Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.tests/src/org/eclipse/xtext/xtext/generator/Formatter2Fragment2Test.xtend", "diffHunk": "@@ -136,7 +135,51 @@ class Formatter2Fragment2Test extends AbstractGeneratorFragmentTests {\n \t\t\t\tgreeting.person.format\n \t\t\t}\n \t\t\t\n-\t\t\t// TODO: implement for \n+\t\t}\n+\t\t'''\n+\t\texpected.assertEquals(actual)\n+\t}\n+\n+\t@Test def void testFormatMethodJavaGeneration() throws Exception {\n+\t\tfragment = TestableFormatter2Fragment2.initializeFragmentWithGrammarFromString('''\n+\t\tgrammar org.xtext.example.mydsl.MyDsl with org.eclipse.xtext.common.Terminals\n+\t\tgenerate myDsl \"http://www.xtext.org/example/mydsl/MyDsl\"\n+\t\tModel:\n+\t\t\tgreetings+=Greeting*\n+\t\t\tdescription=Description;\n+\t\tGreeting:\n+\t\t\t'Hello' person=Person '!';\n+\t\tPerson:\n+\t\t\tfirstname=ID lastname=ID;\n+\t\tDescription:\n+\t\t\ttext=STRING;\n+\t\t''')\n+\t\tfragment.generateXtendStub = false\n+\t\t\n+\t\tval actual = fragment.doGetStubFile.concatenationClientToString\n+\t\tval expected = '''\n+\t\tpackage org.xtext.example.mydsl.formatting2;\n+\t\t\n+\t\timport org.eclipse.xtext.formatting2.AbstractJavaFormatter;\n+\t\timport org.eclipse.xtext.formatting2.IFormattableDocument;\n+\t\timport org.xtext.example.mydsl.myDsl.Greeting;\n+\t\timport org.xtext.example.mydsl.myDsl.Model;\n+\t\t\n+\t\tpublic class MyDslFormatter extends AbstractJavaFormatter {\n+\t\t\n+\t\t\tprotected void format(Model model, IFormattableDocument doc) {\n+\t\t\t\t// TODO: format HiddenRegions around keywords, attributes, cross references, etc. \n+\t\t\t\tfor (Greeting greeting : model.getGreetings()) {\n+\t\t\t\t\tdoc.format(greeting);\n+\t\t\t\t}\n+\t\t\t\tdoc.format(model.getDescription());\n+\t\t\t}\n+\t\t\n+\t\t\tprotected void format(Greeting greeting, IFormattableDocument doc) {\n+\t\t\t\t// TODO: format HiddenRegions around keywords, attributes, cross references, etc. \n+\t\t\t\tdoc.format(greeting.getPerson());\n+\t\t\t}\n+\t\t\t", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ef51221232d8954bf64f27b72e055034cc76bcd"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI1MjM5Mw==", "bodyText": "The output of the if clause is not part of the test expectation.", "url": "https://github.com/eclipse/xtext-core/pull/1613#discussion_r521252393", "createdAt": "2020-11-11T10:12:15Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.xtext.generator/src/org/eclipse/xtext/xtext/generator/formatting/Formatter2Fragment2.xtend", "diffHunk": "@@ -99,15 +100,36 @@ class Formatter2Fragment2 extends AbstractStubGeneratingFragment {\n \t\t\t\t\t\t\ufffdtype.generateFormatMethod(type2ref.get(type), inheritedTypes.containsKey(type))\ufffd\n \t\t\t\t\t\ufffdENDFOR\ufffd\t\n \t\t\t\t\t\n-\t\t\t\t\t// TODO: implement for \ufffdtypes.drop(2).map[name].join(\", \")\ufffd\n+\t\t\t\t\t\ufffdIF types.length > 2\ufffd\n+\t\t\t\t\t\t// TODO: implement for \ufffdtypes.drop(2).map[name].join(\", \")\ufffd\n+\t\t\t\t\t\ufffdENDIF\ufffd\n \t\t\t\t}\n \t\t\t'''\n \t\t\treturn xtendFile\n \t\t} else {\n-\t\t\tLOG.error(this.class.name + \" has been configured to generate a Java stub, but that's not yet supported. See https://bugs.eclipse.org/bugs/show_bug.cgi?id=481563\")\t\n+\t\t\tval javaFile = fileAccessFactory.createJavaFile(grammar.formatter2Stub)\n+\t\t\tjavaFile.resourceSet = language.resourceSet\n+\t\t\t\n+\t\t\tval type2ref = LinkedHashMultimap.<EClass, EReference>create\n+\t\t\tgetLocallyAssignedContainmentReferences(language.grammar, type2ref)\n+\t\t\tval inheritedTypes = LinkedHashMultimap.<EClass, EReference>create\n+\t\t\tgetInheritedContainmentReferences(language.grammar, inheritedTypes, newHashSet)\n+\t\t\tval types = type2ref.keySet\n+\t\t\t\n+\t\t\tjavaFile.content = '''\n+\t\t\t\tpublic class \ufffdgrammar.formatter2Stub.simpleName\ufffd extends \ufffdstubSuperClass\ufffd {\n+\t\t\t\t\t\ufffdFOR type : types.take(2)\ufffd\n+\n+\t\t\t\t\t\t\ufffdtype.generateJavaFormatMethod(type2ref.get(type), inheritedTypes.containsKey(type))\ufffd\n+\t\t\t\t\t\ufffdENDFOR\ufffd\t\n+\t\t\t\t\t\n+\t\t\t\t\t\ufffdIF types.length > 2\ufffd", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ef51221232d8954bf64f27b72e055034cc76bcd"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI1MzIxOA==", "bodyText": "please use a more descriptive name for it or replace by method reference TypeOfIt::noSpace", "url": "https://github.com/eclipse/xtext-core/pull/1613#discussion_r521253218", "createdAt": "2020-11-11T10:13:52Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext/src/org/eclipse/xtext/formatting2/AbstractJavaFormatter.java", "diffHunk": "@@ -0,0 +1,180 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 itemis AG (http://www.itemis.eu) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.formatting2;\n+\n+import java.util.Collections;\n+\n+import org.eclipse.emf.ecore.EObject;\n+import org.eclipse.xtext.formatting2.regionaccess.IEObjectRegion;\n+import org.eclipse.xtext.formatting2.regionaccess.IHiddenRegion;\n+import org.eclipse.xtext.formatting2.regionaccess.ISemanticRegion;\n+import org.eclipse.xtext.formatting2.regionaccess.ISemanticRegionFinder;\n+import org.eclipse.xtext.formatting2.regionaccess.ISemanticRegionsFinder;\n+import org.eclipse.xtext.resource.XtextResource;\n+import org.eclipse.xtext.util.Exceptions;\n+import org.eclipse.xtext.util.PolymorphicDispatcher;\n+import org.eclipse.xtext.util.PolymorphicDispatcher.ErrorHandler;\n+\n+import com.google.common.annotations.Beta;\n+\n+/**\n+ * <p>\n+ * This is an abstract base class for language-specific formatters, intended to be extended with a java class.\n+ * </p>\n+ * <p>\n+ * It is working very much like {@link AbstractFormatter2} but does support additional methods to simplify java\n+ * formatter code.\n+ * </p>\n+ * <p>\n+ * the \"_format\" methods are called by reflection. The name is important as well as there are exactly two arguments\n+ * whereas the first one is of the element type you like to format and the second one of type\n+ * {@link IFormattableDocument}. The methods should be protected.\n+ * </p>\n+ * <p>\n+ * Example code for a java formatter:\n+ * \n+ * <pre>\n+ * import static org.xtext.example.mydsl.myDsl.MyDslPackage.Literals.*;\n+ * \n+ * public class MyDslFormatter2 extends AbstractJavaFormatter {\n+ * \tprotected void _format(Model model, IFormattableDocument doc) {\n+ * \t\tfor (Parent parent : model.getParents())\n+ * \t\t\tdoc.format(parent);\n+ * \t}\n+ * \n+ * \tprotected void _format(Parent parent, IFormattableDocument doc) {\n+ * \t\tdoc.prepend(regionFor(parent).keyword(\"parent\"), it -> it.noSpace());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ef51221232d8954bf64f27b72e055034cc76bcd"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI1Mzc4OQ==", "bodyText": "Why not a JavaDoc comment?", "url": "https://github.com/eclipse/xtext-core/pull/1613#discussion_r521253789", "createdAt": "2020-11-11T10:14:53Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext/src/org/eclipse/xtext/formatting2/AbstractJavaFormatter.java", "diffHunk": "@@ -0,0 +1,180 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 itemis AG (http://www.itemis.eu) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.formatting2;\n+\n+import java.util.Collections;\n+\n+import org.eclipse.emf.ecore.EObject;\n+import org.eclipse.xtext.formatting2.regionaccess.IEObjectRegion;\n+import org.eclipse.xtext.formatting2.regionaccess.IHiddenRegion;\n+import org.eclipse.xtext.formatting2.regionaccess.ISemanticRegion;\n+import org.eclipse.xtext.formatting2.regionaccess.ISemanticRegionFinder;\n+import org.eclipse.xtext.formatting2.regionaccess.ISemanticRegionsFinder;\n+import org.eclipse.xtext.resource.XtextResource;\n+import org.eclipse.xtext.util.Exceptions;\n+import org.eclipse.xtext.util.PolymorphicDispatcher;\n+import org.eclipse.xtext.util.PolymorphicDispatcher.ErrorHandler;\n+\n+import com.google.common.annotations.Beta;\n+\n+/**\n+ * <p>\n+ * This is an abstract base class for language-specific formatters, intended to be extended with a java class.\n+ * </p>\n+ * <p>\n+ * It is working very much like {@link AbstractFormatter2} but does support additional methods to simplify java\n+ * formatter code.\n+ * </p>\n+ * <p>\n+ * the \"_format\" methods are called by reflection. The name is important as well as there are exactly two arguments\n+ * whereas the first one is of the element type you like to format and the second one of type\n+ * {@link IFormattableDocument}. The methods should be protected.\n+ * </p>\n+ * <p>\n+ * Example code for a java formatter:\n+ * \n+ * <pre>\n+ * import static org.xtext.example.mydsl.myDsl.MyDslPackage.Literals.*;\n+ * \n+ * public class MyDslFormatter2 extends AbstractJavaFormatter {\n+ * \tprotected void _format(Model model, IFormattableDocument doc) {\n+ * \t\tfor (Parent parent : model.getParents())\n+ * \t\t\tdoc.format(parent);\n+ * \t}\n+ * \n+ * \tprotected void _format(Parent parent, IFormattableDocument doc) {\n+ * \t\tdoc.prepend(regionFor(parent).keyword(\"parent\"), it -> it.noSpace());\n+ * \t\tdoc.append(regionFor(parent).keyword(\"parent\"), it -> it.oneSpace());\n+ * \t\tdoc.append(regionFor(parent).feature(PARENT__NAME), it -> it.oneSpace());\n+ * \t\tdoc.prepend(regionFor(parent).keyword(\"{\"), it -> it.oneSpace());\n+ * \t\tdoc.append(regionFor(parent).keyword(\"{\"), it -> it.newLine());\n+ * \t\tdoc.interior(regionFor(parent).keyword(\"{\"), regionFor(parent).keyword(\"}\"), it -> it.indent());\n+ * \t\tdoc.append(regionFor(parent).keyword(\"}\"), it -> it.setNewLines(1, 1, 2));\n+ * \t\tfor (Child child : parent.getChildren())\n+ * \t\t\tdoc.format(child);\n+ * \t}\n+ * \n+ * \tprotected void _format(Child child, IFormattableDocument doc) {\n+ * \t\tdoc.append(regionFor(child).keyword(\"child\"), it -> it.oneSpace());\n+ * \t\tdoc.append(regionFor(child).feature(CHILD__NAME), it -> it.newLine());\n+ * \t}\n+ * }\n+ * </pre>\n+ * </p>\n+ * <p>\n+ * This is suitable for the following grammar:\n+ * \n+ * <pre>\n+ * grammar org.xtext.example.mydsl.MyDsl with org.eclipse.xtext.common.Terminals\n+ * \n+ * generate myDsl \"http://www.xtext.org/example/mydsl/MyDsl\"\n+ * \n+ * Model: parents+=Parent*;\n+ * Parent: 'parent' name=ID '!' ('{' children+=Child* '}')?;\n+ * Child: 'child' name=ID;\n+ * </pre>\n+ * </p>\n+ * \n+ * @author Arne Deutsch\n+ * @since 2.24\n+ */\n+@Beta\n+public abstract class AbstractJavaFormatter extends AbstractFormatter2 {\n+\n+\tprivate PolymorphicDispatcher<Void> dispatcher = createPolymorhicDispatcher();\n+\n+\t// Error handler dispatches to default method in case of a missing method in concrete formatter\n+\tprotected class EObjectErrorHandler implements ErrorHandler<Void> {\n+\t\t@Override\n+\t\tpublic Void handle(Object[] params, Throwable e) {\n+\t\t\tif (e instanceof NoSuchMethodException) {\n+\t\t\t\tif (params.length == 2 && params[0] instanceof EObject && params[1] instanceof IFormattableDocument) {\n+\t\t\t\t\t_format((EObject) params[0], (IFormattableDocument) params[1]);\n+\t\t\t\t\treturn null;\n+\t\t\t\t}\n+\t\t\t}\n+\t\t\treturn Exceptions.throwUncheckedException(e);\n+\t\t}\n+\t}\n+\n+\t// reflective method that calls \"_format\" methods found in the implementing class.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ef51221232d8954bf64f27b72e055034cc76bcd"}, "originalPosition": 106}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI1NTQ4NA==", "bodyText": "Is regionFor(rule) a cheap call? Or should we store the region in a local var?", "url": "https://github.com/eclipse/xtext-core/pull/1613#discussion_r521255484", "createdAt": "2020-11-11T10:18:00Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext/src/org/eclipse/xtext/xtext/XtextFormatterJava.java", "diffHunk": "@@ -0,0 +1,207 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 itemis AG (http://www.itemis.com) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.xtext;\n+\n+import org.eclipse.emf.common.util.EList;\n+import org.eclipse.emf.ecore.EObject;\n+import org.eclipse.xtext.AbstractElement;\n+import org.eclipse.xtext.AbstractMetamodelDeclaration;\n+import org.eclipse.xtext.AbstractRule;\n+import org.eclipse.xtext.Action;\n+import org.eclipse.xtext.Alternatives;\n+import org.eclipse.xtext.Annotation;\n+import org.eclipse.xtext.Assignment;\n+import org.eclipse.xtext.CharacterRange;\n+import org.eclipse.xtext.CrossReference;\n+import org.eclipse.xtext.EnumRule;\n+import org.eclipse.xtext.Grammar;\n+import org.eclipse.xtext.Group;\n+import org.eclipse.xtext.Keyword;\n+import org.eclipse.xtext.NamedArgument;\n+import org.eclipse.xtext.NegatedToken;\n+import org.eclipse.xtext.Parameter;\n+import org.eclipse.xtext.ParserRule;\n+import org.eclipse.xtext.RuleCall;\n+import org.eclipse.xtext.TerminalRule;\n+import org.eclipse.xtext.TypeRef;\n+import org.eclipse.xtext.UntilToken;\n+import org.eclipse.xtext.Wildcard;\n+import org.eclipse.xtext.formatting2.AbstractJavaFormatter;\n+import org.eclipse.xtext.formatting2.IFormattableDocument;\n+\n+/**\n+ * @author Arne Deutsch - Initial contribution and API\n+ */\n+public class XtextFormatterJava extends AbstractJavaFormatter {\n+\n+\tprotected void format(Grammar grammar, IFormattableDocument doc) {\n+\t\tdoc.prepend(regionFor(grammar).keyword(\"(\"), it -> it.noSpace());\n+\t\tformatParens(grammar, doc);\n+\t\tregionFor(grammar).keywords(\",\").forEach(s -> doc.prepend(s, it -> it.noSpace()));\n+\t\tregionFor(grammar).keywords(\",\").forEach(s -> doc.append(s, it -> it.oneSpace()));\n+\t\tboolean first = true;\n+\t\tfor (AbstractMetamodelDeclaration decl : grammar.getMetamodelDeclarations()) {\n+\t\t\tdoc.set(previousHiddenRegion(decl), first ? it -> it.setNewLines(2) : it -> it.setNewLines(1));\n+\t\t\tfirst = false;\n+\t\t\tdoc.format(decl);\n+\t\t}\n+\t\tfor (AbstractRule rule : grammar.getRules()) {\n+\t\t\tdoc.set(previousHiddenRegion(rule), it -> it.setNewLines(2));\n+\t\t\tdoc.format(rule);\n+\t\t}\n+\t\tdoc.set(nextHiddenRegion(grammar), it -> it.setNewLines(0, 0, 1));\n+\t}\n+\n+\tprotected void format(ParserRule rule, IFormattableDocument doc) {\n+\t\tdoc.prepend(regionFor(rule).keyword(\"<\"), it -> it.oneSpace());\n+\t\tdoc.append(regionFor(rule).keyword(\">\"), it -> it.noSpace());\n+\t\trule.getParameters().forEach(p -> doc.format(p));\n+\t\tformatRule(rule, doc);\n+\t\tformatParens(rule, doc);\n+\t}\n+\n+\tprotected void format(TerminalRule rule, IFormattableDocument doc) {\n+\t\tformatRule(rule, doc);\n+\t}\n+\n+\tprotected void format(EnumRule rule, IFormattableDocument doc) {\n+\t\tformatRule(rule, doc);\n+\t}\n+\n+\tprotected void format(Alternatives alternatives, IFormattableDocument doc) {\n+\t\tregionFor(alternatives).keywords(\"|\").forEach(r -> {\n+\t\t\tdoc.surround(r, it -> it.autowrap());\n+\t\t\tdoc.surround(r, it -> it.setNewLines(0, 0, 1));\n+\t\t\tdoc.surround(r, it -> it.oneSpace());\n+\t\t});\n+\t\tformatParens(alternatives, doc);\n+\t\tformatCardinality(alternatives, doc);\n+\t\tfor (AbstractElement element : alternatives.getElements())\n+\t\t\tdoc.format(element);\n+\t}\n+\n+\tprotected void format(Assignment assignment, IFormattableDocument doc) {\n+\t\tregionFor(assignment).keywords(\"=\", \"+=\", \"?=\").forEach(r -> doc.surround(r, it -> it.noSpace()));\n+\t\tformatCardinality(assignment, doc);\n+\t\tformatParens(assignment, doc);\n+\t\tdoc.format(assignment.getTerminal());\n+\t}\n+\n+\tprotected void format(Group group, IFormattableDocument doc) {\n+\t\tformatCardinality(group, doc);\n+\t\tformatParens(group, doc);\n+\t\tboolean first = true;\n+\t\tEList<AbstractElement> elements = group.getElements();\n+\t\tint size = elements.size();\n+\t\tint index = 0;\n+\t\tfor (AbstractElement element : elements) {\n+\t\t\tindex++;\n+\t\t\tboolean last = index == size;\n+\t\t\tif (!first && !last) {\n+\t\t\t\tdoc.prepend(element, it -> it.setNewLines(0, 0, 1));\n+\t\t\t\tif (!(element instanceof UntilToken) && !(element instanceof Group))\n+\t\t\t\t\tdoc.surround(element, it -> it.oneSpace());\n+\t\t\t} else if (!first && last) {\n+\t\t\t\tdoc.prepend(element, it -> it.setNewLines(0, 0, 1));\n+\t\t\t}\n+\t\t\tfirst = false;\n+\t\t\tdoc.format(element);\n+\t\t}\n+\t}\n+\n+\tprotected void format(Wildcard wildcard, IFormattableDocument doc) {\n+\t\tdoc.surround(regionFor(wildcard).keyword(\":\"), it -> it.oneSpace());\n+\t}\n+\n+\tprotected void format(CharacterRange range, IFormattableDocument doc) {\n+\t\tdoc.surround(regionFor(range).keyword(\"..\"), it -> it.noSpace());\n+\t\tformatCardinality(range, doc);\n+\t\tdoc.format(range.getLeft());\n+\t\tdoc.format(range.getRight());\n+\t}\n+\n+\tprotected void format(RuleCall call, IFormattableDocument doc) {\n+\t\tdoc.append(call, it -> it.autowrap());\n+\t\tdoc.prepend(regionFor(call).keyword(\"<\"), it -> it.noSpace());\n+\t\tcall.getArguments().forEach(a -> doc.format(a));\n+\t}\n+\n+\tprotected void format(Keyword keyword, IFormattableDocument doc) {\n+\t\tdoc.surround(keyword, it -> it.autowrap());\n+\t\tformatCardinality(keyword, doc);\n+\t}\n+\n+\tprotected void format(NegatedToken token, IFormattableDocument doc) {\n+\t\tdoc.append(regionFor(token).keyword(\"!\"), it -> it.noSpace());\n+\t\tformatParens(token, doc);\n+\t\tformatCardinality(token, doc);\n+\t\tdoc.format(token.getTerminal());\n+\t}\n+\n+\tprotected void format(UntilToken token, IFormattableDocument doc) {\n+\t\tdoc.surround(regionFor(token).keyword(\"->\"), it -> it.noSpace());\n+\t\tdoc.format(token.getTerminal());\n+\t}\n+\n+\tprotected void format(Action action, IFormattableDocument doc) {\n+\t\tdoc.append(regionFor(action).keyword(\"{\"), it -> it.noSpace());\n+\t\tdoc.prepend(regionFor(action).keyword(\"}\"), it -> it.noSpace());\n+\t}\n+\n+\tprotected void format(CrossReference ref, IFormattableDocument doc) {\n+\t\tdoc.prepend(regionFor(ref).keyword(\"[\"), it -> it.autowrap());\n+\t\tdoc.append(regionFor(ref).keyword(\"[\"), it -> it.noSpace());\n+\t\tdoc.prepend(regionFor(ref).keyword(\"]\"), it -> it.noSpace());\n+\t\tdoc.append(regionFor(ref).keyword(\"]\"), it -> it.autowrap());\n+\t\tdoc.surround(regionFor(ref).keyword(\"|\"), it -> it.noSpace());\n+\t\tdoc.format(ref.getType());\n+\t}\n+\n+\tprotected void format(Parameter param, IFormattableDocument doc) {\n+\t\tdoc.surround(param, it -> it.noSpace());\n+\t}\n+\n+\tprotected void format(NamedArgument param, IFormattableDocument doc) {\n+\t\tdoc.surround(param, it -> it.noSpace());\n+\t\tregionFor(param).keywords(\"=\").forEach(k -> doc.surround(k, it -> it.noSpace()));\n+\t}\n+\n+\tprotected void format(TypeRef ref, IFormattableDocument doc) {\n+\t\tdoc.surround(regionFor(ref).keyword(\"::\"), it -> it.noSpace());\n+\t}\n+\n+\tprotected void format(Annotation annotation, IFormattableDocument doc) {\n+\t\tdoc.surround(regionFor(annotation).keyword(\"@\"), it -> it.noSpace());\n+\t\tdoc.append(annotation, it -> it.newLine());\n+\t}\n+\n+\tprivate void formatRule(AbstractRule rule, IFormattableDocument doc) {\n+\t\tdoc.surround(regionFor(rule).keyword(\"returns\"), it -> it.oneSpace());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ef51221232d8954bf64f27b72e055034cc76bcd"}, "originalPosition": 185}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8ef51221232d8954bf64f27b72e055034cc76bcd", "author": {"user": {"login": "ArneDeutsch", "name": "Arne Deutsch"}}, "url": "https://github.com/eclipse/xtext-core/commit/8ef51221232d8954bf64f27b72e055034cc76bcd", "committedDate": "2020-11-06T16:26:51Z", "message": "Review adaptions.\n\nSigned-off-by: Arne Deutsch <Arne.Deutsch@itemis.de>"}, "afterCommit": {"oid": "a331e173df064546ad87ebf3e6a24d9646ca08b7", "author": {"user": {"login": "ArneDeutsch", "name": "Arne Deutsch"}}, "url": "https://github.com/eclipse/xtext-core/commit/a331e173df064546ad87ebf3e6a24d9646ca08b7", "committedDate": "2020-11-13T07:08:00Z", "message": "Review adaptions.\n\nSigned-off-by: Arne Deutsch <Arne.Deutsch@itemis.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxMDUyMjU1", "url": "https://github.com/eclipse/xtext-core/pull/1613#pullrequestreview-531052255", "createdAt": "2020-11-16T08:16:20Z", "commit": {"oid": "a331e173df064546ad87ebf3e6a24d9646ca08b7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a331e173df064546ad87ebf3e6a24d9646ca08b7", "author": {"user": {"login": "ArneDeutsch", "name": "Arne Deutsch"}}, "url": "https://github.com/eclipse/xtext-core/commit/a331e173df064546ad87ebf3e6a24d9646ca08b7", "committedDate": "2020-11-13T07:08:00Z", "message": "Review adaptions.\n\nSigned-off-by: Arne Deutsch <Arne.Deutsch@itemis.de>"}, "afterCommit": {"oid": "816273c7594f17c60dfd98cdfe639d82175d1efd", "author": {"user": {"login": "ArneDeutsch", "name": "Arne Deutsch"}}, "url": "https://github.com/eclipse/xtext-core/commit/816273c7594f17c60dfd98cdfe639d82175d1efd", "committedDate": "2020-11-16T08:21:55Z", "message": "Review adaptions.\n\nSigned-off-by: Arne Deutsch <Arne.Deutsch@itemis.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad62f8360439c62724289f78b1d2cdad1085fb60", "author": {"user": {"login": "ArneDeutsch", "name": "Arne Deutsch"}}, "url": "https://github.com/eclipse/xtext-core/commit/ad62f8360439c62724289f78b1d2cdad1085fb60", "committedDate": "2020-11-16T08:32:34Z", "message": "[eclipse/xtext#1697] Abstract super class for java based formatters.\n[#1489] Java based Xtext formatter (formatter2 API).\n\nRemove API restrictions.\nTesting java based formatter.\nFormatter2 Java Fragment."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "816273c7594f17c60dfd98cdfe639d82175d1efd", "author": {"user": {"login": "ArneDeutsch", "name": "Arne Deutsch"}}, "url": "https://github.com/eclipse/xtext-core/commit/816273c7594f17c60dfd98cdfe639d82175d1efd", "committedDate": "2020-11-16T08:21:55Z", "message": "Review adaptions.\n\nSigned-off-by: Arne Deutsch <Arne.Deutsch@itemis.de>"}, "afterCommit": {"oid": "ad62f8360439c62724289f78b1d2cdad1085fb60", "author": {"user": {"login": "ArneDeutsch", "name": "Arne Deutsch"}}, "url": "https://github.com/eclipse/xtext-core/commit/ad62f8360439c62724289f78b1d2cdad1085fb60", "committedDate": "2020-11-16T08:32:34Z", "message": "[eclipse/xtext#1697] Abstract super class for java based formatters.\n[#1489] Java based Xtext formatter (formatter2 API).\n\nRemove API restrictions.\nTesting java based formatter.\nFormatter2 Java Fragment."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4683, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}