{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3MTg4OTc0", "number": 1392, "reviewThreads": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNDoxODo1NlrODhFlZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxMDoxNzo1OVrODhd7Yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MDIxMDk0OnYy", "diffSide": "RIGHT", "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/server/WorkspaceFoldersTest.xtend", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNDoxODo1NlrOFrp1Og==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNDo1NjoyOFrOFrraWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMxODQ1OA==", "bodyText": "This does only work for empty directories.\nThe org.junit.rules.TemporaryFolder rule may be the better choice here.", "url": "https://github.com/eclipse/xtext-core/pull/1392#discussion_r381318458", "createdAt": "2020-02-19T14:18:56Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/server/WorkspaceFoldersTest.xtend", "diffHunk": "@@ -0,0 +1,123 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.ide.tests.server\n+\n+import com.google.inject.AbstractModule\n+import com.google.inject.Inject\n+import com.google.inject.Module\n+import com.google.inject.Scopes\n+import java.io.File\n+import java.io.FileWriter\n+import java.util.concurrent.CompletableFuture\n+import org.eclipse.lsp4j.DidChangeWorkspaceFoldersParams\n+import org.eclipse.lsp4j.WorkspaceFolder\n+import org.eclipse.lsp4j.WorkspaceFoldersChangeEvent\n+import org.eclipse.xtext.ide.server.UriExtensions\n+import org.eclipse.xtext.ide.server.WorkspaceManager\n+import org.eclipse.xtext.util.Files\n+import org.eclipse.xtext.util.Modules2\n+import org.junit.Test\n+\n+import static org.junit.Assert.assertEquals\n+\n+/**\n+ * @author Jan Koehnlein - Initial contribution and API\n+ */\n+class WorkspaceFoldersTest extends AbstractTestLangLanguageServerTest {\n+\t\n+\t@Inject extension UriExtensions\n+\t\n+\t@Inject WorkspaceManager workspaceManager\n+\t\n+\t@Test\n+\tdef void testInitialize() {\n+\t\tval rootFolder1 = getRoot('root1') \n+\t\tval rootFolder2 = getRoot('root2') \n+\t\twriteFile(rootFolder1, \"one.testlang\", '''\n+\t\t\ttype Foo {\n+\t\t\t\tBar bar\n+\t\t\t}\n+\t\t''')\n+\t\tval twoUri = writeFile(rootFolder2, \"two.testlang\", '''\n+\t\t\ttype Bar {\n+\t\t\t\tFoo foo\n+\t\t\t}\n+\t\t''')\n+\t\tinitialize[ \n+\t\t\tworkspaceFolders = #[\n+\t\t\t\tnew WorkspaceFolder(rootFolder1.toURI.toUriString, 'root1'),\n+\t\t\t\tnew WorkspaceFolder(rootFolder2.toURI.toUriString, 'root2')\n+\t\t\t]\n+\t\t]\n+\t\tassertEquals(2, diagnostics.size)\n+\t\tassertEquals(1, diagnostics.get(twoUri).size)\n+\t\twithBuild [\n+\t\t\tlanguageServer.didChangeWorkspaceFolders(new DidChangeWorkspaceFoldersParams => [\n+\t\t\t\tevent = new WorkspaceFoldersChangeEvent => [\n+\t\t\t\t\tremoved = #[\n+\t\t\t\t\t\tnew WorkspaceFolder(rootFolder2.toURI.toUriString, 'root2')\n+\t\t\t\t\t]\n+\t\t\t\t]\n+\t\t\t])\n+\t\t]\t\n+\t\tassertEquals(0, diagnostics.get(twoUri).size)\n+\t\twithBuild [\n+\t\t\tlanguageServer.didChangeWorkspaceFolders(new DidChangeWorkspaceFoldersParams => [\n+\t\t\t\tevent = new WorkspaceFoldersChangeEvent => [\n+\t\t\t\t\tadded = #[\n+\t\t\t\t\t\tnew WorkspaceFolder(rootFolder2.toURI.toUriString, 'root2')\n+\t\t\t\t\t]\n+\t\t\t\t]\n+\t\t\t])\n+\t\t]\t\n+\t\tassertEquals(1, diagnostics.get(twoUri).size)\n+\t}\n+\n+\tprotected def void withBuild(()=>void lambda) {\n+\t\tval future = new CompletableFuture<Void>()\n+\t\tworkspaceManager.addBuildListener[  \n+\t\t\tworkspaceManager.removeBuildListener(self)\n+\t\t\tfuture.complete(null)\t\t\t\n+\t\t]\n+\t\tlambda.apply\n+\t\tfuture.get\n+\t}\n+\n+    protected def getRoot(String path) {\n+        val root = new File(path)\n+        if (!root.mkdirs) {\n+            Files.cleanFolder(root, null, true, false)\n+        }\n+        root.deleteOnExit", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52d115d152716577242a3d816affa28c12847d74"}, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM0NDM0Ng==", "bodyText": "Yes, I'll change that.", "url": "https://github.com/eclipse/xtext-core/pull/1392#discussion_r381344346", "createdAt": "2020-02-19T14:56:28Z", "author": {"login": "JanKoehnlein"}, "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/server/WorkspaceFoldersTest.xtend", "diffHunk": "@@ -0,0 +1,123 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.ide.tests.server\n+\n+import com.google.inject.AbstractModule\n+import com.google.inject.Inject\n+import com.google.inject.Module\n+import com.google.inject.Scopes\n+import java.io.File\n+import java.io.FileWriter\n+import java.util.concurrent.CompletableFuture\n+import org.eclipse.lsp4j.DidChangeWorkspaceFoldersParams\n+import org.eclipse.lsp4j.WorkspaceFolder\n+import org.eclipse.lsp4j.WorkspaceFoldersChangeEvent\n+import org.eclipse.xtext.ide.server.UriExtensions\n+import org.eclipse.xtext.ide.server.WorkspaceManager\n+import org.eclipse.xtext.util.Files\n+import org.eclipse.xtext.util.Modules2\n+import org.junit.Test\n+\n+import static org.junit.Assert.assertEquals\n+\n+/**\n+ * @author Jan Koehnlein - Initial contribution and API\n+ */\n+class WorkspaceFoldersTest extends AbstractTestLangLanguageServerTest {\n+\t\n+\t@Inject extension UriExtensions\n+\t\n+\t@Inject WorkspaceManager workspaceManager\n+\t\n+\t@Test\n+\tdef void testInitialize() {\n+\t\tval rootFolder1 = getRoot('root1') \n+\t\tval rootFolder2 = getRoot('root2') \n+\t\twriteFile(rootFolder1, \"one.testlang\", '''\n+\t\t\ttype Foo {\n+\t\t\t\tBar bar\n+\t\t\t}\n+\t\t''')\n+\t\tval twoUri = writeFile(rootFolder2, \"two.testlang\", '''\n+\t\t\ttype Bar {\n+\t\t\t\tFoo foo\n+\t\t\t}\n+\t\t''')\n+\t\tinitialize[ \n+\t\t\tworkspaceFolders = #[\n+\t\t\t\tnew WorkspaceFolder(rootFolder1.toURI.toUriString, 'root1'),\n+\t\t\t\tnew WorkspaceFolder(rootFolder2.toURI.toUriString, 'root2')\n+\t\t\t]\n+\t\t]\n+\t\tassertEquals(2, diagnostics.size)\n+\t\tassertEquals(1, diagnostics.get(twoUri).size)\n+\t\twithBuild [\n+\t\t\tlanguageServer.didChangeWorkspaceFolders(new DidChangeWorkspaceFoldersParams => [\n+\t\t\t\tevent = new WorkspaceFoldersChangeEvent => [\n+\t\t\t\t\tremoved = #[\n+\t\t\t\t\t\tnew WorkspaceFolder(rootFolder2.toURI.toUriString, 'root2')\n+\t\t\t\t\t]\n+\t\t\t\t]\n+\t\t\t])\n+\t\t]\t\n+\t\tassertEquals(0, diagnostics.get(twoUri).size)\n+\t\twithBuild [\n+\t\t\tlanguageServer.didChangeWorkspaceFolders(new DidChangeWorkspaceFoldersParams => [\n+\t\t\t\tevent = new WorkspaceFoldersChangeEvent => [\n+\t\t\t\t\tadded = #[\n+\t\t\t\t\t\tnew WorkspaceFolder(rootFolder2.toURI.toUriString, 'root2')\n+\t\t\t\t\t]\n+\t\t\t\t]\n+\t\t\t])\n+\t\t]\t\n+\t\tassertEquals(1, diagnostics.get(twoUri).size)\n+\t}\n+\n+\tprotected def void withBuild(()=>void lambda) {\n+\t\tval future = new CompletableFuture<Void>()\n+\t\tworkspaceManager.addBuildListener[  \n+\t\t\tworkspaceManager.removeBuildListener(self)\n+\t\t\tfuture.complete(null)\t\t\t\n+\t\t]\n+\t\tlambda.apply\n+\t\tfuture.get\n+\t}\n+\n+    protected def getRoot(String path) {\n+        val root = new File(path)\n+        if (!root.mkdirs) {\n+            Files.cleanFolder(root, null, true, false)\n+        }\n+        root.deleteOnExit", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMxODQ1OA=="}, "originalCommit": {"oid": "52d115d152716577242a3d816affa28c12847d74"}, "originalPosition": 97}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MDIzMTQyOnYy", "diffSide": "RIGHT", "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/IMultiRootWorkspaceConfigFactory.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNDoyNDowM1rOFrqCEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNTowODo1N1rOFrr_SQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMyMTc0NA==", "bodyText": "Why did you decide to make this not a subtype of IWorkspaceConfigFactory ?", "url": "https://github.com/eclipse/xtext-core/pull/1392#discussion_r381321744", "createdAt": "2020-02-19T14:24:03Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/IMultiRootWorkspaceConfigFactory.java", "diffHunk": "@@ -0,0 +1,30 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.ide.server;\n+\n+import java.util.List;\n+\n+import org.eclipse.lsp4j.WorkspaceFolder;\n+import org.eclipse.xtext.workspace.IWorkspaceConfig;\n+\n+/**\n+ * @author Jan Koehnlein - Initial contribution and API\n+ * @since 2.11\n+ */\n+public interface IMultiRootWorkspaceConfigFactory {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52d115d152716577242a3d816affa28c12847d74"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM1MzgwMQ==", "bodyText": "I didn't because these interfaces have no methods in common.\nBut the API compatibilities you describe suggest to do so.", "url": "https://github.com/eclipse/xtext-core/pull/1392#discussion_r381353801", "createdAt": "2020-02-19T15:08:57Z", "author": {"login": "JanKoehnlein"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/IMultiRootWorkspaceConfigFactory.java", "diffHunk": "@@ -0,0 +1,30 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.ide.server;\n+\n+import java.util.List;\n+\n+import org.eclipse.lsp4j.WorkspaceFolder;\n+import org.eclipse.xtext.workspace.IWorkspaceConfig;\n+\n+/**\n+ * @author Jan Koehnlein - Initial contribution and API\n+ * @since 2.11\n+ */\n+public interface IMultiRootWorkspaceConfigFactory {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMyMTc0NA=="}, "originalCommit": {"oid": "52d115d152716577242a3d816affa28c12847d74"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MDI0NDg1OnYy", "diffSide": "RIGHT", "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/IMultiRootWorkspaceConfigFactory.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNDoyNzowMlrOFrqKEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNDo1NjoxMVrOFrrZgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMyMzc5Mw==", "bodyText": "should be 2.21", "url": "https://github.com/eclipse/xtext-core/pull/1392#discussion_r381323793", "createdAt": "2020-02-19T14:27:02Z", "author": {"login": "cdietrich"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/IMultiRootWorkspaceConfigFactory.java", "diffHunk": "@@ -0,0 +1,30 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.ide.server;\n+\n+import java.util.List;\n+\n+import org.eclipse.lsp4j.WorkspaceFolder;\n+import org.eclipse.xtext.workspace.IWorkspaceConfig;\n+\n+/**\n+ * @author Jan Koehnlein - Initial contribution and API\n+ * @since 2.11", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52d115d152716577242a3d816affa28c12847d74"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM0NDEyOA==", "bodyText": "Good catch.", "url": "https://github.com/eclipse/xtext-core/pull/1392#discussion_r381344128", "createdAt": "2020-02-19T14:56:11Z", "author": {"login": "JanKoehnlein"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/IMultiRootWorkspaceConfigFactory.java", "diffHunk": "@@ -0,0 +1,30 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.ide.server;\n+\n+import java.util.List;\n+\n+import org.eclipse.lsp4j.WorkspaceFolder;\n+import org.eclipse.xtext.workspace.IWorkspaceConfig;\n+\n+/**\n+ * @author Jan Koehnlein - Initial contribution and API\n+ * @since 2.11", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMyMzc5Mw=="}, "originalCommit": {"oid": "52d115d152716577242a3d816affa28c12847d74"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MDI0ODk2OnYy", "diffSide": "RIGHT", "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/ProjectManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNDoyODowNFrOFrqMtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNDo1NjoxNlrOFrrZuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMyNDQ3MQ==", "bodyText": "missing @since", "url": "https://github.com/eclipse/xtext-core/pull/1392#discussion_r381324471", "createdAt": "2020-02-19T14:28:04Z", "author": {"login": "cdietrich"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/ProjectManager.java", "diffHunk": "@@ -215,4 +215,12 @@ public ProjectDescription getProjectDescription() {\n \tpublic IProjectConfig getProjectConfig() {\n \t\treturn projectConfig;\n \t}\n+\t\n+\tpublic void delete() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52d115d152716577242a3d816affa28c12847d74"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM0NDE4NQ==", "bodyText": "Thanks", "url": "https://github.com/eclipse/xtext-core/pull/1392#discussion_r381344185", "createdAt": "2020-02-19T14:56:16Z", "author": {"login": "JanKoehnlein"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/ProjectManager.java", "diffHunk": "@@ -215,4 +215,12 @@ public ProjectDescription getProjectDescription() {\n \tpublic IProjectConfig getProjectConfig() {\n \t\treturn projectConfig;\n \t}\n+\t\n+\tpublic void delete() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMyNDQ3MQ=="}, "originalCommit": {"oid": "52d115d152716577242a3d816affa28c12847d74"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MDI1MTA3OnYy", "diffSide": "RIGHT", "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/MultiRootWorkspaceConfigFactory.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNDoyODozMVrOFrqN8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNDo1MDo1N1rOFrrKIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMyNDc4Ng==", "bodyText": "The debugging experience would be improved if the workspaceFolder name would be used as a prefix here.", "url": "https://github.com/eclipse/xtext-core/pull/1392#discussion_r381324786", "createdAt": "2020-02-19T14:28:31Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/MultiRootWorkspaceConfigFactory.java", "diffHunk": "@@ -0,0 +1,70 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.ide.server;\n+\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.eclipse.emf.common.util.URI;\n+import org.eclipse.lsp4j.WorkspaceFolder;\n+import org.eclipse.xtext.workspace.FileProjectConfig;\n+import org.eclipse.xtext.workspace.IWorkspaceConfig;\n+import org.eclipse.xtext.workspace.WorkspaceConfig;\n+\n+import com.google.inject.Inject;\n+\n+/**\n+ * Creates one project per workspace root folder.\n+ * \n+ * @author koehnlein - Initial contribution and API\n+ * @since 2.21\n+ */\n+public class MultiRootWorkspaceConfigFactory implements IWorkspaceConfigFactory, IMultiRootWorkspaceConfigFactory {\n+\n+\t@Inject UriExtensions uriExtensions;\n+\t\n+\t@Override\n+\tpublic IWorkspaceConfig getWorkspaceConfig(List<WorkspaceFolder> workspaceFolders) {\n+\t\tWorkspaceConfig workspaceConfig = new WorkspaceConfig();\n+\t\tSet<String> existingProjectNames = new HashSet<>();\n+\t\tfor(WorkspaceFolder workspaceFolder: workspaceFolders) \n+\t\t\taddProjectsForWorkspaceFolder(workspaceConfig, workspaceFolder, existingProjectNames);\n+\t\treturn workspaceConfig;\n+\t}\n+\n+\t@Override\n+\tpublic IWorkspaceConfig getWorkspaceConfig(URI workspaceBaseURI) {\n+\t\tWorkspaceConfig workspaceConfig = new WorkspaceConfig();\n+\t\taddProjectsForWorkspaceFolder(workspaceConfig, new WorkspaceFolder(uriExtensions.toUriString(workspaceBaseURI), \"workspace\"), new HashSet<>());\n+\t\treturn workspaceConfig;\n+\t}\n+\n+\tprotected void addProjectsForWorkspaceFolder(WorkspaceConfig workspaceConfig, WorkspaceFolder workspaceFolder, Set<String> existingNames) {\n+\t\tif (workspaceFolder != null && workspaceFolder.getUri() != null) {\n+\t\t\tFileProjectConfig project = new FileProjectConfig(uriExtensions.toUri(workspaceFolder.getUri()), getUniqueProjectName(workspaceFolder.getName(), existingNames));\n+\t\t\tproject.addSourceFolder(\".\");\n+\t\t\tworkspaceConfig.addProject(project);\n+\t\t}\n+\t}\n+\t\n+\t/**\n+\t * Project names have to be unique, as the WorkspaceManager uses them as keys in a map.\n+\t */\n+\tprotected String getUniqueProjectName(String proposal, Set<String> existingNames){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52d115d152716577242a3d816affa28c12847d74"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMzNzY4NQ==", "bodyText": "But it is passed in as the proposal, isn't it? So it's used as prefix. Maybe I missed your point.", "url": "https://github.com/eclipse/xtext-core/pull/1392#discussion_r381337685", "createdAt": "2020-02-19T14:47:19Z", "author": {"login": "JanKoehnlein"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/MultiRootWorkspaceConfigFactory.java", "diffHunk": "@@ -0,0 +1,70 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.ide.server;\n+\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.eclipse.emf.common.util.URI;\n+import org.eclipse.lsp4j.WorkspaceFolder;\n+import org.eclipse.xtext.workspace.FileProjectConfig;\n+import org.eclipse.xtext.workspace.IWorkspaceConfig;\n+import org.eclipse.xtext.workspace.WorkspaceConfig;\n+\n+import com.google.inject.Inject;\n+\n+/**\n+ * Creates one project per workspace root folder.\n+ * \n+ * @author koehnlein - Initial contribution and API\n+ * @since 2.21\n+ */\n+public class MultiRootWorkspaceConfigFactory implements IWorkspaceConfigFactory, IMultiRootWorkspaceConfigFactory {\n+\n+\t@Inject UriExtensions uriExtensions;\n+\t\n+\t@Override\n+\tpublic IWorkspaceConfig getWorkspaceConfig(List<WorkspaceFolder> workspaceFolders) {\n+\t\tWorkspaceConfig workspaceConfig = new WorkspaceConfig();\n+\t\tSet<String> existingProjectNames = new HashSet<>();\n+\t\tfor(WorkspaceFolder workspaceFolder: workspaceFolders) \n+\t\t\taddProjectsForWorkspaceFolder(workspaceConfig, workspaceFolder, existingProjectNames);\n+\t\treturn workspaceConfig;\n+\t}\n+\n+\t@Override\n+\tpublic IWorkspaceConfig getWorkspaceConfig(URI workspaceBaseURI) {\n+\t\tWorkspaceConfig workspaceConfig = new WorkspaceConfig();\n+\t\taddProjectsForWorkspaceFolder(workspaceConfig, new WorkspaceFolder(uriExtensions.toUriString(workspaceBaseURI), \"workspace\"), new HashSet<>());\n+\t\treturn workspaceConfig;\n+\t}\n+\n+\tprotected void addProjectsForWorkspaceFolder(WorkspaceConfig workspaceConfig, WorkspaceFolder workspaceFolder, Set<String> existingNames) {\n+\t\tif (workspaceFolder != null && workspaceFolder.getUri() != null) {\n+\t\t\tFileProjectConfig project = new FileProjectConfig(uriExtensions.toUri(workspaceFolder.getUri()), getUniqueProjectName(workspaceFolder.getName(), existingNames));\n+\t\t\tproject.addSourceFolder(\".\");\n+\t\t\tworkspaceConfig.addProject(project);\n+\t\t}\n+\t}\n+\t\n+\t/**\n+\t * Project names have to be unique, as the WorkspaceManager uses them as keys in a map.\n+\t */\n+\tprotected String getUniqueProjectName(String proposal, Set<String> existingNames){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMyNDc4Ng=="}, "originalCommit": {"oid": "52d115d152716577242a3d816affa28c12847d74"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM0MDE5Mg==", "bodyText": "My bad - I misread the code. I was assuming that the list of workspaces folders is scanned for contained projects, but that's not the case here.", "url": "https://github.com/eclipse/xtext-core/pull/1392#discussion_r381340192", "createdAt": "2020-02-19T14:50:57Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/MultiRootWorkspaceConfigFactory.java", "diffHunk": "@@ -0,0 +1,70 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.ide.server;\n+\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.eclipse.emf.common.util.URI;\n+import org.eclipse.lsp4j.WorkspaceFolder;\n+import org.eclipse.xtext.workspace.FileProjectConfig;\n+import org.eclipse.xtext.workspace.IWorkspaceConfig;\n+import org.eclipse.xtext.workspace.WorkspaceConfig;\n+\n+import com.google.inject.Inject;\n+\n+/**\n+ * Creates one project per workspace root folder.\n+ * \n+ * @author koehnlein - Initial contribution and API\n+ * @since 2.21\n+ */\n+public class MultiRootWorkspaceConfigFactory implements IWorkspaceConfigFactory, IMultiRootWorkspaceConfigFactory {\n+\n+\t@Inject UriExtensions uriExtensions;\n+\t\n+\t@Override\n+\tpublic IWorkspaceConfig getWorkspaceConfig(List<WorkspaceFolder> workspaceFolders) {\n+\t\tWorkspaceConfig workspaceConfig = new WorkspaceConfig();\n+\t\tSet<String> existingProjectNames = new HashSet<>();\n+\t\tfor(WorkspaceFolder workspaceFolder: workspaceFolders) \n+\t\t\taddProjectsForWorkspaceFolder(workspaceConfig, workspaceFolder, existingProjectNames);\n+\t\treturn workspaceConfig;\n+\t}\n+\n+\t@Override\n+\tpublic IWorkspaceConfig getWorkspaceConfig(URI workspaceBaseURI) {\n+\t\tWorkspaceConfig workspaceConfig = new WorkspaceConfig();\n+\t\taddProjectsForWorkspaceFolder(workspaceConfig, new WorkspaceFolder(uriExtensions.toUriString(workspaceBaseURI), \"workspace\"), new HashSet<>());\n+\t\treturn workspaceConfig;\n+\t}\n+\n+\tprotected void addProjectsForWorkspaceFolder(WorkspaceConfig workspaceConfig, WorkspaceFolder workspaceFolder, Set<String> existingNames) {\n+\t\tif (workspaceFolder != null && workspaceFolder.getUri() != null) {\n+\t\t\tFileProjectConfig project = new FileProjectConfig(uriExtensions.toUri(workspaceFolder.getUri()), getUniqueProjectName(workspaceFolder.getName(), existingNames));\n+\t\t\tproject.addSourceFolder(\".\");\n+\t\t\tworkspaceConfig.addProject(project);\n+\t\t}\n+\t}\n+\t\n+\t/**\n+\t * Project names have to be unique, as the WorkspaceManager uses them as keys in a map.\n+\t */\n+\tprotected String getUniqueProjectName(String proposal, Set<String> existingNames){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMyNDc4Ng=="}, "originalCommit": {"oid": "52d115d152716577242a3d816affa28c12847d74"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MDI1ODY0OnYy", "diffSide": "RIGHT", "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/ProjectManager.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNDozMDowOVrOFrqSpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNDo1Njo0NVrOFrrbRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMyNTk4OA==", "bodyText": "I had another expectation from the method name delete.\nMaybe removeAllIssues or discardAllIssues?", "url": "https://github.com/eclipse/xtext-core/pull/1392#discussion_r381325988", "createdAt": "2020-02-19T14:30:09Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/ProjectManager.java", "diffHunk": "@@ -215,4 +215,12 @@ public ProjectDescription getProjectDescription() {\n \tpublic IProjectConfig getProjectConfig() {\n \t\treturn projectConfig;\n \t}\n+\t\n+\tpublic void delete() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52d115d152716577242a3d816affa28c12847d74"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMzOTQ4OA==", "bodyText": "Yes, I thought this more to be the hook to cleanup when the project is deleted from the workspace, but as long as it just discards issues, I can rename it.", "url": "https://github.com/eclipse/xtext-core/pull/1392#discussion_r381339488", "createdAt": "2020-02-19T14:49:55Z", "author": {"login": "JanKoehnlein"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/ProjectManager.java", "diffHunk": "@@ -215,4 +215,12 @@ public ProjectDescription getProjectDescription() {\n \tpublic IProjectConfig getProjectConfig() {\n \t\treturn projectConfig;\n \t}\n+\t\n+\tpublic void delete() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMyNTk4OA=="}, "originalCommit": {"oid": "52d115d152716577242a3d816affa28c12847d74"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM0NDU4MQ==", "bodyText": "What do you think about aboutToDeleteFromWorkspace()?", "url": "https://github.com/eclipse/xtext-core/pull/1392#discussion_r381344581", "createdAt": "2020-02-19T14:56:45Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/ProjectManager.java", "diffHunk": "@@ -215,4 +215,12 @@ public ProjectDescription getProjectDescription() {\n \tpublic IProjectConfig getProjectConfig() {\n \t\treturn projectConfig;\n \t}\n+\t\n+\tpublic void delete() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMyNTk4OA=="}, "originalCommit": {"oid": "52d115d152716577242a3d816affa28c12847d74"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MDI2NDg0OnYy", "diffSide": "RIGHT", "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/ServerModule.xtend", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNDozMTozMlrOFrqWgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNTowNzo1NFrOFrr8MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMyNjk3Nw==", "bodyText": "Clients that used to have bound ProjectWorkspaceConfigFactory to their special subtype would now be broken. If MultiRootWorkspaceConfigFactory was a subtype of ProjectWorkspaceConfigFactory, that could be mitigated.", "url": "https://github.com/eclipse/xtext-core/pull/1392#discussion_r381326977", "createdAt": "2020-02-19T14:31:32Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/ServerModule.xtend", "diffHunk": "@@ -28,9 +28,8 @@ class ServerModule extends AbstractModule {\n \t\t\n     \tbind(LanguageServer).to(LanguageServerImpl)\n         bind(IResourceServiceProvider.Registry).toProvider(ResourceServiceProviderServiceLoader)\n-        bind(IWorkspaceConfigFactory).to(ProjectWorkspaceConfigFactory)\n+        bind(IWorkspaceConfigFactory).to(MultiRootWorkspaceConfigFactory)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52d115d152716577242a3d816affa28c12847d74"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM1MzAwOA==", "bodyText": "All right. Even though MultiRootWorkspaceConfigFactory will not use or expose any method of ProjectWorkspaceConfigFactory.", "url": "https://github.com/eclipse/xtext-core/pull/1392#discussion_r381353008", "createdAt": "2020-02-19T15:07:54Z", "author": {"login": "JanKoehnlein"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/ServerModule.xtend", "diffHunk": "@@ -28,9 +28,8 @@ class ServerModule extends AbstractModule {\n \t\t\n     \tbind(LanguageServer).to(LanguageServerImpl)\n         bind(IResourceServiceProvider.Registry).toProvider(ResourceServiceProviderServiceLoader)\n-        bind(IWorkspaceConfigFactory).to(ProjectWorkspaceConfigFactory)\n+        bind(IWorkspaceConfigFactory).to(MultiRootWorkspaceConfigFactory)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMyNjk3Nw=="}, "originalCommit": {"oid": "52d115d152716577242a3d816affa28c12847d74"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MDI4MDQ5OnYy", "diffSide": "RIGHT", "path": "org.eclipse.xtext.testing/src/org/eclipse/xtext/testing/AbstractLanguageServerTest.xtend", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNDozNToxN1rOFrqgQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNDo1Nzo1OFrOFrre0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMyOTQ3Mg==", "bodyText": "Do I understand this correctly: this change here turns all the tests into MultiWorkspaceRootTests? Or are there still tests for \"old\" clients?", "url": "https://github.com/eclipse/xtext-core/pull/1392#discussion_r381329472", "createdAt": "2020-02-19T14:35:17Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.testing/src/org/eclipse/xtext/testing/AbstractLanguageServerTest.xtend", "diffHunk": "@@ -190,6 +191,9 @@ abstract class AbstractLanguageServerTest implements Endpoint {\n \t\tval params = new InitializeParams => [\n \t\t\tprocessId = 1\n \t\t\trootUri = root.toURI.normalize.toUriString\n+\t\t\tworkspaceFolders = #[", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52d115d152716577242a3d816affa28c12847d74"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM0NTQ5MQ==", "bodyText": "Yes it does. I consider the multi-roots the new default, as the single root is just a special case of it. Only those that bind their own workspaceconfigfactory won't use it", "url": "https://github.com/eclipse/xtext-core/pull/1392#discussion_r381345491", "createdAt": "2020-02-19T14:57:58Z", "author": {"login": "JanKoehnlein"}, "path": "org.eclipse.xtext.testing/src/org/eclipse/xtext/testing/AbstractLanguageServerTest.xtend", "diffHunk": "@@ -190,6 +191,9 @@ abstract class AbstractLanguageServerTest implements Endpoint {\n \t\tval params = new InitializeParams => [\n \t\t\tprocessId = 1\n \t\t\trootUri = root.toURI.normalize.toUriString\n+\t\t\tworkspaceFolders = #[", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMyOTQ3Mg=="}, "originalCommit": {"oid": "52d115d152716577242a3d816affa28c12847d74"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MDI4ODc2OnYy", "diffSide": "RIGHT", "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/WorkspaceManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNDozNzoxMFrOFrqlcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNTowODoyOVrOFrr93w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMzMDgwMA==", "bodyText": "See question above on the interface IMultiRootWorkspaceConfigFactory - this code here suggests that the \"normal\" workspaceConfigFactory and the multi root incarnation of it are in an inheritance relationship.", "url": "https://github.com/eclipse/xtext-core/pull/1392#discussion_r381330800", "createdAt": "2020-02-19T14:37:10Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/WorkspaceManager.java", "diffHunk": "@@ -141,16 +149,68 @@ public void setBuildManager(BuildManager buildManager) {\n \t */\n \tpublic void initialize(URI baseDir, Procedure2<? super URI, ? super Iterable<Issue>> issueAcceptor,\n \t\t\tCancelIndicator cancelIndicator) {\n-\t\tthis.baseDir = baseDir;\n+\t\tif (isSupportsWorkspaceFolders()) {\n+\t\t\tWorkspaceFolder workspaceFolder = new WorkspaceFolder(uriExtensions.toUriString(baseDir), \"workspace\");\n+\t\t\tinitialize(Collections.singletonList(workspaceFolder), issueAcceptor, cancelIndicator);\t\t\t\n+\t\t} else {\n+\t\t\tthis.baseDir = baseDir;\n+\t\t\tthis.issueAcceptor = issueAcceptor;\n+\t\t\trefreshWorkspaceConfig(cancelIndicator);\n+\t\t}\n+\t}\n+\n+\t/**\n+\t * Initialize a workspace with the given workspace folders.\n+\t *\n+\t * @param workspaceFolders\n+\t *            the list of workspace root folders\n+\t * @param issueAcceptor\n+\t *            the issue acceptor\n+\t * @param cancelIndicator\n+\t *            allows to cancel the initialization\n+\t * @since 2.21\n+\t */\n+\tpublic void initialize(List<WorkspaceFolder> workspaceFolders, Procedure2<? super URI, ? super Iterable<Issue>> issueAcceptor,\n+\t\t\tCancelIndicator cancelIndicator) {\n+\t\tthis.workspaceFolders = new ArrayList<>(workspaceFolders);\n \t\tthis.issueAcceptor = issueAcceptor;\n \t\trefreshWorkspaceConfig(cancelIndicator);\n \t}\n \n+\t/**\n+\t * @return whether this workspace manager supports multiple workspace root folders.\n+\t * @since 2.21\n+\t */\n+\tpublic boolean isSupportsWorkspaceFolders() {\n+\t\treturn workspaceConfigFactory instanceof IMultiRootWorkspaceConfigFactory;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52d115d152716577242a3d816affa28c12847d74"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM1MzQzOQ==", "bodyText": "Changed it.", "url": "https://github.com/eclipse/xtext-core/pull/1392#discussion_r381353439", "createdAt": "2020-02-19T15:08:29Z", "author": {"login": "JanKoehnlein"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/WorkspaceManager.java", "diffHunk": "@@ -141,16 +149,68 @@ public void setBuildManager(BuildManager buildManager) {\n \t */\n \tpublic void initialize(URI baseDir, Procedure2<? super URI, ? super Iterable<Issue>> issueAcceptor,\n \t\t\tCancelIndicator cancelIndicator) {\n-\t\tthis.baseDir = baseDir;\n+\t\tif (isSupportsWorkspaceFolders()) {\n+\t\t\tWorkspaceFolder workspaceFolder = new WorkspaceFolder(uriExtensions.toUriString(baseDir), \"workspace\");\n+\t\t\tinitialize(Collections.singletonList(workspaceFolder), issueAcceptor, cancelIndicator);\t\t\t\n+\t\t} else {\n+\t\t\tthis.baseDir = baseDir;\n+\t\t\tthis.issueAcceptor = issueAcceptor;\n+\t\t\trefreshWorkspaceConfig(cancelIndicator);\n+\t\t}\n+\t}\n+\n+\t/**\n+\t * Initialize a workspace with the given workspace folders.\n+\t *\n+\t * @param workspaceFolders\n+\t *            the list of workspace root folders\n+\t * @param issueAcceptor\n+\t *            the issue acceptor\n+\t * @param cancelIndicator\n+\t *            allows to cancel the initialization\n+\t * @since 2.21\n+\t */\n+\tpublic void initialize(List<WorkspaceFolder> workspaceFolders, Procedure2<? super URI, ? super Iterable<Issue>> issueAcceptor,\n+\t\t\tCancelIndicator cancelIndicator) {\n+\t\tthis.workspaceFolders = new ArrayList<>(workspaceFolders);\n \t\tthis.issueAcceptor = issueAcceptor;\n \t\trefreshWorkspaceConfig(cancelIndicator);\n \t}\n \n+\t/**\n+\t * @return whether this workspace manager supports multiple workspace root folders.\n+\t * @since 2.21\n+\t */\n+\tpublic boolean isSupportsWorkspaceFolders() {\n+\t\treturn workspaceConfigFactory instanceof IMultiRootWorkspaceConfigFactory;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMzMDgwMA=="}, "originalCommit": {"oid": "52d115d152716577242a3d816affa28c12847d74"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MTUwNDIxOnYy", "diffSide": "RIGHT", "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/server/WorkspaceFoldersTest.xtend", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMDoyODoyOFrOFr2d-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxMDowNTowMVrOFsNQUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTUyNTQ5OQ==", "bodyText": "Mixed whitespace", "url": "https://github.com/eclipse/xtext-core/pull/1392#discussion_r381525499", "createdAt": "2020-02-19T20:28:28Z", "author": {"login": "tivervac"}, "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/server/WorkspaceFoldersTest.xtend", "diffHunk": "@@ -0,0 +1,126 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.ide.tests.server\n+\n+import com.google.inject.AbstractModule\n+import com.google.inject.Inject\n+import com.google.inject.Module\n+import com.google.inject.Scopes\n+import java.io.File\n+import java.io.FileWriter\n+import java.util.concurrent.CompletableFuture\n+import org.eclipse.lsp4j.DidChangeWorkspaceFoldersParams\n+import org.eclipse.lsp4j.WorkspaceFolder\n+import org.eclipse.lsp4j.WorkspaceFoldersChangeEvent\n+import org.eclipse.xtext.ide.server.UriExtensions\n+import org.eclipse.xtext.ide.server.WorkspaceManager\n+import org.eclipse.xtext.util.Files\n+import org.eclipse.xtext.util.Modules2\n+import org.junit.Test\n+\n+import static org.junit.Assert.assertEquals\n+import org.junit.rules.TemporaryFolder\n+\n+/**\n+ * @author Jan Koehnlein - Initial contribution and API\n+ */\n+class WorkspaceFoldersTest extends AbstractTestLangLanguageServerTest {\n+\t\n+\t@Inject extension UriExtensions\n+\t\n+\t@Inject WorkspaceManager workspaceManager\n+\t\n+\t@Inject extension TemporaryFolder \n+\t\n+\t@Test\n+\tdef void testInitialize() {\n+\t\tval rootFolder1 = getRoot('root1') \n+\t\tval rootFolder2 = getRoot('root2') \n+\t\twriteFile(rootFolder1, \"one.testlang\", '''\n+\t\t\ttype Foo {\n+\t\t\t\tBar bar\n+\t\t\t}\n+\t\t''')\n+\t\tval twoUri = writeFile(rootFolder2, \"two.testlang\", '''\n+\t\t\ttype Bar {\n+\t\t\t\tFoo foo\n+\t\t\t}\n+\t\t''')\n+\t\tinitialize[ \n+\t\t\tworkspaceFolders = #[\n+\t\t\t\tnew WorkspaceFolder(rootFolder1.toURI.toUriString, 'root1'),\n+\t\t\t\tnew WorkspaceFolder(rootFolder2.toURI.toUriString, 'root2')\n+\t\t\t]\n+\t\t]\n+\t\tassertEquals(2, diagnostics.size)\n+\t\tassertEquals(1, diagnostics.get(twoUri).size)\n+\t\twithBuild [\n+\t\t\tlanguageServer.didChangeWorkspaceFolders(new DidChangeWorkspaceFoldersParams => [\n+\t\t\t\tevent = new WorkspaceFoldersChangeEvent => [\n+\t\t\t\t\tremoved = #[\n+\t\t\t\t\t\tnew WorkspaceFolder(rootFolder2.toURI.toUriString, 'root2')\n+\t\t\t\t\t]\n+\t\t\t\t]\n+\t\t\t])\n+\t\t]\t\n+\t\tassertEquals(0, diagnostics.get(twoUri).size)\n+\t\twithBuild [\n+\t\t\tlanguageServer.didChangeWorkspaceFolders(new DidChangeWorkspaceFoldersParams => [\n+\t\t\t\tevent = new WorkspaceFoldersChangeEvent => [\n+\t\t\t\t\tadded = #[\n+\t\t\t\t\t\tnew WorkspaceFolder(rootFolder2.toURI.toUriString, 'root2')\n+\t\t\t\t\t]\n+\t\t\t\t]\n+\t\t\t])\n+\t\t]\t\n+\t\tassertEquals(1, diagnostics.get(twoUri).size)\n+\t}\n+\n+\tprotected def void withBuild(()=>void lambda) {\n+\t\tval future = new CompletableFuture<Void>()\n+\t\tworkspaceManager.addBuildListener[  \n+\t\t\tworkspaceManager.removeBuildListener(self)\n+\t\t\tfuture.complete(null)\t\t\t\n+\t\t]\n+\t\tlambda.apply\n+\t\tfuture.get\n+\t}\n+\n+    protected def getRoot(String path) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "193089fe0069579dabe0fad64f3ecee6dec34015"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg5ODgzMg==", "bodyText": "Fixed", "url": "https://github.com/eclipse/xtext-core/pull/1392#discussion_r381898832", "createdAt": "2020-02-20T10:05:01Z", "author": {"login": "JanKoehnlein"}, "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/server/WorkspaceFoldersTest.xtend", "diffHunk": "@@ -0,0 +1,126 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.ide.tests.server\n+\n+import com.google.inject.AbstractModule\n+import com.google.inject.Inject\n+import com.google.inject.Module\n+import com.google.inject.Scopes\n+import java.io.File\n+import java.io.FileWriter\n+import java.util.concurrent.CompletableFuture\n+import org.eclipse.lsp4j.DidChangeWorkspaceFoldersParams\n+import org.eclipse.lsp4j.WorkspaceFolder\n+import org.eclipse.lsp4j.WorkspaceFoldersChangeEvent\n+import org.eclipse.xtext.ide.server.UriExtensions\n+import org.eclipse.xtext.ide.server.WorkspaceManager\n+import org.eclipse.xtext.util.Files\n+import org.eclipse.xtext.util.Modules2\n+import org.junit.Test\n+\n+import static org.junit.Assert.assertEquals\n+import org.junit.rules.TemporaryFolder\n+\n+/**\n+ * @author Jan Koehnlein - Initial contribution and API\n+ */\n+class WorkspaceFoldersTest extends AbstractTestLangLanguageServerTest {\n+\t\n+\t@Inject extension UriExtensions\n+\t\n+\t@Inject WorkspaceManager workspaceManager\n+\t\n+\t@Inject extension TemporaryFolder \n+\t\n+\t@Test\n+\tdef void testInitialize() {\n+\t\tval rootFolder1 = getRoot('root1') \n+\t\tval rootFolder2 = getRoot('root2') \n+\t\twriteFile(rootFolder1, \"one.testlang\", '''\n+\t\t\ttype Foo {\n+\t\t\t\tBar bar\n+\t\t\t}\n+\t\t''')\n+\t\tval twoUri = writeFile(rootFolder2, \"two.testlang\", '''\n+\t\t\ttype Bar {\n+\t\t\t\tFoo foo\n+\t\t\t}\n+\t\t''')\n+\t\tinitialize[ \n+\t\t\tworkspaceFolders = #[\n+\t\t\t\tnew WorkspaceFolder(rootFolder1.toURI.toUriString, 'root1'),\n+\t\t\t\tnew WorkspaceFolder(rootFolder2.toURI.toUriString, 'root2')\n+\t\t\t]\n+\t\t]\n+\t\tassertEquals(2, diagnostics.size)\n+\t\tassertEquals(1, diagnostics.get(twoUri).size)\n+\t\twithBuild [\n+\t\t\tlanguageServer.didChangeWorkspaceFolders(new DidChangeWorkspaceFoldersParams => [\n+\t\t\t\tevent = new WorkspaceFoldersChangeEvent => [\n+\t\t\t\t\tremoved = #[\n+\t\t\t\t\t\tnew WorkspaceFolder(rootFolder2.toURI.toUriString, 'root2')\n+\t\t\t\t\t]\n+\t\t\t\t]\n+\t\t\t])\n+\t\t]\t\n+\t\tassertEquals(0, diagnostics.get(twoUri).size)\n+\t\twithBuild [\n+\t\t\tlanguageServer.didChangeWorkspaceFolders(new DidChangeWorkspaceFoldersParams => [\n+\t\t\t\tevent = new WorkspaceFoldersChangeEvent => [\n+\t\t\t\t\tadded = #[\n+\t\t\t\t\t\tnew WorkspaceFolder(rootFolder2.toURI.toUriString, 'root2')\n+\t\t\t\t\t]\n+\t\t\t\t]\n+\t\t\t])\n+\t\t]\t\n+\t\tassertEquals(1, diagnostics.get(twoUri).size)\n+\t}\n+\n+\tprotected def void withBuild(()=>void lambda) {\n+\t\tval future = new CompletableFuture<Void>()\n+\t\tworkspaceManager.addBuildListener[  \n+\t\t\tworkspaceManager.removeBuildListener(self)\n+\t\t\tfuture.complete(null)\t\t\t\n+\t\t]\n+\t\tlambda.apply\n+\t\tfuture.get\n+\t}\n+\n+    protected def getRoot(String path) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTUyNTQ5OQ=="}, "originalCommit": {"oid": "193089fe0069579dabe0fad64f3ecee6dec34015"}, "originalPosition": 95}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MTUxNDQxOnYy", "diffSide": "RIGHT", "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/MultiRootWorkspaceConfigFactory.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMDozMTozNFrOFr2kHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMDozMTozNFrOFr2kHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTUyNzA3MQ==", "bodyText": "Probably want your full name here", "url": "https://github.com/eclipse/xtext-core/pull/1392#discussion_r381527071", "createdAt": "2020-02-19T20:31:34Z", "author": {"login": "tivervac"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/MultiRootWorkspaceConfigFactory.java", "diffHunk": "@@ -0,0 +1,70 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.ide.server;\n+\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.eclipse.emf.common.util.URI;\n+import org.eclipse.lsp4j.WorkspaceFolder;\n+import org.eclipse.xtext.workspace.FileProjectConfig;\n+import org.eclipse.xtext.workspace.IWorkspaceConfig;\n+import org.eclipse.xtext.workspace.WorkspaceConfig;\n+\n+import com.google.inject.Inject;\n+\n+/**\n+ * Creates one project per workspace root folder.\n+ * \n+ * @author koehnlein - Initial contribution and API", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "193089fe0069579dabe0fad64f3ecee6dec34015"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MTUyNzU5OnYy", "diffSide": "RIGHT", "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/WorkspaceManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMDozNTozOFrOFr2sCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxMDowNTo0M1rOFsNRyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTUyOTA5OA==", "bodyText": "Seems like a weird name to me. I'd prefer something like supportsWorkspaceFolders", "url": "https://github.com/eclipse/xtext-core/pull/1392#discussion_r381529098", "createdAt": "2020-02-19T20:35:38Z", "author": {"login": "tivervac"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/WorkspaceManager.java", "diffHunk": "@@ -141,16 +149,68 @@ public void setBuildManager(BuildManager buildManager) {\n \t */\n \tpublic void initialize(URI baseDir, Procedure2<? super URI, ? super Iterable<Issue>> issueAcceptor,\n \t\t\tCancelIndicator cancelIndicator) {\n-\t\tthis.baseDir = baseDir;\n+\t\tif (isSupportsWorkspaceFolders()) {\n+\t\t\tWorkspaceFolder workspaceFolder = new WorkspaceFolder(uriExtensions.toUriString(baseDir), \"workspace\");\n+\t\t\tinitialize(Collections.singletonList(workspaceFolder), issueAcceptor, cancelIndicator);\t\t\t\n+\t\t} else {\n+\t\t\tthis.baseDir = baseDir;\n+\t\t\tthis.issueAcceptor = issueAcceptor;\n+\t\t\trefreshWorkspaceConfig(cancelIndicator);\n+\t\t}\n+\t}\n+\n+\t/**\n+\t * Initialize a workspace with the given workspace folders.\n+\t *\n+\t * @param workspaceFolders\n+\t *            the list of workspace root folders\n+\t * @param issueAcceptor\n+\t *            the issue acceptor\n+\t * @param cancelIndicator\n+\t *            allows to cancel the initialization\n+\t * @since 2.21\n+\t */\n+\tpublic void initialize(List<WorkspaceFolder> workspaceFolders, Procedure2<? super URI, ? super Iterable<Issue>> issueAcceptor,\n+\t\t\tCancelIndicator cancelIndicator) {\n+\t\tthis.workspaceFolders = new ArrayList<>(workspaceFolders);\n \t\tthis.issueAcceptor = issueAcceptor;\n \t\trefreshWorkspaceConfig(cancelIndicator);\n \t}\n \n+\t/**\n+\t * @return whether this workspace manager supports multiple workspace root folders.\n+\t * @since 2.21\n+\t */\n+\tpublic boolean isSupportsWorkspaceFolders() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "193089fe0069579dabe0fad64f3ecee6dec34015"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg5OTIxMA==", "bodyText": "It is Java-beans style. I'll leave that as is.", "url": "https://github.com/eclipse/xtext-core/pull/1392#discussion_r381899210", "createdAt": "2020-02-20T10:05:43Z", "author": {"login": "JanKoehnlein"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/WorkspaceManager.java", "diffHunk": "@@ -141,16 +149,68 @@ public void setBuildManager(BuildManager buildManager) {\n \t */\n \tpublic void initialize(URI baseDir, Procedure2<? super URI, ? super Iterable<Issue>> issueAcceptor,\n \t\t\tCancelIndicator cancelIndicator) {\n-\t\tthis.baseDir = baseDir;\n+\t\tif (isSupportsWorkspaceFolders()) {\n+\t\t\tWorkspaceFolder workspaceFolder = new WorkspaceFolder(uriExtensions.toUriString(baseDir), \"workspace\");\n+\t\t\tinitialize(Collections.singletonList(workspaceFolder), issueAcceptor, cancelIndicator);\t\t\t\n+\t\t} else {\n+\t\t\tthis.baseDir = baseDir;\n+\t\t\tthis.issueAcceptor = issueAcceptor;\n+\t\t\trefreshWorkspaceConfig(cancelIndicator);\n+\t\t}\n+\t}\n+\n+\t/**\n+\t * Initialize a workspace with the given workspace folders.\n+\t *\n+\t * @param workspaceFolders\n+\t *            the list of workspace root folders\n+\t * @param issueAcceptor\n+\t *            the issue acceptor\n+\t * @param cancelIndicator\n+\t *            allows to cancel the initialization\n+\t * @since 2.21\n+\t */\n+\tpublic void initialize(List<WorkspaceFolder> workspaceFolders, Procedure2<? super URI, ? super Iterable<Issue>> issueAcceptor,\n+\t\t\tCancelIndicator cancelIndicator) {\n+\t\tthis.workspaceFolders = new ArrayList<>(workspaceFolders);\n \t\tthis.issueAcceptor = issueAcceptor;\n \t\trefreshWorkspaceConfig(cancelIndicator);\n \t}\n \n+\t/**\n+\t * @return whether this workspace manager supports multiple workspace root folders.\n+\t * @since 2.21\n+\t */\n+\tpublic boolean isSupportsWorkspaceFolders() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTUyOTA5OA=="}, "originalCommit": {"oid": "193089fe0069579dabe0fad64f3ecee6dec34015"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NDE3MTYyOnYy", "diffSide": "RIGHT", "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/server/WorkspaceFoldersTest.xtend", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxMDoxMDowMFrOFsNbBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxMDoyODo1NFrOFsOEDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTkwMTU3NQ==", "bodyText": "Must be a public field and annotated with @Rule to take effect.\nThe Javadoc of TemporaryFolder has an example.", "url": "https://github.com/eclipse/xtext-core/pull/1392#discussion_r381901575", "createdAt": "2020-02-20T10:10:00Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/server/WorkspaceFoldersTest.xtend", "diffHunk": "@@ -0,0 +1,126 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.ide.tests.server\n+\n+import com.google.inject.AbstractModule\n+import com.google.inject.Inject\n+import com.google.inject.Module\n+import com.google.inject.Scopes\n+import java.io.File\n+import java.io.FileWriter\n+import java.util.concurrent.CompletableFuture\n+import org.eclipse.lsp4j.DidChangeWorkspaceFoldersParams\n+import org.eclipse.lsp4j.WorkspaceFolder\n+import org.eclipse.lsp4j.WorkspaceFoldersChangeEvent\n+import org.eclipse.xtext.ide.server.UriExtensions\n+import org.eclipse.xtext.ide.server.WorkspaceManager\n+import org.eclipse.xtext.util.Files\n+import org.eclipse.xtext.util.Modules2\n+import org.junit.Test\n+\n+import static org.junit.Assert.assertEquals\n+import org.junit.rules.TemporaryFolder\n+\n+/**\n+ * @author Jan Koehnlein - Initial contribution and API\n+ */\n+class WorkspaceFoldersTest extends AbstractTestLangLanguageServerTest {\n+\n+\t@Inject extension UriExtensions\n+\n+\t@Inject WorkspaceManager workspaceManager\n+\n+\t@Inject extension TemporaryFolder ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89e84bffa10683317e35a96903a9b4013298aa08"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTkxMjA3Ng==", "bodyText": "Fixed. Thanks", "url": "https://github.com/eclipse/xtext-core/pull/1392#discussion_r381912076", "createdAt": "2020-02-20T10:28:54Z", "author": {"login": "JanKoehnlein"}, "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/server/WorkspaceFoldersTest.xtend", "diffHunk": "@@ -0,0 +1,126 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.ide.tests.server\n+\n+import com.google.inject.AbstractModule\n+import com.google.inject.Inject\n+import com.google.inject.Module\n+import com.google.inject.Scopes\n+import java.io.File\n+import java.io.FileWriter\n+import java.util.concurrent.CompletableFuture\n+import org.eclipse.lsp4j.DidChangeWorkspaceFoldersParams\n+import org.eclipse.lsp4j.WorkspaceFolder\n+import org.eclipse.lsp4j.WorkspaceFoldersChangeEvent\n+import org.eclipse.xtext.ide.server.UriExtensions\n+import org.eclipse.xtext.ide.server.WorkspaceManager\n+import org.eclipse.xtext.util.Files\n+import org.eclipse.xtext.util.Modules2\n+import org.junit.Test\n+\n+import static org.junit.Assert.assertEquals\n+import org.junit.rules.TemporaryFolder\n+\n+/**\n+ * @author Jan Koehnlein - Initial contribution and API\n+ */\n+class WorkspaceFoldersTest extends AbstractTestLangLanguageServerTest {\n+\n+\t@Inject extension UriExtensions\n+\n+\t@Inject WorkspaceManager workspaceManager\n+\n+\t@Inject extension TemporaryFolder ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTkwMTU3NQ=="}, "originalCommit": {"oid": "89e84bffa10683317e35a96903a9b4013298aa08"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NDE3MzEwOnYy", "diffSide": "RIGHT", "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/server/WorkspaceFoldersTest.xtend", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxMDoxMDoyMlrOFsNb0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxMDoxMDoyMlrOFsNb0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTkwMTc3OQ==", "bodyText": "This shouldn't be necessary when working with the TemporaryFolder rule", "url": "https://github.com/eclipse/xtext-core/pull/1392#discussion_r381901779", "createdAt": "2020-02-20T10:10:22Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/server/WorkspaceFoldersTest.xtend", "diffHunk": "@@ -0,0 +1,126 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.ide.tests.server\n+\n+import com.google.inject.AbstractModule\n+import com.google.inject.Inject\n+import com.google.inject.Module\n+import com.google.inject.Scopes\n+import java.io.File\n+import java.io.FileWriter\n+import java.util.concurrent.CompletableFuture\n+import org.eclipse.lsp4j.DidChangeWorkspaceFoldersParams\n+import org.eclipse.lsp4j.WorkspaceFolder\n+import org.eclipse.lsp4j.WorkspaceFoldersChangeEvent\n+import org.eclipse.xtext.ide.server.UriExtensions\n+import org.eclipse.xtext.ide.server.WorkspaceManager\n+import org.eclipse.xtext.util.Files\n+import org.eclipse.xtext.util.Modules2\n+import org.junit.Test\n+\n+import static org.junit.Assert.assertEquals\n+import org.junit.rules.TemporaryFolder\n+\n+/**\n+ * @author Jan Koehnlein - Initial contribution and API\n+ */\n+class WorkspaceFoldersTest extends AbstractTestLangLanguageServerTest {\n+\n+\t@Inject extension UriExtensions\n+\n+\t@Inject WorkspaceManager workspaceManager\n+\n+\t@Inject extension TemporaryFolder \n+\n+\t@Test\n+\tdef void testInitialize() {\n+\t\tval rootFolder1 = getRoot('root1') \n+\t\tval rootFolder2 = getRoot('root2') \n+\t\twriteFile(rootFolder1, \"one.testlang\", '''\n+\t\t\ttype Foo {\n+\t\t\t\tBar bar\n+\t\t\t}\n+\t\t''')\n+\t\tval twoUri = writeFile(rootFolder2, \"two.testlang\", '''\n+\t\t\ttype Bar {\n+\t\t\t\tFoo foo\n+\t\t\t}\n+\t\t''')\n+\t\tinitialize[ \n+\t\t\tworkspaceFolders = #[\n+\t\t\t\tnew WorkspaceFolder(rootFolder1.toURI.toUriString, 'root1'),\n+\t\t\t\tnew WorkspaceFolder(rootFolder2.toURI.toUriString, 'root2')\n+\t\t\t]\n+\t\t]\n+\t\tassertEquals(2, diagnostics.size)\n+\t\tassertEquals(1, diagnostics.get(twoUri).size)\n+\t\twithBuild [\n+\t\t\tlanguageServer.didChangeWorkspaceFolders(new DidChangeWorkspaceFoldersParams => [\n+\t\t\t\tevent = new WorkspaceFoldersChangeEvent => [\n+\t\t\t\t\tremoved = #[\n+\t\t\t\t\t\tnew WorkspaceFolder(rootFolder2.toURI.toUriString, 'root2')\n+\t\t\t\t\t]\n+\t\t\t\t]\n+\t\t\t])\n+\t\t]\t\n+\t\tassertEquals(0, diagnostics.get(twoUri).size)\n+\t\twithBuild [\n+\t\t\tlanguageServer.didChangeWorkspaceFolders(new DidChangeWorkspaceFoldersParams => [\n+\t\t\t\tevent = new WorkspaceFoldersChangeEvent => [\n+\t\t\t\t\tadded = #[\n+\t\t\t\t\t\tnew WorkspaceFolder(rootFolder2.toURI.toUriString, 'root2')\n+\t\t\t\t\t]\n+\t\t\t\t]\n+\t\t\t])\n+\t\t]\t\n+\t\tassertEquals(1, diagnostics.get(twoUri).size)\n+\t}\n+\n+\tprotected def void withBuild(()=>void lambda) {\n+\t\tval future = new CompletableFuture<Void>()\n+\t\tworkspaceManager.addBuildListener[  \n+\t\t\tworkspaceManager.removeBuildListener(self)\n+\t\t\tfuture.complete(null)\t\t\t\n+\t\t]\n+\t\tlambda.apply\n+\t\tfuture.get\n+\t}\n+\n+\tprotected def getRoot(String path) {\n+\t\tval root = newFolder(path)\n+\t\tif (!root.mkdirs) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89e84bffa10683317e35a96903a9b4013298aa08"}, "originalPosition": 97}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NDE5OTM4OnYy", "diffSide": "RIGHT", "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/WorkspaceManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxMDoxNzo1OVrOFsNsOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxMDo1OTowNlrOFsPB7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTkwNTk3OQ==", "bodyText": "I've the feeling that baseDir should be removed and the list of workspaceFolders should always be used.\nIf isSupports..() is false, the baseDir could be unwrapped from the a single workspaceFolder.\nCan we add a protected getter for the workspaceFolders?", "url": "https://github.com/eclipse/xtext-core/pull/1392#discussion_r381905979", "createdAt": "2020-02-20T10:17:59Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/WorkspaceManager.java", "diffHunk": "@@ -60,11 +63,16 @@\n \n \t@Inject\n \tprivate IProjectDescriptionFactory projectDescriptionFactory;\n+\t\n+\t@Inject \n+\tprivate UriExtensions uriExtensions;\n \n \tprivate BuildManager buildManager;\n \n \tprivate URI baseDir;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89e84bffa10683317e35a96903a9b4013298aa08"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTkyNzkxNw==", "bodyText": "OK.", "url": "https://github.com/eclipse/xtext-core/pull/1392#discussion_r381927917", "createdAt": "2020-02-20T10:59:06Z", "author": {"login": "JanKoehnlein"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/WorkspaceManager.java", "diffHunk": "@@ -60,11 +63,16 @@\n \n \t@Inject\n \tprivate IProjectDescriptionFactory projectDescriptionFactory;\n+\t\n+\t@Inject \n+\tprivate UriExtensions uriExtensions;\n \n \tprivate BuildManager buildManager;\n \n \tprivate URI baseDir;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTkwNTk3OQ=="}, "originalCommit": {"oid": "89e84bffa10683317e35a96903a9b4013298aa08"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1025, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}