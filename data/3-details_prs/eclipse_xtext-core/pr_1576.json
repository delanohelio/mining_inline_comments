{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwMTg0MDM4", "number": 1576, "title": "[eclipse/xtext#1851] Fixed regression with InjectionExtension", "bodyText": "Feature: Allow to use RegisterExtension along with injected fields.\nReleng: Make sure that we run the testing.tests for Junit5 on Jenkins.\n\ncloses eclipse/xtext#1851", "createdAt": "2020-09-21T10:09:10Z", "url": "https://github.com/eclipse/xtext-core/pull/1576", "merged": true, "mergeCommit": {"oid": "d6426978c666b4aa9dfde746fb0899170ba9648c"}, "closed": true, "closedAt": "2020-09-22T07:17:25Z", "author": {"login": "szarnekow"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLAlbYgFqTQ5MjQ1MDY0MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLEmT0ABqjM3ODkwOTQzMjg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyNDUwNjQx", "url": "https://github.com/eclipse/xtext-core/pull/1576#pullrequestreview-492450641", "createdAt": "2020-09-21T10:11:17Z", "commit": {"oid": "17a31b90059de1fc9b013ce45e348f0fd7de9ce5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMDoxMToxN1rOHVI_DA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMDoxMToxN1rOHVI_DA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTkyOTM1Ng==", "bodyText": "no version range here?", "url": "https://github.com/eclipse/xtext-core/pull/1576#discussion_r491929356", "createdAt": "2020-09-21T10:11:17Z", "author": {"login": "cdietrich"}, "path": "org.eclipse.xtext.testing/META-INF/MANIFEST.MF", "diffHunk": "@@ -27,7 +27,9 @@ Require-Bundle: org.eclipse.xtext;visibility:=reexport,\n  org.eclipse.xtend.lib\n Import-Package: org.apache.log4j;version=\"1.2.15\",\n  org.apache.log4j.spi;version=\"1.2.15\",\n- org.junit.jupiter.api.extension;version=\"[5.0.0,6.0.0)\";resolution:=optional\n+ org.junit.jupiter.api.extension;version=\"[5.0.0,6.0.0)\";resolution:=optional,\n+ org.junit.platform.runner;resolution:=optional,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17a31b90059de1fc9b013ce45e348f0fd7de9ce5"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyNDUxMTcz", "url": "https://github.com/eclipse/xtext-core/pull/1576#pullrequestreview-492451173", "createdAt": "2020-09-21T10:12:05Z", "commit": {"oid": "17a31b90059de1fc9b013ce45e348f0fd7de9ce5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMDoxMjowNVrOHVJArg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMDoxMjowNVrOHVJArg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTkyOTc3NA==", "bodyText": "?", "url": "https://github.com/eclipse/xtext-core/pull/1576#discussion_r491929774", "createdAt": "2020-09-21T10:12:05Z", "author": {"login": "cdietrich"}, "path": "org.eclipse.xtext.testing/src/org/eclipse/xtext/testing/smoketest/internal/RunnerBuilder.java", "diffHunk": "@@ -72,6 +72,7 @@ public Runner runnerForClass(Class<?> testClass) throws Throwable {\n \t\tprivate final ProcessedBy processor;\n \t\tprivate final Scenario[] scenarios;\n \t\t\n+\t\t@SuppressWarnings(\"deprecation\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17a31b90059de1fc9b013ce45e348f0fd7de9ce5"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyNDUxNzkx", "url": "https://github.com/eclipse/xtext-core/pull/1576#pullrequestreview-492451791", "createdAt": "2020-09-21T10:12:46Z", "commit": {"oid": "17a31b90059de1fc9b013ce45e348f0fd7de9ce5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMDoxMjo0N1rOHVJCAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMDoxMjo0N1rOHVJCAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTkzMDExNA==", "bodyText": "what is this class good for?", "url": "https://github.com/eclipse/xtext-core/pull/1576#discussion_r491930114", "createdAt": "2020-09-21T10:12:47Z", "author": {"login": "cdietrich"}, "path": "org.eclipse.xtext.testing/tests/org/eclipse/xtext/testing/tests/junit5/RunJunit5Suite.java", "diffHunk": "@@ -0,0 +1,19 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 Sebastian Zarnekow and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.testing.tests.junit5;\n+\n+import org.junit.runner.RunWith;\n+import org.junit.platform.runner.JUnitPlatform;\n+import org.junit.platform.suite.api.SelectPackages;\n+\n+@RunWith(JUnitPlatform.class)\n+@SelectPackages(\"org.eclipse.xtext.testing.tests.junit5\")\n+public class RunJunit5Suite {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17a31b90059de1fc9b013ce45e348f0fd7de9ce5"}, "originalPosition": 17}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "17a31b90059de1fc9b013ce45e348f0fd7de9ce5", "author": {"user": {"login": "szarnekow", "name": "Sebastian Zarnekow"}}, "url": "https://github.com/eclipse/xtext-core/commit/17a31b90059de1fc9b013ce45e348f0fd7de9ce5", "committedDate": "2020-09-21T10:02:27Z", "message": "Fixed regression with InjectionExtension\n\n- Feature: Allow to use RegisterExtension along with injected fields.\n- Releng: Make sure that we run the testing.tests for Junit5 on Jenkins.\n\ncloses eclipse/xtext#1851"}, "afterCommit": {"oid": "c01ae557c7eb15b687765ddaace1359500d8644e", "author": {"user": {"login": "szarnekow", "name": "Sebastian Zarnekow"}}, "url": "https://github.com/eclipse/xtext-core/commit/c01ae557c7eb15b687765ddaace1359500d8644e", "committedDate": "2020-09-21T10:14:40Z", "message": "Fixed regression with InjectionExtension\n\n- Feature: Allow to use RegisterExtension along with injected fields.\n- Releng: Make sure that we run the testing.tests for Junit5 on Jenkins.\n\ncloses eclipse/xtext#1851"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyNDYxMzQy", "url": "https://github.com/eclipse/xtext-core/pull/1576#pullrequestreview-492461342", "createdAt": "2020-09-21T10:25:20Z", "commit": {"oid": "c01ae557c7eb15b687765ddaace1359500d8644e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMDoyNToyMFrOHVJhAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMDoyNToyMFrOHVJhAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTkzODA0OQ==", "bodyText": "is this no longer an issue?\nwe dont package at umbrella", "url": "https://github.com/eclipse/xtext-core/pull/1576#discussion_r491938049", "createdAt": "2020-09-21T10:25:20Z", "author": {"login": "cdietrich"}, "path": "org.eclipse.xtext.testing/src/org/eclipse/xtext/testing/extensions/InjectionExtension.java", "diffHunk": "@@ -49,66 +52,85 @@\n \t * </p>\n \t */\n \tprivate static ClassToInstanceMap<IInjectorProvider> injectorProviderClassCache = MutableClassToInstanceMap.create();\n+\t\n+\t/**\n+\t * @since 2.24\n+\t */\n+\tprotected static class RegistryReset implements CloseableResource {\n+\t\tprotected IRegistryConfigurator resetter;\n+\n+\t\tpublic RegistryReset(IRegistryConfigurator resetter) {\n+\t\t\tthis.resetter = resetter;\n+\t\t\tresetter.setupRegistry();\n+\t\t}\n+\n+\t\t@Override\n+\t\tpublic void close() throws Throwable {\n+\t\t\tif (resetter != null) {\n+\t\t\t\tresetter.restoreRegistry();\n+\t\t\t\tresetter = null;\n+\t\t\t}\n+\t\t}\n+\t}\n \n+\t/**\n+\t * @since 2.24\n+\t */\n \t@Override\n-\tpublic void beforeEach(ExtensionContext context) throws Exception {\n+\tpublic void postProcessTestInstance(Object testInstance, ExtensionContext context) throws Exception {\n \t\tIInjectorProvider injectorProvider = getOrCreateInjectorProvider(context);\n-\t\tif (injectorProvider instanceof IRegistryConfigurator) {\n-\t\t\tfinal IRegistryConfigurator registryConfigurator = (IRegistryConfigurator) injectorProvider;\n-\t\t\tregistryConfigurator.setupRegistry();\n-\t\t}\n \t\tif (injectorProvider != null) {\n+\t\t\tsetupRegistry(injectorProvider, context);\n \t\t\tInjector injector = injectorProvider.getInjector();\n \t\t\tif (injector != null) {\n-\t\t\t\tObject testInstance = context.getRequiredTestInstance();\n \t\t\t\tinjector.injectMembers(testInstance);\n-\t\t\t\ttry {\n-\t\t\t\t\tTestInstances requiredTestInstances = context.getRequiredTestInstances();\n-\t\t\t\t\tfor (Object o : requiredTestInstances.getEnclosingInstances()) {\n-\t\t\t\t\t\tinjector.injectMembers(o);\n-\t\t\t\t\t}\n-\t\t\t\t} catch (NoSuchMethodError e) {\n-\t\t\t\t\tif (!Modifier.isStatic(testInstance.getClass().getModifiers())) {\n-\t\t\t\t\t\tif (testInstance.getClass().getDeclaringClass() != null) {\n-\t\t\t\t\t\t\tthrow new ExtensionConfigurationException(\"Injection of nested classes needs Junit5 >= 5.4\", e);\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t\t// OK, getRequiredTestInstances is not there in Junit5 < 5.4\n-\t\t\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c01ae557c7eb15b687765ddaace1359500d8644e"}, "originalPosition": 91}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c01ae557c7eb15b687765ddaace1359500d8644e", "author": {"user": {"login": "szarnekow", "name": "Sebastian Zarnekow"}}, "url": "https://github.com/eclipse/xtext-core/commit/c01ae557c7eb15b687765ddaace1359500d8644e", "committedDate": "2020-09-21T10:14:40Z", "message": "Fixed regression with InjectionExtension\n\n- Feature: Allow to use RegisterExtension along with injected fields.\n- Releng: Make sure that we run the testing.tests for Junit5 on Jenkins.\n\ncloses eclipse/xtext#1851"}, "afterCommit": {"oid": "79ce19de91a44741b1a00189fca209809365812d", "author": {"user": {"login": "szarnekow", "name": "Sebastian Zarnekow"}}, "url": "https://github.com/eclipse/xtext-core/commit/79ce19de91a44741b1a00189fca209809365812d", "committedDate": "2020-09-21T11:10:18Z", "message": "Fixed regression with InjectionExtension\n\n- Feature: Allow to use RegisterExtension along with injected fields.\n- Releng: Make sure that we run the testing.tests for Junit5 on Jenkins.\n\ncloses eclipse/xtext#1851"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "79ce19de91a44741b1a00189fca209809365812d", "author": {"user": {"login": "szarnekow", "name": "Sebastian Zarnekow"}}, "url": "https://github.com/eclipse/xtext-core/commit/79ce19de91a44741b1a00189fca209809365812d", "committedDate": "2020-09-21T11:10:18Z", "message": "Fixed regression with InjectionExtension\n\n- Feature: Allow to use RegisterExtension along with injected fields.\n- Releng: Make sure that we run the testing.tests for Junit5 on Jenkins.\n\ncloses eclipse/xtext#1851"}, "afterCommit": {"oid": "78e9f1c10fbd2f5a4500f2b0ecf64fc2a165510f", "author": {"user": {"login": "szarnekow", "name": "Sebastian Zarnekow"}}, "url": "https://github.com/eclipse/xtext-core/commit/78e9f1c10fbd2f5a4500f2b0ecf64fc2a165510f", "committedDate": "2020-09-21T11:52:13Z", "message": "Fixed regression with InjectionExtension\n\n- Feature: Allow to use RegisterExtension along with injected fields.\n- Releng: Make sure that we run the testing.tests for Junit5 on Jenkins.\n\ncloses eclipse/xtext#1851"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyNTI5MTMz", "url": "https://github.com/eclipse/xtext-core/pull/1576#pullrequestreview-492529133", "createdAt": "2020-09-21T12:06:10Z", "commit": {"oid": "78e9f1c10fbd2f5a4500f2b0ecf64fc2a165510f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "78e9f1c10fbd2f5a4500f2b0ecf64fc2a165510f", "author": {"user": {"login": "szarnekow", "name": "Sebastian Zarnekow"}}, "url": "https://github.com/eclipse/xtext-core/commit/78e9f1c10fbd2f5a4500f2b0ecf64fc2a165510f", "committedDate": "2020-09-21T11:52:13Z", "message": "Fixed regression with InjectionExtension\n\n- Feature: Allow to use RegisterExtension along with injected fields.\n- Releng: Make sure that we run the testing.tests for Junit5 on Jenkins.\n\ncloses eclipse/xtext#1851"}, "afterCommit": {"oid": "b7cb788f1dffc8cf692927a3f0e4eaff36b8dba7", "author": {"user": {"login": "szarnekow", "name": "Sebastian Zarnekow"}}, "url": "https://github.com/eclipse/xtext-core/commit/b7cb788f1dffc8cf692927a3f0e4eaff36b8dba7", "committedDate": "2020-09-21T12:17:21Z", "message": "Fixed regression with InjectionExtension\n\n- Feature: Allow to use RegisterExtension along with injected fields.\n- Releng: Make sure that we run the testing.tests for Junit5 on Jenkins.\n\ncloses eclipse/xtext#1851"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e3558216dd9f5fe60b37814bd61de10dfbce92d4", "author": {"user": {"login": "szarnekow", "name": "Sebastian Zarnekow"}}, "url": "https://github.com/eclipse/xtext-core/commit/e3558216dd9f5fe60b37814bd61de10dfbce92d4", "committedDate": "2020-09-21T12:45:56Z", "message": "Run build with debug"}, "afterCommit": {"oid": "b7cb788f1dffc8cf692927a3f0e4eaff36b8dba7", "author": {"user": {"login": "szarnekow", "name": "Sebastian Zarnekow"}}, "url": "https://github.com/eclipse/xtext-core/commit/b7cb788f1dffc8cf692927a3f0e4eaff36b8dba7", "committedDate": "2020-09-21T12:17:21Z", "message": "Fixed regression with InjectionExtension\n\n- Feature: Allow to use RegisterExtension along with injected fields.\n- Releng: Make sure that we run the testing.tests for Junit5 on Jenkins.\n\ncloses eclipse/xtext#1851"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b7cb788f1dffc8cf692927a3f0e4eaff36b8dba7", "author": {"user": {"login": "szarnekow", "name": "Sebastian Zarnekow"}}, "url": "https://github.com/eclipse/xtext-core/commit/b7cb788f1dffc8cf692927a3f0e4eaff36b8dba7", "committedDate": "2020-09-21T12:17:21Z", "message": "Fixed regression with InjectionExtension\n\n- Feature: Allow to use RegisterExtension along with injected fields.\n- Releng: Make sure that we run the testing.tests for Junit5 on Jenkins.\n\ncloses eclipse/xtext#1851"}, "afterCommit": {"oid": "379b2d0422cdd69154e010ed87eb7a8ab593ceaf", "author": {"user": {"login": "szarnekow", "name": "Sebastian Zarnekow"}}, "url": "https://github.com/eclipse/xtext-core/commit/379b2d0422cdd69154e010ed87eb7a8ab593ceaf", "committedDate": "2020-09-21T13:01:02Z", "message": "Fixed regression with InjectionExtension\n\n- Feature: Allow to use RegisterExtension along with injected fields.\n- Releng: Make sure that we run the testing.tests for Junit5 on Jenkins.\n\ncloses eclipse/xtext#1851"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyNjcxNzg2", "url": "https://github.com/eclipse/xtext-core/pull/1576#pullrequestreview-492671786", "createdAt": "2020-09-21T14:38:14Z", "commit": {"oid": "379b2d0422cdd69154e010ed87eb7a8ab593ceaf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNDozODoxNFrOHVTZ2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNDozODoxNFrOHVTZ2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjEwMDA1OA==", "bodyText": "Not needed. I'll remove that since it's only required for tests and not for consumers of this bundle.", "url": "https://github.com/eclipse/xtext-core/pull/1576#discussion_r492100058", "createdAt": "2020-09-21T14:38:14Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.testing/META-INF/MANIFEST.MF", "diffHunk": "@@ -27,7 +27,9 @@ Require-Bundle: org.eclipse.xtext;visibility:=reexport,\n  org.eclipse.xtend.lib\n Import-Package: org.apache.log4j;version=\"1.2.15\",\n  org.apache.log4j.spi;version=\"1.2.15\",\n- org.junit.jupiter.api.extension;version=\"[5.0.0,6.0.0)\";resolution:=optional\n+ org.junit.jupiter.api.extension;version=\"[5.0.0,6.0.0)\";resolution:=optional,\n+ org.junit.platform.runner;version=\"[1.0.0,2.0.0)\";resolution:=optional,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "379b2d0422cdd69154e010ed87eb7a8ab593ceaf"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e02e19a709f82677f1b7731a8cef635c326d5853", "author": {"user": {"login": "szarnekow", "name": "Sebastian Zarnekow"}}, "url": "https://github.com/eclipse/xtext-core/commit/e02e19a709f82677f1b7731a8cef635c326d5853", "committedDate": "2020-09-21T14:51:39Z", "message": "Fixed regression with InjectionExtension\n\n- Feature: Allow to use RegisterExtension along with injected fields.\n- Releng: Make sure that we run the testing.tests for Junit5 on Jenkins.\n\ncloses eclipse/xtext#1851"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "379b2d0422cdd69154e010ed87eb7a8ab593ceaf", "author": {"user": {"login": "szarnekow", "name": "Sebastian Zarnekow"}}, "url": "https://github.com/eclipse/xtext-core/commit/379b2d0422cdd69154e010ed87eb7a8ab593ceaf", "committedDate": "2020-09-21T13:01:02Z", "message": "Fixed regression with InjectionExtension\n\n- Feature: Allow to use RegisterExtension along with injected fields.\n- Releng: Make sure that we run the testing.tests for Junit5 on Jenkins.\n\ncloses eclipse/xtext#1851"}, "afterCommit": {"oid": "e02e19a709f82677f1b7731a8cef635c326d5853", "author": {"user": {"login": "szarnekow", "name": "Sebastian Zarnekow"}}, "url": "https://github.com/eclipse/xtext-core/commit/e02e19a709f82677f1b7731a8cef635c326d5853", "committedDate": "2020-09-21T14:51:39Z", "message": "Fixed regression with InjectionExtension\n\n- Feature: Allow to use RegisterExtension along with injected fields.\n- Releng: Make sure that we run the testing.tests for Junit5 on Jenkins.\n\ncloses eclipse/xtext#1851"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4649, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}