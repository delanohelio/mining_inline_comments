{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2Mjc0NjEx", "number": 1490, "title": "[lsp] properly rename quoted identifiers", "bodyText": "Fixes #1488", "createdAt": "2020-05-11T18:39:03Z", "url": "https://github.com/eclipse/xtext-core/pull/1490", "merged": true, "mergeCommit": {"oid": "70485e16a4e59c6b57241bbd4cbd6b2aa529205a"}, "closed": true, "closedAt": "2020-05-13T11:50:32Z", "author": {"login": "JanKoehnlein"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgUHnsgH2gAyNDE2Mjc0NjExOmFmZTI4Nzg1MDZlYTVlOGVjMjM2NzQwMWFiODQzMTMwMTIwYmYxYzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgfVm3gH2gAyNDE2Mjc0NjExOjk1ODQ5Yzg5YzQxYTkyODAzYWNmMTEyOWU0OTM4NTU2ZGJkOTJkMmQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "afe2878506ea5e8ec2367401ab843130120bf1c6", "author": {"user": {"login": "JanKoehnlein", "name": "Jan Koehnlein"}}, "url": "https://github.com/eclipse/xtext-core/commit/afe2878506ea5e8ec2367401ab843130120bf1c6", "committedDate": "2020-05-11T18:38:05Z", "message": "[lsp] properly rename quoted identifiers\n\nFixes #1488"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NDM5ODU4", "url": "https://github.com/eclipse/xtext-core/pull/1490#pullrequestreview-409439858", "createdAt": "2020-05-11T18:50:35Z", "commit": {"oid": "afe2878506ea5e8ec2367401ab843130120bf1c6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxODo1MDozNVrOGTo-wQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxODo1MDozNVrOGTo-wQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI0NzU1Mw==", "bodyText": "shouldt we consult linkingHelper.getRuleNameFrom(updatable.getCrossReference()) e.g. as in referenceupdater.getQualifiedName", "url": "https://github.com/eclipse/xtext-core/pull/1490#discussion_r423247553", "createdAt": "2020-05-11T18:50:35Z", "author": {"login": "cdietrich"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/rename/RenameService2.xtend", "diffHunk": "@@ -219,6 +222,14 @@ class RenameService2 implements IRenameService2 {\n \t\treturn null\n \t}\n \n+\tprotected def String getConvertedValue(EObject grammarElement, ILeafNode leaf) {\n+\t\tswitch (grammarElement) {\n+\t\t\tRuleCall: valueConverterService.toValue(leaf.text, grammarElement.rule.name, leaf).toString()\n+\t\t\tCrossReference: getConvertedValue(grammarElement.terminal, leaf)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "afe2878506ea5e8ec2367401ab843130120bf1c6"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NzQxMjIz", "url": "https://github.com/eclipse/xtext-core/pull/1490#pullrequestreview-409741223", "createdAt": "2020-05-12T06:44:20Z", "commit": {"oid": "afe2878506ea5e8ec2367401ab843130120bf1c6"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNjo0NDoyMFrOGT4N7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNjo1MDo1MVrOGT4ZPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQ5NzE5OA==", "bodyText": "Probably beyond this small bugfix here, but the rename infrastructure appears to be based on the assumption that IDs are comprised of leaf nodes and ignores the fact that MyId: ID | 'someKeyword'; or VersionedId: ID '-''(' INT ')'; are valid identifiers, too.", "url": "https://github.com/eclipse/xtext-core/pull/1490#discussion_r423497198", "createdAt": "2020-05-12T06:44:20Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/rename/RenameService2.xtend", "diffHunk": "@@ -197,11 +200,11 @@ class RenameService2 implements IRenameService2 {\n \t\t\t\t\tif (element !== null && !element.eIsProxy) {\n \t\t\t\t\t\tval leaf = NodeModelUtils.findLeafNodeAtOffset(rootNode, candidateOffset)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "afe2878506ea5e8ec2367401ab843130120bf1c6"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQ5Nzc0NQ==", "bodyText": "Given that this is already quite a bit of complexity in the logic, please change the variable name to better reflect what it is now.", "url": "https://github.com/eclipse/xtext-core/pull/1490#discussion_r423497745", "createdAt": "2020-05-12T06:45:33Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/rename/RenameService2.xtend", "diffHunk": "@@ -197,11 +200,11 @@ class RenameService2 implements IRenameService2 {\n \t\t\t\t\tif (element !== null && !element.eIsProxy) {\n \t\t\t\t\t\tval leaf = NodeModelUtils.findLeafNodeAtOffset(rootNode, candidateOffset)\n \t\t\t\t\t\tif (leaf !== null && leaf.isIdentifier) {\n-\t\t\t\t\t\t\tval leafText = NodeModelUtils.getTokenText(leaf)\n+\t\t\t\t\t\t\tval leafText = getConvertedValue(leaf.grammarElement, leaf)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "afe2878506ea5e8ec2367401ab843130120bf1c6"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQ5OTU3NQ==", "bodyText": "toValue() on a leaf node could throw a value converter exception if the leaf node was used in a data type rule e.g.\nIntAsID: INT; with 999999999999999999.\nThe value converter exception is not caught / handled in doPrepareRename", "url": "https://github.com/eclipse/xtext-core/pull/1490#discussion_r423499575", "createdAt": "2020-05-12T06:49:42Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/rename/RenameService2.xtend", "diffHunk": "@@ -219,6 +222,14 @@ class RenameService2 implements IRenameService2 {\n \t\treturn null\n \t}\n \n+\tprotected def String getConvertedValue(EObject grammarElement, ILeafNode leaf) {\n+\t\tswitch (grammarElement) {\n+\t\t\tRuleCall: valueConverterService.toValue(leaf.text, grammarElement.rule.name, leaf).toString()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "afe2878506ea5e8ec2367401ab843130120bf1c6"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUwMDA5Mg==", "bodyText": "Maybe even use org.eclipse.xtext.linking.impl.LinkingHelper.getCrossRefNodeAsString(INode, boolean) and find a proper cross ref node starting at the leaf node.", "url": "https://github.com/eclipse/xtext-core/pull/1490#discussion_r423500092", "createdAt": "2020-05-12T06:50:51Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/rename/RenameService2.xtend", "diffHunk": "@@ -219,6 +222,14 @@ class RenameService2 implements IRenameService2 {\n \t\treturn null\n \t}\n \n+\tprotected def String getConvertedValue(EObject grammarElement, ILeafNode leaf) {\n+\t\tswitch (grammarElement) {\n+\t\t\tRuleCall: valueConverterService.toValue(leaf.text, grammarElement.rule.name, leaf).toString()\n+\t\t\tCrossReference: getConvertedValue(grammarElement.terminal, leaf)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI0NzU1Mw=="}, "originalCommit": {"oid": "afe2878506ea5e8ec2367401ab843130120bf1c6"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95849c89c41a92803acf1129e4938556dbd92d2d", "author": {"user": {"login": "JanKoehnlein", "name": "Jan Koehnlein"}}, "url": "https://github.com/eclipse/xtext-core/commit/95849c89c41a92803acf1129e4938556dbd92d2d", "committedDate": "2020-05-12T07:42:19Z", "message": "[rename] applied feedback"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4797, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}