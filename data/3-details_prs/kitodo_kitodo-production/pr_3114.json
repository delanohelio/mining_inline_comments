{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4NzM1ODMw", "number": 3114, "title": "replace FLocat on export", "bodyText": "", "createdAt": "2020-01-29T19:51:13Z", "url": "https://github.com/kitodo/kitodo-production/pull/3114", "merged": true, "mergeCommit": {"oid": "1b77d0284536cf1fb001b34a591a81331e79a3eb"}, "closed": true, "closedAt": "2020-01-30T10:06:02Z", "author": {"login": "Kathrin-Huber"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_LaK_AH2gAyMzY4NzM1ODMwOjZhMDNhMWRkNjU3YWQzMDkzMzkyMjlkOWY5N2Y4Y2VmYWQ2MmY0NWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_Xi-zgFqTM1MDcwMDA3OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6a03a1dd657ad309339229d9f97f8cefad62f45f", "author": {"user": {"login": "Kathrin-Huber", "name": "Kathrin Huber"}}, "url": "https://github.com/kitodo/kitodo-production/commit/6a03a1dd657ad309339229d9f97f8cefad62f45f", "committedDate": "2020-01-29T19:49:42Z", "message": "replace FLocat on export"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c59eebdd47129883a19bec6e5984587d1edb6346", "author": {"user": {"login": "Kathrin-Huber", "name": "Kathrin Huber"}}, "url": "https://github.com/kitodo/kitodo-production/commit/c59eebdd47129883a19bec6e5984587d1edb6346", "committedDate": "2020-01-29T20:25:48Z", "message": "fix checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwNTk2OTA1", "url": "https://github.com/kitodo/kitodo-production/pull/3114#pullrequestreview-350596905", "createdAt": "2020-01-30T06:03:07Z", "commit": {"oid": "c59eebdd47129883a19bec6e5984587d1edb6346"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwNjowMzowN1rOFjgNXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwNjowMzowN1rOFjgNXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjc3MjE5MQ==", "bodyText": "Why you are not using the replace method from  VariableReplacer class? This method is doing the same.", "url": "https://github.com/kitodo/kitodo-production/pull/3114#discussion_r372772191", "createdAt": "2020-01-30T06:03:07Z", "author": {"login": "henning-gerhardt"}, "path": "Kitodo/src/main/java/org/kitodo/production/services/schema/SchemaService.java", "diffHunk": "@@ -129,6 +132,29 @@ private void addVirtualFileGroupsToMetsMods(Workpiece workpiece, Process process\n         }\n     }\n \n+    private void replaceFLocatForExport(Workpiece workpiece, Process process) throws URISyntaxException {\n+        List<Folder> folders = process.getProject().getFolders();\n+        for (MediaUnit mediaUnit : workpiece.getMediaUnits()) {\n+            for (Entry<MediaVariant, URI> mediaFileForMediaVariant : mediaUnit.getMediaFiles().entrySet()) {\n+                for (Folder folder : folders) {\n+                    if (folder.getFileGroup().equals(mediaFileForMediaVariant.getKey().getUse())) {\n+                        int lastSeparator = mediaFileForMediaVariant.getValue().toString().lastIndexOf(File.separator);\n+                        String lastSegment = mediaFileForMediaVariant.getValue().toString()\n+                                .substring(lastSeparator + 1);\n+                        mediaFileForMediaVariant\n+                                .setValue(new URI(replacePlaceholder(folder.getUrlStructure() + lastSegment, process)));\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    private String replacePlaceholder(String uri, Process process) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c59eebdd47129883a19bec6e5984587d1edb6346"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b8eb9ed8381a52d527f3fa628992bf8333ec6d5", "author": {"user": {"login": "Kathrin-Huber", "name": "Kathrin Huber"}}, "url": "https://github.com/kitodo/kitodo-production/commit/6b8eb9ed8381a52d527f3fa628992bf8333ec6d5", "committedDate": "2020-01-30T08:38:08Z", "message": "use variable replacer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwNzAwMDc4", "url": "https://github.com/kitodo/kitodo-production/pull/3114#pullrequestreview-350700078", "createdAt": "2020-01-30T09:58:11Z", "commit": {"oid": "6b8eb9ed8381a52d527f3fa628992bf8333ec6d5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2736, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}