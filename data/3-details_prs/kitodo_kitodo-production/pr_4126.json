{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5NzUyODEx", "number": 4126, "title": "Realize file upload", "bodyText": "This enables the user to create a process through uploading a xml file.\nHierarchical Import is not supported yet and will be implemented in a separate PR.", "createdAt": "2020-12-14T19:37:36Z", "url": "https://github.com/kitodo/kitodo-production/pull/4126", "merged": true, "mergeCommit": {"oid": "b7e9c99a8c7e2e01973164233c6da5d6e51eaca9"}, "closed": true, "closedAt": "2021-01-13T10:06:05Z", "author": {"login": "Kathrin-Huber"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmLQIcABqjQxMTEwNjMwMTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdvY3KbgH2gAyNTM5NzUyODExOjQzMmI0NTFhODQ3NDYzNmEwNWFmMzU0ODdkOTY2ZWFkZmVkNzYzOGE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2234b56761255bc943d2a138861c305b65082b08", "author": {"user": {"login": "Kathrin-Huber", "name": "Kathrin Huber"}}, "url": "https://github.com/kitodo/kitodo-production/commit/2234b56761255bc943d2a138861c305b65082b08", "committedDate": "2020-12-14T19:17:20Z", "message": "cleanup"}, "afterCommit": {"oid": "c9b501173a2b216a197bb11b9a3ab199137a5bad", "author": {"user": {"login": "Kathrin-Huber", "name": "Kathrin Huber"}}, "url": "https://github.com/kitodo/kitodo-production/commit/c9b501173a2b216a197bb11b9a3ab199137a5bad", "committedDate": "2020-12-14T19:52:32Z", "message": "cleanup"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c9b501173a2b216a197bb11b9a3ab199137a5bad", "author": {"user": {"login": "Kathrin-Huber", "name": "Kathrin Huber"}}, "url": "https://github.com/kitodo/kitodo-production/commit/c9b501173a2b216a197bb11b9a3ab199137a5bad", "committedDate": "2020-12-14T19:52:32Z", "message": "cleanup"}, "afterCommit": {"oid": "f79d3f032afda60857dc121448aee9536be17446", "author": {"user": {"login": "Kathrin-Huber", "name": "Kathrin Huber"}}, "url": "https://github.com/kitodo/kitodo-production/commit/f79d3f032afda60857dc121448aee9536be17446", "committedDate": "2020-12-15T08:19:35Z", "message": "cleanup"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f79d3f032afda60857dc121448aee9536be17446", "author": {"user": {"login": "Kathrin-Huber", "name": "Kathrin Huber"}}, "url": "https://github.com/kitodo/kitodo-production/commit/f79d3f032afda60857dc121448aee9536be17446", "committedDate": "2020-12-15T08:19:35Z", "message": "cleanup"}, "afterCommit": {"oid": "b53805f99f5785c2e16fec906d6153786021b1b2", "author": {"user": {"login": "Kathrin-Huber", "name": "Kathrin Huber"}}, "url": "https://github.com/kitodo/kitodo-production/commit/b53805f99f5785c2e16fec906d6153786021b1b2", "committedDate": "2020-12-15T17:17:02Z", "message": "cleanup"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "25803837ae6b1166e61bf8e7488b75bc9f471b52", "author": {"user": {"login": "Kathrin-Huber", "name": "Kathrin Huber"}}, "url": "https://github.com/kitodo/kitodo-production/commit/25803837ae6b1166e61bf8e7488b75bc9f471b52", "committedDate": "2020-12-17T13:56:37Z", "message": "add fileUploadTag to test opac.xml"}, "afterCommit": {"oid": "3e0be59e2f64c882b8f53bfbfe71ba34256e14cd", "author": {"user": {"login": "Kathrin-Huber", "name": "Kathrin Huber"}}, "url": "https://github.com/kitodo/kitodo-production/commit/3e0be59e2f64c882b8f53bfbfe71ba34256e14cd", "committedDate": "2020-12-18T09:31:41Z", "message": "add fileUploadTag to test opac.xml"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d8d90f14a03408805b7aea45419b4a2f251ed459", "author": {"user": {"login": "Kathrin-Huber", "name": "Kathrin Huber"}}, "url": "https://github.com/kitodo/kitodo-production/commit/d8d90f14a03408805b7aea45419b4a2f251ed459", "committedDate": "2020-12-18T10:43:08Z", "message": "add javadoc"}, "afterCommit": {"oid": "44d80182254670a7c4d262bf50e1b48b086dd3d0", "author": {"user": {"login": "Kathrin-Huber", "name": "Kathrin Huber"}}, "url": "https://github.com/kitodo/kitodo-production/commit/44d80182254670a7c4d262bf50e1b48b086dd3d0", "committedDate": "2020-12-21T08:29:09Z", "message": "add javadoc"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "44d80182254670a7c4d262bf50e1b48b086dd3d0", "author": {"user": {"login": "Kathrin-Huber", "name": "Kathrin Huber"}}, "url": "https://github.com/kitodo/kitodo-production/commit/44d80182254670a7c4d262bf50e1b48b086dd3d0", "committedDate": "2020-12-21T08:29:09Z", "message": "add javadoc"}, "afterCommit": {"oid": "3261221ab9cb8b1ddd3418462d043d745b3ba882", "author": {"user": {"login": "Kathrin-Huber", "name": "Kathrin Huber"}}, "url": "https://github.com/kitodo/kitodo-production/commit/3261221ab9cb8b1ddd3418462d043d745b3ba882", "committedDate": "2021-01-05T08:20:15Z", "message": "add javadoc"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3261221ab9cb8b1ddd3418462d043d745b3ba882", "author": {"user": {"login": "Kathrin-Huber", "name": "Kathrin Huber"}}, "url": "https://github.com/kitodo/kitodo-production/commit/3261221ab9cb8b1ddd3418462d043d745b3ba882", "committedDate": "2021-01-05T08:20:15Z", "message": "add javadoc"}, "afterCommit": {"oid": "f4d3faa6b00e8253b811dfb02d1ec726c4e28812", "author": {"user": {"login": "Kathrin-Huber", "name": "Kathrin Huber"}}, "url": "https://github.com/kitodo/kitodo-production/commit/f4d3faa6b00e8253b811dfb02d1ec726c4e28812", "committedDate": "2021-01-05T08:26:38Z", "message": "add javadoc"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f4d3faa6b00e8253b811dfb02d1ec726c4e28812", "author": {"user": {"login": "Kathrin-Huber", "name": "Kathrin Huber"}}, "url": "https://github.com/kitodo/kitodo-production/commit/f4d3faa6b00e8253b811dfb02d1ec726c4e28812", "committedDate": "2021-01-05T08:26:38Z", "message": "add javadoc"}, "afterCommit": {"oid": "afb121193ab1e01e5d38f30c263cc051cc19b26a", "author": {"user": {"login": "Kathrin-Huber", "name": "Kathrin Huber"}}, "url": "https://github.com/kitodo/kitodo-production/commit/afb121193ab1e01e5d38f30c263cc051cc19b26a", "committedDate": "2021-01-07T14:27:05Z", "message": "fix merge issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25e5a5e44ed297c62b7501190b8780857cfcb70b", "author": {"user": {"login": "Kathrin-Huber", "name": "Kathrin Huber"}}, "url": "https://github.com/kitodo/kitodo-production/commit/25e5a5e44ed297c62b7501190b8780857cfcb70b", "committedDate": "2021-01-08T10:32:10Z", "message": "enable import via fileUpload for monographs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac58b917b1c751b3b481ca6f41d6d8f9509c3d89", "author": {"user": {"login": "Kathrin-Huber", "name": "Kathrin Huber"}}, "url": "https://github.com/kitodo/kitodo-production/commit/ac58b917b1c751b3b481ca6f41d6d8f9509c3d89", "committedDate": "2021-01-08T10:32:10Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f54469a2617648bbdef6cae2c841487b4beb53bd", "author": {"user": {"login": "Kathrin-Huber", "name": "Kathrin Huber"}}, "url": "https://github.com/kitodo/kitodo-production/commit/f54469a2617648bbdef6cae2c841487b4beb53bd", "committedDate": "2021-01-08T10:32:10Z", "message": "styling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8eb98218b47a93be710d6c173fb411821f668d1", "author": {"user": {"login": "Kathrin-Huber", "name": "Kathrin Huber"}}, "url": "https://github.com/kitodo/kitodo-production/commit/d8eb98218b47a93be710d6c173fb411821f668d1", "committedDate": "2021-01-08T10:32:10Z", "message": "add fileUploadTag to test opac.xml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d0592a1cdbd37ce036484ca6fb5c76381b6a4b6", "author": {"user": {"login": "Kathrin-Huber", "name": "Kathrin Huber"}}, "url": "https://github.com/kitodo/kitodo-production/commit/2d0592a1cdbd37ce036484ca6fb5c76381b6a4b6", "committedDate": "2021-01-08T10:32:10Z", "message": "add javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "846fe2b9ed0e9a21c07265ba8a4e91ee76aca2e9", "author": {"user": {"login": "Kathrin-Huber", "name": "Kathrin Huber"}}, "url": "https://github.com/kitodo/kitodo-production/commit/846fe2b9ed0e9a21c07265ba8a4e91ee76aca2e9", "committedDate": "2021-01-08T10:32:10Z", "message": "fix merge issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d8761c899de8c69568b2dfbebb790a796e6794b", "author": {"user": {"login": "Kathrin-Huber", "name": "Kathrin Huber"}}, "url": "https://github.com/kitodo/kitodo-production/commit/3d8761c899de8c69568b2dfbebb790a796e6794b", "committedDate": "2021-01-08T10:32:10Z", "message": "fixCodacy"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "afb121193ab1e01e5d38f30c263cc051cc19b26a", "author": {"user": {"login": "Kathrin-Huber", "name": "Kathrin Huber"}}, "url": "https://github.com/kitodo/kitodo-production/commit/afb121193ab1e01e5d38f30c263cc051cc19b26a", "committedDate": "2021-01-07T14:27:05Z", "message": "fix merge issues"}, "afterCommit": {"oid": "3d8761c899de8c69568b2dfbebb790a796e6794b", "author": {"user": {"login": "Kathrin-Huber", "name": "Kathrin Huber"}}, "url": "https://github.com/kitodo/kitodo-production/commit/3d8761c899de8c69568b2dfbebb790a796e6794b", "committedDate": "2021-01-08T10:32:10Z", "message": "fixCodacy"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY0MTAyMjc3", "url": "https://github.com/kitodo/kitodo-production/pull/4126#pullrequestreview-564102277", "createdAt": "2021-01-08T09:07:46Z", "commit": {"oid": "afb121193ab1e01e5d38f30c263cc051cc19b26a"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOFQwOTowNzo0NlrOIQKr6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOFQxMDozODo1NVrOIQNdxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzgyMzIwOA==", "bodyText": "Please add translations for the message key chooseFile to the resource files.", "url": "https://github.com/kitodo/kitodo-production/pull/4126#discussion_r553823208", "createdAt": "2021-01-08T09:07:46Z", "author": {"login": "solth"}, "path": "Kitodo/src/main/webapp/WEB-INF/templates/includes/processFromTemplate/dialogs/fileUpload.xhtml", "diffHunk": "@@ -0,0 +1,75 @@\n+<!--\n+ *\n+ * (c) Kitodo. Key to digital objects e. V. <contact@kitodo.org>\n+ *\n+ * This file is part of the Kitodo project.\n+ *\n+ * It is licensed under GNU General Public License version 3 or later.\n+ *\n+ * For the full copyright and license information, please read the\n+ * GPL3-License.txt file that was distributed with this source code.\n+ *\n+-->\n+\n+<ui:composition\n+        xmlns=\"http://www.w3.org/1999/xhtml\"\n+        xmlns:f=\"http://xmlns.jcp.org/jsf/core\"\n+        xmlns:h=\"http://xmlns.jcp.org/jsf/html\"\n+        xmlns:ui=\"http://xmlns.jcp.org/jsf/facelets\"\n+        xmlns:p=\"http://primefaces.org/ui\">\n+\n+    <p:dialog widgetVar=\"fileUploadDialog\"\n+              id=\"fileUpload\"\n+              width=\"640\"\n+              modal=\"true\"\n+              resizable=\"false\">\n+        <h3>#{msgs['newProcess.fileUpload.heading']}</h3>\n+        <h:form id=\"fileUploadForm\">\n+            <p:panelGrid layout=\"grid\" columns=\"2\" cellpadding=\"10\">\n+                <p:row>\n+                    <div>\n+                        <p:outputLabel for=\"catalogueSelectMenu\"\n+                                       value=\"#{msgs['newProcess.catalogueSearch.catalogue']}\"/>\n+                        <p:selectOneMenu id=\"catalogueSelectMenu\"\n+                                         autoWidth=\"false\"\n+                                         required=\"#{not empty param['catalogSearchForm:performCatalogSearch']}\"\n+                                         immediate=\"true\"\n+                                         value=\"#{CreateProcessForm.fileUploadDialog.selectedCatalog}\">\n+                            <f:selectItem itemValue=\"#{null}\" itemLabel=\"-- #{msgs.selectCatalog} --\" noSelectionOption=\"true\"/>\n+                            <f:selectItems value=\"#{CreateProcessForm.fileUploadDialog.catalogs}\" var=\"step\" itemLabel=\"#{step}\"\n+                                           itemValue=\"#{step}\"/>\n+                            <p:ajax update=\"fileUploadForm\"/>\n+                        </p:selectOneMenu>\n+                    </div>\n+                </p:row>\n+            </p:panelGrid>\n+            <p:panelGrid>\n+                <p:row>\n+                    <div>\n+                        <p:fileUpload value=\"#{CreateProcessForm.fileUploadDialog.file}\"\n+                                      rendered=\"#{CreateProcessForm.fileUploadDialog.selectedCatalog ne null}\"\n+                                      fileUploadListener=\"#{CreateProcessForm.fileUploadDialog.handleFileUpload}\"\n+                                      allowTypes=\"/(\\.|\\/)(xml)$/\"\n+                                      skinSimple=\"true\"\n+                                      oncomplete=\"PF('fileUploadDialog').hide();\"\n+                                      label=\"#{msgs.chooseFile}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "afb121193ab1e01e5d38f30c263cc051cc19b26a"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzgzNDkxNw==", "bodyText": "I would suggest to make the configuration parameter optional and interpret a missing parameter as false.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return getCatalog(catalogName).getBoolean(\"fileUpload\");\n          \n          \n            \n                    return getCatalog(catalogName).containsKey(\"fileUpload\") \n          \n          \n            \n                            && getCatalog(catalogName).getBoolean(\"fileUpload\");", "url": "https://github.com/kitodo/kitodo-production/pull/4126#discussion_r553834917", "createdAt": "2021-01-08T09:31:28Z", "author": {"login": "solth"}, "path": "Kitodo-API/src/main/java/org/kitodo/config/OPACConfig.java", "diffHunk": "@@ -103,6 +103,15 @@ public static HierarchicalConfiguration getUrlParameters(String catalogName) {\n         return getCatalog(catalogName).configurationAt(\"urlParameters\");\n     }\n \n+    /**\n+     * Retrieve the \"fileUpload\" configuration of the catalog identified by its title.\n+     * @param catalogName String identifying the catalog by its title\n+     * @return boolean if catalog is configured to use FileUpload\n+     */\n+    public static boolean getFileUploadConfig(String catalogName) {\n+        return getCatalog(catalogName).getBoolean(\"fileUpload\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "afb121193ab1e01e5d38f30c263cc051cc19b26a"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mzg0NzU1OA==", "bodyText": "Please add this key to messages_en.properties, too.", "url": "https://github.com/kitodo/kitodo-production/pull/4126#discussion_r553847558", "createdAt": "2021-01-08T09:55:48Z", "author": {"login": "solth"}, "path": "Kitodo/src/main/resources/messages/messages_de.properties", "diffHunk": "@@ -665,6 +665,7 @@ newProcess.catalogueSearch.manyChildrenWarning=Es wurden {0} Kindvorg\\u00E4nge g\n newProcess.catalogueSearch.parentIDMetadataMissing=Es wurde kein Metadatum zum Speichern von IDs \\u00fcbergeordneter Vorg\\u00E4nge (\"higherlevelIdentifier\") im Regelsatz gefunden. Importtiefe zur\\u00fcckgesetzt auf 1!\n newProcess.catalogueSearch.parentIDParameterMissing=Es wurde kein Parameter zum Suchen von Kindelementen eines bestimmten Elterndokuments f\\u00fcr den ausgew\\u00E4hlten Katalog in der kitodo_opac.xml konfiguriert (fehlender Konfigurationsparameter \"parentElement\")!\n newProcess.catalogueSearch.savingSecondaryProcesses=Speichern von untergeordneten Einheiten\n+newProcess.fileUpload.heading=Dateiupload", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "afb121193ab1e01e5d38f30c263cc051cc19b26a"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mzg2MjQ2NA==", "bodyText": "I think since you handle the uploaded file directly in the handleFileUpload listener, this variable here is never used and therefor can be removed.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private UploadedFile file;", "url": "https://github.com/kitodo/kitodo-production/pull/4126#discussion_r553862464", "createdAt": "2021-01-08T10:26:17Z", "author": {"login": "solth"}, "path": "Kitodo/src/main/java/org/kitodo/production/forms/createprocess/FileUploadDialog.java", "diffHunk": "@@ -0,0 +1,138 @@\n+/*\n+ * (c) Kitodo. Key to digital objects e. V. <contact@kitodo.org>\n+ *\n+ * This file is part of the Kitodo project.\n+ *\n+ * It is licensed under GNU General Public License version 3 or later.\n+ *\n+ * For the full copyright and license information, please read the\n+ * GPL3-License.txt file that was distributed with this source code.\n+ */\n+\n+package org.kitodo.production.forms.createprocess;\n+\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.nio.charset.Charset;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.LinkedList;\n+import java.util.List;\n+\n+import javax.xml.parsers.ParserConfigurationException;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+import org.kitodo.api.MdSec;\n+import org.kitodo.api.Metadata;\n+import org.kitodo.api.schemaconverter.DataRecord;\n+import org.kitodo.api.schemaconverter.FileFormat;\n+import org.kitodo.api.schemaconverter.MetadataFormat;\n+import org.kitodo.config.OPACConfig;\n+import org.kitodo.exceptions.ConfigException;\n+import org.kitodo.exceptions.ParameterNotFoundException;\n+import org.kitodo.exceptions.ProcessGenerationException;\n+import org.kitodo.exceptions.UnsupportedFormatException;\n+import org.kitodo.production.helper.Helper;\n+import org.kitodo.production.helper.TempProcess;\n+import org.kitodo.production.services.ServiceManager;\n+import org.kitodo.production.services.data.ImportService;\n+import org.primefaces.event.FileUploadEvent;\n+import org.primefaces.model.UploadedFile;\n+import org.w3c.dom.Document;\n+import org.xml.sax.SAXException;\n+\n+public class FileUploadDialog extends MetadataImportDialog {\n+\n+    private UploadedFile file;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "afb121193ab1e01e5d38f30c263cc051cc19b26a"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mzg2NzYxNA==", "bodyText": "Since the file variable isn't used, this setter is also not required.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n                /**\n          \n          \n            \n                 * Set the file.\n          \n          \n            \n                 * @param file the file to upload\n          \n          \n            \n                 */\n          \n          \n            \n                public void setFile(UploadedFile file) {\n          \n          \n            \n                    this.file = file;\n          \n          \n            \n                }", "url": "https://github.com/kitodo/kitodo-production/pull/4126#discussion_r553867614", "createdAt": "2021-01-08T10:36:28Z", "author": {"login": "solth"}, "path": "Kitodo/src/main/java/org/kitodo/production/forms/createprocess/FileUploadDialog.java", "diffHunk": "@@ -0,0 +1,139 @@\n+/*\n+ * (c) Kitodo. Key to digital objects e. V. <contact@kitodo.org>\n+ *\n+ * This file is part of the Kitodo project.\n+ *\n+ * It is licensed under GNU General Public License version 3 or later.\n+ *\n+ * For the full copyright and license information, please read the\n+ * GPL3-License.txt file that was distributed with this source code.\n+ */\n+\n+package org.kitodo.production.forms.createprocess;\n+\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.nio.charset.Charset;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.LinkedList;\n+import java.util.List;\n+\n+import javax.xml.parsers.ParserConfigurationException;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+import org.kitodo.api.MdSec;\n+import org.kitodo.api.Metadata;\n+import org.kitodo.api.schemaconverter.DataRecord;\n+import org.kitodo.api.schemaconverter.FileFormat;\n+import org.kitodo.api.schemaconverter.MetadataFormat;\n+import org.kitodo.config.OPACConfig;\n+import org.kitodo.exceptions.ConfigException;\n+import org.kitodo.exceptions.ParameterNotFoundException;\n+import org.kitodo.exceptions.ProcessGenerationException;\n+import org.kitodo.exceptions.UnsupportedFormatException;\n+import org.kitodo.production.helper.Helper;\n+import org.kitodo.production.helper.TempProcess;\n+import org.kitodo.production.services.ServiceManager;\n+import org.kitodo.production.services.data.ImportService;\n+import org.primefaces.event.FileUploadEvent;\n+import org.primefaces.model.UploadedFile;\n+import org.w3c.dom.Document;\n+import org.xml.sax.SAXException;\n+\n+public class FileUploadDialog extends MetadataImportDialog {\n+\n+    private UploadedFile file;\n+    private String selectedCatalog;\n+    private static final Logger logger = LogManager.getLogger(FileUploadDialog.class);\n+\n+    public FileUploadDialog(CreateProcessForm createProcessForm) {\n+        super(createProcessForm);\n+    }\n+\n+    /**\n+     * import from csv file.\n+     *\n+     * @param event\n+     *            the file upload event\n+     */\n+    public void handleFileUpload(FileUploadEvent event) {\n+        UploadedFile uploadedFile = event.getFile();\n+        ImportService importService = ServiceManager.getImportService();\n+        try {\n+            Document internalDocument = importService.convertDataRecordToInternal(\n+                createRecordFromXMLElement(IOUtils.toString(uploadedFile.getInputstream(), Charset.defaultCharset())),\n+                selectedCatalog, false);\n+            TempProcess tempProcess = importService.createTempProcessFromDocument(internalDocument,\n+                createProcessForm.getTemplate().getId(), createProcessForm.getProject().getId());\n+\n+            LinkedList<TempProcess> processes = new LinkedList<>();\n+            processes.add(tempProcess);\n+            this.createProcessForm.setProcesses(processes);\n+            if (!processes.isEmpty() && processes.getFirst().getMetadataNodes().getLength() > 0) {\n+                TempProcess firstProcess = processes.getFirst();\n+                this.createProcessForm.getProcessDataTab()\n+                        .setDocType(firstProcess.getWorkpiece().getRootElement().getType());\n+                Collection<Metadata> metadata = ImportService.importMetadata(firstProcess.getMetadataNodes(),\n+                    MdSec.DMD_SEC);\n+                createProcessForm.getProcessMetadataTab().getProcessDetails().setMetadata(metadata);\n+            }\n+            showRecord();\n+        } catch (IOException | ProcessGenerationException | URISyntaxException | ParserConfigurationException\n+                | UnsupportedFormatException | SAXException | ConfigException e) {\n+            Helper.setErrorMessage(e.getLocalizedMessage(), logger, e);\n+        }\n+    }\n+\n+    private DataRecord createRecordFromXMLElement(String xmlContent) {\n+        DataRecord record = new DataRecord();\n+        try {\n+            record.setMetadataFormat(\n+                MetadataFormat.getMetadataFormat(OPACConfig.getConfigValue(selectedCatalog, \"metadataFormat\")));\n+            record.setFileFormat(FileFormat.getFileFormat(OPACConfig.getConfigValue(selectedCatalog, \"returnFormat\")));\n+        } catch (ParameterNotFoundException e) {\n+            Helper.setErrorMessage(e.getLocalizedMessage(), logger, e);\n+        }\n+        record.setOriginalData(xmlContent);\n+        return record;\n+    }\n+\n+    @Override\n+    public List<String> getCatalogs() {\n+        List<String> catalogs = super.getCatalogs();\n+        List<String> catalogsWithFileUpload = new ArrayList<>();\n+        for (String catalog : catalogs) {\n+            boolean isFileUpload = OPACConfig.getFileUploadConfig(catalog);\n+            if (isFileUpload) {\n+                catalogsWithFileUpload.add(catalog);\n+            }\n+        }\n+        return catalogsWithFileUpload;\n+    }\n+\n+    /**\n+     * Set the file.\n+     * @param file the file to upload\n+     */\n+    public void setFile(UploadedFile file) {\n+        this.file = file;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d8761c899de8c69568b2dfbebb790a796e6794b"}, "originalPosition": 122}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mzg2ODc0Mw==", "bodyText": "Because you already handle the file in the fileUploadListener and do not use the file stored to this value attribute in the Java class, it should work without the value attribute entirely, I think.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    <p:fileUpload value=\"#{CreateProcessForm.fileUploadDialog.file}\"\n          \n          \n            \n                                                  rendered=\"#{CreateProcessForm.fileUploadDialog.selectedCatalog ne null}\"\n          \n          \n            \n                                    <p:fileUpload rendered=\"#{CreateProcessForm.fileUploadDialog.selectedCatalog ne null}\"", "url": "https://github.com/kitodo/kitodo-production/pull/4126#discussion_r553868743", "createdAt": "2021-01-08T10:38:55Z", "author": {"login": "solth"}, "path": "Kitodo/src/main/webapp/WEB-INF/templates/includes/processFromTemplate/dialogs/fileUpload.xhtml", "diffHunk": "@@ -0,0 +1,75 @@\n+<!--\n+ *\n+ * (c) Kitodo. Key to digital objects e. V. <contact@kitodo.org>\n+ *\n+ * This file is part of the Kitodo project.\n+ *\n+ * It is licensed under GNU General Public License version 3 or later.\n+ *\n+ * For the full copyright and license information, please read the\n+ * GPL3-License.txt file that was distributed with this source code.\n+ *\n+-->\n+\n+<ui:composition\n+        xmlns=\"http://www.w3.org/1999/xhtml\"\n+        xmlns:f=\"http://xmlns.jcp.org/jsf/core\"\n+        xmlns:h=\"http://xmlns.jcp.org/jsf/html\"\n+        xmlns:ui=\"http://xmlns.jcp.org/jsf/facelets\"\n+        xmlns:p=\"http://primefaces.org/ui\">\n+\n+    <p:dialog widgetVar=\"fileUploadDialog\"\n+              id=\"fileUpload\"\n+              width=\"640\"\n+              modal=\"true\"\n+              resizable=\"false\">\n+        <h3>#{msgs['newProcess.fileUpload.heading']}</h3>\n+        <h:form id=\"fileUploadForm\">\n+            <p:panelGrid layout=\"grid\" columns=\"2\" cellpadding=\"10\">\n+                <p:row>\n+                    <div>\n+                        <p:outputLabel for=\"catalogueSelectMenu\"\n+                                       value=\"#{msgs['newProcess.catalogueSearch.catalogue']}\"/>\n+                        <p:selectOneMenu id=\"catalogueSelectMenu\"\n+                                         autoWidth=\"false\"\n+                                         required=\"#{not empty param['catalogSearchForm:performCatalogSearch']}\"\n+                                         immediate=\"true\"\n+                                         value=\"#{CreateProcessForm.fileUploadDialog.selectedCatalog}\">\n+                            <f:selectItem itemValue=\"#{null}\" itemLabel=\"-- #{msgs.selectCatalog} --\" noSelectionOption=\"true\"/>\n+                            <f:selectItems value=\"#{CreateProcessForm.fileUploadDialog.catalogs}\" var=\"step\" itemLabel=\"#{step}\"\n+                                           itemValue=\"#{step}\"/>\n+                            <p:ajax update=\"fileUploadForm\"/>\n+                        </p:selectOneMenu>\n+                    </div>\n+                </p:row>\n+            </p:panelGrid>\n+            <p:panelGrid>\n+                <p:row>\n+                    <div>\n+                        <p:fileUpload value=\"#{CreateProcessForm.fileUploadDialog.file}\"\n+                                      rendered=\"#{CreateProcessForm.fileUploadDialog.selectedCatalog ne null}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d8761c899de8c69568b2dfbebb790a796e6794b"}, "originalPosition": 50}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2aec886a8487bef85d9bbd21e9949c171058e149", "author": {"user": {"login": "Kathrin-Huber", "name": "Kathrin Huber"}}, "url": "https://github.com/kitodo/kitodo-production/commit/2aec886a8487bef85d9bbd21e9949c171058e149", "committedDate": "2021-01-08T13:20:28Z", "message": "add review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY1MTgzNTE4", "url": "https://github.com/kitodo/kitodo-production/pull/4126#pullrequestreview-565183518", "createdAt": "2021-01-11T09:32:03Z", "commit": {"oid": "2aec886a8487bef85d9bbd21e9949c171058e149"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQwOTozMjowM1rOIRNagQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQwOTozMjoyNlrOIRNbNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDkxNjQ4MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                                  uploadIcon=\"fa fa-download fa-lg\"\n          \n          \n            \n                                                  uploadIcon=\"fa fa-upload fa-lg\"", "url": "https://github.com/kitodo/kitodo-production/pull/4126#discussion_r554916481", "createdAt": "2021-01-11T09:32:03Z", "author": {"login": "solth"}, "path": "Kitodo/src/main/webapp/WEB-INF/templates/includes/processFromTemplate/dialogs/fileUpload.xhtml", "diffHunk": "@@ -0,0 +1,74 @@\n+<!--\n+ *\n+ * (c) Kitodo. Key to digital objects e. V. <contact@kitodo.org>\n+ *\n+ * This file is part of the Kitodo project.\n+ *\n+ * It is licensed under GNU General Public License version 3 or later.\n+ *\n+ * For the full copyright and license information, please read the\n+ * GPL3-License.txt file that was distributed with this source code.\n+ *\n+-->\n+\n+<ui:composition\n+        xmlns=\"http://www.w3.org/1999/xhtml\"\n+        xmlns:f=\"http://xmlns.jcp.org/jsf/core\"\n+        xmlns:h=\"http://xmlns.jcp.org/jsf/html\"\n+        xmlns:ui=\"http://xmlns.jcp.org/jsf/facelets\"\n+        xmlns:p=\"http://primefaces.org/ui\">\n+\n+    <p:dialog widgetVar=\"fileUploadDialog\"\n+              id=\"fileUpload\"\n+              width=\"640\"\n+              modal=\"true\"\n+              resizable=\"false\">\n+        <h3>#{msgs['newProcess.fileUpload.heading']}</h3>\n+        <h:form id=\"fileUploadForm\">\n+            <p:panelGrid layout=\"grid\" columns=\"2\" cellpadding=\"10\">\n+                <p:row>\n+                    <div>\n+                        <p:outputLabel for=\"catalogueSelectMenu\"\n+                                       value=\"#{msgs['newProcess.catalogueSearch.catalogue']}\"/>\n+                        <p:selectOneMenu id=\"catalogueSelectMenu\"\n+                                         autoWidth=\"false\"\n+                                         required=\"#{not empty param['catalogSearchForm:performCatalogSearch']}\"\n+                                         immediate=\"true\"\n+                                         value=\"#{CreateProcessForm.fileUploadDialog.selectedCatalog}\">\n+                            <f:selectItem itemValue=\"#{null}\" itemLabel=\"-- #{msgs.selectCatalog} --\" noSelectionOption=\"true\"/>\n+                            <f:selectItems value=\"#{CreateProcessForm.fileUploadDialog.catalogs}\" var=\"step\" itemLabel=\"#{step}\"\n+                                           itemValue=\"#{step}\"/>\n+                            <p:ajax update=\"fileUploadForm\"/>\n+                        </p:selectOneMenu>\n+                    </div>\n+                </p:row>\n+            </p:panelGrid>\n+            <p:panelGrid>\n+                <p:row>\n+                    <div>\n+                        <p:fileUpload rendered=\"#{CreateProcessForm.fileUploadDialog.selectedCatalog ne null}\"\n+                                      fileUploadListener=\"#{CreateProcessForm.fileUploadDialog.handleFileUpload}\"\n+                                      allowTypes=\"/(\\.|\\/)(xml)$/\"\n+                                      skinSimple=\"true\"\n+                                      oncomplete=\"PF('fileUploadDialog').hide();\"\n+                                      label=\"#{msgs.chooseFile}\"\n+                                      uploadLabel=\"#{msgs.fileUpload}\"\n+                                      cancelLabel=\"#{msgs.cancel}\"\n+                                      chooseIcon=\"fa fa-times fa-lg\"\n+                                      uploadIcon=\"fa fa-download fa-lg\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2aec886a8487bef85d9bbd21e9949c171058e149"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDkxNjY2MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                                  chooseIcon=\"fa fa-times fa-lg\"\n          \n          \n            \n                                                  chooseIcon=\"fa fa-file-code-o fa-lg\"", "url": "https://github.com/kitodo/kitodo-production/pull/4126#discussion_r554916661", "createdAt": "2021-01-11T09:32:26Z", "author": {"login": "solth"}, "path": "Kitodo/src/main/webapp/WEB-INF/templates/includes/processFromTemplate/dialogs/fileUpload.xhtml", "diffHunk": "@@ -0,0 +1,74 @@\n+<!--\n+ *\n+ * (c) Kitodo. Key to digital objects e. V. <contact@kitodo.org>\n+ *\n+ * This file is part of the Kitodo project.\n+ *\n+ * It is licensed under GNU General Public License version 3 or later.\n+ *\n+ * For the full copyright and license information, please read the\n+ * GPL3-License.txt file that was distributed with this source code.\n+ *\n+-->\n+\n+<ui:composition\n+        xmlns=\"http://www.w3.org/1999/xhtml\"\n+        xmlns:f=\"http://xmlns.jcp.org/jsf/core\"\n+        xmlns:h=\"http://xmlns.jcp.org/jsf/html\"\n+        xmlns:ui=\"http://xmlns.jcp.org/jsf/facelets\"\n+        xmlns:p=\"http://primefaces.org/ui\">\n+\n+    <p:dialog widgetVar=\"fileUploadDialog\"\n+              id=\"fileUpload\"\n+              width=\"640\"\n+              modal=\"true\"\n+              resizable=\"false\">\n+        <h3>#{msgs['newProcess.fileUpload.heading']}</h3>\n+        <h:form id=\"fileUploadForm\">\n+            <p:panelGrid layout=\"grid\" columns=\"2\" cellpadding=\"10\">\n+                <p:row>\n+                    <div>\n+                        <p:outputLabel for=\"catalogueSelectMenu\"\n+                                       value=\"#{msgs['newProcess.catalogueSearch.catalogue']}\"/>\n+                        <p:selectOneMenu id=\"catalogueSelectMenu\"\n+                                         autoWidth=\"false\"\n+                                         required=\"#{not empty param['catalogSearchForm:performCatalogSearch']}\"\n+                                         immediate=\"true\"\n+                                         value=\"#{CreateProcessForm.fileUploadDialog.selectedCatalog}\">\n+                            <f:selectItem itemValue=\"#{null}\" itemLabel=\"-- #{msgs.selectCatalog} --\" noSelectionOption=\"true\"/>\n+                            <f:selectItems value=\"#{CreateProcessForm.fileUploadDialog.catalogs}\" var=\"step\" itemLabel=\"#{step}\"\n+                                           itemValue=\"#{step}\"/>\n+                            <p:ajax update=\"fileUploadForm\"/>\n+                        </p:selectOneMenu>\n+                    </div>\n+                </p:row>\n+            </p:panelGrid>\n+            <p:panelGrid>\n+                <p:row>\n+                    <div>\n+                        <p:fileUpload rendered=\"#{CreateProcessForm.fileUploadDialog.selectedCatalog ne null}\"\n+                                      fileUploadListener=\"#{CreateProcessForm.fileUploadDialog.handleFileUpload}\"\n+                                      allowTypes=\"/(\\.|\\/)(xml)$/\"\n+                                      skinSimple=\"true\"\n+                                      oncomplete=\"PF('fileUploadDialog').hide();\"\n+                                      label=\"#{msgs.chooseFile}\"\n+                                      uploadLabel=\"#{msgs.fileUpload}\"\n+                                      cancelLabel=\"#{msgs.cancel}\"\n+                                      chooseIcon=\"fa fa-times fa-lg\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2aec886a8487bef85d9bbd21e9949c171058e149"}, "originalPosition": 57}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "432b451a8474636a05af35487d966eadfed7638a", "author": {"user": {"login": "Kathrin-Huber", "name": "Kathrin Huber"}}, "url": "https://github.com/kitodo/kitodo-production/commit/432b451a8474636a05af35487d966eadfed7638a", "committedDate": "2021-01-12T10:49:39Z", "message": "Apply suggestions from code review\n\nCo-authored-by: Arved Solth <solth@effective-webwork.de>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2814, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}