{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4MDQyMjU5", "number": 3102, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNTo0MDoyOVrODbRIRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNjoxNDozMlrODbR_IA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5OTE4Nzg4OnYy", "diffSide": "RIGHT", "path": "Kitodo/src/main/java/org/kitodo/production/forms/dataeditor/AddDocStrucTypeDialog.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNTo0MDoyOVrOFipzZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNTo0MDoyOVrOFipzZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg4MDgwNQ==", "bodyText": "The javadoc is missing the parameter.", "url": "https://github.com/kitodo/kitodo-production/pull/3102#discussion_r371880805", "createdAt": "2020-01-28T15:40:29Z", "author": {"login": "oliver-stoehr"}, "path": "Kitodo/src/main/java/org/kitodo/production/forms/dataeditor/AddDocStrucTypeDialog.java", "diffHunk": "@@ -446,12 +477,19 @@ private void prepareDocStructPositionSelectionItems(boolean rootNode) {\n     /**\n      *  Prepare the list of available Metadata that can be added to the currently selected structure element.\n      */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c45b2372bf647252a711fa23da97972d0a3bec9"}, "originalPosition": 163}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5OTIwMTk2OnYy", "diffSide": "RIGHT", "path": "Kitodo/src/main/java/org/kitodo/production/forms/dataeditor/AddDocStrucTypeDialog.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNTo0Mzo0M1rOFip8Gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNTo0Mzo0M1rOFip8Gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg4MzAzNQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            .collect(Collectors.toList());", "url": "https://github.com/kitodo/kitodo-production/pull/3102#discussion_r371883035", "createdAt": "2020-01-28T15:43:43Z", "author": {"login": "oliver-stoehr"}, "path": "Kitodo/src/main/java/org/kitodo/production/forms/dataeditor/AddDocStrucTypeDialog.java", "diffHunk": "@@ -500,20 +538,29 @@ private void prepareSelectPageOnAddNodeItems() {\n     public void preparePreselectedViews() {\n         preselectedViews = new ArrayList<>();\n         List<Pair<MediaUnit, IncludedStructuralElement>> selectedMedia = dataEditor.getSelectedMedia();\n-        for (Pair pair : selectedMedia) {\n-            for (View view : ((IncludedStructuralElement) pair.getValue()).getViews()) {\n+        for (Pair<MediaUnit, IncludedStructuralElement> pair : selectedMedia) {\n+            for (View view : pair.getValue().getViews()) {\n                 if (Objects.equals(view.getMediaUnit(), pair.getKey())) {\n                     preselectedViews.add(view);\n                 }\n             }\n         }\n+        preselectedViews = preselectedViews.stream().sorted(Comparator.comparingInt(v -> v.getMediaUnit().getOrder()))\n+                .collect(Collectors.toList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c45b2372bf647252a711fa23da97972d0a3bec9"}, "originalPosition": 198}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5OTIwMzQzOnYy", "diffSide": "RIGHT", "path": "Kitodo/src/main/java/org/kitodo/production/forms/dataeditor/AddDocStrucTypeDialog.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNTo0NDowMlrOFip9Aw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNTo0NDowMlrOFip9Aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg4MzI2Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    preselectedViews = preselectedViews.stream().sorted(Comparator.comparingInt(v -> v.getMediaUnit().getOrder()))\n          \n          \n            \n                    preselectedViews.sort(Comparator.comparingInt(v -> v.getMediaUnit().getOrder()));", "url": "https://github.com/kitodo/kitodo-production/pull/3102#discussion_r371883267", "createdAt": "2020-01-28T15:44:02Z", "author": {"login": "oliver-stoehr"}, "path": "Kitodo/src/main/java/org/kitodo/production/forms/dataeditor/AddDocStrucTypeDialog.java", "diffHunk": "@@ -500,20 +538,29 @@ private void prepareSelectPageOnAddNodeItems() {\n     public void preparePreselectedViews() {\n         preselectedViews = new ArrayList<>();\n         List<Pair<MediaUnit, IncludedStructuralElement>> selectedMedia = dataEditor.getSelectedMedia();\n-        for (Pair pair : selectedMedia) {\n-            for (View view : ((IncludedStructuralElement) pair.getValue()).getViews()) {\n+        for (Pair<MediaUnit, IncludedStructuralElement> pair : selectedMedia) {\n+            for (View view : pair.getValue().getViews()) {\n                 if (Objects.equals(view.getMediaUnit(), pair.getKey())) {\n                     preselectedViews.add(view);\n                 }\n             }\n         }\n+        preselectedViews = preselectedViews.stream().sorted(Comparator.comparingInt(v -> v.getMediaUnit().getOrder()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c45b2372bf647252a711fa23da97972d0a3bec9"}, "originalPosition": 197}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5OTI2MjI2OnYy", "diffSide": "RIGHT", "path": "Kitodo/src/main/resources/messages/messages_de.properties", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNTo1Nzo0N1rOFiqiDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNTo1Nzo0N1rOFiqiDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg5Mjc0OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            dataEditor.addElement.createMultipleDocStrucWithoutPages=Mehrere Strukturelement k\\u00F6nnen nur erzeugt werden, wenn keine Seiten f\\u00FCr eine automatische Zuweisung ausgew\\u00E4hlt sind!\n          \n          \n            \n            dataEditor.addElement.createMultipleDocStrucWithoutPages=Mehrere Strukturelemente k\\u00F6nnen nur erzeugt werden, wenn keine Seiten f\\u00FCr eine automatische Zuweisung ausgew\\u00E4hlt sind!", "url": "https://github.com/kitodo/kitodo-production/pull/3102#discussion_r371892748", "createdAt": "2020-01-28T15:57:47Z", "author": {"login": "oliver-stoehr"}, "path": "Kitodo/src/main/resources/messages/messages_de.properties", "diffHunk": "@@ -215,6 +216,8 @@ currentFolder=Aktueller Ordner\n currentPageReportTemplate={currentPage} von {totalPages}\n currentRepresentative=Aktueller Repr\\u00E4sentant\\:\n dataCopier.runtimeException=Fehler beim Kopieren der Daten\\:\n+dataEditor.addElement.assignPagesToSingleDocStruc=Seiten k\\u00F6nnen nur zu einem einzelnen Strukturelement hinzugef\\u00FCgt werden!\n+dataEditor.addElement.createMultipleDocStrucWithoutPages=Mehrere Strukturelement k\\u00F6nnen nur erzeugt werden, wenn keine Seiten f\\u00FCr eine automatische Zuweisung ausgew\\u00E4hlt sind!", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c45b2372bf647252a711fa23da97972d0a3bec9"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5OTMwMzEwOnYy", "diffSide": "RIGHT", "path": "Kitodo/src/main/webapp/WEB-INF/templates/includes/metadataEditor/dialogs/addDocStrucType.xhtml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNjowODowM1rOFiq7-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNjowODowM1rOFiq7-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg5OTM4Nw==", "bodyText": "Value should be loaded from messages_de.properties/messages_en.properties.", "url": "https://github.com/kitodo/kitodo-production/pull/3102#discussion_r371899387", "createdAt": "2020-01-28T16:08:03Z", "author": {"login": "oliver-stoehr"}, "path": "Kitodo/src/main/webapp/WEB-INF/templates/includes/metadataEditor/dialogs/addDocStrucType.xhtml", "diffHunk": "@@ -11,191 +11,284 @@\n   -->\n \n <ui:composition\n-    xmlns=\"http://www.w3.org/1999/xhtml\"\n-    xmlns:f=\"http://xmlns.jcp.org/jsf/core\"\n-    xmlns:h=\"http://xmlns.jcp.org/jsf/html\"\n-    xmlns:ui=\"http://xmlns.jcp.org/jsf/facelets\"\n-    xmlns:p=\"http://primefaces.org/ui\">\n+        xmlns=\"http://www.w3.org/1999/xhtml\"\n+        xmlns:f=\"http://xmlns.jcp.org/jsf/core\"\n+        xmlns:h=\"http://xmlns.jcp.org/jsf/html\"\n+        xmlns:ui=\"http://xmlns.jcp.org/jsf/facelets\"\n+        xmlns:c=\"http://xmlns.jcp.org/jsp/jstl/core\"\n+        xmlns:p=\"http://primefaces.org/ui\">\n \n-    <p:dialog id=\"dialogAddDocStrucTypeId\"\n+    <p:dialog id=\"dialogAddDocStrucTypeDialog\"\n               resizable=\"false\"\n               widgetVar=\"dialogAddDocStrucType\"\n-              width=\"480px\"\n+              width=\"650px\"\n               modal=\"true\"\n               showHeader=\"false\"\n               dynamic=\"true\"\n               appendTo=\"@(body)\">\n-        <h3>#{msgs.neuesStrukturelement}</h3>\n+        <c:set var=\"selectedViews\"\n+               value=\"#{DataEditorForm.addDocStrucTypeDialog.preselectedViews}\"/>\n+        <c:set value=\"#{selectedViews ne null and selectedViews.size() gt 0}\"\n+               var=\"viewsSelected\"/>\n+        <h3>#{viewsSelected ? msgs.newStructuralElementFromPages : msgs.newStructuralElement}</h3>\n         <h:form id=\"dialogAddDocStrucTypeForm\">\n \n             <h:panelGroup id=\"dialogAddDocStrucTypeFormContent\"\n-                             layout=\"block\"\n+                          layout=\"block\"\n                           styleClass=\"dialogFieldWrapper\">\n-                <h:panelGrid columns=\"2\"\n-                             rendered=\"#{DataEditorForm.addDocStrucTypeDialog.subdialog != 3}\">\n-                    <h:outputLabel value=\"#{msgs.position}:\"\n-                                   for=\"docStructPositionSelection\"/>\n-                    <p:selectOneMenu id=\"docStructPositionSelection\"\n-                                     value=\"#{DataEditorForm.addDocStrucTypeDialog.docStructPositionSelectionSelectedItem}\"\n-                                     style=\"width: 180px;\">\n-                        <f:selectItems value=\"#{DataEditorForm.addDocStrucTypeDialog.docStructPositionSelectionItems}\"\n-                                       var=\"positionSelection\"\n-                                       itemValue=\"#{positionSelection}\"\n-                                       itemLabel=\"#{HelperForm.getTranslated(positionSelection.label)}\"/>\n-                        <p:ajax listener=\"#{DataEditorForm.addDocStrucTypeDialog.prepareDocStructTypes}\"\n-                                update=\"docStructAddTypeSelection, addSingleDocStrucSubmitBtn\"/>\n-                    </p:selectOneMenu>\n-\n-                    <h:outputLabel value=\"#{msgs.typ}:\"\n-                                   for=\"docStructAddTypeSelection\"/>\n-                    <p:selectOneMenu id=\"docStructAddTypeSelection\"\n-                                     value=\"#{DataEditorForm.addDocStrucTypeDialog.docStructAddTypeSelectionSelectedItem}\"\n-                                     style=\"width: 180px;\">\n-                        <f:selectItems value=\"#{DataEditorForm.addDocStrucTypeDialog.docStructAddTypeSelectionItems}\"/>\n-                        <p:ajax update=\"dialogAddDocStrucTypeForm\"/>\n-                    </p:selectOneMenu>\n+\n+                <h:panelGroup id=\"parentElement\"\n+                              layout=\"block\">\n+                    <h:outputText value=\"Neue Strukturelemente werden hinzugef\u00fcgt zu '#{DataEditorForm.addDocStrucTypeDialog.currentStructureLabel}'.\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c45b2372bf647252a711fa23da97972d0a3bec9"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5OTMyODMyOnYy", "diffSide": "RIGHT", "path": "Kitodo/src/main/webapp/WEB-INF/templates/includes/metadataEditor/dialogs/addDocStrucType.xhtml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNjoxNDozMlrOFirL6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNjoxNDozMlrOFirL6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTkwMzQ2NQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                                         styleClass=\"primary\" icon=\"fa fa-search fa-lg\" iconPos=\"right\">\n          \n          \n            \n                                                         styleClass=\"primary\"\n          \n          \n            \n                                                         icon=\"fa fa-search fa-lg\"\n          \n          \n            \n                                                         iconPos=\"right\">", "url": "https://github.com/kitodo/kitodo-production/pull/3102#discussion_r371903465", "createdAt": "2020-01-28T16:14:32Z", "author": {"login": "oliver-stoehr"}, "path": "Kitodo/src/main/webapp/WEB-INF/templates/includes/metadataEditor/dialogs/addDocStrucType.xhtml", "diffHunk": "@@ -11,191 +11,284 @@\n   -->\n \n <ui:composition\n-    xmlns=\"http://www.w3.org/1999/xhtml\"\n-    xmlns:f=\"http://xmlns.jcp.org/jsf/core\"\n-    xmlns:h=\"http://xmlns.jcp.org/jsf/html\"\n-    xmlns:ui=\"http://xmlns.jcp.org/jsf/facelets\"\n-    xmlns:p=\"http://primefaces.org/ui\">\n+        xmlns=\"http://www.w3.org/1999/xhtml\"\n+        xmlns:f=\"http://xmlns.jcp.org/jsf/core\"\n+        xmlns:h=\"http://xmlns.jcp.org/jsf/html\"\n+        xmlns:ui=\"http://xmlns.jcp.org/jsf/facelets\"\n+        xmlns:c=\"http://xmlns.jcp.org/jsp/jstl/core\"\n+        xmlns:p=\"http://primefaces.org/ui\">\n \n-    <p:dialog id=\"dialogAddDocStrucTypeId\"\n+    <p:dialog id=\"dialogAddDocStrucTypeDialog\"\n               resizable=\"false\"\n               widgetVar=\"dialogAddDocStrucType\"\n-              width=\"480px\"\n+              width=\"650px\"\n               modal=\"true\"\n               showHeader=\"false\"\n               dynamic=\"true\"\n               appendTo=\"@(body)\">\n-        <h3>#{msgs.neuesStrukturelement}</h3>\n+        <c:set var=\"selectedViews\"\n+               value=\"#{DataEditorForm.addDocStrucTypeDialog.preselectedViews}\"/>\n+        <c:set value=\"#{selectedViews ne null and selectedViews.size() gt 0}\"\n+               var=\"viewsSelected\"/>\n+        <h3>#{viewsSelected ? msgs.newStructuralElementFromPages : msgs.newStructuralElement}</h3>\n         <h:form id=\"dialogAddDocStrucTypeForm\">\n \n             <h:panelGroup id=\"dialogAddDocStrucTypeFormContent\"\n-                             layout=\"block\"\n+                          layout=\"block\"\n                           styleClass=\"dialogFieldWrapper\">\n-                <h:panelGrid columns=\"2\"\n-                             rendered=\"#{DataEditorForm.addDocStrucTypeDialog.subdialog != 3}\">\n-                    <h:outputLabel value=\"#{msgs.position}:\"\n-                                   for=\"docStructPositionSelection\"/>\n-                    <p:selectOneMenu id=\"docStructPositionSelection\"\n-                                     value=\"#{DataEditorForm.addDocStrucTypeDialog.docStructPositionSelectionSelectedItem}\"\n-                                     style=\"width: 180px;\">\n-                        <f:selectItems value=\"#{DataEditorForm.addDocStrucTypeDialog.docStructPositionSelectionItems}\"\n-                                       var=\"positionSelection\"\n-                                       itemValue=\"#{positionSelection}\"\n-                                       itemLabel=\"#{HelperForm.getTranslated(positionSelection.label)}\"/>\n-                        <p:ajax listener=\"#{DataEditorForm.addDocStrucTypeDialog.prepareDocStructTypes}\"\n-                                update=\"docStructAddTypeSelection, addSingleDocStrucSubmitBtn\"/>\n-                    </p:selectOneMenu>\n-\n-                    <h:outputLabel value=\"#{msgs.typ}:\"\n-                                   for=\"docStructAddTypeSelection\"/>\n-                    <p:selectOneMenu id=\"docStructAddTypeSelection\"\n-                                     value=\"#{DataEditorForm.addDocStrucTypeDialog.docStructAddTypeSelectionSelectedItem}\"\n-                                     style=\"width: 180px;\">\n-                        <f:selectItems value=\"#{DataEditorForm.addDocStrucTypeDialog.docStructAddTypeSelectionItems}\"/>\n-                        <p:ajax update=\"dialogAddDocStrucTypeForm\"/>\n-                    </p:selectOneMenu>\n+\n+                <h:panelGroup id=\"parentElement\"\n+                              layout=\"block\">\n+                    <h:outputText value=\"Neue Strukturelemente werden hinzugef\u00fcgt zu '#{DataEditorForm.addDocStrucTypeDialog.currentStructureLabel}'.\"/>\n+                </h:panelGroup>\n+\n+                <br/>\n+\n+                <!-- option to link to existing process -->\n+                <h:panelGrid>\n+                    <p:selectBooleanCheckbox itemLabel=\"#{msgs.link}\"\n+                                             value=\"#{DataEditorForm.addDocStrucTypeDialog.linkSubDialogVisible}\">\n+                        <p:ajax event=\"change\"\n+                                update=\"dialogAddDocStrucTypeFormContent\" />\n+                    </p:selectBooleanCheckbox>\n                 </h:panelGrid>\n \n                 <br/>\n \n-                <h:panelGrid columns=\"2\"\n-                             columnClasses=\"top,top\"\n-                             rendered=\"#{DataEditorForm.addDocStrucTypeDialog.preselectedViews eq null or DataEditorForm.addDocStrucTypeDialog.preselectedViews.size() eq 0}\">\n-                    <h:outputText value=\"#{msgs.defaults}:\"/>\n+                <!-- add new structure element -->\n+                <p:panelGrid columns=\"2\"\n+                             rendered=\"#{not DataEditorForm.addDocStrucTypeDialog.linkSubDialogVisible}\">\n \n                     <h:panelGroup>\n-                        <p:selectOneRadio layout=\"grid\" columns=\"1\" value=\"#{DataEditorForm.addDocStrucTypeDialog.subdialog}\">\n-                            <f:selectItem itemLabel=\"#{msgs.pageAllocation}\" itemValue=\"1\" />\n-                            <f:selectItem itemLabel=\"#{msgs.metadata}\" itemValue=\"2\" />\n-                            <f:selectItem itemLabel=\"#{msgs.link}\" itemValue=\"3\" />\n-                            <p:ajax event=\"click\" update=\"dialogAddDocStrucTypeFormContent\" />\n-                        </p:selectOneRadio>\n+                        <!-- select type and position of new doc struct element -->\n+                        <p:panelGrid columns=\"2\">\n+                            <p:row>\n+                                <p:outputLabel value=\"#{msgs.position}:\"\n+                                               for=\"docStructPositionSelection\"/>\n+                                <p:selectOneMenu id=\"docStructPositionSelection\"\n+                                                 class=\"input\"\n+                                                 value=\"#{DataEditorForm.addDocStrucTypeDialog.docStructPositionSelectionSelectedItem}\"\n+                                                 style=\"width: 180px;\">\n+                                    <f:selectItems value=\"#{DataEditorForm.addDocStrucTypeDialog.docStructPositionSelectionItems}\"\n+                                                   var=\"positionSelection\"\n+                                                   itemValue=\"#{positionSelection}\"\n+                                                   itemLabel=\"#{HelperForm.getTranslated(positionSelection.label)}\"/>\n+                                    <p:ajax listener=\"#{DataEditorForm.addDocStrucTypeDialog.prepareDocStructTypes}\"\n+                                            update=\"docStructAddTypeSelection\n+                                                    addDocStruc\n+                                                    addAndEditStruc\"/>\n+                                </p:selectOneMenu>\n+\n+                                <p:outputLabel value=\"#{msgs.typ}:\"\n+                                               for=\"docStructAddTypeSelection\"/>\n+                                <p:selectOneMenu id=\"docStructAddTypeSelection\"\n+                                                 class=\"input\"\n+                                                 value=\"#{DataEditorForm.addDocStrucTypeDialog.docStructAddTypeSelectionSelectedItem}\"\n+                                                 style=\"width: 180px;\">\n+                                    <f:selectItems value=\"#{DataEditorForm.addDocStrucTypeDialog.docStructAddTypeSelectionItems}\"/>\n+                                    <p:ajax listener=\"#{DataEditorForm.addDocStrucTypeDialog.prepareSelectAddableMetadataTypesItems(false)}\"\n+                                            update=\"dialogAddDocStrucTypeForm:addMetadata\"/>\n+                                </p:selectOneMenu>\n+                            </p:row>\n+                        </p:panelGrid>\n                     </h:panelGroup>\n-                </h:panelGrid>\n \n-                <h:panelGrid id=\"AddDocStrucTypeSpecs\" columns=\"1\">\n-                    <h:panelGroup rendered=\"#{DataEditorForm.addDocStrucTypeDialog.subdialog == 1}\">\n+                    <h:panelGroup>\n                         <p:panelGrid columns=\"2\">\n-                            <p:row rendered=\"#{DataEditorForm.addDocStrucTypeDialog.preselectedViews eq null or DataEditorForm.addDocStrucTypeDialog.preselectedViews.size() eq 0}\">\n-                                <h:outputText value=\"#{msgs.firstPage}:\"/>\n+                            <!-- option to select pages if doc struct was created without preselected media -->\n+                            <p:row rendered=\"#{not viewsSelected}\">\n+                                <p:outputLabel for=\"selectFirstPageOnAddNode\"\n+                                               value=\"#{msgs.firstPage}:\"/>\n                                 <p:selectOneMenu id=\"selectFirstPageOnAddNode\"\n+                                                 title=\"#{DataEditorForm.addDocStrucTypeDialog.elementsToAddSpinnerValue gt 1 ? msgs['dataEditor.addElement.assignPagesToSingleDocStruc'] : ''}\"\n+                                                 disabled=\"#{DataEditorForm.addDocStrucTypeDialog.elementsToAddSpinnerValue gt 1}\"\n+                                                 class=\"input\"\n                                                  value=\"#{DataEditorForm.addDocStrucTypeDialog.selectFirstPageOnAddNodeSelectedItem}\"\n                                                  filter=\"true\"\n                                                  filterMatchMode=\"startsWith\">\n                                     <f:selectItem itemLabel=\"#{msgs.firstPage}\"\n+                                                  noSelectionOption=\"true\"\n                                                   itemValue=\"\" />\n                                     <f:selectItems value=\"#{DataEditorForm.addDocStrucTypeDialog.selectPageOnAddNodeItems}\"/>\n+                                    <p:ajax update=\"elementsToAddSpinner\"/>\n                                 </p:selectOneMenu>\n-                            </p:row>\n \n-                            <p:row rendered=\"#{DataEditorForm.addDocStrucTypeDialog.preselectedViews eq null or DataEditorForm.addDocStrucTypeDialog.preselectedViews.size() eq 0}\">\n-                                <h:outputText value=\"#{msgs.lastPage}:\"/>\n+                                <p:outputLabel for=\"selectLastPageOnAddNode\"\n+                                                value=\"#{msgs.lastPage}:\"/>\n                                 <p:selectOneMenu id=\"selectLastPageOnAddNode\"\n+                                                 title=\"#{DataEditorForm.addDocStrucTypeDialog.elementsToAddSpinnerValue gt 1 ? msgs['dataEditor.addElement.assignPagesToSingleDocStruc'] : ''}\"\n+                                                 disabled=\"#{DataEditorForm.addDocStrucTypeDialog.elementsToAddSpinnerValue gt 1}\"\n+                                                 class=\"input\"\n                                                  value=\"#{DataEditorForm.addDocStrucTypeDialog.selectLastPageOnAddNodeSelectedItem}\"\n                                                  filter=\"true\"\n                                                  filterMatchMode=\"startsWith\">\n                                     <f:selectItem itemLabel=\"#{msgs.lastPage}\"\n+                                                  noSelectionOption=\"true\"\n                                                   itemValue=\"\" />\n                                     <f:selectItems value=\"#{DataEditorForm.addDocStrucTypeDialog.selectPageOnAddNodeItems}\"/>\n+                                    <p:ajax update=\"elementsToAddSpinner\"/>\n                                 </p:selectOneMenu>\n                             </p:row>\n-                        </p:panelGrid>\n-\n-                        <p:row rendered=\"#{DataEditorForm.addDocStrucTypeDialog.preselectedViews ne null and DataEditorForm.addDocStrucTypeDialog.preselectedViews.size() gt 0}\">\n-                            <h:outputText value=\"#{DataEditorForm.addDocStrucTypeDialog.preselectedViews.size()} #{msgs.mediaWillBeAssigned}\"/>\n-                        </p:row>\n-\n-                        <h:panelGroup layout=\"block\">\n-                            <p:commandButton id=\"addSingleDocStrucSubmitBtn\"\n-                                             value=\"#{msgs.apply}\"\n-                                             action=\"#{DataEditorForm.addDocStrucTypeDialog.addSingleDocStruc}\"\n-                                             disabled=\"#{DataEditorForm.addDocStrucTypeDialog.docStructAddTypeSelectionItems.size() lt 1}\"\n-                                             styleClass=\"primary right\"\n-                                             icon=\"fa fa-check fa-lg\"\n-                                             iconPos=\"right\"\n-                                             update=\"structureTreeForm:logicalTree,paginationForm:paginationWrapperPanel,metadataAccordion:logicalMetadataWrapperPanel,commentWrapperPanel,galleryWrapperPanel\"\n-                                             oncomplete=\"PF('dialogAddDocStrucType').hide();\"/>\n-                            <p:commandButton value=\"#{msgs.cancel}\"\n-                                             icon=\"fa fa-times fa-lg\"\n-                                             iconPos=\"secondary\"\n-                                             styleClass=\"secondary right\"\n-                                             onclick=\"PF('dialogAddDocStrucType').hide();\"/>\n-                        </h:panelGroup>\n-                    </h:panelGroup>\n-\n-                    <h:panelGroup rendered=\"#{DataEditorForm.addDocStrucTypeDialog.subdialog == 2}\">\n-                        <h:panelGrid columns=\"2\">\n-                            <h:outputLabel value=\"#{msgs.count}:\" for=\"elementsToAddSpinner\"/>\n-                            <p:spinner value=\"#{DataEditorForm.addDocStrucTypeDialog.elementsToAddSpinnerValue}\" id=\"elementsToAddSpinner\" size=\"5\" min=\"1\"/>\n-\n-                            <h:outputLabel value=\"#{msgs.typ}:\" for=\"selectAddableMetadataTypes\" />\n-                            <p:selectOneMenu id=\"selectAddableMetadataTypes\" value=\"#{DataEditorForm.addDocStrucTypeDialog.selectAddableMetadataTypesSelectedItem}\" style=\"width: 180px;\">\n-                                <f:selectItems value=\"#{DataEditorForm.addDocStrucTypeDialog.selectAddableMetadataTypesItems}\" />\n-                            </p:selectOneMenu>\n \n-                            <h:outputLabel value=\"#{msgs.value}:\" for=\"inputMetaDataValue\"/>\n-                            <h:inputTextarea id=\"inputMetaDataValue\" value=\"#{DataEditorForm.addDocStrucTypeDialog.inputMetaDataValue}\"/>\n-                        </h:panelGrid>\n-                        <h:panelGroup layout=\"block\">\n-                            <p:commandButton id=\"addMultiDocStrucSubmitBtn\"\n-                                             value=\"#{msgs.apply}\"\n-                                             action=\"#{DataEditorForm.addDocStrucTypeDialog.addMultiDocStruc}\"\n-                                             update=\"structureTreeForm:logicalTree\"\n-                                             icon=\"fa fa-check fa-lg\"\n-                                             iconPos=\"right\"\n-                                             styleClass=\"primary right\"\n-                                             oncomplete=\"PF('dialogAddDocStrucType').hide();\"/>\n-                            <p:commandButton value=\"#{msgs.cancel}\"\n-                                             icon=\"fa fa-times fa-lg\"\n-                                             iconPos=\"secondary\"\n-                                             styleClass=\"secondary right\"\n-                                             onclick=\"PF('dialogAddDocStrucType').hide();\"/>\n-                        </h:panelGroup>\n+                            <!-- show order of first and last preselected media if present -->\n+                            <p:row rendered=\"#{viewsSelected}\">\n+                                <c:set var=\"firstMediaUnit\"\n+                                       value=\"#{selectedViews[0].mediaUnit}\"/>\n+                                <c:set var=\"lastMediaUnit\"\n+                                       value=\"#{selectedViews[selectedViews.size() - 1].mediaUnit}\"/>\n+                                <p:row>\n+                                    <p:outputLabel for=\"firstMedia\"\n+                                                   value=\"#{msgs.firstPage}: \"/>\n+                                    <p:inputText id=\"firstMedia\"\n+                                                 disabled=\"#{true}\"\n+                                                 class=\"input\"\n+                                                 value=\"#{firstMediaUnit.order} #{firstMediaUnit.orderlabel}\"/>\n+                                    <p:outputLabel for=\"lastMedia\"\n+                                                   value=\"#{msgs.lastPage}: \"/>\n+                                    <p:inputText id=\"lastMedia\"\n+                                                 disabled=\"#{true}\"\n+                                                 class=\"input\"\n+                                                 value=\"#{lastMediaUnit.order} #{lastMediaUnit.orderlabel}\"/>\n+                                </p:row>\n+                            </p:row>\n+                        </p:panelGrid>\n                     </h:panelGroup>\n \n-                    <h:panelGroup rendered=\"#{DataEditorForm.addDocStrucTypeDialog.subdialog == 3}\">\n-                        <p:panelGrid>\n+                    <!-- option to add multiple doc structs of same type -->\n+                    <h:panelGroup rendered=\"#{not viewsSelected and not DataEditorForm.addDocStrucTypeDialog.linkSubDialogVisible}\">\n+                        <p:panelGrid columns=\"1\">\n                             <p:row>\n-                                <p:column colspan=\"2\">\n-                                    <h:inputText value=\"#{DataEditorForm.addDocStrucTypeDialog.processNumber}\"\n-                                                 style=\"margin-top: 8px; overflow-x: hidden; overflow-wrap: break-word; height: 36px;\"/>\n-                                </p:column>\n-                                <p:column>\n-                                    <p:commandButton id=\"searchButton\" value=\"#{msgs['dialogAddDocStrucType.searchButton']}\"\n-                                        action=\"#{DataEditorForm.addDocStrucTypeDialog.search}\"\n-                                        styleClass=\"primary\" icon=\"fa fa-search fa-lg\" iconPos=\"right\">\n-                                            <p:remoteCommand name=\"updateProcessSelect\" update=\"processSelect\"/>\n-                                            <p:ajax update=\"processSelect\" oncomplete=\"updateProcessSelect()\"/>\n-                                    </p:commandButton>\n+                                <p:column rowspan=\"2\">\n+                                    <p:outputLabel value=\"#{msgs.count} #{msgs.docstructs}:\"\n+                                                   for=\"elementsToAddSpinner\"/>\n+                                    <p:spinner value=\"#{DataEditorForm.addDocStrucTypeDialog.elementsToAddSpinnerValue}\"\n+                                               title=\"#{not empty DataEditorForm.addDocStrucTypeDialog.selectFirstPageOnAddNodeSelectedItem or not empty DataEditorForm.addDocStrucTypeDialog.selectLastPageOnAddNodeSelectedItem ? msgs['dataEditor.addElement.createMultipleDocStrucWithoutPages'] : ''}\"\n+                                               disabled=\"#{not empty DataEditorForm.addDocStrucTypeDialog.selectFirstPageOnAddNodeSelectedItem or not empty DataEditorForm.addDocStrucTypeDialog.selectLastPageOnAddNodeSelectedItem}\"\n+                                               id=\"elementsToAddSpinner\"\n+                                               class=\"input\"\n+                                               size=\"5\"\n+                                               min=\"1\">\n+                                        <p:ajax update=\"addMetadata\n+                                                        selectFirstPageOnAddNode\n+                                                        selectLastPageOnAddNode\"/>\n+                                    </p:spinner>\n                                 </p:column>\n                             </p:row>\n+                        </p:panelGrid>\n+                    </h:panelGroup>\n+\n+                    <br/>\n+\n+                    <!-- add metadata with value to new doc struct -->\n+                    <h:panelGroup id=\"addMetadata\">\n+                        <p:panelGrid columns=\"2\"\n+                                     rendered=\"#{DataEditorForm.addDocStrucTypeDialog.elementsToAddSpinnerValue gt 1}\">\n                             <p:row>\n-                                <p:column colspan=\"3\">\n-                                    <p:selectOneMenu id=\"processSelect\" converter=\"#{processConverter}\"\n-                                        value=\"#{DataEditorForm.addDocStrucTypeDialog.selectedProcess}\">\n-                                            <f:selectItems value=\"#{DataEditorForm.addDocStrucTypeDialog.processes}\"/>\n-                                            <p:ajax update=\"docStructAddTypeSelection\"/>\n-                                    </p:selectOneMenu>\n-                                </p:column>\n+                                <p:outputLabel value=\"#{msgs.metadata}:\"\n+                                               for=\"selectAddableMetadataTypes\" />\n+                                <p:selectOneMenu id=\"selectAddableMetadataTypes\"\n+                                                 class=\"input\"\n+                                                 value=\"#{DataEditorForm.addDocStrucTypeDialog.selectAddableMetadataTypesSelectedItem}\"\n+                                                 style=\"width: 180px;\">\n+                                    <f:selectItems value=\"#{DataEditorForm.addDocStrucTypeDialog.selectAddableMetadataTypesItems}\" />\n+                                </p:selectOneMenu>\n+\n+                                <p:outputLabel value=\"#{msgs.value}:\"\n+                                               for=\"inputMetaDataValue\"/>\n+                                <p:inputText id=\"inputMetaDataValue\"\n+                                             class=\"input\"\n+                                             value=\"#{DataEditorForm.addDocStrucTypeDialog.inputMetaDataValue}\"/>\n                             </p:row>\n                         </p:panelGrid>\n-                        <h:panelGroup layout=\"block\">\n-                            <p:commandButton id=\"addLinkButton\"\n-                                             value=\"#{msgs.apply}\"\n-                                             action=\"#{DataEditorForm.addDocStrucTypeDialog.addLinkButtonClick}\"\n-                                             update=\"structureTreeForm\"\n-                                             icon=\"fa fa-check fa-lg\"\n-                                             iconPos=\"right\"\n-                                             styleClass=\"primary right\"\n-                                             oncomplete=\"PF('dialogAddDocStrucType').hide();\"/>\n-                            <p:commandButton value=\"#{msgs.cancel}\"\n-                                             icon=\"fa fa-times fa-lg\"\n-                                             iconPos=\"secondary\"\n-                                             styleClass=\"secondary right\"\n-                                             onclick=\"PF('dialogAddDocStrucType').hide();\"/>\n-                        </h:panelGroup>\n                     </h:panelGroup>\n-                </h:panelGrid>\n+                </p:panelGrid>\n+\n+                <!-- link to existing process -->\n+                <p:panelGrid rendered=\"#{DataEditorForm.addDocStrucTypeDialog.linkSubDialogVisible}\">\n+                    <p:row>\n+                        <p:column colspan=\"2\">\n+                            <p:inputText id=\"processTitle\"\n+                                         styleClass=\"search-process-title input\"\n+                                         placeholder=\"#{msgs.processTitle} / #{msgs.id}\"\n+                                         value=\"#{DataEditorForm.addDocStrucTypeDialog.processNumber}\"/>\n+                        </p:column>\n+                        <p:column>\n+                            <p:commandButton id=\"searchButton\"\n+                                             value=\"#{msgs['dialogAddDocStrucType.searchButton']}\"\n+                                             action=\"#{DataEditorForm.addDocStrucTypeDialog.search}\"\n+                                             styleClass=\"primary\" icon=\"fa fa-search fa-lg\" iconPos=\"right\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c45b2372bf647252a711fa23da97972d0a3bec9"}, "originalPosition": 346}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4061, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}