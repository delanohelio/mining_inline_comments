{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyMTQ5NTg2", "number": 4076, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwOTo1MTozNlrOEzOLjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwOTo1Mjo1MFrOEzONPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyMTQ1MTY2OnYy", "diffSide": "RIGHT", "path": "Kitodo-API/src/main/java/org/kitodo/api/dataeditor/rulesetmanagement/ComplexMetadataViewInterface.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwOTo1MTozNlrOHqUH2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwOTo1MTozNlrOHqUH2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDEzMTkzMA==", "bodyText": "<T> is not used and was thus removed", "url": "https://github.com/kitodo/kitodo-production/pull/4076#discussion_r514131930", "createdAt": "2020-10-29T09:51:36Z", "author": {"login": "matthias-ronge"}, "path": "Kitodo-API/src/main/java/org/kitodo/api/dataeditor/rulesetmanagement/ComplexMetadataViewInterface.java", "diffHunk": "@@ -25,23 +25,30 @@\n      * list contains only metadata keys that are still allowed at this point,\n      * minus those that are already displayed anyway but have no value yet.\n      *\n-     * @param <T>\n-     *            the type of metadata objects\n      * @param entered\n      *            metadata objects that have already been entered, along with\n      *            their key\n      * @param additionallySelected\n      *            metadata keys that the user has already selected\n      * @return the metadata keys that the user can add\n      */\n-    <T> Collection<MetadataViewInterface> getAddableMetadata(Map<T, String> entered,\n+    Collection<MetadataViewInterface> getAddableMetadata(Map<?, String> entered,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fedefa583c80308e29c71cc82d607f6dd0a4a60b"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyMTQ1MzExOnYy", "diffSide": "RIGHT", "path": "Kitodo-DataEditor/src/main/java/org/kitodo/dataeditor/ruleset/NestedKeyView.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwOTo1MjowM1rOHqUI2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwOTo1MjowM1rOHqUI2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDEzMjE4NA==", "bodyText": "This all || is the core change of this PR", "url": "https://github.com/kitodo/kitodo-production/pull/4076#discussion_r514132184", "createdAt": "2020-10-29T09:52:03Z", "author": {"login": "matthias-ronge"}, "path": "Kitodo-DataEditor/src/main/java/org/kitodo/dataeditor/ruleset/NestedKeyView.java", "diffHunk": "@@ -340,12 +341,18 @@ protected NestedKeyView(Ruleset ruleset, U universalDivision, UniversalRule univ\n      *            metadata keys that the user has already selected\n      */\n     @Override\n-    public <V> Collection<MetadataViewInterface> getAddableMetadata(Map<V, String> currentEntries,\n+    public Collection<MetadataViewInterface> getAddableMetadata(Map<?, String> currentEntries,\n             Collection<String> additionalKeys) {\n \n+        return getPossibleMetadata(currentEntries, additionalKeys, false);\n+    }\n+\n+    private Collection<MetadataViewInterface> getPossibleMetadata(Map<?, String> currentEntries,\n+            Collection<String> additionalKeys, boolean all) {\n+\n         Collection<MetadataViewInterface> addableMetadata = new LinkedList<>();\n-        for (AuxiliaryTableRow<V> auxiliaryTableRow : createAuxiliaryTable(currentEntries, additionalKeys)) {\n-            if (auxiliaryTableRow.isPossibleToExpandAnotherField()) {\n+        for (AuxiliaryTableRow<?> auxiliaryTableRow : createAuxiliaryTable(currentEntries, additionalKeys)) {\n+            if (all || auxiliaryTableRow.isPossibleToExpandAnotherField()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fedefa583c80308e29c71cc82d607f6dd0a4a60b"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyMTQ1NTk3OnYy", "diffSide": "RIGHT", "path": "Kitodo/src/main/java/org/kitodo/production/services/calendar/CalendarService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwOTo1Mjo1MFrOHqUKpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwOTo1Mjo1MFrOHqUKpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDEzMjY0NQ==", "bodyText": "Here a totally ugly work-around could be removed.", "url": "https://github.com/kitodo/kitodo-production/pull/4076#discussion_r514132645", "createdAt": "2020-10-29T09:52:50Z", "author": {"login": "matthias-ronge"}, "path": "Kitodo/src/main/java/org/kitodo/production/services/calendar/CalendarService.java", "diffHunk": "@@ -109,18 +107,12 @@\n         StructuralElementViewInterface issueView = ruleset.getStructuralElementView(issueType, acquisitionStage, priorityList);\n \n         // From view to output, get all addable metadata\n-        List<MetadataViewWithValuesInterface<Object>> alreadyShowing = issueView\n-                .getSortedVisibleMetadata(Collections.emptyMap(), Collections.emptyList());\n-        Collection<MetadataViewInterface> addable = issueView.getAddableMetadata(Collections.emptyMap(), Collections.emptyList());\n-        return Stream\n-                .concat(\n-                    alreadyShowing.stream()\n-                            .filter(metadataViewWithValues -> metadataViewWithValues.getMetadata().isPresent())\n-                            .map(metadataViewWithValues -> metadataViewWithValues.getMetadata().get()),\n-                    addable.stream())\n-                .filter(new UniqueMetadataView())\n+        Collection<MetadataViewInterface> allowedMetadata = issueView.getAllowedMetadata();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fedefa583c80308e29c71cc82d607f6dd0a4a60b"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3857, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}