{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2NDI5NjI3", "number": 3772, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxMTo1NTo0N1rOEIVb1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwNzo0OTo0NlrOEIpnLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3MTc1MjUzOnYy", "diffSide": "RIGHT", "path": "Kitodo/src/main/java/org/kitodo/production/services/security/SecurityAccessService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxMTo1NTo0N1rOGoO6Sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxMTo1NTo0N1rOGoO6Sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDg0MDUyMw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 *            the specific processId\n          \n          \n            \n                 *            the specific projectId", "url": "https://github.com/kitodo/kitodo-production/pull/3772#discussion_r444840523", "createdAt": "2020-06-24T11:55:47Z", "author": {"login": "solth"}, "path": "Kitodo/src/main/java/org/kitodo/production/services/security/SecurityAccessService.java", "diffHunk": "@@ -339,6 +363,18 @@ public boolean hasAuthorityToEditProject() {\n         return hasAuthorityForClient(\"editProject\");\n     }\n \n+\n+    /**\n+     * Check if the current user has the authority to edit the project.\n+     *\n+     * @param projectId\n+     *            the specific processId", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "128bc4d3f40a0a46c6cb96b3734f60356350614b"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3MTc1NDg2OnYy", "diffSide": "RIGHT", "path": "Kitodo/src/main/java/org/kitodo/production/services/security/SecurityAccessService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxMTo1NjozNlrOGoO7zw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxMTo1NjozNlrOGoO7zw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDg0MDkxMQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 *            the specific processId\n          \n          \n            \n                 *            the specific projectId", "url": "https://github.com/kitodo/kitodo-production/pull/3772#discussion_r444840911", "createdAt": "2020-06-24T11:56:36Z", "author": {"login": "solth"}, "path": "Kitodo/src/main/java/org/kitodo/production/services/security/SecurityAccessService.java", "diffHunk": "@@ -449,6 +497,18 @@ public boolean hasAuthorityToViewProject() {\n         return hasAnyAuthorityForClient(\"viewProject, addProject, editProject\");\n     }\n \n+    /**\n+     * Check if the current user has the authority to view the project. Add and edit\n+     * authorities include also view.\n+     *\n+     * @param projectId\n+     *            the specific processId", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "128bc4d3f40a0a46c6cb96b3734f60356350614b"}, "originalPosition": 94}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3NTAzOTQwOnYy", "diffSide": "RIGHT", "path": "Kitodo/src/main/java/org/kitodo/production/forms/BaseForm.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwNzo0NDoxMlrOGovGlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwNzo0NDoxMlrOGovGlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM2Nzk1OQ==", "bodyText": "Instead of adding a new constant that basically just adds the .jsf suffix to the value of DEFAULT_LINK in the prior line, it would be less redundant to just add that suffix to the existing constant and reuse it. DEFAULT_LINK is currently only used for the referrer URL parameter in some places, and for that purpose desktop.jsf works as well as just desktop.", "url": "https://github.com/kitodo/kitodo-production/pull/3772#discussion_r445367959", "createdAt": "2020-06-25T07:44:12Z", "author": {"login": "solth"}, "path": "Kitodo/src/main/java/org/kitodo/production/forms/BaseForm.java", "diffHunk": "@@ -62,6 +62,7 @@\n \n     protected static final String REDIRECT_PATH = TEMPLATE_ROOT + \"{0}?\" + REDIRECT_PARAMETER;\n     protected static final String DEFAULT_LINK = \"desktop\";\n+    protected static final String DESKTOP_LINK = \"desktop.jsf\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d0568457a4a9119ab57b1a4aa4025dd91f235f9"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3NTA1NDIxOnYy", "diffSide": "RIGHT", "path": "Kitodo/src/main/java/org/kitodo/production/forms/ProcessForm.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwNzo0ODozN1rOGovP1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwNzo0ODozN1rOGovP1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM3MDMyNw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        Helper.setErrorMessage(ERROR_LOADING_ONE, new Object[] {ObjectType.PROCESS.getTranslationSingular(), id },\n          \n          \n            \n                        Helper.setErrorMessage(ERROR_LOADING_ONE, new Object[] {ObjectType.TASK.getTranslationSingular(), id },", "url": "https://github.com/kitodo/kitodo-production/pull/3772#discussion_r445370327", "createdAt": "2020-06-25T07:48:37Z", "author": {"login": "solth"}, "path": "Kitodo/src/main/java/org/kitodo/production/forms/ProcessForm.java", "diffHunk": "@@ -1229,6 +1242,16 @@ public void load(int id) {\n      * Method being used as viewAction for task form.\n      */\n     public void loadTask(int id) {\n+        SecurityAccessController securityAccessController = new SecurityAccessController();\n+        try {\n+            if (!securityAccessController.hasAuthorityToEditTask(id)) {\n+                ExternalContext context = FacesContext.getCurrentInstance().getExternalContext();\n+                context.redirect(DESKTOP_LINK);\n+            }\n+        } catch (IOException | DataException e) {\n+            Helper.setErrorMessage(ERROR_LOADING_ONE, new Object[] {ObjectType.PROCESS.getTranslationSingular(), id },", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d0568457a4a9119ab57b1a4aa4025dd91f235f9"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3NTA1ODM4OnYy", "diffSide": "RIGHT", "path": "Kitodo/src/main/java/org/kitodo/production/forms/ProjectForm.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwNzo0OTo0N1rOGovSTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwNzo0OTo0N1rOGovSTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM3MDk1Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        Helper.setErrorMessage(ERROR_LOADING_ONE, new Object[] {ObjectType.PROCESS.getTranslationSingular(), id },\n          \n          \n            \n                        Helper.setErrorMessage(ERROR_LOADING_ONE, new Object[] {ObjectType.PROJECT.getTranslationSingular(), id },", "url": "https://github.com/kitodo/kitodo-production/pull/3772#discussion_r445370957", "createdAt": "2020-06-25T07:49:47Z", "author": {"login": "solth"}, "path": "Kitodo/src/main/java/org/kitodo/production/forms/ProjectForm.java", "diffHunk": "@@ -599,6 +602,16 @@ public void setPreview(String preview) {\n      *            ID of the ruleset to load\n      */\n     public void loadProject(int id) {\n+        SecurityAccessController securityAccessController = new SecurityAccessController();\n+        try {\n+            if (!securityAccessController.hasAuthorityToEditProject(id)) {\n+                ExternalContext context = FacesContext.getCurrentInstance().getExternalContext();\n+                context.redirect(DESKTOP_LINK);\n+            }\n+        } catch (IOException e) {\n+            Helper.setErrorMessage(ERROR_LOADING_ONE, new Object[] {ObjectType.PROCESS.getTranslationSingular(), id },", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d0568457a4a9119ab57b1a4aa4025dd91f235f9"}, "originalPosition": 35}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3934, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}