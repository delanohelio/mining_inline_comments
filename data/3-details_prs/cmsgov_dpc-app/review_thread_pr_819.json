{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIzODE3MDc3", "number": 819, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxMjo0ODowN1rOEAElBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMzo1MDo1M1rOED476g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4NTEwNDY4OnYy", "diffSide": "RIGHT", "path": "dpc-api/src/main/java/gov/cms/dpc/api/cli/keys/KeyUpload.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxMjo0ODowN1rOGbHqFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxMjo0ODowN1rOGbHqFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA5MDE5OA==", "bodyText": "Method uploadKey has 5 arguments (exceeds 4 allowed). Consider refactoring.", "url": "https://github.com/CMSgov/dpc-app/pull/819#discussion_r431090198", "createdAt": "2020-05-27T12:48:07Z", "author": {"login": "codeclimate"}, "path": "dpc-api/src/main/java/gov/cms/dpc/api/cli/keys/KeyUpload.java", "diffHunk": "@@ -59,25 +70,31 @@ public void run(Bootstrap<?> bootstrap, Namespace namespace) throws Exception {\n         System.out.println(String.format(\"Connecting to API service at: %s\", apiService));\n \n         // Read the file and parse it\n-        final Path filePath = FileSystems.getDefault().getPath(namespace.getString(KEY_FILE));\n-        final String pemFile = Files.readString(filePath);\n+        final Path keyFilePath = FileSystems.getDefault().getPath(namespace.getString(KEY_FILE));\n+        final String publicKey = Files.readString(keyFilePath);\n+\n+        final Path signaturePath = FileSystems.getDefault().getPath(namespace.getString(SIGNATURE_FILE));\n+        final String signature = Files.readString(signaturePath);\n \n         final Optional<String> label = Optional.ofNullable(namespace.getString(\"key-label\"));\n-        uploadKey(apiService, orgID.getIdPart(), label, pemFile);\n+        uploadKey(apiService, orgID.getIdPart(), label, publicKey, signature);\n     }\n \n     @SuppressWarnings(\"OptionalUsedAsFieldOrParameterType\")\n-    private void uploadKey(String apiService, String orgID, Optional<String> label, String pem) throws IOException, URISyntaxException {\n+    private void uploadKey(String apiService, String orgID, Optional<String> label, String pem, String signature) throws IOException, URISyntaxException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7854286d9a3f9faf5d37d742ea7520db118e2f0"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4NTEwNDcxOnYy", "diffSide": "RIGHT", "path": "dpc-web/app/controllers/public_keys_controller.rb", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxMjo0ODowOFrOGbHqHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxMjo0ODowOFrOGbHqHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA5MDIwNA==", "bodyText": "Line is too long. [149/120]", "url": "https://github.com/CMSgov/dpc-app/pull/819#discussion_r431090204", "createdAt": "2020-05-27T12:48:08Z", "author": {"login": "codeclimate"}, "path": "dpc-web/app/controllers/public_keys_controller.rb", "diffHunk": "@@ -15,7 +15,7 @@ def create\n     reg_org = @organization.registered_organizations.find_by(api_env: params[:api_environment])\n     manager = PublicKeyManager.new(api_env: params[:api_environment], registered_organization: reg_org)\n \n-    new_public_key = manager.create_public_key(public_key: params[:public_key], label: params[:label])\n+    new_public_key = manager.create_public_key(public_key: params[:public_key], label: params[:label], snippet_signature: params[:snippet_signature])", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7854286d9a3f9faf5d37d742ea7520db118e2f0"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4NTEwNDc0OnYy", "diffSide": "RIGHT", "path": "dpc-web/app/services/public_key_manager.rb", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxMjo0ODowOFrOGbHqIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxMjo0ODowOFrOGbHqIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA5MDIxMA==", "bodyText": "Line is too long. [152/120]", "url": "https://github.com/CMSgov/dpc-app/pull/819#discussion_r431090210", "createdAt": "2020-05-27T12:48:08Z", "author": {"login": "codeclimate"}, "path": "dpc-web/app/services/public_key_manager.rb", "diffHunk": "@@ -9,15 +9,16 @@ def initialize(api_env:, registered_organization:)\n     @errors = []\n   end\n \n-  def create_public_key(public_key:, label:)\n+  def create_public_key(public_key:, label:, snippet_signature:)\n     public_key = strip_carriage_returns(public_key)\n+\n     if invalid_encoding?(public_key)\n       return { response: false,\n                message: @errors[0] }\n     end\n \n     api_client = APIClient.new(api_env)\n-    api_client.create_public_key(registered_organization.api_id, params: { label: label, public_key: public_key })\n+    api_client.create_public_key(registered_organization.api_id, params: { label: label, public_key: public_key, snippet_signature: snippet_signature })", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7854286d9a3f9faf5d37d742ea7520db118e2f0"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4NTEwNDc5OnYy", "diffSide": "RIGHT", "path": "dpc-web/app/services/api_client.rb", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxMjo0ODowOFrOGbHqJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxMjo0ODowOFrOGbHqJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA5MDIxNA==", "bodyText": "Don't use parentheses around a literal.", "url": "https://github.com/CMSgov/dpc-app/pull/819#discussion_r431090214", "createdAt": "2020-05-27T12:48:08Z", "author": {"login": "codeclimate"}, "path": "dpc-web/app/services/api_client.rb", "diffHunk": "@@ -61,9 +61,14 @@ def get_client_tokens(reg_org_api_id)\n   def create_public_key(reg_org_api_id, params: {})\n     uri_string = base_url + '/Key'\n \n+    json = ({", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7854286d9a3f9faf5d37d742ea7520db118e2f0"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5MDI0ODQ1OnYy", "diffSide": "RIGHT", "path": "dpc-web/app/services/public_key_manager.rb", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNTozMTowN1rOGb60EA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNTozMTowN1rOGb60EA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTkyODMzNg==", "bodyText": "Closing method call brace must be on the line after the last argument when opening brace is on a separate line from the first argument.", "url": "https://github.com/CMSgov/dpc-app/pull/819#discussion_r431928336", "createdAt": "2020-05-28T15:31:07Z", "author": {"login": "codeclimate"}, "path": "dpc-web/app/services/public_key_manager.rb", "diffHunk": "@@ -9,15 +9,22 @@ def initialize(api_env:, registered_organization:)\n     @errors = []\n   end\n \n-  def create_public_key(public_key:, label:)\n+  def create_public_key(public_key:, label:, snippet_signature:)\n     public_key = strip_carriage_returns(public_key)\n+\n     if invalid_encoding?(public_key)\n       return { response: false,\n                message: @errors[0] }\n     end\n \n     api_client = APIClient.new(api_env)\n-    api_client.create_public_key(registered_organization.api_id, params: { label: label, public_key: public_key })\n+    api_client.create_public_key(\n+      registered_organization.api_id, \n+      params: {\n+        label: label,\n+        public_key: public_key,\n+        snippet_signature: snippet_signature\n+      })", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e09e9a0f69f40a2200c7f1984af30e858d8b3124"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5MDI0ODQ3OnYy", "diffSide": "RIGHT", "path": "dpc-web/app/services/public_key_manager.rb", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNTozMTowN1rOGb60FA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNTozMTowN1rOGb60FA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTkyODM0MA==", "bodyText": "Trailing whitespace detected.", "url": "https://github.com/CMSgov/dpc-app/pull/819#discussion_r431928340", "createdAt": "2020-05-28T15:31:07Z", "author": {"login": "codeclimate"}, "path": "dpc-web/app/services/public_key_manager.rb", "diffHunk": "@@ -9,15 +9,22 @@ def initialize(api_env:, registered_organization:)\n     @errors = []\n   end\n \n-  def create_public_key(public_key:, label:)\n+  def create_public_key(public_key:, label:, snippet_signature:)\n     public_key = strip_carriage_returns(public_key)\n+\n     if invalid_encoding?(public_key)\n       return { response: false,\n                message: @errors[0] }\n     end\n \n     api_client = APIClient.new(api_env)\n-    api_client.create_public_key(registered_organization.api_id, params: { label: label, public_key: public_key })\n+    api_client.create_public_key(\n+      registered_organization.api_id, ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e09e9a0f69f40a2200c7f1984af30e858d8b3124"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5MDM2NzkwOnYy", "diffSide": "RIGHT", "path": "dpc-web/app/services/public_key_manager.rb", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNTo1OToxOVrOGb8BYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNTo1OToxOVrOGb8BYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk0ODEzMQ==", "bodyText": "Method has too many lines. [16/15]", "url": "https://github.com/CMSgov/dpc-app/pull/819#discussion_r431948131", "createdAt": "2020-05-28T15:59:19Z", "author": {"login": "codeclimate"}, "path": "dpc-web/app/services/public_key_manager.rb", "diffHunk": "@@ -9,15 +9,23 @@ def initialize(api_env:, registered_organization:)\n     @errors = []\n   end\n \n-  def create_public_key(public_key:, label:)\n+  def create_public_key(public_key:, label:, snippet_signature:)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f288e88e8e7962efee41bb4beb144ae71615357a"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NDQ3Njk1OnYy", "diffSide": "RIGHT", "path": "dpc-web/app/services/public_key_manager.rb", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxNjo1MjoyM1rOGckhkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxNjo1MjoyM1rOGckhkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjYxMTcyOA==", "bodyText": "Method has too many lines. [17/15]", "url": "https://github.com/CMSgov/dpc-app/pull/819#discussion_r432611728", "createdAt": "2020-05-29T16:52:23Z", "author": {"login": "codeclimate"}, "path": "dpc-web/app/services/public_key_manager.rb", "diffHunk": "@@ -9,15 +9,24 @@ def initialize(api_env:, registered_organization:)\n     @errors = []\n   end\n \n-  def create_public_key(public_key:, label:)\n+  def create_public_key(public_key:, label:, snippet_signature:)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ff55536dfcf01bd1c0c954e96cd01dc2fc9355a"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNTE0MDI2OnYy", "diffSide": "RIGHT", "path": "dpc-web/app/controllers/public_keys_controller.rb", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMzo1MDo1M1rOGhK-qw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMzo1NjoxNVrOGhLUWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQzNjA3NQ==", "bodyText": "Are we using application/zip to avoid encoding problems?  Have we tested what that does in various browsers/OS's?", "url": "https://github.com/CMSgov/dpc-app/pull/819#discussion_r437436075", "createdAt": "2020-06-09T13:50:53Z", "author": {"login": "dhgreene"}, "path": "dpc-web/app/controllers/public_keys_controller.rb", "diffHunk": "@@ -24,6 +29,10 @@ def create\n     end\n   end\n \n+  def download_snippet\n+    send_file 'public/snippet.txt', type: 'application/zip', status: 202", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e3b41ff064b368effb3cdd3d2fb269996edf7d0"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQzODM5NA==", "bodyText": "application/zip is what worked in the code? but it downloads the .txt file.\nI have not tested on different browsers but will do so immediately and report back.", "url": "https://github.com/CMSgov/dpc-app/pull/819#discussion_r437438394", "createdAt": "2020-06-09T13:52:56Z", "author": {"login": "Sun-Mountain"}, "path": "dpc-web/app/controllers/public_keys_controller.rb", "diffHunk": "@@ -24,6 +29,10 @@ def create\n     end\n   end\n \n+  def download_snippet\n+    send_file 'public/snippet.txt', type: 'application/zip', status: 202", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQzNjA3NQ=="}, "originalCommit": {"oid": "7e3b41ff064b368effb3cdd3d2fb269996edf7d0"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ0MTYyNA==", "bodyText": "Can confirm downloads work in Chrome, Safari, Firefox, and Brave browsers.", "url": "https://github.com/CMSgov/dpc-app/pull/819#discussion_r437441624", "createdAt": "2020-06-09T13:56:15Z", "author": {"login": "Sun-Mountain"}, "path": "dpc-web/app/controllers/public_keys_controller.rb", "diffHunk": "@@ -24,6 +29,10 @@ def create\n     end\n   end\n \n+  def download_snippet\n+    send_file 'public/snippet.txt', type: 'application/zip', status: 202", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQzNjA3NQ=="}, "originalCommit": {"oid": "7e3b41ff064b368effb3cdd3d2fb269996edf7d0"}, "originalPosition": 32}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4896, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}