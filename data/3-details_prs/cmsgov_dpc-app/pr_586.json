{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwOTMzNjgx", "number": 586, "title": "DPC-1027: Add Public Key operations to CLI", "bodyText": "Why\nAs part of manually on-boarding organizations, we need any easy way to manage public keys. We had some of the features already, but some were missing and needed to be added to the CLI.\nWhat Changed\nAdded missing admin tasks for public keys. These functions are only accessible when connected to the AWS VPC via the VPN. We can upload, list and delete keys via the admin tasks and the CLI commands.\nChoices Made\nThe changes were pretty straightforward, there are also some scattered changes as I added unit tests for our existing admin tasks, this required some small changes to existing files to expose constructors and such.\nTickets closed:\nDPC-1027\nFuture Work\nChecklist\n\n All tests are passing via make ci-app (app change) and make ci-web (website change)\n Swagger documentation has been updated\n FHIR documentation has been updated\n Any required dpc-ops changes have a PR submitted and mentioned in this ticket\n Any manual migration steps are documented, scripts written (where applicable), and tested\n Before merging, any required dpc-ops changes have been approved and merged into master of the dpc-ops repo", "createdAt": "2020-02-04T16:31:56Z", "url": "https://github.com/CMSgov/dpc-app/pull/586", "merged": true, "mergeCommit": {"oid": "5c60cf24f2c18aa2b4c92b2281f2f4b817675c54"}, "closed": true, "closedAt": "2020-02-19T21:46:36Z", "author": {"login": "nickrobison-usds"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBEJ_EAH2gAyMzcwOTMzNjgxOjk1OWZkZTdkOGE3ODBmZjg4MzdkYmMyNjVkMTI1MjdkMGZjN2E4NzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcF9YrWAFqTM2MTQ0OTIzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "959fde7d8a780ff8837dbc265d12527d0fc7a876", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/959fde7d8a780ff8837dbc265d12527d0fc7a876", "committedDate": "2020-02-04T16:30:32Z", "message": "DPC-1027: Refactor admin operations\n\nCreated new public key admin endpoints and split them off from the previously existing token operations.\n\nAlso refactored some of the common parameter extraction logic."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41bc83e584cd30595ebccaba412ad0146e1174c0", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/41bc83e584cd30595ebccaba412ad0146e1174c0", "committedDate": "2020-02-04T16:31:28Z", "message": "DPC-1027: Create CLI operations for managing public keys\n\nAdded upload, delete and list command for organization public keys."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5869a8f1e39ce49903a33f4cfd04e9485e79992d", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/5869a8f1e39ce49903a33f4cfd04e9485e79992d", "committedDate": "2020-02-04T18:08:00Z", "message": "DPC-1027: Error Prone fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMjAwODMx", "url": "https://github.com/CMSgov/dpc-app/pull/586#pullrequestreview-353200831", "createdAt": "2020-02-04T18:25:57Z", "commit": {"oid": "5869a8f1e39ce49903a33f4cfd04e9485e79992d"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxODoyNTo1N1rOFlep-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxODoyNTo1OVrOFleqEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg0Mzg5Nw==", "bodyText": "Similar blocks of code found in 2 locations. Consider refactoring.", "url": "https://github.com/CMSgov/dpc-app/pull/586#discussion_r374843897", "createdAt": "2020-02-04T18:25:57Z", "author": {"login": "codeclimate"}, "path": "dpc-api/src/main/java/gov/cms/dpc/api/cli/keys/KeyList.java", "diffHunk": "@@ -0,0 +1,79 @@\n+package gov.cms.dpc.api.cli.keys;\n+\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import com.jakewharton.fliptables.FlipTable;\n+import gov.cms.dpc.api.cli.AbstractAdminCommand;\n+import gov.cms.dpc.api.entities.PublicKeyEntity;\n+import gov.cms.dpc.api.models.CollectionResponse;\n+import io.dropwizard.setup.Bootstrap;\n+import net.sourceforge.argparse4j.inf.Namespace;\n+import net.sourceforge.argparse4j.inf.Subparser;\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.client.utils.URIBuilder;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.eclipse.jetty.http.HttpStatus;\n+import org.hl7.fhir.dstu3.model.IdType;\n+\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.time.format.DateTimeFormatter;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class KeyList extends AbstractAdminCommand {\n+\n+    public KeyList() {\n+        super(\"list\", \"List public keys for registered Organization.\");\n+    }\n+\n+    @Override\n+    public void addAdditionalOptions(Subparser subparser) {\n+        subparser\n+                .addArgument(\"id\")\n+                .required(true)\n+                .dest(\"org-reference\")\n+                .help(\"ID of Organization to list tokens\");\n+    }\n+\n+    @Override\n+    public void run(Bootstrap<?> bootstrap, Namespace namespace) throws Exception {\n+        // Get the reference\n+        final String orgReference = namespace.getString(\"org-reference\");\n+        System.out.println(String.format(\"Listing keys for organization: %s.\", orgReference));\n+\n+        final String apiService = namespace.getString(API_HOSTNAME);\n+        System.out.println(String.format(\"Connecting to API service at: %s\", apiService));\n+        listKeys(apiService, orgReference);\n+    }\n+\n+    private void listKeys(String apiService, String organization) throws IOException, URISyntaxException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5869a8f1e39ce49903a33f4cfd04e9485e79992d"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg0MzkwMw==", "bodyText": "Similar blocks of code found in 2 locations. Consider refactoring.", "url": "https://github.com/CMSgov/dpc-app/pull/586#discussion_r374843903", "createdAt": "2020-02-04T18:25:58Z", "author": {"login": "codeclimate"}, "path": "dpc-api/src/main/java/gov/cms/dpc/api/cli/tokens/TokenList.java", "diffHunk": "@@ -53,10 +49,10 @@ public void run(Bootstrap<?> bootstrap, Namespace namespace) throws IOException,\n         listTokens(apiService, orgReference);\n     }\n \n-    private void listTokens(String attributionService, String organization) throws IOException, URISyntaxException {\n-        // List all the tokens, switching\n+    private void listTokens(String apiService, String organization) throws IOException, URISyntaxException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5869a8f1e39ce49903a33f4cfd04e9485e79992d"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg0MzkxMA==", "bodyText": "Similar blocks of code found in 2 locations. Consider refactoring.", "url": "https://github.com/CMSgov/dpc-app/pull/586#discussion_r374843910", "createdAt": "2020-02-04T18:25:58Z", "author": {"login": "codeclimate"}, "path": "dpc-api/src/main/java/gov/cms/dpc/api/cli/keys/KeyDelete.java", "diffHunk": "@@ -0,0 +1,65 @@\n+package gov.cms.dpc.api.cli.keys;\n+\n+import gov.cms.dpc.api.cli.AbstractAdminCommand;\n+import io.dropwizard.setup.Bootstrap;\n+import net.sourceforge.argparse4j.inf.Namespace;\n+import net.sourceforge.argparse4j.inf.Subparser;\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.client.utils.URIBuilder;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.eclipse.jetty.http.HttpStatus;\n+import org.hl7.fhir.dstu3.model.IdType;\n+\n+public class KeyDelete extends AbstractAdminCommand {\n+\n+    private static final String KEY_ID = \"key-id\";\n+    private static final String ORG_REFERENCE = \"org-reference\";\n+\n+    public KeyDelete() {\n+        super(\"delete\", \"Delete public key for registered Organization.\");\n+    }\n+\n+    @Override\n+    public void addAdditionalOptions(Subparser subparser) {\n+        subparser\n+                .addArgument(\"--org\", \"-o\")\n+                .dest(\"org-reference\")\n+                .required(true)\n+                .help(\"Organization entity\");\n+        subparser\n+                .addArgument(\"id\")\n+                .required(true)\n+                .dest(KEY_ID)\n+                .help(\"ID of Public Key to delete\");\n+    }\n+\n+    @Override\n+    public void run(Bootstrap<?> bootstrap, Namespace namespace) throws Exception {\n+        // Get the reference\n+        final String orgReference = namespace.getString(ORG_REFERENCE);\n+        final String keyID = namespace.getString(KEY_ID);\n+        System.out.println(String.format(\"Deleting public key %s for organization %s\", keyID, orgReference));\n+\n+        final String apiService = namespace.getString(API_HOSTNAME);\n+        System.out.println(String.format(\"Connecting to API service at: %s\", apiService));\n+\n+        // Delete the token\n+        try (final CloseableHttpClient httpClient = HttpClients.createDefault()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5869a8f1e39ce49903a33f4cfd04e9485e79992d"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg0MzkxNg==", "bodyText": "Similar blocks of code found in 2 locations. Consider refactoring.", "url": "https://github.com/CMSgov/dpc-app/pull/586#discussion_r374843916", "createdAt": "2020-02-04T18:25:58Z", "author": {"login": "codeclimate"}, "path": "dpc-api/src/main/java/gov/cms/dpc/api/tasks/keys/DeletePublicKey.java", "diffHunk": "@@ -0,0 +1,50 @@\n+package gov.cms.dpc.api.tasks.keys;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5869a8f1e39ce49903a33f4cfd04e9485e79992d"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg0MzkyMQ==", "bodyText": "Similar blocks of code found in 2 locations. Consider refactoring.", "url": "https://github.com/CMSgov/dpc-app/pull/586#discussion_r374843921", "createdAt": "2020-02-04T18:25:59Z", "author": {"login": "codeclimate"}, "path": "dpc-api/src/main/java/gov/cms/dpc/api/tasks/tokens/DeleteToken.java", "diffHunk": "@@ -1,4 +1,4 @@\n-package gov.cms.dpc.api.tasks;\n+package gov.cms.dpc.api.tasks.tokens;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5869a8f1e39ce49903a33f4cfd04e9485e79992d"}, "originalPosition": 2}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a75cc4198998e57459448358e5d5f142d4f2ad68", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/a75cc4198998e57459448358e5d5f142d4f2ad68", "committedDate": "2020-02-07T17:45:19Z", "message": "DPC-1027: Add test class for public key admin tasks\n\nMocking the key resource to ensure the admin tasks are covered."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32b0a8f90565205bf3c47b85cec71136372c8b78", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/32b0a8f90565205bf3c47b85cec71136372c8b78", "committedDate": "2020-02-07T18:27:38Z", "message": "DPC-1027: Added unit tests for client token tests\n\nAdded unit tests for the admin tasks, to ensure that they edge cases are covered. Nice to have good code coverage numbers and address some tech debt."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1MzYwNzI5", "url": "https://github.com/CMSgov/dpc-app/pull/586#pullrequestreview-355360729", "createdAt": "2020-02-07T18:46:46Z", "commit": {"oid": "32b0a8f90565205bf3c47b85cec71136372c8b78"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxODo0Njo0NlrOFnGqNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxODo0Njo0N1rOFnGqQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU0Nzg5NA==", "bodyText": "Similar blocks of code found in 2 locations. Consider refactoring.", "url": "https://github.com/CMSgov/dpc-app/pull/586#discussion_r376547894", "createdAt": "2020-02-07T18:46:46Z", "author": {"login": "codeclimate"}, "path": "dpc-api/src/main/java/gov/cms/dpc/api/tasks/keys/ListPublicKeys.java", "diffHunk": "@@ -0,0 +1,43 @@\n+package gov.cms.dpc.api.tasks.keys;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32b0a8f90565205bf3c47b85cec71136372c8b78"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU0Nzg5OQ==", "bodyText": "Similar blocks of code found in 2 locations. Consider refactoring.", "url": "https://github.com/CMSgov/dpc-app/pull/586#discussion_r376547899", "createdAt": "2020-02-07T18:46:46Z", "author": {"login": "codeclimate"}, "path": "dpc-api/src/main/java/gov/cms/dpc/api/tasks/tokens/ListClientTokens.java", "diffHunk": "@@ -1,7 +1,6 @@\n-package gov.cms.dpc.api.tasks;\n+package gov.cms.dpc.api.tasks.tokens;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32b0a8f90565205bf3c47b85cec71136372c8b78"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU0NzkwMA==", "bodyText": "Replace this use of System.out or System.err by a logger.", "url": "https://github.com/CMSgov/dpc-app/pull/586#discussion_r376547900", "createdAt": "2020-02-07T18:46:46Z", "author": {"login": "codeclimate"}, "path": "dpc-api/src/main/java/gov/cms/dpc/api/cli/keys/KeyDelete.java", "diffHunk": "@@ -0,0 +1,65 @@\n+package gov.cms.dpc.api.cli.keys;\n+\n+import gov.cms.dpc.api.cli.AbstractAdminCommand;\n+import io.dropwizard.setup.Bootstrap;\n+import net.sourceforge.argparse4j.inf.Namespace;\n+import net.sourceforge.argparse4j.inf.Subparser;\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.client.utils.URIBuilder;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.eclipse.jetty.http.HttpStatus;\n+import org.hl7.fhir.dstu3.model.IdType;\n+\n+public class KeyDelete extends AbstractAdminCommand {\n+\n+    private static final String KEY_ID = \"key-id\";\n+    private static final String ORG_REFERENCE = \"org-reference\";\n+\n+    public KeyDelete() {\n+        super(\"delete\", \"Delete public key for registered Organization.\");\n+    }\n+\n+    @Override\n+    public void addAdditionalOptions(Subparser subparser) {\n+        subparser\n+                .addArgument(\"--org\", \"-o\")\n+                .dest(\"org-reference\")\n+                .required(true)\n+                .help(\"Organization entity\");\n+        subparser\n+                .addArgument(\"id\")\n+                .required(true)\n+                .dest(KEY_ID)\n+                .help(\"ID of Public Key to delete\");\n+    }\n+\n+    @Override\n+    public void run(Bootstrap<?> bootstrap, Namespace namespace) throws Exception {\n+        // Get the reference\n+        final String orgReference = namespace.getString(ORG_REFERENCE);\n+        final String keyID = namespace.getString(KEY_ID);\n+        System.out.println(String.format(\"Deleting public key %s for organization %s\", keyID, orgReference));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32b0a8f90565205bf3c47b85cec71136372c8b78"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU0NzkwMg==", "bodyText": "Replace this use of System.out or System.err by a logger.", "url": "https://github.com/CMSgov/dpc-app/pull/586#discussion_r376547902", "createdAt": "2020-02-07T18:46:47Z", "author": {"login": "codeclimate"}, "path": "dpc-api/src/main/java/gov/cms/dpc/api/cli/keys/KeyDelete.java", "diffHunk": "@@ -0,0 +1,65 @@\n+package gov.cms.dpc.api.cli.keys;\n+\n+import gov.cms.dpc.api.cli.AbstractAdminCommand;\n+import io.dropwizard.setup.Bootstrap;\n+import net.sourceforge.argparse4j.inf.Namespace;\n+import net.sourceforge.argparse4j.inf.Subparser;\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.client.utils.URIBuilder;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.eclipse.jetty.http.HttpStatus;\n+import org.hl7.fhir.dstu3.model.IdType;\n+\n+public class KeyDelete extends AbstractAdminCommand {\n+\n+    private static final String KEY_ID = \"key-id\";\n+    private static final String ORG_REFERENCE = \"org-reference\";\n+\n+    public KeyDelete() {\n+        super(\"delete\", \"Delete public key for registered Organization.\");\n+    }\n+\n+    @Override\n+    public void addAdditionalOptions(Subparser subparser) {\n+        subparser\n+                .addArgument(\"--org\", \"-o\")\n+                .dest(\"org-reference\")\n+                .required(true)\n+                .help(\"Organization entity\");\n+        subparser\n+                .addArgument(\"id\")\n+                .required(true)\n+                .dest(KEY_ID)\n+                .help(\"ID of Public Key to delete\");\n+    }\n+\n+    @Override\n+    public void run(Bootstrap<?> bootstrap, Namespace namespace) throws Exception {\n+        // Get the reference\n+        final String orgReference = namespace.getString(ORG_REFERENCE);\n+        final String keyID = namespace.getString(KEY_ID);\n+        System.out.println(String.format(\"Deleting public key %s for organization %s\", keyID, orgReference));\n+\n+        final String apiService = namespace.getString(API_HOSTNAME);\n+        System.out.println(String.format(\"Connecting to API service at: %s\", apiService));\n+\n+        // Delete the token\n+        try (final CloseableHttpClient httpClient = HttpClients.createDefault()) {\n+            final URIBuilder builder = new URIBuilder(String.format(\"%s/delete-key\", apiService));\n+            builder.setParameter(\"organization\", new IdType(orgReference).getIdPart());\n+            builder.setParameter(\"key\", keyID);\n+            final HttpPost keyDelete = new HttpPost(builder.build());\n+\n+            try (CloseableHttpResponse response = httpClient.execute(keyDelete)) {\n+                if (!HttpStatus.isSuccess(response.getStatusLine().getStatusCode())) {\n+                    System.err.println(\"Error deleting key: \" + response.getStatusLine().getReasonPhrase());\n+                    System.exit(1);\n+                }\n+            }\n+        }\n+\n+        System.out.println(\"Successfully deleted public key\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32b0a8f90565205bf3c47b85cec71136372c8b78"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU0NzkwNg==", "bodyText": "Similar blocks of code found in 2 locations. Consider refactoring.", "url": "https://github.com/CMSgov/dpc-app/pull/586#discussion_r376547906", "createdAt": "2020-02-07T18:46:47Z", "author": {"login": "codeclimate"}, "path": "dpc-api/src/main/java/gov/cms/dpc/api/cli/keys/KeyList.java", "diffHunk": "@@ -0,0 +1,79 @@\n+package gov.cms.dpc.api.cli.keys;\n+\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import com.jakewharton.fliptables.FlipTable;\n+import gov.cms.dpc.api.cli.AbstractAdminCommand;\n+import gov.cms.dpc.api.entities.PublicKeyEntity;\n+import gov.cms.dpc.api.models.CollectionResponse;\n+import io.dropwizard.setup.Bootstrap;\n+import net.sourceforge.argparse4j.inf.Namespace;\n+import net.sourceforge.argparse4j.inf.Subparser;\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.client.utils.URIBuilder;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.eclipse.jetty.http.HttpStatus;\n+import org.hl7.fhir.dstu3.model.IdType;\n+\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.time.format.DateTimeFormatter;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class KeyList extends AbstractAdminCommand {\n+\n+    public KeyList() {\n+        super(\"list\", \"List public keys for registered Organization.\");\n+    }\n+\n+    @Override\n+    public void addAdditionalOptions(Subparser subparser) {\n+        subparser\n+                .addArgument(\"id\")\n+                .required(true)\n+                .dest(\"org-reference\")\n+                .help(\"ID of Organization to list tokens\");\n+    }\n+\n+    @Override", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32b0a8f90565205bf3c47b85cec71136372c8b78"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d7c5974460ab89bf0388cc3fe2fa4c35963f69f", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/1d7c5974460ab89bf0388cc3fe2fa4c35963f69f", "committedDate": "2020-02-07T20:41:39Z", "message": "Merge branch 'master' into nickrobison/DPC-1027-key-cli"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4OTkxMzMy", "url": "https://github.com/CMSgov/dpc-app/pull/586#pullrequestreview-358991332", "createdAt": "2020-02-14T14:48:14Z", "commit": {"oid": "1d7c5974460ab89bf0388cc3fe2fa4c35963f69f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxNDo0ODoxNFrOFp49oQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxNDo0ODoxNFrOFp49oQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQ2OTIxNw==", "bodyText": "Register subcommands here. See details in other comment.", "url": "https://github.com/CMSgov/dpc-app/pull/586#discussion_r379469217", "createdAt": "2020-02-14T14:48:14Z", "author": {"login": "DeirdreHolub"}, "path": "dpc-api/src/main/java/gov/cms/dpc/api/cli/keys/KeyCommand.java", "diffHunk": "@@ -0,0 +1,10 @@\n+package gov.cms.dpc.api.cli.keys;\n+\n+import gov.cms.dpc.api.cli.AbstractCommandTree;\n+\n+public class KeyCommand extends AbstractCommandTree {\n+\n+    protected KeyCommand() {\n+        super(\"key\", \"Public key related commands\");\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d7c5974460ab89bf0388cc3fe2fa4c35963f69f"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0506769a4ba74fc861769b34ddcd0749b83f637f", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/0506769a4ba74fc861769b34ddcd0749b83f637f", "committedDate": "2020-02-18T14:46:36Z", "message": "DPC-1027: Actually register CLI commands.\n\nRegister the key subcommands and the root command with the API service."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ea5e581b31a99f9fb71a7b6a5e37caa74278363", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/7ea5e581b31a99f9fb71a7b6a5e37caa74278363", "committedDate": "2020-02-18T14:46:39Z", "message": "Merge branch 'master' into nickrobison/DPC-1027-key-cli"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMTQyNzcy", "url": "https://github.com/CMSgov/dpc-app/pull/586#pullrequestreview-361142772", "createdAt": "2020-02-19T14:15:04Z", "commit": {"oid": "7ea5e581b31a99f9fb71a7b6a5e37caa74278363"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNDoxNTowNVrOFrprqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNDoxNTowNVrOFrprqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMxNjAwOA==", "bodyText": "Should this say something more like, ID of organization to upload key for?", "url": "https://github.com/CMSgov/dpc-app/pull/586#discussion_r381316008", "createdAt": "2020-02-19T14:15:05Z", "author": {"login": "em1"}, "path": "dpc-api/src/main/java/gov/cms/dpc/api/cli/keys/KeyUpload.java", "diffHunk": "@@ -0,0 +1,92 @@\n+package gov.cms.dpc.api.cli.keys;\n+\n+import gov.cms.dpc.api.cli.AbstractAdminCommand;\n+import io.dropwizard.setup.Bootstrap;\n+import net.sourceforge.argparse4j.inf.Namespace;\n+import net.sourceforge.argparse4j.inf.Subparser;\n+import org.apache.http.HttpHeaders;\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.client.utils.URIBuilder;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.util.EntityUtils;\n+import org.eclipse.jetty.http.HttpStatus;\n+import org.hl7.fhir.dstu3.model.IdType;\n+\n+import javax.ws.rs.core.MediaType;\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.nio.file.FileSystems;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.Optional;\n+\n+public class KeyUpload extends AbstractAdminCommand {\n+\n+    private static final String KEY_FILE = \"key-file\";\n+\n+    public KeyUpload() {\n+        super(\"upload\", \"Upload organization public key\");\n+    }\n+\n+    @Override\n+    public void addAdditionalOptions(Subparser subparser) {\n+        subparser\n+                .addArgument(\"id\")\n+                .required(true)\n+                .dest(\"org-reference\")\n+                .help(\"ID of Organization to list tokens\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ea5e581b31a99f9fb71a7b6a5e37caa74278363"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "372f791f7d437d5f26bbf2c69fcded023eb1cd45", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/372f791f7d437d5f26bbf2c69fcded023eb1cd45", "committedDate": "2020-02-19T14:32:07Z", "message": "DPC-1027: Fix CLI command labels"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMjY0NDQ2", "url": "https://github.com/CMSgov/dpc-app/pull/586#pullrequestreview-361264446", "createdAt": "2020-02-19T16:56:39Z", "commit": {"oid": "372f791f7d437d5f26bbf2c69fcded023eb1cd45"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNjo1NjozOVrOFrvWWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNjo1NjozOVrOFrvWWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQwODg1Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            .help(\"ID of Organization to upload keys tokens\");\n          \n          \n            \n                            .help(\"ID of Organization to upload key\");", "url": "https://github.com/CMSgov/dpc-app/pull/586#discussion_r381408857", "createdAt": "2020-02-19T16:56:39Z", "author": {"login": "em1"}, "path": "dpc-api/src/main/java/gov/cms/dpc/api/cli/keys/KeyUpload.java", "diffHunk": "@@ -0,0 +1,92 @@\n+package gov.cms.dpc.api.cli.keys;\n+\n+import gov.cms.dpc.api.cli.AbstractAdminCommand;\n+import io.dropwizard.setup.Bootstrap;\n+import net.sourceforge.argparse4j.inf.Namespace;\n+import net.sourceforge.argparse4j.inf.Subparser;\n+import org.apache.http.HttpHeaders;\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.client.utils.URIBuilder;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.util.EntityUtils;\n+import org.eclipse.jetty.http.HttpStatus;\n+import org.hl7.fhir.dstu3.model.IdType;\n+\n+import javax.ws.rs.core.MediaType;\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.nio.file.FileSystems;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.Optional;\n+\n+public class KeyUpload extends AbstractAdminCommand {\n+\n+    private static final String KEY_FILE = \"key-file\";\n+\n+    public KeyUpload() {\n+        super(\"upload\", \"Upload organization public key\");\n+    }\n+\n+    @Override\n+    public void addAdditionalOptions(Subparser subparser) {\n+        subparser\n+                .addArgument(\"id\")\n+                .required(true)\n+                .dest(\"org-reference\")\n+                .help(\"ID of Organization to upload keys tokens\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "372f791f7d437d5f26bbf2c69fcded023eb1cd45"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMjY1MjE5", "url": "https://github.com/CMSgov/dpc-app/pull/586#pullrequestreview-361265219", "createdAt": "2020-02-19T16:57:31Z", "commit": {"oid": "372f791f7d437d5f26bbf2c69fcded023eb1cd45"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxNDQ5MjM0", "url": "https://github.com/CMSgov/dpc-app/pull/586#pullrequestreview-361449234", "createdAt": "2020-02-19T21:26:52Z", "commit": {"oid": "372f791f7d437d5f26bbf2c69fcded023eb1cd45"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 244, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}