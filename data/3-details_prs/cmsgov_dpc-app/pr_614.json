{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2NzMzMzky", "number": 614, "title": "create custom layout to parse json like strings for logging", "bodyText": "Why\nThere are metrics logs that have a json like structure shoved into the message field of the logs, this PR is to extract out those json like structures and move the key/value pair to the same level as the message field.\nWhat Changed\nCreated a new logback layout that extends EventJsonLayout and currently configured dpc-api to use that new layout\nChoices Made\nThis seemed to be the most straight forward way to plug into dropwizard and modify the log messages. Another alternative would be creating a custom appender but I believe that would not give you the LoggingEvent object like it does in the Layout.\nTickets closed:\nhttps://jiraent.cms.gov/browse/DPC-1025\nFuture Work\nList any additional tickets that have either been created due to work in this PR, or existing tickets that expand upon the feature or provide additional fixes.\nChecklist\n\n All tests are passing via make ci-app (app change) and make ci-web (website change)\n Swagger documentation has been updated\n FHIR documentation has been updated\n Any required dpc-ops changes have a PR submitted and mentioned in this ticket\n Any manual migration steps are documented, scripts written (where applicable), and tested\n Before merging, any required dpc-ops changes have been approved and merged into master of the dpc-ops repo\n\nImage below shows type, name, and value at the same level as the other fields, they used to be all stored in the message field", "createdAt": "2020-02-18T17:05:11Z", "url": "https://github.com/CMSgov/dpc-app/pull/614", "merged": true, "mergeCommit": {"oid": "8a221a79e0ec231b8dfd0d4bce7d06fc44067c0e"}, "closed": true, "closedAt": "2020-02-21T18:45:03Z", "author": {"login": "MrBilnon"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFk9sGAH2gAyMzc2NzMzMzkyOmYxZGEzYTIyMzdhZTIzM2RlYjYwNzY0MTliMTQxY2RmZjdhODk0NjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGihkcAH2gAyMzc2NzMzMzkyOmE0MWU2YzBmNjM1YjhlZjIxOGE0MGQ1MmEyNzIwNDM2MmZjOTgwNDM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f1da3a2237ae233deb6076419b141cdff7a89465", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/f1da3a2237ae233deb6076419b141cdff7a89465", "committedDate": "2020-02-18T16:59:40Z", "message": "create custom layout to parse json like strings for logging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f97844924ef6f3faaae0e7d588d11a5d83ed7cf", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/9f97844924ef6f3faaae0e7d588d11a5d83ed7cf", "committedDate": "2020-02-18T17:40:26Z", "message": "remove unused import"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNTYwOTM2", "url": "https://github.com/CMSgov/dpc-app/pull/614#pullrequestreview-360560936", "createdAt": "2020-02-18T18:12:19Z", "commit": {"oid": "9f97844924ef6f3faaae0e7d588d11a5d83ed7cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxODoxMjoxOVrOFrNCyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxODoxMjoxOVrOFrNCyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg0Njc5NQ==", "bodyText": "Constructor has 8 parameters, which is greater than 7 authorized.", "url": "https://github.com/CMSgov/dpc-app/pull/614#discussion_r380846795", "createdAt": "2020-02-18T18:12:19Z", "author": {"login": "codeclimate"}, "path": "dpc-common/src/main/java/gov/cms/dpc/common/logging/DPCJsonLayout.java", "diffHunk": "@@ -0,0 +1,57 @@\n+package gov.cms.dpc.common.logging;\n+\n+import ch.qos.logback.classic.pattern.ThrowableHandlingConverter;\n+import ch.qos.logback.classic.spi.ILoggingEvent;\n+import io.dropwizard.logging.json.EventAttribute;\n+import io.dropwizard.logging.json.layout.EventJsonLayout;\n+import io.dropwizard.logging.json.layout.JsonFormatter;\n+import io.dropwizard.logging.json.layout.TimestampFormatter;\n+import org.apache.commons.lang3.StringUtils;\n+\n+import java.util.Arrays;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+public class DPCJsonLayout extends EventJsonLayout {\n+\n+    private static final String MESSAGE = \"message\";\n+    private static final String KEY_VALUE_SEPARATOR = \"=\";\n+    private static final String ENTRY_SEPARATOR = \",\";\n+\n+    public DPCJsonLayout(JsonFormatter jsonFormatter, TimestampFormatter timestampFormatter, ThrowableHandlingConverter throwableProxyConverter, Set<EventAttribute> includes, Map<String, String> customFieldNames, Map<String, Object> additionalFields, Set<String> includesMdcKeys, boolean flattenMdc) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f97844924ef6f3faaae0e7d588d11a5d83ed7cf"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNjE2MTkw", "url": "https://github.com/CMSgov/dpc-app/pull/614#pullrequestreview-360616190", "createdAt": "2020-02-18T19:35:37Z", "commit": {"oid": "9f97844924ef6f3faaae0e7d588d11a5d83ed7cf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1040d3d87c40f4baeb30a52e37e866d58155278", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/e1040d3d87c40f4baeb30a52e37e866d58155278", "committedDate": "2020-02-18T19:37:38Z", "message": "Merge branch 'master' into willh/DPC-1025-logging-json-format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03df30681e6fed3edef5919c6c55adbaf309b433", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/03df30681e6fed3edef5919c6c55adbaf309b433", "committedDate": "2020-02-18T20:08:17Z", "message": "add dpc-json layout to other projects"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e42ef1430f8f4be698713a2ae87117748158354", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/1e42ef1430f8f4be698713a2ae87117748158354", "committedDate": "2020-02-18T20:38:01Z", "message": "Merge remote-tracking branch 'origin/willh/DPC-1025-logging-json-format' into willh/DPC-1025-logging-json-format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f61d5e3ecec16a87a2e2d7406c5ac241c646fd82", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/f61d5e3ecec16a87a2e2d7406c5ac241c646fd82", "committedDate": "2020-02-21T15:02:02Z", "message": "Merge branch 'master' into willh/DPC-1025-logging-json-format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a41e6c0f635b8ef218a40d52a27204362fc98043", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/a41e6c0f635b8ef218a40d52a27204362fc98043", "committedDate": "2020-02-21T16:43:04Z", "message": "Merge branch 'master' into willh/DPC-1025-logging-json-format"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 261, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}