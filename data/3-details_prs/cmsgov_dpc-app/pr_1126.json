{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI5Njk5ODQ2", "number": 1126, "title": "DPC-849: Prohibited test org ids from being used when org is created via attir\u2026", "bodyText": "Fixes DPC-849\n\nIf no org id is provided when creating a new org a randomly generated UUID is used. While EXTREMELY unlikely, it is possible that the generated UUID matches one of the lookback exempt UUIDs used for test purposes, allowing the newly created org to bypass lookback.\nProposed Changes\nProhibit attribution from creating a UUID that is included in lookback exempt list.\n\nChange Details\nGenerate a random UUID that is not included in prohibited list before converting FHIR model into OrganizationEntity.\n\nSecurity Implications\n\n\n new software dependencies\n\n\n\n security controls or supporting software altered\n\n\n\n new data stored or transmitted\n\n\n\n security checklist is completed for this change\n\n\n\n requires more information or team discussion to evaluate security implications\n\n\n\n no PHI/PII is affected by this change\n\n\nAcceptance Validation\n\nTested with unit tests. Smoke tests pass in dev.\n\nFeedback Requested\nVerify logic.", "createdAt": "2020-11-30T17:30:14Z", "url": "https://github.com/CMSgov/dpc-app/pull/1126", "merged": true, "mergeCommit": {"oid": "f607dbc63b43790aab904c7fc30ab19a125f26e6"}, "closed": true, "closedAt": "2020-12-02T18:07:37Z", "author": {"login": "MrMorie"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdhoy6egH2gAyNTI5Njk5ODQ2OjVhZjcwMWFjYjExM2JkMWM2OTEyNDc5NTliMmRjNTVmM2ZhMTk1YzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdiSI4RgH2gAyNTI5Njk5ODQ2OjJkZTQzMzgwNmE0NjJkZGVhYTQ2ZjMyNmI4MTFlZDM0MjdjYWVlM2Y=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5af701acb113bd1c691247959b2dc55f3fa195c6", "author": {"user": {"login": "MrMorie", "name": "Salvador"}}, "url": "https://github.com/CMSgov/dpc-app/commit/5af701acb113bd1c691247959b2dc55f3fa195c6", "committedDate": "2020-11-30T17:28:33Z", "message": "Prohibited test org ids from being used when org is created via attirbuion service."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMTQzNzAz", "url": "https://github.com/CMSgov/dpc-app/pull/1126#pullrequestreview-541143703", "createdAt": "2020-11-30T17:41:02Z", "commit": {"oid": "5af701acb113bd1c691247959b2dc55f3fa195c6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNzo0MTowMlrOH8GS4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNzo0MTowMlrOH8GS4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc3OTc0Ng==", "bodyText": "maybe move this method into APIHelpers as a static method if you see this type of logic being used else where too (tests included)", "url": "https://github.com/CMSgov/dpc-app/pull/1126#discussion_r532779746", "createdAt": "2020-11-30T17:41:02Z", "author": {"login": "MrBilnon"}, "path": "dpc-attribution/src/main/java/gov/cms/dpc/attribution/resources/v1/OrganizationResource.java", "diffHunk": "@@ -175,4 +181,15 @@ public Response deleteOrganization(@ApiParam(value = \"Organization resource ID\",\n                 .map(e -> this.converter.fromFHIR(EndpointEntity.class, e))\n                 .collect(Collectors.toList());\n     }\n+\n+    private String getNewOrgId(Organization organization){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5af701acb113bd1c691247959b2dc55f3fa195c6"}, "originalPosition": 61}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMTQ5ODEw", "url": "https://github.com/CMSgov/dpc-app/pull/1126#pullrequestreview-541149810", "createdAt": "2020-11-30T17:48:39Z", "commit": {"oid": "5af701acb113bd1c691247959b2dc55f3fa195c6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNzo0ODozOVrOH8GmpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNzo0ODozOVrOH8GmpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc4NDgwNA==", "bodyText": "Call \"optOrganization.isPresent()\" before accessing the value.", "url": "https://github.com/CMSgov/dpc-app/pull/1126#discussion_r532784804", "createdAt": "2020-11-30T17:48:39Z", "author": {"login": "codeclimate"}, "path": "dpc-attribution/src/main/java/gov/cms/dpc/attribution/resources/v1/OrganizationResource.java", "diffHunk": "@@ -81,18 +85,20 @@\n     })\n     public Response submitOrganization(@FHIRParameter(name = \"resource\") Bundle transactionBundle) {\n \n-        final Optional<Organization> organization = transactionBundle\n+        final Optional<Organization> optOrganization = transactionBundle\n                 .getEntry()\n                 .stream()\n                 .filter(entry -> entry.hasResource() && entry.getResource().getResourceType() == ResourceType.Organization)\n                 .map(entry -> (Organization) entry.getResource())\n                 .findFirst();\n \n-        if (organization.isEmpty()) {\n+        if (optOrganization.isEmpty()) {\n             return Response.status(HttpStatus.UNPROCESSABLE_ENTITY_422).entity(\"Must provide organization to register\").build();\n         }\n \n-        final OrganizationEntity entity = this.converter.fromFHIR(OrganizationEntity.class, organization.get());\n+        Organization organization = optOrganization.get();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5af701acb113bd1c691247959b2dc55f3fa195c6"}, "originalPosition": 50}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81876e0b247f26e1e512ba2d2281c6391e789209", "author": {"user": {"login": "MrMorie", "name": "Salvador"}}, "url": "https://github.com/CMSgov/dpc-app/commit/81876e0b247f26e1e512ba2d2281c6391e789209", "committedDate": "2020-12-01T00:55:29Z", "message": "Added unit tests for attribution OrganizatonResource"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "717673247024a9319ef65cd2e91f4bb0c1148352", "author": {"user": {"login": "MrMorie", "name": "Salvador"}}, "url": "https://github.com/CMSgov/dpc-app/commit/717673247024a9319ef65cd2e91f4bb0c1148352", "committedDate": "2020-12-01T01:42:38Z", "message": "Moved some comon test code to attribution test helpers"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyMDc1MDkz", "url": "https://github.com/CMSgov/dpc-app/pull/1126#pullrequestreview-542075093", "createdAt": "2020-12-01T16:25:31Z", "commit": {"oid": "717673247024a9319ef65cd2e91f4bb0c1148352"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxNjoyNTozMlrOH81HGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxNjoyNTozMlrOH81HGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU0Njc3OQ==", "bodyText": "Swapped this only because code climate was complaining about using .isPresent()", "url": "https://github.com/CMSgov/dpc-app/pull/1126#discussion_r533546779", "createdAt": "2020-12-01T16:25:32Z", "author": {"login": "MrMorie"}, "path": "dpc-attribution/src/main/java/gov/cms/dpc/attribution/resources/v1/OrganizationResource.java", "diffHunk": "@@ -81,18 +87,22 @@\n     })\n     public Response submitOrganization(@FHIRParameter(name = \"resource\") Bundle transactionBundle) {\n \n-        final Optional<Organization> organization = transactionBundle\n+        final Optional<Organization> optOrganization = transactionBundle\n                 .getEntry()\n                 .stream()\n                 .filter(entry -> entry.hasResource() && entry.getResource().getResourceType() == ResourceType.Organization)\n                 .map(entry -> (Organization) entry.getResource())\n                 .findFirst();\n \n-        if (organization.isEmpty()) {\n+        if (!optOrganization.isPresent()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "717673247024a9319ef65cd2e91f4bb0c1148352"}, "originalPosition": 54}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyOTQ5NjAy", "url": "https://github.com/CMSgov/dpc-app/pull/1126#pullrequestreview-542949602", "createdAt": "2020-12-02T15:25:36Z", "commit": {"oid": "717673247024a9319ef65cd2e91f4bb0c1148352"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9be3f318b3b433fbce81e1dde4a56b68fe9e811", "author": {"user": {"login": "MrMorie", "name": "Salvador"}}, "url": "https://github.com/CMSgov/dpc-app/commit/c9be3f318b3b433fbce81e1dde4a56b68fe9e811", "committedDate": "2020-12-02T16:40:33Z", "message": "Merge branch 'master' into sg/DPC-849-prohibit-test-org-ids"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2de433806a462ddeaa46f326b811ed3427caee3f", "author": {"user": {"login": "MrMorie", "name": "Salvador"}}, "url": "https://github.com/CMSgov/dpc-app/commit/2de433806a462ddeaa46f326b811ed3427caee3f", "committedDate": "2020-12-02T17:38:39Z", "message": "Merge branch 'master' into sg/DPC-849-prohibit-test-org-ids"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 325, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}