{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2MjE4MzU2", "number": 1114, "title": "DPC-821: Validate NPI on org creation (admin)", "bodyText": "Fixes DPC-821\n\nIn prod-sandbox we're auto-generating fake NPI's for new organizations. However, in dev and test we don't. Also, on the admin page for org creation, we're not validating the NPI. This causes a problem when it's time to enable API access, because an invalid NPI will fail with a generic error.\nAC:\n\nValidate the NPI on the admin org creation form\nAllow the NPI to begin with a number other than 1 or 2\n\nProposed Changes\n\nSet up validation for real NPI (for both admin and external user)\nWill throw an error explaining why the organization was not able to update (re: invalid NPI)\n\n\nChange Details\n\nDue to users being able to add/update the org's NPI in their portal, I added the same error message if they tried to add an invalid NPI to the org.\nMoved generate_npi to the OrganizationHelper for a more DRY application between the web app and tests.\n\n\nSecurity Implications\n\n\n new software dependencies\n\n\n\n security controls or supporting software altered\n\n\n\n new data stored or transmitted\n\n\n\n security checklist is completed for this change\n\n\n\n requires more information or team discussion to evaluate security implications\n\n\n\n no PHI/PII is affected by this change\n\n\nAcceptance Validation\n\n\n\n\nFeedback Requested", "createdAt": "2020-11-05T17:21:45Z", "url": "https://github.com/CMSgov/dpc-app/pull/1114", "merged": true, "mergeCommit": {"oid": "95dfc99c664da158e9525577365c3d49fc50ed8f"}, "closed": true, "closedAt": "2020-11-12T16:36:41Z", "author": {"login": "Sun-Mountain"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXom4hAH2gAyNTE2MjE4MzU2OmQ4OTA3YWUzNjk3OGYwODkxNzRhYWEyNGZlYjVjNzk0ZWRkYTE4OTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdb0HmGgFqTUyOTE5MDI0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d8907ae36978f089174aaa24feb5c794edda1890", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/d8907ae36978f089174aaa24feb5c794edda1890", "committedDate": "2020-10-30T15:36:10Z", "message": "NPI validator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9d3e26aaf4b04b511d0470b15363bd3a6137e90", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/e9d3e26aaf4b04b511d0470b15363bd3a6137e90", "committedDate": "2020-10-30T21:23:18Z", "message": "Fix rspec tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44a605a069df3e6a44963d33db632abcb08cf06d", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/44a605a069df3e6a44963d33db632abcb08cf06d", "committedDate": "2020-11-05T16:59:05Z", "message": "Update organization controller for external user dashboard"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "585256ff4f35828e4fb46e16e00fd8e72633e658", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/585256ff4f35828e4fb46e16e00fd8e72633e658", "committedDate": "2020-11-05T17:05:48Z", "message": "Finish tests for valid NPI check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18d9bf04f676aaee621248a5a841558e0ee07f1d", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/18d9bf04f676aaee621248a5a841558e0ee07f1d", "committedDate": "2020-11-05T17:21:56Z", "message": "Merge branch 'master' into nz/dpc-821-npi-check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b66e682f7319311c06a8140c79c21b80e7dc1a8", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/3b66e682f7319311c06a8140c79c21b80e7dc1a8", "committedDate": "2020-11-05T17:24:51Z", "message": "Climate change fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7524f90c4376ee85b243c1c6bfd1fb415c08b186", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/7524f90c4376ee85b243c1c6bfd1fb415c08b186", "committedDate": "2020-11-05T17:24:58Z", "message": "Merge branch 'nz/dpc-821-npi-check' of github.com:CMSgov/dpc-app into nz/dpc-821-npi-check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4da2e393ac5b623409f26b60cebbbfe6cffacf39", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/4da2e393ac5b623409f26b60cebbbfe6cffacf39", "committedDate": "2020-11-10T14:44:39Z", "message": "Merge branch 'master' into nz/dpc-821-npi-check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4MjkxMTI0", "url": "https://github.com/CMSgov/dpc-app/pull/1114#pullrequestreview-528291124", "createdAt": "2020-11-11T15:44:23Z", "commit": {"oid": "4da2e393ac5b623409f26b60cebbbfe6cffacf39"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa1feb3dafdc348a1c7ef445cb6f6d9c30d12710", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/aa1feb3dafdc348a1c7ef445cb6f6d9c30d12710", "committedDate": "2020-11-12T00:23:17Z", "message": "Merge branch 'master' into nz/dpc-821-npi-check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5MTkwMjQ4", "url": "https://github.com/CMSgov/dpc-app/pull/1114#pullrequestreview-529190248", "createdAt": "2020-11-12T15:16:32Z", "commit": {"oid": "aa1feb3dafdc348a1c7ef445cb6f6d9c30d12710"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxNToxNjozM1rOHx_kjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxNToxNjozM1rOHx_kjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjE4MzgyMA==", "bodyText": "Knowledge about NPI's and how we deal with the Luhancy gem is spread soo many places now.  It would be nice to encapsulate it in its own class.", "url": "https://github.com/CMSgov/dpc-app/pull/1114#discussion_r522183820", "createdAt": "2020-11-12T15:16:33Z", "author": {"login": "dhgreene"}, "path": "dpc-web/spec/factories/organizations.rb", "diffHunk": "@@ -17,4 +17,11 @@\n       end\n     end\n   end\n+\n+  def generate_npi", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa1feb3dafdc348a1c7ef445cb6f6d9c30d12710"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 319, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}