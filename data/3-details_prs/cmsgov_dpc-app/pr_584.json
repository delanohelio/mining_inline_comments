{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwODYwNDAz", "number": 584, "title": "DPC-1016: Data migration to populate fhir_endpoints.registered_organization_id", "bodyText": "Why\nIn DPC-954 we refactored the relationships between FhirEndpoint and\nOrganization and RegisteredOrganization. Now, fhir_endpoints are associated with an organization's registered_organization record directly. This data migration updates\nthe existing data to match the new structure.\nWhat Changed\nData migration that should be run once to update the data in the rails app to associate existing fhir endpoints with their organization's registered organization. This will be run automatically on deploy as part of rails db:migrate. Tested locally.\nChoices Made\nThis is a small, low-cost, one-time data change, so we decided to do this is a migration in the rails db. There are less than 100 records that need to change.\nTickets closed:\nDPC-1016\nFuture Work\nDPC-1017\nChecklist\n\n All tests are passing via make ci-app (app change) and make ci-web (website change)\n Swagger documentation has been updated\n FHIR documentation has been updated\n Any required dpc-ops changes have a PR submitted and mentioned in this ticket\n Any manual migration steps are documented, scripts written (where applicable), and tested\n Before merging, any required dpc-ops changes have been approved and merged into master of the dpc-ops repo", "createdAt": "2020-02-04T14:14:44Z", "url": "https://github.com/CMSgov/dpc-app/pull/584", "merged": true, "mergeCommit": {"oid": "f538a1cff0e3dfe2303bb9e61498adf2ace40834"}, "closed": true, "closedAt": "2020-02-04T18:55:55Z", "author": {"login": "switzersc-usds"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBCIZHgH2gAyMzcwODYwNDAzOjE1MmE1NTdjNTlhM2ZiYzFjNWJmOWExMDdlZDg2YTBhMDVhZDcyMjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBCg0mAFqTM1MzAyMjMxNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "152a557c59a3fbc1c5bf9a107ed86a0a05ad7228", "author": {"user": null}, "url": "https://github.com/CMSgov/dpc-app/commit/152a557c59a3fbc1c5bf9a107ed86a0a05ad7228", "committedDate": "2020-02-04T14:08:59Z", "message": "Data migration for Fhir Endpoints\n\nIn DPC-954 we refactored the relationships between FhirEndpoint and\nOrganization and RegisteredOrganization. This data migration updates\nthe existing data to match the new structure and be valid."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb7b47cbefaa1b2a6ca4d1405fbe6df59105e7f0", "author": {"user": null}, "url": "https://github.com/CMSgov/dpc-app/commit/cb7b47cbefaa1b2a6ca4d1405fbe6df59105e7f0", "committedDate": "2020-02-04T14:17:56Z", "message": "Skip fhir endpoints if they were created after refactor deploy"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMDIwOTAx", "url": "https://github.com/CMSgov/dpc-app/pull/584#pullrequestreview-353020901", "createdAt": "2020-02-04T14:33:50Z", "commit": {"oid": "cb7b47cbefaa1b2a6ca4d1405fbe6df59105e7f0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMDIyMzE2", "url": "https://github.com/CMSgov/dpc-app/pull/584#pullrequestreview-353022316", "createdAt": "2020-02-04T14:35:39Z", "commit": {"oid": "cb7b47cbefaa1b2a6ca4d1405fbe6df59105e7f0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxNDozNTozOVrOFlWOvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxNDozNTozOVrOFlWOvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDcwNTg1NA==", "bodyText": "Method up has a Cognitive Complexity of 10 (exceeds 9 allowed). Consider refactoring.", "url": "https://github.com/CMSgov/dpc-app/pull/584#discussion_r374705854", "createdAt": "2020-02-04T14:35:39Z", "author": {"login": "codeclimate"}, "path": "dpc-web/db/migrate/20200204135210_fhir_endpoint_data_migration.rb", "diffHunk": "@@ -0,0 +1,48 @@\n+class FhirEndpointDataMigration < ActiveRecord::Migration[5.2]\n+  def up", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb7b47cbefaa1b2a6ca4d1405fbe6df59105e7f0"}, "originalPosition": 2}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 238, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}