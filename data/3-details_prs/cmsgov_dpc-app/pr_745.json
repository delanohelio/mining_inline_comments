{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyNjQzMDgy", "number": 745, "title": "DPC-1277: Change external user email to account verification.", "bodyText": "Why\nAs an added security measure, external users now have to verify their email through devise emails. Users who have not verified/confirmed their account will not be able to login.\nWhat Changed\n\nChoices Made\nAdded devise's confirmable functionality, immediately sending the user a verification email.\nAdjusted tests to account for the new confirmed_at requirement as well added a test in the new_user_signs_up_for_account_spec to test that unverified users cannot sign in.\nTickets closed:\nDPC-1277\nFuture Work\nN/A\nChecklist\n\n All tests are passing via make ci-app (app change) and make ci-web (website change)\n Swagger documentation has been updated\n FHIR documentation has been updated\n Any required dpc-ops changes have a PR submitted and mentioned in this ticket\n Any manual migration steps are documented, scripts written (where applicable), and tested\n Before merging, any required dpc-ops changes have been approved and merged into master of the dpc-ops repo", "createdAt": "2020-04-13T13:26:06Z", "url": "https://github.com/CMSgov/dpc-app/pull/745", "merged": true, "mergeCommit": {"oid": "fc63013b3dc0473dbf83716a8b2bd53b10429f2b"}, "closed": true, "closedAt": "2020-04-23T19:05:59Z", "author": {"login": "Sun-Mountain"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcWRNiFgH2gAyNDAyNjQzMDgyOjIxN2I0YzRhM2RlNjA5ZjAxMTAwMzc3MTI1NzM1YTViOGIxY2FiZWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcahGaVgH2gAyNDAyNjQzMDgyOjQ2ODdjMDIwYTczZWE5MTY2NGZmNTg1ZmNiMTIyMDI5OTdkZWFiYjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "217b4c4a3de609f01100377125735a5b8b1cabef", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/217b4c4a3de609f01100377125735a5b8b1cabef", "committedDate": "2020-04-10T13:35:35Z", "message": "Confirmation functionality added."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4912371688f15594901d798ba49ba115bbf7f59b", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/4912371688f15594901d798ba49ba115bbf7f59b", "committedDate": "2020-04-10T14:24:41Z", "message": "Resend confirmation instructions page styling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce6a62af1f8a9ad1a9efa2df1cdcbe2b7b5e325e", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/ce6a62af1f8a9ad1a9efa2df1cdcbe2b7b5e325e", "committedDate": "2020-04-10T15:37:34Z", "message": "Emails all share same layout"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18bfd27a78e1c1b45821127cb97cc87e7e8bcd51", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/18bfd27a78e1c1b45821127cb97cc87e7e8bcd51", "committedDate": "2020-04-10T16:57:13Z", "message": "Email styling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0087a5482cf5e1db1e31c7f78ef08e38a5a25f40", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/0087a5482cf5e1db1e31c7f78ef08e38a5a25f40", "committedDate": "2020-04-10T20:39:47Z", "message": "Tests confirm user account verification"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1af60fbb7703287f300546ceeae59cf5ed7450f", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/a1af60fbb7703287f300546ceeae59cf5ed7450f", "committedDate": "2020-04-13T13:30:00Z", "message": "Code climate fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2591a0e67f0314f7d2ff2c523702da27240a698", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/c2591a0e67f0314f7d2ff2c523702da27240a698", "committedDate": "2020-04-13T13:31:28Z", "message": "Code climate fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NjkzNjQx", "url": "https://github.com/CMSgov/dpc-app/pull/745#pullrequestreview-397693641", "createdAt": "2020-04-21T21:35:48Z", "commit": {"oid": "c2591a0e67f0314f7d2ff2c523702da27240a698"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQyMTozNTo0OVrOGJZgcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQyMTozNTo0OVrOGJZgcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUwODI3Mw==", "bodyText": "I believe that if last_email is not present the test will fail on line 36 unless you add :aggregate_failures", "url": "https://github.com/CMSgov/dpc-app/pull/745#discussion_r412508273", "createdAt": "2020-04-21T21:35:49Z", "author": {"login": "SMLuthi"}, "path": "dpc-web/spec/features/registration/new_user_signs_up_for_account_spec.rb", "diffHunk": "@@ -24,15 +26,30 @@\n       select 'New York', from: :user_state\n       fill_in :user_zip, with: '10033'\n       check :user_agree_to_terms\n-\n+  \n       click_on('Sign up')\n+    end\n+\n+    scenario 'user is sent a confirmation email with confirmation token' do\n+      :confirmation_token.should_not be_nil\n+\n+      ctoken = last_email.body.match(/confirmation_token=\\w*/)\n+\n+      expect(last_email).to be_present", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2591a0e67f0314f7d2ff2c523702da27240a698"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ed258d968e240d4efe72c18a24cb474aa3600f5", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/0ed258d968e240d4efe72c18a24cb474aa3600f5", "committedDate": "2020-04-23T14:21:05Z", "message": "Added aggregate_failures to spec"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da51e70adcdd045013c90c5dc100eb8666d8d6b9", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/da51e70adcdd045013c90c5dc100eb8666d8d6b9", "committedDate": "2020-04-23T17:30:14Z", "message": "Removed check for last_email"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5MzI0MDkw", "url": "https://github.com/CMSgov/dpc-app/pull/745#pullrequestreview-399324090", "createdAt": "2020-04-23T17:32:19Z", "commit": {"oid": "da51e70adcdd045013c90c5dc100eb8666d8d6b9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5MzM0OTUy", "url": "https://github.com/CMSgov/dpc-app/pull/745#pullrequestreview-399334952", "createdAt": "2020-04-23T17:46:16Z", "commit": {"oid": "da51e70adcdd045013c90c5dc100eb8666d8d6b9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4aaf85ad401af97de88e809902f16df94378706", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/d4aaf85ad401af97de88e809902f16df94378706", "committedDate": "2020-04-23T17:46:46Z", "message": "Merge branch 'master' into nzonnenberg/dpc-1277-email-verification"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4687c020a73ea91664ff585fcb12202997deabb0", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/4687c020a73ea91664ff585fcb12202997deabb0", "committedDate": "2020-04-23T18:21:59Z", "message": "Merge branch 'master' into nzonnenberg/dpc-1277-email-verification"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 92, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}