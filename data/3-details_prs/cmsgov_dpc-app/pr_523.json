{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5NjgyMjE5", "number": 523, "title": "DPC-926: Updated Backend Services to POST form params", "bodyText": "Why\nOne of the Google Group uses reported that they were unable to generate access tokens from the Token/auth endpoint. The issue was that their query params were being stripped and never making it to our endpoint. I'm not sure why their library wasn't working, but it revealed a poor implementation of the Backend Services spec where we should have been receiving the auth values as url encoded form params, in the post body, rather than as query params.\nThis will be a breaking change for our users, but hopefully a simple one.\nWhat Changed\nUpdated authentication implementation to move from requiring query params to requiring encoded form params in the body. This actually matches the backend services spec, our previous implementation was incorrect.\nAll of our code and helper scripts have been updated to account for this. This WILL be a breaking change for users, but it should also fix some of the issues that have been reported.\nChoices Made\nTickets closed:\nDPC-926\nFuture Work\nChecklist\n\n All tests are passing via make ci-app (app change) and make ci-web (website change)\n Swagger documentation has been updated\n FHIR documentation has been updated\n Any required dpc-ops changes have a PR submitted and mentioned in this ticket\n Any manual migration steps are documented, scripts written (where applicable), and tested\n Before merging, any required dpc-ops changes have been approved and merged into master of the dpc-ops repo", "createdAt": "2020-01-06T19:37:08Z", "url": "https://github.com/CMSgov/dpc-app/pull/523", "merged": true, "mergeCommit": {"oid": "f7ce6e60f2895a070c9fb60eaeb4d003b3a17456"}, "closed": true, "closedAt": "2020-01-17T21:54:46Z", "author": {"login": "nickrobison-usds"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb3xb3egH2gAyMzU5NjgyMjE5OjZhOGEzMmRmNTAwNzlhZmNjNzA2NmY3ZTU5NjdmZWVkZWE0OTU1YzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb7VWZkAH2gAyMzU5NjgyMjE5OmMwZTQwOWZlOTA3MDdjMDRmOWRlNDg4OGU4ZmI2Y2M2MWQwMmY0ODY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6a8a32df50079afcc7066f7e5967feedea4955c3", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/6a8a32df50079afcc7066f7e5967feedea4955c3", "committedDate": "2020-01-06T19:36:33Z", "message": "DPC-926: Updated Backend Services to post form params\n\nUpdated authentication implementation to move from requiring query params to requiring encoded Form params in the body."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41099d577c056f93ae91d2c6bd910cf6eeae7fb0", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/41099d577c056f93ae91d2c6bd910cf6eeae7fb0", "committedDate": "2020-01-06T21:09:22Z", "message": "Merge branch 'master' into nickrobison/DPC-926-token-query-params"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d542ed72af7a35ea534e637e576f7721c002550", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/3d542ed72af7a35ea534e637e576f7721c002550", "committedDate": "2020-01-06T21:12:58Z", "message": "DPC-926: Update documentation to detail access token request using form params."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "3d542ed72af7a35ea534e637e576f7721c002550", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/3d542ed72af7a35ea534e637e576f7721c002550", "committedDate": "2020-01-06T21:12:58Z", "message": "DPC-926: Update documentation to detail access token request using form params."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "3d542ed72af7a35ea534e637e576f7721c002550", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/3d542ed72af7a35ea534e637e576f7721c002550", "committedDate": "2020-01-06T21:12:58Z", "message": "DPC-926: Update documentation to detail access token request using form params."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5fb27719f08b9f9bc1675d29455c8877d9d360d8", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/5fb27719f08b9f9bc1675d29455c8877d9d360d8", "committedDate": "2020-01-14T16:18:11Z", "message": "Merge branch 'master' into nickrobison/DPC-926-token-query-params"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75e206762a2a50131d26790c91de5ff9a4bfbebf", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/75e206762a2a50131d26790c91de5ff9a4bfbebf", "committedDate": "2020-01-14T16:53:38Z", "message": "DPC-926: Remove unused token logging filter\n\nNow that we're not longer submitting secrets via query params, we don't need to suppress them from the logs."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d5e85b8072eca8f5ef9003d145fd1426202b328", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/8d5e85b8072eca8f5ef9003d145fd1426202b328", "committedDate": "2020-01-14T16:54:48Z", "message": "DPC-760: Update dev environment to point to public facing DNS\n\nWe can now use our public facing DNS name, rather than the internal ALB."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzOTQ4MzI1", "url": "https://github.com/CMSgov/dpc-app/pull/523#pullrequestreview-343948325", "createdAt": "2020-01-16T14:24:50Z", "commit": {"oid": "8d5e85b8072eca8f5ef9003d145fd1426202b328"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxNDoyNDo1MFrOFebDaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxNDoyNDo1MFrOFebDaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQ0NDg0MA==", "bodyText": "Would BasicNameValuePair serve the same purpose? https://hc.apache.org/httpcomponents-core-4.4.x/httpcore/apidocs/org/apache/http/message/BasicNameValuePair.html", "url": "https://github.com/CMSgov/dpc-app/pull/523#discussion_r367444840", "createdAt": "2020-01-16T14:24:50Z", "author": {"login": "em1"}, "path": "dpc-testing/src/main/java/gov/cms/dpc/testing/APIAuthHelpers.java", "diffHunk": "@@ -132,6 +144,21 @@ public static AuthResponse jwtAuthFlow(String baseURL, String macaroon, UUID key\n         return authResponse;\n     }\n \n+    private static NameValuePair encodeNameValuePair(String name, String value) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d5e85b8072eca8f5ef9003d145fd1426202b328"}, "originalPosition": 45}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f382c0bede996fbd2f167df607977579a55c220", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/0f382c0bede996fbd2f167df607977579a55c220", "committedDate": "2020-01-16T14:43:01Z", "message": "DPC-926: Remove custom name value pair logic\n\nTurns out, there's already an existing class that does the name value encoding for us.\nNo need for my hacky mess."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ffbffe09e3a5393ed80fe3b2c6ef029c0b98a65", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/4ffbffe09e3a5393ed80fe3b2c6ef029c0b98a65", "committedDate": "2020-01-16T14:43:15Z", "message": "Merge branch 'master' into nickrobison/DPC-926-token-query-params"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzOTY3MTMy", "url": "https://github.com/CMSgov/dpc-app/pull/523#pullrequestreview-343967132", "createdAt": "2020-01-16T14:49:26Z", "commit": {"oid": "4ffbffe09e3a5393ed80fe3b2c6ef029c0b98a65"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxNDo0OToyNlrOFeb8Eg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxNDo0OToyNlrOFeb8Eg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQ1OTM0Ng==", "bodyText": "With the HttpPost entity being the form data, are parameters still needed on the URL?", "url": "https://github.com/CMSgov/dpc-app/pull/523#discussion_r367459346", "createdAt": "2020-01-16T14:49:26Z", "author": {"login": "em1"}, "path": "dpc-testing/src/main/java/gov/cms/dpc/testing/APIAuthHelpers.java", "diffHunk": "@@ -120,6 +132,7 @@ public static AuthResponse jwtAuthFlow(String baseURL, String macaroon, UUID key\n             builder.addParameter(\"client_assertion_type\", CLIENT_ASSERTION_TYPE);\n             builder.addParameter(\"client_assertion\", jwt);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ffbffe09e3a5393ed80fe3b2c6ef029c0b98a65"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzOTcwMDM1", "url": "https://github.com/CMSgov/dpc-app/pull/523#pullrequestreview-343970035", "createdAt": "2020-01-16T14:53:09Z", "commit": {"oid": "4ffbffe09e3a5393ed80fe3b2c6ef029c0b98a65"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxNDo1MzowOVrOFecEfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxNDo1MzowOVrOFecEfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQ2MTUwMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @DisplayName(\"Query Param tests\")\n          \n          \n            \n                @DisplayName(\"Form Param tests\")", "url": "https://github.com/CMSgov/dpc-app/pull/523#discussion_r367461503", "createdAt": "2020-01-16T14:53:09Z", "author": {"login": "em1"}, "path": "dpc-api/src/test/java/gov/cms/dpc/api/auth/jwt/JWTUnitTests.java", "diffHunk": "@@ -68,50 +70,51 @@ private JWTUnitTests() {\n \n     @Nested\n     @DisplayName(\"Query Param tests\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ffbffe09e3a5393ed80fe3b2c6ef029c0b98a65"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cab65d41f40b69f1929f30076f1337a2cc827da8", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/cab65d41f40b69f1929f30076f1337a2cc827da8", "committedDate": "2020-01-17T15:16:13Z", "message": "DPC-926: Code review cleanups"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d6654e73aa440fcd6d35192957a72a6f8562d87", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/4d6654e73aa440fcd6d35192957a72a6f8562d87", "committedDate": "2020-01-17T15:17:01Z", "message": "Merge branch 'master' into nickrobison/DPC-926-token-query-params"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d847c86a6a02a00d9656a83cd36f1281101b2ff9", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/d847c86a6a02a00d9656a83cd36f1281101b2ff9", "committedDate": "2020-01-17T15:17:46Z", "message": "Merge branch 'nickrobison/DPC-926-token-query-params' of https://github.com/CMSgov/dpc-app into nickrobison/DPC-926-token-query-params"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0NzM2ODQ4", "url": "https://github.com/CMSgov/dpc-app/pull/523#pullrequestreview-344736848", "createdAt": "2020-01-17T17:40:28Z", "commit": {"oid": "d847c86a6a02a00d9656a83cd36f1281101b2ff9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9a3483c5cefc8607d173527cbf5165fba9c052c", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/b9a3483c5cefc8607d173527cbf5165fba9c052c", "committedDate": "2020-01-17T19:17:36Z", "message": "Merge branch 'master' into nickrobison/DPC-926-token-query-params"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0e409fe90707c04f9de4888e8fb6cc61d02f486", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/c0e409fe90707c04f9de4888e8fb6cc61d02f486", "committedDate": "2020-01-17T21:08:56Z", "message": "Merge branch 'master' into nickrobison/DPC-926-token-query-params"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 279, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}