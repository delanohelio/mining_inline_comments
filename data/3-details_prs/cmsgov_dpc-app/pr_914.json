{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUxMTQ1OTE3", "number": 914, "title": "DPC-318 & 520: disable an API env for an organization but not delete all their data from the API.", "bodyText": "Fixes DPC-318 & DPC-520\nIf an intern user \"disables\" an organization, it deletes the organization in the API and loses all client tokens and public keys associated with the organization in the API.\nProposed Changes\n\nRemove delete function to API, so even if the user deletes the organization on the rails app, the information is still in the API.\nAfter the initial creation of the organization in the API, clicking disable and enable hides the views and prevents external users from adding public keys and client tokens through the web app.\n\nChange Details\nSecurity Implications\n\n\n new software dependencies\n\n\n\n security controls or supporting software altered\n\n\n\n new data stored or transmitted\n\n\n\n security checklist is completed for this change\n\n\n\n requires more information or team discussion to evaluate security implications\n\n\n\n no PHI/PII is affected by this change\n\n\nAcceptance Validation\n\n\n\n\nFeedback Requested", "createdAt": "2020-07-17T14:01:38Z", "url": "https://github.com/CMSgov/dpc-app/pull/914", "merged": true, "mergeCommit": {"oid": "2b263e4103641295022ace1f4364829d517a58ef"}, "closed": true, "closedAt": "2020-07-21T13:47:57Z", "author": {"login": "Sun-Mountain"}, "timelineItems": {"totalCount": 31, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczRisXAH2gAyNDUxMTQ1OTE3OjQ0M2Q5MzNkYWIzZTc0YjkzZWM5NGM4OGZhMmE4ODVhZjQ0Njk4OTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3GKsvAH2gAyNDUxMTQ1OTE3OmU0ZmViMTcwYjA2ZGNiNDk1NmFhMTMyYjhkZmZmNDEyNmI1ZjJmMWY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "443d933dab3e74b93ec94c88fa2a885af4469894", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/443d933dab3e74b93ec94c88fa2a885af4469894", "committedDate": "2020-07-09T16:22:30Z", "message": "Init"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a41c81e4b184b8bc8a20b8ae98ec44698748f19", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/0a41c81e4b184b8bc8a20b8ae98ec44698748f19", "committedDate": "2020-07-09T16:43:15Z", "message": "Removed sandbox_id methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce25229d59128c7babf1ecfedbfef940978a95fa", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/ce25229d59128c7babf1ecfedbfef940978a95fa", "committedDate": "2020-07-09T16:43:32Z", "message": "rake tasks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9cad794b7aa4f6272598785e7f2482297ef68cb4", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/9cad794b7aa4f6272598785e7f2482297ef68cb4", "committedDate": "2020-07-09T16:57:47Z", "message": "Remove external identifier from spec tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ec33a36a5e6cd1590821a098a8aa330b94d5200", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/9ec33a36a5e6cd1590821a098a8aa330b94d5200", "committedDate": "2020-07-09T17:44:32Z", "message": "spec test fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0c0c17da6748c78edd03634990df22e5aff042a", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/f0c0c17da6748c78edd03634990df22e5aff042a", "committedDate": "2020-07-09T18:01:34Z", "message": "spec tests fixed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d81068f48a8ea73ed871422a4228b9a2a398ae20", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/d81068f48a8ea73ed871422a4228b9a2a398ae20", "committedDate": "2020-07-09T18:16:03Z", "message": "remove sandbox_id column"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32d482d2819c20a3da2a7fe33dc418da0aef0eb0", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/32d482d2819c20a3da2a7fe33dc418da0aef0eb0", "committedDate": "2020-07-16T12:35:49Z", "message": "Enable and disable functionality added\n\nEnabled column added to registered organization table\nenable_or_disable route added"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5fdb5585c74dd7496b7a238e0759cbf199151d94", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/5fdb5585c74dd7496b7a238e0759cbf199151d94", "committedDate": "2020-07-16T14:05:34Z", "message": "Update views"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de0720560210849f053424415f612001a4e7e117", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/de0720560210849f053424415f612001a4e7e117", "committedDate": "2020-07-16T14:07:23Z", "message": "remove delete org in api function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b8d70a7893c257826428c3e79d6d38798425234", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/0b8d70a7893c257826428c3e79d6d38798425234", "committedDate": "2020-07-16T17:35:51Z", "message": "Remove delete api organization tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5010cc25adaf06b173ee3ee53ba73226e6de2c67", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/5010cc25adaf06b173ee3ee53ba73226e6de2c67", "committedDate": "2020-07-16T17:36:33Z", "message": "merge branch dpc 505"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a64d0deee2d1a14e45d6e0ab54557b496a4cac0", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/1a64d0deee2d1a14e45d6e0ab54557b496a4cac0", "committedDate": "2020-07-16T17:37:32Z", "message": "schema"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0813e41e7f5a814c945c0d757cd3b9654b182ec1", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/0813e41e7f5a814c945c0d757cd3b9654b182ec1", "committedDate": "2020-07-16T18:56:28Z", "message": "Spec progress"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8eb4aca492eab378ab626fb2b9777f8d9c10fd9", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/a8eb4aca492eab378ab626fb2b9777f8d9c10fd9", "committedDate": "2020-07-16T20:40:45Z", "message": "Tests finished"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwNjgzOTk5", "url": "https://github.com/CMSgov/dpc-app/pull/914#pullrequestreview-450683999", "createdAt": "2020-07-17T14:02:49Z", "commit": {"oid": "a8eb4aca492eab378ab626fb2b9777f8d9c10fd9"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNDowMjo1MFrOGzUQhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNDowMjo1MFrOGzUQlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ2MjQ2OQ==", "bodyText": "Line is too long. [131/120]", "url": "https://github.com/CMSgov/dpc-app/pull/914#discussion_r456462469", "createdAt": "2020-07-17T14:02:50Z", "author": {"login": "codeclimate"}, "path": "dpc-web/app/models/organization.rb", "diffHunk": "@@ -25,9 +25,9 @@ class Organization < ApplicationRecord\n \n   scope :provider, -> { where.not(organization_type: ORGANIZATION_TYPES['health_it_vendor']) }\n \n-  scope :is_registered, -> { where('id IN(SELECT DISTINCT(organization_id) FROM registered_organizations)') }\n+  scope :is_registered, -> { where('id IN(SELECT DISTINCT(organization_id) FROM registered_organizations WHERE enabled IS true)') }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8eb4aca492eab378ab626fb2b9777f8d9c10fd9"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ2MjQ3Mw==", "bodyText": "Line is too long. [139/120]", "url": "https://github.com/CMSgov/dpc-app/pull/914#discussion_r456462473", "createdAt": "2020-07-17T14:02:50Z", "author": {"login": "codeclimate"}, "path": "dpc-web/app/models/organization.rb", "diffHunk": "@@ -25,9 +25,9 @@ class Organization < ApplicationRecord\n \n   scope :provider, -> { where.not(organization_type: ORGANIZATION_TYPES['health_it_vendor']) }\n \n-  scope :is_registered, -> { where('id IN(SELECT DISTINCT(organization_id) FROM registered_organizations)') }\n+  scope :is_registered, -> { where('id IN(SELECT DISTINCT(organization_id) FROM registered_organizations WHERE enabled IS true)') }\n \n-  scope :is_not_registered, -> { where('id NOT IN(SELECT DISTINCT(organization_id) FROM registered_organizations)') }\n+  scope :is_not_registered, -> { where('id IN(SELECT DISTINCT(organization_id) FROM registered_organizations WHERE enabled IS NOT true)') }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8eb4aca492eab378ab626fb2b9777f8d9c10fd9"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ2MjQ3OQ==", "bodyText": "Inconsistent indentation detected.", "url": "https://github.com/CMSgov/dpc-app/pull/914#discussion_r456462479", "createdAt": "2020-07-17T14:02:50Z", "author": {"login": "codeclimate"}, "path": "dpc-web/app/controllers/internal/registered_organizations_controller.rb", "diffHunk": "@@ -60,6 +61,25 @@ def destroy\n       redirect_to internal_organization_path(@organization)\n     end\n \n+    def enable_or_disable\n+      @organization = Organization.find(org_id_param)\n+      @reg_org = @organization.registered_organization\n+\n+      if @reg_org.enabled == true\n+        @reg_org.enabled = false\n+        @reg_org.save\n+\n+        flash[:notice] = 'API access disabled.'\n+        redirect_to internal_organization_path(@organization)\n+      else @reg_org.enabled == false\n+        @reg_org.enabled = true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8eb4aca492eab378ab626fb2b9777f8d9c10fd9"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ2MjQ4Mg==", "bodyText": "Inconsistent indentation detected.", "url": "https://github.com/CMSgov/dpc-app/pull/914#discussion_r456462482", "createdAt": "2020-07-17T14:02:50Z", "author": {"login": "codeclimate"}, "path": "dpc-web/app/controllers/internal/registered_organizations_controller.rb", "diffHunk": "@@ -60,6 +61,25 @@ def destroy\n       redirect_to internal_organization_path(@organization)\n     end\n \n+    def enable_or_disable\n+      @organization = Organization.find(org_id_param)\n+      @reg_org = @organization.registered_organization\n+\n+      if @reg_org.enabled == true\n+        @reg_org.enabled = false\n+        @reg_org.save\n+\n+        flash[:notice] = 'API access disabled.'\n+        redirect_to internal_organization_path(@organization)\n+      else @reg_org.enabled == false\n+        @reg_org.enabled = true\n+        @reg_org.save", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8eb4aca492eab378ab626fb2b9777f8d9c10fd9"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ2MjQ4Nw==", "bodyText": "Inconsistent indentation detected.", "url": "https://github.com/CMSgov/dpc-app/pull/914#discussion_r456462487", "createdAt": "2020-07-17T14:02:50Z", "author": {"login": "codeclimate"}, "path": "dpc-web/app/controllers/internal/registered_organizations_controller.rb", "diffHunk": "@@ -60,6 +61,25 @@ def destroy\n       redirect_to internal_organization_path(@organization)\n     end\n \n+    def enable_or_disable\n+      @organization = Organization.find(org_id_param)\n+      @reg_org = @organization.registered_organization\n+\n+      if @reg_org.enabled == true\n+        @reg_org.enabled = false\n+        @reg_org.save\n+\n+        flash[:notice] = 'API access disabled.'\n+        redirect_to internal_organization_path(@organization)\n+      else @reg_org.enabled == false\n+        @reg_org.enabled = true\n+        @reg_org.save\n+\n+        flash[:notice] = 'API access enabled.'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8eb4aca492eab378ab626fb2b9777f8d9c10fd9"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab5e246baf2474be29d35398d9b0cd522d020bca", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/ab5e246baf2474be29d35398d9b0cd522d020bca", "committedDate": "2020-07-17T14:04:33Z", "message": "Remove API columns from organization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2211abcbd1abfdeec944564f6842b535570efcff", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/2211abcbd1abfdeec944564f6842b535570efcff", "committedDate": "2020-07-17T14:05:42Z", "message": "Merge branch 'master' into nicole/dpc-318-enable-disable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c2a5b95552e676cee19119e73934e479921ae43", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/1c2a5b95552e676cee19119e73934e479921ae43", "committedDate": "2020-07-17T14:26:24Z", "message": "Code climate fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f844f46c54a3772592176103b014a05e8aef75b7", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/f844f46c54a3772592176103b014a05e8aef75b7", "committedDate": "2020-07-17T14:26:32Z", "message": "Merge branch 'nicole/dpc-318-enable-disable' of github.com:CMSgov/dpc-app into nicole/dpc-318-enable-disable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c22460ff5b712a0aea7333ff4adb4fccc9e8a53", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/7c22460ff5b712a0aea7333ff4adb4fccc9e8a53", "committedDate": "2020-07-17T14:29:55Z", "message": "Fix org controller code climate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0f4588c734e4821d066419bca2dfbd787dec8fc", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/a0f4588c734e4821d066419bca2dfbd787dec8fc", "committedDate": "2020-07-17T19:29:55Z", "message": "External users cannot add public keys/create client tokens unless org enabled"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72be31dcda1a09da24afa199fb0cc7403ca99d37", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/72be31dcda1a09da24afa199fb0cc7403ca99d37", "committedDate": "2020-07-20T12:12:17Z", "message": "Merge branch 'master' into nicole/dpc-318-enable-disable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1d73dd0e44044eefc1043b595c05ddb44cc76ae", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/b1d73dd0e44044eefc1043b595c05ddb44cc76ae", "committedDate": "2020-07-20T13:48:58Z", "message": "remove migration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd4476a3c9a9fe22074965b178f549122915d404", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/cd4476a3c9a9fe22074965b178f549122915d404", "committedDate": "2020-07-20T17:27:40Z", "message": "Update migration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3438465cd233c193cb877987a539e70d314ded99", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/3438465cd233c193cb877987a539e70d314ded99", "committedDate": "2020-07-20T17:49:42Z", "message": "Migration update: default enabled to true"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "957f73992f3c09557218ee3311c0455450198d59", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/957f73992f3c09557218ee3311c0455450198d59", "committedDate": "2020-07-20T19:48:16Z", "message": "Registered Enabled update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40f24197b7c880337dacbcea798a4973d07da16c", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/40f24197b7c880337dacbcea798a4973d07da16c", "committedDate": "2020-07-20T19:51:38Z", "message": "Final migration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "945b4941d6a711553967aa9ccfaf971198b7456f", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/945b4941d6a711553967aa9ccfaf971198b7456f", "committedDate": "2020-07-20T20:51:35Z", "message": "Final final migration"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNDQ0MTU3", "url": "https://github.com/CMSgov/dpc-app/pull/914#pullrequestreview-452444157", "createdAt": "2020-07-21T13:17:53Z", "commit": {"oid": "945b4941d6a711553967aa9ccfaf971198b7456f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4feb170b06dcb4956aa132b8dfff4126b5f2f1f", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/e4feb170b06dcb4956aa132b8dfff4126b5f2f1f", "committedDate": "2020-07-21T13:23:02Z", "message": "Merge branch 'master' into nicole/dpc-318-enable-disable"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 415, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}