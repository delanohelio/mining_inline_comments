{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg2NjQ1Mjky", "number": 1041, "title": "DPC-19: Fix error to save updated registered org if missing required field", "bodyText": "Fixes DPC-19\nIf the internal user attempts to edit a registered organization and deletes a required field (i.e. the NPI) return an error and render the edit page again.\n\nProposed Changes\n\nAdd check in organization controller to see if npi.nil? if trying to enable org.\n\nResponds with appropriate error for user\n\n\nAdd check in registered organization controller to see if enabled and npi.nil? to not update the organization or registered organization\nTests for these functions\n\n\nChange Details\n\nSecurity Implications\n\n\n new software dependencies\n\n\n\n security controls or supporting software altered\n\n\n\n new data stored or transmitted\n\n\n\n security checklist is completed for this change\n\n\n\n requires more information or team discussion to evaluate security implications\n\n\n\n no PHI/PII is affected by this change\n\n\nAcceptance Validation\n\n\n\nFeedback Requested", "createdAt": "2020-09-14T14:05:56Z", "url": "https://github.com/CMSgov/dpc-app/pull/1041", "merged": true, "mergeCommit": {"oid": "01d8df819461c57bdb9a9fb16c2a30fc6b6175c3"}, "closed": true, "closedAt": "2020-09-16T19:42:17Z", "author": {"login": "Sun-Mountain"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdH1P1RAH2gAyNDg2NjQ1MjkyOjI4MWJkNWM4NDFmNTZjYWEzOTlhNTQyYzUzOWRlYzA5YjFkNGZkMTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJdOzPAH2gAyNDg2NjQ1MjkyOjZjYTJiOTRmZDMwMzgzYjUxMWU0NzRjYzdhYjVjMGZhZDM1MDViMWE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "281bd5c841f56caa399a542c539dec09b1d4fd12", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/281bd5c841f56caa399a542c539dec09b1d4fd12", "committedDate": "2020-09-11T13:16:58Z", "message": "Init"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae7933c7b8c9ed6af3ef798f7b2c64fccc53a324", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/ae7933c7b8c9ed6af3ef798f7b2c64fccc53a324", "committedDate": "2020-09-11T20:07:09Z", "message": "NPI required to save organization information"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad7d3a2ef0b2b9dab1f30cf73048c1bb448cf036", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/ad7d3a2ef0b2b9dab1f30cf73048c1bb448cf036", "committedDate": "2020-09-14T14:05:26Z", "message": "Test progress"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38edcc0f762d090fe9a21d206bf0603b2ad5b733", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/38edcc0f762d090fe9a21d206bf0603b2ad5b733", "committedDate": "2020-09-14T14:45:56Z", "message": "Test for enabled org NPI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f712a0736a157b5cd2627fe5ed1a82b4c92962e", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/9f712a0736a157b5cd2627fe5ed1a82b4c92962e", "committedDate": "2020-09-14T14:50:23Z", "message": "Refactor enable_or_disable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d3e09bf87e36ccdeb003462a3627fc4e3539d39", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/5d3e09bf87e36ccdeb003462a3627fc4e3539d39", "committedDate": "2020-09-14T14:55:48Z", "message": "Test fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "806cf20bff2629237e5f58d36747682fe948323a", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/806cf20bff2629237e5f58d36747682fe948323a", "committedDate": "2020-09-14T14:57:34Z", "message": "Move page_redirect out of conditional"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c60e4f2677d5fbfcfad43ab2ea40762f632c18c6", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/c60e4f2677d5fbfcfad43ab2ea40762f632c18c6", "committedDate": "2020-09-14T15:12:06Z", "message": "Merge branch 'master' into nz/dpc-19-reg-org-req-fields"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f53ae7d7a54f12ba24006b07dbe17239c778829", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/3f53ae7d7a54f12ba24006b07dbe17239c778829", "committedDate": "2020-09-14T16:30:08Z", "message": "Merge branch 'master' into nz/dpc-19-reg-org-req-fields"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87b2175c118650429f19d991875c11db280de42f", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/87b2175c118650429f19d991875c11db280de42f", "committedDate": "2020-09-14T18:33:47Z", "message": "Merge branch 'master' into nz/dpc-19-reg-org-req-fields"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfb5b76f76b26848f4009917702d2cec2de07d2b", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/dfb5b76f76b26848f4009917702d2cec2de07d2b", "committedDate": "2020-09-15T18:39:50Z", "message": "Merge branch 'master' into nz/dpc-19-reg-org-req-fields"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MDQ5OTM4", "url": "https://github.com/CMSgov/dpc-app/pull/1041#pullrequestreview-489049938", "createdAt": "2020-09-15T20:35:07Z", "commit": {"oid": "dfb5b76f76b26848f4009917702d2cec2de07d2b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMDozNTowN1rOHSTkYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMDozNTowN1rOHSTkYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk1NzAyNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    flash[:alert] = 'Enabled organization require an NPI.'\n          \n          \n            \n                    flash[:alert] = 'Enabled organizations require an NPI.'", "url": "https://github.com/CMSgov/dpc-app/pull/1041#discussion_r488957027", "createdAt": "2020-09-15T20:35:07Z", "author": {"login": "dhgreene"}, "path": "dpc-web/app/controllers/internal/organizations_controller.rb", "diffHunk": "@@ -65,7 +65,10 @@ def edit\n     def update\n       @organization = Organization.find id_param\n \n-      if @organization.update organization_params\n+      if organization_enabled?(@organization) && npi_blank?\n+        flash[:alert] = 'Enabled organization require an NPI.'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfb5b76f76b26848f4009917702d2cec2de07d2b"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MDU3ODgw", "url": "https://github.com/CMSgov/dpc-app/pull/1041#pullrequestreview-489057880", "createdAt": "2020-09-15T20:47:00Z", "commit": {"oid": "dfb5b76f76b26848f4009917702d2cec2de07d2b"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMDo0NzowMFrOHST8mw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMDo0NzowMFrOHST8mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk2MzIyNw==", "bodyText": "This works, but I wonder if you could use rails require to enforce the parameter.\n    def organization_params\n      params.require(:organization).permit(\n        :name, :organization_type, :num_providers, :npi, :vendor,\n        address_attributes: %i[id street street_2 city state zip address_use address_type]\n      ).tap do |org_params|\n        org_params.require(:npi)\n      end\n    end\n\nThat may just force an error automatically", "url": "https://github.com/CMSgov/dpc-app/pull/1041#discussion_r488963227", "createdAt": "2020-09-15T20:47:00Z", "author": {"login": "SMLuthi"}, "path": "dpc-web/app/controllers/internal/organizations_controller.rb", "diffHunk": "@@ -119,6 +122,16 @@ def delete_user_from_org\n       end\n     end\n \n+    def npi_blank?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfb5b76f76b26848f4009917702d2cec2de07d2b"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50232888947d90aba1e034c47b161da17b7f8a0b", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/50232888947d90aba1e034c47b161da17b7f8a0b", "committedDate": "2020-09-16T12:04:42Z", "message": "Update dpc-web/app/controllers/internal/organizations_controller.rb\n\nCo-authored-by: dhgreene <dhgreene@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e06e53216e45d91669a09bc16dfc31915f6019dc", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/e06e53216e45d91669a09bc16dfc31915f6019dc", "committedDate": "2020-09-16T12:51:45Z", "message": "Merge branch 'master' into nz/dpc-19-reg-org-req-fields"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NjM1NTMy", "url": "https://github.com/CMSgov/dpc-app/pull/1041#pullrequestreview-489635532", "createdAt": "2020-09-16T13:39:37Z", "commit": {"oid": "e06e53216e45d91669a09bc16dfc31915f6019dc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e30ff11e8cb86c6da337c9f6b910d061bc6a677d", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/e30ff11e8cb86c6da337c9f6b910d061bc6a677d", "committedDate": "2020-09-16T14:07:51Z", "message": "Merge branch 'master' into nz/dpc-19-reg-org-req-fields"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ca2b94fd30383b511e474cc7ab5c0fad3505b1a", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/6ca2b94fd30383b511e474cc7ab5c0fad3505b1a", "committedDate": "2020-09-16T14:25:58Z", "message": "Merge branch 'master' into nz/dpc-19-reg-org-req-fields"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 379, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}