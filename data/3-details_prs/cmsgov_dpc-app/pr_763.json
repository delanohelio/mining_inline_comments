{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3MzE4MTY3", "number": 763, "title": "DPC-1282 organization id validation", "bodyText": "Why\nOrganization Ids that are NPI need to conform to the NPI format (luhn formula)\nWhat Changed\nAdded a validator that checks if the id is an NPI then validate it follows the luhn formula\nChoices Made\nUsed a hibernate validator and luhn function provided by a library instead of rolling my own because it is most likely better tested.\nTickets closed:\nhttps://jiraent.cms.gov/browse/DPC-1282\nFuture Work\nList any additional tickets that have either been created due to work in this PR, or existing tickets that expand upon the feature or provide additional fixes.\nChecklist\n\n All tests are passing via make ci-app (app change) and make ci-web (website change)\n Swagger documentation has been updated\n FHIR documentation has been updated\n Any required dpc-ops changes have a PR submitted and mentioned in this ticket\n Any manual migration steps are documented, scripts written (where applicable), and tested\n Before merging, any required dpc-ops changes have been approved and merged into master of the dpc-ops repo", "createdAt": "2020-04-22T14:12:51Z", "url": "https://github.com/CMSgov/dpc-app/pull/763", "merged": true, "mergeCommit": {"oid": "5d5abae1ebd91e0dcd90f00891034efe5c6f239d"}, "closed": true, "closedAt": "2020-05-18T16:30:16Z", "author": {"login": "MrBilnon"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZ98u2AH2gAyNDA3MzE4MTY3OjQzMjhhNjQ1YzMzNTcyYTBhMWMyM2JkNjQ1Y2Q2MmYxY2IyMTM1NmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABciiTnHAFqTQxMzc0NjQ3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4328a645c33572a0a1c23bd645cd62f1cb21356b", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/4328a645c33572a0a1c23bd645cd62f1cb21356b", "committedDate": "2020-04-22T01:24:44Z", "message": "organization id validation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4Mjk0Mzk4", "url": "https://github.com/CMSgov/dpc-app/pull/763#pullrequestreview-398294398", "createdAt": "2020-04-22T15:11:49Z", "commit": {"oid": "4328a645c33572a0a1c23bd645cd62f1cb21356b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNToxMTo0OVrOGJ7xnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNToxMTo0OVrOGJ7xnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzA2OTcyNQ==", "bodyText": "Is there a reasonable length validation (min < identifier.length() < max) for this?", "url": "https://github.com/CMSgov/dpc-app/pull/763#discussion_r413069725", "createdAt": "2020-04-22T15:11:49Z", "author": {"login": "dhgreene"}, "path": "dpc-common/src/main/java/gov/cms/dpc/common/hibernate/validator/OrganizationIdValidator.java", "diffHunk": "@@ -0,0 +1,32 @@\n+package gov.cms.dpc.common.hibernate.validator;\n+\n+import gov.cms.dpc.common.annotations.OrganizationId;\n+import org.apache.commons.lang3.StringUtils;\n+import org.apache.commons.validator.routines.checkdigit.LuhnCheckDigit;\n+\n+import javax.validation.ConstraintValidator;\n+import javax.validation.ConstraintValidatorContext;\n+\n+public class OrganizationIdValidator implements ConstraintValidator<OrganizationId, String> {\n+\n+    public static final String VALIDATION_MESSAGE = \"Invalid Organization ID format\";\n+    private static final String CARD_ISSUER_IDENTIFIER = \"80840\";\n+\n+    @Override\n+    public void initialize(OrganizationId organizationId) {\n+        //not used\n+    }\n+\n+    @Override\n+    public boolean isValid(String s, ConstraintValidatorContext constraintValidatorContext) {\n+        if (!allDigits(s)) {\n+            return false;\n+        }\n+        String identifier = CARD_ISSUER_IDENTIFIER + s;\n+        return LuhnCheckDigit.LUHN_CHECK_DIGIT.isValid(identifier);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4328a645c33572a0a1c23bd645cd62f1cb21356b"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ca50a6d1a09ebd82432df57cedb1a5ca8d057cf", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/0ca50a6d1a09ebd82432df57cedb1a5ca8d057cf", "committedDate": "2020-04-22T22:24:28Z", "message": "change validator to only look at npi ids"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c979c4f3ec67a1238b9429a5955430e1c8dd7b3", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/8c979c4f3ec67a1238b9429a5955430e1c8dd7b3", "committedDate": "2020-04-22T22:25:24Z", "message": "update tests for new organization id (not database id) validation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4NjQxMjc3", "url": "https://github.com/CMSgov/dpc-app/pull/763#pullrequestreview-398641277", "createdAt": "2020-04-22T22:43:25Z", "commit": {"oid": "8c979c4f3ec67a1238b9429a5955430e1c8dd7b3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQyMjo0MzoyNVrOGKO23g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQyMjo0MzoyNVrOGKO23g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzM4MjM2Ng==", "bodyText": "Method registerOrganization has 5 arguments (exceeds 4 allowed). Consider refactoring.", "url": "https://github.com/CMSgov/dpc-app/pull/763#discussion_r413382366", "createdAt": "2020-04-22T22:43:25Z", "author": {"login": "codeclimate"}, "path": "dpc-common/src/main/java/gov/cms/dpc/fhir/helpers/FHIRHelpers.java", "diffHunk": "@@ -41,7 +41,7 @@\n      * @return - {@link String} Access token generated for the {@link Organization}\n      * @throws IOException - Throws if HTTP client fails\n      */\n-    public static String registerOrganization(IGenericClient client, IParser parser, String organizationID, String adminURL) throws IOException {\n+    public static String registerOrganization(IGenericClient client, IParser parser, String organizationID, String organizationNPI, String adminURL) throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c979c4f3ec67a1238b9429a5955430e1c8dd7b3"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01b6ae97635d9c266c9dfc02799a429acddbc5c7", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/01b6ae97635d9c266c9dfc02799a429acddbc5c7", "committedDate": "2020-04-22T23:04:35Z", "message": "Merge branch 'master' into DPC-1282-organization-id-validation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4214f95810ead4276f78aa13afd036eefef10e7a", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/4214f95810ead4276f78aa13afd036eefef10e7a", "committedDate": "2020-04-23T04:08:11Z", "message": "separate out npi validation from OrganizationIdValidator to separate utility class so npi validation can be used in other places"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a2a423221725cb088e7555bd72eb8e9949a4f08", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/3a2a423221725cb088e7555bd72eb8e9949a4f08", "committedDate": "2020-04-23T04:08:17Z", "message": "Merge remote-tracking branch 'origin/DPC-1282-organization-id-validation' into DPC-1282-organization-id-validation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34f4164041deef691b777f8d6bfbe1c3a3fde756", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/34f4164041deef691b777f8d6bfbe1c3a3fde756", "committedDate": "2020-04-27T19:04:26Z", "message": "add more test cases for different starting numbers"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMjQ3MTA3", "url": "https://github.com/CMSgov/dpc-app/pull/763#pullrequestreview-401247107", "createdAt": "2020-04-27T19:10:07Z", "commit": {"oid": "3a2a423221725cb088e7555bd72eb8e9949a4f08"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28dae358b9a1b1dbed39d47eb6122238963b493d", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/28dae358b9a1b1dbed39d47eb6122238963b493d", "committedDate": "2020-04-27T20:55:10Z", "message": "add npi validation to practitioners and update test (#766)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e91f7b25d308cb97d8c72c30b163d277827f670b", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/e91f7b25d308cb97d8c72c30b163d277827f670b", "committedDate": "2020-04-27T20:55:38Z", "message": "Merge branch 'master' into DPC-1282-organization-id-validation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMzMyMjU3", "url": "https://github.com/CMSgov/dpc-app/pull/763#pullrequestreview-401332257", "createdAt": "2020-04-27T21:15:29Z", "commit": {"oid": "e91f7b25d308cb97d8c72c30b163d277827f670b"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QyMToxNTozMFrOGM4BjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QyMToxNTozMFrOGM4BkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE1Mzk5Nw==", "bodyText": "Similar blocks of code found in 2 locations. Consider refactoring.", "url": "https://github.com/CMSgov/dpc-app/pull/763#discussion_r416153997", "createdAt": "2020-04-27T21:15:30Z", "author": {"login": "codeclimate"}, "path": "dpc-common/src/main/java/gov/cms/dpc/common/annotations/NPI.java", "diffHunk": "@@ -0,0 +1,25 @@\n+package gov.cms.dpc.common.annotations;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e91f7b25d308cb97d8c72c30b163d277827f670b"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE1NDAwMQ==", "bodyText": "Similar blocks of code found in 2 locations. Consider refactoring.", "url": "https://github.com/CMSgov/dpc-app/pull/763#discussion_r416154001", "createdAt": "2020-04-27T21:15:30Z", "author": {"login": "codeclimate"}, "path": "dpc-common/src/main/java/gov/cms/dpc/common/annotations/OrganizationId.java", "diffHunk": "@@ -0,0 +1,25 @@\n+package gov.cms.dpc.common.annotations;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e91f7b25d308cb97d8c72c30b163d277827f670b"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2121e76905c68b62eeafe56a9b0ebcf8531d36f4", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/2121e76905c68b62eeafe56a9b0ebcf8531d36f4", "committedDate": "2020-04-29T18:54:38Z", "message": "Merge branch 'master' into DPC-1282-organization-id-validation\n\n# Conflicts:\n#\tdpc-common/pom.xml\n#\tdpc-common/src/main/java/gov/cms/dpc/common/entities/OrganizationEntity.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d79ae6047992886603329c7ee42e88a5ed1aaf3b", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/d79ae6047992886603329c7ee42e88a5ed1aaf3b", "committedDate": "2020-04-29T19:49:44Z", "message": "Merge remote-tracking branch 'origin/DPC-1282-organization-id-validation' into DPC-1282-organization-id-validation\n\n# Conflicts:\n#\tdpc-common/src/main/java/gov/cms/dpc/common/entities/ProviderEntity.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1ea1846ae4e35fcd7025501ad5f05ba213566be", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/e1ea1846ae4e35fcd7025501ad5f05ba213566be", "committedDate": "2020-04-30T21:54:26Z", "message": "Merge branch 'master' into DPC-1282-organization-id-validation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2fb4123aa66e1a2973066c179ea6b69d68ba0086", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/2fb4123aa66e1a2973066c179ea6b69d68ba0086", "committedDate": "2020-05-18T14:27:28Z", "message": "Merge branch 'master' into DPC-1282-organization-id-validation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9da92cc133fe575da1d060e907e786da3994e93", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/f9da92cc133fe575da1d060e907e786da3994e93", "committedDate": "2020-05-18T15:31:56Z", "message": "Merge remote-tracking branch 'origin/master' into DPC-1282-organization-id-validation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "546ef56bb16f120f539ef8b928e7b5b5fd48b53c", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/546ef56bb16f120f539ef8b928e7b5b5fd48b53c", "committedDate": "2020-05-18T15:58:25Z", "message": "fix test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNzQ2NDc5", "url": "https://github.com/CMSgov/dpc-app/pull/763#pullrequestreview-413746479", "createdAt": "2020-05-18T16:17:41Z", "commit": {"oid": "546ef56bb16f120f539ef8b928e7b5b5fd48b53c"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNjoxNzo0MVrOGW-aiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNjoxNzo0MVrOGW-ajQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc0NDQ1OQ==", "bodyText": "Similar blocks of code found in 3 locations. Consider refactoring.", "url": "https://github.com/CMSgov/dpc-app/pull/763#discussion_r426744459", "createdAt": "2020-05-18T16:17:41Z", "author": {"login": "codeclimate"}, "path": "dpc-common/src/main/java/gov/cms/dpc/common/annotations/NPI.java", "diffHunk": "@@ -0,0 +1,25 @@\n+package gov.cms.dpc.common.annotations;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "546ef56bb16f120f539ef8b928e7b5b5fd48b53c"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc0NDQ2MQ==", "bodyText": "Similar blocks of code found in 3 locations. Consider refactoring.", "url": "https://github.com/CMSgov/dpc-app/pull/763#discussion_r426744461", "createdAt": "2020-05-18T16:17:41Z", "author": {"login": "codeclimate"}, "path": "dpc-common/src/main/java/gov/cms/dpc/common/annotations/OrganizationId.java", "diffHunk": "@@ -0,0 +1,25 @@\n+package gov.cms.dpc.common.annotations;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "546ef56bb16f120f539ef8b928e7b5b5fd48b53c"}, "originalPosition": 1}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 114, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}