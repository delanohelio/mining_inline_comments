{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQzOTA2NTk1", "number": 1153, "title": "DPC-948 ability to differentiate BFD headers when requesting patient everything vs bulk data", "bodyText": "Fixes DPC-948\n\nNeed to send different headers depending on being bulk or non bulk requests to BFD.\nProposed Changes\n\n\nadd new boolean column to indicate if it's a bulk job or not\nrefactor passing down BFD headers (don't use MDC anymore, just pass a Map of headers down to the bb client)\nuse the newly added boolean column to determine which headers to pass down\n\nChange Details\n\nCreate a new is_bulk column for JobQueueBatch that allows JobBatchProcessor to be able to determine which BFD headers to pass down to the BlueButtonClientImpl\nSecurity Implications\n\n\n new software dependencies\n\n\n\n security controls or supporting software altered\n\n\n\n new data stored or transmitted\n\n\n\n security checklist is completed for this change\n\n\n\n requires more information or team discussion to evaluate security implications\n\n\n\n no PHI/PII is affected by this change\n\n\nAcceptance Validation\n\n\nFeedback Requested", "createdAt": "2020-12-22T06:39:54Z", "url": "https://github.com/CMSgov/dpc-app/pull/1153", "merged": true, "mergeCommit": {"oid": "1070a734fabeb718edaa03f26e26a9b69295ea47"}, "closed": true, "closedAt": "2021-01-04T22:49:46Z", "author": {"login": "MrBilnon"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdokpJgAH2gAyNTQzOTA2NTk1OmYzZDc2NWI4Yjg5YzljYTAzNDk2MjgzZjZmZGY2OGU1ODI1YTYwMTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdpHSBYgH2gAyNTQzOTA2NTk1OmZiYjZlM2RkYzkyMTk4YmRlMTE1ODEzODU2ZTQ5M2E0YjQwY2IxNzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f3d765b8b89c9ca03496283f6fdf68e5825a6011", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/f3d765b8b89c9ca03496283f6fdf68e5825a6011", "committedDate": "2020-12-22T06:35:44Z", "message": "ability to differentiate BFD headers when requesting patient everything vs bulk data"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2ODY2NjA2", "url": "https://github.com/CMSgov/dpc-app/pull/1153#pullrequestreview-556866606", "createdAt": "2020-12-22T07:18:35Z", "commit": {"oid": "f3d765b8b89c9ca03496283f6fdf68e5825a6011"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwNzoxODozNlrOIJw5PQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwNzoxODozNlrOIJw5PQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzEwOTE4MQ==", "bodyText": "Should the order matter? To ensure the values match the correct header keys.", "url": "https://github.com/CMSgov/dpc-app/pull/1153#discussion_r547109181", "createdAt": "2020-12-22T07:18:36Z", "author": {"login": "MrMorie"}, "path": "dpc-aggregation/src/test/java/gov/cms/dpc/aggregation/engine/AggregationEngineBFDClientTest.java", "diffHunk": "@@ -84,22 +85,53 @@ void testHeadersPassedToBFD() {\n                 Collections.singletonList(ResourceType.Patient),\n                 null,\n                 MockBlueButtonClient.BFD_TRANSACTION_TIME,\n-                \"127.0.0.1\"\n-        );\n+                \"127.0.0.1\",\n+                true);\n \n         engine.run();\n \n         // Look at the result\n         final var completeJob = queue.getJobBatches(jobID).stream().findFirst().orElseThrow();\n         assertEquals(JobStatus.COMPLETED, completeJob.getStatus());\n \n-        Assertions.assertThat(headerKey.getAllValues()).containsExactlyInAnyOrder(Constants.INCLUDE_IDENTIFIERS_HEADER, Constants.BULK_CLIENT_ID_HEADER, Constants.BULK_JOB_ID_HEADER, HttpHeaders.X_FORWARDED_FOR);\n-        Assertions.assertThat(headerValue.getAllValues()).containsExactlyInAnyOrder(\"mbi\", providerID.toString(), jobID.toString(), \"127.0.0.1\");\n+        Assertions.assertThat(headerKey.getAllValues()).containsExactlyInAnyOrder(Constants.INCLUDE_IDENTIFIERS_HEADER, Constants.BULK_CLIENT_ID_HEADER, Constants.BULK_JOB_ID_HEADER, HttpHeaders.X_FORWARDED_FOR, Constants.BFD_ORIGINAL_QUERY_ID_HEADER);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3d765b8b89c9ca03496283f6fdf68e5825a6011"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2ODY5NDcx", "url": "https://github.com/CMSgov/dpc-app/pull/1153#pullrequestreview-556869471", "createdAt": "2020-12-22T07:25:13Z", "commit": {"oid": "f3d765b8b89c9ca03496283f6fdf68e5825a6011"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbb6e3ddc92198bde115813856e493a4b40cb172", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/fbb6e3ddc92198bde115813856e493a4b40cb172", "committedDate": "2020-12-23T22:57:09Z", "message": "Merge branch 'master' into wh/DPC-948-update_bfd_headers_for_patient_everything"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 355, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}