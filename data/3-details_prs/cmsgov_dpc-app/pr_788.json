{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1MjY2ODIy", "number": 788, "title": "DPC-1347: Change auto-generated vendor and provider ids to pass for NPI", "bodyText": "Why\nThe first iteration of this PR caused deployment issues. With direction from @dhgreene, we were able to determine the original migration was causing the issue by trying to assign original sandbox_ids to all existing organizations.\nWhat Changed\nWe changed the migration for the sandbox_id column to only add the column and not generate sandbox_ids.\nWe added a rake task that will need to be run after deployment to generate sandbox_ids for all existing organizations.\nTo run rake task in each environment:\nrake add_sandbox_ids\nChoices Made\nThis issue with the original PR was that the migration was also adding the sandbox_ids to the column. Running the rake task separately will make assigning ids to organizations much more manageable.\nTickets closed:\nDPC-1347 - take 2!\nFuture Work\nList any additional tickets that have either been created due to work in this PR, or existing tickets that expand upon the feature or provide additional fixes.\nChecklist\n\n All tests are passing via make ci-app (app change) and make ci-web (website change)\n[N/A] Swagger documentation has been updated\n[N/A] FHIR documentation has been updated\n[N/A] Any required dpc-ops changes have a PR submitted and mentioned in this ticket\n[N/A] Any manual migration steps are documented, scripts written (where applicable), and tested\n[N/A] Before merging, any required dpc-ops changes have been approved and merged into master of the dpc-ops repo", "createdAt": "2020-05-08T14:36:34Z", "url": "https://github.com/CMSgov/dpc-app/pull/788", "merged": true, "mergeCommit": {"oid": "7d9a9294194f936a5dc74282269cef564e5bb83e"}, "closed": true, "closedAt": "2020-05-08T17:07:32Z", "author": {"login": "Sun-Mountain"}, "timelineItems": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcazOy_AH2gAyNDE1MjY2ODIyOmQ2MjgyZThlN2NmOGI5YzQwOGI2OGRhYjZjMzhiYmUzNTViOWVhNTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcfU0s6AFqTQwODM3NTU0NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d6282e8e7cf8b9c408b68dab6c38bbe355b9ea58", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/d6282e8e7cf8b9c408b68dab6c38bbe355b9ea58", "committedDate": "2020-04-24T15:29:26Z", "message": "Installed Luhnacy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73821645cb4d44e2e94ba565f41e07bbdfd6af5d", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/73821645cb4d44e2e94ba565f41e07bbdfd6af5d", "committedDate": "2020-04-24T19:54:10Z", "message": "Create sandbox_id as fake npi for organization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7ae6be2419ccc5e325141e94e111021f0f9b46e", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/f7ae6be2419ccc5e325141e94e111021f0f9b46e", "committedDate": "2020-04-24T20:14:41Z", "message": "Move luhnacy requirement to application"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96bac53908e2c70f2d2ffaa9b440875992864602", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/96bac53908e2c70f2d2ffaa9b440875992864602", "committedDate": "2020-04-24T20:20:48Z", "message": "Update all existing organization sandbox_ids"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14dbeb311c7fa598e4eabd14f132720aca9d0b43", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/14dbeb311c7fa598e4eabd14f132720aca9d0b43", "committedDate": "2020-04-27T12:39:41Z", "message": "Rollback migration to ensure blank sandbox_id are generated"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12b44fba6d48af1e8033673e1e1a237bb5a9645a", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/12b44fba6d48af1e8033673e1e1a237bb5a9645a", "committedDate": "2020-04-27T13:08:39Z", "message": "Autogenerated sandbox_id for existing organizations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "427907c5b7d39fe17b4af7287b1dd5d69c7ec64e", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/427907c5b7d39fe17b4af7287b1dd5d69c7ec64e", "committedDate": "2020-04-27T14:20:07Z", "message": "Added sandbox_id column and generates id for existing orgs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e74e4be9d614546a5d39f535dfe3858346cdf268", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/e74e4be9d614546a5d39f535dfe3858346cdf268", "committedDate": "2020-04-27T14:43:26Z", "message": "Update prod-sbx views"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bed60560cd05a249bc8d318c31578d4f6e48af95", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/bed60560cd05a249bc8d318c31578d4f6e48af95", "committedDate": "2020-04-27T15:29:19Z", "message": "Organziation Spec adjusted\n\nRemoved tests for provider_id and vendor_id\nReplaced with concise sandbox_id tests in environments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60f53eb2c31d07683cb4357a3514f5cab96cb2d1", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/60f53eb2c31d07683cb4357a3514f5cab96cb2d1", "committedDate": "2020-04-27T15:39:49Z", "message": "Updated api_client_spec"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0e261c2cf1de4fb6ef318ffe77986cb41f70bbc", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/d0e261c2cf1de4fb6ef318ffe77986cb41f70bbc", "committedDate": "2020-04-27T15:43:40Z", "message": "Removed provider_id and vendor_id columns"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71ab6bd0cb7363c2e0185b91d899acc51026e6be", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/71ab6bd0cb7363c2e0185b91d899acc51026e6be", "committedDate": "2020-04-27T16:40:22Z", "message": "Adjusted views"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec3cdded57dc448de279b3adf83034d1d63241eb", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/ec3cdded57dc448de279b3adf83034d1d63241eb", "committedDate": "2020-04-27T16:48:22Z", "message": "Merge branch 'master' into nzonnenberg/dpc-1347-generate-fake-npis"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7df919a259a46bf5304ca06e75d33e5d021bd0f", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/f7df919a259a46bf5304ca06e75d33e5d021bd0f", "committedDate": "2020-04-27T17:16:16Z", "message": "Code Climate fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31145d74dcb29bd58f2c10ca8379c90d8f265aeb", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/31145d74dcb29bd58f2c10ca8379c90d8f265aeb", "committedDate": "2020-04-27T17:16:42Z", "message": "Merge branch 'nzonnenberg/dpc-1347-generate-fake-npis' of github.com:CMSgov/dpc-app into nzonnenberg/dpc-1347-generate-fake-npis"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6314a7f6c97398d43cb32ce875023f124977c19", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/a6314a7f6c97398d43cb32ce875023f124977c19", "committedDate": "2020-05-05T17:58:58Z", "message": "Commented out docker db:migrate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00d5b0c9f2753ae84f8a55b431b8806968737f5e", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/00d5b0c9f2753ae84f8a55b431b8806968737f5e", "committedDate": "2020-05-05T18:04:23Z", "message": "Merge remote-tracking branch 'origin/master' into nzonnenberg/dpc-1347-generate-fake-npis"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4277a8203e1b7e65eb63a7f09c912ec48e934bb3", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/4277a8203e1b7e65eb63a7f09c912ec48e934bb3", "committedDate": "2020-05-06T13:34:53Z", "message": "Removed sandbox_id generate from migration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4561285665787a167894c154e74580e961530754", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/4561285665787a167894c154e74580e961530754", "committedDate": "2020-05-06T13:43:13Z", "message": "Rake task for sandbox_id added"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1a9f4e1ea8411f90d616a85ad8ee4bdc1ba0cb4", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/b1a9f4e1ea8411f90d616a85ad8ee4bdc1ba0cb4", "committedDate": "2020-05-06T13:49:12Z", "message": "Rake task to add sandbox ids"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "806404c7e47ecb86c596370702f5c72bc673c097", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/806404c7e47ecb86c596370702f5c72bc673c097", "committedDate": "2020-05-08T14:35:23Z", "message": "Added 'sandbox_id'"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4Mjk3Nzcw", "url": "https://github.com/CMSgov/dpc-app/pull/788#pullrequestreview-408297770", "createdAt": "2020-05-08T14:55:04Z", "commit": {"oid": "806404c7e47ecb86c596370702f5c72bc673c097"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNDo1NTowNVrOGSoeSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNDo1NTowNlrOGSoeWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE5MDY2NA==", "bodyText": "Final newline missing.", "url": "https://github.com/CMSgov/dpc-app/pull/788#discussion_r422190664", "createdAt": "2020-05-08T14:55:05Z", "author": {"login": "codeclimate"}, "path": "dpc-web/lib/tasks/add_sandbox_ids.rake", "diffHunk": "@@ -0,0 +1,12 @@\n+desc 'Add sandbox id to existing organizations if null'\n+\n+task :add_sandbox_ids => :environment do\n+  if ENV['DEPLOY_ENV'] == 'prod-sbx'\n+    Organization.find_each do |o|\n+      if o.sandbox_id == nil\n+        o.sandbox_id = Luhnacy.generate(15, :prefix => '808403')[-10..-1]\n+        o.save!\n+      end\n+    end\n+  end\n+end", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "806404c7e47ecb86c596370702f5c72bc673c097"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE5MDY2OA==", "bodyText": "Missing magic comment # frozen_string_literal: true.", "url": "https://github.com/CMSgov/dpc-app/pull/788#discussion_r422190668", "createdAt": "2020-05-08T14:55:05Z", "author": {"login": "codeclimate"}, "path": "dpc-web/lib/tasks/add_sandbox_ids.rake", "diffHunk": "@@ -0,0 +1,12 @@\n+desc 'Add sandbox id to existing organizations if null'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "806404c7e47ecb86c596370702f5c72bc673c097"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE5MDY3MQ==", "bodyText": "Use the new Ruby 1.9 hash syntax.", "url": "https://github.com/CMSgov/dpc-app/pull/788#discussion_r422190671", "createdAt": "2020-05-08T14:55:05Z", "author": {"login": "codeclimate"}, "path": "dpc-web/lib/tasks/add_sandbox_ids.rake", "diffHunk": "@@ -0,0 +1,12 @@\n+desc 'Add sandbox id to existing organizations if null'\n+\n+task :add_sandbox_ids => :environment do", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "806404c7e47ecb86c596370702f5c72bc673c097"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE5MDY3Ng==", "bodyText": "Use the new Ruby 1.9 hash syntax.", "url": "https://github.com/CMSgov/dpc-app/pull/788#discussion_r422190676", "createdAt": "2020-05-08T14:55:05Z", "author": {"login": "codeclimate"}, "path": "dpc-web/lib/tasks/add_sandbox_ids.rake", "diffHunk": "@@ -0,0 +1,12 @@\n+desc 'Add sandbox id to existing organizations if null'\n+\n+task :add_sandbox_ids => :environment do\n+  if ENV['DEPLOY_ENV'] == 'prod-sbx'\n+    Organization.find_each do |o|\n+      if o.sandbox_id == nil\n+        o.sandbox_id = Luhnacy.generate(15, :prefix => '808403')[-10..-1]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "806404c7e47ecb86c596370702f5c72bc673c097"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE5MDY4MA==", "bodyText": "Prefer the use of the nil? predicate.", "url": "https://github.com/CMSgov/dpc-app/pull/788#discussion_r422190680", "createdAt": "2020-05-08T14:55:06Z", "author": {"login": "codeclimate"}, "path": "dpc-web/lib/tasks/add_sandbox_ids.rake", "diffHunk": "@@ -0,0 +1,12 @@\n+desc 'Add sandbox id to existing organizations if null'\n+\n+task :add_sandbox_ids => :environment do\n+  if ENV['DEPLOY_ENV'] == 'prod-sbx'\n+    Organization.find_each do |o|\n+      if o.sandbox_id == nil", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "806404c7e47ecb86c596370702f5c72bc673c097"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8459afbbb906988f592f206a70d406616d7c2bf0", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/8459afbbb906988f592f206a70d406616d7c2bf0", "committedDate": "2020-05-08T15:18:16Z", "message": "Change DEPLOY_ENV variable to ENV"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a421fd25293ae6b1eacf2f0d420c575c6fda56a5", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/a421fd25293ae6b1eacf2f0d420c575c6fda56a5", "committedDate": "2020-05-08T15:24:17Z", "message": "Code climate fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13ac365e382d4740522d6ac5efee2c5f47af6e75", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/13ac365e382d4740522d6ac5efee2c5f47af6e75", "committedDate": "2020-05-08T15:27:20Z", "message": "Remove whitespace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3207abff48eb7dc8c326bb5c5bd3aa032b9f27db", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/3207abff48eb7dc8c326bb5c5bd3aa032b9f27db", "committedDate": "2020-05-08T15:31:09Z", "message": "Code climate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea0b22223f7ad60a7b64ad9bbaa37e6b31226b87", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/ea0b22223f7ad60a7b64ad9bbaa37e6b31226b87", "committedDate": "2020-05-08T16:45:10Z", "message": "Merge branch 'master' into nzonnenberg/dpc-1347-generate-fake-npis"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4Mzc1NTQ1", "url": "https://github.com/CMSgov/dpc-app/pull/788#pullrequestreview-408375545", "createdAt": "2020-05-08T16:53:24Z", "commit": {"oid": "ea0b22223f7ad60a7b64ad9bbaa37e6b31226b87"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 134, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}