{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3NTkwNjYz", "number": 1044, "title": "DPC-573: Allow label creation from web app / Accept token label in body.", "bodyText": "Fixes DPC-573\n\nDPC Web was sending the label as a json body when creating a token, API required them as a query param.\nProposed Changes\nInstead of simply sending the request with query params it was decided to accept them in the body.\nTo maintain backwards compatibility query params are still accepted but should be deprecated.\n\nChange Details\n\naccept token label and expiration in body\ncreated model for request body\nupdated integrations tests to run independently from each other (Order mattered before, now they may run in any order)\nAdded more tests\nextended the formats allowed for expiration time (Kept the ability to accept ISO while also accepting FHIR)\n\n\nSecurity Implications\nDon't see any security issues.\n\n\n new software dependencies\n\n\n\n security controls or supporting software altered\n\n\n\n new data stored or transmitted\n\n\n\n security checklist is completed for this change\n\n\n\n requires more information or team discussion to evaluate security implications\n\n\n\n no PHI/PII is affected by this change\n\n\nAcceptance Validation\n\nYes, tested in Dev\n\n\n\n\n\nFeedback Requested\n\nMissed anyting?", "createdAt": "2020-09-15T21:31:25Z", "url": "https://github.com/CMSgov/dpc-app/pull/1044", "merged": true, "mergeCommit": {"oid": "74698a5be2e71b7e0885114f12670ba267b4f68a"}, "closed": true, "closedAt": "2020-09-17T18:07:32Z", "author": {"login": "MrMorie"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJOqXdAH2gAyNDg3NTkwNjYzOmNiYmFiZDEwMzFiZWRmZDE1ZmJiOTI0MjQ0ZTY0ZDZjN2M0ZmE1Mjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJzWhrgH2gAyNDg3NTkwNjYzOjAzOGIzOWRmZTRlN2MwYTY1NWFlOTgwNDg2ZWEwMGJjNTZlMTY2ZDg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cbbabd1031bedfd15fbb924244e64d6c7c4fa527", "author": {"user": {"login": "MrMorie", "name": "Salvador"}}, "url": "https://github.com/CMSgov/dpc-app/commit/cbbabd1031bedfd15fbb924244e64d6c7c4fa527", "committedDate": "2020-09-15T21:27:30Z", "message": "Added TokenDTO to token resource."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3b4f7179e4190be5a0466f286a0f918fd0f5398", "author": {"user": {"login": "MrMorie", "name": "Salvador"}}, "url": "https://github.com/CMSgov/dpc-app/commit/c3b4f7179e4190be5a0466f286a0f918fd0f5398", "committedDate": "2020-09-15T21:38:58Z", "message": "Merge branch 'master' into sg/DPC-573-accept-body-in-token-creation-request"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MTI3MTg4", "url": "https://github.com/CMSgov/dpc-app/pull/1044#pullrequestreview-489127188", "createdAt": "2020-09-15T21:39:52Z", "commit": {"oid": "c3b4f7179e4190be5a0466f286a0f918fd0f5398"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMTozOTo1MlrOHSVnvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMTozOTo1MlrOHSVnvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk5MDY1Mw==", "bodyText": "This file had been abandoned, deleted it since it was not being used.", "url": "https://github.com/CMSgov/dpc-app/pull/1044#discussion_r488990653", "createdAt": "2020-09-15T21:39:52Z", "author": {"login": "MrMorie"}, "path": "dpc-api/src/main/java/gov/cms/dpc/api/models/TokenResponse.java", "diffHunk": "@@ -1,83 +0,0 @@\n-package gov.cms.dpc.api.models;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3b4f7179e4190be5a0466f286a0f918fd0f5398"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97b25848aed1fae7e8a1f075956d91d9cdce2fe1", "author": {"user": {"login": "MrMorie", "name": "Salvador"}}, "url": "https://github.com/CMSgov/dpc-app/commit/97b25848aed1fae7e8a1f075956d91d9cdce2fe1", "committedDate": "2020-09-15T22:36:39Z", "message": "Added TokenDto tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61c405cc2f43224b876b7a9975559d5bcdc9333b", "author": {"user": {"login": "MrMorie", "name": "Salvador"}}, "url": "https://github.com/CMSgov/dpc-app/commit/61c405cc2f43224b876b7a9975559d5bcdc9333b", "committedDate": "2020-09-15T22:37:15Z", "message": "Merge branch 'sg/DPC-573-accept-body-in-token-creation-request' of https://github.com/CMSgov/dpc-app into sg/DPC-573-accept-body-in-token-creation-request"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MTcxNTUx", "url": "https://github.com/CMSgov/dpc-app/pull/1044#pullrequestreview-489171551", "createdAt": "2020-09-15T23:19:35Z", "commit": {"oid": "61c405cc2f43224b876b7a9975559d5bcdc9333b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMzoxOTozNVrOHSaXDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMzoxOTozNVrOHSaXDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTA2ODMwMw==", "bodyText": "Method equals has a Cognitive Complexity of 10 (exceeds 9 allowed). Consider refactoring.", "url": "https://github.com/CMSgov/dpc-app/pull/1044#discussion_r489068303", "createdAt": "2020-09-15T23:19:35Z", "author": {"login": "codeclimate"}, "path": "dpc-api/src/main/java/gov/cms/dpc/api/models/TokenDto.java", "diffHunk": "@@ -0,0 +1,117 @@\n+package gov.cms.dpc.api.models;\n+\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import com.fasterxml.jackson.annotation.JsonInclude;\n+import com.fasterxml.jackson.databind.annotation.JsonDeserialize;\n+import com.fasterxml.jackson.databind.annotation.JsonSerialize;\n+import gov.cms.dpc.common.annotations.NoHtml;\n+import gov.cms.dpc.common.converters.jackson.OffsetDateTimeToStringConverter;\n+import gov.cms.dpc.common.converters.jackson.StringToOffsetDateTimeConverter;\n+\n+import java.io.Serializable;\n+import java.time.OffsetDateTime;\n+import java.util.Objects;\n+import java.util.UUID;\n+\n+\n+public class TokenDto implements Serializable {\n+\n+    private static final long serialVersionUID = 4464861101748469238L;\n+\n+    private String id;\n+\n+    private String tokenType;\n+\n+    @JsonIgnore\n+    @JsonInclude(JsonInclude.Include.NON_NULL)\n+    private UUID organizationID;\n+\n+    @NoHtml\n+    private String label;\n+\n+    @JsonInclude(JsonInclude.Include.NON_NULL)\n+    private String token;\n+\n+    @JsonSerialize(converter = OffsetDateTimeToStringConverter.class)\n+    @JsonDeserialize(converter = StringToOffsetDateTimeConverter.class)\n+    private OffsetDateTime createdAt;\n+\n+    @JsonSerialize(converter = OffsetDateTimeToStringConverter.class)\n+    @JsonDeserialize(converter = StringToOffsetDateTimeConverter.class)\n+    private OffsetDateTime expiresAt;\n+\n+    public TokenDto() {\n+        // Jackson required\n+    }\n+\n+    public String getId() {\n+        return id;\n+    }\n+\n+    public void setId(String id) {\n+        this.id = id;\n+    }\n+\n+    public String getTokenType() { return tokenType; }\n+\n+    public void setTokenType(String tokenType) { this.tokenType = tokenType; }\n+\n+    public UUID getOrganizationID() {\n+        return organizationID;\n+    }\n+\n+    public void setOrganizationID(UUID organizationID) {\n+        this.organizationID = organizationID;\n+    }\n+\n+    public String getLabel() {\n+        return label;\n+    }\n+\n+    public void setLabel(String label) {\n+        this.label = label;\n+    }\n+\n+    public String getToken() {\n+        return token;\n+    }\n+\n+    public void setToken(String token) {\n+        this.token = token;\n+    }\n+\n+    public OffsetDateTime getCreatedAt() {\n+        return createdAt;\n+    }\n+\n+    public void setCreatedAt(OffsetDateTime createdAt) {\n+        this.createdAt = createdAt;\n+    }\n+\n+    public OffsetDateTime getExpiresAt() {\n+        return expiresAt;\n+    }\n+\n+    public void setExpiresAt(OffsetDateTime expiresAt) {\n+        this.expiresAt = expiresAt;\n+    }\n+\n+    @Override", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61c405cc2f43224b876b7a9975559d5bcdc9333b"}, "originalPosition": 99}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6846f61ffa66d421a48b261a4eca5feb30044667", "author": {"user": {"login": "MrMorie", "name": "Salvador"}}, "url": "https://github.com/CMSgov/dpc-app/commit/6846f61ffa66d421a48b261a4eca5feb30044667", "committedDate": "2020-09-16T21:23:59Z", "message": "Fixed createdAt not being returned, Added proper response for offsetDateTime Deserialization"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwMDUwMTMx", "url": "https://github.com/CMSgov/dpc-app/pull/1044#pullrequestreview-490050131", "createdAt": "2020-09-16T22:00:09Z", "commit": {"oid": "6846f61ffa66d421a48b261a4eca5feb30044667"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQyMjowMDowOVrOHTFt1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQyMjowMDowOVrOHTFt1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc3ODY0Ng==", "bodyText": "Either remove or fill this block of code.", "url": "https://github.com/CMSgov/dpc-app/pull/1044#discussion_r489778646", "createdAt": "2020-09-16T22:00:09Z", "author": {"login": "codeclimate"}, "path": "dpc-common/src/main/java/gov/cms/dpc/common/converters/jackson/MultiFormatOffsetDateTimeDeserializer.java", "diffHunk": "@@ -0,0 +1,29 @@\n+package gov.cms.dpc.common.converters.jackson;\n+\n+import com.fasterxml.jackson.databind.util.StdConverter;\n+import gov.cms.dpc.fhir.FHIRFormatters;\n+\n+import javax.ws.rs.WebApplicationException;\n+import javax.ws.rs.core.Response;\n+import java.time.OffsetDateTime;\n+import java.time.format.DateTimeFormatter;\n+import java.time.format.DateTimeParseException;\n+\n+/**\n+ * Deserialize from the format expected in the FHIR spec. For details see https://hl7.org/fhir/2018May/datatypes.html#instant\n+ */\n+public class MultiFormatOffsetDateTimeDeserializer extends StdConverter<String, OffsetDateTime> {\n+\n+    private static final DateTimeFormatter[] supportedFormats = {FHIRFormatters.INSTANT_FORMATTER, DateTimeFormatter.ISO_OFFSET_DATE_TIME};\n+\n+    @Override\n+    public OffsetDateTime convert(String s) {\n+\n+        for(DateTimeFormatter formatter:supportedFormats){\n+            try {\n+                return OffsetDateTime.parse(s, formatter);\n+            }catch (DateTimeParseException e){}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6846f61ffa66d421a48b261a4eca5feb30044667"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "642300f3b9f1c1dfa184b3bbbff8303f05edc2d6", "author": {"user": {"login": "MrMorie", "name": "Salvador"}}, "url": "https://github.com/CMSgov/dpc-app/commit/642300f3b9f1c1dfa184b3bbbff8303f05edc2d6", "committedDate": "2020-09-16T23:17:35Z", "message": "Merge branch 'master' into sg/DPC-573-accept-body-in-token-creation-request"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "529adde963b45972d5af345c110dd9adffdde580", "author": {"user": {"login": "MrMorie", "name": "Salvador"}}, "url": "https://github.com/CMSgov/dpc-app/commit/529adde963b45972d5af345c110dd9adffdde580", "committedDate": "2020-09-17T04:32:06Z", "message": "+Added validation to token request body. +Added tests for nohtml validation. -Applied KISS principle due to hiberante and mapping issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39a2131eeecfeac9832f6e2fa12b845032859a01", "author": {"user": {"login": "MrMorie", "name": "Salvador"}}, "url": "https://github.com/CMSgov/dpc-app/commit/39a2131eeecfeac9832f6e2fa12b845032859a01", "committedDate": "2020-09-17T04:33:07Z", "message": "Merge branch 'sg/DPC-573-accept-body-in-token-creation-request' of https://github.com/CMSgov/dpc-app into sg/DPC-573-accept-body-in-token-creation-request"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23c5dba42d0096bf483a1023d32063ccb059bdf6", "author": {"user": {"login": "MrMorie", "name": "Salvador"}}, "url": "https://github.com/CMSgov/dpc-app/commit/23c5dba42d0096bf483a1023d32063ccb059bdf6", "committedDate": "2020-09-17T04:42:49Z", "message": "+Formating, +Renamed variables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b549cf370349f8fe923d5989119f0fc7b6af0886", "author": {"user": {"login": "MrMorie", "name": "Salvador"}}, "url": "https://github.com/CMSgov/dpc-app/commit/b549cf370349f8fe923d5989119f0fc7b6af0886", "committedDate": "2020-09-17T04:52:59Z", "message": "Fixed javadoc missing param issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "917df5c20b1fb5373d41aecd24cd0d4d3be5f4a3", "author": {"user": {"login": "MrMorie", "name": "Salvador"}}, "url": "https://github.com/CMSgov/dpc-app/commit/917df5c20b1fb5373d41aecd24cd0d4d3be5f4a3", "committedDate": "2020-09-17T05:49:19Z", "message": "added unit test for deserializer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwNjY4MDEx", "url": "https://github.com/CMSgov/dpc-app/pull/1044#pullrequestreview-490668011", "createdAt": "2020-09-17T14:35:43Z", "commit": {"oid": "917df5c20b1fb5373d41aecd24cd0d4d3be5f4a3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwNjc4NDAy", "url": "https://github.com/CMSgov/dpc-app/pull/1044#pullrequestreview-490678402", "createdAt": "2020-09-17T14:45:38Z", "commit": {"oid": "917df5c20b1fb5373d41aecd24cd0d4d3be5f4a3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba2f3a20023b471c70fbd04877ccffce193dcf41", "author": {"user": {"login": "MrMorie", "name": "Salvador"}}, "url": "https://github.com/CMSgov/dpc-app/commit/ba2f3a20023b471c70fbd04877ccffce193dcf41", "committedDate": "2020-09-17T15:24:07Z", "message": "Merge branch 'master' into sg/DPC-573-accept-body-in-token-creation-request"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "038b39dfe4e7c0a655ae980486ea00bc56e166d8", "author": {"user": {"login": "MrMorie", "name": "Salvador"}}, "url": "https://github.com/CMSgov/dpc-app/commit/038b39dfe4e7c0a655ae980486ea00bc56e166d8", "committedDate": "2020-09-17T16:12:19Z", "message": "Merge branch 'master' into sg/DPC-573-accept-body-in-token-creation-request"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 385, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}