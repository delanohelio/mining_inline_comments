{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM0ODM4Nzk3", "number": 857, "title": "Dpc 354 swagger", "bodyText": "Why:\nThis PR should cause swagger to work with the DPC API.  Currently swagger does not work, so we are trying to eliminate errors in swagger.json that are causing the problems.\nWhat Changed\nThe changes are to the swagger annotations including correcting parameter annotations and securityDefinition references.  This should causes swagger to be able to work against all API resource operations except for createEndpoint and updateEndpoint. Dropwizard swagger is still not producing valid swagger code for those two operations even given what looks to be the correct annotations.\nChoices Made\nN/A The fixes are to made to make DPC API swagger annotations conform to the Swagger 2.0 spec as implemented by Dropwizard-Swagger. https://github.com/smoketurner/dropwizard-swagger\nTickets closed:\nNo Tickets closed. DPC-354-swagger will remain open until swagger outputs are 100% valid and the swagger client meets the minimum requirement for functionality.  All Swagger calls must return expected results for DPC 354 to close.\nFuture Work\nStill need two resolve 2 reaming errors.  Still need to test all swagger operations on sandbox.\nChecklist\n\n All tests are passing via make ci-app (app change) and make ci-web (website change)\n[X ] Swagger documentation has been updated\n[X ] FHIR documentation has been updated\n[N/A] Any required dpc-ops changes have a PR submitted and mentioned in this ticket\n Any manual migration steps are documented, scripts written (where applicable), and tested\n[N/A] Before merging, any required dpc-ops changes have been approved and merged into master of the dpc-ops repo", "createdAt": "2020-06-15T22:00:39Z", "url": "https://github.com/CMSgov/dpc-app/pull/857", "merged": true, "mergeCommit": {"oid": "dac836af3c9ff4d96f66a5c683d07501e46c8411"}, "closed": true, "closedAt": "2020-06-23T00:57:40Z", "author": {"login": "richbraman"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqYOXjgH2gAyNDM0ODM4Nzk3OjYwZDE0OGU4YTdjMDcyYTA3MTNhMTEzYmRjOTVjY2I4M2U0ZDc2YmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABct6CGsAH2gAyNDM0ODM4Nzk3OmFkM2U1NDgzYzU1OTEwM2UyMGIwY2Y2YjYwYTlkNDVjYjMwZjk3MjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "60d148e8a7c072a0713a113bdc95ccb83e4d76bd", "author": {"user": {"login": "richbraman", "name": "Richard Braman"}}, "url": "https://github.com/CMSgov/dpc-app/commit/60d148e8a7c072a0713a113bdc95ccb83e4d76bd", "committedDate": "2020-06-12T01:04:19Z", "message": "in swagger.json:\nsecurity:\napiKey: []\n\u00a0\nis incorrect. \u00a0Swagger validation throws error:\u00a0Security requirements must match a security definition\n\u00a0\nOur security definition is as follows (see swagger.json line 1538:\u00a0\nsecurityDefinitions:\naccess_token:\nswagger.json should read:\nsecurity:\naccess_token: []\n\u00a0\nrequired changes in Java:\n\u00a0\nall annotations containing apiKey must be changes to access_token\nExample:\n@Api(value = \"Patient\", authorizations = @Authorization(value = \"apiKey\"))\nshould be changed to\n@Api(value = \"Patient\", authorizations = @Authorization(value = \"access_token\"))"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b28b8d39d6e7b04e63fcc6adb4ed8a96e6460f0", "author": {"user": {"login": "richbraman", "name": "Richard Braman"}}, "url": "https://github.com/CMSgov/dpc-app/commit/3b28b8d39d6e7b04e63fcc6adb4ed8a96e6460f0", "committedDate": "2020-06-12T03:31:40Z", "message": "Swagger validation complains that several API operations have multiple body parameters because Parametsr are not annotated correctly\n\nlooking at the Group Resource Update Roster Method, we se:e that none of the Parameters to the method was annotated with @ApiParam\n\npublic Group updateRoster(@ApiParam(value = \"Attribution roster ID\") @PathParam(\"rosterID\") UUID rosterID,\n@Valid @Profiled(profile = AttestationProfile.PROFILE_URI)\n@ProvenanceHeader Provenance rosterAttestation,\nGroup rosterUpdate) {....\n\nso we can change like this\n\npublic Group updateRoster(@ApiParam(value = \"Attribution roster ID\") @PathParam(\"rosterID\") UUID rosterID,\n@Valid @Profiled(profile = AttestationProfile.PROFILE_URI)\n@ProvenanceHeader Provenance rosterAttestation,\n@ApiParam Group rosterUpdate) {....\n\nThis may require additional annotations on the Provenance rosterAttestation parameters, but we should try the minimal additions first."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4368ff897fca3dcc6a168c022912940d267d0d48", "author": {"user": {"login": "richbraman", "name": "Richard Braman"}}, "url": "https://github.com/CMSgov/dpc-app/commit/4368ff897fca3dcc6a168c022912940d267d0d48", "committedDate": "2020-06-12T03:38:18Z", "message": "updated pom.xml to latest version of dropwizard"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4b17f6ead9f96d557081f12372e01b4d2288d9d", "author": {"user": {"login": "richbraman", "name": "Richard Braman"}}, "url": "https://github.com/CMSgov/dpc-app/commit/b4b17f6ead9f96d557081f12372e01b4d2288d9d", "committedDate": "2020-06-12T23:19:03Z", "message": "found a few more places where the auth method was wrong, previous commit eliminated errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dac9c45c4b38af62c9b10b76e7f8d4518ef27d0a", "author": {"user": {"login": "richbraman", "name": "Richard Braman"}}, "url": "https://github.com/CMSgov/dpc-app/commit/dac9c45c4b38af62c9b10b76e7f8d4518ef27d0a", "committedDate": "2020-06-15T21:44:01Z", "message": "these annotations produce valid swagger outout for all resources except Endpoint which still has some swagger syntax errors on the parameters to create and update."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab3041cacf827b50f949b7edf3ffe5bdcd960f3d", "author": {"user": {"login": "richbraman", "name": "Richard Braman"}}, "url": "https://github.com/CMSgov/dpc-app/commit/ab3041cacf827b50f949b7edf3ffe5bdcd960f3d", "committedDate": "2020-06-15T22:56:42Z", "message": "experimental config of maven swagger plugin"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxMDU4Nzcw", "url": "https://github.com/CMSgov/dpc-app/pull/857#pullrequestreview-431058770", "createdAt": "2020-06-15T23:27:14Z", "commit": {"oid": "dac9c45c4b38af62c9b10b76e7f8d4518ef27d0a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQyMzoyNzoxNFrOGkGBpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQyMzoyNzoxNFrOGkGBpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUwMDY0NQ==", "bodyText": "Should this be deleted?", "url": "https://github.com/CMSgov/dpc-app/pull/857#discussion_r440500645", "createdAt": "2020-06-15T23:27:14Z", "author": {"login": "dhgreene"}, "path": "pom.xml", "diffHunk": "@@ -194,6 +194,7 @@\n                 <artifactId>hapi-fhir-structures-r4</artifactId>\n                 <version>${hapi.fhir.version}</version>\n             </dependency>\n+            <!-- https://mvnrepository.com/artifact/com.smoketurner/dropwizard-swagger -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dac9c45c4b38af62c9b10b76e7f8d4518ef27d0a"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c29e3fe6fef83919eb4476ad38140bddaf86ef6b", "author": {"user": {"login": "richbraman", "name": "Richard Braman"}}, "url": "https://github.com/CMSgov/dpc-app/commit/c29e3fe6fef83919eb4476ad38140bddaf86ef6b", "committedDate": "2020-06-22T13:06:05Z", "message": "removed mistaken comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0OTA3Mzg2", "url": "https://github.com/CMSgov/dpc-app/pull/857#pullrequestreview-434907386", "createdAt": "2020-06-22T13:11:35Z", "commit": {"oid": "c29e3fe6fef83919eb4476ad38140bddaf86ef6b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7711f571507c0db765db7420becdff471b198fc6", "author": {"user": {"login": "richbraman", "name": "Richard Braman"}}, "url": "https://github.com/CMSgov/dpc-app/commit/7711f571507c0db765db7420becdff471b198fc6", "committedDate": "2020-06-22T13:17:26Z", "message": "Merge branch 'master' into DPC-354-Swagger"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1MjcyMjcw", "url": "https://github.com/CMSgov/dpc-app/pull/857#pullrequestreview-435272270", "createdAt": "2020-06-22T21:03:43Z", "commit": {"oid": "7711f571507c0db765db7420becdff471b198fc6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMTowMzo0M1rOGnQ7XQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMTowMzo0M1rOGnQ7XQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzgyNDk4OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public Response createEndpoint(@ApiParam(hidden=true) @Auth OrganizationPrincipal organizationPrincipal,\n          \n          \n            \n                public Response createEndpoint(@ApiParam(hidden = true) @Auth OrganizationPrincipal organizationPrincipal,\n          \n      \n    \n    \n  \n\nFor readability, we've tried to be consistent with annotation format. Can we keep spaces around the = in all the changes in this PR?", "url": "https://github.com/CMSgov/dpc-app/pull/857#discussion_r443824989", "createdAt": "2020-06-22T21:03:43Z", "author": {"login": "em1"}, "path": "dpc-api/src/main/java/gov/cms/dpc/api/resources/v1/EndpointResource.java", "diffHunk": "@@ -46,7 +46,8 @@\n             @ApiResponse(code = 422, message = \"Endpoint not valid\")\n     })\n     @Override\n-    public Response createEndpoint(@ApiParam(hidden = true) @Auth OrganizationPrincipal organizationPrincipal, @Valid @Profiled(profile = EndpointProfile.PROFILE_URI) Endpoint endpoint) {\n+    public Response createEndpoint(@ApiParam(hidden=true) @Auth OrganizationPrincipal organizationPrincipal,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7711f571507c0db765db7420becdff471b198fc6"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1MzM3NjQ1", "url": "https://github.com/CMSgov/dpc-app/pull/857#pullrequestreview-435337645", "createdAt": "2020-06-22T23:19:09Z", "commit": {"oid": "7711f571507c0db765db7420becdff471b198fc6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMzoxOToxMFrOGnUCvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMzoxOToxMFrOGnUCvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg3NjAyOQ==", "bodyText": "Not sure if it was intentional, but if endpointID is a path param should it not remain with the @NotNull constraint?\nThis branch also seems to be failing due to the missing @NotNull on this particular operation, not including the annotation causes all the tests under EndpointResourceTest.java to fail. (Not sure why, maybe some sort of validation is causing this entire resource not to be loaded.)\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public Endpoint updateEndpoint(@ApiParam(value = \"Your Organization's FHIR Endpoint ID\") @PathParam(\"endpointID\") UUID endpointID,\n          \n          \n            \n                public Endpoint updateEndpoint(@ApiParam(value = \"Your Organization's FHIR Endpoint ID\") @NotNull @PathParam(\"endpointID\") UUID endpointID,", "url": "https://github.com/CMSgov/dpc-app/pull/857#discussion_r443876029", "createdAt": "2020-06-22T23:19:10Z", "author": {"login": "MrMorie"}, "path": "dpc-api/src/main/java/gov/cms/dpc/api/resources/v1/EndpointResource.java", "diffHunk": "@@ -102,14 +103,15 @@ public Endpoint fetchEndpoint(@NotNull @PathParam(\"endpointID\") UUID endpointID)\n     @FHIR\n     @Timed\n     @ExceptionMetered\n-    @ApiOperation(value = \"Update an Endpoint\", notes = \"Update an Endpoint resource\")\n+    @ApiOperation(value = \"Update an Organization's FHIR Server Endpoint\", notes = \"Update an Endpoint resource\")\n     @ApiResponses(value = {\n             @ApiResponse(code = 200, message = \"Endpoint updated\"),\n             @ApiResponse(code = 404, message = \"Endpoint not found\"),\n             @ApiResponse(code = 422, message = \"Endpoint not valid\")\n     })\n     @Override\n-    public Endpoint updateEndpoint(@NotNull @PathParam(\"endpointID\") UUID endpointID, @Valid @Profiled(profile = EndpointProfile.PROFILE_URI) Endpoint endpoint) {\n+    public Endpoint updateEndpoint(@ApiParam(value = \"Your Organization's FHIR Endpoint ID\") @PathParam(\"endpointID\") UUID endpointID,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7711f571507c0db765db7420becdff471b198fc6"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1MzQwMjI1", "url": "https://github.com/CMSgov/dpc-app/pull/857#pullrequestreview-435340225", "createdAt": "2020-06-22T23:26:39Z", "commit": {"oid": "7711f571507c0db765db7420becdff471b198fc6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMzoyNjozOVrOGnULEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMzoyNjozOVrOGnULEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg3ODE2Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        @ApiImplicitParam(name = \"X-Provenance\", value = \"Provenance Resource attesting to Group attribution\",  required = true, paramType = \"header\", type=\"string\", dataTypeClass = Provenance.class)//,\n          \n          \n            \n                        @ApiImplicitParam(name = \"X-Provenance\", value = \"Provenance Resource attesting to Group attribution\",  required = true, paramType = \"header\", type=\"string\", dataTypeClass = Provenance.class)\n          \n      \n    \n    \n  \n\nTiny stray comment.", "url": "https://github.com/CMSgov/dpc-app/pull/857#discussion_r443878162", "createdAt": "2020-06-22T23:26:39Z", "author": {"login": "em1"}, "path": "dpc-api/src/main/java/gov/cms/dpc/api/resources/v1/GroupResource.java", "diffHunk": "@@ -158,15 +157,17 @@ public Group getRoster(@ApiParam(value = \"Attribution roster ID\") @PathParam(\"ro\n     @FHIR\n     @Timed\n     @ExceptionMetered\n-    @ApiOperation(value = \"Update Attribution Roster\", notes = \"Update specific Attribution roster.\" +\n-            \"<p>Updates allow for adding or removing patients from the roster.\")\n+    @ApiOperation(value = \"Update Attribution Group\", notes = \"Update specific Attribution Group.\" +\n+            \"<p>Updates allow for adding or removing patients as members of an Attribution Group.\")\n     @ApiImplicitParams(\n-            @ApiImplicitParam(name = \"X-Provenance\", required = true, paramType = \"header\", dataTypeClass = Provenance.class))\n+            @ApiImplicitParam(name = \"X-Provenance\", value = \"Provenance Resource attesting to Group attribution\",  required = true, paramType = \"header\", type=\"string\", dataTypeClass = Provenance.class)//,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7711f571507c0db765db7420becdff471b198fc6"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "386d5d534604c425e295ff924ecc39f43015b127", "author": {"user": {"login": "richbraman", "name": "Richard Braman"}}, "url": "https://github.com/CMSgov/dpc-app/commit/386d5d534604c425e295ff924ecc39f43015b127", "committedDate": "2020-06-22T23:34:06Z", "message": "Update dpc-api/src/main/java/gov/cms/dpc/api/resources/v1/GroupResource.java\r\n\r\nremoved errant comment\n\nCo-authored-by: Emily Hart <1923441+embh@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "617aeb4d78ab6509fb75ac37003cbb9d4d4dad4d", "author": {"user": {"login": "richbraman", "name": "Richard Braman"}}, "url": "https://github.com/CMSgov/dpc-app/commit/617aeb4d78ab6509fb75ac37003cbb9d4d4dad4d", "committedDate": "2020-06-22T23:35:20Z", "message": "Update dpc-api/src/main/java/gov/cms/dpc/api/resources/v1/EndpointResource.java\r\n\r\nadd @notnull back in.  seems to be a relic of local testing of why endpoint notation does NOT produce valid swagger because it has two body params\n\nCo-authored-by: SalGutierrez <43150956+SalGutierrez@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a909f8220812948c0b6bb9ea5059db28a7df4964", "author": {"user": {"login": "richbraman", "name": "Richard Braman"}}, "url": "https://github.com/CMSgov/dpc-app/commit/a909f8220812948c0b6bb9ea5059db28a7df4964", "committedDate": "2020-06-22T23:37:00Z", "message": "Update dpc-api/src/main/java/gov/cms/dpc/api/resources/v1/EndpointResource.java\n\nCo-authored-by: Emily Hart <1923441+embh@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad3e5483c559103e20b0cf6b60a9d45cb30f9723", "author": {"user": {"login": "richbraman", "name": "Richard Braman"}}, "url": "https://github.com/CMSgov/dpc-app/commit/ad3e5483c559103e20b0cf6b60a9d45cb30f9723", "committedDate": "2020-06-23T00:09:28Z", "message": "Merge branch 'master' into DPC-354-Swagger"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 496, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}