{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyNjk1NTA4", "number": 1061, "title": "DPC-732: Basic performance test suite for /Token endpoints", "bodyText": "Fixes DPC-732\nDPC is setting up a basic performance test suite for attribution endpoints.\nProposed Changes\nThis pull request adds performance tests for the /Token endpoints.\nChange Details\nTests include:\n\nPOST /Token\nPOST /Token/validate\nPOST /Token/auth\nGET /Token\nGET /Token/{id}\nDELETE /Token/{id}\n\nThe new tests are in token.go, and the existing /Key endpoint tests have been moved into key.go.\nSecurity Implications\nThis contains tests only. No security impacts.\n\n\n new software dependencies\n\n\n security controls or supporting software altered\n\n\n new data stored or transmitted\n\n\n security checklist is completed for this change\n\n\n requires more information or team discussion to evaluate security implications\n\n\n no PHI/PII is affected by this change\n\n\nAcceptance Validation\n\nFeedback Requested\nAny", "createdAt": "2020-09-24T20:57:34Z", "url": "https://github.com/CMSgov/dpc-app/pull/1061", "merged": true, "mergeCommit": {"oid": "ee03dace0adec09692f96ca7e2e8a057513d7aa2"}, "closed": true, "closedAt": "2020-10-01T17:45:17Z", "author": {"login": "em1"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMC9UngH2gAyNDkyNjk1NTA4OjRkMGE4OGMyZjc3M2I1OGM4OGI5ZDBkYzc0YzQxYzE5ZjBjN2FkNTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOPRn4AH2gAyNDkyNjk1NTA4OmNmMTliYTljMzgxYjQ0ZDE5OTFjZThlMTU3MmY4ZDg5YmIxNDQwYjc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4d0a88c2f773b58c88b9d0dc74c41c19f0c7ad51", "author": {"user": {"login": "em1", "name": null}}, "url": "https://github.com/CMSgov/dpc-app/commit/4d0a88c2f773b58c88b9d0dc74c41c19f0c7ad51", "committedDate": "2020-09-24T15:31:07Z", "message": "Token perf testing WIP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5533f3e31a768a1ffcef035bcb26828dcf1d86ef", "author": {"user": {"login": "em1", "name": null}}, "url": "https://github.com/CMSgov/dpc-app/commit/5533f3e31a768a1ffcef035bcb26828dcf1d86ef", "committedDate": "2020-09-24T15:31:07Z", "message": "More /Token testing in progress"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68a00ef1b2f913540714ac83877e961d4b27b58f", "author": {"user": {"login": "em1", "name": null}}, "url": "https://github.com/CMSgov/dpc-app/commit/68a00ef1b2f913540714ac83877e961d4b27b58f", "committedDate": "2020-09-24T15:31:07Z", "message": "Move Token/validate requests before Token/auth; un-comment DELETE test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1OTQ2NDM4", "url": "https://github.com/CMSgov/dpc-app/pull/1061#pullrequestreview-495946438", "createdAt": "2020-09-24T20:58:57Z", "commit": {"oid": "68a00ef1b2f913540714ac83877e961d4b27b58f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQyMDo1ODo1OFrOHXsZ-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQyMDo1ODo1OFrOHXsZ-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDYwNjg0MQ==", "bodyText": "Function testTokenEndpoints has 73 lines of code (exceeds 50 allowed). Consider refactoring.", "url": "https://github.com/CMSgov/dpc-app/pull/1061#discussion_r494606841", "createdAt": "2020-09-24T20:58:58Z", "author": {"login": "codeclimate"}, "path": "dpc-testing/performance/token.go", "diffHunk": "@@ -0,0 +1,153 @@\n+package main\n+\n+import (\n+\t\"container/list\"\n+\t\"crypto/rsa\"\n+\t\"encoding/json\"\n+\t\"fmt\"\n+\t\"net/url\"\n+\n+\tdpcclient \"github.com/CMSgov/dpc-app/dpcclient/lib\"\n+\tvegeta \"github.com/tsenart/vegeta/lib\"\n+)\n+\n+type ClientTokenResp struct {\n+\tResource\n+\tClientToken []byte `json:\"token\"`\n+}\n+\n+type AccessTokenResp struct {\n+\tResource\n+\tAccessToken string `json:\"access_token\"`\n+}\n+\n+func testTokenEndpoints(accessToken string, privateKey *rsa.PrivateKey, keyID string, clientToken []byte) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68a00ef1b2f913540714ac83877e961d4b27b58f"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5ODIwNDU0", "url": "https://github.com/CMSgov/dpc-app/pull/1061#pullrequestreview-499820454", "createdAt": "2020-09-30T21:20:01Z", "commit": {"oid": "68a00ef1b2f913540714ac83877e961d4b27b58f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMToyMDowMVrOHavvNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMToyMDowMVrOHavvNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzgwNzE1Ng==", "bodyText": "This is probably due to my limited knowledge of Go, but I'm not finding the definition of generateKeyPairAndSignature", "url": "https://github.com/CMSgov/dpc-app/pull/1061#discussion_r497807156", "createdAt": "2020-09-30T21:20:01Z", "author": {"login": "jonfulk"}, "path": "dpc-testing/performance/key.go", "diffHunk": "@@ -0,0 +1,74 @@\n+package main\n+\n+import (\n+\t\"encoding/json\"\n+\t\"fmt\"\n+\n+\tvegeta \"github.com/tsenart/vegeta/lib\"\n+)\n+\n+func testKeyEndpoints(accessToken string) {\n+\n+\tresps := runTestWithTargeter(fmt.Sprintf(\"POST %s/Key\", apiURL), newPOSTKeyTargeter(accessToken), 5, 5)\n+\tvar keyIDs []string\n+\tfor _, resp := range resps {\n+\t\tvar result Resource\n+\t\tjson.Unmarshal(resp, &result)\n+\t\tkeyIDs = append(keyIDs, result.ID)\n+\t}\n+\n+\tgetKeysTarget := vegeta.Target{\n+\t\tMethod: \"GET\",\n+\t\tURL:    fmt.Sprintf(\"%s%s\", apiURL, \"/Key\"),\n+\t\tHeader: map[string][]string{\n+\t\t\t\"Accept\":        {\"application/json\"},\n+\t\t\t\"Authorization\": {fmt.Sprintf(\"Bearer %s\", accessToken)},\n+\t\t},\n+\t}\n+\trunTest(getKeysTarget, 5, 5)\n+\n+\tgetKeyTarget := vegeta.Target{\n+\t\tMethod: \"GET\",\n+\t\tURL:    fmt.Sprintf(\"%s%s%s\", apiURL, \"/Key/\", keyIDs[0]),\n+\t\tHeader: map[string][]string{\n+\t\t\t\"Accept\":        {\"application/json\"},\n+\t\t\t\"Authorization\": {fmt.Sprintf(\"Bearer %s\", accessToken)},\n+\t\t},\n+\t}\n+\trunTest(getKeyTarget, 5, 5)\n+\n+\tdeleteKeyTargeter := newDELETEKeyTargeter(accessToken, func() string {\n+\t\tkeyID := keyIDs[0]\n+\t\tkeyIDs = keyIDs[1:]\n+\t\treturn keyID\n+\t})\n+\trunTestWithTargeter(fmt.Sprintf(\"DELETE %s/Key/{id}\", apiURL), deleteKeyTargeter, 5, 5)\n+}\n+\n+func newPOSTKeyTargeter(accessToken string) vegeta.Targeter {\n+\treturn func(t *vegeta.Target) error {\n+\t\tt.Method = \"POST\"\n+\t\tt.URL = fmt.Sprintf(\"%s/Key\", apiURL)\n+\t\tt.Header = map[string][]string{\n+\t\t\t\"Content-Type\":  {\"application/json\"},\n+\t\t\t\"Authorization\": {fmt.Sprintf(\"Bearer %s\", accessToken)},\n+\t\t}\n+\n+\t\tpubKeyStr, _, signature := generateKeyPairAndSignature()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68a00ef1b2f913540714ac83877e961d4b27b58f"}, "originalPosition": 57}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5OTY0MTI1", "url": "https://github.com/CMSgov/dpc-app/pull/1061#pullrequestreview-499964125", "createdAt": "2020-10-01T02:02:23Z", "commit": {"oid": "68a00ef1b2f913540714ac83877e961d4b27b58f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5OTkzNjQy", "url": "https://github.com/CMSgov/dpc-app/pull/1061#pullrequestreview-499993642", "createdAt": "2020-10-01T04:00:38Z", "commit": {"oid": "68a00ef1b2f913540714ac83877e961d4b27b58f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf19ba9c381b44d1991ce8e1572f8d89bb1440b7", "author": {"user": {"login": "em1", "name": null}}, "url": "https://github.com/CMSgov/dpc-app/commit/cf19ba9c381b44d1991ce8e1572f8d89bb1440b7", "committedDate": "2020-10-01T11:00:00Z", "message": "Merge branch 'master' into emily/dpc-732-perf-test-token"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 390, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}