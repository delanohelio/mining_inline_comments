{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3OTI3MzA2", "number": 627, "title": "Fix broken token creation in sandbox", "bodyText": "Why\nThe sandbox API is currently configured to use the production API URL. This is causing a number of problems with token creation.\nWhat Changed\nThe configuration URL of the sandbox API has been changed from https://dpc.cms.gov/api to https://sandbox.dpc.cms.gov/api.\nChoices Made\nThis change will break token creation for users who were using the incorrect URL, but working URL. In our documentation we say to use https://sandbox.dpc.cms.gov/api/v1/Token/auth for the aud claim, but this was never actually working in sandbox. Users had to use https://dpc.cms.gov/api/v1/Token/auth as the aud claim for token authentication to work.\nThis is a change we will need to communicate to our Google Group. It's going to fix it for some users, as it matches what's in our documentation, but it's going to break it for others who were using the incorrect URL.\nWe need to make this change, because we have locked down the https://dpc.cms.gov/api/ domain in preparation for actually launching production. We can no longer have users make API requests to sandbox through the production URL.\nTickets closed:\nFuture Work\n\nCommunicate this on the Google Group.\nVerify the website is not also using the incorrect value for token creation in sandbox. @switzersc-usds @Sun-Mountain\n\nChecklist\n\n All tests are passing via make ci-app (app change) and make ci-web (website change)\n Swagger documentation has been updated\n FHIR documentation has been updated\n Any required dpc-ops changes have a PR submitted and mentioned in this ticket\n Any manual migration steps are documented, scripts written (where applicable), and tested\n Before merging, any required dpc-ops changes have been approved and merged into master of the dpc-ops repo", "createdAt": "2020-02-20T19:14:36Z", "url": "https://github.com/CMSgov/dpc-app/pull/627", "merged": true, "mergeCommit": {"oid": "9b4f0931e703d0a68b0e21c4e7ffc2120c3ad24d"}, "closed": true, "closedAt": "2020-02-20T20:02:57Z", "author": {"login": "ronaldheft-usds"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcGP7ebAH2gAyMzc3OTI3MzA2OjEzMjhjOTcwMjUxNDUxMjMyODRjYjQ5ZmYwM2RhZDJmYmQ1NzdkOWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGQo7mgFqTM2MjE4ODc4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1328c97025145123284cb49ff03dad2fbd577d9f", "author": {"user": {"login": "ronaldheft-usds", "name": "Ron Heft"}}, "url": "https://github.com/CMSgov/dpc-app/commit/1328c97025145123284cb49ff03dad2fbd577d9f", "committedDate": "2020-02-20T19:03:10Z", "message": "Fix root URL of sandbox API"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMTc1MjE4", "url": "https://github.com/CMSgov/dpc-app/pull/627#pullrequestreview-362175218", "createdAt": "2020-02-20T19:32:06Z", "commit": {"oid": "1328c97025145123284cb49ff03dad2fbd577d9f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxOTozMjowNlrOFsgZHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxOTozMjowNlrOFsgZHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjIxMjM4Mg==", "bodyText": "In the website for token creation, we use this endpoint: ENV[\"API_METADATA_URL_SANDBOX\"] + '/Token'.\nSo, we'll just want to make sure the API_METADATA_URL_SANDBOX is set correctly. I believe it should be set to https://sandbox.dpc.cms.gov/api/v1, correct? Which has v1 whereas the publicURL here does not.", "url": "https://github.com/CMSgov/dpc-app/pull/627#discussion_r382212382", "createdAt": "2020-02-20T19:32:06Z", "author": {"login": "switzersc-usds"}, "path": "dpc-api/src/main/resources/prod-sbx.application.conf", "diffHunk": "@@ -1,6 +1,6 @@\n dpc.api {\n \n-    publicURL = \"https://dpc.cms.gov/api\" # The root URL at which the application is accessible, if necssary, include the port, do not include the application version\n+    publicURL = \"https://sandbox.dpc.cms.gov/api\" # The root URL at which the application is accessible, if necssary, include the port, do not include the application version", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1328c97025145123284cb49ff03dad2fbd577d9f"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMTgwMDE5", "url": "https://github.com/CMSgov/dpc-app/pull/627#pullrequestreview-362180019", "createdAt": "2020-02-20T19:39:20Z", "commit": {"oid": "1328c97025145123284cb49ff03dad2fbd577d9f"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxOTozOToyMFrOFsgn2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxOTozOToyMFrOFsgn2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjIxNjE1Mg==", "bodyText": "Great, then this should be good to go from the website side of things.", "url": "https://github.com/CMSgov/dpc-app/pull/627#discussion_r382216152", "createdAt": "2020-02-20T19:39:20Z", "author": {"login": "switzersc-usds"}, "path": "dpc-api/src/main/resources/prod-sbx.application.conf", "diffHunk": "@@ -1,6 +1,6 @@\n dpc.api {\n \n-    publicURL = \"https://dpc.cms.gov/api\" # The root URL at which the application is accessible, if necssary, include the port, do not include the application version\n+    publicURL = \"https://sandbox.dpc.cms.gov/api\" # The root URL at which the application is accessible, if necssary, include the port, do not include the application version", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjIxMjM4Mg=="}, "originalCommit": {"oid": "1328c97025145123284cb49ff03dad2fbd577d9f"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMTg4Nzgx", "url": "https://github.com/CMSgov/dpc-app/pull/627#pullrequestreview-362188781", "createdAt": "2020-02-20T19:52:49Z", "commit": {"oid": "1328c97025145123284cb49ff03dad2fbd577d9f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 271, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}