{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyMTMzNjU2", "number": 814, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQyMToxMDoxOVrOD_EhcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxNDo0NzowMVrOD_tSvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NDYwOTc3OnYy", "diffSide": "RIGHT", "path": "dpc-api/src/main/java/gov/cms/dpc/api/cli/keys/KeyUpload.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQyMToxMDoxOVrOGZjsog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQyMToxMDoxOVrOGZjsog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQ1MjQ1MA==", "bodyText": "Method uploadKey has 5 arguments (exceeds 4 allowed). Consider refactoring.", "url": "https://github.com/CMSgov/dpc-app/pull/814#discussion_r429452450", "createdAt": "2020-05-22T21:10:19Z", "author": {"login": "codeclimate"}, "path": "dpc-api/src/main/java/gov/cms/dpc/api/cli/keys/KeyUpload.java", "diffHunk": "@@ -59,25 +70,31 @@ public void run(Bootstrap<?> bootstrap, Namespace namespace) throws Exception {\n         System.out.println(String.format(\"Connecting to API service at: %s\", apiService));\n \n         // Read the file and parse it\n-        final Path filePath = FileSystems.getDefault().getPath(namespace.getString(KEY_FILE));\n-        final String pemFile = Files.readString(filePath);\n+        final Path keyFilePath = FileSystems.getDefault().getPath(namespace.getString(KEY_FILE));\n+        final String publicKey = Files.readString(keyFilePath);\n+\n+        final Path signaturePath = FileSystems.getDefault().getPath(namespace.getString(SIGNATURE_FILE));\n+        final String signature = Files.readString(signaturePath);\n \n         final Optional<String> label = Optional.ofNullable(namespace.getString(\"key-label\"));\n-        uploadKey(apiService, orgID.getIdPart(), label, pemFile);\n+        uploadKey(apiService, orgID.getIdPart(), label, publicKey, signature);\n     }\n \n     @SuppressWarnings(\"OptionalUsedAsFieldOrParameterType\")\n-    private void uploadKey(String apiService, String orgID, Optional<String> label, String pem) throws IOException, URISyntaxException {\n+    private void uploadKey(String apiService, String orgID, Optional<String> label, String pem, String signature) throws IOException, URISyntaxException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4cd0c7e7b343b7bab1a4663f30feae9401d4d15"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MTI4OTU3OnYy", "diffSide": "RIGHT", "path": "dpc-api/src/main/java/gov/cms/dpc/api/auth/jwt/PublicKeyHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxNDo0NzowMVrOGahy9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxNzo1OTozMFrOGap7pA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ2OTg3OA==", "bodyText": "Are we certain at this point in the code that we're not dealing with an ECC signature?", "url": "https://github.com/CMSgov/dpc-app/pull/814#discussion_r430469878", "createdAt": "2020-05-26T14:47:01Z", "author": {"login": "dhgreene"}, "path": "dpc-api/src/main/java/gov/cms/dpc/api/auth/jwt/PublicKeyHandler.java", "diffHunk": "@@ -91,6 +90,30 @@ public static void validatePublicKey(SubjectPublicKeyInfo value) {\n \n     }\n \n+    public static boolean verifySignature(String publicKeyPem, String snippet, String sigStr) {\n+        String keyStr = publicKeyPem\n+                .replace(\"-----BEGIN PUBLIC KEY-----\", \"\")\n+                .replace(\"-----END PUBLIC KEY-----\", \"\")\n+                .replaceAll(\"[\\n\\r]+\", \"\");\n+        sigStr = sigStr.replaceAll(\"[\\n\\r]+\", \"\");\n+\n+        try {\n+            byte[] keyBytes = Base64.getDecoder().decode(keyStr);\n+            X509EncodedKeySpec keySpec = new X509EncodedKeySpec(keyBytes);\n+            KeyFactory keyFactory = KeyFactory.getInstance(\"RSA\");\n+            PublicKey publicKey = keyFactory.generatePublic(keySpec);\n+\n+            Signature signature = Signature.getInstance(\"SHA256withRSA\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDYwMzE3Mg==", "bodyText": "Good catch! Added a check here. https://github.com/CMSgov/dpc-app/pull/814/files#diff-064337c58bb98d2ffe6a3d1a993e68deR151-R153", "url": "https://github.com/CMSgov/dpc-app/pull/814#discussion_r430603172", "createdAt": "2020-05-26T17:59:30Z", "author": {"login": "em1"}, "path": "dpc-api/src/main/java/gov/cms/dpc/api/auth/jwt/PublicKeyHandler.java", "diffHunk": "@@ -91,6 +90,30 @@ public static void validatePublicKey(SubjectPublicKeyInfo value) {\n \n     }\n \n+    public static boolean verifySignature(String publicKeyPem, String snippet, String sigStr) {\n+        String keyStr = publicKeyPem\n+                .replace(\"-----BEGIN PUBLIC KEY-----\", \"\")\n+                .replace(\"-----END PUBLIC KEY-----\", \"\")\n+                .replaceAll(\"[\\n\\r]+\", \"\");\n+        sigStr = sigStr.replaceAll(\"[\\n\\r]+\", \"\");\n+\n+        try {\n+            byte[] keyBytes = Base64.getDecoder().decode(keyStr);\n+            X509EncodedKeySpec keySpec = new X509EncodedKeySpec(keyBytes);\n+            KeyFactory keyFactory = KeyFactory.getInstance(\"RSA\");\n+            PublicKey publicKey = keyFactory.generatePublic(keySpec);\n+\n+            Signature signature = Signature.getInstance(\"SHA256withRSA\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ2OTg3OA=="}, "originalCommit": null, "originalPosition": 31}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4893, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}