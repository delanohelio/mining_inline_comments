{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg2NjQ1Mjky", "number": 1041, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMDozNTowN1rOEjw-sA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMDo0NzowMFrOEjxOMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1OTM4MDk2OnYy", "diffSide": "RIGHT", "path": "dpc-web/app/controllers/internal/organizations_controller.rb", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMDozNTowN1rOHSTkYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMDozNTowN1rOHSTkYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk1NzAyNw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    flash[:alert] = 'Enabled organization require an NPI.'\n          \n          \n            \n                    flash[:alert] = 'Enabled organizations require an NPI.'", "url": "https://github.com/CMSgov/dpc-app/pull/1041#discussion_r488957027", "createdAt": "2020-09-15T20:35:07Z", "author": {"login": "dhgreene"}, "path": "dpc-web/app/controllers/internal/organizations_controller.rb", "diffHunk": "@@ -65,7 +65,10 @@ def edit\n     def update\n       @organization = Organization.find id_param\n \n-      if @organization.update organization_params\n+      if organization_enabled?(@organization) && npi_blank?\n+        flash[:alert] = 'Enabled organization require an NPI.'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfb5b76f76b26848f4009917702d2cec2de07d2b"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1OTQyMDY1OnYy", "diffSide": "RIGHT", "path": "dpc-web/app/controllers/internal/organizations_controller.rb", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMDo0NzowMFrOHST8mw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMjo1MToyNlrOHSvTTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk2MzIyNw==", "bodyText": "This works, but I wonder if you could use rails require to enforce the parameter.\n    def organization_params\n      params.require(:organization).permit(\n        :name, :organization_type, :num_providers, :npi, :vendor,\n        address_attributes: %i[id street street_2 city state zip address_use address_type]\n      ).tap do |org_params|\n        org_params.require(:npi)\n      end\n    end\n\nThat may just force an error automatically", "url": "https://github.com/CMSgov/dpc-app/pull/1041#discussion_r488963227", "createdAt": "2020-09-15T20:47:00Z", "author": {"login": "SMLuthi"}, "path": "dpc-web/app/controllers/internal/organizations_controller.rb", "diffHunk": "@@ -119,6 +122,16 @@ def delete_user_from_org\n       end\n     end\n \n+    def npi_blank?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfb5b76f76b26848f4009917702d2cec2de07d2b"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQwODczMA==", "bodyText": "Can you also specify an error this way?\nThe reason I went with this method was so I could throw flash[:alert] = 'Enabled organization require an NPI.'", "url": "https://github.com/CMSgov/dpc-app/pull/1041#discussion_r489408730", "createdAt": "2020-09-16T12:47:19Z", "author": {"login": "Sun-Mountain"}, "path": "dpc-web/app/controllers/internal/organizations_controller.rb", "diffHunk": "@@ -119,6 +122,16 @@ def delete_user_from_org\n       end\n     end\n \n+    def npi_blank?", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk2MzIyNw=="}, "originalCommit": {"oid": "dfb5b76f76b26848f4009917702d2cec2de07d2b"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQxMTQwNg==", "bodyText": "Also this requires an npi on creation, which we may not know immediately.", "url": "https://github.com/CMSgov/dpc-app/pull/1041#discussion_r489411406", "createdAt": "2020-09-16T12:51:26Z", "author": {"login": "Sun-Mountain"}, "path": "dpc-web/app/controllers/internal/organizations_controller.rb", "diffHunk": "@@ -119,6 +122,16 @@ def delete_user_from_org\n       end\n     end\n \n+    def npi_blank?", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk2MzIyNw=="}, "originalCommit": {"oid": "dfb5b76f76b26848f4009917702d2cec2de07d2b"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 80, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}