{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2MDU5NDQ5", "number": 556, "title": "DPC-248: Enable distributed tracing", "bodyText": "Why\nWe'd like to take advantage of the distributed tracing features in New Relic, in order to improve our ability to debug performance issues in production.\nWhat Changed\nEnabled the distributed_tracing flag in the newrelic.yml for both the Java and Ruby services.\nAlso enabled a manual @Tracing annotation in the aggregation service, since it's not actually being traced correctly.\nRequires ops changes as part of: CMSgov/dpc-ops#115\nChoices Made\nThere are some gaps in the tracing coverage that we'll want to address in the future (e.g. the aggregation service isn't traced at all), but we can improve those areas piece-meal once we have a better understanding of useful information in production.\nTickets closed:\nDPC-248\nFuture Work\nDPC-958: Enable tracing for aggregation service\nDPC-960: Improve tracing for queue database\nChecklist\n\n All tests are passing via make ci-app (app change) and make ci-web (website change)\n Swagger documentation has been updated\n FHIR documentation has been updated\n Any required dpc-ops changes have a PR submitted and mentioned in this ticket\n Any manual migration steps are documented, scripts written (where applicable), and tested\n Before merging, any required dpc-ops changes have been approved and merged into master of the dpc-ops repo", "createdAt": "2020-01-22T20:57:17Z", "url": "https://github.com/CMSgov/dpc-app/pull/556", "merged": true, "mergeCommit": {"oid": "c195237472bae86d368fb047faea8bb78df60c55"}, "closed": true, "closedAt": "2020-01-23T17:19:00Z", "author": {"login": "nickrobison-usds"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb84JhQAH2gAyMzY2MDU5NDQ5OjA0Y2E1Yzc1NzNkMmE0YWNhOWIwNzdmODU0ODNmNzk3ZTI5YWE5NjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb9Nab4gFqTM0NzQ2MDc2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "04ca5c7573d2a4aca9b077f85483f797e29aa961", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/04ca5c7573d2a4aca9b077f85483f797e29aa961", "committedDate": "2020-01-22T16:15:28Z", "message": "DPC-248: Enable distributed tracing\n\nUpdate the newrelic.yml file to enable distributed tracing."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebcc9f6e5bd76011603fd22090435152a3816341", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/ebcc9f6e5bd76011603fd22090435152a3816341", "committedDate": "2020-01-22T18:00:24Z", "message": "DPC-248: Disable cross app tracing and enable trace logging\n\nTry to make things more verbose, as well as disable cross application tracing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2108a1c376f12b4eec6d9d4de7e1c48a1d0b999f", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/2108a1c376f12b4eec6d9d4de7e1c48a1d0b999f", "committedDate": "2020-01-22T19:01:28Z", "message": "DPC-248: Debug logging only for http headers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a689cdc84098d3619fb97b17580c199cecbba32", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/6a689cdc84098d3619fb97b17580c199cecbba32", "committedDate": "2020-01-22T19:02:06Z", "message": "DPC-248: Temporarily disable circuit breakers."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83cad6b932f6675adabbfd88ff87e8d6148d1d2c", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/83cad6b932f6675adabbfd88ff87e8d6148d1d2c", "committedDate": "2020-01-22T20:41:54Z", "message": "DPC-248: Enable distributed tracing for website.\n\nRe-enable circuit breaker, but increase the GC limit to so that it doesn't die on us."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e8ebce0db09739ac86abc6dbb481b12dd7a4790", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/1e8ebce0db09739ac86abc6dbb481b12dd7a4790", "committedDate": "2020-01-22T20:55:53Z", "message": "DPC-248: Add manual trace transaction to aggregation service\n\nUpdated the aggregation engine to manually trace aggregation jobs.\n\nNot sure which level of granularity we need right now, but this should be a good start."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78ed8070c09aed79187dd2313add1fc548116b75", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/78ed8070c09aed79187dd2313add1fc548116b75", "committedDate": "2020-01-23T12:57:02Z", "message": "Merge branch 'master' into nickrobison/DPC-248-distributed-tracing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MzM3MzY1", "url": "https://github.com/CMSgov/dpc-app/pull/556#pullrequestreview-347337365", "createdAt": "2020-01-23T14:28:39Z", "commit": {"oid": "78ed8070c09aed79187dd2313add1fc548116b75"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNDoyODozOVrOFhAGIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNDozODoxNlrOFhAcZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE0ODg5OQ==", "bodyText": "Is this duplicative of the dependency defined above it? I see this definition lacks the version attribute.", "url": "https://github.com/CMSgov/dpc-app/pull/556#discussion_r370148899", "createdAt": "2020-01-23T14:28:39Z", "author": {"login": "rnagle"}, "path": "dpc-aggregation/pom.xml", "diffHunk": "@@ -120,6 +120,11 @@\n             <version>${newrelic.agent.version}</version>\n             <type>${newrelic.agent.type}</type>\n         </dependency>\n+        <dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78ed8070c09aed79187dd2313add1fc548116b75"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE1MzMzOA==", "bodyText": "Curious -- how did you arrive at this threshold? Wondering how overhead of tracing will interact with the ASG scaling policies. No objection, no blocker here, just thinking out loud.", "url": "https://github.com/CMSgov/dpc-app/pull/556#discussion_r370153338", "createdAt": "2020-01-23T14:36:10Z", "author": {"login": "rnagle"}, "path": "src/main/resources/newrelic.yml", "diffHunk": "@@ -9,6 +9,8 @@ common: &default_settings\n   log_limit_in_kbytes: 0\n   log_daily: false\n   log_file_name: STDOUT\n+  circuit_breaker:\n+    gc_cpu_threshold: 30", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78ed8070c09aed79187dd2313add1fc548116b75"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE1NDU5OA==", "bodyText": "How necessary is this? Have you checked that this does not inadvertently result in logging of sensitive information?", "url": "https://github.com/CMSgov/dpc-app/pull/556#discussion_r370154598", "createdAt": "2020-01-23T14:38:16Z", "author": {"login": "rnagle"}, "path": "src/main/resources/server.conf", "diffHunk": "@@ -53,6 +53,7 @@ logging {\n   }]\n   loggers = {\n     \"liquibase\" = WARN\n+      \"org.apache.http.headers\" = DEBUG", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78ed8070c09aed79187dd2313add1fc548116b75"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f98b697001398ed85a7e9293f7619dd46afacec2", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/f98b697001398ed85a7e9293f7619dd46afacec2", "committedDate": "2020-01-23T16:27:46Z", "message": "DPC-248: Remove debug logging of HTTP headers\n\nIn order to avoid leaking PII into the logs, I'm removing the debug header output. We may want to re-enable this in the future, in order to get some additional visibility into the intra-DPC service traffic."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2787640d2f2c4c3ec1fd629528b7f26ad1c44de7", "author": {"user": {"login": "nickrobison-usds", "name": "Nick Robison"}}, "url": "https://github.com/CMSgov/dpc-app/commit/2787640d2f2c4c3ec1fd629528b7f26ad1c44de7", "committedDate": "2020-01-23T16:27:54Z", "message": "Merge branch 'master' into nickrobison/DPC-248-distributed-tracing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3NDYwNzY2", "url": "https://github.com/CMSgov/dpc-app/pull/556#pullrequestreview-347460766", "createdAt": "2020-01-23T17:01:57Z", "commit": {"oid": "2787640d2f2c4c3ec1fd629528b7f26ad1c44de7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 222, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}