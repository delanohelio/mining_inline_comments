{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2MTQ5NTEx", "number": 675, "title": "DPC-1013: Enable vendors to create API credentials in Sandbox", "bodyText": "Why\nRight now vendors cannot begin development because they can't create API credentials for sandbox. This PR removes that blocker.\nWhat Changed\n\nUse existing javascript/css pattern to show/hide provider-specific\nfields on organization\nShow different content if the organization is a vendor vs provider\nAllow vendor users to create tokens / add keys if org is sandbox-\nenabled (remove NPI requirement)\nEmail vendor users a vendor-specific email once their org has been enabled for sandbox\n\nNow when you are an admin, you see this form when you select \"Health IT Vendor\" for org type:\n\nAnd when you select one of the provider options for org type:\n\nWhen you look at the organization's details page, if it is a vendor, you see the vendor id now instead other NPI and vendor text:\n\nAnd as a vendor user assigned to a sandbox enabled vendor org, you can manage API credentials. You cannot edit your org (since there is no NPI or vendor text to edit):\n\nChoices Made\nThe JavaScript for hiding/showing fields could probably be more elegant but it works and is still readable. We need to set up selenium/capybara for javascript-enabled tests but it's not pressing and is out of scope here (more in the related commit message: 12c52ec).\nTickets closed:\nDPC-1013\nFuture Work\nDPC-1186: Set up selenium/capybara for javascript enabled feature tests.\nChecklist\n\n All tests are passing via make ci-app (app change) and make ci-web (website change)\n Swagger documentation has been updated\n FHIR documentation has been updated\n Any required dpc-ops changes have a PR submitted and mentioned in this ticket\n Any manual migration steps are documented, scripts written (where applicable), and tested\n Before merging, any required dpc-ops changes have been approved and merged into master of the dpc-ops repo", "createdAt": "2020-03-10T13:58:29Z", "url": "https://github.com/CMSgov/dpc-app/pull/675", "merged": true, "mergeCommit": {"oid": "b647e3eaf9c19821260bc4b27c3c220baaa0469c"}, "closed": true, "closedAt": "2020-03-13T19:28:56Z", "author": {"login": "switzersc-usds"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMS5_EAH2gAyMzg2MTQ5NTExOjYzYTE3NmY3ZGU5YmJiM2RkNDJjOWUzYzgzZjc5ZGQxNjRhYmUzNTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcNUrYbgH2gAyMzg2MTQ5NTExOmYyYTkzZDNkZjA0MTE0NGJhY2FhZjg0Zjc4YTIzYWNiMjRlZWNlYTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "63a176f7de9bbb3dd42c9e3c83f79dd164abe357", "author": {"user": null}, "url": "https://github.com/CMSgov/dpc-app/commit/63a176f7de9bbb3dd42c9e3c83f79dd164abe357", "committedDate": "2020-03-10T13:54:48Z", "message": "Update vendor-related views\n\n* Use existing javascript/css pattern to show/hide provider-specific\n  fields on organization\n* Show different content if the organization is a vendor vs provider\n* Allow vendor users to create tokens / add keys if org is sandbox-\n  enabled (remove NPI requirement)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12c52ecbc75606f04e8a0426dc1d0f6f5409a4a9", "author": {"user": null}, "url": "https://github.com/CMSgov/dpc-app/commit/12c52ecbc75606f04e8a0426dc1d0f6f5409a4a9", "committedDate": "2020-03-11T18:39:20Z", "message": "Update tests to account for javascript followup\n\nWe use javascript to dynamically hide/show fields in these forms, but\nin order to replicate that functionality in tests, we would need to\nset up selenium and capybara properly. That is out of scope for this\nPR, so for now we will mark these fields as not visible (though in\nactuality they are triggered to be visible with JavaScript)."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d188d1e7371b7b9636a404bac11736750fc5cc90", "author": {"user": null}, "url": "https://github.com/CMSgov/dpc-app/commit/d188d1e7371b7b9636a404bac11736750fc5cc90", "committedDate": "2020-03-11T18:50:18Z", "message": "Update unit test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMDM2MzY2", "url": "https://github.com/CMSgov/dpc-app/pull/675#pullrequestreview-373036366", "createdAt": "2020-03-11T18:51:35Z", "commit": {"oid": "d188d1e7371b7b9636a404bac11736750fc5cc90"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxODo1MTozNVrOF1EbAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxODo1MTozNVrOF1EbAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTE5MTI5Ng==", "bodyText": "This was a hold-out piece of content from when we only had provider orgs.", "url": "https://github.com/CMSgov/dpc-app/pull/675#discussion_r391191296", "createdAt": "2020-03-11T18:51:35Z", "author": {"login": "switzersc-usds"}, "path": "dpc-web/app/views/internal/organizations/new.html.erb", "diffHunk": "@@ -4,7 +4,7 @@\n \n   <section class=\"ds-u-display--flex ds-u-justify-content--between ds-u-align-items--center\">\n \n-    <h1 class=\"ds-u-font-size--title ds-u-font-weight--normal ds-u-margin--0\" data-test=\"new-org-page\">Create a new provider organization</h1>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d188d1e7371b7b9636a404bac11736750fc5cc90"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMDM2OTg5", "url": "https://github.com/CMSgov/dpc-app/pull/675#pullrequestreview-373036989", "createdAt": "2020-03-11T18:52:27Z", "commit": {"oid": "d188d1e7371b7b9636a404bac11736750fc5cc90"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxODo1MjoyN1rOF1Ec8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxODo1MjoyN1rOF1Ec8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTE5MTc5NA==", "bodyText": "Likewise (leftover from when we just had provider orgs)", "url": "https://github.com/CMSgov/dpc-app/pull/675#discussion_r391191794", "createdAt": "2020-03-11T18:52:27Z", "author": {"login": "switzersc-usds"}, "path": "dpc-web/app/views/internal/organizations/show.html.erb", "diffHunk": "@@ -188,6 +196,6 @@\n \n <section class=\"ds-u-margin--2\">\n   <div class=\"ds-l-row ds-u-justify-content--center\">\n-    <%= link_to \"Delete provider organization\", internal_organization_url(@organization), method: :delete, class: \"ds-u-color--error ds-u-text-align--center\" %>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d188d1e7371b7b9636a404bac11736750fc5cc90"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMDM3MTI0", "url": "https://github.com/CMSgov/dpc-app/pull/675#pullrequestreview-373037124", "createdAt": "2020-03-11T18:52:39Z", "commit": {"oid": "d188d1e7371b7b9636a404bac11736750fc5cc90"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxODo1MjozOVrOF1Edaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxODo1MjozOVrOF1Edaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTE5MTkxNQ==", "bodyText": "I explained this in this commit message: 12c52ec", "url": "https://github.com/CMSgov/dpc-app/pull/675#discussion_r391191915", "createdAt": "2020-03-11T18:52:39Z", "author": {"login": "switzersc-usds"}, "path": "dpc-web/spec/features/internal/organization_management/creating_and_updating_organizations_spec.rb", "diffHunk": "@@ -16,7 +16,7 @@\n \n     fill_in 'organization_name', with: 'Good Health'\n     select 'Primary Care Clinic', from: 'organization_organization_type'\n-    fill_in 'organization_num_providers', with: '2200'\n+    fill_in 'organization_num_providers', visible: false, with: '2200'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d188d1e7371b7b9636a404bac11736750fc5cc90"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMDQ0MzIz", "url": "https://github.com/CMSgov/dpc-app/pull/675#pullrequestreview-373044323", "createdAt": "2020-03-11T19:03:12Z", "commit": {"oid": "d188d1e7371b7b9636a404bac11736750fc5cc90"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxOTowMzoxMlrOF1EzqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxOTowMzoxMlrOF1EzqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTE5NzYwOQ==", "bodyText": "Muted so you know you can't edit it", "url": "https://github.com/CMSgov/dpc-app/pull/675#discussion_r391197609", "createdAt": "2020-03-11T19:03:12Z", "author": {"login": "switzersc-usds"}, "path": "dpc-web/app/views/internal/organizations/show.html.erb", "diffHunk": "@@ -46,23 +46,31 @@\n         </svg>\n         <%= @organization.organization_type.titleize %>\n       </div>\n-      <div class=\"ds-u-margin-bottom--1\">\n-        <svg class=\"icon ds-u-margin-right--1 ds-u-color--muted\" xmlns=\"http://www.w3.org/2000/svg\" aria-hidden=\"true\">\n-          <use xlink:href=\"/assets/solid.svg#users\"></use>\n-        </svg>\n-        <%= @organization.num_providers %> providers\n-      </div>\n \n-      <div class=\"ds-u-margin-bottom--1\">\n-        <label class=\"ds-u-margin-right--1 ds-u-color--muted\">NPI</label>\n-        <%= @organization.npi %>\n-      </div>\n+      <% if @organization.health_it_vendor? %>\n+        <br>\n+        <div class=\"ds-u-margin-bottom--1\">\n+          <label class=\"ds-u-margin-right--1 ds-u-color--muted\">Vendor ID (System-generated):</label>\n+          <div class=\"ds-u-color--muted\"><%= @organization.vendor_id %></div>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d188d1e7371b7b9636a404bac11736750fc5cc90"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMDY3MzQ2", "url": "https://github.com/CMSgov/dpc-app/pull/675#pullrequestreview-373067346", "createdAt": "2020-03-11T19:39:08Z", "commit": {"oid": "d188d1e7371b7b9636a404bac11736750fc5cc90"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "873b4371731b22937e2f606cac1b5fc38fd77463", "author": {"user": null}, "url": "https://github.com/CMSgov/dpc-app/commit/873b4371731b22937e2f606cac1b5fc38fd77463", "committedDate": "2020-03-12T15:36:38Z", "message": "Add vendor sandbox email\n\n* Send vendor sandbox email instead of provider one if org type is\n  health_it_vendor\n* Consolidate this logic in UserMailer because it's the most DRY; add\n  unit test for mailer and update other tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "873b4371731b22937e2f606cac1b5fc38fd77463", "author": {"user": null}, "url": "https://github.com/CMSgov/dpc-app/commit/873b4371731b22937e2f606cac1b5fc38fd77463", "committedDate": "2020-03-12T15:36:38Z", "message": "Add vendor sandbox email\n\n* Send vendor sandbox email instead of provider one if org type is\n  health_it_vendor\n* Consolidate this logic in UserMailer because it's the most DRY; add\n  unit test for mailer and update other tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d762be6c144d3decb2f87d55fd46ca781758e9b", "author": {"user": null}, "url": "https://github.com/CMSgov/dpc-app/commit/5d762be6c144d3decb2f87d55fd46ca781758e9b", "committedDate": "2020-03-12T15:45:05Z", "message": "Merge branch 'master' into shelby/DPC-1013-vendor-sandbox"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNzY4Njg4", "url": "https://github.com/CMSgov/dpc-app/pull/675#pullrequestreview-373768688", "createdAt": "2020-03-12T17:40:47Z", "commit": {"oid": "5d762be6c144d3decb2f87d55fd46ca781758e9b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2a93d3df041144bacaaf84f78a23acb24eecea3", "author": {"user": null}, "url": "https://github.com/CMSgov/dpc-app/commit/f2a93d3df041144bacaaf84f78a23acb24eecea3", "committedDate": "2020-03-13T18:32:35Z", "message": "Merge branch 'master' into shelby/DPC-1013-vendor-sandbox"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 181, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}