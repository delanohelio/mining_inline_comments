{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYwMjE1OTk4", "number": 941, "title": "DPC-542 Feature: Add new `make` command to simplify local manual build process", "bodyText": "Fixes DPC-542\nWhen running mvn clean install locally as the README indicates, the tests fail because the decrypted environment variables are not available to Maven.\nProposed Changes\n\nadd new make maven-config command in order to turn the decrypted environment variables into Maven flags stored in .mvn/maven.config\nadd .mvn/ to .gitignore to avoid tracking and committing secrets\nupdate README for clarity\n\nChange Details\nThe most important change here is the new make command which uses bash to read the local.env key-value pairs and convert them to -D* flags which are stored in a maven.config file and then accessible by Maven. Specifically, the command first creates a .mvn directory if it doesn't already exist. Then, it truncates or creates a maven.config file, depending on its existence. Finally, it reads the local.env and appends the variables to maven.config. The command is meant to be idempotent and to be able to run regardless the existence of .mvn or .mvn/maven.config.\nSecurity Implications\n\n\n new software dependencies\n\n\n\n security controls or supporting software altered\n\n\n\n new data stored or transmitted\n\n\n\n security checklist is completed for this change\n\n\n\n requires more information or team discussion to evaluate security implications\n\n\n\n no PHI/PII is affected by this change\n\n\nAcceptance Validation\n\nAll tests were successful when using the new command.\n\nFeedback Requested\nI opted for writing bash directly in the Makefile. Is it preferable that I turn those commands into a script that is then referenced by the make command? I considered doing that but decided against it because it is only 3 lines.", "createdAt": "2020-07-31T14:49:21Z", "url": "https://github.com/CMSgov/dpc-app/pull/941", "merged": true, "mergeCommit": {"oid": "170a147ee9fd5959167fd847be95d579a96c08a0"}, "closed": true, "closedAt": "2020-08-05T21:58:43Z", "author": {"login": "jonfulk"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7Sn6ZAFqTQ2MDA0MjQ2Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7__jZgFqTQ2MTk0MTg2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMDQyNDYz", "url": "https://github.com/CMSgov/dpc-app/pull/941#pullrequestreview-460042463", "createdAt": "2020-08-03T13:50:36Z", "commit": null, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxMzo1MDozNlrOG66UiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxMzo1MDozNlrOG66UiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDQyNjEyMA==", "bodyText": "It might be clearer to move this section up before Building DPC, since it has to happen before you can build. Maybe Preparing to Build DPC with a subheader of Decrypting encrypted files?", "url": "https://github.com/CMSgov/dpc-app/pull/941#discussion_r464426120", "createdAt": "2020-08-03T13:50:36Z", "author": {"login": "em1"}, "path": "README.md", "diffHunk": "@@ -45,20 +45,37 @@ This can be fixed by setting the working directory to the project root, but need\n \n Building DPC\n ---\n+### Decrypt encrypted files", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwODYwNTI5", "url": "https://github.com/CMSgov/dpc-app/pull/941#pullrequestreview-460860529", "createdAt": "2020-08-04T14:20:54Z", "commit": null, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "3924ad8e29fe1cc98da0744b03f00004f89607ca", "author": {"user": null}, "url": "https://github.com/CMSgov/dpc-app/commit/3924ad8e29fe1cc98da0744b03f00004f89607ca", "committedDate": "2020-08-05T18:44:24Z", "message": "Update sample conf with missing keys"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "791dfe4b594941fde5038e43428b5cecad969536", "author": {"user": {"login": "jonfulk", "name": "M.Zola"}}, "url": "https://github.com/CMSgov/dpc-app/commit/791dfe4b594941fde5038e43428b5cecad969536", "committedDate": "2020-08-05T18:44:24Z", "message": "Add `make maven-config` command\n\nwhen running `mvn clean install`, the local.env variables are not\naccessible. This command will allow the developer to easily\ncopy decrypted environment variables from local.env\nto .mvn/maven.config prior to running the install cmd.\n\nDPC-542"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b6f4262560d70542021b47cf09248eb3641bd4c", "author": {"user": {"login": "jonfulk", "name": "M.Zola"}}, "url": "https://github.com/CMSgov/dpc-app/commit/4b6f4262560d70542021b47cf09248eb3641bd4c", "committedDate": "2020-08-05T18:44:24Z", "message": "Do not commit `.mvn` directory to version control"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "771f79e7478e4d47c55ca52978fae67a2cb755e1", "author": {"user": {"login": "jonfulk", "name": "M.Zola"}}, "url": "https://github.com/CMSgov/dpc-app/commit/771f79e7478e4d47c55ca52978fae67a2cb755e1", "committedDate": "2020-08-05T18:44:24Z", "message": "Update README for clarity and to include new `make` commands"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "771f79e7478e4d47c55ca52978fae67a2cb755e1", "author": {"user": {"login": "jonfulk", "name": "M.Zola"}}, "url": "https://github.com/CMSgov/dpc-app/commit/771f79e7478e4d47c55ca52978fae67a2cb755e1", "committedDate": "2020-08-05T18:44:24Z", "message": "Update README for clarity and to include new `make` commands"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxOTQxODYx", "url": "https://github.com/CMSgov/dpc-app/pull/941#pullrequestreview-461941861", "createdAt": "2020-08-05T19:01:03Z", "commit": {"oid": "771f79e7478e4d47c55ca52978fae67a2cb755e1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 456, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}