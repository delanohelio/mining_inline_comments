{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5MzE4MTk5", "number": 879, "title": "DPC-442 Feature: null check in hapi exception handler", "bodyText": "the operation outcome is not guaranteed to be set according to HAPI base client\n\n\nFixes DPC-442\n\nProposed Changes\nNull check\n\nChange Details\nSince HAPI Base Client does not guarantee setting of the operationOutcome, will need to add a null check and produce an empty operationOutcome with the log id\n\nSecurity Implications\nN/A\n\n\n new software dependencies\n\n\n\n security controls or supporting software altered\n\n\n\n new data stored or transmitted\n\n\n\n security checklist is completed for this change\n\n\n\n requires more information or team discussion to evaluate security implications\n\n\n\n no PHI/PII is affected by this change\n\n\nAcceptance Validation\n\n\nFeedback Requested\nWould like to know if it's possible that PII is in our exceptions since the new code takes the message from the exception and puts it into the operation outcome", "createdAt": "2020-06-24T16:30:22Z", "url": "https://github.com/CMSgov/dpc-app/pull/879", "merged": true, "mergeCommit": {"oid": "e1ee8c0a5d34bd0e9de8596c7cfbd582aef4d28b"}, "closed": true, "closedAt": "2020-06-24T22:19:52Z", "author": {"login": "MrBilnon"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcucG69AH2gAyNDM5MzE4MTk5OjBhMTI0ZGE1MTk5NWU0MDY0OGEyOWExZWZlMjk5ZTUzMTUxMDkzODQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcufjdNgFqTQzNjk1ODQyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0a124da51995e40648a29a1efe299e5315109384", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/0a124da51995e40648a29a1efe299e5315109384", "committedDate": "2020-06-24T15:51:30Z", "message": "the operation outcome is not guaranteed to be set according to HAPI base client"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ef626ccc1baced8c58fd3bfd8f62089cfaa5d55", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/3ef626ccc1baced8c58fd3bfd8f62089cfaa5d55", "committedDate": "2020-06-24T18:53:05Z", "message": "add more details to the operation outcome"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2OTI0OTQz", "url": "https://github.com/CMSgov/dpc-app/pull/879#pullrequestreview-436924943", "createdAt": "2020-06-24T19:01:26Z", "commit": {"oid": "3ef626ccc1baced8c58fd3bfd8f62089cfaa5d55"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxOTowMToyNlrOGofMsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxOTowMToyNlrOGofMsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEwNzM3Ng==", "bodyText": "Does this id still also need to be set when the OperationOutcome doesn't start out as null?", "url": "https://github.com/CMSgov/dpc-app/pull/879#discussion_r445107376", "createdAt": "2020-06-24T19:01:26Z", "author": {"login": "em1"}, "path": "dpc-common/src/main/java/gov/cms/dpc/fhir/dropwizard/handlers/exceptions/HAPIExceptionHandler.java", "diffHunk": "@@ -29,8 +30,15 @@ public Response toResponse(BaseServerResponseException exception) {\n     @Override\n     Response handleFHIRException(BaseServerResponseException exception) {\n         final long exceptionID = super.logException(exception);\n-        final OperationOutcome operationOutcome = (OperationOutcome) exception.getOperationOutcome();\n-        operationOutcome.setId(exceptionIDtoHex(exceptionID));\n+        OperationOutcome operationOutcome = (OperationOutcome) exception.getOperationOutcome();\n+        if (operationOutcome == null) {\n+            operationOutcome = new OperationOutcome();\n+            operationOutcome.addIssue()\n+                    .setCode(OperationOutcome.IssueType.EXCEPTION)\n+                    .setSeverity(OperationOutcome.IssueSeverity.ERROR)\n+                    .setDetails(new CodeableConcept().setText(exception.getMessage()));\n+            operationOutcome.setId(exceptionIDtoHex(exceptionID));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ef626ccc1baced8c58fd3bfd8f62089cfaa5d55"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81e5f59f5f1bffac47edb46f36a0ff76838b065d", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/81e5f59f5f1bffac47edb46f36a0ff76838b065d", "committedDate": "2020-06-24T19:02:16Z", "message": "move exception error message to diagnostics, codeable concept is not appropriate object to use."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9c6316d56a81a3da95bbbf556872857c14fdb3a", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/a9c6316d56a81a3da95bbbf556872857c14fdb3a", "committedDate": "2020-06-24T19:03:46Z", "message": "ensure id is set on outcome even when it's not null"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2OTU4NDIw", "url": "https://github.com/CMSgov/dpc-app/pull/879#pullrequestreview-436958420", "createdAt": "2020-06-24T19:52:23Z", "commit": {"oid": "a9c6316d56a81a3da95bbbf556872857c14fdb3a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 399, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}