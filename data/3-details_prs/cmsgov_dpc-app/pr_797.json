{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2MzU4NDQ3", "number": 797, "title": "DPC-92: Responses for create operations", "bodyText": "Why\nEnsure and demonstrate that DPC API's create operations return appropriate error responses.\nWhat Changed\nTests were added to show that appropriate error responses are returned from API create operations for Endpoint, Group, Organization, Patient, and Practitioner resources. Some logic was updated accordingly.\nInformation about create operation error status codes may be found at https://www.hl7.org/fhir/http.html#create.\n\nCommon HTTP Status codes returned on FHIR-related errors (in addition to normal HTTP errors related to security, header and content type negotiation issues):\n400 Bad Request - resource could not be parsed or failed basic FHIR validation rules\n404 Not Found - resource type not supported, or not a FHIR end-point\n422 Unprocessable Entity - the proposed resource violated applicable FHIR profiles or server business rules. This should be accompanied by an OperationOutcome resource providing additional detail\n\n\nExamples of how this PR interprets it:\n\nPOST with body that isn't JSON: 400\nPOST with body that is JSON but doesn't look like a supported FHIR resource: 400\nPOST with body that includes \"resourceType\": \"Patient\" but is missing a field required by the Patient profile: 422 (DPC understands the request, but it violates rules)\n\nTickets closed:\nDPC-92\nChecklist\n\n All tests are passing via make ci-app (app change) and make ci-web (website change)\n Swagger documentation has been updated\n FHIR documentation has been updated\n Any required dpc-ops changes have a PR submitted and mentioned in this ticket\n Any manual migration steps are documented, scripts written (where applicable), and tested\n Before merging, any required dpc-ops changes have been approved and merged into master of the dpc-ops repo", "createdAt": "2020-05-11T21:27:52Z", "url": "https://github.com/CMSgov/dpc-app/pull/797", "merged": true, "mergeCommit": {"oid": "ce6733698ec269ca9370e5919f62417b7dfb27d5"}, "closed": true, "closedAt": "2020-05-15T12:47:33Z", "author": {"login": "em1"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgQcVGgH2gAyNDE2MzU4NDQ3OjgzMDkwMmIwNjA1NzE2MmZkNmY2YmVmZDVjOWJkNjQxMmQ5NjgxZDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchUgIlgFqTQxMjIwNDM2NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "830902b06057162fd6f6befd5c9bd6412d9681d8", "author": {"user": {"login": "em1", "name": null}}, "url": "https://github.com/CMSgov/dpc-app/commit/830902b06057162fd6f6befd5c9bd6412d9681d8", "committedDate": "2020-05-11T14:21:05Z", "message": "New Endpoint creation test without client"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "169129ac2dad7d692d2177b45f5a5b33cb066de3", "author": {"user": {"login": "em1", "name": null}}, "url": "https://github.com/CMSgov/dpc-app/commit/169129ac2dad7d692d2177b45f5a5b33cb066de3", "committedDate": "2020-05-11T21:10:40Z", "message": "More adjustments and tests for create operation response codes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NTQ0OTkz", "url": "https://github.com/CMSgov/dpc-app/pull/797#pullrequestreview-409544993", "createdAt": "2020-05-11T21:29:30Z", "commit": {"oid": "169129ac2dad7d692d2177b45f5a5b33cb066de3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQyMToyOTozMFrOGTuE3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQyMToyOTozMFrOGTuE3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzMzMTAzNg==", "bodyText": "Not really happy with this logic, but I haven't found a better way to differentiate between a request body that isn't parsable and one that can be parsed but violates rules.", "url": "https://github.com/CMSgov/dpc-app/pull/797#discussion_r423331036", "createdAt": "2020-05-11T21:29:30Z", "author": {"login": "em1"}, "path": "dpc-common/src/main/java/gov/cms/dpc/fhir/dropwizard/handlers/FHIRHandler.java", "diffHunk": "@@ -48,7 +48,9 @@ public BaseResource readFrom(Class<BaseResource> type, Type genericType, Annotat\n             // We need to manually handle the DataFormatException because our custom exception handlers aren't loaded yet.\n         } catch (DataFormatException e) {\n             String message = e.getCause() != null ? e.getCause().getMessage() : e.getMessage();\n-            throw new WebApplicationException(message, HttpStatus.UNPROCESSABLE_ENTITY_422);\n+            // Bad request if not parsable; unprocessable if parsable but in violation of profile or business rules\n+            int status = message.contains(\"Invalid attribute value\") ? HttpStatus.UNPROCESSABLE_ENTITY_422 : HttpStatus.BAD_REQUEST_400;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "169129ac2dad7d692d2177b45f5a5b33cb066de3"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ff9863c38a2fd8a83ad96560b32a8f0745353cc", "author": {"user": {"login": "em1", "name": null}}, "url": "https://github.com/CMSgov/dpc-app/commit/7ff9863c38a2fd8a83ad96560b32a8f0745353cc", "committedDate": "2020-05-14T21:03:13Z", "message": "Merge branch 'master' into emily/dpc-878-create-ops-responses"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMjA0MzY0", "url": "https://github.com/CMSgov/dpc-app/pull/797#pullrequestreview-412204364", "createdAt": "2020-05-14T21:38:47Z", "commit": {"oid": "7ff9863c38a2fd8a83ad96560b32a8f0745353cc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 138, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}