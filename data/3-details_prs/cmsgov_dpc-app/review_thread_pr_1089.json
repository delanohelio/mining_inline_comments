{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA0MjA1OTA1", "number": 1089, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNTo1MjoxMVrOEuD96g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMToxNjozMFrOEv-wJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2NzM0OTU0OnYy", "diffSide": "RIGHT", "path": "dpc-smoketest/src/main/java/gov/cms/dpc/testing/smoketests/SmokeTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNTo1MjoxMVrOHiOpvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNTo1MjoxMVrOHiOpvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTY1MzY5NA==", "bodyText": "Method runAndMonitorExportJob has 6 arguments (exceeds 4 allowed). Consider refactoring.", "url": "https://github.com/CMSgov/dpc-app/pull/1089#discussion_r505653694", "createdAt": "2020-10-15T15:52:11Z", "author": {"login": "codeclimate"}, "path": "dpc-smoketest/src/main/java/gov/cms/dpc/testing/smoketests/SmokeTest.java", "diffHunk": "@@ -221,18 +204,20 @@ public SampleResult runTest(JavaSamplerContext javaSamplerContext) {\n             patientSample.sampleEnd();\n             smokeTestResult.addSubResult(patientSample);\n         }\n+        return patientReferences;\n+    }\n \n \n-        // Upload the roster bundle\n+    private void uploadRosterBundle(JavaSamplerContext samplerContext, Bundle providerBundle, IGenericClient exportClient, Map<String,Reference> patientReferences){\n         logger.debug(\"Uploading roster\");\n         try {\n-            ClientUtils.createAndUploadRosters(javaSamplerContext.getParameter(\"seed-file\"), providerBundle, exportClient, UUID.fromString(organizationID), patientReferences);\n+            ClientUtils.createAndUploadRosters(samplerContext.getParameter(\"seed-file\"), providerBundle, exportClient, UUID.fromString(organizationID), patientReferences);\n         } catch (Exception e) {\n             throw new IllegalStateException(\"Cannot upload roster\", e);\n         }\n+    }\n \n-        // Run the job\n-        // Create a custom http client to use for monitoring the non-FHIR export request\n+    private void runAndMonitorExportJob(SampleResult smokeTestResult, String hostParam, String clientToken, Pair<UUID, PrivateKey> keyTuple, IGenericClient exportClient, List<String> providerNPIs){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "154ded0543662586e2b391560dc55feb2cde77c1"}, "originalPosition": 223}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4MTgwMTU0OnYy", "diffSide": "RIGHT", "path": "dpc-aggregation/src/main/java/gov/cms/dpc/aggregation/engine/JobBatchProcessor.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxODowMjoyMFrOHkbQsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxOTo0MTowN1rOHke3dw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk1NzQyNw==", "bodyText": "are we guaranteed to always have an org ID on the job?", "url": "https://github.com/CMSgov/dpc-app/pull/1089#discussion_r507957427", "createdAt": "2020-10-19T18:02:20Z", "author": {"login": "jonfulk"}, "path": "dpc-aggregation/src/main/java/gov/cms/dpc/aggregation/engine/JobBatchProcessor.java", "diffHunk": "@@ -59,15 +59,22 @@ public JobBatchProcessor(BlueButtonClient bbclient, FhirContext fhirContext, Met\n      * @return A list of batch files {@link JobQueueBatchFile}\n      */\n     public List<JobQueueBatchFile> processJobBatchPartial(UUID aggregatorID, IJobQueue queue, JobQueueBatch job, String patientID) {\n-        List<LookBackAnswer> answers = getAnswers(job, patientID);\n+    Flowable<Resource> flowable;\n+    if(isLookBackExempt(job.getOrgID())){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bdb58c5d1287cd9212740929ad94dcc6fa4218e4"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAxNjUwMw==", "bodyText": "@jonfulk I want to say yes because the orgId in the table has a nullable = false constraint", "url": "https://github.com/CMSgov/dpc-app/pull/1089#discussion_r508016503", "createdAt": "2020-10-19T19:41:07Z", "author": {"login": "MrBilnon"}, "path": "dpc-aggregation/src/main/java/gov/cms/dpc/aggregation/engine/JobBatchProcessor.java", "diffHunk": "@@ -59,15 +59,22 @@ public JobBatchProcessor(BlueButtonClient bbclient, FhirContext fhirContext, Met\n      * @return A list of batch files {@link JobQueueBatchFile}\n      */\n     public List<JobQueueBatchFile> processJobBatchPartial(UUID aggregatorID, IJobQueue queue, JobQueueBatch job, String patientID) {\n-        List<LookBackAnswer> answers = getAnswers(job, patientID);\n+    Flowable<Resource> flowable;\n+    if(isLookBackExempt(job.getOrgID())){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk1NzQyNw=="}, "originalCommit": {"oid": "bdb58c5d1287cd9212740929ad94dcc6fa4218e4"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4NzQ2NjYzOnYy", "diffSide": "RIGHT", "path": "dpc-aggregation/src/main/resources/application.conf", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMToxNjozMFrOHlRa4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxNDozNDo1M1rOHlvxBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg0NDc2OQ==", "bodyText": "Just checking but aren't the UUIDs for the orgs in the smoke test generated randomly?  I might be missing where you are hard coding these values.", "url": "https://github.com/CMSgov/dpc-app/pull/1089#discussion_r508844769", "createdAt": "2020-10-20T21:16:30Z", "author": {"login": "MrBilnon"}, "path": "dpc-aggregation/src/main/resources/application.conf", "diffHunk": "@@ -29,6 +29,8 @@ dpc.aggregation {\n   # The number of months to look back for a claim\n   lookBackMonths = 18\n   lookBackMonths = ${?LOOK_BACK_MONTHS}\n+  lookBackExemptOrgs = [\"0ab352f1-2bf1-44c4-aa7a-3004a1ffef12\",\"69c0d4d4-9c07-4fa8-9053-e10fb1608b48\",\"c7f5247b-4c41-478c-84eb-a6e801bdb145\"]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f9c32d15f2655da00b3f42c94ae73c4c8a02e23"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM0MTk1OQ==", "bodyText": "Sorry, this PR only covers adding the mechanism for bypassing lookback based on configured org Ids, I will update the PR description to reflect that.", "url": "https://github.com/CMSgov/dpc-app/pull/1089#discussion_r509341959", "createdAt": "2020-10-21T14:34:53Z", "author": {"login": "MrMorie"}, "path": "dpc-aggregation/src/main/resources/application.conf", "diffHunk": "@@ -29,6 +29,8 @@ dpc.aggregation {\n   # The number of months to look back for a claim\n   lookBackMonths = 18\n   lookBackMonths = ${?LOOK_BACK_MONTHS}\n+  lookBackExemptOrgs = [\"0ab352f1-2bf1-44c4-aa7a-3004a1ffef12\",\"69c0d4d4-9c07-4fa8-9053-e10fb1608b48\",\"c7f5247b-4c41-478c-84eb-a6e801bdb145\"]", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg0NDc2OQ=="}, "originalCommit": {"oid": "4f9c32d15f2655da00b3f42c94ae73c4c8a02e23"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}