{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzMjY2NDUw", "number": 782, "title": "DPC-1371 Email domain validation", "bodyText": "Why\nIn order to limit the number of emails sent to invalid addresses, we want to perform as much validation as possible before allowing an email to be accepted.\nWhat Changed\n\nThe truemail gem is added\nUsing truemail, the domain names for all emails are validated through DNS\n\nMX (or as a fallback,A) records are sought for the domain name\nIf none is found, the email address is rejected\n\n\n\nDomain validation in action (on dev)\n\nChoices Made\nLookup without contact: while the truemail gem allows for validating the full email address by contacting the mail server, that is not RFC-supported behavior and could lead to DPC's server being blacklisted.  This PR chooses the middle ground of added validation, but for the domain only.\nTickets closed:\nDPC-1371\nFuture Work\nN/A\nChecklist\n\n All tests are passing via make ci-app (app change) and make ci-web (website change)\n[N/A] Swagger documentation has been updated\n[N/A] FHIR documentation has been updated\n[N/A] Any required dpc-ops changes have a PR submitted and mentioned in this ticket\n[N/A] Any manual migration steps are documented, scripts written (where applicable), and tested\n[N/A] Before merging, any required dpc-ops changes have been approved and merged into master of the dpc-ops repo", "createdAt": "2020-05-05T01:40:21Z", "url": "https://github.com/CMSgov/dpc-app/pull/782", "merged": true, "mergeCommit": {"oid": "2f7abfd1847d16a2fd143ad056d5a55452835939"}, "closed": true, "closedAt": "2020-05-05T13:53:16Z", "author": {"login": "dhgreene"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcc5W_qAH2gAyNDEzMjY2NDUwOmQxMGE4MGMxNGVjNjI0ZjI2MWYxZTRlN2I4NzNhMjk1OWQ4M2E3MDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABceT_fGgH2gAyNDEzMjY2NDUwOjU3ODk3YzE1M2JhZTExZGVmYzgzYzI2ZWRlNDI4OWU4Y2FhNjQ5YmU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d10a80c14ec624f261f1e4e7b873a2959d83a706", "author": {"user": {"login": "dhgreene", "name": null}}, "url": "https://github.com/CMSgov/dpc-app/commit/d10a80c14ec624f261f1e4e7b873a2959d83a706", "committedDate": "2020-05-01T03:45:40Z", "message": "Validate new user email domain via DNS"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c70a1286203550b8b21e1db6fc0311642158477f", "author": {"user": {"login": "dhgreene", "name": null}}, "url": "https://github.com/CMSgov/dpc-app/commit/c70a1286203550b8b21e1db6fc0311642158477f", "committedDate": "2020-05-01T04:32:51Z", "message": "Rspec uses regex for email validation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0edee6fbbdb77f45dcee762a82419da0b2a6843", "author": {"user": {"login": "dhgreene", "name": null}}, "url": "https://github.com/CMSgov/dpc-app/commit/e0edee6fbbdb77f45dcee762a82419da0b2a6843", "committedDate": "2020-05-04T19:28:07Z", "message": "Revert \"DPC-1347: Change auto-generated vendor and provider ids to pass for NPI (#772)\"\n\nThis reverts commit 805cd5c2c89a790fd698059d60cb9dd20b23579d."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2eb86b1616a937a47da2975ccdb5a72c408376e2", "author": {"user": {"login": "dhgreene", "name": null}}, "url": "https://github.com/CMSgov/dpc-app/commit/2eb86b1616a937a47da2975ccdb5a72c408376e2", "committedDate": "2020-05-05T01:20:14Z", "message": "Merge branch 'dhg/dpc-1371-research-dev-problems' into dhg/dpc-1371-email-domain-validation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NDUxODg0", "url": "https://github.com/CMSgov/dpc-app/pull/782#pullrequestreview-405451884", "createdAt": "2020-05-05T01:41:10Z", "commit": {"oid": "2eb86b1616a937a47da2975ccdb5a72c408376e2"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwMTo0MToxMFrOGQX8rA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwMTo0MToxMVrOGQX8rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTgyMjc2NA==", "bodyText": "Add an empty line after magic comments.", "url": "https://github.com/CMSgov/dpc-app/pull/782#discussion_r419822764", "createdAt": "2020-05-05T01:41:10Z", "author": {"login": "codeclimate"}, "path": "dpc-web/app/validators/domain_exists_validator.rb", "diffHunk": "@@ -0,0 +1,12 @@\n+# frozen_string_literal: true\n+require 'mail'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2eb86b1616a937a47da2975ccdb5a72c408376e2"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTgyMjc2Ng==", "bodyText": "Final newline missing.", "url": "https://github.com/CMSgov/dpc-app/pull/782#discussion_r419822766", "createdAt": "2020-05-05T01:41:11Z", "author": {"login": "codeclimate"}, "path": "dpc-web/app/validators/domain_exists_validator.rb", "diffHunk": "@@ -0,0 +1,12 @@\n+# frozen_string_literal: true\n+require 'mail'\n+class DomainExistsValidator < ActiveModel::EachValidator\n+  def validate_each(record, attribute, value)\n+    begin\n+      r = Truemail.validate(value).result.success\n+    rescue StandardError\n+      r = false\n+    end\n+    record.errors[attribute] << (options[:message] || 'is invalid') unless r\n+  end\n+end", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2eb86b1616a937a47da2975ccdb5a72c408376e2"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a392abf52b5d3af3f18c5253fabf23272c35649", "author": {"user": {"login": "dhgreene", "name": null}}, "url": "https://github.com/CMSgov/dpc-app/commit/8a392abf52b5d3af3f18c5253fabf23272c35649", "committedDate": "2020-05-05T01:45:10Z", "message": "Codeclimate improvements"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NzcyMjA2", "url": "https://github.com/CMSgov/dpc-app/pull/782#pullrequestreview-405772206", "createdAt": "2020-05-05T13:12:08Z", "commit": {"oid": "8a392abf52b5d3af3f18c5253fabf23272c35649"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1Nzc3MTE4", "url": "https://github.com/CMSgov/dpc-app/pull/782#pullrequestreview-405777118", "createdAt": "2020-05-05T13:17:42Z", "commit": {"oid": "8a392abf52b5d3af3f18c5253fabf23272c35649"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57897c153bae11defc83c26ede4289e8caa649be", "author": {"user": {"login": "dhgreene", "name": null}}, "url": "https://github.com/CMSgov/dpc-app/commit/57897c153bae11defc83c26ede4289e8caa649be", "committedDate": "2020-05-05T13:21:21Z", "message": "Merge branch 'master' into dhg/dpc-1371-email-domain-validation"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 125, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}