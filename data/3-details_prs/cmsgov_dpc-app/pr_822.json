{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0MjE0Nzkx", "number": 822, "title": "DPC-162 add auth related logging filter", "bodyText": "Why\nSince we use @FormParam for our posts that means the user can post with query strings.  One of our endpoints that takes a JWT token to get the access token allows this and to prevent this and any other endpoints from logging the query string, this filter was devised.\nWhat Changed\nAdd a logback filter\nChoices Made\nCould not do filtering at the splunk level, so filtering at the programatic logging level here.  Since there is not a way to determine if a value is a JWT token, we can only look for the key (client_assertions).\nTickets closed:\nhttps://jira.cms.gov/browse/DPC-162\nFuture Work\nList any additional tickets that have either been created due to work in this PR, or existing tickets that expand upon the feature or provide additional fixes.\nChecklist\n\n All tests are passing via make ci-app (app change) and make ci-web (website change)\n Swagger documentation has been updated\n FHIR documentation has been updated\n Any required dpc-ops changes have a PR submitted and mentioned in this ticket\n Any manual migration steps are documented, scripts written (where applicable), and tested\n Before merging, any required dpc-ops changes have been approved and merged into master of the dpc-ops repo", "createdAt": "2020-05-28T02:47:12Z", "url": "https://github.com/CMSgov/dpc-app/pull/822", "merged": true, "mergeCommit": {"oid": "e6de3775576d38d01d479edb169e99f0f740178e"}, "closed": true, "closedAt": "2020-06-07T04:41:15Z", "author": {"login": "MrBilnon"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclkmcNgH2gAyNDI0MjE0NzkxOjYwNTljZjIxMGFiYzVlNzk1MDAzMjExZWRhNmEyOTUzMTE0MzU2MDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcn_2HBgH2gAyNDI0MjE0NzkxOjQxNGIyNGVhYzMzNjI4MGYwZDY2N2UxOTQxNTc3NTVkZTc2N2ZiNTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6059cf210abc5e795003211eda6a295311435603", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/6059cf210abc5e795003211eda6a295311435603", "committedDate": "2020-05-28T02:39:51Z", "message": "add auth related logging filter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e6879d7695179430910211384d610b243f82516", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/4e6879d7695179430910211384d610b243f82516", "committedDate": "2020-05-28T02:48:26Z", "message": "Merge branch 'master' into DPC-162-filter-out-jwt-tokens-in-query-string"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwMzUwOTgx", "url": "https://github.com/CMSgov/dpc-app/pull/822#pullrequestreview-420350981", "createdAt": "2020-05-28T17:48:15Z", "commit": {"oid": "4e6879d7695179430910211384d610b243f82516"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNzo0ODoxNVrOGcAHeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNzo0ODoxNVrOGcAHeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjAxNTIyNg==", "bodyText": "Could we make this client_assertion (singular) since that's likely the name for the parameter? Or maybe include both to show that client_assertion anywhere is rejected.", "url": "https://github.com/CMSgov/dpc-app/pull/822#discussion_r432015226", "createdAt": "2020-05-28T17:48:15Z", "author": {"login": "em1"}, "path": "dpc-common/src/test/java/gov/cms/dpc/common/logging/filters/AuthRelatedLoggingFilterTest.java", "diffHunk": "@@ -0,0 +1,43 @@\n+package gov.cms.dpc.common.logging.filters;\n+\n+\n+import ch.qos.logback.access.spi.IAccessEvent;\n+import ch.qos.logback.core.filter.Filter;\n+import ch.qos.logback.core.spi.FilterReply;\n+import io.dropwizard.logging.filter.FilterFactory;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.Arguments;\n+import org.junit.jupiter.params.provider.MethodSource;\n+import org.mockito.Mockito;\n+\n+import java.util.stream.Stream;\n+\n+public class AuthRelatedLoggingFilterTest {\n+\n+    private Filter<IAccessEvent> filter;\n+    private IAccessEvent event = Mockito.mock(IAccessEvent.class);\n+\n+    @BeforeEach\n+    public void setUp() {\n+        FilterFactory<IAccessEvent> filterFactory = new AuthRelatedLoggingFilter();\n+        filter = filterFactory.build();\n+    }\n+\n+    @ParameterizedTest\n+    @MethodSource(\"stringSource\")\n+    public void testQueryString(String queryString, FilterReply expectedReply) {\n+        Mockito.when(event.getQueryString()).thenReturn(queryString);\n+        FilterReply reply = filter.decide(event);\n+        Assertions.assertEquals(expectedReply, reply);\n+    }\n+\n+    private static Stream<Arguments> stringSource() {\n+        return Stream.of(\n+                Arguments.of(\"client_assertions=secret_token\", FilterReply.DENY),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e6879d7695179430910211384d610b243f82516"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbf2be14edb92bd74d9b237a15f9749dbf02447d", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/dbf2be14edb92bd74d9b237a15f9749dbf02447d", "committedDate": "2020-05-28T21:50:29Z", "message": "add test cases for client_assertion (singular)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee7dcb93e5d386a09b279968022defd744e41d7f", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/ee7dcb93e5d386a09b279968022defd744e41d7f", "committedDate": "2020-05-28T21:51:13Z", "message": "Merge remote-tracking branch 'origin/DPC-162-filter-out-jwt-tokens-in-query-string' into DPC-162-filter-out-jwt-tokens-in-query-string"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxOTIyNDY4", "url": "https://github.com/CMSgov/dpc-app/pull/822#pullrequestreview-421922468", "createdAt": "2020-06-01T15:08:14Z", "commit": {"oid": "ee7dcb93e5d386a09b279968022defd744e41d7f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a96c032524d7162ebf97d343e111e264297fd312", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/a96c032524d7162ebf97d343e111e264297fd312", "committedDate": "2020-06-01T20:10:38Z", "message": "Merge branch 'master' into DPC-162-filter-out-jwt-tokens-in-query-string"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "633688d9aa176c48a0e0fba416bdf77685d23f4a", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/633688d9aa176c48a0e0fba416bdf77685d23f4a", "committedDate": "2020-06-02T05:26:15Z", "message": "Merge branch 'master' into DPC-162-filter-out-jwt-tokens-in-query-string"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8fd9edc2ee234658baa11c85bdd02105d57c075", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/a8fd9edc2ee234658baa11c85bdd02105d57c075", "committedDate": "2020-06-02T19:54:21Z", "message": "Merge branch 'master' into DPC-162-filter-out-jwt-tokens-in-query-string"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "414b24eac336280f0d667e194157755de767fb59", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/414b24eac336280f0d667e194157755de767fb59", "committedDate": "2020-06-04T15:32:15Z", "message": "Merge branch 'master' into DPC-162-filter-out-jwt-tokens-in-query-string"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 152, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}