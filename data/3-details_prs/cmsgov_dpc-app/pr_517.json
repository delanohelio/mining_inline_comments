{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4NzUzMzA0", "number": 517, "title": "DPC-907 update docker scripts to redirect logs", "bodyText": "Why\nWe need to configure Docker to place logs on the host file system so that they can be properly injected into Splunk. We need to do this because the splunk log driver for docker causes all kinds of problems and results in missing log data.\nWhat Changed\nDocker entrypoint.sh scripts for application to redirect logs to specified log file.\nThis PR is to be merged with https://github.com/CMSgov/dpc-ops/pull/111\nChoices Made\nUse tee to redirect output from the application to a log file\nTickets closed:\nThis PR with https://github.com/CMSgov/dpc-ops/pull/111 will close DPC-907\nFuture Work\nKnown issue that dpc-web is not producing expected logs - Ruby may need some extra configuration for logging\nChecklist\n\n All tests are passing via make ci-app (app change) and make ci-web (website change)\n Swagger documentation has been updated\n FHIR documentation has been updated\n Any required dpc-ops changes have a PR submitted and mentioned in this ticket\n Any manual migration steps are documented, scripts written (where applicable), and tested\n Before merging, any required dpc-ops changes have been approved and merged into master of the dpc-ops repo", "createdAt": "2020-01-02T18:40:07Z", "url": "https://github.com/CMSgov/dpc-app/pull/517", "merged": true, "mergeCommit": {"oid": "9b7d202f2a71bd631c3ca92e214a5a9144f65f7a"}, "closed": true, "closedAt": "2020-01-14T16:14:31Z", "author": {"login": "mamurphy"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABbyQ0wjgH2gAyMzU4NzUzMzA0OmZiMTZkNGFiNzIxMGM3NDgyYjQ4YzQ5OGE5ZGJhMWM4OTFlODQ5NWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb6TEExgH2gAyMzU4NzUzMzA0OmU3YWIxNTFkMzFmZmJhNWRmYWY3NDQyNjBhOTdlYTRjNTZhZDg5MmM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fb16d4ab7210c7482b48c498a9dba1c891e8495e", "author": {"user": {"login": "rnagle", "name": "Ryan Nagle"}}, "url": "https://github.com/CMSgov/dpc-app/commit/fb16d4ab7210c7482b48c498a9dba1c891e8495e", "committedDate": "2019-12-20T16:47:15Z", "message": "wip redirect log output from container process to container's /var/log/"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad13b67967f3aefb9c8e6a5b8e8708bb64abd3db", "author": {"user": {"login": "rnagle", "name": "Ryan Nagle"}}, "url": "https://github.com/CMSgov/dpc-app/commit/ad13b67967f3aefb9c8e6a5b8e8708bb64abd3db", "committedDate": "2019-12-20T18:42:06Z", "message": "prefix log files with service name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM3ODQ3MjQw", "url": "https://github.com/CMSgov/dpc-app/pull/517#pullrequestreview-337847240", "createdAt": "2020-01-02T20:38:29Z", "commit": {"oid": "ad13b67967f3aefb9c8e6a5b8e8708bb64abd3db"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQyMDozODozMFrOFZ0pWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQyMDozODozMFrOFZ0pWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjYyMTI3Mg==", "bodyText": "Should the name of this log file have a prefix of dpc-consent?", "url": "https://github.com/CMSgov/dpc-app/pull/517#discussion_r362621272", "createdAt": "2020-01-02T20:38:30Z", "author": {"login": "em1"}, "path": "dpc-consent/docker/entrypoint.sh", "diffHunk": "@@ -17,4 +17,4 @@ fi\n \n echo \"Running server\"\n \n-exec ${CMDLINE} \"$@\"\n+exec ${CMDLINE} \"$@\" 2>&1 | tee -a /var/log/$(hostname).log", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad13b67967f3aefb9c8e6a5b8e8708bb64abd3db"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc34227b0196eaea087733a4bc66d689fbd58604", "author": {"user": null}, "url": "https://github.com/CMSgov/dpc-app/commit/bc34227b0196eaea087733a4bc66d689fbd58604", "committedDate": "2020-01-06T14:39:50Z", "message": "correct dpc-consent log filename"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4NzM2MTI5", "url": "https://github.com/CMSgov/dpc-app/pull/517#pullrequestreview-338736129", "createdAt": "2020-01-06T16:13:00Z", "commit": {"oid": "bc34227b0196eaea087733a4bc66d689fbd58604"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNjcyOTEz", "url": "https://github.com/CMSgov/dpc-app/pull/517#pullrequestreview-340672913", "createdAt": "2020-01-09T16:58:53Z", "commit": {"oid": "bc34227b0196eaea087733a4bc66d689fbd58604"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxNjo1ODo1M1rOFb871g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxNjo1ODo1M1rOFb871g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg1NDIzMA==", "bodyText": "Just asking a dumb question, will this still log to stdout, or will it silently redirect everything to the log file?", "url": "https://github.com/CMSgov/dpc-app/pull/517#discussion_r364854230", "createdAt": "2020-01-09T16:58:53Z", "author": {"login": "nickrobison-usds"}, "path": "dpc-aggregation/docker/entrypoint.sh", "diffHunk": "@@ -29,4 +29,4 @@ if [ $DB_MIGRATION -eq 1 ]; then\n fi\n \n echo \"Running server via entrypoint!\"\n-exec ${CMDLINE} \"$@\"\n+exec ${CMDLINE} \"$@\" 2>&1 | tee -a /var/log/dpc-aggregation-$(hostname).log", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc34227b0196eaea087733a4bc66d689fbd58604"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxOTYwNDMz", "url": "https://github.com/CMSgov/dpc-app/pull/517#pullrequestreview-341960433", "createdAt": "2020-01-13T16:15:10Z", "commit": {"oid": "bc34227b0196eaea087733a4bc66d689fbd58604"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38ff68fbc985dc210909385bba1152e785005c9a", "author": {"user": {"login": "mamurphy", "name": "Marissa"}}, "url": "https://github.com/CMSgov/dpc-app/commit/38ff68fbc985dc210909385bba1152e785005c9a", "committedDate": "2020-01-13T17:58:29Z", "message": "Merge branch 'master' into rnagle/dpc-907"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2bc8198bec11cb7bbad03d9a051f0417fbff73a", "author": {"user": {"login": "mamurphy", "name": "Marissa"}}, "url": "https://github.com/CMSgov/dpc-app/commit/f2bc8198bec11cb7bbad03d9a051f0417fbff73a", "committedDate": "2020-01-13T20:10:31Z", "message": "Merge branch 'master' into rnagle/dpc-907"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "739ab66aaabb823c15bcbf50d23c21dd7971f7b1", "author": {"user": null}, "url": "https://github.com/CMSgov/dpc-app/commit/739ab66aaabb823c15bcbf50d23c21dd7971f7b1", "committedDate": "2020-01-13T21:16:30Z", "message": "DPC-907 update the containers to only redirect if the  flag isn't set"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03fdd4386594f11a62d639e423a7216a00ff0220", "author": {"user": null}, "url": "https://github.com/CMSgov/dpc-app/commit/03fdd4386594f11a62d639e423a7216a00ff0220", "committedDate": "2020-01-14T14:26:26Z", "message": "fix if then"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0caca27ce0804ed0d790e4f57eb2d467b84cd349", "author": {"user": {"login": "mamurphy", "name": "Marissa"}}, "url": "https://github.com/CMSgov/dpc-app/commit/0caca27ce0804ed0d790e4f57eb2d467b84cd349", "committedDate": "2020-01-14T15:03:08Z", "message": "Merge branch 'master' into rnagle/dpc-907"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7ab151d31ffba5dfaf744260a97ea4c56ad892c", "author": {"user": {"login": "mamurphy", "name": "Marissa"}}, "url": "https://github.com/CMSgov/dpc-app/commit/e7ab151d31ffba5dfaf744260a97ea4c56ad892c", "committedDate": "2020-01-14T15:55:11Z", "message": "Merge branch 'master' into rnagle/dpc-907"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 273, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}