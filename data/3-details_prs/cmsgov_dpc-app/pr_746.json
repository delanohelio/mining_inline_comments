{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyNzc5MDcw", "number": 746, "title": "DPC-34: _Since Support", "bodyText": "Why\nThis is follow on to (DPC-34: Since PR)[https://github.com//pull/634] which had to be reverted by this (PR)[https://github.com//pull/722] because deploys to DEV were failing. This PR restores the DPC-34 feature along with a config change that should allow the code to run in DEV.\nWhat Changed\nThe error in the DEV environment was caused by the API service not finding the BB key-store. Here's an example error from the logs.\n7\n2020-03-31T14:46:31.663-04:00\n{\"level\":\"ERROR\",\"logger\":\"gov.cms.dpc.bluebutton.BlueButtonClientModule\",\"thread\":\"main\",\"message\":\"Could not find keystore at location: {}/../bbcerts/bb.keystore\",\"timestamp\":\"2020-03-31T18:46:31.656+0000\"}\n@ingestionTime\n1585680391907\n@log\n755619740999:dpc-dev-api\n@logStream\napi/dpc-dev-api/f20b38b0de3148b2a75a1136f58b2e28\n@message\n{\"level\":\"ERROR\",\"logger\":\"gov.cms.dpc.bluebutton.BlueButtonClientModule\",\"thread\":\"main\",\"message\":\"Could not find keystore at location: {}/../bbcerts/bb.keystore\",\"timestamp\":\"2020-03-31T18:46:31.656+0000\"}\n@timestamp\n1585680391663\nlevel\nERROR\nlogger\ngov.cms.dpc.bluebutton.BlueButtonClientModule\nmessage\nCould not find keystore at location: {}/../bbcerts/bb.keystore\nthread\nmain\ntimestamp\n2020-03-31T18:46:31.656+0000\n\nThe fix was to incorporate a set of configs into the DEV, TEST, PROD-SBX API service conf files for the BBClient.\nChoices Made\nTickets closed:\nFuture Work\nChecklist\n\n All tests are passing via make ci-app (app change) and make ci-web (website change)\n Swagger documentation has been updated\n FHIR documentation has been updated\n Any required dpc-ops changes have a PR submitted and mentioned in this ticket\n Any manual migration steps are documented, scripts written (where applicable), and tested\n Before merging, any required dpc-ops changes have been approved and merged into master of the dpc-ops repo", "createdAt": "2020-04-13T18:39:28Z", "url": "https://github.com/CMSgov/dpc-app/pull/746", "merged": true, "mergeCommit": {"oid": "2714561c9f4715f0df428d0058637c6f99693c79"}, "closed": true, "closedAt": "2020-04-23T18:20:49Z", "author": {"login": "RickHawesUSDS"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXROgJAH2gAyNDAyNzc5MDcwOjljZjBjNWU4MWQ0MWFjZmRhNGU0YzgzZGUyMTEzMmQxYTIxMTViODk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaeWQ5gH2gAyNDAyNzc5MDcwOjI2MjM1ZmJlNzE5ZDJhMjI5OGUyMjE0ZjFmZjUxYmVkZTBlM2JiY2E=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9cf0c5e81d41acfda4e4c83de21132d1a2115b89", "author": {"user": null}, "url": "https://github.com/CMSgov/dpc-app/commit/9cf0c5e81d41acfda4e4c83de21132d1a2115b89", "committedDate": "2020-04-13T16:10:34Z", "message": "Fix API config for dev, test, and prod-sbx"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15ddfdaec7d82c74b937027fb9ea8198f01489e0", "author": {"user": null}, "url": "https://github.com/CMSgov/dpc-app/commit/15ddfdaec7d82c74b937027fb9ea8198f01489e0", "committedDate": "2020-04-13T17:58:35Z", "message": "Revert \"Revert DPC-34 since\"\n\nThis reverts commit 9dd05ab323b79f9e8d8f94f63a5a31039d8490cf."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMzQ1OTcx", "url": "https://github.com/CMSgov/dpc-app/pull/746#pullrequestreview-392345971", "createdAt": "2020-04-13T18:40:33Z", "commit": {"oid": "15ddfdaec7d82c74b937027fb9ea8198f01489e0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxODo0MDozNFrOGEwmuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxODo0MDozNFrOGEwmuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY0MzgzNQ==", "bodyText": "Method createEmptyBatch has 6 arguments (exceeds 4 allowed). Consider refactoring.", "url": "https://github.com/CMSgov/dpc-app/pull/746#discussion_r407643835", "createdAt": "2020-04-13T18:40:34Z", "author": {"login": "codeclimate"}, "path": "dpc-queue/src/main/java/gov/cms/dpc/queue/JobQueueCommon.java", "diffHunk": "@@ -44,8 +49,25 @@ public UUID createJob(UUID orgID, String providerID, List<String> patients, List\n         return jobBatches.stream().map(JobQueueBatch::getJobID).findFirst().orElseThrow(() -> new JobQueueFailure(\"Unable to create job. No batches to submit.\"));\n     }\n \n-    protected JobQueueBatch createJobBatch(UUID jobID, UUID orgID, String providerID, List<String> patients, List<ResourceType> resourceTypes) {\n-        return new JobQueueBatch(jobID, orgID, providerID, patients, resourceTypes);\n+    protected JobQueueBatch createJobBatch(UUID jobID,\n+                                           UUID orgID,\n+                                           String providerID,\n+                                           List<String> patients,\n+                                           List<ResourceType> resourceTypes,\n+                                           OffsetDateTime since,\n+                                           OffsetDateTime transactionTime) {\n+        return new JobQueueBatch(jobID, orgID, providerID, patients, resourceTypes, since, transactionTime);\n+    }\n+\n+    protected List<JobQueueBatch> createEmptyBatch(UUID jobID,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15ddfdaec7d82c74b937027fb9ea8198f01489e0"}, "originalPosition": 59}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMzQ3Mzgy", "url": "https://github.com/CMSgov/dpc-app/pull/746#pullrequestreview-392347382", "createdAt": "2020-04-13T18:42:45Z", "commit": {"oid": "9cf0c5e81d41acfda4e4c83de21132d1a2115b89"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxODo0Mjo0NlrOGEwrRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxODo0Mjo0NlrOGEwrRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY0NDk5Ng==", "bodyText": "This section matches a similar section found in the dpc-aggregator.\n\n  \n    \n      dpc-app/dpc-aggregation/src/main/resources/dev.application.conf\n    \n    \n        Lines 16 to 23\n      in\n      49dc30e\n    \n    \n    \n    \n\n        \n          \n           bbclient { \n        \n\n        \n          \n             serverBaseUrl = ${BFD_URL} \n        \n\n        \n          \n            \n        \n\n        \n          \n             keyStore { \n        \n\n        \n          \n               location = ${BB_KEYSTORE_LOCATION} \n        \n\n        \n          \n               defaultPassword = ${BB_KEYSTORE_PASS} \n        \n\n        \n          \n             } \n        \n\n        \n          \n           }", "url": "https://github.com/CMSgov/dpc-app/pull/746#discussion_r407644996", "createdAt": "2020-04-13T18:42:46Z", "author": {"login": "RickHawesUSDS"}, "path": "dpc-api/src/main/resources/dev.application.conf", "diffHunk": "@@ -23,6 +23,16 @@ dpc.api {\n         applicationContextPath = \"/api\"\n     }\n \n+\n+    bbclient {\n+        serverBaseUrl = ${BFD_URL}\n+\n+        keyStore {\n+            location = ${BB_KEYSTORE_LOCATION}\n+            defaultPassword = ${BB_KEYSTORE_PASS}\n+        }\n+    }\n+\n     attributionURL = \"http://backend.dpc-dev.local:8080/v1/\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9cf0c5e81d41acfda4e4c83de21132d1a2115b89"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMjg1ODg4", "url": "https://github.com/CMSgov/dpc-app/pull/746#pullrequestreview-393285888", "createdAt": "2020-04-14T20:51:17Z", "commit": {"oid": "15ddfdaec7d82c74b937027fb9ea8198f01489e0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMDo1MToxN1rOGFgbOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMDo1MToxN1rOGFgbOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQyNzMyMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t\t\t\t\t\t\"// Status should be 204\",\n          \n          \n            \n            \t\t\t\t\t\t\t\t\t\"// Status should be 202\",\n          \n      \n    \n    \n  \n\nOr maybe just remove the comment; it's clear what the test is.", "url": "https://github.com/CMSgov/dpc-app/pull/746#discussion_r408427320", "createdAt": "2020-04-14T20:51:17Z", "author": {"login": "em1"}, "path": "src/test/EndToEndRequestTest.postman_collection.json", "diffHunk": "@@ -1219,6 +1219,146 @@\n \t\t\t\t\t\t\"description\": \"Request a subset of the EOB data to ensure range requests work correctly.\"\n \t\t\t\t\t},\n \t\t\t\t\t\"response\": []\n+\t\t\t\t},\n+\t\t\t\t{\n+\t\t\t\t\t\"name\": \"Try export with _since\",\n+\t\t\t\t\t\"event\": [\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\t\"listen\": \"test\",\n+\t\t\t\t\t\t\t\"script\": {\n+\t\t\t\t\t\t\t\t\"id\": \"5497fa12-aefd-44c2-9254-2beb51c52e31\",\n+\t\t\t\t\t\t\t\t\"exec\": [\n+\t\t\t\t\t\t\t\t\t\"// Status should be 204\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15ddfdaec7d82c74b937027fb9ea8198f01489e0"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "634fa312e58c95fac1c29169b45a8fdfe60a131b", "author": {"user": null}, "url": "https://github.com/CMSgov/dpc-app/commit/634fa312e58c95fac1c29169b45a8fdfe60a131b", "committedDate": "2020-04-15T13:37:06Z", "message": "Fix 204 vs 202 confusion in postman descriptions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NjEyMDY3", "url": "https://github.com/CMSgov/dpc-app/pull/746#pullrequestreview-394612067", "createdAt": "2020-04-16T13:06:25Z", "commit": {"oid": "634fa312e58c95fac1c29169b45a8fdfe60a131b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee708b15254842401e64d6bf4ca6914296aad84c", "author": {"user": {"login": "RickHawesUSDS", "name": "Rick Hawes"}}, "url": "https://github.com/CMSgov/dpc-app/commit/ee708b15254842401e64d6bf4ca6914296aad84c", "committedDate": "2020-04-16T15:20:20Z", "message": "Merge branch 'master' into DPC-34-Since-Support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26235fbe719d2a2298e2214f1ff51bede0e3bbca", "author": {"user": {"login": "RickHawesUSDS", "name": "Rick Hawes"}}, "url": "https://github.com/CMSgov/dpc-app/commit/26235fbe719d2a2298e2214f1ff51bede0e3bbca", "committedDate": "2020-04-23T15:09:35Z", "message": "Merge branch 'master' into DPC-34-Since-Support"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 94, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}