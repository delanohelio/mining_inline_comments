{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc2NTE0NDEy", "number": 1017, "title": "DPC-503 fix: html validator to allow `&`", "bodyText": "Fixes DPC-503\n\nWhen an organization name or address contained &, it failed validation due to a check to ensure that there\nis no HTML in the form data.\nProposed Changes\n\n\nif the String being checked for HTML contains an ampersand surrounded by spaces, the ampersand is replaced by an empty space, thereby ignoring it\na unit test was updated to check for such a condition\n\nChange Details\n\nI opted for stripping out the & because the library we are using to check for HTML (jsoup) allows whitelisting HTML tags, but not necessarily strings like this. It is important to include the spaces before and after the & to ensure that we are only ignoring ampersands used to mean and while not ignoring other codes that begin with an ampersand. The unit test includes both use cases.\nSecurity Implications\n\n\n new software dependencies\n\n\n\n security controls or supporting software altered\n\n\n\n new data stored or transmitted\n\n\n\n security checklist is completed for this change\n\n\n\n requires more information or team discussion to evaluate security implications\n\n\n\n no PHI/PII is affected by this change\n\n\nAcceptance Validation\n\nIn addition to running all of the automated tests, which passed, I ran the web app locally and updated an organization to include an & in both the name as well as the address. These changes did not throw any errors.\n\n\n\nFeedback Requested\n\nI would've preferred to update the jsoup Whitelist as that seemed to be the intended purpose of the Whitelist, however, after reading some docs and trying some variations, I was unable to get it to work. I am open to any ideas about how to approach this differently.", "createdAt": "2020-08-31T20:10:34Z", "url": "https://github.com/CMSgov/dpc-app/pull/1017", "merged": true, "mergeCommit": {"oid": "5a87cf7bc6d8e0998f334fe833965fd6ffd38822"}, "closed": true, "closedAt": "2020-09-03T16:16:35Z", "author": {"login": "jonfulk"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdEYZT5AH2gAyNDc2NTE0NDEyOmZhN2M1YjRhYmU5YzE4MGVlNjJjMDlmZTJjZDlmNWM5YzVkM2M1ZmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFSlfjAH2gAyNDc2NTE0NDEyOmQ0MDFlZjBhOGZjN2FlMmIwNmM1YmIxNDY5MDdlNWY4MjNjZmMwODM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fa7c5b4abe9c180ee62c09fe2cd9f5c9c5d3c5ff", "author": {"user": {"login": "jonfulk", "name": "M.Zola"}}, "url": "https://github.com/CMSgov/dpc-app/commit/fa7c5b4abe9c180ee62c09fe2cd9f5c9c5d3c5ff", "committedDate": "2020-08-31T19:58:18Z", "message": "DPC-503: fix html validator to allow `&`\n\nWhen a name or address contained `&`, it was\nfailing validation due to a check to ensure that there\nis no HTML in the form data. This fix ignores such `&`\ncharacters."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4OTQzMTgz", "url": "https://github.com/CMSgov/dpc-app/pull/1017#pullrequestreview-478943183", "createdAt": "2020-08-31T20:47:36Z", "commit": {"oid": "fa7c5b4abe9c180ee62c09fe2cd9f5c9c5d3c5ff"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMDo0NzozNlrOHKIr1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMDo0NzozNlrOHKIr1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDM5MDEwMA==", "bodyText": "Would it make more sense to replace with \" and \"?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    String s1 = s.replaceAll(\"(\\\\s&\\\\s)\", \"   \");\n          \n          \n            \n                    String s1 = s.replaceAll(\"(\\\\s&\\\\s)\", \" and \");", "url": "https://github.com/CMSgov/dpc-app/pull/1017#discussion_r480390100", "createdAt": "2020-08-31T20:47:36Z", "author": {"login": "dhgreene"}, "path": "dpc-common/src/main/java/gov/cms/dpc/common/hibernate/validator/NoHtmlValidator.java", "diffHunk": "@@ -23,7 +23,9 @@ public boolean isValid(String s, ConstraintValidatorContext constraintValidatorC\n         if (StringUtils.isBlank(s)) {\n             return true;\n         }\n-        String safe = Jsoup.clean(s, \"\", Whitelist.none(), new Document.OutputSettings().prettyPrint(false));\n-        return safe.equals(s);\n+        // Ignore `&` in names and addresses\n+        String s1 = s.replaceAll(\"(\\\\s&\\\\s)\", \"   \");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa7c5b4abe9c180ee62c09fe2cd9f5c9c5d3c5ff"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eac85b6bdcb6fbcad159d94c81883e4152c52ab5", "author": {"user": {"login": "jonfulk", "name": "M.Zola"}}, "url": "https://github.com/CMSgov/dpc-app/commit/eac85b6bdcb6fbcad159d94c81883e4152c52ab5", "committedDate": "2020-08-31T22:30:21Z", "message": "Merge branch 'master' into jkf/dpc-503-allow-amp"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxOTYyMDYz", "url": "https://github.com/CMSgov/dpc-app/pull/1017#pullrequestreview-481962063", "createdAt": "2020-09-03T15:34:32Z", "commit": {"oid": "eac85b6bdcb6fbcad159d94c81883e4152c52ab5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d401ef0a8fc7ae2b06c5bb146907e5f823cfc083", "author": {"user": {"login": "jonfulk", "name": "M.Zola"}}, "url": "https://github.com/CMSgov/dpc-app/commit/d401ef0a8fc7ae2b06c5bb146907e5f823cfc083", "committedDate": "2020-09-03T15:46:06Z", "message": "Merge branch 'master' into jkf/dpc-503-allow-amp"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 375, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}