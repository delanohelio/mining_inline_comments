{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1MzI4MDUx", "number": 860, "title": "DPC-326: As an internal user, I want to filter organizations", "bodyText": "Why\nThe filter for organizations was broken and internal users would not be able to more succinctly search for specific organizations.\n\nWhat Changed\n\n\nAdded filter modal for the organization dashboard allowing the internal user to filter by:\n\nWhether or not the org is enabled in the API\nCreated before/after dates\nOrganization type\n\n\n\nChoices Made\n\nCombined user search and organization search into a \"Base Search\" service file\n\nTickets closed:\nDPC-326\nFuture Work\nN/A\nChecklist\n\n All tests are passing via make ci-app (app change) and make ci-web (website change)\n[] Swagger documentation has been updated\n[] FHIR documentation has been updated\n[] Any required dpc-ops changes have a PR submitted and mentioned in this ticket\n[] Any manual migration steps are documented, scripts written (where applicable), and tested\n[] Before merging, any required dpc-ops changes have been approved and merged into master of the dpc-ops repo", "createdAt": "2020-06-16T16:21:27Z", "url": "https://github.com/CMSgov/dpc-app/pull/860", "merged": true, "mergeCommit": {"oid": "aa06f4dab5098d3116a2b6105c267d29f05319a5"}, "closed": true, "closedAt": "2020-06-18T20:02:24Z", "author": {"login": "Sun-Mountain"}, "timelineItems": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrhuYMgH2gAyNDM1MzI4MDUxOjI5ODBmYWVjMmQ3NmM5MzY2ZTRjYzIxZTQzNDYzZWE3M2UzZjgyOGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcskFgmgFqTQzMzYwNTk1Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2980faec2d76c9366e4cc21e43463ea73e3f828e", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/2980faec2d76c9366e4cc21e43463ea73e3f828e", "committedDate": "2020-06-15T14:42:21Z", "message": "Init"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5936ad6d7357492c1d656a46fc15a0540d03334", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/d5936ad6d7357492c1d656a46fc15a0540d03334", "committedDate": "2020-06-15T17:21:55Z", "message": "Org filter providers/vendors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb98913fa764ed8813d4a95bdd3c275408d71e07", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/cb98913fa764ed8813d4a95bdd3c275408d71e07", "committedDate": "2020-06-15T21:01:50Z", "message": "Search progress"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb2b6bfeeb8932c5be287f0fcfdcd3e94cc92c07", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/fb2b6bfeeb8932c5be287f0fcfdcd3e94cc92c07", "committedDate": "2020-06-16T13:38:09Z", "message": "Search org by type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2899f33c86b30852e5701fa44a09f3eb9daf868b", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/2899f33c86b30852e5701fa44a09f3eb9daf868b", "committedDate": "2020-06-16T14:46:05Z", "message": "Registered or unregistered added"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4258e1c1ad412520b5d51a9513ba7383ff0e962d", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/4258e1c1ad412520b5d51a9513ba7383ff0e962d", "committedDate": "2020-06-16T16:14:51Z", "message": "Register/not register filter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNjk2NDUx", "url": "https://github.com/CMSgov/dpc-app/pull/860#pullrequestreview-431696451", "createdAt": "2020-06-16T16:39:56Z", "commit": {"oid": "4258e1c1ad412520b5d51a9513ba7383ff0e962d"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNjozOTo1NlrOGkkCAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNjozOTo1NlrOGkkCDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk5MjI1Ng==", "bodyText": "Similar blocks of code found in 2 locations. Consider refactoring.", "url": "https://github.com/CMSgov/dpc-app/pull/860#discussion_r440992256", "createdAt": "2020-06-16T16:39:56Z", "author": {"login": "codeclimate"}, "path": "dpc-web/app/services/organization_search.rb", "diffHunk": "@@ -0,0 +1,80 @@\n+# frozen_string_literal: true\n+\n+class OrganizationSearch\n+  ALLOWED_SCOPES = %w[all provider vendor].freeze\n+\n+  attr_reader :params, :initial_scope\n+\n+  def initialize(params: {}, scope: 'all')\n+    scope = 'all'\n+\n+    @params = params\n+    @initial_scope = scope\n+  end\n+\n+  def results\n+    @results ||= query\n+  end\n+\n+  private\n+\n+  def query\n+    scope = Organization\n+\n+    scope = apply_org_queries(scope)\n+    scope = apply_date_queries(scope)\n+    scope = apply_keyword_search(scope)\n+\n+    scope\n+  end\n+\n+  def apply_org_queries(scope)\n+    # Check if registered org\n+    if params[:registered_org]\n+      radio = params[:registered_org]\n+\n+      if radio == 'registered'\n+        scope = scope.where('id IN(SELECT DISTINCT(organization_id) FROM registered_organizations)')\n+      elsif radio == 'unregistered'\n+        scope = scope.where('id NOT IN(SELECT DISTINCT(organization_id) FROM registered_organizations)')\n+      else\n+        scope = Organization\n+      end\n+    end\n+\n+    # Check if provider or vender\n+    if params[:org_type] == 'vendor'\n+      scope = scope.vendor\n+    elsif params[:org_type] == 'provider'\n+      scope = scope.provider\n+    end\n+\n+    # Check org type\n+    if params[:organization_type].present?\n+      scope = scope.where(organization_type: params[:organization_type])\n+    end\n+\n+    scope\n+  end\n+\n+  def apply_date_queries(scope)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4258e1c1ad412520b5d51a9513ba7383ff0e962d"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk5MjI2MA==", "bodyText": "Argument scope was shadowed by a local variable before it was used.", "url": "https://github.com/CMSgov/dpc-app/pull/860#discussion_r440992260", "createdAt": "2020-06-16T16:39:56Z", "author": {"login": "codeclimate"}, "path": "dpc-web/app/services/organization_search.rb", "diffHunk": "@@ -0,0 +1,80 @@\n+# frozen_string_literal: true\n+\n+class OrganizationSearch\n+  ALLOWED_SCOPES = %w[all provider vendor].freeze\n+\n+  attr_reader :params, :initial_scope\n+\n+  def initialize(params: {}, scope: 'all')\n+    scope = 'all'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4258e1c1ad412520b5d51a9513ba7383ff0e962d"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk5MjI2Mw==", "bodyText": "Cyclomatic complexity for apply_org_queries is too high. [7/6]", "url": "https://github.com/CMSgov/dpc-app/pull/860#discussion_r440992263", "createdAt": "2020-06-16T16:39:56Z", "author": {"login": "codeclimate"}, "path": "dpc-web/app/services/organization_search.rb", "diffHunk": "@@ -0,0 +1,80 @@\n+# frozen_string_literal: true\n+\n+class OrganizationSearch\n+  ALLOWED_SCOPES = %w[all provider vendor].freeze\n+\n+  attr_reader :params, :initial_scope\n+\n+  def initialize(params: {}, scope: 'all')\n+    scope = 'all'\n+\n+    @params = params\n+    @initial_scope = scope\n+  end\n+\n+  def results\n+    @results ||= query\n+  end\n+\n+  private\n+\n+  def query\n+    scope = Organization\n+\n+    scope = apply_org_queries(scope)\n+    scope = apply_date_queries(scope)\n+    scope = apply_keyword_search(scope)\n+\n+    scope\n+  end\n+\n+  def apply_org_queries(scope)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4258e1c1ad412520b5d51a9513ba7383ff0e962d"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk5MjI2NQ==", "bodyText": "Method has too many lines. [19/15]", "url": "https://github.com/CMSgov/dpc-app/pull/860#discussion_r440992265", "createdAt": "2020-06-16T16:39:56Z", "author": {"login": "codeclimate"}, "path": "dpc-web/app/services/organization_search.rb", "diffHunk": "@@ -0,0 +1,80 @@\n+# frozen_string_literal: true\n+\n+class OrganizationSearch\n+  ALLOWED_SCOPES = %w[all provider vendor].freeze\n+\n+  attr_reader :params, :initial_scope\n+\n+  def initialize(params: {}, scope: 'all')\n+    scope = 'all'\n+\n+    @params = params\n+    @initial_scope = scope\n+  end\n+\n+  def results\n+    @results ||= query\n+  end\n+\n+  private\n+\n+  def query\n+    scope = Organization\n+\n+    scope = apply_org_queries(scope)\n+    scope = apply_date_queries(scope)\n+    scope = apply_keyword_search(scope)\n+\n+    scope\n+  end\n+\n+  def apply_org_queries(scope)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4258e1c1ad412520b5d51a9513ba7383ff0e962d"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk5MjI2OA==", "bodyText": "Perceived complexity for apply_org_queries is too high. [9/7]", "url": "https://github.com/CMSgov/dpc-app/pull/860#discussion_r440992268", "createdAt": "2020-06-16T16:39:56Z", "author": {"login": "codeclimate"}, "path": "dpc-web/app/services/organization_search.rb", "diffHunk": "@@ -0,0 +1,80 @@\n+# frozen_string_literal: true\n+\n+class OrganizationSearch\n+  ALLOWED_SCOPES = %w[all provider vendor].freeze\n+\n+  attr_reader :params, :initial_scope\n+\n+  def initialize(params: {}, scope: 'all')\n+    scope = 'all'\n+\n+    @params = params\n+    @initial_scope = scope\n+  end\n+\n+  def results\n+    @results ||= query\n+  end\n+\n+  private\n+\n+  def query\n+    scope = Organization\n+\n+    scope = apply_org_queries(scope)\n+    scope = apply_date_queries(scope)\n+    scope = apply_keyword_search(scope)\n+\n+    scope\n+  end\n+\n+  def apply_org_queries(scope)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4258e1c1ad412520b5d51a9513ba7383ff0e962d"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba9057ee5c80f2517479633c49db522fefc6b191", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/ba9057ee5c80f2517479633c49db522fefc6b191", "committedDate": "2020-06-16T16:54:07Z", "message": "remove form"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d31e233a3034bed72f59ca01f37251a4255749a2", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/d31e233a3034bed72f59ca01f37251a4255749a2", "committedDate": "2020-06-16T16:57:57Z", "message": "Fix spec"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNzMzMDA4", "url": "https://github.com/CMSgov/dpc-app/pull/860#pullrequestreview-431733008", "createdAt": "2020-06-16T17:26:46Z", "commit": {"oid": "d31e233a3034bed72f59ca01f37251a4255749a2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzoyNjo0NlrOGklvwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzoyNjo0NlrOGklvwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAyMDM1NA==", "bodyText": "Use the return of the conditional for variable assignment and comparison.", "url": "https://github.com/CMSgov/dpc-app/pull/860#discussion_r441020354", "createdAt": "2020-06-16T17:26:46Z", "author": {"login": "codeclimate"}, "path": "dpc-web/app/services/organization_search.rb", "diffHunk": "@@ -0,0 +1,90 @@\n+# frozen_string_literal: true\n+\n+class OrganizationSearch\n+  ALLOWED_SCOPES = %w[all provider vendor].freeze\n+\n+  attr_reader :params, :initial_scope\n+\n+  def initialize(params: {}, scope: 'all')\n+    scope = 'all'\n+\n+    @params = params\n+    @initial_scope = scope\n+  end\n+\n+  def results\n+    @results ||= query\n+  end\n+\n+  private\n+\n+  def query\n+    scope = Organization\n+\n+    scope = apply_org_queries(scope)\n+    scope = apply_date_queries(scope)\n+    scope = apply_keyword_search(scope)\n+    scope = apply_search_word(scope)\n+\n+    scope\n+  end\n+\n+  def apply_org_queries(scope)\n+    # Check if registered org\n+    if params[:registered_org]\n+      radio = params[:registered_org]\n+\n+      if radio == 'registered'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d31e233a3034bed72f59ca01f37251a4255749a2"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b3ae2a727143dd47623e578c307a14777c5733c", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/5b3ae2a727143dd47623e578c307a14777c5733c", "committedDate": "2020-06-16T18:23:31Z", "message": "code climate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98de153affb6a09dad644971f5d0611511d0264c", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/98de153affb6a09dad644971f5d0611511d0264c", "committedDate": "2020-06-16T19:12:32Z", "message": "code climate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "659556cb2125a27e7912912215ee250a254eebe1", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/659556cb2125a27e7912912215ee250a254eebe1", "committedDate": "2020-06-16T19:26:56Z", "message": "Fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "917973c6b24911c101c07d39346ea1043f8c168e", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/917973c6b24911c101c07d39346ea1043f8c168e", "committedDate": "2020-06-16T19:28:54Z", "message": "Fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxOTA3MzAz", "url": "https://github.com/CMSgov/dpc-app/pull/860#pullrequestreview-431907303", "createdAt": "2020-06-16T21:31:59Z", "commit": {"oid": "917973c6b24911c101c07d39346ea1043f8c168e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMTozMTo1OVrOGkt7Rw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMTozMTo1OVrOGkt7Rw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE1NDM3NQ==", "bodyText": "Method has too many lines. [16/15]", "url": "https://github.com/CMSgov/dpc-app/pull/860#discussion_r441154375", "createdAt": "2020-06-16T21:31:59Z", "author": {"login": "codeclimate"}, "path": "dpc-web/app/services/organization_search.rb", "diffHunk": "@@ -0,0 +1,73 @@\n+# frozen_string_literal: true\n+\n+class OrganizationSearch\n+  ALLOWED_SCOPES = %w[all provider vendor].freeze\n+\n+  attr_reader :params, :initial_scope\n+\n+  def initialize(params: {}, scope: 'all')\n+    scope = 'all' unless ALLOWED_SCOPES.include? scope\n+\n+    @params = params\n+    @initial_scope = scope\n+  end\n+\n+  def results\n+    @results ||= query\n+  end\n+\n+  private\n+\n+  def query\n+    scope = Organization.send(initial_scope)\n+\n+    scope = apply_org_queries(scope)\n+    scope = apply_date_queries(scope)\n+    scope = apply_keyword_search(scope)\n+\n+    scope\n+  end\n+\n+  def apply_org_queries(scope)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "917973c6b24911c101c07d39346ea1043f8c168e"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee32df7826eb51cd68984746ffd8470ac1287dfd", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/ee32df7826eb51cd68984746ffd8470ac1287dfd", "committedDate": "2020-06-17T13:32:49Z", "message": "Search simplify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a8338ffdaede0d4cb02354b3800aae155264d44", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/6a8338ffdaede0d4cb02354b3800aae155264d44", "committedDate": "2020-06-17T13:37:20Z", "message": "Code climate simplify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b92e967a3bd675d0345544dad3773ca67f88cbab", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/b92e967a3bd675d0345544dad3773ca67f88cbab", "committedDate": "2020-06-17T17:20:07Z", "message": "Base Search progress"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69cd949f82ea556f9e857a4b5daf0824d9457a8a", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/69cd949f82ea556f9e857a4b5daf0824d9457a8a", "committedDate": "2020-06-17T18:23:05Z", "message": "Base search complete"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f62b132cc2c3e3b98aa1c2025754ca6d13b355d9", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/f62b132cc2c3e3b98aa1c2025754ca6d13b355d9", "committedDate": "2020-06-17T20:15:36Z", "message": "Fix rspec"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdb6e63a2df5d075e816cf4163329a6f85cfc0ba", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/bdb6e63a2df5d075e816cf4163329a6f85cfc0ba", "committedDate": "2020-06-17T20:33:08Z", "message": "Update rspec"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20ddc3db6c0b5728f2e95d174ad5df4ee4304cb9", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/20ddc3db6c0b5728f2e95d174ad5df4ee4304cb9", "committedDate": "2020-06-17T20:34:59Z", "message": "Fix code climate issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fada6b8e0521d73727dcb6a7a935495b60ae1bee", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/fada6b8e0521d73727dcb6a7a935495b60ae1bee", "committedDate": "2020-06-18T18:06:08Z", "message": "Update search filter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5c1f049b11edab154666c40a719f2ae4043ef23", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/f5c1f049b11edab154666c40a719f2ae4043ef23", "committedDate": "2020-06-18T18:07:42Z", "message": "Merge branch 'master' into nicole/dpc-326-org-filter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNTU1MzQ0", "url": "https://github.com/CMSgov/dpc-app/pull/860#pullrequestreview-433555344", "createdAt": "2020-06-18T18:47:30Z", "commit": {"oid": "f5c1f049b11edab154666c40a719f2ae4043ef23"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxODo0NzozMVrOGl749g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxODo0NzozMVrOGl749g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQzMTczNA==", "bodyText": "Do we need to filter here which parameters we accept, to be consistent with #843 ?", "url": "https://github.com/CMSgov/dpc-app/pull/860#discussion_r442431734", "createdAt": "2020-06-18T18:47:31Z", "author": {"login": "dhgreene"}, "path": "dpc-web/app/controllers/internal/organizations_controller.rb", "diffHunk": "@@ -5,22 +5,9 @@ class OrganizationsController < ApplicationController\n     before_action :authenticate_internal_user!\n \n     def index\n-      scope = if params[:org_type] == 'vendor'\n-                Organization.vendor\n-              elsif params[:org_type] == 'provider'\n-                Organization.provider\n-              else\n-                Organization.all\n-              end\n-\n-      if keyword_param[:keyword].present?\n-        keyword = \"%#{keyword_param[:keyword].downcase}%\"\n-        scope = scope.where(\n-          'LOWER(name) LIKE :keyword', keyword: keyword\n-        )\n-      end\n+      results = BaseSearch.new(params: params, scope: params[:org_type]).results\n \n-      @organizations = scope.page params[:page]\n+      @organizations = results.page params[:page]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5c1f049b11edab154666c40a719f2ae4043ef23"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89bedbd1f56051e976b5e0e5651b466feebfd549", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/89bedbd1f56051e976b5e0e5651b466feebfd549", "committedDate": "2020-06-18T19:22:48Z", "message": "stronger parameters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35ee0c096665f61d4d699927d014ec9728384cac", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/35ee0c096665f61d4d699927d014ec9728384cac", "committedDate": "2020-06-18T19:23:00Z", "message": "Merge branch 'nicole/dpc-326-org-filter' of github.com:CMSgov/dpc-app into nicole/dpc-326-org-filter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNjA1OTU3", "url": "https://github.com/CMSgov/dpc-app/pull/860#pullrequestreview-433605957", "createdAt": "2020-06-18T20:01:21Z", "commit": {"oid": "35ee0c096665f61d4d699927d014ec9728384cac"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 499, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}