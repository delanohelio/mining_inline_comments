{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM2NDQxODc2", "number": 1139, "title": "DPC-952 Do not allow an org to view another org's Group", "bodyText": "Fixes DPC-952\n\nCurrently, if you have API access and can guess the UUID of any existing Group resource, you can show the UUID's of the patients in that group. This is too broad of an access; each organization should only be able to see its own resources, including Groups.\nDuring the implementation of this fix it was found that an organization could also delete or update another's group. This patch will fix theses issues as well.\nProposed Changes\nHow path authentication is handled:\n\n\nPath authentication (triggered by PathAuthorizer annotation on a resource) is handled by the \"MacaroonsAuthorizer\" before a request is sent to a resource.\n\n\nThe MacaroonsAuthorizer uses an attribution client to search for resources (Resource searched is based on path) filtered by (organization or tag) and resource UUID (specified in path) and allows request to proceed if a resource is returned.\n\n\nCause of issue being reported:\nDPC-Attribution's Group search did not support resource UUID as a filter, so it was being ignored. Since the UUID of the resource in the path was being ignored the search simply returned all groups belonging to the organization, this would allow access to any group (as long as there was a result in the search)\n\nChange Details\nAdd support for the _id filter in group search (dpc-attribution)\n\nSecurity Implications\n\n\n new software dependencies\n\n\n\n security controls or supporting software altered\n\n\n\n new data stored or transmitted\n\n\n\n security checklist is completed for this change\n\n\n\n requires more information or team discussion to evaluate security implications\n\n\n\n no PHI/PII is affected by this change\n\n\nAcceptance Validation\nTested Locally - All tests pass\nPending manual test on dev\n\n\nFeedback Requested\n\nAny", "createdAt": "2020-12-11T03:04:36Z", "url": "https://github.com/CMSgov/dpc-app/pull/1139", "merged": true, "mergeCommit": {"oid": "953f35976fb1d0a3306512407dd19613374c2884"}, "closed": true, "closedAt": "2020-12-14T05:09:53Z", "author": {"login": "MrMorie"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdk9ujbAH2gAyNTM2NDQxODc2OmNhMWYwMGYxMjRmMWY4MzVmMzJmMjQwYjBmMmRhNzVlZWI2Y2UxOWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdlRkY9AFqTU1MDY2NTcxMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ca1f00f124f1f835f32f240b0f2da75eeb6ce19b", "author": {"user": {"login": "MrMorie", "name": "Salvador"}}, "url": "https://github.com/CMSgov/dpc-app/commit/ca1f00f124f1f835f32f240b0f2da75eeb6ce19b", "committedDate": "2020-12-11T01:33:34Z", "message": "Added resource filter to Group search. added group integration tests. Fixes group path param  security issue."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "840389b2538e337dadf57fcb643d295b53f60171", "author": {"user": {"login": "MrMorie", "name": "Salvador"}}, "url": "https://github.com/CMSgov/dpc-app/commit/840389b2538e337dadf57fcb643d295b53f60171", "committedDate": "2020-12-11T03:05:38Z", "message": "Merge branch 'master' into sg/DPC-952-limit-roster-visibility"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5NzczNjk0", "url": "https://github.com/CMSgov/dpc-app/pull/1139#pullrequestreview-549773694", "createdAt": "2020-12-11T03:17:32Z", "commit": {"oid": "840389b2538e337dadf57fcb643d295b53f60171"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwMzoxNzozMlrOIDnSRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwMzoxNzozMlrOIDnSRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY2MDI5Mg==", "bodyText": "I tried hard to format this indentation, but failed and gave up. \ud83d\ude1e", "url": "https://github.com/CMSgov/dpc-app/pull/1139#discussion_r540660292", "createdAt": "2020-12-11T03:17:32Z", "author": {"login": "MrMorie"}, "path": "dpc-attribution/src/main/java/gov/cms/dpc/attribution/resources/v1/GroupResource.java", "diffHunk": "@@ -108,7 +108,9 @@ public Response createRoster(Group attributionRoster) {\n             \"<p> You can search for Groups associated to a given provider (via the Provider NPI) and groups for which a patient is a member of (by the Patient resource ID)\",\n             response = Bundle.class)\n     @Override\n-    public List<Group> rosterSearch(@ApiParam(value = \"Organization ID\")\n+    public List<Group> rosterSearch(@ApiParam(value = \"Group resource UUID\")\n+                                        @QueryParam(Group.SP_RES_ID) UUID rosterID,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "840389b2538e337dadf57fcb643d295b53f60171"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4af4906d4b759b4b1c71612689f55562c766dc0", "author": {"user": {"login": "MrMorie", "name": "Salvador"}}, "url": "https://github.com/CMSgov/dpc-app/commit/d4af4906d4b759b4b1c71612689f55562c766dc0", "committedDate": "2020-12-11T03:19:37Z", "message": "Fixed typo and added documentaion to new file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64e721f571bbd4eb72306cc42c0ee78a05bf5722", "author": {"user": {"login": "MrMorie", "name": "Salvador"}}, "url": "https://github.com/CMSgov/dpc-app/commit/64e721f571bbd4eb72306cc42c0ee78a05bf5722", "committedDate": "2020-12-11T03:19:53Z", "message": "Merge branch 'sg/DPC-952-limit-roster-visibility' of https://github.com/CMSgov/dpc-app into sg/DPC-952-limit-roster-visibility"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00150b6576579f8c5fbad886724ee80a84efea52", "author": {"user": {"login": "MrMorie", "name": "Salvador"}}, "url": "https://github.com/CMSgov/dpc-app/commit/00150b6576579f8c5fbad886724ee80a84efea52", "committedDate": "2020-12-11T03:21:43Z", "message": "Fixed documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e017cd21b8e6314b9b68000a58ade3b859471b6", "author": {"user": {"login": "MrMorie", "name": "Salvador"}}, "url": "https://github.com/CMSgov/dpc-app/commit/4e017cd21b8e6314b9b68000a58ade3b859471b6", "committedDate": "2020-12-11T03:26:13Z", "message": "Fixed Typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "860ac4cac17a8d69a8ea3d9ed94e9090c81d0f7e", "author": {"user": {"login": "MrMorie", "name": "Salvador"}}, "url": "https://github.com/CMSgov/dpc-app/commit/860ac4cac17a8d69a8ea3d9ed94e9090c81d0f7e", "committedDate": "2020-12-11T18:59:10Z", "message": "Merge branch 'master' into sg/DPC-952-limit-roster-visibility"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwNjA2OTQ0", "url": "https://github.com/CMSgov/dpc-app/pull/1139#pullrequestreview-550606944", "createdAt": "2020-12-11T22:02:12Z", "commit": {"oid": "860ac4cac17a8d69a8ea3d9ed94e9090c81d0f7e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQyMjowMjoxM1rOIEQ4Mg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQyMjowMjoxM1rOIEQ4Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTM0MTc0Ng==", "bodyText": "only going by the names of the methods but did you test that a org cannot add another org's patients via UUID?", "url": "https://github.com/CMSgov/dpc-app/pull/1139#discussion_r541341746", "createdAt": "2020-12-11T22:02:13Z", "author": {"login": "MrBilnon"}, "path": "dpc-api/src/test/java/gov/cms/dpc/api/resources/v1/GroupResourceTest.java", "diffHunk": "@@ -395,4 +400,157 @@ public void testProvenanceHeaderAndGroupProviderMatch() {\n                 .encodedJson()\n                 .execute();\n     }\n+\n+    @Test\n+    public void testGroupCanOnlyBeRetrievedByOwner() throws GeneralSecurityException, IOException, URISyntaxException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "860ac4cac17a8d69a8ea3d9ed94e9090c81d0f7e"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwNjY1NzEz", "url": "https://github.com/CMSgov/dpc-app/pull/1139#pullrequestreview-550665713", "createdAt": "2020-12-12T00:40:34Z", "commit": {"oid": "860ac4cac17a8d69a8ea3d9ed94e9090c81d0f7e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 334, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}