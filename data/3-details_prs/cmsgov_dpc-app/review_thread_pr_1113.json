{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0NDQ5MjI2", "number": 1113, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNToxNjoxMVrOE5iNFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMjoyOTo1OVrOE6y0uA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4NzY0Njk0OnYy", "diffSide": "RIGHT", "path": "dpc-bluebutton/src/main/java/gov/cms/dpc/bluebutton/client/BlueButtonClientImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNToxNjoxMVrOH0DXnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNToxNjoxMVrOH0DXnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM0MzE5Ng==", "bodyText": "Have we tested in dev from an external address, to see whether we get the actual client IP or Akamai's IP?", "url": "https://github.com/CMSgov/dpc-app/pull/1113#discussion_r524343196", "createdAt": "2020-11-16T15:16:11Z", "author": {"login": "dhgreene"}, "path": "dpc-bluebutton/src/main/java/gov/cms/dpc/bluebutton/client/BlueButtonClientImpl.java", "diffHunk": "@@ -268,4 +279,23 @@ public String hashMbi(String mbi) throws GeneralSecurityException {\n             timerContext.stop();\n         }\n     }\n+\n+    private void addBFDHeaders(IQuery<?> query) {\n+\n+        try {\n+            query.withAdditionalHeader(Constants.INCLUDE_IDENTIFIERS_HEADER, \"mbi\");\n+            var providerId = MDC.get(MDCConstants.PROVIDER_ID);\n+            var jobId = MDC.get(MDCConstants.JOB_ID);\n+            if (StringUtils.isNotBlank(providerId)) {\n+                query.withAdditionalHeader(Constants.BULK_CLIENT_ID_HEADER, providerId);\n+            }\n+            if (StringUtils.isNotBlank(jobId)) {\n+                query.withAdditionalHeader(Constants.BULK_JOB_ID_HEADER, jobId);\n+            }\n+            query.withAdditionalHeader(HttpHeaders.X_FORWARDED_FOR, InetAddress.getLocalHost().getHostAddress());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01af871ff00fa03ba1f78d48ac3fc4e922c74478"}, "originalPosition": 86}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMDgyOTM0OnYy", "diffSide": "RIGHT", "path": "dpc-api/src/main/java/gov/cms/dpc/api/resources/v1/GroupResource.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMjoyMTo0OVrOH2Etfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMjozNDozN1rOH2FGWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ2MjMzNA==", "bodyText": "Not an issue, but we could just inject the HttpHeaders instead of the entire request.", "url": "https://github.com/CMSgov/dpc-app/pull/1113#discussion_r526462334", "createdAt": "2020-11-18T22:21:49Z", "author": {"login": "MrMorie"}, "path": "dpc-api/src/main/java/gov/cms/dpc/api/resources/v1/GroupResource.java", "diffHunk": "@@ -272,7 +274,8 @@ public Response export(@ApiParam(hidden = true)\n                            @DefaultValue(FHIR_NDJSON) @QueryParam(\"_outputFormat\") @NoHtml String outputFormat,\n                            @ApiParam(value = \"Resources will be included in the response if their state has changed after the supplied time (e.g. if Resource.meta.lastUpdated is later than the supplied _since time).\")\n                            @QueryParam(\"_since\") @NoHtml String sinceParam,\n-                           @ApiParam(hidden = true) @HeaderParam(\"Prefer\")  @Valid String Prefer) {\n+                           @ApiParam(hidden = true) @HeaderParam(\"Prefer\")  @Valid String Prefer,\n+                           @Context HttpServletRequest request) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "355fb79d77fc39c6fa1f500c7c380dd0e015c650"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ2Mjk2Mw==", "bodyText": "Not an issue, but we could just inject the HttpHeaders instead of the entire request.\n\nI don't just use the x-forwarded-for header, if it's not present then I'll call request.getRemoteAddr()", "url": "https://github.com/CMSgov/dpc-app/pull/1113#discussion_r526462963", "createdAt": "2020-11-18T22:23:08Z", "author": {"login": "MrBilnon"}, "path": "dpc-api/src/main/java/gov/cms/dpc/api/resources/v1/GroupResource.java", "diffHunk": "@@ -272,7 +274,8 @@ public Response export(@ApiParam(hidden = true)\n                            @DefaultValue(FHIR_NDJSON) @QueryParam(\"_outputFormat\") @NoHtml String outputFormat,\n                            @ApiParam(value = \"Resources will be included in the response if their state has changed after the supplied time (e.g. if Resource.meta.lastUpdated is later than the supplied _since time).\")\n                            @QueryParam(\"_since\") @NoHtml String sinceParam,\n-                           @ApiParam(hidden = true) @HeaderParam(\"Prefer\")  @Valid String Prefer) {\n+                           @ApiParam(hidden = true) @HeaderParam(\"Prefer\")  @Valid String Prefer,\n+                           @Context HttpServletRequest request) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ2MjMzNA=="}, "originalCommit": {"oid": "355fb79d77fc39c6fa1f500c7c380dd0e015c650"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ2ODY5OA==", "bodyText": "oh right. good point.", "url": "https://github.com/CMSgov/dpc-app/pull/1113#discussion_r526468698", "createdAt": "2020-11-18T22:34:37Z", "author": {"login": "MrMorie"}, "path": "dpc-api/src/main/java/gov/cms/dpc/api/resources/v1/GroupResource.java", "diffHunk": "@@ -272,7 +274,8 @@ public Response export(@ApiParam(hidden = true)\n                            @DefaultValue(FHIR_NDJSON) @QueryParam(\"_outputFormat\") @NoHtml String outputFormat,\n                            @ApiParam(value = \"Resources will be included in the response if their state has changed after the supplied time (e.g. if Resource.meta.lastUpdated is later than the supplied _since time).\")\n                            @QueryParam(\"_since\") @NoHtml String sinceParam,\n-                           @ApiParam(hidden = true) @HeaderParam(\"Prefer\")  @Valid String Prefer) {\n+                           @ApiParam(hidden = true) @HeaderParam(\"Prefer\")  @Valid String Prefer,\n+                           @Context HttpServletRequest request) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ2MjMzNA=="}, "originalCommit": {"oid": "355fb79d77fc39c6fa1f500c7c380dd0e015c650"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMDg1NTYwOnYy", "diffSide": "RIGHT", "path": "dpc-common/src/main/java/gov/cms/dpc/common/Constants.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMjoyOTo1OVrOH2E9jQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMjozNDoyNlrOH2FF6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ2NjQ0NQ==", "bodyText": "Since we have an MDCConstants.java file, maybe rename this to something more specific? HeadersConstants? Unless this will be a catch all constants file and just happens to have only headers at the moment.", "url": "https://github.com/CMSgov/dpc-app/pull/1113#discussion_r526466445", "createdAt": "2020-11-18T22:29:59Z", "author": {"login": "MrMorie"}, "path": "dpc-common/src/main/java/gov/cms/dpc/common/Constants.java", "diffHunk": "@@ -0,0 +1,10 @@\n+package gov.cms.dpc.common;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "355fb79d77fc39c6fa1f500c7c380dd0e015c650"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ2ODU4Nw==", "bodyText": "I was going to use this as a catch all in the future", "url": "https://github.com/CMSgov/dpc-app/pull/1113#discussion_r526468587", "createdAt": "2020-11-18T22:34:26Z", "author": {"login": "MrBilnon"}, "path": "dpc-common/src/main/java/gov/cms/dpc/common/Constants.java", "diffHunk": "@@ -0,0 +1,10 @@\n+package gov.cms.dpc.common;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ2NjQ0NQ=="}, "originalCommit": {"oid": "355fb79d77fc39c6fa1f500c7c380dd0e015c650"}, "originalPosition": 1}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 24, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}