{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUwNTM3MzIy", "number": 913, "title": "DPC-545 configure container to run integration tests in it", "bodyText": "Fixes DPC-545\n\nIn Jenkins, patient everything integration test does not have access to the /tmp folder on the host (where aggregation puts it's files) so to solve this, we will run the tests in a container where we can map the /tmp folder as a volume to the container.\nProposed Changes\n\n\nRun api integration tests in container\nMade jobTimeoutInSeconds configurable via SSM\n\nChange Details\n\nUsing the official maven docker image to run the mvn test command in that container instead of directly in jenkins. This allows us to map the /tmp folder of the host to the container so when patient everything runs it can access the files that aggregation generates. Also cleaned up the jobTimeoutInSeconds configuration so it can be configured via SSM.\nSecurity Implications\n\n\n new software dependencies\n\n\n\n security controls or supporting software altered\n\n\n\n new data stored or transmitted\n\n\n\n security checklist is completed for this change\n\n\n\n requires more information or team discussion to evaluate security implications\n\n\n\n no PHI/PII is affected by this change\n\n\nAcceptance Validation\n\n\nFeedback Requested\n\nDo I need a security checklist for bringing in the new docker image although it's only ran locally (via make ci-app) and in jenkins and travis?", "createdAt": "2020-07-16T21:38:47Z", "url": "https://github.com/CMSgov/dpc-app/pull/913", "merged": true, "mergeCommit": {"oid": "3b9411315ecc6c0b192be1e9ea0fb7d7e89fffef"}, "closed": true, "closedAt": "2020-07-21T19:29:45Z", "author": {"login": "MrBilnon"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1lsTmgH2gAyNDUwNTM3MzIyOjVjYTFkNjg0NjlmYjZhM2YyNmUzYTE0MDcyM2VjZTVmODI5OGVjMGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3ID4mAH2gAyNDUwNTM3MzIyOjA1OGE4ZDkzZDE3YTAxZDRiNzIyNjcyMmM3MTU1YWY5NDc4YWRjNTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5ca1d68469fb6a3f26e3a140723ece5f8298ec0d", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/5ca1d68469fb6a3f26e3a140723ece5f8298ec0d", "committedDate": "2020-07-16T20:58:57Z", "message": "configure container to run integration tests in it"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b0361f89035d378e6db6e83dfabc70c80705916", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/8b0361f89035d378e6db6e83dfabc70c80705916", "committedDate": "2020-07-17T00:30:57Z", "message": "remove default value from java config because defined in conf file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21495f87046bba8b8b9fbbd667d56feaac48a077", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/21495f87046bba8b8b9fbbd667d56feaac48a077", "committedDate": "2020-07-17T13:23:50Z", "message": "Merge branch 'master' into wh/DPC-545-run_tests_in_container"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwNzUzODAz", "url": "https://github.com/CMSgov/dpc-app/pull/913#pullrequestreview-450753803", "createdAt": "2020-07-17T15:29:16Z", "commit": {"oid": "21495f87046bba8b8b9fbbd667d56feaac48a077"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNToyOToxNlrOGzXelg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNToyOToxNlrOGzXelg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjUxNTIyMg==", "bodyText": "Is there any downside to setting this higher than the default?", "url": "https://github.com/CMSgov/dpc-app/pull/913#discussion_r456515222", "createdAt": "2020-07-17T15:29:16Z", "author": {"login": "em1"}, "path": "docker-compose.yml", "diffHunk": "@@ -4,6 +4,7 @@ services:\n \n   db:\n     image: postgres\n+    command: postgres -c 'max_connections=250'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21495f87046bba8b8b9fbbd667d56feaac48a077"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwNzU0MTc0", "url": "https://github.com/CMSgov/dpc-app/pull/913#pullrequestreview-450754174", "createdAt": "2020-07-17T15:29:44Z", "commit": {"oid": "21495f87046bba8b8b9fbbd667d56feaac48a077"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10d19cc9c31b9da7b0be90820ced4efd7f779fd8", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/10d19cc9c31b9da7b0be90820ced4efd7f779fd8", "committedDate": "2020-07-17T18:19:30Z", "message": "Merge branch 'master' into wh/DPC-545-run_tests_in_container"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxODY1Mzg3", "url": "https://github.com/CMSgov/dpc-app/pull/913#pullrequestreview-451865387", "createdAt": "2020-07-20T18:42:47Z", "commit": {"oid": "21495f87046bba8b8b9fbbd667d56feaac48a077"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxODo0MzoyNlrOG0auiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxODo0MzoyNlrOG0auiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzYxNzAzNQ==", "bodyText": "Is this a way of defaulting to 30 s if no value is set for JOB_TIMEOUT_IN_SECONDS? If there is a value set, does it just use the first one and ignore the second line?", "url": "https://github.com/CMSgov/dpc-app/pull/913#discussion_r457617035", "createdAt": "2020-07-20T18:43:26Z", "author": {"login": "jonfulk"}, "path": "dpc-api/src/main/resources/application.conf", "diffHunk": "@@ -2,6 +2,9 @@ dpc.api {\n     include \"server.conf\"\n     include \"queue.conf\"\n \n+    jobTimeoutInSeconds = ${?JOB_TIMEOUT_IN_SECONDS}\n+    jobTimeoutInSeconds = 30\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "10d19cc9c31b9da7b0be90820ced4efd7f779fd8"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNDE1NTk4", "url": "https://github.com/CMSgov/dpc-app/pull/913#pullrequestreview-452415598", "createdAt": "2020-07-21T12:44:37Z", "commit": {"oid": "10d19cc9c31b9da7b0be90820ced4efd7f779fd8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "058a8d93d17a01d4b7226722c7155af9478adc58", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/058a8d93d17a01d4b7226722c7155af9478adc58", "committedDate": "2020-07-21T15:35:24Z", "message": "Merge branch 'master' into wh/DPC-545-run_tests_in_container"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 412, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}