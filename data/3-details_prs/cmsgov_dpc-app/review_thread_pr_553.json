{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1NDk0OTI2", "number": 553, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxNTo1OTo1MlrODZ4oPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxOToxNzoxMFrODZ8jfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NDY4Nzk5OnYy", "diffSide": "RIGHT", "path": "dpc-attribution/src/main/resources/migrations.xml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxNTo1OTo1MlrOFghiHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxOTowNjo1NVrOFgnmDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY0ODE1Nw==", "bodyText": "Do the hashes have a fixed length? If so, we might want to shrink this column a bit.", "url": "https://github.com/CMSgov/dpc-app/pull/553#discussion_r369648157", "createdAt": "2020-01-22T15:59:52Z", "author": {"login": "nickrobison-usds"}, "path": "dpc-attribution/src/main/resources/migrations.xml", "diffHunk": "@@ -422,4 +422,10 @@\n                 columnName=\"gender\"\n                 defaultNullValue=\"3\"/>\n     </changeSet>\n+\n+    <changeSet id=\"add-mbi-hash\" author=\"embh\">\n+        <addColumn tableName=\"PATIENTS\">\n+            <column name=\"mbi_hash\" type=\"VARCHAR\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "065171e73f1dc3a9e22598cf7a616868960a2e17"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTc0NzQ2OQ==", "bodyText": "64 characters", "url": "https://github.com/CMSgov/dpc-app/pull/553#discussion_r369747469", "createdAt": "2020-01-22T19:06:55Z", "author": {"login": "RickHawesUSDS"}, "path": "dpc-attribution/src/main/resources/migrations.xml", "diffHunk": "@@ -422,4 +422,10 @@\n                 columnName=\"gender\"\n                 defaultNullValue=\"3\"/>\n     </changeSet>\n+\n+    <changeSet id=\"add-mbi-hash\" author=\"embh\">\n+        <addColumn tableName=\"PATIENTS\">\n+            <column name=\"mbi_hash\" type=\"VARCHAR\"/>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY0ODE1Nw=="}, "originalCommit": {"oid": "065171e73f1dc3a9e22598cf7a616868960a2e17"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NDY5MTU0OnYy", "diffSide": "RIGHT", "path": "dpc-bluebutton/src/main/java/gov/cms/dpc/bluebutton/client/BlueButtonClientImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxNjowMDo1MFrOFghkYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxNjowMDo1MFrOFghkYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY0ODczOA==", "bodyText": "Is there any portion of this that can be pulled out as class variables?", "url": "https://github.com/CMSgov/dpc-app/pull/553#discussion_r369648738", "createdAt": "2020-01-22T16:00:50Z", "author": {"login": "nickrobison-usds"}, "path": "dpc-bluebutton/src/main/java/gov/cms/dpc/bluebutton/client/BlueButtonClientImpl.java", "diffHunk": "@@ -150,6 +156,16 @@ public CapabilityStatement requestCapabilityStatement() throws ResourceNotFoundE\n                         .execute());\n     }\n \n+    @Override\n+    public String hashMbi(String mbi) throws GeneralSecurityException {\n+        String pepper = config.getBfdHashPepper();\n+        int iterations = config.getBfdHashIter();\n+        KeySpec keySpec = new PBEKeySpec(mbi.toCharArray(), Hex.decode(pepper), iterations, 256);\n+        SecretKeyFactory skf = SecretKeyFactory.getInstance(\"PBKDF2WithHmacSHA256\");\n+        SecretKey secretKey = skf.generateSecret(keySpec);\n+        return Hex.toHexString(secretKey.getEncoded());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "065171e73f1dc3a9e22598cf7a616868960a2e17"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NDY5NTQxOnYy", "diffSide": "RIGHT", "path": "dpc-bluebutton/src/test/java/gov/cms/dpc/bluebutton/client/BlueButtonClientTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxNjowMTo1MFrOFghmxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxNjowMTo1MFrOFghmxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY0OTM1MA==", "bodyText": "Do we have a failure case? Such as an empty or null string?", "url": "https://github.com/CMSgov/dpc-app/pull/553#discussion_r369649350", "createdAt": "2020-01-22T16:01:50Z", "author": {"login": "nickrobison-usds"}, "path": "dpc-bluebutton/src/test/java/gov/cms/dpc/bluebutton/client/BlueButtonClientTest.java", "diffHunk": "@@ -222,6 +223,16 @@ void shouldThrowExceptionWhenResourceNotFound() {\n         );\n     }\n \n+    @Test\n+    void shouldHashMbi() throws GeneralSecurityException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "065171e73f1dc3a9e22598cf7a616868960a2e17"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NTMxNjgwOnYy", "diffSide": "RIGHT", "path": "dpc-bluebutton/src/test/resources/test.application.conf", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxOToxMjozMVrOFgnxOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxOToxMjozMVrOFgnxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTc1MDMyOQ==", "bodyText": "Is the comment saying that the source of this pepper is bluebutton?", "url": "https://github.com/CMSgov/dpc-app/pull/553#discussion_r369750329", "createdAt": "2020-01-22T19:12:31Z", "author": {"login": "RickHawesUSDS"}, "path": "dpc-bluebutton/src/test/resources/test.application.conf", "diffHunk": "@@ -13,6 +13,8 @@ bbclient {\n \n   serverBaseUrl = \"http://localhost:8083/v1/fhir/\"\n   resourcesCount = 10\n+  bfdHashPepper=6E6F747468657265616C706570706572 // https://github.com/CMSgov/bluebutton-ansible-playbooks-data-sandbox/blob/master/etl_server_redeploy.yml#L151", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "065171e73f1dc3a9e22598cf7a616868960a2e17"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NTMzMTE4OnYy", "diffSide": "RIGHT", "path": "dpc-bluebutton/src/main/java/gov/cms/dpc/bluebutton/client/BlueButtonClientImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxOToxNzoxMFrOFgn6KQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxOToxNzoxMFrOFgn6KQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTc1MjYxNw==", "bodyText": "What happens if mbi is empty or null? The table's column can be null.", "url": "https://github.com/CMSgov/dpc-app/pull/553#discussion_r369752617", "createdAt": "2020-01-22T19:17:10Z", "author": {"login": "RickHawesUSDS"}, "path": "dpc-bluebutton/src/main/java/gov/cms/dpc/bluebutton/client/BlueButtonClientImpl.java", "diffHunk": "@@ -150,6 +156,16 @@ public CapabilityStatement requestCapabilityStatement() throws ResourceNotFoundE\n                         .execute());\n     }\n \n+    @Override\n+    public String hashMbi(String mbi) throws GeneralSecurityException {\n+        String pepper = config.getBfdHashPepper();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "065171e73f1dc3a9e22598cf7a616868960a2e17"}, "originalPosition": 24}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4937, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}