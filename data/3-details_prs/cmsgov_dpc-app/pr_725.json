{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3NzcxNzQ2", "number": 725, "title": "DPC-1210: Generate fake identifier for provider orgs in sandbox", "bodyText": "Why\nThis solves the current workflow issue where internal admins cannot enable sandbox for a provider org without an NPI (and users do not know they are supposed to enter an NPI after they've been assigned). Furthermore, we know people are entering in fake NPIs in sandbox anyway because they may not know theirs yet.\nWhat Changed\nWhen a provider organization is created or updated, if no provider_id is present one will be generated.\nIf an NPI is not present, the provider_id will be used as the external identifier in the API.\nAdjusted existing tests and added tests for npi/provider_id function.\nNOTE: I'm not sure how to make this only available to sandbox.dpc.cms.gov and not production. Is this something I do on the dev end? Or is there something I need to add to let DevOps set those parameters.\nChoices Made\nI called the provider identifier provider_id to mirror the vendor_id.\nTickets closed:\nDPC-1210\nFuture Work\nWe need another ticket for differentiating sandbox and production parameters if necessary.\nChecklist\n\n All tests are passing via make ci-app (app change) and make ci-web (website change)\n Swagger documentation has been updated\n FHIR documentation has been updated\n Any required dpc-ops changes have a PR submitted and mentioned in this ticket\n Any manual migration steps are documented, scripts written (where applicable), and tested\n Before merging, any required dpc-ops changes have been approved and merged into master of the dpc-ops repo", "createdAt": "2020-04-02T19:24:21Z", "url": "https://github.com/CMSgov/dpc-app/pull/725", "merged": true, "mergeCommit": {"oid": "fa735f204e7b647455eebb37abf2d3cfa2b53c9c"}, "closed": true, "closedAt": "2020-04-07T14:04:17Z", "author": {"login": "Sun-Mountain"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTvYR1AH2gAyMzk3NzcxNzQ2OjNiMjhiOGI3OWVhODBkMWM5ODAzMGE0OTVmOGRiMjQxN2VjMGZhNjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVSpCAAH2gAyMzk3NzcxNzQ2OjZhNDhjMGIyZjEyNDhmYWFjYzZiYTNmN2Q5N2IyYzU5Mjc5OTQ1MTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3b28b8b79ea80d1c98030a495f8db2417ec0fa65", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/3b28b8b79ea80d1c98030a495f8db2417ec0fa65", "committedDate": "2020-04-02T17:02:42Z", "message": "Provider_Id column added to database"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec33faee0be66f126e1ef01acb19481c43e12f39", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/ec33faee0be66f126e1ef01acb19481c43e12f39", "committedDate": "2020-04-02T17:32:57Z", "message": "Merge branch 'master' into nzonnenberg/dpc-1210-prov-id"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b42a10e533cc6dce500d931ae07af4b169deabb4", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/b42a10e533cc6dce500d931ae07af4b169deabb4", "committedDate": "2020-04-02T17:46:43Z", "message": "Provider_id assigned to provider if no provider_id present\n\nIf internal user creates or updates an organization without a vendor or provider id, it will assign a unique id depending on the organization type."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6ec607d43ce9d2d092478d9cae0519f128d1964", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/f6ec607d43ce9d2d092478d9cae0519f128d1964", "committedDate": "2020-04-02T18:32:10Z", "message": "Provider_Id used if not NPI present"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a5db1d9a97f6fa11811d5b0d953e4bf2f7fbb13", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/9a5db1d9a97f6fa11811d5b0d953e4bf2f7fbb13", "committedDate": "2020-04-02T18:37:43Z", "message": "Internal user can view Provider_Id if no NPI is provided"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "914dab7d27ab1b749d26885c96cd7cbff0add5d7", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/914dab7d27ab1b749d26885c96cd7cbff0add5d7", "committedDate": "2020-04-02T18:54:44Z", "message": "Organization show updated"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NzI5NDcy", "url": "https://github.com/CMSgov/dpc-app/pull/725#pullrequestreview-386729472", "createdAt": "2020-04-02T19:25:24Z", "commit": {"oid": "914dab7d27ab1b749d26885c96cd7cbff0add5d7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxOToyNToyNFrOF_6KwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxOToyNToyNFrOF_6KwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU1NzYzMw==", "bodyText": "Move registered_organizations.count.positive? out of the conditional.", "url": "https://github.com/CMSgov/dpc-app/pull/725#discussion_r402557633", "createdAt": "2020-04-02T19:25:24Z", "author": {"login": "codeclimate"}, "path": "dpc-web/app/models/organization.rb", "diffHunk": "@@ -41,18 +41,24 @@ def api_credentialable?\n     if health_it_vendor?\n       registered_organizations.count.positive?\n     else\n-      registered_organizations.count.positive? && npi.present?\n+      registered_organizations.count.positive?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "914dab7d27ab1b749d26885c96cd7cbff0add5d7"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c507c94d39183894747546e7370afadddf175ff", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/0c507c94d39183894747546e7370afadddf175ff", "committedDate": "2020-04-02T19:29:16Z", "message": "Existing tests adjusted to pass with new parameters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47cba268840a201ccd18688296c342a6efb564f1", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/47cba268840a201ccd18688296c342a6efb564f1", "committedDate": "2020-04-02T19:29:29Z", "message": "Merge branch 'master' into nzonnenberg/dpc-1210-prov-id"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b79c409d2c0983c4c76505b4be21f4c121d12ba", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/1b79c409d2c0983c4c76505b4be21f4c121d12ba", "committedDate": "2020-04-03T16:09:43Z", "message": "Adjusted existing and added new tests\n\nassign_vendor_id (line 68) calls the correct methed for ids\n\napi_credentialable? (line 121) returns true if registered org present but npi\n\nadded assign_provider_id tests (line 54) for provider organizations\n\nadded external_identifier tests (line 82) to test on returned value based on organization type and if npi is present"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d423376fdd7efd1181080063bf12d05566d0a3f", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/9d423376fdd7efd1181080063bf12d05566d0a3f", "committedDate": "2020-04-03T16:25:00Z", "message": "Merge branch 'nzonnenberg/dpc-1210-prov-id' of github.com:CMSgov/dpc-app into nzonnenberg/dpc-1210-prov-id"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NTU4MDg4", "url": "https://github.com/CMSgov/dpc-app/pull/725#pullrequestreview-388558088", "createdAt": "2020-04-06T19:37:19Z", "commit": {"oid": "9d423376fdd7efd1181080063bf12d05566d0a3f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxOTozNzoyMFrOGBm86Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxOTozNzoyMFrOGBm86Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDMzOTk0NQ==", "bodyText": "Do we actually no longer care whether the NPI is present for providers?", "url": "https://github.com/CMSgov/dpc-app/pull/725#discussion_r404339945", "createdAt": "2020-04-06T19:37:20Z", "author": {"login": "dhgreene"}, "path": "dpc-web/app/models/organization.rb", "diffHunk": "@@ -38,21 +38,23 @@ def npi=(input)\n   end\n \n   def api_credentialable?\n-    if health_it_vendor?\n-      registered_organizations.count.positive?\n-    else\n-      registered_organizations.count.positive? && npi.present?\n-    end\n+    registered_organizations.count.positive?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d423376fdd7efd1181080063bf12d05566d0a3f"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NjIwOTIz", "url": "https://github.com/CMSgov/dpc-app/pull/725#pullrequestreview-388620923", "createdAt": "2020-04-06T21:12:34Z", "commit": {"oid": "9d423376fdd7efd1181080063bf12d05566d0a3f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a48c0b2f1248faacc6ba3f7d97b2c5927994516", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/6a48c0b2f1248faacc6ba3f7d97b2c5927994516", "committedDate": "2020-04-07T12:41:36Z", "message": "Merge branch 'master' into nzonnenberg/dpc-1210-prov-id"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 203, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}