{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxOTE5OTAx", "number": 739, "title": "DPC-1274-create nohtml validator", "bodyText": "Why\nWe don't expect scripts and/or html in any of our inputs so need to reject request when those are found in our inputs\nWhat Changed\nAdded a NoHtml Validator with the annotation and annotated all the String fields in our entities and also the String fields in API resources.\nChoices Made\nUsed a validator instead of a filter because a filter would have to be generic enough to find all string fields in the request which is a hard problem and could introduce a lot of edge cases.\nTickets closed:\nhttps://jiraent.cms.gov/browse/DPC-1274\nFuture Work\nList any additional tickets that have either been created due to work in this PR, or existing tickets that expand upon the feature or provide additional fixes.\nChecklist\n\n All tests are passing via make ci-app (app change) and make ci-web (website change)\n Swagger documentation has been updated\n FHIR documentation has been updated\n Any required dpc-ops changes have a PR submitted and mentioned in this ticket\n Any manual migration steps are documented, scripts written (where applicable), and tested\n Before merging, any required dpc-ops changes have been approved and merged into master of the dpc-ops repo", "createdAt": "2020-04-10T13:59:06Z", "url": "https://github.com/CMSgov/dpc-app/pull/739", "merged": true, "mergeCommit": {"oid": "ce95381f005cb93664f93fd5cb98e5779720c22c"}, "closed": true, "closedAt": "2020-04-29T15:05:52Z", "author": {"login": "MrBilnon"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcWRimuAH2gAyNDAxOTE5OTAxOjBiMWNiYmZkMWQwODMzMDlkNjVkZTdlM2NhZTVlNGIyN2Y3YTNkODc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccXm7hAFqTQwMjYxNTU4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0b1cbbfd1d083309d65de7e3cae5e4b27f7a3d87", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/0b1cbbfd1d083309d65de7e3cae5e4b27f7a3d87", "committedDate": "2020-04-10T13:58:36Z", "message": "create nohtml validator"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxNDY2NTcz", "url": "https://github.com/CMSgov/dpc-app/pull/739#pullrequestreview-391466573", "createdAt": "2020-04-10T14:19:21Z", "commit": {"oid": "0b1cbbfd1d083309d65de7e3cae5e4b27f7a3d87"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQxNDoxOToyMlrOGD7xmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQxNDoxOToyMlrOGD7xmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjc3ODI2Nw==", "bodyText": "Add a nested comment explaining why this method is empty, throw an UnsupportedOperationException or complete the implementation.", "url": "https://github.com/CMSgov/dpc-app/pull/739#discussion_r406778267", "createdAt": "2020-04-10T14:19:22Z", "author": {"login": "codeclimate"}, "path": "dpc-common/src/main/java/gov/cms/dpc/common/hibernate/validator/NoHtmlValidator.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package gov.cms.dpc.common.hibernate.validator;\n+\n+import gov.cms.dpc.common.annotations.NoHtml;\n+import org.jsoup.Jsoup;\n+import org.jsoup.safety.Whitelist;\n+\n+import javax.validation.ConstraintValidator;\n+import javax.validation.ConstraintValidatorContext;\n+\n+public class NoHtmlValidator implements ConstraintValidator<NoHtml, String> {\n+\n+    public static final String VALIDATION_MESSAGE = \"Cannot contain HTML\";\n+\n+    @Override\n+    public void initialize(NoHtml noHtml) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b1cbbfd1d083309d65de7e3cae5e4b27f7a3d87"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3dbe4da10d26c179adf3eef5f5df54de71406e63", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/3dbe4da10d26c179adf3eef5f5df54de71406e63", "committedDate": "2020-04-10T17:12:24Z", "message": "handle null and blank strings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3a6c24c55ef8cb89b903c00d8466f4649117088", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/c3a6c24c55ef8cb89b903c00d8466f4649117088", "committedDate": "2020-04-10T17:58:12Z", "message": "handle newlines"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0fc9f852fedbbf47e93351a2df0444075b6cf24", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/f0fc9f852fedbbf47e93351a2df0444075b6cf24", "committedDate": "2020-04-10T18:14:54Z", "message": "add annotation to entities"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4dd2211650372d133f4255b13e5713d9e315642", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/b4dd2211650372d133f4255b13e5713d9e315642", "committedDate": "2020-04-10T18:15:26Z", "message": "add annotation to resource endpoints with params that are strings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db136b46b860df0c45a74b7f0a8c2ac81f696613", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/db136b46b860df0c45a74b7f0a8c2ac81f696613", "committedDate": "2020-04-10T18:30:48Z", "message": "fix codeclimate issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9af480157accd435d73224cb9711468dd29387e", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/a9af480157accd435d73224cb9711468dd29387e", "committedDate": "2020-04-12T22:31:55Z", "message": "Merge branch 'master' into DPC-1274-input-validation-for-scripts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMTM2ODQx", "url": "https://github.com/CMSgov/dpc-app/pull/739#pullrequestreview-392136841", "createdAt": "2020-04-13T13:17:10Z", "commit": {"oid": "a9af480157accd435d73224cb9711468dd29387e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxMzoxNzoxMFrOGEmKzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxMzoxNzoxMFrOGEmKzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ3Mjg0Nw==", "bodyText": "Should we also be preventing HTML in the FHIR resources like Provenance and Group?", "url": "https://github.com/CMSgov/dpc-app/pull/739#discussion_r407472847", "createdAt": "2020-04-13T13:17:10Z", "author": {"login": "em1"}, "path": "dpc-api/src/main/java/gov/cms/dpc/api/resources/AbstractGroupResource.java", "diffHunk": "@@ -26,7 +27,7 @@ protected AbstractGroupResource() {\n     public abstract Response createRoster(OrganizationPrincipal organizationPrincipal, @Valid @Profiled(profile = AttestationProfile.PROFILE_URI) Provenance rosterAttestation, Group attributionRoster);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9af480157accd435d73224cb9711468dd29387e"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eddbebca385bc8ce40d7e90dbc1f593ce8704395", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/eddbebca385bc8ce40d7e90dbc1f593ce8704395", "committedDate": "2020-04-23T20:43:46Z", "message": "Merge branch 'master' into DPC-1274-input-validation-for-scripts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "142f6e62d44b912a1452b928cbd57e7508a62184", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/142f6e62d44b912a1452b928cbd57e7508a62184", "committedDate": "2020-04-27T02:46:48Z", "message": "add some resource tests to show scripts aren't able to be saved"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a02ea2410128963894281c620249f27a6f62525b", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/a02ea2410128963894281c620249f27a6f62525b", "committedDate": "2020-04-27T02:47:11Z", "message": "Merge remote-tracking branch 'origin/DPC-1274-input-validation-for-scripts' into DPC-1274-input-validation-for-scripts\n\n# Conflicts:\n#\tdpc-attribution/src/test/java/gov/cms/dpc/attribution/resources/PatientResourceTest.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMjc1MDY1", "url": "https://github.com/CMSgov/dpc-app/pull/739#pullrequestreview-401275065", "createdAt": "2020-04-27T19:50:03Z", "commit": {"oid": "a02ea2410128963894281c620249f27a6f62525b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxOTo1MDowM1rOGM02Yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxOTo1MDowM1rOGM02Yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjEwMTk4Ng==", "bodyText": "There are a number of tricks attackers can use to fool HTML sanitizers.  Can you include a few from this or another source?", "url": "https://github.com/CMSgov/dpc-app/pull/739#discussion_r416101986", "createdAt": "2020-04-27T19:50:03Z", "author": {"login": "dhgreene"}, "path": "dpc-common/src/test/java/gov/cms/dpc/common/hibernate/validator/NoHtmlValidatorTest.java", "diffHunk": "@@ -0,0 +1,62 @@\n+package gov.cms.dpc.common.hibernate.validator;\n+\n+import gov.cms.dpc.common.annotations.NoHtml;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.Arguments;\n+import org.junit.jupiter.params.provider.MethodSource;\n+\n+import javax.validation.ConstraintViolation;\n+import javax.validation.Validation;\n+import javax.validation.Validator;\n+import javax.validation.ValidatorFactory;\n+import java.util.Set;\n+import java.util.stream.Stream;\n+\n+public class NoHtmlValidatorTest {\n+\n+    private Validator validator;\n+\n+    @BeforeEach\n+    public void setUp() {\n+        ValidatorFactory factory = Validation.buildDefaultValidatorFactory();\n+        validator = factory.getValidator();\n+    }\n+\n+    @ParameterizedTest\n+    @MethodSource(\"stringSource\")\n+    public void noHtmlValidatorTest(String value, boolean isEmpty) {\n+\n+        TestObject testObject = new TestObject();\n+        testObject.setA(value);\n+        Set<ConstraintViolation<TestObject>> violations = validator.validate(testObject);\n+        Assertions.assertEquals(isEmpty, violations.isEmpty());\n+    }\n+\n+    private static Stream<Arguments> stringSource() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a02ea2410128963894281c620249f27a6f62525b"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "434e75482ef5257e36eec1eab2b308b6f806ac2a", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/434e75482ef5257e36eec1eab2b308b6f806ac2a", "committedDate": "2020-04-28T14:56:55Z", "message": "update validator unit tests with examples from owasp"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ea7fcfa4cbbdf910ae354015ef08cb733a32cdc", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/1ea7fcfa4cbbdf910ae354015ef08cb733a32cdc", "committedDate": "2020-04-28T15:24:46Z", "message": "add group test for scripts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa83eb7ee9ac4da082795f2c4f0bfd28e2f22832", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/aa83eb7ee9ac4da082795f2c4f0bfd28e2f22832", "committedDate": "2020-04-28T22:15:42Z", "message": "Merge branch 'master' into DPC-1274-input-validation-for-scripts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyNjE1NTg5", "url": "https://github.com/CMSgov/dpc-app/pull/739#pullrequestreview-402615589", "createdAt": "2020-04-29T12:26:18Z", "commit": {"oid": "aa83eb7ee9ac4da082795f2c4f0bfd28e2f22832"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 89, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}