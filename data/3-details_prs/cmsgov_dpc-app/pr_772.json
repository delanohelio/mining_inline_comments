{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA5NjE2Nzgy", "number": 772, "title": "DPC-1347: Change auto-generated vendor and provider ids to pass for NPI", "bodyText": "Why\nFake NPIs will be generated in prod-sbx to accommodate the new NPI validity check in the API.\nWhat Changed\nColumns for provider_id and vendor_id have been removed.\nColumn sandbox_id has been added.\nWhen in prod-sbx environment, the sandbox_id will automatically be generated using the gem Luhnacy. It should satisfy the requirements for the NPI validator on the API side.\nTests have changed to check for sandbox_id in prod-sbx environment.\nChoices Made\nIn prod-sbx\nAs internal user:\n\nAs external user:\n\nNot in prod-sbx\nAs internal user:\n\nAs external user:\n\nTickets closed:\nDPC-1265 - Update Web App code to check what environment it's in\nDPC-1314 - Write tests to confirm prod-sbx conditional functions and views\nDPC-1347 - Change auto-generated vendor and provider ids to pass for NPI\nCANCELED: DPC-1296 - Provider and vendor ids are only used in prod_sbx\nFuture Work\nDPC-1295 - In prod_sbx automatically approve organization for API use\nChecklist\n\n All tests are passing via make ci-app (app change) and make ci-web (website change)\n Swagger documentation has been updated\n FHIR documentation has been updated\n Any required dpc-ops changes have a PR submitted and mentioned in this ticket\n Any manual migration steps are documented, scripts written (where applicable), and tested\n Before merging, any required dpc-ops changes have been approved and merged into master of the dpc-ops repo", "createdAt": "2020-04-27T16:42:20Z", "url": "https://github.com/CMSgov/dpc-app/pull/772", "merged": true, "mergeCommit": {"oid": "805cd5c2c89a790fd698059d60cb9dd20b23579d"}, "closed": true, "closedAt": "2020-04-27T17:40:02Z", "author": {"login": "Sun-Mountain"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcazOy_AH2gAyNDA5NjE2NzgyOmQ2MjgyZThlN2NmOGI5YzQwOGI2OGRhYjZjMzhiYmUzNTViOWVhNTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcbyzRzAFqTQwMTE3NDE4NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d6282e8e7cf8b9c408b68dab6c38bbe355b9ea58", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/d6282e8e7cf8b9c408b68dab6c38bbe355b9ea58", "committedDate": "2020-04-24T15:29:26Z", "message": "Installed Luhnacy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73821645cb4d44e2e94ba565f41e07bbdfd6af5d", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/73821645cb4d44e2e94ba565f41e07bbdfd6af5d", "committedDate": "2020-04-24T19:54:10Z", "message": "Create sandbox_id as fake npi for organization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7ae6be2419ccc5e325141e94e111021f0f9b46e", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/f7ae6be2419ccc5e325141e94e111021f0f9b46e", "committedDate": "2020-04-24T20:14:41Z", "message": "Move luhnacy requirement to application"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96bac53908e2c70f2d2ffaa9b440875992864602", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/96bac53908e2c70f2d2ffaa9b440875992864602", "committedDate": "2020-04-24T20:20:48Z", "message": "Update all existing organization sandbox_ids"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14dbeb311c7fa598e4eabd14f132720aca9d0b43", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/14dbeb311c7fa598e4eabd14f132720aca9d0b43", "committedDate": "2020-04-27T12:39:41Z", "message": "Rollback migration to ensure blank sandbox_id are generated"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12b44fba6d48af1e8033673e1e1a237bb5a9645a", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/12b44fba6d48af1e8033673e1e1a237bb5a9645a", "committedDate": "2020-04-27T13:08:39Z", "message": "Autogenerated sandbox_id for existing organizations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "427907c5b7d39fe17b4af7287b1dd5d69c7ec64e", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/427907c5b7d39fe17b4af7287b1dd5d69c7ec64e", "committedDate": "2020-04-27T14:20:07Z", "message": "Added sandbox_id column and generates id for existing orgs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e74e4be9d614546a5d39f535dfe3858346cdf268", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/e74e4be9d614546a5d39f535dfe3858346cdf268", "committedDate": "2020-04-27T14:43:26Z", "message": "Update prod-sbx views"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bed60560cd05a249bc8d318c31578d4f6e48af95", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/bed60560cd05a249bc8d318c31578d4f6e48af95", "committedDate": "2020-04-27T15:29:19Z", "message": "Organziation Spec adjusted\n\nRemoved tests for provider_id and vendor_id\nReplaced with concise sandbox_id tests in environments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60f53eb2c31d07683cb4357a3514f5cab96cb2d1", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/60f53eb2c31d07683cb4357a3514f5cab96cb2d1", "committedDate": "2020-04-27T15:39:49Z", "message": "Updated api_client_spec"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0e261c2cf1de4fb6ef318ffe77986cb41f70bbc", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/d0e261c2cf1de4fb6ef318ffe77986cb41f70bbc", "committedDate": "2020-04-27T15:43:40Z", "message": "Removed provider_id and vendor_id columns"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71ab6bd0cb7363c2e0185b91d899acc51026e6be", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/71ab6bd0cb7363c2e0185b91d899acc51026e6be", "committedDate": "2020-04-27T16:40:22Z", "message": "Adjusted views"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec3cdded57dc448de279b3adf83034d1d63241eb", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/ec3cdded57dc448de279b3adf83034d1d63241eb", "committedDate": "2020-04-27T16:48:22Z", "message": "Merge branch 'master' into nzonnenberg/dpc-1347-generate-fake-npis"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMTUzNTI0", "url": "https://github.com/CMSgov/dpc-app/pull/772#pullrequestreview-401153524", "createdAt": "2020-04-27T17:06:54Z", "commit": {"oid": "ec3cdded57dc448de279b3adf83034d1d63241eb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxNzowNjo1NFrOGMuIDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxNzowNjo1NFrOGMuIDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk5MTgyMw==", "bodyText": "Use the new Ruby 1.9 hash syntax.", "url": "https://github.com/CMSgov/dpc-app/pull/772#discussion_r415991823", "createdAt": "2020-04-27T17:06:54Z", "author": {"login": "codeclimate"}, "path": "dpc-web/app/models/organization.rb", "diffHunk": "@@ -100,20 +99,9 @@ def production_fhir_endpoint\n \n private\n \n-def generate_provider_id\n-  loop do\n-    provider_id = \"P_#{SecureRandom.alphanumeric(10)}\"\n-    break provider_id unless Organization.where(provider_id: provider_id).exists?\n-  end\n-end\n-\n-def generate_vendor_id\n+def generate_sandbox_id\n   loop do\n-    vendor_id = \"V_#{SecureRandom.alphanumeric(10)}\"\n-    break vendor_id unless Organization.where(vendor_id: vendor_id).exists?\n+    sandbox_id = Luhnacy.generate(15, :prefix => '808403')[-10..-1]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec3cdded57dc448de279b3adf83034d1d63241eb"}, "originalPosition": 66}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7df919a259a46bf5304ca06e75d33e5d021bd0f", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/f7df919a259a46bf5304ca06e75d33e5d021bd0f", "committedDate": "2020-04-27T17:16:16Z", "message": "Code Climate fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31145d74dcb29bd58f2c10ca8379c90d8f265aeb", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/31145d74dcb29bd58f2c10ca8379c90d8f265aeb", "committedDate": "2020-04-27T17:16:42Z", "message": "Merge branch 'nzonnenberg/dpc-1347-generate-fake-npis' of github.com:CMSgov/dpc-app into nzonnenberg/dpc-1347-generate-fake-npis"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMTc0MTg1", "url": "https://github.com/CMSgov/dpc-app/pull/772#pullrequestreview-401174185", "createdAt": "2020-04-27T17:33:18Z", "commit": {"oid": "31145d74dcb29bd58f2c10ca8379c90d8f265aeb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 118, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}