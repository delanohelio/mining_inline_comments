{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwODM1ODE1", "number": 736, "title": "DPC-1197: As an external user, I want an alert telling me if I'm trying to reuse a Public Key.", "bodyText": "Why\nExternal users cannot reuse public keys in use. When an external user tries to enter a public key already registered, there is no message telling them why they can't create a new public key (or if they made another error). It just renders the new public key form.\nWhat Changed\n\n\n\nChoices Made\nThe errors returned by the API were not successfully being returned to the view. After a few changes, now the users will be more aware of why their public key requests were unsuccessful.\nTickets closed:\nDPC-1197\nFuture Work\nN/A\nChecklist\n\n All tests are passing via make ci-app (app change) and make ci-web (website change)\n Swagger documentation has been updated\n FHIR documentation has been updated\n Any required dpc-ops changes have a PR submitted and mentioned in this ticket\n Any manual migration steps are documented, scripts written (where applicable), and tested\n Before merging, any required dpc-ops changes have been approved and merged into master of the dpc-ops repo", "createdAt": "2020-04-08T13:04:40Z", "url": "https://github.com/CMSgov/dpc-app/pull/736", "merged": true, "mergeCommit": {"oid": "2fb9f9341a5af3199051c2a5ae9f39483e35f450"}, "closed": true, "closedAt": "2020-04-23T13:09:11Z", "author": {"login": "Sun-Mountain"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVWUv8AH2gAyNDAwODM1ODE1OjdjYjY2Y2VkYjUwMTRjNjA5ZWMxZmMzYmQzNTJhMDhkNjY4NDNjNDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcacnk6gFqTM5OTA4MTI1MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7cb66cedb5014c609ec1fc3bd352a08d66843c40", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/7cb66cedb5014c609ec1fc3bd352a08d66843c40", "committedDate": "2020-04-07T16:59:04Z", "message": "Alert for public key errors now visible"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f118ad047514c0c8b4568fbf2272ce89e32c414", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/8f118ad047514c0c8b4568fbf2272ce89e32c414", "committedDate": "2020-04-07T20:58:33Z", "message": "Errors for invalid public key submissions now visible\n\nAdded 'pry-nav' gem for easier debugging.\nAPI errors for invalid public keys now visible on public key form view."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5OTUzOTAx", "url": "https://github.com/CMSgov/dpc-app/pull/736#pullrequestreview-389953901", "createdAt": "2020-04-08T13:05:36Z", "commit": {"oid": "8f118ad047514c0c8b4568fbf2272ce89e32c414"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxMzowNTozNlrOGCuSUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxMzowNTozNlrOGCuSUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTUwODY4OQ==", "bodyText": "Trailing whitespace detected.", "url": "https://github.com/CMSgov/dpc-app/pull/736#discussion_r405508689", "createdAt": "2020-04-08T13:05:36Z", "author": {"login": "codeclimate"}, "path": "dpc-web/app/services/public_key_manager.rb", "diffHunk": "@@ -11,12 +11,18 @@ def initialize(api_env:, registered_organization:)\n \n   def create_public_key(public_key:, label:)\n     public_key = strip_carriage_returns(public_key)\n-    return false if invalid_encoding?(public_key)\n+    if invalid_encoding?(public_key)\n+      return { response: false,\n+               message: @errors[0] }\n+    end\n \n     api_client = APIClient.new(api_env)\n     api_client.create_public_key(registered_organization.api_id, params: { label: label, public_key: public_key })\n \n-    api_client.response_successful?\n+    pk_response = api_client.response_body\n+\n+    return { response: api_client.response_successful?, ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f118ad047514c0c8b4568fbf2272ce89e32c414"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTUwODY5MQ==", "bodyText": "Redundant return detected.", "url": "https://github.com/CMSgov/dpc-app/pull/736#discussion_r405508691", "createdAt": "2020-04-08T13:05:36Z", "author": {"login": "codeclimate"}, "path": "dpc-web/app/services/public_key_manager.rb", "diffHunk": "@@ -11,12 +11,18 @@ def initialize(api_env:, registered_organization:)\n \n   def create_public_key(public_key:, label:)\n     public_key = strip_carriage_returns(public_key)\n-    return false if invalid_encoding?(public_key)\n+    if invalid_encoding?(public_key)\n+      return { response: false,\n+               message: @errors[0] }\n+    end\n \n     api_client = APIClient.new(api_env)\n     api_client.create_public_key(registered_organization.api_id, params: { label: label, public_key: public_key })\n \n-    api_client.response_successful?\n+    pk_response = api_client.response_body\n+\n+    return { response: api_client.response_successful?, ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f118ad047514c0c8b4568fbf2272ce89e32c414"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37ff0281320489cd8f9c1031afb081396f796f82", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/37ff0281320489cd8f9c1031afb081396f796f82", "committedDate": "2020-04-08T13:08:24Z", "message": "Code Climate fixes of redundant 'return' and whitespace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "051b7f3eef35ed0c7f84221aba3e0ea3501a5cf8", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/051b7f3eef35ed0c7f84221aba3e0ea3501a5cf8", "committedDate": "2020-04-08T13:09:38Z", "message": "Gem file conflicts resolved"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c88508d5304041a15a7570935ea232309a19a723", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/c88508d5304041a15a7570935ea232309a19a723", "committedDate": "2020-04-08T13:11:21Z", "message": "Merge branch 'master' into nzonnenberg/dpc-1197-public-key-alert"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa550a0daedef507a8d495337ec4d2f6b3d026fe", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/fa550a0daedef507a8d495337ec4d2f6b3d026fe", "committedDate": "2020-04-08T13:34:05Z", "message": "Code cleanup - removed single use variable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff3b684a2a4c2d543fbe346fc97bda43b8ebd8cd", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/ff3b684a2a4c2d543fbe346fc97bda43b8ebd8cd", "committedDate": "2020-04-08T14:39:17Z", "message": "Test fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75f7844a81dca330d5557dc1f479744999dc64a2", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/75f7844a81dca330d5557dc1f479744999dc64a2", "committedDate": "2020-04-13T16:36:02Z", "message": "Failed API request test fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3Njg5OTM5", "url": "https://github.com/CMSgov/dpc-app/pull/736#pullrequestreview-397689939", "createdAt": "2020-04-21T21:29:23Z", "commit": {"oid": "75f7844a81dca330d5557dc1f479744999dc64a2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "beeb04516254d48b5d61e968eb50b3d8b1000a82", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/beeb04516254d48b5d61e968eb50b3d8b1000a82", "committedDate": "2020-04-23T12:22:04Z", "message": "Merge branch 'master' into nzonnenberg/dpc-1197-public-key-alert"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5MDgxMjUw", "url": "https://github.com/CMSgov/dpc-app/pull/736#pullrequestreview-399081250", "createdAt": "2020-04-23T13:08:41Z", "commit": {"oid": "beeb04516254d48b5d61e968eb50b3d8b1000a82"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 88, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}