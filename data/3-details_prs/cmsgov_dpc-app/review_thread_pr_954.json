{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzNTA5NzAw", "number": 954, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxODo1NzoyNlrOEYMU_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzo1MzoyNFrOEYj2Sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzODAzMjYxOnYy", "diffSide": "RIGHT", "path": "dpc-web/app/services/api_client.rb", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxODo1NzoyNlrOHAZcTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMjozMDoyNVrOHAf39w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE3ODg5Mw==", "bodyText": "Good.  Better would be to allow anything in the 20x range--201 and 202 are likely to be used, for instance.", "url": "https://github.com/CMSgov/dpc-app/pull/954#discussion_r470178893", "createdAt": "2020-08-13T18:57:26Z", "author": {"login": "dhgreene"}, "path": "dpc-web/app/services/api_client.rb", "diffHunk": "@@ -71,7 +77,7 @@ def get_public_keys(reg_org_api_id)\n   end\n \n   def response_successful?\n-    @response_status == 200\n+    [200, 204].include? @response_status", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f64296c6a909eb4e93630aebd5e52ebd118c19c9"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE3OTk5NA==", "bodyText": "@SMLuthi", "url": "https://github.com/CMSgov/dpc-app/pull/954#discussion_r470179994", "createdAt": "2020-08-13T18:59:23Z", "author": {"login": "Sun-Mountain"}, "path": "dpc-web/app/services/api_client.rb", "diffHunk": "@@ -71,7 +77,7 @@ def get_public_keys(reg_org_api_id)\n   end\n \n   def response_successful?\n-    @response_status == 200\n+    [200, 204].include? @response_status", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE3ODg5Mw=="}, "originalCommit": {"oid": "f64296c6a909eb4e93630aebd5e52ebd118c19c9"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI4NDI3OQ==", "bodyText": "@dhgreene @Sun-Mountain in that case we can do something like (200..299).include? @response_status which checks over a range", "url": "https://github.com/CMSgov/dpc-app/pull/954#discussion_r470284279", "createdAt": "2020-08-13T22:30:25Z", "author": {"login": "SMLuthi"}, "path": "dpc-web/app/services/api_client.rb", "diffHunk": "@@ -71,7 +77,7 @@ def get_public_keys(reg_org_api_id)\n   end\n \n   def response_successful?\n-    @response_status == 200\n+    [200, 204].include? @response_status", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE3ODg5Mw=="}, "originalCommit": {"oid": "f64296c6a909eb4e93630aebd5e52ebd118c19c9"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzODAzNjA0OnYy", "diffSide": "RIGHT", "path": "dpc-web/app/services/api_client.rb", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxODo1ODoxNlrOHAZeaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxODo1ODoxNlrOHAZeaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE3OTQzMg==", "bodyText": "Does this need to be a call to response_successful? instead?", "url": "https://github.com/CMSgov/dpc-app/pull/954#discussion_r470179432", "createdAt": "2020-08-13T18:58:16Z", "author": {"login": "dhgreene"}, "path": "dpc-web/app/services/api_client.rb", "diffHunk": "@@ -97,9 +103,18 @@ def golden_macaroon\n   end\n \n   def parsed_response(response)\n+    return self if response.body.nil? && @response_status == 204", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f64296c6a909eb4e93630aebd5e52ebd118c19c9"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTMyMzQ0OnYy", "diffSide": "RIGHT", "path": "dpc-web/app/services/api_client.rb", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNTowNzoyMVrOHA4NjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNTowNzoyMVrOHA4NjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY4MzAyMA==", "bodyText": "Use Range#cover? instead of Range#include?.", "url": "https://github.com/CMSgov/dpc-app/pull/954#discussion_r470683020", "createdAt": "2020-08-14T15:07:21Z", "author": {"login": "codeclimate"}, "path": "dpc-web/app/services/api_client.rb", "diffHunk": "@@ -71,7 +77,7 @@ def get_public_keys(reg_org_api_id)\n   end\n \n   def response_successful?\n-    @response_status == 200\n+    (200...299).include? @response_status", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "112c2e331f94d284b6593afca2eabf8eeb91d968"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTg4NjE5OnYy", "diffSide": "RIGHT", "path": "dpc-web/app/controllers/client_tokens_controller.rb", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzo1MzoyNFrOHA9i3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxODoyOToyOFrOHA-8ZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc3MDM5Ng==", "bodyText": "Would this be a little cleaner?\nreturn render_error 'Label required.' unless params_present?\n\nif manager.create_client_token(label: params[:label])\n  @client_token = manager.client_token\n  render :show\n\nrender_error 'Client token could not be created.'", "url": "https://github.com/CMSgov/dpc-app/pull/954#discussion_r470770396", "createdAt": "2020-08-14T17:53:24Z", "author": {"login": "SMLuthi"}, "path": "dpc-web/app/controllers/client_tokens_controller.rb", "diffHunk": "@@ -6,42 +6,60 @@ class ClientTokensController < ApplicationController\n   rescue_from ActiveRecord::RecordNotFound, with: :unauthorized\n \n   def new\n-    @organization = current_user.organizations.find(params[:organization_id])\n+    @organization = current_user.organizations.find(org_id)\n   end\n \n   def create\n     @organization = current_user.organizations.find(params[:organization_id])\n \n     reg_org = @organization.registered_organization\n     manager = ClientTokenManager.new(registered_organization: reg_org)\n-    if missing_params\n-      render_error 'Label required.'\n-    elsif manager.create_client_token(label: params[:label])\n+\n+    if params_present? && manager.create_client_token(label: params[:label])", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3e3c00ebc3c39ce9c3617774634fe4619a013da"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc3OTEyNg==", "bodyText": "The tests did not like that >_>", "url": "https://github.com/CMSgov/dpc-app/pull/954#discussion_r470779126", "createdAt": "2020-08-14T18:11:58Z", "author": {"login": "Sun-Mountain"}, "path": "dpc-web/app/controllers/client_tokens_controller.rb", "diffHunk": "@@ -6,42 +6,60 @@ class ClientTokensController < ApplicationController\n   rescue_from ActiveRecord::RecordNotFound, with: :unauthorized\n \n   def new\n-    @organization = current_user.organizations.find(params[:organization_id])\n+    @organization = current_user.organizations.find(org_id)\n   end\n \n   def create\n     @organization = current_user.organizations.find(params[:organization_id])\n \n     reg_org = @organization.registered_organization\n     manager = ClientTokenManager.new(registered_organization: reg_org)\n-    if missing_params\n-      render_error 'Label required.'\n-    elsif manager.create_client_token(label: params[:label])\n+\n+    if params_present? && manager.create_client_token(label: params[:label])", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc3MDM5Ng=="}, "originalCommit": {"oid": "f3e3c00ebc3c39ce9c3617774634fe4619a013da"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc5MzMxNw==", "bodyText": "Hm, that shouldnt happen. I wonder if the render_errors arent being hit correctly in the way you defined them.", "url": "https://github.com/CMSgov/dpc-app/pull/954#discussion_r470793317", "createdAt": "2020-08-14T18:29:28Z", "author": {"login": "SMLuthi"}, "path": "dpc-web/app/controllers/client_tokens_controller.rb", "diffHunk": "@@ -6,42 +6,60 @@ class ClientTokensController < ApplicationController\n   rescue_from ActiveRecord::RecordNotFound, with: :unauthorized\n \n   def new\n-    @organization = current_user.organizations.find(params[:organization_id])\n+    @organization = current_user.organizations.find(org_id)\n   end\n \n   def create\n     @organization = current_user.organizations.find(params[:organization_id])\n \n     reg_org = @organization.registered_organization\n     manager = ClientTokenManager.new(registered_organization: reg_org)\n-    if missing_params\n-      render_error 'Label required.'\n-    elsif manager.create_client_token(label: params[:label])\n+\n+    if params_present? && manager.create_client_token(label: params[:label])", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc3MDM5Ng=="}, "originalCommit": {"oid": "f3e3c00ebc3c39ce9c3617774634fe4619a013da"}, "originalPosition": 17}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 142, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}