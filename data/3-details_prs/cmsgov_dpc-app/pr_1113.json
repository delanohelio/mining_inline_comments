{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0NDQ5MjI2", "number": 1113, "title": "DPC-772 Add DPC specific headers to BFD call", "bodyText": "Fixes DPC-772\nBFD is now outlining the app specific headers it requires from each app that uses it.  DPC is now sending the applicable headers BFD is requiring.\nProposed Changes\n\nAdd provider id to MDC\nUse MDCs to populate the headers sent to BFD\n\nChange Details\n\nSecurity Implications\nOnly additional Ids that will be in the logs will be the UUID associated to the provider which is not considered sensitive information.\n\n\n new software dependencies\n\n\n\n security controls or supporting software altered\n\n\n\n new data stored or transmitted\n\n\n\n security checklist is completed for this change\n\n\n\n requires more information or team discussion to evaluate security implications\n\n\n\n no PHI/PII is affected by this change\n\n\nAcceptance Validation\n\n\nUsed an existing org in dev environment, uploaded public key, created access token, created patient, provider, roster and submitted for export from local computer to postman,\nSaw my VPN's ip address in the logs when the batch was being processed (won't post screen shot in case IP is sensitive info)\nFeedback Requested", "createdAt": "2020-11-03T03:01:50Z", "url": "https://github.com/CMSgov/dpc-app/pull/1113", "merged": true, "mergeCommit": {"oid": "154c127885e1678d5c0c82e26c396bae952ac97d"}, "closed": true, "closedAt": "2020-11-19T00:26:16Z", "author": {"login": "MrBilnon"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdYwCARgH2gAyNTE0NDQ5MjI2OjVhNjIyNWQ5NmFjZDE2YjhhMDdmMWJmOWQ1MTRjOGViMGUwMWE0ZmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdd19_VgFqTUzMzkzNzEzMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5a6225d96acd16b8a07f1bf9d514c8eb0e01a4fa", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/5a6225d96acd16b8a07f1bf9d514c8eb0e01a4fa", "committedDate": "2020-11-03T02:49:03Z", "message": "add DPC specific headers to BFD call"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a34b2227fedc74202c52df0b5a181bcf3d10e005", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/a34b2227fedc74202c52df0b5a181bcf3d10e005", "committedDate": "2020-11-05T15:47:20Z", "message": "Merge branch 'master' into wh/DPC-772-pass-bfd-required-headers"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NDY0NzQz", "url": "https://github.com/CMSgov/dpc-app/pull/1113#pullrequestreview-524464743", "createdAt": "2020-11-05T16:53:16Z", "commit": {"oid": "a34b2227fedc74202c52df0b5a181bcf3d10e005"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a4b98b64728261ad1dd2ce43cb2878aa462d863", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/5a4b98b64728261ad1dd2ce43cb2878aa462d863", "committedDate": "2020-11-09T15:55:50Z", "message": "remove clear mdc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1b3d5e63411a9c67165873e760e0832df2c3086", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/a1b3d5e63411a9c67165873e760e0832df2c3086", "committedDate": "2020-11-09T15:55:58Z", "message": "Merge remote-tracking branch 'origin/wh/DPC-772-pass-bfd-required-headers' into wh/DPC-772-pass-bfd-required-headers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2bf43b8dd4b4be4e6111b755e417f70c720d4b7", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/b2bf43b8dd4b4be4e6111b755e417f70c720d4b7", "committedDate": "2020-11-09T16:43:26Z", "message": "test removal of MDC values after engine is stopped"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d34125767bf0d47988d8269b52de64324b4c975e", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/d34125767bf0d47988d8269b52de64324b4c975e", "committedDate": "2020-11-09T16:59:17Z", "message": "Merge branch 'master' into wh/DPC-772-pass-bfd-required-headers"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4Mzg3ODU4", "url": "https://github.com/CMSgov/dpc-app/pull/1113#pullrequestreview-528387858", "createdAt": "2020-11-11T17:31:28Z", "commit": {"oid": "d34125767bf0d47988d8269b52de64324b4c975e"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d24fa47ec59d72765e5eaacc855cd16a7f11467d", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/d24fa47ec59d72765e5eaacc855cd16a7f11467d", "committedDate": "2020-11-12T17:05:55Z", "message": "change BFD headers to match their new requirements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01af871ff00fa03ba1f78d48ac3fc4e922c74478", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/01af871ff00fa03ba1f78d48ac3fc4e922c74478", "committedDate": "2020-11-13T04:06:56Z", "message": "use same constants"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxNDE3MTkx", "url": "https://github.com/CMSgov/dpc-app/pull/1113#pullrequestreview-531417191", "createdAt": "2020-11-16T15:16:11Z", "commit": {"oid": "01af871ff00fa03ba1f78d48ac3fc4e922c74478"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNToxNjoxMVrOH0DXnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNToxNjoxMVrOH0DXnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM0MzE5Ng==", "bodyText": "Have we tested in dev from an external address, to see whether we get the actual client IP or Akamai's IP?", "url": "https://github.com/CMSgov/dpc-app/pull/1113#discussion_r524343196", "createdAt": "2020-11-16T15:16:11Z", "author": {"login": "dhgreene"}, "path": "dpc-bluebutton/src/main/java/gov/cms/dpc/bluebutton/client/BlueButtonClientImpl.java", "diffHunk": "@@ -268,4 +279,23 @@ public String hashMbi(String mbi) throws GeneralSecurityException {\n             timerContext.stop();\n         }\n     }\n+\n+    private void addBFDHeaders(IQuery<?> query) {\n+\n+        try {\n+            query.withAdditionalHeader(Constants.INCLUDE_IDENTIFIERS_HEADER, \"mbi\");\n+            var providerId = MDC.get(MDCConstants.PROVIDER_ID);\n+            var jobId = MDC.get(MDCConstants.JOB_ID);\n+            if (StringUtils.isNotBlank(providerId)) {\n+                query.withAdditionalHeader(Constants.BULK_CLIENT_ID_HEADER, providerId);\n+            }\n+            if (StringUtils.isNotBlank(jobId)) {\n+                query.withAdditionalHeader(Constants.BULK_JOB_ID_HEADER, jobId);\n+            }\n+            query.withAdditionalHeader(HttpHeaders.X_FORWARDED_FOR, InetAddress.getLocalHost().getHostAddress());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01af871ff00fa03ba1f78d48ac3fc4e922c74478"}, "originalPosition": 86}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4272bef9115a82dd15c98c6e548aa0444187f9c", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/a4272bef9115a82dd15c98c6e548aa0444187f9c", "committedDate": "2020-11-18T16:14:45Z", "message": "pass requesting ip into job batch to send to BFD"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e454c9346c62b33c73d81c4876c349b5ae05e320", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/e454c9346c62b33c73d81c4876c349b5ae05e320", "committedDate": "2020-11-18T16:18:20Z", "message": "remove requesting ip after batch is processed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d60bd8e307e8b04b12b9b34855dd4804b739988", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/0d60bd8e307e8b04b12b9b34855dd4804b739988", "committedDate": "2020-11-18T19:03:19Z", "message": "Merge branch 'master' into wh/DPC-772-pass-bfd-required-headers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e7ba33e73859412387b3fa0489b439df39fd0d8", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/4e7ba33e73859412387b3fa0489b439df39fd0d8", "committedDate": "2020-11-18T22:11:52Z", "message": "increasing character count to requesting_ip column in case ipv6 starts getting appended by akami or aws"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "355fb79d77fc39c6fa1f500c7c380dd0e015c650", "author": {"user": {"login": "MrBilnon", "name": "Will H"}}, "url": "https://github.com/CMSgov/dpc-app/commit/355fb79d77fc39c6fa1f500c7c380dd0e015c650", "committedDate": "2020-11-18T22:12:00Z", "message": "Merge remote-tracking branch 'origin/wh/DPC-772-pass-bfd-required-headers' into wh/DPC-772-pass-bfd-required-headers"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzOTI5OTI3", "url": "https://github.com/CMSgov/dpc-app/pull/1113#pullrequestreview-533929927", "createdAt": "2020-11-18T22:21:49Z", "commit": {"oid": "355fb79d77fc39c6fa1f500c7c380dd0e015c650"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMjoyMTo0OVrOH2Etfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMjoyMTo0OVrOH2Etfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ2MjMzNA==", "bodyText": "Not an issue, but we could just inject the HttpHeaders instead of the entire request.", "url": "https://github.com/CMSgov/dpc-app/pull/1113#discussion_r526462334", "createdAt": "2020-11-18T22:21:49Z", "author": {"login": "MrMorie"}, "path": "dpc-api/src/main/java/gov/cms/dpc/api/resources/v1/GroupResource.java", "diffHunk": "@@ -272,7 +274,8 @@ public Response export(@ApiParam(hidden = true)\n                            @DefaultValue(FHIR_NDJSON) @QueryParam(\"_outputFormat\") @NoHtml String outputFormat,\n                            @ApiParam(value = \"Resources will be included in the response if their state has changed after the supplied time (e.g. if Resource.meta.lastUpdated is later than the supplied _since time).\")\n                            @QueryParam(\"_since\") @NoHtml String sinceParam,\n-                           @ApiParam(hidden = true) @HeaderParam(\"Prefer\")  @Valid String Prefer) {\n+                           @ApiParam(hidden = true) @HeaderParam(\"Prefer\")  @Valid String Prefer,\n+                           @Context HttpServletRequest request) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "355fb79d77fc39c6fa1f500c7c380dd0e015c650"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzOTM0ODgx", "url": "https://github.com/CMSgov/dpc-app/pull/1113#pullrequestreview-533934881", "createdAt": "2020-11-18T22:29:59Z", "commit": {"oid": "355fb79d77fc39c6fa1f500c7c380dd0e015c650"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMjoyOTo1OVrOH2E9jQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMjoyOTo1OVrOH2E9jQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ2NjQ0NQ==", "bodyText": "Since we have an MDCConstants.java file, maybe rename this to something more specific? HeadersConstants? Unless this will be a catch all constants file and just happens to have only headers at the moment.", "url": "https://github.com/CMSgov/dpc-app/pull/1113#discussion_r526466445", "createdAt": "2020-11-18T22:29:59Z", "author": {"login": "MrMorie"}, "path": "dpc-common/src/main/java/gov/cms/dpc/common/Constants.java", "diffHunk": "@@ -0,0 +1,10 @@\n+package gov.cms.dpc.common;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "355fb79d77fc39c6fa1f500c7c380dd0e015c650"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzOTM2NTIy", "url": "https://github.com/CMSgov/dpc-app/pull/1113#pullrequestreview-533936522", "createdAt": "2020-11-18T22:32:37Z", "commit": {"oid": "355fb79d77fc39c6fa1f500c7c380dd0e015c650"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzOTM3MTMy", "url": "https://github.com/CMSgov/dpc-app/pull/1113#pullrequestreview-533937132", "createdAt": "2020-11-18T22:33:43Z", "commit": {"oid": "355fb79d77fc39c6fa1f500c7c380dd0e015c650"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 317, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}