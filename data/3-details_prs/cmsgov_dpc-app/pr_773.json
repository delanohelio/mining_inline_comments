{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwMTUwNzk2", "number": 773, "title": "DPC-1295: In prod_sbx automatically approve organization for API use", "bodyText": "Why\nTo expedite onboarding for prod-sbx, internal users will be automatically prompted to enable organizations for sandbox API.\nWhat Changed\nIf DEPLOY_ENV is set to prod-sbx (sandbox.dpc.cms.org), internal users will be redirected to the enable organization in sandbox API form to immediately enable organization in sandbox.\nAdjusted registered organization errors to be more succinct (specifically to tell when NPI is missing).\nChoices Made\nWorkflow for organization create in prod-sbx:\nForm to create\n\nForm to enable in API\n\nOrganization created & enabled in API\n\nError for if no NPI present:\n\nTickets closed:\nDPC-1272 - (story) Remove approval step to access prod-sandbox access\nDPC-1295 - In prod_sbx automatically approve organization for API use\nFuture Work\nN/A\nChecklist\n\n All tests are passing via make ci-app (app change) and make ci-web (website change)\n Swagger documentation has been updated\n FHIR documentation has been updated\n Any required dpc-ops changes have a PR submitted and mentioned in this ticket\n Any manual migration steps are documented, scripts written (where applicable), and tested\n Before merging, any required dpc-ops changes have been approved and merged into master of the dpc-ops repo", "createdAt": "2020-04-28T14:20:25Z", "url": "https://github.com/CMSgov/dpc-app/pull/773", "merged": true, "mergeCommit": {"oid": "e018deedc829943c04491a662c233a3f82bd9268"}, "closed": true, "closedAt": "2020-04-29T18:50:51Z", "author": {"login": "Sun-Mountain"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcbzKLngH2gAyNDEwMTUwNzk2OjMxZjA1NGYwNDkwOGYyNzkzODBlOWZkNTQ5NDIwYWZlMjY5NWVmZjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcccdQ2AH2gAyNDEwMTUwNzk2OjA2OTFkYzIyOWI4NDg2NWVhZmFlZTVkNDI0MjgzMDRhYjIwODQ1NzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "31f054f04908f279380e9fd549420afe2695eff9", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/31f054f04908f279380e9fd549420afe2695eff9", "committedDate": "2020-04-27T17:58:19Z", "message": "In prod-sbx, redirect after create org to enable org in api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33b9c040174d9ba94533f48c52f7dfc0798a92d2", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/33b9c040174d9ba94533f48c52f7dfc0798a92d2", "committedDate": "2020-04-28T13:58:51Z", "message": "Updated Gemfile & registered organization errors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxODg2NDcw", "url": "https://github.com/CMSgov/dpc-app/pull/773#pullrequestreview-401886470", "createdAt": "2020-04-28T14:22:16Z", "commit": {"oid": "33b9c040174d9ba94533f48c52f7dfc0798a92d2"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxNDoyMjoxNlrOGNWkJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxNDoyMjoxN1rOGNWkMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjY1NDM3NQ==", "bodyText": "Literal 'Cannot find organization' appeared as a condition.", "url": "https://github.com/CMSgov/dpc-app/pull/773#discussion_r416654375", "createdAt": "2020-04-28T14:22:16Z", "author": {"login": "codeclimate"}, "path": "dpc-web/app/models/registered_organization.rb", "diffHunk": "@@ -84,7 +90,9 @@ def delete_api_organization\n       return\n     end\n \n-    errors.add(:base, \"couldn't be deleted from #{api_env} API: #{api_response}\")\n+    action = 'deleted'\n+    msg = api_repsponse.include? 'Cannot find organization' ? 'Cannot find organization' : api_response", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33b9c040174d9ba94533f48c52f7dfc0798a92d2"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjY1NDM3Ng==", "bodyText": "Use double pipes || instead.", "url": "https://github.com/CMSgov/dpc-app/pull/773#discussion_r416654376", "createdAt": "2020-04-28T14:22:16Z", "author": {"login": "codeclimate"}, "path": "dpc-web/app/models/registered_organization.rb", "diffHunk": "@@ -84,7 +90,9 @@ def delete_api_organization\n       return\n     end\n \n-    errors.add(:base, \"couldn't be deleted from #{api_env} API: #{api_response}\")\n+    action = 'deleted'\n+    msg = api_repsponse.include? 'Cannot find organization' ? 'Cannot find organization' : api_response", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33b9c040174d9ba94533f48c52f7dfc0798a92d2"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjY1NDM4Mg==", "bodyText": "Trailing whitespace detected.", "url": "https://github.com/CMSgov/dpc-app/pull/773#discussion_r416654382", "createdAt": "2020-04-28T14:22:17Z", "author": {"login": "codeclimate"}, "path": "dpc-web/app/controllers/internal/organizations_controller.rb", "diffHunk": "@@ -84,6 +86,10 @@ def destroy\n \n     private\n \n+    def prod_sbx?\n+      ENV['DEPLOY_ENV'] == 'prod-sbx'\n+    end\n+  ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33b9c040174d9ba94533f48c52f7dfc0798a92d2"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjY1NDM4Ng==", "bodyText": "Line is too long. [131/120]", "url": "https://github.com/CMSgov/dpc-app/pull/773#discussion_r416654386", "createdAt": "2020-04-28T14:22:17Z", "author": {"login": "codeclimate"}, "path": "dpc-web/app/controllers/internal/organizations_controller.rb", "diffHunk": "@@ -42,6 +42,8 @@ def create\n         flash[:notice] = 'Organization created.'\n         if params[:from_user].present?\n           redirect_to edit_internal_user_path(params[:from_user], user_organization_ids: @organization.id)\n+        elsif prod_sbx?\n+          redirect_to new_internal_organization_registered_organization_path(organization_id: @organization.id, api_env: 'sandbox')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33b9c040174d9ba94533f48c52f7dfc0798a92d2"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4aed87ffe91176e47f29eba794f94ca2fa4966d", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/d4aed87ffe91176e47f29eba794f94ca2fa4966d", "committedDate": "2020-04-28T14:50:11Z", "message": "Code Climate fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5db7659aa5e0d2f80b18346c0cbdbcd5d0d71b0", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/e5db7659aa5e0d2f80b18346c0cbdbcd5d0d71b0", "committedDate": "2020-04-28T15:57:19Z", "message": "Fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "848d05a6ae6962f8daf69ab3c6b5539159a57f8a", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/848d05a6ae6962f8daf69ab3c6b5539159a57f8a", "committedDate": "2020-04-28T16:01:41Z", "message": "Code Climate fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7361c6bd6736d29de31732168d84419479157d8", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/c7361c6bd6736d29de31732168d84419479157d8", "committedDate": "2020-04-28T16:48:51Z", "message": "Reorder create conditionals"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyNjI3NjY2", "url": "https://github.com/CMSgov/dpc-app/pull/773#pullrequestreview-402627666", "createdAt": "2020-04-29T12:43:03Z", "commit": {"oid": "c7361c6bd6736d29de31732168d84419479157d8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ee3dfe23b43f449b99dd9565ae649d97c9dd643", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/8ee3dfe23b43f449b99dd9565ae649d97c9dd643", "committedDate": "2020-04-29T15:21:44Z", "message": "Merge branch 'master' into nzonnenberg/dpc-1295-auto-api-prod-sbx"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0691dc229b84865eafaee5d42428304ab2084570", "author": {"user": {"login": "Sun-Mountain", "name": "Nicole Zonnenberg"}}, "url": "https://github.com/CMSgov/dpc-app/commit/0691dc229b84865eafaee5d42428304ab2084570", "committedDate": "2020-04-29T18:05:16Z", "message": "Merge branch 'master' into nzonnenberg/dpc-1295-auto-api-prod-sbx"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 120, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}