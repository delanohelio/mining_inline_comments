{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA0OTM0ODkw", "number": 1091, "title": "DPC-554 fix: Require `Accept` header", "bodyText": "Fixes DPC-554\nThis PR is meant to replace #923\nFHIR Bulk data spec requires the Accept parameter to be set to application/fhir+json\nProposed Changes\n\nAdd a unit test to check that we are correctly checking the required headers\nupdate header variable names to be lowercase, per convention\nsplit out and modify the checkRequestHeader method to take a Map of headers instead of multiple string variables\n\nChange Details\nThe decision to use aMap instead of a list of variables is to make the method more extensible for the future. It is better to change the implementation of the method if needed in the future instead of the interface, so a Map is better than a growing list of String parameters.\nSecurity Implications\n\n new software dependencies\n\n\n\n security controls or supporting software altered\n\n\n\n new data stored or transmitted\n\n\n\n security checklist is completed for this change\n\n\n\n requires more information or team discussion to evaluate security implications\n\n\n\n no PHI/PII is affected by this change\n\n\nAcceptance Validation\n\nNew unit tests pass\nsmoke tests passed locally\n\n\nFeedback Requested\nAny", "createdAt": "2020-10-16T15:39:43Z", "url": "https://github.com/CMSgov/dpc-app/pull/1091", "merged": true, "mergeCommit": {"oid": "29fc06907510d70c7ae27da9fcf16d48cd80e696"}, "closed": true, "closedAt": "2020-10-20T18:47:18Z", "author": {"login": "jonfulk"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdTHIAygH2gAyNTA0OTM0ODkwOjQwMzEwMGE3ODY2YTBjOGNmMTVkOGZjNjI0MzFiYzE0ZDdjZjhjMTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUcapVAFqTUxMjk4MTQ1OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "403100a7866a0c8cf15d8fc62431bc14d7cf8c11", "author": {"user": {"login": "jonfulk", "name": "M.Zola"}}, "url": "https://github.com/CMSgov/dpc-app/commit/403100a7866a0c8cf15d8fc62431bc14d7cf8c11", "committedDate": "2020-10-16T14:19:53Z", "message": "fix: make `Prefer` variable lowercase"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a556a6910dc24c9df346ff07ac9e61392f36ef1d", "author": {"user": {"login": "jonfulk", "name": "M.Zola"}}, "url": "https://github.com/CMSgov/dpc-app/commit/a556a6910dc24c9df346ff07ac9e61392f36ef1d", "committedDate": "2020-10-16T15:56:35Z", "message": "fix: add test for required `Prefer` header"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3be1cfac7fa701246cbcc2738cce2d0f261b363e", "author": {"user": {"login": "jonfulk", "name": "M.Zola"}}, "url": "https://github.com/CMSgov/dpc-app/commit/3be1cfac7fa701246cbcc2738cce2d0f261b363e", "committedDate": "2020-10-16T18:53:43Z", "message": "feat: add `Accept` header param"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cbfe60fff9766c38b78387cc1fb311ae687ae932", "author": {"user": {"login": "jonfulk", "name": "M.Zola"}}, "url": "https://github.com/CMSgov/dpc-app/commit/cbfe60fff9766c38b78387cc1fb311ae687ae932", "committedDate": "2020-10-16T18:54:21Z", "message": "fix: mv/simplify test and check for accept header"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d1424cade9534173ca603eed72097d65c9c3f3d", "author": {"user": {"login": "jonfulk", "name": "M.Zola"}}, "url": "https://github.com/CMSgov/dpc-app/commit/6d1424cade9534173ca603eed72097d65c9c3f3d", "committedDate": "2020-10-19T15:42:02Z", "message": "fix: update test and make it pass"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "6d1424cade9534173ca603eed72097d65c9c3f3d", "author": {"user": {"login": "jonfulk", "name": "M.Zola"}}, "url": "https://github.com/CMSgov/dpc-app/commit/6d1424cade9534173ca603eed72097d65c9c3f3d", "committedDate": "2020-10-19T15:42:02Z", "message": "fix: update test and make it pass"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddb677d32fa9efba5ce93ec5664bc7698f5dca53", "author": {"user": {"login": "jonfulk", "name": "M.Zola"}}, "url": "https://github.com/CMSgov/dpc-app/commit/ddb677d32fa9efba5ce93ec5664bc7698f5dca53", "committedDate": "2020-10-19T17:55:45Z", "message": "Merge branch 'master' into jkf/DPC-554-require-accept-header"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyMzM5NTcy", "url": "https://github.com/CMSgov/dpc-app/pull/1091#pullrequestreview-512339572", "createdAt": "2020-10-20T05:24:08Z", "commit": {"oid": "ddb677d32fa9efba5ce93ec5664bc7698f5dca53"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQwNToyNDowOFrOHkrGDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQwNToyNDowOFrOHkrGDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODIxNjg0Ng==", "bodyText": "I feel like this check should also be in the checkRequestHeaders method", "url": "https://github.com/CMSgov/dpc-app/pull/1091#discussion_r508216846", "createdAt": "2020-10-20T05:24:08Z", "author": {"login": "MrBilnon"}, "path": "dpc-api/src/main/java/gov/cms/dpc/api/resources/v1/GroupResource.java", "diffHunk": "@@ -268,15 +273,25 @@ public Response export(@ApiParam(hidden = true)\n                            @PathParam(\"rosterID\") @NoHtml String rosterID,\n                            @ApiParam(value = \"List of FHIR resources to export\", allowableValues = \"ExplanationOfBenefits, Coverage, Patient\")\n                            @QueryParam(\"_type\") @NoHtml String resourceTypes,\n-                           @ApiParam(value = \"Output format of requested data\", allowableValues = FHIR_NDJSON , defaultValue = FHIR_NDJSON)\n+                           @ApiParam(value = \"Output format of requested data\", allowableValues = FHIR_NDJSON, defaultValue = FHIR_NDJSON)\n                            @QueryParam(\"_outputFormat\") @NoHtml String outputFormat,\n                            @ApiParam(value = \"Resources will be included in the response if their state has changed after the supplied time (e.g. if Resource.meta.lastUpdated is later than the supplied _since time).\")\n                            @QueryParam(\"_since\") @NoHtml String since,\n-                           @ApiParam(hidden = true) @HeaderParam(\"Prefer\")  @Valid String Prefer) {\n+                           @ApiParam(hidden = true) @HeaderParam(\"Prefer\") @Valid String prefer,\n+                           @ApiParam(hidden = true) @HeaderParam(\"Accept\") @Valid String accept) {\n         logger.info(\"Exporting data for provider: {} _since: {}\", rosterID, since);\n \n         // Check the parameters\n-        checkExportRequest(outputFormat, Prefer);\n+        Map<String, String> headers = Stream.of(Pair.of(\"Prefer\", prefer), Pair.of(\"Accept\", accept))\n+                .peek(header -> {\n+                    if (header.getRight() == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddb677d32fa9efba5ce93ec5664bc7698f5dca53"}, "originalPosition": 111}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyOTQ3NTA2", "url": "https://github.com/CMSgov/dpc-app/pull/1091#pullrequestreview-512947506", "createdAt": "2020-10-20T16:59:46Z", "commit": null, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b08a7a570dfdaf3f585d953f2100d115531d5c1", "author": {"user": {"login": "jonfulk", "name": "M.Zola"}}, "url": "https://github.com/CMSgov/dpc-app/commit/8b08a7a570dfdaf3f585d953f2100d115531d5c1", "committedDate": "2020-10-20T17:30:09Z", "message": "fix: move `BadRequestExceptions` into the `check...` methods"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "8b08a7a570dfdaf3f585d953f2100d115531d5c1", "author": {"user": {"login": "jonfulk", "name": "M.Zola"}}, "url": "https://github.com/CMSgov/dpc-app/commit/8b08a7a570dfdaf3f585d953f2100d115531d5c1", "committedDate": "2020-10-20T17:30:09Z", "message": "fix: move `BadRequestExceptions` into the `check...` methods"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyOTc4MDU5", "url": "https://github.com/CMSgov/dpc-app/pull/1091#pullrequestreview-512978059", "createdAt": "2020-10-20T17:37:53Z", "commit": {"oid": "8b08a7a570dfdaf3f585d953f2100d115531d5c1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyOTgxNDU4", "url": "https://github.com/CMSgov/dpc-app/pull/1091#pullrequestreview-512981458", "createdAt": "2020-10-20T17:42:10Z", "commit": {"oid": "8b08a7a570dfdaf3f585d953f2100d115531d5c1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 295, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}