{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxMzI1NDcz", "number": 9033, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNlQwMjoxNToyMlrOEnsRmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNlQwMjo1Njo0OFrOEns4SQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMDU1MzIwOnYy", "diffSide": "RIGHT", "path": "java/src/jmri/jmrit/swing/meter/MeterFrame.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNlQwMjoxNToyMlrOHYbzHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNlQwMzo0MDowOVrOHYdZwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTM4MzMyNg==", "bodyText": "This structure \"forces\" all displayed titles on the GUI to be specifically \"track voltage\" or \"track current\", as specified in the bundle associated with jmrit/swing/meter.  This is limiting.\nReported voltages can be \"other than track\" voltages.  Reported currents can be \"other than track\" currents.\nPresumably, other \"meter\" types, such as a fictitious \"LocoNet Message Traffic Meter\" would need some other title (and probably some other \"units\").  It seems silly to me that the title and units would be effectively hard-coded in the MeterFrame and its bundle, rather than provided by the concrete implementation which provides the meter data.\nI would recommend that some future implementation move the \"title\" information out of the MeterFrame and its bundle, into the concrete implementations of the meter data sources.  Ditto for \"default number of whole-unit digits\" and \"default number of fractional-unit digits\", and the units themselves.", "url": "https://github.com/JMRI/JMRI/pull/9033#discussion_r495383326", "createdAt": "2020-09-26T02:15:22Z", "author": {"login": "devel-bobm"}, "path": "java/src/jmri/jmrit/swing/meter/MeterFrame.java", "diffHunk": "@@ -0,0 +1,661 @@\n+package jmri.jmrit.swing.meter;\n+\n+import java.awt.event.*;\n+import java.beans.PropertyChangeListener;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.UUID;\n+\n+import javax.swing.*;\n+\n+import jmri.*;\n+import jmri.jmrit.catalog.NamedIcon;\n+import jmri.util.JmriJFrame;\n+\n+/**\n+ * Frame providing a simple LCD-based display of track voltage.\n+ * <p>\n+ * @author Ken Cameron        Copyright (C) 2007\n+ * @author Mark Underwood     Copyright (C) 2007\n+ * @author Andrew Crosland    Copyright (C) 2020\n+ * @author Daniel Bergqvist   Copyright (C) 2020\n+ *\n+ * Adapted from ampmeter to display voltage and current.\n+ */\n+public class MeterFrame extends JmriJFrame {\n+\n+    public enum Unit {\n+        Percent(1.0),    // Not a unit, but here anyway\n+        MicroVolt(1000*1000),\n+        MilliVolt(1000),\n+        Volt(1.0),\n+        KiloVolt(1/1000.0),\n+        MicroAmpere(1000*1000),\n+        MilliAmpere(1000),\n+        Ampere(1.0),\n+        KiloAmpere(1/1000.0);\n+        \n+        private final double multiply;\n+        \n+        private Unit(double m) { multiply = m; }\n+    }\n+    \n+    private static final int MAX_INTEGER_DIGITS = 7;\n+    private static final int MAX_DECIMAL_DIGITS = 3;\n+    \n+    private final UUID uuid;\n+    \n+    private final List<Meter> voltageMeters = new ArrayList<>();\n+    private final List<Meter> currentMeters = new ArrayList<>();\n+    \n+    // GUI member declarations\n+    private JMenuBar menuBar;\n+    ArrayList<JLabel> integerDigitIcons;\n+    ArrayList<JLabel> decimalDigitIcons;\n+    JLabel decimal;\n+    Map<Unit, JLabel> unitLabels = new HashMap<>();\n+    \n+    Map<Meter, JCheckBoxMenuItem> meter_MenuItemMap = new HashMap<>();\n+    Map<Unit, JCheckBoxMenuItem> units_MenuItemMap = new HashMap<>();\n+    Map<Integer, JCheckBoxMenuItem> integerDigits_MenuItemMap = new HashMap<>();\n+    Map<Integer, JCheckBoxMenuItem> decimalDigits_MenuItemMap = new HashMap<>();\n+    JMenuItem lastSelectedMeterMenuItem;\n+    JMenuItem lastSelectedIntegerDigitsMenuItem;\n+    JMenuItem lastSelectedDecimalDigitsMenuItem;\n+    int numIntegerDigits = 3;\n+    int numDecimalDigits = 0;\n+    int lastNumDecimalDigits = -1;\n+    int widthOfAllIconsToDisplay = 0;\n+    int oldWidthOfAllIconsToDisplay = -1;\n+    boolean frameIsInitialized = false;\n+    Unit selectedUnit = Unit.Volt;\n+    \n+    int digitIconWidth;\n+    int decimalIconWidth;\n+    int unitIconWidth;\n+    int iconHeight;\n+\n+    private PropertyChangeListener propertyChangeListener;\n+\n+    private Meter meter;\n+\n+    NamedIcon integerDigits[] = new NamedIcon[10];\n+    NamedIcon decimalDigits[] = new NamedIcon[10];\n+    NamedIcon decimalIcon;\n+    NamedIcon microVoltIcon;\n+    NamedIcon milliVoltIcon;\n+    NamedIcon voltIcon;\n+    NamedIcon kiloVoltIcon;\n+    NamedIcon microAmpIcon;\n+    NamedIcon milliAmpIcon;\n+    NamedIcon ampIcon;\n+    NamedIcon kiloAmpIcon;\n+    NamedIcon percentIcon;\n+    NamedIcon errorIcon;\n+\n+    JPanel pane1;\n+    JPanel meterPane;\n+    \n+    public MeterFrame() {\n+        this(UUID.randomUUID());\n+    }\n+    \n+    public MeterFrame(UUID uuid) {\n+        super(Bundle.getMessage(\"TrackVoltageMeterTitle\"));\n+        \n+        this.uuid = uuid;\n+        \n+        MeterManager mm = InstanceManager.getNullableDefault(MeterManager.class);\n+        if (mm == null) throw new RuntimeException(\"No meter manager exists\");\n+        \n+        for (Meter m : mm.getNamedBeanSet()) {\n+            if ((m != null) && (m instanceof VoltageMeter)) voltageMeters.add(m);\n+            if ((m != null) && (m instanceof CurrentMeter)) currentMeters.add(m);\n+        }\n+        \n+        if (!voltageMeters.isEmpty()) {\n+            setMeter(voltageMeters.get(0));\n+        } else if (!currentMeters.isEmpty()) {\n+            setMeter(currentMeters.get(0));\n+        } else {\n+            setTitle(Bundle.getMessage(\"TrackVoltageMeterTitle\"));\n+        }\n+        \n+        MeterFrameManager.getInstance().register(this);\n+    }\n+    \n+    /**\n+     * Get the UUID of this frame.\n+     * <P>\n+     * The UUID is used if two different panel files are loaded with the same\n+     * meter frame.\n+     * \n+     * @return the UUID of this frame\n+     */\n+    public UUID getUUID() {\n+        return uuid;\n+    }\n+    \n+    /**\n+     * Get the meter that is displayed\n+     * @return the meter\n+     */\n+    public Meter getMeter() {\n+        return meter;\n+    }\n+    \n+    /**\n+     * Set the meter that is displayed.\n+     * @param m the meter or null if no meter is to be shown\n+     */\n+    public void setMeter(Meter m) {\n+        if (lastSelectedMeterMenuItem != null) lastSelectedMeterMenuItem.setSelected(false);\n+\n+        if (meter != null) {\n+            meter.disable();\n+            meter.removePropertyChangeListener(NamedBean.PROPERTY_STATE, propertyChangeListener);\n+        }\n+\n+        meter = m;\n+        \n+        if (meter == null) return;\n+        \n+        meter.addPropertyChangeListener(NamedBean.PROPERTY_STATE, propertyChangeListener);\n+        meter.enable();\n+\n+        if (frameIsInitialized) {\n+            // Initially we want to scale the icons to fit the previously saved window size\n+            scaleImage();\n+\n+            JCheckBoxMenuItem menuItem = meter_MenuItemMap.get(meter);\n+            menuItem.setSelected(true);\n+            lastSelectedMeterMenuItem = menuItem;\n+            \n+            updateMenuUnits();\n+            initSelectedUnit();\n+        }\n+\n+        if (meter instanceof VoltageMeter) {\n+            setTitle(Bundle.getMessage(\"TrackVoltageMeterTitle2\", m.getDisplayName()));\n+        } else {\n+            setTitle(Bundle.getMessage(\"TrackCurrentMeterTitle2\", m.getDisplayName()));\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb4422ded8d37d69f4deef3b026c93f86fefb87e"}, "originalPosition": 184}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQwOTYwMQ==", "bodyText": "I have removed the string \"Track\" from the title. It's not needed. The meters are NamedBeans and their display name (system name and possibly the user name) are displayed in the title of MeterFrame. So one simple solution is to give the predefined meters a decent name, for example \"Track voltage\".", "url": "https://github.com/JMRI/JMRI/pull/9033#discussion_r495409601", "createdAt": "2020-09-26T03:40:09Z", "author": {"login": "danielb987"}, "path": "java/src/jmri/jmrit/swing/meter/MeterFrame.java", "diffHunk": "@@ -0,0 +1,661 @@\n+package jmri.jmrit.swing.meter;\n+\n+import java.awt.event.*;\n+import java.beans.PropertyChangeListener;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.UUID;\n+\n+import javax.swing.*;\n+\n+import jmri.*;\n+import jmri.jmrit.catalog.NamedIcon;\n+import jmri.util.JmriJFrame;\n+\n+/**\n+ * Frame providing a simple LCD-based display of track voltage.\n+ * <p>\n+ * @author Ken Cameron        Copyright (C) 2007\n+ * @author Mark Underwood     Copyright (C) 2007\n+ * @author Andrew Crosland    Copyright (C) 2020\n+ * @author Daniel Bergqvist   Copyright (C) 2020\n+ *\n+ * Adapted from ampmeter to display voltage and current.\n+ */\n+public class MeterFrame extends JmriJFrame {\n+\n+    public enum Unit {\n+        Percent(1.0),    // Not a unit, but here anyway\n+        MicroVolt(1000*1000),\n+        MilliVolt(1000),\n+        Volt(1.0),\n+        KiloVolt(1/1000.0),\n+        MicroAmpere(1000*1000),\n+        MilliAmpere(1000),\n+        Ampere(1.0),\n+        KiloAmpere(1/1000.0);\n+        \n+        private final double multiply;\n+        \n+        private Unit(double m) { multiply = m; }\n+    }\n+    \n+    private static final int MAX_INTEGER_DIGITS = 7;\n+    private static final int MAX_DECIMAL_DIGITS = 3;\n+    \n+    private final UUID uuid;\n+    \n+    private final List<Meter> voltageMeters = new ArrayList<>();\n+    private final List<Meter> currentMeters = new ArrayList<>();\n+    \n+    // GUI member declarations\n+    private JMenuBar menuBar;\n+    ArrayList<JLabel> integerDigitIcons;\n+    ArrayList<JLabel> decimalDigitIcons;\n+    JLabel decimal;\n+    Map<Unit, JLabel> unitLabels = new HashMap<>();\n+    \n+    Map<Meter, JCheckBoxMenuItem> meter_MenuItemMap = new HashMap<>();\n+    Map<Unit, JCheckBoxMenuItem> units_MenuItemMap = new HashMap<>();\n+    Map<Integer, JCheckBoxMenuItem> integerDigits_MenuItemMap = new HashMap<>();\n+    Map<Integer, JCheckBoxMenuItem> decimalDigits_MenuItemMap = new HashMap<>();\n+    JMenuItem lastSelectedMeterMenuItem;\n+    JMenuItem lastSelectedIntegerDigitsMenuItem;\n+    JMenuItem lastSelectedDecimalDigitsMenuItem;\n+    int numIntegerDigits = 3;\n+    int numDecimalDigits = 0;\n+    int lastNumDecimalDigits = -1;\n+    int widthOfAllIconsToDisplay = 0;\n+    int oldWidthOfAllIconsToDisplay = -1;\n+    boolean frameIsInitialized = false;\n+    Unit selectedUnit = Unit.Volt;\n+    \n+    int digitIconWidth;\n+    int decimalIconWidth;\n+    int unitIconWidth;\n+    int iconHeight;\n+\n+    private PropertyChangeListener propertyChangeListener;\n+\n+    private Meter meter;\n+\n+    NamedIcon integerDigits[] = new NamedIcon[10];\n+    NamedIcon decimalDigits[] = new NamedIcon[10];\n+    NamedIcon decimalIcon;\n+    NamedIcon microVoltIcon;\n+    NamedIcon milliVoltIcon;\n+    NamedIcon voltIcon;\n+    NamedIcon kiloVoltIcon;\n+    NamedIcon microAmpIcon;\n+    NamedIcon milliAmpIcon;\n+    NamedIcon ampIcon;\n+    NamedIcon kiloAmpIcon;\n+    NamedIcon percentIcon;\n+    NamedIcon errorIcon;\n+\n+    JPanel pane1;\n+    JPanel meterPane;\n+    \n+    public MeterFrame() {\n+        this(UUID.randomUUID());\n+    }\n+    \n+    public MeterFrame(UUID uuid) {\n+        super(Bundle.getMessage(\"TrackVoltageMeterTitle\"));\n+        \n+        this.uuid = uuid;\n+        \n+        MeterManager mm = InstanceManager.getNullableDefault(MeterManager.class);\n+        if (mm == null) throw new RuntimeException(\"No meter manager exists\");\n+        \n+        for (Meter m : mm.getNamedBeanSet()) {\n+            if ((m != null) && (m instanceof VoltageMeter)) voltageMeters.add(m);\n+            if ((m != null) && (m instanceof CurrentMeter)) currentMeters.add(m);\n+        }\n+        \n+        if (!voltageMeters.isEmpty()) {\n+            setMeter(voltageMeters.get(0));\n+        } else if (!currentMeters.isEmpty()) {\n+            setMeter(currentMeters.get(0));\n+        } else {\n+            setTitle(Bundle.getMessage(\"TrackVoltageMeterTitle\"));\n+        }\n+        \n+        MeterFrameManager.getInstance().register(this);\n+    }\n+    \n+    /**\n+     * Get the UUID of this frame.\n+     * <P>\n+     * The UUID is used if two different panel files are loaded with the same\n+     * meter frame.\n+     * \n+     * @return the UUID of this frame\n+     */\n+    public UUID getUUID() {\n+        return uuid;\n+    }\n+    \n+    /**\n+     * Get the meter that is displayed\n+     * @return the meter\n+     */\n+    public Meter getMeter() {\n+        return meter;\n+    }\n+    \n+    /**\n+     * Set the meter that is displayed.\n+     * @param m the meter or null if no meter is to be shown\n+     */\n+    public void setMeter(Meter m) {\n+        if (lastSelectedMeterMenuItem != null) lastSelectedMeterMenuItem.setSelected(false);\n+\n+        if (meter != null) {\n+            meter.disable();\n+            meter.removePropertyChangeListener(NamedBean.PROPERTY_STATE, propertyChangeListener);\n+        }\n+\n+        meter = m;\n+        \n+        if (meter == null) return;\n+        \n+        meter.addPropertyChangeListener(NamedBean.PROPERTY_STATE, propertyChangeListener);\n+        meter.enable();\n+\n+        if (frameIsInitialized) {\n+            // Initially we want to scale the icons to fit the previously saved window size\n+            scaleImage();\n+\n+            JCheckBoxMenuItem menuItem = meter_MenuItemMap.get(meter);\n+            menuItem.setSelected(true);\n+            lastSelectedMeterMenuItem = menuItem;\n+            \n+            updateMenuUnits();\n+            initSelectedUnit();\n+        }\n+\n+        if (meter instanceof VoltageMeter) {\n+            setTitle(Bundle.getMessage(\"TrackVoltageMeterTitle2\", m.getDisplayName()));\n+        } else {\n+            setTitle(Bundle.getMessage(\"TrackCurrentMeterTitle2\", m.getDisplayName()));\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTM4MzMyNg=="}, "originalCommit": {"oid": "cb4422ded8d37d69f4deef3b026c93f86fefb87e"}, "originalPosition": 184}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMDU4MzI0OnYy", "diffSide": "RIGHT", "path": "java/src/jmri/jmrit/swing/meter/MeterFrame.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNlQwMjoyNzo1MFrOHYcGNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNlQwNDozMzoyNFrOHYdpcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTM4ODIxNQ==", "bodyText": "I assume that a concrete, system-specific MeterManager implementation may register its  VoltageMeter and CurrentMeter objects, and that registered objects of those types will be available for display in the MeterFrame GUI.  I assume that this loop construct makes all registered Meter objects available for selection for display by the MeterFrame.\nQuestion: can a given concrete MeterManager implementation register more than one VoltageMeter and/or more than one CurrentMeter object?  For example, \"track current from booster 1\" and \"track current from booster 2\" and \"track current from booster N\"?  If so, how are these multiple current meters differentiatable so that he/she can select the appropriate Meter object to display in the MeterFrame?", "url": "https://github.com/JMRI/JMRI/pull/9033#discussion_r495388215", "createdAt": "2020-09-26T02:27:50Z", "author": {"login": "devel-bobm"}, "path": "java/src/jmri/jmrit/swing/meter/MeterFrame.java", "diffHunk": "@@ -0,0 +1,661 @@\n+package jmri.jmrit.swing.meter;\n+\n+import java.awt.event.*;\n+import java.beans.PropertyChangeListener;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.UUID;\n+\n+import javax.swing.*;\n+\n+import jmri.*;\n+import jmri.jmrit.catalog.NamedIcon;\n+import jmri.util.JmriJFrame;\n+\n+/**\n+ * Frame providing a simple LCD-based display of track voltage.\n+ * <p>\n+ * @author Ken Cameron        Copyright (C) 2007\n+ * @author Mark Underwood     Copyright (C) 2007\n+ * @author Andrew Crosland    Copyright (C) 2020\n+ * @author Daniel Bergqvist   Copyright (C) 2020\n+ *\n+ * Adapted from ampmeter to display voltage and current.\n+ */\n+public class MeterFrame extends JmriJFrame {\n+\n+    public enum Unit {\n+        Percent(1.0),    // Not a unit, but here anyway\n+        MicroVolt(1000*1000),\n+        MilliVolt(1000),\n+        Volt(1.0),\n+        KiloVolt(1/1000.0),\n+        MicroAmpere(1000*1000),\n+        MilliAmpere(1000),\n+        Ampere(1.0),\n+        KiloAmpere(1/1000.0);\n+        \n+        private final double multiply;\n+        \n+        private Unit(double m) { multiply = m; }\n+    }\n+    \n+    private static final int MAX_INTEGER_DIGITS = 7;\n+    private static final int MAX_DECIMAL_DIGITS = 3;\n+    \n+    private final UUID uuid;\n+    \n+    private final List<Meter> voltageMeters = new ArrayList<>();\n+    private final List<Meter> currentMeters = new ArrayList<>();\n+    \n+    // GUI member declarations\n+    private JMenuBar menuBar;\n+    ArrayList<JLabel> integerDigitIcons;\n+    ArrayList<JLabel> decimalDigitIcons;\n+    JLabel decimal;\n+    Map<Unit, JLabel> unitLabels = new HashMap<>();\n+    \n+    Map<Meter, JCheckBoxMenuItem> meter_MenuItemMap = new HashMap<>();\n+    Map<Unit, JCheckBoxMenuItem> units_MenuItemMap = new HashMap<>();\n+    Map<Integer, JCheckBoxMenuItem> integerDigits_MenuItemMap = new HashMap<>();\n+    Map<Integer, JCheckBoxMenuItem> decimalDigits_MenuItemMap = new HashMap<>();\n+    JMenuItem lastSelectedMeterMenuItem;\n+    JMenuItem lastSelectedIntegerDigitsMenuItem;\n+    JMenuItem lastSelectedDecimalDigitsMenuItem;\n+    int numIntegerDigits = 3;\n+    int numDecimalDigits = 0;\n+    int lastNumDecimalDigits = -1;\n+    int widthOfAllIconsToDisplay = 0;\n+    int oldWidthOfAllIconsToDisplay = -1;\n+    boolean frameIsInitialized = false;\n+    Unit selectedUnit = Unit.Volt;\n+    \n+    int digitIconWidth;\n+    int decimalIconWidth;\n+    int unitIconWidth;\n+    int iconHeight;\n+\n+    private PropertyChangeListener propertyChangeListener;\n+\n+    private Meter meter;\n+\n+    NamedIcon integerDigits[] = new NamedIcon[10];\n+    NamedIcon decimalDigits[] = new NamedIcon[10];\n+    NamedIcon decimalIcon;\n+    NamedIcon microVoltIcon;\n+    NamedIcon milliVoltIcon;\n+    NamedIcon voltIcon;\n+    NamedIcon kiloVoltIcon;\n+    NamedIcon microAmpIcon;\n+    NamedIcon milliAmpIcon;\n+    NamedIcon ampIcon;\n+    NamedIcon kiloAmpIcon;\n+    NamedIcon percentIcon;\n+    NamedIcon errorIcon;\n+\n+    JPanel pane1;\n+    JPanel meterPane;\n+    \n+    public MeterFrame() {\n+        this(UUID.randomUUID());\n+    }\n+    \n+    public MeterFrame(UUID uuid) {\n+        super(Bundle.getMessage(\"TrackVoltageMeterTitle\"));\n+        \n+        this.uuid = uuid;\n+        \n+        MeterManager mm = InstanceManager.getNullableDefault(MeterManager.class);\n+        if (mm == null) throw new RuntimeException(\"No meter manager exists\");\n+        \n+        for (Meter m : mm.getNamedBeanSet()) {\n+            if ((m != null) && (m instanceof VoltageMeter)) voltageMeters.add(m);\n+            if ((m != null) && (m instanceof CurrentMeter)) currentMeters.add(m);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb4422ded8d37d69f4deef3b026c93f86fefb87e"}, "originalPosition": 116}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQwNzE3Nw==", "bodyText": "VoltageMeter and CurrentMeter extends Meter, that extends AnalogIO that extends NamedBean. So each meter has a system name and possible an user name. I use the method getDisplayName() to get the system name and the user name if it exists.\nSo yes, any concrete MeterManager can have any number of VoltageMeters and CurrentMeters. And all these meters are available in the MeterFrame.", "url": "https://github.com/JMRI/JMRI/pull/9033#discussion_r495407177", "createdAt": "2020-09-26T03:15:23Z", "author": {"login": "danielb987"}, "path": "java/src/jmri/jmrit/swing/meter/MeterFrame.java", "diffHunk": "@@ -0,0 +1,661 @@\n+package jmri.jmrit.swing.meter;\n+\n+import java.awt.event.*;\n+import java.beans.PropertyChangeListener;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.UUID;\n+\n+import javax.swing.*;\n+\n+import jmri.*;\n+import jmri.jmrit.catalog.NamedIcon;\n+import jmri.util.JmriJFrame;\n+\n+/**\n+ * Frame providing a simple LCD-based display of track voltage.\n+ * <p>\n+ * @author Ken Cameron        Copyright (C) 2007\n+ * @author Mark Underwood     Copyright (C) 2007\n+ * @author Andrew Crosland    Copyright (C) 2020\n+ * @author Daniel Bergqvist   Copyright (C) 2020\n+ *\n+ * Adapted from ampmeter to display voltage and current.\n+ */\n+public class MeterFrame extends JmriJFrame {\n+\n+    public enum Unit {\n+        Percent(1.0),    // Not a unit, but here anyway\n+        MicroVolt(1000*1000),\n+        MilliVolt(1000),\n+        Volt(1.0),\n+        KiloVolt(1/1000.0),\n+        MicroAmpere(1000*1000),\n+        MilliAmpere(1000),\n+        Ampere(1.0),\n+        KiloAmpere(1/1000.0);\n+        \n+        private final double multiply;\n+        \n+        private Unit(double m) { multiply = m; }\n+    }\n+    \n+    private static final int MAX_INTEGER_DIGITS = 7;\n+    private static final int MAX_DECIMAL_DIGITS = 3;\n+    \n+    private final UUID uuid;\n+    \n+    private final List<Meter> voltageMeters = new ArrayList<>();\n+    private final List<Meter> currentMeters = new ArrayList<>();\n+    \n+    // GUI member declarations\n+    private JMenuBar menuBar;\n+    ArrayList<JLabel> integerDigitIcons;\n+    ArrayList<JLabel> decimalDigitIcons;\n+    JLabel decimal;\n+    Map<Unit, JLabel> unitLabels = new HashMap<>();\n+    \n+    Map<Meter, JCheckBoxMenuItem> meter_MenuItemMap = new HashMap<>();\n+    Map<Unit, JCheckBoxMenuItem> units_MenuItemMap = new HashMap<>();\n+    Map<Integer, JCheckBoxMenuItem> integerDigits_MenuItemMap = new HashMap<>();\n+    Map<Integer, JCheckBoxMenuItem> decimalDigits_MenuItemMap = new HashMap<>();\n+    JMenuItem lastSelectedMeterMenuItem;\n+    JMenuItem lastSelectedIntegerDigitsMenuItem;\n+    JMenuItem lastSelectedDecimalDigitsMenuItem;\n+    int numIntegerDigits = 3;\n+    int numDecimalDigits = 0;\n+    int lastNumDecimalDigits = -1;\n+    int widthOfAllIconsToDisplay = 0;\n+    int oldWidthOfAllIconsToDisplay = -1;\n+    boolean frameIsInitialized = false;\n+    Unit selectedUnit = Unit.Volt;\n+    \n+    int digitIconWidth;\n+    int decimalIconWidth;\n+    int unitIconWidth;\n+    int iconHeight;\n+\n+    private PropertyChangeListener propertyChangeListener;\n+\n+    private Meter meter;\n+\n+    NamedIcon integerDigits[] = new NamedIcon[10];\n+    NamedIcon decimalDigits[] = new NamedIcon[10];\n+    NamedIcon decimalIcon;\n+    NamedIcon microVoltIcon;\n+    NamedIcon milliVoltIcon;\n+    NamedIcon voltIcon;\n+    NamedIcon kiloVoltIcon;\n+    NamedIcon microAmpIcon;\n+    NamedIcon milliAmpIcon;\n+    NamedIcon ampIcon;\n+    NamedIcon kiloAmpIcon;\n+    NamedIcon percentIcon;\n+    NamedIcon errorIcon;\n+\n+    JPanel pane1;\n+    JPanel meterPane;\n+    \n+    public MeterFrame() {\n+        this(UUID.randomUUID());\n+    }\n+    \n+    public MeterFrame(UUID uuid) {\n+        super(Bundle.getMessage(\"TrackVoltageMeterTitle\"));\n+        \n+        this.uuid = uuid;\n+        \n+        MeterManager mm = InstanceManager.getNullableDefault(MeterManager.class);\n+        if (mm == null) throw new RuntimeException(\"No meter manager exists\");\n+        \n+        for (Meter m : mm.getNamedBeanSet()) {\n+            if ((m != null) && (m instanceof VoltageMeter)) voltageMeters.add(m);\n+            if ((m != null) && (m instanceof CurrentMeter)) currentMeters.add(m);\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTM4ODIxNQ=="}, "originalCommit": {"oid": "cb4422ded8d37d69f4deef3b026c93f86fefb87e"}, "originalPosition": 116}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQxMTYxMQ==", "bodyText": "If a manager implements multiple meters of a given type, they will all have an identical title in the MeterFrame GUI?  I don't see any reference to either UserName or SystemName when generating the Title for the MeterFrame GUI.", "url": "https://github.com/JMRI/JMRI/pull/9033#discussion_r495411611", "createdAt": "2020-09-26T04:06:11Z", "author": {"login": "devel-bobm"}, "path": "java/src/jmri/jmrit/swing/meter/MeterFrame.java", "diffHunk": "@@ -0,0 +1,661 @@\n+package jmri.jmrit.swing.meter;\n+\n+import java.awt.event.*;\n+import java.beans.PropertyChangeListener;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.UUID;\n+\n+import javax.swing.*;\n+\n+import jmri.*;\n+import jmri.jmrit.catalog.NamedIcon;\n+import jmri.util.JmriJFrame;\n+\n+/**\n+ * Frame providing a simple LCD-based display of track voltage.\n+ * <p>\n+ * @author Ken Cameron        Copyright (C) 2007\n+ * @author Mark Underwood     Copyright (C) 2007\n+ * @author Andrew Crosland    Copyright (C) 2020\n+ * @author Daniel Bergqvist   Copyright (C) 2020\n+ *\n+ * Adapted from ampmeter to display voltage and current.\n+ */\n+public class MeterFrame extends JmriJFrame {\n+\n+    public enum Unit {\n+        Percent(1.0),    // Not a unit, but here anyway\n+        MicroVolt(1000*1000),\n+        MilliVolt(1000),\n+        Volt(1.0),\n+        KiloVolt(1/1000.0),\n+        MicroAmpere(1000*1000),\n+        MilliAmpere(1000),\n+        Ampere(1.0),\n+        KiloAmpere(1/1000.0);\n+        \n+        private final double multiply;\n+        \n+        private Unit(double m) { multiply = m; }\n+    }\n+    \n+    private static final int MAX_INTEGER_DIGITS = 7;\n+    private static final int MAX_DECIMAL_DIGITS = 3;\n+    \n+    private final UUID uuid;\n+    \n+    private final List<Meter> voltageMeters = new ArrayList<>();\n+    private final List<Meter> currentMeters = new ArrayList<>();\n+    \n+    // GUI member declarations\n+    private JMenuBar menuBar;\n+    ArrayList<JLabel> integerDigitIcons;\n+    ArrayList<JLabel> decimalDigitIcons;\n+    JLabel decimal;\n+    Map<Unit, JLabel> unitLabels = new HashMap<>();\n+    \n+    Map<Meter, JCheckBoxMenuItem> meter_MenuItemMap = new HashMap<>();\n+    Map<Unit, JCheckBoxMenuItem> units_MenuItemMap = new HashMap<>();\n+    Map<Integer, JCheckBoxMenuItem> integerDigits_MenuItemMap = new HashMap<>();\n+    Map<Integer, JCheckBoxMenuItem> decimalDigits_MenuItemMap = new HashMap<>();\n+    JMenuItem lastSelectedMeterMenuItem;\n+    JMenuItem lastSelectedIntegerDigitsMenuItem;\n+    JMenuItem lastSelectedDecimalDigitsMenuItem;\n+    int numIntegerDigits = 3;\n+    int numDecimalDigits = 0;\n+    int lastNumDecimalDigits = -1;\n+    int widthOfAllIconsToDisplay = 0;\n+    int oldWidthOfAllIconsToDisplay = -1;\n+    boolean frameIsInitialized = false;\n+    Unit selectedUnit = Unit.Volt;\n+    \n+    int digitIconWidth;\n+    int decimalIconWidth;\n+    int unitIconWidth;\n+    int iconHeight;\n+\n+    private PropertyChangeListener propertyChangeListener;\n+\n+    private Meter meter;\n+\n+    NamedIcon integerDigits[] = new NamedIcon[10];\n+    NamedIcon decimalDigits[] = new NamedIcon[10];\n+    NamedIcon decimalIcon;\n+    NamedIcon microVoltIcon;\n+    NamedIcon milliVoltIcon;\n+    NamedIcon voltIcon;\n+    NamedIcon kiloVoltIcon;\n+    NamedIcon microAmpIcon;\n+    NamedIcon milliAmpIcon;\n+    NamedIcon ampIcon;\n+    NamedIcon kiloAmpIcon;\n+    NamedIcon percentIcon;\n+    NamedIcon errorIcon;\n+\n+    JPanel pane1;\n+    JPanel meterPane;\n+    \n+    public MeterFrame() {\n+        this(UUID.randomUUID());\n+    }\n+    \n+    public MeterFrame(UUID uuid) {\n+        super(Bundle.getMessage(\"TrackVoltageMeterTitle\"));\n+        \n+        this.uuid = uuid;\n+        \n+        MeterManager mm = InstanceManager.getNullableDefault(MeterManager.class);\n+        if (mm == null) throw new RuntimeException(\"No meter manager exists\");\n+        \n+        for (Meter m : mm.getNamedBeanSet()) {\n+            if ((m != null) && (m instanceof VoltageMeter)) voltageMeters.add(m);\n+            if ((m != null) && (m instanceof CurrentMeter)) currentMeters.add(m);\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTM4ODIxNQ=="}, "originalCommit": {"oid": "cb4422ded8d37d69f4deef3b026c93f86fefb87e"}, "originalPosition": 116}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQxMTgyNQ==", "bodyText": "And, curiously, even without reference to UserName or SystemName, the GUI shows up with the \"system name\", such as \"LVCommandStationVoltage\".  Guess I need to look more carefully at the code!", "url": "https://github.com/JMRI/JMRI/pull/9033#discussion_r495411825", "createdAt": "2020-09-26T04:09:23Z", "author": {"login": "devel-bobm"}, "path": "java/src/jmri/jmrit/swing/meter/MeterFrame.java", "diffHunk": "@@ -0,0 +1,661 @@\n+package jmri.jmrit.swing.meter;\n+\n+import java.awt.event.*;\n+import java.beans.PropertyChangeListener;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.UUID;\n+\n+import javax.swing.*;\n+\n+import jmri.*;\n+import jmri.jmrit.catalog.NamedIcon;\n+import jmri.util.JmriJFrame;\n+\n+/**\n+ * Frame providing a simple LCD-based display of track voltage.\n+ * <p>\n+ * @author Ken Cameron        Copyright (C) 2007\n+ * @author Mark Underwood     Copyright (C) 2007\n+ * @author Andrew Crosland    Copyright (C) 2020\n+ * @author Daniel Bergqvist   Copyright (C) 2020\n+ *\n+ * Adapted from ampmeter to display voltage and current.\n+ */\n+public class MeterFrame extends JmriJFrame {\n+\n+    public enum Unit {\n+        Percent(1.0),    // Not a unit, but here anyway\n+        MicroVolt(1000*1000),\n+        MilliVolt(1000),\n+        Volt(1.0),\n+        KiloVolt(1/1000.0),\n+        MicroAmpere(1000*1000),\n+        MilliAmpere(1000),\n+        Ampere(1.0),\n+        KiloAmpere(1/1000.0);\n+        \n+        private final double multiply;\n+        \n+        private Unit(double m) { multiply = m; }\n+    }\n+    \n+    private static final int MAX_INTEGER_DIGITS = 7;\n+    private static final int MAX_DECIMAL_DIGITS = 3;\n+    \n+    private final UUID uuid;\n+    \n+    private final List<Meter> voltageMeters = new ArrayList<>();\n+    private final List<Meter> currentMeters = new ArrayList<>();\n+    \n+    // GUI member declarations\n+    private JMenuBar menuBar;\n+    ArrayList<JLabel> integerDigitIcons;\n+    ArrayList<JLabel> decimalDigitIcons;\n+    JLabel decimal;\n+    Map<Unit, JLabel> unitLabels = new HashMap<>();\n+    \n+    Map<Meter, JCheckBoxMenuItem> meter_MenuItemMap = new HashMap<>();\n+    Map<Unit, JCheckBoxMenuItem> units_MenuItemMap = new HashMap<>();\n+    Map<Integer, JCheckBoxMenuItem> integerDigits_MenuItemMap = new HashMap<>();\n+    Map<Integer, JCheckBoxMenuItem> decimalDigits_MenuItemMap = new HashMap<>();\n+    JMenuItem lastSelectedMeterMenuItem;\n+    JMenuItem lastSelectedIntegerDigitsMenuItem;\n+    JMenuItem lastSelectedDecimalDigitsMenuItem;\n+    int numIntegerDigits = 3;\n+    int numDecimalDigits = 0;\n+    int lastNumDecimalDigits = -1;\n+    int widthOfAllIconsToDisplay = 0;\n+    int oldWidthOfAllIconsToDisplay = -1;\n+    boolean frameIsInitialized = false;\n+    Unit selectedUnit = Unit.Volt;\n+    \n+    int digitIconWidth;\n+    int decimalIconWidth;\n+    int unitIconWidth;\n+    int iconHeight;\n+\n+    private PropertyChangeListener propertyChangeListener;\n+\n+    private Meter meter;\n+\n+    NamedIcon integerDigits[] = new NamedIcon[10];\n+    NamedIcon decimalDigits[] = new NamedIcon[10];\n+    NamedIcon decimalIcon;\n+    NamedIcon microVoltIcon;\n+    NamedIcon milliVoltIcon;\n+    NamedIcon voltIcon;\n+    NamedIcon kiloVoltIcon;\n+    NamedIcon microAmpIcon;\n+    NamedIcon milliAmpIcon;\n+    NamedIcon ampIcon;\n+    NamedIcon kiloAmpIcon;\n+    NamedIcon percentIcon;\n+    NamedIcon errorIcon;\n+\n+    JPanel pane1;\n+    JPanel meterPane;\n+    \n+    public MeterFrame() {\n+        this(UUID.randomUUID());\n+    }\n+    \n+    public MeterFrame(UUID uuid) {\n+        super(Bundle.getMessage(\"TrackVoltageMeterTitle\"));\n+        \n+        this.uuid = uuid;\n+        \n+        MeterManager mm = InstanceManager.getNullableDefault(MeterManager.class);\n+        if (mm == null) throw new RuntimeException(\"No meter manager exists\");\n+        \n+        for (Meter m : mm.getNamedBeanSet()) {\n+            if ((m != null) && (m instanceof VoltageMeter)) voltageMeters.add(m);\n+            if ((m != null) && (m instanceof CurrentMeter)) currentMeters.add(m);\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTM4ODIxNQ=="}, "originalCommit": {"oid": "cb4422ded8d37d69f4deef3b026c93f86fefb87e"}, "originalPosition": 116}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQxMzYxNw==", "bodyText": "The method MeterFrame.setMeter(Meter m), line 180-184:\nif (meter instanceof VoltageMeter) {\n    setTitle(Bundle.getMessage(\"VoltageMeterTitle2\", m.getDisplayName()));\n} else {\n    setTitle(Bundle.getMessage(\"CurrentMeterTitle2\", m.getDisplayName()));\n}\n\ngetDisplayName() returns a string with system name and possibly the user name, if the user name is not empty.", "url": "https://github.com/JMRI/JMRI/pull/9033#discussion_r495413617", "createdAt": "2020-09-26T04:33:24Z", "author": {"login": "danielb987"}, "path": "java/src/jmri/jmrit/swing/meter/MeterFrame.java", "diffHunk": "@@ -0,0 +1,661 @@\n+package jmri.jmrit.swing.meter;\n+\n+import java.awt.event.*;\n+import java.beans.PropertyChangeListener;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.UUID;\n+\n+import javax.swing.*;\n+\n+import jmri.*;\n+import jmri.jmrit.catalog.NamedIcon;\n+import jmri.util.JmriJFrame;\n+\n+/**\n+ * Frame providing a simple LCD-based display of track voltage.\n+ * <p>\n+ * @author Ken Cameron        Copyright (C) 2007\n+ * @author Mark Underwood     Copyright (C) 2007\n+ * @author Andrew Crosland    Copyright (C) 2020\n+ * @author Daniel Bergqvist   Copyright (C) 2020\n+ *\n+ * Adapted from ampmeter to display voltage and current.\n+ */\n+public class MeterFrame extends JmriJFrame {\n+\n+    public enum Unit {\n+        Percent(1.0),    // Not a unit, but here anyway\n+        MicroVolt(1000*1000),\n+        MilliVolt(1000),\n+        Volt(1.0),\n+        KiloVolt(1/1000.0),\n+        MicroAmpere(1000*1000),\n+        MilliAmpere(1000),\n+        Ampere(1.0),\n+        KiloAmpere(1/1000.0);\n+        \n+        private final double multiply;\n+        \n+        private Unit(double m) { multiply = m; }\n+    }\n+    \n+    private static final int MAX_INTEGER_DIGITS = 7;\n+    private static final int MAX_DECIMAL_DIGITS = 3;\n+    \n+    private final UUID uuid;\n+    \n+    private final List<Meter> voltageMeters = new ArrayList<>();\n+    private final List<Meter> currentMeters = new ArrayList<>();\n+    \n+    // GUI member declarations\n+    private JMenuBar menuBar;\n+    ArrayList<JLabel> integerDigitIcons;\n+    ArrayList<JLabel> decimalDigitIcons;\n+    JLabel decimal;\n+    Map<Unit, JLabel> unitLabels = new HashMap<>();\n+    \n+    Map<Meter, JCheckBoxMenuItem> meter_MenuItemMap = new HashMap<>();\n+    Map<Unit, JCheckBoxMenuItem> units_MenuItemMap = new HashMap<>();\n+    Map<Integer, JCheckBoxMenuItem> integerDigits_MenuItemMap = new HashMap<>();\n+    Map<Integer, JCheckBoxMenuItem> decimalDigits_MenuItemMap = new HashMap<>();\n+    JMenuItem lastSelectedMeterMenuItem;\n+    JMenuItem lastSelectedIntegerDigitsMenuItem;\n+    JMenuItem lastSelectedDecimalDigitsMenuItem;\n+    int numIntegerDigits = 3;\n+    int numDecimalDigits = 0;\n+    int lastNumDecimalDigits = -1;\n+    int widthOfAllIconsToDisplay = 0;\n+    int oldWidthOfAllIconsToDisplay = -1;\n+    boolean frameIsInitialized = false;\n+    Unit selectedUnit = Unit.Volt;\n+    \n+    int digitIconWidth;\n+    int decimalIconWidth;\n+    int unitIconWidth;\n+    int iconHeight;\n+\n+    private PropertyChangeListener propertyChangeListener;\n+\n+    private Meter meter;\n+\n+    NamedIcon integerDigits[] = new NamedIcon[10];\n+    NamedIcon decimalDigits[] = new NamedIcon[10];\n+    NamedIcon decimalIcon;\n+    NamedIcon microVoltIcon;\n+    NamedIcon milliVoltIcon;\n+    NamedIcon voltIcon;\n+    NamedIcon kiloVoltIcon;\n+    NamedIcon microAmpIcon;\n+    NamedIcon milliAmpIcon;\n+    NamedIcon ampIcon;\n+    NamedIcon kiloAmpIcon;\n+    NamedIcon percentIcon;\n+    NamedIcon errorIcon;\n+\n+    JPanel pane1;\n+    JPanel meterPane;\n+    \n+    public MeterFrame() {\n+        this(UUID.randomUUID());\n+    }\n+    \n+    public MeterFrame(UUID uuid) {\n+        super(Bundle.getMessage(\"TrackVoltageMeterTitle\"));\n+        \n+        this.uuid = uuid;\n+        \n+        MeterManager mm = InstanceManager.getNullableDefault(MeterManager.class);\n+        if (mm == null) throw new RuntimeException(\"No meter manager exists\");\n+        \n+        for (Meter m : mm.getNamedBeanSet()) {\n+            if ((m != null) && (m instanceof VoltageMeter)) voltageMeters.add(m);\n+            if ((m != null) && (m instanceof CurrentMeter)) currentMeters.add(m);\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTM4ODIxNQ=="}, "originalCommit": {"oid": "cb4422ded8d37d69f4deef3b026c93f86fefb87e"}, "originalPosition": 116}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMDYyMTI2OnYy", "diffSide": "RIGHT", "path": "java/src/jmri/jmrix/loconet/LnPredefinedMeters.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNlQwMjo0NDowM1rOHYcesA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNlQwMjo0NDowM1rOHYcesA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTM5NDQ4MA==", "bodyText": "A technical, nit-picky issue:\nIf a LocoNet has more than one of \"DCS240\", \"DCS210\" and/or \"DCS52\" (with one or more of them being configured as booster), then there will be a sequence of reports, one from each reportable device, in response to the query, all going to the same Meter object, and presumably the GUI would be rapidly updated from each source.  It is unclear to me whether this would result in a predictable sequence by device type, so it may be difficult to predict whether the reporting will actually make sense and/or come from a given device.\nUntil some specific plan is put in place for LocoNet Meters and interpretation by \"serial number\" or some other uniquely-identifying information, I would suggest a comment somewhere in help/en/html/hardware/loconet/... stating something like \"LocoNet 'Meter's may give unpredictable results when more than one device on LocoNet is capable of reporting 'Query Mode' voltage and current information.  In such a case, it is unclear exactly which device provides which 'Query Mode' data, so it is unclear exactly which device's data will be reported\".", "url": "https://github.com/JMRI/JMRI/pull/9033#discussion_r495394480", "createdAt": "2020-09-26T02:44:03Z", "author": {"login": "devel-bobm"}, "path": "java/src/jmri/jmrix/loconet/LnPredefinedMeters.java", "diffHunk": "@@ -0,0 +1,110 @@\n+package jmri.jmrix.loconet;\n+\n+import jmri.*;\n+import jmri.implementation.DefaultMeter;\n+import jmri.implementation.MeterUpdateTask;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Provide access to current and voltage meter from some LocoNet command stations\n+ *\n+ * @author Steve G           Copyright (C) 2019\n+ * @author Bob Jacobsen      Copyright (C) 2019\n+ * @author Egbert Boerse     Copyright (C) 2019\n+ * @author Daniel Bergqvist  Copyright (C) 2020\n+ */\n+public class LnPredefinedMeters implements LocoNetListener {\n+\n+    private SlotManager sm = null;\n+    private LnTrafficController tc = null;\n+    private final MeterUpdateTask updateTask;\n+    private final Meter currentMeter;\n+    private final Meter voltageMeter;\n+\n+    /**\n+     * Create a LnPredefinedMeters object\n+     *\n+     * @param scm  connection memo\n+     */\n+    public LnPredefinedMeters(LocoNetSystemConnectionMemo scm) {\n+        \n+        this.sm = scm.getSlotManager();\n+        this.tc = scm.getLnTrafficController();\n+        \n+        updateTask = new MeterUpdateTask(LnConstants.METER_INTERVAL_MS) {\n+            @Override\n+            public void requestUpdateFromLayout() {\n+                sm.sendReadSlot(249);\n+            }\n+        };\n+        \n+        currentMeter = new DefaultMeter.DefaultCurrentMeter(\n+                scm.getSystemPrefix() + \"V\" + \"CommandStationCurrent\",\n+                Meter.Unit.NoPrefix, 0, 12.7, 0.1, updateTask);\n+        \n+        voltageMeter = new DefaultMeter.DefaultVoltageMeter(\n+                scm.getSystemPrefix() + \"V\" + \"CommandStationVoltage\",\n+                Meter.Unit.NoPrefix, 0, 25.4, 0.2, updateTask);\n+        \n+        InstanceManager.getDefault(MeterManager.class).register(currentMeter);\n+        InstanceManager.getDefault(MeterManager.class).register(voltageMeter);\n+        \n+        tc.addLocoNetListener(~0, this);\n+        \n+        updateTask.initTimer();\n+    }\n+\n+    @Override\n+    public void message(LocoNetMessage msg) {\n+        try {\n+            if (msg.getOpCode() != LnConstants.OPC_EXP_RD_SL_DATA\n+                    || msg.getElement(1) != 21\n+                    || msg.getElement(2) != 1\n+                    || msg.getElement(3) != 0x79) {\n+                return;\n+            }\n+            log.debug(\"Found slot 249\");\n+            // CS Types supported\n+            switch (msg.getElement(16)) {\n+                case LnConstants.RE_IPL_DIGITRAX_HOST_DCS240:\n+                case LnConstants.RE_IPL_DIGITRAX_HOST_DCS210:\n+                case LnConstants.RE_IPL_DIGITRAX_HOST_DCS52:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb4422ded8d37d69f4deef3b026c93f86fefb87e"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMDYzNDIxOnYy", "diffSide": "RIGHT", "path": "java/src/jmri/jmrix/loconet/LnPredefinedMeters.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNlQwMjo0OTozM1rOHYcnJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNlQwMjo0OTozM1rOHYcnJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTM5NjY0Nw==", "bodyText": "An additional test might be to verify the \"serial number\" portion of the 'Query Mode' message against a known serial number from the command station.  One way to get the active command station's serial number is by a one-time 'Query Mode' request of the \"identity\" data: filter the replies for the \"active command station\" bit, and extract and save the serial number from the one marked as \"active command staiton\" for later use in qualifying the individual 'Query Mode' track voltage/current reply data.\nI expect that any such changes would be made as some future pull-request, and will not hold up this pull-request because of the technical issues mentioned in this comment.", "url": "https://github.com/JMRI/JMRI/pull/9033#discussion_r495396647", "createdAt": "2020-09-26T02:49:33Z", "author": {"login": "devel-bobm"}, "path": "java/src/jmri/jmrix/loconet/LnPredefinedMeters.java", "diffHunk": "@@ -0,0 +1,110 @@\n+package jmri.jmrix.loconet;\n+\n+import jmri.*;\n+import jmri.implementation.DefaultMeter;\n+import jmri.implementation.MeterUpdateTask;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Provide access to current and voltage meter from some LocoNet command stations\n+ *\n+ * @author Steve G           Copyright (C) 2019\n+ * @author Bob Jacobsen      Copyright (C) 2019\n+ * @author Egbert Boerse     Copyright (C) 2019\n+ * @author Daniel Bergqvist  Copyright (C) 2020\n+ */\n+public class LnPredefinedMeters implements LocoNetListener {\n+\n+    private SlotManager sm = null;\n+    private LnTrafficController tc = null;\n+    private final MeterUpdateTask updateTask;\n+    private final Meter currentMeter;\n+    private final Meter voltageMeter;\n+\n+    /**\n+     * Create a LnPredefinedMeters object\n+     *\n+     * @param scm  connection memo\n+     */\n+    public LnPredefinedMeters(LocoNetSystemConnectionMemo scm) {\n+        \n+        this.sm = scm.getSlotManager();\n+        this.tc = scm.getLnTrafficController();\n+        \n+        updateTask = new MeterUpdateTask(LnConstants.METER_INTERVAL_MS) {\n+            @Override\n+            public void requestUpdateFromLayout() {\n+                sm.sendReadSlot(249);\n+            }\n+        };\n+        \n+        currentMeter = new DefaultMeter.DefaultCurrentMeter(\n+                scm.getSystemPrefix() + \"V\" + \"CommandStationCurrent\",\n+                Meter.Unit.NoPrefix, 0, 12.7, 0.1, updateTask);\n+        \n+        voltageMeter = new DefaultMeter.DefaultVoltageMeter(\n+                scm.getSystemPrefix() + \"V\" + \"CommandStationVoltage\",\n+                Meter.Unit.NoPrefix, 0, 25.4, 0.2, updateTask);\n+        \n+        InstanceManager.getDefault(MeterManager.class).register(currentMeter);\n+        InstanceManager.getDefault(MeterManager.class).register(voltageMeter);\n+        \n+        tc.addLocoNetListener(~0, this);\n+        \n+        updateTask.initTimer();\n+    }\n+\n+    @Override\n+    public void message(LocoNetMessage msg) {\n+        try {\n+            if (msg.getOpCode() != LnConstants.OPC_EXP_RD_SL_DATA\n+                    || msg.getElement(1) != 21\n+                    || msg.getElement(2) != 1\n+                    || msg.getElement(3) != 0x79) {\n+                return;\n+            }\n+            log.debug(\"Found slot 249\");\n+            // CS Types supported\n+            switch (msg.getElement(16)) {\n+                case LnConstants.RE_IPL_DIGITRAX_HOST_DCS240:\n+                case LnConstants.RE_IPL_DIGITRAX_HOST_DCS210:\n+                case LnConstants.RE_IPL_DIGITRAX_HOST_DCS52:\n+                    log.debug(\"Found Evolution CS Amps[{}] Max[{}]\",msg.getElement(6) / 10.0f, (msg.getElement(7) / 10.0f));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb4422ded8d37d69f4deef3b026c93f86fefb87e"}, "originalPosition": 74}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMDY0NjQxOnYy", "diffSide": "RIGHT", "path": "java/src/jmri/jmrix/loconet/LocoNetSystemConnectionMemo.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNlQwMjo1NDozMlrOHYcurQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNlQwNDowMjozNVrOHYdgYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTM5ODU3Mw==", "bodyText": "This construct assumes that the connection configuration is established in a way that accurately represents the actual command station.  JMRI has never required such an accurate configuration.\nAs I commented previously, it may be useful to perform a one-time 'Query Mode' request and filter for \"active command station\" bit set, and then extract command station type and serial number, as part of the initialization.  This is an idea for a future pull-request and not something I deem important to resolve before the current pull request is merged.", "url": "https://github.com/JMRI/JMRI/pull/9033#discussion_r495398573", "createdAt": "2020-09-26T02:54:32Z", "author": {"login": "devel-bobm"}, "path": "java/src/jmri/jmrix/loconet/LocoNetSystemConnectionMemo.java", "diffHunk": "@@ -285,11 +287,27 @@ public LnLightManager getLightManager() {\n         return (LnLightManager) classObjectMap.computeIfAbsent(LightManager.class, (Class c) -> new LnLightManager(this));\n     }\n \n-    public LnMultiMeter getMultiMeter() {\n+    protected LnPredefinedMeters predefinedMeters;\n+\n+    public LnPredefinedMeters getPredefinedMeters() {\n         if (getDisabled()) {\n             return null;\n         }\n-        return (LnMultiMeter) classObjectMap.computeIfAbsent(MultiMeter.class,(Class c) -> new LnMultiMeter(this));\n+        switch (getSlotManager().commandStationType) {\n+            case COMMAND_STATION_USB_DCS240_ALONE:\n+            case COMMAND_STATION_DCS240:\n+            case COMMAND_STATION_DCS210:\n+            case COMMAND_STATION_USB_DCS52_ALONE:\n+            case COMMAND_STATION_DCS052:\n+                break;\n+            default:\n+                // The command station does not support these meters\n+                return null;\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb4422ded8d37d69f4deef3b026c93f86fefb87e"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQwODExMw==", "bodyText": "FYI: The reason for why I added this was that Z21 has two connections, one XpressNet connection and one LocoNet connection. Before I added this check, I got two voltage meters and two current meters for the Z21, but only the XpressNet voltage meter and current meter works for the Z21 as far as I know.", "url": "https://github.com/JMRI/JMRI/pull/9033#discussion_r495408113", "createdAt": "2020-09-26T03:21:52Z", "author": {"login": "danielb987"}, "path": "java/src/jmri/jmrix/loconet/LocoNetSystemConnectionMemo.java", "diffHunk": "@@ -285,11 +287,27 @@ public LnLightManager getLightManager() {\n         return (LnLightManager) classObjectMap.computeIfAbsent(LightManager.class, (Class c) -> new LnLightManager(this));\n     }\n \n-    public LnMultiMeter getMultiMeter() {\n+    protected LnPredefinedMeters predefinedMeters;\n+\n+    public LnPredefinedMeters getPredefinedMeters() {\n         if (getDisabled()) {\n             return null;\n         }\n-        return (LnMultiMeter) classObjectMap.computeIfAbsent(MultiMeter.class,(Class c) -> new LnMultiMeter(this));\n+        switch (getSlotManager().commandStationType) {\n+            case COMMAND_STATION_USB_DCS240_ALONE:\n+            case COMMAND_STATION_DCS240:\n+            case COMMAND_STATION_DCS210:\n+            case COMMAND_STATION_USB_DCS52_ALONE:\n+            case COMMAND_STATION_DCS052:\n+                break;\n+            default:\n+                // The command station does not support these meters\n+                return null;\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTM5ODU3Mw=="}, "originalCommit": {"oid": "cb4422ded8d37d69f4deef3b026c93f86fefb87e"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQxMTI3OQ==", "bodyText": "The code is entirely acceptable until you have a single LocoNet segment with more than one of DCS240, DCS210, DCS52, (and DCS210+ which has firmware which implements Query Mode voltage/current values in a different/broken way!).\nWhen more than one such device is installed on a LocoNet, the one LV bean might report the sequence of values from the different reporting devices, and it is unclear to me what order they would report in, and whether the command station is guaranteed to be the last reporter.  That will lead to unexpected results in the meter, and therefore lead to user confusion.", "url": "https://github.com/JMRI/JMRI/pull/9033#discussion_r495411279", "createdAt": "2020-09-26T04:02:13Z", "author": {"login": "devel-bobm"}, "path": "java/src/jmri/jmrix/loconet/LocoNetSystemConnectionMemo.java", "diffHunk": "@@ -285,11 +287,27 @@ public LnLightManager getLightManager() {\n         return (LnLightManager) classObjectMap.computeIfAbsent(LightManager.class, (Class c) -> new LnLightManager(this));\n     }\n \n-    public LnMultiMeter getMultiMeter() {\n+    protected LnPredefinedMeters predefinedMeters;\n+\n+    public LnPredefinedMeters getPredefinedMeters() {\n         if (getDisabled()) {\n             return null;\n         }\n-        return (LnMultiMeter) classObjectMap.computeIfAbsent(MultiMeter.class,(Class c) -> new LnMultiMeter(this));\n+        switch (getSlotManager().commandStationType) {\n+            case COMMAND_STATION_USB_DCS240_ALONE:\n+            case COMMAND_STATION_DCS240:\n+            case COMMAND_STATION_DCS210:\n+            case COMMAND_STATION_USB_DCS52_ALONE:\n+            case COMMAND_STATION_DCS052:\n+                break;\n+            default:\n+                // The command station does not support these meters\n+                return null;\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTM5ODU3Mw=="}, "originalCommit": {"oid": "cb4422ded8d37d69f4deef3b026c93f86fefb87e"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQxMTI5Ng==", "bodyText": "This is a problem to resolve at a future date...", "url": "https://github.com/JMRI/JMRI/pull/9033#discussion_r495411296", "createdAt": "2020-09-26T04:02:35Z", "author": {"login": "devel-bobm"}, "path": "java/src/jmri/jmrix/loconet/LocoNetSystemConnectionMemo.java", "diffHunk": "@@ -285,11 +287,27 @@ public LnLightManager getLightManager() {\n         return (LnLightManager) classObjectMap.computeIfAbsent(LightManager.class, (Class c) -> new LnLightManager(this));\n     }\n \n-    public LnMultiMeter getMultiMeter() {\n+    protected LnPredefinedMeters predefinedMeters;\n+\n+    public LnPredefinedMeters getPredefinedMeters() {\n         if (getDisabled()) {\n             return null;\n         }\n-        return (LnMultiMeter) classObjectMap.computeIfAbsent(MultiMeter.class,(Class c) -> new LnMultiMeter(this));\n+        switch (getSlotManager().commandStationType) {\n+            case COMMAND_STATION_USB_DCS240_ALONE:\n+            case COMMAND_STATION_DCS240:\n+            case COMMAND_STATION_DCS210:\n+            case COMMAND_STATION_USB_DCS52_ALONE:\n+            case COMMAND_STATION_DCS052:\n+                break;\n+            default:\n+                // The command station does not support these meters\n+                return null;\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTM5ODU3Mw=="}, "originalCommit": {"oid": "cb4422ded8d37d69f4deef3b026c93f86fefb87e"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMDY1MjI1OnYy", "diffSide": "RIGHT", "path": "java/src/jmri/managers/AbstractMeterManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNlQwMjo1Njo0OFrOHYcybA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNlQwMzoyNToyOFrOHYdVfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTM5OTUzMg==", "bodyText": "Is AnalogIOManager the correct class name?", "url": "https://github.com/JMRI/JMRI/pull/9033#discussion_r495399532", "createdAt": "2020-09-26T02:56:48Z", "author": {"login": "devel-bobm"}, "path": "java/src/jmri/managers/AbstractMeterManager.java", "diffHunk": "@@ -0,0 +1,62 @@\n+package jmri.managers;\n+\n+import javax.annotation.Nonnull;\n+import jmri.Manager;\n+import jmri.Meter;\n+import jmri.MeterManager;\n+import jmri.SystemConnectionMemo;\n+\n+/**\n+ * Default implementation of a MeterManager.\n+ *\n+ * @author Dave Duchamp      Copyright (C) 2004\n+ * @author Daniel Bergqvist  Copyright (C) 2020\n+ */\n+public class AbstractMeterManager extends AbstractManager<Meter>\n+        implements MeterManager {\n+\n+    /**\n+     * Create a new AnalogIOManager instance.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb4422ded8d37d69f4deef3b026c93f86fefb87e"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQwODUwOQ==", "bodyText": "No. Copy-paste error. Thanks.", "url": "https://github.com/JMRI/JMRI/pull/9033#discussion_r495408509", "createdAt": "2020-09-26T03:25:28Z", "author": {"login": "danielb987"}, "path": "java/src/jmri/managers/AbstractMeterManager.java", "diffHunk": "@@ -0,0 +1,62 @@\n+package jmri.managers;\n+\n+import javax.annotation.Nonnull;\n+import jmri.Manager;\n+import jmri.Meter;\n+import jmri.MeterManager;\n+import jmri.SystemConnectionMemo;\n+\n+/**\n+ * Default implementation of a MeterManager.\n+ *\n+ * @author Dave Duchamp      Copyright (C) 2004\n+ * @author Daniel Bergqvist  Copyright (C) 2020\n+ */\n+public class AbstractMeterManager extends AbstractManager<Meter>\n+        implements MeterManager {\n+\n+    /**\n+     * Create a new AnalogIOManager instance.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTM5OTUzMg=="}, "originalCommit": {"oid": "cb4422ded8d37d69f4deef3b026c93f86fefb87e"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4386, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}