{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1MTk4MzI4", "number": 8910, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOVQyMTowMDo0OFrOEWnKBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOVQyMTowMDo0OFrOEWnKBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMTQ1NjcxOnYy", "diffSide": "LEFT", "path": "java/src/jmri/jmrix/mqtt/MqttTurnout.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOVQyMTowMDo0OFrOG99xNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOVQyMTowMDo0OFrOG99xNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzYyODM0Mg==", "bodyText": "Noticed now that this state is removed. This is not the same as inconsistent.\nMOVING is a controlled state showing that the turnout is switching position. It should not be removed.", "url": "https://github.com/JMRI/JMRI/pull/8910#discussion_r467628342", "createdAt": "2020-08-09T21:00:48Z", "author": {"login": "elestedt"}, "path": "java/src/jmri/jmrix/mqtt/MqttTurnout.java", "diffHunk": "@@ -12,85 +12,83 @@\n public class MqttTurnout extends AbstractTurnout implements MqttEventListener {\n \n     private final MqttAdapter mqttAdapter;\n-    private final String topic;\n-    private final static String stateTopicPrefix = \"state/\";\n-    private final static String commandTopicPrefix = \"command/\";\n+    private final String sendTopic;\n+    private final String rcvTopic;\n \n     /**\n      * Requires, but does not check, that the system name and topic be consistent\n      * @param ma Adapter to reference for connection\n      * @param systemName System name of turnout\n-     * @param topic MQTT topic being used\n+     * @param sendTopicFormat MQTT topic to use when sending (full string, including systemName part)\n+     * @param sendTopicFormat MQTT topic to use when receiving (full string, including systemName part)\n      */\n-    MqttTurnout(MqttAdapter ma, String systemName, String topic) {\n+    MqttTurnout(MqttAdapter ma, String systemName, String sendTopic, String rcvTopic) {\n         super(systemName);\n-        this.topic = topic;\n+        this.sendTopic = sendTopic;\n+        this.rcvTopic  = rcvTopic;\n         mqttAdapter = ma;\n-        mqttAdapter.subscribe(getStateTopicPrefix() + topic, this);\n-        _validFeedbackNames = new String[] {\"DIRECT\", \"ONESENSOR\", \"TWOSENSOR\", \"DELAYED\", \"MONITORING\", \"EXACT\"};\n-        _validFeedbackModes = new int[] {DIRECT, ONESENSOR, TWOSENSOR, DELAYED, MONITORING, EXACT};\n+        mqttAdapter.subscribe(rcvTopic, this);  // only receive receive topic, not send one\n+        _validFeedbackNames = new String[] {\"DIRECT\", \"ONESENSOR\", \"TWOSENSOR\", \"DELAYED\", \"MONITORING\"};\n+        _validFeedbackModes = new int[] {DIRECT, ONESENSOR, TWOSENSOR, DELAYED, MONITORING};\n         _validFeedbackTypes = DIRECT | ONESENSOR | TWOSENSOR | DELAYED | MONITORING;\n     }\n \n-    private String getStateTopicPrefix() {\n-        return (getFeedbackMode() == EXACT ? stateTopicPrefix : \"\");\n-    }\n-\n-    private String getCommandTopicPrefix() {\n-        return (getFeedbackMode() == EXACT ? commandTopicPrefix : \"\");\n-    }\n-\n-    @Override\n-    public void setFeedbackMode(int mode) throws IllegalArgumentException {\n-        mqttAdapter.unsubscribe(getStateTopicPrefix() + topic, this);\n-        try {\n-            super.setFeedbackMode(mode);\n-        } finally {\n-            mqttAdapter.subscribe(getStateTopicPrefix() + topic, this);\n-        }\n-    }\n-\n     public void setParser(MqttContentParser<Turnout> parser) {\n         this.parser = parser;\n     }\n-    \n+        \n     MqttContentParser<Turnout> parser = new MqttContentParser<Turnout>() {\n         private final static String closedText = \"CLOSED\";\n         private final static String thrownText = \"THROWN\";\n         private final static String unknownText = \"UNKNOWN\";\n         private final static String inconsistentText = \"INCONSISTENT\";\n-        private final static String movingText = \"MOVING\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b00ea288644fa7698517f52166ab8f5b289cb7c4"}, "originalPosition": 62}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4453, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}