{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU2Nzk2NDIx", "number": 8869, "title": "Merge MQTT development branch", "bodyText": "This PR updates the MQTT development branch that a couple people have been using and merges it to master.  That makes it a useful base for other, later specific PRs.\n\nProvides MQTT Sensors\nAllows setting topic segments through the connection preferences\n\nIt's a merge of the mqtt_add_sensor and next_mqtt branches.", "createdAt": "2020-07-26T19:46:23Z", "url": "https://github.com/JMRI/JMRI/pull/8869", "merged": true, "mergeCommit": {"oid": "d3267a612183b92c9538b1018849056ebee32817"}, "closed": true, "closedAt": "2020-08-07T13:58:04Z", "author": {"login": "bobjacobsen"}, "timelineItems": {"totalCount": 33, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABagIqGvgH2gAyNDU2Nzk2NDIxOjg1MGJlNDk2MjVlOTg2YjZkMjJjYjk0ZjU2NTQ2OTdiMDc3YzVlZGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8egvTgH2gAyNDU2Nzk2NDIxOmExYTgwMjYyMzJkMTg5YWIxOGRkOGM1MDcyMjhmM2M1OGY2MThiMmQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "850be49625e986b6d22cb94f5654697b077c5edf", "author": {"user": {"login": "bobjacobsen", "name": "Bob Jacobsen"}}, "url": "https://github.com/JMRI/JMRI/commit/850be49625e986b6d22cb94f5654697b077c5edf", "committedDate": "2019-04-09T12:54:35Z", "message": "a bit on saving"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f4cbe1208bf5deba5bffb99a46a3855dd2e19f8", "author": {"user": {"login": "bobjacobsen", "name": "Bob Jacobsen"}}, "url": "https://github.com/JMRI/JMRI/commit/8f4cbe1208bf5deba5bffb99a46a3855dd2e19f8", "committedDate": "2019-04-09T12:55:02Z", "message": "add options, even if not really working or in order"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1631759cc6dce746b857f2545cebff55803bd45c", "author": {"user": {"login": "bobjacobsen", "name": "Bob Jacobsen"}}, "url": "https://github.com/JMRI/JMRI/commit/1631759cc6dce746b857f2545cebff55803bd45c", "committedDate": "2019-04-09T13:11:03Z", "message": "keep & display options in key-alpha order"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0fd1a3c7ec23b2ef9aee40ef3f3d07d577a29577", "author": {"user": {"login": "bobjacobsen", "name": "Bob Jacobsen"}}, "url": "https://github.com/JMRI/JMRI/commit/0fd1a3c7ec23b2ef9aee40ef3f3d07d577a29577", "committedDate": "2019-06-01T13:54:26Z", "message": "added Sensor et al, but not compile, not run, no tests, no XML"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d54d92fbbf6175233707114f16630373c04a0bfd", "author": {"user": {"login": "bobjacobsen", "name": "Bob Jacobsen"}}, "url": "https://github.com/JMRI/JMRI/commit/d54d92fbbf6175233707114f16630373c04a0bfd", "committedDate": "2020-07-26T19:07:29Z", "message": "merge to current master, fix SystemConnection-related conflicts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "360870617e5d9095421f18d17b3a1c91cfb4c815", "author": {"user": {"login": "bobjacobsen", "name": "Bob Jacobsen"}}, "url": "https://github.com/JMRI/JMRI/commit/360870617e5d9095421f18d17b3a1c91cfb4c815", "committedDate": "2020-07-26T19:34:55Z", "message": "merge next-mqtt branch and de-conflict"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0dbc87a9c11c88aff222c6ae2addae0947d178c4", "author": {"user": {"login": "bobjacobsen", "name": "Bob Jacobsen"}}, "url": "https://github.com/JMRI/JMRI/commit/0dbc87a9c11c88aff222c6ae2addae0947d178c4", "committedDate": "2020-07-26T19:35:09Z", "message": "release note"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f6d4c60ba822f5f07b0f1067f86b81db2f0d618", "author": {"user": {"login": "bobjacobsen", "name": "Bob Jacobsen"}}, "url": "https://github.com/JMRI/JMRI/commit/7f6d4c60ba822f5f07b0f1067f86b81db2f0d618", "committedDate": "2020-07-26T19:36:04Z", "message": "missed a conflict"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45151f115707e326f97b2c99babff342fcbab9dd", "author": {"user": {"login": "bobjacobsen", "name": "Bob Jacobsen"}}, "url": "https://github.com/JMRI/JMRI/commit/45151f115707e326f97b2c99babff342fcbab9dd", "committedDate": "2020-07-26T20:03:00Z", "message": "javadoc fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49369887eb893a89362c552dc906beb981f489e3", "author": {"user": {"login": "bobjacobsen", "name": "Bob Jacobsen"}}, "url": "https://github.com/JMRI/JMRI/commit/49369887eb893a89362c552dc906beb981f489e3", "committedDate": "2020-07-26T20:03:12Z", "message": "add detail to note"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edfb566e73bd81137192b5d77d979be16019e65d", "author": {"user": {"login": "bobjacobsen", "name": "Bob Jacobsen"}}, "url": "https://github.com/JMRI/JMRI/commit/edfb566e73bd81137192b5d77d979be16019e65d", "committedDate": "2020-07-26T20:59:50Z", "message": "detab"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a99bcad63b69847956e6200488550ff60ed3801", "author": {"user": {"login": "bobjacobsen", "name": "Bob Jacobsen"}}, "url": "https://github.com/JMRI/JMRI/commit/1a99bcad63b69847956e6200488550ff60ed3801", "committedDate": "2020-07-26T21:02:08Z", "message": "add bundle test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d2bbec76ee500af106a97ea04b3235717021008", "author": {"user": {"login": "bobjacobsen", "name": "Bob Jacobsen"}}, "url": "https://github.com/JMRI/JMRI/commit/1d2bbec76ee500af106a97ea04b3235717021008", "committedDate": "2020-07-28T05:30:22Z", "message": "Add MqttSensorTest; improvetestability; suppress messages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4232494e5e735cde03aad8b5c2e1e03eb9b23964", "author": {"user": {"login": "bobjacobsen", "name": "Bob Jacobsen"}}, "url": "https://github.com/JMRI/JMRI/commit/4232494e5e735cde03aad8b5c2e1e03eb9b23964", "committedDate": "2020-07-28T05:38:42Z", "message": "MqttSensorManagerTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f00db2152938024b751242b07f80b61d0a66ff3", "author": {"user": {"login": "bobjacobsen", "name": "Bob Jacobsen"}}, "url": "https://github.com/JMRI/JMRI/commit/3f00db2152938024b751242b07f80b61d0a66ff3", "committedDate": "2020-07-28T06:22:12Z", "message": "spotbugs adding to workload again"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27a491d62178befc67754b05c3021752e7c5d6ea", "author": {"user": {"login": "bobjacobsen", "name": "Bob Jacobsen"}}, "url": "https://github.com/JMRI/JMRI/commit/27a491d62178befc67754b05c3021752e7c5d6ea", "committedDate": "2020-07-29T02:45:30Z", "message": "test coverage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ac7b553181c30ded5a388f841183fddd91be354", "author": {"user": {"login": "bobjacobsen", "name": "Bob Jacobsen"}}, "url": "https://github.com/JMRI/JMRI/commit/0ac7b553181c30ded5a388f841183fddd91be354", "committedDate": "2020-08-05T15:04:46Z", "message": "Merge remote-tracking branch 'origin/master' into mqtt-dev-branch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bde23c5e18603ec1c0ea16854375b1b8315baef3", "author": {"user": {"login": "bobjacobsen", "name": "Bob Jacobsen"}}, "url": "https://github.com/JMRI/JMRI/commit/bde23c5e18603ec1c0ea16854375b1b8315baef3", "committedDate": "2020-08-06T02:38:54Z", "message": "index page update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e523b91103b09f377e203f3e4df54010cb61e49d", "author": {"user": {"login": "bobjacobsen", "name": "Bob Jacobsen"}}, "url": "https://github.com/JMRI/JMRI/commit/e523b91103b09f377e203f3e4df54010cb61e49d", "committedDate": "2020-08-06T02:39:26Z", "message": "copy option to sensor, turnout manager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee03f9d92f9e51e3469c1c04ad98f2e1b8bec6dd", "author": {"user": {"login": "bobjacobsen", "name": "Bob Jacobsen"}}, "url": "https://github.com/JMRI/JMRI/commit/ee03f9d92f9e51e3469c1c04ad98f2e1b8bec6dd", "committedDate": "2020-08-06T02:39:56Z", "message": "start of text vs jcombobox"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0205b3fbb8e32b3132a094c051ddaac5ef95e3e8", "author": {"user": {"login": "bobjacobsen", "name": "Bob Jacobsen"}}, "url": "https://github.com/JMRI/JMRI/commit/0205b3fbb8e32b3132a094c051ddaac5ef95e3e8", "committedDate": "2020-08-06T19:13:25Z", "message": "setting default option values"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3775be7962f16ffacf76ba08ce9a1935af6d9a76", "author": {"user": {"login": "bobjacobsen", "name": "Bob Jacobsen"}}, "url": "https://github.com/JMRI/JMRI/commit/3775be7962f16ffacf76ba08ce9a1935af6d9a76", "committedDate": "2020-08-06T19:13:47Z", "message": "knownState vs outState"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "754178e978c8b292b4c9ae0ccab018bdb403ace2", "author": {"user": {"login": "bobjacobsen", "name": "Bob Jacobsen"}}, "url": "https://github.com/JMRI/JMRI/commit/754178e978c8b292b4c9ae0ccab018bdb403ace2", "committedDate": "2020-08-06T19:14:29Z", "message": "text box config option"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fadea781022fb127806913030e848e4e5c36a42d", "author": {"user": {"login": "bobjacobsen", "name": "Bob Jacobsen"}}, "url": "https://github.com/JMRI/JMRI/commit/fadea781022fb127806913030e848e4e5c36a42d", "committedDate": "2020-08-06T19:14:44Z", "message": "load/store"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33dc1fd1ec079bb27b45f9d9ede161dc2cedcd8e", "author": {"user": {"login": "bobjacobsen", "name": "Bob Jacobsen"}}, "url": "https://github.com/JMRI/JMRI/commit/33dc1fd1ec079bb27b45f9d9ede161dc2cedcd8e", "committedDate": "2020-08-06T20:02:48Z", "message": "doc update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64335cdb8a18d24166067743466846ced24bfe2d", "author": {"user": {"login": "bobjacobsen", "name": "Bob Jacobsen"}}, "url": "https://github.com/JMRI/JMRI/commit/64335cdb8a18d24166067743466846ced24bfe2d", "committedDate": "2020-08-06T20:18:01Z", "message": "javadoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyODQ1Nzgy", "url": "https://github.com/JMRI/JMRI/pull/8869#pullrequestreview-462845782", "createdAt": "2020-08-06T20:17:29Z", "commit": {"oid": "33dc1fd1ec079bb27b45f9d9ede161dc2cedcd8e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMDoxNzoyOVrOG9CzLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMDoxNzozMFrOG9CzMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY2MjE4OA==", "bodyText": "Doesn't these two tests always fail? Seems like you forgot to change from turnout to sensor and the states here...", "url": "https://github.com/JMRI/JMRI/pull/8869#discussion_r466662188", "createdAt": "2020-08-06T20:17:29Z", "author": {"login": "elestedt"}, "path": "java/test/jmri/jmrix/mqtt/MqttSensorTest.java", "diffHunk": "@@ -0,0 +1,65 @@\n+package jmri.jmrix.mqtt;\n+\n+import jmri.util.*;\n+\n+import org.junit.Assert;\n+import org.junit.jupiter.api.*;\n+\n+/**\n+ *\n+ * @author Bob Jacobsen Coyright (C) 2020\n+ */\n+public class MqttSensorTest extends jmri.implementation.AbstractSensorTestBase {\n+    \n+    @Override\n+    public int numListeners() {return 0;}\n+\n+    @Override\n+    public void checkStatusRequestMsgSent() {}\n+\n+\n+    MqttAdapter a;\n+    String saveTopic;\n+    byte[] savePayload;\n+    \n+    @Override\n+    @BeforeEach\n+    public void setUp() {\n+        jmri.util.JUnitUtil.setUp();\n+        JUnitUtil.initDefaultUserMessagePreferences();\n+        // prepare an interface\n+        saveTopic = null;\n+        savePayload = null;\n+        a = new MqttAdapter(){\n+                @Override\n+                public void publish(String topic, byte[] payload) {\n+                    saveTopic = topic;\n+                    savePayload = payload;\n+                }\n+            };\n+        t = new MqttSensor(a, \"MS1\", \"track/sensor/1\");\n+        JUnitAppender.assertWarnMessage(\"Trying to subscribe before connect/configure is done\");\n+    }\n+\n+    @Override\n+    @AfterEach\n+    public void tearDown() {\n+        t.dispose();\n+        JUnitUtil.tearDown();\n+    }\n+\n+    @Override\n+    public void checkOnMsgSent() {\n+        Assert.assertEquals(\"topic\", \"track/turnout/2\", saveTopic);\n+        Assert.assertEquals(\"topic\", \"THROWN\", new String(savePayload));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33dc1fd1ec079bb27b45f9d9ede161dc2cedcd8e"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY2MjE5NQ==", "bodyText": "... and here", "url": "https://github.com/JMRI/JMRI/pull/8869#discussion_r466662195", "createdAt": "2020-08-06T20:17:30Z", "author": {"login": "elestedt"}, "path": "java/test/jmri/jmrix/mqtt/MqttSensorTest.java", "diffHunk": "@@ -0,0 +1,65 @@\n+package jmri.jmrix.mqtt;\n+\n+import jmri.util.*;\n+\n+import org.junit.Assert;\n+import org.junit.jupiter.api.*;\n+\n+/**\n+ *\n+ * @author Bob Jacobsen Coyright (C) 2020\n+ */\n+public class MqttSensorTest extends jmri.implementation.AbstractSensorTestBase {\n+    \n+    @Override\n+    public int numListeners() {return 0;}\n+\n+    @Override\n+    public void checkStatusRequestMsgSent() {}\n+\n+\n+    MqttAdapter a;\n+    String saveTopic;\n+    byte[] savePayload;\n+    \n+    @Override\n+    @BeforeEach\n+    public void setUp() {\n+        jmri.util.JUnitUtil.setUp();\n+        JUnitUtil.initDefaultUserMessagePreferences();\n+        // prepare an interface\n+        saveTopic = null;\n+        savePayload = null;\n+        a = new MqttAdapter(){\n+                @Override\n+                public void publish(String topic, byte[] payload) {\n+                    saveTopic = topic;\n+                    savePayload = payload;\n+                }\n+            };\n+        t = new MqttSensor(a, \"MS1\", \"track/sensor/1\");\n+        JUnitAppender.assertWarnMessage(\"Trying to subscribe before connect/configure is done\");\n+    }\n+\n+    @Override\n+    @AfterEach\n+    public void tearDown() {\n+        t.dispose();\n+        JUnitUtil.tearDown();\n+    }\n+\n+    @Override\n+    public void checkOnMsgSent() {\n+        Assert.assertEquals(\"topic\", \"track/turnout/2\", saveTopic);\n+        Assert.assertEquals(\"topic\", \"THROWN\", new String(savePayload));\n+    }\n+\n+    @Override\n+    public void checkOffMsgSent() {\n+        Assert.assertEquals(\"topic\", \"track/turnout/2\", saveTopic);\n+        Assert.assertEquals(\"topic\", \"CLOSED\", new String(savePayload));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33dc1fd1ec079bb27b45f9d9ede161dc2cedcd8e"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyODk5MDIy", "url": "https://github.com/JMRI/JMRI/pull/8869#pullrequestreview-462899022", "createdAt": "2020-08-06T21:47:30Z", "commit": {"oid": "64335cdb8a18d24166067743466846ced24bfe2d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08d4651b5f92105e207701cfab00dff68e83ec81", "author": {"user": {"login": "bobjacobsen", "name": "Bob Jacobsen"}}, "url": "https://github.com/JMRI/JMRI/commit/08d4651b5f92105e207701cfab00dff68e83ec81", "committedDate": "2020-08-06T21:54:38Z", "message": "add persistance"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9047f71fa47aa6170484ce99c52db70051243fff", "author": {"user": {"login": "bobjacobsen", "name": "Bob Jacobsen"}}, "url": "https://github.com/JMRI/JMRI/commit/9047f71fa47aa6170484ce99c52db70051243fff", "committedDate": "2020-08-06T21:57:30Z", "message": "sensor xml test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyOTExNTI1", "url": "https://github.com/JMRI/JMRI/pull/8869#pullrequestreview-462911525", "createdAt": "2020-08-06T22:13:17Z", "commit": {"oid": "9047f71fa47aa6170484ce99c52db70051243fff"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8decc39d3735a0d9a77bd13b5392141b00efbecd", "author": {"user": {"login": "bobjacobsen", "name": "Bob Jacobsen"}}, "url": "https://github.com/JMRI/JMRI/commit/8decc39d3735a0d9a77bd13b5392141b00efbecd", "committedDate": "2020-08-07T04:21:31Z", "message": "test default method for coverage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1a8026232d189ab18dd8c507228f3c58f618b2d", "author": {"user": {"login": "bobjacobsen", "name": "Bob Jacobsen"}}, "url": "https://github.com/JMRI/JMRI/commit/a1a8026232d189ab18dd8c507228f3c58f618b2d", "committedDate": "2020-08-07T06:34:27Z", "message": "remove default method impl OBE"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3964, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}