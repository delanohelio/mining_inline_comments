{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3NTQzMTM3", "number": 8720, "title": "Ensure STLR NamedBeans dispose of listeners", "bodyText": "Not caught by AbstractNamedBean dispose method @OverridingMethodsMustInvokeSuper .", "createdAt": "2020-06-21T13:08:54Z", "url": "https://github.com/JMRI/JMRI/pull/8720", "merged": true, "mergeCommit": {"oid": "03f59c54a4ce5fb01f1c316d77feaf5e6a95519d"}, "closed": true, "closedAt": "2020-06-23T14:27:14Z", "author": {"login": "icklesteve"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABctb2bvAH2gAyNDM3NTQzMTM3OmUyNjkxOTdkNzc5YmI1MWVhODFiNzkxMGY0YTNmNzNmYTU2NTJlNzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABctvhZ9AFqTQzNDg1MTE5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e269197d779bb51ea81b7910f4a3f73fa5652e72", "author": {"user": {"login": "icklesteve", "name": "Steve Young"}}, "url": "https://github.com/JMRI/JMRI/commit/e269197d779bb51ea81b7910f4a3f73fa5652e72", "committedDate": "2020-06-21T12:59:34Z", "message": "Ensure Reporters dispose of listeners"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "705135ad468354d8e3f64abc9d2dfb37099478ea", "author": {"user": {"login": "icklesteve", "name": "Steve Young"}}, "url": "https://github.com/JMRI/JMRI/commit/705135ad468354d8e3f64abc9d2dfb37099478ea", "committedDate": "2020-06-21T13:05:54Z", "message": "Update RpsReporter.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NTA2NDc0", "url": "https://github.com/JMRI/JMRI/pull/8720#pullrequestreview-434506474", "createdAt": "2020-06-21T14:33:06Z", "commit": {"oid": "705135ad468354d8e3f64abc9d2dfb37099478ea"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMVQxNDozMzowNlrOGmsVjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMVQxNDozMzowNlrOGmsVjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIyNTQ4NQ==", "bodyText": "The expected behavior of NamedBean.dispose() is that the NamedBean is no longer valid after the dispose call.\nWhat this means is that when the call to get the number of property change listeners is made after the call to dispose a numeric result is not the only valid outcome.\nAn exception may occur and, as a developer, I would anticipate this occurring based on the Javadoc.", "url": "https://github.com/JMRI/JMRI/pull/8720#discussion_r443225485", "createdAt": "2020-06-21T14:33:06Z", "author": {"login": "pabender"}, "path": "java/test/jmri/implementation/AbstractReporterTestBase.java", "diffHunk": "@@ -78,6 +78,14 @@ public void testPropertyChange() {\n         // Check that LastReport was not seen (no change on null)\n         Assert.assertFalse(\"LastReport seen after null\", lastReportSeen);\n     }\n+    \n+    @Test\n+    public void testDispose() {\n+        r.addPropertyChangeListener(new TestReporterListener());\n+        Assert.assertEquals(\"controller listener added\", 1, r.getNumPropertyChangeListeners());\n+        r.dispose();\n+        Assert.assertEquals(\"controller listeners remaining\", 0, r.getNumPropertyChangeListeners());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "705135ad468354d8e3f64abc9d2dfb37099478ea"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43185bb5d146e43270821e78d2b62ea4f73ccc95", "author": {"user": {"login": "icklesteve", "name": "Steve Young"}}, "url": "https://github.com/JMRI/JMRI/commit/43185bb5d146e43270821e78d2b62ea4f73ccc95", "committedDate": "2020-06-21T15:19:04Z", "message": "Update AbstractReporterTestBase.java\n\nAdd test for 0 listeners on creation.\nEnsure listeners less than 1, ie 0 or -1"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NTIyNjk2", "url": "https://github.com/JMRI/JMRI/pull/8720#pullrequestreview-434522696", "createdAt": "2020-06-21T18:30:29Z", "commit": {"oid": "43185bb5d146e43270821e78d2b62ea4f73ccc95"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NTI0NDky", "url": "https://github.com/JMRI/JMRI/pull/8720#pullrequestreview-434524492", "createdAt": "2020-06-21T18:58:41Z", "commit": {"oid": "43185bb5d146e43270821e78d2b62ea4f73ccc95"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMVQxODo1ODo0MlrOGmtqGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMVQxODo1ODo0MlrOGmtqGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0NzEyOA==", "bodyText": "This is still making a call to the object after the dispose call.", "url": "https://github.com/JMRI/JMRI/pull/8720#discussion_r443247128", "createdAt": "2020-06-21T18:58:42Z", "author": {"login": "pabender"}, "path": "java/test/jmri/implementation/AbstractReporterTestBase.java", "diffHunk": "@@ -78,6 +78,15 @@ public void testPropertyChange() {\n         // Check that LastReport was not seen (no change on null)\n         Assert.assertFalse(\"LastReport seen after null\", lastReportSeen);\n     }\n+    \n+    @Test\n+    public void testDispose() {\n+        Assert.assertEquals(\"starts 0 listeners\", 0, r.getNumPropertyChangeListeners());\n+        r.addPropertyChangeListener(new TestReporterListener());\n+        Assert.assertEquals(\"controller listener added\", 1, r.getNumPropertyChangeListeners());\n+        r.dispose();\n+        Assert.assertTrue(\"controller listeners remaining < 1\", r.getNumPropertyChangeListeners() < 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43185bb5d146e43270821e78d2b62ea4f73ccc95"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f2e3ecdce5fa8c638a5c4e4699dd7a061dcc8e1", "author": {"user": {"login": "icklesteve", "name": "Steve Young"}}, "url": "https://github.com/JMRI/JMRI/commit/5f2e3ecdce5fa8c638a5c4e4699dd7a061dcc8e1", "committedDate": "2020-06-22T01:56:41Z", "message": "reporter tests add exception condition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "723b0b02c7d9b14f5be2741ec05505a9e7c31314", "author": {"user": {"login": "icklesteve", "name": "Steve Young"}}, "url": "https://github.com/JMRI/JMRI/commit/723b0b02c7d9b14f5be2741ec05505a9e7c31314", "committedDate": "2020-06-22T01:57:24Z", "message": "add sensor turnout light tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5578afe7c29d6123e582e3a7e71baf7e5e7ac1ba", "author": {"user": {"login": "icklesteve", "name": "Steve Young"}}, "url": "https://github.com/JMRI/JMRI/commit/5578afe7c29d6123e582e3a7e71baf7e5e7ac1ba", "committedDate": "2020-06-22T01:58:13Z", "message": "add missing super disposes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NjE0NDYw", "url": "https://github.com/JMRI/JMRI/pull/8720#pullrequestreview-434614460", "createdAt": "2020-06-22T05:37:17Z", "commit": {"oid": "5578afe7c29d6123e582e3a7e71baf7e5e7ac1ba"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwNTozNzoxN1rOGmyeRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwNTozODoyMVrOGmyfUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzMyNjAyMw==", "bodyText": "This needs to specifically be a RuntimeException and not just an Exception.", "url": "https://github.com/JMRI/JMRI/pull/8720#discussion_r443326023", "createdAt": "2020-06-22T05:37:17Z", "author": {"login": "pabender"}, "path": "java/test/jmri/implementation/AbstractLightTestBase.java", "diffHunk": "@@ -75,6 +75,20 @@ public void testDispose() {\n         t.dispose();\n         Assert.assertEquals(\"controller listeners remaining\", 0, numListeners());\n     }\n+    \n+    @Test\n+    public void testRemoveListenerOnDispose() {\n+        Assert.assertEquals(\"starts 0 listeners\", 0, t.getNumPropertyChangeListeners());\n+        t.addPropertyChangeListener(new Listen());\n+        Assert.assertEquals(\"controller listener added\", 1, t.getNumPropertyChangeListeners());\n+        t.dispose();\n+        try {\n+            Assert.assertTrue(\"controller listeners remaining < 1\", t.getNumPropertyChangeListeners() < 1);\n+        }\n+        catch ( Exception e){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5578afe7c29d6123e582e3a7e71baf7e5e7ac1ba"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzMyNjE2Mg==", "bodyText": "This needs to specifically be a RuntimeException and not just an Exception.", "url": "https://github.com/JMRI/JMRI/pull/8720#discussion_r443326162", "createdAt": "2020-06-22T05:37:48Z", "author": {"login": "pabender"}, "path": "java/test/jmri/implementation/AbstractReporterTestBase.java", "diffHunk": "@@ -80,12 +80,17 @@ public void testPropertyChange() {\n     }\n     \n     @Test\n-    public void testDispose() {\n+    public void testAddRemoveListener() {\n         Assert.assertEquals(\"starts 0 listeners\", 0, r.getNumPropertyChangeListeners());\n         r.addPropertyChangeListener(new TestReporterListener());\n         Assert.assertEquals(\"controller listener added\", 1, r.getNumPropertyChangeListeners());\n         r.dispose();\n-        Assert.assertTrue(\"controller listeners remaining < 1\", r.getNumPropertyChangeListeners() < 1);\n+        try {\n+            Assert.assertTrue(\"controller listeners remaining < 1\", r.getNumPropertyChangeListeners() < 1);\n+        }\n+        catch ( Exception e){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5578afe7c29d6123e582e3a7e71baf7e5e7ac1ba"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzMyNjIzOQ==", "bodyText": "This needs to specifically be a RuntimeException and not just an Exception.", "url": "https://github.com/JMRI/JMRI/pull/8720#discussion_r443326239", "createdAt": "2020-06-22T05:38:06Z", "author": {"login": "pabender"}, "path": "java/test/jmri/implementation/AbstractSensorTestBase.java", "diffHunk": "@@ -83,6 +83,20 @@ public void testDispose() throws JmriException {\n         t.dispose();\n         Assert.assertEquals(\"controller listeners remaining\", 0, numListeners());\n     }\n+    \n+    @Test\n+    public void testRemoveListenerOnDispose() {\n+        Assert.assertEquals(\"starts 0 listeners\", 0, t.getNumPropertyChangeListeners());\n+        t.addPropertyChangeListener(new Listen());\n+        Assert.assertEquals(\"controller listener added\", 1, t.getNumPropertyChangeListeners());\n+        t.dispose();\n+        try {\n+            Assert.assertTrue(\"controller listeners remaining < 1\", t.getNumPropertyChangeListeners() < 1);\n+        }\n+        catch ( Exception e){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5578afe7c29d6123e582e3a7e71baf7e5e7ac1ba"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzMyNjI4OQ==", "bodyText": "This needs to specifically be a RuntimeException and not just an Exception.", "url": "https://github.com/JMRI/JMRI/pull/8720#discussion_r443326289", "createdAt": "2020-06-22T05:38:21Z", "author": {"login": "pabender"}, "path": "java/test/jmri/implementation/AbstractTurnoutTestBase.java", "diffHunk": "@@ -100,6 +100,20 @@ public void testDispose() {\n         t.dispose();\n         Assert.assertEquals(\"controller listeners remaining\", 0, numListeners());\n     }\n+    \n+    @Test\n+    public void testRemoveListenerOnDispose() {\n+        int startListeners =  t.getNumPropertyChangeListeners();\n+        t.addPropertyChangeListener(new Listen());\n+        Assert.assertEquals(\"controller listener added\", startListeners+1, t.getNumPropertyChangeListeners());\n+        t.dispose();\n+        try {\n+            Assert.assertTrue(\"controller listeners remaining < 1\", t.getNumPropertyChangeListeners() < 1);\n+        }\n+        catch ( Exception e){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5578afe7c29d6123e582e3a7e71baf7e5e7ac1ba"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26ebc8f5fffeb857e4abb6f6dd3fbed416686c0a", "author": {"user": {"login": "icklesteve", "name": "Steve Young"}}, "url": "https://github.com/JMRI/JMRI/commit/26ebc8f5fffeb857e4abb6f6dd3fbed416686c0a", "committedDate": "2020-06-22T11:03:07Z", "message": "move Exception to RuntimeException"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0ODUxMTkx", "url": "https://github.com/JMRI/JMRI/pull/8720#pullrequestreview-434851191", "createdAt": "2020-06-22T11:54:42Z", "commit": {"oid": "26ebc8f5fffeb857e4abb6f6dd3fbed416686c0a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4060, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}