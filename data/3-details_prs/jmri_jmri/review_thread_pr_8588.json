{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyODE0NjI1", "number": 8588, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxODo1MzoyMlrOD_c_IA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxODo1MzoyMlrOD_c_IA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3ODYxNzkyOnYy", "diffSide": "RIGHT", "path": "java/src/apps/configurexml/PerformActionModelXml.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxODo1MzoyMlrOGaIAIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxODo1MzoyMlrOGaIAIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA0NzI2Ng==", "bodyText": "Would it make sense to log (at WARN? INFO?) this occurrence so that people trying to solve a downstream problem (i.e. should the Manager not handle it; I'm not sure they will absent tests) get a hit to look back to hear?  (2 places)", "url": "https://github.com/JMRI/JMRI/pull/8588#discussion_r430047266", "createdAt": "2020-05-25T18:53:22Z", "author": {"login": "bobjacobsen"}, "path": "java/src/apps/configurexml/PerformActionModelXml.java", "diffHunk": "@@ -57,12 +63,36 @@ public boolean load(Element shared, Element perNode) {\n         String className = shared.getAttribute(\"name\").getValue();\n         PerformActionModel model = new PerformActionModel();\n         model.setClassName(className);\n-        for (Element child : shared.getChildren(\"property\")) { // NOI18N\n+        shared.getChildren(\"property\").forEach(child -> { // NOI18N\n+            String value = child.getAttributeValue(\"value\"); // NOI18N\n             if (child.getAttributeValue(\"name\").equals(\"systemPrefix\") // NOI18N\n-                    && child.getAttributeValue(\"value\") != null) { // NOI18N\n-                model.setSystemPrefix(child.getAttributeValue(\"value\")); // NOI18N\n+                    && value != null) {\n+                // handle the situation where the model expects a system prefix\n+                // but was not saved with one in a pre-4.19.7 JMRI instance\n+                // TODO: at some point (June 2022 release?) change entire\n+                // try/catch block to just \"model.setSystemPrefix(value);\"\n+                try {\n+                    Class<?> ac = Class.forName(className);\n+                    if (value.isEmpty() && SystemConnectionAction.class.isAssignableFrom(ac)) {\n+                        SystemConnectionAction<?> a = (SystemConnectionAction<?>) ac.getConstructor().newInstance();\n+                        InstanceManager.getList(SystemConnectionMemo.class)\n+                                .forEach(memo -> a.getSystemConnectionMemoClasses().stream()\n+                                .filter(mc -> memo.getClass().isAssignableFrom(mc))\n+                                .forEach(mc -> model.setSystemPrefix(memo.getSystemPrefix())));\n+                    } else {\n+                        model.setSystemPrefix(value);\n+                    }\n+                } catch (ClassNotFoundException\n+                        | InstantiationException\n+                        | IllegalAccessException\n+                        | IllegalArgumentException\n+                        | InvocationTargetException\n+                        | NoSuchMethodException\n+                        | SecurityException ex) {\n+                    // ignore to allow manager to handle later", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5358f8ae2d7186ddde14ebd66bb739b7e075ef71"}, "originalPosition": 62}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4574, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}