{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDExODg2MzI1", "number": 8464, "title": "Fixes running test, if CoS is enabled. Fixes Apply Changes in Debugger.", "bodyText": "Core ideas:\nDisable jacoco:prepare-agent in debug-test mode; fixes \"Apply changes\" feature. Done by a profile that disables on maven.surefire.debug property.\nCircumvent supposed NetBeans IDE bug with compile-on save: instead of adding goals to an action, the IDE defines a property that activates a Profile. That profile then binds the goal into the appropriate phase (test) executed by the IDE. The effect will be the same as if the explicit action was given.\nManually running mvn test only reaches test phase, while the merge was bound to generate-resources phase (too early, no tests were run), and post-integration-test is never reached with test goal. The fix is to bind jacoco:merge to the test phase -- since Maven 3.0.3, the order of plugins in POM should dictate the order of their goals contributed to a particular phase. So being in test textually later than Surefire, will run after tests are executed.\nI would be grateful if someone tests this on his IDE/setup; there's a nonzero chance it works just in my local environment because of some forgotten setting/file (or similar human error).", "createdAt": "2020-04-30T23:08:59Z", "url": "https://github.com/JMRI/JMRI/pull/8464", "merged": true, "mergeCommit": {"oid": "f367d9db3a5eb1e4514d8ac473b6a9b22471c70d"}, "closed": true, "closedAt": "2020-05-06T00:44:16Z", "author": {"login": "svatoun"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcc12HFAFqTQwMzk0NjQ5NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcdwW8BgFqTQwNDY1MTUyOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzOTQ2NDk1", "url": "https://github.com/JMRI/JMRI/pull/8464#pullrequestreview-403946495", "createdAt": "2020-04-30T23:35:12Z", "commit": {"oid": "2b05b300b57499c6f76d40273516594323008673"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQyMzozNToxMlrOGO94DQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQyMzozODoxMVrOGO97lA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM0NzAyMQ==", "bodyText": "The configuration that follows the lines you are removing here is configuration for the goal in question.  I don't think this works in general.", "url": "https://github.com/JMRI/JMRI/pull/8464#discussion_r418347021", "createdAt": "2020-04-30T23:35:12Z", "author": {"login": "pabender"}, "path": "pom.xml", "diffHunk": "@@ -662,15 +760,15 @@\n                 </configuration>\n             </plugin>\n             <plugin>\n+                <!-- Warning: do not put this plugin's configuration before surefire plugin one. The sequence\n+                     in which the surefire and jacoco goals run is important -->\n                 <groupId>org.jacoco</groupId>\n                 <artifactId>jacoco-maven-plugin</artifactId>\n                 <version>${jacoco.version}</version>\n                 <executions>\n                     <execution>\n                         <id>prepare-agent</id>\n-                        <goals>\n-                            <goal>prepare-agent</goal>\n-                        </goals>\n+                        <!-- Do not bind any goals, let a profile to do it conditionally -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b05b300b57499c6f76d40273516594323008673"}, "originalPosition": 120}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM0NzIwNw==", "bodyText": "again, this is configuration for the specific goal in the specific context", "url": "https://github.com/JMRI/JMRI/pull/8464#discussion_r418347207", "createdAt": "2020-04-30T23:35:50Z", "author": {"login": "pabender"}, "path": "pom.xml", "diffHunk": "@@ -679,9 +777,7 @@\n                     </execution>\n                     <execution>\n                         <id>prepare-agent-integration</id>\n-                        <goals>\n-                            <goal>prepare-agent</goal>\n-                        </goals>\n+                        <!-- Do not bind any goals, let a profile to do it conditionally -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b05b300b57499c6f76d40273516594323008673"}, "originalPosition": 131}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM0NzkyNA==", "bodyText": "This may be ok, but it may also cause duplicate processing of data in the test report.  The merging needs to take place after ALL tests complete.\nAdding the command line configuration does something different.  It allows you to run the jacoco:merge goal from the command line and have it work as expected.  It needs to stay in place.", "url": "https://github.com/JMRI/JMRI/pull/8464#discussion_r418347924", "createdAt": "2020-04-30T23:38:11Z", "author": {"login": "pabender"}, "path": "pom.xml", "diffHunk": "@@ -706,7 +802,12 @@\n                         </configuration>\n                     </execution>\n                     <execution>\n-                        <id>default-cli</id>\n+                        <!-- Do a merge after unit tests complete, to cover the case that only goals up to 'test' phase", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b05b300b57499c6f76d40273516594323008673"}, "originalPosition": 140}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MTM2MTc0", "url": "https://github.com/JMRI/JMRI/pull/8464#pullrequestreview-404136174", "createdAt": "2020-05-01T12:28:45Z", "commit": {"oid": "d7816a6552bd95c95cf4fcffc56ff7d49101019d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxMjoyODo0NVrOGPIhHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxMjoyODo0NVrOGPIhHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODUyMTM3NA==", "bodyText": "Please restore the previous fileset.", "url": "https://github.com/JMRI/JMRI/pull/8464#discussion_r418521374", "createdAt": "2020-05-01T12:28:45Z", "author": {"login": "pabender"}, "path": "pom.xml", "diffHunk": "@@ -795,7 +795,8 @@\n                                 <fileSet>\n                                     <directory>${jacoco.reportDir}</directory>\n                                     <includes>\n-                                        <File>**/*.exec</File>\n+                                        <File>**/jacoco.exec</File>\n+                                        <File>**/*-it.exec</File>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7816a6552bd95c95cf4fcffc56ff7d49101019d"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MTM2MjY2", "url": "https://github.com/JMRI/JMRI/pull/8464#pullrequestreview-404136266", "createdAt": "2020-05-01T12:29:03Z", "commit": {"oid": "d7816a6552bd95c95cf4fcffc56ff7d49101019d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxMjoyOTowM1rOGPIhZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxMjoyOTowM1rOGPIhZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODUyMTQ0NQ==", "bodyText": "Please restore the previous fileset", "url": "https://github.com/JMRI/JMRI/pull/8464#discussion_r418521445", "createdAt": "2020-05-01T12:29:03Z", "author": {"login": "pabender"}, "path": "pom.xml", "diffHunk": "@@ -816,7 +817,8 @@\n                                 <fileSet>\n                                     <directory>${jacoco.reportDir}</directory>\n                                     <includes>\n-                                        <File>**/*.exec</File>\n+                                        <File>**/jacoco.exec</File>\n+                                        <File>**/*-unit.exec</File>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7816a6552bd95c95cf4fcffc56ff7d49101019d"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MTUyNTAx", "url": "https://github.com/JMRI/JMRI/pull/8464#pullrequestreview-404152501", "createdAt": "2020-05-01T13:14:52Z", "commit": {"oid": "d7816a6552bd95c95cf4fcffc56ff7d49101019d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d7816a6552bd95c95cf4fcffc56ff7d49101019d", "author": {"user": {"login": "svatoun", "name": "Svata Dedic"}}, "url": "https://github.com/JMRI/JMRI/commit/d7816a6552bd95c95cf4fcffc56ff7d49101019d", "committedDate": "2020-05-01T09:18:43Z", "message": "Refine merging patterns for Jacoco."}, "afterCommit": {"oid": "2b05b300b57499c6f76d40273516594323008673", "author": {"user": {"login": "svatoun", "name": "Svata Dedic"}}, "url": "https://github.com/JMRI/JMRI/commit/2b05b300b57499c6f76d40273516594323008673", "committedDate": "2020-04-30T22:00:23Z", "message": "Fixes running test, if CoS is enabled. Fixes Apply Changes in Debugger."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54d947df3760a73e03e1800c932e86a021a2d642", "author": {"user": {"login": "svatoun", "name": "Svata Dedic"}}, "url": "https://github.com/JMRI/JMRI/commit/54d947df3760a73e03e1800c932e86a021a2d642", "committedDate": "2020-05-03T17:47:59Z", "message": "Fixes running test, if CoS is enabled. Fixes Apply Changes in Debugger."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2b05b300b57499c6f76d40273516594323008673", "author": {"user": {"login": "svatoun", "name": "Svata Dedic"}}, "url": "https://github.com/JMRI/JMRI/commit/2b05b300b57499c6f76d40273516594323008673", "committedDate": "2020-04-30T22:00:23Z", "message": "Fixes running test, if CoS is enabled. Fixes Apply Changes in Debugger."}, "afterCommit": {"oid": "54d947df3760a73e03e1800c932e86a021a2d642", "author": {"user": {"login": "svatoun", "name": "Svata Dedic"}}, "url": "https://github.com/JMRI/JMRI/commit/54d947df3760a73e03e1800c932e86a021a2d642", "committedDate": "2020-05-03T17:47:59Z", "message": "Fixes running test, if CoS is enabled. Fixes Apply Changes in Debugger."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NjUxNTI5", "url": "https://github.com/JMRI/JMRI/pull/8464#pullrequestreview-404651529", "createdAt": "2020-05-03T19:50:23Z", "commit": {"oid": "54d947df3760a73e03e1800c932e86a021a2d642"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4107, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}