{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUyNTczODQ0", "number": 8850, "title": "Test fixes", "bodyText": "This is a collection of corrections to tests.\nIt includes:\nsome removal of apps references from jmri tests\nsome bug fixes for tests (mostly fixing threading issues)\nsome conversion (or finalizing conversion) to JUnit5", "createdAt": "2020-07-19T13:48:50Z", "url": "https://github.com/JMRI/JMRI/pull/8850", "merged": true, "mergeCommit": {"oid": "770d0103200beab9d4885780fc03d68d3329bf06"}, "closed": true, "closedAt": "2020-08-05T03:20:26Z", "author": {"login": "pabender"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc0kuLfAH2gAyNDUyNTczODQ0OjRlMjM2ZWE5Mzg4Mzg3ODQ5ZjdhNWI1MTgyMDkzODQwMjBiNDI0Mjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7e2qGAFqTQ2MDQ4NjMyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4e236ea9388387849f7a5b518209384020b42428", "author": {"user": {"login": "pabender", "name": "Paul Bender"}}, "url": "https://github.com/JMRI/JMRI/commit/4e236ea9388387849f7a5b518209384020b42428", "committedDate": "2020-07-13T17:17:10Z", "message": "remove unnecessary reference to apps"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34a4d8d1d1d767c5ccbbc86bf5a4814361873537", "author": {"user": {"login": "pabender", "name": "Paul Bender"}}, "url": "https://github.com/JMRI/JMRI/commit/34a4d8d1d1d767c5ccbbc86bf5a4814361873537", "committedDate": "2020-07-13T21:58:26Z", "message": "remove apps references from JUnitUtil"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74fc5ae45db6539b16f027c02817a0edd98b85b1", "author": {"user": {"login": "pabender", "name": "Paul Bender"}}, "url": "https://github.com/JMRI/JMRI/commit/74fc5ae45db6539b16f027c02817a0edd98b85b1", "committedDate": "2020-07-13T22:42:56Z", "message": "use the right logger"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba5ff9dda9c52dfbe8718c9969d1df1989e11edd", "author": {"user": {"login": "pabender", "name": "Paul Bender"}}, "url": "https://github.com/JMRI/JMRI/commit/ba5ff9dda9c52dfbe8718c9969d1df1989e11edd", "committedDate": "2020-07-14T01:00:47Z", "message": "Merge branch 'master' of https://github.com/JMRI/JMRI into TestFixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d66d372e096ef4cd51ebf8cfec7e0858848aa25a", "author": {"user": {"login": "pabender", "name": "Paul Bender"}}, "url": "https://github.com/JMRI/JMRI/commit/d66d372e096ef4cd51ebf8cfec7e0858848aa25a", "committedDate": "2020-07-17T19:04:30Z", "message": "Merge branch 'master' of https://github.com/JMRI/JMRI into TestFixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "427c2092db59ec40d0a8a4f74bf15bfb758a0877", "author": {"user": {"login": "pabender", "name": "Paul Bender"}}, "url": "https://github.com/JMRI/JMRI/commit/427c2092db59ec40d0a8a4f74bf15bfb758a0877", "committedDate": "2020-07-17T22:42:27Z", "message": "linting;fix bitwise operation bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f6e24055c862abf6bbf6d9c590ef907873eceaa", "author": {"user": {"login": "pabender", "name": "Paul Bender"}}, "url": "https://github.com/JMRI/JMRI/commit/8f6e24055c862abf6bbf6d9c590ef907873eceaa", "committedDate": "2020-07-18T00:49:49Z", "message": "test linting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "619428684fa3b8157af61dc046f5b01790ea3be0", "author": {"user": {"login": "pabender", "name": "Paul Bender"}}, "url": "https://github.com/JMRI/JMRI/commit/619428684fa3b8157af61dc046f5b01790ea3be0", "committedDate": "2020-07-18T05:38:02Z", "message": "check for logging init by looking for appenders."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5c61750324a49aa035ee13124bb2de5c6e060ad", "author": {"user": {"login": "pabender", "name": "Paul Bender"}}, "url": "https://github.com/JMRI/JMRI/commit/f5c61750324a49aa035ee13124bb2de5c6e060ad", "committedDate": "2020-07-18T12:23:45Z", "message": "test linting; and some tolelrance for window positioning"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "701d4c169e4a90c76c0055b73ac8be9ab4aed4d1", "author": {"user": {"login": "pabender", "name": "Paul Bender"}}, "url": "https://github.com/JMRI/JMRI/commit/701d4c169e4a90c76c0055b73ac8be9ab4aed4d1", "committedDate": "2020-07-18T14:50:42Z", "message": "remove unused variable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39ea430637a4081a2ab2fa1940d73c555d972124", "author": {"user": {"login": "pabender", "name": "Paul Bender"}}, "url": "https://github.com/JMRI/JMRI/commit/39ea430637a4081a2ab2fa1940d73c555d972124", "committedDate": "2020-07-18T19:06:15Z", "message": "test linting; use disable instead of assume"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5ad4a68b8bab855f1ba8dbcea079aabf946b849", "author": {"user": {"login": "pabender", "name": "Paul Bender"}}, "url": "https://github.com/JMRI/JMRI/commit/b5ad4a68b8bab855f1ba8dbcea079aabf946b849", "committedDate": "2020-07-19T01:58:09Z", "message": "linting; one graphics disable per file (for file of all graphical tests)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c22476c864ef991d7d19d03494b5d735cc200a46", "author": {"user": {"login": "pabender", "name": "Paul Bender"}}, "url": "https://github.com/JMRI/JMRI/commit/c22476c864ef991d7d19d03494b5d735cc200a46", "committedDate": "2020-07-19T02:56:16Z", "message": "include Disable intermittent annotation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMTM0MDQ1", "url": "https://github.com/JMRI/JMRI/pull/8850#pullrequestreview-451134045", "createdAt": "2020-07-19T13:56:39Z", "commit": {"oid": "c22476c864ef991d7d19d03494b5d735cc200a46"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQxMzo1NjozOVrOGzvsgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQxMzo1NjozOVrOGzvsgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkxMjAwMw==", "bodyText": "Why a new class and not adding logging initialization to jmri.util.JUnitLoggingUtil? (its likely going to be confusing having JUnitLoggingUtil and LoggingTestUtil)", "url": "https://github.com/JMRI/JMRI/pull/8850#discussion_r456912003", "createdAt": "2020-07-19T13:56:39Z", "author": {"login": "rhwood"}, "path": "java/test/jmri/util/LoggingTestUtil.java", "diffHunk": "@@ -0,0 +1,151 @@\n+package jmri.util;\n+\n+import java.io.*;\n+import java.nio.file.Files;\n+import java.util.*;\n+\n+import javax.annotation.Nonnull;\n+\n+import jmri.util.exceptionhandler.UncaughtExceptionHandler;\n+\n+import org.apache.log4j.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Common utility methods for working with Log4J in tests.\n+ * <p>\n+ * Two system properties influence how logging is configured in JMRI:\n+ * <dl>\n+ * <dt>jmri.log</dt><dd>The logging control file. If this file is not an\n+ * absolute path, this file is searched for in the following order:<ol>\n+ * <li>JMRI settings directory</li>\n+ * <li>JMRI installation (program) directory</li>\n+ * </ol>\n+ * If this property is not specified, the logging control file\n+ * <i>default.lcf</i> is used, following the above search order to find it.\n+ * </dd>\n+ * <dt>jmri.log.path</dt><dd>The directory for storing logs. If not specified,\n+ * logs are stored in the JMRI preferences directory.</dd>\n+ * </dl>\n+ *\n+ * @author Bob Jacobsen Copyright 2009, 2010\n+ * @author Randall Wood Copyright 2014, 2020\n+ */\n+public class LoggingTestUtil {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c22476c864ef991d7d19d03494b5d735cc200a46"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMTM5NzQw", "url": "https://github.com/JMRI/JMRI/pull/8850#pullrequestreview-451139740", "createdAt": "2020-07-19T15:05:24Z", "commit": {"oid": "c22476c864ef991d7d19d03494b5d735cc200a46"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQxNTowNToyNVrOGzwKLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQxNTowNToyNVrOGzwKLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkxOTU5Nw==", "bodyText": "I just wanted to point out the subtle bug in this line.\nThe & happens before the |, so the result of the & doesn\u2019t matter because the | with a constant always makes the value nonzero.\nThe solution is to put the | in parentheses. I moved that line to the oBlockOccupiedOrAllocated method.", "url": "https://github.com/JMRI/JMRI/pull/8850#discussion_r456919597", "createdAt": "2020-07-19T15:05:25Z", "author": {"login": "pabender"}, "path": "java/test/jmri/jmrit/logix/LearnWarrantTest.java", "diffHunk": "@@ -96,24 +84,18 @@ public void testLearnWarrant() throws Exception {\n         Sensor sensor = block0.getSensor();\n         NXFrameTest.setAndConfirmSensorAction(sensor, Sensor.ACTIVE, block0);\n \n-        JUnitUtil.waitFor(() -> {\n-            return  (block0.getState() & OBlock.ALLOCATED | OBlock.OCCUPIED) != 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c22476c864ef991d7d19d03494b5d735cc200a46"}, "originalPosition": 74}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cbc6f64612f1a1d70e51373d7da3ceb69b570728", "author": {"user": {"login": "pabender", "name": "Paul Bender"}}, "url": "https://github.com/JMRI/JMRI/commit/cbc6f64612f1a1d70e51373d7da3ceb69b570728", "committedDate": "2020-07-19T20:36:43Z", "message": "better name for class"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMjQ2NTc0", "url": "https://github.com/JMRI/JMRI/pull/8850#pullrequestreview-451246574", "createdAt": "2020-07-20T02:23:39Z", "commit": {"oid": "cbc6f64612f1a1d70e51373d7da3ceb69b570728"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwMjoyMzozOVrOGz0yPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwMjoyMzozOVrOGz0yPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njk5NTM4OA==", "bodyText": "Please do this for X as well as Y. When I run this test on my laptop with Debian Linux, I consistent get wrong X values on some items. I don't know why, but by adding your code, but for the X axis, removes the problem.\nIn the tests that failes, x=0 is expected, but I get x=-5.", "url": "https://github.com/JMRI/JMRI/pull/8850#discussion_r456995388", "createdAt": "2020-07-20T02:23:39Z", "author": {"login": "danielb987"}, "path": "java/test/jmri/configurexml/LoadAndStoreTestBase.java", "diffHunk": "@@ -196,6 +196,24 @@ public static void checkFile(File inFile1, File inFile2) throws Exception {\n                 }\n             }\n \n+            // window y positions will sometimes differ based on window decorations.\n+            if (!match) {\n+                if (line1.contains(\"  <LayoutEditor\") ||\n+                    line1.contains(\" <switchboardeditor\")) {\n+                    // if either line contains a y position attribute\n+                    String yposition_regexe = \"( y=\\\"[^\\\"]*\\\")\";\n+                    String[] splits1 = line1.split(yposition_regexe);\n+                    if (splits1.length == 2) {  // (yes) remove it\n+                        line1 = splits1[0] + splits1[1];\n+                    }\n+                    String[] splits2 = line2.split(yposition_regexe);\n+                    if (splits2.length == 2) {  // (yes) remove it\n+                        line2 = splits2[0] + splits2[1];\n+                    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbc6f64612f1a1d70e51373d7da3ceb69b570728"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "393bb6988ab388c3b6ec98e0cdc7277ab5dd643a", "author": {"user": {"login": "pabender", "name": "Paul Bender"}}, "url": "https://github.com/JMRI/JMRI/commit/393bb6988ab388c3b6ec98e0cdc7277ab5dd643a", "committedDate": "2020-07-20T05:13:43Z", "message": "filter out both x and y coordinates.  some refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "482e80ee3704baa74c095d578694b5f67a448f07", "author": {"user": {"login": "pabender", "name": "Paul Bender"}}, "url": "https://github.com/JMRI/JMRI/commit/482e80ee3704baa74c095d578694b5f67a448f07", "committedDate": "2020-07-20T05:26:27Z", "message": "use correct regex"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MzM3ODQy", "url": "https://github.com/JMRI/JMRI/pull/8850#pullrequestreview-455337842", "createdAt": "2020-07-26T07:00:04Z", "commit": {"oid": "482e80ee3704baa74c095d578694b5f67a448f07"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwNDg2MzI3", "url": "https://github.com/JMRI/JMRI/pull/8850#pullrequestreview-460486327", "createdAt": "2020-08-04T04:24:28Z", "commit": {"oid": "482e80ee3704baa74c095d578694b5f67a448f07"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4042, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}