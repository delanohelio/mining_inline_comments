{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2MTExNTgx", "number": 1451, "reviewThreads": {"totalCount": 34, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxODo0Njo0MVrOD_c6_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNToxODo1MFrOEByuLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3ODYwNzM1OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/domain/Rating.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxODo0Njo0MVrOGaH54g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNToyMDoxOFrOGb6Uow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA0NTY2Ng==", "bodyText": "I don\u2019t think cascade makes sense here. This would mean a result is deleted when a rating is deleted", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430045666", "createdAt": "2020-05-25T18:46:41Z", "author": {"login": "krusche"}, "path": "src/main/java/de/tum/in/www1/artemis/domain/Rating.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package de.tum.in.www1.artemis.domain;\n+\n+import java.io.Serializable;\n+import java.util.Objects;\n+\n+import javax.persistence.CascadeType;\n+import javax.persistence.Column;\n+import javax.persistence.Entity;\n+import javax.persistence.FetchType;\n+import javax.persistence.Id;\n+import javax.persistence.JoinColumn;\n+import javax.persistence.MapsId;\n+import javax.persistence.OneToOne;\n+import javax.persistence.Table;\n+\n+import com.fasterxml.jackson.annotation.JsonInclude;\n+import com.fasterxml.jackson.annotation.JsonInclude.Include;\n+\n+/**\n+ * A Rating.\n+ */\n+@Entity\n+@Table(name = \"result_rating\")\n+@JsonInclude(Include.NON_EMPTY)\n+public class Rating implements Serializable {\n+\n+    @Id\n+    private Long id;\n+\n+    @Column(name = \"rating\")\n+    private Integer rating;\n+\n+    @MapsId\n+    @OneToOne(fetch = FetchType.LAZY, cascade = CascadeType.ALL)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99935f8977138fccb6d7c61d56561509fd7c45b5"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM0NDI3MA==", "bodyText": "From my understanding Cascade.ALL propagates all operations \u2014 including Hibernate-specific ones \u2014 from a parent to a child entity. In an uni-directional 1-1 mapping using \"MapsId\", the referenced table is the parent entity and the referencing one is the child entity. Therefore I would delete the rating if the result ist deleted.", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430344270", "createdAt": "2020-05-26T11:31:47Z", "author": {"login": "JonasPetry"}, "path": "src/main/java/de/tum/in/www1/artemis/domain/Rating.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package de.tum.in.www1.artemis.domain;\n+\n+import java.io.Serializable;\n+import java.util.Objects;\n+\n+import javax.persistence.CascadeType;\n+import javax.persistence.Column;\n+import javax.persistence.Entity;\n+import javax.persistence.FetchType;\n+import javax.persistence.Id;\n+import javax.persistence.JoinColumn;\n+import javax.persistence.MapsId;\n+import javax.persistence.OneToOne;\n+import javax.persistence.Table;\n+\n+import com.fasterxml.jackson.annotation.JsonInclude;\n+import com.fasterxml.jackson.annotation.JsonInclude.Include;\n+\n+/**\n+ * A Rating.\n+ */\n+@Entity\n+@Table(name = \"result_rating\")\n+@JsonInclude(Include.NON_EMPTY)\n+public class Rating implements Serializable {\n+\n+    @Id\n+    private Long id;\n+\n+    @Column(name = \"rating\")\n+    private Integer rating;\n+\n+    @MapsId\n+    @OneToOne(fetch = FetchType.LAZY, cascade = CascadeType.ALL)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA0NTY2Ng=="}, "originalCommit": {"oid": "99935f8977138fccb6d7c61d56561509fd7c45b5"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTkyMDI5MQ==", "bodyText": "Nevermind, I've tested it and you are right. I removed the cascading now!", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r431920291", "createdAt": "2020-05-28T15:20:18Z", "author": {"login": "JonasPetry"}, "path": "src/main/java/de/tum/in/www1/artemis/domain/Rating.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package de.tum.in.www1.artemis.domain;\n+\n+import java.io.Serializable;\n+import java.util.Objects;\n+\n+import javax.persistence.CascadeType;\n+import javax.persistence.Column;\n+import javax.persistence.Entity;\n+import javax.persistence.FetchType;\n+import javax.persistence.Id;\n+import javax.persistence.JoinColumn;\n+import javax.persistence.MapsId;\n+import javax.persistence.OneToOne;\n+import javax.persistence.Table;\n+\n+import com.fasterxml.jackson.annotation.JsonInclude;\n+import com.fasterxml.jackson.annotation.JsonInclude.Include;\n+\n+/**\n+ * A Rating.\n+ */\n+@Entity\n+@Table(name = \"result_rating\")\n+@JsonInclude(Include.NON_EMPTY)\n+public class Rating implements Serializable {\n+\n+    @Id\n+    private Long id;\n+\n+    @Column(name = \"rating\")\n+    private Integer rating;\n+\n+    @MapsId\n+    @OneToOne(fetch = FetchType.LAZY, cascade = CascadeType.ALL)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA0NTY2Ng=="}, "originalCommit": {"oid": "99935f8977138fccb6d7c61d56561509fd7c45b5"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3ODYwODczOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/RatingService.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxODo0NzozMVrOGaH6uA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QyMDozNjoyN1rOGbcLUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA0NTg4MA==", "bodyText": "Please remove transactional here", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430045880", "createdAt": "2020-05-25T18:47:31Z", "author": {"login": "krusche"}, "path": "src/main/java/de/tum/in/www1/artemis/service/RatingService.java", "diffHunk": "@@ -0,0 +1,67 @@\n+package de.tum.in.www1.artemis.service;\n+\n+import java.util.Optional;\n+\n+import javax.transaction.Transactional;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Service;\n+\n+import de.tum.in.www1.artemis.domain.Rating;\n+import de.tum.in.www1.artemis.domain.Result;\n+import de.tum.in.www1.artemis.repository.RatingRepository;\n+import de.tum.in.www1.artemis.repository.ResultRepository;\n+\n+/**\n+ * Service Implementation for managing {@link de.tum.in.www1.artemis.domain.Rating}.\n+ */\n+@Service\n+public class RatingService {\n+\n+    private final Logger log = LoggerFactory.getLogger(ResultService.class);\n+\n+    private final RatingRepository ratingRepository;\n+\n+    private final ResultRepository resultRepository;\n+\n+    public RatingService(RatingRepository ratingRepository, ResultRepository resultRepository) {\n+        this.ratingRepository = ratingRepository;\n+        this.resultRepository = resultRepository;\n+    }\n+\n+    /**\n+     * Return Rating that refers to Result with id resultId\n+     * @param resultId - Id of Result that the rating refers to\n+     * @return Rating if it exists else null\n+     */\n+    public Optional<Rating> findRatingByResultId(Long resultId) {\n+        return ratingRepository.findById(resultId);\n+    }\n+\n+    /**\n+     * Persist a new Rating\n+     * @param rating - Rating that should be persisted\n+     * @return persisted Rating\n+     */\n+    @Transactional", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99935f8977138fccb6d7c61d56561509fd7c45b5"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA2MzE5NQ==", "bodyText": "I've tried it in a few ways but I honestly did not figure out how to do it without using transactional. I've come across the book \"Spring Boot Persistence Best Practices: Optimize Java Persistence\" which recommended the way I've implemented it now.", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430063195", "createdAt": "2020-05-25T20:09:11Z", "author": {"login": "JonasPetry"}, "path": "src/main/java/de/tum/in/www1/artemis/service/RatingService.java", "diffHunk": "@@ -0,0 +1,67 @@\n+package de.tum.in.www1.artemis.service;\n+\n+import java.util.Optional;\n+\n+import javax.transaction.Transactional;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Service;\n+\n+import de.tum.in.www1.artemis.domain.Rating;\n+import de.tum.in.www1.artemis.domain.Result;\n+import de.tum.in.www1.artemis.repository.RatingRepository;\n+import de.tum.in.www1.artemis.repository.ResultRepository;\n+\n+/**\n+ * Service Implementation for managing {@link de.tum.in.www1.artemis.domain.Rating}.\n+ */\n+@Service\n+public class RatingService {\n+\n+    private final Logger log = LoggerFactory.getLogger(ResultService.class);\n+\n+    private final RatingRepository ratingRepository;\n+\n+    private final ResultRepository resultRepository;\n+\n+    public RatingService(RatingRepository ratingRepository, ResultRepository resultRepository) {\n+        this.ratingRepository = ratingRepository;\n+        this.resultRepository = resultRepository;\n+    }\n+\n+    /**\n+     * Return Rating that refers to Result with id resultId\n+     * @param resultId - Id of Result that the rating refers to\n+     * @return Rating if it exists else null\n+     */\n+    public Optional<Rating> findRatingByResultId(Long resultId) {\n+        return ratingRepository.findById(resultId);\n+    }\n+\n+    /**\n+     * Persist a new Rating\n+     * @param rating - Rating that should be persisted\n+     * @return persisted Rating\n+     */\n+    @Transactional", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA0NTg4MA=="}, "originalCommit": {"oid": "99935f8977138fccb6d7c61d56561509fd7c45b5"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA2NzgzMg==", "bodyText": "The book does not matter, we have design and coding guidelines in Artemis. Please do not use transactional except you have a very good reason for it. I don\u2019t see a good reason in the cases of this PR. Make sure to fetch objects (with related objects) directly from the database to avoid additional fetches. There are plenty of examples in the repositories how to do that", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430067832", "createdAt": "2020-05-25T20:32:09Z", "author": {"login": "krusche"}, "path": "src/main/java/de/tum/in/www1/artemis/service/RatingService.java", "diffHunk": "@@ -0,0 +1,67 @@\n+package de.tum.in.www1.artemis.service;\n+\n+import java.util.Optional;\n+\n+import javax.transaction.Transactional;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Service;\n+\n+import de.tum.in.www1.artemis.domain.Rating;\n+import de.tum.in.www1.artemis.domain.Result;\n+import de.tum.in.www1.artemis.repository.RatingRepository;\n+import de.tum.in.www1.artemis.repository.ResultRepository;\n+\n+/**\n+ * Service Implementation for managing {@link de.tum.in.www1.artemis.domain.Rating}.\n+ */\n+@Service\n+public class RatingService {\n+\n+    private final Logger log = LoggerFactory.getLogger(ResultService.class);\n+\n+    private final RatingRepository ratingRepository;\n+\n+    private final ResultRepository resultRepository;\n+\n+    public RatingService(RatingRepository ratingRepository, ResultRepository resultRepository) {\n+        this.ratingRepository = ratingRepository;\n+        this.resultRepository = resultRepository;\n+    }\n+\n+    /**\n+     * Return Rating that refers to Result with id resultId\n+     * @param resultId - Id of Result that the rating refers to\n+     * @return Rating if it exists else null\n+     */\n+    public Optional<Rating> findRatingByResultId(Long resultId) {\n+        return ratingRepository.findById(resultId);\n+    }\n+\n+    /**\n+     * Persist a new Rating\n+     * @param rating - Rating that should be persisted\n+     * @return persisted Rating\n+     */\n+    @Transactional", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA0NTg4MA=="}, "originalCommit": {"oid": "99935f8977138fccb6d7c61d56561509fd7c45b5"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQyNjM4Nw==", "bodyText": "I think the @Transactional is needed in this case, because the Id is not automatically set otherwise.", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r431426387", "createdAt": "2020-05-27T20:36:27Z", "author": {"login": "JonasPetry"}, "path": "src/main/java/de/tum/in/www1/artemis/service/RatingService.java", "diffHunk": "@@ -0,0 +1,67 @@\n+package de.tum.in.www1.artemis.service;\n+\n+import java.util.Optional;\n+\n+import javax.transaction.Transactional;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Service;\n+\n+import de.tum.in.www1.artemis.domain.Rating;\n+import de.tum.in.www1.artemis.domain.Result;\n+import de.tum.in.www1.artemis.repository.RatingRepository;\n+import de.tum.in.www1.artemis.repository.ResultRepository;\n+\n+/**\n+ * Service Implementation for managing {@link de.tum.in.www1.artemis.domain.Rating}.\n+ */\n+@Service\n+public class RatingService {\n+\n+    private final Logger log = LoggerFactory.getLogger(ResultService.class);\n+\n+    private final RatingRepository ratingRepository;\n+\n+    private final ResultRepository resultRepository;\n+\n+    public RatingService(RatingRepository ratingRepository, ResultRepository resultRepository) {\n+        this.ratingRepository = ratingRepository;\n+        this.resultRepository = resultRepository;\n+    }\n+\n+    /**\n+     * Return Rating that refers to Result with id resultId\n+     * @param resultId - Id of Result that the rating refers to\n+     * @return Rating if it exists else null\n+     */\n+    public Optional<Rating> findRatingByResultId(Long resultId) {\n+        return ratingRepository.findById(resultId);\n+    }\n+\n+    /**\n+     * Persist a new Rating\n+     * @param rating - Rating that should be persisted\n+     * @return persisted Rating\n+     */\n+    @Transactional", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA0NTg4MA=="}, "originalCommit": {"oid": "99935f8977138fccb6d7c61d56561509fd7c45b5"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3ODYwOTMwOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/RatingService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxODo0Nzo0NlrOGaH7AA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxODo0Nzo0NlrOGaH7AA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA0NTk1Mg==", "bodyText": "Please remove transactional here", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430045952", "createdAt": "2020-05-25T18:47:46Z", "author": {"login": "krusche"}, "path": "src/main/java/de/tum/in/www1/artemis/service/RatingService.java", "diffHunk": "@@ -0,0 +1,67 @@\n+package de.tum.in.www1.artemis.service;\n+\n+import java.util.Optional;\n+\n+import javax.transaction.Transactional;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Service;\n+\n+import de.tum.in.www1.artemis.domain.Rating;\n+import de.tum.in.www1.artemis.domain.Result;\n+import de.tum.in.www1.artemis.repository.RatingRepository;\n+import de.tum.in.www1.artemis.repository.ResultRepository;\n+\n+/**\n+ * Service Implementation for managing {@link de.tum.in.www1.artemis.domain.Rating}.\n+ */\n+@Service\n+public class RatingService {\n+\n+    private final Logger log = LoggerFactory.getLogger(ResultService.class);\n+\n+    private final RatingRepository ratingRepository;\n+\n+    private final ResultRepository resultRepository;\n+\n+    public RatingService(RatingRepository ratingRepository, ResultRepository resultRepository) {\n+        this.ratingRepository = ratingRepository;\n+        this.resultRepository = resultRepository;\n+    }\n+\n+    /**\n+     * Return Rating that refers to Result with id resultId\n+     * @param resultId - Id of Result that the rating refers to\n+     * @return Rating if it exists else null\n+     */\n+    public Optional<Rating> findRatingByResultId(Long resultId) {\n+        return ratingRepository.findById(resultId);\n+    }\n+\n+    /**\n+     * Persist a new Rating\n+     * @param rating - Rating that should be persisted\n+     * @return persisted Rating\n+     */\n+    @Transactional\n+    public Rating saveRating(Rating rating) {\n+        Result result = resultRepository.findById(rating.getResult().getId()).orElseThrow();\n+        Rating serverRating = new Rating();\n+        serverRating.setRating(rating.getRating());\n+        serverRating.setResult(result);\n+        return ratingRepository.save(serverRating);\n+    }\n+\n+    /**\n+     * Update an existing Rating\n+     * @param rating - Updated Rating that should be persisted\n+     * @return updated rating\n+     */\n+    @Transactional", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99935f8977138fccb6d7c61d56561509fd7c45b5"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3ODYxMDY1OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxODo0ODo0MlrOGaH70w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxODo0ODo0MlrOGaH70w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA0NjE2Mw==", "bodyText": "Do you really need this?", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430046163", "createdAt": "2020-05-25T18:48:42Z", "author": {"login": "krusche"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "diffHunk": "@@ -0,0 +1,133 @@\n+package de.tum.in.www1.artemis.web.rest;\n+\n+import static de.tum.in.www1.artemis.web.rest.util.ResponseUtil.forbidden;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.Optional;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.PostMapping;\n+import org.springframework.web.bind.annotation.PutMapping;\n+import org.springframework.web.bind.annotation.RequestBody;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+import org.springframework.web.server.ResponseStatusException;\n+\n+import de.tum.in.www1.artemis.domain.Rating;\n+import de.tum.in.www1.artemis.domain.Result;\n+import de.tum.in.www1.artemis.domain.User;\n+import de.tum.in.www1.artemis.domain.participation.StudentParticipation;\n+import de.tum.in.www1.artemis.service.AuthorizationCheckService;\n+import de.tum.in.www1.artemis.service.ParticipationService;\n+import de.tum.in.www1.artemis.service.RatingService;\n+import de.tum.in.www1.artemis.service.ResultService;\n+import de.tum.in.www1.artemis.service.UserService;\n+import de.tum.in.www1.artemis.web.rest.errors.BadRequestAlertException;\n+\n+/**\n+ * REST controller for managing Rating.\n+ */\n+@RestController\n+@RequestMapping(\"/api\")\n+public class RatingResource {\n+\n+    private static final String ENTITY_NAME = \"rating\";\n+\n+    private final Logger log = LoggerFactory.getLogger(RatingResource.class);\n+\n+    private final RatingService ratingService;\n+\n+    private final UserService userService;\n+\n+    private final AuthorizationCheckService authCheckService;\n+\n+    private final ResultService resultService;\n+\n+    private final ParticipationService participationService;\n+\n+    @Value(\"${jhipster.clientApp.name}\")\n+    private String applicationName;\n+\n+    @Value(\"${artemis.continuous-integration.artemis-authentication-token-value}\")\n+    private String ARTEMIS_AUTHENTICATION_TOKEN_VALUE = \"\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99935f8977138fccb6d7c61d56561509fd7c45b5"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3ODYxMTc5OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxODo0OToyN1rOGaH8dg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxODo0OToyN1rOGaH8dg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA0NjMyNg==", "bodyText": "The URL is incorrect. I suggest /results/{resultId}/rating", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430046326", "createdAt": "2020-05-25T18:49:27Z", "author": {"login": "krusche"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "diffHunk": "@@ -0,0 +1,133 @@\n+package de.tum.in.www1.artemis.web.rest;\n+\n+import static de.tum.in.www1.artemis.web.rest.util.ResponseUtil.forbidden;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.Optional;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.PostMapping;\n+import org.springframework.web.bind.annotation.PutMapping;\n+import org.springframework.web.bind.annotation.RequestBody;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+import org.springframework.web.server.ResponseStatusException;\n+\n+import de.tum.in.www1.artemis.domain.Rating;\n+import de.tum.in.www1.artemis.domain.Result;\n+import de.tum.in.www1.artemis.domain.User;\n+import de.tum.in.www1.artemis.domain.participation.StudentParticipation;\n+import de.tum.in.www1.artemis.service.AuthorizationCheckService;\n+import de.tum.in.www1.artemis.service.ParticipationService;\n+import de.tum.in.www1.artemis.service.RatingService;\n+import de.tum.in.www1.artemis.service.ResultService;\n+import de.tum.in.www1.artemis.service.UserService;\n+import de.tum.in.www1.artemis.web.rest.errors.BadRequestAlertException;\n+\n+/**\n+ * REST controller for managing Rating.\n+ */\n+@RestController\n+@RequestMapping(\"/api\")\n+public class RatingResource {\n+\n+    private static final String ENTITY_NAME = \"rating\";\n+\n+    private final Logger log = LoggerFactory.getLogger(RatingResource.class);\n+\n+    private final RatingService ratingService;\n+\n+    private final UserService userService;\n+\n+    private final AuthorizationCheckService authCheckService;\n+\n+    private final ResultService resultService;\n+\n+    private final ParticipationService participationService;\n+\n+    @Value(\"${jhipster.clientApp.name}\")\n+    private String applicationName;\n+\n+    @Value(\"${artemis.continuous-integration.artemis-authentication-token-value}\")\n+    private String ARTEMIS_AUTHENTICATION_TOKEN_VALUE = \"\";\n+\n+    public RatingResource(RatingService ratingService, UserService userService, AuthorizationCheckService authCheckService, ResultService resultService,\n+            ParticipationService participationService) {\n+        this.ratingService = ratingService;\n+        this.userService = userService;\n+        this.authCheckService = authCheckService;\n+        this.resultService = resultService;\n+        this.participationService = participationService;\n+    }\n+\n+    /**\n+     * Return Rating referencing resultId or 404 Not Found\n+     *\n+     * @param resultId - Id of result that is referenced with the rating\n+     * @return Rating or 404 Not Found\n+     */\n+    @GetMapping(\"/rating/result/{resultId}\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99935f8977138fccb6d7c61d56561509fd7c45b5"}, "originalPosition": 77}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3ODYxMjA5OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxODo0OTo0M1rOGaH8pg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxODo0OTo0M1rOGaH8pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA0NjM3NA==", "bodyText": "Wrong url", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430046374", "createdAt": "2020-05-25T18:49:43Z", "author": {"login": "krusche"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "diffHunk": "@@ -0,0 +1,133 @@\n+package de.tum.in.www1.artemis.web.rest;\n+\n+import static de.tum.in.www1.artemis.web.rest.util.ResponseUtil.forbidden;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.Optional;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.PostMapping;\n+import org.springframework.web.bind.annotation.PutMapping;\n+import org.springframework.web.bind.annotation.RequestBody;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+import org.springframework.web.server.ResponseStatusException;\n+\n+import de.tum.in.www1.artemis.domain.Rating;\n+import de.tum.in.www1.artemis.domain.Result;\n+import de.tum.in.www1.artemis.domain.User;\n+import de.tum.in.www1.artemis.domain.participation.StudentParticipation;\n+import de.tum.in.www1.artemis.service.AuthorizationCheckService;\n+import de.tum.in.www1.artemis.service.ParticipationService;\n+import de.tum.in.www1.artemis.service.RatingService;\n+import de.tum.in.www1.artemis.service.ResultService;\n+import de.tum.in.www1.artemis.service.UserService;\n+import de.tum.in.www1.artemis.web.rest.errors.BadRequestAlertException;\n+\n+/**\n+ * REST controller for managing Rating.\n+ */\n+@RestController\n+@RequestMapping(\"/api\")\n+public class RatingResource {\n+\n+    private static final String ENTITY_NAME = \"rating\";\n+\n+    private final Logger log = LoggerFactory.getLogger(RatingResource.class);\n+\n+    private final RatingService ratingService;\n+\n+    private final UserService userService;\n+\n+    private final AuthorizationCheckService authCheckService;\n+\n+    private final ResultService resultService;\n+\n+    private final ParticipationService participationService;\n+\n+    @Value(\"${jhipster.clientApp.name}\")\n+    private String applicationName;\n+\n+    @Value(\"${artemis.continuous-integration.artemis-authentication-token-value}\")\n+    private String ARTEMIS_AUTHENTICATION_TOKEN_VALUE = \"\";\n+\n+    public RatingResource(RatingService ratingService, UserService userService, AuthorizationCheckService authCheckService, ResultService resultService,\n+            ParticipationService participationService) {\n+        this.ratingService = ratingService;\n+        this.userService = userService;\n+        this.authCheckService = authCheckService;\n+        this.resultService = resultService;\n+        this.participationService = participationService;\n+    }\n+\n+    /**\n+     * Return Rating referencing resultId or 404 Not Found\n+     *\n+     * @param resultId - Id of result that is referenced with the rating\n+     * @return Rating or 404 Not Found\n+     */\n+    @GetMapping(\"/rating/result/{resultId}\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Rating> getRatingForResult(@PathVariable Long resultId) {\n+        Optional<Rating> rating = this.ratingService.findRatingByResultId(resultId);\n+        if (rating.isEmpty()) {\n+            throw new ResponseStatusException(HttpStatus.NOT_FOUND, \"Rating does not exist!\");\n+        }\n+        return ResponseEntity.ok(rating.get());\n+    }\n+\n+    /**\n+     * Persist a new Rating\n+     *\n+     * @param rating - Rating that should be persisted\n+     * @return inserted Rating\n+     * @throws URISyntaxException if the Location URI syntax is incorrect\n+     */\n+    @PostMapping(\"/rating\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99935f8977138fccb6d7c61d56561509fd7c45b5"}, "originalPosition": 95}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3ODYxMjQzOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxODo0OTo1NVrOGaH81w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxODo0OTo1NVrOGaH81w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA0NjQyMw==", "bodyText": "Wrong url", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430046423", "createdAt": "2020-05-25T18:49:55Z", "author": {"login": "krusche"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "diffHunk": "@@ -0,0 +1,133 @@\n+package de.tum.in.www1.artemis.web.rest;\n+\n+import static de.tum.in.www1.artemis.web.rest.util.ResponseUtil.forbidden;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.Optional;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.PostMapping;\n+import org.springframework.web.bind.annotation.PutMapping;\n+import org.springframework.web.bind.annotation.RequestBody;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+import org.springframework.web.server.ResponseStatusException;\n+\n+import de.tum.in.www1.artemis.domain.Rating;\n+import de.tum.in.www1.artemis.domain.Result;\n+import de.tum.in.www1.artemis.domain.User;\n+import de.tum.in.www1.artemis.domain.participation.StudentParticipation;\n+import de.tum.in.www1.artemis.service.AuthorizationCheckService;\n+import de.tum.in.www1.artemis.service.ParticipationService;\n+import de.tum.in.www1.artemis.service.RatingService;\n+import de.tum.in.www1.artemis.service.ResultService;\n+import de.tum.in.www1.artemis.service.UserService;\n+import de.tum.in.www1.artemis.web.rest.errors.BadRequestAlertException;\n+\n+/**\n+ * REST controller for managing Rating.\n+ */\n+@RestController\n+@RequestMapping(\"/api\")\n+public class RatingResource {\n+\n+    private static final String ENTITY_NAME = \"rating\";\n+\n+    private final Logger log = LoggerFactory.getLogger(RatingResource.class);\n+\n+    private final RatingService ratingService;\n+\n+    private final UserService userService;\n+\n+    private final AuthorizationCheckService authCheckService;\n+\n+    private final ResultService resultService;\n+\n+    private final ParticipationService participationService;\n+\n+    @Value(\"${jhipster.clientApp.name}\")\n+    private String applicationName;\n+\n+    @Value(\"${artemis.continuous-integration.artemis-authentication-token-value}\")\n+    private String ARTEMIS_AUTHENTICATION_TOKEN_VALUE = \"\";\n+\n+    public RatingResource(RatingService ratingService, UserService userService, AuthorizationCheckService authCheckService, ResultService resultService,\n+            ParticipationService participationService) {\n+        this.ratingService = ratingService;\n+        this.userService = userService;\n+        this.authCheckService = authCheckService;\n+        this.resultService = resultService;\n+        this.participationService = participationService;\n+    }\n+\n+    /**\n+     * Return Rating referencing resultId or 404 Not Found\n+     *\n+     * @param resultId - Id of result that is referenced with the rating\n+     * @return Rating or 404 Not Found\n+     */\n+    @GetMapping(\"/rating/result/{resultId}\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Rating> getRatingForResult(@PathVariable Long resultId) {\n+        Optional<Rating> rating = this.ratingService.findRatingByResultId(resultId);\n+        if (rating.isEmpty()) {\n+            throw new ResponseStatusException(HttpStatus.NOT_FOUND, \"Rating does not exist!\");\n+        }\n+        return ResponseEntity.ok(rating.get());\n+    }\n+\n+    /**\n+     * Persist a new Rating\n+     *\n+     * @param rating - Rating that should be persisted\n+     * @return inserted Rating\n+     * @throws URISyntaxException if the Location URI syntax is incorrect\n+     */\n+    @PostMapping(\"/rating\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Rating> createRatingForResult(@RequestBody Rating rating) throws URISyntaxException {\n+        if (rating.getId() != null) {\n+            throw new BadRequestAlertException(\"The rating must not have an ID\", ENTITY_NAME, \"idDoesExist\");\n+        }\n+        User user = userService.getUser();\n+        Result res = resultService.findOne(rating.getResult().getId());\n+        StudentParticipation participation = participationService.findOneStudentParticipation(res.getParticipation().getId());\n+        if (!authCheckService.isOwnerOfParticipation(participation, user)) {\n+            return forbidden();\n+        }\n+\n+        Rating result = this.ratingService.saveRating(rating);\n+        return ResponseEntity.created(new URI(\"/api/rating/\" + result.getId())).body(result);\n+    }\n+\n+    /**\n+     * Update a Rating\n+     *\n+     * @param rating - updated Rating\n+     * @return updated Rating\n+     */\n+    @PutMapping(\"/rating\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99935f8977138fccb6d7c61d56561509fd7c45b5"}, "originalPosition": 118}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3OTk0MzU3OnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/exercises/shared/rating/rating.service.ts", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwODo0NDozNVrOGaUfMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwODo0NDozNVrOGaUfMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI1MTgyNg==", "bodyText": "You're adding the slash twice, resulting in a 500.", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430251826", "createdAt": "2020-05-26T08:44:35Z", "author": {"login": "madwau"}, "path": "src/main/webapp/app/exercises/shared/rating/rating.service.ts", "diffHunk": "@@ -0,0 +1,38 @@\n+import { Injectable } from '@angular/core';\n+import { HttpClient } from '@angular/common/http';\n+import { Observable } from 'rxjs/Observable';\n+import { Rating } from 'app/entities/rating.model';\n+import { SERVER_API_URL } from 'app/app.constants';\n+\n+@Injectable({\n+    providedIn: 'root',\n+})\n+export class RatingService {\n+    private ratingResourceUrl = SERVER_API_URL + 'api/results/';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f1fc82b20b697b98d289d1c34b1ea5fc067c016"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3OTk3NDg0OnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/exercises/shared/rating/rating.service.ts", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwODo1Mjo1NVrOGaUzFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOTowNjo0NFrOGaVUVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI1NjkxNg==", "bodyText": "All the urls seem inconsistent with the server endpoints. Does rating.service.ts still need to be adapted to the latest changes in RatingResource?", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430256916", "createdAt": "2020-05-26T08:52:55Z", "author": {"login": "madwau"}, "path": "src/main/webapp/app/exercises/shared/rating/rating.service.ts", "diffHunk": "@@ -0,0 +1,38 @@\n+import { Injectable } from '@angular/core';\n+import { HttpClient } from '@angular/common/http';\n+import { Observable } from 'rxjs/Observable';\n+import { Rating } from 'app/entities/rating.model';\n+import { SERVER_API_URL } from 'app/app.constants';\n+\n+@Injectable({\n+    providedIn: 'root',\n+})\n+export class RatingService {\n+    private ratingResourceUrl = SERVER_API_URL + 'api/results/';\n+\n+    constructor(private http: HttpClient) {}\n+\n+    /**\n+     * Update the student rating for feedback on the server.\n+     * @param rating - Rating for the result\n+     */\n+    setRating(rating: Rating): Observable<Rating> {\n+        return this.http.post<Rating>(this.ratingResourceUrl + `${rating.id}/rating/${rating.rating}`, rating);\n+    }\n+\n+    /**\n+     * Get rating for \"resultId\" Result\n+     * @param resultId - Id of Result who's rating is received\n+     */\n+    getRating(resultId: number): Observable<Rating> {\n+        return this.http.get<Rating>(this.ratingResourceUrl + `${resultId}/rating`);\n+    }\n+\n+    /**\n+     * Update rating for \"resultId\" Result\n+     * @param rating - Rating for the result\n+     */\n+    updateRating(rating: Rating): Observable<Rating> {\n+        return this.http.put<Rating>(this.ratingResourceUrl + `${rating.id}/rating/${rating.rating}`, rating);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "114f290e1b160b024cca9dc827af4a60e6293337"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI2MTYxNg==", "bodyText": "The result id needs to be passed in. ${rating.id} should be ${result.id}.", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430261616", "createdAt": "2020-05-26T09:00:23Z", "author": {"login": "madwau"}, "path": "src/main/webapp/app/exercises/shared/rating/rating.service.ts", "diffHunk": "@@ -0,0 +1,38 @@\n+import { Injectable } from '@angular/core';\n+import { HttpClient } from '@angular/common/http';\n+import { Observable } from 'rxjs/Observable';\n+import { Rating } from 'app/entities/rating.model';\n+import { SERVER_API_URL } from 'app/app.constants';\n+\n+@Injectable({\n+    providedIn: 'root',\n+})\n+export class RatingService {\n+    private ratingResourceUrl = SERVER_API_URL + 'api/results/';\n+\n+    constructor(private http: HttpClient) {}\n+\n+    /**\n+     * Update the student rating for feedback on the server.\n+     * @param rating - Rating for the result\n+     */\n+    setRating(rating: Rating): Observable<Rating> {\n+        return this.http.post<Rating>(this.ratingResourceUrl + `${rating.id}/rating/${rating.rating}`, rating);\n+    }\n+\n+    /**\n+     * Get rating for \"resultId\" Result\n+     * @param resultId - Id of Result who's rating is received\n+     */\n+    getRating(resultId: number): Observable<Rating> {\n+        return this.http.get<Rating>(this.ratingResourceUrl + `${resultId}/rating`);\n+    }\n+\n+    /**\n+     * Update rating for \"resultId\" Result\n+     * @param rating - Rating for the result\n+     */\n+    updateRating(rating: Rating): Observable<Rating> {\n+        return this.http.put<Rating>(this.ratingResourceUrl + `${rating.id}/rating/${rating.rating}`, rating);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI1NjkxNg=="}, "originalCommit": {"oid": "114f290e1b160b024cca9dc827af4a60e6293337"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI2NDA1OQ==", "bodyText": "Although I guess it's technically correct since they are the same when MapsId is used.", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430264059", "createdAt": "2020-05-26T09:04:26Z", "author": {"login": "madwau"}, "path": "src/main/webapp/app/exercises/shared/rating/rating.service.ts", "diffHunk": "@@ -0,0 +1,38 @@\n+import { Injectable } from '@angular/core';\n+import { HttpClient } from '@angular/common/http';\n+import { Observable } from 'rxjs/Observable';\n+import { Rating } from 'app/entities/rating.model';\n+import { SERVER_API_URL } from 'app/app.constants';\n+\n+@Injectable({\n+    providedIn: 'root',\n+})\n+export class RatingService {\n+    private ratingResourceUrl = SERVER_API_URL + 'api/results/';\n+\n+    constructor(private http: HttpClient) {}\n+\n+    /**\n+     * Update the student rating for feedback on the server.\n+     * @param rating - Rating for the result\n+     */\n+    setRating(rating: Rating): Observable<Rating> {\n+        return this.http.post<Rating>(this.ratingResourceUrl + `${rating.id}/rating/${rating.rating}`, rating);\n+    }\n+\n+    /**\n+     * Get rating for \"resultId\" Result\n+     * @param resultId - Id of Result who's rating is received\n+     */\n+    getRating(resultId: number): Observable<Rating> {\n+        return this.http.get<Rating>(this.ratingResourceUrl + `${resultId}/rating`);\n+    }\n+\n+    /**\n+     * Update rating for \"resultId\" Result\n+     * @param rating - Rating for the result\n+     */\n+    updateRating(rating: Rating): Observable<Rating> {\n+        return this.http.put<Rating>(this.ratingResourceUrl + `${rating.id}/rating/${rating.rating}`, rating);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI1NjkxNg=="}, "originalCommit": {"oid": "114f290e1b160b024cca9dc827af4a60e6293337"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI2NTQyOQ==", "bodyText": "I think the only real issue is in setRating then. It fails since rating.id is still undefined at that point.", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430265429", "createdAt": "2020-05-26T09:06:44Z", "author": {"login": "madwau"}, "path": "src/main/webapp/app/exercises/shared/rating/rating.service.ts", "diffHunk": "@@ -0,0 +1,38 @@\n+import { Injectable } from '@angular/core';\n+import { HttpClient } from '@angular/common/http';\n+import { Observable } from 'rxjs/Observable';\n+import { Rating } from 'app/entities/rating.model';\n+import { SERVER_API_URL } from 'app/app.constants';\n+\n+@Injectable({\n+    providedIn: 'root',\n+})\n+export class RatingService {\n+    private ratingResourceUrl = SERVER_API_URL + 'api/results/';\n+\n+    constructor(private http: HttpClient) {}\n+\n+    /**\n+     * Update the student rating for feedback on the server.\n+     * @param rating - Rating for the result\n+     */\n+    setRating(rating: Rating): Observable<Rating> {\n+        return this.http.post<Rating>(this.ratingResourceUrl + `${rating.id}/rating/${rating.rating}`, rating);\n+    }\n+\n+    /**\n+     * Get rating for \"resultId\" Result\n+     * @param resultId - Id of Result who's rating is received\n+     */\n+    getRating(resultId: number): Observable<Rating> {\n+        return this.http.get<Rating>(this.ratingResourceUrl + `${resultId}/rating`);\n+    }\n+\n+    /**\n+     * Update rating for \"resultId\" Result\n+     * @param rating - Rating for the result\n+     */\n+    updateRating(rating: Rating): Observable<Rating> {\n+        return this.http.put<Rating>(this.ratingResourceUrl + `${rating.id}/rating/${rating.rating}`, rating);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI1NjkxNg=="}, "originalCommit": {"oid": "114f290e1b160b024cca9dc827af4a60e6293337"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MDAzNDE1OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/domain/Rating.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOTowODo0NVrOGaVZDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOTowODo0NVrOGaVZDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI2NjYzNg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return \"Feedback{\" + \"id=\" + getId() + \", rating='\" + getRating() + \"'\" + \", resultId='\" + getId() + \"'}\";\n          \n          \n            \n                    return \"Rating{\" + \"id=\" + getId() + \", rating='\" + getRating() + \"'}\";", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430266636", "createdAt": "2020-05-26T09:08:45Z", "author": {"login": "madwau"}, "path": "src/main/java/de/tum/in/www1/artemis/domain/Rating.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package de.tum.in.www1.artemis.domain;\n+\n+import java.io.Serializable;\n+import java.util.Objects;\n+\n+import javax.persistence.CascadeType;\n+import javax.persistence.Column;\n+import javax.persistence.Entity;\n+import javax.persistence.FetchType;\n+import javax.persistence.Id;\n+import javax.persistence.JoinColumn;\n+import javax.persistence.MapsId;\n+import javax.persistence.OneToOne;\n+import javax.persistence.Table;\n+\n+import com.fasterxml.jackson.annotation.JsonInclude;\n+import com.fasterxml.jackson.annotation.JsonInclude.Include;\n+\n+/**\n+ * A Rating.\n+ */\n+@Entity\n+@Table(name = \"result_rating\")\n+@JsonInclude(Include.NON_EMPTY)\n+public class Rating implements Serializable {\n+\n+    @Id\n+    private Long id;\n+\n+    @Column(name = \"rating\")\n+    private Integer rating;\n+\n+    @MapsId\n+    @OneToOne(fetch = FetchType.LAZY, cascade = CascadeType.ALL)\n+    @JoinColumn(name = \"id\")\n+    private Result result;\n+\n+    public Long getId() {\n+        return id;\n+    }\n+\n+    public void setId(Long id) {\n+        this.id = id;\n+    }\n+\n+    public Integer getRating() {\n+        return rating;\n+    }\n+\n+    public void setRating(Integer rating) {\n+        this.rating = rating;\n+    }\n+\n+    public Result getResult() {\n+        return result;\n+    }\n+\n+    public void setResult(Result result) {\n+        this.result = result;\n+    }\n+\n+    @Override\n+    public int hashCode() {\n+        return Objects.hashCode(getId());\n+    }\n+\n+    @Override\n+    public String toString() {\n+        return \"Feedback{\" + \"id=\" + getId() + \", rating='\" + getRating() + \"'\" + \", resultId='\" + getId() + \"'}\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "114f290e1b160b024cca9dc827af4a60e6293337"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MDAzOTYwOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/RatingService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOToxMDoxM1rOGaVchQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOToxMDoxM1rOGaVchQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI2NzUyNQ==", "bodyText": "Maybe better call it updatedRating?", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430267525", "createdAt": "2020-05-26T09:10:13Z", "author": {"login": "madwau"}, "path": "src/main/java/de/tum/in/www1/artemis/service/RatingService.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package de.tum.in.www1.artemis.service;\n+\n+import java.util.Optional;\n+\n+import javax.transaction.Transactional;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Service;\n+\n+import de.tum.in.www1.artemis.domain.Rating;\n+import de.tum.in.www1.artemis.domain.Result;\n+import de.tum.in.www1.artemis.repository.RatingRepository;\n+import de.tum.in.www1.artemis.repository.ResultRepository;\n+\n+/**\n+ * Service Implementation for managing {@link de.tum.in.www1.artemis.domain.Rating}.\n+ */\n+@Service\n+public class RatingService {\n+\n+    private final Logger log = LoggerFactory.getLogger(ResultService.class);\n+\n+    private final RatingRepository ratingRepository;\n+\n+    private final ResultRepository resultRepository;\n+\n+    public RatingService(RatingRepository ratingRepository, ResultRepository resultRepository) {\n+        this.ratingRepository = ratingRepository;\n+        this.resultRepository = resultRepository;\n+    }\n+\n+    /**\n+     * Return Rating that refers to Result with id resultId\n+     *\n+     * @param resultId - Id of Result that the rating refers to\n+     * @return Rating if it exists else null\n+     */\n+    public Optional<Rating> findRatingByResultId(Long resultId) {\n+        return ratingRepository.findById(resultId);\n+    }\n+\n+    /**\n+     * Persist a new Rating\n+     *\n+     * @param resultId    - Id of the rating that should be persisted\n+     * @param ratingValue - Value of the rating that should be persisted\n+     * @return persisted Rating\n+     */\n+    @Transactional\n+    public Rating saveRating(Long resultId, Integer ratingValue) {\n+        Result result = resultRepository.findById(resultId).orElseThrow();\n+        Rating serverRating = new Rating();\n+        serverRating.setRating(ratingValue);\n+        serverRating.setResult(result);\n+        return ratingRepository.save(serverRating);\n+    }\n+\n+    /**\n+     * Update an existing Rating\n+     *\n+     * @param resultId    - Id of the rating that should be updated\n+     * @param ratingValue - Value of the updated rating\n+     * @return updated rating\n+     */\n+    public Rating updateRating(Long resultId, Integer ratingValue) {\n+        Rating update = this.ratingRepository.findById(resultId).orElseThrow();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "114f290e1b160b024cca9dc827af4a60e6293337"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MDA1MjUyOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOToxMzozNlrOGaVkgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOToxMzozNlrOGaVkgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI2OTU3MQ==", "bodyText": "I think we should avoid raising a 404 simply because a result doesn't have a rating yet. I think a 404 should mostly be reserved for actual unexpected not found errors since it will also end up in Sentry and the error statistics. Having a 404 raised every time someone looks at an assessed submission without result rating would generate a lot of 404s.", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430269571", "createdAt": "2020-05-26T09:13:36Z", "author": {"login": "madwau"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "diffHunk": "@@ -0,0 +1,120 @@\n+package de.tum.in.www1.artemis.web.rest;\n+\n+import static de.tum.in.www1.artemis.web.rest.util.ResponseUtil.forbidden;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.Optional;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.PostMapping;\n+import org.springframework.web.bind.annotation.PutMapping;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+import org.springframework.web.server.ResponseStatusException;\n+\n+import de.tum.in.www1.artemis.domain.Rating;\n+import de.tum.in.www1.artemis.domain.Result;\n+import de.tum.in.www1.artemis.domain.User;\n+import de.tum.in.www1.artemis.domain.participation.StudentParticipation;\n+import de.tum.in.www1.artemis.service.AuthorizationCheckService;\n+import de.tum.in.www1.artemis.service.ParticipationService;\n+import de.tum.in.www1.artemis.service.RatingService;\n+import de.tum.in.www1.artemis.service.ResultService;\n+import de.tum.in.www1.artemis.service.UserService;\n+\n+/**\n+ * REST controller for managing Rating.\n+ */\n+@RestController\n+@RequestMapping(\"/api\")\n+public class RatingResource {\n+\n+    private static final String ENTITY_NAME = \"rating\";\n+\n+    private final Logger log = LoggerFactory.getLogger(RatingResource.class);\n+\n+    private final RatingService ratingService;\n+\n+    private final UserService userService;\n+\n+    private final AuthorizationCheckService authCheckService;\n+\n+    private final ResultService resultService;\n+\n+    private final ParticipationService participationService;\n+\n+    public RatingResource(RatingService ratingService, UserService userService, AuthorizationCheckService authCheckService, ResultService resultService,\n+            ParticipationService participationService) {\n+        this.ratingService = ratingService;\n+        this.userService = userService;\n+        this.authCheckService = authCheckService;\n+        this.resultService = resultService;\n+        this.participationService = participationService;\n+    }\n+\n+    /**\n+     * Return Rating referencing resultId or 404 Not Found", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "114f290e1b160b024cca9dc827af4a60e6293337"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MDA1NTE4OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/RatingService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOToxNDoyNFrOGaVmOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOToxNDoyNFrOGaVmOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI3MDAwOA==", "bodyText": "this. is not needed.", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430270008", "createdAt": "2020-05-26T09:14:24Z", "author": {"login": "madwau"}, "path": "src/main/java/de/tum/in/www1/artemis/service/RatingService.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package de.tum.in.www1.artemis.service;\n+\n+import java.util.Optional;\n+\n+import javax.transaction.Transactional;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Service;\n+\n+import de.tum.in.www1.artemis.domain.Rating;\n+import de.tum.in.www1.artemis.domain.Result;\n+import de.tum.in.www1.artemis.repository.RatingRepository;\n+import de.tum.in.www1.artemis.repository.ResultRepository;\n+\n+/**\n+ * Service Implementation for managing {@link de.tum.in.www1.artemis.domain.Rating}.\n+ */\n+@Service\n+public class RatingService {\n+\n+    private final Logger log = LoggerFactory.getLogger(ResultService.class);\n+\n+    private final RatingRepository ratingRepository;\n+\n+    private final ResultRepository resultRepository;\n+\n+    public RatingService(RatingRepository ratingRepository, ResultRepository resultRepository) {\n+        this.ratingRepository = ratingRepository;\n+        this.resultRepository = resultRepository;\n+    }\n+\n+    /**\n+     * Return Rating that refers to Result with id resultId\n+     *\n+     * @param resultId - Id of Result that the rating refers to\n+     * @return Rating if it exists else null\n+     */\n+    public Optional<Rating> findRatingByResultId(Long resultId) {\n+        return ratingRepository.findById(resultId);\n+    }\n+\n+    /**\n+     * Persist a new Rating\n+     *\n+     * @param resultId    - Id of the rating that should be persisted\n+     * @param ratingValue - Value of the rating that should be persisted\n+     * @return persisted Rating\n+     */\n+    @Transactional\n+    public Rating saveRating(Long resultId, Integer ratingValue) {\n+        Result result = resultRepository.findById(resultId).orElseThrow();\n+        Rating serverRating = new Rating();\n+        serverRating.setRating(ratingValue);\n+        serverRating.setResult(result);\n+        return ratingRepository.save(serverRating);\n+    }\n+\n+    /**\n+     * Update an existing Rating\n+     *\n+     * @param resultId    - Id of the rating that should be updated\n+     * @param ratingValue - Value of the updated rating\n+     * @return updated rating\n+     */\n+    public Rating updateRating(Long resultId, Integer ratingValue) {\n+        Rating update = this.ratingRepository.findById(resultId).orElseThrow();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "114f290e1b160b024cca9dc827af4a60e6293337"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MDA1NTc5OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOToxNDozM1rOGaVmmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOToxNDozM1rOGaVmmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI3MDEwNg==", "bodyText": "this. is not needed.", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430270106", "createdAt": "2020-05-26T09:14:33Z", "author": {"login": "madwau"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "diffHunk": "@@ -0,0 +1,120 @@\n+package de.tum.in.www1.artemis.web.rest;\n+\n+import static de.tum.in.www1.artemis.web.rest.util.ResponseUtil.forbidden;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.Optional;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.PostMapping;\n+import org.springframework.web.bind.annotation.PutMapping;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+import org.springframework.web.server.ResponseStatusException;\n+\n+import de.tum.in.www1.artemis.domain.Rating;\n+import de.tum.in.www1.artemis.domain.Result;\n+import de.tum.in.www1.artemis.domain.User;\n+import de.tum.in.www1.artemis.domain.participation.StudentParticipation;\n+import de.tum.in.www1.artemis.service.AuthorizationCheckService;\n+import de.tum.in.www1.artemis.service.ParticipationService;\n+import de.tum.in.www1.artemis.service.RatingService;\n+import de.tum.in.www1.artemis.service.ResultService;\n+import de.tum.in.www1.artemis.service.UserService;\n+\n+/**\n+ * REST controller for managing Rating.\n+ */\n+@RestController\n+@RequestMapping(\"/api\")\n+public class RatingResource {\n+\n+    private static final String ENTITY_NAME = \"rating\";\n+\n+    private final Logger log = LoggerFactory.getLogger(RatingResource.class);\n+\n+    private final RatingService ratingService;\n+\n+    private final UserService userService;\n+\n+    private final AuthorizationCheckService authCheckService;\n+\n+    private final ResultService resultService;\n+\n+    private final ParticipationService participationService;\n+\n+    public RatingResource(RatingService ratingService, UserService userService, AuthorizationCheckService authCheckService, ResultService resultService,\n+            ParticipationService participationService) {\n+        this.ratingService = ratingService;\n+        this.userService = userService;\n+        this.authCheckService = authCheckService;\n+        this.resultService = resultService;\n+        this.participationService = participationService;\n+    }\n+\n+    /**\n+     * Return Rating referencing resultId or 404 Not Found\n+     *\n+     * @param resultId - Id of result that is referenced with the rating\n+     * @return Rating or 404 Not Found\n+     */\n+    @GetMapping(\"/results/{resultId}/rating\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Rating> getRatingForResult(@PathVariable Long resultId) {\n+        Optional<Rating> rating = this.ratingService.findRatingByResultId(resultId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "114f290e1b160b024cca9dc827af4a60e6293337"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MDA2ODc0OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOToxNzo1OVrOGaVu8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOToxNzo1OVrOGaVu8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI3MjI0Mg==", "bodyText": "this. is not needed.", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430272242", "createdAt": "2020-05-26T09:17:59Z", "author": {"login": "madwau"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "diffHunk": "@@ -0,0 +1,120 @@\n+package de.tum.in.www1.artemis.web.rest;\n+\n+import static de.tum.in.www1.artemis.web.rest.util.ResponseUtil.forbidden;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.Optional;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.PostMapping;\n+import org.springframework.web.bind.annotation.PutMapping;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+import org.springframework.web.server.ResponseStatusException;\n+\n+import de.tum.in.www1.artemis.domain.Rating;\n+import de.tum.in.www1.artemis.domain.Result;\n+import de.tum.in.www1.artemis.domain.User;\n+import de.tum.in.www1.artemis.domain.participation.StudentParticipation;\n+import de.tum.in.www1.artemis.service.AuthorizationCheckService;\n+import de.tum.in.www1.artemis.service.ParticipationService;\n+import de.tum.in.www1.artemis.service.RatingService;\n+import de.tum.in.www1.artemis.service.ResultService;\n+import de.tum.in.www1.artemis.service.UserService;\n+\n+/**\n+ * REST controller for managing Rating.\n+ */\n+@RestController\n+@RequestMapping(\"/api\")\n+public class RatingResource {\n+\n+    private static final String ENTITY_NAME = \"rating\";\n+\n+    private final Logger log = LoggerFactory.getLogger(RatingResource.class);\n+\n+    private final RatingService ratingService;\n+\n+    private final UserService userService;\n+\n+    private final AuthorizationCheckService authCheckService;\n+\n+    private final ResultService resultService;\n+\n+    private final ParticipationService participationService;\n+\n+    public RatingResource(RatingService ratingService, UserService userService, AuthorizationCheckService authCheckService, ResultService resultService,\n+            ParticipationService participationService) {\n+        this.ratingService = ratingService;\n+        this.userService = userService;\n+        this.authCheckService = authCheckService;\n+        this.resultService = resultService;\n+        this.participationService = participationService;\n+    }\n+\n+    /**\n+     * Return Rating referencing resultId or 404 Not Found\n+     *\n+     * @param resultId - Id of result that is referenced with the rating\n+     * @return Rating or 404 Not Found\n+     */\n+    @GetMapping(\"/results/{resultId}/rating\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Rating> getRatingForResult(@PathVariable Long resultId) {\n+        Optional<Rating> rating = this.ratingService.findRatingByResultId(resultId);\n+        if (rating.isEmpty()) {\n+            throw new ResponseStatusException(HttpStatus.NOT_FOUND, \"Rating does not exist!\");\n+        }\n+        return ResponseEntity.ok(rating.get());\n+    }\n+\n+    /**\n+     * Persist a new Rating\n+     *\n+     * @param resultId    - Id of the rating that should be updated\n+     * @param ratingValue - Value of the updated rating\n+     * @return inserted Rating\n+     * @throws URISyntaxException if the Location URI syntax is incorrect\n+     */\n+    @PostMapping(\"/results/{resultId}/rating/{ratingValue}\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Rating> createRatingForResult(@PathVariable Long resultId, @PathVariable Integer ratingValue) throws URISyntaxException {\n+        User user = userService.getUser();\n+        Result res = resultService.findOne(resultId);\n+        StudentParticipation participation = participationService.findOneStudentParticipation(res.getParticipation().getId());\n+        if (!authCheckService.isOwnerOfParticipation(participation, user)) {\n+            return forbidden();\n+        }\n+\n+        Rating result = this.ratingService.saveRating(resultId, ratingValue);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "114f290e1b160b024cca9dc827af4a60e6293337"}, "originalPosition": 96}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MDA3Mjk4OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOToxOToxNVrOGaVxxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOToxOToxNVrOGaVxxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI3Mjk2NA==", "bodyText": "The name result is pretty confusing here since it's actually a Rating and not a Result. Better call it rating or savedRating.", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430272964", "createdAt": "2020-05-26T09:19:15Z", "author": {"login": "madwau"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "diffHunk": "@@ -0,0 +1,120 @@\n+package de.tum.in.www1.artemis.web.rest;\n+\n+import static de.tum.in.www1.artemis.web.rest.util.ResponseUtil.forbidden;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.Optional;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.PostMapping;\n+import org.springframework.web.bind.annotation.PutMapping;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+import org.springframework.web.server.ResponseStatusException;\n+\n+import de.tum.in.www1.artemis.domain.Rating;\n+import de.tum.in.www1.artemis.domain.Result;\n+import de.tum.in.www1.artemis.domain.User;\n+import de.tum.in.www1.artemis.domain.participation.StudentParticipation;\n+import de.tum.in.www1.artemis.service.AuthorizationCheckService;\n+import de.tum.in.www1.artemis.service.ParticipationService;\n+import de.tum.in.www1.artemis.service.RatingService;\n+import de.tum.in.www1.artemis.service.ResultService;\n+import de.tum.in.www1.artemis.service.UserService;\n+\n+/**\n+ * REST controller for managing Rating.\n+ */\n+@RestController\n+@RequestMapping(\"/api\")\n+public class RatingResource {\n+\n+    private static final String ENTITY_NAME = \"rating\";\n+\n+    private final Logger log = LoggerFactory.getLogger(RatingResource.class);\n+\n+    private final RatingService ratingService;\n+\n+    private final UserService userService;\n+\n+    private final AuthorizationCheckService authCheckService;\n+\n+    private final ResultService resultService;\n+\n+    private final ParticipationService participationService;\n+\n+    public RatingResource(RatingService ratingService, UserService userService, AuthorizationCheckService authCheckService, ResultService resultService,\n+            ParticipationService participationService) {\n+        this.ratingService = ratingService;\n+        this.userService = userService;\n+        this.authCheckService = authCheckService;\n+        this.resultService = resultService;\n+        this.participationService = participationService;\n+    }\n+\n+    /**\n+     * Return Rating referencing resultId or 404 Not Found\n+     *\n+     * @param resultId - Id of result that is referenced with the rating\n+     * @return Rating or 404 Not Found\n+     */\n+    @GetMapping(\"/results/{resultId}/rating\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Rating> getRatingForResult(@PathVariable Long resultId) {\n+        Optional<Rating> rating = this.ratingService.findRatingByResultId(resultId);\n+        if (rating.isEmpty()) {\n+            throw new ResponseStatusException(HttpStatus.NOT_FOUND, \"Rating does not exist!\");\n+        }\n+        return ResponseEntity.ok(rating.get());\n+    }\n+\n+    /**\n+     * Persist a new Rating\n+     *\n+     * @param resultId    - Id of the rating that should be updated\n+     * @param ratingValue - Value of the updated rating\n+     * @return inserted Rating\n+     * @throws URISyntaxException if the Location URI syntax is incorrect\n+     */\n+    @PostMapping(\"/results/{resultId}/rating/{ratingValue}\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Rating> createRatingForResult(@PathVariable Long resultId, @PathVariable Integer ratingValue) throws URISyntaxException {\n+        User user = userService.getUser();\n+        Result res = resultService.findOne(resultId);\n+        StudentParticipation participation = participationService.findOneStudentParticipation(res.getParticipation().getId());\n+        if (!authCheckService.isOwnerOfParticipation(participation, user)) {\n+            return forbidden();\n+        }\n+\n+        Rating result = this.ratingService.saveRating(resultId, ratingValue);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "114f290e1b160b024cca9dc827af4a60e6293337"}, "originalPosition": 96}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MDA3NTM0OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOToxOTo1N1rOGaVzVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOToxOTo1N1rOGaVzVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI3MzM2NA==", "bodyText": "Can be confusing for other developers since it assumes knowledge of the shared primary key.", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430273364", "createdAt": "2020-05-26T09:19:57Z", "author": {"login": "madwau"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "diffHunk": "@@ -0,0 +1,120 @@\n+package de.tum.in.www1.artemis.web.rest;\n+\n+import static de.tum.in.www1.artemis.web.rest.util.ResponseUtil.forbidden;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.Optional;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.PostMapping;\n+import org.springframework.web.bind.annotation.PutMapping;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+import org.springframework.web.server.ResponseStatusException;\n+\n+import de.tum.in.www1.artemis.domain.Rating;\n+import de.tum.in.www1.artemis.domain.Result;\n+import de.tum.in.www1.artemis.domain.User;\n+import de.tum.in.www1.artemis.domain.participation.StudentParticipation;\n+import de.tum.in.www1.artemis.service.AuthorizationCheckService;\n+import de.tum.in.www1.artemis.service.ParticipationService;\n+import de.tum.in.www1.artemis.service.RatingService;\n+import de.tum.in.www1.artemis.service.ResultService;\n+import de.tum.in.www1.artemis.service.UserService;\n+\n+/**\n+ * REST controller for managing Rating.\n+ */\n+@RestController\n+@RequestMapping(\"/api\")\n+public class RatingResource {\n+\n+    private static final String ENTITY_NAME = \"rating\";\n+\n+    private final Logger log = LoggerFactory.getLogger(RatingResource.class);\n+\n+    private final RatingService ratingService;\n+\n+    private final UserService userService;\n+\n+    private final AuthorizationCheckService authCheckService;\n+\n+    private final ResultService resultService;\n+\n+    private final ParticipationService participationService;\n+\n+    public RatingResource(RatingService ratingService, UserService userService, AuthorizationCheckService authCheckService, ResultService resultService,\n+            ParticipationService participationService) {\n+        this.ratingService = ratingService;\n+        this.userService = userService;\n+        this.authCheckService = authCheckService;\n+        this.resultService = resultService;\n+        this.participationService = participationService;\n+    }\n+\n+    /**\n+     * Return Rating referencing resultId or 404 Not Found\n+     *\n+     * @param resultId - Id of result that is referenced with the rating\n+     * @return Rating or 404 Not Found\n+     */\n+    @GetMapping(\"/results/{resultId}/rating\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Rating> getRatingForResult(@PathVariable Long resultId) {\n+        Optional<Rating> rating = this.ratingService.findRatingByResultId(resultId);\n+        if (rating.isEmpty()) {\n+            throw new ResponseStatusException(HttpStatus.NOT_FOUND, \"Rating does not exist!\");\n+        }\n+        return ResponseEntity.ok(rating.get());\n+    }\n+\n+    /**\n+     * Persist a new Rating\n+     *\n+     * @param resultId    - Id of the rating that should be updated", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "114f290e1b160b024cca9dc827af4a60e6293337"}, "originalPosition": 81}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MDA3NjEwOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOToyMDowN1rOGaVzyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOToyMDowN1rOGaVzyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI3MzQ4Mg==", "bodyText": "Can be confusing for other developers since it assumes knowledge of the shared primary key.", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430273482", "createdAt": "2020-05-26T09:20:07Z", "author": {"login": "madwau"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "diffHunk": "@@ -0,0 +1,120 @@\n+package de.tum.in.www1.artemis.web.rest;\n+\n+import static de.tum.in.www1.artemis.web.rest.util.ResponseUtil.forbidden;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.Optional;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.PostMapping;\n+import org.springframework.web.bind.annotation.PutMapping;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+import org.springframework.web.server.ResponseStatusException;\n+\n+import de.tum.in.www1.artemis.domain.Rating;\n+import de.tum.in.www1.artemis.domain.Result;\n+import de.tum.in.www1.artemis.domain.User;\n+import de.tum.in.www1.artemis.domain.participation.StudentParticipation;\n+import de.tum.in.www1.artemis.service.AuthorizationCheckService;\n+import de.tum.in.www1.artemis.service.ParticipationService;\n+import de.tum.in.www1.artemis.service.RatingService;\n+import de.tum.in.www1.artemis.service.ResultService;\n+import de.tum.in.www1.artemis.service.UserService;\n+\n+/**\n+ * REST controller for managing Rating.\n+ */\n+@RestController\n+@RequestMapping(\"/api\")\n+public class RatingResource {\n+\n+    private static final String ENTITY_NAME = \"rating\";\n+\n+    private final Logger log = LoggerFactory.getLogger(RatingResource.class);\n+\n+    private final RatingService ratingService;\n+\n+    private final UserService userService;\n+\n+    private final AuthorizationCheckService authCheckService;\n+\n+    private final ResultService resultService;\n+\n+    private final ParticipationService participationService;\n+\n+    public RatingResource(RatingService ratingService, UserService userService, AuthorizationCheckService authCheckService, ResultService resultService,\n+            ParticipationService participationService) {\n+        this.ratingService = ratingService;\n+        this.userService = userService;\n+        this.authCheckService = authCheckService;\n+        this.resultService = resultService;\n+        this.participationService = participationService;\n+    }\n+\n+    /**\n+     * Return Rating referencing resultId or 404 Not Found\n+     *\n+     * @param resultId - Id of result that is referenced with the rating\n+     * @return Rating or 404 Not Found\n+     */\n+    @GetMapping(\"/results/{resultId}/rating\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Rating> getRatingForResult(@PathVariable Long resultId) {\n+        Optional<Rating> rating = this.ratingService.findRatingByResultId(resultId);\n+        if (rating.isEmpty()) {\n+            throw new ResponseStatusException(HttpStatus.NOT_FOUND, \"Rating does not exist!\");\n+        }\n+        return ResponseEntity.ok(rating.get());\n+    }\n+\n+    /**\n+     * Persist a new Rating\n+     *\n+     * @param resultId    - Id of the rating that should be updated\n+     * @param ratingValue - Value of the updated rating\n+     * @return inserted Rating\n+     * @throws URISyntaxException if the Location URI syntax is incorrect\n+     */\n+    @PostMapping(\"/results/{resultId}/rating/{ratingValue}\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Rating> createRatingForResult(@PathVariable Long resultId, @PathVariable Integer ratingValue) throws URISyntaxException {\n+        User user = userService.getUser();\n+        Result res = resultService.findOne(resultId);\n+        StudentParticipation participation = participationService.findOneStudentParticipation(res.getParticipation().getId());\n+        if (!authCheckService.isOwnerOfParticipation(participation, user)) {\n+            return forbidden();\n+        }\n+\n+        Rating result = this.ratingService.saveRating(resultId, ratingValue);\n+        return ResponseEntity.created(new URI(\"/api/results/\" + result.getId() + \"/rating\")).body(result);\n+    }\n+\n+    /**\n+     * Update a Rating\n+     *\n+     * @param resultId    - Id of the rating that should be updated", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "114f290e1b160b024cca9dc827af4a60e6293337"}, "originalPosition": 103}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MDA3NzU1OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOToyMDozMlrOGaV0xA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOToyMDo1MlrOGaV1mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI3MzczMg==", "bodyText": "this. is not needed.", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430273732", "createdAt": "2020-05-26T09:20:32Z", "author": {"login": "madwau"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "diffHunk": "@@ -0,0 +1,120 @@\n+package de.tum.in.www1.artemis.web.rest;\n+\n+import static de.tum.in.www1.artemis.web.rest.util.ResponseUtil.forbidden;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.Optional;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.PostMapping;\n+import org.springframework.web.bind.annotation.PutMapping;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+import org.springframework.web.server.ResponseStatusException;\n+\n+import de.tum.in.www1.artemis.domain.Rating;\n+import de.tum.in.www1.artemis.domain.Result;\n+import de.tum.in.www1.artemis.domain.User;\n+import de.tum.in.www1.artemis.domain.participation.StudentParticipation;\n+import de.tum.in.www1.artemis.service.AuthorizationCheckService;\n+import de.tum.in.www1.artemis.service.ParticipationService;\n+import de.tum.in.www1.artemis.service.RatingService;\n+import de.tum.in.www1.artemis.service.ResultService;\n+import de.tum.in.www1.artemis.service.UserService;\n+\n+/**\n+ * REST controller for managing Rating.\n+ */\n+@RestController\n+@RequestMapping(\"/api\")\n+public class RatingResource {\n+\n+    private static final String ENTITY_NAME = \"rating\";\n+\n+    private final Logger log = LoggerFactory.getLogger(RatingResource.class);\n+\n+    private final RatingService ratingService;\n+\n+    private final UserService userService;\n+\n+    private final AuthorizationCheckService authCheckService;\n+\n+    private final ResultService resultService;\n+\n+    private final ParticipationService participationService;\n+\n+    public RatingResource(RatingService ratingService, UserService userService, AuthorizationCheckService authCheckService, ResultService resultService,\n+            ParticipationService participationService) {\n+        this.ratingService = ratingService;\n+        this.userService = userService;\n+        this.authCheckService = authCheckService;\n+        this.resultService = resultService;\n+        this.participationService = participationService;\n+    }\n+\n+    /**\n+     * Return Rating referencing resultId or 404 Not Found\n+     *\n+     * @param resultId - Id of result that is referenced with the rating\n+     * @return Rating or 404 Not Found\n+     */\n+    @GetMapping(\"/results/{resultId}/rating\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Rating> getRatingForResult(@PathVariable Long resultId) {\n+        Optional<Rating> rating = this.ratingService.findRatingByResultId(resultId);\n+        if (rating.isEmpty()) {\n+            throw new ResponseStatusException(HttpStatus.NOT_FOUND, \"Rating does not exist!\");\n+        }\n+        return ResponseEntity.ok(rating.get());\n+    }\n+\n+    /**\n+     * Persist a new Rating\n+     *\n+     * @param resultId    - Id of the rating that should be updated\n+     * @param ratingValue - Value of the updated rating\n+     * @return inserted Rating\n+     * @throws URISyntaxException if the Location URI syntax is incorrect\n+     */\n+    @PostMapping(\"/results/{resultId}/rating/{ratingValue}\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Rating> createRatingForResult(@PathVariable Long resultId, @PathVariable Integer ratingValue) throws URISyntaxException {\n+        User user = userService.getUser();\n+        Result res = resultService.findOne(resultId);\n+        StudentParticipation participation = participationService.findOneStudentParticipation(res.getParticipation().getId());\n+        if (!authCheckService.isOwnerOfParticipation(participation, user)) {\n+            return forbidden();\n+        }\n+\n+        Rating result = this.ratingService.saveRating(resultId, ratingValue);\n+        return ResponseEntity.created(new URI(\"/api/results/\" + result.getId() + \"/rating\")).body(result);\n+    }\n+\n+    /**\n+     * Update a Rating\n+     *\n+     * @param resultId    - Id of the rating that should be updated\n+     * @param ratingValue - Value of the updated rating\n+     * @return updated Rating\n+     */\n+    @PutMapping(\"/results/{resultId}/rating/{ratingValue}\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Rating> updateRatingForResult(@PathVariable Long resultId, @PathVariable Integer ratingValue) {\n+        User user = userService.getUser();\n+        Result res = resultService.findOne(resultId);\n+        StudentParticipation participation = participationService.findOneStudentParticipation(res.getParticipation().getId());\n+        if (!authCheckService.isOwnerOfParticipation(participation, user)) {\n+            return forbidden();\n+        }\n+\n+        Rating result = this.ratingService.updateRating(resultId, ratingValue);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "114f290e1b160b024cca9dc827af4a60e6293337"}, "originalPosition": 117}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI3Mzk0Ng==", "bodyText": "The name result is pretty confusing here since it's actually a Rating and not a Result. Better call it rating or updatedRating.", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430273946", "createdAt": "2020-05-26T09:20:52Z", "author": {"login": "madwau"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "diffHunk": "@@ -0,0 +1,120 @@\n+package de.tum.in.www1.artemis.web.rest;\n+\n+import static de.tum.in.www1.artemis.web.rest.util.ResponseUtil.forbidden;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.Optional;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.PostMapping;\n+import org.springframework.web.bind.annotation.PutMapping;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+import org.springframework.web.server.ResponseStatusException;\n+\n+import de.tum.in.www1.artemis.domain.Rating;\n+import de.tum.in.www1.artemis.domain.Result;\n+import de.tum.in.www1.artemis.domain.User;\n+import de.tum.in.www1.artemis.domain.participation.StudentParticipation;\n+import de.tum.in.www1.artemis.service.AuthorizationCheckService;\n+import de.tum.in.www1.artemis.service.ParticipationService;\n+import de.tum.in.www1.artemis.service.RatingService;\n+import de.tum.in.www1.artemis.service.ResultService;\n+import de.tum.in.www1.artemis.service.UserService;\n+\n+/**\n+ * REST controller for managing Rating.\n+ */\n+@RestController\n+@RequestMapping(\"/api\")\n+public class RatingResource {\n+\n+    private static final String ENTITY_NAME = \"rating\";\n+\n+    private final Logger log = LoggerFactory.getLogger(RatingResource.class);\n+\n+    private final RatingService ratingService;\n+\n+    private final UserService userService;\n+\n+    private final AuthorizationCheckService authCheckService;\n+\n+    private final ResultService resultService;\n+\n+    private final ParticipationService participationService;\n+\n+    public RatingResource(RatingService ratingService, UserService userService, AuthorizationCheckService authCheckService, ResultService resultService,\n+            ParticipationService participationService) {\n+        this.ratingService = ratingService;\n+        this.userService = userService;\n+        this.authCheckService = authCheckService;\n+        this.resultService = resultService;\n+        this.participationService = participationService;\n+    }\n+\n+    /**\n+     * Return Rating referencing resultId or 404 Not Found\n+     *\n+     * @param resultId - Id of result that is referenced with the rating\n+     * @return Rating or 404 Not Found\n+     */\n+    @GetMapping(\"/results/{resultId}/rating\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Rating> getRatingForResult(@PathVariable Long resultId) {\n+        Optional<Rating> rating = this.ratingService.findRatingByResultId(resultId);\n+        if (rating.isEmpty()) {\n+            throw new ResponseStatusException(HttpStatus.NOT_FOUND, \"Rating does not exist!\");\n+        }\n+        return ResponseEntity.ok(rating.get());\n+    }\n+\n+    /**\n+     * Persist a new Rating\n+     *\n+     * @param resultId    - Id of the rating that should be updated\n+     * @param ratingValue - Value of the updated rating\n+     * @return inserted Rating\n+     * @throws URISyntaxException if the Location URI syntax is incorrect\n+     */\n+    @PostMapping(\"/results/{resultId}/rating/{ratingValue}\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Rating> createRatingForResult(@PathVariable Long resultId, @PathVariable Integer ratingValue) throws URISyntaxException {\n+        User user = userService.getUser();\n+        Result res = resultService.findOne(resultId);\n+        StudentParticipation participation = participationService.findOneStudentParticipation(res.getParticipation().getId());\n+        if (!authCheckService.isOwnerOfParticipation(participation, user)) {\n+            return forbidden();\n+        }\n+\n+        Rating result = this.ratingService.saveRating(resultId, ratingValue);\n+        return ResponseEntity.created(new URI(\"/api/results/\" + result.getId() + \"/rating\")).body(result);\n+    }\n+\n+    /**\n+     * Update a Rating\n+     *\n+     * @param resultId    - Id of the rating that should be updated\n+     * @param ratingValue - Value of the updated rating\n+     * @return updated Rating\n+     */\n+    @PutMapping(\"/results/{resultId}/rating/{ratingValue}\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Rating> updateRatingForResult(@PathVariable Long resultId, @PathVariable Integer ratingValue) {\n+        User user = userService.getUser();\n+        Result res = resultService.findOne(resultId);\n+        StudentParticipation participation = participationService.findOneStudentParticipation(res.getParticipation().getId());\n+        if (!authCheckService.isOwnerOfParticipation(participation, user)) {\n+            return forbidden();\n+        }\n+\n+        Rating result = this.ratingService.updateRating(resultId, ratingValue);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI3MzczMg=="}, "originalCommit": {"oid": "114f290e1b160b024cca9dc827af4a60e6293337"}, "originalPosition": 117}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MDA5NzUwOnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/exercises/shared/rating/rating.component.ts", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOToyNjowNFrOGaWByA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOToyNjowNFrOGaWByA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI3NzA2NA==", "bodyText": "Constructor should be at the top.", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430277064", "createdAt": "2020-05-26T09:26:04Z", "author": {"login": "madwau"}, "path": "src/main/webapp/app/exercises/shared/rating/rating.component.ts", "diffHunk": "@@ -0,0 +1,59 @@\n+import { Component, Input } from '@angular/core';\n+import { RatingService } from 'app/exercises/shared/rating/rating.service';\n+import { StarRatingComponent } from 'ng-starrating';\n+import { Result } from 'app/entities/result.model';\n+import { Rating } from 'app/entities/rating.model';\n+\n+@Component({\n+    selector: 'jhi-rating',\n+    providers: [RatingService],\n+    templateUrl: './rating.component.html',\n+    styleUrls: ['./rating.component.scss'],\n+})\n+export class RatingComponent {\n+    // public ratingValue = 2;\n+    public rating: Rating;\n+    private _result: Result;\n+\n+    /**\n+     * Result Input of the result that the rating is for\n+     * @param result\n+     */\n+    @Input()\n+    public set result(result: Result) {\n+        if (!result || !result.submission) {\n+            return;\n+        }\n+        this._result = result;\n+        this.ratingService.getRating(result.id).subscribe(\n+            (rating) => {\n+                this.rating = rating;\n+            },\n+            () => {\n+                this.rating = new Rating(result, 0);\n+            },\n+        );\n+    }\n+\n+    constructor(public ratingService: RatingService) {}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "114f290e1b160b024cca9dc827af4a60e6293337"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MDEwMjE0OnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/exercises/shared/rating/rating.component.ts", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOToyNzoyMFrOGaWE2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOToyNzoyMFrOGaWE2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI3Nzg1MA==", "bodyText": "I don't think we use this syntax of prefixing private attributes with an underscore at the moment.", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430277850", "createdAt": "2020-05-26T09:27:20Z", "author": {"login": "madwau"}, "path": "src/main/webapp/app/exercises/shared/rating/rating.component.ts", "diffHunk": "@@ -0,0 +1,59 @@\n+import { Component, Input } from '@angular/core';\n+import { RatingService } from 'app/exercises/shared/rating/rating.service';\n+import { StarRatingComponent } from 'ng-starrating';\n+import { Result } from 'app/entities/result.model';\n+import { Rating } from 'app/entities/rating.model';\n+\n+@Component({\n+    selector: 'jhi-rating',\n+    providers: [RatingService],\n+    templateUrl: './rating.component.html',\n+    styleUrls: ['./rating.component.scss'],\n+})\n+export class RatingComponent {\n+    // public ratingValue = 2;\n+    public rating: Rating;\n+    private _result: Result;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "114f290e1b160b024cca9dc827af4a60e6293337"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MDEwMzk1OnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/exercises/shared/rating/rating.component.ts", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOToyNzo0NFrOGaWF7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOToyNzo0NFrOGaWF7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI3ODEyNQ==", "bodyText": "Can this be removed?", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430278125", "createdAt": "2020-05-26T09:27:44Z", "author": {"login": "madwau"}, "path": "src/main/webapp/app/exercises/shared/rating/rating.component.ts", "diffHunk": "@@ -0,0 +1,59 @@\n+import { Component, Input } from '@angular/core';\n+import { RatingService } from 'app/exercises/shared/rating/rating.service';\n+import { StarRatingComponent } from 'ng-starrating';\n+import { Result } from 'app/entities/result.model';\n+import { Rating } from 'app/entities/rating.model';\n+\n+@Component({\n+    selector: 'jhi-rating',\n+    providers: [RatingService],\n+    templateUrl: './rating.component.html',\n+    styleUrls: ['./rating.component.scss'],\n+})\n+export class RatingComponent {\n+    // public ratingValue = 2;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "114f290e1b160b024cca9dc827af4a60e6293337"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MDExMDgwOnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/exercises/shared/rating/rating.service.ts", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOToyOTozMVrOGaWKQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOToyOTozMVrOGaWKQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI3OTIzMw==", "bodyText": "I think the word update should be avoided here since it could be misinterpreted as: The rating already exists and we want to update it (even though this is not the case here, it is being created).", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430279233", "createdAt": "2020-05-26T09:29:31Z", "author": {"login": "madwau"}, "path": "src/main/webapp/app/exercises/shared/rating/rating.service.ts", "diffHunk": "@@ -0,0 +1,38 @@\n+import { Injectable } from '@angular/core';\n+import { HttpClient } from '@angular/common/http';\n+import { Observable } from 'rxjs/Observable';\n+import { Rating } from 'app/entities/rating.model';\n+import { SERVER_API_URL } from 'app/app.constants';\n+\n+@Injectable({\n+    providedIn: 'root',\n+})\n+export class RatingService {\n+    private ratingResourceUrl = SERVER_API_URL + 'api/results/';\n+\n+    constructor(private http: HttpClient) {}\n+\n+    /**\n+     * Update the student rating for feedback on the server.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "114f290e1b160b024cca9dc827af4a60e6293337"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MDExMjEyOnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/exercises/shared/rating/rating.service.ts", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOToyOTo1NFrOGaWLGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOToyOTo1NFrOGaWLGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI3OTQ1MA==", "bodyText": "I think createRating might be better to avoid confusion with updateRating.", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430279450", "createdAt": "2020-05-26T09:29:54Z", "author": {"login": "madwau"}, "path": "src/main/webapp/app/exercises/shared/rating/rating.service.ts", "diffHunk": "@@ -0,0 +1,38 @@\n+import { Injectable } from '@angular/core';\n+import { HttpClient } from '@angular/common/http';\n+import { Observable } from 'rxjs/Observable';\n+import { Rating } from 'app/entities/rating.model';\n+import { SERVER_API_URL } from 'app/app.constants';\n+\n+@Injectable({\n+    providedIn: 'root',\n+})\n+export class RatingService {\n+    private ratingResourceUrl = SERVER_API_URL + 'api/results/';\n+\n+    constructor(private http: HttpClient) {}\n+\n+    /**\n+     * Update the student rating for feedback on the server.\n+     * @param rating - Rating for the result\n+     */\n+    setRating(rating: Rating): Observable<Rating> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "114f290e1b160b024cca9dc827af4a60e6293337"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MDEyMTcwOnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/exercises/shared/rating/rating.component.ts", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOTozMjozNVrOGaWRTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOTozMjozNVrOGaWRTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI4MTAzOA==", "bodyText": "Is this construction needed compared to a normal @Input declaration and loading the result in ngOnInit?", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430281038", "createdAt": "2020-05-26T09:32:35Z", "author": {"login": "madwau"}, "path": "src/main/webapp/app/exercises/shared/rating/rating.component.ts", "diffHunk": "@@ -0,0 +1,59 @@\n+import { Component, Input } from '@angular/core';\n+import { RatingService } from 'app/exercises/shared/rating/rating.service';\n+import { StarRatingComponent } from 'ng-starrating';\n+import { Result } from 'app/entities/result.model';\n+import { Rating } from 'app/entities/rating.model';\n+\n+@Component({\n+    selector: 'jhi-rating',\n+    providers: [RatingService],\n+    templateUrl: './rating.component.html',\n+    styleUrls: ['./rating.component.scss'],\n+})\n+export class RatingComponent {\n+    // public ratingValue = 2;\n+    public rating: Rating;\n+    private _result: Result;\n+\n+    /**\n+     * Result Input of the result that the rating is for\n+     * @param result\n+     */\n+    @Input()\n+    public set result(result: Result) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "114f290e1b160b024cca9dc827af4a60e6293337"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MDEyNjQ0OnYy", "diffSide": "RIGHT", "path": "src/test/java/de/tum/in/www1/artemis/RatingResourceIntegrationTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOTozMzo1M1rOGaWUVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOTozMzo1M1rOGaWUVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI4MTgxNA==", "bodyText": "It would be good to add some assertions on the saved entity, e.g. that it belongs to the correct result and that the rating value is correct.", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430281814", "createdAt": "2020-05-26T09:33:53Z", "author": {"login": "madwau"}, "path": "src/test/java/de/tum/in/www1/artemis/RatingResourceIntegrationTest.java", "diffHunk": "@@ -0,0 +1,136 @@\n+package de.tum.in.www1.artemis;\n+\n+import java.util.List;\n+\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import de.tum.in.www1.artemis.domain.Rating;\n+import de.tum.in.www1.artemis.domain.Result;\n+import de.tum.in.www1.artemis.domain.TextExercise;\n+import de.tum.in.www1.artemis.domain.TextSubmission;\n+import de.tum.in.www1.artemis.domain.User;\n+import de.tum.in.www1.artemis.domain.enumeration.Language;\n+import de.tum.in.www1.artemis.domain.participation.Participation;\n+import de.tum.in.www1.artemis.repository.CourseRepository;\n+import de.tum.in.www1.artemis.repository.ExerciseRepository;\n+import de.tum.in.www1.artemis.repository.RatingRepository;\n+import de.tum.in.www1.artemis.repository.ResultRepository;\n+import de.tum.in.www1.artemis.repository.SubmissionRepository;\n+import de.tum.in.www1.artemis.repository.UserRepository;\n+import de.tum.in.www1.artemis.service.RatingService;\n+import de.tum.in.www1.artemis.service.UserService;\n+import de.tum.in.www1.artemis.util.DatabaseUtilService;\n+import de.tum.in.www1.artemis.util.ModelFactory;\n+import de.tum.in.www1.artemis.util.RequestUtilService;\n+\n+public class RatingResourceIntegrationTest extends AbstractSpringIntegrationBambooBitbucketJiraTest {\n+\n+    @Autowired\n+    CourseRepository courseRepository;\n+\n+    @Autowired\n+    ExerciseRepository exerciseRepo;\n+\n+    @Autowired\n+    ResultRepository resultRepo;\n+\n+    @Autowired\n+    UserService userService;\n+\n+    @Autowired\n+    DatabaseUtilService database;\n+\n+    @Autowired\n+    RequestUtilService request;\n+\n+    @Autowired\n+    UserRepository userRepository;\n+\n+    @Autowired\n+    RatingService ratingService;\n+\n+    @Autowired\n+    RatingRepository ratingRepo;\n+\n+    @Autowired\n+    SubmissionRepository submissionRepo;\n+\n+    private TextExercise exercise;\n+\n+    private List<User> users;\n+\n+    private TextSubmission submission;\n+\n+    private Result result;\n+\n+    private Rating rating;\n+\n+    @BeforeEach\n+    public void initTestCase() {\n+        users = database.addUsers(2, 1, 1);\n+        database.addCourseWithOneTextExercise();\n+        exercise = (TextExercise) exerciseRepo.findAll().get(0);\n+        User student1 = users.get(0);\n+        Participation participation = database.addParticipationForExercise(exercise, student1.getLogin());\n+\n+        submission = ModelFactory.generateTextSubmission(\"example text\", Language.ENGLISH, true);\n+        submission = database.addTextSubmission(exercise, submission, student1.getLogin());\n+\n+        result = ModelFactory.generateResult(true, 0);\n+        result = database.addResultToSubmission(submission);\n+\n+        rating = new Rating();\n+        rating.setResult(result);\n+        rating.setRating(2);\n+    }\n+\n+    @AfterEach\n+    public void tearDown() {\n+        ratingRepo.deleteAll();\n+        database.resetDatabase();\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"student1\", roles = \"USER\")\n+    public void testCreateRating_asUser() throws Exception {\n+        request.post(\"/api/results/\" + result.getId() + \"/rating/\" + rating.getRating(), null, HttpStatus.CREATED);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "114f290e1b160b024cca9dc827af4a60e6293337"}, "originalPosition": 101}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MDEzNDYwOnYy", "diffSide": "RIGHT", "path": "src/test/java/de/tum/in/www1/artemis/RatingResourceIntegrationTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOTozNTo1N1rOGaWZaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOTozNTo1N1rOGaWZaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI4MzExMw==", "bodyText": "The name result is confusing in this context. Should be changed to rating or savedRating. Then the this. is also not needed anymore.", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430283113", "createdAt": "2020-05-26T09:35:57Z", "author": {"login": "madwau"}, "path": "src/test/java/de/tum/in/www1/artemis/RatingResourceIntegrationTest.java", "diffHunk": "@@ -0,0 +1,136 @@\n+package de.tum.in.www1.artemis;\n+\n+import java.util.List;\n+\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import de.tum.in.www1.artemis.domain.Rating;\n+import de.tum.in.www1.artemis.domain.Result;\n+import de.tum.in.www1.artemis.domain.TextExercise;\n+import de.tum.in.www1.artemis.domain.TextSubmission;\n+import de.tum.in.www1.artemis.domain.User;\n+import de.tum.in.www1.artemis.domain.enumeration.Language;\n+import de.tum.in.www1.artemis.domain.participation.Participation;\n+import de.tum.in.www1.artemis.repository.CourseRepository;\n+import de.tum.in.www1.artemis.repository.ExerciseRepository;\n+import de.tum.in.www1.artemis.repository.RatingRepository;\n+import de.tum.in.www1.artemis.repository.ResultRepository;\n+import de.tum.in.www1.artemis.repository.SubmissionRepository;\n+import de.tum.in.www1.artemis.repository.UserRepository;\n+import de.tum.in.www1.artemis.service.RatingService;\n+import de.tum.in.www1.artemis.service.UserService;\n+import de.tum.in.www1.artemis.util.DatabaseUtilService;\n+import de.tum.in.www1.artemis.util.ModelFactory;\n+import de.tum.in.www1.artemis.util.RequestUtilService;\n+\n+public class RatingResourceIntegrationTest extends AbstractSpringIntegrationBambooBitbucketJiraTest {\n+\n+    @Autowired\n+    CourseRepository courseRepository;\n+\n+    @Autowired\n+    ExerciseRepository exerciseRepo;\n+\n+    @Autowired\n+    ResultRepository resultRepo;\n+\n+    @Autowired\n+    UserService userService;\n+\n+    @Autowired\n+    DatabaseUtilService database;\n+\n+    @Autowired\n+    RequestUtilService request;\n+\n+    @Autowired\n+    UserRepository userRepository;\n+\n+    @Autowired\n+    RatingService ratingService;\n+\n+    @Autowired\n+    RatingRepository ratingRepo;\n+\n+    @Autowired\n+    SubmissionRepository submissionRepo;\n+\n+    private TextExercise exercise;\n+\n+    private List<User> users;\n+\n+    private TextSubmission submission;\n+\n+    private Result result;\n+\n+    private Rating rating;\n+\n+    @BeforeEach\n+    public void initTestCase() {\n+        users = database.addUsers(2, 1, 1);\n+        database.addCourseWithOneTextExercise();\n+        exercise = (TextExercise) exerciseRepo.findAll().get(0);\n+        User student1 = users.get(0);\n+        Participation participation = database.addParticipationForExercise(exercise, student1.getLogin());\n+\n+        submission = ModelFactory.generateTextSubmission(\"example text\", Language.ENGLISH, true);\n+        submission = database.addTextSubmission(exercise, submission, student1.getLogin());\n+\n+        result = ModelFactory.generateResult(true, 0);\n+        result = database.addResultToSubmission(submission);\n+\n+        rating = new Rating();\n+        rating.setResult(result);\n+        rating.setRating(2);\n+    }\n+\n+    @AfterEach\n+    public void tearDown() {\n+        ratingRepo.deleteAll();\n+        database.resetDatabase();\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"student1\", roles = \"USER\")\n+    public void testCreateRating_asUser() throws Exception {\n+        request.post(\"/api/results/\" + result.getId() + \"/rating/\" + rating.getRating(), null, HttpStatus.CREATED);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void testCreateRating_asTutor_FORBIDDEN() throws Exception {\n+        request.post(\"/api/results/\" + result.getId() + \"/rating/\" + rating.getRating(), null, HttpStatus.FORBIDDEN);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"student1\", roles = \"USER\")\n+    public void testGetRating_asUser() throws Exception {\n+        Rating result = ratingService.saveRating(this.result.getId(), rating.getRating());\n+        request.get(\"/api/results/\" + result.getId() + \"/rating\", HttpStatus.OK, Rating.class);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"student1\", roles = \"USER\")\n+    public void testGetRating_asUser_NOT_FOUND() throws Exception {\n+        request.get(\"/api/results/\" + result.getId() + \"/rating\", HttpStatus.NOT_FOUND, Rating.class);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"student1\", roles = \"USER\")\n+    public void testUpdateRating_asUser() throws Exception {\n+        Rating result = ratingService.saveRating(this.result.getId(), rating.getRating());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "114f290e1b160b024cca9dc827af4a60e6293337"}, "originalPosition": 126}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MDEzOTIwOnYy", "diffSide": "RIGHT", "path": "src/test/java/de/tum/in/www1/artemis/RatingResourceIntegrationTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOTozNzoxMlrOGaWcPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOTozNzoxMlrOGaWcPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI4MzgzNw==", "bodyText": "Assertions are missing. Also, what is being tested here? Wouldn't it be better if an actual change to the rating value was tested and verified?", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430283837", "createdAt": "2020-05-26T09:37:12Z", "author": {"login": "madwau"}, "path": "src/test/java/de/tum/in/www1/artemis/RatingResourceIntegrationTest.java", "diffHunk": "@@ -0,0 +1,136 @@\n+package de.tum.in.www1.artemis;\n+\n+import java.util.List;\n+\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import de.tum.in.www1.artemis.domain.Rating;\n+import de.tum.in.www1.artemis.domain.Result;\n+import de.tum.in.www1.artemis.domain.TextExercise;\n+import de.tum.in.www1.artemis.domain.TextSubmission;\n+import de.tum.in.www1.artemis.domain.User;\n+import de.tum.in.www1.artemis.domain.enumeration.Language;\n+import de.tum.in.www1.artemis.domain.participation.Participation;\n+import de.tum.in.www1.artemis.repository.CourseRepository;\n+import de.tum.in.www1.artemis.repository.ExerciseRepository;\n+import de.tum.in.www1.artemis.repository.RatingRepository;\n+import de.tum.in.www1.artemis.repository.ResultRepository;\n+import de.tum.in.www1.artemis.repository.SubmissionRepository;\n+import de.tum.in.www1.artemis.repository.UserRepository;\n+import de.tum.in.www1.artemis.service.RatingService;\n+import de.tum.in.www1.artemis.service.UserService;\n+import de.tum.in.www1.artemis.util.DatabaseUtilService;\n+import de.tum.in.www1.artemis.util.ModelFactory;\n+import de.tum.in.www1.artemis.util.RequestUtilService;\n+\n+public class RatingResourceIntegrationTest extends AbstractSpringIntegrationBambooBitbucketJiraTest {\n+\n+    @Autowired\n+    CourseRepository courseRepository;\n+\n+    @Autowired\n+    ExerciseRepository exerciseRepo;\n+\n+    @Autowired\n+    ResultRepository resultRepo;\n+\n+    @Autowired\n+    UserService userService;\n+\n+    @Autowired\n+    DatabaseUtilService database;\n+\n+    @Autowired\n+    RequestUtilService request;\n+\n+    @Autowired\n+    UserRepository userRepository;\n+\n+    @Autowired\n+    RatingService ratingService;\n+\n+    @Autowired\n+    RatingRepository ratingRepo;\n+\n+    @Autowired\n+    SubmissionRepository submissionRepo;\n+\n+    private TextExercise exercise;\n+\n+    private List<User> users;\n+\n+    private TextSubmission submission;\n+\n+    private Result result;\n+\n+    private Rating rating;\n+\n+    @BeforeEach\n+    public void initTestCase() {\n+        users = database.addUsers(2, 1, 1);\n+        database.addCourseWithOneTextExercise();\n+        exercise = (TextExercise) exerciseRepo.findAll().get(0);\n+        User student1 = users.get(0);\n+        Participation participation = database.addParticipationForExercise(exercise, student1.getLogin());\n+\n+        submission = ModelFactory.generateTextSubmission(\"example text\", Language.ENGLISH, true);\n+        submission = database.addTextSubmission(exercise, submission, student1.getLogin());\n+\n+        result = ModelFactory.generateResult(true, 0);\n+        result = database.addResultToSubmission(submission);\n+\n+        rating = new Rating();\n+        rating.setResult(result);\n+        rating.setRating(2);\n+    }\n+\n+    @AfterEach\n+    public void tearDown() {\n+        ratingRepo.deleteAll();\n+        database.resetDatabase();\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"student1\", roles = \"USER\")\n+    public void testCreateRating_asUser() throws Exception {\n+        request.post(\"/api/results/\" + result.getId() + \"/rating/\" + rating.getRating(), null, HttpStatus.CREATED);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void testCreateRating_asTutor_FORBIDDEN() throws Exception {\n+        request.post(\"/api/results/\" + result.getId() + \"/rating/\" + rating.getRating(), null, HttpStatus.FORBIDDEN);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"student1\", roles = \"USER\")\n+    public void testGetRating_asUser() throws Exception {\n+        Rating result = ratingService.saveRating(this.result.getId(), rating.getRating());\n+        request.get(\"/api/results/\" + result.getId() + \"/rating\", HttpStatus.OK, Rating.class);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"student1\", roles = \"USER\")\n+    public void testGetRating_asUser_NOT_FOUND() throws Exception {\n+        request.get(\"/api/results/\" + result.getId() + \"/rating\", HttpStatus.NOT_FOUND, Rating.class);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"student1\", roles = \"USER\")\n+    public void testUpdateRating_asUser() throws Exception {\n+        Rating result = ratingService.saveRating(this.result.getId(), rating.getRating());\n+        request.put(\"/api/results/\" + result.getId() + \"/rating/\" + rating.getRating(), null, HttpStatus.OK);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "114f290e1b160b024cca9dc827af4a60e6293337"}, "originalPosition": 127}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MDEzOTk3OnYy", "diffSide": "RIGHT", "path": "src/test/java/de/tum/in/www1/artemis/RatingResourceIntegrationTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOTozNzoyNVrOGaWcwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOTozNzoyNVrOGaWcwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI4Mzk2OQ==", "bodyText": "See above.", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430283969", "createdAt": "2020-05-26T09:37:25Z", "author": {"login": "madwau"}, "path": "src/test/java/de/tum/in/www1/artemis/RatingResourceIntegrationTest.java", "diffHunk": "@@ -0,0 +1,136 @@\n+package de.tum.in.www1.artemis;\n+\n+import java.util.List;\n+\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import de.tum.in.www1.artemis.domain.Rating;\n+import de.tum.in.www1.artemis.domain.Result;\n+import de.tum.in.www1.artemis.domain.TextExercise;\n+import de.tum.in.www1.artemis.domain.TextSubmission;\n+import de.tum.in.www1.artemis.domain.User;\n+import de.tum.in.www1.artemis.domain.enumeration.Language;\n+import de.tum.in.www1.artemis.domain.participation.Participation;\n+import de.tum.in.www1.artemis.repository.CourseRepository;\n+import de.tum.in.www1.artemis.repository.ExerciseRepository;\n+import de.tum.in.www1.artemis.repository.RatingRepository;\n+import de.tum.in.www1.artemis.repository.ResultRepository;\n+import de.tum.in.www1.artemis.repository.SubmissionRepository;\n+import de.tum.in.www1.artemis.repository.UserRepository;\n+import de.tum.in.www1.artemis.service.RatingService;\n+import de.tum.in.www1.artemis.service.UserService;\n+import de.tum.in.www1.artemis.util.DatabaseUtilService;\n+import de.tum.in.www1.artemis.util.ModelFactory;\n+import de.tum.in.www1.artemis.util.RequestUtilService;\n+\n+public class RatingResourceIntegrationTest extends AbstractSpringIntegrationBambooBitbucketJiraTest {\n+\n+    @Autowired\n+    CourseRepository courseRepository;\n+\n+    @Autowired\n+    ExerciseRepository exerciseRepo;\n+\n+    @Autowired\n+    ResultRepository resultRepo;\n+\n+    @Autowired\n+    UserService userService;\n+\n+    @Autowired\n+    DatabaseUtilService database;\n+\n+    @Autowired\n+    RequestUtilService request;\n+\n+    @Autowired\n+    UserRepository userRepository;\n+\n+    @Autowired\n+    RatingService ratingService;\n+\n+    @Autowired\n+    RatingRepository ratingRepo;\n+\n+    @Autowired\n+    SubmissionRepository submissionRepo;\n+\n+    private TextExercise exercise;\n+\n+    private List<User> users;\n+\n+    private TextSubmission submission;\n+\n+    private Result result;\n+\n+    private Rating rating;\n+\n+    @BeforeEach\n+    public void initTestCase() {\n+        users = database.addUsers(2, 1, 1);\n+        database.addCourseWithOneTextExercise();\n+        exercise = (TextExercise) exerciseRepo.findAll().get(0);\n+        User student1 = users.get(0);\n+        Participation participation = database.addParticipationForExercise(exercise, student1.getLogin());\n+\n+        submission = ModelFactory.generateTextSubmission(\"example text\", Language.ENGLISH, true);\n+        submission = database.addTextSubmission(exercise, submission, student1.getLogin());\n+\n+        result = ModelFactory.generateResult(true, 0);\n+        result = database.addResultToSubmission(submission);\n+\n+        rating = new Rating();\n+        rating.setResult(result);\n+        rating.setRating(2);\n+    }\n+\n+    @AfterEach\n+    public void tearDown() {\n+        ratingRepo.deleteAll();\n+        database.resetDatabase();\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"student1\", roles = \"USER\")\n+    public void testCreateRating_asUser() throws Exception {\n+        request.post(\"/api/results/\" + result.getId() + \"/rating/\" + rating.getRating(), null, HttpStatus.CREATED);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void testCreateRating_asTutor_FORBIDDEN() throws Exception {\n+        request.post(\"/api/results/\" + result.getId() + \"/rating/\" + rating.getRating(), null, HttpStatus.FORBIDDEN);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"student1\", roles = \"USER\")\n+    public void testGetRating_asUser() throws Exception {\n+        Rating result = ratingService.saveRating(this.result.getId(), rating.getRating());\n+        request.get(\"/api/results/\" + result.getId() + \"/rating\", HttpStatus.OK, Rating.class);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"student1\", roles = \"USER\")\n+    public void testGetRating_asUser_NOT_FOUND() throws Exception {\n+        request.get(\"/api/results/\" + result.getId() + \"/rating\", HttpStatus.NOT_FOUND, Rating.class);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"student1\", roles = \"USER\")\n+    public void testUpdateRating_asUser() throws Exception {\n+        Rating result = ratingService.saveRating(this.result.getId(), rating.getRating());\n+        request.put(\"/api/results/\" + result.getId() + \"/rating/\" + rating.getRating(), null, HttpStatus.OK);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void testUpdateRating_asTutor_FORBIDDEN() throws Exception {\n+        Rating result = ratingService.saveRating(this.result.getId(), rating.getRating());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "114f290e1b160b024cca9dc827af4a60e6293337"}, "originalPosition": 133}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MDE5ODM2OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/domain/Rating.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOTo1Mzo0NlrOGaXCIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOTo1Mzo0NlrOGaXCIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI5MzUzNg==", "bodyText": "Depending on the usage a @JsonIgnore could be added since right now the whole result is always serialized when a rating is returned by the server although it's not actually needed for the current use case as far as I can see.", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r430293536", "createdAt": "2020-05-26T09:53:46Z", "author": {"login": "madwau"}, "path": "src/main/java/de/tum/in/www1/artemis/domain/Rating.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package de.tum.in.www1.artemis.domain;\n+\n+import java.io.Serializable;\n+import java.util.Objects;\n+\n+import javax.persistence.CascadeType;\n+import javax.persistence.Column;\n+import javax.persistence.Entity;\n+import javax.persistence.FetchType;\n+import javax.persistence.Id;\n+import javax.persistence.JoinColumn;\n+import javax.persistence.MapsId;\n+import javax.persistence.OneToOne;\n+import javax.persistence.Table;\n+\n+import com.fasterxml.jackson.annotation.JsonInclude;\n+import com.fasterxml.jackson.annotation.JsonInclude.Include;\n+\n+/**\n+ * A Rating.\n+ */\n+@Entity\n+@Table(name = \"result_rating\")\n+@JsonInclude(Include.NON_EMPTY)\n+public class Rating implements Serializable {\n+\n+    @Id\n+    private Long id;\n+\n+    @Column(name = \"rating\")\n+    private Integer rating;\n+\n+    @MapsId\n+    @OneToOne(fetch = FetchType.LAZY, cascade = CascadeType.ALL)\n+    @JoinColumn(name = \"id\")\n+    private Result result;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "114f290e1b160b024cca9dc827af4a60e6293337"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwMTI4OTg2OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/domain/Rating.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwNjo0Nzo1NlrOGdkNlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwNzo0MToyOFrOGdlw3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzY1NTE4OA==", "bodyText": "Can you remove the unnecessary parentheses here?", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r433655188", "createdAt": "2020-06-02T06:47:56Z", "author": {"login": "sascha11110"}, "path": "src/main/java/de/tum/in/www1/artemis/domain/Rating.java", "diffHunk": "@@ -0,0 +1,70 @@\n+package de.tum.in.www1.artemis.domain;\n+\n+import java.io.Serializable;\n+import java.util.Objects;\n+\n+import javax.persistence.Column;\n+import javax.persistence.Entity;\n+import javax.persistence.GeneratedValue;\n+import javax.persistence.GenerationType;\n+import javax.persistence.Id;\n+import javax.persistence.JoinColumn;\n+import javax.persistence.OneToOne;\n+import javax.persistence.Table;\n+\n+import com.fasterxml.jackson.annotation.JsonInclude;\n+import com.fasterxml.jackson.annotation.JsonInclude.Include;\n+\n+/**\n+ * A Rating.\n+ */\n+@Entity\n+@Table(name = \"result_rating\")\n+@JsonInclude(Include.NON_EMPTY)\n+public class Rating implements Serializable {\n+\n+    @Id\n+    @GeneratedValue(strategy = GenerationType.IDENTITY)\n+    private Long id;\n+\n+    @Column(name = \"rating\")\n+    private Integer rating;\n+\n+    @OneToOne()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e807f993bfe03303c30fb44d94ae27afe0eb9a5"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzY4MDYwNA==", "bodyText": "Done", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r433680604", "createdAt": "2020-06-02T07:41:28Z", "author": {"login": "JonasPetry"}, "path": "src/main/java/de/tum/in/www1/artemis/domain/Rating.java", "diffHunk": "@@ -0,0 +1,70 @@\n+package de.tum.in.www1.artemis.domain;\n+\n+import java.io.Serializable;\n+import java.util.Objects;\n+\n+import javax.persistence.Column;\n+import javax.persistence.Entity;\n+import javax.persistence.GeneratedValue;\n+import javax.persistence.GenerationType;\n+import javax.persistence.Id;\n+import javax.persistence.JoinColumn;\n+import javax.persistence.OneToOne;\n+import javax.persistence.Table;\n+\n+import com.fasterxml.jackson.annotation.JsonInclude;\n+import com.fasterxml.jackson.annotation.JsonInclude.Include;\n+\n+/**\n+ * A Rating.\n+ */\n+@Entity\n+@Table(name = \"result_rating\")\n+@JsonInclude(Include.NON_EMPTY)\n+public class Rating implements Serializable {\n+\n+    @Id\n+    @GeneratedValue(strategy = GenerationType.IDENTITY)\n+    private Long id;\n+\n+    @Column(name = \"rating\")\n+    private Integer rating;\n+\n+    @OneToOne()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzY1NTE4OA=="}, "originalCommit": {"oid": "2e807f993bfe03303c30fb44d94ae27afe0eb9a5"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwMjExMDk5OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMDo1NDowMFrOGdsX5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNTowMjo0N1rOGd19Yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc4ODkwMA==", "bodyText": "This means, everyone could access every rating in all courses, not a good solution.\nI think we should only allow this to users for results for their own participations.\nTAs and instructors can see all ratings in the course in which they are TAs / instructors.\nAdmins can see all ratings", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r433788900", "createdAt": "2020-06-02T10:54:00Z", "author": {"login": "krusche"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "diffHunk": "@@ -0,0 +1,115 @@\n+package de.tum.in.www1.artemis.web.rest;\n+\n+import static de.tum.in.www1.artemis.web.rest.util.ResponseUtil.forbidden;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.Optional;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.PostMapping;\n+import org.springframework.web.bind.annotation.PutMapping;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+\n+import de.tum.in.www1.artemis.domain.Rating;\n+import de.tum.in.www1.artemis.domain.Result;\n+import de.tum.in.www1.artemis.domain.User;\n+import de.tum.in.www1.artemis.domain.participation.StudentParticipation;\n+import de.tum.in.www1.artemis.service.AuthorizationCheckService;\n+import de.tum.in.www1.artemis.service.ParticipationService;\n+import de.tum.in.www1.artemis.service.RatingService;\n+import de.tum.in.www1.artemis.service.ResultService;\n+import de.tum.in.www1.artemis.service.UserService;\n+\n+/**\n+ * REST controller for managing Rating.\n+ */\n+@RestController\n+@RequestMapping(\"/api\")\n+public class RatingResource {\n+\n+    private static final String ENTITY_NAME = \"rating\";\n+\n+    private final Logger log = LoggerFactory.getLogger(RatingResource.class);\n+\n+    private final RatingService ratingService;\n+\n+    private final UserService userService;\n+\n+    private final AuthorizationCheckService authCheckService;\n+\n+    private final ResultService resultService;\n+\n+    private final ParticipationService participationService;\n+\n+    public RatingResource(RatingService ratingService, UserService userService, AuthorizationCheckService authCheckService, ResultService resultService,\n+            ParticipationService participationService) {\n+        this.ratingService = ratingService;\n+        this.userService = userService;\n+        this.authCheckService = authCheckService;\n+        this.resultService = resultService;\n+        this.participationService = participationService;\n+    }\n+\n+    /**\n+     * Return Rating referencing resultId or null\n+     *\n+     * @param resultId - Id of result that is referenced with the rating\n+     * @return Rating or null\n+     */\n+    @GetMapping(\"/results/{resultId}/rating\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Optional<Rating>> getRatingForResult(@PathVariable Long resultId) {\n+        Optional<Rating> rating = ratingService.findRatingByResultId(resultId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44f5b034955b5cf45da6718898f1915b05209152"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzkyNzgxMg==", "bodyText": "I've discussed this with @jpbernius and for now we will only allow the student who rated the result to see the rating.\nYour suggested changes would follow at a later point. Is that ok for you?", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r433927812", "createdAt": "2020-06-02T14:38:18Z", "author": {"login": "JonasPetry"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "diffHunk": "@@ -0,0 +1,115 @@\n+package de.tum.in.www1.artemis.web.rest;\n+\n+import static de.tum.in.www1.artemis.web.rest.util.ResponseUtil.forbidden;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.Optional;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.PostMapping;\n+import org.springframework.web.bind.annotation.PutMapping;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+\n+import de.tum.in.www1.artemis.domain.Rating;\n+import de.tum.in.www1.artemis.domain.Result;\n+import de.tum.in.www1.artemis.domain.User;\n+import de.tum.in.www1.artemis.domain.participation.StudentParticipation;\n+import de.tum.in.www1.artemis.service.AuthorizationCheckService;\n+import de.tum.in.www1.artemis.service.ParticipationService;\n+import de.tum.in.www1.artemis.service.RatingService;\n+import de.tum.in.www1.artemis.service.ResultService;\n+import de.tum.in.www1.artemis.service.UserService;\n+\n+/**\n+ * REST controller for managing Rating.\n+ */\n+@RestController\n+@RequestMapping(\"/api\")\n+public class RatingResource {\n+\n+    private static final String ENTITY_NAME = \"rating\";\n+\n+    private final Logger log = LoggerFactory.getLogger(RatingResource.class);\n+\n+    private final RatingService ratingService;\n+\n+    private final UserService userService;\n+\n+    private final AuthorizationCheckService authCheckService;\n+\n+    private final ResultService resultService;\n+\n+    private final ParticipationService participationService;\n+\n+    public RatingResource(RatingService ratingService, UserService userService, AuthorizationCheckService authCheckService, ResultService resultService,\n+            ParticipationService participationService) {\n+        this.ratingService = ratingService;\n+        this.userService = userService;\n+        this.authCheckService = authCheckService;\n+        this.resultService = resultService;\n+        this.participationService = participationService;\n+    }\n+\n+    /**\n+     * Return Rating referencing resultId or null\n+     *\n+     * @param resultId - Id of result that is referenced with the rating\n+     * @return Rating or null\n+     */\n+    @GetMapping(\"/results/{resultId}/rating\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Optional<Rating>> getRatingForResult(@PathVariable Long resultId) {\n+        Optional<Rating> rating = ratingService.findRatingByResultId(resultId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc4ODkwMA=="}, "originalCommit": {"oid": "44f5b034955b5cf45da6718898f1915b05209152"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzkzMjkwMA==", "bodyText": "That would be ok. It's just important to have access control here. You can easily integrate admins as well, I think this would be good! Please leave a TODO for tutors and instructors", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r433932900", "createdAt": "2020-06-02T14:45:22Z", "author": {"login": "krusche"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "diffHunk": "@@ -0,0 +1,115 @@\n+package de.tum.in.www1.artemis.web.rest;\n+\n+import static de.tum.in.www1.artemis.web.rest.util.ResponseUtil.forbidden;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.Optional;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.PostMapping;\n+import org.springframework.web.bind.annotation.PutMapping;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+\n+import de.tum.in.www1.artemis.domain.Rating;\n+import de.tum.in.www1.artemis.domain.Result;\n+import de.tum.in.www1.artemis.domain.User;\n+import de.tum.in.www1.artemis.domain.participation.StudentParticipation;\n+import de.tum.in.www1.artemis.service.AuthorizationCheckService;\n+import de.tum.in.www1.artemis.service.ParticipationService;\n+import de.tum.in.www1.artemis.service.RatingService;\n+import de.tum.in.www1.artemis.service.ResultService;\n+import de.tum.in.www1.artemis.service.UserService;\n+\n+/**\n+ * REST controller for managing Rating.\n+ */\n+@RestController\n+@RequestMapping(\"/api\")\n+public class RatingResource {\n+\n+    private static final String ENTITY_NAME = \"rating\";\n+\n+    private final Logger log = LoggerFactory.getLogger(RatingResource.class);\n+\n+    private final RatingService ratingService;\n+\n+    private final UserService userService;\n+\n+    private final AuthorizationCheckService authCheckService;\n+\n+    private final ResultService resultService;\n+\n+    private final ParticipationService participationService;\n+\n+    public RatingResource(RatingService ratingService, UserService userService, AuthorizationCheckService authCheckService, ResultService resultService,\n+            ParticipationService participationService) {\n+        this.ratingService = ratingService;\n+        this.userService = userService;\n+        this.authCheckService = authCheckService;\n+        this.resultService = resultService;\n+        this.participationService = participationService;\n+    }\n+\n+    /**\n+     * Return Rating referencing resultId or null\n+     *\n+     * @param resultId - Id of result that is referenced with the rating\n+     * @return Rating or null\n+     */\n+    @GetMapping(\"/results/{resultId}/rating\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Optional<Rating>> getRatingForResult(@PathVariable Long resultId) {\n+        Optional<Rating> rating = ratingService.findRatingByResultId(resultId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc4ODkwMA=="}, "originalCommit": {"oid": "44f5b034955b5cf45da6718898f1915b05209152"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk0NTk1NQ==", "bodyText": "Admins are now allowed as well and a TODO for instructors is added!", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r433945955", "createdAt": "2020-06-02T15:02:47Z", "author": {"login": "JonasPetry"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "diffHunk": "@@ -0,0 +1,115 @@\n+package de.tum.in.www1.artemis.web.rest;\n+\n+import static de.tum.in.www1.artemis.web.rest.util.ResponseUtil.forbidden;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.Optional;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.PostMapping;\n+import org.springframework.web.bind.annotation.PutMapping;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+\n+import de.tum.in.www1.artemis.domain.Rating;\n+import de.tum.in.www1.artemis.domain.Result;\n+import de.tum.in.www1.artemis.domain.User;\n+import de.tum.in.www1.artemis.domain.participation.StudentParticipation;\n+import de.tum.in.www1.artemis.service.AuthorizationCheckService;\n+import de.tum.in.www1.artemis.service.ParticipationService;\n+import de.tum.in.www1.artemis.service.RatingService;\n+import de.tum.in.www1.artemis.service.ResultService;\n+import de.tum.in.www1.artemis.service.UserService;\n+\n+/**\n+ * REST controller for managing Rating.\n+ */\n+@RestController\n+@RequestMapping(\"/api\")\n+public class RatingResource {\n+\n+    private static final String ENTITY_NAME = \"rating\";\n+\n+    private final Logger log = LoggerFactory.getLogger(RatingResource.class);\n+\n+    private final RatingService ratingService;\n+\n+    private final UserService userService;\n+\n+    private final AuthorizationCheckService authCheckService;\n+\n+    private final ResultService resultService;\n+\n+    private final ParticipationService participationService;\n+\n+    public RatingResource(RatingService ratingService, UserService userService, AuthorizationCheckService authCheckService, ResultService resultService,\n+            ParticipationService participationService) {\n+        this.ratingService = ratingService;\n+        this.userService = userService;\n+        this.authCheckService = authCheckService;\n+        this.resultService = resultService;\n+        this.participationService = participationService;\n+    }\n+\n+    /**\n+     * Return Rating referencing resultId or null\n+     *\n+     * @param resultId - Id of result that is referenced with the rating\n+     * @return Rating or null\n+     */\n+    @GetMapping(\"/results/{resultId}/rating\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Optional<Rating>> getRatingForResult(@PathVariable Long resultId) {\n+        Optional<Rating> rating = ratingService.findRatingByResultId(resultId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc4ODkwMA=="}, "originalCommit": {"oid": "44f5b034955b5cf45da6718898f1915b05209152"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwMjEyNDY3OnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/exercises/shared/rating/rating.component.ts", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMDo1ODozNFrOGdsg2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMTo1Nzo0M1rOGduTdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc5MTE5NQ==", "bodyText": "this means we have one additional REST call, when navigating into the page that shows the rating / allows the user to interact with it.\nCan you please do the following:\n\nOnly load the rating if it is not yet available (in the passed result) --> You might need to add rating as reference to result then\nCheck if you can load the rating together with the result. (using the fetch mechanism in the repository)", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r433791195", "createdAt": "2020-06-02T10:58:34Z", "author": {"login": "krusche"}, "path": "src/main/webapp/app/exercises/shared/rating/rating.component.ts", "diffHunk": "@@ -0,0 +1,58 @@\n+import { Component, Input, OnInit } from '@angular/core';\n+import { RatingService } from 'app/exercises/shared/rating/rating.service';\n+import { StarRatingComponent } from 'ng-starrating';\n+import { Result } from 'app/entities/result.model';\n+import { Rating } from 'app/entities/rating.model';\n+\n+@Component({\n+    selector: 'jhi-rating',\n+    templateUrl: './rating.component.html',\n+    styleUrls: ['./rating.component.scss'],\n+})\n+export class RatingComponent implements OnInit {\n+    public rating: Rating;\n+    public disableRating = false;\n+    @Input() result: Result;\n+\n+    constructor(public ratingService: RatingService) {}\n+\n+    ngOnInit(): void {\n+        if (!this.result || !this.result.submission) {\n+            return;\n+        }\n+        this.ratingService.getRating(this.result.id).subscribe((rating) => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44f5b034955b5cf45da6718898f1915b05209152"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzgxMDQyMQ==", "bodyText": "We use the same approach for complaints.\nFor those, we also do an extra network call to see if they are present.\nI think we need to do it that way if we want to keep our design goal of this being independent and integratable by a single line.\nRight now the Result does not know about ratings.\nIf we change this, we would need to update the Resources we well to include this for other exercise types.", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r433810421", "createdAt": "2020-06-02T11:37:49Z", "author": {"login": "jpbernius"}, "path": "src/main/webapp/app/exercises/shared/rating/rating.component.ts", "diffHunk": "@@ -0,0 +1,58 @@\n+import { Component, Input, OnInit } from '@angular/core';\n+import { RatingService } from 'app/exercises/shared/rating/rating.service';\n+import { StarRatingComponent } from 'ng-starrating';\n+import { Result } from 'app/entities/result.model';\n+import { Rating } from 'app/entities/rating.model';\n+\n+@Component({\n+    selector: 'jhi-rating',\n+    templateUrl: './rating.component.html',\n+    styleUrls: ['./rating.component.scss'],\n+})\n+export class RatingComponent implements OnInit {\n+    public rating: Rating;\n+    public disableRating = false;\n+    @Input() result: Result;\n+\n+    constructor(public ratingService: RatingService) {}\n+\n+    ngOnInit(): void {\n+        if (!this.result || !this.result.submission) {\n+            return;\n+        }\n+        this.ratingService.getRating(this.result.id).subscribe((rating) => {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc5MTE5NQ=="}, "originalCommit": {"oid": "44f5b034955b5cf45da6718898f1915b05209152"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzgyMDUzMg==", "bodyText": "That's exactly my concern, we then have 3 request: result, complaint and rating.\nWe can keep this for now, but I would like to have 1 request here in the future", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r433820532", "createdAt": "2020-06-02T11:57:43Z", "author": {"login": "krusche"}, "path": "src/main/webapp/app/exercises/shared/rating/rating.component.ts", "diffHunk": "@@ -0,0 +1,58 @@\n+import { Component, Input, OnInit } from '@angular/core';\n+import { RatingService } from 'app/exercises/shared/rating/rating.service';\n+import { StarRatingComponent } from 'ng-starrating';\n+import { Result } from 'app/entities/result.model';\n+import { Rating } from 'app/entities/rating.model';\n+\n+@Component({\n+    selector: 'jhi-rating',\n+    templateUrl: './rating.component.html',\n+    styleUrls: ['./rating.component.scss'],\n+})\n+export class RatingComponent implements OnInit {\n+    public rating: Rating;\n+    public disableRating = false;\n+    @Input() result: Result;\n+\n+    constructor(public ratingService: RatingService) {}\n+\n+    ngOnInit(): void {\n+        if (!this.result || !this.result.submission) {\n+            return;\n+        }\n+        this.ratingService.getRating(this.result.id).subscribe((rating) => {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc5MTE5NQ=="}, "originalCommit": {"oid": "44f5b034955b5cf45da6718898f1915b05209152"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwMzE1MDUzOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNToxODo1MFrOGd2quA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNjowNTozOVrOGd5IEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk1NzU2MA==", "bodyText": "can you reduce this to one database access to find the participation directly?", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r433957560", "createdAt": "2020-06-02T15:18:50Z", "author": {"login": "krusche"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "diffHunk": "@@ -0,0 +1,126 @@\n+package de.tum.in.www1.artemis.web.rest;\n+\n+import static de.tum.in.www1.artemis.web.rest.util.ResponseUtil.forbidden;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.Optional;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.PostMapping;\n+import org.springframework.web.bind.annotation.PutMapping;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+\n+import de.tum.in.www1.artemis.domain.Rating;\n+import de.tum.in.www1.artemis.domain.Result;\n+import de.tum.in.www1.artemis.domain.User;\n+import de.tum.in.www1.artemis.domain.participation.StudentParticipation;\n+import de.tum.in.www1.artemis.service.AuthorizationCheckService;\n+import de.tum.in.www1.artemis.service.ParticipationService;\n+import de.tum.in.www1.artemis.service.RatingService;\n+import de.tum.in.www1.artemis.service.ResultService;\n+import de.tum.in.www1.artemis.service.UserService;\n+\n+/**\n+ * REST controller for managing Rating.\n+ */\n+@RestController\n+@RequestMapping(\"/api\")\n+public class RatingResource {\n+\n+    private static final String ENTITY_NAME = \"rating\";\n+\n+    private final Logger log = LoggerFactory.getLogger(RatingResource.class);\n+\n+    private final RatingService ratingService;\n+\n+    private final UserService userService;\n+\n+    private final AuthorizationCheckService authCheckService;\n+\n+    private final ResultService resultService;\n+\n+    private final ParticipationService participationService;\n+\n+    public RatingResource(RatingService ratingService, UserService userService, AuthorizationCheckService authCheckService, ResultService resultService,\n+            ParticipationService participationService) {\n+        this.ratingService = ratingService;\n+        this.userService = userService;\n+        this.authCheckService = authCheckService;\n+        this.resultService = resultService;\n+        this.participationService = participationService;\n+    }\n+\n+    /**\n+     * Return Rating referencing resultId or null\n+     *\n+     * @param resultId - Id of result that is referenced with the rating\n+     * @return Rating or null\n+     */\n+    @GetMapping(\"/results/{resultId}/rating\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Optional<Rating>> getRatingForResult(@PathVariable Long resultId) {\n+        // TODO allow for Instructors\n+        if (!checkIfUserIsOwnerOfSubmission(resultId) && !authCheckService.isAdmin()) {\n+            return forbidden();\n+        }\n+        Optional<Rating> rating = ratingService.findRatingByResultId(resultId);\n+        return ResponseEntity.ok(rating);\n+    }\n+\n+    /**\n+     * Persist a new Rating\n+     *\n+     * @param resultId    - Id of result that is referenced with the rating that should be persisted\n+     * @param ratingValue - Value of the updated rating\n+     * @return inserted Rating\n+     * @throws URISyntaxException if the Location URI syntax is incorrect\n+     */\n+    @PostMapping(\"/results/{resultId}/rating/{ratingValue}\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Rating> createRatingForResult(@PathVariable Long resultId, @PathVariable Integer ratingValue) throws URISyntaxException {\n+        if (!checkIfUserIsOwnerOfSubmission(resultId)) {\n+            return forbidden();\n+        }\n+\n+        Rating savedRating = ratingService.saveRating(resultId, ratingValue);\n+        return ResponseEntity.created(new URI(\"/api/results/\" + savedRating.getId() + \"/rating\")).body(savedRating);\n+    }\n+\n+    /**\n+     * Update a Rating\n+     *\n+     * @param resultId    - Id of result that is referenced with the rating that should be updated\n+     * @param ratingValue - Value of the updated rating\n+     * @return updated Rating\n+     */\n+    @PutMapping(\"/results/{resultId}/rating/{ratingValue}\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Rating> updateRatingForResult(@PathVariable Long resultId, @PathVariable Integer ratingValue) {\n+        if (!checkIfUserIsOwnerOfSubmission(resultId)) {\n+            return forbidden();\n+        }\n+\n+        Rating savedRating = ratingService.updateRating(resultId, ratingValue);\n+        return ResponseEntity.ok(savedRating);\n+    }\n+\n+    /**\n+     * Check if currently logged in user in the owner of the participation\n+     *\n+     * @param resultId - Id of the result that the participation belongs to\n+     * @return False if User is not Owner, True otherwise\n+     */\n+    private boolean checkIfUserIsOwnerOfSubmission(Long resultId) {\n+        User user = userService.getUser();\n+        Result res = resultService.findOne(resultId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20b80adf98863b1dba76ea148ef158f4656028b0"}, "originalPosition": 122}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk5Nzg0MQ==", "bodyText": "Done", "url": "https://github.com/ls1intum/Artemis/pull/1451#discussion_r433997841", "createdAt": "2020-06-02T16:05:39Z", "author": {"login": "JonasPetry"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/RatingResource.java", "diffHunk": "@@ -0,0 +1,126 @@\n+package de.tum.in.www1.artemis.web.rest;\n+\n+import static de.tum.in.www1.artemis.web.rest.util.ResponseUtil.forbidden;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.Optional;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.PostMapping;\n+import org.springframework.web.bind.annotation.PutMapping;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+\n+import de.tum.in.www1.artemis.domain.Rating;\n+import de.tum.in.www1.artemis.domain.Result;\n+import de.tum.in.www1.artemis.domain.User;\n+import de.tum.in.www1.artemis.domain.participation.StudentParticipation;\n+import de.tum.in.www1.artemis.service.AuthorizationCheckService;\n+import de.tum.in.www1.artemis.service.ParticipationService;\n+import de.tum.in.www1.artemis.service.RatingService;\n+import de.tum.in.www1.artemis.service.ResultService;\n+import de.tum.in.www1.artemis.service.UserService;\n+\n+/**\n+ * REST controller for managing Rating.\n+ */\n+@RestController\n+@RequestMapping(\"/api\")\n+public class RatingResource {\n+\n+    private static final String ENTITY_NAME = \"rating\";\n+\n+    private final Logger log = LoggerFactory.getLogger(RatingResource.class);\n+\n+    private final RatingService ratingService;\n+\n+    private final UserService userService;\n+\n+    private final AuthorizationCheckService authCheckService;\n+\n+    private final ResultService resultService;\n+\n+    private final ParticipationService participationService;\n+\n+    public RatingResource(RatingService ratingService, UserService userService, AuthorizationCheckService authCheckService, ResultService resultService,\n+            ParticipationService participationService) {\n+        this.ratingService = ratingService;\n+        this.userService = userService;\n+        this.authCheckService = authCheckService;\n+        this.resultService = resultService;\n+        this.participationService = participationService;\n+    }\n+\n+    /**\n+     * Return Rating referencing resultId or null\n+     *\n+     * @param resultId - Id of result that is referenced with the rating\n+     * @return Rating or null\n+     */\n+    @GetMapping(\"/results/{resultId}/rating\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Optional<Rating>> getRatingForResult(@PathVariable Long resultId) {\n+        // TODO allow for Instructors\n+        if (!checkIfUserIsOwnerOfSubmission(resultId) && !authCheckService.isAdmin()) {\n+            return forbidden();\n+        }\n+        Optional<Rating> rating = ratingService.findRatingByResultId(resultId);\n+        return ResponseEntity.ok(rating);\n+    }\n+\n+    /**\n+     * Persist a new Rating\n+     *\n+     * @param resultId    - Id of result that is referenced with the rating that should be persisted\n+     * @param ratingValue - Value of the updated rating\n+     * @return inserted Rating\n+     * @throws URISyntaxException if the Location URI syntax is incorrect\n+     */\n+    @PostMapping(\"/results/{resultId}/rating/{ratingValue}\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Rating> createRatingForResult(@PathVariable Long resultId, @PathVariable Integer ratingValue) throws URISyntaxException {\n+        if (!checkIfUserIsOwnerOfSubmission(resultId)) {\n+            return forbidden();\n+        }\n+\n+        Rating savedRating = ratingService.saveRating(resultId, ratingValue);\n+        return ResponseEntity.created(new URI(\"/api/results/\" + savedRating.getId() + \"/rating\")).body(savedRating);\n+    }\n+\n+    /**\n+     * Update a Rating\n+     *\n+     * @param resultId    - Id of result that is referenced with the rating that should be updated\n+     * @param ratingValue - Value of the updated rating\n+     * @return updated Rating\n+     */\n+    @PutMapping(\"/results/{resultId}/rating/{ratingValue}\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Rating> updateRatingForResult(@PathVariable Long resultId, @PathVariable Integer ratingValue) {\n+        if (!checkIfUserIsOwnerOfSubmission(resultId)) {\n+            return forbidden();\n+        }\n+\n+        Rating savedRating = ratingService.updateRating(resultId, ratingValue);\n+        return ResponseEntity.ok(savedRating);\n+    }\n+\n+    /**\n+     * Check if currently logged in user in the owner of the participation\n+     *\n+     * @param resultId - Id of the result that the participation belongs to\n+     * @return False if User is not Owner, True otherwise\n+     */\n+    private boolean checkIfUserIsOwnerOfSubmission(Long resultId) {\n+        User user = userService.getUser();\n+        Result res = resultService.findOne(resultId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk1NzU2MA=="}, "originalCommit": {"oid": "20b80adf98863b1dba76ea148ef158f4656028b0"}, "originalPosition": 122}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4966, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}