{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI1MDEwMjMx", "number": 2440, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQyMzozODozOFrOE7vy6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQyMzozOToxMVrOE7vzVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxMDg0NTIwOnYy", "diffSide": "LEFT", "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/jenkins/DefaultJenkinsBuildPlanCreator.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQyMzozODozOFrOH3kJHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQyMzozODozOFrOH3kJHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODAyNTg4Nw==", "bodyText": "That code was duplicated 3 times and it was not readable in terms of what thing was replaced by what", "url": "https://github.com/ls1intum/Artemis/pull/2440#discussion_r528025887", "createdAt": "2020-11-20T23:38:38Z", "author": {"login": "1-alex98"}, "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/jenkins/DefaultJenkinsBuildPlanCreator.java", "diffHunk": "@@ -1,33 +0,0 @@\n-package de.tum.in.www1.artemis.service.connectors.jenkins;\n-\n-import java.net.URL;\n-import java.util.Map;\n-\n-import org.springframework.context.annotation.Lazy;\n-import org.springframework.context.annotation.Profile;\n-import org.springframework.stereotype.Component;\n-\n-import de.tum.in.www1.artemis.ResourceLoaderService;\n-import de.tum.in.www1.artemis.config.Constants;\n-import de.tum.in.www1.artemis.domain.enumeration.ProgrammingLanguage;\n-\n-@Profile(\"jenkins\")\n-@Component\n-public class DefaultJenkinsBuildPlanCreator extends AbstractJenkinsBuildPlanCreator {\n-\n-    public DefaultJenkinsBuildPlanCreator(ResourceLoaderService resourceLoaderService, @Lazy JenkinsService jenkinsService) {\n-        super(resourceLoaderService, jenkinsService);\n-    }\n-\n-    @Override\n-    public String getPipelineScript(ProgrammingLanguage programmingLanguage, URL testRepositoryURL, URL assignmentRepositoryURL, boolean isStaticCodeAnalysisEnabled) {\n-        final var resourcePath = new String[] { \"templates\", \"jenkins\", programmingLanguage.name().toLowerCase(), \"Jenkinsfile\" };\n-\n-        final var replacements = Map.of(REPLACE_TEST_REPO, testRepositoryURL.toString(), REPLACE_ASSIGNMENT_REPO, assignmentRepositoryURL.toString(), REPLACE_GIT_CREDENTIALS,\n-                gitCredentialsKey, REPLACE_ASSIGNMENT_CHECKOUT_PATH, Constants.ASSIGNMENT_CHECKOUT_PATH, REPLACE_TESTS_CHECKOUT_PATH, Constants.TESTS_CHECKOUT_PATH,\n-                REPLACE_ARTEMIS_NOTIFICATION_URL, artemisNotificationUrl, REPLACE_NOTIFICATIONS_TOKEN, ARTEMIS_AUTHENTICATION_TOKEN_KEY, REPLACE_DOCKER_IMAGE_NAME,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7e9fc2b4d7107ad49fa9dabc9574e298fa8bf93"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxMDg0NjMxOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/jenkins/JavaJenkinsBuildPlanCreator.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQyMzozOToxMVrOH3kJtg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQyMzozOToxMVrOH3kJtg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODAyNjAzOA==", "bodyText": "Only set what is really different here", "url": "https://github.com/ls1intum/Artemis/pull/2440#discussion_r528026038", "createdAt": "2020-11-20T23:39:11Z", "author": {"login": "1-alex98"}, "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/jenkins/JavaJenkinsBuildPlanCreator.java", "diffHunk": "@@ -23,25 +22,19 @@ public JavaJenkinsBuildPlanCreator(ResourceLoaderService resourceLoaderService,\n     }\n \n     @Override\n-    public String getPipelineScript(ProgrammingLanguage programmingLanguage, URL testRepositoryURL, URL assignmentRepositoryURL, boolean isStaticCodeAnalysisEnabled) {\n+    protected String[] getResourcePath(ProgrammingLanguage programmingLanguage, URL testRepositoryURL, URL assignmentRepositoryURL, boolean isStaticCodeAnalysisEnabled) {\n         final var buildPlan = isStaticCodeAnalysisEnabled ? \"Jenkinsfile-staticCodeAnalysis\" : \"Jenkinsfile\";\n-        final var resourcePath = new String[] { \"templates\", \"jenkins\", \"java\", buildPlan };\n+        return new String[] { \"templates\", \"jenkins\", \"java\", buildPlan };\n+    }\n \n-        Map<String, String> replacements;\n-        if (isStaticCodeAnalysisEnabled) {\n+    @Override\n+    protected Map<String, String> getReplacements(ProgrammingLanguage programmingLanguage, URL testRepositoryURL, URL assignmentRepositoryURL, boolean isStaticCodeAnalysisEnabled) {\n+        Map<String, String> replacements = super.getReplacements(programmingLanguage, testRepositoryURL, assignmentRepositoryURL, isStaticCodeAnalysisEnabled);\n+        if(isStaticCodeAnalysisEnabled){\n             String staticCodeAnalysisScript = createStaticCodeAnalysisScript();\n-            replacements = Map.of(REPLACE_TEST_REPO, testRepositoryURL.toString(), REPLACE_ASSIGNMENT_REPO, assignmentRepositoryURL.toString(), REPLACE_GIT_CREDENTIALS,\n-                    gitCredentialsKey, REPLACE_ASSIGNMENT_CHECKOUT_PATH, Constants.ASSIGNMENT_CHECKOUT_PATH, REPLACE_ARTEMIS_NOTIFICATION_URL, artemisNotificationUrl,\n-                    REPLACE_NOTIFICATIONS_TOKEN, ARTEMIS_AUTHENTICATION_TOKEN_KEY, REPLACE_STATIC_CODE_ANALYSIS_SCRIPT, staticCodeAnalysisScript, REPLACE_DOCKER_IMAGE_NAME,\n-                    jenkinsService.getDockerImageName(ProgrammingLanguage.JAVA));\n+            replacements.put(REPLACE_STATIC_CODE_ANALYSIS_SCRIPT, staticCodeAnalysisScript);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7e9fc2b4d7107ad49fa9dabc9574e298fa8bf93"}, "originalPosition": 37}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4479, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}