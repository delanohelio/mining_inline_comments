{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzMzU5NDAw", "number": 1998, "title": "Plagiarism checks for text exercises", "bodyText": "Checklist\n\n I tested all changes and all related features with different users (student, tutor, instructor, admin) on the test server https://artemistest.ase.in.tum.de.\n Server: I added multiple integration tests (Spring) related to the features\n Server: I added @PreAuthorize and check the course groups for all new REST Calls (security)\n Server: I implemented the changes with a good performance and prevented too many database calls\n Server: I documented the Java code using JavaDoc style.\n\nDescription\nTo identify plagiarism, we add a REST endpoint to pairwise compare all text submissions using four different strategies. The resulting distances help instructors to understand if a student might have copies from another student. Score 0.0 indicates identical submissions.\nSteps for Testing\n\nLog in to Artemis\nCollect Authorization and CSRF Tokens\nMake HTTP Request to /api/text-exercises/{exerciseId}/plagiarism-checks", "createdAt": "2020-08-05T12:43:44Z", "url": "https://github.com/ls1intum/Artemis/pull/1998", "merged": true, "mergeCommit": {"oid": "f93f912e9c04139f41f0572161b4e9c4961867e6"}, "closed": true, "closedAt": "2020-08-06T15:42:47Z", "author": {"login": "jpbernius"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc76h3hAH2gAyNDYzMzU5NDAwOmY2ZmMzM2Y5MjBlMjUxZDc2MGMzZWUxZGM2MzAwZWEwMGNkOGZhY2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8RNivgH2gAyNDYzMzU5NDAwOjc0OTUyNGFjMzE1ZGYwYjRiYTk4OWM4YzdkZTUxNzU5YzkxNDQ0Y2M=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f6fc33f920e251d760c3ee1dc6300ea00cd8facd", "author": {"user": {"login": "jpbernius", "name": "Jan Philip Bernius"}}, "url": "https://github.com/ls1intum/Artemis/commit/f6fc33f920e251d760c3ee1dc6300ea00cd8facd", "committedDate": "2020-08-05T12:39:06Z", "message": "Compute distance metrics for text submissions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12e28bf378664427323986ce59df4a12a762c250", "author": {"user": {"login": "jpbernius", "name": "Jan Philip Bernius"}}, "url": "https://github.com/ls1intum/Artemis/commit/12e28bf378664427323986ce59df4a12a762c250", "committedDate": "2020-08-05T14:13:14Z", "message": "Downlaod from Client"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0aab51a7b25133b2307a56cbcd99c6730704252c", "author": {"user": {"login": "jpbernius", "name": "Jan Philip Bernius"}}, "url": "https://github.com/ls1intum/Artemis/commit/0aab51a7b25133b2307a56cbcd99c6730704252c", "committedDate": "2020-08-05T14:16:10Z", "message": "./gradlew :spotlessApply Good Suggestions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61024c0f75b79877e61f662e48408996cc01dc96", "author": {"user": {"login": "jpbernius", "name": "Jan Philip Bernius"}}, "url": "https://github.com/ls1intum/Artemis/commit/61024c0f75b79877e61f662e48408996cc01dc96", "committedDate": "2020-08-05T14:17:21Z", "message": "./gradlew :spotlessApply Bad Suggestions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxNzYyMTEw", "url": "https://github.com/ls1intum/Artemis/pull/1998#pullrequestreview-461762110", "createdAt": "2020-08-05T15:12:19Z", "commit": {"oid": "61024c0f75b79877e61f662e48408996cc01dc96"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNToxMjoyMFrOG8ONcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNToxMjoyMFrOG8ONcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTgwMDU2MQ==", "bodyText": "@krusche I refactored your new method in #1995 and what was used in quiz-exercise.service.ts here as this is duplicate. This here drops the $window argument though.", "url": "https://github.com/ls1intum/Artemis/pull/1998#discussion_r465800561", "createdAt": "2020-08-05T15:12:20Z", "author": {"login": "jpbernius"}, "path": "src/main/webapp/app/shared/util/download.util.ts", "diffHunk": "@@ -0,0 +1,32 @@\n+import { HttpResponse } from '@angular/common/http';\n+\n+export function downloadZipFileFromResponse(response: HttpResponse<Blob>): void {\n+    if (response.body) {\n+        const file = new Blob([response.body], { type: 'application/zip' });\n+        downloadFile(file, response.headers.get('filename')!);\n+    }\n+}\n+\n+/**\n+ * Make a file of given blob and allows user to download it from the browser.\n+ * @param blob data to be written in file.\n+ * @param filename suggested to the browser.\n+ */\n+export function downloadFile(blob: Blob, filename: string) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61024c0f75b79877e61f662e48408996cc01dc96"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMjY0Mjc3", "url": "https://github.com/ls1intum/Artemis/pull/1998#pullrequestreview-462264277", "createdAt": "2020-08-06T07:44:58Z", "commit": {"oid": "61024c0f75b79877e61f662e48408996cc01dc96"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwNzo0NDo1OFrOG8nJXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwODoxODo0NVrOG8oX3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjIwOTExOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Convenience method of extract all latest submissions from a TextExercise and compute pair-wise distancse.\n          \n          \n            \n                 * Convenience method to extract all latest submissions from a TextExercise and compute pair-wise distances.", "url": "https://github.com/ls1intum/Artemis/pull/1998#discussion_r466209119", "createdAt": "2020-08-06T07:44:58Z", "author": {"login": "JonasPetry"}, "path": "src/main/java/de/tum/in/www1/artemis/service/plagiarism/text/TextPlagiarismDetectionService.java", "diffHunk": "@@ -0,0 +1,64 @@\n+package de.tum.in.www1.artemis.service.plagiarism.text;\n+\n+import static java.util.stream.Collectors.toUnmodifiableList;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.Set;\n+\n+import org.springframework.stereotype.Service;\n+\n+import de.tum.in.www1.artemis.domain.TextExercise;\n+import de.tum.in.www1.artemis.domain.TextSubmission;\n+import de.tum.in.www1.artemis.domain.participation.Participation;\n+\n+@Service\n+public class TextPlagiarismDetectionService {\n+\n+    /**\n+     * Convenience method of extract all latest submissions from a TextExercise and compute pair-wise distancse.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61024c0f75b79877e61f662e48408996cc01dc96"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjIxODUwNw==", "bodyText": "Iterating like that, items are only compared to items behind them in the list.\nIf there are submissions [a,b,c] and let's say a & c are identical, a would receive a low distance score and c would not be evaluated at all. Is this intended? If yes, I would indicate that somewhere in the documentation.", "url": "https://github.com/ls1intum/Artemis/pull/1998#discussion_r466218507", "createdAt": "2020-08-06T08:00:14Z", "author": {"login": "JonasPetry"}, "path": "src/main/java/de/tum/in/www1/artemis/service/plagiarism/text/TextPlagiarismDetectionService.java", "diffHunk": "@@ -0,0 +1,64 @@\n+package de.tum.in.www1.artemis.service.plagiarism.text;\n+\n+import static java.util.stream.Collectors.toUnmodifiableList;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.Set;\n+\n+import org.springframework.stereotype.Service;\n+\n+import de.tum.in.www1.artemis.domain.TextExercise;\n+import de.tum.in.www1.artemis.domain.TextSubmission;\n+import de.tum.in.www1.artemis.domain.participation.Participation;\n+\n+@Service\n+public class TextPlagiarismDetectionService {\n+\n+    /**\n+     * Convenience method of extract all latest submissions from a TextExercise and compute pair-wise distancse.\n+     *\n+     * @param exerciseWithParticipationsAndSubmissions Text Exercise with fetched participations and submissions\n+     * @param comparisionStrategy TextComparisionStrategy\n+     * @return Map of text submission pairs and distance score\n+     */\n+    public Map<Set<TextSubmission>, Double> compareSubmissionsForExerciseWithStrategy(TextExercise exerciseWithParticipationsAndSubmissions,\n+            TextComparisionStrategy comparisionStrategy) {\n+        final List<TextSubmission> textSubmissions = textSubmissionsForComparison(exerciseWithParticipationsAndSubmissions);\n+        return compareSubmissionsForExerciseWithStrategy(textSubmissions, comparisionStrategy);\n+    }\n+\n+    /**\n+     * Pairwise comparision of text submissions using a TextComparisionStrategy\n+     *\n+     * @param textSubmissions List of text submissions\n+     * @param comparisionStrategy TextComparisionStrategy\n+     * @return Map of text submission pairs and distance score\n+     */\n+    public Map<Set<TextSubmission>, Double> compareSubmissionsForExerciseWithStrategy(List<TextSubmission> textSubmissions, TextComparisionStrategy comparisionStrategy) {\n+        final Map<Set<TextSubmission>, Double> map = new HashMap<>();\n+\n+        for (int i = 0; i < textSubmissions.size(); i++) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61024c0f75b79877e61f662e48408996cc01dc96"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjIyMzY2Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        downloadFile(blob, `check-plagiarism-${this.textExercise.id}.json`);\n          \n          \n            \n                        downloadFile(blob, `check-plagiarism-textExercise_${this.textExercise.id}.json`);", "url": "https://github.com/ls1intum/Artemis/pull/1998#discussion_r466223662", "createdAt": "2020-08-06T08:08:59Z", "author": {"login": "JonasPetry"}, "path": "src/main/webapp/app/exercises/text/manage/text-exercise/text-exercise-detail.component.ts", "diffHunk": "@@ -106,4 +111,60 @@ export class TextExerciseDetailComponent implements OnInit, OnDestroy {\n     registerChangeInTextExercises() {\n         this.eventSubscriber = this.eventManager.subscribe('textExerciseListModification', () => this.load(this.textExercise.id));\n     }\n+\n+    checkPlagiarismJson() {\n+        this.checkPlagiarism((data) => {\n+            const json = JSON.stringify(data);\n+            const blob = new Blob([json], { type: 'application/json' });\n+            downloadFile(blob, `check-plagiarism-${this.textExercise.id}.json`);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61024c0f75b79877e61f662e48408996cc01dc96"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjIyMzk4Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                title: `Plagiarism Check for Exercise ${this.textExercise.id}: ${this.textExercise.title}`,\n          \n          \n            \n                                title: `Plagiarism Check for Text Exercise ${this.textExercise.id}: ${this.textExercise.title}`,", "url": "https://github.com/ls1intum/Artemis/pull/1998#discussion_r466223987", "createdAt": "2020-08-06T08:09:36Z", "author": {"login": "JonasPetry"}, "path": "src/main/webapp/app/exercises/text/manage/text-exercise/text-exercise-detail.component.ts", "diffHunk": "@@ -106,4 +111,60 @@ export class TextExerciseDetailComponent implements OnInit, OnDestroy {\n     registerChangeInTextExercises() {\n         this.eventSubscriber = this.eventManager.subscribe('textExerciseListModification', () => this.load(this.textExercise.id));\n     }\n+\n+    checkPlagiarismJson() {\n+        this.checkPlagiarism((data) => {\n+            const json = JSON.stringify(data);\n+            const blob = new Blob([json], { type: 'application/json' });\n+            downloadFile(blob, `check-plagiarism-${this.textExercise.id}.json`);\n+        });\n+    }\n+\n+    checkPlagiarismCsv() {\n+        this.checkPlagiarism((data) => {\n+            if (data.length > 0) {\n+                const csvExporter = new ExportToCsv({\n+                    fieldSeparator: ';',\n+                    quoteStrings: '\"',\n+                    decimalSeparator: 'locale',\n+                    showLabels: true,\n+                    title: `Plagiarism Check for Exercise ${this.textExercise.id}: ${this.textExercise.title}`,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61024c0f75b79877e61f662e48408996cc01dc96"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjIyNDE3MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                filename: `check-plagiarism-${this.textExercise.id}`,\n          \n          \n            \n                                filename: `check-plagiarism-textExercise_${this.textExercise.id}`,", "url": "https://github.com/ls1intum/Artemis/pull/1998#discussion_r466224170", "createdAt": "2020-08-06T08:09:55Z", "author": {"login": "JonasPetry"}, "path": "src/main/webapp/app/exercises/text/manage/text-exercise/text-exercise-detail.component.ts", "diffHunk": "@@ -106,4 +111,60 @@ export class TextExerciseDetailComponent implements OnInit, OnDestroy {\n     registerChangeInTextExercises() {\n         this.eventSubscriber = this.eventManager.subscribe('textExerciseListModification', () => this.load(this.textExercise.id));\n     }\n+\n+    checkPlagiarismJson() {\n+        this.checkPlagiarism((data) => {\n+            const json = JSON.stringify(data);\n+            const blob = new Blob([json], { type: 'application/json' });\n+            downloadFile(blob, `check-plagiarism-${this.textExercise.id}.json`);\n+        });\n+    }\n+\n+    checkPlagiarismCsv() {\n+        this.checkPlagiarism((data) => {\n+            if (data.length > 0) {\n+                const csvExporter = new ExportToCsv({\n+                    fieldSeparator: ';',\n+                    quoteStrings: '\"',\n+                    decimalSeparator: 'locale',\n+                    showLabels: true,\n+                    title: `Plagiarism Check for Exercise ${this.textExercise.id}: ${this.textExercise.title}`,\n+                    filename: `check-plagiarism-${this.textExercise.id}`,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61024c0f75b79877e61f662e48408996cc01dc96"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjIyOTIxMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            const fullname = (student: User): string => `${student.firstName || ''} ${student.lastName || ''}`;\n          \n          \n            \n                            const fullname = (student: User): string => `${student.firstName || ''}${' ' + student.lastName || ''}`;", "url": "https://github.com/ls1intum/Artemis/pull/1998#discussion_r466229213", "createdAt": "2020-08-06T08:18:45Z", "author": {"login": "JonasPetry"}, "path": "src/main/webapp/app/exercises/text/manage/text-exercise/text-exercise-detail.component.ts", "diffHunk": "@@ -106,4 +111,60 @@ export class TextExerciseDetailComponent implements OnInit, OnDestroy {\n     registerChangeInTextExercises() {\n         this.eventSubscriber = this.eventManager.subscribe('textExerciseListModification', () => this.load(this.textExercise.id));\n     }\n+\n+    checkPlagiarismJson() {\n+        this.checkPlagiarism((data) => {\n+            const json = JSON.stringify(data);\n+            const blob = new Blob([json], { type: 'application/json' });\n+            downloadFile(blob, `check-plagiarism-${this.textExercise.id}.json`);\n+        });\n+    }\n+\n+    checkPlagiarismCsv() {\n+        this.checkPlagiarism((data) => {\n+            if (data.length > 0) {\n+                const csvExporter = new ExportToCsv({\n+                    fieldSeparator: ';',\n+                    quoteStrings: '\"',\n+                    decimalSeparator: 'locale',\n+                    showLabels: true,\n+                    title: `Plagiarism Check for Exercise ${this.textExercise.id}: ${this.textExercise.title}`,\n+                    filename: `check-plagiarism-${this.textExercise.id}`,\n+                    useTextFile: false,\n+                    useBom: true,\n+                    headers: ['Student A', 'Submission A', 'Student B', 'Submission B', ...Object.keys(data[0].distanceMetrics)],\n+                });\n+\n+                const fullname = (student: User): string => `${student.firstName || ''} ${student.lastName || ''}`;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61024c0f75b79877e61f662e48408996cc01dc96"}, "originalPosition": 51}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e9e9fd688bcd15940245e96fa14a6c861031ebc", "author": {"user": {"login": "JonasPetry", "name": "Jonas Petry"}}, "url": "https://github.com/ls1intum/Artemis/commit/5e9e9fd688bcd15940245e96fa14a6c861031ebc", "committedDate": "2020-08-06T08:22:22Z", "message": "Merge branch 'develop' into text-plag"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54f80d0350774a79026c813c5863a4970e89d29b", "author": {"user": {"login": "JonasPetry", "name": "Jonas Petry"}}, "url": "https://github.com/ls1intum/Artemis/commit/54f80d0350774a79026c813c5863a4970e89d29b", "committedDate": "2020-08-06T08:46:03Z", "message": "Merge branch 'develop' into text-plag"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ef8bf524bc774c018e9fb95fd18ab155f30b106", "author": {"user": {"login": "jpbernius", "name": "Jan Philip Bernius"}}, "url": "https://github.com/ls1intum/Artemis/commit/0ef8bf524bc774c018e9fb95fd18ab155f30b106", "committedDate": "2020-08-06T13:21:50Z", "message": "Apply suggestions from code review\n\nCo-authored-by: Jonas Petry <51994246+JonasPetry@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "621af30a00595a5f995d53eecf0f829a1fa33939", "author": {"user": {"login": "jpbernius", "name": "Jan Philip Bernius"}}, "url": "https://github.com/ls1intum/Artemis/commit/621af30a00595a5f995d53eecf0f829a1fa33939", "committedDate": "2020-08-06T13:25:39Z", "message": "Merge branch 'develop' into text-plag"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4803a387e7d59678231c3663e2db6d53f1d7f238", "author": {"user": {"login": "jpbernius", "name": "Jan Philip Bernius"}}, "url": "https://github.com/ls1intum/Artemis/commit/4803a387e7d59678231c3663e2db6d53f1d7f238", "committedDate": "2020-08-06T13:42:59Z", "message": "Apply suggestions from code review\n\n* Improve Tests\n* Trim CSV Student Names\n* Improve imports\n\nSigned-off-by: Jan Philip Bernius <janphilip.bernius@tum.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "023021fbf42caad6fc79a86acfb5e4a7754adb0c", "author": {"user": {"login": "jpbernius", "name": "Jan Philip Bernius"}}, "url": "https://github.com/ls1intum/Artemis/commit/023021fbf42caad6fc79a86acfb5e4a7754adb0c", "committedDate": "2020-08-06T13:50:43Z", "message": "Rename o to other\n\nSigned-off-by: Jan Philip Bernius <janphilip.bernius@tum.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c47d056f19a6cf48272c9bd83211f4d1a564125", "author": {"user": {"login": "jpbernius", "name": "Jan Philip Bernius"}}, "url": "https://github.com/ls1intum/Artemis/commit/5c47d056f19a6cf48272c9bd83211f4d1a564125", "committedDate": "2020-08-06T13:57:55Z", "message": "Fix issues\n\nSigned-off-by: Jan Philip Bernius <janphilip.bernius@tum.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "749524ac315df0b4ba989c8c7de51759c91444cc", "author": {"user": {"login": "jpbernius", "name": "Jan Philip Bernius"}}, "url": "https://github.com/ls1intum/Artemis/commit/749524ac315df0b4ba989c8c7de51759c91444cc", "committedDate": "2020-08-06T15:04:43Z", "message": "Merge branch 'develop' into text-plag\n\nSigned-off-by: Jan Philip Bernius <janphilip.bernius@tum.de>\n\n# Conflicts:\n#\tsrc/main/webapp/app/shared/util/download.util.ts"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4462, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}