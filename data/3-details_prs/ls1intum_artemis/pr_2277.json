{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEwMTM1Mzkw", "number": 2277, "title": "[Enhancement] Reduce code duplication in for-dashboard call", "bodyText": "Checklist\n\n I tested all changes and all related features with different users (student, tutor, instructor, admin) locally.\n\nMotivation and Context\n\n\nWhen an assessment is just saved and not submitted, the result has not completion date yet. This lead to a NPE in when updating the latestSubmission according to the completion date of the submissions result.\nDescription\n\n\nAssure that only manual results that are rated and have a completion date are taken into account\nReduced duplicated code, by using some more checks in ExerciseService.java\n\nSteps for Testing\n\nMore focus on the code review\n\nLog in to Artemis\nNavigate to Course Administration\nAssess a programming exercise submission and just save\nGo to Course Overview and see that the for-dashboard throws no error\nPlay a bit around everything should work as expected (e.g. Assessed results are displayed after assessment due date)\nSee Instructions Publishing of results before assessment due date and after assessment due date (student) in #2137\n\nTest Coverage\n\nNothing changed, just reduced code duplication\nScreenshots", "createdAt": "2020-10-26T16:01:53Z", "url": "https://github.com/ls1intum/Artemis/pull/2277", "merged": true, "mergeCommit": {"oid": "59059884746691834f9d0d4ddd03a81934084992"}, "closed": true, "closedAt": "2020-10-29T20:06:25Z", "author": {"login": "fde312"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWWcddAH2gAyNTEwMTM1MzkwOjA2NDA5N2E5MDI4ZmIzMGEyOWQxNzlkNGE3NTk1MzU2ZDQ4M2JhMDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXX3o8gFqTUyMDAzOTU4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "064097a9028fb30a29d179d4a7595356d483ba01", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/064097a9028fb30a29d179d4a7595356d483ba01", "committedDate": "2020-10-26T15:52:34Z", "message": "fix NPE in for-dashboard call and reduce duplicated code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65976776721d0b53fbffa524f58016d51fee96dd", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/65976776721d0b53fbffa524f58016d51fee96dd", "committedDate": "2020-10-27T22:12:05Z", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into hotfix/programming-exercises/for-dashboard-call\n\n# Conflicts:\n#\tsrc/main/java/de/tum/in/www1/artemis/domain/ProgrammingExercise.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ba33230f7146dc1a19eaae008f2be207735e082", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/4ba33230f7146dc1a19eaae008f2be207735e082", "committedDate": "2020-10-27T23:06:39Z", "message": "remove again duplicated block after merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "feba79a1b61acdca5ec790439286b27c2554638c", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/feba79a1b61acdca5ec790439286b27c2554638c", "committedDate": "2020-10-27T23:12:24Z", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into hotfix/programming-exercises/for-dashboard-call"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10e10e4a44cebae9d361d2542b95c455974e1bff", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/10e10e4a44cebae9d361d2542b95c455974e1bff", "committedDate": "2020-10-28T00:10:29Z", "message": "move check to own method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4NDg3ODIw", "url": "https://github.com/ls1intum/Artemis/pull/2277#pullrequestreview-518487820", "createdAt": "2020-10-28T09:52:31Z", "commit": {"oid": "10e10e4a44cebae9d361d2542b95c455974e1bff"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4NTkwOTI4", "url": "https://github.com/ls1intum/Artemis/pull/2277#pullrequestreview-518590928", "createdAt": "2020-10-28T12:07:29Z", "commit": {"oid": "10e10e4a44cebae9d361d2542b95c455974e1bff"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5MzAwOTk2", "url": "https://github.com/ls1intum/Artemis/pull/2277#pullrequestreview-519300996", "createdAt": "2020-10-29T03:12:17Z", "commit": {"oid": "10e10e4a44cebae9d361d2542b95c455974e1bff"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwMzoxMjoxOFrOHqGfpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwMzoxMjoxOFrOHqGfpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzkwODY0Nw==", "bodyText": "I don't see where isAssessmentOver is used. Maybe I'm blind because codacy didn't report anything \ud83d\ude04", "url": "https://github.com/ls1intum/Artemis/pull/2277#discussion_r513908647", "createdAt": "2020-10-29T03:12:18Z", "author": {"login": "kloessst"}, "path": "src/main/java/de/tum/in/www1/artemis/domain/ProgrammingExercise.java", "diffHunk": "@@ -500,38 +500,7 @@ public void filterSensitiveInformation() {\n     @Override\n     public Set<Result> findResultsFilteredForStudents(Participation participation) {\n         boolean isAssessmentOver = getAssessmentDueDate() == null || getAssessmentDueDate().isBefore(ZonedDateTime.now());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "10e10e4a44cebae9d361d2542b95c455974e1bff"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5NjMzMTA5", "url": "https://github.com/ls1intum/Artemis/pull/2277#pullrequestreview-519633109", "createdAt": "2020-10-29T12:55:12Z", "commit": {"oid": "10e10e4a44cebae9d361d2542b95c455974e1bff"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMjo1NToxMlrOHqadeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMjo1NToxMlrOHqadeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDIzNTc2OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    boolean isAssessmentOver = getAssessmentDueDate() == null || getAssessmentDueDate().isBefore(ZonedDateTime.now());", "url": "https://github.com/ls1intum/Artemis/pull/2277#discussion_r514235768", "createdAt": "2020-10-29T12:55:12Z", "author": {"login": "fde312"}, "path": "src/main/java/de/tum/in/www1/artemis/domain/ProgrammingExercise.java", "diffHunk": "@@ -500,38 +500,7 @@ public void filterSensitiveInformation() {\n     @Override\n     public Set<Result> findResultsFilteredForStudents(Participation participation) {\n         boolean isAssessmentOver = getAssessmentDueDate() == null || getAssessmentDueDate().isBefore(ZonedDateTime.now());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "10e10e4a44cebae9d361d2542b95c455974e1bff"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f1bcaa288fd855e3f8ae7c9da9d82b3758178d8", "author": {"user": {"login": "fde312", "name": "Francisco De las Casas Young"}}, "url": "https://github.com/ls1intum/Artemis/commit/7f1bcaa288fd855e3f8ae7c9da9d82b3758178d8", "committedDate": "2020-10-29T12:55:43Z", "message": "Update src/main/java/de/tum/in/www1/artemis/domain/ProgrammingExercise.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08253bfd218cb2cd954134eabc297d2211315ca3", "author": {"user": {"login": "fde312", "name": "Francisco De las Casas Young"}}, "url": "https://github.com/ls1intum/Artemis/commit/08253bfd218cb2cd954134eabc297d2211315ca3", "committedDate": "2020-10-29T13:14:43Z", "message": "Merge branch 'develop' into hotfix/programming-exercises/for-dashboard-call"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5NjU0NjA5", "url": "https://github.com/ls1intum/Artemis/pull/2277#pullrequestreview-519654609", "createdAt": "2020-10-29T13:19:45Z", "commit": {"oid": "08253bfd218cb2cd954134eabc297d2211315ca3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMzoxOTo0NVrOHqbaZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMzoxOTo0NVrOHqbaZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDI1MTM2Nw==", "bodyText": "Codacy found an issue: Useless parentheses.", "url": "https://github.com/ls1intum/Artemis/pull/2277#discussion_r514251367", "createdAt": "2020-10-29T13:19:45Z", "author": {"login": "artemis-bot"}, "path": "src/main/java/de/tum/in/www1/artemis/domain/Exercise.java", "diffHunk": "@@ -536,12 +536,17 @@ public Submission findLatestSubmissionWithRatedResultWithCompletionDate(Particip\n         }\n         for (var submission : participation.getSubmissions()) {\n             var result = submission.getResult();\n-            if (result == null) {\n+            // If not the result does not exist or is not assessed yet, we can skip it\n+            if (result == null || result.getCompletionDate() == null) {\n                 continue;\n             }\n             // NOTE: for the dashboard we only use rated results with completion date\n             boolean isAssessmentOver = ignoreAssessmentDueDate || getAssessmentDueDate() == null || getAssessmentDueDate().isBefore(ZonedDateTime.now());\n-            if (result.getCompletionDate() != null && Boolean.TRUE.equals(result.isRated()) && isAssessmentOver) {\n+            boolean isProgrammingExercise = participation.getExercise() instanceof ProgrammingExercise;\n+            // Check that submission was submitted in time (rated). For non programming exercises we check if the assessment due date has passed (if set)\n+            if (Boolean.TRUE.equals(result.isRated()) && (!isProgrammingExercise && isAssessmentOver\n+                    // For programming exercises we check that the assessment due date has passed (if set) for manual results otherwise we always show the automatic result\n+                    || isProgrammingExercise && ((result.isManualResult() && isAssessmentOver) || result.getAssessmentType().equals(AssessmentType.AUTOMATIC)))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08253bfd218cb2cd954134eabc297d2211315ca3"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5NjU0NjI1", "url": "https://github.com/ls1intum/Artemis/pull/2277#pullrequestreview-519654625", "createdAt": "2020-10-29T13:19:46Z", "commit": {"oid": "08253bfd218cb2cd954134eabc297d2211315ca3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMzoxOTo0NlrOHqbadg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMzoxOTo0NlrOHqbadg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDI1MTM4Mg==", "bodyText": "Codacy found an issue: Useless parentheses.", "url": "https://github.com/ls1intum/Artemis/pull/2277#discussion_r514251382", "createdAt": "2020-10-29T13:19:46Z", "author": {"login": "artemis-bot"}, "path": "src/main/java/de/tum/in/www1/artemis/domain/ProgrammingExercise.java", "diffHunk": "@@ -544,6 +512,12 @@ public boolean areManualResultsAllowed() {\n         return getAssessmentType() == AssessmentType.SEMI_AUTOMATIC && (relevantDueDate == null || relevantDueDate.isBefore(ZonedDateTime.now()));\n     }\n \n+    private boolean checkForRatedAndAssessedResult(Result result) {\n+        boolean isAssessmentOver = getAssessmentDueDate() == null || getAssessmentDueDate().isBefore(ZonedDateTime.now());\n+        return Boolean.TRUE.equals(result.isRated()) && result.getCompletionDate() != null\n+                && ((result.isManualResult() && isAssessmentOver) || result.getAssessmentType().equals(AssessmentType.AUTOMATIC));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08253bfd218cb2cd954134eabc297d2211315ca3"}, "originalPosition": 61}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5ODQxNjQw", "url": "https://github.com/ls1intum/Artemis/pull/2277#pullrequestreview-519841640", "createdAt": "2020-10-29T16:17:01Z", "commit": {"oid": "08253bfd218cb2cd954134eabc297d2211315ca3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bea16f7b7320c98156d15c79cf971830a95de0d8", "author": {"user": {"login": "fde312", "name": "Francisco De las Casas Young"}}, "url": "https://github.com/ls1intum/Artemis/commit/bea16f7b7320c98156d15c79cf971830a95de0d8", "committedDate": "2020-10-29T19:21:29Z", "message": "Merge branch 'develop' into hotfix/programming-exercises/for-dashboard-call"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMDM2ODk3", "url": "https://github.com/ls1intum/Artemis/pull/2277#pullrequestreview-520036897", "createdAt": "2020-10-29T20:02:26Z", "commit": {"oid": "bea16f7b7320c98156d15c79cf971830a95de0d8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMDM5NTgx", "url": "https://github.com/ls1intum/Artemis/pull/2277#pullrequestreview-520039581", "createdAt": "2020-10-29T20:06:05Z", "commit": {"oid": "bea16f7b7320c98156d15c79cf971830a95de0d8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3947, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}