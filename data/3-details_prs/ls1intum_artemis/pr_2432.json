{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0MDgwNjg2", "number": 2432, "title": "Add Option to Disable More Feedback Requests", "bodyText": "Checklist\n\n The database changes got approved. --- Do not test this PR on the test servers until this is checked!\n I tested all changes and all related features with different users (student, tutor, instructor, admin) on the test server https://artemistest.ase.in.tum.de.\n Server: I added multiple integration tests (Spring) related to the features (with a high test coverage)\n Server: I implemented the changes with a good performance and prevented too many database calls\n Server: I documented the Java code using JavaDoc style.\n Client: I documented the TypeScript code using JSDoc style.\n Client: I added multiple screenshots/screencasts of my UI changes\n Client: I translated all the newly inserted strings into German and English\n\nMotivation and Context\nSome courses need to be able to adjust the assessment after a complaint if it is wrong because exam-rules apply, practical courses such as PGdP have this requirement. Student using the more feedback function only make everything more complicated,\nbecause the score cannot be modified by tutors. We want to disable more feedback requests for the course and only allow (unlimited) complaints because we more or less have to.\nDescription\n\nDatabase Change: added max_request_more_feedback_time_days column\nIt is not nullable and a primitive int.\nAdded a corresponding attribute to the Course class and adjusted some logic\nChanged course and complaint validation (on create/update)\nAdded the attribute on the client side as well\nAdjust client forms and some complaint-setting-based conditions\n\nOpen Questions\n\n Find out why team complaints do not work at all (even on develop, or am I doing something wrong?)\nSeems to be decided by this.isCurrentUserSubmissionAuthor = this.participation.student.id === user.id;, is that a problem?\n The same goes for more feedback requests for teams, those don't seem to exist as well.\n\nSteps for Testing\n\nReview the code, especially look if I missed something that needs to be changed as well\nTest that complaints with various course settings work:\n\nRequest more feedback enabled <-> disabled\nComplaints enabled <-> disabled.\n\n\nAdjust the course setting and then see, if the correct options are available for an already graded submission in this course.\n\"Request More Feedback\" should only be available if the option is checked, and \"Complain\" only when complaint tokens are available.\nSubmit a Complaint / More Feedback Request and check that it is accepted by the server (e.g. check on the Instructor Dashboard)\n\nTest Coverage\nmore or less unchanged\nScreenshots\n\nOptions\n\nStudents can only submit complaints and not request more feedback if disabled", "createdAt": "2020-11-19T16:33:20Z", "url": "https://github.com/ls1intum/Artemis/pull/2432", "merged": true, "mergeCommit": {"oid": "52dfe7ea588591b7ed5634f9c886b3cc5eefd4ee"}, "closed": true, "closedAt": "2020-11-20T16:19:57Z", "author": {"login": "MaisiKoleni"}, "timelineItems": {"totalCount": 34, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdTQJCegH2gAyNTI0MDgwNjg2OmJhNTVhYTc1YWQ4YjcwODA5OGU0ZDM4OTMxYjM3ZDY2ZTJjZTNkNzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeZvocgFqTUzNTU2NzY5NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ba55aa75ad8b708098e4d38931b37d66e2ce3d73", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/ba55aa75ad8b708098e4d38931b37d66e2ce3d73", "committedDate": "2020-10-17T00:50:09Z", "message": "Add requestMoreFeedback attribute to Course domain class and database"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44659b3274c9ecaf14ef9a96394817fcad6b441e", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/44659b3274c9ecaf14ef9a96394817fcad6b441e", "committedDate": "2020-10-17T00:53:30Z", "message": "Adjust Course validation and the way we decide if complaints are enabled"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "006e9c987663c5865fc89eccad456683064babcc", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/006e9c987663c5865fc89eccad456683064babcc", "committedDate": "2020-10-17T00:56:08Z", "message": "Don't allow creating more feedback requests if the course disabled them"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2d96343f41d2c02639b20b8b0f9d416a2466836", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/e2d96343f41d2c02639b20b8b0f9d416a2466836", "committedDate": "2020-10-17T00:57:50Z", "message": "Add requestMoreFeedbackEnabled for the client Course with default 'true'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62fbac3b0270dbd4b2e3ec8e71103760026c7e27", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/62fbac3b0270dbd4b2e3ec8e71103760026c7e27", "committedDate": "2020-10-17T01:02:57Z", "message": "Add a check box for requestMoreFeedbackEnabled to the edit course page"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c68aed8980be60f596c51de6de38d79cad03944", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/0c68aed8980be60f596c51de6de38d79cad03944", "committedDate": "2020-10-17T01:02:58Z", "message": "Change complain interaction component to respect the new settings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56d347f75251204cf7ac4669d558995b4067b7b9", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/56d347f75251204cf7ac4669d558995b4067b7b9", "committedDate": "2020-10-17T01:27:24Z", "message": "Adjust server tests to requestMoreFeedbackEnabled and add some tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19a714e15281deb7fa7a387e65e873b94f2d7dc5", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/19a714e15281deb7fa7a387e65e873b94f2d7dc5", "committedDate": "2020-10-17T02:12:36Z", "message": "Adjust client tests to new course update form"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5014b75efb06d5ad46407fca4fc0d7e00170103", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/c5014b75efb06d5ad46407fca4fc0d7e00170103", "committedDate": "2020-10-17T02:14:13Z", "message": "Merge branch 'develop' into feature/course/request-more-feedback-toggle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "052d25685fb7736d1546077841bd85239a06a00d", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/052d25685fb7736d1546077841bd85239a06a00d", "committedDate": "2020-10-17T02:20:38Z", "message": "Simplify the code a bit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f8b41bff3050f59b25563530b12dd4aca8f18de", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/9f8b41bff3050f59b25563530b12dd4aca8f18de", "committedDate": "2020-11-19T16:34:25Z", "message": "Merge branch 'develop' into feature/course/request-more-feedback-toggle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60c5512015227f3400f2884a1a0996e4cb6ab09a", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/60c5512015227f3400f2884a1a0996e4cb6ab09a", "committedDate": "2020-11-19T16:50:42Z", "message": "Change liquibase changelog id"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc5f8c492ede50e4e0e941ad8b809c400ae7e28f", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/bc5f8c492ede50e4e0e941ad8b809c400ae7e28f", "committedDate": "2020-11-19T21:25:23Z", "message": "Make request more feedback a separate option"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7e97de46c1ebff9f8c12e7ca1dabbdad0eeb9bf6", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/7e97de46c1ebff9f8c12e7ca1dabbdad0eeb9bf6", "committedDate": "2020-11-19T18:57:27Z", "message": "Make request more feedback a separate option"}, "afterCommit": {"oid": "bc5f8c492ede50e4e0e941ad8b809c400ae7e28f", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/bc5f8c492ede50e4e0e941ad8b809c400ae7e28f", "committedDate": "2020-11-19T21:25:23Z", "message": "Make request more feedback a separate option"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5e0c3bc0b179ba02e6df1903e81153510ea8cda", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/d5e0c3bc0b179ba02e6df1903e81153510ea8cda", "committedDate": "2020-11-19T21:52:11Z", "message": "Fix formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c81646ac9f4a663384aadbd7a5c42018fccacfff", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/c81646ac9f4a663384aadbd7a5c42018fccacfff", "committedDate": "2020-11-19T22:40:08Z", "message": "Fix bug in more feedback request validation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25dee3bfb7ecec68682ba6499b8ba26a4874ecda", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/25dee3bfb7ecec68682ba6499b8ba26a4874ecda", "committedDate": "2020-11-19T22:40:19Z", "message": "Merge branch 'develop' into feature/course/request-more-feedback-toggle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fd28cef523182f616c5c42baaa4239dc7d41639", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/9fd28cef523182f616c5c42baaa4239dc7d41639", "committedDate": "2020-11-19T22:46:48Z", "message": "Fix additional whitespace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e5bcb4fee851e5c294a367a67285dcc0f8d8677", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/6e5bcb4fee851e5c294a367a67285dcc0f8d8677", "committedDate": "2020-11-20T11:53:00Z", "message": "Merge branch 'develop' into feature/course/request-more-feedback-toggle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NDIyMzkx", "url": "https://github.com/ls1intum/Artemis/pull/2432#pullrequestreview-535422391", "createdAt": "2020-11-20T13:23:35Z", "commit": {"oid": "6e5bcb4fee851e5c294a367a67285dcc0f8d8677"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxMzoyMzozNlrOH3PdoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxMzoyMzozNlrOH3PdoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY4NzA3Mw==", "bodyText": "If maxDays is 14 this will result in \"14 weeks\" right?", "url": "https://github.com/ls1intum/Artemis/pull/2432#discussion_r527687073", "createdAt": "2020-11-20T13:23:36Z", "author": {"login": "kloessst"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ComplaintService.java", "diffHunk": "@@ -224,22 +226,44 @@ public Integer getMaxComplaintsPerParticipant(Course course, Participant partici\n     }\n \n     /**\n-     * This function checks whether the student is allowed to submit a complaint or not. Submitting a complaint is allowed within one week after the student received the result. If\n-     * the result was submitted after the assessment due date or the assessment due date is not set, the completion date of the result is checked. If the result was submitted\n-     * before the assessment due date, the assessment due date is checked, as the student can only see the result after the assessment due date.\n+     * This function checks whether the student is allowed to submit a complaint / more feedback request or not.\n+     * This is allowed within the corresponding number of days set in the course after the student received the result.\n+     * If the result was submitted after the assessment due date or the assessment due date is not set, the completion date of the result is checked.\n+     * If the result was submitted before the assessment due date, the assessment due date is checked, as the student can only see the result after the assessment due date.\n      */\n-    private boolean isTimeOfComplaintValid(Result result, Exercise exercise, Course course) {\n+    private static void validateTimeOfComplaintOrRequestMoreFeedback(Result result, Exercise exercise, Course course, ComplaintType type) {\n+        int maxDays = switch (type) {\n+            case COMPLAINT -> course.getMaxComplaintTimeDays();\n+            case MORE_FEEDBACK -> course.getMaxRequestMoreFeedbackTimeDays();\n+        };\n+\n+        boolean isTimeValid;\n         if (exercise.getAssessmentDueDate() == null || result.getCompletionDate().isAfter(exercise.getAssessmentDueDate())) {\n-            return result.getCompletionDate().isAfter(ZonedDateTime.now().minusDays(course.getMaxComplaintTimeDays()));\n+            isTimeValid = result.getCompletionDate().isAfter(ZonedDateTime.now().minusDays(maxDays));\n+        }\n+        else {\n+            isTimeValid = exercise.getAssessmentDueDate().isAfter(ZonedDateTime.now().minusDays(maxDays));\n+        }\n+\n+        if (!isTimeValid) {\n+            StringBuilder message = new StringBuilder(\"You cannot \");\n+            message.append(type == ComplaintType.COMPLAINT ? \"submit a complaint\" : \"request more feedback\");\n+            message.append(\" for a result that is older than \");\n+            message.append(switch (maxDays) {\n+                case 1 -> \"one day\";\n+                case 7 -> \"one week\";\n+                default -> maxDays + (maxDays % 7 == 0 ? \" weeks\" : \" days\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e5bcb4fee851e5c294a367a67285dcc0f8d8677"}, "originalPosition": 49}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NDYxNDUz", "url": "https://github.com/ls1intum/Artemis/pull/2432#pullrequestreview-535461453", "createdAt": "2020-11-20T14:13:49Z", "commit": {"oid": "6e5bcb4fee851e5c294a367a67285dcc0f8d8677"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NDYyODkz", "url": "https://github.com/ls1intum/Artemis/pull/2432#pullrequestreview-535462893", "createdAt": "2020-11-20T14:15:28Z", "commit": {"oid": "6e5bcb4fee851e5c294a367a67285dcc0f8d8677"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NDY0Mjc4", "url": "https://github.com/ls1intum/Artemis/pull/2432#pullrequestreview-535464278", "createdAt": "2020-11-20T14:17:06Z", "commit": {"oid": "6e5bcb4fee851e5c294a367a67285dcc0f8d8677"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NDY0Njg4", "url": "https://github.com/ls1intum/Artemis/pull/2432#pullrequestreview-535464688", "createdAt": "2020-11-20T14:17:36Z", "commit": {"oid": "6e5bcb4fee851e5c294a367a67285dcc0f8d8677"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NDY0NzQ0", "url": "https://github.com/ls1intum/Artemis/pull/2432#pullrequestreview-535464744", "createdAt": "2020-11-20T14:17:39Z", "commit": {"oid": "6e5bcb4fee851e5c294a367a67285dcc0f8d8677"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61eb1403279dc2f4eb6459e3ebfc8941569e36ae", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/61eb1403279dc2f4eb6459e3ebfc8941569e36ae", "committedDate": "2020-11-20T15:05:55Z", "message": "Fix number of weeks in error message generation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NTE3OTI3", "url": "https://github.com/ls1intum/Artemis/pull/2432#pullrequestreview-535517927", "createdAt": "2020-11-20T15:18:03Z", "commit": {"oid": "61eb1403279dc2f4eb6459e3ebfc8941569e36ae"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NTE5MzQy", "url": "https://github.com/ls1intum/Artemis/pull/2432#pullrequestreview-535519342", "createdAt": "2020-11-20T15:19:41Z", "commit": {"oid": "61eb1403279dc2f4eb6459e3ebfc8941569e36ae"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NTIzOTU3", "url": "https://github.com/ls1intum/Artemis/pull/2432#pullrequestreview-535523957", "createdAt": "2020-11-20T15:24:54Z", "commit": {"oid": "61eb1403279dc2f4eb6459e3ebfc8941569e36ae"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54022ca06dc2cdb737454fe95cea55f7b5a9cd47", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/54022ca06dc2cdb737454fe95cea55f7b5a9cd47", "committedDate": "2020-11-20T15:38:36Z", "message": "Fix parentheses"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NTY2MTY4", "url": "https://github.com/ls1intum/Artemis/pull/2432#pullrequestreview-535566168", "createdAt": "2020-11-20T16:12:46Z", "commit": {"oid": "54022ca06dc2cdb737454fe95cea55f7b5a9cd47"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NTY3MjEy", "url": "https://github.com/ls1intum/Artemis/pull/2432#pullrequestreview-535567212", "createdAt": "2020-11-20T16:14:03Z", "commit": {"oid": "54022ca06dc2cdb737454fe95cea55f7b5a9cd47"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NTY3Mjg0", "url": "https://github.com/ls1intum/Artemis/pull/2432#pullrequestreview-535567284", "createdAt": "2020-11-20T16:14:08Z", "commit": {"oid": "54022ca06dc2cdb737454fe95cea55f7b5a9cd47"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NTY3Njk1", "url": "https://github.com/ls1intum/Artemis/pull/2432#pullrequestreview-535567695", "createdAt": "2020-11-20T16:14:37Z", "commit": {"oid": "54022ca06dc2cdb737454fe95cea55f7b5a9cd47"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3694, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}