{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyNTcwNTM0", "number": 2299, "title": "Use Set instead of List for TextSubmission.textBlocks", "bodyText": "This relationship does not have an @Ordered annotation, so the order cannot be retrieved from the database\nChecklist\n\n I tested all changes and all related features with different users (student, tutor, instructor, admin) on the test server https://artemistest.ase.in.tum.de.\n\nSteps for Testing\n\nLog in to Artemis\nCreate, participate and assess text exercises\nBoth, with manual and semi-automatic assessment enabled\n\nNo client functionality is changed", "createdAt": "2020-10-29T21:08:26Z", "url": "https://github.com/ls1intum/Artemis/pull/2299", "merged": true, "mergeCommit": {"oid": "2b086ba25d3def269dbc8147d35e4e8307418545"}, "closed": true, "closedAt": "2020-11-15T11:21:55Z", "author": {"login": "krusche"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXYBwaAH2gAyNTEyNTcwNTM0OmQ2NjYzNzI0NjczYTAzZWY1NmY1NWMyMjNlZmU1ZTZkYjFiZmVhMGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdctN3JgFqTUzMDc3OTQ2OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d6663724673a03ef56f55c223efe5e6db1bfea0c", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/d6663724673a03ef56f55c223efe5e6db1bfea0c", "committedDate": "2020-10-29T20:17:08Z", "message": "List -> Set for TextSubmission.textBlocks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "845799d5c14232a591b76d1be8636ac419a54c02", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/845799d5c14232a591b76d1be8636ac419a54c02", "committedDate": "2020-10-29T21:04:51Z", "message": "fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b225128d540f2e876d0ba30dfb9528f61a2cb35d", "author": {"user": {"login": "krusche", "name": "Stephan Krusche"}}, "url": "https://github.com/ls1intum/Artemis/commit/b225128d540f2e876d0ba30dfb9528f61a2cb35d", "committedDate": "2020-11-06T00:03:20Z", "message": "Merge branch 'develop' into chore/text-block-set"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f222259dc78b3d9cc4fcbabd0b45e3190b9b2a6", "author": {"user": {"login": "jpbernius", "name": "Jan Philip Bernius"}}, "url": "https://github.com/ls1intum/Artemis/commit/8f222259dc78b3d9cc4fcbabd0b45e3190b9b2a6", "committedDate": "2020-11-06T08:03:21Z", "message": "TextBlockService\n\nReturn Set in splitSubmissionIntoBlocks()\n\nSigned-off-by: Jan Philip Bernius <janphilip.bernius@tum.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "161326ce22f3dedf6eb1f0f9466a539e9d75f61c", "author": {"user": {"login": "jpbernius", "name": "Jan Philip Bernius"}}, "url": "https://github.com/ls1intum/Artemis/commit/161326ce22f3dedf6eb1f0f9466a539e9d75f61c", "committedDate": "2020-11-06T08:03:55Z", "message": "AutomaticTextAssessmentConflictService\n\ngroupingBy with toSet()\n\nSigned-off-by: Jan Philip Bernius <janphilip.bernius@tum.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d55c2ea62ecf0b9b23e69ee19a53261116a638b", "author": {"user": {"login": "jpbernius", "name": "Jan Philip Bernius"}}, "url": "https://github.com/ls1intum/Artemis/commit/6d55c2ea62ecf0b9b23e69ee19a53261116a638b", "committedDate": "2020-11-06T08:05:37Z", "message": "TextAssessmentResource\n\ndo not overwrite parameters of saveTextBlocks()\n\nSigned-off-by: Jan Philip Bernius <janphilip.bernius@tum.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89af7f5ea49a7f8855dc50bb0269e442a3714b14", "author": {"user": {"login": "jpbernius", "name": "Jan Philip Bernius"}}, "url": "https://github.com/ls1intum/Artemis/commit/89af7f5ea49a7f8855dc50bb0269e442a3714b14", "committedDate": "2020-11-06T08:11:29Z", "message": "TextExerciseUtilService\n\nJavaDoc\n\nSigned-off-by: Jan Philip Bernius <janphilip.bernius@tum.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0OTE1MTg0", "url": "https://github.com/ls1intum/Artemis/pull/2299#pullrequestreview-524915184", "createdAt": "2020-11-06T07:40:36Z", "commit": {"oid": "b225128d540f2e876d0ba30dfb9528f61a2cb35d"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwNzo0MDozNlrOHujFZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwNzo1OToyOFrOHujkxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODU3MTM2NQ==", "bodyText": "Should be possible to allocate the HashSet in the groupingBy\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    final Map<Long, List<TextBlock>> textBlocks = allTextBlocks.stream().collect(groupingBy(block -> block.getSubmission().getId()));\n          \n          \n            \n                    textSubmissionSet.forEach(textSubmission -> textSubmission.setBlocks(new HashSet<>(textBlocks.get(textSubmission.getId()))));\n          \n          \n            \n                    final Map<Long, List<TextBlock>> textBlocks = allTextBlocks.stream().collect(groupingBy(block -> block.getSubmission().getId(), toSet()));\n          \n          \n            \n                    textSubmissionSet.forEach(textSubmission -> textSubmission.setBlocks(textBlocks.get(textSubmission.getId())));", "url": "https://github.com/ls1intum/Artemis/pull/2299#discussion_r518571365", "createdAt": "2020-11-06T07:40:36Z", "author": {"login": "jpbernius"}, "path": "src/main/java/de/tum/in/www1/artemis/service/AutomaticTextAssessmentConflictService.java", "diffHunk": "@@ -149,9 +145,9 @@ public void asyncCheckFeedbackConsistency(List<TextBlock> textBlocks, List<Feedb\n                 return (TextSubmission) conflict.getFirstFeedback().getResult().getSubmission();\n             }\n         }).collect(toSet());\n-        final Map<Long, List<TextBlock>> textBlocks = textBlockRepository.findAllBySubmissionIdIn(textSubmissionSet.stream().map(TextSubmission::getId).collect(toList())).stream()\n-                .collect(groupingBy(b -> b.getSubmission().getId()));\n-        textSubmissionSet.forEach(textSubmission -> textSubmission.setBlocks(textBlocks.get(textSubmission.getId())));\n+        var allTextBlocks = textBlockRepository.findAllBySubmissionIdIn(textSubmissionSet.stream().map(TextSubmission::getId).collect(toSet()));\n+        final Map<Long, List<TextBlock>> textBlocks = allTextBlocks.stream().collect(groupingBy(block -> block.getSubmission().getId()));\n+        textSubmissionSet.forEach(textSubmission -> textSubmission.setBlocks(new HashSet<>(textBlocks.get(textSubmission.getId()))));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b225128d540f2e876d0ba30dfb9528f61a2cb35d"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODU3OTM5Ng==", "bodyText": "This can be changed to public Set<TextBlock> splitSubmissionIntoBlocks(TextSubmission submission). Will submit a commit.", "url": "https://github.com/ls1intum/Artemis/pull/2299#discussion_r518579396", "createdAt": "2020-11-06T07:59:28Z", "author": {"login": "jpbernius"}, "path": "src/main/java/de/tum/in/www1/artemis/service/TextBlockService.java", "diffHunk": "@@ -49,11 +46,11 @@\n      * @param submission TextSubmission to split\n      * @return List of TextBlocks\n      */\n-    @Transactional(readOnly = true)\n     public List<TextBlock> splitSubmissionIntoBlocks(TextSubmission submission) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b225128d540f2e876d0ba30dfb9528f61a2cb35d"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5OTk2NDYz", "url": "https://github.com/ls1intum/Artemis/pull/2299#pullrequestreview-529996463", "createdAt": "2020-11-13T11:46:34Z", "commit": {"oid": "89af7f5ea49a7f8855dc50bb0269e442a3714b14"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxMTo0NjozNFrOHyrUuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxMTo0ODo1NVrOHyrYfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjkwMDY2Nw==", "bodyText": "Would it make sense to use Collections.emptySet() here, which avoids allocating a new HashSet if we don't need it?", "url": "https://github.com/ls1intum/Artemis/pull/2299#discussion_r522900667", "createdAt": "2020-11-13T11:46:34Z", "author": {"login": "FrankeLukas"}, "path": "src/main/java/de/tum/in/www1/artemis/service/TextBlockService.java", "diffHunk": "@@ -49,23 +46,24 @@\n      * @param submission TextSubmission to split\n      * @return List of TextBlocks\n      */\n-    @Transactional(readOnly = true)\n-    public List<TextBlock> splitSubmissionIntoBlocks(TextSubmission submission) {\n+    public Set<TextBlock> splitSubmissionIntoBlocks(TextSubmission submission) {\n+        final Set<TextBlock> blocks = new HashSet<>();\n+\n+        // Return empty set for missing submission text.\n         final String submissionText = submission.getText();\n-        if (submissionText == null)\n-            return new ArrayList<>();\n-        // Return empty list for missing submission text.\n+        if (submissionText == null) {\n+            return blocks;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89af7f5ea49a7f8855dc50bb0269e442a3714b14"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjkwMTYyOA==", "bodyText": "Typo: expectedText", "url": "https://github.com/ls1intum/Artemis/pull/2299#discussion_r522901628", "createdAt": "2020-11-13T11:48:55Z", "author": {"login": "FrankeLukas"}, "path": "src/test/java/de/tum/in/www1/artemis/service/TextBlockServiceTest.java", "diffHunk": "@@ -47,42 +45,57 @@ public void splitSubmissionIntoBlocksForEmptyText() {\n     @Test\n     public void splitSubmissionIntoBlocksForSingleSentence() {\n         final TextSubmission submission = new TextSubmission(0L).text(\"Hello World.\");\n-        final List<TextBlock> textBlocks = textBlockService.splitSubmissionIntoBlocks(submission);\n+        final var textBlocks = textBlockService.splitSubmissionIntoBlocks(submission);\n \n         assertThat(textBlocks, hasSize(1));\n-        assertThat(textBlocks.get(0).getText(), is(equalTo(\"Hello World.\")));\n+        assertThat(textBlocks.iterator().next().getText(), is(equalTo(\"Hello World.\")));\n     }\n \n     @Test\n     public void splitSubmissionIntoBlocksForTwoSentencesWithoutNewLine() {\n         final TextSubmission submission = new TextSubmission(0L).text(\"Hello World. This is a Test.\");\n-        final List<TextBlock> textBlocks = textBlockService.splitSubmissionIntoBlocks(submission);\n+        final var textBlocks = textBlockService.splitSubmissionIntoBlocks(submission);\n \n         assertThat(textBlocks, hasSize(2));\n-        assertThat(textBlocks.get(0).getText(), is(equalTo(\"Hello World.\")));\n-        assertThat(textBlocks.get(1).getText(), is(equalTo(\"This is a Test.\")));\n+        assertThat(textBlocks, hasItem(textBlockWithEqualText(\"Hello World.\")));\n+        assertThat(textBlocks, hasItem(textBlockWithEqualText(\"This is a Test.\")));\n     }\n \n     @Test\n     public void splitSubmissionsIntoBlocksForManySentencesWithNewlinesWithoutFullstop() {\n         final TextSubmission submission = new TextSubmission(0L).text(\"Hello World. This is a Test\\n\\n\\nAnother Test\");\n-        final List<TextBlock> textBlocks = textBlockService.splitSubmissionIntoBlocks(submission);\n+        final var textBlocks = textBlockService.splitSubmissionIntoBlocks(submission);\n \n         assertThat(textBlocks, hasSize(3));\n-        assertThat(textBlocks.get(0).getText(), is(equalTo(\"Hello World.\")));\n-        assertThat(textBlocks.get(1).getText(), is(equalTo(\"This is a Test\")));\n-        assertThat(textBlocks.get(2).getText(), is(equalTo(\"Another Test\")));\n+        assertThat(textBlocks, hasItem(textBlockWithEqualText(\"Hello World.\")));\n+        assertThat(textBlocks, hasItem(textBlockWithEqualText(\"This is a Test\")));\n+        assertThat(textBlocks, hasItem(textBlockWithEqualText(\"Another Test\")));\n     }\n \n     @Test\n     public void splitSubmissionIntoBlocksForManySentencesWithoutPunctuation() {\n         final TextSubmission submission = new TextSubmission(0L).text(\"Example:\\nThis is the first example\\n\\nSection 2:\\n- Here is a list\\n- Of many bullet  points\\n\\n\");\n-        final List<TextBlock> textBlocks = textBlockService.splitSubmissionIntoBlocks(submission);\n+        final var textBlocks = textBlockService.splitSubmissionIntoBlocks(submission);\n \n         String[] sections = new String[] { \"Example:\", \"This is the first example\", \"Section 2:\", \"- Here is a list\", \"- Of many bullet  points\" };\n         assertThat(textBlocks, hasSize(sections.length));\n-        for (int i = 0; i < sections.length; i++) {\n-            assertThat(textBlocks.get(i).getText(), is(equalTo(sections[i])));\n+        for (String section : sections) {\n+            assertThat(textBlocks, hasItem(textBlockWithEqualText(section)));\n         }\n     }\n+\n+    private Matcher<TextBlock> textBlockWithEqualText(String expextedText) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89af7f5ea49a7f8855dc50bb0269e442a3714b14"}, "originalPosition": 95}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwMDAxMzI1", "url": "https://github.com/ls1intum/Artemis/pull/2299#pullrequestreview-530001325", "createdAt": "2020-11-13T11:55:00Z", "commit": {"oid": "89af7f5ea49a7f8855dc50bb0269e442a3714b14"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70c97c50dcb38a9c6a88ab324e337726e7706299", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/70c97c50dcb38a9c6a88ab324e337726e7706299", "committedDate": "2020-11-15T08:37:35Z", "message": "fixed issues found in comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08ff0671c4916522654e75ba2ab846d4beffcfb6", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/08ff0671c4916522654e75ba2ab846d4beffcfb6", "committedDate": "2020-11-15T08:38:01Z", "message": "Merge branch 'develop' into chore/text-block-set"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNzgxNTc4", "url": "https://github.com/ls1intum/Artemis/pull/2299#pullrequestreview-530781578", "createdAt": "2020-11-15T09:34:20Z", "commit": {"oid": "08ff0671c4916522654e75ba2ab846d4beffcfb6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNzgyMzY2", "url": "https://github.com/ls1intum/Artemis/pull/2299#pullrequestreview-530782366", "createdAt": "2020-11-15T09:44:51Z", "commit": {"oid": "08ff0671c4916522654e75ba2ab846d4beffcfb6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNzc5NDY5", "url": "https://github.com/ls1intum/Artemis/pull/2299#pullrequestreview-530779469", "createdAt": "2020-11-15T09:02:40Z", "commit": {"oid": "08ff0671c4916522654e75ba2ab846d4beffcfb6"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQwOTowMjo0MVrOHzd7Rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQwOTowMjo0MVrOHzd7Rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzcyOTczNA==", "bodyText": "Does it make sense to use a immutable set here? The other returned set are mutable. Maybe refactor to only return immutable sets? Set<String> immutable = ImmutableSet.copyOf(set);", "url": "https://github.com/ls1intum/Artemis/pull/2299#discussion_r523729734", "createdAt": "2020-11-15T09:02:41Z", "author": {"login": "stefanwaldhauser"}, "path": "src/main/java/de/tum/in/www1/artemis/service/TextBlockService.java", "diffHunk": "@@ -49,23 +46,23 @@\n      * @param submission TextSubmission to split\n      * @return List of TextBlocks\n      */\n-    @Transactional(readOnly = true)\n-    public List<TextBlock> splitSubmissionIntoBlocks(TextSubmission submission) {\n+    public Set<TextBlock> splitSubmissionIntoBlocks(TextSubmission submission) {\n+\n+        // Return empty set for missing submission text.\n         final String submissionText = submission.getText();\n-        if (submissionText == null)\n-            return new ArrayList<>();\n-        // Return empty list for missing submission text.\n+        if (submissionText == null) {\n+            return Collections.emptySet();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08ff0671c4916522654e75ba2ab846d4beffcfb6"}, "originalPosition": 44}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3537, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}