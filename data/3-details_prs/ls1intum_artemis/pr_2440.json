{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI1MDEwMjMx", "number": 2440, "title": "Allow to set timeout for jenkins pipelines", "bodyText": "Fixes #2434\nChecklist\n\n I tested all changes and all related features with different users (student, tutor, instructor, admin) on the test server https://artemistest.ase.in.tum.de.\n Server: I followed the coding and design guidelines.\n Server: I added @PreAuthorize and check the course groups for all new REST Calls (security)\n Server: I implemented the changes with a good performance and prevented too many database calls\n\nMotivation and Context\nTimeout out removes stale builds so i don't have to to it manually\nDescription\n\nSteps for Testing\nUse TS2 for testing\n\nCreate a programming exercise\nGo to Edit in Editor, change to the Test Repository and remove the @StrictTimeout annotations from SortingBehaviorTest.java\nParticipate in the exercise\nSubmit valid code with an endless loop\nCheck the build plan in Jenkins. It should be stopped after 30 mins.\n\nI have no set up server. So I would be cool if one could help me test this or something similar.", "createdAt": "2020-11-20T23:37:43Z", "url": "https://github.com/ls1intum/Artemis/pull/2440", "merged": true, "mergeCommit": {"oid": "d008aa099dd9e0d7cb8066c4dbac032acb9869c6"}, "closed": true, "closedAt": "2020-11-24T21:05:33Z", "author": {"login": "1-alex98"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdegCfpgH2gAyNTI1MDEwMjMxOmE3ZTlmYzJiNGQ3MTA3YWQ0OWZhOWRhYmM5NTc0ZTI5OGZhOGJmOTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdfwTRjgFqTUzNzkyMDI5NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a7e9fc2b4d7107ad49fa9dabc9574e298fa8bf93", "author": {"user": {"login": "1-alex98", "name": "Alexander von Trostorff"}}, "url": "https://github.com/ls1intum/Artemis/commit/a7e9fc2b4d7107ad49fa9dabc9574e298fa8bf93", "committedDate": "2020-11-20T23:34:39Z", "message": "Allow to set timeout for jenkins pipelines\n\nFixes #2434"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1ODQ0Mjkz", "url": "https://github.com/ls1intum/Artemis/pull/2440#pullrequestreview-535844293", "createdAt": "2020-11-20T23:38:38Z", "commit": {"oid": "a7e9fc2b4d7107ad49fa9dabc9574e298fa8bf93"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQyMzozODozOFrOH3kJHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQyMzozOToxMVrOH3kJtg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODAyNTg4Nw==", "bodyText": "That code was duplicated 3 times and it was not readable in terms of what thing was replaced by what", "url": "https://github.com/ls1intum/Artemis/pull/2440#discussion_r528025887", "createdAt": "2020-11-20T23:38:38Z", "author": {"login": "1-alex98"}, "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/jenkins/DefaultJenkinsBuildPlanCreator.java", "diffHunk": "@@ -1,33 +0,0 @@\n-package de.tum.in.www1.artemis.service.connectors.jenkins;\n-\n-import java.net.URL;\n-import java.util.Map;\n-\n-import org.springframework.context.annotation.Lazy;\n-import org.springframework.context.annotation.Profile;\n-import org.springframework.stereotype.Component;\n-\n-import de.tum.in.www1.artemis.ResourceLoaderService;\n-import de.tum.in.www1.artemis.config.Constants;\n-import de.tum.in.www1.artemis.domain.enumeration.ProgrammingLanguage;\n-\n-@Profile(\"jenkins\")\n-@Component\n-public class DefaultJenkinsBuildPlanCreator extends AbstractJenkinsBuildPlanCreator {\n-\n-    public DefaultJenkinsBuildPlanCreator(ResourceLoaderService resourceLoaderService, @Lazy JenkinsService jenkinsService) {\n-        super(resourceLoaderService, jenkinsService);\n-    }\n-\n-    @Override\n-    public String getPipelineScript(ProgrammingLanguage programmingLanguage, URL testRepositoryURL, URL assignmentRepositoryURL, boolean isStaticCodeAnalysisEnabled) {\n-        final var resourcePath = new String[] { \"templates\", \"jenkins\", programmingLanguage.name().toLowerCase(), \"Jenkinsfile\" };\n-\n-        final var replacements = Map.of(REPLACE_TEST_REPO, testRepositoryURL.toString(), REPLACE_ASSIGNMENT_REPO, assignmentRepositoryURL.toString(), REPLACE_GIT_CREDENTIALS,\n-                gitCredentialsKey, REPLACE_ASSIGNMENT_CHECKOUT_PATH, Constants.ASSIGNMENT_CHECKOUT_PATH, REPLACE_TESTS_CHECKOUT_PATH, Constants.TESTS_CHECKOUT_PATH,\n-                REPLACE_ARTEMIS_NOTIFICATION_URL, artemisNotificationUrl, REPLACE_NOTIFICATIONS_TOKEN, ARTEMIS_AUTHENTICATION_TOKEN_KEY, REPLACE_DOCKER_IMAGE_NAME,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7e9fc2b4d7107ad49fa9dabc9574e298fa8bf93"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODAyNjAzOA==", "bodyText": "Only set what is really different here", "url": "https://github.com/ls1intum/Artemis/pull/2440#discussion_r528026038", "createdAt": "2020-11-20T23:39:11Z", "author": {"login": "1-alex98"}, "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/jenkins/JavaJenkinsBuildPlanCreator.java", "diffHunk": "@@ -23,25 +22,19 @@ public JavaJenkinsBuildPlanCreator(ResourceLoaderService resourceLoaderService,\n     }\n \n     @Override\n-    public String getPipelineScript(ProgrammingLanguage programmingLanguage, URL testRepositoryURL, URL assignmentRepositoryURL, boolean isStaticCodeAnalysisEnabled) {\n+    protected String[] getResourcePath(ProgrammingLanguage programmingLanguage, URL testRepositoryURL, URL assignmentRepositoryURL, boolean isStaticCodeAnalysisEnabled) {\n         final var buildPlan = isStaticCodeAnalysisEnabled ? \"Jenkinsfile-staticCodeAnalysis\" : \"Jenkinsfile\";\n-        final var resourcePath = new String[] { \"templates\", \"jenkins\", \"java\", buildPlan };\n+        return new String[] { \"templates\", \"jenkins\", \"java\", buildPlan };\n+    }\n \n-        Map<String, String> replacements;\n-        if (isStaticCodeAnalysisEnabled) {\n+    @Override\n+    protected Map<String, String> getReplacements(ProgrammingLanguage programmingLanguage, URL testRepositoryURL, URL assignmentRepositoryURL, boolean isStaticCodeAnalysisEnabled) {\n+        Map<String, String> replacements = super.getReplacements(programmingLanguage, testRepositoryURL, assignmentRepositoryURL, isStaticCodeAnalysisEnabled);\n+        if(isStaticCodeAnalysisEnabled){\n             String staticCodeAnalysisScript = createStaticCodeAnalysisScript();\n-            replacements = Map.of(REPLACE_TEST_REPO, testRepositoryURL.toString(), REPLACE_ASSIGNMENT_REPO, assignmentRepositoryURL.toString(), REPLACE_GIT_CREDENTIALS,\n-                    gitCredentialsKey, REPLACE_ASSIGNMENT_CHECKOUT_PATH, Constants.ASSIGNMENT_CHECKOUT_PATH, REPLACE_ARTEMIS_NOTIFICATION_URL, artemisNotificationUrl,\n-                    REPLACE_NOTIFICATIONS_TOKEN, ARTEMIS_AUTHENTICATION_TOKEN_KEY, REPLACE_STATIC_CODE_ANALYSIS_SCRIPT, staticCodeAnalysisScript, REPLACE_DOCKER_IMAGE_NAME,\n-                    jenkinsService.getDockerImageName(ProgrammingLanguage.JAVA));\n+            replacements.put(REPLACE_STATIC_CODE_ANALYSIS_SCRIPT, staticCodeAnalysisScript);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7e9fc2b4d7107ad49fa9dabc9574e298fa8bf93"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MDA5NTk2", "url": "https://github.com/ls1intum/Artemis/pull/2440#pullrequestreview-536009596", "createdAt": "2020-11-21T21:19:49Z", "commit": {"oid": "a7e9fc2b4d7107ad49fa9dabc9574e298fa8bf93"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97d16243912fe323c083ee6e157006a6e967efdf", "author": {"user": {"login": "jpbernius", "name": "Jan Philip Bernius"}}, "url": "https://github.com/ls1intum/Artemis/commit/97d16243912fe323c083ee6e157006a6e967efdf", "committedDate": "2020-11-23T23:58:36Z", "message": "Merge branch 'develop' into feature/jenkins/#2434-jenkins-timeout"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3NjMzMTQy", "url": "https://github.com/ls1intum/Artemis/pull/2440#pullrequestreview-537633142", "createdAt": "2020-11-24T15:32:32Z", "commit": {"oid": "97d16243912fe323c083ee6e157006a6e967efdf"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d174761fff545710c54bfac282fa8b87e12493a", "author": {"user": {"login": "kloessst", "name": "Stefan Kl\u00f6ss-Schuster"}}, "url": "https://github.com/ls1intum/Artemis/commit/5d174761fff545710c54bfac282fa8b87e12493a", "committedDate": "2020-11-24T15:58:23Z", "message": "Merge branch 'develop' into feature/jenkins/#2434-jenkins-timeout"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91ee8331f8eb96c03bb792112dc2373481af9b14", "author": {"user": {"login": "kloessst", "name": "Stefan Kl\u00f6ss-Schuster"}}, "url": "https://github.com/ls1intum/Artemis/commit/91ee8331f8eb96c03bb792112dc2373481af9b14", "committedDate": "2020-11-24T16:09:37Z", "message": "Fix codacy issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3ODMwNDA0", "url": "https://github.com/ls1intum/Artemis/pull/2440#pullrequestreview-537830404", "createdAt": "2020-11-24T19:17:56Z", "commit": {"oid": "91ee8331f8eb96c03bb792112dc2373481af9b14"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3ODMyMTEy", "url": "https://github.com/ls1intum/Artemis/pull/2440#pullrequestreview-537832112", "createdAt": "2020-11-24T19:20:19Z", "commit": {"oid": "91ee8331f8eb96c03bb792112dc2373481af9b14"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3OTIwMjk0", "url": "https://github.com/ls1intum/Artemis/pull/2440#pullrequestreview-537920294", "createdAt": "2020-11-24T21:05:23Z", "commit": {"oid": "91ee8331f8eb96c03bb792112dc2373481af9b14"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3721, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}