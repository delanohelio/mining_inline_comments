{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0ODE3Mjgx", "number": 2068, "title": "Add build logs to database.", "bodyText": "Checklist\n\n I tested all changes and all related features with different users (student, tutor, instructor, admin) on the test server https://artemistest.ase.in.tum.de.\n Server: I added multiple integration tests (Spring) related to the features (with a high test coverage)\n Server: I added @PreAuthorize and check the course groups for all new REST Calls (security)\n Server: I implemented the changes with a good performance and prevented too many database calls\n Server: I documented the Java code using JavaDoc style.\n\nMotivation and Context\nSee #2067:\nCurrently, Artemis has to fetch the build logs from the CI server (like Bamboo) every time the client requests these logs.\nThis is not optimal as on the one hand, it causes additional requests to the CI server. On the other hand, the build logs might be cleaned on the CI server and are thus not available anymore.\nDescription\nWe store the build logs of failed builds within Artemis. If the build plans are cleaned on the CI server, they are still persisted in Artemis.\nWe do not have to store logs of builds that did not fail as the feedback is then displayed directly within Artemis.\nArtemis will still include the current behavior (fetching the build logs) as existing submissions do not have build logs stored in the database and we currently only plan to implement this behavior for Bamboo, not for Jenkins.\nThe database changes have been approved in #2067.\nSteps for Testing\n\nParticipate in a programming exercise using the online code editor\nProduce a failed build -> The build log should be shown & should be correctly formatted\nIf testing locally (requires setup for the programming exercises): Ensure that the build logs are persisted in the database\n\nTest Coverage\n\nBambooService.java: 33% (previously 32%)", "createdAt": "2020-08-27T16:31:58Z", "url": "https://github.com/ls1intum/Artemis/pull/2068", "merged": true, "mergeCommit": {"oid": "255b674aa81b97f9f0f3bde3132a2c3e23c8eef9"}, "closed": true, "closedAt": "2020-09-24T16:38:45Z", "author": {"login": "sleiss"}, "timelineItems": {"totalCount": 32, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdDDCSGgH2gAyNDc0ODE3MjgxOmZiMDljYTkzOGZkMWY5NDU5ZmJhODQyYWExZDQxNjMwNzc3ODNkNTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdMCNVVAFqTQ5NTY0NDU1MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fb09ca938fd1f9459fba842aa1d4163077783d55", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/fb09ca938fd1f9459fba842aa1d4163077783d55", "committedDate": "2020-08-27T16:31:13Z", "message": "Add build logs to database."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73879b717b7cce2ee46602996febfdda55b85720", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/73879b717b7cce2ee46602996febfdda55b85720", "committedDate": "2020-08-27T16:36:56Z", "message": "Add getter and setter."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1f12344395a80240e3cd79db15103aa45d146da", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/c1f12344395a80240e3cd79db15103aa45d146da", "committedDate": "2020-08-29T09:32:01Z", "message": "Add getter and setter for id."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc11b3e890c61df0439935a2421454ca5be5e24b", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/fc11b3e890c61df0439935a2421454ca5be5e24b", "committedDate": "2020-08-29T09:40:18Z", "message": "Remove unneeded view."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0785311dc2d1759ec5fda37abc34e9b5dcf2fee6", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/0785311dc2d1759ec5fda37abc34e9b5dcf2fee6", "committedDate": "2020-08-29T09:45:25Z", "message": "Store logs into database."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd0282c455135fa306b55236d9579f8b966557d0", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/fd0282c455135fa306b55236d9579f8b966557d0", "committedDate": "2020-08-31T15:47:28Z", "message": "Rework saving."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4ODUzOTUx", "url": "https://github.com/ls1intum/Artemis/pull/2068#pullrequestreview-478853951", "createdAt": "2020-08-31T18:43:08Z", "commit": {"oid": "fd0282c455135fa306b55236d9579f8b966557d0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxODo0MzowOFrOHKER-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxODo0MzowOFrOHKER-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMxNzk0NA==", "bodyText": "I am not sure if this is a good approach. In the future, we will have only one programming submission per commit (that was pushed to the remote). Then it could happen that multiple builds add multiple build logs.\nUsers might see the same build errors multiple times then.\nI would suggest that we simply replace all build logs here. In case they are identical, this makes more sense.\nIn case they have changed, the old ones might not be valid any more.", "url": "https://github.com/ls1intum/Artemis/pull/2068#discussion_r480317944", "createdAt": "2020-08-31T18:43:08Z", "author": {"login": "krusche"}, "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/BambooService.java", "diffHunk": "@@ -452,7 +452,20 @@ public Result onBuildCompletedNew(ProgrammingExerciseParticipation participation\n             final var hasArtifact = buildResult.getBuild().isArtifact();\n             programmingSubmission.setBuildArtifact(hasArtifact);\n             programmingSubmission.setBuildFailed(result.getResultString().equals(\"No tests found\"));\n-            programmingSubmissionRepository.save(programmingSubmission);\n+\n+            programmingSubmission = programmingSubmissionRepository.save(programmingSubmission);\n+\n+            Optional<ProgrammingSubmission> optionalProgrammingSubmission = programmingSubmissionRepository.findWithEagerBuildLogEntries(programmingSubmission.getId());\n+            if (optionalProgrammingSubmission.isPresent()) {\n+                programmingSubmission = optionalProgrammingSubmission.get();\n+                // Store logs into database. Append logs of multiple jobs.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd0282c455135fa306b55236d9579f8b966557d0"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53330f12afa5a43a7be570ebcc50b8b52aa302ea", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/53330f12afa5a43a7be570ebcc50b8b52aa302ea", "committedDate": "2020-08-31T18:50:19Z", "message": "Move to changesets into one changeset."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a38b4dcc27c6d8c6390e8141617ca6e8c6d7c91", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/5a38b4dcc27c6d8c6390e8141617ca6e8c6d7c91", "committedDate": "2020-09-01T12:31:47Z", "message": "Merge branch 'develop' into feature/store-build-logs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66cd3fc388a947faf20235dd1ac7216b39b99d07", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/66cd3fc388a947faf20235dd1ac7216b39b99d07", "committedDate": "2020-09-01T12:32:28Z", "message": "Merge remote-tracking branch 'origin/feature/store-build-logs' into feature/store-build-logs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f73f3483cb8e8fe6007fe51dd424e7bdd5517fc1", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/f73f3483cb8e8fe6007fe51dd424e7bdd5517fc1", "committedDate": "2020-09-01T13:26:47Z", "message": "Store build logs correctly, fetch them if possible & filter them."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddaf8b3054419f046555064ae7279d7472ae5f52", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/ddaf8b3054419f046555064ae7279d7472ae5f52", "committedDate": "2020-09-01T13:45:15Z", "message": "Resolve codacy issues. Fix tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de5130d9c12effec1c1b7039283903f18a881d48", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/de5130d9c12effec1c1b7039283903f18a881d48", "committedDate": "2020-09-01T19:18:54Z", "message": "Add test case."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "985952713078d8a70f628ba6ba3bd41a302111cf", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/985952713078d8a70f628ba6ba3bd41a302111cf", "committedDate": "2020-09-01T19:46:53Z", "message": "Add logs to sample payload."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1921e7483da84afb0b5b85f77a42ef3d996b829d", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/1921e7483da84afb0b5b85f77a42ef3d996b829d", "committedDate": "2020-09-01T20:04:31Z", "message": "Add logs to ModelFactory."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a227a1fe8c32afdb69788ed20df561ea1d8c9d1", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/9a227a1fe8c32afdb69788ed20df561ea1d8c9d1", "committedDate": "2020-09-01T20:20:37Z", "message": "Filter logs on insert."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22f22a2e511fe7d32daacdc0d6f275219c0a665b", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/22f22a2e511fe7d32daacdc0d6f275219c0a665b", "committedDate": "2020-09-02T09:01:41Z", "message": "Merge branch 'develop' into feature/store-build-logs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6248b643bca168ec98f22b66f3e92a5d48c0f3a", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/c6248b643bca168ec98f22b66f3e92a5d48c0f3a", "committedDate": "2020-09-22T08:09:01Z", "message": "Merge branch 'develop' into feature/store-build-logs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2130153ca15389c2bc026c9d25dc8c781fe0fcfd", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/2130153ca15389c2bc026c9d25dc8c781fe0fcfd", "committedDate": "2020-09-23T15:57:05Z", "message": "Merge branch 'develop' into feature/store-build-logs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a2faa1a40298a8c6d0dc44be59a5d50f55987c2", "author": {"user": {"login": "krusche", "name": "Stephan Krusche"}}, "url": "https://github.com/ls1intum/Artemis/commit/5a2faa1a40298a8c6d0dc44be59a5d50f55987c2", "committedDate": "2020-09-24T09:11:37Z", "message": "Merge branch 'develop' into feature/store-build-logs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NDA3ODIw", "url": "https://github.com/ls1intum/Artemis/pull/2068#pullrequestreview-495407820", "createdAt": "2020-09-24T09:57:24Z", "commit": {"oid": "5a2faa1a40298a8c6d0dc44be59a5d50f55987c2"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwOTo1NzoyNFrOHXS5EA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxMDowMTozMFrOHXTC9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE4ODgxNg==", "bodyText": "Maybe it's me but this comment is hard to read", "url": "https://github.com/ls1intum/Artemis/pull/2068#discussion_r494188816", "createdAt": "2020-09-24T09:57:24Z", "author": {"login": "sascha11110"}, "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/BambooService.java", "diffHunk": "@@ -452,7 +463,30 @@ public Result onBuildCompletedNew(ProgrammingExerciseParticipation participation\n             final var hasArtifact = buildResult.getBuild().isArtifact();\n             programmingSubmission.setBuildArtifact(hasArtifact);\n             programmingSubmission.setBuildFailed(result.getResultString().equals(\"No tests found\"));\n-            programmingSubmissionRepository.save(programmingSubmission);\n+\n+            programmingSubmission = programmingSubmissionRepository.save(programmingSubmission);\n+\n+            Optional<ProgrammingSubmission> optionalProgrammingSubmission = programmingSubmissionRepository.findWithEagerBuildLogEntriesById(programmingSubmission.getId());\n+            if (optionalProgrammingSubmission.isPresent()) {\n+                programmingSubmission = optionalProgrammingSubmission.get();\n+\n+                List<BuildLogEntry> buildLogEntries = new ArrayList<>();\n+\n+                // Store logs into database. Append logs of multiple jobs.\n+                for (var job : buildResult.getBuild().getJobs()) {\n+                    for (var bambooLog : job.getLogs()) {\n+                        // We have to unescape the HTML as otherwise symbols like '<' are not displayed correctly\n+                        buildLogEntries.add(new BuildLogEntry(bambooLog.getDate(), StringEscapeUtils.unescapeHtml(bambooLog.getLog()), programmingSubmission));\n+                    }\n+                }\n+\n+                // Set logs that as we received new logs and don't want logs to be stored twice", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a2faa1a40298a8c6d0dc44be59a5d50f55987c2"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE5MDAxOQ==", "bodyText": "I'm not really into our Bamboo / Jenkins setup. But why is there a method retrieveLatestBuildLogsFromJenkins in BambooService.java?", "url": "https://github.com/ls1intum/Artemis/pull/2068#discussion_r494190019", "createdAt": "2020-09-24T09:59:32Z", "author": {"login": "sascha11110"}, "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/BambooService.java", "diffHunk": "@@ -831,14 +865,23 @@ private Long calculateScoreForResult(Result result, int skippedTests) {\n         return null;\n     }\n \n+    private List<BuildLogEntry> retrieveLatestBuildLogsFromDatabase(ProgrammingSubmission programmingSubmission) {\n+        Optional<ProgrammingSubmission> optionalProgrammingSubmission = programmingSubmissionRepository.findWithEagerBuildLogEntriesById(programmingSubmission.getId());\n+        if (optionalProgrammingSubmission.isPresent()) {\n+            return optionalProgrammingSubmission.get().getBuildLogEntries();\n+        }\n+\n+        return List.of();\n+    }\n+\n     /**\n-     * Performs a request to the Bamboo REST API to retrieve the build log of the latest build.\n+     * Load the build log from the database.\n+     * Performs a request to the Bamboo REST API to retrieve the build log of the latest build, if the log is not available in the database.\n      *\n      * @param planKey to identify the build logs with.\n      * @return the list of retrieved build logs.\n      */\n-    //TODO: save this on the Artemis server, e.g. in the result class so that Artemis does not need to retrieve it every time\n-    public List<BuildLogEntry> retrieveLatestBuildLogs(String planKey) {\n+    private List<BuildLogEntry> retrieveLatestBuildLogsFromJenkins(String planKey) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a2faa1a40298a8c6d0dc44be59a5d50f55987c2"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE5MTM1MQ==", "bodyText": "Normally we use the timestamp of the file (20200827182434) as \u00ecd` of the chageSet :-)", "url": "https://github.com/ls1intum/Artemis/pull/2068#discussion_r494191351", "createdAt": "2020-09-24T10:01:30Z", "author": {"login": "sascha11110"}, "path": "src/main/resources/config/liquibase/changelog/20200827182434_changelog.xml", "diffHunk": "@@ -0,0 +1,15 @@\n+<?xml version=\"1.1\" encoding=\"UTF-8\" standalone=\"no\"?>\n+<databaseChangeLog xmlns=\"http://www.liquibase.org/xml/ns/dbchangelog\" xmlns:ext=\"http://www.liquibase.org/xml/ns/dbchangelog-ext\" xmlns:pro=\"http://www.liquibase.org/xml/ns/pro\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-3.9.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.9.xsd\">\n+    <changeSet author=\"sleiss\" id=\"1598545508786-1\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a2faa1a40298a8c6d0dc44be59a5d50f55987c2"}, "originalPosition": 3}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6f0655baa4b84bfa26778152e2b67659d1aece0", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/d6f0655baa4b84bfa26778152e2b67659d1aece0", "committedDate": "2020-09-24T10:35:04Z", "message": "Apply feedback."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "950aadb7652c1a1ed8705f69d1bfec560841e2d4", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/950aadb7652c1a1ed8705f69d1bfec560841e2d4", "committedDate": "2020-09-24T10:36:26Z", "message": "Merge remote-tracking branch 'origin/feature/store-build-logs' into feature/store-build-logs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NDQ2MjMx", "url": "https://github.com/ls1intum/Artemis/pull/2068#pullrequestreview-495446231", "createdAt": "2020-09-24T10:51:30Z", "commit": {"oid": "950aadb7652c1a1ed8705f69d1bfec560841e2d4"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c00b18adf110e168b32b2c293e31461d8f15e6bf", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/c00b18adf110e168b32b2c293e31461d8f15e6bf", "committedDate": "2020-09-24T10:54:47Z", "message": "Save retrieved build logs."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e87338cc930a681007b34c6e392c7f4a19580ed9", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/e87338cc930a681007b34c6e392c7f4a19580ed9", "committedDate": "2020-09-24T10:57:52Z", "message": "Import Cache annotation."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NDU0Njg0", "url": "https://github.com/ls1intum/Artemis/pull/2068#pullrequestreview-495454684", "createdAt": "2020-09-24T11:04:07Z", "commit": {"oid": "e87338cc930a681007b34c6e392c7f4a19580ed9"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0ce5b9adc4d884e47321a0a5fba8fb866bbd14a", "author": {"user": {"login": "krusche", "name": "Stephan Krusche"}}, "url": "https://github.com/ls1intum/Artemis/commit/c0ce5b9adc4d884e47321a0a5fba8fb866bbd14a", "committedDate": "2020-09-24T11:12:02Z", "message": "Merge branch 'develop' into feature/store-build-logs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NDUxNjky", "url": "https://github.com/ls1intum/Artemis/pull/2068#pullrequestreview-495451692", "createdAt": "2020-09-24T10:59:34Z", "commit": {"oid": "e87338cc930a681007b34c6e392c7f4a19580ed9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxMDo1OTozNFrOHXU-5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxMTozODoxN1rOHXWOTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDIyMzA3OQ==", "bodyText": "Now that this class becomes an entity, you should also take the id into account for equals and for hashCode", "url": "https://github.com/ls1intum/Artemis/pull/2068#discussion_r494223079", "createdAt": "2020-09-24T10:59:34Z", "author": {"login": "kloessst"}, "path": "src/main/java/de/tum/in/www1/artemis/domain/BuildLogEntry.java", "diffHunk": "@@ -33,6 +74,14 @@ public void setLog(String log) {\n         this.log = log;\n     }\n \n+    public ProgrammingSubmission getProgrammingSubmission() {\n+        return programmingSubmission;\n+    }\n+\n+    public void setProgrammingSubmission(ProgrammingSubmission programmingSubmission) {\n+        this.programmingSubmission = programmingSubmission;\n+    }\n+\n     @Override\n     public boolean equals(Object object) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e87338cc930a681007b34c6e392c7f4a19580ed9"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI0MzQwNQ==", "bodyText": "Why do you fetch the programming submission with build logs here? Could you just use the programmingSubmission from a line above?", "url": "https://github.com/ls1intum/Artemis/pull/2068#discussion_r494243405", "createdAt": "2020-09-24T11:38:17Z", "author": {"login": "kloessst"}, "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/BambooService.java", "diffHunk": "@@ -452,7 +470,30 @@ public Result onBuildCompletedNew(ProgrammingExerciseParticipation participation\n             final var hasArtifact = buildResult.getBuild().isArtifact();\n             programmingSubmission.setBuildArtifact(hasArtifact);\n             programmingSubmission.setBuildFailed(result.getResultString().equals(\"No tests found\"));\n-            programmingSubmissionRepository.save(programmingSubmission);\n+\n+            programmingSubmission = programmingSubmissionRepository.save(programmingSubmission);\n+\n+            Optional<ProgrammingSubmission> optionalProgrammingSubmission = programmingSubmissionRepository.findWithEagerBuildLogEntriesById(programmingSubmission.getId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0ce5b9adc4d884e47321a0a5fba8fb866bbd14a"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d24743718d6018a342918b13cf04d2b23bae19c2", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/d24743718d6018a342918b13cf04d2b23bae19c2", "committedDate": "2020-09-24T12:16:22Z", "message": "Adjust equals & hashCode functions. Remove unnecessary fetch."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NjQyMjgx", "url": "https://github.com/ls1intum/Artemis/pull/2068#pullrequestreview-495642281", "createdAt": "2020-09-24T14:36:33Z", "commit": {"oid": "d24743718d6018a342918b13cf04d2b23bae19c2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NjQ0NTUx", "url": "https://github.com/ls1intum/Artemis/pull/2068#pullrequestreview-495644551", "createdAt": "2020-09-24T14:38:42Z", "commit": {"oid": "d24743718d6018a342918b13cf04d2b23bae19c2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4087, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}