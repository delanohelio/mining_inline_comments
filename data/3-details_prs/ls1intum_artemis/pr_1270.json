{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1Njk4MzQ0", "number": 1270, "title": "Chore/test coverage/student question", "bodyText": "Checklist\n\n Server: I added multiple integration tests (Spring) related to the features\n\nMotivation and Context\n\n\nThis PR is part of the initiative to increase the test coverage for the REST controllers.\nDescription\n\n\nadded several testcases for StudentQuestion- and StudentQuestionAnswerResource covering all REST calls and at least 80% of lines", "createdAt": "2020-03-09T16:47:24Z", "url": "https://github.com/ls1intum/Artemis/pull/1270", "merged": true, "mergeCommit": {"oid": "10095b5429070e12edca7fa8f55471ef47ea7ee7"}, "closed": true, "closedAt": "2020-03-13T12:03:53Z", "author": {"login": "clemenszuck"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcLE-ORAH2gAyMzg1Njk4MzQ0OmFjN2UzYjYzZGQ1ZmQxYmUwZTA0YWY2NmNjYmE2YzA1YWFmZTgxMTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcNO0NsAFqTM3NDIzNTU2Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ac7e3b63dd5fd1be0e04af66ccba6c05aafe8114", "author": {"user": {"login": "clemenszuck", "name": "Clemens Zuck"}}, "url": "https://github.com/ls1intum/Artemis/commit/ac7e3b63dd5fd1be0e04af66ccba6c05aafe8114", "committedDate": "2020-03-06T19:06:50Z", "message": "Added StudentQuestionIntegrationTest.java with several testcases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f62abfadd4077d3e6bf4729cd842c5e553629375", "author": {"user": {"login": "clemenszuck", "name": "Clemens Zuck"}}, "url": "https://github.com/ls1intum/Artemis/commit/f62abfadd4077d3e6bf4729cd842c5e553629375", "committedDate": "2020-03-06T20:12:04Z", "message": "Added StudentQuestionAnswerIntegrationTest.java and several testcases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8b1fabe24cb1313014cc7a0740b0d7dba3bcb08", "author": {"user": {"login": "clemenszuck", "name": "Clemens Zuck"}}, "url": "https://github.com/ls1intum/Artemis/commit/b8b1fabe24cb1313014cc7a0740b0d7dba3bcb08", "committedDate": "2020-03-07T11:05:16Z", "message": "Added deletion of StudentQuestions at tear down"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6fe01c14849d1ba27a0a951f05c3db6c885848f", "author": {"user": {"login": "clemenszuck", "name": "Clemens Zuck"}}, "url": "https://github.com/ls1intum/Artemis/commit/e6fe01c14849d1ba27a0a951f05c3db6c885848f", "committedDate": "2020-03-09T12:35:32Z", "message": "remove unnecessary rest calls in tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef74566a28d892f47e0873473089b7bdd760906e", "author": {"user": {"login": "clemenszuck", "name": "Clemens Zuck"}}, "url": "https://github.com/ls1intum/Artemis/commit/ef74566a28d892f47e0873473089b7bdd760906e", "committedDate": "2020-03-09T12:49:51Z", "message": "fix java code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "465370663aeaf1e5c4ee03e5afbe873234d83290", "author": {"user": {"login": "clemenszuck", "name": "Clemens Zuck"}}, "url": "https://github.com/ls1intum/Artemis/commit/465370663aeaf1e5c4ee03e5afbe873234d83290", "committedDate": "2020-03-09T15:34:46Z", "message": "rework initalization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a9f81404bd6d08cd5bbf2d99bbc5c055e90d595", "author": {"user": {"login": "clemenszuck", "name": "Clemens Zuck"}}, "url": "https://github.com/ls1intum/Artemis/commit/9a9f81404bd6d08cd5bbf2d99bbc5c055e90d595", "committedDate": "2020-03-09T16:30:10Z", "message": "fixed tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMzYyOTgz", "url": "https://github.com/ls1intum/Artemis/pull/1270#pullrequestreview-371362983", "createdAt": "2020-03-09T17:02:07Z", "commit": {"oid": "9a9f81404bd6d08cd5bbf2d99bbc5c055e90d595"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNzowMjowN1rOFzxQEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNzowOTowN1rOFzxg3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTgyODYyNA==", "bodyText": "Can a student edit the answer to a question? If not could you please cover this case.", "url": "https://github.com/ls1intum/Artemis/pull/1270#discussion_r389828624", "createdAt": "2020-03-09T17:02:07Z", "author": {"login": "HanyaElhashemy"}, "path": "src/test/java/de/tum/in/www1/artemis/StudentQuestionAnswerIntegrationTest.java", "diffHunk": "@@ -0,0 +1,140 @@\n+package de.tum.in.www1.artemis;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import java.time.ZonedDateTime;\n+\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import de.tum.in.www1.artemis.domain.*;\n+import de.tum.in.www1.artemis.repository.CourseRepository;\n+import de.tum.in.www1.artemis.repository.ExerciseRepository;\n+import de.tum.in.www1.artemis.repository.StudentQuestionAnswerRepository;\n+import de.tum.in.www1.artemis.repository.StudentQuestionRepository;\n+import de.tum.in.www1.artemis.service.StudentQuestionService;\n+import de.tum.in.www1.artemis.util.DatabaseUtilService;\n+import de.tum.in.www1.artemis.util.RequestUtilService;\n+\n+public class StudentQuestionAnswerIntegrationTest extends AbstractSpringIntegrationTest {\n+\n+    @Autowired\n+    DatabaseUtilService database;\n+\n+    @Autowired\n+    RequestUtilService request;\n+\n+    @Autowired\n+    CourseRepository courseRepo;\n+\n+    @Autowired\n+    ExerciseRepository exerciseRepo;\n+\n+    @Autowired\n+    StudentQuestionRepository studentQuestionRepository;\n+\n+    @Autowired\n+    StudentQuestionAnswerRepository studentQuestionAnswerRepository;\n+\n+    @Autowired\n+    StudentQuestionService studentQuestionService;\n+\n+    @BeforeEach\n+    public void initTestCase() {\n+        database.addUsers(5, 5, 1);\n+    }\n+\n+    @AfterEach\n+    public void tearDown() {\n+        database.resetDatabase();\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void createStudentQuestionAnswer() throws Exception {\n+        StudentQuestion studentQuestion = database.createCourseWithExerciseAndStudentQuestions().get(0);\n+\n+        StudentQuestionAnswer studentQuestionAnswer = new StudentQuestionAnswer();\n+        studentQuestionAnswer.setAuthor(database.getUserByLogin(\"tutor1\"));\n+        studentQuestionAnswer.setAnswerText(\"Test Answer\");\n+        studentQuestionAnswer.setAnswerDate(ZonedDateTime.now());\n+        studentQuestionAnswer.setQuestion(studentQuestion);\n+        StudentQuestionAnswer response = request.postWithResponseBody(\"/api/student-question-answers\", studentQuestionAnswer, StudentQuestionAnswer.class, HttpStatus.CREATED);\n+\n+        // trying to create same studentQuestionAnswer again --> bad request\n+        request.postWithResponseBody(\"/api/student-question-answers\", response, StudentQuestionAnswer.class, HttpStatus.BAD_REQUEST);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void editStudentQuestionAnswer() throws Exception {\n+        StudentQuestionAnswer studentQuestionAnswer = createStudentQuestionAnswerOnServer();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a9f81404bd6d08cd5bbf2d99bbc5c055e90d595"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTgzMjkyNQ==", "bodyText": "Can another student edit this student's question?", "url": "https://github.com/ls1intum/Artemis/pull/1270#discussion_r389832925", "createdAt": "2020-03-09T17:09:07Z", "author": {"login": "HanyaElhashemy"}, "path": "src/test/java/de/tum/in/www1/artemis/StudentQuestionIntegrationTest.java", "diffHunk": "@@ -0,0 +1,160 @@\n+package de.tum.in.www1.artemis;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import java.time.ZonedDateTime;\n+import java.util.HashSet;\n+import java.util.List;\n+\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import de.tum.in.www1.artemis.domain.Attachment;\n+import de.tum.in.www1.artemis.domain.Course;\n+import de.tum.in.www1.artemis.domain.Lecture;\n+import de.tum.in.www1.artemis.domain.StudentQuestion;\n+import de.tum.in.www1.artemis.repository.*;\n+import de.tum.in.www1.artemis.service.StudentQuestionService;\n+import de.tum.in.www1.artemis.util.DatabaseUtilService;\n+import de.tum.in.www1.artemis.util.ModelFactory;\n+import de.tum.in.www1.artemis.util.RequestUtilService;\n+\n+public class StudentQuestionIntegrationTest extends AbstractSpringIntegrationTest {\n+\n+    @Autowired\n+    DatabaseUtilService database;\n+\n+    @Autowired\n+    RequestUtilService request;\n+\n+    @Autowired\n+    CourseRepository courseRepo;\n+\n+    @Autowired\n+    ExerciseRepository exerciseRepo;\n+\n+    @Autowired\n+    LectureRepository lectureRepo;\n+\n+    @Autowired\n+    AttachmentRepository attachmentRepo;\n+\n+    @Autowired\n+    StudentQuestionRepository studentQuestionRepository;\n+\n+    @Autowired\n+    StudentQuestionService studentQuestionService;\n+\n+    @BeforeEach\n+    public void initTestCase() {\n+        database.addUsers(5, 5, 1);\n+    }\n+\n+    @AfterEach\n+    public void tearDown() {\n+        database.resetDatabase();\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void createStudentQuestion() throws Exception {\n+        StudentQuestion studentQuestion = new StudentQuestion();\n+        studentQuestion.setQuestionText(\"Test Student Question 1\");\n+        studentQuestion.setVisibleForStudents(true);\n+\n+        StudentQuestion createdStudentQuestion = request.postWithResponseBody(\"/api/student-questions\", studentQuestion, StudentQuestion.class, HttpStatus.CREATED);\n+\n+        assertThat(createdStudentQuestion).isNotNull();\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void createExistingStudentQuestion() throws Exception {\n+        StudentQuestion studentQuestion = database.createCourseWithExerciseAndStudentQuestions().get(0);\n+\n+        request.postWithResponseBody(\"/api/student-questions\", studentQuestion, StudentQuestion.class, HttpStatus.BAD_REQUEST);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void editStudentQuestion() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a9f81404bd6d08cd5bbf2d99bbc5c055e90d595"}, "originalPosition": 84}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de58f2d7e8fe8e4d246321d52ea7bc0f5574967d", "author": {"user": {"login": "clemenszuck", "name": "Clemens Zuck"}}, "url": "https://github.com/ls1intum/Artemis/commit/de58f2d7e8fe8e4d246321d52ea7bc0f5574967d", "committedDate": "2020-03-09T18:25:35Z", "message": "Added additional testcases as student"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxNDM0Mjcz", "url": "https://github.com/ls1intum/Artemis/pull/1270#pullrequestreview-371434273", "createdAt": "2020-03-09T18:38:42Z", "commit": {"oid": "de58f2d7e8fe8e4d246321d52ea7bc0f5574967d"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxNDM4Nzkw", "url": "https://github.com/ls1intum/Artemis/pull/1270#pullrequestreview-371438790", "createdAt": "2020-03-09T18:45:25Z", "commit": {"oid": "de58f2d7e8fe8e4d246321d52ea7bc0f5574967d"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee06776bd633fa81004e7a86169bf5d96cb057ce", "author": {"user": {"login": "clemenszuck", "name": "Clemens Zuck"}}, "url": "https://github.com/ls1intum/Artemis/commit/ee06776bd633fa81004e7a86169bf5d96cb057ce", "committedDate": "2020-03-12T09:45:37Z", "message": "Adjusted tests to test for desired logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33151e43bc47bdc42b6ffa1a55d9a2deae395345", "author": {"user": {"login": "clemenszuck", "name": "Clemens Zuck"}}, "url": "https://github.com/ls1intum/Artemis/commit/33151e43bc47bdc42b6ffa1a55d9a2deae395345", "committedDate": "2020-03-12T09:49:24Z", "message": "fix java code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6235923e0c8e0b2ca1499634e65c33e2a2644576", "author": {"user": {"login": "clemenszuck", "name": "Clemens Zuck"}}, "url": "https://github.com/ls1intum/Artemis/commit/6235923e0c8e0b2ca1499634e65c33e2a2644576", "committedDate": "2020-03-12T09:51:31Z", "message": "Merge remote-tracking branch 'origin/develop' into chore/test-coverage/student-question"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b2620a347aa9d02f8b8c2c06ee378a10de508f0", "author": {"user": {"login": "jpbernius", "name": "Jan Philip Bernius"}}, "url": "https://github.com/ls1intum/Artemis/commit/5b2620a347aa9d02f8b8c2c06ee378a10de508f0", "committedDate": "2020-03-13T11:08:34Z", "message": "Fix Permission check in StudentQuestionResource:updateStudentQuestion\n\nSigned-off-by: Jan Philip Bernius <janphilip.bernius@tum.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d080fef1b782092ec960209d887ca4e25e1ae894", "author": {"user": {"login": "jpbernius", "name": "Jan Philip Bernius"}}, "url": "https://github.com/ls1intum/Artemis/commit/d080fef1b782092ec960209d887ca4e25e1ae894", "committedDate": "2020-03-13T11:15:15Z", "message": "Fix Permission check in StudentQuestionAnswerResource:updateStudentQuestionAnswer\n\nSigned-off-by: Jan Philip Bernius <janphilip.bernius@tum.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78a38b55d5c57bd8bbc9f46b1338c7eae72a325f", "author": {"user": {"login": "jpbernius", "name": "Jan Philip Bernius"}}, "url": "https://github.com/ls1intum/Artemis/commit/78a38b55d5c57bd8bbc9f46b1338c7eae72a325f", "committedDate": "2020-03-13T11:21:27Z", "message": "Add missing JavaDoc\n\nSigned-off-by: Jan Philip Bernius <janphilip.bernius@tum.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0MjI2MjUw", "url": "https://github.com/ls1intum/Artemis/pull/1270#pullrequestreview-374226250", "createdAt": "2020-03-13T11:25:33Z", "commit": {"oid": "78a38b55d5c57bd8bbc9f46b1338c7eae72a325f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0MjM1NTYy", "url": "https://github.com/ls1intum/Artemis/pull/1270#pullrequestreview-374235562", "createdAt": "2020-03-13T11:42:48Z", "commit": {"oid": "78a38b55d5c57bd8bbc9f46b1338c7eae72a325f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3232, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}