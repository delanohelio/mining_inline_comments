{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ3ODgyNTcw", "number": 1867, "title": "Submit StudentExam after Exam ended", "bodyText": "Checklist\n\n I tested all changes and all related features with different users (student, tutor, instructor, admin) on the test server https://vmbruegge60.in.tum.de/\n Server: I added @PreAuthorize and check the course groups for all new REST Calls (security)\n Server: I implemented the changes with a good performance and prevented too many database calls\n Server: I documented the Java code using JavaDoc style.\n Client: I documented the TypeScript code using JSDoc style.\n Client: I added multiple screenshots/screencasts of my UI changes\n\nMotivation and Context\n\n\nWhen the working time is over, the latest student exam state should be transferred to the server. To distribute the amount of requests, the request is made once the student accepts the end terms of the exam\nDescription\n\nAdded fields to entities:\n\nStudent Exam - boolean submitted (marks whether an exam is submitted or not)\nExam - gracePeriod integer (time for accepting the terms)\n\nServer:\n\nadd endpoint to submit student exam\nadd service method to submit student exam\ngenerating student exam: set submitted to false for new student exams\n\nClient:\n\nput timer into own component\ndisplay timer also on exam-participation-cover with grace period\nadd call to server once\nshow exam title on end exam-participation-cover\n\nSteps for Testing\n\n\nCreate an exam and participate (working for modeling, text and quiz exercises)\nMake last minute changes to an exercise (should not be synchronized with the server via the regular synchronization mechanisms (manual save, 30s timer or exercise change)).\nWhen the exam finishes, the user sees the end page where he/she has to accept the end terms. The student gets a grace period of 3minutes in which he/she can accept the end terms of the exam\nWhen the terms are accepted, the last version of the student exam is sent to the server and the student exam is marked as submitted. This includes the last minute changes from the previous step (working for modeling, text and quiz exercises)\nthe student can then see the summary\nrefresh the summary page to see if your submissions are correctly synchronized (the aforementioned last minute changes - working for modeling, text and quiz exercises)\nonce accepted, the end terms should not be displayed again (e.g. after page reload)\n\nStudent does not accept terms\n\nif the student did not accept the terms, the summary is not displayed\nif the end terms are not accepted until the exam is over (after grace period is 0 - timer in the end page, see screenshot), the summary cannot be displayed and the end terms can no longer be accepted\n\nScreenshots\n\n\nstudent does not accept terms", "createdAt": "2020-07-12T10:45:46Z", "url": "https://github.com/ls1intum/Artemis/pull/1867", "merged": true, "mergeCommit": {"oid": "123fabb9944593913d04d302106f30bdfcdfa45e"}, "closed": true, "closedAt": "2020-07-13T22:24:45Z", "author": {"login": "TobiasPr"}, "timelineItems": {"totalCount": 46, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc0I3OHAH2gAyNDQ3ODgyNTcwOmE1MWY0Zjc0ZmY4ODljODFmMTE1NDA2OWRjZGFhNzZmNWZhYTM0Y2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc0pHI7gFqTQ0NzY1MjA0OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a51f4f74ff889c81f1154069dcdaa76f5faa34cb", "author": {"user": {"login": "TobiasPr", "name": "Tobias Priesching"}}, "url": "https://github.com/ls1intum/Artemis/commit/a51f4f74ff889c81f1154069dcdaa76f5faa34cb", "committedDate": "2020-07-12T08:49:42Z", "message": "add grace period to student exams -> time in which the students can submit their exam, even after official working time - this is to distribute the final submissions of exams over a period of time"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b1f1efd5907aedd41bb9dc6ded6927fe399cfb5", "author": {"user": {"login": "TobiasPr", "name": "Tobias Priesching"}}, "url": "https://github.com/ls1intum/Artemis/commit/7b1f1efd5907aedd41bb9dc6ded6927fe399cfb5", "committedDate": "2020-07-12T09:26:24Z", "message": "include migration\nmove grace_period from StudentExam to Exam"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b8003a196869eb91942c4e17c55bc0037d870d2", "author": {"user": {"login": "TobiasPr", "name": "Tobias Priesching"}}, "url": "https://github.com/ls1intum/Artemis/commit/5b8003a196869eb91942c4e17c55bc0037d870d2", "committedDate": "2020-07-12T10:35:21Z", "message": "add client logic to submit StudentExam\nshow summary only if studentExam is submitted"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "333f2718dc79ea89f3278fe125806e990677496f", "author": {"user": {"login": "TobiasPr", "name": "Tobias Priesching"}}, "url": "https://github.com/ls1intum/Artemis/commit/333f2718dc79ea89f3278fe125806e990677496f", "committedDate": "2020-07-12T12:58:45Z", "message": "extract timer component"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d676170f6557d1fa8526cc666fd81cb3f3b9da3d", "author": {"user": {"login": "TobiasPr", "name": "Tobias Priesching"}}, "url": "https://github.com/ls1intum/Artemis/commit/d676170f6557d1fa8526cc666fd81cb3f3b9da3d", "committedDate": "2020-07-12T13:30:39Z", "message": "show timer for grace period on end page"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "afeb167924e2422bf649a16d014cc1ef9f2a5b1b", "author": {"user": {"login": "TobiasPr", "name": "Tobias Priesching"}}, "url": "https://github.com/ls1intum/Artemis/commit/afeb167924e2422bf649a16d014cc1ef9f2a5b1b", "committedDate": "2020-07-12T13:58:16Z", "message": "correct display of timer in exam-participation-cover.component.html"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc59c65134a95cd7673495beb33b34ee8012d638", "author": {"user": {"login": "TobiasPr", "name": "Tobias Priesching"}}, "url": "https://github.com/ls1intum/Artemis/commit/bc59c65134a95cd7673495beb33b34ee8012d638", "committedDate": "2020-07-12T14:18:31Z", "message": "remove studentExamId from URL -> no longer needed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb76467242cee2c16e3cd903f8adada36b37c28d", "author": {"user": {"login": "TobiasPr", "name": "Tobias Priesching"}}, "url": "https://github.com/ls1intum/Artemis/commit/eb76467242cee2c16e3cd903f8adada36b37c28d", "committedDate": "2020-07-12T18:22:10Z", "message": "submit quiz, text and modeling exercises on exam end"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba6cc0bfad17e50310ccce03ba5175387097e52d", "author": {"user": {"login": "TobiasPr", "name": "Tobias Priesching"}}, "url": "https://github.com/ls1intum/Artemis/commit/ba6cc0bfad17e50310ccce03ba5175387097e52d", "committedDate": "2020-07-12T18:47:38Z", "message": "use individual submission date if set, otherwise use exam endDate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7b220d8ece85b1f207aef6b7361dcb7f7a9effa", "author": {"user": {"login": "TobiasPr", "name": "Tobias Priesching"}}, "url": "https://github.com/ls1intum/Artemis/commit/b7b220d8ece85b1f207aef6b7361dcb7f7a9effa", "committedDate": "2020-07-12T18:54:37Z", "message": "remove TODO -> @PreAuthorize should be correct"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9d4c6214b760345c624c7353b87085c572d5c54", "author": {"user": {"login": "TobiasPr", "name": "Tobias Priesching"}}, "url": "https://github.com/ls1intum/Artemis/commit/a9d4c6214b760345c624c7353b87085c572d5c54", "committedDate": "2020-07-12T19:01:22Z", "message": "timer stops at 0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7fc6f8e8b520b0aa43014bdb92d024ace4ed3c94", "author": {"user": {"login": "TobiasPr", "name": "Tobias Priesching"}}, "url": "https://github.com/ls1intum/Artemis/commit/7fc6f8e8b520b0aa43014bdb92d024ace4ed3c94", "committedDate": "2020-07-12T19:07:52Z", "message": "remove unnecessary param, add java doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cdc4d0feb74734173848556e9b5b6980f436177", "author": {"user": {"login": "TobiasPr", "name": "Tobias Priesching"}}, "url": "https://github.com/ls1intum/Artemis/commit/8cdc4d0feb74734173848556e9b5b6980f436177", "committedDate": "2020-07-12T19:11:28Z", "message": "add js doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f3acd7e7af15daf1b2e917c538daa4eec85380e", "author": {"user": {"login": "TobiasPr", "name": "Tobias Priesching"}}, "url": "https://github.com/ls1intum/Artemis/commit/8f3acd7e7af15daf1b2e917c538daa4eec85380e", "committedDate": "2020-07-12T19:14:56Z", "message": "reformat html and disable start button while waiting for exam start"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a59e95e87f95c9ed4436fe26576138ca3870e617", "author": {"user": {"login": "TobiasPr", "name": "Tobias Priesching"}}, "url": "https://github.com/ls1intum/Artemis/commit/a59e95e87f95c9ed4436fe26576138ca3870e617", "committedDate": "2020-07-12T19:57:19Z", "message": "Merge branch 'develop' into feature/exam/track-submission-status"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c63ba84fcd0cd1389a888ee8e8a1f248c0d90d7", "author": {"user": {"login": "TobiasPr", "name": "Tobias Priesching"}}, "url": "https://github.com/ls1intum/Artemis/commit/0c63ba84fcd0cd1389a888ee8e8a1f248c0d90d7", "committedDate": "2020-07-12T21:09:40Z", "message": "add exam title on end view\nfix quiz submissions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4278319e3293814c2ce9afcf326eb11a8f15122", "author": {"user": {"login": "TobiasPr", "name": "Tobias Priesching"}}, "url": "https://github.com/ls1intum/Artemis/commit/f4278319e3293814c2ce9afcf326eb11a8f15122", "committedDate": "2020-07-12T21:09:59Z", "message": "Merge remote-tracking branch 'origin/feature/exam/track-submission-status' into feature/exam/track-submission-status"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "753b73d96417674c0e11f452b4cb1b67366f0596", "author": {"user": {"login": "TobiasPr", "name": "Tobias Priesching"}}, "url": "https://github.com/ls1intum/Artemis/commit/753b73d96417674c0e11f452b4cb1b67366f0596", "committedDate": "2020-07-12T21:16:47Z", "message": "missed import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d8cc72a587df92941ecdd24a30891c4acf45c2b", "author": {"user": {"login": "TobiasPr", "name": "Tobias Priesching"}}, "url": "https://github.com/ls1intum/Artemis/commit/3d8cc72a587df92941ecdd24a30891c4acf45c2b", "committedDate": "2020-07-12T21:47:28Z", "message": "fix layouting on end page"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3MDY0MDU5", "url": "https://github.com/ls1intum/Artemis/pull/1867#pullrequestreview-447064059", "createdAt": "2020-07-13T09:04:16Z", "commit": {"oid": "3d8cc72a587df92941ecdd24a30891c4acf45c2b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QwOTowNDoxNlrOGwfmdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QwOTowNDoxNlrOGwfmdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzUwMjU4MA==", "bodyText": "we should use forbidden(...) here", "url": "https://github.com/ls1intum/Artemis/pull/1867#discussion_r453502580", "createdAt": "2020-07-13T09:04:16Z", "author": {"login": "krusche"}, "path": "src/main/java/de/tum/in/www1/artemis/service/StudentExamService.java", "diffHunk": "@@ -67,6 +88,65 @@ public StudentExam findOneWithExercisesByUserIdAndExamId(Long userId, Long examI\n         return studentExamRepository.findWithExercisesByUserIdAndExamId(userId, examId);\n     }\n \n+    /**\n+     * submit StudentExam and uses submissions as final submissions if studentExam is not yet submitted\n+     * and if it was submitted after exam startDate and before individual endDate + gracePeriod\n+     *\n+     * @param studentExam latest studentExam object which will be submitted (final submission)\n+     */\n+    public void submitStudentExam(StudentExam studentExam) {\n+        log.debug(\"Submit student exam with id {}\", studentExam.getId());\n+        // checks if student exam is already marked as submitted\n+        if (studentExam.isSubmitted()) {\n+            throw new IllegalStateException(\"StudentExam is already marked as submitted\");\n+        }\n+\n+        // gets individual exam end or exam.endDate if individual cannot be calculated\n+        ZonedDateTime examEndDate = studentExam.getExam().getStartDate() != null && studentExam.getWorkingTime() != null\n+                ? studentExam.getExam().getStartDate().plusSeconds(studentExam.getWorkingTime())\n+                : studentExam.getExam().getEndDate();\n+\n+        // checks if student exam is live (after start date, before end date + grace period)\n+        if ((studentExam.getExam().getStartDate() != null && !ZonedDateTime.now().isAfter(studentExam.getExam().getStartDate()))\n+                || (examEndDate != null && !(ZonedDateTime.now().isBefore(examEndDate.plusSeconds(studentExam.getExam().getGracePeriod()))))) {\n+            throw new IllegalStateException(\"StudentExam cannot be marked as submitted, because it is not invoked between start and end of exam\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d8cc72a587df92941ecdd24a30891c4acf45c2b"}, "originalPosition": 71}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3MDY1MDIx", "url": "https://github.com/ls1intum/Artemis/pull/1867#pullrequestreview-447065021", "createdAt": "2020-07-13T09:05:28Z", "commit": {"oid": "3d8cc72a587df92941ecdd24a30891c4acf45c2b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QwOTowNToyOFrOGwfpYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QwOTowNToyOFrOGwfpYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzUwMzMzMA==", "bodyText": "Security: we should double check that the user is owner of the participation so that no wrong data can be injected over REST here", "url": "https://github.com/ls1intum/Artemis/pull/1867#discussion_r453503330", "createdAt": "2020-07-13T09:05:28Z", "author": {"login": "krusche"}, "path": "src/main/java/de/tum/in/www1/artemis/service/StudentExamService.java", "diffHunk": "@@ -67,6 +88,65 @@ public StudentExam findOneWithExercisesByUserIdAndExamId(Long userId, Long examI\n         return studentExamRepository.findWithExercisesByUserIdAndExamId(userId, examId);\n     }\n \n+    /**\n+     * submit StudentExam and uses submissions as final submissions if studentExam is not yet submitted\n+     * and if it was submitted after exam startDate and before individual endDate + gracePeriod\n+     *\n+     * @param studentExam latest studentExam object which will be submitted (final submission)\n+     */\n+    public void submitStudentExam(StudentExam studentExam) {\n+        log.debug(\"Submit student exam with id {}\", studentExam.getId());\n+        // checks if student exam is already marked as submitted\n+        if (studentExam.isSubmitted()) {\n+            throw new IllegalStateException(\"StudentExam is already marked as submitted\");\n+        }\n+\n+        // gets individual exam end or exam.endDate if individual cannot be calculated\n+        ZonedDateTime examEndDate = studentExam.getExam().getStartDate() != null && studentExam.getWorkingTime() != null\n+                ? studentExam.getExam().getStartDate().plusSeconds(studentExam.getWorkingTime())\n+                : studentExam.getExam().getEndDate();\n+\n+        // checks if student exam is live (after start date, before end date + grace period)\n+        if ((studentExam.getExam().getStartDate() != null && !ZonedDateTime.now().isAfter(studentExam.getExam().getStartDate()))\n+                || (examEndDate != null && !(ZonedDateTime.now().isBefore(examEndDate.plusSeconds(studentExam.getExam().getGracePeriod()))))) {\n+            throw new IllegalStateException(\"StudentExam cannot be marked as submitted, because it is not invoked between start and end of exam\");\n+        }\n+\n+        studentExam.getExercises().forEach(exercise -> {\n+            // if exercise is either QuizExercise, TextExercise or ModelingExercise and exactly one participation exists\n+            if (exercise.getStudentParticipations() != null && exercise.getStudentParticipations().size() == 1) {\n+                exercise.getStudentParticipations().forEach(studentParticipation -> {\n+                    // if exactly one submission exists we save the submission\n+                    if (studentParticipation.getSubmissions() != null && studentParticipation.getSubmissions().size() == 1) {\n+                        studentParticipation.setExercise(exercise);\n+                        studentParticipation.getSubmissions().forEach(submission -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d8cc72a587df92941ecdd24a30891c4acf45c2b"}, "originalPosition": 81}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3MDY1OTE4", "url": "https://github.com/ls1intum/Artemis/pull/1867#pullrequestreview-447065918", "createdAt": "2020-07-13T09:06:36Z", "commit": {"oid": "3d8cc72a587df92941ecdd24a30891c4acf45c2b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QwOTowNjozNlrOGwfsAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QwOTowNjozNlrOGwfsAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzUwNDAwMg==", "bodyText": "Security: we should compare the submission with the existing one, so that no wrong data can be injected here (e.g. a submission with a different ID that overrides another submission of another user)", "url": "https://github.com/ls1intum/Artemis/pull/1867#discussion_r453504002", "createdAt": "2020-07-13T09:06:36Z", "author": {"login": "krusche"}, "path": "src/main/java/de/tum/in/www1/artemis/service/StudentExamService.java", "diffHunk": "@@ -67,6 +88,65 @@ public StudentExam findOneWithExercisesByUserIdAndExamId(Long userId, Long examI\n         return studentExamRepository.findWithExercisesByUserIdAndExamId(userId, examId);\n     }\n \n+    /**\n+     * submit StudentExam and uses submissions as final submissions if studentExam is not yet submitted\n+     * and if it was submitted after exam startDate and before individual endDate + gracePeriod\n+     *\n+     * @param studentExam latest studentExam object which will be submitted (final submission)\n+     */\n+    public void submitStudentExam(StudentExam studentExam) {\n+        log.debug(\"Submit student exam with id {}\", studentExam.getId());\n+        // checks if student exam is already marked as submitted\n+        if (studentExam.isSubmitted()) {\n+            throw new IllegalStateException(\"StudentExam is already marked as submitted\");\n+        }\n+\n+        // gets individual exam end or exam.endDate if individual cannot be calculated\n+        ZonedDateTime examEndDate = studentExam.getExam().getStartDate() != null && studentExam.getWorkingTime() != null\n+                ? studentExam.getExam().getStartDate().plusSeconds(studentExam.getWorkingTime())\n+                : studentExam.getExam().getEndDate();\n+\n+        // checks if student exam is live (after start date, before end date + grace period)\n+        if ((studentExam.getExam().getStartDate() != null && !ZonedDateTime.now().isAfter(studentExam.getExam().getStartDate()))\n+                || (examEndDate != null && !(ZonedDateTime.now().isBefore(examEndDate.plusSeconds(studentExam.getExam().getGracePeriod()))))) {\n+            throw new IllegalStateException(\"StudentExam cannot be marked as submitted, because it is not invoked between start and end of exam\");\n+        }\n+\n+        studentExam.getExercises().forEach(exercise -> {\n+            // if exercise is either QuizExercise, TextExercise or ModelingExercise and exactly one participation exists\n+            if (exercise.getStudentParticipations() != null && exercise.getStudentParticipations().size() == 1) {\n+                exercise.getStudentParticipations().forEach(studentParticipation -> {\n+                    // if exactly one submission exists we save the submission\n+                    if (studentParticipation.getSubmissions() != null && studentParticipation.getSubmissions().size() == 1) {\n+                        studentParticipation.setExercise(exercise);\n+                        studentParticipation.getSubmissions().forEach(submission -> {\n+                            submission.setParticipation(studentParticipation);\n+                            submission.submissionDate(ZonedDateTime.now());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d8cc72a587df92941ecdd24a30891c4acf45c2b"}, "originalPosition": 83}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3MDY2ODM3", "url": "https://github.com/ls1intum/Artemis/pull/1867#pullrequestreview-447066837", "createdAt": "2020-07-13T09:07:44Z", "commit": {"oid": "3d8cc72a587df92941ecdd24a30891c4acf45c2b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QwOTowNzo0NVrOGwfulw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QwOTowNzo0NVrOGwfulw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzUwNDY2Mw==", "bodyText": "Please be more specific. It is important to note that it includes exercises, participations and submissions, otherwise the call won't work", "url": "https://github.com/ls1intum/Artemis/pull/1867#discussion_r453504663", "createdAt": "2020-07-13T09:07:45Z", "author": {"login": "krusche"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/StudentExamResource.java", "diffHunk": "@@ -148,6 +148,34 @@ public StudentExamResource(ExamAccessService examAccessService, StudentExamServi\n         return ResponseEntity.ok(studentExamRepository.save(studentExam));\n     }\n \n+    /**\n+     * POST /courses/{courseId}/exams/{examId}/studentExams/submit : Submits the student exam\n+     * Updates all submissions and marks student exam as submitted according to given student exam\n+     * @param courseId      the course to which the student exams belong to\n+     * @param examId        the exam to which the student exams belong to\n+     * @param studentExam   the student exam parameter (request body)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d8cc72a587df92941ecdd24a30891c4acf45c2b"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3MDY3MTI1", "url": "https://github.com/ls1intum/Artemis/pull/1867#pullrequestreview-447067125", "createdAt": "2020-07-13T09:08:06Z", "commit": {"oid": "3d8cc72a587df92941ecdd24a30891c4acf45c2b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QwOTowODowN1rOGwfvaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QwOTowODowN1rOGwfvaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzUwNDg3Mw==", "bodyText": "Please add an error message into the bad request here", "url": "https://github.com/ls1intum/Artemis/pull/1867#discussion_r453504873", "createdAt": "2020-07-13T09:08:07Z", "author": {"login": "krusche"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/StudentExamResource.java", "diffHunk": "@@ -148,6 +148,34 @@ public StudentExamResource(ExamAccessService examAccessService, StudentExamServi\n         return ResponseEntity.ok(studentExamRepository.save(studentExam));\n     }\n \n+    /**\n+     * POST /courses/{courseId}/exams/{examId}/studentExams/submit : Submits the student exam\n+     * Updates all submissions and marks student exam as submitted according to given student exam\n+     * @param courseId      the course to which the student exams belong to\n+     * @param examId        the exam to which the student exams belong to\n+     * @param studentExam   the student exam parameter (request body)\n+     * @return              empty response with status code:\n+     *                          200 if successful\n+     *                          400 if student exam was in an illegal state\n+     */\n+    @PostMapping(\"/courses/{courseId}/exams/{examId}/studentExams/submit\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> submitStudentExam(@PathVariable Long courseId, @PathVariable Long examId, @RequestBody StudentExam studentExam) {\n+        log.debug(\"REST request to mark the studentExam as submitted : {}\", studentExam.getId());\n+        Optional<ResponseEntity<Void>> accessFailure = this.studentExamAccessService.checkStudentExamAccess(courseId, examId, studentExam.getId());\n+        if (accessFailure.isPresent()) {\n+            return accessFailure.get();\n+        }\n+        try {\n+            studentExamService.submitStudentExam(studentExam);\n+        }\n+        catch (IllegalStateException exception) {\n+            log.debug(\"REST request to mark the studentExam as failed, because of illegal state of StudentExam : {}\", studentExam.getId());\n+            return ResponseEntity.badRequest().build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d8cc72a587df92941ecdd24a30891c4acf45c2b"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9457aa938090f58da05fe2093ce2e72b865e9cc5", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/9457aa938090f58da05fe2093ce2e72b865e9cc5", "committedDate": "2020-07-13T13:29:02Z", "message": "Adjust comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3Mjc5MjM3", "url": "https://github.com/ls1intum/Artemis/pull/1867#pullrequestreview-447279237", "createdAt": "2020-07-13T14:00:59Z", "commit": {"oid": "3d8cc72a587df92941ecdd24a30891c4acf45c2b"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7076f2444e38f9c6f76b45eb4531d5be2372d820", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/7076f2444e38f9c6f76b45eb4531d5be2372d820", "committedDate": "2020-07-13T14:26:17Z", "message": "Improve error messages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47530a904fe7958deba8d773b4fbc905be42ebca", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/47530a904fe7958deba8d773b4fbc905be42ebca", "committedDate": "2020-07-13T14:39:29Z", "message": "Add error messages in client"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3455984840266353a5eff0ff0385c32b228bef02", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/3455984840266353a5eff0ff0385c32b228bef02", "committedDate": "2020-07-13T14:56:24Z", "message": "Refactor checkStudentExamAccess()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6cc959b3bab3d6e6ca01da8cc5ae41001b57e850", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/6cc959b3bab3d6e6ca01da8cc5ae41001b57e850", "committedDate": "2020-07-13T15:06:23Z", "message": "Security: double check that the user is owner of the participation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0601fb53c0d5f643e13e91437226bdd7a241eecc", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/0601fb53c0d5f643e13e91437226bdd7a241eecc", "committedDate": "2020-07-13T15:08:59Z", "message": "Merge branch 'develop' into feature/exam/track-submission-status"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3Mzc3NjA0", "url": "https://github.com/ls1intum/Artemis/pull/1867#pullrequestreview-447377604", "createdAt": "2020-07-13T15:48:49Z", "commit": {"oid": "3d8cc72a587df92941ecdd24a30891c4acf45c2b"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f73351dba1cdc0c02a9f7fe25a6bcebae281fff5", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/f73351dba1cdc0c02a9f7fe25a6bcebae281fff5", "committedDate": "2020-07-13T16:56:50Z", "message": "Security: submission checks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c31722aa205d9ace9f8c8ca21c1b46a6d9d21e0", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/2c31722aa205d9ace9f8c8ca21c1b46a6d9d21e0", "committedDate": "2020-07-13T17:19:11Z", "message": "Adjust StudentExamAccessServiceTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6f7ea12fcdff7d3772ef4399b3f4f30cf81b778", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/e6f7ea12fcdff7d3772ef4399b3f4f30cf81b778", "committedDate": "2020-07-13T19:41:48Z", "message": "Calculate individual end date via working time also on page reload"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0a467d652155947f499743fdb273040d62a4f2a", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/f0a467d652155947f499743fdb273040d62a4f2a", "committedDate": "2020-07-13T20:25:07Z", "message": "Check that existing student exam has not already been submitted"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd4fd6a59f944871abe34cdc272c0db0d7d7389f", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/cd4fd6a59f944871abe34cdc272c0db0d7d7389f", "committedDate": "2020-07-13T20:33:39Z", "message": "Prevent manipulation of studentExam.exam.startDate/endDate/workingTime"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "425697a847214929a9028bba30f5029f3057f48e", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/425697a847214929a9028bba30f5029f3057f48e", "committedDate": "2020-07-13T20:37:37Z", "message": "fix issues with date calculation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "721d9043591c3b65aa56adb3fc846465990942d1", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/721d9043591c3b65aa56adb3fc846465990942d1", "committedDate": "2020-07-13T20:48:34Z", "message": "fix test compile errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "560816c6f86609be436351577dfee9fa0eef1a84", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/560816c6f86609be436351577dfee9fa0eef1a84", "committedDate": "2020-07-13T20:53:24Z", "message": "Basic integration test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f002d0f13f4f1ba0ffc8b0de87ba3da81be9a007", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/f002d0f13f4f1ba0ffc8b0de87ba3da81be9a007", "committedDate": "2020-07-13T20:55:50Z", "message": "fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5818d9cdd8e93dd3f317886fee333017a9913be7", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/5818d9cdd8e93dd3f317886fee333017a9913be7", "committedDate": "2020-07-13T20:56:41Z", "message": "Merge remote-tracking branch 'origin/feature/exam/track-submission-status' into feature/exam/track-submission-status"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df01d9317b57e0aa9bd5131bcf06aed748af8f46", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/df01d9317b57e0aa9bd5131bcf06aed748af8f46", "committedDate": "2020-07-13T20:59:51Z", "message": "Merge branch 'feature/exam/track-submission-status' of https://github.com/ls1intum/Artemis into feature/exam/track-submission-status"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2bc7c4eb52535d24b233b52758d80f40c14fb6c7", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/2bc7c4eb52535d24b233b52758d80f40c14fb6c7", "committedDate": "2020-07-13T21:01:46Z", "message": "fix tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3NjUxODIw", "url": "https://github.com/ls1intum/Artemis/pull/1867#pullrequestreview-447651820", "createdAt": "2020-07-13T22:23:37Z", "commit": {"oid": "2bc7c4eb52535d24b233b52758d80f40c14fb6c7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3NjUyMDQ5", "url": "https://github.com/ls1intum/Artemis/pull/1867#pullrequestreview-447652049", "createdAt": "2020-07-13T22:24:03Z", "commit": {"oid": "2bc7c4eb52535d24b233b52758d80f40c14fb6c7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4331, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}