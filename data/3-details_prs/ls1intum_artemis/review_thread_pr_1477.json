{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4NzgwMjkx", "number": 1477, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQwODoyMjo0NVrOD_LkBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxMDoxNToyNFrOD_nFZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NTc2MzI1OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/QuizExerciseService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQwODoyMjo0NVrOGZtbVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQwODoyMjo0NVrOGZtbVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTYxMTg2Mw==", "bodyText": "This is not a good change. It will lead to the case, that quizzes won't start automatically when students have opened them before. I think we should unify the web socket channels here", "url": "https://github.com/ls1intum/Artemis/pull/1477#discussion_r429611863", "createdAt": "2020-05-24T08:22:45Z", "author": {"login": "krusche"}, "path": "src/main/java/de/tum/in/www1/artemis/service/QuizExerciseService.java", "diffHunk": "@@ -335,12 +346,14 @@ public void sendQuizExerciseToSubscribedClients(QuizExercise quizExercise, Strin\n             if (quizChange.equals(\"set-visible\")) {\n                 // the quiz id is not yet known to the client, we need to use a more generic topic\n                 messagingTemplate.send(\"/topic/\" + quizExercise.getCourse().getId() + \"/quizExercises\", MessageBuilder.withPayload(payload).build());\n-                // TODO: start-now would also be interesting to be supported in the client, but needs to be handled differently in the client\n+            } else if(quizChange.equals(\"start-now\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28dc4dd015621921f4eeb05d3b767dad8ed6f44a"}, "originalPosition": 164}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NzM0MTQ0OnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/exercises/quiz/participate/quiz-participation.component.ts", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwOTo1NjoxMFrOGZ7yLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMzo1OToxM1rOGaCDNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg0NzA4Ng==", "bodyText": "That's quite a lot of code commented out. Can it be deleted or is left there on purpose?", "url": "https://github.com/ls1intum/Artemis/pull/1477#discussion_r429847086", "createdAt": "2020-05-25T09:56:10Z", "author": {"login": "filip-gregurevic"}, "path": "src/main/webapp/app/exercises/quiz/participate/quiz-participation.component.ts", "diffHunk": "@@ -815,47 +820,48 @@ export class QuizParticipationComponent implements OnInit, OnDestroy {\n \n     /**\n      * Callback function for handling quiz submission after saving submission to server\n-     * @param quizSubmission The quiz submission data from the server\n      * @param error a potential error during save\n      */\n-    onSaveSuccess(quizSubmission: QuizSubmission | null, error: string | null) {\n-        if (!quizSubmission || error) {\n-            alert('Saving Answers failed: ' + error);\n+    onSaveError(error: string) {\n+        if (error) {\n+            const errorMessage = 'Saving answers failed: ' + error;\n+            // TODO: this is a workaround to avoid translation not found issues. Provide proper translations\n+            const jhiAlert = this.jhiAlertService.error(errorMessage);\n+            jhiAlert.msg = errorMessage;\n             this.unsavedChanges = true;\n             this.isSubmitting = false;\n-            if (this.outstandingWebsocketResponses > 0) {\n-                this.outstandingWebsocketResponses--;\n-            }\n-            if (this.outstandingWebsocketResponses === 0) {\n-                this.isSaving = false;\n-            }\n-            return;\n-        }\n-        if (quizSubmission.submitted) {\n-            this.outstandingWebsocketResponses = 0;\n-            this.isSaving = false;\n-            this.unsavedChanges = false;\n-            this.isSubmitting = false;\n-            this.submission = quizSubmission;\n-            this.updateSubmissionTime();\n-            this.applySubmission();\n-        } else if (this.outstandingWebsocketResponses === 0) {\n-            this.isSaving = false;\n-            this.unsavedChanges = false;\n-            this.submission = quizSubmission;\n-            this.updateSubmissionTime();\n-            this.applySubmission();\n-        } else {\n-            this.outstandingWebsocketResponses--;\n-            if (this.outstandingWebsocketResponses === 0) {\n-                this.isSaving = false;\n-                this.unsavedChanges = false;\n-                if (quizSubmission) {\n-                    this.submission.submissionDate = quizSubmission.submissionDate;\n-                    this.updateSubmissionTime();\n-                }\n-            }\n+            // if (this.outstandingWebsocketResponses > 0) {\n+            //     this.outstandingWebsocketResponses--;\n+            // }\n+            // if (this.outstandingWebsocketResponses === 0) {\n+            //     this.isSaving = false;\n+            // }\n         }\n+        // if (quizSubmission.submitted) {\n+        //     // this.outstandingWebsocketResponses = 0;\n+        //     this.isSaving = false;\n+        //     this.unsavedChanges = false;\n+        //     this.isSubmitting = false;\n+        //     this.submission = quizSubmission;\n+        //     this.updateSubmissionTime();\n+        //     this.applySubmission();\n+        // } else if (this.outstandingWebsocketResponses === 0) {\n+        //     this.isSaving = false;\n+        //     this.unsavedChanges = false;\n+        //     this.submission = quizSubmission;\n+        //     this.updateSubmissionTime();\n+        //     this.applySubmission();\n+        // } else {\n+        //     this.outstandingWebsocketResponses--;\n+        //     if (this.outstandingWebsocketResponses === 0) {\n+        //         this.isSaving = false;\n+        //         this.unsavedChanges = false;\n+        //         if (quizSubmission) {\n+        //             this.submission.submissionDate = quizSubmission.submissionDate;\n+        //             this.updateSubmissionTime();\n+        //         }\n+        //     }\n+        // }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "698593bf2bf3cab26c0d1aa572f3410d69ee8425"}, "originalPosition": 220}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk0OTc1MQ==", "bodyText": "I wanted to keep it in case we have to revert some of the changes. We will clean it up after all quiz problems are resolved", "url": "https://github.com/ls1intum/Artemis/pull/1477#discussion_r429949751", "createdAt": "2020-05-25T13:59:13Z", "author": {"login": "krusche"}, "path": "src/main/webapp/app/exercises/quiz/participate/quiz-participation.component.ts", "diffHunk": "@@ -815,47 +820,48 @@ export class QuizParticipationComponent implements OnInit, OnDestroy {\n \n     /**\n      * Callback function for handling quiz submission after saving submission to server\n-     * @param quizSubmission The quiz submission data from the server\n      * @param error a potential error during save\n      */\n-    onSaveSuccess(quizSubmission: QuizSubmission | null, error: string | null) {\n-        if (!quizSubmission || error) {\n-            alert('Saving Answers failed: ' + error);\n+    onSaveError(error: string) {\n+        if (error) {\n+            const errorMessage = 'Saving answers failed: ' + error;\n+            // TODO: this is a workaround to avoid translation not found issues. Provide proper translations\n+            const jhiAlert = this.jhiAlertService.error(errorMessage);\n+            jhiAlert.msg = errorMessage;\n             this.unsavedChanges = true;\n             this.isSubmitting = false;\n-            if (this.outstandingWebsocketResponses > 0) {\n-                this.outstandingWebsocketResponses--;\n-            }\n-            if (this.outstandingWebsocketResponses === 0) {\n-                this.isSaving = false;\n-            }\n-            return;\n-        }\n-        if (quizSubmission.submitted) {\n-            this.outstandingWebsocketResponses = 0;\n-            this.isSaving = false;\n-            this.unsavedChanges = false;\n-            this.isSubmitting = false;\n-            this.submission = quizSubmission;\n-            this.updateSubmissionTime();\n-            this.applySubmission();\n-        } else if (this.outstandingWebsocketResponses === 0) {\n-            this.isSaving = false;\n-            this.unsavedChanges = false;\n-            this.submission = quizSubmission;\n-            this.updateSubmissionTime();\n-            this.applySubmission();\n-        } else {\n-            this.outstandingWebsocketResponses--;\n-            if (this.outstandingWebsocketResponses === 0) {\n-                this.isSaving = false;\n-                this.unsavedChanges = false;\n-                if (quizSubmission) {\n-                    this.submission.submissionDate = quizSubmission.submissionDate;\n-                    this.updateSubmissionTime();\n-                }\n-            }\n+            // if (this.outstandingWebsocketResponses > 0) {\n+            //     this.outstandingWebsocketResponses--;\n+            // }\n+            // if (this.outstandingWebsocketResponses === 0) {\n+            //     this.isSaving = false;\n+            // }\n         }\n+        // if (quizSubmission.submitted) {\n+        //     // this.outstandingWebsocketResponses = 0;\n+        //     this.isSaving = false;\n+        //     this.unsavedChanges = false;\n+        //     this.isSubmitting = false;\n+        //     this.submission = quizSubmission;\n+        //     this.updateSubmissionTime();\n+        //     this.applySubmission();\n+        // } else if (this.outstandingWebsocketResponses === 0) {\n+        //     this.isSaving = false;\n+        //     this.unsavedChanges = false;\n+        //     this.submission = quizSubmission;\n+        //     this.updateSubmissionTime();\n+        //     this.applySubmission();\n+        // } else {\n+        //     this.outstandingWebsocketResponses--;\n+        //     if (this.outstandingWebsocketResponses === 0) {\n+        //         this.isSaving = false;\n+        //         this.unsavedChanges = false;\n+        //         if (quizSubmission) {\n+        //             this.submission.submissionDate = quizSubmission.submissionDate;\n+        //             this.updateSubmissionTime();\n+        //         }\n+        //     }\n+        // }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg0NzA4Ng=="}, "originalCommit": {"oid": "698593bf2bf3cab26c0d1aa572f3410d69ee8425"}, "originalPosition": 220}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MDI2MDEyOnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/exercises/quiz/participate/quiz-participation.component.html", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxMDoxMTozNlrOGaXpVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxMDoxMTozNlrOGaXpVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDMwMzU3Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            <jhi-connection-status *ngIf=\"mode === 'live'\" class=\"conxnection-status-quiz\">\n          \n          \n            \n                            <jhi-connection-status *ngIf=\"mode === 'live'\" class=\"connection-status-quiz\">\n          \n      \n    \n    \n  \n\nsmall typo here", "url": "https://github.com/ls1intum/Artemis/pull/1477#discussion_r430303572", "createdAt": "2020-05-26T10:11:36Z", "author": {"login": "filip-gregurevic"}, "path": "src/main/webapp/app/exercises/quiz/participate/quiz-participation.component.html", "diffHunk": "@@ -119,21 +120,20 @@ <h2 [ngSwitch]=\"mode\">\n                     <span jhiTranslate=\"artemisApp.quizExercise.waitingForStart\"></span>\n                 </div>\n                 <div *ngIf=\"mode === 'live' && !waitingForQuizStart\">\n-                    <span *ngIf=\"isSaving\" jhiTranslate=\"artemisApp.quizExercise.isSaving\">Saving answers...</span>\n-                    <span *ngIf=\"!isSaving && !isMobile()\" ngbTooltip=\"{{ submission.adjustedSubmissionDate | artemisDate: 'long':true }}\" placement=\"right\">\n+                    <span *ngIf=\"!isMobile()\" ngbTooltip=\"{{ submission.adjustedSubmissionDate | artemisDate: 'long':true }}\" placement=\"right\">\n                         <span *ngIf=\"!submission.submitted\" jhiTranslate=\"artemisApp.quizExercise.lastSaved\" class=\"colon-suffix\"></span>\n                         <span *ngIf=\"submission.submitted\" jhiTranslate=\"artemisApp.quizExercise.submitted\" class=\"colon-suffix\"></span>\n                         <span *ngIf=\"justSaved\" jhiTranslate=\"justNow\"></span>\n                         <span *ngIf=\"!justSaved && lastSavedTimeText !== ''\">{{ lastSavedTimeText }}</span>\n                         <span *ngIf=\"!justSaved && lastSavedTimeText === ''\" jhiTranslate=\"artemisApp.quizExercise.lastSavedTimeNever\"></span>\n                     </span>\n                     <!-- Only display save and submission hint without time stamps for mobile -->\n-                    <span *ngIf=\"!isSaving && isMobile()\" ngbTooltip=\"{{ submission.adjustedSubmissionDate | artemisDate: 'long':true }}\" placement=\"right\">\n+                    <span *ngIf=\"isMobile()\" ngbTooltip=\"{{ submission.adjustedSubmissionDate | artemisDate: 'long':true }}\" placement=\"right\">\n                         <span *ngIf=\"!submission.submitted\" jhiTranslate=\"artemisApp.quizExercise.lastSaved\"></span>\n                         <span *ngIf=\"submission.submitted\" jhiTranslate=\"artemisApp.quizExercise.submitted\"></span>\n                     </span>\n                 </div>\n-                <jhi-connection-status *ngIf=\"mode === 'live'\" class=\"connection-status-quiz\">\n+                <jhi-connection-status *ngIf=\"mode === 'live'\" class=\"conxnection-status-quiz\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3a9154972f1a393767c87a4aff757617f62c5ffc"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MDI3MjM2OnYy", "diffSide": "RIGHT", "path": "src/main/webapp/i18n/en/quizExercise.json", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxMDoxNToyNFrOGaXxEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxMDoxNToyNFrOGaXxEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDMwNTU1Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"quizIsOverText\": \"The quiz has ended. Please wait. If the results so not load automatically within 60s, please refresh the page.\",\n          \n          \n            \n                        \"quizIsOverText\": \"The quiz has ended. Please wait. If the results do not load automatically within 60s, please refresh the page.\",\n          \n      \n    \n    \n  \n\nsmall typo", "url": "https://github.com/ls1intum/Artemis/pull/1477#discussion_r430305552", "createdAt": "2020-05-26T10:15:24Z", "author": {"login": "filip-gregurevic"}, "path": "src/main/webapp/i18n/en/quizExercise.json", "diffHunk": "@@ -106,10 +106,10 @@\n             \"previewMode\": \"Preview\",\n             \"preview\": \"Preview Quiz\",\n             \"solution\": \"Sample Solution\",\n-            \"quizIsOverText\": \"The quiz has ended. Please wait. The results will load automatically.\",\n+            \"quizIsOverText\": \"The quiz has ended. Please wait. If the results so not load automatically within 60s, please refresh the page.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3a9154972f1a393767c87a4aff757617f62c5ffc"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4978, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}