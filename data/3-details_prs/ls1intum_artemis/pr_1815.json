{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0MjgzNzI0", "number": 1815, "title": "Prevent changing the working time of student exams after the exam is visible", "bodyText": "Checklist\n\n I tested all changes and all related features with different users (student, tutor, instructor, admin) on the test server https://artemistest.ase.in.tum.de.\n\nMotivation and Context\nChanging the working time after the exam is visible, leads to issues with lock and unlock programming exercise operations. This can also be confusing during testing\nDescription\nInstructors can now only change the working time of an individual student before the exam is visible\nSteps for Testing\n\nGenerate student exams\nChange the working time of one student before the exam is visible --> should work\nTry to change the working time of one student after the exam is visible --> should not work", "createdAt": "2020-07-04T13:16:55Z", "url": "https://github.com/ls1intum/Artemis/pull/1815", "merged": true, "mergeCommit": {"oid": "aed00b301eb9bd2e8c6d43b0c8250adbcdeaf52f"}, "closed": true, "closedAt": "2020-07-05T18:42:10Z", "author": {"login": "krusche"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcxjc_jgH2gAyNDQ0MjgzNzI0OjI5Y2EzNDE2ODE3OTU5OGY3NTNmNTY3OGJhNWRlMzNmZGZlZWFmNWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcyBMAhgFqTQ0MjY5ODM1Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "29ca34168179598f753f5678ba5de33fdfeeaf5b", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/29ca34168179598f753f5678ba5de33fdfeeaf5b", "committedDate": "2020-07-04T08:06:43Z", "message": "prevent changing the working time after the exam is visible"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b70b0743f0da085ae4bc545ca0d0b79819dd627", "author": {"user": {"login": "krusche", "name": "Stephan Krusche"}}, "url": "https://github.com/ls1intum/Artemis/commit/6b70b0743f0da085ae4bc545ca0d0b79819dd627", "committedDate": "2020-07-04T20:22:26Z", "message": "Merge branch 'develop' into bugfix/no-change-in-student-working-time-after-exam-visible"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNjMzMTM5", "url": "https://github.com/ls1intum/Artemis/pull/1815#pullrequestreview-442633139", "createdAt": "2020-07-04T21:51:07Z", "commit": {"oid": "6b70b0743f0da085ae4bc545ca0d0b79819dd627"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQyMTo1MTowOFrOGs-HLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQyMTo1MTowOFrOGs-HLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgwODE3NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // if the exam is not visible, we rather disable the form\n          \n          \n            \n                    // if the exam is not visible to students yet, we disable the form to edit the working time", "url": "https://github.com/ls1intum/Artemis/pull/1815#discussion_r449808174", "createdAt": "2020-07-04T21:51:08Z", "author": {"login": "sleiss"}, "path": "src/main/webapp/app/exam/manage/student-exams/student-exam-detail.component.ts", "diffHunk": "@@ -107,8 +108,29 @@ export class StudentExamDetailComponent implements OnInit {\n         const workingTime = this.artemisDurationFromSecondsPipe.transform(this.studentExam.workingTime);\n         const workingTimeParts = workingTime.split(':');\n         this.workingTimeForm = new FormGroup({\n-            minutes: new FormControl(parseInt(workingTimeParts[0] ? workingTimeParts[0] : '0', 10), [Validators.min(0), Validators.required]),\n-            seconds: new FormControl(parseInt(workingTimeParts[1] ? workingTimeParts[1] : '0', 10), [Validators.min(0), Validators.max(59), Validators.required]),\n+            minutes: new FormControl({ value: parseInt(workingTimeParts[0] ? workingTimeParts[0] : '0', 10), disabled: this.examIsVisible() }, [\n+                Validators.min(0),\n+                Validators.required,\n+            ]),\n+            seconds: new FormControl({ value: parseInt(workingTimeParts[1] ? workingTimeParts[1] : '0', 10), disabled: this.examIsVisible() }, [\n+                Validators.min(0),\n+                Validators.max(59),\n+                Validators.required,\n+            ]),\n         });\n     }\n+\n+    examIsVisible(): boolean {\n+        if (this.studentExam.exam) {\n+            return moment(this.studentExam.exam.visibleDate).isBefore(moment());\n+        }\n+        // if the exam is not visible, we rather disable the form", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b70b0743f0da085ae4bc545ca0d0b79819dd627"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "402c6f26ec18e099b76169eb45412bf8f0cab129", "author": {"user": {"login": "krusche", "name": "Stephan Krusche"}}, "url": "https://github.com/ls1intum/Artemis/commit/402c6f26ec18e099b76169eb45412bf8f0cab129", "committedDate": "2020-07-04T22:52:39Z", "message": "Update src/main/webapp/app/exam/manage/student-exams/student-exam-detail.component.ts\n\nCo-authored-by: Simon Lei\u00df <5084100+sleiss@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNjk2ODMy", "url": "https://github.com/ls1intum/Artemis/pull/1815#pullrequestreview-442696832", "createdAt": "2020-07-05T18:17:07Z", "commit": {"oid": "402c6f26ec18e099b76169eb45412bf8f0cab129"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxODoxNzowN1rOGtD_zA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxODoyMTozN1rOGtEBCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwNDU4OA==", "bodyText": "You may want to add a comment here to make this more clear:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        return moment(this.studentExam.exam.visibleDate).isBefore(moment());\n          \n          \n            \n                        // Disable the form to edit the working time if the exam is already visible\n          \n          \n            \n                        return moment(this.studentExam.exam.visibleDate).isBefore(moment());", "url": "https://github.com/ls1intum/Artemis/pull/1815#discussion_r449904588", "createdAt": "2020-07-05T18:17:07Z", "author": {"login": "sascha11110"}, "path": "src/main/webapp/app/exam/manage/student-exams/student-exam-detail.component.ts", "diffHunk": "@@ -107,8 +108,29 @@ export class StudentExamDetailComponent implements OnInit {\n         const workingTime = this.artemisDurationFromSecondsPipe.transform(this.studentExam.workingTime);\n         const workingTimeParts = workingTime.split(':');\n         this.workingTimeForm = new FormGroup({\n-            minutes: new FormControl(parseInt(workingTimeParts[0] ? workingTimeParts[0] : '0', 10), [Validators.min(0), Validators.required]),\n-            seconds: new FormControl(parseInt(workingTimeParts[1] ? workingTimeParts[1] : '0', 10), [Validators.min(0), Validators.max(59), Validators.required]),\n+            minutes: new FormControl({ value: parseInt(workingTimeParts[0] ? workingTimeParts[0] : '0', 10), disabled: this.examIsVisible() }, [\n+                Validators.min(0),\n+                Validators.required,\n+            ]),\n+            seconds: new FormControl({ value: parseInt(workingTimeParts[1] ? workingTimeParts[1] : '0', 10), disabled: this.examIsVisible() }, [\n+                Validators.min(0),\n+                Validators.max(59),\n+                Validators.required,\n+            ]),\n         });\n     }\n+\n+    examIsVisible(): boolean {\n+        if (this.studentExam.exam) {\n+            return moment(this.studentExam.exam.visibleDate).isBefore(moment());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "402c6f26ec18e099b76169eb45412bf8f0cab129"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwNDgxMg==", "bodyText": "I don't get this comment. For two reasons:\n\nThe purpose of the PR is to ensure that the working time cannot be changed after the exam is visible to the students. If there is no visibleDate the working time can be changed --> so the method should return false (--> form is editable)\nThe first part (if the exam is not visible to students yet) is a little confusing. If the visibleDate is not set would make more sense here", "url": "https://github.com/ls1intum/Artemis/pull/1815#discussion_r449904812", "createdAt": "2020-07-05T18:20:22Z", "author": {"login": "sascha11110"}, "path": "src/main/webapp/app/exam/manage/student-exams/student-exam-detail.component.ts", "diffHunk": "@@ -107,8 +108,29 @@ export class StudentExamDetailComponent implements OnInit {\n         const workingTime = this.artemisDurationFromSecondsPipe.transform(this.studentExam.workingTime);\n         const workingTimeParts = workingTime.split(':');\n         this.workingTimeForm = new FormGroup({\n-            minutes: new FormControl(parseInt(workingTimeParts[0] ? workingTimeParts[0] : '0', 10), [Validators.min(0), Validators.required]),\n-            seconds: new FormControl(parseInt(workingTimeParts[1] ? workingTimeParts[1] : '0', 10), [Validators.min(0), Validators.max(59), Validators.required]),\n+            minutes: new FormControl({ value: parseInt(workingTimeParts[0] ? workingTimeParts[0] : '0', 10), disabled: this.examIsVisible() }, [\n+                Validators.min(0),\n+                Validators.required,\n+            ]),\n+            seconds: new FormControl({ value: parseInt(workingTimeParts[1] ? workingTimeParts[1] : '0', 10), disabled: this.examIsVisible() }, [\n+                Validators.min(0),\n+                Validators.max(59),\n+                Validators.required,\n+            ]),\n         });\n     }\n+\n+    examIsVisible(): boolean {\n+        if (this.studentExam.exam) {\n+            return moment(this.studentExam.exam.visibleDate).isBefore(moment());\n+        }\n+        // if the exam is not visible to students yet, we disable the form to edit the working time", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "402c6f26ec18e099b76169eb45412bf8f0cab129"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwNDkwNQ==", "bodyText": "We should find a better solution for this soon :-D", "url": "https://github.com/ls1intum/Artemis/pull/1815#discussion_r449904905", "createdAt": "2020-07-05T18:21:37Z", "author": {"login": "sascha11110"}, "path": "src/test/java/de/tum/in/www1/artemis/StudentExamIntegrationTest.java", "diffHunk": "@@ -70,7 +70,13 @@ public void initTestCase() {\n     }\n \n     @AfterEach\n-    public void resetDatabase() {\n+    public void resetDatabase() throws Exception {\n+\n+        // change back to instructor user\n+        database.changeUser(\"instructor1\");\n+        // Clean up to prevent exceptions during reset database\n+        request.delete(\"/api/courses/\" + course1.getId() + \"/exams/\" + exam1.getId(), HttpStatus.OK);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "402c6f26ec18e099b76169eb45412bf8f0cab129"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNjk3NDY2", "url": "https://github.com/ls1intum/Artemis/pull/1815#pullrequestreview-442697466", "createdAt": "2020-07-05T18:29:02Z", "commit": {"oid": "402c6f26ec18e099b76169eb45412bf8f0cab129"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNjk3OTkz", "url": "https://github.com/ls1intum/Artemis/pull/1815#pullrequestreview-442697993", "createdAt": "2020-07-05T18:38:29Z", "commit": {"oid": "402c6f26ec18e099b76169eb45412bf8f0cab129"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNjk4MTMx", "url": "https://github.com/ls1intum/Artemis/pull/1815#pullrequestreview-442698131", "createdAt": "2020-07-05T18:41:11Z", "commit": {"oid": "402c6f26ec18e099b76169eb45412bf8f0cab129"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxODo0MToxMVrOGtEHUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxODo0MToxMVrOGtEHUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwNjUxNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // if the exam is not visible to students yet, we disable the form to edit the working time\n          \n          \n            \n                    // if exam is undefined, the form to edit the working time is disabled", "url": "https://github.com/ls1intum/Artemis/pull/1815#discussion_r449906514", "createdAt": "2020-07-05T18:41:11Z", "author": {"login": "krusche"}, "path": "src/main/webapp/app/exam/manage/student-exams/student-exam-detail.component.ts", "diffHunk": "@@ -107,8 +108,29 @@ export class StudentExamDetailComponent implements OnInit {\n         const workingTime = this.artemisDurationFromSecondsPipe.transform(this.studentExam.workingTime);\n         const workingTimeParts = workingTime.split(':');\n         this.workingTimeForm = new FormGroup({\n-            minutes: new FormControl(parseInt(workingTimeParts[0] ? workingTimeParts[0] : '0', 10), [Validators.min(0), Validators.required]),\n-            seconds: new FormControl(parseInt(workingTimeParts[1] ? workingTimeParts[1] : '0', 10), [Validators.min(0), Validators.max(59), Validators.required]),\n+            minutes: new FormControl({ value: parseInt(workingTimeParts[0] ? workingTimeParts[0] : '0', 10), disabled: this.examIsVisible() }, [\n+                Validators.min(0),\n+                Validators.required,\n+            ]),\n+            seconds: new FormControl({ value: parseInt(workingTimeParts[1] ? workingTimeParts[1] : '0', 10), disabled: this.examIsVisible() }, [\n+                Validators.min(0),\n+                Validators.max(59),\n+                Validators.required,\n+            ]),\n         });\n     }\n+\n+    examIsVisible(): boolean {\n+        if (this.studentExam.exam) {\n+            return moment(this.studentExam.exam.visibleDate).isBefore(moment());\n+        }\n+        // if the exam is not visible to students yet, we disable the form to edit the working time", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "402c6f26ec18e099b76169eb45412bf8f0cab129"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ada80d6ce14369b55c997686acad5fb2939e4c4", "author": {"user": {"login": "krusche", "name": "Stephan Krusche"}}, "url": "https://github.com/ls1intum/Artemis/commit/5ada80d6ce14369b55c997686acad5fb2939e4c4", "committedDate": "2020-07-05T18:41:31Z", "message": "Apply suggestions from code review\n\nCo-authored-by: Sascha Beele <sascha@beele.io>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNjk4MzUy", "url": "https://github.com/ls1intum/Artemis/pull/1815#pullrequestreview-442698352", "createdAt": "2020-07-05T18:45:19Z", "commit": {"oid": "5ada80d6ce14369b55c997686acad5fb2939e4c4"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4487, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}