{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUzMTE5ODUx", "number": 1938, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxODowNDoyOVrOERKN5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxODo0OTo0OVrOERLOFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2NDI4NjQ2OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/TextSubmissionService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxODowNDoyOVrOG1uIvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxODowNDoyOVrOG1uIvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODk4MzYxMg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // Retrieve all submissions assessed by the tutor and filter out ones which contain complaints", "url": "https://github.com/ls1intum/Artemis/pull/1938#discussion_r458983612", "createdAt": "2020-07-22T18:04:29Z", "author": {"login": "kloessst"}, "path": "src/main/java/de/tum/in/www1/artemis/service/TextSubmissionService.java", "diffHunk": "@@ -238,28 +234,16 @@ public TextSubmission save(TextSubmission textSubmission) {\n      * Given an exercise id and a tutor id, it returns all the text submissions where the tutor has a result associated\n      *\n      * @param exerciseId - the id of the exercise we are looking for\n-     * @param tutorId    - the id of the tutor we are interested in\n+     * @param tutor - the tutor we are interested in\n      * @return a list of text Submissions\n      */\n-    @Transactional(readOnly = true)\n-    public List<TextSubmission> getAllTextSubmissionsByTutorForExercise(Long exerciseId, Long tutorId) {\n-        // We take all the results in this exercise associated to the tutor, and from there we retrieve the submissions\n-        List<Result> results = this.resultRepository.findAllByParticipationExerciseIdAndAssessorId(exerciseId, tutorId);\n-\n-        // TODO: properly load the submissions with all required data from the database without using @Transactional\n-        return results.stream().map(result -> {\n-            Submission submission = result.getSubmission();\n-            TextSubmission textSubmission = new TextSubmission();\n-\n-            result.setSubmission(null);\n-            textSubmission.setLanguage(submission.getLanguage());\n-            textSubmission.setResult(result);\n-            textSubmission.setParticipation(submission.getParticipation());\n-            textSubmission.setId(submission.getId());\n-            textSubmission.setSubmissionDate(submission.getSubmissionDate());\n-\n-            return textSubmission;\n-        }).collect(toList());\n+    public List<TextSubmission> getAllTextSubmissionsAssessedByTutorWithForExercise(Long exerciseId, User tutor) {\n+        // Retrieve all submissions assessed by the tutor and filter out ones which contain complaints", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d27751318746750e4523d63b7eb8849e8d5faa6b"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2NDM2NjM4OnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/assessment/assessment-header/assessment-header.component.html", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxODoyNjo1MFrOG1u6ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxODoyNjo1MFrOG1u6ew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODk5NjM0Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        *ngIf=\"(isAssessor && !hasComplaint) || (isAssessor && isAtLeastInstructor)\"\n          \n          \n            \n                        *ngIf=\"isAssessor && (!hasComplaint || isAtLeastInstructor)\"", "url": "https://github.com/ls1intum/Artemis/pull/1938#discussion_r458996347", "createdAt": "2020-07-22T18:26:50Z", "author": {"login": "kloessst"}, "path": "src/main/webapp/app/assessment/assessment-header/assessment-header.component.html", "diffHunk": "@@ -17,15 +17,39 @@ <h3 class=\"top-container\">\n             Assessment locked by: otherUser\n         </span>\n         <span\n-            *ngIf=\"!isAssessor && isComplaint\"\n+            id=\"assessmentReadOnlyUnhandledComplaint\"\n+            *ngIf=\"isAssessor && !isAtLeastInstructor && hasComplaint && !complaintHandled\"\n+            class=\"ml-3\"\n+            style=\"font-size: 65%;\"\n+            jhiTranslate=\"artemisApp.assessment.assessmentReadOnlyUnhandledComplaint\"\n+        >\n+            There is a complaint for this assessment. Another tutor must respond.\n+        </span>\n+        <span\n+            id=\"assessmentReadOnlyhandled\"\n+            *ngIf=\"isAssessor && !isAtLeastInstructor && hasComplaint && complaintHandled\"\n+            class=\"ml-3\"\n+            style=\"font-size: 65%;\"\n+            jhiTranslate=\"artemisApp.assessment.assessmentReadOnlyHandledComplaint\"\n+        >\n+            The complaint about your assessment has been resolved.\n+        </span>\n+        <span\n+            *ngIf=\"!isAssessor && hasComplaint\"\n             class=\"ml-3\"\n             style=\"font-size: 65%;\"\n             jhiTranslate=\"artemisApp.assessment.assessmentLockedComplaintView\"\n             [translateValues]=\"{ otherUser: result?.assessor?.name + ' (' + result?.assessor?.login + ')' }\"\n         >\n             Original Assessor: otherUser\n         </span>\n-        <span id=\"assessmentLockedCurrentUser\" *ngIf=\"isAssessor\" class=\"text-danger ml-3\" style=\"font-size: 65%;\" jhiTranslate=\"artemisApp.assessment.assessmentLockedCurrentUser\">\n+        <span\n+            id=\"assessmentLockedCurrentUser\"\n+            *ngIf=\"(isAssessor && !hasComplaint) || (isAssessor && isAtLeastInstructor)\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d27751318746750e4523d63b7eb8849e8d5faa6b"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2NDQzMTEwOnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/exercises/file-upload/assess/file-upload-assessment.component.ts", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxODo0NDozMVrOG1vjSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxODo0NDozMVrOG1vjSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAwNjc5Mg==", "bodyText": "Why do we need the else case here? I don't think we should award everyone with 'ROLE_INSTRUCTOR' these rights in this case.", "url": "https://github.com/ls1intum/Artemis/pull/1938#discussion_r459006792", "createdAt": "2020-07-22T18:44:31Z", "author": {"login": "kloessst"}, "path": "src/main/webapp/app/exercises/file-upload/assess/file-upload-assessment.component.ts", "diffHunk": "@@ -428,14 +427,39 @@ export class FileUploadAssessmentComponent implements OnInit, AfterViewInit, OnD\n \n     private checkPermissions() {\n         this.isAssessor = this.result && this.result.assessor && this.result.assessor.id === this.userId;\n+        if (this.exercise) {\n+            this.isAtLeastInstructor = this.accountService.isAtLeastInstructorInCourse(this.exercise.course || this.exercise.exerciseGroup!.exam!.course);\n+        } else {\n+            this.isAtLeastInstructor = this.accountService.hasAnyAuthorityDirect(['ROLE_INSTRUCTOR', 'ROLE_ADMIN']);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d27751318746750e4523d63b7eb8849e8d5faa6b"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2NDQ0Njg2OnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/exercises/file-upload/assess/file-upload-assessment.component.ts", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxODo0ODo0NFrOG1vtKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxODo0ODo0NFrOG1vtKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAwOTMyMQ==", "bodyText": "I also saw this code duplicated somewhere else. Maybe we could create a super class for all exercise type assessment components and define this in there.", "url": "https://github.com/ls1intum/Artemis/pull/1938#discussion_r459009321", "createdAt": "2020-07-22T18:48:44Z", "author": {"login": "kloessst"}, "path": "src/main/webapp/app/exercises/file-upload/assess/file-upload-assessment.component.ts", "diffHunk": "@@ -428,14 +427,39 @@ export class FileUploadAssessmentComponent implements OnInit, AfterViewInit, OnD\n \n     private checkPermissions() {\n         this.isAssessor = this.result && this.result.assessor && this.result.assessor.id === this.userId;\n+        if (this.exercise) {\n+            this.isAtLeastInstructor = this.accountService.isAtLeastInstructorInCourse(this.exercise.course || this.exercise.exerciseGroup!.exam!.course);\n+        } else {\n+            this.isAtLeastInstructor = this.accountService.hasAnyAuthorityDirect(['ROLE_INSTRUCTOR', 'ROLE_ADMIN']);\n+        }\n+    }\n \n-        let isBeforeAssessmentDueDate = true;\n-        // Add check as the assessmentDueDate must not be set for exercises\n-        if (this.exercise.assessmentDueDate) {\n-            isBeforeAssessmentDueDate = this.exercise && this.exercise.assessmentDueDate && moment().isBefore(this.exercise.assessmentDueDate);\n+    /**\n+     * Boolean which determines whether the user can override a result.\n+     * If no exercise is loaded, for example during loading between exercises, we return false.\n+     * Instructors can always override a result.\n+     * Tutors can override their own results within the assessment due date, if there is no complaint about their assessment.\n+     * They cannot override a result anymore, if there is a complaint. Another tutor must handle the complaint.\n+     */\n+    get canOverride(): boolean {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d27751318746750e4523d63b7eb8849e8d5faa6b"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2NDQ1MDc3OnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/exercises/file-upload/assess/file-upload-assessment.component.ts", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxODo0OTo0OVrOG1vvzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxOTowMzoxOFrOG1wOyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAwOTk5OA==", "bodyText": "This appears multiple times. Would be better if this is defined in one place.", "url": "https://github.com/ls1intum/Artemis/pull/1938#discussion_r459009998", "createdAt": "2020-07-22T18:49:49Z", "author": {"login": "kloessst"}, "path": "src/main/webapp/app/exercises/file-upload/assess/file-upload-assessment.component.ts", "diffHunk": "@@ -495,6 +519,10 @@ export class FileUploadAssessmentComponent implements OnInit, AfterViewInit, OnD\n         this.referencedFeedback = feedbacks;\n     }\n \n+    get readOnly(): boolean {\n+        return !this.isAtLeastInstructor && !!this.complaint && this.isAssessor;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d27751318746750e4523d63b7eb8849e8d5faa6b"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAxNzkzMA==", "bodyText": "There are three assessment components which have very similar code. However, refactoring them to create an assessment superclass would require a deep intrusion into the code which I feel should be done in a separate PR. This change should also include adapting the manual assessment review of programming exercises to follow the same procedure as the other exercises types. However, this is all out of scope of this PR, and we should probably do this after the exams are over.", "url": "https://github.com/ls1intum/Artemis/pull/1938#discussion_r459017930", "createdAt": "2020-07-22T19:03:18Z", "author": {"login": "anditurdiu"}, "path": "src/main/webapp/app/exercises/file-upload/assess/file-upload-assessment.component.ts", "diffHunk": "@@ -495,6 +519,10 @@ export class FileUploadAssessmentComponent implements OnInit, AfterViewInit, OnD\n         this.referencedFeedback = feedbacks;\n     }\n \n+    get readOnly(): boolean {\n+        return !this.isAtLeastInstructor && !!this.complaint && this.isAssessor;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAwOTk5OA=="}, "originalCommit": {"oid": "d27751318746750e4523d63b7eb8849e8d5faa6b"}, "originalPosition": 59}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4807, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}