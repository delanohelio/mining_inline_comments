{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3MDA3NDk3", "number": 1684, "title": "Generate participations for all exercises in student exams", "bodyText": "Checklist\n\n\n I tested all changes and all related features with different users (student, tutor, instructor, admin) on the test server https://artemistest.ase.in.tum.de.\n\n\n Server: I added multiple integration tests (Spring) related to the features\n\n\n Server: I added @PreAuthorize and check the course groups for all new REST Calls (security)\n\n\n Server: I implemented the changes with a good performance and prevented too many database calls\n\n\n Server: I documented the Java code using JavaDoc style.\n\n\n Client: I added multiple screenshots/screencasts of my UI changes\n\n\n Client: I translated all the newly inserted strings into German and English\n\n\nMotivation and Context\n\n\nTo reduce the load on the server at exam time, instructors should be able to generate the necessary participation objects manually by clicking a button in the exam management UI.\nDescription\n\nCloses #1616\nSteps for Testing\n\n\nLog in to Artemis\nNavigate to Course Administration\nCreate an Exam with some Exercises\nCreate the student exams\nClick the Start Exercises Button and look in the network tab. The generated participations will be in the response\n\nScreenshots", "createdAt": "2020-06-19T09:58:14Z", "url": "https://github.com/ls1intum/Artemis/pull/1684", "merged": true, "mergeCommit": {"oid": "ad94d6a1fbd399fdf528408335d64c0533ba1d85"}, "closed": true, "closedAt": "2020-06-22T11:43:19Z", "author": {"login": "stefanwaldhauser"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcswCdogH2gAyNDM3MDA3NDk3OmM5M2UxMGFlNWY2MzEyN2YzMDU2MDYzZGNkNTQ0NDJiMzQ0NDQ3ZDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABctu2UJAFqTQzNDgyMTk3NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c93e10ae5f63127f3056063dcd54442b344447d9", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/c93e10ae5f63127f3056063dcd54442b344447d9", "committedDate": "2020-06-19T09:56:53Z", "message": "Created REST Endpoint for generating the participations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a96b8569adeb1400d987297b12cfc71c5369fea4", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/a96b8569adeb1400d987297b12cfc71c5369fea4", "committedDate": "2020-06-19T12:16:06Z", "message": "Implemented method to pre-start all exercises for student exams"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7038cbdae4e91a09c3227370d2bf591e49fdac7b", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/7038cbdae4e91a09c3227370d2bf591e49fdac7b", "committedDate": "2020-06-19T13:35:53Z", "message": "Moved to exam"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "277723a7e145bc52baa1214061a60382dd3fe5d4", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/277723a7e145bc52baa1214061a60382dd3fe5d4", "committedDate": "2020-06-19T14:02:45Z", "message": "Wrote Integration Test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b853195cafbd9a7897aace37e95e5c12570e0bee", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/b853195cafbd9a7897aace37e95e5c12570e0bee", "committedDate": "2020-06-20T09:46:45Z", "message": "Implemented StartExercise Functionality in the frontend"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8a18f054d12695ae071a0e209de165c379206d8", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/e8a18f054d12695ae071a0e209de165c379206d8", "committedDate": "2020-06-20T10:05:45Z", "message": "added student participation to findByExamId"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2dd4cb36e4857d882fb9aeb5ee5d274cbf6ff5d", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/e2dd4cb36e4857d882fb9aeb5ee5d274cbf6ff5d", "committedDate": "2020-06-20T10:06:22Z", "message": "Implemented reloading after generating student exams / starting exercises"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "019868cafc7606ab608d26b4e20da90bb3dfd60e", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/019868cafc7606ab608d26b4e20da90bb3dfd60e", "committedDate": "2020-06-20T10:45:51Z", "message": "Added more integration tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d3ddb2b73b3647b6ed2d8d58323d7cfd404c2ee", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/9d3ddb2b73b3647b6ed2d8d58323d7cfd404c2ee", "committedDate": "2020-06-20T10:49:43Z", "message": "Merge branch 'develop' into exam-mode/variants/participation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf6667120e20adcdf9238d80a1e23f26e19adb19", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/cf6667120e20adcdf9238d80a1e23f26e19adb19", "committedDate": "2020-06-20T10:51:33Z", "message": "Fixed merged conflict"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6e6ba18a09ee439b661bc1dd1e63ea14564e374", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/f6e6ba18a09ee439b661bc1dd1e63ea14564e374", "committedDate": "2020-06-20T10:59:58Z", "message": "Added missing javadoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NDg5OTY2", "url": "https://github.com/ls1intum/Artemis/pull/1684#pullrequestreview-434489966", "createdAt": "2020-06-21T10:41:58Z", "commit": {"oid": "f6e6ba18a09ee439b661bc1dd1e63ea14564e374"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMVQxMDo0MTo1OFrOGmrKpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMVQxMDo0MTo1OFrOGmrKpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIwNjMxMQ==", "bodyText": "do we only support java atm? I know that @anditurdiu was working on programming exercises in other languages which will come at some point in the future (if not already there). Should the programming language also be configurable?", "url": "https://github.com/ls1intum/Artemis/pull/1684#discussion_r443206311", "createdAt": "2020-06-21T10:41:58Z", "author": {"login": "TobiasPr"}, "path": "src/test/java/de/tum/in/www1/artemis/util/ModelFactory.java", "diffHunk": "@@ -71,6 +71,17 @@ public static ProgrammingExercise generateProgrammingExercise(ZonedDateTime rele\n         return programmingExercise;\n     }\n \n+    public static ProgrammingExercise generateProgrammingExerciseForExam(ZonedDateTime releaseDate, ZonedDateTime dueDate, ExerciseGroup exerciseGroup) {\n+        ProgrammingExercise programmingExercise = new ProgrammingExercise();\n+        programmingExercise = (ProgrammingExercise) populateExerciseForExam(programmingExercise, releaseDate, dueDate, null, exerciseGroup);\n+        programmingExercise.generateAndSetProjectKey();\n+        programmingExercise.setAssessmentType(AssessmentType.SEMI_AUTOMATIC);\n+        programmingExercise.setProgrammingLanguage(ProgrammingLanguage.JAVA);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6e6ba18a09ee439b661bc1dd1e63ea14564e374"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NTEzNTIz", "url": "https://github.com/ls1intum/Artemis/pull/1684#pullrequestreview-434513523", "createdAt": "2020-06-21T16:05:18Z", "commit": {"oid": "f6e6ba18a09ee439b661bc1dd1e63ea14564e374"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NTI0NTM1", "url": "https://github.com/ls1intum/Artemis/pull/1684#pullrequestreview-434524535", "createdAt": "2020-06-21T18:59:25Z", "commit": {"oid": "f6e6ba18a09ee439b661bc1dd1e63ea14564e374"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NjY0NTk1", "url": "https://github.com/ls1intum/Artemis/pull/1684#pullrequestreview-434664595", "createdAt": "2020-06-22T07:26:21Z", "commit": {"oid": "f6e6ba18a09ee439b661bc1dd1e63ea14564e374"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0Njk4MTM1", "url": "https://github.com/ls1intum/Artemis/pull/1684#pullrequestreview-434698135", "createdAt": "2020-06-22T08:15:23Z", "commit": {"oid": "f6e6ba18a09ee439b661bc1dd1e63ea14564e374"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NzE5OTk1", "url": "https://github.com/ls1intum/Artemis/pull/1684#pullrequestreview-434719995", "createdAt": "2020-06-22T08:43:52Z", "commit": {"oid": "f6e6ba18a09ee439b661bc1dd1e63ea14564e374"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwODo0Mzo1MlrOGm3UVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwODo0Mzo1MlrOGm3UVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQwNTM5OA==", "bodyText": "comment is wrong", "url": "https://github.com/ls1intum/Artemis/pull/1684#discussion_r443405398", "createdAt": "2020-06-22T08:43:52Z", "author": {"login": "krusche"}, "path": "src/test/java/de/tum/in/www1/artemis/ExamIntegrationTest.java", "diffHunk": "@@ -167,6 +171,90 @@ public void testRegisterUsersInExam() throws Exception {\n         }\n     }\n \n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void testStartExercisesWithTextExercise() throws Exception {\n+        // registering users\n+        var student1 = database.getUserByLogin(\"student1\");\n+        var student2 = database.getUserByLogin(\"student2\");\n+        var registeredUsers = Set.of(student1, student2);\n+        exam2.setRegisteredUsers(registeredUsers);\n+        // setting dates\n+        exam2.setStartDate(ZonedDateTime.now().plusHours(2));\n+        exam2.setEndDate(ZonedDateTime.now().plusHours(3));\n+        exam2.setVisibleDate(ZonedDateTime.now().plusHours(1));\n+\n+        // creating exercise\n+        TextExercise textExercise = ModelFactory.generateTextExerciseForExam(exam2.getStartDate(), exam2.getEndDate(), exam2.getEndDate().plusWeeks(2),\n+                exam2.getExerciseGroups().get(0));\n+        exam2.getExerciseGroups().get(0).addExercise(textExercise);\n+        exerciseGroupRepository.save(exam2.getExerciseGroups().get(0));\n+        textExercise = exerciseRepo.save(textExercise);\n+\n+        // creating student exams\n+        for (User user : registeredUsers) {\n+            StudentExam studentExam = new StudentExam();\n+            studentExam.addExercise(textExercise);\n+            studentExam.setUser(user);\n+            exam2.addStudentExam(studentExam);\n+            studentExamRepository.save(studentExam);\n+        }\n+\n+        exam2 = examRepository.save(exam2);\n+\n+        // invoke generate student exams", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6e6ba18a09ee439b661bc1dd1e63ea14564e374"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NzIxMzk2", "url": "https://github.com/ls1intum/Artemis/pull/1684#pullrequestreview-434721396", "createdAt": "2020-06-22T08:45:41Z", "commit": {"oid": "f6e6ba18a09ee439b661bc1dd1e63ea14564e374"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwODo0NTo0MVrOGm3YaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwODo0NTo0MVrOGm3YaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQwNjQ0MQ==", "bodyText": "Please do not use Transactional here and rather use a query such as\nstudentExamRepository.findWithExercisesAndParticipationsByExamId\nThen make sure that only the participations for the user of the student exam is loaded, otherwise your \"isEmpty()\" check does not make any sense later on", "url": "https://github.com/ls1intum/Artemis/pull/1684#discussion_r443406441", "createdAt": "2020-06-22T08:45:41Z", "author": {"login": "krusche"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ExamService.java", "diffHunk": "@@ -297,4 +302,24 @@ private Exercise selectRandomExercise(SecureRandom random, ExerciseGroup exercis\n         int randomIndex = random.nextInt(exercises.size());\n         return exercises.get(randomIndex);\n     }\n+\n+    /**\n+     * Starts all the exercises of all the student exams of an exam\n+     *\n+     * @param examId exam to which the student exams belong\n+     * @return list of generated participations\n+     */\n+    @Transactional", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6e6ba18a09ee439b661bc1dd1e63ea14564e374"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NzIxODA3", "url": "https://github.com/ls1intum/Artemis/pull/1684#pullrequestreview-434721807", "createdAt": "2020-06-22T08:46:13Z", "commit": {"oid": "f6e6ba18a09ee439b661bc1dd1e63ea14564e374"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwODo0NjoxM1rOGm3ZxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwODo0NjoxM1rOGm3ZxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQwNjc4OA==", "bodyText": "exercise.getStudentParticipations().isEmpty() is problematic here, because it might include participations of other users than the user specified in the studentExam", "url": "https://github.com/ls1intum/Artemis/pull/1684#discussion_r443406788", "createdAt": "2020-06-22T08:46:13Z", "author": {"login": "krusche"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ExamService.java", "diffHunk": "@@ -297,4 +302,24 @@ private Exercise selectRandomExercise(SecureRandom random, ExerciseGroup exercis\n         int randomIndex = random.nextInt(exercises.size());\n         return exercises.get(randomIndex);\n     }\n+\n+    /**\n+     * Starts all the exercises of all the student exams of an exam\n+     *\n+     * @param examId exam to which the student exams belong\n+     * @return list of generated participations\n+     */\n+    @Transactional\n+    public List<Participation> startExercises(Long examId) {\n+        List<StudentExam> studentExams = studentExamRepository.findByExamId(examId);\n+        List<Participation> generatedParticipations = new ArrayList<>();\n+\n+        for (StudentExam studentExam : studentExams) {\n+            User student = studentExam.getUser();\n+            studentExam.getExercises().stream().filter(exercise -> exercise.getStudentParticipations().isEmpty())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6e6ba18a09ee439b661bc1dd1e63ea14564e374"}, "originalPosition": 49}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NzIzNzE1", "url": "https://github.com/ls1intum/Artemis/pull/1684#pullrequestreview-434723715", "createdAt": "2020-06-22T08:48:50Z", "commit": {"oid": "f6e6ba18a09ee439b661bc1dd1e63ea14564e374"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54ae1691c96e9ae5a0765382aec4405ff57490be", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/54ae1691c96e9ae5a0765382aec4405ff57490be", "committedDate": "2020-06-22T11:04:46Z", "message": "fix PR comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebbca9a0dbe0539969ce560fabbef8c6e56c678a", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/ebbca9a0dbe0539969ce560fabbef8c6e56c678a", "committedDate": "2020-06-22T11:06:52Z", "message": "revert change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85b3a08ed9c7c7df8771c24ca81c8ba7e229c875", "author": {"user": {"login": "krusche", "name": "Stephan Krusche"}}, "url": "https://github.com/ls1intum/Artemis/commit/85b3a08ed9c7c7df8771c24ca81c8ba7e229c875", "committedDate": "2020-06-22T11:07:17Z", "message": "Merge branch 'develop' into exam-mode/variants/participation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0ODIxOTc0", "url": "https://github.com/ls1intum/Artemis/pull/1684#pullrequestreview-434821974", "createdAt": "2020-06-22T11:07:38Z", "commit": {"oid": "85b3a08ed9c7c7df8771c24ca81c8ba7e229c875"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2485, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}