{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1NzgyNTY2", "number": 1442, "title": "Improve BehaviourTest in java template", "bodyText": "This is an Artemis-local copy of the fork of #1194\nMotivation and Context\nBehaviorTest class in templates for Java exercises had bugs and did not provide required functionality for one of the exercises.\nDescription\nFirst of all, there was a bug in the method getParameterTypes where it would not construct the correct array of classes if any of the parameters were equal in the Java-object sense.\nSecondly, there was no way of creating a newInstance if the required classes had constructor with primitively-typed arguments. Method getConstructor and another overloading of newInstance were added to tackle that problem.\nNext, there was no way of using invokeMethod, but rethrowing an exception which could occur during the underlying method execution. It is sometimes required to check whether implementation of a method by students throws an expected exception. A new method invokeMethodRethrowing was added to support this.\nLastly, there are a couple of small refactoring here and there to make the code more readable, and less error-prone.\nSteps for Testing\n\nLog in to Artemis\nNavigate to Course Administration\nCreate a new Java exercise\nCheck the created tests repo, which should include the new version of BehaviorTest class\n\nTests\n\n I checked on the test server that the behavior tests can be used as expected and still work", "createdAt": "2020-05-10T21:19:01Z", "url": "https://github.com/ls1intum/Artemis/pull/1442", "merged": true, "mergeCommit": {"oid": "4d013ce397aed41a8670726ef64a9d838f7b28fe"}, "closed": true, "closedAt": "2020-05-12T15:35:19Z", "author": {"login": "MaisiKoleni"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb7rQ3YAH2gAyNDE1NzgyNTY2OmU1NTRiM2FmODE1ODdkZTQ2MWFmZTQ0NmExZWI0M2MwZDdhYmJlMTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgmFkYAFqTQxMDE2NjgzNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e554b3af81587de461afe446a1eb43c0d7abbe11", "author": {"user": {"login": "alllex", "name": "Aleksei Semin"}}, "url": "https://github.com/ls1intum/Artemis/commit/e554b3af81587de461afe446a1eb43c0d7abbe11", "committedDate": "2020-01-18T22:40:48Z", "message": "Improve BehaviourTest in java template"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "872895fa349de124e41049edc37b6e4c55a5a199", "author": {"user": {"login": "alllex", "name": "Aleksei Semin"}}, "url": "https://github.com/ls1intum/Artemis/commit/872895fa349de124e41049edc37b6e4c55a5a199", "committedDate": "2020-01-18T22:53:12Z", "message": "Fix javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f709df2459c0ffba522f26cdff0c8805e88a8fe", "author": {"user": {"login": "krusche", "name": "Stephan Krusche"}}, "url": "https://github.com/ls1intum/Artemis/commit/6f709df2459c0ffba522f26cdff0c8805e88a8fe", "committedDate": "2020-01-23T22:53:28Z", "message": "Merge branch 'develop' into develop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "534ce913a92d1e645fa65ad1ff82dc2d2c553626", "author": {"user": {"login": "alllex", "name": "Aleksei Semin"}}, "url": "https://github.com/ls1intum/Artemis/commit/534ce913a92d1e645fa65ad1ff82dc2d2c553626", "committedDate": "2020-01-24T10:08:21Z", "message": "Improve error message formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "192ee5cf031bc4d0b59e4bbabd56a5e3a0f6df00", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/192ee5cf031bc4d0b59e4bbabd56a5e3a0f6df00", "committedDate": "2020-05-08T14:45:13Z", "message": "Use simple class name again"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3e5fc62a216006ffbfebf78765e4ebee2dc337c", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/d3e5fc62a216006ffbfebf78765e4ebee2dc337c", "committedDate": "2020-05-08T15:28:56Z", "message": "More places where simple names should be used"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "431edcbc04e5b7153fc820abed1a8ed0811ad280", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/431edcbc04e5b7153fc820abed1a8ed0811ad280", "committedDate": "2020-05-08T15:53:39Z", "message": "Improve failure messages for NullPointerExceptions\n\nI would highly advise to change or remove the way methods are selected\njust using the run time types of the arguments in the future. Good error\nmessages are not possible if some objects are unexpectedly null.\nIt will also suddenly fail if the tester/student/... passes subclasses\ninstead."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8de83d576ed9a6f2512f0048d5363ece2cbe30b5", "author": {"user": {"login": "krusche", "name": "Stephan Krusche"}}, "url": "https://github.com/ls1intum/Artemis/commit/8de83d576ed9a6f2512f0048d5363ece2cbe30b5", "committedDate": "2020-05-10T08:22:21Z", "message": "Merge branch 'develop' into develop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9bc30d81de2b309821d414f449170126a6b91ac", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/a9bc30d81de2b309821d414f449170126a6b91ac", "committedDate": "2020-05-10T14:51:26Z", "message": "Describe method limitations in the JavaDoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c2fb00169e8f13826ab9cea6e79176d03aa9fb7", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/3c2fb00169e8f13826ab9cea6e79176d03aa9fb7", "committedDate": "2020-05-10T14:51:46Z", "message": "Remove TODO"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50c072b39d95c6f6dd4ff85345cc668f014c9198", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/50c072b39d95c6f6dd4ff85345cc668f014c9198", "committedDate": "2020-05-10T19:52:39Z", "message": "Update version of BehaviorTest class JavaDoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MDA5Nzg5", "url": "https://github.com/ls1intum/Artemis/pull/1442#pullrequestreview-409009789", "createdAt": "2020-05-11T09:30:49Z", "commit": {"oid": "50c072b39d95c6f6dd4ff85345cc668f014c9198"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQwOTozMDo1MFrOGTUUwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQwOTozMDo1MFrOGTUUwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjkwOTEyMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        + getParameterTypesAsString(parameterTypes) + \" from the \" + declaringClass.getSimpleName() + \" because\";\n          \n          \n            \n                        + getParameterTypesAsString(parameterTypes) + \" in the class \" + declaringClass.getSimpleName() + \" because\";", "url": "https://github.com/ls1intum/Artemis/pull/1442#discussion_r422909122", "createdAt": "2020-05-11T09:30:50Z", "author": {"login": "krusche"}, "path": "src/main/resources/templates/java/test/testFiles/behavior/BehaviorTest.java", "diffHunk": "@@ -125,7 +180,7 @@ protected Method getMethod(Object object, String methodName, Class<?>... paramet\n      */\n     protected Method getMethod(Class<?> declaringClass, String methodName, Class<?>... parameterTypes) {\n         String failMessage = \"Could not find the method '\" + methodName + \"' with the parameters: \"\n-            + getParameterTypesAsString(parameterTypes) + \" from the class \" + declaringClass.getSimpleName() + \" because\";\n+            + getParameterTypesAsString(parameterTypes) + \" from the \" + declaringClass.getSimpleName() + \" because\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50c072b39d95c6f6dd4ff85345cc668f014c9198"}, "originalPosition": 126}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MDEwMzYx", "url": "https://github.com/ls1intum/Artemis/pull/1442#pullrequestreview-409010361", "createdAt": "2020-05-11T09:31:38Z", "commit": {"oid": "50c072b39d95c6f6dd4ff85345cc668f014c9198"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQwOTozMTozOFrOGTUWgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQwOTozMTozOFrOGTUWgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjkwOTU3MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            + \" from the class \" + declaringClass.getSimpleName() + \" because\";\n          \n          \n            \n                            + \" in the class \" + declaringClass.getSimpleName() + \" because\";", "url": "https://github.com/ls1intum/Artemis/pull/1442#discussion_r422909571", "createdAt": "2020-05-11T09:31:38Z", "author": {"login": "krusche"}, "path": "src/main/resources/templates/java/test/testFiles/behavior/BehaviorTest.java", "diffHunk": "@@ -167,39 +224,86 @@ protected Object invokeMethod(Object object, Method method, Object... params) {\n     }\n \n     /**\n-     * Invoke a given method name of a given object with instances of the parameters.\n+     * Invoke a given method of a given object with instances of the parameters,\n+     * and rethrow an exception if one occurs during the method execution.\n      * @param object: The instance of the class that should invoke the method.\n+     * @param method: The method that has to get invoked.\n+     * @param params: Parameter instances of the method. Do not include if the method has no parameters.\n+     * @return The return value of the method.\n+     */\n+    protected Object invokeMethodRethrowing(Object object, Method method, Object... params) throws Throwable {\n+        // NOTE: object can be null, if method is static\n+        String failMessage = \"Could not invoke the method '\" + method.getName()\n+                + \"' in the class \" + method.getDeclaringClass().getSimpleName() + \" because\";\n+        try {\n+            return method.invoke(object, params);\n+        } catch (IllegalAccessException iae) {\n+            fail(failMessage += \" access to the method was denied. Make sure to check the modifiers of the method.\");\n+        } catch (IllegalArgumentException iae) {\n+            fail(failMessage += \" the parameters are not implemented right. Make sure to check the parameters of the method\");\n+        } catch (InvocationTargetException e) {\n+            throw e.getCause();\n+        }\n+\n+        return null;\n+    }\n+\n+    /**\n+     * Invoke a given method name of a given object with instances of the parameters.\n+     * <p>\n+     * This method does not support invoking static methods and passing null, passing subclasses of the parameter types or invoking\n+     * methods with primitive parameters. Use {@link #invokeMethod(Object, Method, Object...)} for that.\n+     * @param object: The instance of the class that should invoke the method. Must not be null, even for static methods.\n      * @param methodName: The method name that has to get invoked.\n      * @param params: Parameter instances of the method. Do not include if the method has no parameters.\n      * @return The return value of the method.\n      */\n     protected Object invokeMethod(Object object, String methodName, Object... params) {\n-        Class<?>[] parameterTypes = getParameterTypes(params);\n+        String failMessage = \"Could not find the method '\" + methodName + \"' because\";\n+        Class<?>[] parameterTypes = getParameterTypes(failMessage, params);\n         Method method = getMethod(object, methodName, parameterTypes);\n         return invokeMethod(object, method, params);\n     }\n \n     /**\n-     * Retrieves the parameters types of a given collection of parameter instances.\n-     * @param params: The instances of the parameters.\n-     * @return The parameter types of the instances as an array.\n+     * Retrieve a constructor with arguments of a given class.\n+     * @param declaringClass: The class that declares this constructor.\n+     * @param parameterTypes: The parameter types of this method. Do not include if the method has no parameters.\n+     * @return The wanted method.\n      */\n-    private Class<?>[] getParameterTypes(Object... params) {\n-        Class<?>[] parameterTypes;\n+    protected Constructor<?> getConstructor(Class<?> declaringClass, Class<?>... parameterTypes) {\n+        String failMessage = \"Could not find the constructor with the parameters: \"\n+                + getParameterTypesAsString(parameterTypes)\n+                + \" from the class \" + declaringClass.getSimpleName() + \" because\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50c072b39d95c6f6dd4ff85345cc668f014c9198"}, "originalPosition": 209}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MDExMTY2", "url": "https://github.com/ls1intum/Artemis/pull/1442#pullrequestreview-409011166", "createdAt": "2020-05-11T09:32:44Z", "commit": {"oid": "50c072b39d95c6f6dd4ff85345cc668f014c9198"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f7426a111e281ff46af1a6b30966ca3cd525a85", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/1f7426a111e281ff46af1a6b30966ca3cd525a85", "committedDate": "2020-05-11T09:38:34Z", "message": "Improve BehaviourTest failure message wording\n\nCo-authored-by: Stephan Krusche <krusche@in.tum.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMDYxOTU5", "url": "https://github.com/ls1intum/Artemis/pull/1442#pullrequestreview-410061959", "createdAt": "2020-05-12T13:50:37Z", "commit": {"oid": "1f7426a111e281ff46af1a6b30966ca3cd525a85"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMDY2Njg5", "url": "https://github.com/ls1intum/Artemis/pull/1442#pullrequestreview-410066689", "createdAt": "2020-05-12T13:55:18Z", "commit": {"oid": "1f7426a111e281ff46af1a6b30966ca3cd525a85"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3654f33ddacd3180a685d4c50016143008037978", "author": {"user": {"login": "F4lka", "name": null}}, "url": "https://github.com/ls1intum/Artemis/commit/3654f33ddacd3180a685d4c50016143008037978", "committedDate": "2020-05-12T13:55:27Z", "message": "Merge branch 'develop' into enhancement/programming-exercise/behavior-test-improvements"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMTY2ODM1", "url": "https://github.com/ls1intum/Artemis/pull/1442#pullrequestreview-410166835", "createdAt": "2020-05-12T15:34:08Z", "commit": {"oid": "3654f33ddacd3180a685d4c50016143008037978"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3017, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}