{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3MzkyNzQ2", "number": 2367, "title": "Notification popup", "bodyText": "Checklist\n\n I tested all changes and all related features with different users (student, tutor, instructor, admin) on the test server https://artemistest.ase.in.tum.de.\n Server: I followed the coding and design guidelines.\n Server: I added multiple integration tests (Spring) related to the features (with a high test coverage)\n Server: I added @PreAuthorize and check the course groups for all new REST Calls (security)\n Server: I implemented the changes with a good performance and prevented too many database calls\n Server: I documented the Java code using JavaDoc style.\n Client: I followed the coding and design guidelines.\n Client: I added multiple integration tests (Jest) related to the features (with a high test coverage)\n Client: I documented the TypeScript code using JSDoc style.\n Client: I added multiple screenshots/screencasts of my UI changes\n\nMotivation and Context\nIf students are not on the course overview, they will not see when a new quiz exercise starts. We want to notify students about a started quiz exercise everywhere.\nDescription\nWe use a popup in the right bottom corner to inform students about a started quiz exercise. The popup is shown on every page. Therefore I introduce a couple of changes:\n\nTo prevent unnecessary server load we derive the corresponding notification from the already existing quiz updates that are received via websocket. We do not send the quiz started notification via websocket.\nAt the moment the subscription to the websocket messages for notifications takes mainly place in the course-management.service. It makes more sense to place these subscriptions in the components that actually consume the notifications (notification-sidebar.component and notification-popup.component).\nThe course-management.service now only provides a list of coursesForNotifications. The notification.service uses this list to subscribe to notification updates and quiz updates (if not already subscribed).\nThe coursesForNotifications will be filled with courses received from existing requests from the course-management.service. I've added a REST route that retrieves the courses for notifications with minimal payload.\nThe new GET /courses/for-notifications request is only triggered if no courses have been retrieved up by the course management service yet.\nThe notification will only be displayed if the user is not already on the target page (or the live participation page)\n\nSteps for Testing\n\nLog in to Artemis with artemis_test_user1\nNavigate wherever you want\nExecute steps 1-5 in browser/tab 2\nThe notification should now popup in this tab\nClick on the notification\nYou should be redirected to the quiz's participation page\n\nBrowser/Tab 2\n\nLog in to Artemis with your account\nNavigate to Course Administration\nCreate a quiz\nSet the quiz visible\nStart the quiz\n\nTest Coverage\nClient\n\nnotification-sidebar.component.ts 88.89% -> 88.24%\nnotification-popup.component.ts 97.3%\ncourse-management.service.ts 31.88% -> 32.16%\nnotification.service.ts 32.88% -> 47.37%\n\nServer\nFlaky test prevents generation of coverage report.\nScreenshots", "createdAt": "2020-11-08T23:57:14Z", "url": "https://github.com/ls1intum/Artemis/pull/2367", "merged": true, "mergeCommit": {"oid": "d818d350d1155b697daefc8e77ae0cd615212ae3"}, "closed": true, "closedAt": "2020-11-17T16:00:16Z", "author": {"login": "sascha11110"}, "timelineItems": {"totalCount": 39, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXYm7UAH2gAyNTE3MzkyNzQ2Ojc3ZGYzOGU3YWI5OTk4ZmVlNzU3MGQyNWZiZmEyMGY0OGUwZmNkYmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddbvR1gFqTUzMjUyMzkxOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "77df38e7ab9998fee7570d25fbfa20f48e0fcdbf", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/77df38e7ab9998fee7570d25fbfa20f48e0fcdbf", "committedDate": "2020-10-29T20:57:44Z", "message": "Server: Rename NotificationType EXERCISE_STARTED to QUIZ_EXERCISE_STARTED"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfd0bc354c5dce1f02cc788820b07da88c04c549", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/cfd0bc354c5dce1f02cc788820b07da88c04c549", "committedDate": "2020-10-29T21:00:15Z", "message": "Server: \"Exercise started\" -> \"Quiz started\""}}, {"__typename": "PullRequestCommit", "commit": {"oid": "765b0216dfecd30874d893d0716f07a693a1a38b", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/765b0216dfecd30874d893d0716f07a693a1a38b", "committedDate": "2020-11-04T07:15:21Z", "message": "Client: Adjust courseManagementService to fetch courses for notifications"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d3ea199d4225ea8b8accbfec94e72da8a89ef52", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/8d3ea199d4225ea8b8accbfec94e72da8a89ef52", "committedDate": "2020-11-04T21:44:45Z", "message": "Client: Add notification popup component"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4919a98a9d6396379156b3a961fe40ef9385a757", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/4919a98a9d6396379156b3a961fe40ef9385a757", "committedDate": "2020-11-08T20:06:17Z", "message": "Client: Handle empty notification target in notification-popup.component"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73efda598a653fbda649ae3e0c4d289582f7a3c1", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/73efda598a653fbda649ae3e0c4d289582f7a3c1", "committedDate": "2020-11-08T20:18:02Z", "message": "Client: Handle empty notification target in notification-popup.component (2)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2508ad3696e8adcc887a3574c8e58b60615457b", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/e2508ad3696e8adcc887a3574c8e58b60615457b", "committedDate": "2020-11-08T21:38:42Z", "message": "Client: Use notification subscription mechanism in notification sidebar component"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6580803fb477e7ae6f2f8cf4d91ace4df61fc46", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/b6580803fb477e7ae6f2f8cf4d91ace4df61fc46", "committedDate": "2020-11-08T21:41:05Z", "message": "Client [Test]: Adjust notification-sidebar.component.spec"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9ad2688597bd930f55f2375c8374f02a6db6e1f", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/b9ad2688597bd930f55f2375c8374f02a6db6e1f", "committedDate": "2020-11-08T22:54:34Z", "message": "Client [Test]: Adjust notification service mock"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e26ff73f4e151d17028b2daf32042c77531ce050", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/e26ff73f4e151d17028b2daf32042c77531ce050", "committedDate": "2020-11-08T22:54:55Z", "message": "Client [Test]: Add notification-popup.component.spec"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4cd8d38e9d5460289c47f1ac391be918513a8aa", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/a4cd8d38e9d5460289c47f1ac391be918513a8aa", "committedDate": "2020-11-08T23:02:48Z", "message": "Server: Add route to retrieve all active courses for notifications"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6bccc6d3766f98216f3b62c78657f5ea86b7cef3", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/6bccc6d3766f98216f3b62c78657f5ea86b7cef3", "committedDate": "2020-11-08T23:05:40Z", "message": "Server [Test]: Extend CourseIntegrationTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d683715bc87646f3d0150d417470654ca7834b2", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/4d683715bc87646f3d0150d417470654ca7834b2", "committedDate": "2020-11-08T23:20:07Z", "message": "Server: Do not send notification if quiz exercise is started"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76bc5f234bd73042c5056ef4862dbc073cbd13a9", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/76bc5f234bd73042c5056ef4862dbc073cbd13a9", "committedDate": "2020-11-08T23:21:06Z", "message": "Merge branch 'develop' into feature/notification/popup-quiz-start"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "407459ceea9cecb76ded0d367d1533ca35bfe37d", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/407459ceea9cecb76ded0d367d1533ca35bfe37d", "committedDate": "2020-11-09T00:05:45Z", "message": "Client: Remove notificationService from courseManagementService to prevent circular dependency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d84edfa9c9b8e26a7001e5fa08d5b5d7022ecf81", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/d84edfa9c9b8e26a7001e5fa08d5b5d7022ecf81", "committedDate": "2020-11-09T00:11:08Z", "message": "Client: Fix Codacy issues (1)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "479bfc8f7b27532193a239b5e35bd52368b1d40c", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/479bfc8f7b27532193a239b5e35bd52368b1d40c", "committedDate": "2020-11-09T00:12:49Z", "message": "Server: Fix Codacy issues (2)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ca3f1443fc77180028bb9355f9d8fecad0d732f", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/5ca3f1443fc77180028bb9355f9d8fecad0d732f", "committedDate": "2020-11-09T00:23:25Z", "message": "Client: Fix Codacy issues (3)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efc3edc1d94829ac1070e712ae3423808f949e65", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/efc3edc1d94829ac1070e712ae3423808f949e65", "committedDate": "2020-11-09T00:49:38Z", "message": "Client: Fix Codacy issues (4)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a60dfb0a65951d0121d4130779f419b050d76849", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/a60dfb0a65951d0121d4130779f419b050d76849", "committedDate": "2020-11-09T23:24:04Z", "message": "Merge branch 'develop' into feature/notification/popup-quiz-start"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e24fe64f1e1fca45ad28a69392877d8d41bfc69", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/9e24fe64f1e1fca45ad28a69392877d8d41bfc69", "committedDate": "2020-11-10T00:12:11Z", "message": "Client: Prevent undefined in notification-popup.component and notification-sidebar.component"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "751c40492453f87aa4e40eb7910a5e0e73f13ed0", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/751c40492453f87aa4e40eb7910a5e0e73f13ed0", "committedDate": "2020-11-10T00:15:47Z", "message": "Client: Adjust bottom positioning of notification popup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25be2e023c771bfdc2173d4d8c0bc0a92ea31fbf", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/25be2e023c771bfdc2173d4d8c0bc0a92ea31fbf", "committedDate": "2020-11-10T00:47:54Z", "message": "Client: Use ReplaySubject"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b940feabc46b31a5e77c8964301f26c207d977d", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/6b940feabc46b31a5e77c8964301f26c207d977d", "committedDate": "2020-11-10T01:00:10Z", "message": "Client: Fix target of dummy quiz notification"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f1721961d16aa8f45a49db7c35380a0e08ed4ab", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/6f1721961d16aa8f45a49db7c35380a0e08ed4ab", "committedDate": "2020-11-10T07:57:24Z", "message": "Merge branch 'develop' into feature/notification/popup-quiz-start"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3MTk5Mzg3", "url": "https://github.com/ls1intum/Artemis/pull/2367#pullrequestreview-527199387", "createdAt": "2020-11-10T13:28:17Z", "commit": {"oid": "6f1721961d16aa8f45a49db7c35380a0e08ed4ab"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4MTAzMzUw", "url": "https://github.com/ls1intum/Artemis/pull/2367#pullrequestreview-528103350", "createdAt": "2020-11-11T11:51:06Z", "commit": {"oid": "6f1721961d16aa8f45a49db7c35380a0e08ed4ab"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "235c6a5dea40f52b427712d79edc1c84f310b8a5", "author": {"user": {"login": "krusche", "name": "Stephan Krusche"}}, "url": "https://github.com/ls1intum/Artemis/commit/235c6a5dea40f52b427712d79edc1c84f310b8a5", "committedDate": "2020-11-11T20:56:00Z", "message": "Merge branch 'develop' into feature/notification/popup-quiz-start"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NTI4Mjgy", "url": "https://github.com/ls1intum/Artemis/pull/2367#pullrequestreview-528528282", "createdAt": "2020-11-11T20:56:40Z", "commit": {"oid": "235c6a5dea40f52b427712d79edc1c84f310b8a5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4adb7ebfd10d81424cf4041a292c6bbf6f896d43", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/4adb7ebfd10d81424cf4041a292c6bbf6f896d43", "committedDate": "2020-11-13T21:30:18Z", "message": "Merge branch 'develop' into feature/notification/popup-quiz-start"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e77c424ebae3de862a928306f10a84352ce41019", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/e77c424ebae3de862a928306f10a84352ce41019", "committedDate": "2020-11-14T20:58:27Z", "message": "Merge branch 'develop' into feature/notification/popup-quiz-start"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28216d6585d7f7ae5517d5bc5416da27c044ab2b", "author": {"user": {"login": "fde312", "name": "Francisco De las Casas Young"}}, "url": "https://github.com/ls1intum/Artemis/commit/28216d6585d7f7ae5517d5bc5416da27c044ab2b", "committedDate": "2020-11-15T23:10:31Z", "message": "Merge branch 'develop' into feature/notification/popup-quiz-start"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "942d6542fab023d56c6dc605c03503552c808239", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/942d6542fab023d56c6dc605c03503552c808239", "committedDate": "2020-11-16T00:18:53Z", "message": "Do not add current user as author of quiz started notification"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ce77e6b9ac9ec498e3fabeb237077cd5d35e416", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/5ce77e6b9ac9ec498e3fabeb237077cd5d35e416", "committedDate": "2020-11-16T00:19:31Z", "message": "Merge remote-tracking branch 'origin/feature/notification/popup-quiz-start' into feature/notification/popup-quiz-start"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxMjY1NDAx", "url": "https://github.com/ls1intum/Artemis/pull/2367#pullrequestreview-531265401", "createdAt": "2020-11-16T12:14:18Z", "commit": {"oid": "5ce77e6b9ac9ec498e3fabeb237077cd5d35e416"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNDMwMjY2", "url": "https://github.com/ls1intum/Artemis/pull/2367#pullrequestreview-532430266", "createdAt": "2020-11-17T14:41:16Z", "commit": {"oid": "5ce77e6b9ac9ec498e3fabeb237077cd5d35e416"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNDo0MToxNlrOH04B8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNDo0Nzo0NFrOH04WXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIwNjAwMQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                describe('Webscoket receive', () => {\n          \n          \n            \n                describe('Websocket receive', () => {", "url": "https://github.com/ls1intum/Artemis/pull/2367#discussion_r525206001", "createdAt": "2020-11-17T14:41:16Z", "author": {"login": "stefanwaldhauser"}, "path": "src/test/javascript/spec/component/shared/notification/notification-popup.component.spec.ts", "diffHunk": "@@ -0,0 +1,135 @@\n+import { ComponentFixture, TestBed, fakeAsync, tick } from '@angular/core/testing';\n+import { By } from '@angular/platform-browser';\n+import { Router } from '@angular/router';\n+import { TranslateService } from '@ngx-translate/core';\n+import { LocalStorageService, SessionStorageService } from 'ngx-webstorage';\n+import { BehaviorSubject } from 'rxjs';\n+import * as chai from 'chai';\n+import * as sinonChai from 'sinon-chai';\n+import * as sinon from 'sinon';\n+import { NotificationPopupComponent } from 'app/shared/notification/notification-popup/notification-popup.component';\n+import { NotificationService } from 'app/shared/notification/notification.service';\n+import { AccountService } from 'app/core/auth/account.service';\n+import { ArtemisTestModule } from '../../../test.module';\n+import { MockSyncStorage } from '../../../helpers/mocks/service/mock-sync-storage.service';\n+import { MockNotificationService } from '../../../helpers/mocks/service/mock-notification.service';\n+import { MockTranslateService } from '../../../helpers/mocks/service/mock-translate.service';\n+import { MockAccountService } from '../../../helpers/mocks/service/mock-account.service';\n+import { Notification } from 'app/entities/notification.model';\n+import { RouterTestingModule } from '@angular/router/testing';\n+\n+chai.use(sinonChai);\n+const expect = chai.expect;\n+\n+describe('Notification Popup Component', () => {\n+    let notificationPopupComponent: NotificationPopupComponent;\n+    let notificationPopupComponentFixture: ComponentFixture<NotificationPopupComponent>;\n+    let notificationService: NotificationService;\n+    let accountService: AccountService;\n+    let router: Router;\n+\n+    const generateNotification = (id: number) => {\n+        const generatedNotification = { id, title: 'Quiz started', text: 'Quiz \"Proxy pattern\" just started.' } as Notification;\n+        generatedNotification.target = JSON.stringify({ mainPage: 'courses', course: 1, entity: 'exercise', id: 1 });\n+        return generatedNotification;\n+    };\n+    const notification = generateNotification(1);\n+\n+    beforeEach(() => {\n+        TestBed.configureTestingModule({\n+            imports: [ArtemisTestModule, RouterTestingModule.withRoutes([])],\n+            declarations: [NotificationPopupComponent],\n+            providers: [\n+                { provide: LocalStorageService, useClass: MockSyncStorage },\n+                { provide: SessionStorageService, useClass: MockSyncStorage },\n+                { provide: NotificationService, useClass: MockNotificationService },\n+                { provide: TranslateService, useClass: MockTranslateService },\n+                { provide: AccountService, useClass: MockAccountService },\n+            ],\n+        })\n+            .compileComponents()\n+            .then(() => {\n+                notificationPopupComponentFixture = TestBed.createComponent(NotificationPopupComponent);\n+                notificationPopupComponent = notificationPopupComponentFixture.componentInstance;\n+                notificationService = TestBed.inject(NotificationService);\n+                accountService = TestBed.inject(AccountService);\n+                router = TestBed.get(Router);\n+            });\n+    });\n+\n+    describe('Initialization', () => {\n+        it('should get authentication state', () => {\n+            sinon.spy(accountService, 'getAuthenticationState');\n+            notificationPopupComponent.ngOnInit();\n+            expect(accountService.getAuthenticationState).to.have.been.calledOnce;\n+        });\n+\n+        it('should subscribe to notification updates', () => {\n+            sinon.spy(notificationService, 'subscribeToNotificationUpdates');\n+            notificationPopupComponent.ngOnInit();\n+            expect(notificationService.subscribeToNotificationUpdates).to.have.been.calledOnce;\n+        });\n+    });\n+\n+    describe('Click', () => {\n+        beforeEach(() => {\n+            notificationPopupComponent.notifications.push(notification);\n+            notificationPopupComponentFixture.detectChanges();\n+        });\n+\n+        it('should remove notification from component state and navigate to target when notification is clicked', () => {\n+            sinon.spy(notificationPopupComponent, 'removeNotification');\n+            sinon.replace(notificationPopupComponent, 'navigateToTarget', sinon.fake());\n+            const notificationElement = notificationPopupComponentFixture.debugElement.query(By.css('.notification-popup-container > div'));\n+            notificationElement.nativeElement.click();\n+            expect(notificationPopupComponent.removeNotification).to.have.been.calledOnce;\n+            expect(notificationPopupComponent.notifications).to.be.empty;\n+            expect(notificationPopupComponent.navigateToTarget).to.have.been.calledOnce;\n+        });\n+\n+        it('should remove notification from component state when notification is closed', () => {\n+            sinon.spy(notificationPopupComponent, 'removeNotification');\n+            sinon.replace(notificationPopupComponent, 'navigateToTarget', sinon.fake());\n+            const button = notificationPopupComponentFixture.debugElement.query(By.css('.notification-popup-container > div button'));\n+            button.nativeElement.click();\n+            expect(notificationPopupComponent.removeNotification).to.have.been.called;\n+            expect(notificationPopupComponent.notifications).to.be.empty;\n+        });\n+\n+        it('should navigate to target when notification is clicked', () => {\n+            sinon.spy(notificationPopupComponent, 'navigateToTarget');\n+            sinon.replace(router, 'navigateByUrl', sinon.fake());\n+            const button = notificationPopupComponentFixture.debugElement.query(By.css('.notification-popup-container > div button'));\n+            button.nativeElement.click();\n+            expect(notificationPopupComponent.navigateToTarget).to.have.been.calledOnce;\n+            expect(router.navigateByUrl).to.have.been.calledOnce;\n+        });\n+    });\n+\n+    describe('Webscoket receive', () => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ce77e6b9ac9ec498e3fabeb237077cd5d35e416"}, "originalPosition": 109}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIwODI1MA==", "bodyText": "I would suggest moving start-now into a shared constant wherever it is used. Can quizChange be an Enum instead of just a string?", "url": "https://github.com/ls1intum/Artemis/pull/2367#discussion_r525208250", "createdAt": "2020-11-17T14:44:11Z", "author": {"login": "stefanwaldhauser"}, "path": "src/main/java/de/tum/in/www1/artemis/service/QuizExerciseService.java", "diffHunk": "@@ -353,6 +357,11 @@ public void sendQuizExerciseToSubscribedClients(QuizExercise quizExercise, Strin\n             byte[] payload = objectMapper.writerWithView(view).writeValueAsBytes(quizExercise);\n             // For each change we send the same message. The client needs to decide how to handle the date based on the quiz status\n             if (quizExercise.isVisibleToStudents() && quizExercise.hasCourse()) {\n+                // Create a group notification if actions is 'start-now'.\n+                if (\"start-now\".equals(quizChange)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ce77e6b9ac9ec498e3fabeb237077cd5d35e416"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIxMTIzMA==", "bodyText": "This seems very brittle. Can this be changed to an enum?", "url": "https://github.com/ls1intum/Artemis/pull/2367#discussion_r525211230", "createdAt": "2020-11-17T14:47:44Z", "author": {"login": "stefanwaldhauser"}, "path": "src/main/webapp/app/shared/notification/notification-popup/notification-popup.component.ts", "diffHunk": "@@ -0,0 +1,106 @@\n+import { Component, OnInit } from '@angular/core';\n+import { Router, UrlTree } from '@angular/router';\n+import { NotificationService } from 'app/shared/notification/notification.service';\n+import { User } from 'app/core/user/user.model';\n+import { AccountService } from 'app/core/auth/account.service';\n+import { Notification } from 'app/entities/notification.model';\n+import { GroupNotification } from 'app/entities/group-notification.model';\n+\n+@Component({\n+    selector: 'jhi-notification-popup',\n+    templateUrl: './notification-popup.component.html',\n+    styleUrls: ['./notification-popup.scss'],\n+})\n+export class NotificationPopupComponent implements OnInit {\n+    notifications: Notification[] = [];\n+\n+    constructor(private accountService: AccountService, private notificationService: NotificationService, private router: Router) {}\n+\n+    /**\n+     * Subscribe to notification updates that are received via websocket if the user is logged in.\n+     */\n+    ngOnInit(): void {\n+        this.accountService.getAuthenticationState().subscribe((user: User | undefined) => {\n+            if (user) {\n+                this.subscribeToNotificationUpdates();\n+            }\n+        });\n+    }\n+\n+    /**\n+     * Returns a string that can be interpreted as fontawesome icon based on the notification type of the given notification.\n+     * @param notification {Notification}\n+     */\n+    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n+    notificationIcon(notification: Notification): string {\n+        return 'check-double';\n+    }\n+\n+    /**\n+     * Removes the notification at the specified index from the notifications array.\n+     * @param index {number}\n+     */\n+    removeNotification(index: number): void {\n+        this.notifications.splice(index, 1);\n+    }\n+\n+    /**\n+     * Navigate to the target (view) of the notification that the user clicked.\n+     * @param notification {Notification}\n+     */\n+    navigateToTarget(notification: Notification): void {\n+        this.router.navigateByUrl(this.notificationTargetRoute(notification));\n+    }\n+\n+    private notificationTargetRoute(notification: Notification): UrlTree | string {\n+        if (notification.target) {\n+            const target = JSON.parse(notification.target);\n+            return this.router.createUrlTree([target.mainPage, target.course, target.entity, target.id]);\n+        }\n+        return this.router.url;\n+    }\n+\n+    private subscribeToNotificationUpdates(): void {\n+        this.notificationService.subscribeToNotificationUpdates().subscribe((notification: Notification) => {\n+            this.addNotification(notification);\n+        });\n+    }\n+\n+    private addNotification(notification: Notification): void {\n+        // Only add a notification if it does not already exist.\n+        if (notification && !this.notifications.some(({ id }) => id === notification.id)) {\n+            // For now only notifications about a started quiz should be displayed.\n+            if (notification.title === 'Quiz started') {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ce77e6b9ac9ec498e3fabeb237077cd5d35e416"}, "originalPosition": 73}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNDQyNzE4", "url": "https://github.com/ls1intum/Artemis/pull/2367#pullrequestreview-532442718", "createdAt": "2020-11-17T14:52:37Z", "commit": {"oid": "5ce77e6b9ac9ec498e3fabeb237077cd5d35e416"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNDY4NzAw", "url": "https://github.com/ls1intum/Artemis/pull/2367#pullrequestreview-532468700", "createdAt": "2020-11-17T15:15:47Z", "commit": {"oid": "5ce77e6b9ac9ec498e3fabeb237077cd5d35e416"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNTIzOTE4", "url": "https://github.com/ls1intum/Artemis/pull/2367#pullrequestreview-532523918", "createdAt": "2020-11-17T16:00:07Z", "commit": {"oid": "5ce77e6b9ac9ec498e3fabeb237077cd5d35e416"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3630, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}