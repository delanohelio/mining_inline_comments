{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5Mjg0ODAz", "number": 2038, "reviewThreads": {"totalCount": 34, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwODoxMTozOFrOEb9Etw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxOTowNDoxN1rOEdWbNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3NzQ3NjM5OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/repository/ProgrammingExerciseStudentParticipationRepository.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwODoxMTozOFrOHGMqLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMzoxMTozOFrOHGXYOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI2MDkxMQ==", "bodyText": "I would add AndAssessor to the method name :-)", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476260911", "createdAt": "2020-08-25T08:11:38Z", "author": {"login": "sascha11110"}, "path": "src/main/java/de/tum/in/www1/artemis/repository/ProgrammingExerciseStudentParticipationRepository.java", "diffHunk": "@@ -24,6 +24,9 @@\n     @Query(\"select p from ProgrammingExerciseStudentParticipation p left join fetch p.results pr left join fetch pr.feedbacks left join fetch pr.submission where p.id = :participationId and (pr.id = (select max(id) from p.results) or pr.id = null)\")\n     Optional<ProgrammingExerciseStudentParticipation> findByIdWithLatestResultAndFeedbacksAndRelatedSubmissions(@Param(\"participationId\") Long participationId);\n \n+    @Query(\"select p from ProgrammingExerciseStudentParticipation p left join fetch p.results pr left join fetch pr.feedbacks left join fetch pr.submission left join fetch pr.assessor where p.id = :participationId\")\n+    Optional<ProgrammingExerciseStudentParticipation> findByIdWithResultsAndFeedbacksAndRelatedSubmissions(@Param(\"participationId\") Long participationId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fda6d499b27a1ab19fa83712c7d99afef8f9899"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQzNjUzNw==", "bodyText": "done. I also renamed the method name in the Service :)", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476436537", "createdAt": "2020-08-25T13:11:38Z", "author": {"login": "fde312"}, "path": "src/main/java/de/tum/in/www1/artemis/repository/ProgrammingExerciseStudentParticipationRepository.java", "diffHunk": "@@ -24,6 +24,9 @@\n     @Query(\"select p from ProgrammingExerciseStudentParticipation p left join fetch p.results pr left join fetch pr.feedbacks left join fetch pr.submission where p.id = :participationId and (pr.id = (select max(id) from p.results) or pr.id = null)\")\n     Optional<ProgrammingExerciseStudentParticipation> findByIdWithLatestResultAndFeedbacksAndRelatedSubmissions(@Param(\"participationId\") Long participationId);\n \n+    @Query(\"select p from ProgrammingExerciseStudentParticipation p left join fetch p.results pr left join fetch pr.feedbacks left join fetch pr.submission left join fetch pr.assessor where p.id = :participationId\")\n+    Optional<ProgrammingExerciseStudentParticipation> findByIdWithResultsAndFeedbacksAndRelatedSubmissions(@Param(\"participationId\") Long participationId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI2MDkxMQ=="}, "originalCommit": {"oid": "5fda6d499b27a1ab19fa83712c7d99afef8f9899"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3NzQ4NzAxOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/ProgrammingAssessmentService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwODoxNDoxMFrOHGMwow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMzoxMjo1MlrOHGXbbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI2MjU2Mw==", "bodyText": "I think you should remove this line?", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476262563", "createdAt": "2020-08-25T08:14:10Z", "author": {"login": "sascha11110"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ProgrammingAssessmentService.java", "diffHunk": "@@ -33,4 +40,55 @@ public Result updateAssessmentAfterComplaint(Result originalResult, Exercise exe\n         originalResult.setScore(assessmentUpdate.getScore());\n         return super.updateAssessmentAfterComplaint(originalResult, exercise, assessmentUpdate);\n     }\n+\n+    /**\n+     * This function is used for saving a manual assessment/result. It sets the assessment type to MANUAL and sets the assessor attribute. Furthermore, it saves the result in the\n+     * database.\n+     *\n+     // * @param submission the modeling submission to which the feedback belongs to", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fda6d499b27a1ab19fa83712c7d99afef8f9899"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQzNzM1OQ==", "bodyText": "jupe :)", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476437359", "createdAt": "2020-08-25T13:12:52Z", "author": {"login": "fde312"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ProgrammingAssessmentService.java", "diffHunk": "@@ -33,4 +40,55 @@ public Result updateAssessmentAfterComplaint(Result originalResult, Exercise exe\n         originalResult.setScore(assessmentUpdate.getScore());\n         return super.updateAssessmentAfterComplaint(originalResult, exercise, assessmentUpdate);\n     }\n+\n+    /**\n+     * This function is used for saving a manual assessment/result. It sets the assessment type to MANUAL and sets the assessor attribute. Furthermore, it saves the result in the\n+     * database.\n+     *\n+     // * @param submission the modeling submission to which the feedback belongs to", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI2MjU2Mw=="}, "originalCommit": {"oid": "5fda6d499b27a1ab19fa83712c7d99afef8f9899"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3NzU1NDE0OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/ProgrammingAssessmentService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwODozMDo0OVrOHGNY7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMzoxNTo1NlrOHGXjaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI3Mjg3OA==", "bodyText": "You should clarify this question in this PR :-)\nI think the reason for setting it explicitly to false is that there is no default value in Result.java and that the database sets it to NULL if a value is missing.", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476272878", "createdAt": "2020-08-25T08:30:49Z", "author": {"login": "sascha11110"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ProgrammingAssessmentService.java", "diffHunk": "@@ -33,4 +40,55 @@ public Result updateAssessmentAfterComplaint(Result originalResult, Exercise exe\n         originalResult.setScore(assessmentUpdate.getScore());\n         return super.updateAssessmentAfterComplaint(originalResult, exercise, assessmentUpdate);\n     }\n+\n+    /**\n+     * This function is used for saving a manual assessment/result. It sets the assessment type to MANUAL and sets the assessor attribute. Furthermore, it saves the result in the\n+     * database.\n+     *\n+     // * @param submission the modeling submission to which the feedback belongs to\n+     * @param result the new result of a programming exercise\n+     * @return result that was saved in the database\n+     */\n+    @Transactional\n+    public Result saveManualAssessment(Result result) {\n+        Boolean isFeedbackEmpty = result.getFeedbacks().isEmpty();\n+        result.setHasFeedback(!isFeedbackEmpty);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+        // TODO: Double check why we set here complaint false\n+        result.setHasComplaint(false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fda6d499b27a1ab19fa83712c7d99afef8f9899"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQzOTQwMQ==", "bodyText": "You are right, I forgot to remove my comment! :)", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476439401", "createdAt": "2020-08-25T13:15:56Z", "author": {"login": "fde312"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ProgrammingAssessmentService.java", "diffHunk": "@@ -33,4 +40,55 @@ public Result updateAssessmentAfterComplaint(Result originalResult, Exercise exe\n         originalResult.setScore(assessmentUpdate.getScore());\n         return super.updateAssessmentAfterComplaint(originalResult, exercise, assessmentUpdate);\n     }\n+\n+    /**\n+     * This function is used for saving a manual assessment/result. It sets the assessment type to MANUAL and sets the assessor attribute. Furthermore, it saves the result in the\n+     * database.\n+     *\n+     // * @param submission the modeling submission to which the feedback belongs to\n+     * @param result the new result of a programming exercise\n+     * @return result that was saved in the database\n+     */\n+    @Transactional\n+    public Result saveManualAssessment(Result result) {\n+        Boolean isFeedbackEmpty = result.getFeedbacks().isEmpty();\n+        result.setHasFeedback(!isFeedbackEmpty);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+        // TODO: Double check why we set here complaint false\n+        result.setHasComplaint(false);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI3Mjg3OA=="}, "originalCommit": {"oid": "5fda6d499b27a1ab19fa83712c7d99afef8f9899"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3NzU4MTk2OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/ProgrammingAssessmentService.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwODozNzozOVrOHGNpUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMzoxODoxMFrOHGXpAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI3NzA3NA==", "bodyText": "Remove this lines?", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476277074", "createdAt": "2020-08-25T08:37:39Z", "author": {"login": "sascha11110"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ProgrammingAssessmentService.java", "diffHunk": "@@ -33,4 +40,55 @@ public Result updateAssessmentAfterComplaint(Result originalResult, Exercise exe\n         originalResult.setScore(assessmentUpdate.getScore());\n         return super.updateAssessmentAfterComplaint(originalResult, exercise, assessmentUpdate);\n     }\n+\n+    /**\n+     * This function is used for saving a manual assessment/result. It sets the assessment type to MANUAL and sets the assessor attribute. Furthermore, it saves the result in the\n+     * database.\n+     *\n+     // * @param submission the modeling submission to which the feedback belongs to\n+     * @param result the new result of a programming exercise\n+     * @return result that was saved in the database\n+     */\n+    @Transactional\n+    public Result saveManualAssessment(Result result) {\n+        Boolean isFeedbackEmpty = result.getFeedbacks().isEmpty();\n+        result.setHasFeedback(!isFeedbackEmpty);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+        // TODO: Double check why we set here complaint false\n+        result.setHasComplaint(false);\n+        result.setAssessmentType(AssessmentType.MANUAL);\n+        result.setAssessor(user);\n+\n+        result.setCompletionDate(null);\n+        result.setRated(false);\n+\n+        result.getFeedbacks().forEach(feedback -> {\n+            feedback.setResult(result);\n+        });\n+\n+        // Note: This also saves the feedback objects in the database because of the 'cascade = CascadeType.ALL' option.\n+        return resultRepository.save(result);\n+    }\n+\n+    /**\n+     * This function is used for submitting a manual assessment/result. It gets the result that belongs to the given resultId, updates the completion date, sets the assessment type\n+     * to MANUAL and sets the assessor attribute. Afterwards, it saves the update result in the database again.\n+     *\n+     * @param resultId the id of the result that should be submitted\n+     * @return the ResponseEntity with result as body\n+     */\n+    @Transactional\n+    public Result submitManualAssessment(long resultId) {\n+        Result result = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(resultId)\n+                .orElseThrow(() -> new EntityNotFoundException(\"No result for the given resultId could be found\"));\n+        // Every manual assessed programming submission is rated\n+        result.setRated(true);\n+        result.setCompletionDate(ZonedDateTime.now());\n+\n+        // Double calculatedScore = calculateTotalScore(result.getFeedbacks());\n+        // return submitResult(result, exercise, calculatedScore);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fda6d499b27a1ab19fa83712c7d99afef8f9899"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ0MDYwOQ==", "bodyText": "We will keep that, as we want to use this later on when we established to give points for manual results (similar to text and modeling) :)", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476440609", "createdAt": "2020-08-25T13:17:48Z", "author": {"login": "fde312"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ProgrammingAssessmentService.java", "diffHunk": "@@ -33,4 +40,55 @@ public Result updateAssessmentAfterComplaint(Result originalResult, Exercise exe\n         originalResult.setScore(assessmentUpdate.getScore());\n         return super.updateAssessmentAfterComplaint(originalResult, exercise, assessmentUpdate);\n     }\n+\n+    /**\n+     * This function is used for saving a manual assessment/result. It sets the assessment type to MANUAL and sets the assessor attribute. Furthermore, it saves the result in the\n+     * database.\n+     *\n+     // * @param submission the modeling submission to which the feedback belongs to\n+     * @param result the new result of a programming exercise\n+     * @return result that was saved in the database\n+     */\n+    @Transactional\n+    public Result saveManualAssessment(Result result) {\n+        Boolean isFeedbackEmpty = result.getFeedbacks().isEmpty();\n+        result.setHasFeedback(!isFeedbackEmpty);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+        // TODO: Double check why we set here complaint false\n+        result.setHasComplaint(false);\n+        result.setAssessmentType(AssessmentType.MANUAL);\n+        result.setAssessor(user);\n+\n+        result.setCompletionDate(null);\n+        result.setRated(false);\n+\n+        result.getFeedbacks().forEach(feedback -> {\n+            feedback.setResult(result);\n+        });\n+\n+        // Note: This also saves the feedback objects in the database because of the 'cascade = CascadeType.ALL' option.\n+        return resultRepository.save(result);\n+    }\n+\n+    /**\n+     * This function is used for submitting a manual assessment/result. It gets the result that belongs to the given resultId, updates the completion date, sets the assessment type\n+     * to MANUAL and sets the assessor attribute. Afterwards, it saves the update result in the database again.\n+     *\n+     * @param resultId the id of the result that should be submitted\n+     * @return the ResponseEntity with result as body\n+     */\n+    @Transactional\n+    public Result submitManualAssessment(long resultId) {\n+        Result result = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(resultId)\n+                .orElseThrow(() -> new EntityNotFoundException(\"No result for the given resultId could be found\"));\n+        // Every manual assessed programming submission is rated\n+        result.setRated(true);\n+        result.setCompletionDate(ZonedDateTime.now());\n+\n+        // Double calculatedScore = calculateTotalScore(result.getFeedbacks());\n+        // return submitResult(result, exercise, calculatedScore);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI3NzA3NA=="}, "originalCommit": {"oid": "5fda6d499b27a1ab19fa83712c7d99afef8f9899"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ0MDgzNQ==", "bodyText": "I added a todo for this, so this is more clear why its commented out for the moment", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476440835", "createdAt": "2020-08-25T13:18:10Z", "author": {"login": "fde312"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ProgrammingAssessmentService.java", "diffHunk": "@@ -33,4 +40,55 @@ public Result updateAssessmentAfterComplaint(Result originalResult, Exercise exe\n         originalResult.setScore(assessmentUpdate.getScore());\n         return super.updateAssessmentAfterComplaint(originalResult, exercise, assessmentUpdate);\n     }\n+\n+    /**\n+     * This function is used for saving a manual assessment/result. It sets the assessment type to MANUAL and sets the assessor attribute. Furthermore, it saves the result in the\n+     * database.\n+     *\n+     // * @param submission the modeling submission to which the feedback belongs to\n+     * @param result the new result of a programming exercise\n+     * @return result that was saved in the database\n+     */\n+    @Transactional\n+    public Result saveManualAssessment(Result result) {\n+        Boolean isFeedbackEmpty = result.getFeedbacks().isEmpty();\n+        result.setHasFeedback(!isFeedbackEmpty);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+        // TODO: Double check why we set here complaint false\n+        result.setHasComplaint(false);\n+        result.setAssessmentType(AssessmentType.MANUAL);\n+        result.setAssessor(user);\n+\n+        result.setCompletionDate(null);\n+        result.setRated(false);\n+\n+        result.getFeedbacks().forEach(feedback -> {\n+            feedback.setResult(result);\n+        });\n+\n+        // Note: This also saves the feedback objects in the database because of the 'cascade = CascadeType.ALL' option.\n+        return resultRepository.save(result);\n+    }\n+\n+    /**\n+     * This function is used for submitting a manual assessment/result. It gets the result that belongs to the given resultId, updates the completion date, sets the assessment type\n+     * to MANUAL and sets the assessor attribute. Afterwards, it saves the update result in the database again.\n+     *\n+     * @param resultId the id of the result that should be submitted\n+     * @return the ResponseEntity with result as body\n+     */\n+    @Transactional\n+    public Result submitManualAssessment(long resultId) {\n+        Result result = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(resultId)\n+                .orElseThrow(() -> new EntityNotFoundException(\"No result for the given resultId could be found\"));\n+        // Every manual assessed programming submission is rated\n+        result.setRated(true);\n+        result.setCompletionDate(ZonedDateTime.now());\n+\n+        // Double calculatedScore = calculateTotalScore(result.getFeedbacks());\n+        // return submitResult(result, exercise, calculatedScore);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI3NzA3NA=="}, "originalCommit": {"oid": "5fda6d499b27a1ab19fa83712c7d99afef8f9899"}, "originalPosition": 79}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3NzYxMDE2OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwODo0NDoyNlrOHGN6Xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMzoxOToxMlrOHGXrpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI4MTQzOA==", "bodyText": "Clarify this in this PR :-)", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476281438", "createdAt": "2020-08-25T08:44:26Z", "author": {"login": "sascha11110"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,114 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,\n+            @RequestBody Result newResult) {\n+        log.debug(\"REST request to save a new result : {}\", newResult);\n+        final var participation = participationService.findOneWithEagerResultsAndCourse(participationId);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+\n+        Optional<Result> latestExistingResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.MANUAL).findFirst();\n+        if (latestExistingResult.isPresent()) {\n+            // prevent that tutors create multiple manual results\n+            // TODO: Double check if this is the right way to do, or if we should create a new Manual Result", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fda6d499b27a1ab19fa83712c7d99afef8f9899"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ0MTUxMQ==", "bodyText": "Removed the comment! :)", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476441511", "createdAt": "2020-08-25T13:19:12Z", "author": {"login": "fde312"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,114 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,\n+            @RequestBody Result newResult) {\n+        log.debug(\"REST request to save a new result : {}\", newResult);\n+        final var participation = participationService.findOneWithEagerResultsAndCourse(participationId);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+\n+        Optional<Result> latestExistingResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.MANUAL).findFirst();\n+        if (latestExistingResult.isPresent()) {\n+            // prevent that tutors create multiple manual results\n+            // TODO: Double check if this is the right way to do, or if we should create a new Manual Result", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI4MTQzOA=="}, "originalCommit": {"oid": "5fda6d499b27a1ab19fa83712c7d99afef8f9899"}, "originalPosition": 86}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3NzYzOTMzOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwODo1MToyNVrOHGOMPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNzo0NDoyNVrOHGjF0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI4NjAxMg==", "bodyText": "I think the first check is already done in checkAuthorization()", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476286012", "createdAt": "2020-08-25T08:51:25Z", "author": {"login": "sascha11110"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,114 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,\n+            @RequestBody Result newResult) {\n+        log.debug(\"REST request to save a new result : {}\", newResult);\n+        final var participation = participationService.findOneWithEagerResultsAndCourse(participationId);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+\n+        Optional<Result> latestExistingResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.MANUAL).findFirst();\n+        if (latestExistingResult.isPresent()) {\n+            // prevent that tutors create multiple manual results\n+            // TODO: Double check if this is the right way to do, or if we should create a new Manual Result\n+            newResult.setId(latestExistingResult.get().getId());\n+            // load assessor\n+            latestExistingResult = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(latestExistingResult.get().getId());\n+        }\n+\n+        // make sure that the participation cannot be manipulated on the client side\n+        newResult.setParticipation(participation);\n+\n+        ProgrammingExercise exercise = (ProgrammingExercise) participation.getExercise();\n+        checkAuthorization(exercise, user);\n+\n+        final var isAtLeastInstructor = authCheckService.isAtLeastInstructorForExercise(exercise, user);\n+        if (!assessmentService.isAllowedToCreateOrOverrideResult(latestExistingResult.orElse(null), exercise, participation, user, isAtLeastInstructor)) {\n+            log.debug(\"The user \" + user.getLogin() + \" is not allowed to override the assessment for the participation \" + participation.getId() + \" for User \" + user.getLogin());\n+            return forbidden(\"assessment\", \"assessmentSaveNotAllowed\", \"The user is not allowed to override the assessment\");\n+        }\n+\n+        final var course = exercise.getCourseViaExerciseGroupOrCourseMember();\n+        if (!authCheckService.isAtLeastTeachingAssistantInCourse(course, user) || !exercise.areManualResultsAllowed()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fda6d499b27a1ab19fa83712c7d99afef8f9899"}, "originalPosition": 105}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYyODQzNA==", "bodyText": "Good catch! Fixed in  9a64c0d", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476628434", "createdAt": "2020-08-25T17:44:25Z", "author": {"login": "fde312"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,114 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,\n+            @RequestBody Result newResult) {\n+        log.debug(\"REST request to save a new result : {}\", newResult);\n+        final var participation = participationService.findOneWithEagerResultsAndCourse(participationId);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+\n+        Optional<Result> latestExistingResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.MANUAL).findFirst();\n+        if (latestExistingResult.isPresent()) {\n+            // prevent that tutors create multiple manual results\n+            // TODO: Double check if this is the right way to do, or if we should create a new Manual Result\n+            newResult.setId(latestExistingResult.get().getId());\n+            // load assessor\n+            latestExistingResult = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(latestExistingResult.get().getId());\n+        }\n+\n+        // make sure that the participation cannot be manipulated on the client side\n+        newResult.setParticipation(participation);\n+\n+        ProgrammingExercise exercise = (ProgrammingExercise) participation.getExercise();\n+        checkAuthorization(exercise, user);\n+\n+        final var isAtLeastInstructor = authCheckService.isAtLeastInstructorForExercise(exercise, user);\n+        if (!assessmentService.isAllowedToCreateOrOverrideResult(latestExistingResult.orElse(null), exercise, participation, user, isAtLeastInstructor)) {\n+            log.debug(\"The user \" + user.getLogin() + \" is not allowed to override the assessment for the participation \" + participation.getId() + \" for User \" + user.getLogin());\n+            return forbidden(\"assessment\", \"assessmentSaveNotAllowed\", \"The user is not allowed to override the assessment\");\n+        }\n+\n+        final var course = exercise.getCourseViaExerciseGroupOrCourseMember();\n+        if (!authCheckService.isAtLeastTeachingAssistantInCourse(course, user) || !exercise.areManualResultsAllowed()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI4NjAxMg=="}, "originalCommit": {"oid": "5fda6d499b27a1ab19fa83712c7d99afef8f9899"}, "originalPosition": 105}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3NzY0NjQ4OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwODo1MzoxNlrOHGOQwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNzozNzo1OVrOHGi3ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI4NzE2OQ==", "bodyText": "Same as above :-)", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476287169", "createdAt": "2020-08-25T08:53:16Z", "author": {"login": "sascha11110"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,114 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,\n+            @RequestBody Result newResult) {\n+        log.debug(\"REST request to save a new result : {}\", newResult);\n+        final var participation = participationService.findOneWithEagerResultsAndCourse(participationId);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+\n+        Optional<Result> latestExistingResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.MANUAL).findFirst();\n+        if (latestExistingResult.isPresent()) {\n+            // prevent that tutors create multiple manual results\n+            // TODO: Double check if this is the right way to do, or if we should create a new Manual Result\n+            newResult.setId(latestExistingResult.get().getId());\n+            // load assessor\n+            latestExistingResult = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(latestExistingResult.get().getId());\n+        }\n+\n+        // make sure that the participation cannot be manipulated on the client side\n+        newResult.setParticipation(participation);\n+\n+        ProgrammingExercise exercise = (ProgrammingExercise) participation.getExercise();\n+        checkAuthorization(exercise, user);\n+\n+        final var isAtLeastInstructor = authCheckService.isAtLeastInstructorForExercise(exercise, user);\n+        if (!assessmentService.isAllowedToCreateOrOverrideResult(latestExistingResult.orElse(null), exercise, participation, user, isAtLeastInstructor)) {\n+            log.debug(\"The user \" + user.getLogin() + \" is not allowed to override the assessment for the participation \" + participation.getId() + \" for User \" + user.getLogin());\n+            return forbidden(\"assessment\", \"assessmentSaveNotAllowed\", \"The user is not allowed to override the assessment\");\n+        }\n+\n+        final var course = exercise.getCourseViaExerciseGroupOrCourseMember();\n+        if (!authCheckService.isAtLeastTeachingAssistantInCourse(course, user) || !exercise.areManualResultsAllowed()) {\n+            return forbidden();\n+        }\n+\n+        if (newResult.getResultString() == null) {\n+            throw new BadRequestAlertException(\"Result string is required.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getResultString().length() > 255) {\n+            throw new BadRequestAlertException(\"Result string is too long.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getScore() == null) {\n+            throw new BadRequestAlertException(\"Score is required.\", ENTITY_NAME, \"scoreNull\");\n+        }\n+        else if (newResult.getScore() < 100 && newResult.isSuccessful()) {\n+            throw new BadRequestAlertException(\"Only result with score 100% can be successful.\", ENTITY_NAME, \"scoreAndSuccessfulNotMatching\");\n+        }\n+        else if (!newResult.getFeedbacks().isEmpty() && newResult.getFeedbacks().stream().anyMatch(feedback -> feedback.getText() == null)) {\n+            throw new BadRequestAlertException(\"In case feedback is present, feedback text and detail text are mandatory.\", ENTITY_NAME, \"feedbackTextOrDetailTextNull\");\n+        }\n+\n+        ProgrammingSubmission submission;\n+        if (latestExistingResult.isEmpty()) {\n+            // TODO: Double check if we can create a new result when the existing result has already a completion date (submitted)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fda6d499b27a1ab19fa83712c7d99afef8f9899"}, "originalPosition": 127}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYyNDc5OA==", "bodyText": "Done :)", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476624798", "createdAt": "2020-08-25T17:37:59Z", "author": {"login": "fde312"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,114 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,\n+            @RequestBody Result newResult) {\n+        log.debug(\"REST request to save a new result : {}\", newResult);\n+        final var participation = participationService.findOneWithEagerResultsAndCourse(participationId);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+\n+        Optional<Result> latestExistingResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.MANUAL).findFirst();\n+        if (latestExistingResult.isPresent()) {\n+            // prevent that tutors create multiple manual results\n+            // TODO: Double check if this is the right way to do, or if we should create a new Manual Result\n+            newResult.setId(latestExistingResult.get().getId());\n+            // load assessor\n+            latestExistingResult = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(latestExistingResult.get().getId());\n+        }\n+\n+        // make sure that the participation cannot be manipulated on the client side\n+        newResult.setParticipation(participation);\n+\n+        ProgrammingExercise exercise = (ProgrammingExercise) participation.getExercise();\n+        checkAuthorization(exercise, user);\n+\n+        final var isAtLeastInstructor = authCheckService.isAtLeastInstructorForExercise(exercise, user);\n+        if (!assessmentService.isAllowedToCreateOrOverrideResult(latestExistingResult.orElse(null), exercise, participation, user, isAtLeastInstructor)) {\n+            log.debug(\"The user \" + user.getLogin() + \" is not allowed to override the assessment for the participation \" + participation.getId() + \" for User \" + user.getLogin());\n+            return forbidden(\"assessment\", \"assessmentSaveNotAllowed\", \"The user is not allowed to override the assessment\");\n+        }\n+\n+        final var course = exercise.getCourseViaExerciseGroupOrCourseMember();\n+        if (!authCheckService.isAtLeastTeachingAssistantInCourse(course, user) || !exercise.areManualResultsAllowed()) {\n+            return forbidden();\n+        }\n+\n+        if (newResult.getResultString() == null) {\n+            throw new BadRequestAlertException(\"Result string is required.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getResultString().length() > 255) {\n+            throw new BadRequestAlertException(\"Result string is too long.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getScore() == null) {\n+            throw new BadRequestAlertException(\"Score is required.\", ENTITY_NAME, \"scoreNull\");\n+        }\n+        else if (newResult.getScore() < 100 && newResult.isSuccessful()) {\n+            throw new BadRequestAlertException(\"Only result with score 100% can be successful.\", ENTITY_NAME, \"scoreAndSuccessfulNotMatching\");\n+        }\n+        else if (!newResult.getFeedbacks().isEmpty() && newResult.getFeedbacks().stream().anyMatch(feedback -> feedback.getText() == null)) {\n+            throw new BadRequestAlertException(\"In case feedback is present, feedback text and detail text are mandatory.\", ENTITY_NAME, \"feedbackTextOrDetailTextNull\");\n+        }\n+\n+        ProgrammingSubmission submission;\n+        if (latestExistingResult.isEmpty()) {\n+            // TODO: Double check if we can create a new result when the existing result has already a completion date (submitted)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI4NzE2OQ=="}, "originalCommit": {"oid": "5fda6d499b27a1ab19fa83712c7d99afef8f9899"}, "originalPosition": 127}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3NzY1MzUwOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwODo1NDo1M1rOHGOU8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwODo1NDo1M1rOHGOU8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI4ODI0MA==", "bodyText": "Remove this line :-)", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476288240", "createdAt": "2020-08-25T08:54:53Z", "author": {"login": "sascha11110"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,114 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,\n+            @RequestBody Result newResult) {\n+        log.debug(\"REST request to save a new result : {}\", newResult);\n+        final var participation = participationService.findOneWithEagerResultsAndCourse(participationId);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+\n+        Optional<Result> latestExistingResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.MANUAL).findFirst();\n+        if (latestExistingResult.isPresent()) {\n+            // prevent that tutors create multiple manual results\n+            // TODO: Double check if this is the right way to do, or if we should create a new Manual Result\n+            newResult.setId(latestExistingResult.get().getId());\n+            // load assessor\n+            latestExistingResult = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(latestExistingResult.get().getId());\n+        }\n+\n+        // make sure that the participation cannot be manipulated on the client side\n+        newResult.setParticipation(participation);\n+\n+        ProgrammingExercise exercise = (ProgrammingExercise) participation.getExercise();\n+        checkAuthorization(exercise, user);\n+\n+        final var isAtLeastInstructor = authCheckService.isAtLeastInstructorForExercise(exercise, user);\n+        if (!assessmentService.isAllowedToCreateOrOverrideResult(latestExistingResult.orElse(null), exercise, participation, user, isAtLeastInstructor)) {\n+            log.debug(\"The user \" + user.getLogin() + \" is not allowed to override the assessment for the participation \" + participation.getId() + \" for User \" + user.getLogin());\n+            return forbidden(\"assessment\", \"assessmentSaveNotAllowed\", \"The user is not allowed to override the assessment\");\n+        }\n+\n+        final var course = exercise.getCourseViaExerciseGroupOrCourseMember();\n+        if (!authCheckService.isAtLeastTeachingAssistantInCourse(course, user) || !exercise.areManualResultsAllowed()) {\n+            return forbidden();\n+        }\n+\n+        if (newResult.getResultString() == null) {\n+            throw new BadRequestAlertException(\"Result string is required.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getResultString().length() > 255) {\n+            throw new BadRequestAlertException(\"Result string is too long.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getScore() == null) {\n+            throw new BadRequestAlertException(\"Score is required.\", ENTITY_NAME, \"scoreNull\");\n+        }\n+        else if (newResult.getScore() < 100 && newResult.isSuccessful()) {\n+            throw new BadRequestAlertException(\"Only result with score 100% can be successful.\", ENTITY_NAME, \"scoreAndSuccessfulNotMatching\");\n+        }\n+        else if (!newResult.getFeedbacks().isEmpty() && newResult.getFeedbacks().stream().anyMatch(feedback -> feedback.getText() == null)) {\n+            throw new BadRequestAlertException(\"In case feedback is present, feedback text and detail text are mandatory.\", ENTITY_NAME, \"feedbackTextOrDetailTextNull\");\n+        }\n+\n+        ProgrammingSubmission submission;\n+        if (latestExistingResult.isEmpty()) {\n+            // TODO: Double check if we can create a new result when the existing result has already a completion date (submitted)\n+            // Create manual submission with last commit hash und current time stamp.\n+            submission = programmingSubmissionService.createSubmissionWithLastCommitHashForParticipation((ProgrammingExerciseStudentParticipation) participation,\n+                    SubmissionType.MANUAL);\n+            newResult.setSubmission(submission);\n+        }\n+        else {\n+            submission = programmingSubmissionService.findByIdWithEagerResultAndFeedback(latestExistingResult.get().getSubmission().getId());\n+            newResult.setSubmission(submission);\n+            if (newResult.getSubmission() == null) {\n+                throw new BadRequestAlertException(\"The submission is not connected to the result.\", ENTITY_NAME, \"submissionMissing\");\n+            }\n+        }\n+\n+        Result result = programmingAssessmentService.saveManualAssessment(newResult);\n+\n+        if (submit) {\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fda6d499b27a1ab19fa83712c7d99afef8f9899"}, "originalPosition": 144}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3NzY2NTA5OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwODo1NzozOVrOHGOcCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNzo0NDozNFrOHGjGIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI5MDA1Nw==", "bodyText": "I know we have many places in the code where we set the participant manually to null but there is a method for that in StudentParticipation.java: filterSensitiveInformation()", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476290057", "createdAt": "2020-08-25T08:57:39Z", "author": {"login": "sascha11110"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,114 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,\n+            @RequestBody Result newResult) {\n+        log.debug(\"REST request to save a new result : {}\", newResult);\n+        final var participation = participationService.findOneWithEagerResultsAndCourse(participationId);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+\n+        Optional<Result> latestExistingResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.MANUAL).findFirst();\n+        if (latestExistingResult.isPresent()) {\n+            // prevent that tutors create multiple manual results\n+            // TODO: Double check if this is the right way to do, or if we should create a new Manual Result\n+            newResult.setId(latestExistingResult.get().getId());\n+            // load assessor\n+            latestExistingResult = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(latestExistingResult.get().getId());\n+        }\n+\n+        // make sure that the participation cannot be manipulated on the client side\n+        newResult.setParticipation(participation);\n+\n+        ProgrammingExercise exercise = (ProgrammingExercise) participation.getExercise();\n+        checkAuthorization(exercise, user);\n+\n+        final var isAtLeastInstructor = authCheckService.isAtLeastInstructorForExercise(exercise, user);\n+        if (!assessmentService.isAllowedToCreateOrOverrideResult(latestExistingResult.orElse(null), exercise, participation, user, isAtLeastInstructor)) {\n+            log.debug(\"The user \" + user.getLogin() + \" is not allowed to override the assessment for the participation \" + participation.getId() + \" for User \" + user.getLogin());\n+            return forbidden(\"assessment\", \"assessmentSaveNotAllowed\", \"The user is not allowed to override the assessment\");\n+        }\n+\n+        final var course = exercise.getCourseViaExerciseGroupOrCourseMember();\n+        if (!authCheckService.isAtLeastTeachingAssistantInCourse(course, user) || !exercise.areManualResultsAllowed()) {\n+            return forbidden();\n+        }\n+\n+        if (newResult.getResultString() == null) {\n+            throw new BadRequestAlertException(\"Result string is required.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getResultString().length() > 255) {\n+            throw new BadRequestAlertException(\"Result string is too long.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getScore() == null) {\n+            throw new BadRequestAlertException(\"Score is required.\", ENTITY_NAME, \"scoreNull\");\n+        }\n+        else if (newResult.getScore() < 100 && newResult.isSuccessful()) {\n+            throw new BadRequestAlertException(\"Only result with score 100% can be successful.\", ENTITY_NAME, \"scoreAndSuccessfulNotMatching\");\n+        }\n+        else if (!newResult.getFeedbacks().isEmpty() && newResult.getFeedbacks().stream().anyMatch(feedback -> feedback.getText() == null)) {\n+            throw new BadRequestAlertException(\"In case feedback is present, feedback text and detail text are mandatory.\", ENTITY_NAME, \"feedbackTextOrDetailTextNull\");\n+        }\n+\n+        ProgrammingSubmission submission;\n+        if (latestExistingResult.isEmpty()) {\n+            // TODO: Double check if we can create a new result when the existing result has already a completion date (submitted)\n+            // Create manual submission with last commit hash und current time stamp.\n+            submission = programmingSubmissionService.createSubmissionWithLastCommitHashForParticipation((ProgrammingExerciseStudentParticipation) participation,\n+                    SubmissionType.MANUAL);\n+            newResult.setSubmission(submission);\n+        }\n+        else {\n+            submission = programmingSubmissionService.findByIdWithEagerResultAndFeedback(latestExistingResult.get().getSubmission().getId());\n+            newResult.setSubmission(submission);\n+            if (newResult.getSubmission() == null) {\n+                throw new BadRequestAlertException(\"The submission is not connected to the result.\", ENTITY_NAME, \"submissionMissing\");\n+            }\n+        }\n+\n+        Result result = programmingAssessmentService.saveManualAssessment(newResult);\n+\n+        if (submit) {\n+\n+            result = programmingAssessmentService.submitManualAssessment(result.getId());\n+        }\n+        // remove information about the student for tutors to ensure double-blind assessment\n+        if (!isAtLeastInstructor) {\n+            ((StudentParticipation) result.getParticipation()).setParticipant(null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fda6d499b27a1ab19fa83712c7d99afef8f9899"}, "originalPosition": 149}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYyODUxNA==", "bodyText": "Thank you! I did not know that! Fixed in 9a64c0d", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476628514", "createdAt": "2020-08-25T17:44:34Z", "author": {"login": "fde312"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,114 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,\n+            @RequestBody Result newResult) {\n+        log.debug(\"REST request to save a new result : {}\", newResult);\n+        final var participation = participationService.findOneWithEagerResultsAndCourse(participationId);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+\n+        Optional<Result> latestExistingResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.MANUAL).findFirst();\n+        if (latestExistingResult.isPresent()) {\n+            // prevent that tutors create multiple manual results\n+            // TODO: Double check if this is the right way to do, or if we should create a new Manual Result\n+            newResult.setId(latestExistingResult.get().getId());\n+            // load assessor\n+            latestExistingResult = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(latestExistingResult.get().getId());\n+        }\n+\n+        // make sure that the participation cannot be manipulated on the client side\n+        newResult.setParticipation(participation);\n+\n+        ProgrammingExercise exercise = (ProgrammingExercise) participation.getExercise();\n+        checkAuthorization(exercise, user);\n+\n+        final var isAtLeastInstructor = authCheckService.isAtLeastInstructorForExercise(exercise, user);\n+        if (!assessmentService.isAllowedToCreateOrOverrideResult(latestExistingResult.orElse(null), exercise, participation, user, isAtLeastInstructor)) {\n+            log.debug(\"The user \" + user.getLogin() + \" is not allowed to override the assessment for the participation \" + participation.getId() + \" for User \" + user.getLogin());\n+            return forbidden(\"assessment\", \"assessmentSaveNotAllowed\", \"The user is not allowed to override the assessment\");\n+        }\n+\n+        final var course = exercise.getCourseViaExerciseGroupOrCourseMember();\n+        if (!authCheckService.isAtLeastTeachingAssistantInCourse(course, user) || !exercise.areManualResultsAllowed()) {\n+            return forbidden();\n+        }\n+\n+        if (newResult.getResultString() == null) {\n+            throw new BadRequestAlertException(\"Result string is required.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getResultString().length() > 255) {\n+            throw new BadRequestAlertException(\"Result string is too long.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getScore() == null) {\n+            throw new BadRequestAlertException(\"Score is required.\", ENTITY_NAME, \"scoreNull\");\n+        }\n+        else if (newResult.getScore() < 100 && newResult.isSuccessful()) {\n+            throw new BadRequestAlertException(\"Only result with score 100% can be successful.\", ENTITY_NAME, \"scoreAndSuccessfulNotMatching\");\n+        }\n+        else if (!newResult.getFeedbacks().isEmpty() && newResult.getFeedbacks().stream().anyMatch(feedback -> feedback.getText() == null)) {\n+            throw new BadRequestAlertException(\"In case feedback is present, feedback text and detail text are mandatory.\", ENTITY_NAME, \"feedbackTextOrDetailTextNull\");\n+        }\n+\n+        ProgrammingSubmission submission;\n+        if (latestExistingResult.isEmpty()) {\n+            // TODO: Double check if we can create a new result when the existing result has already a completion date (submitted)\n+            // Create manual submission with last commit hash und current time stamp.\n+            submission = programmingSubmissionService.createSubmissionWithLastCommitHashForParticipation((ProgrammingExerciseStudentParticipation) participation,\n+                    SubmissionType.MANUAL);\n+            newResult.setSubmission(submission);\n+        }\n+        else {\n+            submission = programmingSubmissionService.findByIdWithEagerResultAndFeedback(latestExistingResult.get().getSubmission().getId());\n+            newResult.setSubmission(submission);\n+            if (newResult.getSubmission() == null) {\n+                throw new BadRequestAlertException(\"The submission is not connected to the result.\", ENTITY_NAME, \"submissionMissing\");\n+            }\n+        }\n+\n+        Result result = programmingAssessmentService.saveManualAssessment(newResult);\n+\n+        if (submit) {\n+\n+            result = programmingAssessmentService.submitManualAssessment(result.getId());\n+        }\n+        // remove information about the student for tutors to ensure double-blind assessment\n+        if (!isAtLeastInstructor) {\n+            ((StudentParticipation) result.getParticipation()).setParticipant(null);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI5MDA1Nw=="}, "originalCommit": {"oid": "5fda6d499b27a1ab19fa83712c7d99afef8f9899"}, "originalPosition": 149}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3NzY3MTYzOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwODo1OToxMVrOHGOgJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNzo0NDo0OVrOHGjGsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI5MTEwOA==", "bodyText": "Same as above :-)\nI don't think so as we in some places remove the assessor explicitly via filterSensitiveInformation() in Result.java", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476291108", "createdAt": "2020-08-25T08:59:11Z", "author": {"login": "sascha11110"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,114 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,\n+            @RequestBody Result newResult) {\n+        log.debug(\"REST request to save a new result : {}\", newResult);\n+        final var participation = participationService.findOneWithEagerResultsAndCourse(participationId);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+\n+        Optional<Result> latestExistingResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.MANUAL).findFirst();\n+        if (latestExistingResult.isPresent()) {\n+            // prevent that tutors create multiple manual results\n+            // TODO: Double check if this is the right way to do, or if we should create a new Manual Result\n+            newResult.setId(latestExistingResult.get().getId());\n+            // load assessor\n+            latestExistingResult = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(latestExistingResult.get().getId());\n+        }\n+\n+        // make sure that the participation cannot be manipulated on the client side\n+        newResult.setParticipation(participation);\n+\n+        ProgrammingExercise exercise = (ProgrammingExercise) participation.getExercise();\n+        checkAuthorization(exercise, user);\n+\n+        final var isAtLeastInstructor = authCheckService.isAtLeastInstructorForExercise(exercise, user);\n+        if (!assessmentService.isAllowedToCreateOrOverrideResult(latestExistingResult.orElse(null), exercise, participation, user, isAtLeastInstructor)) {\n+            log.debug(\"The user \" + user.getLogin() + \" is not allowed to override the assessment for the participation \" + participation.getId() + \" for User \" + user.getLogin());\n+            return forbidden(\"assessment\", \"assessmentSaveNotAllowed\", \"The user is not allowed to override the assessment\");\n+        }\n+\n+        final var course = exercise.getCourseViaExerciseGroupOrCourseMember();\n+        if (!authCheckService.isAtLeastTeachingAssistantInCourse(course, user) || !exercise.areManualResultsAllowed()) {\n+            return forbidden();\n+        }\n+\n+        if (newResult.getResultString() == null) {\n+            throw new BadRequestAlertException(\"Result string is required.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getResultString().length() > 255) {\n+            throw new BadRequestAlertException(\"Result string is too long.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getScore() == null) {\n+            throw new BadRequestAlertException(\"Score is required.\", ENTITY_NAME, \"scoreNull\");\n+        }\n+        else if (newResult.getScore() < 100 && newResult.isSuccessful()) {\n+            throw new BadRequestAlertException(\"Only result with score 100% can be successful.\", ENTITY_NAME, \"scoreAndSuccessfulNotMatching\");\n+        }\n+        else if (!newResult.getFeedbacks().isEmpty() && newResult.getFeedbacks().stream().anyMatch(feedback -> feedback.getText() == null)) {\n+            throw new BadRequestAlertException(\"In case feedback is present, feedback text and detail text are mandatory.\", ENTITY_NAME, \"feedbackTextOrDetailTextNull\");\n+        }\n+\n+        ProgrammingSubmission submission;\n+        if (latestExistingResult.isEmpty()) {\n+            // TODO: Double check if we can create a new result when the existing result has already a completion date (submitted)\n+            // Create manual submission with last commit hash und current time stamp.\n+            submission = programmingSubmissionService.createSubmissionWithLastCommitHashForParticipation((ProgrammingExerciseStudentParticipation) participation,\n+                    SubmissionType.MANUAL);\n+            newResult.setSubmission(submission);\n+        }\n+        else {\n+            submission = programmingSubmissionService.findByIdWithEagerResultAndFeedback(latestExistingResult.get().getSubmission().getId());\n+            newResult.setSubmission(submission);\n+            if (newResult.getSubmission() == null) {\n+                throw new BadRequestAlertException(\"The submission is not connected to the result.\", ENTITY_NAME, \"submissionMissing\");\n+            }\n+        }\n+\n+        Result result = programmingAssessmentService.saveManualAssessment(newResult);\n+\n+        if (submit) {\n+\n+            result = programmingAssessmentService.submitManualAssessment(result.getId());\n+        }\n+        // remove information about the student for tutors to ensure double-blind assessment\n+        if (!isAtLeastInstructor) {\n+            ((StudentParticipation) result.getParticipation()).setParticipant(null);\n+        }\n+        if (submit && ((result.getParticipation()).getExercise().getAssessmentDueDate() == null\n+                || result.getParticipation().getExercise().getAssessmentDueDate().isBefore(ZonedDateTime.now()))) {\n+            ltiService.onNewResult((ProgrammingExerciseStudentParticipation) result.getParticipation());\n+            // TODO: Is it intended that the result with information about the assessor is broadcasted (this is also for other exercises type the case)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fda6d499b27a1ab19fa83712c7d99afef8f9899"}, "originalPosition": 154}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYyODY1OQ==", "bodyText": "Done :)", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476628659", "createdAt": "2020-08-25T17:44:49Z", "author": {"login": "fde312"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,114 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,\n+            @RequestBody Result newResult) {\n+        log.debug(\"REST request to save a new result : {}\", newResult);\n+        final var participation = participationService.findOneWithEagerResultsAndCourse(participationId);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+\n+        Optional<Result> latestExistingResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.MANUAL).findFirst();\n+        if (latestExistingResult.isPresent()) {\n+            // prevent that tutors create multiple manual results\n+            // TODO: Double check if this is the right way to do, or if we should create a new Manual Result\n+            newResult.setId(latestExistingResult.get().getId());\n+            // load assessor\n+            latestExistingResult = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(latestExistingResult.get().getId());\n+        }\n+\n+        // make sure that the participation cannot be manipulated on the client side\n+        newResult.setParticipation(participation);\n+\n+        ProgrammingExercise exercise = (ProgrammingExercise) participation.getExercise();\n+        checkAuthorization(exercise, user);\n+\n+        final var isAtLeastInstructor = authCheckService.isAtLeastInstructorForExercise(exercise, user);\n+        if (!assessmentService.isAllowedToCreateOrOverrideResult(latestExistingResult.orElse(null), exercise, participation, user, isAtLeastInstructor)) {\n+            log.debug(\"The user \" + user.getLogin() + \" is not allowed to override the assessment for the participation \" + participation.getId() + \" for User \" + user.getLogin());\n+            return forbidden(\"assessment\", \"assessmentSaveNotAllowed\", \"The user is not allowed to override the assessment\");\n+        }\n+\n+        final var course = exercise.getCourseViaExerciseGroupOrCourseMember();\n+        if (!authCheckService.isAtLeastTeachingAssistantInCourse(course, user) || !exercise.areManualResultsAllowed()) {\n+            return forbidden();\n+        }\n+\n+        if (newResult.getResultString() == null) {\n+            throw new BadRequestAlertException(\"Result string is required.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getResultString().length() > 255) {\n+            throw new BadRequestAlertException(\"Result string is too long.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getScore() == null) {\n+            throw new BadRequestAlertException(\"Score is required.\", ENTITY_NAME, \"scoreNull\");\n+        }\n+        else if (newResult.getScore() < 100 && newResult.isSuccessful()) {\n+            throw new BadRequestAlertException(\"Only result with score 100% can be successful.\", ENTITY_NAME, \"scoreAndSuccessfulNotMatching\");\n+        }\n+        else if (!newResult.getFeedbacks().isEmpty() && newResult.getFeedbacks().stream().anyMatch(feedback -> feedback.getText() == null)) {\n+            throw new BadRequestAlertException(\"In case feedback is present, feedback text and detail text are mandatory.\", ENTITY_NAME, \"feedbackTextOrDetailTextNull\");\n+        }\n+\n+        ProgrammingSubmission submission;\n+        if (latestExistingResult.isEmpty()) {\n+            // TODO: Double check if we can create a new result when the existing result has already a completion date (submitted)\n+            // Create manual submission with last commit hash und current time stamp.\n+            submission = programmingSubmissionService.createSubmissionWithLastCommitHashForParticipation((ProgrammingExerciseStudentParticipation) participation,\n+                    SubmissionType.MANUAL);\n+            newResult.setSubmission(submission);\n+        }\n+        else {\n+            submission = programmingSubmissionService.findByIdWithEagerResultAndFeedback(latestExistingResult.get().getSubmission().getId());\n+            newResult.setSubmission(submission);\n+            if (newResult.getSubmission() == null) {\n+                throw new BadRequestAlertException(\"The submission is not connected to the result.\", ENTITY_NAME, \"submissionMissing\");\n+            }\n+        }\n+\n+        Result result = programmingAssessmentService.saveManualAssessment(newResult);\n+\n+        if (submit) {\n+\n+            result = programmingAssessmentService.submitManualAssessment(result.getId());\n+        }\n+        // remove information about the student for tutors to ensure double-blind assessment\n+        if (!isAtLeastInstructor) {\n+            ((StudentParticipation) result.getParticipation()).setParticipant(null);\n+        }\n+        if (submit && ((result.getParticipation()).getExercise().getAssessmentDueDate() == null\n+                || result.getParticipation().getExercise().getAssessmentDueDate().isBefore(ZonedDateTime.now()))) {\n+            ltiService.onNewResult((ProgrammingExerciseStudentParticipation) result.getParticipation());\n+            // TODO: Is it intended that the result with information about the assessor is broadcasted (this is also for other exercises type the case)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI5MTEwOA=="}, "originalCommit": {"oid": "5fda6d499b27a1ab19fa83712c7d99afef8f9899"}, "originalPosition": 154}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3NzcyMjQyOnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/exercises/programming/assess/code-editor-tutor-assessment-container.component.ts", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwOTowODo1NFrOHGO-vQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMzoyMTowMVrOHGXwgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI5ODk0MQ==", "bodyText": "Just a suggestion: first public, then private methods :-)", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476298941", "createdAt": "2020-08-25T09:08:54Z", "author": {"login": "sascha11110"}, "path": "src/main/webapp/app/exercises/programming/assess/code-editor-tutor-assessment-container.component.ts", "diffHunk": "@@ -0,0 +1,323 @@\n+import { Component, OnDestroy, OnInit, ViewChild } from '@angular/core';\n+import { Subscription } from 'rxjs/Subscription';\n+import * as moment from 'moment';\n+import { TranslateService } from '@ngx-translate/core';\n+import { ActivatedRoute, Router } from '@angular/router';\n+import { AlertService } from 'app/core/alert/alert.service';\n+import { ProgrammingExerciseParticipationService } from 'app/exercises/programming/manage/services/programming-exercise-participation.service';\n+import { ButtonSize } from 'app/shared/components/button.component';\n+import { DomainService } from 'app/exercises/programming/shared/code-editor/service/code-editor-domain.service';\n+import { ExerciseType } from 'app/entities/exercise.model';\n+import { Result } from 'app/entities/result.model';\n+import { ProgrammingExercise } from 'app/entities/programming-exercise.model';\n+import { DomainType } from 'app/exercises/programming/shared/code-editor/model/code-editor.model';\n+import { ProgrammingExerciseStudentParticipation } from 'app/entities/participation/programming-exercise-student-participation.model';\n+import { AssessmentType } from 'app/entities/assessment-type.model';\n+import { orderBy as _orderBy, cloneDeep } from 'lodash';\n+import { Complaint } from 'app/entities/complaint.model';\n+import { ComplaintResponse } from 'app/entities/complaint-response.model';\n+import { HttpErrorResponse, HttpResponse } from '@angular/common/http';\n+import { ProgrammingAssessmentManualResultService } from 'app/exercises/programming/assess/manual-result/programming-assessment-manual-result.service';\n+import { ProgrammingSubmission } from 'app/entities/programming-submission.model';\n+import { Location } from '@angular/common';\n+import { AccountService } from 'app/core/auth/account.service';\n+import { ProgrammingSubmissionService } from 'app/exercises/programming/participate/programming-submission.service';\n+import { ComplaintService } from 'app/complaints/complaint.service';\n+import { CodeEditorContainerComponent } from 'app/exercises/programming/shared/code-editor/container/code-editor-container.component';\n+import { assessmentNavigateBack } from 'app/exercises/shared/navigate-back.util';\n+import { Course } from 'app/entities/course.model';\n+\n+@Component({\n+    selector: 'jhi-code-editor-tutor-assessment',\n+    templateUrl: './code-editor-tutor-assessment-container.component.html',\n+})\n+export class CodeEditorTutorAssessmentContainerComponent implements OnInit, OnDestroy {\n+    @ViewChild(CodeEditorContainerComponent, { static: false }) codeEditorContainer: CodeEditorContainerComponent;\n+    ButtonSize = ButtonSize;\n+    PROGRAMMING = ExerciseType.PROGRAMMING;\n+\n+    paramSub: Subscription;\n+    participation: ProgrammingExerciseStudentParticipation;\n+    participationForManualResult: ProgrammingExerciseStudentParticipation;\n+    exercise: ProgrammingExercise;\n+    submission: ProgrammingSubmission | null;\n+    manualResult: Result | null;\n+    automaticResult: Result | null;\n+    userId: number;\n+    // for assessment-layout\n+    isLoading = false;\n+    saveBusy = false;\n+    submitBusy = false;\n+    cancelBusy = false;\n+    nextSubmissionBusy = false;\n+    isAtLeastInstructor = false;\n+    isAssessor = false;\n+    assessmentsAreValid = false;\n+    complaint: Complaint;\n+    private cancelConfirmationText: string;\n+    // Fatal error state: when the participation can't be retrieved, the code editor is unusable for the student\n+    loadingParticipation = false;\n+    participationCouldNotBeFetched = false;\n+    showEditorInstructions = true;\n+    private get course(): Course | undefined {\n+        return this.exercise?.course || this.exercise?.exerciseGroup?.exam?.course;\n+    }\n+    constructor(\n+        private manualResultService: ProgrammingAssessmentManualResultService,\n+        private router: Router,\n+        private location: Location,\n+        private accountService: AccountService,\n+        private programmingSubmissionService: ProgrammingSubmissionService,\n+        private domainService: DomainService,\n+        private programmingExerciseParticipationService: ProgrammingExerciseParticipationService,\n+        private complaintService: ComplaintService,\n+        private translateService: TranslateService,\n+        private route: ActivatedRoute,\n+        private jhiAlertService: AlertService,\n+    ) {\n+        translateService.get('artemisApp.assessment.messages.confirmCancel').subscribe((text) => (this.cancelConfirmationText = text));\n+    }\n+\n+    /**\n+     * On init set up the route param subscription.\n+     * Will load the participation according to participation Id with the latest result and result details.\n+     */\n+    ngOnInit(): void {\n+        // Used to check if the assessor is the current user\n+        this.accountService.identity().then((user) => {\n+            this.userId = user!.id!;\n+        });\n+        this.isAtLeastInstructor = this.accountService.hasAnyAuthorityDirect(['ROLE_ADMIN', 'ROLE_INSTRUCTOR']);\n+        this.paramSub = this.route.params.subscribe((params) => {\n+            this.loadingParticipation = true;\n+            this.participationCouldNotBeFetched = false;\n+            const participationId = Number(params['participationId']);\n+            this.programmingExerciseParticipationService.getStudentParticipationWithResults(participationId).subscribe(\n+                (participationWithResults: ProgrammingExerciseStudentParticipation) => {\n+                    // Set domain to make file editor work properly\n+                    this.domainService.setDomain([DomainType.PARTICIPATION, participationWithResults]);\n+                    this.participation = <ProgrammingExerciseStudentParticipation>participationWithResults;\n+                    this.automaticResult = this.getLatestAutomaticResult(this.participation.results);\n+                    this.manualResult = this.getLatestManualResult(this.participation.results);\n+\n+                    // Add participation with manual results to display manual result in navbar\n+                    this.participationForManualResult = cloneDeep(this.participation);\n+                    this.participationForManualResult.results = this.manualResult ? [this.manualResult] : [];\n+\n+                    // Either latest manual or automatic result\n+                    this.submission = this.getLatestResult(this.participation.results)?.submission as ProgrammingSubmission;\n+                    this.exercise = this.participation.exercise as ProgrammingExercise;\n+\n+                    this.checkPermissions();\n+\n+                    if (this.manualResult && this.manualResult.hasComplaint) {\n+                        this.getComplaint();\n+                    }\n+                },\n+                () => {\n+                    this.participationCouldNotBeFetched = true;\n+                    this.loadingParticipation = false;\n+                },\n+                () => {\n+                    this.loadingParticipation = false;\n+                },\n+            );\n+        });\n+    }\n+\n+    private getLatestResult(results: Result[]): Result | null {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fda6d499b27a1ab19fa83712c7d99afef8f9899"}, "originalPosition": 128}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ0Mjc1NA==", "bodyText": "changed the order of methods :)", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476442754", "createdAt": "2020-08-25T13:21:01Z", "author": {"login": "fde312"}, "path": "src/main/webapp/app/exercises/programming/assess/code-editor-tutor-assessment-container.component.ts", "diffHunk": "@@ -0,0 +1,323 @@\n+import { Component, OnDestroy, OnInit, ViewChild } from '@angular/core';\n+import { Subscription } from 'rxjs/Subscription';\n+import * as moment from 'moment';\n+import { TranslateService } from '@ngx-translate/core';\n+import { ActivatedRoute, Router } from '@angular/router';\n+import { AlertService } from 'app/core/alert/alert.service';\n+import { ProgrammingExerciseParticipationService } from 'app/exercises/programming/manage/services/programming-exercise-participation.service';\n+import { ButtonSize } from 'app/shared/components/button.component';\n+import { DomainService } from 'app/exercises/programming/shared/code-editor/service/code-editor-domain.service';\n+import { ExerciseType } from 'app/entities/exercise.model';\n+import { Result } from 'app/entities/result.model';\n+import { ProgrammingExercise } from 'app/entities/programming-exercise.model';\n+import { DomainType } from 'app/exercises/programming/shared/code-editor/model/code-editor.model';\n+import { ProgrammingExerciseStudentParticipation } from 'app/entities/participation/programming-exercise-student-participation.model';\n+import { AssessmentType } from 'app/entities/assessment-type.model';\n+import { orderBy as _orderBy, cloneDeep } from 'lodash';\n+import { Complaint } from 'app/entities/complaint.model';\n+import { ComplaintResponse } from 'app/entities/complaint-response.model';\n+import { HttpErrorResponse, HttpResponse } from '@angular/common/http';\n+import { ProgrammingAssessmentManualResultService } from 'app/exercises/programming/assess/manual-result/programming-assessment-manual-result.service';\n+import { ProgrammingSubmission } from 'app/entities/programming-submission.model';\n+import { Location } from '@angular/common';\n+import { AccountService } from 'app/core/auth/account.service';\n+import { ProgrammingSubmissionService } from 'app/exercises/programming/participate/programming-submission.service';\n+import { ComplaintService } from 'app/complaints/complaint.service';\n+import { CodeEditorContainerComponent } from 'app/exercises/programming/shared/code-editor/container/code-editor-container.component';\n+import { assessmentNavigateBack } from 'app/exercises/shared/navigate-back.util';\n+import { Course } from 'app/entities/course.model';\n+\n+@Component({\n+    selector: 'jhi-code-editor-tutor-assessment',\n+    templateUrl: './code-editor-tutor-assessment-container.component.html',\n+})\n+export class CodeEditorTutorAssessmentContainerComponent implements OnInit, OnDestroy {\n+    @ViewChild(CodeEditorContainerComponent, { static: false }) codeEditorContainer: CodeEditorContainerComponent;\n+    ButtonSize = ButtonSize;\n+    PROGRAMMING = ExerciseType.PROGRAMMING;\n+\n+    paramSub: Subscription;\n+    participation: ProgrammingExerciseStudentParticipation;\n+    participationForManualResult: ProgrammingExerciseStudentParticipation;\n+    exercise: ProgrammingExercise;\n+    submission: ProgrammingSubmission | null;\n+    manualResult: Result | null;\n+    automaticResult: Result | null;\n+    userId: number;\n+    // for assessment-layout\n+    isLoading = false;\n+    saveBusy = false;\n+    submitBusy = false;\n+    cancelBusy = false;\n+    nextSubmissionBusy = false;\n+    isAtLeastInstructor = false;\n+    isAssessor = false;\n+    assessmentsAreValid = false;\n+    complaint: Complaint;\n+    private cancelConfirmationText: string;\n+    // Fatal error state: when the participation can't be retrieved, the code editor is unusable for the student\n+    loadingParticipation = false;\n+    participationCouldNotBeFetched = false;\n+    showEditorInstructions = true;\n+    private get course(): Course | undefined {\n+        return this.exercise?.course || this.exercise?.exerciseGroup?.exam?.course;\n+    }\n+    constructor(\n+        private manualResultService: ProgrammingAssessmentManualResultService,\n+        private router: Router,\n+        private location: Location,\n+        private accountService: AccountService,\n+        private programmingSubmissionService: ProgrammingSubmissionService,\n+        private domainService: DomainService,\n+        private programmingExerciseParticipationService: ProgrammingExerciseParticipationService,\n+        private complaintService: ComplaintService,\n+        private translateService: TranslateService,\n+        private route: ActivatedRoute,\n+        private jhiAlertService: AlertService,\n+    ) {\n+        translateService.get('artemisApp.assessment.messages.confirmCancel').subscribe((text) => (this.cancelConfirmationText = text));\n+    }\n+\n+    /**\n+     * On init set up the route param subscription.\n+     * Will load the participation according to participation Id with the latest result and result details.\n+     */\n+    ngOnInit(): void {\n+        // Used to check if the assessor is the current user\n+        this.accountService.identity().then((user) => {\n+            this.userId = user!.id!;\n+        });\n+        this.isAtLeastInstructor = this.accountService.hasAnyAuthorityDirect(['ROLE_ADMIN', 'ROLE_INSTRUCTOR']);\n+        this.paramSub = this.route.params.subscribe((params) => {\n+            this.loadingParticipation = true;\n+            this.participationCouldNotBeFetched = false;\n+            const participationId = Number(params['participationId']);\n+            this.programmingExerciseParticipationService.getStudentParticipationWithResults(participationId).subscribe(\n+                (participationWithResults: ProgrammingExerciseStudentParticipation) => {\n+                    // Set domain to make file editor work properly\n+                    this.domainService.setDomain([DomainType.PARTICIPATION, participationWithResults]);\n+                    this.participation = <ProgrammingExerciseStudentParticipation>participationWithResults;\n+                    this.automaticResult = this.getLatestAutomaticResult(this.participation.results);\n+                    this.manualResult = this.getLatestManualResult(this.participation.results);\n+\n+                    // Add participation with manual results to display manual result in navbar\n+                    this.participationForManualResult = cloneDeep(this.participation);\n+                    this.participationForManualResult.results = this.manualResult ? [this.manualResult] : [];\n+\n+                    // Either latest manual or automatic result\n+                    this.submission = this.getLatestResult(this.participation.results)?.submission as ProgrammingSubmission;\n+                    this.exercise = this.participation.exercise as ProgrammingExercise;\n+\n+                    this.checkPermissions();\n+\n+                    if (this.manualResult && this.manualResult.hasComplaint) {\n+                        this.getComplaint();\n+                    }\n+                },\n+                () => {\n+                    this.participationCouldNotBeFetched = true;\n+                    this.loadingParticipation = false;\n+                },\n+                () => {\n+                    this.loadingParticipation = false;\n+                },\n+            );\n+        });\n+    }\n+\n+    private getLatestResult(results: Result[]): Result | null {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI5ODk0MQ=="}, "originalCommit": {"oid": "5fda6d499b27a1ab19fa83712c7d99afef8f9899"}, "originalPosition": 128}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3Nzc0Mjc4OnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/exercises/programming/assess/code-editor-tutor-assessment-container.component.ts", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwOToxNDoyM1rOHGPLYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMzoyMTo0N1rOHGXyfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMwMjE3OA==", "bodyText": "The exclamation mark at the end should not be necessary", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476302178", "createdAt": "2020-08-25T09:14:23Z", "author": {"login": "sascha11110"}, "path": "src/main/webapp/app/exercises/programming/assess/code-editor-tutor-assessment-container.component.ts", "diffHunk": "@@ -0,0 +1,323 @@\n+import { Component, OnDestroy, OnInit, ViewChild } from '@angular/core';\n+import { Subscription } from 'rxjs/Subscription';\n+import * as moment from 'moment';\n+import { TranslateService } from '@ngx-translate/core';\n+import { ActivatedRoute, Router } from '@angular/router';\n+import { AlertService } from 'app/core/alert/alert.service';\n+import { ProgrammingExerciseParticipationService } from 'app/exercises/programming/manage/services/programming-exercise-participation.service';\n+import { ButtonSize } from 'app/shared/components/button.component';\n+import { DomainService } from 'app/exercises/programming/shared/code-editor/service/code-editor-domain.service';\n+import { ExerciseType } from 'app/entities/exercise.model';\n+import { Result } from 'app/entities/result.model';\n+import { ProgrammingExercise } from 'app/entities/programming-exercise.model';\n+import { DomainType } from 'app/exercises/programming/shared/code-editor/model/code-editor.model';\n+import { ProgrammingExerciseStudentParticipation } from 'app/entities/participation/programming-exercise-student-participation.model';\n+import { AssessmentType } from 'app/entities/assessment-type.model';\n+import { orderBy as _orderBy, cloneDeep } from 'lodash';\n+import { Complaint } from 'app/entities/complaint.model';\n+import { ComplaintResponse } from 'app/entities/complaint-response.model';\n+import { HttpErrorResponse, HttpResponse } from '@angular/common/http';\n+import { ProgrammingAssessmentManualResultService } from 'app/exercises/programming/assess/manual-result/programming-assessment-manual-result.service';\n+import { ProgrammingSubmission } from 'app/entities/programming-submission.model';\n+import { Location } from '@angular/common';\n+import { AccountService } from 'app/core/auth/account.service';\n+import { ProgrammingSubmissionService } from 'app/exercises/programming/participate/programming-submission.service';\n+import { ComplaintService } from 'app/complaints/complaint.service';\n+import { CodeEditorContainerComponent } from 'app/exercises/programming/shared/code-editor/container/code-editor-container.component';\n+import { assessmentNavigateBack } from 'app/exercises/shared/navigate-back.util';\n+import { Course } from 'app/entities/course.model';\n+\n+@Component({\n+    selector: 'jhi-code-editor-tutor-assessment',\n+    templateUrl: './code-editor-tutor-assessment-container.component.html',\n+})\n+export class CodeEditorTutorAssessmentContainerComponent implements OnInit, OnDestroy {\n+    @ViewChild(CodeEditorContainerComponent, { static: false }) codeEditorContainer: CodeEditorContainerComponent;\n+    ButtonSize = ButtonSize;\n+    PROGRAMMING = ExerciseType.PROGRAMMING;\n+\n+    paramSub: Subscription;\n+    participation: ProgrammingExerciseStudentParticipation;\n+    participationForManualResult: ProgrammingExerciseStudentParticipation;\n+    exercise: ProgrammingExercise;\n+    submission: ProgrammingSubmission | null;\n+    manualResult: Result | null;\n+    automaticResult: Result | null;\n+    userId: number;\n+    // for assessment-layout\n+    isLoading = false;\n+    saveBusy = false;\n+    submitBusy = false;\n+    cancelBusy = false;\n+    nextSubmissionBusy = false;\n+    isAtLeastInstructor = false;\n+    isAssessor = false;\n+    assessmentsAreValid = false;\n+    complaint: Complaint;\n+    private cancelConfirmationText: string;\n+    // Fatal error state: when the participation can't be retrieved, the code editor is unusable for the student\n+    loadingParticipation = false;\n+    participationCouldNotBeFetched = false;\n+    showEditorInstructions = true;\n+    private get course(): Course | undefined {\n+        return this.exercise?.course || this.exercise?.exerciseGroup?.exam?.course;\n+    }\n+    constructor(\n+        private manualResultService: ProgrammingAssessmentManualResultService,\n+        private router: Router,\n+        private location: Location,\n+        private accountService: AccountService,\n+        private programmingSubmissionService: ProgrammingSubmissionService,\n+        private domainService: DomainService,\n+        private programmingExerciseParticipationService: ProgrammingExerciseParticipationService,\n+        private complaintService: ComplaintService,\n+        private translateService: TranslateService,\n+        private route: ActivatedRoute,\n+        private jhiAlertService: AlertService,\n+    ) {\n+        translateService.get('artemisApp.assessment.messages.confirmCancel').subscribe((text) => (this.cancelConfirmationText = text));\n+    }\n+\n+    /**\n+     * On init set up the route param subscription.\n+     * Will load the participation according to participation Id with the latest result and result details.\n+     */\n+    ngOnInit(): void {\n+        // Used to check if the assessor is the current user\n+        this.accountService.identity().then((user) => {\n+            this.userId = user!.id!;\n+        });\n+        this.isAtLeastInstructor = this.accountService.hasAnyAuthorityDirect(['ROLE_ADMIN', 'ROLE_INSTRUCTOR']);\n+        this.paramSub = this.route.params.subscribe((params) => {\n+            this.loadingParticipation = true;\n+            this.participationCouldNotBeFetched = false;\n+            const participationId = Number(params['participationId']);\n+            this.programmingExerciseParticipationService.getStudentParticipationWithResults(participationId).subscribe(\n+                (participationWithResults: ProgrammingExerciseStudentParticipation) => {\n+                    // Set domain to make file editor work properly\n+                    this.domainService.setDomain([DomainType.PARTICIPATION, participationWithResults]);\n+                    this.participation = <ProgrammingExerciseStudentParticipation>participationWithResults;\n+                    this.automaticResult = this.getLatestAutomaticResult(this.participation.results);\n+                    this.manualResult = this.getLatestManualResult(this.participation.results);\n+\n+                    // Add participation with manual results to display manual result in navbar\n+                    this.participationForManualResult = cloneDeep(this.participation);\n+                    this.participationForManualResult.results = this.manualResult ? [this.manualResult] : [];\n+\n+                    // Either latest manual or automatic result\n+                    this.submission = this.getLatestResult(this.participation.results)?.submission as ProgrammingSubmission;\n+                    this.exercise = this.participation.exercise as ProgrammingExercise;\n+\n+                    this.checkPermissions();\n+\n+                    if (this.manualResult && this.manualResult.hasComplaint) {\n+                        this.getComplaint();\n+                    }\n+                },\n+                () => {\n+                    this.participationCouldNotBeFetched = true;\n+                    this.loadingParticipation = false;\n+                },\n+                () => {\n+                    this.loadingParticipation = false;\n+                },\n+            );\n+        });\n+    }\n+\n+    private getLatestResult(results: Result[]): Result | null {\n+        return _orderBy(results, 'id', 'desc')[0] ?? null;\n+    }\n+\n+    private getLatestAutomaticResult(results: Result[]): Result | null {\n+        const automaticResults = results.filter((result) => result.assessmentType === AssessmentType.AUTOMATIC);\n+        return _orderBy(automaticResults, 'id', 'desc')[0] ?? null;\n+    }\n+\n+    private getLatestManualResult(results: Result[]): Result | null {\n+        const manualResults = results.filter((result) => result.assessmentType === AssessmentType.MANUAL);\n+        return _orderBy(manualResults, 'id', 'desc')[0] ?? null;\n+    }\n+\n+    /**\n+     * If a subscription exists for paramSub, unsubscribe\n+     */\n+    ngOnDestroy() {\n+        if (this.paramSub) {\n+            this.paramSub.unsubscribe();\n+        }\n+    }\n+\n+    /**\n+     * Save the assessment\n+     */\n+    save(): void {\n+        this.saveBusy = true;\n+\n+        this.manualResultService.save(this.participation.id, this.manualResult!).subscribe(\n+            (response) => this.handleSaveOrSubmitSuccessWithAlert(response, 'artemisApp.textAssessment.saveSuccessful'),\n+            (error: HttpErrorResponse) => this.onError(`artemisApp.${error.error.entityName}.${error.error.message}`),\n+        );\n+    }\n+\n+    /**\n+     * Submit the assessment\n+     */\n+    submit(): void {\n+        this.submitBusy = true;\n+\n+        this.manualResultService.save(this.participation.id, this.manualResult!, true).subscribe(\n+            (response) => this.handleSaveOrSubmitSuccessWithAlert(response, 'artemisApp.textAssessment.submitSuccessful'),\n+            (error: HttpErrorResponse) => this.onError(`artemisApp.${error.error.entityName}.${error.error.message}`),\n+        );\n+    }\n+\n+    /**\n+     * Cancel the assessment\n+     */\n+    cancel(): void {\n+        const confirmCancel = window.confirm(this.cancelConfirmationText);\n+        this.cancelBusy = true;\n+        if (confirmCancel && this.exercise && this.submission) {\n+            // TODO: Implement lock for programming submissions, otherwise cancel will only work when saving before.\n+            // this.manualResultService.cancelAssessment(this.submission.id).subscribe(() => this.navigateBack());\n+            this.navigateBack();\n+        }\n+    }\n+\n+    /**\n+     * Go to next submission\n+     */\n+    nextSubmission() {\n+        this.programmingSubmissionService.getProgrammingSubmissionForExerciseWithoutAssessment(this.exercise.id).subscribe(\n+            (response: ProgrammingSubmission) => {\n+                const unassessedSubmission = response;\n+                this.router.onSameUrlNavigation = 'reload';\n+                // navigate to the new assessment page to trigger re-initialization of the components\n+                this.router.navigateByUrl(\n+                    `/course-management/${this.course!.id}/programming-exercises/${this.exercise.id}/code-editor/${unassessedSubmission.participation.id}/assessment`,\n+                    {},\n+                );\n+            },\n+            (error: HttpErrorResponse) => {\n+                if (error.status === 404) {\n+                    // there are no unassessed submission, nothing we have to worry about\n+                    this.jhiAlertService.error('artemisApp.tutorExerciseDashboard.noSubmissions');\n+                } else {\n+                    this.onError(error.message);\n+                }\n+            },\n+        );\n+    }\n+\n+    /**\n+     * Sends the current (updated) assessment to the server to update the original assessment after a complaint was accepted.\n+     * The corresponding complaint response is sent along with the updated assessment to prevent additional requests.\n+     *\n+     * @param complaintResponse the response to the complaint that is sent to the server along with the assessment update\n+     */\n+    onUpdateAssessmentAfterComplaint(complaintResponse: ComplaintResponse): void {\n+        this.manualResultService.updateAfterComplaint(this.manualResult!.feedbacks, complaintResponse, this.manualResult!, this.manualResult!.submission!.id).subscribe(\n+            (result: Result) => {\n+                this.manualResult = result;\n+                this.jhiAlertService.clear();\n+                this.jhiAlertService.success('artemisApp.assessment.messages.updateAfterComplaintSuccessful');\n+            },\n+            () => {\n+                this.jhiAlertService.clear();\n+                this.jhiAlertService.error('artemisApp.assessment.messages.updateAfterComplaintFailed');\n+            },\n+        );\n+    }\n+\n+    navigateBack() {\n+        assessmentNavigateBack(this.location, this.router, this.exercise, this.submission);\n+    }\n+\n+    /**\n+     * Boolean which determines whether the user can override a result.\n+     * If no exercise is loaded, for example during loading between exercises, we return false.\n+     * Instructors can always override a result.\n+     * Tutors can override their own results within the assessment due date, if there is no complaint about their assessment.\n+     * They cannot override a result anymore, if there is a complaint. Another tutor must handle the complaint.\n+     */\n+    get canOverride(): boolean {\n+        if (this.exercise) {\n+            if (this.isAtLeastInstructor) {\n+                // Instructors can override any assessment at any time.\n+                return true;\n+            }\n+            if (this.complaint && this.isAssessor) {\n+                // If there is a complaint, the original assessor cannot override the result anymore.\n+                return false;\n+            }\n+            let isBeforeAssessmentDueDate = true;\n+            // Add check as the assessmentDueDate must not be set for exercises\n+            if (this.exercise.assessmentDueDate) {\n+                isBeforeAssessmentDueDate = moment().isBefore(this.exercise.assessmentDueDate!);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fda6d499b27a1ab19fa83712c7d99afef8f9899"}, "originalPosition": 257}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ0MzI2MA==", "bodyText": "done", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476443260", "createdAt": "2020-08-25T13:21:47Z", "author": {"login": "fde312"}, "path": "src/main/webapp/app/exercises/programming/assess/code-editor-tutor-assessment-container.component.ts", "diffHunk": "@@ -0,0 +1,323 @@\n+import { Component, OnDestroy, OnInit, ViewChild } from '@angular/core';\n+import { Subscription } from 'rxjs/Subscription';\n+import * as moment from 'moment';\n+import { TranslateService } from '@ngx-translate/core';\n+import { ActivatedRoute, Router } from '@angular/router';\n+import { AlertService } from 'app/core/alert/alert.service';\n+import { ProgrammingExerciseParticipationService } from 'app/exercises/programming/manage/services/programming-exercise-participation.service';\n+import { ButtonSize } from 'app/shared/components/button.component';\n+import { DomainService } from 'app/exercises/programming/shared/code-editor/service/code-editor-domain.service';\n+import { ExerciseType } from 'app/entities/exercise.model';\n+import { Result } from 'app/entities/result.model';\n+import { ProgrammingExercise } from 'app/entities/programming-exercise.model';\n+import { DomainType } from 'app/exercises/programming/shared/code-editor/model/code-editor.model';\n+import { ProgrammingExerciseStudentParticipation } from 'app/entities/participation/programming-exercise-student-participation.model';\n+import { AssessmentType } from 'app/entities/assessment-type.model';\n+import { orderBy as _orderBy, cloneDeep } from 'lodash';\n+import { Complaint } from 'app/entities/complaint.model';\n+import { ComplaintResponse } from 'app/entities/complaint-response.model';\n+import { HttpErrorResponse, HttpResponse } from '@angular/common/http';\n+import { ProgrammingAssessmentManualResultService } from 'app/exercises/programming/assess/manual-result/programming-assessment-manual-result.service';\n+import { ProgrammingSubmission } from 'app/entities/programming-submission.model';\n+import { Location } from '@angular/common';\n+import { AccountService } from 'app/core/auth/account.service';\n+import { ProgrammingSubmissionService } from 'app/exercises/programming/participate/programming-submission.service';\n+import { ComplaintService } from 'app/complaints/complaint.service';\n+import { CodeEditorContainerComponent } from 'app/exercises/programming/shared/code-editor/container/code-editor-container.component';\n+import { assessmentNavigateBack } from 'app/exercises/shared/navigate-back.util';\n+import { Course } from 'app/entities/course.model';\n+\n+@Component({\n+    selector: 'jhi-code-editor-tutor-assessment',\n+    templateUrl: './code-editor-tutor-assessment-container.component.html',\n+})\n+export class CodeEditorTutorAssessmentContainerComponent implements OnInit, OnDestroy {\n+    @ViewChild(CodeEditorContainerComponent, { static: false }) codeEditorContainer: CodeEditorContainerComponent;\n+    ButtonSize = ButtonSize;\n+    PROGRAMMING = ExerciseType.PROGRAMMING;\n+\n+    paramSub: Subscription;\n+    participation: ProgrammingExerciseStudentParticipation;\n+    participationForManualResult: ProgrammingExerciseStudentParticipation;\n+    exercise: ProgrammingExercise;\n+    submission: ProgrammingSubmission | null;\n+    manualResult: Result | null;\n+    automaticResult: Result | null;\n+    userId: number;\n+    // for assessment-layout\n+    isLoading = false;\n+    saveBusy = false;\n+    submitBusy = false;\n+    cancelBusy = false;\n+    nextSubmissionBusy = false;\n+    isAtLeastInstructor = false;\n+    isAssessor = false;\n+    assessmentsAreValid = false;\n+    complaint: Complaint;\n+    private cancelConfirmationText: string;\n+    // Fatal error state: when the participation can't be retrieved, the code editor is unusable for the student\n+    loadingParticipation = false;\n+    participationCouldNotBeFetched = false;\n+    showEditorInstructions = true;\n+    private get course(): Course | undefined {\n+        return this.exercise?.course || this.exercise?.exerciseGroup?.exam?.course;\n+    }\n+    constructor(\n+        private manualResultService: ProgrammingAssessmentManualResultService,\n+        private router: Router,\n+        private location: Location,\n+        private accountService: AccountService,\n+        private programmingSubmissionService: ProgrammingSubmissionService,\n+        private domainService: DomainService,\n+        private programmingExerciseParticipationService: ProgrammingExerciseParticipationService,\n+        private complaintService: ComplaintService,\n+        private translateService: TranslateService,\n+        private route: ActivatedRoute,\n+        private jhiAlertService: AlertService,\n+    ) {\n+        translateService.get('artemisApp.assessment.messages.confirmCancel').subscribe((text) => (this.cancelConfirmationText = text));\n+    }\n+\n+    /**\n+     * On init set up the route param subscription.\n+     * Will load the participation according to participation Id with the latest result and result details.\n+     */\n+    ngOnInit(): void {\n+        // Used to check if the assessor is the current user\n+        this.accountService.identity().then((user) => {\n+            this.userId = user!.id!;\n+        });\n+        this.isAtLeastInstructor = this.accountService.hasAnyAuthorityDirect(['ROLE_ADMIN', 'ROLE_INSTRUCTOR']);\n+        this.paramSub = this.route.params.subscribe((params) => {\n+            this.loadingParticipation = true;\n+            this.participationCouldNotBeFetched = false;\n+            const participationId = Number(params['participationId']);\n+            this.programmingExerciseParticipationService.getStudentParticipationWithResults(participationId).subscribe(\n+                (participationWithResults: ProgrammingExerciseStudentParticipation) => {\n+                    // Set domain to make file editor work properly\n+                    this.domainService.setDomain([DomainType.PARTICIPATION, participationWithResults]);\n+                    this.participation = <ProgrammingExerciseStudentParticipation>participationWithResults;\n+                    this.automaticResult = this.getLatestAutomaticResult(this.participation.results);\n+                    this.manualResult = this.getLatestManualResult(this.participation.results);\n+\n+                    // Add participation with manual results to display manual result in navbar\n+                    this.participationForManualResult = cloneDeep(this.participation);\n+                    this.participationForManualResult.results = this.manualResult ? [this.manualResult] : [];\n+\n+                    // Either latest manual or automatic result\n+                    this.submission = this.getLatestResult(this.participation.results)?.submission as ProgrammingSubmission;\n+                    this.exercise = this.participation.exercise as ProgrammingExercise;\n+\n+                    this.checkPermissions();\n+\n+                    if (this.manualResult && this.manualResult.hasComplaint) {\n+                        this.getComplaint();\n+                    }\n+                },\n+                () => {\n+                    this.participationCouldNotBeFetched = true;\n+                    this.loadingParticipation = false;\n+                },\n+                () => {\n+                    this.loadingParticipation = false;\n+                },\n+            );\n+        });\n+    }\n+\n+    private getLatestResult(results: Result[]): Result | null {\n+        return _orderBy(results, 'id', 'desc')[0] ?? null;\n+    }\n+\n+    private getLatestAutomaticResult(results: Result[]): Result | null {\n+        const automaticResults = results.filter((result) => result.assessmentType === AssessmentType.AUTOMATIC);\n+        return _orderBy(automaticResults, 'id', 'desc')[0] ?? null;\n+    }\n+\n+    private getLatestManualResult(results: Result[]): Result | null {\n+        const manualResults = results.filter((result) => result.assessmentType === AssessmentType.MANUAL);\n+        return _orderBy(manualResults, 'id', 'desc')[0] ?? null;\n+    }\n+\n+    /**\n+     * If a subscription exists for paramSub, unsubscribe\n+     */\n+    ngOnDestroy() {\n+        if (this.paramSub) {\n+            this.paramSub.unsubscribe();\n+        }\n+    }\n+\n+    /**\n+     * Save the assessment\n+     */\n+    save(): void {\n+        this.saveBusy = true;\n+\n+        this.manualResultService.save(this.participation.id, this.manualResult!).subscribe(\n+            (response) => this.handleSaveOrSubmitSuccessWithAlert(response, 'artemisApp.textAssessment.saveSuccessful'),\n+            (error: HttpErrorResponse) => this.onError(`artemisApp.${error.error.entityName}.${error.error.message}`),\n+        );\n+    }\n+\n+    /**\n+     * Submit the assessment\n+     */\n+    submit(): void {\n+        this.submitBusy = true;\n+\n+        this.manualResultService.save(this.participation.id, this.manualResult!, true).subscribe(\n+            (response) => this.handleSaveOrSubmitSuccessWithAlert(response, 'artemisApp.textAssessment.submitSuccessful'),\n+            (error: HttpErrorResponse) => this.onError(`artemisApp.${error.error.entityName}.${error.error.message}`),\n+        );\n+    }\n+\n+    /**\n+     * Cancel the assessment\n+     */\n+    cancel(): void {\n+        const confirmCancel = window.confirm(this.cancelConfirmationText);\n+        this.cancelBusy = true;\n+        if (confirmCancel && this.exercise && this.submission) {\n+            // TODO: Implement lock for programming submissions, otherwise cancel will only work when saving before.\n+            // this.manualResultService.cancelAssessment(this.submission.id).subscribe(() => this.navigateBack());\n+            this.navigateBack();\n+        }\n+    }\n+\n+    /**\n+     * Go to next submission\n+     */\n+    nextSubmission() {\n+        this.programmingSubmissionService.getProgrammingSubmissionForExerciseWithoutAssessment(this.exercise.id).subscribe(\n+            (response: ProgrammingSubmission) => {\n+                const unassessedSubmission = response;\n+                this.router.onSameUrlNavigation = 'reload';\n+                // navigate to the new assessment page to trigger re-initialization of the components\n+                this.router.navigateByUrl(\n+                    `/course-management/${this.course!.id}/programming-exercises/${this.exercise.id}/code-editor/${unassessedSubmission.participation.id}/assessment`,\n+                    {},\n+                );\n+            },\n+            (error: HttpErrorResponse) => {\n+                if (error.status === 404) {\n+                    // there are no unassessed submission, nothing we have to worry about\n+                    this.jhiAlertService.error('artemisApp.tutorExerciseDashboard.noSubmissions');\n+                } else {\n+                    this.onError(error.message);\n+                }\n+            },\n+        );\n+    }\n+\n+    /**\n+     * Sends the current (updated) assessment to the server to update the original assessment after a complaint was accepted.\n+     * The corresponding complaint response is sent along with the updated assessment to prevent additional requests.\n+     *\n+     * @param complaintResponse the response to the complaint that is sent to the server along with the assessment update\n+     */\n+    onUpdateAssessmentAfterComplaint(complaintResponse: ComplaintResponse): void {\n+        this.manualResultService.updateAfterComplaint(this.manualResult!.feedbacks, complaintResponse, this.manualResult!, this.manualResult!.submission!.id).subscribe(\n+            (result: Result) => {\n+                this.manualResult = result;\n+                this.jhiAlertService.clear();\n+                this.jhiAlertService.success('artemisApp.assessment.messages.updateAfterComplaintSuccessful');\n+            },\n+            () => {\n+                this.jhiAlertService.clear();\n+                this.jhiAlertService.error('artemisApp.assessment.messages.updateAfterComplaintFailed');\n+            },\n+        );\n+    }\n+\n+    navigateBack() {\n+        assessmentNavigateBack(this.location, this.router, this.exercise, this.submission);\n+    }\n+\n+    /**\n+     * Boolean which determines whether the user can override a result.\n+     * If no exercise is loaded, for example during loading between exercises, we return false.\n+     * Instructors can always override a result.\n+     * Tutors can override their own results within the assessment due date, if there is no complaint about their assessment.\n+     * They cannot override a result anymore, if there is a complaint. Another tutor must handle the complaint.\n+     */\n+    get canOverride(): boolean {\n+        if (this.exercise) {\n+            if (this.isAtLeastInstructor) {\n+                // Instructors can override any assessment at any time.\n+                return true;\n+            }\n+            if (this.complaint && this.isAssessor) {\n+                // If there is a complaint, the original assessor cannot override the result anymore.\n+                return false;\n+            }\n+            let isBeforeAssessmentDueDate = true;\n+            // Add check as the assessmentDueDate must not be set for exercises\n+            if (this.exercise.assessmentDueDate) {\n+                isBeforeAssessmentDueDate = moment().isBefore(this.exercise.assessmentDueDate!);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMwMjE3OA=="}, "originalCommit": {"oid": "5fda6d499b27a1ab19fa83712c7d99afef8f9899"}, "originalPosition": 257}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3Nzc0MzA1OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwOToxNDoyOVrOHGPLkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMzowODo1NlrOHGXQ5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMwMjIyNw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (submit) {\n          \n          \n            \n                    if (submit) {", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476302227", "createdAt": "2020-08-25T09:14:29Z", "author": {"login": "MaisiKoleni"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,114 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,\n+            @RequestBody Result newResult) {\n+        log.debug(\"REST request to save a new result : {}\", newResult);\n+        final var participation = participationService.findOneWithEagerResultsAndCourse(participationId);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+\n+        Optional<Result> latestExistingResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.MANUAL).findFirst();\n+        if (latestExistingResult.isPresent()) {\n+            // prevent that tutors create multiple manual results\n+            // TODO: Double check if this is the right way to do, or if we should create a new Manual Result\n+            newResult.setId(latestExistingResult.get().getId());\n+            // load assessor\n+            latestExistingResult = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(latestExistingResult.get().getId());\n+        }\n+\n+        // make sure that the participation cannot be manipulated on the client side\n+        newResult.setParticipation(participation);\n+\n+        ProgrammingExercise exercise = (ProgrammingExercise) participation.getExercise();\n+        checkAuthorization(exercise, user);\n+\n+        final var isAtLeastInstructor = authCheckService.isAtLeastInstructorForExercise(exercise, user);\n+        if (!assessmentService.isAllowedToCreateOrOverrideResult(latestExistingResult.orElse(null), exercise, participation, user, isAtLeastInstructor)) {\n+            log.debug(\"The user \" + user.getLogin() + \" is not allowed to override the assessment for the participation \" + participation.getId() + \" for User \" + user.getLogin());\n+            return forbidden(\"assessment\", \"assessmentSaveNotAllowed\", \"The user is not allowed to override the assessment\");\n+        }\n+\n+        final var course = exercise.getCourseViaExerciseGroupOrCourseMember();\n+        if (!authCheckService.isAtLeastTeachingAssistantInCourse(course, user) || !exercise.areManualResultsAllowed()) {\n+            return forbidden();\n+        }\n+\n+        if (newResult.getResultString() == null) {\n+            throw new BadRequestAlertException(\"Result string is required.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getResultString().length() > 255) {\n+            throw new BadRequestAlertException(\"Result string is too long.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getScore() == null) {\n+            throw new BadRequestAlertException(\"Score is required.\", ENTITY_NAME, \"scoreNull\");\n+        }\n+        else if (newResult.getScore() < 100 && newResult.isSuccessful()) {\n+            throw new BadRequestAlertException(\"Only result with score 100% can be successful.\", ENTITY_NAME, \"scoreAndSuccessfulNotMatching\");\n+        }\n+        else if (!newResult.getFeedbacks().isEmpty() && newResult.getFeedbacks().stream().anyMatch(feedback -> feedback.getText() == null)) {\n+            throw new BadRequestAlertException(\"In case feedback is present, feedback text and detail text are mandatory.\", ENTITY_NAME, \"feedbackTextOrDetailTextNull\");\n+        }\n+\n+        ProgrammingSubmission submission;\n+        if (latestExistingResult.isEmpty()) {\n+            // TODO: Double check if we can create a new result when the existing result has already a completion date (submitted)\n+            // Create manual submission with last commit hash und current time stamp.\n+            submission = programmingSubmissionService.createSubmissionWithLastCommitHashForParticipation((ProgrammingExerciseStudentParticipation) participation,\n+                    SubmissionType.MANUAL);\n+            newResult.setSubmission(submission);\n+        }\n+        else {\n+            submission = programmingSubmissionService.findByIdWithEagerResultAndFeedback(latestExistingResult.get().getSubmission().getId());\n+            newResult.setSubmission(submission);\n+            if (newResult.getSubmission() == null) {\n+                throw new BadRequestAlertException(\"The submission is not connected to the result.\", ENTITY_NAME, \"submissionMissing\");\n+            }\n+        }\n+\n+        Result result = programmingAssessmentService.saveManualAssessment(newResult);\n+\n+        if (submit) {\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fda6d499b27a1ab19fa83712c7d99afef8f9899"}, "originalPosition": 144}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQzNDY2Mw==", "bodyText": "done \ud83d\ude04", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476434663", "createdAt": "2020-08-25T13:08:56Z", "author": {"login": "fde312"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,114 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,\n+            @RequestBody Result newResult) {\n+        log.debug(\"REST request to save a new result : {}\", newResult);\n+        final var participation = participationService.findOneWithEagerResultsAndCourse(participationId);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+\n+        Optional<Result> latestExistingResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.MANUAL).findFirst();\n+        if (latestExistingResult.isPresent()) {\n+            // prevent that tutors create multiple manual results\n+            // TODO: Double check if this is the right way to do, or if we should create a new Manual Result\n+            newResult.setId(latestExistingResult.get().getId());\n+            // load assessor\n+            latestExistingResult = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(latestExistingResult.get().getId());\n+        }\n+\n+        // make sure that the participation cannot be manipulated on the client side\n+        newResult.setParticipation(participation);\n+\n+        ProgrammingExercise exercise = (ProgrammingExercise) participation.getExercise();\n+        checkAuthorization(exercise, user);\n+\n+        final var isAtLeastInstructor = authCheckService.isAtLeastInstructorForExercise(exercise, user);\n+        if (!assessmentService.isAllowedToCreateOrOverrideResult(latestExistingResult.orElse(null), exercise, participation, user, isAtLeastInstructor)) {\n+            log.debug(\"The user \" + user.getLogin() + \" is not allowed to override the assessment for the participation \" + participation.getId() + \" for User \" + user.getLogin());\n+            return forbidden(\"assessment\", \"assessmentSaveNotAllowed\", \"The user is not allowed to override the assessment\");\n+        }\n+\n+        final var course = exercise.getCourseViaExerciseGroupOrCourseMember();\n+        if (!authCheckService.isAtLeastTeachingAssistantInCourse(course, user) || !exercise.areManualResultsAllowed()) {\n+            return forbidden();\n+        }\n+\n+        if (newResult.getResultString() == null) {\n+            throw new BadRequestAlertException(\"Result string is required.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getResultString().length() > 255) {\n+            throw new BadRequestAlertException(\"Result string is too long.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getScore() == null) {\n+            throw new BadRequestAlertException(\"Score is required.\", ENTITY_NAME, \"scoreNull\");\n+        }\n+        else if (newResult.getScore() < 100 && newResult.isSuccessful()) {\n+            throw new BadRequestAlertException(\"Only result with score 100% can be successful.\", ENTITY_NAME, \"scoreAndSuccessfulNotMatching\");\n+        }\n+        else if (!newResult.getFeedbacks().isEmpty() && newResult.getFeedbacks().stream().anyMatch(feedback -> feedback.getText() == null)) {\n+            throw new BadRequestAlertException(\"In case feedback is present, feedback text and detail text are mandatory.\", ENTITY_NAME, \"feedbackTextOrDetailTextNull\");\n+        }\n+\n+        ProgrammingSubmission submission;\n+        if (latestExistingResult.isEmpty()) {\n+            // TODO: Double check if we can create a new result when the existing result has already a completion date (submitted)\n+            // Create manual submission with last commit hash und current time stamp.\n+            submission = programmingSubmissionService.createSubmissionWithLastCommitHashForParticipation((ProgrammingExerciseStudentParticipation) participation,\n+                    SubmissionType.MANUAL);\n+            newResult.setSubmission(submission);\n+        }\n+        else {\n+            submission = programmingSubmissionService.findByIdWithEagerResultAndFeedback(latestExistingResult.get().getSubmission().getId());\n+            newResult.setSubmission(submission);\n+            if (newResult.getSubmission() == null) {\n+                throw new BadRequestAlertException(\"The submission is not connected to the result.\", ENTITY_NAME, \"submissionMissing\");\n+            }\n+        }\n+\n+        Result result = programmingAssessmentService.saveManualAssessment(newResult);\n+\n+        if (submit) {\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMwMjIyNw=="}, "originalCommit": {"oid": "5fda6d499b27a1ab19fa83712c7d99afef8f9899"}, "originalPosition": 144}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3Nzc1NDY2OnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/exercises/programming/assess/manual-result/programming-assessment-manual-result-in-code-editor.component.html", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwOToxNzo0NFrOHGPS6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwOToxNzo0NFrOHGPS6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMwNDEwNQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        <span class=\"text-danger\" *ngIf=\"resultString?.invalid && resultString?.errors?.required\" jhiTranslate=\"artemisApp.result.resultStringRequired\"\n          \n          \n            \n                            >Result text is required.</span\n          \n          \n            \n                        >\n          \n          \n            \n                        <span class=\"text-danger\" *ngIf=\"resultString?.invalid && resultString?.errors?.required\" jhiTranslate=\"artemisApp.result.resultStringRequired\">\n          \n          \n            \n                            Result text is required.\n          \n          \n            \n                        </span>", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476304105", "createdAt": "2020-08-25T09:17:44Z", "author": {"login": "sascha11110"}, "path": "src/main/webapp/app/exercises/programming/assess/manual-result/programming-assessment-manual-result-in-code-editor.component.html", "diffHunk": "@@ -0,0 +1,109 @@\n+<div *ngIf=\"result && !isLoading\" class=\"modal-body\">\n+    <div *ngIf=\"isOpenForSubmission\" class=\"alert alert-warning\">\n+        <strong jhiTranslate=\"artemisApp.result.exerciseStillOpen\">Exercise is still open for submissions!</strong>\n+        <span jhiTranslate=\"artemisApp.result.studentOverride\">\n+            The due date of this exercise is not reached yet. The student could override this manual result by committing a new solution.\n+        </span>\n+    </div>\n+    <div class=\"form-group\" *ngIf=\"exercise.gradingInstructions\">\n+        <h3 for=\"id\" jhiTranslate=\"artemisApp.exercise.gradingInstructions\">Grading Instructions</h3>\n+        <span [innerHTML]=\"exercise.gradingInstructions | htmlForMarkdown\"></span>\n+    </div>\n+    <div class=\"form-group row align-items-end\">\n+        <div class=\"col-md-6\">\n+            <h4 class=\"control-label\" jhiTranslate=\"artemisApp.result.resultString\">Result Text</h4>\n+            <input\n+                type=\"text\"\n+                required\n+                class=\"form-control\"\n+                [readOnly]=\"readOnly()\"\n+                name=\"resultString\"\n+                id=\"resultString\"\n+                [(ngModel)]=\"result.resultString\"\n+                (ngModelChange)=\"onResultModified.emit(result)\"\n+                #resultString=\"ngModel\"\n+            />\n+            <span class=\"text-danger\" *ngIf=\"resultString?.invalid && resultString?.errors?.required\" jhiTranslate=\"artemisApp.result.resultStringRequired\"\n+                >Result text is required.</span\n+            >", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fda6d499b27a1ab19fa83712c7d99afef8f9899"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3Nzc2MTIwOnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/exercises/programming/assess/manual-result/programming-assessment-manual-result-in-code-editor.component.html", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwOToxOTowOFrOHGPWng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwOToxOTowOFrOHGPWng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMwNTA1NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            <input type=\"checkbox\" name=\"successful\" [(ngModel)]=\"result.successful\" [disabled]=\"true\" />&nbsp;<span jhiTranslate=\"artemisApp.result.successful\"\n          \n          \n            \n                                >Successful</span\n          \n          \n            \n                            >\n          \n          \n            \n                            <input type=\"checkbox\" name=\"successful\" [(ngModel)]=\"result.successful\" [disabled]=\"true\" />&nbsp;<span jhiTranslate=\"artemisApp.result.successful\">\n          \n          \n            \n                                Successful\n          \n          \n            \n                            </span>", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476305054", "createdAt": "2020-08-25T09:19:08Z", "author": {"login": "sascha11110"}, "path": "src/main/webapp/app/exercises/programming/assess/manual-result/programming-assessment-manual-result-in-code-editor.component.html", "diffHunk": "@@ -0,0 +1,109 @@\n+<div *ngIf=\"result && !isLoading\" class=\"modal-body\">\n+    <div *ngIf=\"isOpenForSubmission\" class=\"alert alert-warning\">\n+        <strong jhiTranslate=\"artemisApp.result.exerciseStillOpen\">Exercise is still open for submissions!</strong>\n+        <span jhiTranslate=\"artemisApp.result.studentOverride\">\n+            The due date of this exercise is not reached yet. The student could override this manual result by committing a new solution.\n+        </span>\n+    </div>\n+    <div class=\"form-group\" *ngIf=\"exercise.gradingInstructions\">\n+        <h3 for=\"id\" jhiTranslate=\"artemisApp.exercise.gradingInstructions\">Grading Instructions</h3>\n+        <span [innerHTML]=\"exercise.gradingInstructions | htmlForMarkdown\"></span>\n+    </div>\n+    <div class=\"form-group row align-items-end\">\n+        <div class=\"col-md-6\">\n+            <h4 class=\"control-label\" jhiTranslate=\"artemisApp.result.resultString\">Result Text</h4>\n+            <input\n+                type=\"text\"\n+                required\n+                class=\"form-control\"\n+                [readOnly]=\"readOnly()\"\n+                name=\"resultString\"\n+                id=\"resultString\"\n+                [(ngModel)]=\"result.resultString\"\n+                (ngModelChange)=\"onResultModified.emit(result)\"\n+                #resultString=\"ngModel\"\n+            />\n+            <span class=\"text-danger\" *ngIf=\"resultString?.invalid && resultString?.errors?.required\" jhiTranslate=\"artemisApp.result.resultStringRequired\"\n+                >Result text is required.</span\n+            >\n+        </div>\n+    </div>\n+    <div class=\"form-group row align-items-end\">\n+        <div class=\"col-md-6\">\n+            <h4 class=\"control-label\" jhiTranslate=\"artemisApp.result.scorePercentage\">Score (in %)</h4>\n+            <input\n+                type=\"number\"\n+                [pattern]=\"SCORE_PATTERN\"\n+                required\n+                class=\"form-control\"\n+                name=\"score\"\n+                id=\"field_score\"\n+                [readOnly]=\"readOnly()\"\n+                [(ngModel)]=\"result.score\"\n+                (ngModelChange)=\"updateResultSuccess()\"\n+                #score=\"ngModel\"\n+            />\n+            <span class=\"text-danger\" *ngIf=\"score.dirty && score.invalid\" jhiTranslate=\"artemisApp.result.invalidScore\">Score is required and should be a number.</span>\n+        </div>\n+        <div class=\"checkbox col-md-6\">\n+            <label class=\"artemis-label\">\n+                <input type=\"checkbox\" name=\"successful\" [(ngModel)]=\"result.successful\" [disabled]=\"true\" />&nbsp;<span jhiTranslate=\"artemisApp.result.successful\"\n+                    >Successful</span\n+                >", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fda6d499b27a1ab19fa83712c7d99afef8f9899"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3Nzc2MzMyOnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/exercises/programming/assess/manual-result/programming-assessment-manual-result-in-code-editor.component.html", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwOToxOTo0MFrOHGPX8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwOToxOTo0MFrOHGPX8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMwNTM5NQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            <span class=\"text-danger\" *ngIf=\"feedbackText?.invalid && feedbackText?.errors?.required\" jhiTranslate=\"artemisApp.result.feedbackTextRequired\"\n          \n          \n            \n                                >Feedback text is required.</span\n          \n          \n            \n                            >\n          \n          \n            \n                            <span class=\"text-danger\" *ngIf=\"feedbackText?.invalid && feedbackText?.errors?.required\" jhiTranslate=\"artemisApp.result.feedbackTextRequired\">\n          \n          \n            \n                                Feedback text is required.\n          \n          \n            \n                            </span>", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476305395", "createdAt": "2020-08-25T09:19:40Z", "author": {"login": "sascha11110"}, "path": "src/main/webapp/app/exercises/programming/assess/manual-result/programming-assessment-manual-result-in-code-editor.component.html", "diffHunk": "@@ -0,0 +1,109 @@\n+<div *ngIf=\"result && !isLoading\" class=\"modal-body\">\n+    <div *ngIf=\"isOpenForSubmission\" class=\"alert alert-warning\">\n+        <strong jhiTranslate=\"artemisApp.result.exerciseStillOpen\">Exercise is still open for submissions!</strong>\n+        <span jhiTranslate=\"artemisApp.result.studentOverride\">\n+            The due date of this exercise is not reached yet. The student could override this manual result by committing a new solution.\n+        </span>\n+    </div>\n+    <div class=\"form-group\" *ngIf=\"exercise.gradingInstructions\">\n+        <h3 for=\"id\" jhiTranslate=\"artemisApp.exercise.gradingInstructions\">Grading Instructions</h3>\n+        <span [innerHTML]=\"exercise.gradingInstructions | htmlForMarkdown\"></span>\n+    </div>\n+    <div class=\"form-group row align-items-end\">\n+        <div class=\"col-md-6\">\n+            <h4 class=\"control-label\" jhiTranslate=\"artemisApp.result.resultString\">Result Text</h4>\n+            <input\n+                type=\"text\"\n+                required\n+                class=\"form-control\"\n+                [readOnly]=\"readOnly()\"\n+                name=\"resultString\"\n+                id=\"resultString\"\n+                [(ngModel)]=\"result.resultString\"\n+                (ngModelChange)=\"onResultModified.emit(result)\"\n+                #resultString=\"ngModel\"\n+            />\n+            <span class=\"text-danger\" *ngIf=\"resultString?.invalid && resultString?.errors?.required\" jhiTranslate=\"artemisApp.result.resultStringRequired\"\n+                >Result text is required.</span\n+            >\n+        </div>\n+    </div>\n+    <div class=\"form-group row align-items-end\">\n+        <div class=\"col-md-6\">\n+            <h4 class=\"control-label\" jhiTranslate=\"artemisApp.result.scorePercentage\">Score (in %)</h4>\n+            <input\n+                type=\"number\"\n+                [pattern]=\"SCORE_PATTERN\"\n+                required\n+                class=\"form-control\"\n+                name=\"score\"\n+                id=\"field_score\"\n+                [readOnly]=\"readOnly()\"\n+                [(ngModel)]=\"result.score\"\n+                (ngModelChange)=\"updateResultSuccess()\"\n+                #score=\"ngModel\"\n+            />\n+            <span class=\"text-danger\" *ngIf=\"score.dirty && score.invalid\" jhiTranslate=\"artemisApp.result.invalidScore\">Score is required and should be a number.</span>\n+        </div>\n+        <div class=\"checkbox col-md-6\">\n+            <label class=\"artemis-label\">\n+                <input type=\"checkbox\" name=\"successful\" [(ngModel)]=\"result.successful\" [disabled]=\"true\" />&nbsp;<span jhiTranslate=\"artemisApp.result.successful\"\n+                    >Successful</span\n+                >\n+            </label>\n+        </div>\n+    </div>\n+    <div class=\"form-group mb-0\" *ngIf=\"!readOnly()\">\n+        <a [hidden]=\"feedbacks.length > 0\" (click)=\"pushFeedback()\" jhiTranslate=\"artemisApp.result.addFeedback\">Add feedback</a>\n+    </div>\n+    <div *ngIf=\"feedbacks.length > 0\">\n+        <div *ngFor=\"let feedback of feedbacks; let i = index\">\n+            <div class=\"form-group\">\n+                <label class=\"control-label\" [ngClass]=\"{ negative: !feedback || !feedback.positive, positive: feedback.positive }\"> Feedback #{{ i + 1 }} Text </label>\n+                <input\n+                    type=\"text\"\n+                    class=\"form-control\"\n+                    name=\"feedbackText{{ i }}\"\n+                    [readOnly]=\"readOnly()\"\n+                    required\n+                    [(ngModel)]=\"feedback.text\"\n+                    (ngModelChange)=\"updateResultFeedbacks()\"\n+                    #feedbackText=\"ngModel\"\n+                />\n+                <span class=\"text-danger\" *ngIf=\"feedbackText?.invalid && feedbackText?.errors?.required\" jhiTranslate=\"artemisApp.result.feedbackTextRequired\"\n+                    >Feedback text is required.</span\n+                >", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fda6d499b27a1ab19fa83712c7d99afef8f9899"}, "originalPosition": 75}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3OTE5ODM4OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/ProgrammingAssessmentService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNToxNjozOVrOHGdE2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNzozMjowOFrOHGiqhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjUyOTg4Mw==", "bodyText": "I am not that familiar with hibernate, but why are you using @transactional here?", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476529883", "createdAt": "2020-08-25T15:16:39Z", "author": {"login": "TobiasPr"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ProgrammingAssessmentService.java", "diffHunk": "@@ -33,4 +40,53 @@ public Result updateAssessmentAfterComplaint(Result originalResult, Exercise exe\n         originalResult.setScore(assessmentUpdate.getScore());\n         return super.updateAssessmentAfterComplaint(originalResult, exercise, assessmentUpdate);\n     }\n+\n+    /**\n+     * This function is used for saving a manual assessment/result. It sets the assessment type to MANUAL and sets the assessor attribute. Furthermore, it saves the result in the\n+     * database.\n+     *\n+     * @param result the new result of a programming exercise\n+     * @return result that was saved in the database\n+     */\n+    @Transactional\n+    public Result saveManualAssessment(Result result) {\n+        Boolean isFeedbackEmpty = result.getFeedbacks().isEmpty();\n+        result.setHasFeedback(!isFeedbackEmpty);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+        result.setHasComplaint(false);\n+        result.setAssessmentType(AssessmentType.MANUAL);\n+        result.setAssessor(user);\n+\n+        result.setCompletionDate(null);\n+        result.setRated(false);\n+\n+        result.getFeedbacks().forEach(feedback -> {\n+            feedback.setResult(result);\n+        });\n+\n+        // Note: This also saves the feedback objects in the database because of the 'cascade = CascadeType.ALL' option.\n+        return resultRepository.save(result);\n+    }\n+\n+    /**\n+     * This function is used for submitting a manual assessment/result. It gets the result that belongs to the given resultId, updates the completion date, sets the assessment type\n+     * to MANUAL and sets the assessor attribute. Afterwards, it saves the update result in the database again.\n+     *\n+     * @param resultId the id of the result that should be submitted\n+     * @return the ResponseEntity with result as body\n+     */\n+    @Transactional", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2b3373fcd891258a372add5b829447ca0c170af"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYyMTQ0NQ==", "bodyText": "To be honst, I am neither. I orientated myself to how it is done for the other exercise types. There, we used @Transactional see https://github.com/ls1intum/Artemis/blob/develop/src/main/java/de/tum/in/www1/artemis/service/ModelingAssessmentService.java#L79\nthat's why I used it as well to keep it consistent to the other exercises.", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476621445", "createdAt": "2020-08-25T17:32:08Z", "author": {"login": "fde312"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ProgrammingAssessmentService.java", "diffHunk": "@@ -33,4 +40,53 @@ public Result updateAssessmentAfterComplaint(Result originalResult, Exercise exe\n         originalResult.setScore(assessmentUpdate.getScore());\n         return super.updateAssessmentAfterComplaint(originalResult, exercise, assessmentUpdate);\n     }\n+\n+    /**\n+     * This function is used for saving a manual assessment/result. It sets the assessment type to MANUAL and sets the assessor attribute. Furthermore, it saves the result in the\n+     * database.\n+     *\n+     * @param result the new result of a programming exercise\n+     * @return result that was saved in the database\n+     */\n+    @Transactional\n+    public Result saveManualAssessment(Result result) {\n+        Boolean isFeedbackEmpty = result.getFeedbacks().isEmpty();\n+        result.setHasFeedback(!isFeedbackEmpty);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+        result.setHasComplaint(false);\n+        result.setAssessmentType(AssessmentType.MANUAL);\n+        result.setAssessor(user);\n+\n+        result.setCompletionDate(null);\n+        result.setRated(false);\n+\n+        result.getFeedbacks().forEach(feedback -> {\n+            feedback.setResult(result);\n+        });\n+\n+        // Note: This also saves the feedback objects in the database because of the 'cascade = CascadeType.ALL' option.\n+        return resultRepository.save(result);\n+    }\n+\n+    /**\n+     * This function is used for submitting a manual assessment/result. It gets the result that belongs to the given resultId, updates the completion date, sets the assessment type\n+     * to MANUAL and sets the assessor attribute. Afterwards, it saves the update result in the database again.\n+     *\n+     * @param resultId the id of the result that should be submitted\n+     * @return the ResponseEntity with result as body\n+     */\n+    @Transactional", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjUyOTg4Mw=="}, "originalCommit": {"oid": "d2b3373fcd891258a372add5b829447ca0c170af"}, "originalPosition": 68}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3OTI0NDQzOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNToyNjo0MlrOHGdhow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNzo0NDoyMlrOHGjFuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjUzNzI1MQ==", "bodyText": "Wouldn't it be easier to check the submission directly for null, before setting the submission of the newResult and getting it again? Just for readability", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476537251", "createdAt": "2020-08-25T15:26:42Z", "author": {"login": "TobiasPr"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,112 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,\n+            @RequestBody Result newResult) {\n+        log.debug(\"REST request to save a new result : {}\", newResult);\n+        final var participation = participationService.findOneWithEagerResultsAndCourse(participationId);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+\n+        Optional<Result> latestExistingResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.MANUAL).findFirst();\n+        if (latestExistingResult.isPresent()) {\n+            // prevent that tutors create multiple manual results\n+            newResult.setId(latestExistingResult.get().getId());\n+            // load assessor\n+            latestExistingResult = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(latestExistingResult.get().getId());\n+        }\n+\n+        // make sure that the participation cannot be manipulated on the client side\n+        newResult.setParticipation(participation);\n+\n+        ProgrammingExercise exercise = (ProgrammingExercise) participation.getExercise();\n+        checkAuthorization(exercise, user);\n+\n+        final var isAtLeastInstructor = authCheckService.isAtLeastInstructorForExercise(exercise, user);\n+        if (!assessmentService.isAllowedToCreateOrOverrideResult(latestExistingResult.orElse(null), exercise, participation, user, isAtLeastInstructor)) {\n+            log.debug(\"The user \" + user.getLogin() + \" is not allowed to override the assessment for the participation \" + participation.getId() + \" for User \" + user.getLogin());\n+            return forbidden(\"assessment\", \"assessmentSaveNotAllowed\", \"The user is not allowed to override the assessment\");\n+        }\n+\n+        final var course = exercise.getCourseViaExerciseGroupOrCourseMember();\n+        if (!authCheckService.isAtLeastTeachingAssistantInCourse(course, user) || !exercise.areManualResultsAllowed()) {\n+            return forbidden();\n+        }\n+\n+        if (newResult.getResultString() == null) {\n+            throw new BadRequestAlertException(\"Result string is required.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getResultString().length() > 255) {\n+            throw new BadRequestAlertException(\"Result string is too long.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getScore() == null) {\n+            throw new BadRequestAlertException(\"Score is required.\", ENTITY_NAME, \"scoreNull\");\n+        }\n+        else if (newResult.getScore() < 100 && newResult.isSuccessful()) {\n+            throw new BadRequestAlertException(\"Only result with score 100% can be successful.\", ENTITY_NAME, \"scoreAndSuccessfulNotMatching\");\n+        }\n+        else if (!newResult.getFeedbacks().isEmpty() && newResult.getFeedbacks().stream().anyMatch(feedback -> feedback.getText() == null)) {\n+            throw new BadRequestAlertException(\"In case feedback is present, feedback text and detail text are mandatory.\", ENTITY_NAME, \"feedbackTextOrDetailTextNull\");\n+        }\n+\n+        ProgrammingSubmission submission;\n+        if (latestExistingResult.isEmpty()) {\n+            // TODO: Double check if we can create a new result when the existing result has already a completion date (submitted)\n+            // Create manual submission with last commit hash und current time stamp.\n+            submission = programmingSubmissionService.createSubmissionWithLastCommitHashForParticipation((ProgrammingExerciseStudentParticipation) participation,\n+                    SubmissionType.MANUAL);\n+            newResult.setSubmission(submission);\n+        }\n+        else {\n+            submission = programmingSubmissionService.findByIdWithEagerResultAndFeedback(latestExistingResult.get().getSubmission().getId());\n+            newResult.setSubmission(submission);\n+            if (newResult.getSubmission() == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2b3373fcd891258a372add5b829447ca0c170af"}, "originalPosition": 135}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYyODQwOA==", "bodyText": "Good catch! Fixed in  2f9193f", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476628408", "createdAt": "2020-08-25T17:44:22Z", "author": {"login": "fde312"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,112 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,\n+            @RequestBody Result newResult) {\n+        log.debug(\"REST request to save a new result : {}\", newResult);\n+        final var participation = participationService.findOneWithEagerResultsAndCourse(participationId);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+\n+        Optional<Result> latestExistingResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.MANUAL).findFirst();\n+        if (latestExistingResult.isPresent()) {\n+            // prevent that tutors create multiple manual results\n+            newResult.setId(latestExistingResult.get().getId());\n+            // load assessor\n+            latestExistingResult = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(latestExistingResult.get().getId());\n+        }\n+\n+        // make sure that the participation cannot be manipulated on the client side\n+        newResult.setParticipation(participation);\n+\n+        ProgrammingExercise exercise = (ProgrammingExercise) participation.getExercise();\n+        checkAuthorization(exercise, user);\n+\n+        final var isAtLeastInstructor = authCheckService.isAtLeastInstructorForExercise(exercise, user);\n+        if (!assessmentService.isAllowedToCreateOrOverrideResult(latestExistingResult.orElse(null), exercise, participation, user, isAtLeastInstructor)) {\n+            log.debug(\"The user \" + user.getLogin() + \" is not allowed to override the assessment for the participation \" + participation.getId() + \" for User \" + user.getLogin());\n+            return forbidden(\"assessment\", \"assessmentSaveNotAllowed\", \"The user is not allowed to override the assessment\");\n+        }\n+\n+        final var course = exercise.getCourseViaExerciseGroupOrCourseMember();\n+        if (!authCheckService.isAtLeastTeachingAssistantInCourse(course, user) || !exercise.areManualResultsAllowed()) {\n+            return forbidden();\n+        }\n+\n+        if (newResult.getResultString() == null) {\n+            throw new BadRequestAlertException(\"Result string is required.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getResultString().length() > 255) {\n+            throw new BadRequestAlertException(\"Result string is too long.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getScore() == null) {\n+            throw new BadRequestAlertException(\"Score is required.\", ENTITY_NAME, \"scoreNull\");\n+        }\n+        else if (newResult.getScore() < 100 && newResult.isSuccessful()) {\n+            throw new BadRequestAlertException(\"Only result with score 100% can be successful.\", ENTITY_NAME, \"scoreAndSuccessfulNotMatching\");\n+        }\n+        else if (!newResult.getFeedbacks().isEmpty() && newResult.getFeedbacks().stream().anyMatch(feedback -> feedback.getText() == null)) {\n+            throw new BadRequestAlertException(\"In case feedback is present, feedback text and detail text are mandatory.\", ENTITY_NAME, \"feedbackTextOrDetailTextNull\");\n+        }\n+\n+        ProgrammingSubmission submission;\n+        if (latestExistingResult.isEmpty()) {\n+            // TODO: Double check if we can create a new result when the existing result has already a completion date (submitted)\n+            // Create manual submission with last commit hash und current time stamp.\n+            submission = programmingSubmissionService.createSubmissionWithLastCommitHashForParticipation((ProgrammingExerciseStudentParticipation) participation,\n+                    SubmissionType.MANUAL);\n+            newResult.setSubmission(submission);\n+        }\n+        else {\n+            submission = programmingSubmissionService.findByIdWithEagerResultAndFeedback(latestExistingResult.get().getSubmission().getId());\n+            newResult.setSubmission(submission);\n+            if (newResult.getSubmission() == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjUzNzI1MQ=="}, "originalCommit": {"oid": "d2b3373fcd891258a372add5b829447ca0c170af"}, "originalPosition": 135}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4MDMxNjY0OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/ProgrammingAssessmentService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQyMDowNzo0OFrOHGn5vQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQyMToxMzozMFrOHGp8Vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjcwNzI2MQ==", "bodyText": "You can do this in one line like result.setHasFeedback(!result.getFeedbacks().isEmpty());", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476707261", "createdAt": "2020-08-25T20:07:48Z", "author": {"login": "kloessst"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ProgrammingAssessmentService.java", "diffHunk": "@@ -33,4 +40,53 @@ public Result updateAssessmentAfterComplaint(Result originalResult, Exercise exe\n         originalResult.setScore(assessmentUpdate.getScore());\n         return super.updateAssessmentAfterComplaint(originalResult, exercise, assessmentUpdate);\n     }\n+\n+    /**\n+     * This function is used for saving a manual assessment/result. It sets the assessment type to MANUAL and sets the assessor attribute. Furthermore, it saves the result in the\n+     * database.\n+     *\n+     * @param result the new result of a programming exercise\n+     * @return result that was saved in the database\n+     */\n+    @Transactional\n+    public Result saveManualAssessment(Result result) {\n+        Boolean isFeedbackEmpty = result.getFeedbacks().isEmpty();\n+        result.setHasFeedback(!isFeedbackEmpty);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d2ee2f3ee689b85f34bf985f989e30af890eed1"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc0MDY5NA==", "bodyText": "Done in 46457a4", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476740694", "createdAt": "2020-08-25T21:13:30Z", "author": {"login": "fde312"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ProgrammingAssessmentService.java", "diffHunk": "@@ -33,4 +40,53 @@ public Result updateAssessmentAfterComplaint(Result originalResult, Exercise exe\n         originalResult.setScore(assessmentUpdate.getScore());\n         return super.updateAssessmentAfterComplaint(originalResult, exercise, assessmentUpdate);\n     }\n+\n+    /**\n+     * This function is used for saving a manual assessment/result. It sets the assessment type to MANUAL and sets the assessor attribute. Furthermore, it saves the result in the\n+     * database.\n+     *\n+     * @param result the new result of a programming exercise\n+     * @return result that was saved in the database\n+     */\n+    @Transactional\n+    public Result saveManualAssessment(Result result) {\n+        Boolean isFeedbackEmpty = result.getFeedbacks().isEmpty();\n+        result.setHasFeedback(!isFeedbackEmpty);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjcwNzI2MQ=="}, "originalCommit": {"oid": "8d2ee2f3ee689b85f34bf985f989e30af890eed1"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4MDM4MjMwOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQyMDoyODozM1rOHGoifQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQyMToxNDoxOFrOHGp95Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjcxNzY5Mw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        // Create manual submission with last commit hash und current time stamp.\n          \n          \n            \n                        // Create manual submission with last commit hash and current time stamp.", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476717693", "createdAt": "2020-08-25T20:28:33Z", "author": {"login": "kloessst"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,111 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,\n+            @RequestBody Result newResult) {\n+        log.debug(\"REST request to save a new result : {}\", newResult);\n+        final var participation = participationService.findOneWithEagerResultsAndCourse(participationId);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+\n+        Optional<Result> latestExistingResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.MANUAL).findFirst();\n+        if (latestExistingResult.isPresent()) {\n+            // prevent that tutors create multiple manual results\n+            newResult.setId(latestExistingResult.get().getId());\n+            // load assessor\n+            latestExistingResult = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(latestExistingResult.get().getId());\n+        }\n+\n+        // make sure that the participation cannot be manipulated on the client side\n+        newResult.setParticipation(participation);\n+\n+        ProgrammingExercise exercise = (ProgrammingExercise) participation.getExercise();\n+        checkAuthorization(exercise, user);\n+\n+        final var isAtLeastInstructor = authCheckService.isAtLeastInstructorForExercise(exercise, user);\n+        if (!assessmentService.isAllowedToCreateOrOverrideResult(latestExistingResult.orElse(null), exercise, participation, user, isAtLeastInstructor)) {\n+            log.debug(\"The user \" + user.getLogin() + \" is not allowed to override the assessment for the participation \" + participation.getId() + \" for User \" + user.getLogin());\n+            return forbidden(\"assessment\", \"assessmentSaveNotAllowed\", \"The user is not allowed to override the assessment\");\n+        }\n+\n+        if (!exercise.areManualResultsAllowed()) {\n+            return forbidden();\n+        }\n+\n+        if (newResult.getResultString() == null) {\n+            throw new BadRequestAlertException(\"Result string is required.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getResultString().length() > 255) {\n+            throw new BadRequestAlertException(\"Result string is too long.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getScore() == null) {\n+            throw new BadRequestAlertException(\"Score is required.\", ENTITY_NAME, \"scoreNull\");\n+        }\n+        else if (newResult.getScore() < 100 && newResult.isSuccessful()) {\n+            throw new BadRequestAlertException(\"Only result with score 100% can be successful.\", ENTITY_NAME, \"scoreAndSuccessfulNotMatching\");\n+        }\n+        else if (!newResult.getFeedbacks().isEmpty() && newResult.getFeedbacks().stream().anyMatch(feedback -> feedback.getText() == null)) {\n+            throw new BadRequestAlertException(\"In case feedback is present, feedback text and detail text are mandatory.\", ENTITY_NAME, \"feedbackTextOrDetailTextNull\");\n+        }\n+\n+        ProgrammingSubmission submission;\n+        if (latestExistingResult.isEmpty()) {\n+            // Create manual submission with last commit hash und current time stamp.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d2ee2f3ee689b85f34bf985f989e30af890eed1"}, "originalPosition": 125}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc0MTA5Mw==", "bodyText": "Done in 46457a4", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476741093", "createdAt": "2020-08-25T21:14:18Z", "author": {"login": "fde312"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,111 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,\n+            @RequestBody Result newResult) {\n+        log.debug(\"REST request to save a new result : {}\", newResult);\n+        final var participation = participationService.findOneWithEagerResultsAndCourse(participationId);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+\n+        Optional<Result> latestExistingResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.MANUAL).findFirst();\n+        if (latestExistingResult.isPresent()) {\n+            // prevent that tutors create multiple manual results\n+            newResult.setId(latestExistingResult.get().getId());\n+            // load assessor\n+            latestExistingResult = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(latestExistingResult.get().getId());\n+        }\n+\n+        // make sure that the participation cannot be manipulated on the client side\n+        newResult.setParticipation(participation);\n+\n+        ProgrammingExercise exercise = (ProgrammingExercise) participation.getExercise();\n+        checkAuthorization(exercise, user);\n+\n+        final var isAtLeastInstructor = authCheckService.isAtLeastInstructorForExercise(exercise, user);\n+        if (!assessmentService.isAllowedToCreateOrOverrideResult(latestExistingResult.orElse(null), exercise, participation, user, isAtLeastInstructor)) {\n+            log.debug(\"The user \" + user.getLogin() + \" is not allowed to override the assessment for the participation \" + participation.getId() + \" for User \" + user.getLogin());\n+            return forbidden(\"assessment\", \"assessmentSaveNotAllowed\", \"The user is not allowed to override the assessment\");\n+        }\n+\n+        if (!exercise.areManualResultsAllowed()) {\n+            return forbidden();\n+        }\n+\n+        if (newResult.getResultString() == null) {\n+            throw new BadRequestAlertException(\"Result string is required.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getResultString().length() > 255) {\n+            throw new BadRequestAlertException(\"Result string is too long.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getScore() == null) {\n+            throw new BadRequestAlertException(\"Score is required.\", ENTITY_NAME, \"scoreNull\");\n+        }\n+        else if (newResult.getScore() < 100 && newResult.isSuccessful()) {\n+            throw new BadRequestAlertException(\"Only result with score 100% can be successful.\", ENTITY_NAME, \"scoreAndSuccessfulNotMatching\");\n+        }\n+        else if (!newResult.getFeedbacks().isEmpty() && newResult.getFeedbacks().stream().anyMatch(feedback -> feedback.getText() == null)) {\n+            throw new BadRequestAlertException(\"In case feedback is present, feedback text and detail text are mandatory.\", ENTITY_NAME, \"feedbackTextOrDetailTextNull\");\n+        }\n+\n+        ProgrammingSubmission submission;\n+        if (latestExistingResult.isEmpty()) {\n+            // Create manual submission with last commit hash und current time stamp.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjcxNzY5Mw=="}, "originalCommit": {"oid": "8d2ee2f3ee689b85f34bf985f989e30af890eed1"}, "originalPosition": 125}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4MDM5MTU0OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQyMDozMToxMlrOHGooCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQyMToyMDo1OVrOHGqOww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjcxOTExMw==", "bodyText": "I think the service will throw an EntityNotFoundException if no submission was found so you don't need the check", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476719113", "createdAt": "2020-08-25T20:31:12Z", "author": {"login": "kloessst"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,111 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,\n+            @RequestBody Result newResult) {\n+        log.debug(\"REST request to save a new result : {}\", newResult);\n+        final var participation = participationService.findOneWithEagerResultsAndCourse(participationId);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+\n+        Optional<Result> latestExistingResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.MANUAL).findFirst();\n+        if (latestExistingResult.isPresent()) {\n+            // prevent that tutors create multiple manual results\n+            newResult.setId(latestExistingResult.get().getId());\n+            // load assessor\n+            latestExistingResult = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(latestExistingResult.get().getId());\n+        }\n+\n+        // make sure that the participation cannot be manipulated on the client side\n+        newResult.setParticipation(participation);\n+\n+        ProgrammingExercise exercise = (ProgrammingExercise) participation.getExercise();\n+        checkAuthorization(exercise, user);\n+\n+        final var isAtLeastInstructor = authCheckService.isAtLeastInstructorForExercise(exercise, user);\n+        if (!assessmentService.isAllowedToCreateOrOverrideResult(latestExistingResult.orElse(null), exercise, participation, user, isAtLeastInstructor)) {\n+            log.debug(\"The user \" + user.getLogin() + \" is not allowed to override the assessment for the participation \" + participation.getId() + \" for User \" + user.getLogin());\n+            return forbidden(\"assessment\", \"assessmentSaveNotAllowed\", \"The user is not allowed to override the assessment\");\n+        }\n+\n+        if (!exercise.areManualResultsAllowed()) {\n+            return forbidden();\n+        }\n+\n+        if (newResult.getResultString() == null) {\n+            throw new BadRequestAlertException(\"Result string is required.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getResultString().length() > 255) {\n+            throw new BadRequestAlertException(\"Result string is too long.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getScore() == null) {\n+            throw new BadRequestAlertException(\"Score is required.\", ENTITY_NAME, \"scoreNull\");\n+        }\n+        else if (newResult.getScore() < 100 && newResult.isSuccessful()) {\n+            throw new BadRequestAlertException(\"Only result with score 100% can be successful.\", ENTITY_NAME, \"scoreAndSuccessfulNotMatching\");\n+        }\n+        else if (!newResult.getFeedbacks().isEmpty() && newResult.getFeedbacks().stream().anyMatch(feedback -> feedback.getText() == null)) {\n+            throw new BadRequestAlertException(\"In case feedback is present, feedback text and detail text are mandatory.\", ENTITY_NAME, \"feedbackTextOrDetailTextNull\");\n+        }\n+\n+        ProgrammingSubmission submission;\n+        if (latestExistingResult.isEmpty()) {\n+            // Create manual submission with last commit hash und current time stamp.\n+            submission = programmingSubmissionService.createSubmissionWithLastCommitHashForParticipation((ProgrammingExerciseStudentParticipation) participation,\n+                    SubmissionType.MANUAL);\n+            newResult.setSubmission(submission);\n+        }\n+        else {\n+            submission = programmingSubmissionService.findByIdWithEagerResultAndFeedback(latestExistingResult.get().getSubmission().getId());\n+            if (submission == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d2ee2f3ee689b85f34bf985f989e30af890eed1"}, "originalPosition": 132}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc0NTQxMQ==", "bodyText": "you are right, very good catch! Done in 46457a4", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476745411", "createdAt": "2020-08-25T21:20:59Z", "author": {"login": "fde312"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,111 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,\n+            @RequestBody Result newResult) {\n+        log.debug(\"REST request to save a new result : {}\", newResult);\n+        final var participation = participationService.findOneWithEagerResultsAndCourse(participationId);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+\n+        Optional<Result> latestExistingResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.MANUAL).findFirst();\n+        if (latestExistingResult.isPresent()) {\n+            // prevent that tutors create multiple manual results\n+            newResult.setId(latestExistingResult.get().getId());\n+            // load assessor\n+            latestExistingResult = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(latestExistingResult.get().getId());\n+        }\n+\n+        // make sure that the participation cannot be manipulated on the client side\n+        newResult.setParticipation(participation);\n+\n+        ProgrammingExercise exercise = (ProgrammingExercise) participation.getExercise();\n+        checkAuthorization(exercise, user);\n+\n+        final var isAtLeastInstructor = authCheckService.isAtLeastInstructorForExercise(exercise, user);\n+        if (!assessmentService.isAllowedToCreateOrOverrideResult(latestExistingResult.orElse(null), exercise, participation, user, isAtLeastInstructor)) {\n+            log.debug(\"The user \" + user.getLogin() + \" is not allowed to override the assessment for the participation \" + participation.getId() + \" for User \" + user.getLogin());\n+            return forbidden(\"assessment\", \"assessmentSaveNotAllowed\", \"The user is not allowed to override the assessment\");\n+        }\n+\n+        if (!exercise.areManualResultsAllowed()) {\n+            return forbidden();\n+        }\n+\n+        if (newResult.getResultString() == null) {\n+            throw new BadRequestAlertException(\"Result string is required.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getResultString().length() > 255) {\n+            throw new BadRequestAlertException(\"Result string is too long.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getScore() == null) {\n+            throw new BadRequestAlertException(\"Score is required.\", ENTITY_NAME, \"scoreNull\");\n+        }\n+        else if (newResult.getScore() < 100 && newResult.isSuccessful()) {\n+            throw new BadRequestAlertException(\"Only result with score 100% can be successful.\", ENTITY_NAME, \"scoreAndSuccessfulNotMatching\");\n+        }\n+        else if (!newResult.getFeedbacks().isEmpty() && newResult.getFeedbacks().stream().anyMatch(feedback -> feedback.getText() == null)) {\n+            throw new BadRequestAlertException(\"In case feedback is present, feedback text and detail text are mandatory.\", ENTITY_NAME, \"feedbackTextOrDetailTextNull\");\n+        }\n+\n+        ProgrammingSubmission submission;\n+        if (latestExistingResult.isEmpty()) {\n+            // Create manual submission with last commit hash und current time stamp.\n+            submission = programmingSubmissionService.createSubmissionWithLastCommitHashForParticipation((ProgrammingExerciseStudentParticipation) participation,\n+                    SubmissionType.MANUAL);\n+            newResult.setSubmission(submission);\n+        }\n+        else {\n+            submission = programmingSubmissionService.findByIdWithEagerResultAndFeedback(latestExistingResult.get().getSubmission().getId());\n+            if (submission == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjcxOTExMw=="}, "originalCommit": {"oid": "8d2ee2f3ee689b85f34bf985f989e30af890eed1"}, "originalPosition": 132}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4MDQ1OTcyOnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/exercises/programming/assess/manual-result/programming-assessment-manual-result-in-code-editor.component.ts", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQyMDo1MjoxN1rOHGpSEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQyMToyNjoyMVrOHGqh8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjcyOTg3NQ==", "bodyText": "Condition should be >100 as you might reach more than 100% in the future with bonus points.", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476729875", "createdAt": "2020-08-25T20:52:17Z", "author": {"login": "kloessst"}, "path": "src/main/webapp/app/exercises/programming/assess/manual-result/programming-assessment-manual-result-in-code-editor.component.ts", "diffHunk": "@@ -291,6 +169,26 @@ export class ProgrammingAssessmentManualResultDialogComponent implements OnInit\n     writable() {\n         // TODO: this is still not ideal and we should either distinguish between tutors and instructors here or allow to override accepted / rejected complaints\n         // at the moment instructors can still edit already accepted / rejected complaints because the first condition is true, however we do not yet allow to override complaints\n-        return this.canOverride || (this.complaint !== undefined && this.complaint.accepted === undefined);\n+        return this.canOverride || (this.complaint !== undefined && this.complaint.accepted === undefined && this.result.assessor.id !== this.user.id);\n+    }\n+    /**\n+     * Updates if the result is successful (score of 100%) or not\n+     * and emits the updated result to the parent component\n+     */\n+    updateResultSuccess() {\n+        this.result.successful = this.result.score === 100;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d2ee2f3ee689b85f34bf985f989e30af890eed1"}, "originalPosition": 272}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc1MDMyMQ==", "bodyText": "Done, changed to >= 100 in 46457a4", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476750321", "createdAt": "2020-08-25T21:26:21Z", "author": {"login": "fde312"}, "path": "src/main/webapp/app/exercises/programming/assess/manual-result/programming-assessment-manual-result-in-code-editor.component.ts", "diffHunk": "@@ -291,6 +169,26 @@ export class ProgrammingAssessmentManualResultDialogComponent implements OnInit\n     writable() {\n         // TODO: this is still not ideal and we should either distinguish between tutors and instructors here or allow to override accepted / rejected complaints\n         // at the moment instructors can still edit already accepted / rejected complaints because the first condition is true, however we do not yet allow to override complaints\n-        return this.canOverride || (this.complaint !== undefined && this.complaint.accepted === undefined);\n+        return this.canOverride || (this.complaint !== undefined && this.complaint.accepted === undefined && this.result.assessor.id !== this.user.id);\n+    }\n+    /**\n+     * Updates if the result is successful (score of 100%) or not\n+     * and emits the updated result to the parent component\n+     */\n+    updateResultSuccess() {\n+        this.result.successful = this.result.score === 100;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjcyOTg3NQ=="}, "originalCommit": {"oid": "8d2ee2f3ee689b85f34bf985f989e30af890eed1"}, "originalPosition": 272}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4MDQ3NTk2OnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/exercises/programming/shared/utils/programming-exercise.utils.ts", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQyMDo1Njo0M1rOHGpb1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQyMTozNDo1NFrOHGq_Bg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjczMjM3NQ==", "bodyText": "Are all results without an completionDate legacy?", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476732375", "createdAt": "2020-08-25T20:56:43Z", "author": {"login": "kloessst"}, "path": "src/main/webapp/app/exercises/programming/shared/utils/programming-exercise.utils.ts", "diffHunk": "@@ -11,7 +11,11 @@ import { ProgrammingExercise } from 'app/entities/programming-exercise.model';\n const BAMBOO_RESULT_LEGACY_TIMESTAMP = 1557526348000;\n \n export const isLegacyResult = (result: Result) => {\n-    return result.completionDate!.valueOf() < BAMBOO_RESULT_LEGACY_TIMESTAMP;\n+    if (result.completionDate) {\n+        return result.completionDate.valueOf() < BAMBOO_RESULT_LEGACY_TIMESTAMP;\n+    } else {\n+        return true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d2ee2f3ee689b85f34bf985f989e30af890eed1"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc1Nzc2Ng==", "bodyText": "Very good catch! With this PR we introduce that results can also have no completionDate (when saving and but not yet submitted). Therefore this should be false :)\nChange in 46457a4", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476757766", "createdAt": "2020-08-25T21:34:54Z", "author": {"login": "fde312"}, "path": "src/main/webapp/app/exercises/programming/shared/utils/programming-exercise.utils.ts", "diffHunk": "@@ -11,7 +11,11 @@ import { ProgrammingExercise } from 'app/entities/programming-exercise.model';\n const BAMBOO_RESULT_LEGACY_TIMESTAMP = 1557526348000;\n \n export const isLegacyResult = (result: Result) => {\n-    return result.completionDate!.valueOf() < BAMBOO_RESULT_LEGACY_TIMESTAMP;\n+    if (result.completionDate) {\n+        return result.completionDate.valueOf() < BAMBOO_RESULT_LEGACY_TIMESTAMP;\n+    } else {\n+        return true;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjczMjM3NQ=="}, "originalCommit": {"oid": "8d2ee2f3ee689b85f34bf985f989e30af890eed1"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4MDgxNDQ2OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingExerciseParticipationResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQyMjoxMToxNlrOHGszoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQyMjozNzoyOFrOHGt_xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc4NzYxNw==", "bodyText": "why should a user be allowed to call this resource?", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476787617", "createdAt": "2020-08-25T22:11:16Z", "author": {"login": "krusche"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingExerciseParticipationResource.java", "diffHunk": "@@ -76,6 +76,30 @@ public ProgrammingExerciseParticipationResource(ProgrammingExerciseParticipation\n         return ResponseEntity.ok(participation.get());\n     }\n \n+    /**\n+     * Get the given student participation with its results and feedbacks.\n+     *\n+     * @param participationId for which to retrieve the student participation with results and feedbacks.\n+     * @return the ResponseEntity with status 200 (OK) and the participation with its results in the body.\n+     */\n+    @GetMapping(\"/programming-exercise-participations/{participationId}/student-participation-with-results-and-feedbacks\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0dd64ef5c32ed0643bfb91a40dff9028595ea9f"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjgwNzExMA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n          \n          \n            \n                @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476807110", "createdAt": "2020-08-25T22:37:28Z", "author": {"login": "fde312"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingExerciseParticipationResource.java", "diffHunk": "@@ -76,6 +76,30 @@ public ProgrammingExerciseParticipationResource(ProgrammingExerciseParticipation\n         return ResponseEntity.ok(participation.get());\n     }\n \n+    /**\n+     * Get the given student participation with its results and feedbacks.\n+     *\n+     * @param participationId for which to retrieve the student participation with results and feedbacks.\n+     * @return the ResponseEntity with status 200 (OK) and the participation with its results in the body.\n+     */\n+    @GetMapping(\"/programming-exercise-participations/{participationId}/student-participation-with-results-and-feedbacks\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc4NzYxNw=="}, "originalCommit": {"oid": "e0dd64ef5c32ed0643bfb91a40dff9028595ea9f"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5MjExNTEyOnYy", "diffSide": "RIGHT", "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingAssessmentIntegrationTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxOTowNDowOFrOHIdeNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxOTowNDowOFrOHIdeNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYzMzUyNg==", "bodyText": "Codacy found an issue: Linguistics Antipattern - The setter 'setParticipationForProgrammingExercise' should not return any type except void linguistically", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r478633526", "createdAt": "2020-08-27T19:04:08Z", "author": {"login": "artemis-bot"}, "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingAssessmentIntegrationTest.java", "diffHunk": "@@ -207,6 +373,15 @@ private void overrideAssessment(HttpStatus httpStatus) throws Exception {\n         result.setFeedbacks(feedbacks);\n         result.setParticipation(participation);\n         result.setSubmission(programmingSubmission);\n+        result.setResultString(\"This is a overridden result\");\n         request.putWithResponseBody(\"/api/participations/\" + participation.getId() + \"/manual-results\", result, Result.class, httpStatus);\n     }\n+\n+    private ProgrammingExerciseStudentParticipation setParticipationForProgrammingExercise(AssessmentType assessmentType) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a6e370d5fc17ca254cac4502f9e395647a0239a"}, "originalPosition": 218}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5MjExNTE3OnYy", "diffSide": "RIGHT", "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingAssessmentIntegrationTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxOTowNDowOVrOHIdePQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxOTowNDowOVrOHIdePQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYzMzUzMw==", "bodyText": "Codacy found an issue: The JUnit 5 test method name 'createManualProgrammingExerciseResult_resultExists' doesn't match '[a-z][a-zA-Z0-9]*'", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r478633533", "createdAt": "2020-08-27T19:04:09Z", "author": {"login": "artemis-bot"}, "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingAssessmentIntegrationTest.java", "diffHunk": "@@ -194,6 +214,152 @@ public void testOverrideAssessment_submitSameTutorNoAssessmentDueDatePossible()\n         overrideAssessment(HttpStatus.OK);\n     }\n \n+    @Test\n+    @WithMockUser(value = \"student1\", roles = \"USER\")\n+    public void programmingExerciseManualResult_noManualReviewsAllowed_forbidden() throws Exception {\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, HttpStatus.FORBIDDEN);\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results?submit=true\", result, HttpStatus.FORBIDDEN);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void programmingExerciseManualResult_noManualReviewsWithoutSubmission() throws Exception {\n+        // When it is the first manual result, a new submission is created with latest commit hash\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class,\n+                HttpStatus.OK);\n+        String commitHash = ((ProgrammingSubmission) response.getSubmission()).getCommitHash();\n+        assertThat(dummyHash.equalsIgnoreCase(commitHash));\n+\n+        // Check when a manual result already exists that submission is fetched\n+        result.setSubmission(null);\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, HttpStatus.OK);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_save() throws Exception {\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class,\n+                HttpStatus.OK);\n+\n+        assertThat(response.getResultString()).isEqualTo(result.getResultString());\n+        assertThat(response.getSubmission()).isNotNull();\n+        assertThat(response.getParticipation()).isEqualTo(result.getParticipation());\n+        assertThat(response.getFeedbacks().size()).isEqualTo(result.getFeedbacks().size());\n+        assertThat(response.isRated().equals(Boolean.FALSE));\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_submit() throws Exception {\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results?submit=true\", result,\n+                Result.class, HttpStatus.OK);\n+\n+        assertThat(response.getResultString()).isEqualTo(result.getResultString());\n+        assertThat(response.getSubmission()).isNotNull();\n+        assertThat(response.getParticipation()).isEqualTo(result.getParticipation());\n+        assertThat(response.getFeedbacks().size()).isEqualTo(result.getFeedbacks().size());\n+        assertThat(response.isRated().equals(Boolean.TRUE));\n+        assertThat(response.getCompletionDate().equals(ZonedDateTime.now()));\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_manualResultsNotAllowed() throws Exception {\n+        var participation = setParticipationForProgrammingExercise(AssessmentType.AUTOMATIC);\n+        result.setParticipation(participation);\n+\n+        request.putWithResponseBody(\"/api/participations/\" + participation.getId() + \"/manual-results\", result, Result.class, HttpStatus.FORBIDDEN);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_resultExists() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a6e370d5fc17ca254cac4502f9e395647a0239a"}, "originalPosition": 120}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5MjExNTI1OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxOTowNDoxMFrOHIdeSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxOTowNDoxMFrOHIdeSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYzMzU0NQ==", "bodyText": "Codacy found an issue: The method 'saveProgrammingAssessment(Long, boolean, Result)' has an NPath complexity of 4536, current threshold is 200", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r478633545", "createdAt": "2020-08-27T19:04:10Z", "author": {"login": "artemis-bot"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,106 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a6e370d5fc17ca254cac4502f9e395647a0239a"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5MjExNTI5OnYy", "diffSide": "RIGHT", "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingAssessmentIntegrationTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxOTowNDoxMVrOHIdeTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxOTowNDoxMVrOHIdeTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYzMzU1MQ==", "bodyText": "Codacy found an issue: The JUnit 5 test method name 'createManualProgrammingExerciseResult_resultPropertyMissing' doesn't match '[a-z][a-zA-Z0-9]*'", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r478633551", "createdAt": "2020-08-27T19:04:11Z", "author": {"login": "artemis-bot"}, "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingAssessmentIntegrationTest.java", "diffHunk": "@@ -194,6 +214,152 @@ public void testOverrideAssessment_submitSameTutorNoAssessmentDueDatePossible()\n         overrideAssessment(HttpStatus.OK);\n     }\n \n+    @Test\n+    @WithMockUser(value = \"student1\", roles = \"USER\")\n+    public void programmingExerciseManualResult_noManualReviewsAllowed_forbidden() throws Exception {\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, HttpStatus.FORBIDDEN);\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results?submit=true\", result, HttpStatus.FORBIDDEN);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void programmingExerciseManualResult_noManualReviewsWithoutSubmission() throws Exception {\n+        // When it is the first manual result, a new submission is created with latest commit hash\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class,\n+                HttpStatus.OK);\n+        String commitHash = ((ProgrammingSubmission) response.getSubmission()).getCommitHash();\n+        assertThat(dummyHash.equalsIgnoreCase(commitHash));\n+\n+        // Check when a manual result already exists that submission is fetched\n+        result.setSubmission(null);\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, HttpStatus.OK);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_save() throws Exception {\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class,\n+                HttpStatus.OK);\n+\n+        assertThat(response.getResultString()).isEqualTo(result.getResultString());\n+        assertThat(response.getSubmission()).isNotNull();\n+        assertThat(response.getParticipation()).isEqualTo(result.getParticipation());\n+        assertThat(response.getFeedbacks().size()).isEqualTo(result.getFeedbacks().size());\n+        assertThat(response.isRated().equals(Boolean.FALSE));\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_submit() throws Exception {\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results?submit=true\", result,\n+                Result.class, HttpStatus.OK);\n+\n+        assertThat(response.getResultString()).isEqualTo(result.getResultString());\n+        assertThat(response.getSubmission()).isNotNull();\n+        assertThat(response.getParticipation()).isEqualTo(result.getParticipation());\n+        assertThat(response.getFeedbacks().size()).isEqualTo(result.getFeedbacks().size());\n+        assertThat(response.isRated().equals(Boolean.TRUE));\n+        assertThat(response.getCompletionDate().equals(ZonedDateTime.now()));\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_manualResultsNotAllowed() throws Exception {\n+        var participation = setParticipationForProgrammingExercise(AssessmentType.AUTOMATIC);\n+        result.setParticipation(participation);\n+\n+        request.putWithResponseBody(\"/api/participations/\" + participation.getId() + \"/manual-results\", result, Result.class, HttpStatus.FORBIDDEN);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_resultExists() throws Exception {\n+        // Save result in order to generate a new id\n+        result = resultRepository.save(result);\n+        Long id = result.getId();\n+\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class,\n+                HttpStatus.OK);\n+        // Make sure that no new id was generated and the result is updated\n+        assertThat(id.equals(response.getId())).isTrue();\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_resultPropertyMissing() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a6e370d5fc17ca254cac4502f9e395647a0239a"}, "originalPosition": 133}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5MjExNTMxOnYy", "diffSide": "RIGHT", "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingAssessmentIntegrationTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxOTowNDoxMlrOHIdeVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxOTowNDoxMlrOHIdeVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYzMzU1OA==", "bodyText": "Codacy found an issue: The JUnit 5 test method name 'createManualProgrammingExerciseResult_submit' doesn't match '[a-z][a-zA-Z0-9]*'", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r478633558", "createdAt": "2020-08-27T19:04:12Z", "author": {"login": "artemis-bot"}, "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingAssessmentIntegrationTest.java", "diffHunk": "@@ -194,6 +214,152 @@ public void testOverrideAssessment_submitSameTutorNoAssessmentDueDatePossible()\n         overrideAssessment(HttpStatus.OK);\n     }\n \n+    @Test\n+    @WithMockUser(value = \"student1\", roles = \"USER\")\n+    public void programmingExerciseManualResult_noManualReviewsAllowed_forbidden() throws Exception {\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, HttpStatus.FORBIDDEN);\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results?submit=true\", result, HttpStatus.FORBIDDEN);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void programmingExerciseManualResult_noManualReviewsWithoutSubmission() throws Exception {\n+        // When it is the first manual result, a new submission is created with latest commit hash\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class,\n+                HttpStatus.OK);\n+        String commitHash = ((ProgrammingSubmission) response.getSubmission()).getCommitHash();\n+        assertThat(dummyHash.equalsIgnoreCase(commitHash));\n+\n+        // Check when a manual result already exists that submission is fetched\n+        result.setSubmission(null);\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, HttpStatus.OK);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_save() throws Exception {\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class,\n+                HttpStatus.OK);\n+\n+        assertThat(response.getResultString()).isEqualTo(result.getResultString());\n+        assertThat(response.getSubmission()).isNotNull();\n+        assertThat(response.getParticipation()).isEqualTo(result.getParticipation());\n+        assertThat(response.getFeedbacks().size()).isEqualTo(result.getFeedbacks().size());\n+        assertThat(response.isRated().equals(Boolean.FALSE));\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_submit() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a6e370d5fc17ca254cac4502f9e395647a0239a"}, "originalPosition": 97}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5MjExNTM3OnYy", "diffSide": "RIGHT", "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingAssessmentIntegrationTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxOTowNDoxM1rOHIdeYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxOTowNDoxM1rOHIdeYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYzMzU2OA==", "bodyText": "Codacy found an issue: The JUnit 5 test method name 'updateManualProgrammingExerciseResult_newResult' doesn't match '[a-z][a-zA-Z0-9]*'", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r478633568", "createdAt": "2020-08-27T19:04:13Z", "author": {"login": "artemis-bot"}, "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingAssessmentIntegrationTest.java", "diffHunk": "@@ -194,6 +214,152 @@ public void testOverrideAssessment_submitSameTutorNoAssessmentDueDatePossible()\n         overrideAssessment(HttpStatus.OK);\n     }\n \n+    @Test\n+    @WithMockUser(value = \"student1\", roles = \"USER\")\n+    public void programmingExerciseManualResult_noManualReviewsAllowed_forbidden() throws Exception {\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, HttpStatus.FORBIDDEN);\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results?submit=true\", result, HttpStatus.FORBIDDEN);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void programmingExerciseManualResult_noManualReviewsWithoutSubmission() throws Exception {\n+        // When it is the first manual result, a new submission is created with latest commit hash\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class,\n+                HttpStatus.OK);\n+        String commitHash = ((ProgrammingSubmission) response.getSubmission()).getCommitHash();\n+        assertThat(dummyHash.equalsIgnoreCase(commitHash));\n+\n+        // Check when a manual result already exists that submission is fetched\n+        result.setSubmission(null);\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, HttpStatus.OK);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_save() throws Exception {\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class,\n+                HttpStatus.OK);\n+\n+        assertThat(response.getResultString()).isEqualTo(result.getResultString());\n+        assertThat(response.getSubmission()).isNotNull();\n+        assertThat(response.getParticipation()).isEqualTo(result.getParticipation());\n+        assertThat(response.getFeedbacks().size()).isEqualTo(result.getFeedbacks().size());\n+        assertThat(response.isRated().equals(Boolean.FALSE));\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_submit() throws Exception {\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results?submit=true\", result,\n+                Result.class, HttpStatus.OK);\n+\n+        assertThat(response.getResultString()).isEqualTo(result.getResultString());\n+        assertThat(response.getSubmission()).isNotNull();\n+        assertThat(response.getParticipation()).isEqualTo(result.getParticipation());\n+        assertThat(response.getFeedbacks().size()).isEqualTo(result.getFeedbacks().size());\n+        assertThat(response.isRated().equals(Boolean.TRUE));\n+        assertThat(response.getCompletionDate().equals(ZonedDateTime.now()));\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_manualResultsNotAllowed() throws Exception {\n+        var participation = setParticipationForProgrammingExercise(AssessmentType.AUTOMATIC);\n+        result.setParticipation(participation);\n+\n+        request.putWithResponseBody(\"/api/participations/\" + participation.getId() + \"/manual-results\", result, Result.class, HttpStatus.FORBIDDEN);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_resultExists() throws Exception {\n+        // Save result in order to generate a new id\n+        result = resultRepository.save(result);\n+        Long id = result.getId();\n+\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class,\n+                HttpStatus.OK);\n+        // Make sure that no new id was generated and the result is updated\n+        assertThat(id.equals(response.getId())).isTrue();\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_resultPropertyMissing() throws Exception {\n+        Result result = new Result();\n+\n+        // Result string is missing\n+        request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class, HttpStatus.BAD_REQUEST);\n+\n+        // Result string is too long\n+        result.setResultString(\n+                \"Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.   \\n\"\n+                        + \"Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat, vel illum dolore eu feugiat nulla facilisis at vero eros et accumsan et iusto odio dignissim qui blandit praesent luptatum zzril delenit augue duis dolore te feugait nulla facilisi. Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat.   \\n\"\n+                        + \"Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit lobortis nisl ut aliquip ex ea commodo consequat. Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat, vel illum dolore...\");\n+        request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class, HttpStatus.BAD_REQUEST);\n+\n+        // Result score is missing\n+        result.setResultString(\"Good work here\");\n+        request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class, HttpStatus.BAD_REQUEST);\n+\n+        // Feedbacks have empty text\n+        result.setScore(100L);\n+        List<Feedback> feedbacks = ModelFactory.generateFeedback();\n+        result.setFeedbacks(feedbacks);\n+        request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class, HttpStatus.BAD_REQUEST);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void updateManualProgrammingExerciseResult() throws Exception {\n+        ProgrammingSubmission programmingSubmission = (ProgrammingSubmission) new ProgrammingSubmission().commitHash(\"abc\").submitted(true).submissionDate(ZonedDateTime.now());\n+        database.addProgrammingSubmission(programmingExercise, programmingSubmission, \"student1\");\n+        var participation = setParticipationForProgrammingExercise(AssessmentType.SEMI_AUTOMATIC);\n+\n+        result.setParticipation(participation);\n+        result.setSubmission(programmingSubmission);\n+        // Result has to be manual to be updated\n+        result.setAssessmentType(AssessmentType.MANUAL);\n+        result = resultRepository.save(result);\n+\n+        // Remove feedbacks, change text and score.\n+        result.setFeedbacks(result.getFeedbacks().subList(0, 1));\n+        result.setResultString(\"Changed text\");\n+        result.setScore(77L);\n+\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + participation.getId() + \"/manual-results\", result, Result.class, HttpStatus.OK);\n+        assertThat(response.getResultString()).isEqualTo(result.getResultString());\n+        assertThat(response.getParticipation()).isEqualTo(result.getParticipation());\n+        assertThat(response.getFeedbacks().size()).isEqualTo(result.getFeedbacks().size());\n+\n+        // Submission in response is lazy loaded therefore, we fetch submission and check if relation is correct\n+        ProgrammingSubmission submissionFetch = programmingSubmissionService.findByIdWithEagerResultAndFeedback(programmingSubmission.getId());\n+        assertThat(response.getId().equals(submissionFetch.getResult().getId()));\n+        assertThat(submissionFetch.getId().equals(programmingSubmission.getId()));\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void updateManualProgrammingExerciseResult_newResult() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a6e370d5fc17ca254cac4502f9e395647a0239a"}, "originalPosition": 188}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5MjExNTQxOnYy", "diffSide": "RIGHT", "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingAssessmentIntegrationTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxOTowNDoxNFrOHIdeaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxOTowNDoxNFrOHIdeaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYzMzU3Nw==", "bodyText": "Codacy found an issue: The JUnit 5 test method name 'programmingExerciseManualResult_noManualReviewsAllowed_forbidden' doesn't match '[a-z][a-zA-Z0-9]*'", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r478633577", "createdAt": "2020-08-27T19:04:14Z", "author": {"login": "artemis-bot"}, "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingAssessmentIntegrationTest.java", "diffHunk": "@@ -194,6 +214,152 @@ public void testOverrideAssessment_submitSameTutorNoAssessmentDueDatePossible()\n         overrideAssessment(HttpStatus.OK);\n     }\n \n+    @Test\n+    @WithMockUser(value = \"student1\", roles = \"USER\")\n+    public void programmingExerciseManualResult_noManualReviewsAllowed_forbidden() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a6e370d5fc17ca254cac4502f9e395647a0239a"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5MjExNTUzOnYy", "diffSide": "RIGHT", "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingAssessmentIntegrationTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxOTowNDoxNVrOHIdeeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxOTowNDoxNVrOHIdeeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYzMzU5NA==", "bodyText": "Codacy found an issue: The JUnit 5 test method name 'createManualProgrammingExerciseResult_save' doesn't match '[a-z][a-zA-Z0-9]*'", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r478633594", "createdAt": "2020-08-27T19:04:15Z", "author": {"login": "artemis-bot"}, "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingAssessmentIntegrationTest.java", "diffHunk": "@@ -194,6 +214,152 @@ public void testOverrideAssessment_submitSameTutorNoAssessmentDueDatePossible()\n         overrideAssessment(HttpStatus.OK);\n     }\n \n+    @Test\n+    @WithMockUser(value = \"student1\", roles = \"USER\")\n+    public void programmingExerciseManualResult_noManualReviewsAllowed_forbidden() throws Exception {\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, HttpStatus.FORBIDDEN);\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results?submit=true\", result, HttpStatus.FORBIDDEN);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void programmingExerciseManualResult_noManualReviewsWithoutSubmission() throws Exception {\n+        // When it is the first manual result, a new submission is created with latest commit hash\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class,\n+                HttpStatus.OK);\n+        String commitHash = ((ProgrammingSubmission) response.getSubmission()).getCommitHash();\n+        assertThat(dummyHash.equalsIgnoreCase(commitHash));\n+\n+        // Check when a manual result already exists that submission is fetched\n+        result.setSubmission(null);\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, HttpStatus.OK);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_save() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a6e370d5fc17ca254cac4502f9e395647a0239a"}, "originalPosition": 84}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5MjExNTY2OnYy", "diffSide": "RIGHT", "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingAssessmentIntegrationTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxOTowNDoxNlrOHIdejA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxOTowNDoxNlrOHIdejA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYzMzYxMg==", "bodyText": "Codacy found an issue: The JUnit 5 test method name 'createManualProgrammingExerciseResult_manualResultsNotAllowed' doesn't match '[a-z][a-zA-Z0-9]*'", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r478633612", "createdAt": "2020-08-27T19:04:16Z", "author": {"login": "artemis-bot"}, "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingAssessmentIntegrationTest.java", "diffHunk": "@@ -194,6 +214,152 @@ public void testOverrideAssessment_submitSameTutorNoAssessmentDueDatePossible()\n         overrideAssessment(HttpStatus.OK);\n     }\n \n+    @Test\n+    @WithMockUser(value = \"student1\", roles = \"USER\")\n+    public void programmingExerciseManualResult_noManualReviewsAllowed_forbidden() throws Exception {\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, HttpStatus.FORBIDDEN);\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results?submit=true\", result, HttpStatus.FORBIDDEN);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void programmingExerciseManualResult_noManualReviewsWithoutSubmission() throws Exception {\n+        // When it is the first manual result, a new submission is created with latest commit hash\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class,\n+                HttpStatus.OK);\n+        String commitHash = ((ProgrammingSubmission) response.getSubmission()).getCommitHash();\n+        assertThat(dummyHash.equalsIgnoreCase(commitHash));\n+\n+        // Check when a manual result already exists that submission is fetched\n+        result.setSubmission(null);\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, HttpStatus.OK);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_save() throws Exception {\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class,\n+                HttpStatus.OK);\n+\n+        assertThat(response.getResultString()).isEqualTo(result.getResultString());\n+        assertThat(response.getSubmission()).isNotNull();\n+        assertThat(response.getParticipation()).isEqualTo(result.getParticipation());\n+        assertThat(response.getFeedbacks().size()).isEqualTo(result.getFeedbacks().size());\n+        assertThat(response.isRated().equals(Boolean.FALSE));\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_submit() throws Exception {\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results?submit=true\", result,\n+                Result.class, HttpStatus.OK);\n+\n+        assertThat(response.getResultString()).isEqualTo(result.getResultString());\n+        assertThat(response.getSubmission()).isNotNull();\n+        assertThat(response.getParticipation()).isEqualTo(result.getParticipation());\n+        assertThat(response.getFeedbacks().size()).isEqualTo(result.getFeedbacks().size());\n+        assertThat(response.isRated().equals(Boolean.TRUE));\n+        assertThat(response.getCompletionDate().equals(ZonedDateTime.now()));\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_manualResultsNotAllowed() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a6e370d5fc17ca254cac4502f9e395647a0239a"}, "originalPosition": 111}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5MjExNTczOnYy", "diffSide": "RIGHT", "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingAssessmentIntegrationTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxOTowNDoxN1rOHIdelA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxOTowNDoxN1rOHIdelA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYzMzYyMA==", "bodyText": "Codacy found an issue: The JUnit 5 test method name 'programmingExerciseManualResult_noManualReviewsWithoutSubmission' doesn't match '[a-z][a-zA-Z0-9]*'", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r478633620", "createdAt": "2020-08-27T19:04:17Z", "author": {"login": "artemis-bot"}, "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingAssessmentIntegrationTest.java", "diffHunk": "@@ -194,6 +214,152 @@ public void testOverrideAssessment_submitSameTutorNoAssessmentDueDatePossible()\n         overrideAssessment(HttpStatus.OK);\n     }\n \n+    @Test\n+    @WithMockUser(value = \"student1\", roles = \"USER\")\n+    public void programmingExerciseManualResult_noManualReviewsAllowed_forbidden() throws Exception {\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, HttpStatus.FORBIDDEN);\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results?submit=true\", result, HttpStatus.FORBIDDEN);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void programmingExerciseManualResult_noManualReviewsWithoutSubmission() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a6e370d5fc17ca254cac4502f9e395647a0239a"}, "originalPosition": 70}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4643, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}