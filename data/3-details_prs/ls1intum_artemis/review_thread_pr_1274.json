{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwNTAyNTgx", "number": 1274, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQyMjoyNTo1OVrODpTKfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMToyOTozMlrODpeAZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0NjMyMTg5OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingExerciseResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQyMjoyNTo1OVrOF4ZApA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQyMjoyNTo1OVrOF4ZApA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDY3NDM0MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // Cceck if the exercise title matches regex\n          \n          \n            \n                    // Check if the exercise title matches regex", "url": "https://github.com/ls1intum/Artemis/pull/1274#discussion_r394674340", "createdAt": "2020-03-18T22:25:59Z", "author": {"login": "jpbernius"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingExerciseResource.java", "diffHunk": "@@ -169,7 +170,7 @@ public ProgrammingExerciseResource(ProgrammingExerciseRepository programmingExer\n                     .headers(HeaderUtil.createAlert(applicationName, \"The title of the programming exercise is too short\", \"programmingExerciseTitleInvalid\")).body(null);\n         }\n \n-        // CHeck if the exercise title matches regex\n+        // Cceck if the exercise title matches regex", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e2a99b914ed2defae3c197a34307dd4dfcc08b8"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0ODA5NTcyOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/CourseResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMToyODo0NVrOF4qYIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMToyODo0NVrOF4qYIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDk1ODg4MA==", "bodyText": "Only the student group is deleted on Jira. Here is why:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (course.getStudentGroupName().equals(\"artemis-\" + course.getShortName() + \"-tutors\")) {\n          \n          \n            \n                        artemisAuthenticationProvider.deleteGroup(course.getTeachingAssistantGroupName());\n          \n          \n            \n                    }\n          \n          \n            \n                    if (course.getStudentGroupName().equals(\"artemis-\" + course.getShortName() + \"-instructors\")) {\n          \n          \n            \n                        artemisAuthenticationProvider.deleteGroup(course.getInstructorGroupName());\n          \n          \n            \n                    }\n          \n          \n            \n                    if (course.getTeachingAssistantGroupName().equals(\"artemis-\" + course.getShortName() + \"-tutors\")) {\n          \n          \n            \n                        artemisAuthenticationProvider.deleteGroup(course.getTeachingAssistantGroupName());\n          \n          \n            \n                    }\n          \n          \n            \n                    if (course.getInstructorGroupName().equals(\"artemis-\" + course.getShortName() + \"-instructors\")) {\n          \n          \n            \n                        artemisAuthenticationProvider.deleteGroup(course.getInstructorGroupName());\n          \n          \n            \n                    }", "url": "https://github.com/ls1intum/Artemis/pull/1274#discussion_r394958880", "createdAt": "2020-03-19T11:28:45Z", "author": {"login": "jpbernius"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/CourseResource.java", "diffHunk": "@@ -620,7 +619,20 @@ private boolean userHasPermission(Course course, User user) {\n             notificationService.deleteNotification(notification);\n         }\n         String title = course.getTitle();\n+\n+        // only delete the groups if they have been created by Artemis before\n+        if (course.getStudentGroupName().equals(\"artemis-\" + course.getShortName() + \"-students\")) {\n+            artemisAuthenticationProvider.deleteGroup(course.getStudentGroupName());\n+        }\n+        if (course.getStudentGroupName().equals(\"artemis-\" + course.getShortName() + \"-tutors\")) {\n+            artemisAuthenticationProvider.deleteGroup(course.getTeachingAssistantGroupName());\n+        }\n+        if (course.getStudentGroupName().equals(\"artemis-\" + course.getShortName() + \"-instructors\")) {\n+            artemisAuthenticationProvider.deleteGroup(course.getInstructorGroupName());\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e266cd6c81fe9d9ad1dc12b56e3c6311df5f18f"}, "originalPosition": 223}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0ODA5ODMxOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/CourseResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMToyOTozMlrOF4qZpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMzoyNToyM1rOF4uOBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDk1OTI3MQ==", "bodyText": "I am wondering if we should create the group names in the Course Object, as we use them multiple times.", "url": "https://github.com/ls1intum/Artemis/pull/1274#discussion_r394959271", "createdAt": "2020-03-19T11:29:32Z", "author": {"login": "jpbernius"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/CourseResource.java", "diffHunk": "@@ -141,22 +136,48 @@ public CourseResource(Environment env, UserService userService, CourseService co\n         if (course.getId() != null) {\n             throw new BadRequestAlertException(\"A new course cannot already have an ID\", ENTITY_NAME, \"idexists\");\n         }\n+\n+        // Check if course shortname matches regex\n+        Matcher shortNameMatcher = SHORT_NAME_PATTERN.matcher(course.getShortName());\n+        if (!shortNameMatcher.matches()) {\n+            return ResponseEntity.badRequest().headers(HeaderUtil.createAlert(applicationName, \"The shortname is invalid\", \"shortnameInvalid\")).body(null);\n+        }\n+\n+        List<Course> coursesWithSameShortName = courseRepository.findAllByShortName(course.getShortName());\n+        if (coursesWithSameShortName.size() > 0) {\n+            return ResponseEntity.badRequest().headers(\n+                    HeaderUtil.createAlert(applicationName, \"A course with the same short name already exists. Please choose a different short name.\", \"shortnameAlreadyExists\"))\n+                    .body(null);\n+        }\n+\n+        if (course.getStudentGroupName() != null) {\n+            throw new BadRequestAlertException(\"The student group name must be null when creating a course\", ENTITY_NAME, \"studentGroupNameCannotBeSet\");\n+        }\n+        if (course.getTeachingAssistantGroupName() != null) {\n+            throw new BadRequestAlertException(\"The teaching assistant group name must be null when creating a course\", ENTITY_NAME, \"teachingAssistantGroupNameCannotBeSet\");\n+        }\n+        if (course.getInstructorGroupName() != null) {\n+            throw new BadRequestAlertException(\"The instructor group name must be null when creating a course\", ENTITY_NAME, \"instructorGroupNameCannotBeSet\");\n+        }\n+\n         validateComplaintsConfig(course);\n+\n+        course.setStudentGroupName(\"artemis-\" + course.getShortName() + \"-students\");\n+        course.setTeachingAssistantGroupName(\"artemis-\" + course.getShortName() + \"-tutors\");\n+        course.setInstructorGroupName(\"artemis-\" + course.getShortName() + \"-instructors\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e266cd6c81fe9d9ad1dc12b56e3c6311df5f18f"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTAyMTgzMQ==", "bodyText": "good point. I refactored it", "url": "https://github.com/ls1intum/Artemis/pull/1274#discussion_r395021831", "createdAt": "2020-03-19T13:25:23Z", "author": {"login": "krusche"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/CourseResource.java", "diffHunk": "@@ -141,22 +136,48 @@ public CourseResource(Environment env, UserService userService, CourseService co\n         if (course.getId() != null) {\n             throw new BadRequestAlertException(\"A new course cannot already have an ID\", ENTITY_NAME, \"idexists\");\n         }\n+\n+        // Check if course shortname matches regex\n+        Matcher shortNameMatcher = SHORT_NAME_PATTERN.matcher(course.getShortName());\n+        if (!shortNameMatcher.matches()) {\n+            return ResponseEntity.badRequest().headers(HeaderUtil.createAlert(applicationName, \"The shortname is invalid\", \"shortnameInvalid\")).body(null);\n+        }\n+\n+        List<Course> coursesWithSameShortName = courseRepository.findAllByShortName(course.getShortName());\n+        if (coursesWithSameShortName.size() > 0) {\n+            return ResponseEntity.badRequest().headers(\n+                    HeaderUtil.createAlert(applicationName, \"A course with the same short name already exists. Please choose a different short name.\", \"shortnameAlreadyExists\"))\n+                    .body(null);\n+        }\n+\n+        if (course.getStudentGroupName() != null) {\n+            throw new BadRequestAlertException(\"The student group name must be null when creating a course\", ENTITY_NAME, \"studentGroupNameCannotBeSet\");\n+        }\n+        if (course.getTeachingAssistantGroupName() != null) {\n+            throw new BadRequestAlertException(\"The teaching assistant group name must be null when creating a course\", ENTITY_NAME, \"teachingAssistantGroupNameCannotBeSet\");\n+        }\n+        if (course.getInstructorGroupName() != null) {\n+            throw new BadRequestAlertException(\"The instructor group name must be null when creating a course\", ENTITY_NAME, \"instructorGroupNameCannotBeSet\");\n+        }\n+\n         validateComplaintsConfig(course);\n+\n+        course.setStudentGroupName(\"artemis-\" + course.getShortName() + \"-students\");\n+        course.setTeachingAssistantGroupName(\"artemis-\" + course.getShortName() + \"-tutors\");\n+        course.setInstructorGroupName(\"artemis-\" + course.getShortName() + \"-instructors\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDk1OTI3MQ=="}, "originalCommit": {"oid": "9e266cd6c81fe9d9ad1dc12b56e3c6311df5f18f"}, "originalPosition": 81}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 76, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}