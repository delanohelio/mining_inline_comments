{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0MzYxNjQ5", "number": 2314, "title": "[Feature] Stash unsubmitted changes after due date has passed", "bodyText": "Checklist\n\n I tested all changes and all related features with different users (student, tutor, instructor, admin) on the test server https://artemistest.ase.in.tum.de.\n Server: I added multiple integration tests (Spring) related to the features (with a high test coverage)\n Server: I implemented the changes with a good performance and prevented too many database calls\n Server: I documented the Java code using JavaDoc style.\n\nMotivation and Context\n\n\nWe want to display only the changes that the student submitted (all changes that are on BitBucket). To ensure this, we will stash all unsubmitted changes.\nDescription\n\n\nImplemented method to  stash changes after the due date has passed\nInvoke stash changes method in a scheduler, that will be executed when the due date has passed (same as for lock repo)\n\nSteps for Testing\n\n\nLog in to Artemis\nNavigate to Course Administration\nCreate Programming Exercise, set due date in the near future and enable manual assessment\nParticipate on exercise\n4.1 Submit code and make change and just click on save (do not submit a second time!!!)\n4.2 Just save your changes (do not submit at all)\n4.3 Make changes and alway submit your code\nWait until the due date has passed\nCheck your submission in the code editor and check that the not saved changes are not displayed anymore\n\nTest Coverage\n\n\nGitService.java: 80%\nProgrammingExerciseParticipationService,java: 86%\n\nScreenshots\n\n\nDuring participation after clicking on save:\n\nAfter due date:", "createdAt": "2020-11-02T22:11:59Z", "url": "https://github.com/ls1intum/Artemis/pull/2314", "merged": true, "mergeCommit": {"oid": "09f6e0f8c7b4919de9c0c73645c5e5a90a23a7a6"}, "closed": true, "closedAt": "2020-11-05T23:32:52Z", "author": {"login": "fde312"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdYrOyKgH2gAyNTE0MzYxNjQ5OjE5MDVjNzllZDg1NTY5NTUyOTExZGIzZWZjNjhkMTRhNTg4NjQ1NzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZq_ztgFqTUyNDc1MzM4Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1905c79ed85569552911db3efc68d14a58864575", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/1905c79ed85569552911db3efc68d14a58864575", "committedDate": "2020-11-02T21:13:29Z", "message": "stash also unsubmitted changes when the repo is locked"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyOTA4NTA3", "url": "https://github.com/ls1intum/Artemis/pull/2314#pullrequestreview-522908507", "createdAt": "2020-11-03T22:05:32Z", "commit": {"oid": "1905c79ed85569552911db3efc68d14a58864575"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QyMjowNTozM1rOHtCIOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QyMjowNTozM1rOHtCIOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk4Mjg0MA==", "bodyText": "Reformulate / adjust reporting logic to notify only about operations that failed (not always both).", "url": "https://github.com/ls1intum/Artemis/pull/2314#discussion_r516982840", "createdAt": "2020-11-03T22:05:33Z", "author": {"login": "MaisiKoleni"}, "path": "src/main/java/de/tum/in/www1/artemis/service/scheduled/ProgrammingExerciseScheduleService.java", "diffHunk": "@@ -227,20 +227,25 @@ private Runnable lockStudentRepositories(ProgrammingExercise exercise, Predicate\n             SecurityUtils.setAuthorizationObject();\n             try {\n                 List<ProgrammingExerciseStudentParticipation> failedLockOperations = removeWritePermissionsFromAllStudentRepositories(programmingExerciseId, condition);\n+                // Stash also the not submitted/committed changes, to ensure that only submitted/commited changes are displayed\n+                List<ProgrammingExerciseStudentParticipation> failedStashOperations = stashChangesInAllStudentRepositories(programmingExerciseId, condition);\n \n-                // We sent a notification to the instructor about the success of the repository locking operation.\n+                // We sent a notification to the instructor about the success of the repository locking and stashing operations.\n                 long numberOfFailedLockOperations = failedLockOperations.size();\n+                long numberOfFailedStashOperations = failedStashOperations.size();\n                 Optional<ProgrammingExercise> programmingExercise = programmingExerciseRepository.findWithTemplateParticipationAndSolutionParticipationById(programmingExerciseId);\n                 if (programmingExercise.isEmpty()) {\n                     throw new EntityNotFoundException(\"programming exercise not found with id \" + programmingExerciseId);\n                 }\n-                if (numberOfFailedLockOperations > 0) {\n+                if (numberOfFailedLockOperations > 0 || numberOfFailedStashOperations > 0) {\n                     groupNotificationService.notifyInstructorGroupAboutExerciseUpdate(programmingExercise.get(),\n-                            Constants.PROGRAMMING_EXERCISE_FAILED_LOCK_OPERATIONS_NOTIFICATION + failedLockOperations.size());\n+                            Constants.PROGRAMMING_EXERCISE_FAILED_LOCK_OPERATIONS_NOTIFICATION + numberOfFailedLockOperations\n+                                    + \". Furthermore, When stashing the not submitted changes, not all stash operations were successfull. Number of failed stash operations: \"\n+                                    + numberOfFailedStashOperations);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1905c79ed85569552911db3efc68d14a58864575"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyOTYxMTA2", "url": "https://github.com/ls1intum/Artemis/pull/2314#pullrequestreview-522961106", "createdAt": "2020-11-04T00:07:37Z", "commit": {"oid": "1905c79ed85569552911db3efc68d14a58864575"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db6a3e75483e0ee2466d7ead3f8d92b50ab86bb3", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/db6a3e75483e0ee2466d7ead3f8d92b50ab86bb3", "committedDate": "2020-11-04T01:16:04Z", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into bugfix/programming-exercises/stash-unsubmitted-changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbdeea95647e5d16893abe86dea8969ba07db64d", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/fbdeea95647e5d16893abe86dea8969ba07db64d", "committedDate": "2020-11-04T15:55:18Z", "message": "add test for stashing changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da5cdca0f0e8b3b5dbf19ed77a1460e61b488894", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/da5cdca0f0e8b3b5dbf19ed77a1460e61b488894", "committedDate": "2020-11-04T17:44:37Z", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into bugfix/programming-exercises/stash-unsubmitted-changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdae02bb4ffa071b1e61392308860afca1402285", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/bdae02bb4ffa071b1e61392308860afca1402285", "committedDate": "2020-11-04T17:45:07Z", "message": "add more tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2527d3c4e6a86e2f43ae7ecf82aa89c36fd06122", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/2527d3c4e6a86e2f43ae7ecf82aa89c36fd06122", "committedDate": "2020-11-04T22:35:56Z", "message": "structure test and improve coverage for new method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eae8e1243d0426111c486abe2ac357fd1400a048", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/eae8e1243d0426111c486abe2ac357fd1400a048", "committedDate": "2020-11-05T01:31:29Z", "message": "improve test coverage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b7b048ec6b560742da0f4e52bf53d8cda789474", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/5b7b048ec6b560742da0f4e52bf53d8cda789474", "committedDate": "2020-11-05T02:18:41Z", "message": "incorporate feedback and make codacy happy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eea5d1b0047b4c81d950dfc22cfcc20cc7441abc", "author": {"user": {"login": "fde312", "name": "Francisco De las Casas Young"}}, "url": "https://github.com/ls1intum/Artemis/commit/eea5d1b0047b4c81d950dfc22cfcc20cc7441abc", "committedDate": "2020-11-05T02:49:11Z", "message": "Update RepositoryProgrammingExerciseParticipationResourceIntegrationTest.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b662912e6ffedea172859422e16597e3b94a23e9", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/b662912e6ffedea172859422e16597e3b94a23e9", "committedDate": "2020-11-05T05:59:22Z", "message": "increase coverage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91f2f794a31e283f67d9a52526e327e6e0a01bc8", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/91f2f794a31e283f67d9a52526e327e6e0a01bc8", "committedDate": "2020-11-05T05:59:28Z", "message": "Merge branch 'bugfix/programming-exercises/stash-unsubmitted-changes' of https://github.com/ls1intum/Artemis into bugfix/programming-exercises/stash-unsubmitted-changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MjY5MTQ5", "url": "https://github.com/ls1intum/Artemis/pull/2314#pullrequestreview-524269149", "createdAt": "2020-11-05T13:41:00Z", "commit": {"oid": "91f2f794a31e283f67d9a52526e327e6e0a01bc8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NTE2NTMx", "url": "https://github.com/ls1intum/Artemis/pull/2314#pullrequestreview-524516531", "createdAt": "2020-11-05T17:48:33Z", "commit": {"oid": "91f2f794a31e283f67d9a52526e327e6e0a01bc8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxNzo0ODozM1rOHuPH4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxNzo0ODozM1rOHuPH4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODI0NDMyMw==", "bodyText": "git.close();  won't close the repo with the new Git(repo). I think for linux this is fine but for Windows this could introduce some problems. If you don't need to repo anymore, make sure to close it correctly. You could use the constructor new Git(repo, true) to force a close of the repo if you close the git instance.", "url": "https://github.com/ls1intum/Artemis/pull/2314#discussion_r518244323", "createdAt": "2020-11-05T17:48:33Z", "author": {"login": "kloessst"}, "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/GitService.java", "diffHunk": "@@ -705,4 +705,16 @@ public boolean repositoryAlreadyExists(URL repoUrl) {\n         Path localPath = new java.io.File(REPO_CLONE_PATH + folderNameForRepositoryUrl(repoUrl)).toPath();\n         return Files.exists(localPath);\n     }\n+\n+    /**\n+     * Stashes not submitted/committed changes of the repo.\n+     *\n+     * @param repo student repo of a participation in a programming exercise\n+     * @throws GitAPIException\n+     */\n+    public void stashChanges(Repository repo) throws GitAPIException {\n+        Git git = new Git(repo);\n+        git.stashCreate().call();\n+        git.close();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91f2f794a31e283f67d9a52526e327e6e0a01bc8"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NTQzMjk4", "url": "https://github.com/ls1intum/Artemis/pull/2314#pullrequestreview-524543298", "createdAt": "2020-11-05T18:21:14Z", "commit": {"oid": "91f2f794a31e283f67d9a52526e327e6e0a01bc8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NTQ5Mzg4", "url": "https://github.com/ls1intum/Artemis/pull/2314#pullrequestreview-524549388", "createdAt": "2020-11-05T18:29:24Z", "commit": {"oid": "91f2f794a31e283f67d9a52526e327e6e0a01bc8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NTcyMzY3", "url": "https://github.com/ls1intum/Artemis/pull/2314#pullrequestreview-524572367", "createdAt": "2020-11-05T18:59:51Z", "commit": {"oid": "91f2f794a31e283f67d9a52526e327e6e0a01bc8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NzE0Njk0", "url": "https://github.com/ls1intum/Artemis/pull/2314#pullrequestreview-524714694", "createdAt": "2020-11-05T22:14:20Z", "commit": {"oid": "91f2f794a31e283f67d9a52526e327e6e0a01bc8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NzUzMzgy", "url": "https://github.com/ls1intum/Artemis/pull/2314#pullrequestreview-524753382", "createdAt": "2020-11-05T23:31:03Z", "commit": {"oid": "91f2f794a31e283f67d9a52526e327e6e0a01bc8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3574, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}