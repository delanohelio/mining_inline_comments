{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczMTM4ODk5", "number": 1235, "title": "Chore: Add tests for Submission Resource", "bodyText": "Checklist\n\n Server: I added multiple integration tests (Spring) related to the features\n\nMotivation and Context\n\n\nThis PR increases the test coverage of Submission Resource class from 46% to 93%. Covers all available REST endpoints.", "createdAt": "2020-02-10T13:37:43Z", "url": "https://github.com/ls1intum/Artemis/pull/1235", "merged": true, "mergeCommit": {"oid": "fdc90a15d843df90fdc1c08e08caaa6256f3b14d"}, "closed": true, "closedAt": "2020-02-16T14:38:43Z", "author": {"login": "maxr96"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcC8mXAAH2gAyMzczMTM4ODk5OmQwMWQ2NzIyMGM4M2FmNGYxZTlhZjdiYWFjZGQ4OTk3YTk3MWQ4ZjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcE5vwkAFqTM1OTQwNzg0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d01d67220c83af4f1e9af7baacdd8997a971d8f1", "author": {"user": {"login": "maxr96", "name": null}}, "url": "https://github.com/ls1intum/Artemis/commit/d01d67220c83af4f1e9af7baacdd8997a971d8f1", "committedDate": "2020-02-10T12:50:08Z", "message": "Add tests for Submission Resource"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1OTQ0ODI2", "url": "https://github.com/ls1intum/Artemis/pull/1235#pullrequestreview-355944826", "createdAt": "2020-02-10T13:44:10Z", "commit": {"oid": "d01d67220c83af4f1e9af7baacdd8997a971d8f1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMzo0NDoxMFrOFnmfvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMzo0NDoxMFrOFnmfvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA2OTUwMw==", "bodyText": "I didn't find any usage of the endpoints except the delete one. They didn't have any authorization checks and in my opinion can cause security issues. I would suggest to remove them. Should I do that @krusche ?", "url": "https://github.com/ls1intum/Artemis/pull/1235#discussion_r377069503", "createdAt": "2020-02-10T13:44:10Z", "author": {"login": "maxr96"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/SubmissionResource.java", "diffHunk": "@@ -65,6 +65,7 @@ public SubmissionResource(SubmissionRepository submissionRepository, ResultServi\n      * @throws URISyntaxException if the Location URI syntax is incorrect\n      */\n     @PostMapping(\"/submissions\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d01d67220c83af4f1e9af7baacdd8997a971d8f1"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1OTUwODI1", "url": "https://github.com/ls1intum/Artemis/pull/1235#pullrequestreview-355950825", "createdAt": "2020-02-10T13:52:48Z", "commit": {"oid": "d01d67220c83af4f1e9af7baacdd8997a971d8f1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMzo1Mjo0OVrOFnmycA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMzo1NTowMFrOFnm3Hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA3NDI4OA==", "bodyText": "Could you change an attribute and then verify that it has actually changed?", "url": "https://github.com/ls1intum/Artemis/pull/1235#discussion_r377074288", "createdAt": "2020-02-10T13:52:49Z", "author": {"login": "HanyaElhashemy"}, "path": "src/test/java/de/tum/in/www1/artemis/ParticipationSubmissionIntegrationTest.java", "diffHunk": "@@ -83,4 +94,49 @@ public void deleteParticipation_forbidden_tutor() throws Exception {\n     public void deleteParticipation_notFound() throws Exception {\n         request.delete(\"/api/submissions/\" + 1, HttpStatus.NOT_FOUND);\n     }\n+\n+    @Test\n+    @WithMockUser(username = \"student1\", roles = \"USER\")\n+    public void createSubmission() throws Exception {\n+        request.postWithResponseBody(\"/api/submissions\", new TextSubmission(), Submission.class, HttpStatus.CREATED);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"student1\", roles = \"USER\")\n+    public void createSubmission_withId() throws Exception {\n+        var submission = new TextSubmission();\n+        submission.setId(1L);\n+        request.postWithResponseBody(\"/api/submissions\", submission, Submission.class, HttpStatus.BAD_REQUEST);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"student1\", roles = \"USER\")\n+    public void updateSubmission() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d01d67220c83af4f1e9af7baacdd8997a971d8f1"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA3NTQ4Nw==", "bodyText": "could you assert that the properties of the received submission have the expected values?", "url": "https://github.com/ls1intum/Artemis/pull/1235#discussion_r377075487", "createdAt": "2020-02-10T13:55:00Z", "author": {"login": "HanyaElhashemy"}, "path": "src/test/java/de/tum/in/www1/artemis/ParticipationSubmissionIntegrationTest.java", "diffHunk": "@@ -83,4 +94,49 @@ public void deleteParticipation_forbidden_tutor() throws Exception {\n     public void deleteParticipation_notFound() throws Exception {\n         request.delete(\"/api/submissions/\" + 1, HttpStatus.NOT_FOUND);\n     }\n+\n+    @Test\n+    @WithMockUser(username = \"student1\", roles = \"USER\")\n+    public void createSubmission() throws Exception {\n+        request.postWithResponseBody(\"/api/submissions\", new TextSubmission(), Submission.class, HttpStatus.CREATED);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"student1\", roles = \"USER\")\n+    public void createSubmission_withId() throws Exception {\n+        var submission = new TextSubmission();\n+        submission.setId(1L);\n+        request.postWithResponseBody(\"/api/submissions\", submission, Submission.class, HttpStatus.BAD_REQUEST);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"student1\", roles = \"USER\")\n+    public void updateSubmission() throws Exception {\n+        var submission = new TextSubmission();\n+        submissionRepository.save(submission);\n+        request.putWithResponseBody(\"/api/submissions\", submission, Submission.class, HttpStatus.OK);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"student1\", roles = \"USER\")\n+    public void updateSubmission_noId() throws Exception {\n+        var submission = new TextSubmission();\n+        request.putWithResponseBody(\"/api/submissions\", submission, Submission.class, HttpStatus.CREATED);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"tutor1\", roles = \"TA\")\n+    public void getAllSubmissions() throws Exception {\n+        submissionRepository.save(new TextSubmission());\n+        submissionRepository.save(new ModelingSubmission());\n+        List<Submission> submissions = request.getList(\"/api/submissions\", HttpStatus.OK, Submission.class);\n+        assertThat(submissions.size()).isEqualTo(2);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"tutor1\", roles = \"TA\")\n+    public void getSubmission() throws Exception {\n+        var submission = submissionRepository.save(new TextSubmission());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d01d67220c83af4f1e9af7baacdd8997a971d8f1"}, "originalPosition": 93}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9cb357434e724a96d67c54c3517ae7702537683", "author": {"user": {"login": "maxr96", "name": null}}, "url": "https://github.com/ls1intum/Artemis/commit/e9cb357434e724a96d67c54c3517ae7702537683", "committedDate": "2020-02-15T22:23:47Z", "message": "Removed unused code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5NDA3ODQ3", "url": "https://github.com/ls1intum/Artemis/pull/1235#pullrequestreview-359407847", "createdAt": "2020-02-16T14:38:32Z", "commit": {"oid": "e9cb357434e724a96d67c54c3517ae7702537683"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3165, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}