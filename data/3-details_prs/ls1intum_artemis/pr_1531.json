{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI1MTA5NzQ1", "number": 1531, "title": "Feature/reduce websocket subscriptions", "bodyText": "Checklist\n\n I tested all changes and all related features with different users (student, tutor, instructor, admin) on the test server https://artemistest.ase.in.tum.de.\n Server: I implemented the changes with a good performance and prevented too many database calls\n Server: I documented the Java code using JavaDoc style.\n Client: I added multiple integration tests (Jest) related to the features\n Client: I documented the TypeScript code using JSDoc style.\n\nMotivation and Context\nCurrently, a new WebSocket subscription is opened for every unrated exercise where the due date passed and for every started programming exercise for every student in the course overview. Also, for TAs and higher, a WebSocket subscription is opened for every student once they view an exercise overview.\nIn large courses like EIST, around 1500 students use the system at the same time. Every one of these students typically has quite some unrated exercises and started programming exercises, sometimes leading to > 10 subscriptions per students. The subscribe-mechanism is quite exhausting for the server which already lead to problems during one quiz in a live lecture as there was a large queue with unprocessed subscriptions, decreasing the user experience and functionality as other WebSocket messages could also not be processed.\nThis PR creates one subscription for all /newResults-messages and one for every /newSubmission-messages for each student. Also, TAs and higher will now open one subscription per exercise, instead of one per participation.\nDescription\nA new topic /user/topic/newResults is introduced which every client can independently subscribe to. The server will then send the new results to this topic for the student(s) owning the participation instead of a topic only used by this participation.\nThe new result will also be broadcasted to the topic /topic/exercise/{exerciseId}/newResults, where TAs and higher can subscribe to.\nA security check was added in the server that ensures that only TAs and higher can subscribe to the /topic/exercise/{exerciseId}/newResults topic.\nIn the client, at several occurrences, it has to be specified if a subscription to a new result for a participation is for a student or for an instructor. This is done by adding a property personalParticipation to several components. This value will be set be their parent components, depending on the context the child component is used (e.g. in the course overview for a student, the UpdatingResultComponent will be used in a personal context whereas it will be used in a non-personal context in the exercise view for instructors (where the state of the template & solution repositories are shown)).\nThe client also keeps a map which stores which topic was used by which participation, therefore ensuring that every topic will only be subscribed once.\nThis logic also ensures that an unsubscription from one specific WebSocket topic will only occur if no other participations rely on this topic.\nThe difference between the previous subscriptions and the current subscriptions can be found in the following tables:\n\n\n\nOld subscriptions\nStudent\nTA/Instructor/Admin\n\n\n\n\nInform about new results\n/topic/participation/{participationId}/newResults\n/topic/participation/{participationId}/newResults\n\n\nInform about new submissions\n/topic/participation/ {particpationId}/newSubmission\n/topic/participation/ {particpationId}/newSubmission\n\n\n\n\n\n\nNew subscriptions\nStudent\nTA/Instructor/Admin\n\n\n\n\nInform about new results\n/user/topic/newResults\n/topic/exercise/{exerciseId}/newResults\n\n\nInform about new submissions\n/user/topic/newSubmission\n/topic/exercise/{exerciseId}/newSubmission\n\n\n\nThe number websocket subscriptions is reduced as 2 subscriptions per student are enough and also the instructors only need 2 subscriptions per exercise instead of per participation.\nSteps for Testing\nIn general, results and subscriptions should be updated without reload wherever they are updated before this PR, but in a more performant way.\n\nLog in to Artemis\nNavigate to Course Administration\nCreate a text exercise\nParticipate as a student\nAssess the submission of the student\nThe student should be informed without reload about the new result\n\n\n\n\nLog in to Artemis\n\n\nNavigate to Course Administration\n\n\nCreate a programming exercise\n\n\nClick on the View-button for the exercise.\n\n\nScroll down, the status of the template and solution participation should be displayed.\n\n\nRe-trigger the builds for template and solution participations. Only the participation that you triggered should be changed to \"Building and testing...\" and the received result should be displayed. (NOTE: this can take some time as the build is processed in the background on the CI-server, but it should normally take not significantly longer than it took for me locally (see GIF))\n\n\n\nStart the programming exercise as a student\n\n\nChange some code and submit, the text should change to \"Testing and Building...\"\n\n\nAfter the build was executed, the result should be displayed.", "createdAt": "2020-05-29T13:39:58Z", "url": "https://github.com/ls1intum/Artemis/pull/1531", "merged": true, "mergeCommit": {"oid": "19600919c5fb200a5d090187c81f3bf8a21ee019"}, "closed": true, "closedAt": "2020-06-09T21:36:54Z", "author": {"login": "sleiss"}, "timelineItems": {"totalCount": 59, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchmS1igH2gAyNDI1MTA5NzQ1OjdiNTZjMDNlMzZhN2NmMDE5OTQ0NDkxNTc4ZDM1YmYxNTNkMTVlYmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpsF1DAFqTQyNzU2NDczNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7b56c03e36a7cf019944491578d35bf153d15eba", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/7b56c03e36a7cf019944491578d35bf153d15eba", "committedDate": "2020-05-15T18:22:33Z", "message": "Start with subscription updates."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0fc9a64753acff272d50224444d269b7e2677e21", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/0fc9a64753acff272d50224444d269b7e2677e21", "committedDate": "2020-05-18T10:00:53Z", "message": "Work on lowering subscription count."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8bd455d334123eaa3cd6c3254c3bfedf1e2922e6", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/8bd455d334123eaa3cd6c3254c3bfedf1e2922e6", "committedDate": "2020-05-19T10:11:26Z", "message": "Merge branch 'develop' into feature/reduce-websocket-subscriptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a86f21181ea8df32a2dd19657be67fd8d1f57e63", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/a86f21181ea8df32a2dd19657be67fd8d1f57e63", "committedDate": "2020-05-19T13:16:47Z", "message": "Change subscribed topic to expect sendToUser."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7540f41bf741da3b186737d59deecf10de98f944", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/7540f41bf741da3b186737d59deecf10de98f944", "committedDate": "2020-05-22T19:47:28Z", "message": "Progress on reduced subscriptions."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a30633dbb85e52564e238ea993b5ba20e1fe34a0", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/a30633dbb85e52564e238ea993b5ba20e1fe34a0", "committedDate": "2020-05-26T09:13:42Z", "message": "Merge branch 'develop' into feature/reduce-websocket-subscriptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1aad8bc44383a49c93f2f9fb3df488ab4f196f03", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/1aad8bc44383a49c93f2f9fb3df488ab4f196f03", "committedDate": "2020-05-28T22:12:34Z", "message": "Merge branch 'develop' into feature/reduce-websocket-subscriptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c07c479d4740ec83f5a4f0fc73afdd3359609695", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/c07c479d4740ec83f5a4f0fc73afdd3359609695", "committedDate": "2020-05-29T09:41:00Z", "message": "Fix missing personal property."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66cd37478ee73912751775e332157ce7f470ae47", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/66cd37478ee73912751775e332157ce7f470ae47", "committedDate": "2020-05-29T18:50:22Z", "message": "Fix test cases."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "317255b962df6c0c5afbe1b96d4cdefd0be9c9b5", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/317255b962df6c0c5afbe1b96d4cdefd0be9c9b5", "committedDate": "2020-05-29T19:32:14Z", "message": "Fix failing test cases."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45adf8804296b54351e84c6b1421764e115138d9", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/45adf8804296b54351e84c6b1421764e115138d9", "committedDate": "2020-05-29T19:47:04Z", "message": "Adjust k6 tests to new subscriptions."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20fcfa85507ca60871fb8d68401c0ed1606362e2", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/20fcfa85507ca60871fb8d68401c0ed1606362e2", "committedDate": "2020-05-29T22:57:36Z", "message": "Fix test cases."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22bc58e47d0f20952ae93f7f84652d60c4fd2eec", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/22bc58e47d0f20952ae93f7f84652d60c4fd2eec", "committedDate": "2020-05-29T23:10:53Z", "message": "Fix codestyle issue."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cff7a981686642b7f165c858a3098c86ad5a41bd", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/cff7a981686642b7f165c858a3098c86ad5a41bd", "committedDate": "2020-05-29T23:14:25Z", "message": "Fix more test cases."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ba0c67e27fd4af867bf9e4ce86c85574992e905", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/9ba0c67e27fd4af867bf9e4ce86c85574992e905", "committedDate": "2020-05-30T21:38:54Z", "message": "Remove unneeded parts that got changed & update tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c3ebfb56651cfb8860606742baae12cd543cad0", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/0c3ebfb56651cfb8860606742baae12cd543cad0", "committedDate": "2020-05-30T22:04:20Z", "message": "Remove unneeded file."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cbaf7a302482916190cec8e538a0e5c488788002", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/cbaf7a302482916190cec8e538a0e5c488788002", "committedDate": "2020-06-01T08:51:06Z", "message": "Make progress on fixing test cases."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "651737f1a595b859cf0900f2bd56353e8c92d214", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/651737f1a595b859cf0900f2bd56353e8c92d214", "committedDate": "2020-06-01T09:07:28Z", "message": "Merge branch 'develop' into feature/reduce-websocket-subscriptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9942b9f113643836270847408d30ac4fbd7e44a", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/f9942b9f113643836270847408d30ac4fbd7e44a", "committedDate": "2020-06-01T11:29:04Z", "message": "Fix typescript tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24b8f0feb8b932cc97f2a5dbbc0b51025f3ec1b6", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/24b8f0feb8b932cc97f2a5dbbc0b51025f3ec1b6", "committedDate": "2020-06-01T13:22:19Z", "message": "Start securing the WS channels."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3cc81f533645f5474ea082730cbaca0ea882784a", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/3cc81f533645f5474ea082730cbaca0ea882784a", "committedDate": "2020-06-01T17:17:37Z", "message": "Implement unsubscribe/remove."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b6e12c7853515686137d36f6008049905d4ebdc", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/1b6e12c7853515686137d36f6008049905d4ebdc", "committedDate": "2020-06-01T17:52:03Z", "message": "Fix user check."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a575cd593c824b38b37e7a6360f42540d3cf2bfb", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/a575cd593c824b38b37e7a6360f42540d3cf2bfb", "committedDate": "2020-06-01T17:52:56Z", "message": "Merge remote-tracking branch 'origin/feature/reduce-websocket-subscriptions' into feature/reduce-websocket-subscriptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edbcb4bb3a383921abdd2410654a325d85a43627", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/edbcb4bb3a383921abdd2410654a325d85a43627", "committedDate": "2020-06-02T10:50:41Z", "message": "Fix issues with submission websocket messages."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d29de4c2f3d8883cfe3b48785bc4dd3eda6132cb", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/d29de4c2f3d8883cfe3b48785bc4dd3eda6132cb", "committedDate": "2020-06-02T11:50:27Z", "message": "Fix unsubscribe logic in submission service."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d91c8b4858a59bb4f7d7dfdca5826252e47c4476", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/d91c8b4858a59bb4f7d7dfdca5826252e47c4476", "committedDate": "2020-06-02T14:00:40Z", "message": "Don't add /user twice. Fix test case."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8d2018dc97ba6a149e28ec36b2d85ad73c7ec35", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/d8d2018dc97ba6a149e28ec36b2d85ad73c7ec35", "committedDate": "2020-06-02T14:28:09Z", "message": "Merge branch 'develop' into feature/reduce-websocket-subscriptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "503f2c2d7959e5328545184d57aa884913c4ee67", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/503f2c2d7959e5328545184d57aa884913c4ee67", "committedDate": "2020-06-02T18:23:45Z", "message": "Merge branch 'develop' into feature/reduce-websocket-subscriptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "147511954f7cfc1b5906eaccaed6415f7c428ad4", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/147511954f7cfc1b5906eaccaed6415f7c428ad4", "committedDate": "2020-06-03T08:57:07Z", "message": "Merge branch 'develop' into feature/reduce-websocket-subscriptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3abd5f6fcad127335dea89d7a501d4d5d66d7395", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/3abd5f6fcad127335dea89d7a501d4d5d66d7395", "committedDate": "2020-06-03T11:29:54Z", "message": "Add client test cases and fix small bugs."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a83c98e5cc14932c44d021bff19ef8503c7af81e", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/a83c98e5cc14932c44d021bff19ef8503c7af81e", "committedDate": "2020-06-03T11:52:38Z", "message": "Merge remote-tracking branch 'origin/feature/reduce-websocket-subscriptions' into feature/reduce-websocket-subscriptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37cb219020cef6a765a2e75d1764619011d0f2c2", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/37cb219020cef6a765a2e75d1764619011d0f2c2", "committedDate": "2020-06-03T20:40:46Z", "message": "Merge branch 'develop' into feature/reduce-websocket-subscriptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d97bd2b2ea610f9fa83fd7c177b358ed418257e1", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/d97bd2b2ea610f9fa83fd7c177b358ed418257e1", "committedDate": "2020-06-04T06:52:57Z", "message": "Remove unneeded service."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe5d35487e29c39aebb1853fbb406bef96ed355f", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/fe5d35487e29c39aebb1853fbb406bef96ed355f", "committedDate": "2020-06-04T07:53:07Z", "message": "Revert \"Remove unneeded service.\"\n\nThis reverts commit d97bd2b2ea610f9fa83fd7c177b358ed418257e1."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68e07a989bd1acb5e5888e9bbd77c36f077b31ad", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/68e07a989bd1acb5e5888e9bbd77c36f077b31ad", "committedDate": "2020-06-04T07:53:54Z", "message": "Initialize exercise service Lazy to break circular dependency."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eba3f04efe389baeb8430a3aac4fb5d3324c0df3", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/eba3f04efe389baeb8430a3aac4fb5d3324c0df3", "committedDate": "2020-06-04T09:28:31Z", "message": "Change personal to personalParticipation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7afa21c6e8d9982e2144e86c7ec7f31bdf7042f", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/c7afa21c6e8d9982e2144e86c7ec7f31bdf7042f", "committedDate": "2020-06-04T13:22:43Z", "message": "Use constants."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7747ced6d24ffcff1ed6808531fd22cfc58b86e7", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/7747ced6d24ffcff1ed6808531fd22cfc58b86e7", "committedDate": "2020-06-04T13:25:37Z", "message": "Restore some code."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "292e1a3fcd48d01e48e87810e7ef4347ec20f6a9", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/292e1a3fcd48d01e48e87810e7ef4347ec20f6a9", "committedDate": "2020-06-04T13:27:05Z", "message": "Revert unwanted code change."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "befeda999c9d3a6087383d277a8897956ecf02e1", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/befeda999c9d3a6087383d277a8897956ecf02e1", "committedDate": "2020-06-04T13:31:39Z", "message": "Whoopsie."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "276eb8af06e5845f17d085dd49ec4d2fc370cf99", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/276eb8af06e5845f17d085dd49ec4d2fc370cf99", "committedDate": "2020-06-04T13:48:13Z", "message": "Adjust interface."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66d073d74104c63b0e6d24e720510b095051c017", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/66d073d74104c63b0e6d24e720510b095051c017", "committedDate": "2020-06-04T14:17:40Z", "message": "Set participation if it is not present."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1MjE2OTE5", "url": "https://github.com/ls1intum/Artemis/pull/1531#pullrequestreview-425216919", "createdAt": "2020-06-05T11:28:19Z", "commit": {"oid": "66d073d74104c63b0e6d24e720510b095051c017"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fffe2f89637ea0da1faf8e12a0ec995025b99f54", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/fffe2f89637ea0da1faf8e12a0ec995025b99f54", "committedDate": "2020-06-07T12:59:24Z", "message": "Merge branch 'develop' into feature/reduce-websocket-subscriptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1cc155f73f09765d9fbf336526a3fa8880b43820", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/1cc155f73f09765d9fbf336526a3fa8880b43820", "committedDate": "2020-06-09T07:32:32Z", "message": "Fix bug where the building status was not shown correct."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40b3b58cec2ad824990989de94c1e7f363817bb8", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/40b3b58cec2ad824990989de94c1e7f363817bb8", "committedDate": "2020-06-09T07:42:27Z", "message": "Merge branch 'develop' into feature/reduce-websocket-subscriptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c8cfb7dc5b11d1286e05a68b466c75eec9e365c", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/2c8cfb7dc5b11d1286e05a68b466c75eec9e365c", "committedDate": "2020-06-09T08:51:43Z", "message": "Map participationId->exerciseId and use from there."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2OTgxNDQ1", "url": "https://github.com/ls1intum/Artemis/pull/1531#pullrequestreview-426981445", "createdAt": "2020-06-09T09:56:42Z", "commit": {"oid": "2c8cfb7dc5b11d1286e05a68b466c75eec9e365c"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MTE1MjY1", "url": "https://github.com/ls1intum/Artemis/pull/1531#pullrequestreview-427115265", "createdAt": "2020-06-09T12:57:14Z", "commit": {"oid": "2c8cfb7dc5b11d1286e05a68b466c75eec9e365c"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f50b11da4957d8fa3d4d7df9dd0f8f459033d779", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/f50b11da4957d8fa3d4d7df9dd0f8f459033d779", "committedDate": "2020-06-09T14:28:04Z", "message": "Fix bug where template submission was not showing building status."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MzQzMjc5", "url": "https://github.com/ls1intum/Artemis/pull/1531#pullrequestreview-427343279", "createdAt": "2020-06-09T16:34:00Z", "commit": {"oid": "f50b11da4957d8fa3d4d7df9dd0f8f459033d779"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NDM3ODE4", "url": "https://github.com/ls1intum/Artemis/pull/1531#pullrequestreview-427437818", "createdAt": "2020-06-09T18:36:56Z", "commit": {"oid": "f50b11da4957d8fa3d4d7df9dd0f8f459033d779"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxODozNjo1NlrOGhXWZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxODo0NTozNVrOGhXpeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYzODc1Ng==", "bodyText": "Would be nice if singular and plural are consistent for /topic/newSubmission and /topic/newResults.", "url": "https://github.com/ls1intum/Artemis/pull/1531#discussion_r437638756", "createdAt": "2020-06-09T18:36:56Z", "author": {"login": "madwau"}, "path": "src/main/java/de/tum/in/www1/artemis/config/Constants.java", "diffHunk": "@@ -32,7 +32,11 @@\n \n     public static final String FILEPATH_ID_PLACHEOLDER = \"PLACEHOLDER_FOR_ID\";\n \n-    public static final String PARTICIPATION_TOPIC_ROOT = \"/topic/participation/\";\n+    public static final String EXERCISE_TOPIC_ROOT = \"/topic/exercise/\";\n+\n+    public static final String NEW_SUBMISSION_TOPIC = \"/topic/newSubmission\";\n+\n+    public static final String NEW_RESULT_TOPIC = \"/topic/newResults\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f50b11da4957d8fa3d4d7df9dd0f8f459033d779"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY0MDI2NA==", "bodyText": "The method name suggests that it is checked whether the user is a TA or above but the actual check is done for instructor or above.", "url": "https://github.com/ls1intum/Artemis/pull/1531#discussion_r437640264", "createdAt": "2020-06-09T18:39:38Z", "author": {"login": "madwau"}, "path": "src/main/java/de/tum/in/www1/artemis/config/websocket/WebsocketConfiguration.java", "diffHunk": "@@ -228,4 +249,10 @@ private boolean isParticipationOwnedByUser(Principal principal, Long participati\n         StudentParticipation participation = participationService.findOneStudentParticipation(participationId);\n         return participation.isOwnedBy(principal.getName());\n     }\n+\n+    private boolean isUserTAOrHigherForExercise(Principal principal, Long exerciseId) {\n+        Exercise exercise = exerciseService.findOne(exerciseId);\n+        User user = userService.getUserWithGroupsAndAuthorities(principal.getName());\n+        return authorizationCheckService.isAtLeastInstructorForExercise(exercise, user);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f50b11da4957d8fa3d4d7df9dd0f8f459033d779"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY0MTYxNg==", "bodyText": "Maybe there can be a static builder method that constructs this topic? At least /newSubmission should not be hardcoded and appear in multiple places.", "url": "https://github.com/ls1intum/Artemis/pull/1531#discussion_r437641616", "createdAt": "2020-06-09T18:41:56Z", "author": {"login": "madwau"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ProgrammingSubmissionService.java", "diffHunk": "@@ -529,13 +528,27 @@ private String getProgrammingExerciseAllExerciseBuildsTriggeredTopic(Long progra\n      * @param submission ProgrammingSubmission\n      */\n     public void notifyUserAboutSubmission(ProgrammingSubmission submission) {\n-        String topic = Constants.PARTICIPATION_TOPIC_ROOT + submission.getParticipation().getId() + Constants.PROGRAMMING_SUBMISSION_TOPIC;\n-        messagingTemplate.convertAndSend(topic, submission);\n+        if (submission.getParticipation() instanceof StudentParticipation) {\n+            StudentParticipation studentParticipation = (StudentParticipation) submission.getParticipation();\n+            studentParticipation.getStudents().forEach(user -> messagingTemplate.convertAndSendToUser(user.getLogin(), NEW_SUBMISSION_TOPIC, submission));\n+        }\n+\n+        if (submission.getParticipation() != null && submission.getParticipation().getExercise() != null) {\n+            String exerciseTopic = EXERCISE_TOPIC_ROOT + submission.getParticipation().getExercise().getId() + \"/newSubmission\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f50b11da4957d8fa3d4d7df9dd0f8f459033d779"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY0MjczMw==", "bodyText": "Does not really explain what the method is actually checking.", "url": "https://github.com/ls1intum/Artemis/pull/1531#discussion_r437642733", "createdAt": "2020-06-09T18:44:01Z", "author": {"login": "madwau"}, "path": "src/main/java/de/tum/in/www1/artemis/service/WebsocketMessagingService.java", "diffHunk": "@@ -40,9 +48,46 @@ public void broadcastNewResult(Participation participation, Result result) {\n         var originalParticipation = result.getParticipation();\n         result.setParticipation(originalParticipation.copyParticipationId());\n \n-        messagingTemplate.convertAndSend(\"/topic/participation/\" + participation.getId() + \"/newResults\", result);\n+        // TODO: Are there other cases that must be handled here?\n+        if (participation instanceof StudentParticipation) {\n+            StudentParticipation studentParticipation = (StudentParticipation) participation;\n+            studentParticipation.getStudents().forEach(user -> messagingTemplate.convertAndSendToUser(user.getLogin(), NEW_RESULT_TOPIC, result));\n+        }\n+\n+        // Send to tutors, instructors and admins\n+        messagingTemplate.convertAndSend(getResultDestination(participation.getExercise().getId()), result);\n \n         // recover the participation because we might want to use it again after this method\n         result.setParticipation(originalParticipation);\n     }\n+\n+    /**\n+     * Returns true if the given destination should be handled by this service", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f50b11da4957d8fa3d4d7df9dd0f8f459033d779"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY0MzY0MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private participationToExercise = new Map<number, number>();\n          \n          \n            \n                private participationIdToExerciseId = new Map<number, number>();", "url": "https://github.com/ls1intum/Artemis/pull/1531#discussion_r437643640", "createdAt": "2020-06-09T18:45:35Z", "author": {"login": "madwau"}, "path": "src/main/webapp/app/exercises/programming/participate/programming-submission.service.ts", "diffHunk": "@@ -52,11 +52,15 @@ export class ProgrammingSubmissionService implements IProgrammingSubmissionServi\n     public PROGRAMMING_EXERCISE_RESOURCE_URL = SERVER_API_URL + 'api/programming-exercises/';\n     // Default value: 2 minutes.\n     private DEFAULT_EXPECTED_RESULT_ETA = 2 * 60 * 1000;\n-    private SUBMISSION_TEMPLATE_TOPIC = '/topic/participation/%participationId%/newSubmission';\n+    private SUBMISSION_TEMPLATE_TOPIC = '/topic/exercise/%exerciseId%/newSubmission';\n \n     private resultSubscriptions: { [participationId: number]: Subscription } = {};\n     // participationId -> topic\n     private submissionTopicsSubscribed = new Map<number, string>();\n+\n+    // participationId -> exerciseId\n+    private participationToExercise = new Map<number, number>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f50b11da4957d8fa3d4d7df9dd0f8f459033d779"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04086fc7a18fcfa595e53d148084ab85718aaac1", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/04086fc7a18fcfa595e53d148084ab85718aaac1", "committedDate": "2020-06-09T19:54:11Z", "message": "Update src/main/webapp/app/exercises/programming/participate/programming-submission.service.ts\n\nCo-authored-by: Martin Wauligmann <martin@wauligmann.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c53cbfd4f0e3d857926005e608dbfcba5d9c84a1", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/c53cbfd4f0e3d857926005e608dbfcba5d9c84a1", "committedDate": "2020-06-09T20:00:47Z", "message": "Implement feedback."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50dfc5047ac99d0e9e0192259bb65b0f1bf8077b", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/50dfc5047ac99d0e9e0192259bb65b0f1bf8077b", "committedDate": "2020-06-09T20:02:26Z", "message": "Merge remote-tracking branch 'origin/feature/reduce-websocket-subscriptions' into feature/reduce-websocket-subscriptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cae3af33bd969cd0ad8c04bae8c84a931d822052", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/cae3af33bd969cd0ad8c04bae8c84a931d822052", "committedDate": "2020-06-09T20:42:44Z", "message": "Add missing renaming of attribute."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "051f4681935ea11b0f4d80d099af8d2decc7dc88", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/051f4681935ea11b0f4d80d099af8d2decc7dc88", "committedDate": "2020-06-09T20:43:38Z", "message": "Fix wrong replacement."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NTYzMjg5", "url": "https://github.com/ls1intum/Artemis/pull/1531#pullrequestreview-427563289", "createdAt": "2020-06-09T21:36:31Z", "commit": {"oid": "051f4681935ea11b0f4d80d099af8d2decc7dc88"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NTY0NzM0", "url": "https://github.com/ls1intum/Artemis/pull/1531#pullrequestreview-427564734", "createdAt": "2020-06-09T21:39:10Z", "commit": {"oid": "051f4681935ea11b0f4d80d099af8d2decc7dc88"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2709, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}