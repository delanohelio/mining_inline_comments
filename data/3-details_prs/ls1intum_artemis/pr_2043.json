{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwOTQ2OTI5", "number": 2043, "title": "Improve Distributed Quiz Exercise Cache Code", "bodyText": "Checklist\n\n I tested all changes and all related features with different users (student, tutor, instructor, admin) on the test server https://artemistest.ase.in.tum.de.\n Server: I documented the Java code using JavaDoc style.\n\nMotivation and Context\nFix some code style issues and improve the readability, add more documentation, explain the reasoning and make the code easier understandable and maintainable.\nDescription\n\nRemoved some unnecessary explicit annotation attributes\nUsed null as id for the empty quiz exercise cache instead of -1\nRenamed some attributes, methods and classes\nEncapsulated the quiz exercise caches and introduced a new class\nThrow an UnsupportedOperationException when clear() is called on the empty cache.\nAdded a lot more JavaDoc to classes, methods, fields and statements.\nAdded and modified integration tests\n\nOnly the clear() and null-id changes should change functionality (that should never be used anywhere).\nSteps for Testing\n\nMost important: review the code and check that it is possible to understand what it does. Check if everything looks right.\nExecute (quiz) tests\nTest participating in Artemis Quiz Exercises, check that no submission is lost.", "createdAt": "2020-08-20T14:26:25Z", "url": "https://github.com/ls1intum/Artemis/pull/2043", "merged": true, "mergeCommit": {"oid": "8ced15f5048307e781dbfd7dc6a565bd917517c2"}, "closed": true, "closedAt": "2020-09-24T08:07:51Z", "author": {"login": "MaisiKoleni"}, "timelineItems": {"totalCount": 34, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAwjfxgH2gAyNDcwOTQ2OTI5OjhlODc0YWZkOWViNDQ4OGEwZGFiMjg1OGFmNjlmMzU2MzZmNjg2NDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdL8nSSgFqTQ5NTMxODc2MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8e874afd9eb4488a0dab2858af69f35636f68645", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/8e874afd9eb4488a0dab2858af69f35636f68645", "committedDate": "2020-08-20T13:51:27Z", "message": "Make task classes final"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b02bbecd629210591507f0e9d8b0bdad32d25eb", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/0b02bbecd629210591507f0e9d8b0bdad32d25eb", "committedDate": "2020-08-20T13:52:12Z", "message": "Remove redundant explicit required attribute on Autowired"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa4ca553aa78765bcfa01d3adec31c2b206026fc", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/aa4ca553aa78765bcfa01d3adec31c2b206026fc", "committedDate": "2020-08-20T13:55:20Z", "message": "Set EmptzyQuizExerciseCache id to null, document it and throw on clear()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf15a4a34bb51adeb651a307b68f8872a2d7977f", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/bf15a4a34bb51adeb651a307b68f8872a2d7977f", "committedDate": "2020-08-20T13:55:47Z", "message": "Rename to exerciseId"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fdaf9b2c1ad2f731d61719ca6b934a6e12e6073c", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/fdaf9b2c1ad2f731d61719ca6b934a6e12e6073c", "committedDate": "2020-08-20T13:57:04Z", "message": "Fix if code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3d367a6f36c8f7aaf7400d3992b14a49fd25d63", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/e3d367a6f36c8f7aaf7400d3992b14a49fd25d63", "committedDate": "2020-08-20T13:57:45Z", "message": "Rename and document the cache serializer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3feb2500de99e6a9a06cecb7fbfc3139c60f5729", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/3feb2500de99e6a9a06cecb7fbfc3139c60f5729", "committedDate": "2020-08-20T13:58:09Z", "message": "Document the distributed cache more"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f24737114f4cf55fad8cf216be9cb0eab08c8fb1", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/f24737114f4cf55fad8cf216be9cb0eab08c8fb1", "committedDate": "2020-08-20T13:59:02Z", "message": "Add a bit more documentation to the QuizExerciseCache itself"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ee064df7f50a4a817998bf03f9ef4317b12e8ac", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/5ee064df7f50a4a817998bf03f9ef4317b12e8ac", "committedDate": "2020-08-20T14:01:30Z", "message": "Introduce QuizCache class to encapsulate the quiz cache behavior"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0921653f317bdac099dc69ab5fda1b12a501e95b", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/0921653f317bdac099dc69ab5fda1b12a501e95b", "committedDate": "2020-08-20T14:27:52Z", "message": "Create a new quiz cache in the constructor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f57b544269ea1592171513f30cb58d66ebf0fc68", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/f57b544269ea1592171513f30cb58d66ebf0fc68", "committedDate": "2020-08-20T15:07:32Z", "message": "Improve code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90888b6e19214ffcd1d2c3c4f5b0f17c97fc22ba", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/90888b6e19214ffcd1d2c3c4f5b0f17c97fc22ba", "committedDate": "2020-08-24T12:37:30Z", "message": "Merge branch 'develop' into chore/quiz-exercise-cache"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca919d673798fcabbd68dc756e224bac29adf895", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/ca919d673798fcabbd68dc756e224bac29adf895", "committedDate": "2020-08-25T22:22:14Z", "message": "Improve handling null"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67d190869c75ee324205fa6f9b11a3b6e7e65a7a", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/67d190869c75ee324205fa6f9b11a3b6e7e65a7a", "committedDate": "2020-08-25T22:23:47Z", "message": "Change LOG into log again"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfd0e4ba19bad328b14a1d460e79653f8c65b189", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/bfd0e4ba19bad328b14a1d460e79653f8c65b189", "committedDate": "2020-08-26T15:58:16Z", "message": "Remove unnecessary empty lines"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16d690415963bdaab432f2657354eafb72bc8900", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/16d690415963bdaab432f2657354eafb72bc8900", "committedDate": "2020-08-26T16:11:32Z", "message": "Test more different situations and interactions with live quiz exercises"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "265d8f660400e7b2d442c39624372b1f53e9c7e2", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/265d8f660400e7b2d442c39624372b1f53e9c7e2", "committedDate": "2020-08-26T16:29:44Z", "message": "Submit the submission in the test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0869d090fe90a78f0c12945c227f03ffdaf4703f", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/0869d090fe90a78f0c12945c227f03ffdaf4703f", "committedDate": "2020-08-26T17:38:34Z", "message": "Increase the waiting periods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46d1c431f48f2b3d63042d3aec55cb447e31927a", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/46d1c431f48f2b3d63042d3aec55cb447e31927a", "committedDate": "2020-08-26T17:56:33Z", "message": "Merge branch 'develop' into chore/quiz-exercise-cache"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89dcf8da3c35e3c4d6b63196c47c147cc66bf390", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/89dcf8da3c35e3c4d6b63196c47c147cc66bf390", "committedDate": "2020-08-26T22:04:07Z", "message": "Improve test consistency and document times"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "519c530ec1e6eb72f178d31ec760e3dad87af528", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/519c530ec1e6eb72f178d31ec760e3dad87af528", "committedDate": "2020-08-26T22:06:01Z", "message": "Improve order of operations when updating exercise scheduling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87a3c00f21d4ec970eceeafb60b22a33f5f4ef43", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/87a3c00f21d4ec970eceeafb60b22a33f5f4ef43", "committedDate": "2020-08-26T22:19:15Z", "message": "Improve usage of the near cache, cache directly after write"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cc6e007a25ab8976ef6cff63fcc33637ee66583", "author": {"user": {"login": "MaisiKoleni", "name": "Christian Femers"}}, "url": "https://github.com/ls1intum/Artemis/commit/0cc6e007a25ab8976ef6cff63fcc33637ee66583", "committedDate": "2020-08-26T22:20:20Z", "message": "Simplify the process cached submissions loop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "817e8b81840cdb9acc11cf89618d4cdc7f3153c0", "author": {"user": {"login": "fde312", "name": "Francisco De las Casas Young"}}, "url": "https://github.com/ls1intum/Artemis/commit/817e8b81840cdb9acc11cf89618d4cdc7f3153c0", "committedDate": "2020-08-27T20:35:50Z", "message": "Merge branch 'develop' into chore/quiz-exercise-cache"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20f71dd079d3886ee38e1aa4116cfa60b4434043", "author": {"user": {"login": "krusche", "name": "Stephan Krusche"}}, "url": "https://github.com/ls1intum/Artemis/commit/20f71dd079d3886ee38e1aa4116cfa60b4434043", "committedDate": "2020-08-27T20:46:50Z", "message": "Merge branch 'develop' into chore/quiz-exercise-cache"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d8cd2879f492751aaf7cf486f93e764ac0ce8dc", "author": {"user": {"login": "fde312", "name": "Francisco De las Casas Young"}}, "url": "https://github.com/ls1intum/Artemis/commit/2d8cd2879f492751aaf7cf486f93e764ac0ce8dc", "committedDate": "2020-08-28T11:39:36Z", "message": "Merge branch 'develop' into chore/quiz-exercise-cache"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5NjYzOTQx", "url": "https://github.com/ls1intum/Artemis/pull/2043#pullrequestreview-479663941", "createdAt": "2020-09-01T11:53:37Z", "commit": {"oid": "2d8cd2879f492751aaf7cf486f93e764ac0ce8dc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5OTcyMTA3", "url": "https://github.com/ls1intum/Artemis/pull/2043#pullrequestreview-479972107", "createdAt": "2020-09-01T17:36:01Z", "commit": {"oid": "2d8cd2879f492751aaf7cf486f93e764ac0ce8dc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwMDI4NDM2", "url": "https://github.com/ls1intum/Artemis/pull/2043#pullrequestreview-480028436", "createdAt": "2020-09-01T18:53:04Z", "commit": {"oid": "2d8cd2879f492751aaf7cf486f93e764ac0ce8dc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d37dfe054ccf8f01a0501ba72e2ed228277c778", "author": {"user": {"login": "jpbernius", "name": "Jan Philip Bernius"}}, "url": "https://github.com/ls1intum/Artemis/commit/3d37dfe054ccf8f01a0501ba72e2ed228277c778", "committedDate": "2020-09-15T10:07:10Z", "message": "Merge branch 'develop' into chore/quiz-exercise-cache"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4NTMxNTY0", "url": "https://github.com/ls1intum/Artemis/pull/2043#pullrequestreview-488531564", "createdAt": "2020-09-15T10:12:07Z", "commit": {"oid": "3d37dfe054ccf8f01a0501ba72e2ed228277c778"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxMDoxMjowN1rOHR6shw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxMDoxMjowN1rOHR6shw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODU0OTUxMQ==", "bodyText": "Codacy found an issue: The constant name 'log' doesn't match '[A-Z][A-Z_0-9]*'", "url": "https://github.com/ls1intum/Artemis/pull/2043#discussion_r488549511", "createdAt": "2020-09-15T10:12:07Z", "author": {"login": "artemis-bot"}, "path": "src/main/java/de/tum/in/www1/artemis/service/scheduled/quiz/QuizCache.java", "diffHunk": "@@ -0,0 +1,264 @@\n+package de.tum.in.www1.artemis.service.scheduled.quiz;\n+\n+import java.util.*;\n+import java.util.function.UnaryOperator;\n+import java.util.stream.Collectors;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.hazelcast.config.*;\n+import com.hazelcast.core.HazelcastInstance;\n+import com.hazelcast.map.IMap;\n+import com.hazelcast.topic.ITopic;\n+\n+import de.tum.in.www1.artemis.config.Constants;\n+import de.tum.in.www1.artemis.domain.quiz.QuizExercise;\n+\n+/**\n+ * This class manages all {@link QuizExerciseCache}s for all cached quiz exercises.\n+ * <p>\n+ * It encapsulates the Hazelcast objects to avoid unsafe actions on them and to prevent mistakes.\n+ * Hazelcast distributed objects are more database like, which means that modifications of the objects themselves\n+ * will not have any effect until they are send to all other instances, e.g. by replacing the value in the data structure.\n+ * <p>\n+ * To handle this better, we provide methods in this class that make {@linkplain #getReadCacheFor(Long) read-operations} and \n+ * {@linkplain #getTransientWriteCacheFor(Long) write operations on transient properties} easier and less error prone; \n+ * and that allow for {@linkplain #performCacheWrite(Long, UnaryOperator) atomic writes} (including an \n+ * {@linkplain #performCacheWriteIfPresent(Long, UnaryOperator) if-present variant}).\n+ */\n+final class QuizCache {\n+\n+    private static final Logger log = LoggerFactory.getLogger(QuizCache.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d37dfe054ccf8f01a0501ba72e2ed228277c778"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4NTMxNTg0", "url": "https://github.com/ls1intum/Artemis/pull/2043#pullrequestreview-488531584", "createdAt": "2020-09-15T10:12:09Z", "commit": {"oid": "3d37dfe054ccf8f01a0501ba72e2ed228277c778"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxMDoxMjowOVrOHR6skQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxMDoxMjowOVrOHR6skQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODU0OTUyMQ==", "bodyText": "Codacy found an issue: The constant name 'log' doesn't match '[A-Z][A-Z_0-9]*'", "url": "https://github.com/ls1intum/Artemis/pull/2043#discussion_r488549521", "createdAt": "2020-09-15T10:12:09Z", "author": {"login": "artemis-bot"}, "path": "src/main/java/de/tum/in/www1/artemis/service/scheduled/quiz/QuizScheduleService.java", "diffHunk": "@@ -46,16 +43,10 @@\n @Service\n public class QuizScheduleService {\n \n-    static final Logger log = LoggerFactory.getLogger(QuizScheduleService.class);\n+    private static final Logger log = LoggerFactory.getLogger(QuizScheduleService.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d37dfe054ccf8f01a0501ba72e2ed228277c778"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4NTMxNTkx", "url": "https://github.com/ls1intum/Artemis/pull/2043#pullrequestreview-488531591", "createdAt": "2020-09-15T10:12:10Z", "commit": {"oid": "3d37dfe054ccf8f01a0501ba72e2ed228277c778"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxMDoxMjoxMFrOHR6slw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxMDoxMjoxMFrOHR6slw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODU0OTUyNw==", "bodyText": "Codacy found an issue: The constant name 'log' doesn't match '[A-Z][A-Z_0-9]*'", "url": "https://github.com/ls1intum/Artemis/pull/2043#discussion_r488549527", "createdAt": "2020-09-15T10:12:10Z", "author": {"login": "artemis-bot"}, "path": "src/main/java/de/tum/in/www1/artemis/service/scheduled/quiz/EmptyQuizExerciseCache.java", "diffHunk": "@@ -14,16 +14,27 @@\n import de.tum.in.www1.artemis.domain.quiz.QuizSubmission;\n \n /**\n- * Empty cache object representing a cache miss\n+ * Empty cache object representing a cache miss.\n+ * <p> \n+ * This allows to handle a not-cached quiz exercise elegantly, because most operations on the cache are read operations on the\n+ * exercise object or the submission, participation or result map. This immutable, singleton class returning only null or empty\n+ * data structures on read operations allows being used as as default, if no real cache exists. This saves us much branching and\n+ * checking in the {@link QuizScheduleService}, as we can either just return the {@link EmptyQuizExerciseCache} or create a new\n+ * real {@link QuizExerciseCache} for write operations, if no cache can be found.\n+ * <p>\n+ * All method that modify a {@link QuizExerciseCache} throw an {@link UnsupportedOperationException} for the empty cache. \n  */\n final class EmptyQuizExerciseCache extends QuizExerciseCache {\n \n-    static final Logger log = LoggerFactory.getLogger(EmptyQuizExerciseCache.class);\n+    private static final Logger log = LoggerFactory.getLogger(EmptyQuizExerciseCache.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d37dfe054ccf8f01a0501ba72e2ed228277c778"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1MzE4NzYw", "url": "https://github.com/ls1intum/Artemis/pull/2043#pullrequestreview-495318760", "createdAt": "2020-09-24T08:07:37Z", "commit": {"oid": "3d37dfe054ccf8f01a0501ba72e2ed228277c778"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4058, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}