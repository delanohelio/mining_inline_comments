{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg5ODA3MTI5", "number": 2109, "title": "Sync feature toggle using Hazelcast map.", "bodyText": "Checklist\n\n I tested all changes and all related features with different users (student, tutor, instructor, admin) on the test server https://artemistest2.ase.in.tum.de.\n Server: I added multiple integration tests (Spring) related to the features (with a high test coverage)\n Server: I documented the Java code using JavaDoc style.\n\nMotivation and Context\nArtemis has feature toggles that allow administrators to disable certain features of Artemis without having to restart the application server (currently, only programming exercises can be disabled).\nThe feature toggle state (whether a certain feature is enabled or disabled) was currently only stored in an Enum on the instance where the administrator was connected to when performing the change but was not distributed between all instances.\nThis leads to inconsistent states where a feature can be enabled on one instance but disabled on another.\nThis PR synchronizes the feature state between all instances.\nDescription\nInstead of the Enum that holds the state (which cannot easily be shared), a map is shared between all instances:\n\nEach feature is either enabled (true) or disabled (false)\n\nSteps for Testing\nThis PR can only really be tested if you are running at least two instances of Artemis (thus you should use TS2 for testing).\nYou can however also test on TS1/3 and just make sure nothing broke.\n\nLog in to Artemis\nNavigate to Server Administration >  Feature Toggles\nToggle the state of a feature: The change should immediately be effective to all users, even if they are connected to a different instance.\n\nThis can be tested on TS2 with multiple testers connected to different instances, just DM me (or anyone else with access to TS2) on Slack, so that we can verify that the testers are indeed connected to different instances.\nTest Coverage\nServer:\n\nFeatureToggleService: 100%", "createdAt": "2020-09-19T18:24:01Z", "url": "https://github.com/ls1intum/Artemis/pull/2109", "merged": true, "mergeCommit": {"oid": "af313339277555b964f5d5cdddad1c1f6fad75e9"}, "closed": true, "closedAt": "2020-10-06T19:54:59Z", "author": {"login": "sleiss"}, "timelineItems": {"totalCount": 32, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdKebaHAH2gAyNDg5ODA3MTI5OmNkNzBkNWRmYzE3MDFlYjI4ZTM4ZTYwZDg4YTEyMDBkYWQxMjA1M2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdP96zMAFqTUwMzMwODgyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cd70d5dfc1701eb28e38e60d88a1200dad12053c", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/cd70d5dfc1701eb28e38e60d88a1200dad12053c", "committedDate": "2020-09-19T18:23:34Z", "message": "Sync feature toggle using Hazelcast lists."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cde47c3aca979bbd2d73ccbe96d4769c420bb68c", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/cde47c3aca979bbd2d73ccbe96d4769c420bb68c", "committedDate": "2020-09-23T15:53:48Z", "message": "Merge branch 'develop' into feature/sync-feature-toggle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee1e6170a23d929f468663982b2b6aeaccfecb9d", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/ee1e6170a23d929f468663982b2b6aeaccfecb9d", "committedDate": "2020-09-24T11:15:19Z", "message": "Rename FeatureToggleService back."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7169e858041b403af18cd458c6c851c5e9df56f0", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/7169e858041b403af18cd458c6c851c5e9df56f0", "committedDate": "2020-09-29T09:03:49Z", "message": "Merge branch 'develop' into feature/sync-feature-toggle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b96524bce3b7cf93652b8b0799fb4b27f4683469", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/b96524bce3b7cf93652b8b0799fb4b27f4683469", "committedDate": "2020-09-29T09:19:01Z", "message": "Add some comments."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e741e2114e7d4758a2636b59a40080d5019cc536", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/e741e2114e7d4758a2636b59a40080d5019cc536", "committedDate": "2020-09-29T09:51:51Z", "message": "Add/Adjust test cases."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a47460bf58d0174481e887403f399510aaf1d2d", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/6a47460bf58d0174481e887403f399510aaf1d2d", "committedDate": "2020-09-29T09:52:11Z", "message": "Merge branch 'develop' into feature/sync-feature-toggle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b4054ab917736ca7c4f28b62574a3c14964f928", "author": {"user": {"login": "krusche", "name": "Stephan Krusche"}}, "url": "https://github.com/ls1intum/Artemis/commit/0b4054ab917736ca7c4f28b62574a3c14964f928", "committedDate": "2020-09-29T17:22:03Z", "message": "Merge branch 'develop' into feature/sync-feature-toggle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c44a8441d82d7696bff45f913c7ede0858767af4", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/c44a8441d82d7696bff45f913c7ede0858767af4", "committedDate": "2020-09-29T19:05:58Z", "message": "Merge branch 'develop' into feature/sync-feature-toggle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c75976894549cef77af594c7d8995eefe106d66", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/0c75976894549cef77af594c7d8995eefe106d66", "committedDate": "2020-09-30T08:19:59Z", "message": "Reset feature state after tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d50669347af7cda4227d34f95c4e9e4dfa073a4", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/5d50669347af7cda4227d34f95c4e9e4dfa073a4", "committedDate": "2020-09-30T08:20:12Z", "message": "Merge remote-tracking branch 'origin/feature/sync-feature-toggle' into feature/sync-feature-toggle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28ec2fe7c67279d18654e5e18b3350d04771e874", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/28ec2fe7c67279d18654e5e18b3350d04771e874", "committedDate": "2020-09-30T08:26:29Z", "message": "Merge branch 'develop' into feature/sync-feature-toggle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edafe0844a13a639b75396f5aadbe6fab1028d6c", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/edafe0844a13a639b75396f5aadbe6fab1028d6c", "committedDate": "2020-09-30T08:28:14Z", "message": "Remove unneeded ZonedDateTime."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c28d2672ddbcb75857fea48a058d9c2a4ce61758", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/c28d2672ddbcb75857fea48a058d9c2a4ce61758", "committedDate": "2020-09-30T08:29:29Z", "message": "Merge remote-tracking branch 'origin/feature/sync-feature-toggle' into feature/sync-feature-toggle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7eecdfed80101cc760a168cc0273e266d8a916a", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/e7eecdfed80101cc760a168cc0273e266d8a916a", "committedDate": "2020-09-30T09:17:11Z", "message": "Add sleep after disabling."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c282089846ac81e77d00e9db75a755d49db9e9bc", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/c282089846ac81e77d00e9db75a755d49db9e9bc", "committedDate": "2020-09-30T11:40:38Z", "message": "Add more sleep."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51fd3555cb1e09e41e7ad876ca942db61f5841c7", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/51fd3555cb1e09e41e7ad876ca942db61f5841c7", "committedDate": "2020-10-05T19:14:39Z", "message": "Merge branch 'develop' into feature/sync-feature-toggle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNDEwMTY2", "url": "https://github.com/ls1intum/Artemis/pull/2109#pullrequestreview-502410166", "createdAt": "2020-10-05T20:50:13Z", "commit": {"oid": "51fd3555cb1e09e41e7ad876ca942db61f5841c7"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc8107c8548b0d2bb06c80e2a14a46ce30d493b0", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/fc8107c8548b0d2bb06c80e2a14a46ce30d493b0", "committedDate": "2020-10-05T21:06:57Z", "message": "Use Map instead of two lists."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3935154fc3d318f1ec1a9ba57fbcbfbfa5041211", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/3935154fc3d318f1ec1a9ba57fbcbfbfa5041211", "committedDate": "2020-10-05T21:09:10Z", "message": "Merge remote-tracking branch 'origin/feature/sync-feature-toggle' into feature/sync-feature-toggle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32ab3941489dd8457f1fc758dac7762860c2870d", "author": {"user": {"login": "krusche", "name": "Stephan Krusche"}}, "url": "https://github.com/ls1intum/Artemis/commit/32ab3941489dd8457f1fc758dac7762860c2870d", "committedDate": "2020-10-06T09:50:59Z", "message": "Merge branch 'develop' into feature/sync-feature-toggle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "965cdc1f7d6ce7d69f336818c7cc13c946b44e85", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/965cdc1f7d6ce7d69f336818c7cc13c946b44e85", "committedDate": "2020-10-06T10:03:15Z", "message": "Adjust comment."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNzg1NDA0", "url": "https://github.com/ls1intum/Artemis/pull/2109#pullrequestreview-502785404", "createdAt": "2020-10-06T10:11:55Z", "commit": {"oid": "965cdc1f7d6ce7d69f336818c7cc13c946b44e85"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMDoxMTo1NVrOHc_XAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMDoxMTo1NVrOHc_XAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDE2MDI1OQ==", "bodyText": "Codacy found an issue: Missing a Javadoc comment.", "url": "https://github.com/ls1intum/Artemis/pull/2109#discussion_r500160259", "createdAt": "2020-10-06T10:11:55Z", "author": {"login": "artemis-bot"}, "path": "src/test/java/de/tum/in/www1/artemis/service/FeatureToggleServiceTest.java", "diffHunk": "@@ -0,0 +1,84 @@\n+package de.tum.in.www1.artemis.service;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+\n+import de.tum.in.www1.artemis.AbstractSpringIntegrationBambooBitbucketJiraTest;\n+import de.tum.in.www1.artemis.service.feature.Feature;\n+import de.tum.in.www1.artemis.service.feature.FeatureToggleService;\n+\n+public class FeatureToggleServiceTest extends AbstractSpringIntegrationBambooBitbucketJiraTest {\n+\n+    @Autowired\n+    FeatureToggleService featureToggleService;\n+\n+    @AfterEach\n+    public void checkReset() {\n+        // Verify that the test has resetted the state\n+        // Must be extended if additional features are added\n+        assertTrue(featureToggleService.isFeatureEnabled(Feature.PROGRAMMING_EXERCISES));\n+    }\n+\n+    @Test\n+    public void testSetFeaturesEnabled() {\n+        Map<Feature, Boolean> featureStates = new HashMap<>();\n+        featureStates.put(Feature.PROGRAMMING_EXERCISES, true);\n+        featureToggleService.updateFeatureToggles(featureStates);\n+        assertTrue(featureToggleService.isFeatureEnabled(Feature.PROGRAMMING_EXERCISES));\n+    }\n+\n+    @Test", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "965cdc1f7d6ce7d69f336818c7cc13c946b44e85"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNzg1NDIx", "url": "https://github.com/ls1intum/Artemis/pull/2109#pullrequestreview-502785421", "createdAt": "2020-10-06T10:11:56Z", "commit": {"oid": "965cdc1f7d6ce7d69f336818c7cc13c946b44e85"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMDoxMTo1NlrOHc_XCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMDoxMTo1NlrOHc_XCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDE2MDI2Nw==", "bodyText": "Codacy found an issue: Useless parentheses.", "url": "https://github.com/ls1intum/Artemis/pull/2109#discussion_r500160267", "createdAt": "2020-10-06T10:11:56Z", "author": {"login": "artemis-bot"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ParticipationResource.java", "diffHunk": "@@ -127,7 +131,8 @@ public ParticipationResource(ParticipationService participationService, Programm\n         // Also don't allow participations if the feature is disabled\n         if (exercise instanceof ProgrammingExercise) {\n             var programmingExercise = (ProgrammingExercise) exercise;\n-            if (!Feature.PROGRAMMING_EXERCISES.isEnabled() || (programmingExercise.getDueDate() != null && ZonedDateTime.now().isAfter(programmingExercise.getDueDate())\n+            if (!featureToggleService.isFeatureEnabled(Feature.PROGRAMMING_EXERCISES) || (programmingExercise.getDueDate() != null", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "965cdc1f7d6ce7d69f336818c7cc13c946b44e85"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da8b0f94c4d5a2ad6923c7639fee0548bf74cc9f", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/da8b0f94c4d5a2ad6923c7639fee0548bf74cc9f", "committedDate": "2020-10-06T19:03:30Z", "message": "Merge branch 'develop' into feature/sync-feature-toggle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3dc8eea82a279c01d51ed658ae346249475c1e7", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/a3dc8eea82a279c01d51ed658ae346249475c1e7", "committedDate": "2020-10-06T19:21:23Z", "message": "Remove sleep."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMjg2OTU1", "url": "https://github.com/ls1intum/Artemis/pull/2109#pullrequestreview-503286955", "createdAt": "2020-10-06T19:23:04Z", "commit": {"oid": "a3dc8eea82a279c01d51ed658ae346249475c1e7"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9c723e96689260dbe200b87db60bf454d30139c", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/e9c723e96689260dbe200b87db60bf454d30139c", "committedDate": "2020-10-06T19:25:10Z", "message": "Remove sleep."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMjg5Mjgx", "url": "https://github.com/ls1intum/Artemis/pull/2109#pullrequestreview-503289281", "createdAt": "2020-10-06T19:26:31Z", "commit": {"oid": "e9c723e96689260dbe200b87db60bf454d30139c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMjg5NTAy", "url": "https://github.com/ls1intum/Artemis/pull/2109#pullrequestreview-503289502", "createdAt": "2020-10-06T19:26:52Z", "commit": {"oid": "e9c723e96689260dbe200b87db60bf454d30139c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMzAxMzA1", "url": "https://github.com/ls1intum/Artemis/pull/2109#pullrequestreview-503301305", "createdAt": "2020-10-06T19:43:41Z", "commit": {"oid": "e9c723e96689260dbe200b87db60bf454d30139c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMzA4ODIw", "url": "https://github.com/ls1intum/Artemis/pull/2109#pullrequestreview-503308820", "createdAt": "2020-10-06T19:54:32Z", "commit": {"oid": "e9c723e96689260dbe200b87db60bf454d30139c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4190, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}