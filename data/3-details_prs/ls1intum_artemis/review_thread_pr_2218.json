{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA0OTAwMDIz", "number": 2218, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMToxODowNFrOEzQHhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMDo0MjoyOVrOEzvIHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyMTc2OTAyOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/AuthorizationCheckService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMToxODowNFrOHqXMcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMToxODowNFrOHqXMcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE4MjI1Nw==", "bodyText": "Codacy found an issue: Useless parentheses.", "url": "https://github.com/ls1intum/Artemis/pull/2218#discussion_r514182257", "createdAt": "2020-10-29T11:18:04Z", "author": {"login": "artemis-bot"}, "path": "src/main/java/de/tum/in/www1/artemis/service/AuthorizationCheckService.java", "diffHunk": "@@ -311,6 +312,24 @@ public boolean isAllowedToSeeExercise(Exercise exercise, User user) {\n         return isInstructorInCourse(course, user) || isTeachingAssistantInCourse(course, user) || (isStudentInCourse(course, user) && exercise.isVisibleToStudents());\n     }\n \n+    /**\n+     * Determines if a user is allowed to see a lecture unit\n+     *\n+     * @param lectureUnit the lectureUnit for which to check permission\n+     * @param user        the user for which to check permission\n+     * @return true if the user is allowed, false otherwise\n+     */\n+    public boolean isAllowedToSeeLectureUnit(LectureUnit lectureUnit, User user) {\n+        if (user == null || user.getGroups() == null) {\n+            user = userService.getUserWithGroupsAndAuthorities();\n+        }\n+        if (isAdmin(user)) {\n+            return true;\n+        }\n+        Course course = lectureUnit.getLecture().getCourse();\n+        return isInstructorInCourse(course, user) || isTeachingAssistantInCourse(course, user) || (isStudentInCourse(course, user) && lectureUnit.isVisibleToStudents());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56728e350b1d8d8275795e67a1baa258d20c8e27"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyMTc2OTExOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/AuthorizationCheckService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMToxODowNVrOHqXMew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMToxODowNVrOHqXMew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE4MjI2Nw==", "bodyText": "Codacy found an issue: Avoid reassigning parameters such as 'user'", "url": "https://github.com/ls1intum/Artemis/pull/2218#discussion_r514182267", "createdAt": "2020-10-29T11:18:05Z", "author": {"login": "artemis-bot"}, "path": "src/main/java/de/tum/in/www1/artemis/service/AuthorizationCheckService.java", "diffHunk": "@@ -311,6 +312,24 @@ public boolean isAllowedToSeeExercise(Exercise exercise, User user) {\n         return isInstructorInCourse(course, user) || isTeachingAssistantInCourse(course, user) || (isStudentInCourse(course, user) && exercise.isVisibleToStudents());\n     }\n \n+    /**\n+     * Determines if a user is allowed to see a lecture unit\n+     *\n+     * @param lectureUnit the lectureUnit for which to check permission\n+     * @param user        the user for which to check permission\n+     * @return true if the user is allowed, false otherwise\n+     */\n+    public boolean isAllowedToSeeLectureUnit(LectureUnit lectureUnit, User user) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56728e350b1d8d8275795e67a1baa258d20c8e27"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyMTc2OTE2OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/ExerciseService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMToxODowNlrOHqXMgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMToxODowNlrOHqXMgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE4MjI3Mg==", "bodyText": "Codacy found an issue: Avoid long parameter lists.", "url": "https://github.com/ls1intum/Artemis/pull/2218#discussion_r514182272", "createdAt": "2020-10-29T11:18:06Z", "author": {"login": "artemis-bot"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ExerciseService.java", "diffHunk": "@@ -64,11 +65,13 @@\n \n     private final TeamService teamService;\n \n-    public ExerciseService(ExerciseRepository exerciseRepository, ParticipationService participationService, AuthorizationCheckService authCheckService,\n-            ProgrammingExerciseService programmingExerciseService, QuizExerciseService quizExerciseService, QuizScheduleService quizScheduleService,\n-            TutorParticipationRepository tutorParticipationRepository, ExampleSubmissionService exampleSubmissionService, AuditEventRepository auditEventRepository,\n-            ComplaintRepository complaintRepository, ComplaintResponseRepository complaintResponseRepository, TeamService teamService, StudentExamRepository studentExamRepository,\n-            ExamRepository exampRepository) {\n+    private final ExerciseUnitRepository exerciseUnitRepository;\n+\n+    public ExerciseService(ExerciseRepository exerciseRepository, ExerciseUnitRepository exerciseUnitRepository, ParticipationService participationService,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56728e350b1d8d8275795e67a1baa258d20c8e27"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyMTc2OTI5OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/domain/lecture_unit/LectureUnit.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMToxODowN1rOHqXMjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMToxODowN1rOHqXMjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE4MjI4Nw==", "bodyText": "Codacy found an issue: Avoid unused private fields such as 'visibleToStudents'.", "url": "https://github.com/ls1intum/Artemis/pull/2218#discussion_r514182287", "createdAt": "2020-10-29T11:18:07Z", "author": {"login": "artemis-bot"}, "path": "src/main/java/de/tum/in/www1/artemis/domain/lecture_unit/LectureUnit.java", "diffHunk": "@@ -0,0 +1,104 @@\n+package de.tum.in.www1.artemis.domain.lecture_unit;\n+\n+import java.time.ZonedDateTime;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import javax.persistence.*;\n+\n+import org.hibernate.annotations.Cache;\n+import org.hibernate.annotations.CacheConcurrencyStrategy;\n+import org.hibernate.annotations.DiscriminatorOptions;\n+\n+import com.fasterxml.jackson.annotation.JsonInclude;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.annotation.JsonSubTypes;\n+import com.fasterxml.jackson.annotation.JsonTypeInfo;\n+\n+import de.tum.in.www1.artemis.domain.DomainObject;\n+import de.tum.in.www1.artemis.domain.LearningGoal;\n+import de.tum.in.www1.artemis.domain.Lecture;\n+\n+@Entity\n+@Table(name = \"lecture_unit\")\n+@Inheritance(strategy = InheritanceType.SINGLE_TABLE)\n+@DiscriminatorColumn(name = \"discriminator\", discriminatorType = DiscriminatorType.STRING)\n+@DiscriminatorValue(\"L\")\n+@DiscriminatorOptions(force = true)\n+@Cache(usage = CacheConcurrencyStrategy.NONSTRICT_READ_WRITE)\n+@JsonTypeInfo(use = JsonTypeInfo.Id.NAME, property = \"type\")\n+@JsonInclude(JsonInclude.Include.NON_EMPTY)\n+// Annotation necessary to distinguish between concrete implementations of lecture-content when deserializing from JSON\n+@JsonSubTypes({ @JsonSubTypes.Type(value = AttachmentUnit.class, name = \"attachment\"), @JsonSubTypes.Type(value = ExerciseUnit.class, name = \"exercise\"),\n+        @JsonSubTypes.Type(value = TextUnit.class, name = \"text\"), @JsonSubTypes.Type(value = VideoUnit.class, name = \"video\"), })\n+public abstract class LectureUnit extends DomainObject {\n+\n+    @Transient\n+    private boolean visibleToStudents;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56728e350b1d8d8275795e67a1baa258d20c8e27"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNjgyNjc5OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/domain/Attachment.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMDozNToyMFrOHrJYFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMDozNToyMFrOHrJYFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTAwNDQzOQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (attachmentType == AttachmentType.FILE && getAttachmentUnit() != null && link != null && link.contains(Constants.FILEPATH_ID_PLACHEOLDER)) {\n          \n          \n            \n                    else if (attachmentType == AttachmentType.FILE && getAttachmentUnit() != null && link != null && link.contains(Constants.FILEPATH_ID_PLACHEOLDER)) {\n          \n      \n    \n    \n  \n\nI guess those are exclusive options? So to make this more explicit use else if.", "url": "https://github.com/ls1intum/Artemis/pull/2218#discussion_r515004439", "createdAt": "2020-10-30T10:35:20Z", "author": {"login": "jpbernius"}, "path": "src/main/java/de/tum/in/www1/artemis/domain/Attachment.java", "diffHunk": "@@ -78,6 +83,10 @@ public void onLoad() {\n         if (attachmentType == AttachmentType.FILE && getLecture() != null && link != null && link.contains(Constants.FILEPATH_ID_PLACHEOLDER)) {\n             link = link.replace(Constants.FILEPATH_ID_PLACHEOLDER, getLecture().getId().toString());\n         }\n+        if (attachmentType == AttachmentType.FILE && getAttachmentUnit() != null && link != null && link.contains(Constants.FILEPATH_ID_PLACHEOLDER)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b09951063b3dd2b8e32ee565e02aac16fdc1ac03"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNjgyNzk2OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/domain/Attachment.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMDozNTo0NlrOHrJY0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMDozNTo0NlrOHrJY0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTAwNDYyNw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (attachmentType == AttachmentType.FILE && getAttachmentUnit() != null) {\n          \n          \n            \n                    else if (attachmentType == AttachmentType.FILE && getAttachmentUnit() != null) {\n          \n      \n    \n    \n  \n\nsee above", "url": "https://github.com/ls1intum/Artemis/pull/2218#discussion_r515004627", "createdAt": "2020-10-30T10:35:46Z", "author": {"login": "jpbernius"}, "path": "src/main/java/de/tum/in/www1/artemis/domain/Attachment.java", "diffHunk": "@@ -92,14 +101,26 @@ public void beforeCreate() {\n             link = fileService.manageFilesForUpdatedFilePath(prevLink, link, FilePathService.getLectureAttachmentFilepath() + getLecture().getId() + '/', getLecture().getId(),\n                     true);\n         }\n+        if (attachmentType == AttachmentType.FILE && getAttachmentUnit() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b09951063b3dd2b8e32ee565e02aac16fdc1ac03"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNjg0NjkwOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/domain/Attachment.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMDo0MTozOVrOHrJklQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMDo0MTozOVrOHrJklQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTAwNzYzNw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (attachmentType == AttachmentType.FILE && link != null && link.contains(Constants.FILEPATH_ID_PLACHEOLDER) && getAttachmentUnit() != null) {\n          \n          \n            \n                    else if (attachmentType == AttachmentType.FILE && link != null && link.contains(Constants.FILEPATH_ID_PLACHEOLDER) && getAttachmentUnit() != null) {", "url": "https://github.com/ls1intum/Artemis/pull/2218#discussion_r515007637", "createdAt": "2020-10-30T10:41:39Z", "author": {"login": "jpbernius"}, "path": "src/main/java/de/tum/in/www1/artemis/domain/Attachment.java", "diffHunk": "@@ -92,14 +101,26 @@ public void beforeCreate() {\n             link = fileService.manageFilesForUpdatedFilePath(prevLink, link, FilePathService.getLectureAttachmentFilepath() + getLecture().getId() + '/', getLecture().getId(),\n                     true);\n         }\n+        if (attachmentType == AttachmentType.FILE && getAttachmentUnit() != null) {\n+            // move file if necessary (id at this point will be null, so placeholder will be inserted)\n+            link = fileService.manageFilesForUpdatedFilePath(prevLink, link, FilePathService.getAttachmentUnitFilePath() + getAttachmentUnit().getId() + '/',\n+                    getAttachmentUnit().getId(), true);\n+        }\n     }\n \n+    /**\n+     * Will be called after the entity is persisted (saved).\n+     * Manages files by taking care of file system changes for this entity.\n+     */\n     @PostPersist\n     public void afterCreate() {\n         // replace placeholder with actual id if necessary (id is no longer null at this point)\n-        if (attachmentType == AttachmentType.FILE && link != null && link.contains(Constants.FILEPATH_ID_PLACHEOLDER)) {\n+        if (attachmentType == AttachmentType.FILE && link != null && link.contains(Constants.FILEPATH_ID_PLACHEOLDER) && getLecture() != null) {\n             link = link.replace(Constants.FILEPATH_ID_PLACHEOLDER, getLecture().getId().toString());\n         }\n+        if (attachmentType == AttachmentType.FILE && link != null && link.contains(Constants.FILEPATH_ID_PLACHEOLDER) && getAttachmentUnit() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b09951063b3dd2b8e32ee565e02aac16fdc1ac03"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNjg0ODQ0OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/domain/Attachment.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMDo0MjowOFrOHrJllg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMDo0MjowOFrOHrJllg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTAwNzg5NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (attachmentType == AttachmentType.FILE && getAttachmentUnit() != null) {\n          \n          \n            \n                    else if (attachmentType == AttachmentType.FILE && getAttachmentUnit() != null) {", "url": "https://github.com/ls1intum/Artemis/pull/2218#discussion_r515007894", "createdAt": "2020-10-30T10:42:08Z", "author": {"login": "jpbernius"}, "path": "src/main/java/de/tum/in/www1/artemis/domain/Attachment.java", "diffHunk": "@@ -113,14 +134,28 @@ public void onUpdate() {\n             link = fileService.manageFilesForUpdatedFilePath(prevLink, link, FilePathService.getLectureAttachmentFilepath() + getLecture().getId() + '/', getLecture().getId(),\n                     true);\n         }\n+        if (attachmentType == AttachmentType.FILE && getAttachmentUnit() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b09951063b3dd2b8e32ee565e02aac16fdc1ac03"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNjg0OTU4OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/domain/Attachment.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMDo0MjoyOVrOHrJmUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMDo0MjoyOVrOHrJmUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTAwODA4MQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (attachmentType == AttachmentType.FILE && getAttachmentUnit() != null) {\n          \n          \n            \n                    else if (attachmentType == AttachmentType.FILE && getAttachmentUnit() != null) {", "url": "https://github.com/ls1intum/Artemis/pull/2218#discussion_r515008081", "createdAt": "2020-10-30T10:42:29Z", "author": {"login": "jpbernius"}, "path": "src/main/java/de/tum/in/www1/artemis/domain/Attachment.java", "diffHunk": "@@ -113,14 +134,28 @@ public void onUpdate() {\n             link = fileService.manageFilesForUpdatedFilePath(prevLink, link, FilePathService.getLectureAttachmentFilepath() + getLecture().getId() + '/', getLecture().getId(),\n                     true);\n         }\n+        if (attachmentType == AttachmentType.FILE && getAttachmentUnit() != null) {\n+            // move file and delete old file if necessary\n+            link = fileService.manageFilesForUpdatedFilePath(prevLink, link, FilePathService.getAttachmentUnitFilePath() + getAttachmentUnit().getId() + '/',\n+                    getAttachmentUnit().getId(), true);\n+        }\n     }\n \n+    /**\n+     * Will be called after the entity is removed (deleted).\n+     * Manages files by taking care of file system changes for this entity.\n+     */\n     @PostRemove\n     public void onDelete() {\n         if (attachmentType == AttachmentType.FILE && getLecture() != null) {\n             // delete old file if necessary\n             fileService.manageFilesForUpdatedFilePath(prevLink, null, FilePathService.getLectureAttachmentFilepath() + getLecture().getId() + '/', getLecture().getId(), true);\n         }\n+        if (attachmentType == AttachmentType.FILE && getAttachmentUnit() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b09951063b3dd2b8e32ee565e02aac16fdc1ac03"}, "originalPosition": 79}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4542, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}