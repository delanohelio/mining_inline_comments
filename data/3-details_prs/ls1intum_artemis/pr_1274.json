{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwNTAyNTgx", "number": 1274, "title": "Create course groups in JIRA automatically based on the course short name", "bodyText": "Checklist\n\n I tested all changes and all related features with different users (student, tutor, instructor, admin) on the test server https://artemistest.ase.in.tum.de.\n Server: I updated multiple integration tests (Spring) related to the features\n Server: I added @PreAuthorize and check the course groups for all new REST Calls (security)\n Server: I implemented the changes with a good performance and prevented too many database calls\n Server: I documented the Java code using JavaDoc style.\n Client: I added multiple integration tests (Jest) related to the features\n Client: I added authorities to all new routes and check the course groups for displaying navigation elements (links, buttons)\n Client: I documented the TypeScript code using JSDoc style.\n Client: I added multiple screenshots/screencasts of my UI changes\n Client: I translated all the newly inserted strings into German and English\n\nMotivation and Context\nSimplify course administration in JIRA\nAddresses #1221\nDescription\nImprove error handling for courses and programming exercises\nCheck that short names are always unique\nIn case of an error, automatically scroll up in the client\nSteps for Testing\n\nLog in to Artemis\nNavigate to Course Administration\nCreate a course\nEdit a course\nDelete a course", "createdAt": "2020-03-18T15:25:14Z", "url": "https://github.com/ls1intum/Artemis/pull/1274", "merged": true, "mergeCommit": {"oid": "41e248e910dd50aa0c9abb58342ab025274d8b1c"}, "closed": true, "closedAt": "2020-03-19T18:24:48Z", "author": {"login": "krusche"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcO48zRgH2gAyMzkwNTAyNTgxOjllMmE5OWI5MTRlZDJkZWZhZTNjMTk3YTM0MzA3ZGQ0ZGZjYzA4Yjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcPPaBsgH2gAyMzkwNTAyNTgxOmQ2ZjRmODBkY2Y4ZDEwOGU2YTlhZjc2MGZkYTIyYjRhMzljYWZmZTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9e2a99b914ed2defae3c197a34307dd4dfcc08b8", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/9e2a99b914ed2defae3c197a34307dd4dfcc08b8", "committedDate": "2020-03-18T15:22:07Z", "message": "create course groups in JIRA automatically based on the course short name\n\nimprove error handling for courses and programming exercises\ncheck that short names are always unique\nin case of an error, automatically scroll up in the client"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e864b09c19091d29d5cf66971d7bc55987c7d836", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/e864b09c19091d29d5cf66971d7bc55987c7d836", "committedDate": "2020-03-18T20:48:34Z", "message": "Merge branch 'develop' into feature/course-automatic-groups"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "267e050da96cb70b45559e05f5550c37e899bac0", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/267e050da96cb70b45559e05f5550c37e899bac0", "committedDate": "2020-03-18T21:18:52Z", "message": "fix course tests by mocking new jira calls"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24aba450c78355c6392ef81a3a46dd0354e18d9b", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/24aba450c78355c6392ef81a3a46dd0354e18d9b", "committedDate": "2020-03-18T21:51:38Z", "message": "implement removeGroupFromUsers and fix missing @Param in UserRepository"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3dc82b9ccaab5ed3682c1bab6a688e2d59834fa2", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/3dc82b9ccaab5ed3682c1bab6a688e2d59834fa2", "committedDate": "2020-03-18T21:53:49Z", "message": "Merge branch 'develop' into feature/course-automatic-groups"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa69070333eda53eec712642ff03c6aa9c652230", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/aa69070333eda53eec712642ff03c6aa9c652230", "committedDate": "2020-03-19T06:05:37Z", "message": "do not delete groups that have not been created in artemis"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ede367528a80366946fbdaa6ca6e1e07ce371b65", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/ede367528a80366946fbdaa6ca6e1e07ce371b65", "committedDate": "2020-03-19T06:08:01Z", "message": "update delete test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b66f109312111c1b4158be026fb23c15ff18a2fc", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/b66f109312111c1b4158be026fb23c15ff18a2fc", "committedDate": "2020-03-19T06:14:16Z", "message": "additional check to prevent the deletion of groups in JIRA"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49d3204ee136e25756e4856a21d24d6789abc174", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/49d3204ee136e25756e4856a21d24d6789abc174", "committedDate": "2020-03-19T06:22:03Z", "message": "fix code style and test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3Mjc4Mjg4", "url": "https://github.com/ls1intum/Artemis/pull/1274#pullrequestreview-377278288", "createdAt": "2020-03-18T22:25:59Z", "commit": {"oid": "9e2a99b914ed2defae3c197a34307dd4dfcc08b8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQyMjoyNTo1OVrOF4ZApA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQyMjoyNTo1OVrOF4ZApA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDY3NDM0MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // Cceck if the exercise title matches regex\n          \n          \n            \n                    // Check if the exercise title matches regex", "url": "https://github.com/ls1intum/Artemis/pull/1274#discussion_r394674340", "createdAt": "2020-03-18T22:25:59Z", "author": {"login": "jpbernius"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingExerciseResource.java", "diffHunk": "@@ -169,7 +170,7 @@ public ProgrammingExerciseResource(ProgrammingExerciseRepository programmingExer\n                     .headers(HeaderUtil.createAlert(applicationName, \"The title of the programming exercise is too short\", \"programmingExerciseTitleInvalid\")).body(null);\n         }\n \n-        // CHeck if the exercise title matches regex\n+        // Cceck if the exercise title matches regex", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e2a99b914ed2defae3c197a34307dd4dfcc08b8"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e266cd6c81fe9d9ad1dc12b56e3c6311df5f18f", "author": {"user": {"login": "jpbernius", "name": "Jan Philip Bernius"}}, "url": "https://github.com/ls1intum/Artemis/commit/9e266cd6c81fe9d9ad1dc12b56e3c6311df5f18f", "committedDate": "2020-03-19T11:00:53Z", "message": "Update Typo in ProgrammingExerciseResource.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3NjMzMzA4", "url": "https://github.com/ls1intum/Artemis/pull/1274#pullrequestreview-377633308", "createdAt": "2020-03-19T11:28:45Z", "commit": {"oid": "9e266cd6c81fe9d9ad1dc12b56e3c6311df5f18f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMToyODo0NVrOF4qYIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMToyOTozMlrOF4qZpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDk1ODg4MA==", "bodyText": "Only the student group is deleted on Jira. Here is why:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (course.getStudentGroupName().equals(\"artemis-\" + course.getShortName() + \"-tutors\")) {\n          \n          \n            \n                        artemisAuthenticationProvider.deleteGroup(course.getTeachingAssistantGroupName());\n          \n          \n            \n                    }\n          \n          \n            \n                    if (course.getStudentGroupName().equals(\"artemis-\" + course.getShortName() + \"-instructors\")) {\n          \n          \n            \n                        artemisAuthenticationProvider.deleteGroup(course.getInstructorGroupName());\n          \n          \n            \n                    }\n          \n          \n            \n                    if (course.getTeachingAssistantGroupName().equals(\"artemis-\" + course.getShortName() + \"-tutors\")) {\n          \n          \n            \n                        artemisAuthenticationProvider.deleteGroup(course.getTeachingAssistantGroupName());\n          \n          \n            \n                    }\n          \n          \n            \n                    if (course.getInstructorGroupName().equals(\"artemis-\" + course.getShortName() + \"-instructors\")) {\n          \n          \n            \n                        artemisAuthenticationProvider.deleteGroup(course.getInstructorGroupName());\n          \n          \n            \n                    }", "url": "https://github.com/ls1intum/Artemis/pull/1274#discussion_r394958880", "createdAt": "2020-03-19T11:28:45Z", "author": {"login": "jpbernius"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/CourseResource.java", "diffHunk": "@@ -620,7 +619,20 @@ private boolean userHasPermission(Course course, User user) {\n             notificationService.deleteNotification(notification);\n         }\n         String title = course.getTitle();\n+\n+        // only delete the groups if they have been created by Artemis before\n+        if (course.getStudentGroupName().equals(\"artemis-\" + course.getShortName() + \"-students\")) {\n+            artemisAuthenticationProvider.deleteGroup(course.getStudentGroupName());\n+        }\n+        if (course.getStudentGroupName().equals(\"artemis-\" + course.getShortName() + \"-tutors\")) {\n+            artemisAuthenticationProvider.deleteGroup(course.getTeachingAssistantGroupName());\n+        }\n+        if (course.getStudentGroupName().equals(\"artemis-\" + course.getShortName() + \"-instructors\")) {\n+            artemisAuthenticationProvider.deleteGroup(course.getInstructorGroupName());\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e266cd6c81fe9d9ad1dc12b56e3c6311df5f18f"}, "originalPosition": 223}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDk1OTI3MQ==", "bodyText": "I am wondering if we should create the group names in the Course Object, as we use them multiple times.", "url": "https://github.com/ls1intum/Artemis/pull/1274#discussion_r394959271", "createdAt": "2020-03-19T11:29:32Z", "author": {"login": "jpbernius"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/CourseResource.java", "diffHunk": "@@ -141,22 +136,48 @@ public CourseResource(Environment env, UserService userService, CourseService co\n         if (course.getId() != null) {\n             throw new BadRequestAlertException(\"A new course cannot already have an ID\", ENTITY_NAME, \"idexists\");\n         }\n+\n+        // Check if course shortname matches regex\n+        Matcher shortNameMatcher = SHORT_NAME_PATTERN.matcher(course.getShortName());\n+        if (!shortNameMatcher.matches()) {\n+            return ResponseEntity.badRequest().headers(HeaderUtil.createAlert(applicationName, \"The shortname is invalid\", \"shortnameInvalid\")).body(null);\n+        }\n+\n+        List<Course> coursesWithSameShortName = courseRepository.findAllByShortName(course.getShortName());\n+        if (coursesWithSameShortName.size() > 0) {\n+            return ResponseEntity.badRequest().headers(\n+                    HeaderUtil.createAlert(applicationName, \"A course with the same short name already exists. Please choose a different short name.\", \"shortnameAlreadyExists\"))\n+                    .body(null);\n+        }\n+\n+        if (course.getStudentGroupName() != null) {\n+            throw new BadRequestAlertException(\"The student group name must be null when creating a course\", ENTITY_NAME, \"studentGroupNameCannotBeSet\");\n+        }\n+        if (course.getTeachingAssistantGroupName() != null) {\n+            throw new BadRequestAlertException(\"The teaching assistant group name must be null when creating a course\", ENTITY_NAME, \"teachingAssistantGroupNameCannotBeSet\");\n+        }\n+        if (course.getInstructorGroupName() != null) {\n+            throw new BadRequestAlertException(\"The instructor group name must be null when creating a course\", ENTITY_NAME, \"instructorGroupNameCannotBeSet\");\n+        }\n+\n         validateComplaintsConfig(course);\n+\n+        course.setStudentGroupName(\"artemis-\" + course.getShortName() + \"-students\");\n+        course.setTeachingAssistantGroupName(\"artemis-\" + course.getShortName() + \"-tutors\");\n+        course.setInstructorGroupName(\"artemis-\" + course.getShortName() + \"-instructors\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e266cd6c81fe9d9ad1dc12b56e3c6311df5f18f"}, "originalPosition": 81}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b6eae66cae8debd669b181902ca369c413ce660", "author": {"user": {"login": "krusche", "name": "Stephan Krusche"}}, "url": "https://github.com/ls1intum/Artemis/commit/8b6eae66cae8debd669b181902ca369c413ce660", "committedDate": "2020-03-19T13:10:43Z", "message": "Update src/main/java/de/tum/in/www1/artemis/web/rest/CourseResource.java\n\nCo-Authored-By: Jan Philip Bernius <janphilip.bernius@tum.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2bbca3583e4c5ed2dbae77f2aa49a93c929056a4", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/2bbca3583e4c5ed2dbae77f2aa49a93c929056a4", "committedDate": "2020-03-19T13:25:40Z", "message": "refactor group default names into Constant and into Course.java\n\nvalidate that programming exercise short name does not change during PUT"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3NzE5NTgz", "url": "https://github.com/ls1intum/Artemis/pull/1274#pullrequestreview-377719583", "createdAt": "2020-03-19T13:31:17Z", "commit": {"oid": "2bbca3583e4c5ed2dbae77f2aa49a93c929056a4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4711360fce6b851ebd02a75c57a92b03984e9a14", "author": {"user": {"login": "krusche", "name": "Stephan Krusche"}}, "url": "https://github.com/ls1intum/Artemis/commit/4711360fce6b851ebd02a75c57a92b03984e9a14", "committedDate": "2020-03-19T13:32:54Z", "message": "Merge branch 'develop' into feature/course-automatic-groups"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ee2faf21d0adfe97c5a6d0b80bf0c2f91552042", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/1ee2faf21d0adfe97c5a6d0b80bf0c2f91552042", "committedDate": "2020-03-19T16:23:35Z", "message": "Merge branch 'develop' into feature/course-automatic-groups"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3OTM4ODAz", "url": "https://github.com/ls1intum/Artemis/pull/1274#pullrequestreview-377938803", "createdAt": "2020-03-19T17:26:06Z", "commit": {"oid": "1ee2faf21d0adfe97c5a6d0b80bf0c2f91552042"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6f4f80dcf8d108e6a9af760fda22b4a39caffe7", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/d6f4f80dcf8d108e6a9af760fda22b4a39caffe7", "committedDate": "2020-03-19T17:31:57Z", "message": "count number of students, tutors and instructors for course management"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2838, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}