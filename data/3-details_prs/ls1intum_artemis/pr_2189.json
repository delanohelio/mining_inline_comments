{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxODM4NzU4", "number": 2189, "title": "Add missing plagiarism tests", "bodyText": "Checklist\n\n Client: I added multiple integration tests (Jest) related to the features (with a high test coverage)\n Client: I documented the TypeScript code using JSDoc style.\n\nDescription\nThis is a follow-up PR to #2106 and adds tests for the PlagiarismHeaderComponent and PlagiarismInspectorComponent. Additionally, some variables and functions have been renamed to be more descriptive.\nSteps for Testing\nSince this PR only adds new tests, just make sure they all pass.\nTest Coverage\n\n\nplagiarism-header.component.ts: 100%\nplagiarism-inspector.component.ts 97.22%", "createdAt": "2020-10-12T21:49:29Z", "url": "https://github.com/ls1intum/Artemis/pull/2189", "merged": true, "mergeCommit": {"oid": "58f54cbac6c46df2d3fc9bd3ddf7509f0bc64105"}, "closed": true, "closedAt": "2020-10-16T10:23:21Z", "author": {"login": "philippbauch"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdRwGR5gH2gAyNTAxODM4NzU4OjE4MzJkMmU5ZDRmOTIzZTUxMWNkNDc4YjIxMWI2MTI0NmE4YTAyYTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdTDvRsgFqTUxMDM0MzA1OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1832d2e9d4f923e511cd478b211b61246a8a02a3", "author": {"user": {"login": "philippbauch", "name": "Philipp Bauch"}}, "url": "https://github.com/ls1intum/Artemis/commit/1832d2e9d4f923e511cd478b211b61246a8a02a3", "committedDate": "2020-10-12T08:56:15Z", "message": "Add tests for PlagiarismHeaderComponent"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c15d5e673258ecdec9d16c68a2defa48c2eab847", "author": {"user": {"login": "philippbauch", "name": "Philipp Bauch"}}, "url": "https://github.com/ls1intum/Artemis/commit/c15d5e673258ecdec9d16c68a2defa48c2eab847", "committedDate": "2020-10-12T17:23:09Z", "message": "Add tests for PlagiarismInspectorComponent"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a8800bb4d04623cfeae9c941a4a99692d4eb007", "author": {"user": {"login": "philippbauch", "name": "Philipp Bauch"}}, "url": "https://github.com/ls1intum/Artemis/commit/3a8800bb4d04623cfeae9c941a4a99692d4eb007", "committedDate": "2020-10-14T19:59:26Z", "message": "Merge branch 'develop' into chore/add-missing-plagiarism-tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "324f886619885aaa1a797206d4249ed382f5f584", "author": {"user": {"login": "philippbauch", "name": "Philipp Bauch"}}, "url": "https://github.com/ls1intum/Artemis/commit/324f886619885aaa1a797206d4249ed382f5f584", "committedDate": "2020-10-14T20:50:06Z", "message": "Add more tests for PlagiarismInspectorComponent"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "166b04d1fd640e3e38c0ed0bae98d8daa554c320", "author": {"user": {"login": "philippbauch", "name": "Philipp Bauch"}}, "url": "https://github.com/ls1intum/Artemis/commit/166b04d1fd640e3e38c0ed0bae98d8daa554c320", "committedDate": "2020-10-14T21:03:52Z", "message": "Add test for the CSV export of plagiarism results"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b37699c495ee88a4fb8eb6736b3d78ab6fb0fd9", "author": {"user": {"login": "philippbauch", "name": "Philipp Bauch"}}, "url": "https://github.com/ls1intum/Artemis/commit/1b37699c495ee88a4fb8eb6736b3d78ab6fb0fd9", "committedDate": "2020-10-15T11:44:00Z", "message": "Fix PlagiarismInspectorComponent tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "056183861958ee2eea181f57b6abfaada4bd6391", "author": {"user": {"login": "philippbauch", "name": "Philipp Bauch"}}, "url": "https://github.com/ls1intum/Artemis/commit/056183861958ee2eea181f57b6abfaada4bd6391", "committedDate": "2020-10-15T12:25:10Z", "message": "Merge branch 'develop' into chore/add-missing-plagiarism-tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5NjAyMDI1", "url": "https://github.com/ls1intum/Artemis/pull/2189#pullrequestreview-509602025", "createdAt": "2020-10-15T17:17:50Z", "commit": {"oid": "056183861958ee2eea181f57b6abfaada4bd6391"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNzoxNzo1MVrOHiSGWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNzoxNzo1MVrOHiSGWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTcxMDE3MQ==", "bodyText": "We usually have networking code in a service class. I'd argue that would also improve the structure here.", "url": "https://github.com/ls1intum/Artemis/pull/2189#discussion_r505710171", "createdAt": "2020-10-15T17:17:51Z", "author": {"login": "jpbernius"}, "path": "src/main/webapp/app/exercises/shared/plagiarism/plagiarism-inspector/plagiarism-inspector.component.ts", "diffHunk": "@@ -13,35 +13,97 @@ import { ExportToCsv } from 'export-to-csv';\n     templateUrl: './plagiarism-inspector.component.html',\n })\n export class PlagiarismInspectorComponent implements OnInit {\n-    selectedComparisonIndex: number;\n-    plagiarismCheckInProgress: boolean;\n+    /**\n+     * The modeling exercise for which plagiarism is to be detected.\n+     */\n     modelingExercise: ModelingExercise;\n+\n+    /**\n+     * Results of the plagiarism detection.\n+     */\n     modelingSubmissionComparisons: Array<ModelingSubmissionComparisonDTO>;\n-    splitControlSubject: Subject<string> = new Subject<string>();\n \n-    private subscription: Subscription;\n+    /**\n+     * Flag to indicate whether the plagiarism detection is currently in progress.\n+     */\n+    plagiarismDetectionInProgress: boolean;\n+\n+    /**\n+     * Index of the currently selected plagiarism.\n+     */\n+    selectedPlagiarismIndex: number;\n+\n+    /**\n+     * Subject to be passed into PlagiarismSplitViewComponent to control the split view.\n+     */\n+    splitControlSubject: Subject<string> = new Subject<string>();\n \n     constructor(private route: ActivatedRoute, private router: Router, private modelingExerciseService: ModelingExerciseService) {}\n \n     ngOnInit() {\n-        this.subscription = this.route.params.subscribe((params) => {\n-            this.modelingExerciseService.find(params['exerciseId']).subscribe((response: HttpResponse<ModelingExercise>) => {\n-                this.modelingExercise = response.body!;\n-            });\n+        this.route.params.subscribe((params) => {\n+            this.fetchModelingExercise(params['exerciseId']);\n+        });\n+    }\n+\n+    /**\n+     * Fetch the modeling exercise with the given id.\n+     *\n+     * @param modelingExerciseId\n+     */\n+    fetchModelingExercise(modelingExerciseId: number) {\n+        this.modelingExerciseService.find(modelingExerciseId).subscribe((response: HttpResponse<ModelingExercise>) => {\n+            this.modelingExercise = response.body!;\n         });\n     }\n \n-    handleTagPlagiarism(confirmed: boolean) {\n-        this.modelingSubmissionComparisons[this.selectedComparisonIndex].confirmed = confirmed;\n+    /**\n+     * Handle the 'plagiarismStatusChange' event emitted by PlagiarismHeaderComponent.\n+     *\n+     * @param confirmed\n+     */\n+    handlePlagiarismStatusChange(confirmed: boolean) {\n+        this.modelingSubmissionComparisons[this.selectedPlagiarismIndex].confirmed = confirmed;\n+    }\n+\n+    /**\n+     * Handle the 'splitViewChange' event emitted by PlagiarismHeaderComponent.\n+     *\n+     * @param pane\n+     */\n+    handleSplitViewChange(pane: string) {\n+        this.splitControlSubject.next(pane);\n+    }\n+\n+    /**\n+     * Trigger the server-side plagiarism detection and fetch its result.\n+     */\n+    checkPlagiarism() {\n+        this.plagiarismDetectionInProgress = true;\n+\n+        this.modelingExerciseService.checkPlagiarism(this.modelingExercise.id!).subscribe(\n+            (response: HttpResponse<Array<ModelingSubmissionComparisonDTO>>) => {\n+                this.plagiarismDetectionInProgress = false;\n+                this.modelingSubmissionComparisons = response.body!.sort((c1, c2) => c2.similarity - c1.similarity);\n+            },\n+            () => (this.plagiarismDetectionInProgress = false),\n+        );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "056183861958ee2eea181f57b6abfaada4bd6391"}, "originalPosition": 97}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51a18475dd6d7167ae4fc01e9b1942ede1b81ac2", "author": {"user": {"login": "philippbauch", "name": "Philipp Bauch"}}, "url": "https://github.com/ls1intum/Artemis/commit/51a18475dd6d7167ae4fc01e9b1942ede1b81ac2", "committedDate": "2020-10-16T08:49:14Z", "message": "Move checkPlagiarism() network code in PlagiarismInspectorComponent to service class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0806aa1712a92116fb261d38fb28463e0acefde", "author": {"user": {"login": "philippbauch", "name": "Philipp Bauch"}}, "url": "https://github.com/ls1intum/Artemis/commit/a0806aa1712a92116fb261d38fb28463e0acefde", "committedDate": "2020-10-16T08:49:14Z", "message": "Fix PlagiarismInspectorComponent tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwMzQwNTE3", "url": "https://github.com/ls1intum/Artemis/pull/2189#pullrequestreview-510340517", "createdAt": "2020-10-16T10:19:18Z", "commit": {"oid": "a0806aa1712a92116fb261d38fb28463e0acefde"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwMzQzMDU4", "url": "https://github.com/ls1intum/Artemis/pull/2189#pullrequestreview-510343058", "createdAt": "2020-10-16T10:23:09Z", "commit": {"oid": "a0806aa1712a92116fb261d38fb28463e0acefde"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3804, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}