{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1MTQzMDkz", "number": 1664, "title": "[Exam] Management: Follow-up fixes", "bodyText": "Checklist\n\n I tested all changes and all related features with different users (student, tutor, instructor, admin) on the test server https://artemistest.ase.in.tum.de.\n Server: I added multiple integration tests (Spring) related to the features\n Server: I documented the Java code using JavaDoc style.\n\nMotivation and Context\nThis weeks new features for the exam management introduced a few smaller issues.\nDescription\n\n Ensured that exercise groups are preserved on exam update (changing exercise groups should be handled via the ExerciseGroupResource) (see: f0d9c32)\n Fixed missing exercise group order\n Fixed null index column for collection Exam.exerciseGroups when getting the exam with eager exercise groups\n Ensured that exercise groups cannot be manipulate via @PostMapping(\"/courses/{courseId}/exams\")\n @krusche @jpbernius: We've removed TODO: check that the exam id in the body was NOT changed as we have nothing to check against. Should we add {examId} to the route?\n Exercise groups and associated exercises will also be deleted on deletion of exam\n Exams will be deleted on deletion of course\n Ensured that the not yet implemented Assessment Dashboard link in the exam overview does not throw an error\n Used ExamAccessService checks in the following routes: /courses/{courseId}/exams/{examId}/students [POST], /courses/{courseId}/exams/{examId}/students/{studentLogin} [POST, DELETE]\n\nSteps for Testing\nMostly code review :-)\nMade sure that exercise groups are preserved on exam update\nUpdate an exam at check that it still works. We've covered the intended preserve with a test case.\nFixed missing exercise group order:\nTest this locally:\n\nCreate a new exam\nAdd some exercise groups to the exam\nRun this query on your local database: SELECT * FROM exercise_group;\nCheck that exercise_group_order is not null for the new exercise groups\n\nExercise groups and associated exercises will also be deleted on deletion of exam\n\nCreate a new Exam\nAdd an exercise group\nAdd an exercise\ndelete the Exam\n\nExams will be deleted on deletion of course\n\nCreate a new Course\nAdd a new Exam\nAdd an exercise group\nAdd an exercise\nDelete the Course\n\nFixed null index column for collection Exam.exerciseGroups when getting the exam with eager exercise groups\n\nCreate a new exam\nAdd a new exercise group to the exam\nChange the title of the exam\nCheck that the update works without an error on console", "createdAt": "2020-06-16T11:10:47Z", "url": "https://github.com/ls1intum/Artemis/pull/1664", "merged": true, "mergeCommit": {"oid": "eea16a1d53668db4aaedc76c2c3a0158cdf817a2"}, "closed": true, "closedAt": "2020-06-16T21:14:59Z", "author": {"login": "sascha11110"}, "timelineItems": {"totalCount": 29, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrxrRHAH2gAyNDM1MTQzMDkzOmYwZDljMzI2MGM5ODVjZjRkYTM1MjdkODY0NzgxY2I1NDgzNmViNzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcr7-BRAFqTQzMTg5MDEzMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f0d9c3260c985cf4da3527d864781cb54836eb70", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/f0d9c3260c985cf4da3527d864781cb54836eb70", "committedDate": "2020-06-16T09:17:26Z", "message": "Make sure that exercise groups are preserved on exam update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3901c8e7dd3ecf34ead2629bc44ccc443bdc429", "author": {"user": {"login": "kloessst", "name": "Stefan Kl\u00f6ss-Schuster"}}, "url": "https://github.com/ls1intum/Artemis/commit/f3901c8e7dd3ecf34ead2629bc44ccc443bdc429", "committedDate": "2020-06-16T09:26:29Z", "message": "Save exerciseGroups as part of exam. Otherwise the order column won't get set correctly."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "058f5630e9af37ccbd24559e1163eef1c9192aa2", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/058f5630e9af37ccbd24559e1163eef1c9192aa2", "committedDate": "2020-06-16T11:48:24Z", "message": "Update the delete functions of ExamResource & CourseResource\nNow they delete all child elements first. Also updated the warning to make it clear that the exams will also be deleted"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66469d863a5a1fb0f6afcfc8a7f3bb18f8b19323", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/66469d863a5a1fb0f6afcfc8a7f3bb18f8b19323", "committedDate": "2020-06-16T11:50:14Z", "message": "Merge branch 'develop' into exam/management/follow-up-fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7beefde5d83ff5f96edb44e99783c20941a4179", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/c7beefde5d83ff5f96edb44e99783c20941a4179", "committedDate": "2020-06-16T12:56:56Z", "message": "Fix null index column error: Use @JoinColumn instead of mappedBy as it is not support in combination with @OrderColumn"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7615a0b4223e1d0d07d5935c76ba9363313535db", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/7615a0b4223e1d0d07d5935c76ba9363313535db", "committedDate": "2020-06-16T13:08:55Z", "message": "Clean up ExamIntegrationTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e7a4b259be58e6bb1b1d9cee8c578eb1b6c29e3", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/0e7a4b259be58e6bb1b1d9cee8c578eb1b6c29e3", "committedDate": "2020-06-16T13:13:45Z", "message": "Merge remote-tracking branch 'origin/exam/management/follow-up-fixes' into exam/management/follow-up-fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9dc476376e655f4a834ed56f6861442be34c624f", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/9dc476376e655f4a834ed56f6861442be34c624f", "committedDate": "2020-06-16T14:24:42Z", "message": "Clean up ExamIntegrationTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "180802ddb9bd389d6214a04a130793a4082ceff2", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/180802ddb9bd389d6214a04a130793a4082ceff2", "committedDate": "2020-06-16T14:53:35Z", "message": "Ensure that exercise groups that exerciseGroups cannot be manipulated via POST exam"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8d39841e6d28197bb9e27773340bf445f93812b", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/a8d39841e6d28197bb9e27773340bf445f93812b", "committedDate": "2020-06-16T14:56:18Z", "message": "Remove TODO"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ce3350843fcf2929e9bae8007f927920e8445cc", "author": {"user": {"login": "kloessst", "name": "Stefan Kl\u00f6ss-Schuster"}}, "url": "https://github.com/ls1intum/Artemis/commit/7ce3350843fcf2929e9bae8007f927920e8445cc", "committedDate": "2020-06-16T15:40:41Z", "message": "Refactor integration tests using exercise groups. We have to ensure that exerciseGroups are created via examRepository. Otherwise orderColumn won't work."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34e741f5cb6285e2018286d2e656363e42abeaf5", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/34e741f5cb6285e2018286d2e656363e42abeaf5", "committedDate": "2020-06-16T15:44:16Z", "message": "Use ExamAccessService in register student routes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec1e7f0b5074cc16900d25821815d954ce044db2", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/ec1e7f0b5074cc16900d25821815d954ce044db2", "committedDate": "2020-06-16T15:44:33Z", "message": "Merge remote-tracking branch 'origin/exam/management/follow-up-fixes' into exam/management/follow-up-fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c14a566a38fdf4ee850c44d4105141a964b8002", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/6c14a566a38fdf4ee850c44d4105141a964b8002", "committedDate": "2020-06-16T15:44:46Z", "message": "Merge branch 'develop' into exam/management/follow-up-fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30e73dba63476f238b15c6ed38162fba5613dde8", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/30e73dba63476f238b15c6ed38162fba5613dde8", "committedDate": "2020-06-16T15:46:05Z", "message": "Merge branch 'exam/management/follow-up-fixes' of github.com:ls1intum/Artemis into exam/management/follow-up-fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a473ce88cdf1c370a863a9f18c0522f026c163b", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/2a473ce88cdf1c370a863a9f18c0522f026c163b", "committedDate": "2020-06-16T15:58:33Z", "message": "Hide assessment dashboard link"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "027448ddf5b6858610dee0e91f4c32ed52cd034b", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/027448ddf5b6858610dee0e91f4c32ed52cd034b", "committedDate": "2020-06-16T16:55:06Z", "message": "Fix delete operation for ExamResource\nNow it successfully deletes an exam even if there is an exerciseGroup with exercises"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0eaab31e981938f14e41b195de945dfff6b3986a", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/0eaab31e981938f14e41b195de945dfff6b3986a", "committedDate": "2020-06-16T17:13:28Z", "message": "Rename functions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b176beb64f5ace0d3c6968f95188629dd448aad8", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/b176beb64f5ace0d3c6968f95188629dd448aad8", "committedDate": "2020-06-16T17:29:56Z", "message": "Fix course delete operation\nNow it handles courses with exams aswell"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a7f7d32c4e6f18fc4510653b4998f3562f7e1d7", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/3a7f7d32c4e6f18fc4510653b4998f3562f7e1d7", "committedDate": "2020-06-16T17:31:11Z", "message": "Merge branch 'exam/management/follow-up-fixes' of github.com:ls1intum/Artemis into exam/management/follow-up-fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd4f83e52faae2fcc8e323747bca4a5ade56a446", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/cd4f83e52faae2fcc8e323747bca4a5ade56a446", "committedDate": "2020-06-16T17:44:52Z", "message": "Update Exam Integration tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "990b5158760020f4f3f8c241848d83d3cec41fd7", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/990b5158760020f4f3f8c241848d83d3cec41fd7", "committedDate": "2020-06-16T18:49:42Z", "message": "Merge branch 'develop' into exam/management/follow-up-fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b79ba9358ad141c13206b9955cbed6f5e6b7b8eb", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/b79ba9358ad141c13206b9955cbed6f5e6b7b8eb", "committedDate": "2020-06-16T19:03:52Z", "message": "update IntegrationTest"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxODEwNjk3", "url": "https://github.com/ls1intum/Artemis/pull/1664#pullrequestreview-431810697", "createdAt": "2020-06-16T19:05:38Z", "commit": {"oid": "b79ba9358ad141c13206b9955cbed6f5e6b7b8eb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxOTowNTozOFrOGkpVYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxOTowNTozOFrOGkpVYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA3OTEzNg==", "bodyText": "typo, please revert", "url": "https://github.com/ls1intum/Artemis/pull/1664#discussion_r441079136", "createdAt": "2020-06-16T19:05:38Z", "author": {"login": "krusche"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/CourseResource.java", "diffHunk": "@@ -772,7 +784,7 @@ private boolean userHasPermission(Course course, User user) {\n     }\n \n     /**\n-     * DELETE /courses/:courseId : delete the \"id\" course.\n+     * DELETE /courses/:courseId : deletedelete the \"id\" course.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b79ba9358ad141c13206b9955cbed6f5e6b7b8eb"}, "originalPosition": 47}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60aeb2891ea5241f48786287aab841698d79ab3f", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/60aeb2891ea5241f48786287aab841698d79ab3f", "committedDate": "2020-06-16T19:07:05Z", "message": "Fix typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6f42cfb587b4b5869be9b771db5ecb129bd0419", "author": {"user": {"login": "sascha11110", "name": "Sascha Beele"}}, "url": "https://github.com/ls1intum/Artemis/commit/c6f42cfb587b4b5869be9b771db5ecb129bd0419", "committedDate": "2020-06-16T19:07:46Z", "message": "Merge remote-tracking branch 'origin/exam/management/follow-up-fixes' into exam/management/follow-up-fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db7585355af2072875cd38b5b88d8424fda07f37", "author": {"user": {"login": "anditurdiu", "name": "Andi Turdiu"}}, "url": "https://github.com/ls1intum/Artemis/commit/db7585355af2072875cd38b5b88d8424fda07f37", "committedDate": "2020-06-16T19:29:04Z", "message": "Merge branch 'develop' into exam/management/follow-up-fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxODk2ODQx", "url": "https://github.com/ls1intum/Artemis/pull/1664#pullrequestreview-431896841", "createdAt": "2020-06-16T21:14:34Z", "commit": {"oid": "db7585355af2072875cd38b5b88d8424fda07f37"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxODkwMTMx", "url": "https://github.com/ls1intum/Artemis/pull/1664#pullrequestreview-431890131", "createdAt": "2020-06-16T21:04:07Z", "commit": {"oid": "db7585355af2072875cd38b5b88d8424fda07f37"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMTowNDowN1rOGktGcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMToxMTowMlrOGktUMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE0MDg0OA==", "bodyText": "Using both @EntityGraph and @query is redundant. We should be able to delete one.", "url": "https://github.com/ls1intum/Artemis/pull/1664#discussion_r441140848", "createdAt": "2020-06-16T21:04:07Z", "author": {"login": "kloessst"}, "path": "src/main/java/de/tum/in/www1/artemis/repository/ExamRepository.java", "diffHunk": "@@ -19,6 +21,13 @@\n \n     List<Exam> findByCourseId(Long courseId);\n \n+    @EntityGraph(type = LOAD, attributePaths = { \"exerciseGroups\" })\n+    Optional<Exam> findWithExerciseGroupsById(Long id);\n+\n     @EntityGraph(type = LOAD, attributePaths = { \"registeredUsers\" })\n     Optional<Exam> findWithRegisteredUsersById(Long id);\n+\n+    @EntityGraph(type = LOAD, attributePaths = { \"exerciseGroups\", \"studentExams\" })\n+    @Query(\"select distinct exam from Exam exam left join fetch exam.studentExams studentExams left join fetch exam.exerciseGroups exerciseGroups left join fetch exerciseGroups.exercises where (exam.id =:#{#examId})\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db7585355af2072875cd38b5b88d8424fda07f37"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE0NDEzNQ==", "bodyText": "find instead of findOne. Return an Optional", "url": "https://github.com/ls1intum/Artemis/pull/1664#discussion_r441144135", "createdAt": "2020-06-16T21:10:36Z", "author": {"login": "kloessst"}, "path": "src/main/java/de/tum/in/www1/artemis/repository/ExamRepository.java", "diffHunk": "@@ -19,6 +21,13 @@\n \n     List<Exam> findByCourseId(Long courseId);\n \n+    @EntityGraph(type = LOAD, attributePaths = { \"exerciseGroups\" })\n+    Optional<Exam> findWithExerciseGroupsById(Long id);\n+\n     @EntityGraph(type = LOAD, attributePaths = { \"registeredUsers\" })\n     Optional<Exam> findWithRegisteredUsersById(Long id);\n+\n+    @EntityGraph(type = LOAD, attributePaths = { \"exerciseGroups\", \"studentExams\" })\n+    @Query(\"select distinct exam from Exam exam left join fetch exam.studentExams studentExams left join fetch exam.exerciseGroups exerciseGroups left join fetch exerciseGroups.exercises where (exam.id =:#{#examId})\")\n+    Exam findOneWithEagerExercisesGroupsAndStudentExams(@Param(\"examId\") long examId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db7585355af2072875cd38b5b88d8424fda07f37"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE0NDM3MQ==", "bodyText": "Add new entity not found exception", "url": "https://github.com/ls1intum/Artemis/pull/1664#discussion_r441144371", "createdAt": "2020-06-16T21:11:02Z", "author": {"login": "kloessst"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ExamService.java", "diffHunk": "@@ -74,6 +86,16 @@ public Exam findOneWithRegisteredUsers(Long examId) {\n         return examRepository.findByCourseId(courseId);\n     }\n \n+    /**\n+     * Get the exam of a course with exercise groups and student exams\n+     * @param examId {Long} The courseId of the course which contains the exam\n+     * @return The exam\n+     */\n+    public Exam findOneWithExercisesGroupsAndStudentExamsByExamId(Long examId) {\n+        log.debug(\"REST request to get the exam with student exams and exercise groups for Id : {}\", examId);\n+        return examRepository.findOneWithEagerExercisesGroupsAndStudentExams(examId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db7585355af2072875cd38b5b88d8424fda07f37"}, "originalPosition": 41}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2443, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}