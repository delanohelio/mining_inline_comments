{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzNTU4MDI1", "number": 2202, "title": "Only log warning when user is missing in VCS", "bodyText": "Fixes #2201\nI can write a test that tests this behaviour if you approve the change this way.", "createdAt": "2020-10-14T18:22:02Z", "url": "https://github.com/ls1intum/Artemis/pull/2202", "merged": true, "mergeCommit": {"oid": "ae5968491c0f90e4314054763e1ab25b42f83269"}, "closed": true, "closedAt": "2020-10-23T07:45:49Z", "author": {"login": "1-alex98"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdShXLDgH2gAyNTAzNTU4MDI1OjVmMjFlMmRhNmYwODQxNGE4MzgyNTdmMzJhYTczNzY2NGE5ZjM5OTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVRqizAFqTUxNTQxOTU2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5f21e2da6f08414a838257f32aa737664a9f3999", "author": {"user": {"login": "1-alex98", "name": "Alexander von Trostorff"}}, "url": "https://github.com/ls1intum/Artemis/commit/5f21e2da6f08414a838257f32aa737664a9f3999", "committedDate": "2020-10-14T18:20:03Z", "message": "Only log warning when user is missing in VCS\n\nFixes #2201"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4NjE5NzU5", "url": "https://github.com/ls1intum/Artemis/pull/2202#pullrequestreview-508619759", "createdAt": "2020-10-14T18:29:47Z", "commit": {"oid": "5f21e2da6f08414a838257f32aa737664a9f3999"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df2a5dad84bb404d16505475de87e3ec6597299c", "author": {"user": {"login": "1-alex98", "name": "Alexander von Trostorff"}}, "url": "https://github.com/ls1intum/Artemis/commit/df2a5dad84bb404d16505475de87e3ec6597299c", "committedDate": "2020-10-19T22:04:38Z", "message": "Add integration test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyMTk0MTk4", "url": "https://github.com/ls1intum/Artemis/pull/2202#pullrequestreview-512194198", "createdAt": "2020-10-19T22:07:21Z", "commit": {"oid": "df2a5dad84bb404d16505475de87e3ec6597299c"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyMjUxNzcw", "url": "https://github.com/ls1intum/Artemis/pull/2202#pullrequestreview-512251770", "createdAt": "2020-10-20T00:37:26Z", "commit": {"oid": "df2a5dad84bb404d16505475de87e3ec6597299c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQwMDozNzoyNlrOHkmagA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQwMDozNzoyNlrOHkmagA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODE0MDE2MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        log.warn(\"Cannot delete user in GitLab. User does not exist! %s\".formatted(login));\n          \n          \n            \n                        log.warn(\"Cannot delete user in GitLab. User does not exist! {}\", login);\n          \n      \n    \n    \n  \n\nI don't know why it wasn't like that before. (This is the standard logging string format for SLF4J)", "url": "https://github.com/ls1intum/Artemis/pull/2202#discussion_r508140160", "createdAt": "2020-10-20T00:37:26Z", "author": {"login": "MaisiKoleni"}, "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/gitlab/GitLabUserManagementService.java", "diffHunk": "@@ -246,8 +246,8 @@ public void deleteUser(String login) {\n             final var userId = getUserId(login);\n             gitlab.getUserApi().deleteUser(userId, true);\n         }\n-        catch (NullPointerException e) {\n-            log.warn(\"Cannot delete user in GitLab. User does not exist! \" + login);\n+        catch (GitLabUserDoesNotExistException e) {\n+            log.warn(\"Cannot delete user in GitLab. User does not exist! %s\".formatted(login));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df2a5dad84bb404d16505475de87e3ec6597299c"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyMjU0OTIx", "url": "https://github.com/ls1intum/Artemis/pull/2202#pullrequestreview-512254921", "createdAt": "2020-10-20T00:47:16Z", "commit": {"oid": "df2a5dad84bb404d16505475de87e3ec6597299c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQwMDo0NzoxNlrOHkmmEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQwMDo0NzoxNlrOHkmmEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODE0MzEyMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @AfterEach\n          \n          \n            \n                public void tearDown() {\n          \n          \n            \n                    database.resetDatabase();\n          \n          \n            \n                    gitlabRequestMockProvider.reset();\n          \n          \n            \n                }\n          \n          \n            \n            \n          \n          \n            \n                @BeforeEach\n          \n          \n            \n                public void setUp() {\n          \n          \n            \n                    gitlabRequestMockProvider.enableMockingOfRequests();\n          \n          \n            \n                }\n          \n          \n            \n                @BeforeEach\n          \n          \n            \n                public void setUp() {\n          \n          \n            \n                    gitlabRequestMockProvider.enableMockingOfRequests();\n          \n          \n            \n                }\n          \n          \n            \n            \n          \n          \n            \n                @AfterEach\n          \n          \n            \n                public void tearDown() {\n          \n          \n            \n                    database.resetDatabase();\n          \n          \n            \n                    gitlabRequestMockProvider.reset();\n          \n          \n            \n                }\n          \n      \n    \n    \n  \n\nI am not sure here, this might be highly opinionated, but I think swapping @BeforeEach and @AfterEach here would make the code quicker to read.", "url": "https://github.com/ls1intum/Artemis/pull/2202#discussion_r508143122", "createdAt": "2020-10-20T00:47:16Z", "author": {"login": "MaisiKoleni"}, "path": "src/test/java/de/tum/in/www1/artemis/AccountResourceWithGitLabIntegrationTest.java", "diffHunk": "@@ -0,0 +1,80 @@\n+package de.tum.in.www1.artemis;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import java.util.Optional;\n+\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+\n+import de.tum.in.www1.artemis.connector.gitlab.GitlabRequestMockProvider;\n+import de.tum.in.www1.artemis.domain.User;\n+import de.tum.in.www1.artemis.repository.UserRepository;\n+import de.tum.in.www1.artemis.service.UserService;\n+import de.tum.in.www1.artemis.util.DatabaseUtilService;\n+import de.tum.in.www1.artemis.util.ModelFactory;\n+import de.tum.in.www1.artemis.util.RequestUtilService;\n+import de.tum.in.www1.artemis.web.rest.vm.ManagedUserVM;\n+\n+public class AccountResourceWithGitLabIntegrationTest extends AbstractSpringIntegrationJenkinsGitlabTest {\n+\n+    @Autowired\n+    RequestUtilService request;\n+\n+    @Autowired\n+    UserRepository userRepo;\n+\n+    @Autowired\n+    UserService userService;\n+\n+    @Autowired\n+    DatabaseUtilService database;\n+\n+    @Autowired\n+    private GitlabRequestMockProvider gitlabRequestMockProvider;\n+\n+    @AfterEach\n+    public void tearDown() {\n+        database.resetDatabase();\n+        gitlabRequestMockProvider.reset();\n+    }\n+\n+    @BeforeEach\n+    public void setUp() {\n+        gitlabRequestMockProvider.enableMockingOfRequests();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df2a5dad84bb404d16505475de87e3ec6597299c"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c4219f49718c7532f67ddee1a5e6071559fcb7e", "author": {"user": {"login": "1-alex98", "name": "Alexander von Trostorff"}}, "url": "https://github.com/ls1intum/Artemis/commit/4c4219f49718c7532f67ddee1a5e6071559fcb7e", "committedDate": "2020-10-20T07:51:56Z", "message": "Address review comments and add second test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26144ea8ae686feef9abbd5574196cb23fd759c4", "author": {"user": {"login": "1-alex98", "name": "Alexander von Trostorff"}}, "url": "https://github.com/ls1intum/Artemis/commit/26144ea8ae686feef9abbd5574196cb23fd759c4", "committedDate": "2020-10-20T07:59:52Z", "message": "Address review comments and add second test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8bd3f68bcacdfb1979fa3df99f2994d646be52b8", "author": {"user": {"login": "krusche", "name": "Stephan Krusche"}}, "url": "https://github.com/ls1intum/Artemis/commit/8bd3f68bcacdfb1979fa3df99f2994d646be52b8", "committedDate": "2020-10-20T11:28:48Z", "message": "Merge branch 'develop' into bugfix/register/#2201-user-deltion-also-if-not-in-vcs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyOTIzMDEz", "url": "https://github.com/ls1intum/Artemis/pull/2202#pullrequestreview-512923013", "createdAt": "2020-10-20T16:30:42Z", "commit": {"oid": "8bd3f68bcacdfb1979fa3df99f2994d646be52b8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNjozMDo0M1rOHlG-FA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNjozMDo0M1rOHlG-FA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODY3MzU1Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        log.warn(\"Cannot delete user ''{}'' in GitLab. User does not exist! \", login);\n          \n          \n            \n                        log.warn(\"Cannot delete user ''{}'' in GitLab. User does not exist!\", login);", "url": "https://github.com/ls1intum/Artemis/pull/2202#discussion_r508673556", "createdAt": "2020-10-20T16:30:43Z", "author": {"login": "MaisiKoleni"}, "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/gitlab/GitLabUserManagementService.java", "diffHunk": "@@ -246,8 +246,8 @@ public void deleteUser(String login) {\n             final var userId = getUserId(login);\n             gitlab.getUserApi().deleteUser(userId, true);\n         }\n-        catch (NullPointerException e) {\n-            log.warn(\"Cannot delete user in GitLab. User does not exist! \" + login);\n+        catch (GitLabUserDoesNotExistException e) {\n+            log.warn(\"Cannot delete user ''{}'' in GitLab. User does not exist! \", login);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bd3f68bcacdfb1979fa3df99f2994d646be52b8"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45d234a639de671faa26bdcecf93b924cfe4168e", "author": {"user": {"login": "1-alex98", "name": "Alexander von Trostorff"}}, "url": "https://github.com/ls1intum/Artemis/commit/45d234a639de671faa26bdcecf93b924cfe4168e", "committedDate": "2020-10-20T21:40:35Z", "message": "Remove space"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzMjY3MTE1", "url": "https://github.com/ls1intum/Artemis/pull/2202#pullrequestreview-513267115", "createdAt": "2020-10-21T02:44:09Z", "commit": {"oid": "45d234a639de671faa26bdcecf93b924cfe4168e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1NDE5NTYx", "url": "https://github.com/ls1intum/Artemis/pull/2202#pullrequestreview-515419561", "createdAt": "2020-10-23T07:44:30Z", "commit": {"oid": "45d234a639de671faa26bdcecf93b924cfe4168e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3822, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}