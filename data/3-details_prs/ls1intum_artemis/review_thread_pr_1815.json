{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0MjgzNzI0", "number": 1815, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQyMTo1MTowOFrOELaObA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxODo0MToxMVrOELfGHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMzk5NDY4OnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/exam/manage/student-exams/student-exam-detail.component.ts", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQyMTo1MTowOFrOGs-HLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQyMTo1MTowOFrOGs-HLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgwODE3NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // if the exam is not visible, we rather disable the form\n          \n          \n            \n                    // if the exam is not visible to students yet, we disable the form to edit the working time", "url": "https://github.com/ls1intum/Artemis/pull/1815#discussion_r449808174", "createdAt": "2020-07-04T21:51:08Z", "author": {"login": "sleiss"}, "path": "src/main/webapp/app/exam/manage/student-exams/student-exam-detail.component.ts", "diffHunk": "@@ -107,8 +108,29 @@ export class StudentExamDetailComponent implements OnInit {\n         const workingTime = this.artemisDurationFromSecondsPipe.transform(this.studentExam.workingTime);\n         const workingTimeParts = workingTime.split(':');\n         this.workingTimeForm = new FormGroup({\n-            minutes: new FormControl(parseInt(workingTimeParts[0] ? workingTimeParts[0] : '0', 10), [Validators.min(0), Validators.required]),\n-            seconds: new FormControl(parseInt(workingTimeParts[1] ? workingTimeParts[1] : '0', 10), [Validators.min(0), Validators.max(59), Validators.required]),\n+            minutes: new FormControl({ value: parseInt(workingTimeParts[0] ? workingTimeParts[0] : '0', 10), disabled: this.examIsVisible() }, [\n+                Validators.min(0),\n+                Validators.required,\n+            ]),\n+            seconds: new FormControl({ value: parseInt(workingTimeParts[1] ? workingTimeParts[1] : '0', 10), disabled: this.examIsVisible() }, [\n+                Validators.min(0),\n+                Validators.max(59),\n+                Validators.required,\n+            ]),\n         });\n     }\n+\n+    examIsVisible(): boolean {\n+        if (this.studentExam.exam) {\n+            return moment(this.studentExam.exam.visibleDate).isBefore(moment());\n+        }\n+        // if the exam is not visible, we rather disable the form", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b70b0743f0da085ae4bc545ca0d0b79819dd627"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNDc3Njg4OnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/exam/manage/student-exams/student-exam-detail.component.ts", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxODoxNzowN1rOGtD_zA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxODoxNzowN1rOGtD_zA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwNDU4OA==", "bodyText": "You may want to add a comment here to make this more clear:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        return moment(this.studentExam.exam.visibleDate).isBefore(moment());\n          \n          \n            \n                        // Disable the form to edit the working time if the exam is already visible\n          \n          \n            \n                        return moment(this.studentExam.exam.visibleDate).isBefore(moment());", "url": "https://github.com/ls1intum/Artemis/pull/1815#discussion_r449904588", "createdAt": "2020-07-05T18:17:07Z", "author": {"login": "sascha11110"}, "path": "src/main/webapp/app/exam/manage/student-exams/student-exam-detail.component.ts", "diffHunk": "@@ -107,8 +108,29 @@ export class StudentExamDetailComponent implements OnInit {\n         const workingTime = this.artemisDurationFromSecondsPipe.transform(this.studentExam.workingTime);\n         const workingTimeParts = workingTime.split(':');\n         this.workingTimeForm = new FormGroup({\n-            minutes: new FormControl(parseInt(workingTimeParts[0] ? workingTimeParts[0] : '0', 10), [Validators.min(0), Validators.required]),\n-            seconds: new FormControl(parseInt(workingTimeParts[1] ? workingTimeParts[1] : '0', 10), [Validators.min(0), Validators.max(59), Validators.required]),\n+            minutes: new FormControl({ value: parseInt(workingTimeParts[0] ? workingTimeParts[0] : '0', 10), disabled: this.examIsVisible() }, [\n+                Validators.min(0),\n+                Validators.required,\n+            ]),\n+            seconds: new FormControl({ value: parseInt(workingTimeParts[1] ? workingTimeParts[1] : '0', 10), disabled: this.examIsVisible() }, [\n+                Validators.min(0),\n+                Validators.max(59),\n+                Validators.required,\n+            ]),\n         });\n     }\n+\n+    examIsVisible(): boolean {\n+        if (this.studentExam.exam) {\n+            return moment(this.studentExam.exam.visibleDate).isBefore(moment());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "402c6f26ec18e099b76169eb45412bf8f0cab129"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNDc3ODc0OnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/exam/manage/student-exams/student-exam-detail.component.ts", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxODoyMDoyMlrOGtEArA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxODo0MDo0NlrOGtEHLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwNDgxMg==", "bodyText": "I don't get this comment. For two reasons:\n\nThe purpose of the PR is to ensure that the working time cannot be changed after the exam is visible to the students. If there is no visibleDate the working time can be changed --> so the method should return false (--> form is editable)\nThe first part (if the exam is not visible to students yet) is a little confusing. If the visibleDate is not set would make more sense here", "url": "https://github.com/ls1intum/Artemis/pull/1815#discussion_r449904812", "createdAt": "2020-07-05T18:20:22Z", "author": {"login": "sascha11110"}, "path": "src/main/webapp/app/exam/manage/student-exams/student-exam-detail.component.ts", "diffHunk": "@@ -107,8 +108,29 @@ export class StudentExamDetailComponent implements OnInit {\n         const workingTime = this.artemisDurationFromSecondsPipe.transform(this.studentExam.workingTime);\n         const workingTimeParts = workingTime.split(':');\n         this.workingTimeForm = new FormGroup({\n-            minutes: new FormControl(parseInt(workingTimeParts[0] ? workingTimeParts[0] : '0', 10), [Validators.min(0), Validators.required]),\n-            seconds: new FormControl(parseInt(workingTimeParts[1] ? workingTimeParts[1] : '0', 10), [Validators.min(0), Validators.max(59), Validators.required]),\n+            minutes: new FormControl({ value: parseInt(workingTimeParts[0] ? workingTimeParts[0] : '0', 10), disabled: this.examIsVisible() }, [\n+                Validators.min(0),\n+                Validators.required,\n+            ]),\n+            seconds: new FormControl({ value: parseInt(workingTimeParts[1] ? workingTimeParts[1] : '0', 10), disabled: this.examIsVisible() }, [\n+                Validators.min(0),\n+                Validators.max(59),\n+                Validators.required,\n+            ]),\n         });\n     }\n+\n+    examIsVisible(): boolean {\n+        if (this.studentExam.exam) {\n+            return moment(this.studentExam.exam.visibleDate).isBefore(moment());\n+        }\n+        // if the exam is not visible to students yet, we disable the form to edit the working time", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "402c6f26ec18e099b76169eb45412bf8f0cab129"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwNjQ3OA==", "bodyText": "the comment is wrong, I'll update it. This should just prevent an edge case and type script error when for some reason the studentExam.exam is not loaded or undefined", "url": "https://github.com/ls1intum/Artemis/pull/1815#discussion_r449906478", "createdAt": "2020-07-05T18:40:46Z", "author": {"login": "krusche"}, "path": "src/main/webapp/app/exam/manage/student-exams/student-exam-detail.component.ts", "diffHunk": "@@ -107,8 +108,29 @@ export class StudentExamDetailComponent implements OnInit {\n         const workingTime = this.artemisDurationFromSecondsPipe.transform(this.studentExam.workingTime);\n         const workingTimeParts = workingTime.split(':');\n         this.workingTimeForm = new FormGroup({\n-            minutes: new FormControl(parseInt(workingTimeParts[0] ? workingTimeParts[0] : '0', 10), [Validators.min(0), Validators.required]),\n-            seconds: new FormControl(parseInt(workingTimeParts[1] ? workingTimeParts[1] : '0', 10), [Validators.min(0), Validators.max(59), Validators.required]),\n+            minutes: new FormControl({ value: parseInt(workingTimeParts[0] ? workingTimeParts[0] : '0', 10), disabled: this.examIsVisible() }, [\n+                Validators.min(0),\n+                Validators.required,\n+            ]),\n+            seconds: new FormControl({ value: parseInt(workingTimeParts[1] ? workingTimeParts[1] : '0', 10), disabled: this.examIsVisible() }, [\n+                Validators.min(0),\n+                Validators.max(59),\n+                Validators.required,\n+            ]),\n         });\n     }\n+\n+    examIsVisible(): boolean {\n+        if (this.studentExam.exam) {\n+            return moment(this.studentExam.exam.visibleDate).isBefore(moment());\n+        }\n+        // if the exam is not visible to students yet, we disable the form to edit the working time", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwNDgxMg=="}, "originalCommit": {"oid": "402c6f26ec18e099b76169eb45412bf8f0cab129"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNDc3OTU0OnYy", "diffSide": "RIGHT", "path": "src/test/java/de/tum/in/www1/artemis/StudentExamIntegrationTest.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxODoyMTozN1rOGtEBCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxODozNDo1NlrOGtEFOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwNDkwNQ==", "bodyText": "We should find a better solution for this soon :-D", "url": "https://github.com/ls1intum/Artemis/pull/1815#discussion_r449904905", "createdAt": "2020-07-05T18:21:37Z", "author": {"login": "sascha11110"}, "path": "src/test/java/de/tum/in/www1/artemis/StudentExamIntegrationTest.java", "diffHunk": "@@ -70,7 +70,13 @@ public void initTestCase() {\n     }\n \n     @AfterEach\n-    public void resetDatabase() {\n+    public void resetDatabase() throws Exception {\n+\n+        // change back to instructor user\n+        database.changeUser(\"instructor1\");\n+        // Clean up to prevent exceptions during reset database\n+        request.delete(\"/api/courses/\" + course1.getId() + \"/exams/\" + exam1.getId(), HttpStatus.OK);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "402c6f26ec18e099b76169eb45412bf8f0cab129"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwNTc0OA==", "bodyText": "In my project I always use a try{}finally{} and within the finally I delete all of the entities created by accessing the repository directly\nif(repo.existsById(...)){\nrepo.deleteById(...);\n}\nSomething like that. Is that something that might help you?", "url": "https://github.com/ls1intum/Artemis/pull/1815#discussion_r449905748", "createdAt": "2020-07-05T18:31:53Z", "author": {"login": "julian-christl"}, "path": "src/test/java/de/tum/in/www1/artemis/StudentExamIntegrationTest.java", "diffHunk": "@@ -70,7 +70,13 @@ public void initTestCase() {\n     }\n \n     @AfterEach\n-    public void resetDatabase() {\n+    public void resetDatabase() throws Exception {\n+\n+        // change back to instructor user\n+        database.changeUser(\"instructor1\");\n+        // Clean up to prevent exceptions during reset database\n+        request.delete(\"/api/courses/\" + course1.getId() + \"/exams/\" + exam1.getId(), HttpStatus.OK);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwNDkwNQ=="}, "originalCommit": {"oid": "402c6f26ec18e099b76169eb45412bf8f0cab129"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwNTk3Ng==", "bodyText": "we have a better solution already, I added a cleanup database service on develop so this line might not even be necessary, but still a good test that the DELETE Rest call does work as intended", "url": "https://github.com/ls1intum/Artemis/pull/1815#discussion_r449905976", "createdAt": "2020-07-05T18:34:56Z", "author": {"login": "krusche"}, "path": "src/test/java/de/tum/in/www1/artemis/StudentExamIntegrationTest.java", "diffHunk": "@@ -70,7 +70,13 @@ public void initTestCase() {\n     }\n \n     @AfterEach\n-    public void resetDatabase() {\n+    public void resetDatabase() throws Exception {\n+\n+        // change back to instructor user\n+        database.changeUser(\"instructor1\");\n+        // Clean up to prevent exceptions during reset database\n+        request.delete(\"/api/courses/\" + course1.getId() + \"/exams/\" + exam1.getId(), HttpStatus.OK);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwNDkwNQ=="}, "originalCommit": {"oid": "402c6f26ec18e099b76169eb45412bf8f0cab129"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNDc5MjYyOnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/exam/manage/student-exams/student-exam-detail.component.ts", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxODo0MToxMVrOGtEHUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxODo0MToxMVrOGtEHUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwNjUxNA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // if the exam is not visible to students yet, we disable the form to edit the working time\n          \n          \n            \n                    // if exam is undefined, the form to edit the working time is disabled", "url": "https://github.com/ls1intum/Artemis/pull/1815#discussion_r449906514", "createdAt": "2020-07-05T18:41:11Z", "author": {"login": "krusche"}, "path": "src/main/webapp/app/exam/manage/student-exams/student-exam-detail.component.ts", "diffHunk": "@@ -107,8 +108,29 @@ export class StudentExamDetailComponent implements OnInit {\n         const workingTime = this.artemisDurationFromSecondsPipe.transform(this.studentExam.workingTime);\n         const workingTimeParts = workingTime.split(':');\n         this.workingTimeForm = new FormGroup({\n-            minutes: new FormControl(parseInt(workingTimeParts[0] ? workingTimeParts[0] : '0', 10), [Validators.min(0), Validators.required]),\n-            seconds: new FormControl(parseInt(workingTimeParts[1] ? workingTimeParts[1] : '0', 10), [Validators.min(0), Validators.max(59), Validators.required]),\n+            minutes: new FormControl({ value: parseInt(workingTimeParts[0] ? workingTimeParts[0] : '0', 10), disabled: this.examIsVisible() }, [\n+                Validators.min(0),\n+                Validators.required,\n+            ]),\n+            seconds: new FormControl({ value: parseInt(workingTimeParts[1] ? workingTimeParts[1] : '0', 10), disabled: this.examIsVisible() }, [\n+                Validators.min(0),\n+                Validators.max(59),\n+                Validators.required,\n+            ]),\n         });\n     }\n+\n+    examIsVisible(): boolean {\n+        if (this.studentExam.exam) {\n+            return moment(this.studentExam.exam.visibleDate).isBefore(moment());\n+        }\n+        // if the exam is not visible to students yet, we disable the form to edit the working time", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "402c6f26ec18e099b76169eb45412bf8f0cab129"}, "originalPosition": 46}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4855, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}