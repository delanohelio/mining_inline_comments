{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEzNjQzMzky", "number": 2306, "title": "Move Jenkins build process to Pipelines & make templates configurable.", "bodyText": "Checklist\n\n I tested all changes and all related features with different users (student, tutor, instructor, admin) on the test server https://artemistest.ase.in.tum.de.\n Server: I added multiple integration tests (Spring) related to the features (with a high test coverage)\n Server: I documented the Java code using JavaDoc style.\n\nMotivation and Context\nAs discussed in #2169, the current Jenkins build configuration is deprecated:\n\nUsage of outdated plugins (Multiple SCMs: https://plugins.jenkins.io/multiple-scms/)\nno support for docker builds\nincreased setup complexity as all dependencies for all supported programming languages must be installed within the Jenkins master\nBad scalability: All builds are executed on the Jenkins master and adding more agents is rather expensive as all dependencies must be installed on all agents (and also updated).\n\nThis PR moves the Jenkins configuration to so-called Pipelines which define the build process, not through UI settings but declarations in a file.\nExercises that use the old setup should still be supported (e.g. you should still be able to import them into other exercises or start these exercises as student).\nDescription\nThe build process in Jenkins is moved to a config.xml-file that shares common steps for all programming languages (e.g. triggering a build when a push to GitLab occurred).\nIt is extended by a Jenkinsfile that is dependent on the used programming language which will be included in the generic config.xml file.\nThe builds steps (including used docker images, the checkout process, the actual build steps, and the reporting of the results to Artemis) is included in the Jenkinsfile.\nAnother improvement is that files from the src/main/resources/templates/jenkins-folder can now be modified. This allows (especially non-TUM-institutions) to override settings that might fit well into our deployment, but not so well in different deployments (e.g. a setup where build agents are not static like in our setup, but managed through a Kubernetes cluster).\nThe ResourceLoaderService manages this: Files are first loaded from a template folder next to the artemis.war-file and if no results are found, the files are loaded from the classpath (e.g. files included in the .war.file).\nThis avoids additional setup steps for all users, but allows experienced users to adjust the jenkins-templates to their own setup.\nNote: This PR requires at least version 1.1.1 of the Jenkins notification plugin: https://github.com/ls1intum/jenkins-server-notification-plugin. It is already installed at our Jenkins instance at TUM.\nAlso, some other Jenkins plugins are required for this setup, please refer to the changes in the documentation included in this PR.\nThe updated documentation also contains steps for setting up remote agents.\nPossible Questions related to the default Jenkinsfile\nQ: Why did you use checkout([$class: 'GitSCM', branches: [[name: '*/master']], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [[credentialsId: '#gitCredentials', name: 'tests', url: '#testRepository']]]) instead of git url: '#testRepository' credentialsId: '#gitCredentials'?\nA: The git step might be sufficient for the most cases, but it is recommended to use the checkout step instead (see https://www.jenkins.io/doc/pipeline/steps/git/). I decided to use the checkout step as the Jenkinsfile might be adjusted by other universities and this shows them more of the available options.\nQ: Why must every step of the Build stage be within a timestamps block?\nA: Artemis expects the timestamp to parse the logs.\nQ: But why did you not activate it for all pipeline builds? There even is an option to do this.\nA: This would also activate the timestamps for builds that are not related to Artemis but might be executed on the Jenkins instance.\nQ: Why did you use the cleanup action in the step to send the results and not the always option?\nA: There are multiple stages available that can be used to execute commands after the build completed. However, we can not change the order of execution of these steps and cleanup is always executed last.\nQ: Why is there a || true next to cp target/surefire-reports/*.xml $WORKSPACE/results/?\nA: If the build fails (e.g. due to a compilation error), no test-results are generated (and thus they can not be copied). The cp command then exits with a non-zero exit code and Jenkins will then stop the build (and will not sent the test results to Artemis.\nTo prevent this, we ignore the return value of the cp command.\nSteps for Testing\nAs this affects the Jenkins/GitLab-setup (and not the Bamboo/Bitbucket-setup), please use TS2 to test these changes.\n\nMake sure an exercise exists that was created before deploying this PR. Make sure that you have not started it yet.\nDeploy this PR.\nCreate a new Java or Python exercise (for Java, also try static code analysis) and verify that the solution and base repository are executed correctly (i.e. go to Edit in Editor and validate that the solution repository passes all test cases whilst the base repository passes none).\nStart the exercise as a student and participate: The normal behaviour, including the detection of failed and successful test cases, should work. Also validate that build logs are shown if a build error occured.\nImport the exercise into a new exercise and validate that the repositories are updated correctly (e.g. by validating that pushing to the new solution repository actually affects the correct exercise)\nStart the imported exercise as students and repeat the testing from step 4.\nRepeat steps 4-6 but use the programming exercise that was created before this PR was deployed instead.\n\nPlease also test that creating programming exercises still works on the Bamboo/Bitbucket-setup (TS1/TS3).\nTest Coverage\n\n\nExerciseService.java: 85%\nprogramming-exercise.component.ts 95%", "createdAt": "2020-11-01T15:37:28Z", "url": "https://github.com/ls1intum/Artemis/pull/2306", "merged": true, "mergeCommit": {"oid": "80edddb1244053d1230acdc0290999e9d49778da"}, "closed": true, "closedAt": "2020-11-10T16:41:39Z", "author": {"login": "sleiss"}, "timelineItems": {"totalCount": 55, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVDCWyAH2gAyNTEzNjQzMzkyOjZhNDJhYWZhZWQ4NjAxYmJhOTg5ZmUyZWI0MmRlNDRkNWNjN2ZkNzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbMIXFgFqTUyNzM5NTEzMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6a42aafaed8601bba989fe2eb42de44d5cc7fd72", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/6a42aafaed8601bba989fe2eb42de44d5cc7fd72", "committedDate": "2020-10-22T14:41:56Z", "message": "Start with supporting Pipelines for Jenkins."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5eba4a267023ab8021be1cde7f0a79f2034d3f9d", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/5eba4a267023ab8021be1cde7f0a79f2034d3f9d", "committedDate": "2020-10-22T15:50:06Z", "message": "Add python pipeline."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f14b67250ef68c526d02c9c6e6d11ec2e9ebedab", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/f14b67250ef68c526d02c9c6e6d11ec2e9ebedab", "committedDate": "2020-10-22T19:34:51Z", "message": "Parse timestamps."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb748ecc5b4d95ec9c97810a2f40fd251e77a48a", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/bb748ecc5b4d95ec9c97810a2f40fd251e77a48a", "committedDate": "2020-10-22T21:34:17Z", "message": "Work on C, Java with static SCA templates."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2638d08f3243835886c017ad794c6e24a01e349e", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/2638d08f3243835886c017ad794c6e24a01e349e", "committedDate": "2020-10-24T22:16:23Z", "message": "Fix SCA exercises."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8452cab8144692e4b060f54df0fc0577c3526e0", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/c8452cab8144692e4b060f54df0fc0577c3526e0", "committedDate": "2020-10-24T22:20:09Z", "message": "Fix SCA exercises."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b28934408aec1c713a48d70b4e858215852cfc99", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/b28934408aec1c713a48d70b4e858215852cfc99", "committedDate": "2020-10-28T20:12:47Z", "message": "Add documentation regarding setup of remote agent."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d4672b0a0226e80badbb5214fb895edc7edfa52", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/8d4672b0a0226e80badbb5214fb895edc7edfa52", "committedDate": "2020-10-28T20:22:16Z", "message": "Add more documentation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f42e9555f5d62ba77669eef57d66811e1c7bb90", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/0f42e9555f5d62ba77669eef57d66811e1c7bb90", "committedDate": "2020-10-28T20:24:57Z", "message": "Add more documentation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf61bfdc297c7ec969b75f0fc6807764ab922dce", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/cf61bfdc297c7ec969b75f0fc6807764ab922dce", "committedDate": "2020-10-28T20:43:10Z", "message": "Adjust pipeline script."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "570a8c1889a05cc8130e70284897d24ee6f0c483", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/570a8c1889a05cc8130e70284897d24ee6f0c483", "committedDate": "2020-10-28T20:43:51Z", "message": "Add image."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48838601f92eb6c1f8734b5b816898358364301b", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/48838601f92eb6c1f8734b5b816898358364301b", "committedDate": "2020-10-31T19:31:46Z", "message": "Merge develop."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d693d6830541879a0deb5f053954a95b22ecfe1d", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/d693d6830541879a0deb5f053954a95b22ecfe1d", "committedDate": "2020-10-31T20:56:20Z", "message": "Improve URL replacing on exercise creation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2bc8d589c1210b32583bf228e86c76758a1eda80", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/2bc8d589c1210b32583bf228e86c76758a1eda80", "committedDate": "2020-10-31T21:38:29Z", "message": "Fix fallback detection when creating new exercises."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "953a55df49fd2861198dd0b31bfd10d094cc10e9", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/953a55df49fd2861198dd0b31bfd10d094cc10e9", "committedDate": "2020-10-31T22:51:18Z", "message": "Add option to make templates configurable."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74d71a89ac8c96bf57ce3a4285a8c59c456e1a11", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/74d71a89ac8c96bf57ce3a4285a8c59c456e1a11", "committedDate": "2020-11-01T15:10:24Z", "message": "Add docker label to agents. Fix exercise import."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27e9953d024562fbd551f68fd29a88b2348aee05", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/27e9953d024562fbd551f68fd29a88b2348aee05", "committedDate": "2020-11-01T19:05:50Z", "message": "Make template path configurable."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ea2c4e20911de5fe5f3b10d9615225497e786cd", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/0ea2c4e20911de5fe5f3b10d9615225497e786cd", "committedDate": "2020-11-01T19:36:26Z", "message": "Add documentation on programming exercise specific values."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMjU4MjIw", "url": "https://github.com/ls1intum/Artemis/pull/2306#pullrequestreview-521258220", "createdAt": "2020-11-01T20:29:46Z", "commit": {"oid": "0ea2c4e20911de5fe5f3b10d9615225497e786cd"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQyMDoyOTo0NlrOHrx4tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQyMDozODoxNFrOHrx8XQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY2ODE1MQ==", "bodyText": "GitHub Actions complains: docs/dev/setup/programming-exercises.rst#L1: document isn't included in any toctree", "url": "https://github.com/ls1intum/Artemis/pull/2306#discussion_r515668151", "createdAt": "2020-11-01T20:29:46Z", "author": {"login": "FrankeLukas"}, "path": "docs/dev/setup/programming-exercises.rst", "diffHunk": "@@ -0,0 +1,57 @@\n+Adjustments for programming exercises", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ea2c4e20911de5fe5f3b10d9615225497e786cd"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY2ODUwNw==", "bodyText": "Shouldn't this be jenkinsService.getDockerImageName(programmingLanguage) instead considering you removed the hardcoded \"c\" from resourcePath?", "url": "https://github.com/ls1intum/Artemis/pull/2306#discussion_r515668507", "createdAt": "2020-11-01T20:33:11Z", "author": {"login": "FrankeLukas"}, "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/jenkins/DefaultJenkinsBuildPlanCreator.java", "diffHunk": "@@ -0,0 +1,33 @@\n+package de.tum.in.www1.artemis.service.connectors.jenkins;\n+\n+import java.net.URL;\n+import java.util.Map;\n+\n+import org.springframework.context.annotation.Lazy;\n+import org.springframework.context.annotation.Profile;\n+import org.springframework.stereotype.Component;\n+\n+import de.tum.in.www1.artemis.ResourceLoaderService;\n+import de.tum.in.www1.artemis.config.Constants;\n+import de.tum.in.www1.artemis.domain.enumeration.ProgrammingLanguage;\n+\n+@Profile(\"jenkins\")\n+@Component\n+public class DefaultJenkinsBuildPlanCreator extends AbstractJenkinsBuildPlanCreator {\n+\n+    public DefaultJenkinsBuildPlanCreator(ResourceLoaderService resourceLoaderService, @Lazy JenkinsService jenkinsService) {\n+        super(resourceLoaderService, jenkinsService);\n+    }\n+\n+    @Override\n+    public String getPipelineScript(ProgrammingLanguage programmingLanguage, URL testRepositoryURL, URL assignmentRepositoryURL, boolean isStaticCodeAnalysisEnabled) {\n+        final var resourcePath = new String[] { \"templates\", \"jenkins\", programmingLanguage.name().toLowerCase(), \"Jenkinsfile\" };\n+\n+        final var replacements = Map.of(REPLACE_TEST_REPO, testRepositoryURL.toString(), REPLACE_ASSIGNMENT_REPO, assignmentRepositoryURL.toString(), REPLACE_GIT_CREDENTIALS,\n+                gitCredentialsKey, REPLACE_ASSIGNMENT_CHECKOUT_PATH, Constants.ASSIGNMENT_CHECKOUT_PATH, REPLACE_TESTS_CHECKOUT_PATH, Constants.TESTS_CHECKOUT_PATH,\n+                REPLACE_ARTEMIS_NOTIFICATION_URL, artemisNotificationUrl, REPLACE_NOTIFICATIONS_TOKEN, ARTEMIS_AUTHENTICATION_TOKEN_KEY, REPLACE_DOCKER_IMAGE_NAME,\n+                jenkinsService.getDockerImageName(ProgrammingLanguage.C));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ea2c4e20911de5fe5f3b10d9615225497e786cd"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY2ODc2Mg==", "bodyText": "Codacy is complaining here: These nested if statements could be combined", "url": "https://github.com/ls1intum/Artemis/pull/2306#discussion_r515668762", "createdAt": "2020-11-01T20:35:02Z", "author": {"login": "FrankeLukas"}, "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/jenkins/JenkinsService.java", "diffHunk": "@@ -465,6 +500,72 @@ private void addFeedbackToResult(Result result, TestResultsDTO report) {\n         }\n     }\n \n+    private List<BuildLogEntry> parsePipelineLogs(Element logHtml) throws IllegalArgumentException {\n+        final var buildLog = new LinkedList<BuildLogEntry>();\n+        if (logHtml.childNodes().stream().noneMatch(child -> child.attr(\"class\").contains(\"pipeline\"))) {\n+            throw new IllegalArgumentException(\"Log is not pipeline log\");\n+        }\n+        for (Element elem : logHtml.children()) {\n+            // Only pipeline-node-ID elements contain actual log entries\n+            if (elem.attributes().get(\"class\").contains(\"pipeline-node\")) {\n+                // At least one child must have a timestamp class\n+                if (elem.childNodes().stream().anyMatch(child -> child.attr(\"class\").contains(\"timestamp\"))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ea2c4e20911de5fe5f3b10d9615225497e786cd"}, "originalPosition": 139}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY2OTA4NQ==", "bodyText": "Fwiw, Imho this would be more readable as\nfor (Element elem : logHtml.children()) {\n    // Only pipeline-node-ID elements containing actual log entries with at least one child with a timestamp class\n    if (!elem.attributes().get(\"class\").contains(\"pipeline-node\") || !elem.childNodes().stream().anyMatch(child -> child.attr(\"class\").contains(\"timestamp\"))) {\n        continue;\n    }\n\n    Iterator<Node> nodeIterator = elem.childNodes().iterator();\n    [...]\n}\n\nbut that is personal preference.", "url": "https://github.com/ls1intum/Artemis/pull/2306#discussion_r515669085", "createdAt": "2020-11-01T20:38:14Z", "author": {"login": "FrankeLukas"}, "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/jenkins/JenkinsService.java", "diffHunk": "@@ -465,6 +500,72 @@ private void addFeedbackToResult(Result result, TestResultsDTO report) {\n         }\n     }\n \n+    private List<BuildLogEntry> parsePipelineLogs(Element logHtml) throws IllegalArgumentException {\n+        final var buildLog = new LinkedList<BuildLogEntry>();\n+        if (logHtml.childNodes().stream().noneMatch(child -> child.attr(\"class\").contains(\"pipeline\"))) {\n+            throw new IllegalArgumentException(\"Log is not pipeline log\");\n+        }\n+        for (Element elem : logHtml.children()) {\n+            // Only pipeline-node-ID elements contain actual log entries\n+            if (elem.attributes().get(\"class\").contains(\"pipeline-node\")) {\n+                // At least one child must have a timestamp class\n+                if (elem.childNodes().stream().anyMatch(child -> child.attr(\"class\").contains(\"timestamp\"))) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY2ODc2Mg=="}, "originalCommit": {"oid": "0ea2c4e20911de5fe5f3b10d9615225497e786cd"}, "originalPosition": 139}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "460236a3b4e74c800b6b6779a17fb7b284c5e160", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/460236a3b4e74c800b6b6779a17fb7b284c5e160", "committedDate": "2020-11-01T21:34:39Z", "message": "Fix minor issues."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87317c7573be5c03c650aa4fb7a310ae1a73b143", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/87317c7573be5c03c650aa4fb7a310ae1a73b143", "committedDate": "2020-11-01T21:37:35Z", "message": "Fix some issues with documentation."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyODQ2NTY2", "url": "https://github.com/ls1intum/Artemis/pull/2306#pullrequestreview-522846566", "createdAt": "2020-11-03T20:21:56Z", "commit": {"oid": "87317c7573be5c03c650aa4fb7a310ae1a73b143"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f51617059020a53c023239d0c7534888bf09d086", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/f51617059020a53c023239d0c7534888bf09d086", "committedDate": "2020-11-04T08:57:16Z", "message": "Merge branch 'develop' into feature/jenkins-pipeline"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd5fd7e6e437bd4f0c56583eb7dee8fd0166b1d7", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/bd5fd7e6e437bd4f0c56583eb7dee8fd0166b1d7", "committedDate": "2020-11-04T11:57:49Z", "message": "Make only jenkins folder configurable."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "560af7c15fd60bedd411d20e5d873fe766b0f6b3", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/560af7c15fd60bedd411d20e5d873fe766b0f6b3", "committedDate": "2020-11-04T12:24:21Z", "message": "Add tests for ResourceLoaderService."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NTMzNjc4", "url": "https://github.com/ls1intum/Artemis/pull/2306#pullrequestreview-524533678", "createdAt": "2020-11-05T18:08:30Z", "commit": {"oid": "560af7c15fd60bedd411d20e5d873fe766b0f6b3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxODowODozMFrOHuQEAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxODowODozMFrOHuQEAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODI1OTcxNA==", "bodyText": "This is the same as in line 13. Should it be artemis.repo-download-clone-path?", "url": "https://github.com/ls1intum/Artemis/pull/2306#discussion_r518259714", "createdAt": "2020-11-05T18:08:30Z", "author": {"login": "b-fein"}, "path": "docs/dev/setup/programming-exercises.rst", "diffHunk": "@@ -0,0 +1,59 @@\n+Adjustments for programming exercises\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+There are several variables that can be configured when using programming exercises.\n+They are present in this separate page to keep the 'normal' setup guide shorter.\n+\n+\n+Path variables\n+##############\n+\n+There are variables for several paths:\n+\n+- ``artemis.repo-clone-path``\n+\n+  Repositories that the Artemis server needs are stored in this folder.\n+  This e.g. affects repositories from students which use the online code editor or the template/solution repositories of new exercises, as they are pushed to the VCS after modification.\n+\n+  Files in this directory are usually not critical, as the latest pushed version of these repositories is also stored at the VCS.\n+  However, changed that are saved in the online code editor but not yet commited will be lost when this folder is deleted.\n+\n+- ``artemis.repo-clone-path``", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "560af7c15fd60bedd411d20e5d873fe766b0f6b3"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78c21fd9be422a47349304cde0b1b8cd1c8bb19e", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/78c21fd9be422a47349304cde0b1b8cd1c8bb19e", "committedDate": "2020-11-05T18:11:24Z", "message": "Merge branch 'develop' into feature/jenkins-pipeline"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4890b9a4c9cefee64ec1d2dae1840ade04c504fe", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/4890b9a4c9cefee64ec1d2dae1840ade04c504fe", "committedDate": "2020-11-05T18:12:37Z", "message": "Fix wrong path in documentation."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NjIwMTQ1", "url": "https://github.com/ls1intum/Artemis/pull/2306#pullrequestreview-524620145", "createdAt": "2020-11-05T19:58:35Z", "commit": {"oid": "4890b9a4c9cefee64ec1d2dae1840ade04c504fe"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d593abb431dbb4b5fc38bbc51407458dc9b55bde", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/d593abb431dbb4b5fc38bbc51407458dc9b55bde", "committedDate": "2020-11-05T20:06:16Z", "message": "Adjust docu."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NzExODg5", "url": "https://github.com/ls1intum/Artemis/pull/2306#pullrequestreview-524711889", "createdAt": "2020-11-05T22:09:39Z", "commit": {"oid": "d593abb431dbb4b5fc38bbc51407458dc9b55bde"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NzE4NjYy", "url": "https://github.com/ls1intum/Artemis/pull/2306#pullrequestreview-524718662", "createdAt": "2020-11-05T22:21:27Z", "commit": {"oid": "d593abb431dbb4b5fc38bbc51407458dc9b55bde"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "493f0ee3b77f44ca8b2cc536db6886ac3ffc698d", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/493f0ee3b77f44ca8b2cc536db6886ac3ffc698d", "committedDate": "2020-11-06T09:24:06Z", "message": "Also remove path from remote agents."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d05dbfc050f8b5559dc5ededeef303cd41bf4eb5", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/d05dbfc050f8b5559dc5ededeef303cd41bf4eb5", "committedDate": "2020-11-06T09:25:27Z", "message": "Merge branch 'develop' into feature/jenkins-pipeline"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "562f889c1603db1f44d0f39c3efd866b7fb08c0e", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/562f889c1603db1f44d0f39c3efd866b7fb08c0e", "committedDate": "2020-11-06T10:17:36Z", "message": "Fix merge conflict."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MDcwOTEy", "url": "https://github.com/ls1intum/Artemis/pull/2306#pullrequestreview-525070912", "createdAt": "2020-11-06T11:28:40Z", "commit": {"oid": "562f889c1603db1f44d0f39c3efd866b7fb08c0e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxMToyODo0MVrOHuqeSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxMzozOTowN1rOHuuXag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY5MjQyNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              Templates are available within Artemis. The templates should fit to most environment, but there might cases where one wants to change the templates.\n          \n          \n            \n              Templates are available within Artemis. The templates should fit to most environments, but there might be cases where one wants to change the templates.", "url": "https://github.com/ls1intum/Artemis/pull/2306#discussion_r518692424", "createdAt": "2020-11-06T11:28:41Z", "author": {"login": "kloessst"}, "path": "docs/dev/setup/programming-exercises.rst", "diffHunk": "@@ -0,0 +1,59 @@\n+Adjustments for programming exercises\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+There are several variables that can be configured when using programming exercises.\n+They are present in this separate page to keep the 'normal' setup guide shorter.\n+\n+\n+Path variables\n+##############\n+\n+There are variables for several paths:\n+\n+- ``artemis.repo-clone-path``\n+\n+  Repositories that the Artemis server needs are stored in this folder.\n+  This e.g. affects repositories from students which use the online code editor or the template/solution repositories of new exercises, as they are pushed to the VCS after modification.\n+\n+  Files in this directory are usually not critical, as the latest pushed version of these repositories is also stored at the VCS.\n+  However, changed that are saved in the online code editor but not yet commited will be lost when this folder is deleted.\n+\n+- ``artemis.repo-download-clone-path``\n+\n+  Repositories that were downloaded from Artemis are stored in this directory.\n+\n+  Files in this directory can be removed without loss of data, if the downloaded repositories are still present at the VCS.\n+  No changes to the data in the VCS are stored in this directory (or they can be retrieved by performing the download-action again).\n+\n+- ``artemis.template-path``\n+\n+  Templates are available within Artemis. The templates should fit to most environment, but there might cases where one wants to change the templates.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "562f889c1603db1f44d0f39c3efd866b7fb08c0e"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY5MzQwNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              Note that this is the folder to the path where the `templates` folder is located, not the path to the `templates` folder itself.\n          \n          \n            \n              Note that this is the path to the folder where the `templates` folder is located, not the path to the `templates` folder itself.", "url": "https://github.com/ls1intum/Artemis/pull/2306#discussion_r518693405", "createdAt": "2020-11-06T11:30:45Z", "author": {"login": "kloessst"}, "path": "docs/dev/setup/programming-exercises.rst", "diffHunk": "@@ -0,0 +1,59 @@\n+Adjustments for programming exercises\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+There are several variables that can be configured when using programming exercises.\n+They are present in this separate page to keep the 'normal' setup guide shorter.\n+\n+\n+Path variables\n+##############\n+\n+There are variables for several paths:\n+\n+- ``artemis.repo-clone-path``\n+\n+  Repositories that the Artemis server needs are stored in this folder.\n+  This e.g. affects repositories from students which use the online code editor or the template/solution repositories of new exercises, as they are pushed to the VCS after modification.\n+\n+  Files in this directory are usually not critical, as the latest pushed version of these repositories is also stored at the VCS.\n+  However, changed that are saved in the online code editor but not yet commited will be lost when this folder is deleted.\n+\n+- ``artemis.repo-download-clone-path``\n+\n+  Repositories that were downloaded from Artemis are stored in this directory.\n+\n+  Files in this directory can be removed without loss of data, if the downloaded repositories are still present at the VCS.\n+  No changes to the data in the VCS are stored in this directory (or they can be retrieved by performing the download-action again).\n+\n+- ``artemis.template-path``\n+\n+  Templates are available within Artemis. The templates should fit to most environment, but there might cases where one wants to change the templates.\n+\n+  This value specified the path were the templates that should be overwritten are stored.\n+  Note that this is the folder to the path where the `templates` folder is located, not the path to the `templates` folder itself.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "562f889c1603db1f44d0f39c3efd866b7fb08c0e"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY5NDEwNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              This value specified the path were the templates that should be overwritten are stored.\n          \n          \n            \n              This value specifies the path to the templates which should overwrite the default ones.", "url": "https://github.com/ls1intum/Artemis/pull/2306#discussion_r518694107", "createdAt": "2020-11-06T11:32:21Z", "author": {"login": "kloessst"}, "path": "docs/dev/setup/programming-exercises.rst", "diffHunk": "@@ -0,0 +1,59 @@\n+Adjustments for programming exercises\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+There are several variables that can be configured when using programming exercises.\n+They are present in this separate page to keep the 'normal' setup guide shorter.\n+\n+\n+Path variables\n+##############\n+\n+There are variables for several paths:\n+\n+- ``artemis.repo-clone-path``\n+\n+  Repositories that the Artemis server needs are stored in this folder.\n+  This e.g. affects repositories from students which use the online code editor or the template/solution repositories of new exercises, as they are pushed to the VCS after modification.\n+\n+  Files in this directory are usually not critical, as the latest pushed version of these repositories is also stored at the VCS.\n+  However, changed that are saved in the online code editor but not yet commited will be lost when this folder is deleted.\n+\n+- ``artemis.repo-download-clone-path``\n+\n+  Repositories that were downloaded from Artemis are stored in this directory.\n+\n+  Files in this directory can be removed without loss of data, if the downloaded repositories are still present at the VCS.\n+  No changes to the data in the VCS are stored in this directory (or they can be retrieved by performing the download-action again).\n+\n+- ``artemis.template-path``\n+\n+  Templates are available within Artemis. The templates should fit to most environment, but there might cases where one wants to change the templates.\n+\n+  This value specified the path were the templates that should be overwritten are stored.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "562f889c1603db1f44d0f39c3efd866b7fb08c0e"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY5NDYxMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              Files in this directory are usually not critical, as the latest pushed version of these repositories is also stored at the VCS.\n          \n          \n            \n              Files in this directory are usually not critical, as the latest pushed version of these repositories are also stored at the VCS.", "url": "https://github.com/ls1intum/Artemis/pull/2306#discussion_r518694612", "createdAt": "2020-11-06T11:33:27Z", "author": {"login": "kloessst"}, "path": "docs/dev/setup/programming-exercises.rst", "diffHunk": "@@ -0,0 +1,59 @@\n+Adjustments for programming exercises\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+There are several variables that can be configured when using programming exercises.\n+They are present in this separate page to keep the 'normal' setup guide shorter.\n+\n+\n+Path variables\n+##############\n+\n+There are variables for several paths:\n+\n+- ``artemis.repo-clone-path``\n+\n+  Repositories that the Artemis server needs are stored in this folder.\n+  This e.g. affects repositories from students which use the online code editor or the template/solution repositories of new exercises, as they are pushed to the VCS after modification.\n+\n+  Files in this directory are usually not critical, as the latest pushed version of these repositories is also stored at the VCS.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "562f889c1603db1f44d0f39c3efd866b7fb08c0e"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY5NDk0NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            They are present in this separate page to keep the 'normal' setup guide shorter.\n          \n          \n            \n            They are presented in this separate page to keep the 'normal' setup guide shorter.", "url": "https://github.com/ls1intum/Artemis/pull/2306#discussion_r518694945", "createdAt": "2020-11-06T11:34:11Z", "author": {"login": "kloessst"}, "path": "docs/dev/setup/programming-exercises.rst", "diffHunk": "@@ -0,0 +1,59 @@\n+Adjustments for programming exercises\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+There are several variables that can be configured when using programming exercises.\n+They are present in this separate page to keep the 'normal' setup guide shorter.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "562f889c1603db1f44d0f39c3efd866b7fb08c0e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY5NjA1OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            This setup guide is for setting up a remote agent on an Ubuntu virtual machine that supports docker builds.\n          \n          \n            \n            This guide explains setting up a remote agent on an Ubuntu virtual machine that supports docker builds.", "url": "https://github.com/ls1intum/Artemis/pull/2306#discussion_r518696059", "createdAt": "2020-11-06T11:36:41Z", "author": {"login": "kloessst"}, "path": "docs/dev/setup/jenkins-gitlab.rst", "diffHunk": "@@ -646,6 +661,67 @@ the following steps:\n     Depending on the version this setting might not be available anymore.\n     Have a look `here <https://unix.stackexchange.com/questions/444177/how-to-disable-the-csrf-protection-in-jenkins-by-default>`__ on how you can disable CSRF protection.\n \n+\n+Installing remote build agents\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+You might want to run the builds on additional Jenkins agents, especially if a large amount of students should use the system at the same time.\n+Jenkins supports remote build agents: The actual compilation of the students submissions happens on these other machines but the whole process is transparent to Artemis.\n+\n+This setup guide is for setting up a remote agent on an Ubuntu virtual machine that supports docker builds.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "562f889c1603db1f44d0f39c3efd866b7fb08c0e"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY5NzA5Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            These templates should fit well for many deployments, but one might to change some of them in special deployments.\n          \n          \n            \n            These templates should fit well for many deployments, but one might want to change some of them for special deployments.", "url": "https://github.com/ls1intum/Artemis/pull/2306#discussion_r518697097", "createdAt": "2020-11-06T11:38:51Z", "author": {"login": "kloessst"}, "path": "docs/dev/setup/programming-exercises.rst", "diffHunk": "@@ -0,0 +1,59 @@\n+Adjustments for programming exercises\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+There are several variables that can be configured when using programming exercises.\n+They are present in this separate page to keep the 'normal' setup guide shorter.\n+\n+\n+Path variables\n+##############\n+\n+There are variables for several paths:\n+\n+- ``artemis.repo-clone-path``\n+\n+  Repositories that the Artemis server needs are stored in this folder.\n+  This e.g. affects repositories from students which use the online code editor or the template/solution repositories of new exercises, as they are pushed to the VCS after modification.\n+\n+  Files in this directory are usually not critical, as the latest pushed version of these repositories is also stored at the VCS.\n+  However, changed that are saved in the online code editor but not yet commited will be lost when this folder is deleted.\n+\n+- ``artemis.repo-download-clone-path``\n+\n+  Repositories that were downloaded from Artemis are stored in this directory.\n+\n+  Files in this directory can be removed without loss of data, if the downloaded repositories are still present at the VCS.\n+  No changes to the data in the VCS are stored in this directory (or they can be retrieved by performing the download-action again).\n+\n+- ``artemis.template-path``\n+\n+  Templates are available within Artemis. The templates should fit to most environment, but there might cases where one wants to change the templates.\n+\n+  This value specified the path were the templates that should be overwritten are stored.\n+  Note that this is the folder to the path where the `templates` folder is located, not the path to the `templates` folder itself.\n+\n+\n+\n+Templates\n+#########\n+\n+Templates are shipped with Artemis (they can be found within the ``src/main/resources/templates`` folder in Github).\n+These templates should fit well for many deployments, but one might to change some of them in special deployments.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "562f889c1603db1f44d0f39c3efd866b7fb08c0e"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODcyNjUzMA==", "bodyText": "Is this variable always set? You could make this Optional and then check it if its empty in the methods.", "url": "https://github.com/ls1intum/Artemis/pull/2306#discussion_r518726530", "createdAt": "2020-11-06T12:41:29Z", "author": {"login": "kloessst"}, "path": "src/main/java/de/tum/in/www1/artemis/ResourceLoaderService.java", "diffHunk": "@@ -0,0 +1,125 @@\n+package de.tum.in.www1.artemis;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.apache.commons.lang.StringUtils;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.core.io.Resource;\n+import org.springframework.core.io.ResourceLoader;\n+import org.springframework.core.io.support.ResourcePatternUtils;\n+import org.springframework.stereotype.Service;\n+\n+/**\n+ * Service class to load resources from the file system (if possible) and the classpath (as fallback).\n+ */\n+@Service\n+public class ResourceLoaderService {\n+\n+    private final ResourceLoader resourceLoader;\n+\n+    @Value(\"${artemis.template-path:#{null}}\")\n+    private String templateFileSystemPath;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "562f889c1603db1f44d0f39c3efd866b7fb08c0e"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc1NTk1Mg==", "bodyText": "Is it possible that there are multiple hidden elements?", "url": "https://github.com/ls1intum/Artemis/pull/2306#discussion_r518755952", "createdAt": "2020-11-06T13:38:42Z", "author": {"login": "kloessst"}, "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/jenkins/JenkinsService.java", "diffHunk": "@@ -465,6 +507,72 @@ private void addFeedbackToResult(Result result, TestResultsDTO report) {\n         }\n     }\n \n+    private List<BuildLogEntry> parsePipelineLogs(Element logHtml) throws IllegalArgumentException {\n+        final var buildLog = new LinkedList<BuildLogEntry>();\n+        if (logHtml.childNodes().stream().noneMatch(child -> child.attr(\"class\").contains(\"pipeline\"))) {\n+            throw new IllegalArgumentException(\"Log is not pipeline log\");\n+        }\n+        for (Element elem : logHtml.children()) {\n+            // Only pipeline-node-ID elements contain actual log entries\n+            if (elem.attributes().get(\"class\").contains(\"pipeline-node\")) {\n+                // At least one child must have a timestamp class\n+                if (elem.childNodes().stream().anyMatch(child -> child.attr(\"class\").contains(\"timestamp\"))) {\n+                    Iterator<Node> nodeIterator = elem.childNodes().iterator();\n+\n+                    while (nodeIterator.hasNext()) {\n+                        Node node = nodeIterator.next();\n+                        final String log;\n+                        if (node.attributes().get(\"class\").contains(\"timestamp\")) {\n+                            final var timeAsString = ((TextNode) node.childNode(0).childNode(0)).getWholeText();\n+                            final var time = ZonedDateTime.parse(timeAsString, DateTimeFormatter.ofPattern(\"yyyy-MM-dd'T'HH:mm:ssX\"));\n+                            var contentCandidate = nodeIterator.next();\n+\n+                            // Skip invisible entries (they contain only the timestamp, but we already got that above)\n+                            if (contentCandidate.attr(\"style\").contains(\"display: none\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "562f889c1603db1f44d0f39c3efd866b7fb08c0e"}, "originalPosition": 168}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc1NjIwMg==", "bodyText": "DateTimeFormatter.ofPattern(\"yyyy-MM-dd'T'HH:mm:ssX\") could move this out of the loops.", "url": "https://github.com/ls1intum/Artemis/pull/2306#discussion_r518756202", "createdAt": "2020-11-06T13:39:07Z", "author": {"login": "kloessst"}, "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/jenkins/JenkinsService.java", "diffHunk": "@@ -465,6 +507,72 @@ private void addFeedbackToResult(Result result, TestResultsDTO report) {\n         }\n     }\n \n+    private List<BuildLogEntry> parsePipelineLogs(Element logHtml) throws IllegalArgumentException {\n+        final var buildLog = new LinkedList<BuildLogEntry>();\n+        if (logHtml.childNodes().stream().noneMatch(child -> child.attr(\"class\").contains(\"pipeline\"))) {\n+            throw new IllegalArgumentException(\"Log is not pipeline log\");\n+        }\n+        for (Element elem : logHtml.children()) {\n+            // Only pipeline-node-ID elements contain actual log entries\n+            if (elem.attributes().get(\"class\").contains(\"pipeline-node\")) {\n+                // At least one child must have a timestamp class\n+                if (elem.childNodes().stream().anyMatch(child -> child.attr(\"class\").contains(\"timestamp\"))) {\n+                    Iterator<Node> nodeIterator = elem.childNodes().iterator();\n+\n+                    while (nodeIterator.hasNext()) {\n+                        Node node = nodeIterator.next();\n+                        final String log;\n+                        if (node.attributes().get(\"class\").contains(\"timestamp\")) {\n+                            final var timeAsString = ((TextNode) node.childNode(0).childNode(0)).getWholeText();\n+                            final var time = ZonedDateTime.parse(timeAsString, DateTimeFormatter.ofPattern(\"yyyy-MM-dd'T'HH:mm:ssX\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "562f889c1603db1f44d0f39c3efd866b7fb08c0e"}, "originalPosition": 164}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0edb6fbf10a5b8cb45d0a54e47678c5d7b84078c", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/0edb6fbf10a5b8cb45d0a54e47678c5d7b84078c", "committedDate": "2020-11-06T14:49:52Z", "message": "Update docs/dev/setup/programming-exercises.rst\n\nCo-authored-by: Stefan Kl\u00f6ss-Schuster <16407766+kloessst@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ee3edde5c9a33e675de431d70d57c2c15d085df", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/3ee3edde5c9a33e675de431d70d57c2c15d085df", "committedDate": "2020-11-06T14:50:05Z", "message": "Update docs/dev/setup/programming-exercises.rst\n\nCo-authored-by: Stefan Kl\u00f6ss-Schuster <16407766+kloessst@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "590ceb75056c218fba4543d13f97ae3f8074d72e", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/590ceb75056c218fba4543d13f97ae3f8074d72e", "committedDate": "2020-11-06T14:50:14Z", "message": "Update docs/dev/setup/programming-exercises.rst\n\nCo-authored-by: Stefan Kl\u00f6ss-Schuster <16407766+kloessst@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b3ea3a9dbc56b508bbb2a8a211b1d6d6692e436", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/8b3ea3a9dbc56b508bbb2a8a211b1d6d6692e436", "committedDate": "2020-11-06T14:50:28Z", "message": "Update docs/dev/setup/programming-exercises.rst\n\nCo-authored-by: Stefan Kl\u00f6ss-Schuster <16407766+kloessst@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e54ef68bf11fea49f1d501b70539a2cf7175b9a1", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/e54ef68bf11fea49f1d501b70539a2cf7175b9a1", "committedDate": "2020-11-06T14:50:36Z", "message": "Update docs/dev/setup/jenkins-gitlab.rst\n\nCo-authored-by: Stefan Kl\u00f6ss-Schuster <16407766+kloessst@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b98ed3e2476164e2a104b95a423dca0c4c316d36", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/b98ed3e2476164e2a104b95a423dca0c4c316d36", "committedDate": "2020-11-06T14:50:46Z", "message": "Update docs/dev/setup/programming-exercises.rst\n\nCo-authored-by: Stefan Kl\u00f6ss-Schuster <16407766+kloessst@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "459fd48fe2a201d014ffe41d0c54cb6d78cbe088", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/459fd48fe2a201d014ffe41d0c54cb6d78cbe088", "committedDate": "2020-11-06T14:55:40Z", "message": "Merge branch 'develop' into feature/jenkins-pipeline"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd2b2353d0ceed7d8ac915c15321d79a50f031f7", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/cd2b2353d0ceed7d8ac915c15321d79a50f031f7", "committedDate": "2020-11-06T14:58:17Z", "message": "Move DateTimeFormatter to class."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d8f0593440e065eceae2ab2115ba71ba91e62a8", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/8d8f0593440e065eceae2ab2115ba71ba91e62a8", "committedDate": "2020-11-06T15:01:03Z", "message": "Update docs/dev/setup/programming-exercises.rst\n\nCo-authored-by: Stefan Kl\u00f6ss-Schuster <16407766+kloessst@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58faca3b8aed93e096c90d5816e5f8f565b8b662", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/58faca3b8aed93e096c90d5816e5f8f565b8b662", "committedDate": "2020-11-06T15:10:43Z", "message": "Use Optionals for template path."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cea8e4ad75d64d63b345e74b473d84915cd9cffc", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/cea8e4ad75d64d63b345e74b473d84915cd9cffc", "committedDate": "2020-11-06T15:11:07Z", "message": "Merge branch 'feature/jenkins-pipeline' of github.com:ls1intum/ArTEMiS into feature/jenkins-pipeline"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a83adac52e4326dd2e6623e33c6d00267f8031d4", "author": {"user": {"login": "sleiss", "name": "Simon Lei\u00df"}}, "url": "https://github.com/ls1intum/Artemis/commit/a83adac52e4326dd2e6623e33c6d00267f8031d4", "committedDate": "2020-11-07T14:34:54Z", "message": "Revert accidential update."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2MTU1MTk4", "url": "https://github.com/ls1intum/Artemis/pull/2306#pullrequestreview-526155198", "createdAt": "2020-11-09T11:20:45Z", "commit": {"oid": "a83adac52e4326dd2e6623e33c6d00267f8031d4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMToyMDo0NVrOHvqDxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMToyMDo0NVrOHvqDxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTczNDIxMg==", "bodyText": "Is this just ISO_OFFSET_DATE_TIME?", "url": "https://github.com/ls1intum/Artemis/pull/2306#discussion_r519734212", "createdAt": "2020-11-09T11:20:45Z", "author": {"login": "MaisiKoleni"}, "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/jenkins/JenkinsService.java", "diffHunk": "@@ -81,6 +82,9 @@\n \n     private final FeedbackService feedbackService;\n \n+    // Pattern of the DateTime that is included in the logs received from Jenkins\n+    private final DateTimeFormatter logDateTimeFormatter = DateTimeFormatter.ofPattern(\"yyyy-MM-dd'T'HH:mm:ssX\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a83adac52e4326dd2e6623e33c6d00267f8031d4"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2MTk3MjMy", "url": "https://github.com/ls1intum/Artemis/pull/2306#pullrequestreview-526197232", "createdAt": "2020-11-09T12:21:17Z", "commit": {"oid": "a83adac52e4326dd2e6623e33c6d00267f8031d4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2MzE1NDY3", "url": "https://github.com/ls1intum/Artemis/pull/2306#pullrequestreview-526315467", "createdAt": "2020-11-09T14:34:50Z", "commit": {"oid": "a83adac52e4326dd2e6623e33c6d00267f8031d4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2OTk4MTA1", "url": "https://github.com/ls1intum/Artemis/pull/2306#pullrequestreview-526998105", "createdAt": "2020-11-10T09:15:49Z", "commit": {"oid": "a83adac52e4326dd2e6623e33c6d00267f8031d4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3MjE3ODEz", "url": "https://github.com/ls1intum/Artemis/pull/2306#pullrequestreview-527217813", "createdAt": "2020-11-10T13:49:03Z", "commit": {"oid": "a83adac52e4326dd2e6623e33c6d00267f8031d4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMzo0OTowM1rOHwdXYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMzo0OTowM1rOHwdXYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU3NDgxNw==", "bodyText": "I think three ` are too much and only two are needed to highlight it as intended. The preview shows an extra `  surrounding the code fragment.\nThis needs to be changed in all below lines too.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            2. Add a new user to the remote machine that Jenkins will use: ```sudo adduser --disabled-password --gecos \"\" jenkins```\n          \n          \n            \n            2. Add a new user to the remote machine that Jenkins will use: ``sudo adduser --disabled-password --gecos \"\" jenkins``", "url": "https://github.com/ls1intum/Artemis/pull/2306#discussion_r520574817", "createdAt": "2020-11-10T13:49:03Z", "author": {"login": "derLalla"}, "path": "docs/dev/setup/jenkins-gitlab.rst", "diffHunk": "@@ -646,6 +661,67 @@ the following steps:\n     Depending on the version this setting might not be available anymore.\n     Have a look `here <https://unix.stackexchange.com/questions/444177/how-to-disable-the-csrf-protection-in-jenkins-by-default>`__ on how you can disable CSRF protection.\n \n+\n+Installing remote build agents\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+You might want to run the builds on additional Jenkins agents, especially if a large amount of students should use the system at the same time.\n+Jenkins supports remote build agents: The actual compilation of the students submissions happens on these other machines but the whole process is transparent to Artemis.\n+\n+This guide explains setting up a remote agent on an Ubuntu virtual machine that supports docker builds.\n+\n+Prerequisites:\n+1. Install Docker on the remote machine: https://docs.docker.com/engine/install/ubuntu/\n+\n+2. Add a new user to the remote machine that Jenkins will use: ```sudo adduser --disabled-password --gecos \"\" jenkins```", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a83adac52e4326dd2e6623e33c6d00267f8031d4"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3MzExMjQ0", "url": "https://github.com/ls1intum/Artemis/pull/2306#pullrequestreview-527311244", "createdAt": "2020-11-10T15:19:37Z", "commit": {"oid": "a83adac52e4326dd2e6623e33c6d00267f8031d4"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNToxOTozN1rOHwhm3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNToxOTozN1rOHwhm3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDY0NDMxOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              However, changed that are saved in the online code editor but not yet commited will be lost when this folder is deleted.\n          \n          \n            \n              However, changes that are saved in the online code editor but not yet commited will be lost when this folder is deleted.", "url": "https://github.com/ls1intum/Artemis/pull/2306#discussion_r520644319", "createdAt": "2020-11-10T15:19:37Z", "author": {"login": "derLalla"}, "path": "docs/dev/setup/programming-exercises.rst", "diffHunk": "@@ -0,0 +1,59 @@\n+Adjustments for programming exercises\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+There are several variables that can be configured when using programming exercises.\n+They are presented in this separate page to keep the 'normal' setup guide shorter.\n+\n+\n+Path variables\n+##############\n+\n+There are variables for several paths:\n+\n+- ``artemis.repo-clone-path``\n+\n+  Repositories that the Artemis server needs are stored in this folder.\n+  This e.g. affects repositories from students which use the online code editor or the template/solution repositories of new exercises, as they are pushed to the VCS after modification.\n+\n+  Files in this directory are usually not critical, as the latest pushed version of these repositories are also stored at the VCS.\n+  However, changed that are saved in the online code editor but not yet commited will be lost when this folder is deleted.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a83adac52e4326dd2e6623e33c6d00267f8031d4"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3Mzk1MTMz", "url": "https://github.com/ls1intum/Artemis/pull/2306#pullrequestreview-527395133", "createdAt": "2020-11-10T16:41:11Z", "commit": {"oid": "a83adac52e4326dd2e6623e33c6d00267f8031d4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3550, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}