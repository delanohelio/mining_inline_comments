{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgzNTU1OTc4", "number": 2096, "reviewThreads": {"totalCount": 40, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxODo1NzowMFrOEmOR8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwNTo1NToxOVrOEm4mYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NTE1MzE0OnYy", "diffSide": "LEFT", "path": "build.gradle", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxODo1NzowMFrOHWIKuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMjoxMDo1MlrOHWOIow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk2NDUzNw==", "bodyText": "Should this change be reverted before the merge?", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r492964537", "createdAt": "2020-09-22T18:57:00Z", "author": {"login": "kloessst"}, "path": "build.gradle", "diffHunk": "@@ -91,9 +91,6 @@ springBoot {\n     mainClassName = \"de.tum.in.www1.artemis.ArtemisApp\"\n }\n \n-tasks.withType(JavaCompile).each {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72dfca8d8b136b4e359eb08081e13430d99042fb"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA1MDU0NA==", "bodyText": "I think so, depending on how we move forward with java 15. For now its necessary though so that we can build the latest build and deploy on ts1.", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493050544", "createdAt": "2020-09-22T21:42:38Z", "author": {"login": "anditurdiu"}, "path": "build.gradle", "diffHunk": "@@ -91,9 +91,6 @@ springBoot {\n     mainClassName = \"de.tum.in.www1.artemis.ArtemisApp\"\n }\n \n-tasks.withType(JavaCompile).each {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk2NDUzNw=="}, "originalCommit": {"oid": "72dfca8d8b136b4e359eb08081e13430d99042fb"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA2MjMwNw==", "bodyText": "Seems like @krusche made the transition to Java 15 so this can be deleted.", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493062307", "createdAt": "2020-09-22T22:10:52Z", "author": {"login": "kloessst"}, "path": "build.gradle", "diffHunk": "@@ -91,9 +91,6 @@ springBoot {\n     mainClassName = \"de.tum.in.www1.artemis.ArtemisApp\"\n }\n \n-tasks.withType(JavaCompile).each {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk2NDUzNw=="}, "originalCommit": {"oid": "72dfca8d8b136b4e359eb08081e13430d99042fb"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NTM3MjQyOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/ComplaintResponseService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMDowMTozNFrOHWKSaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMTo0ODoyMVrOHWNkKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk5OTI3Mg==", "bodyText": "Don't you need to check for exam mode here as well?", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r492999272", "createdAt": "2020-09-22T20:01:34Z", "author": {"login": "kloessst"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ComplaintResponseService.java", "diffHunk": "@@ -114,6 +115,11 @@ private boolean isUserAuthorizedToRespondToComplaint(StudentParticipation partic\n             return assessor.equals(reviewer);\n         }\n         else if (complaint.getComplaintType() == null || complaint.getComplaintType().equals(ComplaintType.COMPLAINT)) {\n+            // if test run complaint\n+            if (complaint.getStudent() != null && complaint.getStudent().getLogin().equals(assessor.getLogin())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d189067470549910bf5be3ce6cdfd0178172a30"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA1Mjk3MQ==", "bodyText": "In theory yes, but in practise, this method is called when a user wants to respond to a complaint. For non test run exercises, the tutor/instructor does not see the complaints in his dashboard and does not have the functionality on the client to respond to the complaint.\nTherefore the additional check if \"exam mode\" is redundant, I decided to not use it as we would have to fetch the exercises along with the participation from the database. In my opinion it is not worth making the call more expensive. Would you agree?", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493052971", "createdAt": "2020-09-22T21:48:21Z", "author": {"login": "anditurdiu"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ComplaintResponseService.java", "diffHunk": "@@ -114,6 +115,11 @@ private boolean isUserAuthorizedToRespondToComplaint(StudentParticipation partic\n             return assessor.equals(reviewer);\n         }\n         else if (complaint.getComplaintType() == null || complaint.getComplaintType().equals(ComplaintType.COMPLAINT)) {\n+            // if test run complaint\n+            if (complaint.getStudent() != null && complaint.getStudent().getLogin().equals(assessor.getLogin())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk5OTI3Mg=="}, "originalCommit": {"oid": "2d189067470549910bf5be3ce6cdfd0178172a30"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NTM5MDcwOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/ExamService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMDowNzowMFrOHWKdjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMjowNzowNFrOHWOCwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAwMjEyNg==", "bodyText": "Would be easier to already fetch only student exams which do not belong to a test run from the DB.", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493002126", "createdAt": "2020-09-22T20:07:00Z", "author": {"login": "kloessst"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ExamService.java", "diffHunk": "@@ -607,6 +605,18 @@ public void setNumberOfRegisteredUsersForExams(List<Exam> exams) {\n         exams.forEach(exam -> exam.setNumberOfRegisteredUsers(registeredUsersCountMap.get(exam.getId()).longValue()));\n     }\n \n+    /**\n+     * Finds an exam based on the id with all student exams which are not marked as test runs.\n+     * @param examId the id of the exam\n+     * @return the exam with student exams loaded\n+     */\n+    private Exam findWithStudentExamsById(long examId) {\n+        Exam exam = examRepository.findWithStudentExamsById(examId).orElseThrow(() -> new EntityNotFoundException(\"Exam with id \" + examId + \" does not exist\"));\n+        // drop all test runs and set the remaining students exams to the exam\n+        exam.setStudentExams(exam.getStudentExams().stream().dropWhile(StudentExam::getTestRun).collect(Collectors.toSet()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d189067470549910bf5be3ce6cdfd0178172a30"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA2MDgwMg==", "bodyText": "Yes good point!", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493060802", "createdAt": "2020-09-22T22:07:04Z", "author": {"login": "anditurdiu"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ExamService.java", "diffHunk": "@@ -607,6 +605,18 @@ public void setNumberOfRegisteredUsersForExams(List<Exam> exams) {\n         exams.forEach(exam -> exam.setNumberOfRegisteredUsers(registeredUsersCountMap.get(exam.getId()).longValue()));\n     }\n \n+    /**\n+     * Finds an exam based on the id with all student exams which are not marked as test runs.\n+     * @param examId the id of the exam\n+     * @return the exam with student exams loaded\n+     */\n+    private Exam findWithStudentExamsById(long examId) {\n+        Exam exam = examRepository.findWithStudentExamsById(examId).orElseThrow(() -> new EntityNotFoundException(\"Exam with id \" + examId + \" does not exist\"));\n+        // drop all test runs and set the remaining students exams to the exam\n+        exam.setStudentExams(exam.getStudentExams().stream().dropWhile(StudentExam::getTestRun).collect(Collectors.toSet()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAwMjEyNg=="}, "originalCommit": {"oid": "2d189067470549910bf5be3ce6cdfd0178172a30"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NTQ3NjA3OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/ParticipationService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMDozMjoyNVrOHWLSlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMjowODowNlrOHWOERg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAxNTcwMQ==", "bodyText": "I'd rather return an optional so the caller knows that he has to check whether a value is present", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493015701", "createdAt": "2020-09-22T20:32:25Z", "author": {"login": "kloessst"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ParticipationService.java", "diffHunk": "@@ -1234,6 +1301,33 @@ private boolean userHasPermissions(StudentParticipation participation) {\n         return studentParticipationRepository.findByStudentIdAndIndividualExercisesWithEagerSubmissionsResult(studentId, exercises);\n     }\n \n+    /**\n+     * Loads the test run participation for the instructor.\n+     * See {@link StudentParticipation#isTestRunParticipation()}\n+     * @param instructorId the id of the instructor\n+     * @param exercise the exercise id\n+     * @return the test run participation with submissions and results loaded\n+     */\n+    public StudentParticipation findTestRunParticipationOfInstructorForExercise(Long instructorId, Exercise exercise) {\n+        var studentParticipations = findByStudentIdAndIndividualExercisesWithEagerSubmissionsResult(instructorId, List.of(exercise));\n+        if (studentParticipations.isEmpty() || !studentParticipations.get(0).isTestRunParticipation()) {\n+            return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d189067470549910bf5be3ce6cdfd0178172a30"}, "originalPosition": 133}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA2MTE5MA==", "bodyText": "I agree. I implemented the CR.", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493061190", "createdAt": "2020-09-22T22:08:06Z", "author": {"login": "anditurdiu"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ParticipationService.java", "diffHunk": "@@ -1234,6 +1301,33 @@ private boolean userHasPermissions(StudentParticipation participation) {\n         return studentParticipationRepository.findByStudentIdAndIndividualExercisesWithEagerSubmissionsResult(studentId, exercises);\n     }\n \n+    /**\n+     * Loads the test run participation for the instructor.\n+     * See {@link StudentParticipation#isTestRunParticipation()}\n+     * @param instructorId the id of the instructor\n+     * @param exercise the exercise id\n+     * @return the test run participation with submissions and results loaded\n+     */\n+    public StudentParticipation findTestRunParticipationOfInstructorForExercise(Long instructorId, Exercise exercise) {\n+        var studentParticipations = findByStudentIdAndIndividualExercisesWithEagerSubmissionsResult(instructorId, List.of(exercise));\n+        if (studentParticipations.isEmpty() || !studentParticipations.get(0).isTestRunParticipation()) {\n+            return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAxNTcwMQ=="}, "originalCommit": {"oid": "2d189067470549910bf5be3ce6cdfd0178172a30"}, "originalPosition": 133}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NTUwMjU3OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/StudentExamService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMDo0MDoxOVrOHWLi1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMDo0MDoxOVrOHWLi1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAxOTg2Mg==", "bodyText": "te instructor -> the instructor :)", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493019862", "createdAt": "2020-09-22T20:40:19Z", "author": {"login": "kloessst"}, "path": "src/main/java/de/tum/in/www1/artemis/service/StudentExamService.java", "diffHunk": "@@ -336,4 +340,118 @@ public Integer findMaxWorkingTimeByExamId(Long examId) {\n         log.debug(\"Request to find all distinct working times for Exam : {}\", examId);\n         return studentExamRepository.findAllDistinctWorkingTimesByExamId(examId);\n     }\n+\n+    /**\n+     * Generates a Student Exam marked as a testRun for te instructor to test the exam as a student would experience it.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d189067470549910bf5be3ce6cdfd0178172a30"}, "originalPosition": 83}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NTU2MTk1OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ComplaintResource.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMDo1Nzo0MVrOHWMHnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMDo1Nzo0MVrOHWMHnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAyOTI3Ng==", "bodyText": "indicates", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493029276", "createdAt": "2020-09-22T20:57:41Z", "author": {"login": "kloessst"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ComplaintResource.java", "diffHunk": "@@ -239,7 +240,29 @@ public ComplaintResource(AuthorizationCheckService authCheckService, ExerciseSer\n         }\n \n         List<Complaint> responseComplaints = complaintService.getAllComplaintsByExerciseIdButMine(exerciseId);\n-        responseComplaints = buildComplaintsListForAssessor(responseComplaints, principal, false);\n+        responseComplaints = buildComplaintsListForAssessor(responseComplaints, principal, false, false);\n+        return ResponseEntity.ok(responseComplaints);\n+    }\n+\n+    /**\n+     * Get /exercises/:exerciseId/complaints-for-test-run-dashboard\n+     * <p>\n+     * Get all the complaints associated to a test run exercise, but filter out the ones that are not about the tutor who is doing the request, since this idicated test run exercises", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d189067470549910bf5be3ce6cdfd0178172a30"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NTU3Njk3OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ComplaintResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMTowMjowOVrOHWMQ2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMjoxMzoyNVrOHWOMRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAzMTY0MA==", "bodyText": "Could it happen for normal exercises that (student != null && assessor.getLogin().equals(student.getLogin())) evaluates to true because the assessor was the same person (e.g. for a quick testing session) and testRun is false? Might not matter in this case but I'm curios.", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493031640", "createdAt": "2020-09-22T21:02:09Z", "author": {"login": "kloessst"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ComplaintResource.java", "diffHunk": "@@ -463,8 +486,9 @@ private void filterOutUselessDataFromComplaints(List<Complaint> complaints, bool\n         complaints.forEach(complaint -> {\n             String submissorName = principal.getName();\n             User assessor = complaint.getResult().getAssessor();\n+            User student = complaint.getStudent();\n \n-            if (assessor.getLogin().equals(submissorName) == assessorSameAsCaller) {\n+            if (assessor.getLogin().equals(submissorName) == assessorSameAsCaller && (student != null && assessor.getLogin().equals(student.getLogin())) == testRun) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d189067470549910bf5be3ce6cdfd0178172a30"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA2MzIzOA==", "bodyText": "(student != null && assessor.getLogin().equals(student.getLogin())) yes as you can assess your own submissions. But for normal (not test run participations) assessorSameAsCaller is set to false\nwhich would in turn make assessor.getLogin().equals(submissorName) == assessorSameAsCaller result to false thereby falsifying the clause. There should therefore be no interference here between test run participations and normal participations", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493063238", "createdAt": "2020-09-22T22:13:25Z", "author": {"login": "anditurdiu"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ComplaintResource.java", "diffHunk": "@@ -463,8 +486,9 @@ private void filterOutUselessDataFromComplaints(List<Complaint> complaints, bool\n         complaints.forEach(complaint -> {\n             String submissorName = principal.getName();\n             User assessor = complaint.getResult().getAssessor();\n+            User student = complaint.getStudent();\n \n-            if (assessor.getLogin().equals(submissorName) == assessorSameAsCaller) {\n+            if (assessor.getLogin().equals(submissorName) == assessorSameAsCaller && (student != null && assessor.getLogin().equals(student.getLogin())) == testRun) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAzMTY0MA=="}, "originalCommit": {"oid": "2d189067470549910bf5be3ce6cdfd0178172a30"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NTU5MjMyOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ExamResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMTowNzowOFrOHWMadQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMjoxNjo0MVrOHWORNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAzNDEwMQ==", "bodyText": "Do you need this request? I don't see any additional test run logic. You could probably reuse getExamForTutorDashboard but I might be wrong", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493034101", "createdAt": "2020-09-22T21:07:08Z", "author": {"login": "kloessst"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ExamResource.java", "diffHunk": "@@ -289,7 +290,38 @@ public ExamResource(UserService userService, CourseService courseService, ExamRe\n         }\n \n         List<TutorParticipation> tutorParticipations = tutorParticipationService.findAllByCourseAndTutor(course, user);\n-        tutorDashboardService.prepareExercisesForTutorDashboard(exercises, tutorParticipations);\n+        tutorDashboardService.prepareExercisesForTutorDashboard(exercises, tutorParticipations, true);\n+\n+        return ResponseEntity.ok(exam);\n+    }\n+\n+    /**\n+     * GET /courses/:courseId/exams/:examId:for-exam-tutor-test-run-dashboard\n+     *\n+     * @param courseId the id of the course to retrieve\n+     * @param examId the id of the exam that contains the exercises\n+     * @return data about a exam test run including all exercises, plus some data for the tutor as tutor status for assessment\n+     */\n+    @GetMapping(\"/courses/{courseId}/exams/{examId}/for-exam-tutor-test-run-dashboard\")\n+    @PreAuthorize(\"hasAnyRole('INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Exam> getExamForTutorTestRunDashboard(@PathVariable long courseId, @PathVariable long examId) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d189067470549910bf5be3ce6cdfd0178172a30"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA2NDUwMA==", "bodyText": "There are differences, as only instructors can access this endpoint. We also do not check against the end date of the exam. For the normal dashboard, we throw a forbidden error, as tutors and instructors are not supposed to assess submissions before the exam is over.\nAdditionally, we do not prepare the status statistics for this call, as that is not displayed for the test run assessment dashboard.", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493064500", "createdAt": "2020-09-22T22:16:41Z", "author": {"login": "anditurdiu"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ExamResource.java", "diffHunk": "@@ -289,7 +290,38 @@ public ExamResource(UserService userService, CourseService courseService, ExamRe\n         }\n \n         List<TutorParticipation> tutorParticipations = tutorParticipationService.findAllByCourseAndTutor(course, user);\n-        tutorDashboardService.prepareExercisesForTutorDashboard(exercises, tutorParticipations);\n+        tutorDashboardService.prepareExercisesForTutorDashboard(exercises, tutorParticipations, true);\n+\n+        return ResponseEntity.ok(exam);\n+    }\n+\n+    /**\n+     * GET /courses/:courseId/exams/:examId:for-exam-tutor-test-run-dashboard\n+     *\n+     * @param courseId the id of the course to retrieve\n+     * @param examId the id of the exam that contains the exercises\n+     * @return data about a exam test run including all exercises, plus some data for the tutor as tutor status for assessment\n+     */\n+    @GetMapping(\"/courses/{courseId}/exams/{examId}/for-exam-tutor-test-run-dashboard\")\n+    @PreAuthorize(\"hasAnyRole('INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Exam> getExamForTutorTestRunDashboard(@PathVariable long courseId, @PathVariable long examId) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAzNDEwMQ=="}, "originalCommit": {"oid": "2d189067470549910bf5be3ce6cdfd0178172a30"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NTYzNTM4OnYy", "diffSide": "RIGHT", "path": "src/main/resources/config/liquibase/changelog/20200908112330_changelog.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMToyMTowNlrOHWM0-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMjoxODowOVrOHWOTZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA0MDg5MA==", "bodyText": "I would add this to the other changelog file. One changeSet is fine for these changes", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493040890", "createdAt": "2020-09-22T21:21:06Z", "author": {"login": "kloessst"}, "path": "src/main/resources/config/liquibase/changelog/20200908112330_changelog.xml", "diffHunk": "@@ -0,0 +1,8 @@\n+<?xml version=\"1.1\" encoding=\"UTF-8\" standalone=\"no\"?>\n+<databaseChangeLog xmlns=\"http://www.liquibase.org/xml/ns/dbchangelog\" xmlns:ext=\"http://www.liquibase.org/xml/ns/dbchangelog-ext\" xmlns:pro=\"http://www.liquibase.org/xml/ns/pro\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-3.9.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.9.xsd\">\n+    <changeSet author=\"turdiu\" id=\"20200908112330\">\n+        <addColumn tableName=\"student_exam\">\n+            <column name=\"test_run\" type=\"bit\" defaultValueBoolean=\"false\"/>\n+        </addColumn>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a58bdcd215649c172a124baa753bbab1cbb58194"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA2NTA2MQ==", "bodyText": "Okay, will do :)", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493065061", "createdAt": "2020-09-22T22:18:09Z", "author": {"login": "anditurdiu"}, "path": "src/main/resources/config/liquibase/changelog/20200908112330_changelog.xml", "diffHunk": "@@ -0,0 +1,8 @@\n+<?xml version=\"1.1\" encoding=\"UTF-8\" standalone=\"no\"?>\n+<databaseChangeLog xmlns=\"http://www.liquibase.org/xml/ns/dbchangelog\" xmlns:ext=\"http://www.liquibase.org/xml/ns/dbchangelog-ext\" xmlns:pro=\"http://www.liquibase.org/xml/ns/pro\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-3.9.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.9.xsd\">\n+    <changeSet author=\"turdiu\" id=\"20200908112330\">\n+        <addColumn tableName=\"student_exam\">\n+            <column name=\"test_run\" type=\"bit\" defaultValueBoolean=\"false\"/>\n+        </addColumn>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA0MDg5MA=="}, "originalCommit": {"oid": "a58bdcd215649c172a124baa753bbab1cbb58194"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NTY0Njc4OnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/exam/manage/exam-management.route.ts", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMToyNDo1N1rOHWM7-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMjoxNzoxMVrOHWOSIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA0MjY4Mg==", "bodyText": "Do we need 'ROLE_TA' here?", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493042682", "createdAt": "2020-09-22T21:24:57Z", "author": {"login": "kloessst"}, "path": "src/main/webapp/app/exam/manage/exam-management.route.ts", "diffHunk": "@@ -220,6 +223,39 @@ export const examManagementRoute: Routes = [\n         },\n         canActivate: [UserRouteAccessService],\n     },\n+    {\n+        path: ':examId/test-runs',\n+        component: TestRunManagementComponent,\n+        resolve: {\n+            exam: ExamResolve,\n+        },\n+        data: {\n+            authorities: ['ROLE_INSTRUCTOR', 'ROLE_ADMIN'],\n+            pageTitle: 'artemisApp.examManagement.title',\n+        },\n+        canActivate: [UserRouteAccessService],\n+    },\n+    {\n+        path: ':examId/test-runs/assess',\n+        component: TutorCourseDashboardComponent,\n+        data: {\n+            authorities: ['ROLE_ADMIN', 'ROLE_INSTRUCTOR', 'ROLE_TA'],", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a58bdcd215649c172a124baa753bbab1cbb58194"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA2NDczNw==", "bodyText": "No, but they would not be able to access the resources anyways. But good catch \ud83d\udc4d", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493064737", "createdAt": "2020-09-22T22:17:11Z", "author": {"login": "anditurdiu"}, "path": "src/main/webapp/app/exam/manage/exam-management.route.ts", "diffHunk": "@@ -220,6 +223,39 @@ export const examManagementRoute: Routes = [\n         },\n         canActivate: [UserRouteAccessService],\n     },\n+    {\n+        path: ':examId/test-runs',\n+        component: TestRunManagementComponent,\n+        resolve: {\n+            exam: ExamResolve,\n+        },\n+        data: {\n+            authorities: ['ROLE_INSTRUCTOR', 'ROLE_ADMIN'],\n+            pageTitle: 'artemisApp.examManagement.title',\n+        },\n+        canActivate: [UserRouteAccessService],\n+    },\n+    {\n+        path: ':examId/test-runs/assess',\n+        component: TutorCourseDashboardComponent,\n+        data: {\n+            authorities: ['ROLE_ADMIN', 'ROLE_INSTRUCTOR', 'ROLE_TA'],", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA0MjY4Mg=="}, "originalCommit": {"oid": "a58bdcd215649c172a124baa753bbab1cbb58194"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NTY1Nzg3OnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/exam/manage/test-runs/test-run-management.component.ts", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMToyODo1OFrOHWNCzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMjoyNzo0MVrOHWOhOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA0NDQyOQ==", "bodyText": "Could you just use item.id where ever this function is called?", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493044429", "createdAt": "2020-09-22T21:28:58Z", "author": {"login": "kloessst"}, "path": "src/main/webapp/app/exam/manage/test-runs/test-run-management.component.ts", "diffHunk": "@@ -0,0 +1,134 @@\n+import { Component, OnInit } from '@angular/core';\n+import { ActivatedRoute } from '@angular/router';\n+import { Course } from 'app/entities/course.model';\n+import { StudentExam } from 'app/entities/student-exam.model';\n+import { SortService } from 'app/shared/service/sort.service';\n+import { Exam } from 'app/entities/exam.model';\n+import { HttpErrorResponse, HttpResponse } from '@angular/common/http';\n+import { JhiAlertService } from 'ng-jhipster';\n+import { NgbModal, NgbModalRef } from '@ng-bootstrap/ng-bootstrap';\n+import { CreateTestRunModalComponent } from 'app/exam/manage/test-runs/create-test-run-modal.component';\n+import { ExamManagementService } from 'app/exam/manage/exam-management.service';\n+import { AccountService } from 'app/core/auth/account.service';\n+import { Subject } from 'rxjs';\n+import { User } from 'app/core/user/user.model';\n+\n+@Component({\n+    selector: 'jhi-test-run-management',\n+    templateUrl: './test-run-management.component.html',\n+})\n+export class TestRunManagementComponent implements OnInit {\n+    course: Course;\n+    exam: Exam;\n+    isLoading: boolean;\n+    isExamStarted: boolean;\n+    testRuns: StudentExam[] = [];\n+    instructor: User;\n+    private dialogErrorSource = new Subject<string>();\n+    dialogError$ = this.dialogErrorSource.asObservable();\n+    predicate: string;\n+    ascending: boolean;\n+\n+    constructor(\n+        private route: ActivatedRoute,\n+        private jhiAlertService: JhiAlertService,\n+        private examManagementService: ExamManagementService,\n+        private accountService: AccountService,\n+        private sortService: SortService,\n+        private modalService: NgbModal,\n+    ) {\n+        this.predicate = 'id';\n+        this.ascending = true;\n+    }\n+\n+    ngOnInit(): void {\n+        this.examManagementService.find(Number(this.route.snapshot.paramMap.get('courseId')), Number(this.route.snapshot.paramMap.get('examId')), false, true).subscribe(\n+            (response: HttpResponse<Exam>) => {\n+                this.exam = response.body!;\n+                this.isExamStarted = this.exam.started;\n+                this.course = this.exam.course;\n+                this.course.isAtLeastInstructor = this.accountService.isAtLeastInstructorInCourse(this.course);\n+                this.examManagementService.findAllTestRunsForExam(this.course.id, this.exam.id).subscribe(\n+                    (res) => {\n+                        this.testRuns = res.body!;\n+                    },\n+                    (err) => this.onError(err),\n+                );\n+            },\n+            (error) => this.onError(error),\n+        );\n+        this.accountService.fetch().subscribe((res) => {\n+            if (res.body != null) {\n+                this.instructor = res.body;\n+            }\n+        });\n+    }\n+\n+    /**\n+     * Open modal to configure a new test run\n+     */\n+    openCreateTestRunModal() {\n+        const modalRef: NgbModalRef = this.modalService.open(CreateTestRunModalComponent as Component, { size: 'lg', backdrop: 'static' });\n+        modalRef.componentInstance.exam = this.exam;\n+        modalRef.result\n+            .then((testRunConfiguration: StudentExam) => {\n+                this.examManagementService.createTestRun(this.course.id, this.exam.id, testRunConfiguration).subscribe(\n+                    (res) => {\n+                        if (res.body != null) {\n+                            this.testRuns.push(res.body!);\n+                        }\n+                    },\n+                    (error) => {\n+                        this.onError(error);\n+                    },\n+                );\n+            })\n+            .catch(() => {});\n+    }\n+\n+    /**\n+     * Delete the test run with the given id.\n+     * @param testRunId {number}\n+     */\n+    deleteTestRun(testRunId: number) {\n+        this.examManagementService.deleteTestRun(this.course.id, this.exam.id, testRunId).subscribe(\n+            () => {\n+                this.testRuns = this.testRuns!.filter((testRun) => testRun.id !== testRunId);\n+                this.dialogErrorSource.next('');\n+            },\n+            (error) => this.dialogErrorSource.next(error.message),\n+        );\n+    }\n+\n+    /**\n+     * Track the items on the testruns Table\n+     * @param index {number}\n+     * @param item {StudentExam}\n+     */\n+    trackId(index: number, item: StudentExam) {\n+        return item.id;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a58bdcd215649c172a124baa753bbab1cbb58194"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA2ODYwMg==", "bodyText": "This is required for the angular change detection, to track the items by id", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493068602", "createdAt": "2020-09-22T22:27:41Z", "author": {"login": "anditurdiu"}, "path": "src/main/webapp/app/exam/manage/test-runs/test-run-management.component.ts", "diffHunk": "@@ -0,0 +1,134 @@\n+import { Component, OnInit } from '@angular/core';\n+import { ActivatedRoute } from '@angular/router';\n+import { Course } from 'app/entities/course.model';\n+import { StudentExam } from 'app/entities/student-exam.model';\n+import { SortService } from 'app/shared/service/sort.service';\n+import { Exam } from 'app/entities/exam.model';\n+import { HttpErrorResponse, HttpResponse } from '@angular/common/http';\n+import { JhiAlertService } from 'ng-jhipster';\n+import { NgbModal, NgbModalRef } from '@ng-bootstrap/ng-bootstrap';\n+import { CreateTestRunModalComponent } from 'app/exam/manage/test-runs/create-test-run-modal.component';\n+import { ExamManagementService } from 'app/exam/manage/exam-management.service';\n+import { AccountService } from 'app/core/auth/account.service';\n+import { Subject } from 'rxjs';\n+import { User } from 'app/core/user/user.model';\n+\n+@Component({\n+    selector: 'jhi-test-run-management',\n+    templateUrl: './test-run-management.component.html',\n+})\n+export class TestRunManagementComponent implements OnInit {\n+    course: Course;\n+    exam: Exam;\n+    isLoading: boolean;\n+    isExamStarted: boolean;\n+    testRuns: StudentExam[] = [];\n+    instructor: User;\n+    private dialogErrorSource = new Subject<string>();\n+    dialogError$ = this.dialogErrorSource.asObservable();\n+    predicate: string;\n+    ascending: boolean;\n+\n+    constructor(\n+        private route: ActivatedRoute,\n+        private jhiAlertService: JhiAlertService,\n+        private examManagementService: ExamManagementService,\n+        private accountService: AccountService,\n+        private sortService: SortService,\n+        private modalService: NgbModal,\n+    ) {\n+        this.predicate = 'id';\n+        this.ascending = true;\n+    }\n+\n+    ngOnInit(): void {\n+        this.examManagementService.find(Number(this.route.snapshot.paramMap.get('courseId')), Number(this.route.snapshot.paramMap.get('examId')), false, true).subscribe(\n+            (response: HttpResponse<Exam>) => {\n+                this.exam = response.body!;\n+                this.isExamStarted = this.exam.started;\n+                this.course = this.exam.course;\n+                this.course.isAtLeastInstructor = this.accountService.isAtLeastInstructorInCourse(this.course);\n+                this.examManagementService.findAllTestRunsForExam(this.course.id, this.exam.id).subscribe(\n+                    (res) => {\n+                        this.testRuns = res.body!;\n+                    },\n+                    (err) => this.onError(err),\n+                );\n+            },\n+            (error) => this.onError(error),\n+        );\n+        this.accountService.fetch().subscribe((res) => {\n+            if (res.body != null) {\n+                this.instructor = res.body;\n+            }\n+        });\n+    }\n+\n+    /**\n+     * Open modal to configure a new test run\n+     */\n+    openCreateTestRunModal() {\n+        const modalRef: NgbModalRef = this.modalService.open(CreateTestRunModalComponent as Component, { size: 'lg', backdrop: 'static' });\n+        modalRef.componentInstance.exam = this.exam;\n+        modalRef.result\n+            .then((testRunConfiguration: StudentExam) => {\n+                this.examManagementService.createTestRun(this.course.id, this.exam.id, testRunConfiguration).subscribe(\n+                    (res) => {\n+                        if (res.body != null) {\n+                            this.testRuns.push(res.body!);\n+                        }\n+                    },\n+                    (error) => {\n+                        this.onError(error);\n+                    },\n+                );\n+            })\n+            .catch(() => {});\n+    }\n+\n+    /**\n+     * Delete the test run with the given id.\n+     * @param testRunId {number}\n+     */\n+    deleteTestRun(testRunId: number) {\n+        this.examManagementService.deleteTestRun(this.course.id, this.exam.id, testRunId).subscribe(\n+            () => {\n+                this.testRuns = this.testRuns!.filter((testRun) => testRun.id !== testRunId);\n+                this.dialogErrorSource.next('');\n+            },\n+            (error) => this.dialogErrorSource.next(error.message),\n+        );\n+    }\n+\n+    /**\n+     * Track the items on the testruns Table\n+     * @param index {number}\n+     * @param item {StudentExam}\n+     */\n+    trackId(index: number, item: StudentExam) {\n+        return item.id;\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA0NDQyOQ=="}, "originalCommit": {"oid": "a58bdcd215649c172a124baa753bbab1cbb58194"}, "originalPosition": 110}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NzA4OTg1OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/repository/StudentExamRepository.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwNzozMjowMVrOHWaJDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwNzo0NDoxOVrOHWanbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI1OTAyMA==", "bodyText": "Question to the naming pattern: Shouldn't these method names also include a IgnoreTestRuns, like findWithExercisesByUserIdAndExamIdIgnoreTestRuns", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493259020", "createdAt": "2020-09-23T07:32:01Z", "author": {"login": "TobiasPr"}, "path": "src/main/java/de/tum/in/www1/artemis/repository/StudentExamRepository.java", "diffHunk": "@@ -24,22 +24,41 @@\n     @EntityGraph(type = LOAD, attributePaths = { \"exercises\" })\n     Optional<StudentExam> findWithExercisesById(Long id);\n \n-    @EntityGraph(type = LOAD, attributePaths = { \"exercises\" })\n+    @Query(\"select distinct se from StudentExam se left join fetch se.exercises e where se.testRun = false and se.exam.id = :#{#examId} and se.user.id = :#{#userId} \")\n     Optional<StudentExam> findWithExercisesByUserIdAndExamId(@Param(\"userId\") long userId, @Param(\"examId\") long examId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI2Njc5OQ==", "bodyText": "I have followed the convention of distinguishing between student exams and test runs. Repository calls which return StudentExams which are test runs follow the naming: findTestRun, whereas all calls named findStudentExam.. ignore them.\nI think this makes it clearer which function to use as we want to distinguish clearly between student exams and test runs.\nThe \"IgnoreTestRuns\" is added to participations & submission calls by contrast", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493266799", "createdAt": "2020-09-23T07:44:19Z", "author": {"login": "anditurdiu"}, "path": "src/main/java/de/tum/in/www1/artemis/repository/StudentExamRepository.java", "diffHunk": "@@ -24,22 +24,41 @@\n     @EntityGraph(type = LOAD, attributePaths = { \"exercises\" })\n     Optional<StudentExam> findWithExercisesById(Long id);\n \n-    @EntityGraph(type = LOAD, attributePaths = { \"exercises\" })\n+    @Query(\"select distinct se from StudentExam se left join fetch se.exercises e where se.testRun = false and se.exam.id = :#{#examId} and se.user.id = :#{#userId} \")\n     Optional<StudentExam> findWithExercisesByUserIdAndExamId(@Param(\"userId\") long userId, @Param(\"examId\") long examId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI1OTAyMA=="}, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NzA5MTg2OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/repository/StudentExamRepository.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwNzozMjozM1rOHWaKTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwNzozMjozM1rOHWaKTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI1OTM0Mw==", "bodyText": "Same naming  pattern question here", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493259343", "createdAt": "2020-09-23T07:32:33Z", "author": {"login": "TobiasPr"}, "path": "src/main/java/de/tum/in/www1/artemis/repository/StudentExamRepository.java", "diffHunk": "@@ -24,22 +24,41 @@\n     @EntityGraph(type = LOAD, attributePaths = { \"exercises\" })\n     Optional<StudentExam> findWithExercisesById(Long id);\n \n-    @EntityGraph(type = LOAD, attributePaths = { \"exercises\" })\n+    @Query(\"select distinct se from StudentExam se left join fetch se.exercises e where se.testRun = false and se.exam.id = :#{#examId} and se.user.id = :#{#userId} \")\n     Optional<StudentExam> findWithExercisesByUserIdAndExamId(@Param(\"userId\") long userId, @Param(\"examId\") long examId);\n \n-    List<StudentExam> findByExamId(Long examId);\n+    @Query(\"select distinct se from StudentExam se left join fetch se.exercises e left join fetch e.studentParticipations sp left join fetch sp.submissions s where se.id = :#{#studentExamId} and sp.student.id = :#{#studentId} and se.testRun = :#{#testRun}\")\n+    Optional<StudentExam> findWithExercisesParticipationsSubmissionsByIdForUser(@Param(\"studentExamId\") Long studentExamId, @Param(\"studentId\") Long studentId,\n+            @Param(\"testRun\") boolean testRun);\n+\n+    @Query(\"select distinct se from StudentExam se left join fetch se.exercises e left join fetch e.studentParticipations sp left join fetch sp.submissions s where se.id = :#{#studentExamId} and se.testRun = :#{#testRun}\")\n+    Optional<StudentExam> findWithExercisesParticipationsSubmissionsById(@Param(\"studentExamId\") Long studentExamId, @Param(\"testRun\") boolean testRun);\n+\n+    @Query(\"select se from StudentExam se where se.exam.id = :#{#examId} and se.testRun = false\")\n+    List<StudentExam> findByExamId(@Param(\"examId\") Long examId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NzE0MTk4OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/repository/StudentExamRepository.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwNzo0NDozNVrOHWaoBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwNzo0NDozNVrOHWaoBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI2Njk1MA==", "bodyText": "Same naming pattern question here", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493266950", "createdAt": "2020-09-23T07:44:35Z", "author": {"login": "TobiasPr"}, "path": "src/main/java/de/tum/in/www1/artemis/repository/StudentExamRepository.java", "diffHunk": "@@ -24,22 +24,41 @@\n     @EntityGraph(type = LOAD, attributePaths = { \"exercises\" })\n     Optional<StudentExam> findWithExercisesById(Long id);\n \n-    @EntityGraph(type = LOAD, attributePaths = { \"exercises\" })\n+    @Query(\"select distinct se from StudentExam se left join fetch se.exercises e where se.testRun = false and se.exam.id = :#{#examId} and se.user.id = :#{#userId} \")\n     Optional<StudentExam> findWithExercisesByUserIdAndExamId(@Param(\"userId\") long userId, @Param(\"examId\") long examId);\n \n-    List<StudentExam> findByExamId(Long examId);\n+    @Query(\"select distinct se from StudentExam se left join fetch se.exercises e left join fetch e.studentParticipations sp left join fetch sp.submissions s where se.id = :#{#studentExamId} and sp.student.id = :#{#studentId} and se.testRun = :#{#testRun}\")\n+    Optional<StudentExam> findWithExercisesParticipationsSubmissionsByIdForUser(@Param(\"studentExamId\") Long studentExamId, @Param(\"studentId\") Long studentId,\n+            @Param(\"testRun\") boolean testRun);\n+\n+    @Query(\"select distinct se from StudentExam se left join fetch se.exercises e left join fetch e.studentParticipations sp left join fetch sp.submissions s where se.id = :#{#studentExamId} and se.testRun = :#{#testRun}\")\n+    Optional<StudentExam> findWithExercisesParticipationsSubmissionsById(@Param(\"studentExamId\") Long studentExamId, @Param(\"testRun\") boolean testRun);\n+\n+    @Query(\"select se from StudentExam se where se.exam.id = :#{#examId} and se.testRun = false\")\n+    List<StudentExam> findByExamId(@Param(\"examId\") Long examId);\n+\n+    @Query(\"select se from StudentExam se where se.exam.id = :#{#examId} and se.testRun = true\")\n+    List<StudentExam> findAllTestRunsByExamId(@Param(\"examId\") Long examId);\n \n-    Optional<StudentExam> findByExamIdAndUserId(Long examId, Long userId);\n+    @Query(\"select distinct se from StudentExam se left join fetch se.exercises e left join fetch e.studentParticipations sp left join fetch sp.submissions s left join fetch s.result r left join fetch r.assessor a where se.exam.id = :#{#examId} and se.testRun = true and se.user.id = sp.student.id\")\n+    List<StudentExam> findAllTestRunsWithExercisesParticipationsSubmissionsResultsByExamId(@Param(\"examId\") Long examId);\n \n-    @Query(\"select distinct se from StudentExam se left join se.exercises e where e.id = :#{#exerciseId} and se.user.id = :#{#userId}\")\n+    @Query(\"select distinct se from StudentExam se left join fetch se.exercises e where se.exam.id = :#{#examId} and se.testRun = true and se.user.id = :#{#userId}\")\n+    List<StudentExam> findAllTestRunsWithExercisesByExamIdForUser(@Param(\"examId\") Long examId, @Param(\"userId\") Long userId);\n+\n+    @Query(\"select distinct se from StudentExam se where se.testRun = false and se.exam.id = :#{#examId} and se.user.id = :#{#userId} \")\n+    Optional<StudentExam> findByExamIdAndUserId(@Param(\"examId\") long examId, @Param(\"userId\") long userId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NzE0MjgyOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/repository/StudentExamRepository.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwNzo0NDo0N1rOHWaokg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwNzo0NDo0N1rOHWaokg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI2NzA5MA==", "bodyText": "Same naming pattern question here", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493267090", "createdAt": "2020-09-23T07:44:47Z", "author": {"login": "TobiasPr"}, "path": "src/main/java/de/tum/in/www1/artemis/repository/StudentExamRepository.java", "diffHunk": "@@ -24,22 +24,41 @@\n     @EntityGraph(type = LOAD, attributePaths = { \"exercises\" })\n     Optional<StudentExam> findWithExercisesById(Long id);\n \n-    @EntityGraph(type = LOAD, attributePaths = { \"exercises\" })\n+    @Query(\"select distinct se from StudentExam se left join fetch se.exercises e where se.testRun = false and se.exam.id = :#{#examId} and se.user.id = :#{#userId} \")\n     Optional<StudentExam> findWithExercisesByUserIdAndExamId(@Param(\"userId\") long userId, @Param(\"examId\") long examId);\n \n-    List<StudentExam> findByExamId(Long examId);\n+    @Query(\"select distinct se from StudentExam se left join fetch se.exercises e left join fetch e.studentParticipations sp left join fetch sp.submissions s where se.id = :#{#studentExamId} and sp.student.id = :#{#studentId} and se.testRun = :#{#testRun}\")\n+    Optional<StudentExam> findWithExercisesParticipationsSubmissionsByIdForUser(@Param(\"studentExamId\") Long studentExamId, @Param(\"studentId\") Long studentId,\n+            @Param(\"testRun\") boolean testRun);\n+\n+    @Query(\"select distinct se from StudentExam se left join fetch se.exercises e left join fetch e.studentParticipations sp left join fetch sp.submissions s where se.id = :#{#studentExamId} and se.testRun = :#{#testRun}\")\n+    Optional<StudentExam> findWithExercisesParticipationsSubmissionsById(@Param(\"studentExamId\") Long studentExamId, @Param(\"testRun\") boolean testRun);\n+\n+    @Query(\"select se from StudentExam se where se.exam.id = :#{#examId} and se.testRun = false\")\n+    List<StudentExam> findByExamId(@Param(\"examId\") Long examId);\n+\n+    @Query(\"select se from StudentExam se where se.exam.id = :#{#examId} and se.testRun = true\")\n+    List<StudentExam> findAllTestRunsByExamId(@Param(\"examId\") Long examId);\n \n-    Optional<StudentExam> findByExamIdAndUserId(Long examId, Long userId);\n+    @Query(\"select distinct se from StudentExam se left join fetch se.exercises e left join fetch e.studentParticipations sp left join fetch sp.submissions s left join fetch s.result r left join fetch r.assessor a where se.exam.id = :#{#examId} and se.testRun = true and se.user.id = sp.student.id\")\n+    List<StudentExam> findAllTestRunsWithExercisesParticipationsSubmissionsResultsByExamId(@Param(\"examId\") Long examId);\n \n-    @Query(\"select distinct se from StudentExam se left join se.exercises e where e.id = :#{#exerciseId} and se.user.id = :#{#userId}\")\n+    @Query(\"select distinct se from StudentExam se left join fetch se.exercises e where se.exam.id = :#{#examId} and se.testRun = true and se.user.id = :#{#userId}\")\n+    List<StudentExam> findAllTestRunsWithExercisesByExamIdForUser(@Param(\"examId\") Long examId, @Param(\"userId\") Long userId);\n+\n+    @Query(\"select distinct se from StudentExam se where se.testRun = false and se.exam.id = :#{#examId} and se.user.id = :#{#userId} \")\n+    Optional<StudentExam> findByExamIdAndUserId(@Param(\"examId\") long examId, @Param(\"userId\") long userId);\n+\n+    @Query(\"select distinct se from StudentExam se left join fetch se.exercises e where se.testRun = false and e.id = :#{#exerciseId} and se.user.id = :#{#userId}\")\n     Optional<StudentExam> findByExerciseIdAndUserId(@Param(\"exerciseId\") Long exerciseId, @Param(\"userId\") Long userId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NzE0ODg5OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/repository/StudentExamRepository.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwNzo0NjoxNVrOHWasJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwNzo0NjoxNVrOHWasJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI2ODAwNQ==", "bodyText": "Same naming pattern question here", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493268005", "createdAt": "2020-09-23T07:46:15Z", "author": {"login": "TobiasPr"}, "path": "src/main/java/de/tum/in/www1/artemis/repository/StudentExamRepository.java", "diffHunk": "@@ -24,22 +24,41 @@\n     @EntityGraph(type = LOAD, attributePaths = { \"exercises\" })\n     Optional<StudentExam> findWithExercisesById(Long id);\n \n-    @EntityGraph(type = LOAD, attributePaths = { \"exercises\" })\n+    @Query(\"select distinct se from StudentExam se left join fetch se.exercises e where se.testRun = false and se.exam.id = :#{#examId} and se.user.id = :#{#userId} \")\n     Optional<StudentExam> findWithExercisesByUserIdAndExamId(@Param(\"userId\") long userId, @Param(\"examId\") long examId);\n \n-    List<StudentExam> findByExamId(Long examId);\n+    @Query(\"select distinct se from StudentExam se left join fetch se.exercises e left join fetch e.studentParticipations sp left join fetch sp.submissions s where se.id = :#{#studentExamId} and sp.student.id = :#{#studentId} and se.testRun = :#{#testRun}\")\n+    Optional<StudentExam> findWithExercisesParticipationsSubmissionsByIdForUser(@Param(\"studentExamId\") Long studentExamId, @Param(\"studentId\") Long studentId,\n+            @Param(\"testRun\") boolean testRun);\n+\n+    @Query(\"select distinct se from StudentExam se left join fetch se.exercises e left join fetch e.studentParticipations sp left join fetch sp.submissions s where se.id = :#{#studentExamId} and se.testRun = :#{#testRun}\")\n+    Optional<StudentExam> findWithExercisesParticipationsSubmissionsById(@Param(\"studentExamId\") Long studentExamId, @Param(\"testRun\") boolean testRun);\n+\n+    @Query(\"select se from StudentExam se where se.exam.id = :#{#examId} and se.testRun = false\")\n+    List<StudentExam> findByExamId(@Param(\"examId\") Long examId);\n+\n+    @Query(\"select se from StudentExam se where se.exam.id = :#{#examId} and se.testRun = true\")\n+    List<StudentExam> findAllTestRunsByExamId(@Param(\"examId\") Long examId);\n \n-    Optional<StudentExam> findByExamIdAndUserId(Long examId, Long userId);\n+    @Query(\"select distinct se from StudentExam se left join fetch se.exercises e left join fetch e.studentParticipations sp left join fetch sp.submissions s left join fetch s.result r left join fetch r.assessor a where se.exam.id = :#{#examId} and se.testRun = true and se.user.id = sp.student.id\")\n+    List<StudentExam> findAllTestRunsWithExercisesParticipationsSubmissionsResultsByExamId(@Param(\"examId\") Long examId);\n \n-    @Query(\"select distinct se from StudentExam se left join se.exercises e where e.id = :#{#exerciseId} and se.user.id = :#{#userId}\")\n+    @Query(\"select distinct se from StudentExam se left join fetch se.exercises e where se.exam.id = :#{#examId} and se.testRun = true and se.user.id = :#{#userId}\")\n+    List<StudentExam> findAllTestRunsWithExercisesByExamIdForUser(@Param(\"examId\") Long examId, @Param(\"userId\") Long userId);\n+\n+    @Query(\"select distinct se from StudentExam se where se.testRun = false and se.exam.id = :#{#examId} and se.user.id = :#{#userId} \")\n+    Optional<StudentExam> findByExamIdAndUserId(@Param(\"examId\") long examId, @Param(\"userId\") long userId);\n+\n+    @Query(\"select distinct se from StudentExam se left join fetch se.exercises e where se.testRun = false and e.id = :#{#exerciseId} and se.user.id = :#{#userId}\")\n     Optional<StudentExam> findByExerciseIdAndUserId(@Param(\"exerciseId\") Long exerciseId, @Param(\"userId\") Long userId);\n \n-    @Query(\"select max(se.workingTime) from StudentExam se where se.exam.id = :#{#examId}\")\n+    @Query(\"select max(se.workingTime) from StudentExam se where se.testRun = false and se.exam.id = :#{#examId}\")\n     Optional<Integer> findMaxWorkingTimeByExamId(@Param(\"examId\") Long examId);\n \n-    @Query(\"select distinct se.workingTime from StudentExam se where se.exam.id = :#{#examId}\")\n+    @Query(\"select distinct se.workingTime from StudentExam se where se.testRun = false and se.exam.id = :#{#examId}\")\n     Set<Integer> findAllDistinctWorkingTimesByExamId(@Param(\"examId\") Long examId);\n \n-    @Query(\"select u from StudentExam se left join se.user u where se.exam.id = :#{#examId}\")\n+    @Query(\"select distinct u from StudentExam se left join se.user u where se.testRun = false and se.exam.id = :#{#examId}\")\n     Set<User> findUsersWithStudentExamsForExam(@Param(\"examId\") Long examId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NzQ2Mzg1OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/FileUploadSubmissionService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwODo0MDo0OVrOHWd05g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwODo0MDo0OVrOHWd05g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzMxOTM5OA==", "bodyText": "examMode: personally I like Enums better for that, because it is more explicit which mode you are setting and it is easier for new developers to debug (does not require that much of domain specific knowledge, i.e. what is the contrary of examMode), just my opinion", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493319398", "createdAt": "2020-09-23T08:40:49Z", "author": {"login": "TobiasPr"}, "path": "src/main/java/de/tum/in/www1/artemis/service/FileUploadSubmissionService.java", "diffHunk": "@@ -88,11 +90,18 @@ public FileUploadSubmission handleFileUploadSubmission(FileUploadSubmission file\n      *\n      * @param exerciseId    - the id of the exercise we are interested into\n      * @param submittedOnly - if true, it returns only submission with submitted flag set to true\n+     * @param examMode - set flag to to ignore exam test run submissions\n      * @return a list of file upload submissions for the given exercise id\n      */\n     @Transactional(readOnly = true)\n-    public List<FileUploadSubmission> getFileUploadSubmissions(Long exerciseId, boolean submittedOnly) {\n-        List<StudentParticipation> participations = studentParticipationRepository.findAllWithEagerSubmissionsAndEagerResultsAndEagerAssessorByExerciseId(exerciseId);\n+    public List<FileUploadSubmission> getFileUploadSubmissions(Long exerciseId, boolean submittedOnly, boolean examMode) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NzUyMDM1OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/FileUploadSubmissionService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwODo1MDoxOFrOHWeZiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNToyMzowM1rOHWz_WQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzMyODc3Ng==", "bodyText": "why do we filter TestRunParticipations here when we have the if else above?", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493328776", "createdAt": "2020-09-23T08:50:18Z", "author": {"login": "TobiasPr"}, "path": "src/main/java/de/tum/in/www1/artemis/service/FileUploadSubmissionService.java", "diffHunk": "@@ -106,28 +115,47 @@ public FileUploadSubmission handleFileUploadSubmission(FileUploadSubmission file\n      *\n      * @param exerciseId - the id of the exercise we are looking for\n      * @param tutor - the tutor we are interested in\n+     * @param examMode - flag should be set to ignore the test run submissions\n      * @return a list of file upload Submissions\n      */\n-    public List<FileUploadSubmission> getAllFileUploadSubmissionsAssessedByTutorForExercise(Long exerciseId, User tutor) {\n-        List<Submission> submissions = this.submissionRepository.findAllByParticipationExerciseIdAndResultAssessor(exerciseId, tutor);\n+    public List<FileUploadSubmission> getAllFileUploadSubmissionsAssessedByTutorForExercise(Long exerciseId, User tutor, boolean examMode) {\n+        List<Submission> submissions;\n+        if (examMode) {\n+            var participations = this.studentParticipationRepository.findAllByParticipationExerciseIdAndResultAssessorIgnoreTestRuns(exerciseId, tutor);\n+            submissions = participations.stream().filter(studentParticipation -> studentParticipation.findLatestSubmission().isPresent())\n+                    .map(StudentParticipation::findLatestSubmission).map(Optional::get).collect(toList());\n+        }\n+        else {\n+            submissions = this.submissionRepository.findAllByParticipationExerciseIdAndResultAssessor(exerciseId, tutor);\n+        }\n         return submissions.stream().map(submission -> {\n             submission.getResult().setSubmission(null);\n             return (FileUploadSubmission) submission;\n         }).collect(Collectors.toList());\n     }\n \n     /**\n-     * Given an exercise id, find a random file upload submission for that exercise which still doesn't have any manual result. No manual result means that no user has started an\n-     * assessment for the corresponding submission yet.\n+     * Given an exercise id, find a random file upload submission for that exercise which still doesn't have any manual result.\n+     * No manual result means that no user has started an assessment for the corresponding submission yet.\n+     * For exam exercises we should also remove the test run participations as these should not be graded by the tutors.\n      *\n      * @param fileUploadExercise the exercise for which we want to retrieve a submission without manual result\n+     * @param removeTestRunParticipations flag to determine if test runs should be removed. This should be set to true for exam exercises\n      * @return a fileUploadSubmission without any manual result or an empty Optional if no submission without manual result could be found\n      */\n     @Transactional(readOnly = true)\n-    public Optional<FileUploadSubmission> getFileUploadSubmissionWithoutManualResult(FileUploadExercise fileUploadExercise) {\n+    public Optional<FileUploadSubmission> getRandomFileUploadSubmissionEligibleForNewAssessment(FileUploadExercise fileUploadExercise, boolean removeTestRunParticipations) {\n         Random random = new Random();\n-        var participations = participationService.findByExerciseIdWithLatestSubmissionWithoutManualResults(fileUploadExercise.getId());\n-        var submissionsWithoutResult = participations.stream().map(StudentParticipation::findLatestSubmission).filter(Optional::isPresent).map(Optional::get)\n+        List<StudentParticipation> participations;\n+        if (removeTestRunParticipations) {\n+            participations = participationService.findByExerciseIdWithLatestSubmissionWithoutManualResultsAndNoTestRun(fileUploadExercise.getId());\n+        }\n+        else {\n+            participations = participationService.findByExerciseIdWithLatestSubmissionWithoutManualResults(fileUploadExercise.getId());\n+        }\n+\n+        List<FileUploadSubmission> submissionsWithoutResult = participations.stream().filter(studentParticipation -> !studentParticipation.isTestRunParticipation())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY4MjUyMQ==", "bodyText": "This was left over code, i removed it. Nice catch :)", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493682521", "createdAt": "2020-09-23T15:23:03Z", "author": {"login": "anditurdiu"}, "path": "src/main/java/de/tum/in/www1/artemis/service/FileUploadSubmissionService.java", "diffHunk": "@@ -106,28 +115,47 @@ public FileUploadSubmission handleFileUploadSubmission(FileUploadSubmission file\n      *\n      * @param exerciseId - the id of the exercise we are looking for\n      * @param tutor - the tutor we are interested in\n+     * @param examMode - flag should be set to ignore the test run submissions\n      * @return a list of file upload Submissions\n      */\n-    public List<FileUploadSubmission> getAllFileUploadSubmissionsAssessedByTutorForExercise(Long exerciseId, User tutor) {\n-        List<Submission> submissions = this.submissionRepository.findAllByParticipationExerciseIdAndResultAssessor(exerciseId, tutor);\n+    public List<FileUploadSubmission> getAllFileUploadSubmissionsAssessedByTutorForExercise(Long exerciseId, User tutor, boolean examMode) {\n+        List<Submission> submissions;\n+        if (examMode) {\n+            var participations = this.studentParticipationRepository.findAllByParticipationExerciseIdAndResultAssessorIgnoreTestRuns(exerciseId, tutor);\n+            submissions = participations.stream().filter(studentParticipation -> studentParticipation.findLatestSubmission().isPresent())\n+                    .map(StudentParticipation::findLatestSubmission).map(Optional::get).collect(toList());\n+        }\n+        else {\n+            submissions = this.submissionRepository.findAllByParticipationExerciseIdAndResultAssessor(exerciseId, tutor);\n+        }\n         return submissions.stream().map(submission -> {\n             submission.getResult().setSubmission(null);\n             return (FileUploadSubmission) submission;\n         }).collect(Collectors.toList());\n     }\n \n     /**\n-     * Given an exercise id, find a random file upload submission for that exercise which still doesn't have any manual result. No manual result means that no user has started an\n-     * assessment for the corresponding submission yet.\n+     * Given an exercise id, find a random file upload submission for that exercise which still doesn't have any manual result.\n+     * No manual result means that no user has started an assessment for the corresponding submission yet.\n+     * For exam exercises we should also remove the test run participations as these should not be graded by the tutors.\n      *\n      * @param fileUploadExercise the exercise for which we want to retrieve a submission without manual result\n+     * @param removeTestRunParticipations flag to determine if test runs should be removed. This should be set to true for exam exercises\n      * @return a fileUploadSubmission without any manual result or an empty Optional if no submission without manual result could be found\n      */\n     @Transactional(readOnly = true)\n-    public Optional<FileUploadSubmission> getFileUploadSubmissionWithoutManualResult(FileUploadExercise fileUploadExercise) {\n+    public Optional<FileUploadSubmission> getRandomFileUploadSubmissionEligibleForNewAssessment(FileUploadExercise fileUploadExercise, boolean removeTestRunParticipations) {\n         Random random = new Random();\n-        var participations = participationService.findByExerciseIdWithLatestSubmissionWithoutManualResults(fileUploadExercise.getId());\n-        var submissionsWithoutResult = participations.stream().map(StudentParticipation::findLatestSubmission).filter(Optional::isPresent).map(Optional::get)\n+        List<StudentParticipation> participations;\n+        if (removeTestRunParticipations) {\n+            participations = participationService.findByExerciseIdWithLatestSubmissionWithoutManualResultsAndNoTestRun(fileUploadExercise.getId());\n+        }\n+        else {\n+            participations = participationService.findByExerciseIdWithLatestSubmissionWithoutManualResults(fileUploadExercise.getId());\n+        }\n+\n+        List<FileUploadSubmission> submissionsWithoutResult = participations.stream().filter(studentParticipation -> !studentParticipation.isTestRunParticipation())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzMyODc3Ng=="}, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 79}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4ODQ5ODEwOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/ComplaintService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMTo0NjozMlrOHWoVOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxODowMDo1NlrOHW6R4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ5MTUxMw==", "bodyText": "examTestRun can be defined within the if block.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        examTestRun = instructors.stream().anyMatch(instructor -> instructor.getLogin().equals(principal.getName()));\n          \n          \n            \n                        boolean examTestRun = instructors.stream().anyMatch(instructor -> instructor.getLogin().equals(principal.getName()));", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493491513", "createdAt": "2020-09-23T11:46:32Z", "author": {"login": "jpbernius"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ComplaintService.java", "diffHunk": "@@ -64,10 +67,13 @@ public Complaint createComplaint(Complaint complaint, OptionalLong examId, Princ\n         StudentParticipation studentParticipation = (StudentParticipation) originalResult.getParticipation();\n         Participant participant = studentParticipation.getParticipant(); // Team or Student\n         Long courseId = studentParticipation.getExercise().getCourseViaExerciseGroupOrCourseMember().getId();\n+        boolean examTestRun;\n \n         if (examId.isPresent()) {\n             final Exam exam = examService.findOne(examId.getAsLong());\n-            if (!isTimeOfComplaintValid(exam)) {\n+            final List<User> instructors = userService.getInstructors(exam.getCourse());\n+            examTestRun = instructors.stream().anyMatch(instructor -> instructor.getLogin().equals(principal.getName()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzc4NTU2OQ==", "bodyText": "See 69acec4", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493785569", "createdAt": "2020-09-23T18:00:56Z", "author": {"login": "anditurdiu"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ComplaintService.java", "diffHunk": "@@ -64,10 +67,13 @@ public Complaint createComplaint(Complaint complaint, OptionalLong examId, Princ\n         StudentParticipation studentParticipation = (StudentParticipation) originalResult.getParticipation();\n         Participant participant = studentParticipation.getParticipant(); // Team or Student\n         Long courseId = studentParticipation.getExercise().getCourseViaExerciseGroupOrCourseMember().getId();\n+        boolean examTestRun;\n \n         if (examId.isPresent()) {\n             final Exam exam = examService.findOne(examId.getAsLong());\n-            if (!isTimeOfComplaintValid(exam)) {\n+            final List<User> instructors = userService.getInstructors(exam.getCourse());\n+            examTestRun = instructors.stream().anyMatch(instructor -> instructor.getLogin().equals(principal.getName()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ5MTUxMw=="}, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4ODQ5OTg1OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/ComplaintService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMTo0Njo0OVrOHWoWRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxODowMToyNVrOHW6TBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ5MTc4MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    boolean examTestRun;", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493491780", "createdAt": "2020-09-23T11:46:49Z", "author": {"login": "jpbernius"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ComplaintService.java", "diffHunk": "@@ -64,10 +67,13 @@ public Complaint createComplaint(Complaint complaint, OptionalLong examId, Princ\n         StudentParticipation studentParticipation = (StudentParticipation) originalResult.getParticipation();\n         Participant participant = studentParticipation.getParticipant(); // Team or Student\n         Long courseId = studentParticipation.getExercise().getCourseViaExerciseGroupOrCourseMember().getId();\n+        boolean examTestRun;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzc4NTg2Mg==", "bodyText": "69acec4", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493785862", "createdAt": "2020-09-23T18:01:25Z", "author": {"login": "anditurdiu"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ComplaintService.java", "diffHunk": "@@ -64,10 +67,13 @@ public Complaint createComplaint(Complaint complaint, OptionalLong examId, Princ\n         StudentParticipation studentParticipation = (StudentParticipation) originalResult.getParticipation();\n         Participant participant = studentParticipation.getParticipant(); // Team or Student\n         Long courseId = studentParticipation.getExercise().getCourseViaExerciseGroupOrCourseMember().getId();\n+        boolean examTestRun;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ5MTc4MA=="}, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4ODU1OTkyOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/ExamSubmissionService.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMTo1Njo1MFrOHWo7pg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxODowMTo1MVrOHW6T_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUwMTM1MA==", "bodyText": "Is this done here for performance reasons?\nPlease add a short comment to describe why this is one in a catch block instead of doing this beforehand.", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493501350", "createdAt": "2020-09-23T11:56:50Z", "author": {"login": "jpbernius"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ExamSubmissionService.java", "diffHunk": "@@ -62,7 +67,16 @@ public boolean isAllowedToSubmit(Exercise exercise, User user) {\n         if (isExamSubmission(exercise)) {\n             // Get the student exam if it was not passed to the function\n             Exam exam = exercise.getExerciseGroup().getExam();\n-            StudentExam studentExam = studentExamService.findOneWithExercisesByUserIdAndExamId(user.getId(), exam.getId());\n+            StudentExam studentExam;\n+            try {\n+                studentExam = studentExamService.findOneWithExercisesByUserIdAndExamId(user.getId(), exam.getId());\n+            }\n+            catch (EntityNotFoundException entityNotFoundException) {\n+                if (!isExamTestRunSubmission(exercise, user, exam)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzczMTY3Mg==", "bodyText": "Yes, this is done for performance reasons, as this will be called every 20 seconds for every exercise during an exam. We do not need to make an extra database call here 99.9% of the time. I will add it as a comment", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493731672", "createdAt": "2020-09-23T16:32:48Z", "author": {"login": "anditurdiu"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ExamSubmissionService.java", "diffHunk": "@@ -62,7 +67,16 @@ public boolean isAllowedToSubmit(Exercise exercise, User user) {\n         if (isExamSubmission(exercise)) {\n             // Get the student exam if it was not passed to the function\n             Exam exam = exercise.getExerciseGroup().getExam();\n-            StudentExam studentExam = studentExamService.findOneWithExercisesByUserIdAndExamId(user.getId(), exam.getId());\n+            StudentExam studentExam;\n+            try {\n+                studentExam = studentExamService.findOneWithExercisesByUserIdAndExamId(user.getId(), exam.getId());\n+            }\n+            catch (EntityNotFoundException entityNotFoundException) {\n+                if (!isExamTestRunSubmission(exercise, user, exam)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUwMTM1MA=="}, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzc4NjEwOA==", "bodyText": "See 8fb42cc", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493786108", "createdAt": "2020-09-23T18:01:51Z", "author": {"login": "anditurdiu"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ExamSubmissionService.java", "diffHunk": "@@ -62,7 +67,16 @@ public boolean isAllowedToSubmit(Exercise exercise, User user) {\n         if (isExamSubmission(exercise)) {\n             // Get the student exam if it was not passed to the function\n             Exam exam = exercise.getExerciseGroup().getExam();\n-            StudentExam studentExam = studentExamService.findOneWithExercisesByUserIdAndExamId(user.getId(), exam.getId());\n+            StudentExam studentExam;\n+            try {\n+                studentExam = studentExamService.findOneWithExercisesByUserIdAndExamId(user.getId(), exam.getId());\n+            }\n+            catch (EntityNotFoundException entityNotFoundException) {\n+                if (!isExamTestRunSubmission(exercise, user, exam)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUwMTM1MA=="}, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4ODU2ODIwOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/ExamSubmissionService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMTo1ODoxNlrOHWpA5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNjozNjoyOVrOHW3IfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUwMjY5Mg==", "bodyText": "Should we reuse the existing method for this check here? (The one usually used in REST Resources?)", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493502692", "createdAt": "2020-09-23T11:58:16Z", "author": {"login": "jpbernius"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ExamSubmissionService.java", "diffHunk": "@@ -80,6 +94,28 @@ public boolean isAllowedToSubmit(Exercise exercise, User user) {\n         return true;\n     }\n \n+    /**\n+     * Check if the submission is made as part of a test run exam\n+     * Only Instructors have access to test runs.\n+     * @param exercise the exercise\n+     * @param user the user\n+     * @param exam the exam\n+     * @return returns whether the submission is part of a test run exam.\n+     */\n+    private boolean isExamTestRunSubmission(Exercise exercise, User user, Exam exam) {\n+        // Check if user is an instructor or admin\n+        if (user.getGroups().contains(exam.getCourse().getInstructorGroupName()) || authorizationCheckService.isAdmin(user)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzczNDAxMg==", "bodyText": "The isTestRunParticipation is more general as it only checks for the general requirements of a test run participation. Here we also check that the submission we are trying to save is part of the current user's test run. Hence the \"isExamTestRunSubmission\". Maybe I should change the name?", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493734012", "createdAt": "2020-09-23T16:36:29Z", "author": {"login": "anditurdiu"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ExamSubmissionService.java", "diffHunk": "@@ -80,6 +94,28 @@ public boolean isAllowedToSubmit(Exercise exercise, User user) {\n         return true;\n     }\n \n+    /**\n+     * Check if the submission is made as part of a test run exam\n+     * Only Instructors have access to test runs.\n+     * @param exercise the exercise\n+     * @param user the user\n+     * @param exam the exam\n+     * @return returns whether the submission is part of a test run exam.\n+     */\n+    private boolean isExamTestRunSubmission(Exercise exercise, User user, Exam exam) {\n+        // Check if user is an instructor or admin\n+        if (user.getGroups().contains(exam.getCourse().getInstructorGroupName()) || authorizationCheckService.isAdmin(user)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUwMjY5Mg=="}, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4ODU3ODc3OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/ExamSubmissionService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMjowMDoxMFrOHWpHbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNjozNzo1NVrOHW3L2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUwNDM2NA==", "bodyText": "Could this be simplified using .anyMatch()?", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493504364", "createdAt": "2020-09-23T12:00:10Z", "author": {"login": "jpbernius"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ExamSubmissionService.java", "diffHunk": "@@ -80,6 +94,28 @@ public boolean isAllowedToSubmit(Exercise exercise, User user) {\n         return true;\n     }\n \n+    /**\n+     * Check if the submission is made as part of a test run exam\n+     * Only Instructors have access to test runs.\n+     * @param exercise the exercise\n+     * @param user the user\n+     * @param exam the exam\n+     * @return returns whether the submission is part of a test run exam.\n+     */\n+    private boolean isExamTestRunSubmission(Exercise exercise, User user, Exam exam) {\n+        // Check if user is an instructor or admin\n+        if (user.getGroups().contains(exam.getCourse().getInstructorGroupName()) || authorizationCheckService.isAdmin(user)) {\n+            // fetch all testRuns for the instructor\n+            List<StudentExam> testRuns = studentExamService.findAllTestRunsWithExercisesForUser(exam.getId(), user.getId());\n+            // count the test runs which contain this exercise\n+            final long numberOfTestRunsContainingExercise = testRuns.stream().filter(testRun -> testRun.getExercises().contains(exercise)).count();\n+            // if a test run contains the exercise, then the instructor is allowed to submit\n+            return numberOfTestRunsContainingExercise > 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzczNDg3Mw==", "bodyText": "Indeed, see 8fb42cc", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493734873", "createdAt": "2020-09-23T16:37:55Z", "author": {"login": "anditurdiu"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ExamSubmissionService.java", "diffHunk": "@@ -80,6 +94,28 @@ public boolean isAllowedToSubmit(Exercise exercise, User user) {\n         return true;\n     }\n \n+    /**\n+     * Check if the submission is made as part of a test run exam\n+     * Only Instructors have access to test runs.\n+     * @param exercise the exercise\n+     * @param user the user\n+     * @param exam the exam\n+     * @return returns whether the submission is part of a test run exam.\n+     */\n+    private boolean isExamTestRunSubmission(Exercise exercise, User user, Exam exam) {\n+        // Check if user is an instructor or admin\n+        if (user.getGroups().contains(exam.getCourse().getInstructorGroupName()) || authorizationCheckService.isAdmin(user)) {\n+            // fetch all testRuns for the instructor\n+            List<StudentExam> testRuns = studentExamService.findAllTestRunsWithExercisesForUser(exam.getId(), user.getId());\n+            // count the test runs which contain this exercise\n+            final long numberOfTestRunsContainingExercise = testRuns.stream().filter(testRun -> testRun.getExercises().contains(exercise)).count();\n+            // if a test run contains the exercise, then the instructor is allowed to submit\n+            return numberOfTestRunsContainingExercise > 0;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUwNDM2NA=="}, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4ODYyMjU5OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/FileUploadSubmissionService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMjowODowN1rOHWpixA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMjowODowN1rOHWpixA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUxMTM2NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        submissions = participations.stream().filter(studentParticipation -> studentParticipation.findLatestSubmission().isPresent())\n          \n          \n            \n                                .map(StudentParticipation::findLatestSubmission).map(Optional::get).collect(toList());\n          \n          \n            \n                        submissions = participations.stream().map(StudentParticipation::findLatestSubmission)\n          \n          \n            \n                                .filter(Optional::isPresent).map(Optional::get).collect(toList());", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493511364", "createdAt": "2020-09-23T12:08:07Z", "author": {"login": "jpbernius"}, "path": "src/main/java/de/tum/in/www1/artemis/service/FileUploadSubmissionService.java", "diffHunk": "@@ -106,28 +115,47 @@ public FileUploadSubmission handleFileUploadSubmission(FileUploadSubmission file\n      *\n      * @param exerciseId - the id of the exercise we are looking for\n      * @param tutor - the tutor we are interested in\n+     * @param examMode - flag should be set to ignore the test run submissions\n      * @return a list of file upload Submissions\n      */\n-    public List<FileUploadSubmission> getAllFileUploadSubmissionsAssessedByTutorForExercise(Long exerciseId, User tutor) {\n-        List<Submission> submissions = this.submissionRepository.findAllByParticipationExerciseIdAndResultAssessor(exerciseId, tutor);\n+    public List<FileUploadSubmission> getAllFileUploadSubmissionsAssessedByTutorForExercise(Long exerciseId, User tutor, boolean examMode) {\n+        List<Submission> submissions;\n+        if (examMode) {\n+            var participations = this.studentParticipationRepository.findAllByParticipationExerciseIdAndResultAssessorIgnoreTestRuns(exerciseId, tutor);\n+            submissions = participations.stream().filter(studentParticipation -> studentParticipation.findLatestSubmission().isPresent())\n+                    .map(StudentParticipation::findLatestSubmission).map(Optional::get).collect(toList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4ODY3OTI1OnYy", "diffSide": "RIGHT", "path": "src/test/java/de/tum/in/www1/artemis/util/DatabaseUtilService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMjoxODoyMFrOHWqF7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNToyMzoxOVrOHW0AJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUyMDM2Nw==", "bodyText": "Unused Import! Should be removed", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493520367", "createdAt": "2020-09-23T12:18:20Z", "author": {"login": "stefanwaldhauser"}, "path": "src/test/java/de/tum/in/www1/artemis/util/DatabaseUtilService.java", "diffHunk": "@@ -29,6 +29,7 @@\n import org.springframework.security.test.context.TestSecurityContextHolder;\n import org.springframework.stereotype.Service;\n import org.springframework.util.ResourceUtils;\n+import org.w3c.dom.Text;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "778f8e54a5670a2b8ab206603cfd920c547ebd4a"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY4MjcyNg==", "bodyText": "Is Removed :)", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493682726", "createdAt": "2020-09-23T15:23:19Z", "author": {"login": "anditurdiu"}, "path": "src/test/java/de/tum/in/www1/artemis/util/DatabaseUtilService.java", "diffHunk": "@@ -29,6 +29,7 @@\n import org.springframework.security.test.context.TestSecurityContextHolder;\n import org.springframework.stereotype.Service;\n import org.springframework.util.ResourceUtils;\n+import org.w3c.dom.Text;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUyMDM2Nw=="}, "originalCommit": {"oid": "778f8e54a5670a2b8ab206603cfd920c547ebd4a"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4ODY5MjI5OnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/exercises/shared/dashboards/tutor/tutor-exercise-dashboard.component.ts", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMjoyMDozNVrOHWqOAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNToyMzoyNFrOHW0AWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUyMjQzNA==", "bodyText": "This looks weird! Please fix this", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493522434", "createdAt": "2020-09-23T12:20:35Z", "author": {"login": "stefanwaldhauser"}, "path": "src/main/webapp/app/exercises/shared/dashboards/tutor/tutor-exercise-dashboard.component.ts", "diffHunk": "@@ -131,6 +134,7 @@ export class TutorExerciseDashboardComponent implements OnInit, AfterViewInit {\n     ngOnInit(): void {\n         this.exerciseId = Number(this.route.snapshot.paramMap.get('exerciseId'));\n         this.courseId = Number(this.route.snapshot.paramMap.get('courseId'));\n+        this.isTestRun = this.isTestRun = this.route.snapshot.url[3]?.toString() === 'test-run-tutor-dashboard';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "778f8e54a5670a2b8ab206603cfd920c547ebd4a"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY4Mjc3Ng==", "bodyText": "Done", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493682776", "createdAt": "2020-09-23T15:23:24Z", "author": {"login": "anditurdiu"}, "path": "src/main/webapp/app/exercises/shared/dashboards/tutor/tutor-exercise-dashboard.component.ts", "diffHunk": "@@ -131,6 +134,7 @@ export class TutorExerciseDashboardComponent implements OnInit, AfterViewInit {\n     ngOnInit(): void {\n         this.exerciseId = Number(this.route.snapshot.paramMap.get('exerciseId'));\n         this.courseId = Number(this.route.snapshot.paramMap.get('courseId'));\n+        this.isTestRun = this.isTestRun = this.route.snapshot.url[3]?.toString() === 'test-run-tutor-dashboard';", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUyMjQzNA=="}, "originalCommit": {"oid": "778f8e54a5670a2b8ab206603cfd920c547ebd4a"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4ODc2MzI3OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/ModelingSubmissionService.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMjozMjozMlrOHWq5Ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxODowMjo0NlrOHW6WQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUzMzQ5OQ==", "bodyText": "I think you have the same code for file upload also. Can you extract this into a protected method and pull it up SubmissionService?", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493533499", "createdAt": "2020-09-23T12:32:32Z", "author": {"login": "jpbernius"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ModelingSubmissionService.java", "diffHunk": "@@ -55,11 +57,18 @@ public ModelingSubmissionService(ModelingSubmissionRepository modelingSubmission\n      *\n      * @param exerciseId    - the id of the exercise we are interested into\n      * @param submittedOnly - if true, it returns only submission with submitted flag set to true\n+     * @param examMode - set flag to ignore exam test run submissions\n      * @return a list of modeling submissions for the given exercise id\n      */\n     @Transactional(readOnly = true)\n-    public List<ModelingSubmission> getModelingSubmissions(Long exerciseId, boolean submittedOnly) {\n-        List<StudentParticipation> participations = studentParticipationRepository.findAllWithEagerSubmissionsAndEagerResultsAndEagerAssessorByExerciseId(exerciseId);\n+    public List<ModelingSubmission> getModelingSubmissions(Long exerciseId, boolean submittedOnly, boolean examMode) {\n+        List<StudentParticipation> participations;\n+        if (examMode) {\n+            participations = studentParticipationRepository.findAllWithEagerSubmissionsAndEagerResultsAndEagerAssessorByExerciseIdIgnoreTestRuns(exerciseId);\n+        }\n+        else {\n+            participations = studentParticipationRepository.findAllWithEagerSubmissionsAndEagerResultsAndEagerAssessorByExerciseId(exerciseId);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUzNDc5Ng==", "bodyText": "Also, maybe there are similar cases in *SubmissionService classes with a if (examMode) else construct.", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493534796", "createdAt": "2020-09-23T12:33:54Z", "author": {"login": "jpbernius"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ModelingSubmissionService.java", "diffHunk": "@@ -55,11 +57,18 @@ public ModelingSubmissionService(ModelingSubmissionRepository modelingSubmission\n      *\n      * @param exerciseId    - the id of the exercise we are interested into\n      * @param submittedOnly - if true, it returns only submission with submitted flag set to true\n+     * @param examMode - set flag to ignore exam test run submissions\n      * @return a list of modeling submissions for the given exercise id\n      */\n     @Transactional(readOnly = true)\n-    public List<ModelingSubmission> getModelingSubmissions(Long exerciseId, boolean submittedOnly) {\n-        List<StudentParticipation> participations = studentParticipationRepository.findAllWithEagerSubmissionsAndEagerResultsAndEagerAssessorByExerciseId(exerciseId);\n+    public List<ModelingSubmission> getModelingSubmissions(Long exerciseId, boolean submittedOnly, boolean examMode) {\n+        List<StudentParticipation> participations;\n+        if (examMode) {\n+            participations = studentParticipationRepository.findAllWithEagerSubmissionsAndEagerResultsAndEagerAssessorByExerciseIdIgnoreTestRuns(exerciseId);\n+        }\n+        else {\n+            participations = studentParticipationRepository.findAllWithEagerSubmissionsAndEagerResultsAndEagerAssessorByExerciseId(exerciseId);\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUzMzQ5OQ=="}, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzc2OTY3Ng==", "bodyText": "Good point, I refactored this and the get next random submission for all submission types.", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493769676", "createdAt": "2020-09-23T17:34:42Z", "author": {"login": "anditurdiu"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ModelingSubmissionService.java", "diffHunk": "@@ -55,11 +57,18 @@ public ModelingSubmissionService(ModelingSubmissionRepository modelingSubmission\n      *\n      * @param exerciseId    - the id of the exercise we are interested into\n      * @param submittedOnly - if true, it returns only submission with submitted flag set to true\n+     * @param examMode - set flag to ignore exam test run submissions\n      * @return a list of modeling submissions for the given exercise id\n      */\n     @Transactional(readOnly = true)\n-    public List<ModelingSubmission> getModelingSubmissions(Long exerciseId, boolean submittedOnly) {\n-        List<StudentParticipation> participations = studentParticipationRepository.findAllWithEagerSubmissionsAndEagerResultsAndEagerAssessorByExerciseId(exerciseId);\n+    public List<ModelingSubmission> getModelingSubmissions(Long exerciseId, boolean submittedOnly, boolean examMode) {\n+        List<StudentParticipation> participations;\n+        if (examMode) {\n+            participations = studentParticipationRepository.findAllWithEagerSubmissionsAndEagerResultsAndEagerAssessorByExerciseIdIgnoreTestRuns(exerciseId);\n+        }\n+        else {\n+            participations = studentParticipationRepository.findAllWithEagerSubmissionsAndEagerResultsAndEagerAssessorByExerciseId(exerciseId);\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUzMzQ5OQ=="}, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzc4NjY4OA==", "bodyText": "See ad13371", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493786688", "createdAt": "2020-09-23T18:02:46Z", "author": {"login": "anditurdiu"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ModelingSubmissionService.java", "diffHunk": "@@ -55,11 +57,18 @@ public ModelingSubmissionService(ModelingSubmissionRepository modelingSubmission\n      *\n      * @param exerciseId    - the id of the exercise we are interested into\n      * @param submittedOnly - if true, it returns only submission with submitted flag set to true\n+     * @param examMode - set flag to ignore exam test run submissions\n      * @return a list of modeling submissions for the given exercise id\n      */\n     @Transactional(readOnly = true)\n-    public List<ModelingSubmission> getModelingSubmissions(Long exerciseId, boolean submittedOnly) {\n-        List<StudentParticipation> participations = studentParticipationRepository.findAllWithEagerSubmissionsAndEagerResultsAndEagerAssessorByExerciseId(exerciseId);\n+    public List<ModelingSubmission> getModelingSubmissions(Long exerciseId, boolean submittedOnly, boolean examMode) {\n+        List<StudentParticipation> participations;\n+        if (examMode) {\n+            participations = studentParticipationRepository.findAllWithEagerSubmissionsAndEagerResultsAndEagerAssessorByExerciseIdIgnoreTestRuns(exerciseId);\n+        }\n+        else {\n+            participations = studentParticipationRepository.findAllWithEagerSubmissionsAndEagerResultsAndEagerAssessorByExerciseId(exerciseId);\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUzMzQ5OQ=="}, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4ODc5MDYyOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/ModelingSubmissionService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMjozNzoxNFrOHWrKJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxODowMjo1NFrOHW6WkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUzNzgyOQ==", "bodyText": "Switch map and filter as in FileUploadSubm..\nAlso, consider pulling this up.", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493537829", "createdAt": "2020-09-23T12:37:14Z", "author": {"login": "jpbernius"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ModelingSubmissionService.java", "diffHunk": "@@ -163,10 +181,20 @@ public ModelingSubmission lockModelingSubmissionWithoutResult(ModelingExercise m\n      *\n      * @param exerciseId - the id of the exercise we are looking for\n      * @param tutor - the tutor we are interested in\n+     * @param examMode - flag should be set to ignore the test run submissions\n      * @return a list of modeling submissions\n      */\n-    public List<ModelingSubmission> getAllModelingSubmissionsAssessedByTutorForExercise(Long exerciseId, User tutor) {\n-        List<Submission> submissions = this.submissionRepository.findAllByParticipationExerciseIdAndResultAssessor(exerciseId, tutor);\n+    public List<ModelingSubmission> getAllModelingSubmissionsAssessedByTutorForExercise(Long exerciseId, User tutor, boolean examMode) {\n+        List<Submission> submissions;\n+        if (examMode) {\n+            var participations = this.studentParticipationRepository.findAllByParticipationExerciseIdAndResultAssessorIgnoreTestRuns(exerciseId, tutor);\n+            submissions = participations.stream().filter(studentParticipation -> studentParticipation.findLatestSubmission().isPresent())\n+                    .map(StudentParticipation::findLatestSubmission).map(Optional::get).collect(toList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzc4Njc2OA==", "bodyText": "See ad13371", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493786768", "createdAt": "2020-09-23T18:02:54Z", "author": {"login": "anditurdiu"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ModelingSubmissionService.java", "diffHunk": "@@ -163,10 +181,20 @@ public ModelingSubmission lockModelingSubmissionWithoutResult(ModelingExercise m\n      *\n      * @param exerciseId - the id of the exercise we are looking for\n      * @param tutor - the tutor we are interested in\n+     * @param examMode - flag should be set to ignore the test run submissions\n      * @return a list of modeling submissions\n      */\n-    public List<ModelingSubmission> getAllModelingSubmissionsAssessedByTutorForExercise(Long exerciseId, User tutor) {\n-        List<Submission> submissions = this.submissionRepository.findAllByParticipationExerciseIdAndResultAssessor(exerciseId, tutor);\n+    public List<ModelingSubmission> getAllModelingSubmissionsAssessedByTutorForExercise(Long exerciseId, User tutor, boolean examMode) {\n+        List<Submission> submissions;\n+        if (examMode) {\n+            var participations = this.studentParticipationRepository.findAllByParticipationExerciseIdAndResultAssessorIgnoreTestRuns(exerciseId, tutor);\n+            submissions = participations.stream().filter(studentParticipation -> studentParticipation.findLatestSubmission().isPresent())\n+                    .map(StudentParticipation::findLatestSubmission).map(Optional::get).collect(toList());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUzNzgyOQ=="}, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 99}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4ODk3MTU5OnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/complaints/complaint-interactions.component.ts", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMzowNzo0NFrOHWs8tQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNTozMDoxOFrOHW0VEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzU2NzE1Nw==", "bodyText": "remove console.log statement?", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493567157", "createdAt": "2020-09-23T13:07:44Z", "author": {"login": "TobiasPr"}, "path": "src/main/webapp/app/complaints/complaint-interactions.component.ts", "diffHunk": "@@ -47,6 +49,7 @@ export class ComplaintInteractionsComponent implements OnInit {\n      * Loads the number of allowed complaints and feedback requests\n      */\n     ngOnInit(): void {\n+        console.log('complaints active');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "778f8e54a5670a2b8ab206603cfd920c547ebd4a"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY4ODA4Mg==", "bodyText": "Done", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493688082", "createdAt": "2020-09-23T15:30:18Z", "author": {"login": "anditurdiu"}, "path": "src/main/webapp/app/complaints/complaint-interactions.component.ts", "diffHunk": "@@ -47,6 +49,7 @@ export class ComplaintInteractionsComponent implements OnInit {\n      * Loads the number of allowed complaints and feedback requests\n      */\n     ngOnInit(): void {\n+        console.log('complaints active');", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzU2NzE1Nw=="}, "originalCommit": {"oid": "778f8e54a5670a2b8ab206603cfd920c547ebd4a"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4OTA3NDcwOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/ParticipationService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMzoyNDo0OFrOHWt-mA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxODowNDo1OFrOHW6bFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzU4NDAyNA==", "bodyText": "Why AssessmentType.AUTOMATIC? What about AssessmentType.TEST_RUN?", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493584024", "createdAt": "2020-09-23T13:24:48Z", "author": {"login": "jpbernius"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ParticipationService.java", "diffHunk": "@@ -241,9 +241,45 @@ public StudentParticipation startExercise(Exercise exercise, Participant partici\n                 }\n             }\n         }\n-        participation = save(participation);\n+        return save(participation);\n+    }\n \n-        return participation;\n+    /**\n+     * In order to distinguish test run submissions from student exam submissions we add a manual result to the test run submissions.\n+     * We add draft assessments with the instructor as assessor to the empty submissions in order to hide them from tutors for correction.\n+     * This way the submission appears to, and can only by assessed by, the instructor who created the test run.\n+     * @param participations The test run participations\n+     */\n+    public void markSubmissionsOfTestRunParticipations(List<StudentParticipation> participations) {\n+        for (final var participation : participations) {\n+            final Exercise exercise = participation.getExercise();\n+            Submission submission;\n+            if (participation instanceof ProgrammingExerciseParticipation) {\n+                Set<Submission> programmingSubmissions = new HashSet<>(submissionRepository.findAllByParticipationId(participation.getId()));\n+                participation.setSubmissions(programmingSubmissions);\n+                initializeSubmission(participation, exercise, null);\n+                submission = participation.getSubmissions().iterator().next();\n+                // required so that the tutor dashboard statistics are calculated correctly\n+                submission.setSubmitted(true);\n+            }\n+            else {\n+                submission = participation.getSubmissions().iterator().next();\n+            }\n+            submission.setSubmissionDate(ZonedDateTime.now());\n+            // We add a result for test runs with the user set as an assessor in order to make sure it doesnt show up for assessment for the tutors\n+            if (submission.getResult() == null) {\n+                Result result = new Result();\n+                result.setSubmission(submission);\n+                submission.setResult(result);\n+                result.setParticipation(submission.getParticipation());\n+                submission.getResult().setAssessor(participation.getStudent().get());\n+                submission.getResult().setAssessmentType(AssessmentType.AUTOMATIC);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzc4NzkyNg==", "bodyText": "2705ce2", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493787926", "createdAt": "2020-09-23T18:04:58Z", "author": {"login": "anditurdiu"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ParticipationService.java", "diffHunk": "@@ -241,9 +241,45 @@ public StudentParticipation startExercise(Exercise exercise, Participant partici\n                 }\n             }\n         }\n-        participation = save(participation);\n+        return save(participation);\n+    }\n \n-        return participation;\n+    /**\n+     * In order to distinguish test run submissions from student exam submissions we add a manual result to the test run submissions.\n+     * We add draft assessments with the instructor as assessor to the empty submissions in order to hide them from tutors for correction.\n+     * This way the submission appears to, and can only by assessed by, the instructor who created the test run.\n+     * @param participations The test run participations\n+     */\n+    public void markSubmissionsOfTestRunParticipations(List<StudentParticipation> participations) {\n+        for (final var participation : participations) {\n+            final Exercise exercise = participation.getExercise();\n+            Submission submission;\n+            if (participation instanceof ProgrammingExerciseParticipation) {\n+                Set<Submission> programmingSubmissions = new HashSet<>(submissionRepository.findAllByParticipationId(participation.getId()));\n+                participation.setSubmissions(programmingSubmissions);\n+                initializeSubmission(participation, exercise, null);\n+                submission = participation.getSubmissions().iterator().next();\n+                // required so that the tutor dashboard statistics are calculated correctly\n+                submission.setSubmitted(true);\n+            }\n+            else {\n+                submission = participation.getSubmissions().iterator().next();\n+            }\n+            submission.setSubmissionDate(ZonedDateTime.now());\n+            // We add a result for test runs with the user set as an assessor in order to make sure it doesnt show up for assessment for the tutors\n+            if (submission.getResult() == null) {\n+                Result result = new Result();\n+                result.setSubmission(submission);\n+                submission.setResult(result);\n+                result.setParticipation(submission.getParticipation());\n+                submission.getResult().setAssessor(participation.getStudent().get());\n+                submission.getResult().setAssessmentType(AssessmentType.AUTOMATIC);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzU4NDAyNA=="}, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4OTkwMzIwOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/StudentExamService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNjoxMTo0NFrOHW2IYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNzoyOTowOVrOHW5HAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzcxNzYwMQ==", "bodyText": "Why is this ok as a fallback?", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493717601", "createdAt": "2020-09-23T16:11:44Z", "author": {"login": "jpbernius"}, "path": "src/main/java/de/tum/in/www1/artemis/service/StudentExamService.java", "diffHunk": "@@ -336,4 +340,118 @@ public Integer findMaxWorkingTimeByExamId(Long examId) {\n         log.debug(\"Request to find all distinct working times for Exam : {}\", examId);\n         return studentExamRepository.findAllDistinctWorkingTimesByExamId(examId);\n     }\n+\n+    /**\n+     * Generates a Student Exam marked as a testRun for the instructor to test the exam as a student would experience it.\n+     * Calls {@link StudentExamService#createTestRun and {@link ExamService#setUpTestRunExerciseParticipationsAndSubmissions}}\n+     * @param testRunConfiguration the configured studentExam\n+     * @return the created testRun studentExam\n+     */\n+    public StudentExam generateTestRun(StudentExam testRunConfiguration) {\n+        StudentExam testRun = createTestRun(testRunConfiguration);\n+        setUpTestRunExerciseParticipationsAndSubmissions(testRun.getId());\n+        return testRun;\n+    }\n+\n+    /**\n+     * Create TestRun student exam based on the configuration provided.\n+     *\n+     * @param testRunConfiguration Contains the exercises and working time for this test run\n+     * @return The created test run\n+     */\n+    private StudentExam createTestRun(StudentExam testRunConfiguration) {\n+        StudentExam testRun = new StudentExam();\n+        testRun.setExercises(testRunConfiguration.getExercises());\n+        testRun.setExam(testRunConfiguration.getExam());\n+        testRun.setWorkingTime(testRunConfiguration.getWorkingTime());\n+        testRun.setUser(userService.getUser());\n+        testRun.setTestRun(true);\n+        testRun.setSubmitted(false);\n+        testRun = studentExamRepository.save(testRun);\n+        return testRun;\n+    }\n+\n+    /**\n+     * Sets up the participations and submissions for all the exercises of the test run.\n+     * Calls {@link ExamService#setUpExerciseParticipationsAndSubmissions} to set up the exercise participations\n+     * and {@link ParticipationService#markSubmissionsOfTestRunParticipations} to mark them as test run participations\n+     *\n+     * @param testRunId the id of the TestRun\n+     */\n+    private void setUpTestRunExerciseParticipationsAndSubmissions(Long testRunId) {\n+        StudentExam testRun = studentExamRepository.findWithExercisesParticipationsSubmissionsById(testRunId, true)\n+                .orElseThrow(() -> new EntityNotFoundException(\"StudentExam with id: \\\"\" + testRunId + \"\\\" does not exist\"));\n+        List<StudentParticipation> generatedParticipations = Collections.synchronizedList(new ArrayList<>());\n+        examService.setUpExerciseParticipationsAndSubmissions(generatedParticipations, testRun);\n+        participationService.markSubmissionsOfTestRunParticipations(generatedParticipations);\n+    }\n+\n+    /**\n+     * Deletes a test run.\n+     * In case the participation is  not referenced by other test runs, the participation, submission, buildplans and repositories are deleted as well.\n+     * @param testRunId the id of the test run\n+     * @param instructorId the id of the instructor\n+     * @return the deleted test run\n+     */\n+    public StudentExam deleteTestRun(Long testRunId, Long instructorId) {\n+        StudentExam testRun = studentExamRepository.findWithExercisesParticipationsSubmissionsByIdForUser(testRunId, instructorId, true)\n+                .orElse(studentExamRepository.findWithExercisesParticipationsSubmissionsById(testRunId, true)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 136}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzc2NjQwMA==", "bodyText": "the delete functionality was refactored", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493766400", "createdAt": "2020-09-23T17:29:09Z", "author": {"login": "anditurdiu"}, "path": "src/main/java/de/tum/in/www1/artemis/service/StudentExamService.java", "diffHunk": "@@ -336,4 +340,118 @@ public Integer findMaxWorkingTimeByExamId(Long examId) {\n         log.debug(\"Request to find all distinct working times for Exam : {}\", examId);\n         return studentExamRepository.findAllDistinctWorkingTimesByExamId(examId);\n     }\n+\n+    /**\n+     * Generates a Student Exam marked as a testRun for the instructor to test the exam as a student would experience it.\n+     * Calls {@link StudentExamService#createTestRun and {@link ExamService#setUpTestRunExerciseParticipationsAndSubmissions}}\n+     * @param testRunConfiguration the configured studentExam\n+     * @return the created testRun studentExam\n+     */\n+    public StudentExam generateTestRun(StudentExam testRunConfiguration) {\n+        StudentExam testRun = createTestRun(testRunConfiguration);\n+        setUpTestRunExerciseParticipationsAndSubmissions(testRun.getId());\n+        return testRun;\n+    }\n+\n+    /**\n+     * Create TestRun student exam based on the configuration provided.\n+     *\n+     * @param testRunConfiguration Contains the exercises and working time for this test run\n+     * @return The created test run\n+     */\n+    private StudentExam createTestRun(StudentExam testRunConfiguration) {\n+        StudentExam testRun = new StudentExam();\n+        testRun.setExercises(testRunConfiguration.getExercises());\n+        testRun.setExam(testRunConfiguration.getExam());\n+        testRun.setWorkingTime(testRunConfiguration.getWorkingTime());\n+        testRun.setUser(userService.getUser());\n+        testRun.setTestRun(true);\n+        testRun.setSubmitted(false);\n+        testRun = studentExamRepository.save(testRun);\n+        return testRun;\n+    }\n+\n+    /**\n+     * Sets up the participations and submissions for all the exercises of the test run.\n+     * Calls {@link ExamService#setUpExerciseParticipationsAndSubmissions} to set up the exercise participations\n+     * and {@link ParticipationService#markSubmissionsOfTestRunParticipations} to mark them as test run participations\n+     *\n+     * @param testRunId the id of the TestRun\n+     */\n+    private void setUpTestRunExerciseParticipationsAndSubmissions(Long testRunId) {\n+        StudentExam testRun = studentExamRepository.findWithExercisesParticipationsSubmissionsById(testRunId, true)\n+                .orElseThrow(() -> new EntityNotFoundException(\"StudentExam with id: \\\"\" + testRunId + \"\\\" does not exist\"));\n+        List<StudentParticipation> generatedParticipations = Collections.synchronizedList(new ArrayList<>());\n+        examService.setUpExerciseParticipationsAndSubmissions(generatedParticipations, testRun);\n+        participationService.markSubmissionsOfTestRunParticipations(generatedParticipations);\n+    }\n+\n+    /**\n+     * Deletes a test run.\n+     * In case the participation is  not referenced by other test runs, the participation, submission, buildplans and repositories are deleted as well.\n+     * @param testRunId the id of the test run\n+     * @param instructorId the id of the instructor\n+     * @return the deleted test run\n+     */\n+    public StudentExam deleteTestRun(Long testRunId, Long instructorId) {\n+        StudentExam testRun = studentExamRepository.findWithExercisesParticipationsSubmissionsByIdForUser(testRunId, instructorId, true)\n+                .orElse(studentExamRepository.findWithExercisesParticipationsSubmissionsById(testRunId, true)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzcxNzYwMQ=="}, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 136}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4OTkxNDYwOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/TextSubmissionService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNjoxNDoxOVrOHW2Phg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxODowMzoyM1rOHW6XqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzcxOTQzMA==", "bodyText": "First map, then filter for present.\nAlso, check with similar comments above.", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493719430", "createdAt": "2020-09-23T16:14:19Z", "author": {"login": "jpbernius"}, "path": "src/main/java/de/tum/in/www1/artemis/service/TextSubmissionService.java", "diffHunk": "@@ -235,10 +244,19 @@ public TextSubmission save(TextSubmission textSubmission) {\n      *\n      * @param exerciseId - the id of the exercise we are looking for\n      * @param tutor - the tutor we are interested in\n+     * @param examMode - flag should be set to ignore the test run submissions\n      * @return a list of text Submissions\n      */\n-    public List<TextSubmission> getAllTextSubmissionsAssessedByTutorWithForExercise(Long exerciseId, User tutor) {\n-        List<Submission> submissions = this.submissionRepository.findAllByParticipationExerciseIdAndResultAssessor(exerciseId, tutor);\n+    public List<TextSubmission> getAllTextSubmissionsAssessedByTutorWithForExercise(Long exerciseId, User tutor, boolean examMode) {\n+        List<Submission> submissions;\n+        if (examMode) {\n+            var participations = this.studentParticipationRepository.findAllByParticipationExerciseIdAndResultAssessorIgnoreTestRuns(exerciseId, tutor);\n+            submissions = participations.stream().filter(studentParticipation -> studentParticipation.findLatestSubmission().isPresent())\n+                    .map(StudentParticipation::findLatestSubmission).map(Optional::get).collect(toList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzc4NzA0OQ==", "bodyText": "See ad13371 and 781a856", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493787049", "createdAt": "2020-09-23T18:03:23Z", "author": {"login": "anditurdiu"}, "path": "src/main/java/de/tum/in/www1/artemis/service/TextSubmissionService.java", "diffHunk": "@@ -235,10 +244,19 @@ public TextSubmission save(TextSubmission textSubmission) {\n      *\n      * @param exerciseId - the id of the exercise we are looking for\n      * @param tutor - the tutor we are interested in\n+     * @param examMode - flag should be set to ignore the test run submissions\n      * @return a list of text Submissions\n      */\n-    public List<TextSubmission> getAllTextSubmissionsAssessedByTutorWithForExercise(Long exerciseId, User tutor) {\n-        List<Submission> submissions = this.submissionRepository.findAllByParticipationExerciseIdAndResultAssessor(exerciseId, tutor);\n+    public List<TextSubmission> getAllTextSubmissionsAssessedByTutorWithForExercise(Long exerciseId, User tutor, boolean examMode) {\n+        List<Submission> submissions;\n+        if (examMode) {\n+            var participations = this.studentParticipationRepository.findAllByParticipationExerciseIdAndResultAssessorIgnoreTestRuns(exerciseId, tutor);\n+            submissions = participations.stream().filter(studentParticipation -> studentParticipation.findLatestSubmission().isPresent())\n+                    .map(StudentParticipation::findLatestSubmission).map(Optional::get).collect(toList());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzcxOTQzMA=="}, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4OTk0MTUyOnYy", "diffSide": "RIGHT", "path": "src/main/resources/config/liquibase/master.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNjoyMDo1MlrOHW2gww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxODowNDoxOFrOHW6ZmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzcyMzg0Mw==", "bodyText": "This can be one migration!", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493723843", "createdAt": "2020-09-23T16:20:52Z", "author": {"login": "jpbernius"}, "path": "src/main/resources/config/liquibase/master.xml", "diffHunk": "@@ -80,4 +80,6 @@\n     <include file=\"classpath:config/liquibase/changelog/20200728142700_changelog.xml\" relativeToChangelogFile=\"false\"/>\n     <include file=\"classpath:config/liquibase/changelog/20200805101210_changelog.xml\" relativeToChangelogFile=\"false\"/>\n     <include file=\"classpath:config/liquibase/changelog/20200806141810_changelog.xml\" relativeToChangelogFile=\"false\"/>\n+    <include file=\"classpath:config/liquibase/changelog/20200908112330_changelog.xml\" relativeToChangelogFile=\"false\"/>\n+    <include file=\"classpath:config/liquibase/changelog/20200921155030_changelog.xml\" relativeToChangelogFile=\"false\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzc4NzU0NQ==", "bodyText": "8111f8f", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493787545", "createdAt": "2020-09-23T18:04:18Z", "author": {"login": "anditurdiu"}, "path": "src/main/resources/config/liquibase/master.xml", "diffHunk": "@@ -80,4 +80,6 @@\n     <include file=\"classpath:config/liquibase/changelog/20200728142700_changelog.xml\" relativeToChangelogFile=\"false\"/>\n     <include file=\"classpath:config/liquibase/changelog/20200805101210_changelog.xml\" relativeToChangelogFile=\"false\"/>\n     <include file=\"classpath:config/liquibase/changelog/20200806141810_changelog.xml\" relativeToChangelogFile=\"false\"/>\n+    <include file=\"classpath:config/liquibase/changelog/20200908112330_changelog.xml\" relativeToChangelogFile=\"false\"/>\n+    <include file=\"classpath:config/liquibase/changelog/20200921155030_changelog.xml\" relativeToChangelogFile=\"false\"/>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzcyMzg0Mw=="}, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4OTk0NjAxOnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/complaints/complaint-interactions.component.ts", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNjoyMTo1NVrOHW2jqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNjoyMTo1NVrOHW2jqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzcyNDU4Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    console.log('complaints active');", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493724586", "createdAt": "2020-09-23T16:21:55Z", "author": {"login": "jpbernius"}, "path": "src/main/webapp/app/complaints/complaint-interactions.component.ts", "diffHunk": "@@ -47,6 +49,7 @@ export class ComplaintInteractionsComponent implements OnInit {\n      * Loads the number of allowed complaints and feedback requests\n      */\n     ngOnInit(): void {\n+        console.log('complaints active');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4OTk0OTU0OnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/course/dashboards/tutor-course-dashboard/tutor-course-dashboard.component.html", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNjoyMjo0OVrOHW2mAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxODowNDo0M1rOHW6adQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzcyNTE4Ng==", "bodyText": "You only need to switch the translation string conditionally.", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493725186", "createdAt": "2020-09-23T16:22:49Z", "author": {"login": "jpbernius"}, "path": "src/main/webapp/app/course/dashboards/tutor-course-dashboard/tutor-course-dashboard.component.html", "diffHunk": "@@ -4,7 +4,8 @@\n             <h2>\n                 <fa-icon [icon]=\"'arrow-left'\" (click)=\"back()\" class=\"back-button mr-2\"></fa-icon>\n                 <h2 *ngIf=\"!isExamMode\">{{ 'artemisApp.tutorCourseDashboard.pageHeader' | translate }} {{ course?.title }}</h2>\n-                <h2 *ngIf=\"isExamMode\">{{ 'artemisApp.tutorCourseDashboard.pageHeaderExam' | translate }} {{ exam?.title }}</h2>\n+                <h2 *ngIf=\"isExamMode && !isTestRun\">{{ 'artemisApp.tutorCourseDashboard.pageHeaderExam' | translate }} {{ exam?.title }}</h2>\n+                <h2 *ngIf=\"isExamMode && isTestRun\">{{ 'artemisApp.tutorCourseDashboard.pageHeaderExamTestRun' | translate }} {{ exam?.title }}</h2>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzc4Nzc2NQ==", "bodyText": "488d918", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r493787765", "createdAt": "2020-09-23T18:04:43Z", "author": {"login": "anditurdiu"}, "path": "src/main/webapp/app/course/dashboards/tutor-course-dashboard/tutor-course-dashboard.component.html", "diffHunk": "@@ -4,7 +4,8 @@\n             <h2>\n                 <fa-icon [icon]=\"'arrow-left'\" (click)=\"back()\" class=\"back-button mr-2\"></fa-icon>\n                 <h2 *ngIf=\"!isExamMode\">{{ 'artemisApp.tutorCourseDashboard.pageHeader' | translate }} {{ course?.title }}</h2>\n-                <h2 *ngIf=\"isExamMode\">{{ 'artemisApp.tutorCourseDashboard.pageHeaderExam' | translate }} {{ exam?.title }}</h2>\n+                <h2 *ngIf=\"isExamMode && !isTestRun\">{{ 'artemisApp.tutorCourseDashboard.pageHeaderExam' | translate }} {{ exam?.title }}</h2>\n+                <h2 *ngIf=\"isExamMode && isTestRun\">{{ 'artemisApp.tutorCourseDashboard.pageHeaderExamTestRun' | translate }} {{ exam?.title }}</h2>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzcyNTE4Ng=="}, "originalCommit": {"oid": "6c443779982ad73b5f7c969264a370b24c206f78"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5MjA4NjQ0OnYy", "diffSide": "RIGHT", "path": "src/test/java/de/tum/in/www1/artemis/ExamIntegrationTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwNTo1NToxNVrOHXKu_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwNTo1NToxNVrOHXKu_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDA1NTE2Nw==", "bodyText": "Codacy found an issue: The JUnit 5 test method name 'testGetExamForTestRunDashboard_forbidden' doesn't match '[a-z][a-zA-Z0-9]*'", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r494055167", "createdAt": "2020-09-24T05:55:15Z", "author": {"login": "artemis-bot"}, "path": "src/test/java/de/tum/in/www1/artemis/ExamIntegrationTest.java", "diffHunk": "@@ -735,6 +735,98 @@ public void testDeleteStudentWithParticipationsAndSubmissions() throws Exception\n         request.delete(\"/api/courses/\" + course1.getId() + \"/exams/\" + exam.getId(), HttpStatus.OK);\n     }\n \n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void testDeleteExamWithOneTestRun() throws Exception {\n+        var instructor = database.getUserByLogin(\"instructor1\");\n+        var exam = database.addTextModelingProgrammingExercisesToExam(exam1, false);\n+        database.setupTestRunForExamWithExerciseGroupsForInstructor(exam1, instructor, exam.getExerciseGroups());\n+        request.delete(\"/api/courses/\" + course1.getId() + \"/exams/\" + exam1.getId(), HttpStatus.OK);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void testDeleteTestRun() throws Exception {\n+        var instructor = database.getUserByLogin(\"instructor1\");\n+        var exam = database.addTextModelingProgrammingExercisesToExam(exam1, false);\n+        database.setupTestRunForExamWithExerciseGroupsForInstructor(exam1, instructor, exam.getExerciseGroups());\n+        var testRun = database.setupTestRunForExamWithExerciseGroupsForInstructor(exam1, instructor, exam.getExerciseGroups());\n+        request.delete(\"/api/courses/\" + course1.getId() + \"/exams/\" + exam1.getId() + \"/delete-test-run/\" + testRun.getId(), HttpStatus.OK);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void testDeleteTestRunWithReferencedParticipations() throws Exception {\n+        var instructor = database.getUserByLogin(\"instructor1\");\n+        var exam = database.addTextModelingProgrammingExercisesToExam(exam1, false);\n+        database.setupTestRunForExamWithExerciseGroupsForInstructor(exam1, instructor, exam.getExerciseGroups());\n+        var testRun1 = database.setupTestRunForExamWithExerciseGroupsForInstructor(exam1, instructor, exam.getExerciseGroups());\n+        var testRun2 = new StudentExam();\n+        testRun2.setTestRun(true);\n+        testRun2.setExam(testRun1.getExam());\n+        testRun2.setUser(instructor);\n+        testRun2.setExercises(testRun1.getExercises());\n+        testRun2.setWorkingTime(testRun1.getWorkingTime());\n+        studentExamRepository.save(testRun2);\n+        request.delete(\"/api/courses/\" + course1.getId() + \"/exams/\" + exam1.getId() + \"/delete-test-run/\" + testRun2.getId(), HttpStatus.OK);\n+        SecurityUtils.setAuthorizationObject();\n+        var testRunList = studentExamRepository.findAllTestRunsWithExercisesParticipationsSubmissionsResultsByExamId(exam1.getId());\n+        assertThat(testRunList.size()).isEqualTo(1);\n+        testRunList.get(0).getExercises().forEach(exercise -> assertThat(exercise.getStudentParticipations()).isNotEmpty());\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"tutor1\", roles = \"TA\")\n+    public void testDeleteTestRunAsTutor() throws Exception {\n+        request.delete(\"/api/courses/\" + course1.getId() + \"/exams/\" + exam1.getId() + \"/delete-test-run/\" + 1, HttpStatus.FORBIDDEN);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"tutor1\", roles = \"TA\")\n+    public void testGetExamForTestRunDashboard_forbidden() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d83ac21cce0a3d263e1ecb4b4c851da11c0e0efc"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5MjA4NjUxOnYy", "diffSide": "RIGHT", "path": "src/test/java/de/tum/in/www1/artemis/ExamIntegrationTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwNTo1NToxNlrOHXKvCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwNTo1NToxNlrOHXKvCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDA1NTE3OA==", "bodyText": "Codacy found an issue: The JUnit 5 test method name 'testGetExamForTestRunDashboard_ok' doesn't match '[a-z][a-zA-Z0-9]*'", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r494055178", "createdAt": "2020-09-24T05:55:16Z", "author": {"login": "artemis-bot"}, "path": "src/test/java/de/tum/in/www1/artemis/ExamIntegrationTest.java", "diffHunk": "@@ -735,6 +735,98 @@ public void testDeleteStudentWithParticipationsAndSubmissions() throws Exception\n         request.delete(\"/api/courses/\" + course1.getId() + \"/exams/\" + exam.getId(), HttpStatus.OK);\n     }\n \n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void testDeleteExamWithOneTestRun() throws Exception {\n+        var instructor = database.getUserByLogin(\"instructor1\");\n+        var exam = database.addTextModelingProgrammingExercisesToExam(exam1, false);\n+        database.setupTestRunForExamWithExerciseGroupsForInstructor(exam1, instructor, exam.getExerciseGroups());\n+        request.delete(\"/api/courses/\" + course1.getId() + \"/exams/\" + exam1.getId(), HttpStatus.OK);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void testDeleteTestRun() throws Exception {\n+        var instructor = database.getUserByLogin(\"instructor1\");\n+        var exam = database.addTextModelingProgrammingExercisesToExam(exam1, false);\n+        database.setupTestRunForExamWithExerciseGroupsForInstructor(exam1, instructor, exam.getExerciseGroups());\n+        var testRun = database.setupTestRunForExamWithExerciseGroupsForInstructor(exam1, instructor, exam.getExerciseGroups());\n+        request.delete(\"/api/courses/\" + course1.getId() + \"/exams/\" + exam1.getId() + \"/delete-test-run/\" + testRun.getId(), HttpStatus.OK);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void testDeleteTestRunWithReferencedParticipations() throws Exception {\n+        var instructor = database.getUserByLogin(\"instructor1\");\n+        var exam = database.addTextModelingProgrammingExercisesToExam(exam1, false);\n+        database.setupTestRunForExamWithExerciseGroupsForInstructor(exam1, instructor, exam.getExerciseGroups());\n+        var testRun1 = database.setupTestRunForExamWithExerciseGroupsForInstructor(exam1, instructor, exam.getExerciseGroups());\n+        var testRun2 = new StudentExam();\n+        testRun2.setTestRun(true);\n+        testRun2.setExam(testRun1.getExam());\n+        testRun2.setUser(instructor);\n+        testRun2.setExercises(testRun1.getExercises());\n+        testRun2.setWorkingTime(testRun1.getWorkingTime());\n+        studentExamRepository.save(testRun2);\n+        request.delete(\"/api/courses/\" + course1.getId() + \"/exams/\" + exam1.getId() + \"/delete-test-run/\" + testRun2.getId(), HttpStatus.OK);\n+        SecurityUtils.setAuthorizationObject();\n+        var testRunList = studentExamRepository.findAllTestRunsWithExercisesParticipationsSubmissionsResultsByExamId(exam1.getId());\n+        assertThat(testRunList.size()).isEqualTo(1);\n+        testRunList.get(0).getExercises().forEach(exercise -> assertThat(exercise.getStudentParticipations()).isNotEmpty());\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"tutor1\", roles = \"TA\")\n+    public void testDeleteTestRunAsTutor() throws Exception {\n+        request.delete(\"/api/courses/\" + course1.getId() + \"/exams/\" + exam1.getId() + \"/delete-test-run/\" + 1, HttpStatus.FORBIDDEN);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"tutor1\", roles = \"TA\")\n+    public void testGetExamForTestRunDashboard_forbidden() throws Exception {\n+        request.get(\"/api/courses/\" + course1.getId() + \"/exams/\" + exam1.getId() + \"/for-exam-tutor-test-run-dashboard\", HttpStatus.FORBIDDEN, Exam.class);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void testGetExamForTestRunDashboard_conflict() throws Exception {\n+        request.get(\"/api/courses/\" + course2.getId() + \"/exams/\" + exam1.getId() + \"/for-exam-tutor-test-run-dashboard\", HttpStatus.CONFLICT, Exam.class);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void testGetExamForTestRunDashboard_ok() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d83ac21cce0a3d263e1ecb4b4c851da11c0e0efc"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5MjA4NjYxOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/StudentExamService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwNTo1NToxN1rOHXKvFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwNTo1NToxN1rOHXKvFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDA1NTE4OQ==", "bodyText": "Codacy found an issue: Avoid long parameter lists.", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r494055189", "createdAt": "2020-09-24T05:55:17Z", "author": {"login": "artemis-bot"}, "path": "src/main/java/de/tum/in/www1/artemis/service/StudentExamService.java", "diffHunk": "@@ -53,11 +53,14 @@\n \n     private final ProgrammingExerciseParticipationService programmingExerciseParticipationService;\n \n-    public StudentExamService(StudentExamRepository studentExamRepository, ParticipationService participationService, QuizSubmissionRepository quizSubmissionRepository,\n-            TextSubmissionRepository textSubmissionRepository, ModelingSubmissionRepository modelingSubmissionRepository, SubmissionVersionService submissionVersionService,\n-            ProgrammingExerciseParticipationService programmingExerciseParticipationService, ProgrammingSubmissionRepository programmingSubmissionRepository) {\n+    public StudentExamService(StudentExamRepository studentExamRepository, ExamService examService, UserService userService, ParticipationService participationService,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d83ac21cce0a3d263e1ecb4b4c851da11c0e0efc"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5MjA4NjY1OnYy", "diffSide": "RIGHT", "path": "src/test/java/de/tum/in/www1/artemis/ExamIntegrationTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwNTo1NToxOFrOHXKvGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwNTo1NToxOFrOHXKvGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDA1NTE5NQ==", "bodyText": "Codacy found an issue: The JUnit 5 test method name 'testGetExamForTestRunDashboard_conflict' doesn't match '[a-z][a-zA-Z0-9]*'", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r494055195", "createdAt": "2020-09-24T05:55:18Z", "author": {"login": "artemis-bot"}, "path": "src/test/java/de/tum/in/www1/artemis/ExamIntegrationTest.java", "diffHunk": "@@ -735,6 +735,98 @@ public void testDeleteStudentWithParticipationsAndSubmissions() throws Exception\n         request.delete(\"/api/courses/\" + course1.getId() + \"/exams/\" + exam.getId(), HttpStatus.OK);\n     }\n \n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void testDeleteExamWithOneTestRun() throws Exception {\n+        var instructor = database.getUserByLogin(\"instructor1\");\n+        var exam = database.addTextModelingProgrammingExercisesToExam(exam1, false);\n+        database.setupTestRunForExamWithExerciseGroupsForInstructor(exam1, instructor, exam.getExerciseGroups());\n+        request.delete(\"/api/courses/\" + course1.getId() + \"/exams/\" + exam1.getId(), HttpStatus.OK);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void testDeleteTestRun() throws Exception {\n+        var instructor = database.getUserByLogin(\"instructor1\");\n+        var exam = database.addTextModelingProgrammingExercisesToExam(exam1, false);\n+        database.setupTestRunForExamWithExerciseGroupsForInstructor(exam1, instructor, exam.getExerciseGroups());\n+        var testRun = database.setupTestRunForExamWithExerciseGroupsForInstructor(exam1, instructor, exam.getExerciseGroups());\n+        request.delete(\"/api/courses/\" + course1.getId() + \"/exams/\" + exam1.getId() + \"/delete-test-run/\" + testRun.getId(), HttpStatus.OK);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void testDeleteTestRunWithReferencedParticipations() throws Exception {\n+        var instructor = database.getUserByLogin(\"instructor1\");\n+        var exam = database.addTextModelingProgrammingExercisesToExam(exam1, false);\n+        database.setupTestRunForExamWithExerciseGroupsForInstructor(exam1, instructor, exam.getExerciseGroups());\n+        var testRun1 = database.setupTestRunForExamWithExerciseGroupsForInstructor(exam1, instructor, exam.getExerciseGroups());\n+        var testRun2 = new StudentExam();\n+        testRun2.setTestRun(true);\n+        testRun2.setExam(testRun1.getExam());\n+        testRun2.setUser(instructor);\n+        testRun2.setExercises(testRun1.getExercises());\n+        testRun2.setWorkingTime(testRun1.getWorkingTime());\n+        studentExamRepository.save(testRun2);\n+        request.delete(\"/api/courses/\" + course1.getId() + \"/exams/\" + exam1.getId() + \"/delete-test-run/\" + testRun2.getId(), HttpStatus.OK);\n+        SecurityUtils.setAuthorizationObject();\n+        var testRunList = studentExamRepository.findAllTestRunsWithExercisesParticipationsSubmissionsResultsByExamId(exam1.getId());\n+        assertThat(testRunList.size()).isEqualTo(1);\n+        testRunList.get(0).getExercises().forEach(exercise -> assertThat(exercise.getStudentParticipations()).isNotEmpty());\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"tutor1\", roles = \"TA\")\n+    public void testDeleteTestRunAsTutor() throws Exception {\n+        request.delete(\"/api/courses/\" + course1.getId() + \"/exams/\" + exam1.getId() + \"/delete-test-run/\" + 1, HttpStatus.FORBIDDEN);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"tutor1\", roles = \"TA\")\n+    public void testGetExamForTestRunDashboard_forbidden() throws Exception {\n+        request.get(\"/api/courses/\" + course1.getId() + \"/exams/\" + exam1.getId() + \"/for-exam-tutor-test-run-dashboard\", HttpStatus.FORBIDDEN, Exam.class);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void testGetExamForTestRunDashboard_conflict() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d83ac21cce0a3d263e1ecb4b4c851da11c0e0efc"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5MjA4NjczOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/SubmissionService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwNTo1NToxOVrOHXKvKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwNTo1NToxOVrOHXKvKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDA1NTIwOA==", "bodyText": "Codacy found an issue: Unnecessary use of fully qualified name 'Collectors.toList' due to existing static import 'java.util.stream.Collectors.toList'", "url": "https://github.com/ls1intum/Artemis/pull/2096#discussion_r494055208", "createdAt": "2020-09-24T05:55:19Z", "author": {"login": "artemis-bot"}, "path": "src/main/java/de/tum/in/www1/artemis/service/SubmissionService.java", "diffHunk": "@@ -126,6 +136,61 @@ public long countSubmissionLocks(long courseId) {\n         return submissionRepository.getLockedSubmissionsByUserIdAndCourseId(userService.getUserWithGroupsAndAuthorities().getId(), courseId);\n     }\n \n+    /**\n+     * Given an exercise id and a tutor id, it returns all the submissions where the tutor has a result associated.\n+     *\n+     * @param exerciseId - the id of the exercise we are looking for\n+     * @param tutor - the tutor we are interested in\n+     * @param examMode - flag should be set to ignore the test run submissions\n+     * @return a list of Submissions\n+     */\n+    protected List<Submission> getAllSubmissionsAssessedByTutorForExercise(Long exerciseId, User tutor, boolean examMode) {\n+        List<Submission> submissions;\n+        if (examMode) {\n+            var participations = this.studentParticipationRepository.findAllByParticipationExerciseIdAndResultAssessorIgnoreTestRuns(exerciseId, tutor);\n+            submissions = participations.stream().map(StudentParticipation::findLatestSubmission).filter(Optional::isPresent).map(Optional::get).collect(toList());\n+        }\n+        else {\n+            submissions = this.submissionRepository.findAllByParticipationExerciseIdAndResultAssessor(exerciseId, tutor);\n+        }\n+\n+        submissions.forEach(submission -> submission.getResult().setSubmission(null));\n+        return submissions;\n+    }\n+\n+    /**\n+     * Given an exercise id, find a random submission for that exercise which still doesn't have any manual result.\n+     * No manual result means that no user has started an assessment for the corresponding submission yet.\n+     * For exam exercises we should also remove the test run participations as these should not be graded by the tutors.\n+     *\n+     * @param fileUploadExercise the exercise for which we want to retrieve a submission without manual result\n+     * @param examMode flag to determine if test runs should be removed. This should be set to true for exam exercises\n+     * @return a submission without any manual result or an empty Optional if no submission without manual result could be found\n+     */\n+    @Transactional(readOnly = true)\n+    public Optional<Submission> getRandomSubmissionEligibleForNewAssessment(Exercise fileUploadExercise, boolean examMode) {\n+        Random random = new Random();\n+        List<StudentParticipation> participations;\n+        if (examMode) {\n+            participations = participationService.findByExerciseIdWithLatestSubmissionWithoutManualResultsAndNoTestRun(fileUploadExercise.getId());\n+        }\n+        else {\n+            participations = participationService.findByExerciseIdWithLatestSubmissionWithoutManualResults(fileUploadExercise.getId());\n+        }\n+\n+        List<Submission> submissionsWithoutResult = participations.stream().map(StudentParticipation::findLatestSubmission).filter(Optional::isPresent).map(Optional::get)\n+                .collect(Collectors.toList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d83ac21cce0a3d263e1ecb4b4c851da11c0e0efc"}, "originalPosition": 107}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4683, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}