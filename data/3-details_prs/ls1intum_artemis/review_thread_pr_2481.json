{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI5NjA1NDQ0", "number": 2481, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwOTozNDozMFrOE_Cukw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQyMTozNDowN1rOE_0ZUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0NTQwNDM1OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/jenkins/JenkinsService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwOTozNDozMFrOH8hhTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxNDowNDowOFrOH8uARA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzIyNTgwNA==", "bodyText": "can we remove this?", "url": "https://github.com/ls1intum/Artemis/pull/2481#discussion_r533225804", "createdAt": "2020-12-01T09:34:30Z", "author": {"login": "krusche"}, "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/jenkins/JenkinsService.java", "diffHunk": "@@ -322,7 +326,12 @@ public Result onBuildCompleted(ProgrammingExerciseParticipation participation, O\n         final ProgrammingSubmission submission;\n         submission = latestPendingSubmission.orElseGet(() -> createFallbackSubmission(participation, report));\n         submission.setBuildFailed(result.getResultString().equals(\"No tests found\"));\n+\n+        // todo wip, save currently necessary, because of relationship between result and submission", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81aa72aac2961383f856c541c6d70973038244c2"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQzMDM0MA==", "bodyText": "adjusted in: ed4e902", "url": "https://github.com/ls1intum/Artemis/pull/2481#discussion_r533430340", "createdAt": "2020-12-01T14:04:08Z", "author": {"login": "anditurdiu"}, "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/jenkins/JenkinsService.java", "diffHunk": "@@ -322,7 +326,12 @@ public Result onBuildCompleted(ProgrammingExerciseParticipation participation, O\n         final ProgrammingSubmission submission;\n         submission = latestPendingSubmission.orElseGet(() -> createFallbackSubmission(participation, report));\n         submission.setBuildFailed(result.getResultString().equals(\"No tests found\"));\n+\n+        // todo wip, save currently necessary, because of relationship between result and submission", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzIyNTgwNA=="}, "originalCommit": {"oid": "81aa72aac2961383f856c541c6d70973038244c2"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0NTQxMzc4OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/jenkins/JenkinsService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwOTozNTozOVrOH8hnLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxNDowNDoxOFrOH8uAwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzIyNzMwOA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    resultRepository.save(result);\n          \n          \n            \n                    result = resultRepository.save(result);", "url": "https://github.com/ls1intum/Artemis/pull/2481#discussion_r533227308", "createdAt": "2020-12-01T09:35:39Z", "author": {"login": "krusche"}, "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/jenkins/JenkinsService.java", "diffHunk": "@@ -322,7 +326,12 @@ public Result onBuildCompleted(ProgrammingExerciseParticipation participation, O\n         final ProgrammingSubmission submission;\n         submission = latestPendingSubmission.orElseGet(() -> createFallbackSubmission(participation, report));\n         submission.setBuildFailed(result.getResultString().equals(\"No tests found\"));\n+\n+        // todo wip, save currently necessary, because of relationship between result and submission\n+        resultRepository.save(result);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81aa72aac2961383f856c541c6d70973038244c2"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQzMDQ2NA==", "bodyText": "Fixed in: ed4e902", "url": "https://github.com/ls1intum/Artemis/pull/2481#discussion_r533430464", "createdAt": "2020-12-01T14:04:18Z", "author": {"login": "anditurdiu"}, "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/jenkins/JenkinsService.java", "diffHunk": "@@ -322,7 +326,12 @@ public Result onBuildCompleted(ProgrammingExerciseParticipation participation, O\n         final ProgrammingSubmission submission;\n         submission = latestPendingSubmission.orElseGet(() -> createFallbackSubmission(participation, report));\n         submission.setBuildFailed(result.getResultString().equals(\"No tests found\"));\n+\n+        // todo wip, save currently necessary, because of relationship between result and submission\n+        resultRepository.save(result);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzIyNzMwOA=="}, "originalCommit": {"oid": "81aa72aac2961383f856c541c6d70973038244c2"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0NTQxNzI2OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/SubmissionService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwOTozNjowN1rOH8hpcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxNDoyMjoxM1rOH8u0Aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzIyNzg4OA==", "bodyText": "can you add a better documentation here instead?\nalso make sure to write TODO Nicolas Ruscher or another name", "url": "https://github.com/ls1intum/Artemis/pull/2481#discussion_r533227888", "createdAt": "2020-12-01T09:36:07Z", "author": {"login": "krusche"}, "path": "src/main/java/de/tum/in/www1/artemis/service/SubmissionService.java", "diffHunk": "@@ -287,10 +287,30 @@ public void hideDetails(Submission submission, User user) {\n      */\n     public Result setNewResult(Submission submission) {\n         Result result = new Result();\n+        result.setParticipation(submission.getParticipation());\n+        result = resultRepository.save(result);\n         result.setSubmission(submission);\n         submission.setResult(result);\n-        result.setParticipation(submission.getParticipation());\n+        submissionRepository.save(submission);\n+        return result;\n+    }\n+\n+    /**\n+     * todo wip: currently used to fix issues with saving / assigning results to submissions", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81aa72aac2961383f856c541c6d70973038244c2"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQ0MzU4Nw==", "bodyText": "adjusted in 00b31df", "url": "https://github.com/ls1intum/Artemis/pull/2481#discussion_r533443587", "createdAt": "2020-12-01T14:22:13Z", "author": {"login": "anditurdiu"}, "path": "src/main/java/de/tum/in/www1/artemis/service/SubmissionService.java", "diffHunk": "@@ -287,10 +287,30 @@ public void hideDetails(Submission submission, User user) {\n      */\n     public Result setNewResult(Submission submission) {\n         Result result = new Result();\n+        result.setParticipation(submission.getParticipation());\n+        result = resultRepository.save(result);\n         result.setSubmission(submission);\n         submission.setResult(result);\n-        result.setParticipation(submission.getParticipation());\n+        submissionRepository.save(submission);\n+        return result;\n+    }\n+\n+    /**\n+     * todo wip: currently used to fix issues with saving / assigning results to submissions", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzIyNzg4OA=="}, "originalCommit": {"oid": "81aa72aac2961383f856c541c6d70973038244c2"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0NTQyMjUxOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/bamboo/BambooService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwOTozNjo0NVrOH8hsoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxNDowNDozNFrOH8uBcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzIyODcwNQ==", "bodyText": "can we remove it and instead document why saving the result here is necessary?", "url": "https://github.com/ls1intum/Artemis/pull/2481#discussion_r533228705", "createdAt": "2020-12-01T09:36:45Z", "author": {"login": "krusche"}, "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/bamboo/BambooService.java", "diffHunk": "@@ -566,11 +570,17 @@ public Result onBuildCompleted(ProgrammingExerciseParticipation participation, O\n             // Do not remove this save, otherwise Hibernate will throw an order column index null exception on saving the build logs\n             programmingSubmission = programmingSubmissionRepository.save(programmingSubmission);\n \n+            // todo wip, save currently necessary, because of relationship between result and submission", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81aa72aac2961383f856c541c6d70973038244c2"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQzMDY0Mg==", "bodyText": "adjusted in: ed4e902", "url": "https://github.com/ls1intum/Artemis/pull/2481#discussion_r533430642", "createdAt": "2020-12-01T14:04:34Z", "author": {"login": "anditurdiu"}, "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/bamboo/BambooService.java", "diffHunk": "@@ -566,11 +570,17 @@ public Result onBuildCompleted(ProgrammingExerciseParticipation participation, O\n             // Do not remove this save, otherwise Hibernate will throw an order column index null exception on saving the build logs\n             programmingSubmission = programmingSubmissionRepository.save(programmingSubmission);\n \n+            // todo wip, save currently necessary, because of relationship between result and submission", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzIyODcwNQ=="}, "originalCommit": {"oid": "81aa72aac2961383f856c541c6d70973038244c2"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0NTQ1NDA3OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/bamboo/BambooService.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwOTo0MDo0MlrOH8iANw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQyMDozNjoyN1rOH8-xkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzIzMzcxOQ==", "bodyText": "we now save the programmingSubmission twice (see two lines below), is this really necessary?", "url": "https://github.com/ls1intum/Artemis/pull/2481#discussion_r533233719", "createdAt": "2020-12-01T09:40:42Z", "author": {"login": "krusche"}, "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/bamboo/BambooService.java", "diffHunk": "@@ -566,11 +570,17 @@ public Result onBuildCompleted(ProgrammingExerciseParticipation participation, O\n             // Do not remove this save, otherwise Hibernate will throw an order column index null exception on saving the build logs\n             programmingSubmission = programmingSubmissionRepository.save(programmingSubmission);\n \n+            // todo wip, save currently necessary, because of relationship between result and submission\n+            result = resultRepository.save(result);\n+\n             var buildLogs = extractAndPrepareBuildLogs(buildResult, programmingSubmission);\n             // Set the received logs in order to avoid duplicate entries (this removes existing logs)\n+            result.setSubmission(programmingSubmission);\n+            programmingSubmission.setResult(result);\n+            programmingSubmission = programmingSubmissionRepository.save(programmingSubmission);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81aa72aac2961383f856c541c6d70973038244c2"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQzMzk4MQ==", "bodyText": "Without the second save there would be an IndexColumnError null thrown for the build logs. We tried creating a BuildLogEntryRepository and first saving all BuildLogEntries, before establishing the relation but that did not fix the problem. This was the only solution @SimonEntholzer found. Maybe @SimonEntholzer you can explain your rationale a bit better?", "url": "https://github.com/ls1intum/Artemis/pull/2481#discussion_r533433981", "createdAt": "2020-12-01T14:09:13Z", "author": {"login": "anditurdiu"}, "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/bamboo/BambooService.java", "diffHunk": "@@ -566,11 +570,17 @@ public Result onBuildCompleted(ProgrammingExerciseParticipation participation, O\n             // Do not remove this save, otherwise Hibernate will throw an order column index null exception on saving the build logs\n             programmingSubmission = programmingSubmissionRepository.save(programmingSubmission);\n \n+            // todo wip, save currently necessary, because of relationship between result and submission\n+            result = resultRepository.save(result);\n+\n             var buildLogs = extractAndPrepareBuildLogs(buildResult, programmingSubmission);\n             // Set the received logs in order to avoid duplicate entries (this removes existing logs)\n+            result.setSubmission(programmingSubmission);\n+            programmingSubmission.setResult(result);\n+            programmingSubmission = programmingSubmissionRepository.save(programmingSubmission);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzIzMzcxOQ=="}, "originalCommit": {"oid": "81aa72aac2961383f856c541c6d70973038244c2"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzcwNTEwNg==", "bodyText": "You were right, this was not needed. There was still a issue with null index column for buildLogEntries which is fixed in 6444cd.", "url": "https://github.com/ls1intum/Artemis/pull/2481#discussion_r533705106", "createdAt": "2020-12-01T20:36:27Z", "author": {"login": "fde312"}, "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/bamboo/BambooService.java", "diffHunk": "@@ -566,11 +570,17 @@ public Result onBuildCompleted(ProgrammingExerciseParticipation participation, O\n             // Do not remove this save, otherwise Hibernate will throw an order column index null exception on saving the build logs\n             programmingSubmission = programmingSubmissionRepository.save(programmingSubmission);\n \n+            // todo wip, save currently necessary, because of relationship between result and submission\n+            result = resultRepository.save(result);\n+\n             var buildLogs = extractAndPrepareBuildLogs(buildResult, programmingSubmission);\n             // Set the received logs in order to avoid duplicate entries (this removes existing logs)\n+            result.setSubmission(programmingSubmission);\n+            programmingSubmission.setResult(result);\n+            programmingSubmission = programmingSubmissionRepository.save(programmingSubmission);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzIzMzcxOQ=="}, "originalCommit": {"oid": "81aa72aac2961383f856c541c6d70973038244c2"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0NTQ2MTk3OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ExerciseResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwOTo0MTo0NlrOH8iFfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxNDo0MDo1OFrOH8vvAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzIzNTA2OA==", "bodyText": "can we remove the above TODO now?", "url": "https://github.com/ls1intum/Artemis/pull/2481#discussion_r533235068", "createdAt": "2020-12-01T09:41:46Z", "author": {"login": "krusche"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ExerciseResource.java", "diffHunk": "@@ -169,10 +173,10 @@ else if (authCheckService.isAtLeastTeachingAssistantForExercise(exercise, user))\n         }\n \n         // TODO CZ: load results of submissions eagerly to prevent additional database calls\n-        List<ExampleSubmission> exampleSubmissions = this.exampleSubmissionRepository.findAllByExerciseId(exerciseId);\n+        Set<ExampleSubmission> exampleSubmissions = this.exampleSubmissionRepository.findAllWithEagerResultByExerciseId(exerciseId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81aa72aac2961383f856c541c6d70973038244c2"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQ1ODY4OQ==", "bodyText": "Yes, removed the outdated todo in 0e13167", "url": "https://github.com/ls1intum/Artemis/pull/2481#discussion_r533458689", "createdAt": "2020-12-01T14:40:58Z", "author": {"login": "anditurdiu"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ExerciseResource.java", "diffHunk": "@@ -169,10 +173,10 @@ else if (authCheckService.isAtLeastTeachingAssistantForExercise(exercise, user))\n         }\n \n         // TODO CZ: load results of submissions eagerly to prevent additional database calls\n-        List<ExampleSubmission> exampleSubmissions = this.exampleSubmissionRepository.findAllByExerciseId(exerciseId);\n+        Set<ExampleSubmission> exampleSubmissions = this.exampleSubmissionRepository.findAllWithEagerResultByExerciseId(exerciseId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzIzNTA2OA=="}, "originalCommit": {"oid": "81aa72aac2961383f856c541c6d70973038244c2"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM1MzU0MTkzOnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/config/SecurityConfiguration.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQyMTozNDowN1rOH9vC5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQyMTozNDowN1rOH9vC5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQ5NTk3NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change", "url": "https://github.com/ls1intum/Artemis/pull/2481#discussion_r534495974", "createdAt": "2020-12-02T21:34:07Z", "author": {"login": "MaisiKoleni"}, "path": "src/main/java/de/tum/in/www1/artemis/config/SecurityConfiguration.java", "diffHunk": "@@ -162,6 +162,7 @@ protected void configure(HttpSecurity http) throws Exception {\n             .antMatchers(\"/time\").permitAll()\n         .and()\n             .apply(securityConfigurerAdapter());\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6104dce3d44eccbd97c3f39df3cd091784625072"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4295, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}