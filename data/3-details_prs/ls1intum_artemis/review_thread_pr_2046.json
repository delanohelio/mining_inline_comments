{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxOTgxMjMx", "number": 2046, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxNjoxODoyN1rOEbpRyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwOToyNTozN1rOEb--Kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3NDIzMzA0OnYy", "diffSide": "RIGHT", "path": "src/main/java/de/tum/in/www1/artemis/repository/ParticipationRepository.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxNjoxODoyN1rOHFsdFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxNzowNDo1NlrOHFuT2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTczMzI3MQ==", "bodyText": "not sure why you change this here, but this would mean the feedback is not included any more, right?", "url": "https://github.com/ls1intum/Artemis/pull/2046#discussion_r475733271", "createdAt": "2020-08-24T16:18:27Z", "author": {"login": "krusche"}, "path": "src/main/java/de/tum/in/www1/artemis/repository/ParticipationRepository.java", "diffHunk": "@@ -18,8 +18,8 @@\n     @Query(\"select distinct p from Participation p left join fetch p.submissions left join fetch p.results where p.id = :#{#participationId}\")\n     Participation getOneWithEagerSubmissionsAndResults(@Param(\"participationId\") Long participationId);\n \n-    @Query(\"select p from Participation p left join fetch p.results pr left join fetch pr.feedbacks prf where p.id = :participationId and (pr.id = (select max(id) from p.results) or pr.id = null)\")\n-    Optional<Participation> findByIdWithLatestResultAndFeedbacks(@Param(\"participationId\") Long participationId);\n+    @Query(\"select p from Participation p left join fetch p.submissions s left join fetch s.result r where p.id = :participationId and (s.id = (select max(id) from p.submissions) or s.id = null)\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b45febbd2afe0d1b345d0f35163334391fedb2c"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTc2MzY3NQ==", "bodyText": "This query was only used by the Resource method for fetching the build logs. The feedback was never used.", "url": "https://github.com/ls1intum/Artemis/pull/2046#discussion_r475763675", "createdAt": "2020-08-24T17:04:56Z", "author": {"login": "kloessst"}, "path": "src/main/java/de/tum/in/www1/artemis/repository/ParticipationRepository.java", "diffHunk": "@@ -18,8 +18,8 @@\n     @Query(\"select distinct p from Participation p left join fetch p.submissions left join fetch p.results where p.id = :#{#participationId}\")\n     Participation getOneWithEagerSubmissionsAndResults(@Param(\"participationId\") Long participationId);\n \n-    @Query(\"select p from Participation p left join fetch p.results pr left join fetch pr.feedbacks prf where p.id = :participationId and (pr.id = (select max(id) from p.results) or pr.id = null)\")\n-    Optional<Participation> findByIdWithLatestResultAndFeedbacks(@Param(\"participationId\") Long participationId);\n+    @Query(\"select p from Participation p left join fetch p.submissions s left join fetch s.result r where p.id = :participationId and (s.id = (select max(id) from p.submissions) or s.id = null)\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTczMzI3MQ=="}, "originalCommit": {"oid": "4b45febbd2afe0d1b345d0f35163334391fedb2c"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3Nzc4MTk2OnYy", "diffSide": "LEFT", "path": "src/main/webapp/app/exercises/programming/shared/code-editor/build-output/code-editor-build-output.component.ts", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwOToyNDoxNVrOHGPjIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNDo1Mjo0N1rOHGb-8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMwODI1Nw==", "bodyText": "is this logic not necessary any more?", "url": "https://github.com/ls1intum/Artemis/pull/2046#discussion_r476308257", "createdAt": "2020-08-25T09:24:15Z", "author": {"login": "krusche"}, "path": "src/main/webapp/app/exercises/programming/shared/code-editor/build-output/code-editor-build-output.component.ts", "diffHunk": "@@ -182,15 +183,14 @@ export class CodeEditorBuildOutputComponent implements AfterViewInit, OnInit, On\n \n     /**\n      * Decides if the build log should be shown.\n-     * If All tests were successful or there is test feedback -> don't show build logs.\n-     * Else -> show build logs.\n+     * Fetch the build logs only if the submission could not be build\n      * @param result\n      */\n     fetchBuildResults(result: Result | null): Observable<BuildLogEntry[] | null> {\n-        if ((result && result.successful) || (result && !result.successful && result.feedbacks && result.feedbacks.length)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "733aefae9d2eca47ebaf74bc95a0ba67490fe5c4"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjUxMTk4Ng==", "bodyText": "The whole feedback available logic is what caused the problems in the first place. I also think submission.isBuildFailed is a stronger check than result.successful. Added a check for the result. If no result is available we don't need to check for build logs.", "url": "https://github.com/ls1intum/Artemis/pull/2046#discussion_r476511986", "createdAt": "2020-08-25T14:52:47Z", "author": {"login": "kloessst"}, "path": "src/main/webapp/app/exercises/programming/shared/code-editor/build-output/code-editor-build-output.component.ts", "diffHunk": "@@ -182,15 +183,14 @@ export class CodeEditorBuildOutputComponent implements AfterViewInit, OnInit, On\n \n     /**\n      * Decides if the build log should be shown.\n-     * If All tests were successful or there is test feedback -> don't show build logs.\n-     * Else -> show build logs.\n+     * Fetch the build logs only if the submission could not be build\n      * @param result\n      */\n     fetchBuildResults(result: Result | null): Observable<BuildLogEntry[] | null> {\n-        if ((result && result.successful) || (result && !result.successful && result.feedbacks && result.feedbacks.length)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMwODI1Nw=="}, "originalCommit": {"oid": "733aefae9d2eca47ebaf74bc95a0ba67490fe5c4"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3Nzc4NzMwOnYy", "diffSide": "RIGHT", "path": "src/main/webapp/app/exercises/programming/shared/code-editor/build-output/code-editor-build-output.component.ts", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwOToyNTozN1rOHGPmaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMzoyNToyOVrOHGX8Tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMwOTA5Nw==", "bodyText": "should we handle the (edge) case that result?.submission is not available and then try to get the build logs anyway? In such a case it would be fine if the server throws a 403, because it should not happen. And in case the submission is not available (for whatever reason) and the build has failed, the user experience would be better", "url": "https://github.com/ls1intum/Artemis/pull/2046#discussion_r476309097", "createdAt": "2020-08-25T09:25:37Z", "author": {"login": "krusche"}, "path": "src/main/webapp/app/exercises/programming/shared/code-editor/build-output/code-editor-build-output.component.ts", "diffHunk": "@@ -182,15 +183,14 @@ export class CodeEditorBuildOutputComponent implements AfterViewInit, OnInit, On\n \n     /**\n      * Decides if the build log should be shown.\n-     * If All tests were successful or there is test feedback -> don't show build logs.\n-     * Else -> show build logs.\n+     * Fetch the build logs only if the submission could not be build\n      * @param result\n      */\n     fetchBuildResults(result: Result | null): Observable<BuildLogEntry[] | null> {\n-        if ((result && result.successful) || (result && !result.successful && result.feedbacks && result.feedbacks.length)) {\n-            return of([]);\n-        } else {\n+        if ((result?.submission as ProgrammingSubmission).buildFailed) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "733aefae9d2eca47ebaf74bc95a0ba67490fe5c4"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ0NTc3NQ==", "bodyText": "Sounds good to me", "url": "https://github.com/ls1intum/Artemis/pull/2046#discussion_r476445775", "createdAt": "2020-08-25T13:25:29Z", "author": {"login": "kloessst"}, "path": "src/main/webapp/app/exercises/programming/shared/code-editor/build-output/code-editor-build-output.component.ts", "diffHunk": "@@ -182,15 +183,14 @@ export class CodeEditorBuildOutputComponent implements AfterViewInit, OnInit, On\n \n     /**\n      * Decides if the build log should be shown.\n-     * If All tests were successful or there is test feedback -> don't show build logs.\n-     * Else -> show build logs.\n+     * Fetch the build logs only if the submission could not be build\n      * @param result\n      */\n     fetchBuildResults(result: Result | null): Observable<BuildLogEntry[] | null> {\n-        if ((result && result.successful) || (result && !result.successful && result.feedbacks && result.feedbacks.length)) {\n-            return of([]);\n-        } else {\n+        if ((result?.submission as ProgrammingSubmission).buildFailed) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMwOTA5Nw=="}, "originalCommit": {"oid": "733aefae9d2eca47ebaf74bc95a0ba67490fe5c4"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4650, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}