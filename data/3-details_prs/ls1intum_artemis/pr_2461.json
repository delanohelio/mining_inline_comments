{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2NjI4MjM5", "number": 2461, "title": "[Bugfix] Start Assessment from Exercise Scores View", "bodyText": "Checklist\n\n I tested all changes and all related features with different users (student, tutor, instructor, admin) on the test server https://artemistest.ase.in.tum.de.\n Server: I followed the coding and design guidelines.\n Server: I added multiple integration tests (Spring) related to the features (with a high test coverage)\n Server: I added @PreAuthorize and check the course groups for all new REST Calls (security)\n Server: I implemented the changes with a good performance and prevented too many database calls\n Server: I documented the Java code using JavaDoc style.\n Client: I followed the coding and design guidelines.\n Client: I documented the TypeScript code using JSDoc style.\n Client: I added multiple screenshots/screencasts of my UI changes\n\nMotivation and Context\n\n\nAdded back functionality to make an assessment for a specific submission.\nDescription\n\n\nAdded new Endpoint to lock a submission for a specific participation\nAdded check in exercise scores view to be consistent with other exercise types\nAdded check in exercise scores to not display View Assessment button when programming exercise allows no manual result\nNew Endpoint is used in resolver for route\n\nSteps for Testing\n\n\nLog in to Artemis\nNavigate to Course Administration (you need a programming exercise with participations)\nGo to Exercise Score view\nClick on View Assessment button, you should see the assessment if it exists or get the lock for the assessment\nCheck how many locks you have -> Assessment Dashboard -> Assessments locked by you (see also Screenshots section)\n\n\nTest Coverage\n\n\n\nScreenshots\n\n\nAssessments locked by me before trying to assess via exercise score view:\n\nView Assessment button is now visible all the time and when clicking it and no assessment was yet started you will get the lock:\n\nAfter clicking on View Assessment button 2 times for not yet startet assessments:", "createdAt": "2020-11-24T17:02:21Z", "url": "https://github.com/ls1intum/Artemis/pull/2461", "merged": true, "mergeCommit": {"oid": "114bce6ee2a41ac24f89d881b52fccbd4875cd18"}, "closed": true, "closedAt": "2020-11-24T21:15:11Z", "author": {"login": "fde312"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfsui4gH2gAyNTI2NjI4MjM5OmZjN2YxMTJkMzlmMDQ0YzJmM2NiMWRjMzY1ZWY1MmFiM2NlMDI0YzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdfwbNXgFqTUzNzkzNTgxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fc7f112d39f044c2f3cb1dc365ef52ab3ce024c1", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/fc7f112d39f044c2f3cb1dc365ef52ab3ce024c1", "committedDate": "2020-11-24T16:55:33Z", "message": "rename method for fileUpload"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93edf6ff6a50480e0b5ad85391043ed4876c935b", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/93edf6ff6a50480e0b5ad85391043ed4876c935b", "committedDate": "2020-11-24T16:55:54Z", "message": "throw error if no manual result was found"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfcdbdb30d499350b47d8a269e2f87729dc5bba2", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/cfcdbdb30d499350b47d8a269e2f87729dc5bba2", "committedDate": "2020-11-24T16:58:15Z", "message": "implement new endpoint to lock a specific submission"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd4f243ed59273bfa11d5cf6ddda5dcb4022a092", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/fd4f243ed59273bfa11d5cf6ddda5dcb4022a092", "committedDate": "2020-11-24T17:00:07Z", "message": "reach endpoint on client"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4c496169a9e0c7f780aec2fbaaf4a6952ac3f29", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/b4c496169a9e0c7f780aec2fbaaf4a6952ac3f29", "committedDate": "2020-11-24T17:00:32Z", "message": "enable back assessment button in scores view"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3NzUxNzU5", "url": "https://github.com/ls1intum/Artemis/pull/2461#pullrequestreview-537751759", "createdAt": "2020-11-24T17:33:37Z", "commit": {"oid": "b4c496169a9e0c7f780aec2fbaaf4a6952ac3f29"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNzozMzozN1rOH5NwFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNzozMzozN1rOH5NwFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc1NjE4Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * GET /programming-submissions/:id : get the programmingSubmissions participation by it's id and locks the corresponding submission for assessment\n          \n          \n            \n                 * GET /programming-submissions/:participationId/lock : get the programmingSubmissions participation by it's id and locks the corresponding submission for assessment", "url": "https://github.com/ls1intum/Artemis/pull/2461#discussion_r529756183", "createdAt": "2020-11-24T17:33:37Z", "author": {"login": "fde312"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingSubmissionResource.java", "diffHunk": "@@ -347,6 +348,43 @@ public ProgrammingSubmissionResource(ProgrammingSubmissionService programmingSub\n         return ResponseEntity.ok().body(programmingSubmissions);\n     }\n \n+    // TODO: Make this call use submissionId instead of participationId (after implementation of one to many relation ship of submission and results)\n+    /**\n+     * GET /programming-submissions/:id : get the programmingSubmissions participation by it's id and locks the corresponding submission for assessment", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4c496169a9e0c7f780aec2fbaaf4a6952ac3f29"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3NzU1MDM1", "url": "https://github.com/ls1intum/Artemis/pull/2461#pullrequestreview-537755035", "createdAt": "2020-11-24T17:37:46Z", "commit": {"oid": "b4c496169a9e0c7f780aec2fbaaf4a6952ac3f29"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNzozNzo0NlrOH5N6Yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNzozNzo0NlrOH5N6Yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc1ODgxOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        Result latestAutomaticResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.AUTOMATIC)\n          \n          \n            \n                                .sorted(Comparator.comparing(Result::getId).reversed()).iterator().next();\n          \n          \n            \n                        Result latestAutomaticResult = participation.findLatestResult();", "url": "https://github.com/ls1intum/Artemis/pull/2461#discussion_r529758818", "createdAt": "2020-11-24T17:37:46Z", "author": {"login": "fde312"}, "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingSubmissionResource.java", "diffHunk": "@@ -347,6 +348,43 @@ public ProgrammingSubmissionResource(ProgrammingSubmissionService programmingSub\n         return ResponseEntity.ok().body(programmingSubmissions);\n     }\n \n+    // TODO: Make this call use submissionId instead of participationId (after implementation of one to many relation ship of submission and results)\n+    /**\n+     * GET /programming-submissions/:id : get the programmingSubmissions participation by it's id and locks the corresponding submission for assessment\n+     *\n+     * @param participationId the id of the participation to retrieve\n+     * @return the ResponseEntity with status 200 (OK) and with body the programmingSubmissions participation\n+     */\n+    @GetMapping(\"/programming-submissions/{participationId}/lock\")\n+    @PreAuthorize(\"hasAnyRole('TA','INSTRUCTOR','ADMIN')\")\n+    public ResponseEntity<Participation> lockAndGetProgrammingSubmissionParticipation(@PathVariable Long participationId) {\n+        log.debug(\"REST request to get ProgrammingSubmission of Participation with id: {}\", participationId);\n+        final var participation = participationService.findOneWithEagerResultsAndCourse(participationId);\n+        final var exercise = participation.getExercise();\n+        final User user = userService.getUserWithGroupsAndAuthorities();\n+\n+        if (!authCheckService.isAtLeastTeachingAssistantForExercise(exercise, user)) {\n+            return forbidden();\n+        }\n+\n+        Optional<Result> manualResult = participation.getResults().stream().filter(Result::isManualResult).findFirst();\n+\n+        if (manualResult.isPresent()) {\n+            return ResponseEntity.ok(participation);\n+        }\n+        else {\n+            // Check lock limit\n+            programmingSubmissionService.checkSubmissionLockLimit(exercise.getCourseViaExerciseGroupOrCourseMember().getId());\n+\n+            // As no manual result is present we need to lock the submission for assessment\n+            Result latestAutomaticResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.AUTOMATIC)\n+                    .sorted(Comparator.comparing(Result::getId).reversed()).iterator().next();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4c496169a9e0c7f780aec2fbaaf4a6952ac3f29"}, "originalPosition": 80}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13f59e9747d900f74a51f2a59761f359580c6584", "author": {"user": {"login": "fde312", "name": "Francisco De las Casas Young"}}, "url": "https://github.com/ls1intum/Artemis/commit/13f59e9747d900f74a51f2a59761f359580c6584", "committedDate": "2020-11-24T17:40:48Z", "message": "Update programming-assessment.route.ts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb711600077ad8875d2dbec8f96fcb308db65dbf", "author": {"user": {"login": "fde312", "name": "Francisco De las Casas Young"}}, "url": "https://github.com/ls1intum/Artemis/commit/fb711600077ad8875d2dbec8f96fcb308db65dbf", "committedDate": "2020-11-24T17:42:10Z", "message": "Apply suggestions from code review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3NzQ4NTEy", "url": "https://github.com/ls1intum/Artemis/pull/2461#pullrequestreview-537748512", "createdAt": "2020-11-24T17:29:36Z", "commit": {"oid": "b4c496169a9e0c7f780aec2fbaaf4a6952ac3f29"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNzoyOTozNlrOH5Nl4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNzoyOTozNlrOH5Nl4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc1MzU3MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @param submissionId       the id of the programming submission\n          \n          \n            \n                 * @param submissionId the id of the programming submission", "url": "https://github.com/ls1intum/Artemis/pull/2461#discussion_r529753570", "createdAt": "2020-11-24T17:29:36Z", "author": {"login": "kloessst"}, "path": "src/main/java/de/tum/in/www1/artemis/service/ProgrammingSubmissionService.java", "diffHunk": "@@ -636,6 +636,21 @@ public ProgrammingSubmission findByIdWithEagerResultAndFeedback(long submissionI\n                 .orElseThrow(() -> new EntityNotFoundException(\"Programming submission with id \\\"\" + submissionId + \"\\\" does not exist\"));\n     }\n \n+    /**\n+     * Get the programming submission with the given ID from the database and lock the submission to prevent other tutors from receiving and assessing it.\n+     *\n+     * @param submissionId       the id of the programming submission", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4c496169a9e0c7f780aec2fbaaf4a6952ac3f29"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7588b0efe4cdb8ef5df27f2d894aa230e349cfc", "author": {"user": {"login": "fde312", "name": "Francisco De las Casas Young"}}, "url": "https://github.com/ls1intum/Artemis/commit/c7588b0efe4cdb8ef5df27f2d894aa230e349cfc", "committedDate": "2020-11-24T17:44:32Z", "message": "Apply suggestions from code review\n\nCo-authored-by: Stefan Kl\u00f6ss-Schuster <16407766+kloessst@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "465eb9305cb7cc24f1a402492a6b337f20c93c2d", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/465eb9305cb7cc24f1a402492a6b337f20c93c2d", "committedDate": "2020-11-24T18:24:58Z", "message": "run spotless and removed not used code and added check if user is instructor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83521209a640d21b1b6894d3710919e01dc2c418", "author": {"user": {"login": "fde312", "name": "Francisco De las Casas Young"}}, "url": "https://github.com/ls1intum/Artemis/commit/83521209a640d21b1b6894d3710919e01dc2c418", "committedDate": "2020-11-24T19:32:24Z", "message": "Merge branch 'develop' into bugfix/programming-exercises/allow-assessments-via-score-view"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cead85cada0ec00d8b50e267cec0b3e359d2331f", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/cead85cada0ec00d8b50e267cec0b3e359d2331f", "committedDate": "2020-11-24T20:11:38Z", "message": "add tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4704c200d8c236975be62367615704612ceead29", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/4704c200d8c236975be62367615704612ceead29", "committedDate": "2020-11-24T20:11:51Z", "message": "Merge branch 'bugfix/programming-exercises/allow-assessments-via-score-view' of https://github.com/ls1intum/Artemis into bugfix/programming-exercises/allow-assessments-via-score-view"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3ODg2OTIw", "url": "https://github.com/ls1intum/Artemis/pull/2461#pullrequestreview-537886920", "createdAt": "2020-11-24T20:41:32Z", "commit": {"oid": "4704c200d8c236975be62367615704612ceead29"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQyMDo0MTozMlrOH5UYcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQyMDo0MTozMlrOH5UYcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg2NDgxOA==", "bodyText": "We also need to disable that for purely automatic programming exercise.", "url": "https://github.com/ls1intum/Artemis/pull/2461#discussion_r529864818", "createdAt": "2020-11-24T20:41:32Z", "author": {"login": "MaisiKoleni"}, "path": "src/main/webapp/app/exercises/shared/exercise-scores/exercise-scores.component.html", "diffHunk": "@@ -235,15 +241,15 @@ <h2>\n                             Online editor\n                         </button>\n                         <button\n-                            *ngIf=\"exercise.course && isManualResult(value)\"\n+                            *ngIf=\"exercise.course\"\n                             [routerLink]=\"['/course-management', exercise.course?.id, 'programming-exercises', exercise.id, 'code-editor', value.participation.id, 'assessment']\"\n                             class=\"btn btn-primary btn-sm mr-1\"\n                         >\n                             <fa-icon [icon]=\"'folder-open'\" [fixedWidth]=\"true\"></fa-icon>\n                             {{ 'artemisApp.programmingSubmission.view' | translate }}\n                         </button>\n                         <button\n-                            *ngIf=\"exercise.exerciseGroup && isManualResult(value)\"\n+                            *ngIf=\"exercise.exerciseGroup\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4704c200d8c236975be62367615704612ceead29"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3ODg4MDYy", "url": "https://github.com/ls1intum/Artemis/pull/2461#pullrequestreview-537888062", "createdAt": "2020-11-24T20:43:19Z", "commit": {"oid": "4704c200d8c236975be62367615704612ceead29"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70289fe86efa6bcfc40ee6ae26bf9502c0ca7ef4", "author": {"user": null}, "url": "https://github.com/ls1intum/Artemis/commit/70289fe86efa6bcfc40ee6ae26bf9502c0ca7ef4", "committedDate": "2020-11-24T20:52:09Z", "message": "try to fix issue with when no manual result is enabled"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3OTI1NDQx", "url": "https://github.com/ls1intum/Artemis/pull/2461#pullrequestreview-537925441", "createdAt": "2020-11-24T21:08:18Z", "commit": {"oid": "70289fe86efa6bcfc40ee6ae26bf9502c0ca7ef4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3OTI1NTQz", "url": "https://github.com/ls1intum/Artemis/pull/2461#pullrequestreview-537925543", "createdAt": "2020-11-24T21:08:21Z", "commit": {"oid": "70289fe86efa6bcfc40ee6ae26bf9502c0ca7ef4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3OTI2NTgy", "url": "https://github.com/ls1intum/Artemis/pull/2461#pullrequestreview-537926582", "createdAt": "2020-11-24T21:08:54Z", "commit": {"oid": "70289fe86efa6bcfc40ee6ae26bf9502c0ca7ef4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3OTI5Njk0", "url": "https://github.com/ls1intum/Artemis/pull/2461#pullrequestreview-537929694", "createdAt": "2020-11-24T21:10:35Z", "commit": {"oid": "70289fe86efa6bcfc40ee6ae26bf9502c0ca7ef4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3OTMxMzQy", "url": "https://github.com/ls1intum/Artemis/pull/2461#pullrequestreview-537931342", "createdAt": "2020-11-24T21:11:31Z", "commit": {"oid": "70289fe86efa6bcfc40ee6ae26bf9502c0ca7ef4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3OTM1ODE5", "url": "https://github.com/ls1intum/Artemis/pull/2461#pullrequestreview-537935819", "createdAt": "2020-11-24T21:14:03Z", "commit": {"oid": "70289fe86efa6bcfc40ee6ae26bf9502c0ca7ef4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3313, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}