{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxMTQ4NjI0", "number": 145, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQyMToxMDozNFrODW_ARg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQyMToyNDo1MlrODW_OCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1NDI3NTI2OnYy", "diffSide": "RIGHT", "path": "google-cloud-bigtable/src/main/java/com/google/cloud/bigtable/data/v2/stub/mutaterows/MutateRowsBatchingDescriptor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQyMToxMDozNFrOFcDdQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQyMToxMDozNFrOFcDdQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDk2MTA4OQ==", "bodyText": "lets rename batch to entries", "url": "https://github.com/googleapis/java-bigtable/pull/145#discussion_r364961089", "createdAt": "2020-01-09T21:10:34Z", "author": {"login": "igorbernstein2"}, "path": "google-cloud-bigtable/src/main/java/com/google/cloud/bigtable/data/v2/stub/mutaterows/MutateRowsBatchingDescriptor.java", "diffHunk": "@@ -45,9 +46,9 @@\n   }\n \n   @Override\n-  public void splitResponse(Void response, List<SettableApiFuture<Void>> batch) {\n-    for (SettableApiFuture<Void> batchResponse : batch) {\n-      batchResponse.set(null);\n+  public void splitResponse(Void response, List<BatchEntry<RowMutationEntry, Void>> batch) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5693e6e6438b9308aa9f793e6ca12e77c3366d9c"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1NDI3NTUyOnYy", "diffSide": "RIGHT", "path": "google-cloud-bigtable/src/main/java/com/google/cloud/bigtable/data/v2/stub/mutaterows/MutateRowsBatchingDescriptor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQyMToxMDo0MlrOFcDdaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQyMToxMDo0MlrOFcDdaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDk2MTEyOA==", "bodyText": "lets rename batch to entries", "url": "https://github.com/googleapis/java-bigtable/pull/145#discussion_r364961128", "createdAt": "2020-01-09T21:10:42Z", "author": {"login": "igorbernstein2"}, "path": "google-cloud-bigtable/src/main/java/com/google/cloud/bigtable/data/v2/stub/mutaterows/MutateRowsBatchingDescriptor.java", "diffHunk": "@@ -58,10 +59,10 @@ public void splitResponse(Void response, List<SettableApiFuture<Void>> batch) {\n    * entries whose index is mentioned {@link MutateRowsException#getFailedMutations()}.\n    */\n   @Override\n-  public void splitException(Throwable throwable, List<SettableApiFuture<Void>> batch) {\n+  public void splitException(Throwable throwable, List<BatchEntry<RowMutationEntry, Void>> batch) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5693e6e6438b9308aa9f793e6ca12e77c3366d9c"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1NDI3OTQ2OnYy", "diffSide": "RIGHT", "path": "google-cloud-bigtable/src/test/java/com/google/cloud/bigtable/data/v2/stub/mutaterows/MutateRowsBatchingDescriptorTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQyMToxMjoxOFrOFcDf-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQyMToxMjoxOFrOFcDf-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDk2MTc4NA==", "bodyText": "The mutaterows descriptor shouldn't accept nulls, the check is missing, but lets keep the test correct:\nList<BatchEntry<RowMutationEntry, Void>> entries =\n        ImmutableList.of(\n            BatchEntry.create(\n                RowMutationEntry.create(\"key1\").deleteRow(), SettableApiFuture.<Void>create()),\n            BatchEntry.create(\n                RowMutationEntry.create(\"key2\").deleteRow(), SettableApiFuture.<Void>create()));", "url": "https://github.com/googleapis/java-bigtable/pull/145#discussion_r364961784", "createdAt": "2020-01-09T21:12:18Z", "author": {"login": "igorbernstein2"}, "path": "google-cloud-bigtable/src/test/java/com/google/cloud/bigtable/data/v2/stub/mutaterows/MutateRowsBatchingDescriptorTest.java", "diffHunk": "@@ -77,29 +78,35 @@ public void requestBuilderTest() {\n \n   @Test\n   public void splitResponseTest() {\n-    List<SettableApiFuture<Void>> batchResponse =\n-        ImmutableList.of(SettableApiFuture.<Void>create(), SettableApiFuture.<Void>create());\n-    assertThat(batchResponse.get(0).isDone()).isFalse();\n-    assertThat(batchResponse.get(1).isDone()).isFalse();\n+    BatchEntry<RowMutationEntry, Void> resultFuture1 = BatchEntry.create(null, SettableApiFuture.<Void>create());\n+    BatchEntry<RowMutationEntry, Void> resultFuture2 = BatchEntry.create(null, SettableApiFuture.<Void>create());\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5693e6e6438b9308aa9f793e6ca12e77c3366d9c"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1NDI4Mjk3OnYy", "diffSide": "RIGHT", "path": "google-cloud-bigtable/src/test/java/com/google/cloud/bigtable/data/v2/stub/mutaterows/MutateRowsBatchingDescriptorTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQyMToxMzo1NVrOFcDiOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQyMToxMzo1NVrOFcDiOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDk2MjM2MA==", "bodyText": "same as above:\nList<BatchEntry<RowMutationEntry, Void>> batchResponses =\n        ImmutableList.of(\n            BatchEntry.create(\n                RowMutationEntry.create(\"key1\").deleteRow(), SettableApiFuture.<Void>create()),\n            BatchEntry.create(\n                RowMutationEntry.create(\"key2\").deleteRow(), SettableApiFuture.<Void>create()));", "url": "https://github.com/googleapis/java-bigtable/pull/145#discussion_r364962360", "createdAt": "2020-01-09T21:13:55Z", "author": {"login": "igorbernstein2"}, "path": "google-cloud-bigtable/src/test/java/com/google/cloud/bigtable/data/v2/stub/mutaterows/MutateRowsBatchingDescriptorTest.java", "diffHunk": "@@ -77,29 +78,35 @@ public void requestBuilderTest() {\n \n   @Test\n   public void splitResponseTest() {\n-    List<SettableApiFuture<Void>> batchResponse =\n-        ImmutableList.of(SettableApiFuture.<Void>create(), SettableApiFuture.<Void>create());\n-    assertThat(batchResponse.get(0).isDone()).isFalse();\n-    assertThat(batchResponse.get(1).isDone()).isFalse();\n+    BatchEntry<RowMutationEntry, Void> resultFuture1 = BatchEntry.create(null, SettableApiFuture.<Void>create());\n+    BatchEntry<RowMutationEntry, Void> resultFuture2 = BatchEntry.create(null, SettableApiFuture.<Void>create());\n+\n+    List<BatchEntry<RowMutationEntry, Void>> batchResponse =\n+        ImmutableList.of(resultFuture1, resultFuture2);\n+    assertThat(batchResponse.get(0).getResultFuture().isDone()).isFalse();\n+    assertThat(batchResponse.get(1).getResultFuture().isDone()).isFalse();\n \n     MutateRowsBatchingDescriptor underTest = new MutateRowsBatchingDescriptor();\n     underTest.splitResponse(null, batchResponse);\n-    assertThat(batchResponse.get(0).isDone()).isTrue();\n-    assertThat(batchResponse.get(1).isDone()).isTrue();\n+    assertThat(batchResponse.get(0).getResultFuture().isDone()).isTrue();\n+    assertThat(batchResponse.get(1).getResultFuture().isDone()).isTrue();\n   }\n \n   @Test\n   public void splitExceptionTest() {\n+    BatchEntry<RowMutationEntry, Void> resultFuture1 = BatchEntry.create(null, SettableApiFuture.<Void>create());\n+    BatchEntry<RowMutationEntry, Void> resultFuture2 = BatchEntry.create(null, SettableApiFuture.<Void>create());\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5693e6e6438b9308aa9f793e6ca12e77c3366d9c"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1NDI4NzI2OnYy", "diffSide": "RIGHT", "path": "google-cloud-bigtable/src/test/java/com/google/cloud/bigtable/data/v2/stub/mutaterows/MutateRowsBatchingDescriptorTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQyMToxNTozM1rOFcDk3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQyMToxNTozM1rOFcDk3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDk2MzAzOQ==", "bodyText": "similar to above, don't use null", "url": "https://github.com/googleapis/java-bigtable/pull/145#discussion_r364963039", "createdAt": "2020-01-09T21:15:33Z", "author": {"login": "igorbernstein2"}, "path": "google-cloud-bigtable/src/test/java/com/google/cloud/bigtable/data/v2/stub/mutaterows/MutateRowsBatchingDescriptorTest.java", "diffHunk": "@@ -110,9 +117,9 @@ public void splitExceptionTest() {\n   public void splitExceptionWithFailedMutationsTest() {\n     MutateRowsBatchingDescriptor underTest = new MutateRowsBatchingDescriptor();\n     Throwable actualThrowable = null;\n-    SettableApiFuture<Void> resultFuture1 = SettableApiFuture.create();\n-    SettableApiFuture<Void> resultFuture2 = SettableApiFuture.create();\n-    SettableApiFuture<Void> resultFuture3 = SettableApiFuture.create();\n+    BatchEntry<RowMutationEntry, Void> resultFuture1 = BatchEntry.create(null, SettableApiFuture.<Void>create());\n+    BatchEntry<RowMutationEntry, Void> resultFuture2 = BatchEntry.create(null, SettableApiFuture.<Void>create());\n+    BatchEntry<RowMutationEntry, Void> resultFuture3 = BatchEntry.create(null, SettableApiFuture.<Void>create());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5693e6e6438b9308aa9f793e6ca12e77c3366d9c"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1NDMwOTg3OnYy", "diffSide": "RIGHT", "path": "google-cloud-bigtable/src/main/java/com/google/cloud/bigtable/data/v2/stub/mutaterows/MutateRowsBatchingDescriptor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQyMToyNDozNFrOFcDyyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQyMToyNDozNFrOFcDyyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDk2NjYwMQ==", "bodyText": "s/future/entry", "url": "https://github.com/googleapis/java-bigtable/pull/145#discussion_r364966601", "createdAt": "2020-01-09T21:24:34Z", "author": {"login": "igorbernstein2"}, "path": "google-cloud-bigtable/src/main/java/com/google/cloud/bigtable/data/v2/stub/mutaterows/MutateRowsBatchingDescriptor.java", "diffHunk": "@@ -58,10 +58,11 @@ public void splitResponse(Void response, List<SettableApiFuture<Void>> batch) {\n    * entries whose index is mentioned {@link MutateRowsException#getFailedMutations()}.\n    */\n   @Override\n-  public void splitException(Throwable throwable, List<SettableApiFuture<Void>> batch) {\n+  public void splitException(\n+      Throwable throwable, List<BatchEntry<RowMutationEntry, Void>> entries) {\n     if (!(throwable instanceof MutateRowsException)) {\n-      for (SettableApiFuture<Void> future : batch) {\n-        future.setException(throwable);\n+      for (BatchEntry<RowMutationEntry, Void> future : entries) {\n+        future.getResultFuture().setException(throwable);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d5e153c2b4be0b1fb999c971fd6131991788825"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1NDMxMDUwOnYy", "diffSide": "RIGHT", "path": "google-cloud-bigtable/src/main/java/com/google/cloud/bigtable/data/v2/stub/mutaterows/MutateRowsBatchingDescriptor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQyMToyNDo1MlrOFcDzKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQyMToyNDo1MlrOFcDzKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDk2NjY5OQ==", "bodyText": "s/entryResultFuture/entry", "url": "https://github.com/googleapis/java-bigtable/pull/145#discussion_r364966699", "createdAt": "2020-01-09T21:24:52Z", "author": {"login": "igorbernstein2"}, "path": "google-cloud-bigtable/src/main/java/com/google/cloud/bigtable/data/v2/stub/mutaterows/MutateRowsBatchingDescriptor.java", "diffHunk": "@@ -74,12 +75,12 @@ public void splitException(Throwable throwable, List<SettableApiFuture<Void>> ba\n     }\n \n     int i = 0;\n-    for (SettableApiFuture<Void> entryResultFuture : batch) {\n+    for (BatchEntry<RowMutationEntry, Void> entryResultFuture : entries) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d5e153c2b4be0b1fb999c971fd6131991788825"}, "originalPosition": 42}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3415, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}