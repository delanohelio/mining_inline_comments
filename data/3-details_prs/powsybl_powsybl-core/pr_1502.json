{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3ODY1MDc1", "number": 1502, "title": "[IIDM] Allow to reuse ShuntCompensatorAdder twice", "bodyText": "Signed-off-by: Thomas ADAM tadam@silicom.fr\nPlease check if the PR fulfills these requirements (please use '[x]' to check the checkboxes, or submit the PR and then click the checkboxes)\n\n The commit message follows our guidelines\n Tests for the changes have been added (for bug fixes / features)\n Docs have been added / updated (for bug fixes / features)\n\nDoes this PR already have an issue describing the problem ? If so, link to this issue using '#XXX' and skip the rest\n'#1489'\nOther information:\nOnly ShuntCompensator part of issue is done on this PR", "createdAt": "2020-10-05T13:43:09Z", "url": "https://github.com/powsybl/powsybl-core/pull/1502", "merged": true, "mergeCommit": {"oid": "b591ff13f5b6f4b39cb96fafccf76e8d9018d0cf"}, "closed": true, "closedAt": "2020-10-16T08:39:39Z", "author": {"login": "tadam50"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdPj26EgH2gAyNDk3ODY1MDc1OjVhZjUzMmRhMjlmNTEyOTUyODFjNjQ0YjhlMDA4MTZiZDI3YjA2MmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdTCD8jgFqTUxMDI1NjQ2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5af532da29f51295281c644b8e00816bd27b062a", "author": {"user": {"login": "tadam50", "name": "Thomas ADAM"}}, "url": "https://github.com/powsybl/powsybl-core/commit/5af532da29f51295281c644b8e00816bd27b062a", "committedDate": "2020-10-05T13:32:45Z", "message": "Allow to reuse ShuntCompensatorAdder twice\n\nSigned-off-by: Thomas ADAM <tadam@silicom.fr>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MzQ0MjI1", "url": "https://github.com/powsybl/powsybl-core/pull/1502#pullrequestreview-506344225", "createdAt": "2020-10-12T07:07:41Z", "commit": {"oid": "5af532da29f51295281c644b8e00816bd27b062a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwNzowNzo0MVrOHfxlsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwNzoxMDowNFrOHfxpwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA4MDM2OQ==", "bodyText": "@MioRtia why the public API of ShuntCompensatorModel is empty? I would move everything except this method in the public API (i.e. outside the wrapper)", "url": "https://github.com/powsybl/powsybl-core/pull/1502#discussion_r503080369", "createdAt": "2020-10-12T07:07:41Z", "author": {"login": "mathbagu"}, "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/AbstractShuntCompensatorModel.java", "diffHunk": "@@ -19,9 +17,6 @@\n \n     @Override\n     public void setShuntCompensator(ShuntCompensatorImpl shuntCompensator) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5af532da29f51295281c644b8e00816bd27b062a"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA4MTE3Ng==", "bodyText": "I think this class is redundant with AbstractShuntCompensatorModel\n@MioRtia Is it ok if we remove it?", "url": "https://github.com/powsybl/powsybl-core/pull/1502#discussion_r503081176", "createdAt": "2020-10-12T07:09:33Z", "author": {"login": "mathbagu"}, "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ShuntCompensatorAdderImpl.java", "diffHunk": "@@ -177,6 +180,17 @@ public ShuntCompensatorAdder setTargetDeadband(double targetDeadband) {\n     public ShuntCompensatorImpl add() {\n         String id = checkAndGetUniqueId();\n         TerminalExt terminal = checkAndGetTerminal();\n+        ShuntCompensatorModelWrapper model = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5af532da29f51295281c644b8e00816bd27b062a"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA4MTQwOQ==", "bodyText": "I would perform the deep copy in the constructor of ShuntCompensatorNonLinearModelImpl (and document it)", "url": "https://github.com/powsybl/powsybl-core/pull/1502#discussion_r503081409", "createdAt": "2020-10-12T07:10:04Z", "author": {"login": "mathbagu"}, "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ShuntCompensatorAdderImpl.java", "diffHunk": "@@ -177,6 +180,17 @@ public ShuntCompensatorAdder setTargetDeadband(double targetDeadband) {\n     public ShuntCompensatorImpl add() {\n         String id = checkAndGetUniqueId();\n         TerminalExt terminal = checkAndGetTerminal();\n+        ShuntCompensatorModelWrapper model = null;\n+        if (shuntCompensatorLinearModelAdder != null) {\n+            model = new ShuntCompensatorLinearModelImpl(shuntCompensatorLinearModelAdder.bPerSection,\n+                                                        shuntCompensatorLinearModelAdder.gPerSection,\n+                                                        shuntCompensatorLinearModelAdder.maximumSectionCount);\n+        } else if (shuntCompensatorNonLinearModelAdder != null) {\n+            model = new ShuntCompensatorNonLinearModelImpl(shuntCompensatorNonLinearModelAdder.sections.stream()\n+                                                                                                       .map(ShuntCompensatorNonLinearModelImpl.SectionImpl::copy)\n+                                                                                                       .collect(Collectors.toList()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5af532da29f51295281c644b8e00816bd27b062a"}, "originalPosition": 63}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb5f85b0264802c1b3b91d9bca1e2ba3aa5ec2f1", "author": {"user": {"login": "tadam50", "name": "Thomas ADAM"}}, "url": "https://github.com/powsybl/powsybl-core/commit/fb5f85b0264802c1b3b91d9bca1e2ba3aa5ec2f1", "committedDate": "2020-10-12T08:16:52Z", "message": "Remove ShuntCompensatorModelWrapper class\n\nSigned-off-by: Thomas ADAM <tadam@silicom.fr>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e1a8478f0f75fdaed96d5760ab0aab678a9f611", "author": {"user": {"login": "tadam50", "name": "Thomas ADAM"}}, "url": "https://github.com/powsybl/powsybl-core/commit/0e1a8478f0f75fdaed96d5760ab0aab678a9f611", "committedDate": "2020-10-12T08:39:48Z", "message": "Move sections deep copy into ShuntCompensatorNonLinearModel constructor\n\nSigned-off-by: Thomas ADAM <tadam@silicom.fr>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "383cc724d98ae8a3f6969c4174368069b14575cb", "author": {"user": {"login": "tadam50", "name": "Thomas ADAM"}}, "url": "https://github.com/powsybl/powsybl-core/commit/383cc724d98ae8a3f6969c4174368069b14575cb", "committedDate": "2020-10-13T08:16:50Z", "message": "Move internal adder set into add method\n\nSigned-off-by: Thomas ADAM <tadam@silicom.fr>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MjE1Nzgx", "url": "https://github.com/powsybl/powsybl-core/pull/1502#pullrequestreview-509215781", "createdAt": "2020-10-15T10:02:02Z", "commit": {"oid": "383cc724d98ae8a3f6969c4174368069b14575cb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMDowMjowM1rOHiAV7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMDowNDoxMFrOHiAazw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQxOTI0NA==", "bodyText": "This is not sufficient to ensure someone don't set two different models. You should introduce a common interface or reset the corresponding attribute in the add methods.", "url": "https://github.com/powsybl/powsybl-core/pull/1502#discussion_r505419244", "createdAt": "2020-10-15T10:02:03Z", "author": {"login": "mathbagu"}, "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ShuntCompensatorAdderImpl.java", "diffHunk": "@@ -18,7 +18,9 @@\n \n     private final VoltageLevelExt voltageLevel;\n \n-    private ShuntCompensatorModelWrapper model;\n+    private ShuntCompensatorNonLinearModelAdderImpl shuntCompensatorNonLinearModelAdder;\n+\n+    private ShuntCompensatorLinearModelAdderImpl shuntCompensatorLinearModelAdder;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "383cc724d98ae8a3f6969c4174368069b14575cb"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQxOTUyNg==", "bodyText": "See my previous comment.", "url": "https://github.com/powsybl/powsybl-core/pull/1502#discussion_r505419526", "createdAt": "2020-10-15T10:02:27Z", "author": {"login": "mathbagu"}, "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ShuntCompensatorAdderImpl.java", "diffHunk": "@@ -177,6 +179,15 @@ public ShuntCompensatorAdder setTargetDeadband(double targetDeadband) {\n     public ShuntCompensatorImpl add() {\n         String id = checkAndGetUniqueId();\n         TerminalExt terminal = checkAndGetTerminal();\n+        AbstractShuntCompensatorModel model = null;\n+        if (shuntCompensatorLinearModelAdder != null) {\n+            model = new ShuntCompensatorLinearModelImpl(shuntCompensatorLinearModelAdder.bPerSection,\n+                                                        shuntCompensatorLinearModelAdder.gPerSection,\n+                                                        shuntCompensatorLinearModelAdder.maximumSectionCount);\n+        } else if (shuntCompensatorNonLinearModelAdder != null) {\n+            model = new ShuntCompensatorNonLinearModelImpl(shuntCompensatorNonLinearModelAdder.sections);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "383cc724d98ae8a3f6969c4174368069b14575cb"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQyMDQ5NQ==", "bodyText": "I think clone is more commonly used", "url": "https://github.com/powsybl/powsybl-core/pull/1502#discussion_r505420495", "createdAt": "2020-10-15T10:04:10Z", "author": {"login": "mathbagu"}, "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ShuntCompensatorNonLinearModelImpl.java", "diffHunk": "@@ -60,6 +61,10 @@ public Section setG(double g) {\n             return this;\n         }\n \n+        public SectionImpl copy() {\n+            return new SectionImpl(index, b, g);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "383cc724d98ae8a3f6969c4174368069b14575cb"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3ffd287c407c0e4580dd142a6173819894d5138", "author": {"user": {"login": "tadam50", "name": "Thomas ADAM"}}, "url": "https://github.com/powsybl/powsybl-core/commit/f3ffd287c407c0e4580dd142a6173819894d5138", "committedDate": "2020-10-15T13:03:08Z", "message": "Taking into account PR reviews\n\nSigned-off-by: Thomas ADAM <tadam@silicom.fr>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58e312ebed63d104b7888d2fb97fb1445fa16999", "author": {"user": {"login": "mathbagu", "name": "Mathieu BAGUE"}}, "url": "https://github.com/powsybl/powsybl-core/commit/58e312ebed63d104b7888d2fb97fb1445fa16999", "committedDate": "2020-10-16T08:25:44Z", "message": "Merge branch 'master' into issue_1489_shunt"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwMjU2NDY3", "url": "https://github.com/powsybl/powsybl-core/pull/1502#pullrequestreview-510256467", "createdAt": "2020-10-16T08:25:55Z", "commit": {"oid": "58e312ebed63d104b7888d2fb97fb1445fa16999"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4048, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}