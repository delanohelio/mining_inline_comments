{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5NDM2ODc0", "number": 1511, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwODoyMDoyM1rOErgAHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwODoyMjowMFrOErgCtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0MDQ4NTQzOnYy", "diffSide": "RIGHT", "path": "computation/src/main/java/com/powsybl/computation/DefaultExecutionReport.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwODoyMDoyM1rOHeTMAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxMjoyMTo1MFrOHeb5jQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUzMzY5OQ==", "bodyText": "Is it relevant to make a constructor without parameters with a default directory (maybe not)(don't forget the Breaking change label if it is not the case)?", "url": "https://github.com/powsybl/powsybl-core/pull/1511#discussion_r501533699", "createdAt": "2020-10-08T08:20:23Z", "author": {"login": "miovd"}, "path": "computation/src/main/java/com/powsybl/computation/DefaultExecutionReport.java", "diffHunk": "@@ -22,29 +27,22 @@\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(DefaultExecutionReport.class);\n \n-    private static final ExecutionReport OK = new DefaultExecutionReport();\n+    private final Path workingDirectory;\n \n     private final List<ExecutionError> errors;\n \n-    /**\n-     * An execution report with no execution error.\n-     * @return an execution report with no execution error.\n-     */\n-    public static ExecutionReport ok() {\n-        return OK;\n-    }\n-\n     /**\n      * Create an execution report with no execution error.\n      */\n-    public DefaultExecutionReport() {\n-        this(Collections.emptyList());\n+    public DefaultExecutionReport(Path workingDirectory) {\n+        this(workingDirectory, Collections.emptyList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "079607f86606b0cc200ae09fc5d93a6a049c929d"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU0ODM0OA==", "bodyText": "Not sure it's relevant to have a default constructor. The working directory is the temporary directory used during the execution. From my point of view, computations always run in a temporary directory, even if no data are stored in it, it's created by the computation manager (part of the API).", "url": "https://github.com/powsybl/powsybl-core/pull/1511#discussion_r501548348", "createdAt": "2020-10-08T08:43:30Z", "author": {"login": "mathbagu"}, "path": "computation/src/main/java/com/powsybl/computation/DefaultExecutionReport.java", "diffHunk": "@@ -22,29 +27,22 @@\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(DefaultExecutionReport.class);\n \n-    private static final ExecutionReport OK = new DefaultExecutionReport();\n+    private final Path workingDirectory;\n \n     private final List<ExecutionError> errors;\n \n-    /**\n-     * An execution report with no execution error.\n-     * @return an execution report with no execution error.\n-     */\n-    public static ExecutionReport ok() {\n-        return OK;\n-    }\n-\n     /**\n      * Create an execution report with no execution error.\n      */\n-    public DefaultExecutionReport() {\n-        this(Collections.emptyList());\n+    public DefaultExecutionReport(Path workingDirectory) {\n+        this(workingDirectory, Collections.emptyList());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUzMzY5OQ=="}, "originalCommit": {"oid": "079607f86606b0cc200ae09fc5d93a6a049c929d"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTY3NjQyOQ==", "bodyText": "Okay!", "url": "https://github.com/powsybl/powsybl-core/pull/1511#discussion_r501676429", "createdAt": "2020-10-08T12:21:50Z", "author": {"login": "miovd"}, "path": "computation/src/main/java/com/powsybl/computation/DefaultExecutionReport.java", "diffHunk": "@@ -22,29 +27,22 @@\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(DefaultExecutionReport.class);\n \n-    private static final ExecutionReport OK = new DefaultExecutionReport();\n+    private final Path workingDirectory;\n \n     private final List<ExecutionError> errors;\n \n-    /**\n-     * An execution report with no execution error.\n-     * @return an execution report with no execution error.\n-     */\n-    public static ExecutionReport ok() {\n-        return OK;\n-    }\n-\n     /**\n      * Create an execution report with no execution error.\n      */\n-    public DefaultExecutionReport() {\n-        this(Collections.emptyList());\n+    public DefaultExecutionReport(Path workingDirectory) {\n+        this(workingDirectory, Collections.emptyList());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUzMzY5OQ=="}, "originalCommit": {"oid": "079607f86606b0cc200ae09fc5d93a6a049c929d"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0MDQ4OTUxOnYy", "diffSide": "RIGHT", "path": "computation/src/main/java/com/powsybl/computation/DefaultExecutionReport.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwODoyMToyMVrOHeTOeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwODo0MDo0MlrOHeT-Og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUzNDMzMA==", "bodyText": "Sonarcloud said it is not useful to add the toString() method as the logger already formats paths", "url": "https://github.com/powsybl/powsybl-core/pull/1511#discussion_r501534330", "createdAt": "2020-10-08T08:21:21Z", "author": {"login": "miovd"}, "path": "computation/src/main/java/com/powsybl/computation/DefaultExecutionReport.java", "diffHunk": "@@ -65,4 +63,29 @@ public void log() {\n         }\n     }\n \n+    @Override\n+    public Optional<InputStream> getStdOut(Command command, int index) {\n+        return getOutputFile(command, index, \".out\");\n+    }\n+\n+    @Override\n+    public Optional<InputStream> getStdErr(Command command, int index) {\n+        return getOutputFile(command, index, \".err\");\n+    }\n+\n+    private Optional<InputStream> getOutputFile(Command command, int index, String extension) {\n+        Objects.requireNonNull(command);\n+        if (index < 0) {\n+            throw new IllegalArgumentException(\"Invalid index: \" + index);\n+        }\n+\n+        Path path = workingDirectory.resolve(command.getId() + \"_\" + index + extension);\n+        try {\n+            return Optional.of(Files.newInputStream(path));\n+        } catch (IOException e) {\n+            LOGGER.warn(\"Unable to read {}: {}\", path.toString(), e.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "079607f86606b0cc200ae09fc5d93a6a049c929d"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU0NjU1NA==", "bodyText": "Fixed in the last commit", "url": "https://github.com/powsybl/powsybl-core/pull/1511#discussion_r501546554", "createdAt": "2020-10-08T08:40:42Z", "author": {"login": "mathbagu"}, "path": "computation/src/main/java/com/powsybl/computation/DefaultExecutionReport.java", "diffHunk": "@@ -65,4 +63,29 @@ public void log() {\n         }\n     }\n \n+    @Override\n+    public Optional<InputStream> getStdOut(Command command, int index) {\n+        return getOutputFile(command, index, \".out\");\n+    }\n+\n+    @Override\n+    public Optional<InputStream> getStdErr(Command command, int index) {\n+        return getOutputFile(command, index, \".err\");\n+    }\n+\n+    private Optional<InputStream> getOutputFile(Command command, int index, String extension) {\n+        Objects.requireNonNull(command);\n+        if (index < 0) {\n+            throw new IllegalArgumentException(\"Invalid index: \" + index);\n+        }\n+\n+        Path path = workingDirectory.resolve(command.getId() + \"_\" + index + extension);\n+        try {\n+            return Optional.of(Files.newInputStream(path));\n+        } catch (IOException e) {\n+            LOGGER.warn(\"Unable to read {}: {}\", path.toString(), e.getMessage());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUzNDMzMA=="}, "originalCommit": {"oid": "079607f86606b0cc200ae09fc5d93a6a049c929d"}, "originalPosition": 83}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0MDQ5MjA0OnYy", "diffSide": "LEFT", "path": "computation/src/main/java/com/powsybl/computation/DefaultExecutionReport.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwODoyMjowMFrOHeTQEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwODo0MToyOFrOHeUAGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUzNDczOA==", "bodyText": "Just for me, when did we use this method? (Don't forget the Breaking change label if we delete it)", "url": "https://github.com/powsybl/powsybl-core/pull/1511#discussion_r501534738", "createdAt": "2020-10-08T08:22:00Z", "author": {"login": "miovd"}, "path": "computation/src/main/java/com/powsybl/computation/DefaultExecutionReport.java", "diffHunk": "@@ -22,29 +27,22 @@\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(DefaultExecutionReport.class);\n \n-    private static final ExecutionReport OK = new DefaultExecutionReport();\n+    private final Path workingDirectory;\n \n     private final List<ExecutionError> errors;\n \n-    /**\n-     * An execution report with no execution error.\n-     * @return an execution report with no execution error.\n-     */\n-    public static ExecutionReport ok() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "079607f86606b0cc200ae09fc5d93a6a049c929d"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU0NzAzNA==", "bodyText": "This was used only in the unit test, but it's really useful to return always the same instance.", "url": "https://github.com/powsybl/powsybl-core/pull/1511#discussion_r501547034", "createdAt": "2020-10-08T08:41:28Z", "author": {"login": "mathbagu"}, "path": "computation/src/main/java/com/powsybl/computation/DefaultExecutionReport.java", "diffHunk": "@@ -22,29 +27,22 @@\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(DefaultExecutionReport.class);\n \n-    private static final ExecutionReport OK = new DefaultExecutionReport();\n+    private final Path workingDirectory;\n \n     private final List<ExecutionError> errors;\n \n-    /**\n-     * An execution report with no execution error.\n-     * @return an execution report with no execution error.\n-     */\n-    public static ExecutionReport ok() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUzNDczOA=="}, "originalCommit": {"oid": "079607f86606b0cc200ae09fc5d93a6a049c929d"}, "originalPosition": 37}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4901, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}