{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI4NTUxNDU3", "number": 1338, "reviewThreads": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMDo1MTo1OVrOEDGEJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMTowODo0NlrOEDGT1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNjgwNTQ5OnYy", "diffSide": "RIGHT", "path": "psse/psse-converter/pom.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMDo1MTo1OVrOGf9A3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QxOTo0NTozMFrOGgLeEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE1ODY4NQ==", "bodyText": "Missing license header", "url": "https://github.com/powsybl/powsybl-core/pull/1338#discussion_r436158685", "createdAt": "2020-06-05T20:51:59Z", "author": {"login": "geofjamg"}, "path": "psse/psse-converter/pom.xml", "diffHunk": "@@ -0,0 +1,103 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f60c63f99a38726eae129d62ce038fa0dacef32c"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM5NTUzNg==", "bodyText": "OK", "url": "https://github.com/powsybl/powsybl-core/pull/1338#discussion_r436395536", "createdAt": "2020-06-07T19:45:30Z", "author": {"login": "JB-H"}, "path": "psse/psse-converter/pom.xml", "diffHunk": "@@ -0,0 +1,103 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE1ODY4NQ=="}, "originalCommit": {"oid": "f60c63f99a38726eae129d62ce038fa0dacef32c"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNjgwNjQwOnYy", "diffSide": "RIGHT", "path": "psse/psse-converter/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMDo1MjoyMlrOGf9BgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMDo1MjoyMlrOGf9BgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE1ODg0OQ==", "bodyText": "Do we need this dependency?", "url": "https://github.com/powsybl/powsybl-core/pull/1338#discussion_r436158849", "createdAt": "2020-06-05T20:52:22Z", "author": {"login": "geofjamg"}, "path": "psse/psse-converter/pom.xml", "diffHunk": "@@ -0,0 +1,103 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <parent>\n+        <artifactId>powsybl-psse</artifactId>\n+        <groupId>com.powsybl</groupId>\n+        <version>3.4.0-SNAPSHOT</version>\n+    </parent>\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <artifactId>powsybl-psse-converter</artifactId>\n+    <name>PSSE converter</name>\n+    <description>PSSE  Data Format to IIDM converter</description>\n+\n+    <dependencies>\n+        <!-- Compile dependencies -->\n+        <dependency>\n+            <groupId>${project.groupId}</groupId>\n+            <artifactId>powsybl-commons</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>${project.groupId}</groupId>\n+            <artifactId>powsybl-iidm-converter-api</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>${project.groupId}</groupId>\n+            <artifactId>powsybl-iidm-util</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>${project.groupId}</groupId>\n+            <artifactId>powsybl-psse-model</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>\n+        <dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f60c63f99a38726eae129d62ce038fa0dacef32c"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNjgwNzA1OnYy", "diffSide": "RIGHT", "path": "psse/psse-converter/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMDo1MjozOFrOGf9B8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMDo1MjozOFrOGf9B8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE1ODk2Mw==", "bodyText": "Do we need this dependency?", "url": "https://github.com/powsybl/powsybl-core/pull/1338#discussion_r436158963", "createdAt": "2020-06-05T20:52:38Z", "author": {"login": "geofjamg"}, "path": "psse/psse-converter/pom.xml", "diffHunk": "@@ -0,0 +1,103 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <parent>\n+        <artifactId>powsybl-psse</artifactId>\n+        <groupId>com.powsybl</groupId>\n+        <version>3.4.0-SNAPSHOT</version>\n+    </parent>\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <artifactId>powsybl-psse-converter</artifactId>\n+    <name>PSSE converter</name>\n+    <description>PSSE  Data Format to IIDM converter</description>\n+\n+    <dependencies>\n+        <!-- Compile dependencies -->\n+        <dependency>\n+            <groupId>${project.groupId}</groupId>\n+            <artifactId>powsybl-commons</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>${project.groupId}</groupId>\n+            <artifactId>powsybl-iidm-converter-api</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>${project.groupId}</groupId>\n+            <artifactId>powsybl-iidm-util</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>${project.groupId}</groupId>\n+            <artifactId>powsybl-psse-model</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>com.univocity</groupId>\n+            <artifactId>univocity-parsers</artifactId>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.slf4j</groupId>\n+            <artifactId>slf4j-api</artifactId>\n+        </dependency>\n+\n+        <!-- Test dependencies -->\n+        <dependency>\n+            <groupId>com.google.jimfs</groupId>\n+            <artifactId>jimfs</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>junit</groupId>\n+            <artifactId>junit</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.slf4j</groupId>\n+            <artifactId>slf4j-simple</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+\n+        <dependency>\n+            <groupId>${project.groupId}</groupId>\n+            <artifactId>powsybl-commons</artifactId>\n+            <version>${project.version}</version>\n+            <type>test-jar</type>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>${project.groupId}</groupId>\n+            <artifactId>powsybl-config-test</artifactId>\n+            <version>${project.version}</version>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>${project.groupId}</groupId>\n+            <artifactId>powsybl-iidm-impl</artifactId>\n+            <version>${project.version}</version>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>${project.groupId}</groupId>\n+            <artifactId>powsybl-iidm-xml-converter</artifactId>\n+            <version>${project.version}</version>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>${project.groupId}</groupId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f60c63f99a38726eae129d62ce038fa0dacef32c"}, "originalPosition": 90}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNjgwNzQwOnYy", "diffSide": "RIGHT", "path": "psse/psse-converter/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMDo1Mjo0N1rOGf9CMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMDo1Mjo0N1rOGf9CMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE1OTAyNQ==", "bodyText": "Do we need this dependency?", "url": "https://github.com/powsybl/powsybl-core/pull/1338#discussion_r436159025", "createdAt": "2020-06-05T20:52:47Z", "author": {"login": "geofjamg"}, "path": "psse/psse-converter/pom.xml", "diffHunk": "@@ -0,0 +1,103 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <parent>\n+        <artifactId>powsybl-psse</artifactId>\n+        <groupId>com.powsybl</groupId>\n+        <version>3.4.0-SNAPSHOT</version>\n+    </parent>\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <artifactId>powsybl-psse-converter</artifactId>\n+    <name>PSSE converter</name>\n+    <description>PSSE  Data Format to IIDM converter</description>\n+\n+    <dependencies>\n+        <!-- Compile dependencies -->\n+        <dependency>\n+            <groupId>${project.groupId}</groupId>\n+            <artifactId>powsybl-commons</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>${project.groupId}</groupId>\n+            <artifactId>powsybl-iidm-converter-api</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>${project.groupId}</groupId>\n+            <artifactId>powsybl-iidm-util</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>${project.groupId}</groupId>\n+            <artifactId>powsybl-psse-model</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>com.univocity</groupId>\n+            <artifactId>univocity-parsers</artifactId>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.slf4j</groupId>\n+            <artifactId>slf4j-api</artifactId>\n+        </dependency>\n+\n+        <!-- Test dependencies -->\n+        <dependency>\n+            <groupId>com.google.jimfs</groupId>\n+            <artifactId>jimfs</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>junit</groupId>\n+            <artifactId>junit</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.slf4j</groupId>\n+            <artifactId>slf4j-simple</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+\n+        <dependency>\n+            <groupId>${project.groupId}</groupId>\n+            <artifactId>powsybl-commons</artifactId>\n+            <version>${project.version}</version>\n+            <type>test-jar</type>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>${project.groupId}</groupId>\n+            <artifactId>powsybl-config-test</artifactId>\n+            <version>${project.version}</version>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>${project.groupId}</groupId>\n+            <artifactId>powsybl-iidm-impl</artifactId>\n+            <version>${project.version}</version>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>${project.groupId}</groupId>\n+            <artifactId>powsybl-iidm-xml-converter</artifactId>\n+            <version>${project.version}</version>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>${project.groupId}</groupId>\n+            <artifactId>powsybl-loadflow-results-completion</artifactId>\n+            <version>${project.version}</version>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f60c63f99a38726eae129d62ce038fa0dacef32c"}, "originalPosition": 95}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNjgwODc2OnYy", "diffSide": "RIGHT", "path": "psse/psse-converter/src/main/java/com/powsybl/psse/converter/PsseImporter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMDo1MzoxOVrOGf9DBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QxOTo0NTo1NFrOGgLeOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE1OTIzNg==", "bodyText": "2020", "url": "https://github.com/powsybl/powsybl-core/pull/1338#discussion_r436159236", "createdAt": "2020-06-05T20:53:19Z", "author": {"login": "geofjamg"}, "path": "psse/psse-converter/src/main/java/com/powsybl/psse/converter/PsseImporter.java", "diffHunk": "@@ -0,0 +1,358 @@\n+/**\n+ * Copyright (c) 2019, RTE (http://www.rte-france.com)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f60c63f99a38726eae129d62ce038fa0dacef32c"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM5NTU3OQ==", "bodyText": "ok", "url": "https://github.com/powsybl/powsybl-core/pull/1338#discussion_r436395579", "createdAt": "2020-06-07T19:45:54Z", "author": {"login": "JB-H"}, "path": "psse/psse-converter/src/main/java/com/powsybl/psse/converter/PsseImporter.java", "diffHunk": "@@ -0,0 +1,358 @@\n+/**\n+ * Copyright (c) 2019, RTE (http://www.rte-france.com)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE1OTIzNg=="}, "originalCommit": {"oid": "f60c63f99a38726eae129d62ce038fa0dacef32c"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNjgxMDU3OnYy", "diffSide": "RIGHT", "path": "psse/psse-converter/src/main/java/com/powsybl/psse/converter/PsseImporter.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMDo1NDoxMVrOGf9ENw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwNzoxMzoyOVrOGgRp8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE1OTU0Mw==", "bodyText": "Do we really need this option with PSS/E. It was relevant with IEEE CDF data but is it the case here?", "url": "https://github.com/powsybl/powsybl-core/pull/1338#discussion_r436159543", "createdAt": "2020-06-05T20:54:11Z", "author": {"login": "geofjamg"}, "path": "psse/psse-converter/src/main/java/com/powsybl/psse/converter/PsseImporter.java", "diffHunk": "@@ -0,0 +1,358 @@\n+/**\n+ * Copyright (c) 2019, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.psse.converter;\n+\n+import com.google.auto.service.AutoService;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.io.ByteStreams;\n+import com.powsybl.commons.datasource.DataSource;\n+import com.powsybl.commons.datasource.ReadOnlyDataSource;\n+import com.powsybl.iidm.ConversionParameters;\n+import com.powsybl.iidm.import_.Importer;\n+import com.powsybl.iidm.network.*;\n+import com.powsybl.iidm.network.util.ContainersMapping;\n+import com.powsybl.iidm.parameters.Parameter;\n+import com.powsybl.iidm.parameters.ParameterDefaultValueConfig;\n+import com.powsybl.iidm.parameters.ParameterType;\n+import com.powsybl.psse.model.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.*;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Properties;\n+import java.util.function.Predicate;\n+import java.util.function.ToDoubleFunction;\n+import java.util.function.ToIntFunction;\n+\n+/**\n+ * @author JB Heyberger <jean-baptiste.heyberger at rte-france.com>\n+ */\n+@AutoService(Importer.class)\n+public class PsseImporter implements Importer {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(PsseImporter.class);\n+\n+    private static final String FORMAT = \"PSS/E\";\n+\n+    private static final String EXT = \"raw\"; //TO DO: support both RAW and raw extensions\n+\n+    private static final Parameter IGNORE_BASE_VOLTAGE_PARAMETER = new Parameter(\"ignore-base-voltage\",\n+            ParameterType.BOOLEAN,\n+            \"Ignore base voltage specified in the file\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f60c63f99a38726eae129d62ce038fa0dacef32c"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM5NTU4Mw==", "bodyText": "For testing purposes it might be interesting as results might be expressed in voltage perunit. If not relevant, I suggest to remove it in another PR", "url": "https://github.com/powsybl/powsybl-core/pull/1338#discussion_r436395583", "createdAt": "2020-06-07T19:46:00Z", "author": {"login": "JB-H"}, "path": "psse/psse-converter/src/main/java/com/powsybl/psse/converter/PsseImporter.java", "diffHunk": "@@ -0,0 +1,358 @@\n+/**\n+ * Copyright (c) 2019, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.psse.converter;\n+\n+import com.google.auto.service.AutoService;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.io.ByteStreams;\n+import com.powsybl.commons.datasource.DataSource;\n+import com.powsybl.commons.datasource.ReadOnlyDataSource;\n+import com.powsybl.iidm.ConversionParameters;\n+import com.powsybl.iidm.import_.Importer;\n+import com.powsybl.iidm.network.*;\n+import com.powsybl.iidm.network.util.ContainersMapping;\n+import com.powsybl.iidm.parameters.Parameter;\n+import com.powsybl.iidm.parameters.ParameterDefaultValueConfig;\n+import com.powsybl.iidm.parameters.ParameterType;\n+import com.powsybl.psse.model.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.*;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Properties;\n+import java.util.function.Predicate;\n+import java.util.function.ToDoubleFunction;\n+import java.util.function.ToIntFunction;\n+\n+/**\n+ * @author JB Heyberger <jean-baptiste.heyberger at rte-france.com>\n+ */\n+@AutoService(Importer.class)\n+public class PsseImporter implements Importer {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(PsseImporter.class);\n+\n+    private static final String FORMAT = \"PSS/E\";\n+\n+    private static final String EXT = \"raw\"; //TO DO: support both RAW and raw extensions\n+\n+    private static final Parameter IGNORE_BASE_VOLTAGE_PARAMETER = new Parameter(\"ignore-base-voltage\",\n+            ParameterType.BOOLEAN,\n+            \"Ignore base voltage specified in the file\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE1OTU0Mw=="}, "originalCommit": {"oid": "f60c63f99a38726eae129d62ce038fa0dacef32c"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ5Njg4MQ==", "bodyText": "Ok", "url": "https://github.com/powsybl/powsybl-core/pull/1338#discussion_r436496881", "createdAt": "2020-06-08T07:13:29Z", "author": {"login": "geofjamg"}, "path": "psse/psse-converter/src/main/java/com/powsybl/psse/converter/PsseImporter.java", "diffHunk": "@@ -0,0 +1,358 @@\n+/**\n+ * Copyright (c) 2019, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.psse.converter;\n+\n+import com.google.auto.service.AutoService;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.io.ByteStreams;\n+import com.powsybl.commons.datasource.DataSource;\n+import com.powsybl.commons.datasource.ReadOnlyDataSource;\n+import com.powsybl.iidm.ConversionParameters;\n+import com.powsybl.iidm.import_.Importer;\n+import com.powsybl.iidm.network.*;\n+import com.powsybl.iidm.network.util.ContainersMapping;\n+import com.powsybl.iidm.parameters.Parameter;\n+import com.powsybl.iidm.parameters.ParameterDefaultValueConfig;\n+import com.powsybl.iidm.parameters.ParameterType;\n+import com.powsybl.psse.model.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.*;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Properties;\n+import java.util.function.Predicate;\n+import java.util.function.ToDoubleFunction;\n+import java.util.function.ToIntFunction;\n+\n+/**\n+ * @author JB Heyberger <jean-baptiste.heyberger at rte-france.com>\n+ */\n+@AutoService(Importer.class)\n+public class PsseImporter implements Importer {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(PsseImporter.class);\n+\n+    private static final String FORMAT = \"PSS/E\";\n+\n+    private static final String EXT = \"raw\"; //TO DO: support both RAW and raw extensions\n+\n+    private static final Parameter IGNORE_BASE_VOLTAGE_PARAMETER = new Parameter(\"ignore-base-voltage\",\n+            ParameterType.BOOLEAN,\n+            \"Ignore base voltage specified in the file\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE1OTU0Mw=="}, "originalCommit": {"oid": "f60c63f99a38726eae129d62ce038fa0dacef32c"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNjgxNTAzOnYy", "diffSide": "RIGHT", "path": "psse/psse-converter/src/main/java/com/powsybl/psse/converter/PsseImporter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMDo1NTo0OVrOGf9G9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QxOTo0NjowNlrOGgLeTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE2MDI0Nw==", "bodyText": "Maybe for another PR but we should find a more robust way to detect valid raw files.", "url": "https://github.com/powsybl/powsybl-core/pull/1338#discussion_r436160247", "createdAt": "2020-06-05T20:55:49Z", "author": {"login": "geofjamg"}, "path": "psse/psse-converter/src/main/java/com/powsybl/psse/converter/PsseImporter.java", "diffHunk": "@@ -0,0 +1,358 @@\n+/**\n+ * Copyright (c) 2019, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.psse.converter;\n+\n+import com.google.auto.service.AutoService;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.io.ByteStreams;\n+import com.powsybl.commons.datasource.DataSource;\n+import com.powsybl.commons.datasource.ReadOnlyDataSource;\n+import com.powsybl.iidm.ConversionParameters;\n+import com.powsybl.iidm.import_.Importer;\n+import com.powsybl.iidm.network.*;\n+import com.powsybl.iidm.network.util.ContainersMapping;\n+import com.powsybl.iidm.parameters.Parameter;\n+import com.powsybl.iidm.parameters.ParameterDefaultValueConfig;\n+import com.powsybl.iidm.parameters.ParameterType;\n+import com.powsybl.psse.model.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.*;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Properties;\n+import java.util.function.Predicate;\n+import java.util.function.ToDoubleFunction;\n+import java.util.function.ToIntFunction;\n+\n+/**\n+ * @author JB Heyberger <jean-baptiste.heyberger at rte-france.com>\n+ */\n+@AutoService(Importer.class)\n+public class PsseImporter implements Importer {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(PsseImporter.class);\n+\n+    private static final String FORMAT = \"PSS/E\";\n+\n+    private static final String EXT = \"raw\"; //TO DO: support both RAW and raw extensions\n+\n+    private static final Parameter IGNORE_BASE_VOLTAGE_PARAMETER = new Parameter(\"ignore-base-voltage\",\n+            ParameterType.BOOLEAN,\n+            \"Ignore base voltage specified in the file\",\n+            Boolean.TRUE);\n+\n+    private static final double DEFAULT_ACTIVE_POWER_LIMIT = 9999d;\n+\n+    @Override\n+    public String getFormat() {\n+        return FORMAT;\n+    }\n+\n+    @Override\n+    public List<Parameter> getParameters() {\n+        return Collections.singletonList(IGNORE_BASE_VOLTAGE_PARAMETER);\n+    }\n+\n+    @Override\n+    public String getComment() {\n+        return \"PSS/E Format to IIDM converter\";\n+    }\n+\n+    @Override\n+    public boolean exists(ReadOnlyDataSource dataSource) {\n+        try {\n+            if (dataSource.exists(null, EXT)) {\n+                try (BufferedReader reader = new BufferedReader(new InputStreamReader(dataSource.newInputStream(null, EXT)))) {\n+                    String titleLine = reader.readLine();\n+                    if (titleLine != null) {\n+                        return titleLine.length() >= 38\n+                                && titleLine.charAt(37) == '/';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f60c63f99a38726eae129d62ce038fa0dacef32c"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM5NTU5OA==", "bodyText": "Agreed, need to be more robust.", "url": "https://github.com/powsybl/powsybl-core/pull/1338#discussion_r436395598", "createdAt": "2020-06-07T19:46:06Z", "author": {"login": "JB-H"}, "path": "psse/psse-converter/src/main/java/com/powsybl/psse/converter/PsseImporter.java", "diffHunk": "@@ -0,0 +1,358 @@\n+/**\n+ * Copyright (c) 2019, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.psse.converter;\n+\n+import com.google.auto.service.AutoService;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.io.ByteStreams;\n+import com.powsybl.commons.datasource.DataSource;\n+import com.powsybl.commons.datasource.ReadOnlyDataSource;\n+import com.powsybl.iidm.ConversionParameters;\n+import com.powsybl.iidm.import_.Importer;\n+import com.powsybl.iidm.network.*;\n+import com.powsybl.iidm.network.util.ContainersMapping;\n+import com.powsybl.iidm.parameters.Parameter;\n+import com.powsybl.iidm.parameters.ParameterDefaultValueConfig;\n+import com.powsybl.iidm.parameters.ParameterType;\n+import com.powsybl.psse.model.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.*;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Properties;\n+import java.util.function.Predicate;\n+import java.util.function.ToDoubleFunction;\n+import java.util.function.ToIntFunction;\n+\n+/**\n+ * @author JB Heyberger <jean-baptiste.heyberger at rte-france.com>\n+ */\n+@AutoService(Importer.class)\n+public class PsseImporter implements Importer {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(PsseImporter.class);\n+\n+    private static final String FORMAT = \"PSS/E\";\n+\n+    private static final String EXT = \"raw\"; //TO DO: support both RAW and raw extensions\n+\n+    private static final Parameter IGNORE_BASE_VOLTAGE_PARAMETER = new Parameter(\"ignore-base-voltage\",\n+            ParameterType.BOOLEAN,\n+            \"Ignore base voltage specified in the file\",\n+            Boolean.TRUE);\n+\n+    private static final double DEFAULT_ACTIVE_POWER_LIMIT = 9999d;\n+\n+    @Override\n+    public String getFormat() {\n+        return FORMAT;\n+    }\n+\n+    @Override\n+    public List<Parameter> getParameters() {\n+        return Collections.singletonList(IGNORE_BASE_VOLTAGE_PARAMETER);\n+    }\n+\n+    @Override\n+    public String getComment() {\n+        return \"PSS/E Format to IIDM converter\";\n+    }\n+\n+    @Override\n+    public boolean exists(ReadOnlyDataSource dataSource) {\n+        try {\n+            if (dataSource.exists(null, EXT)) {\n+                try (BufferedReader reader = new BufferedReader(new InputStreamReader(dataSource.newInputStream(null, EXT)))) {\n+                    String titleLine = reader.readLine();\n+                    if (titleLine != null) {\n+                        return titleLine.length() >= 38\n+                                && titleLine.charAt(37) == '/';", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE2MDI0Nw=="}, "originalCommit": {"oid": "f60c63f99a38726eae129d62ce038fa0dacef32c"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNjgxODMwOnYy", "diffSide": "RIGHT", "path": "psse/psse-converter/src/main/java/com/powsybl/psse/converter/PsseImporter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMDo1NzowMFrOGf9I9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QxOTo0NjoxNFrOGgLeXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE2MDc1Ng==", "bodyText": "See previous comment about the relevancy of this option with raw data.", "url": "https://github.com/powsybl/powsybl-core/pull/1338#discussion_r436160756", "createdAt": "2020-06-05T20:57:00Z", "author": {"login": "geofjamg"}, "path": "psse/psse-converter/src/main/java/com/powsybl/psse/converter/PsseImporter.java", "diffHunk": "@@ -0,0 +1,358 @@\n+/**\n+ * Copyright (c) 2019, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.psse.converter;\n+\n+import com.google.auto.service.AutoService;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.io.ByteStreams;\n+import com.powsybl.commons.datasource.DataSource;\n+import com.powsybl.commons.datasource.ReadOnlyDataSource;\n+import com.powsybl.iidm.ConversionParameters;\n+import com.powsybl.iidm.import_.Importer;\n+import com.powsybl.iidm.network.*;\n+import com.powsybl.iidm.network.util.ContainersMapping;\n+import com.powsybl.iidm.parameters.Parameter;\n+import com.powsybl.iidm.parameters.ParameterDefaultValueConfig;\n+import com.powsybl.iidm.parameters.ParameterType;\n+import com.powsybl.psse.model.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.*;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Properties;\n+import java.util.function.Predicate;\n+import java.util.function.ToDoubleFunction;\n+import java.util.function.ToIntFunction;\n+\n+/**\n+ * @author JB Heyberger <jean-baptiste.heyberger at rte-france.com>\n+ */\n+@AutoService(Importer.class)\n+public class PsseImporter implements Importer {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(PsseImporter.class);\n+\n+    private static final String FORMAT = \"PSS/E\";\n+\n+    private static final String EXT = \"raw\"; //TO DO: support both RAW and raw extensions\n+\n+    private static final Parameter IGNORE_BASE_VOLTAGE_PARAMETER = new Parameter(\"ignore-base-voltage\",\n+            ParameterType.BOOLEAN,\n+            \"Ignore base voltage specified in the file\",\n+            Boolean.TRUE);\n+\n+    private static final double DEFAULT_ACTIVE_POWER_LIMIT = 9999d;\n+\n+    @Override\n+    public String getFormat() {\n+        return FORMAT;\n+    }\n+\n+    @Override\n+    public List<Parameter> getParameters() {\n+        return Collections.singletonList(IGNORE_BASE_VOLTAGE_PARAMETER);\n+    }\n+\n+    @Override\n+    public String getComment() {\n+        return \"PSS/E Format to IIDM converter\";\n+    }\n+\n+    @Override\n+    public boolean exists(ReadOnlyDataSource dataSource) {\n+        try {\n+            if (dataSource.exists(null, EXT)) {\n+                try (BufferedReader reader = new BufferedReader(new InputStreamReader(dataSource.newInputStream(null, EXT)))) {\n+                    String titleLine = reader.readLine();\n+                    if (titleLine != null) {\n+                        return titleLine.length() >= 38\n+                                && titleLine.charAt(37) == '/';\n+                    }\n+                }\n+            }\n+        } catch (IOException e) {\n+            throw new UncheckedIOException(e);\n+        }\n+        return false;\n+    }\n+\n+    @Override\n+    public void copy(ReadOnlyDataSource fromDataSource, DataSource toDataSource) {\n+        Objects.requireNonNull(fromDataSource);\n+        Objects.requireNonNull(toDataSource);\n+        try {\n+            try (InputStream is = fromDataSource.newInputStream(null, EXT);\n+                 OutputStream os = toDataSource.newOutputStream(null, EXT, false)) {\n+                ByteStreams.copy(is, os);\n+            }\n+        } catch (IOException e) {\n+            throw new UncheckedIOException(e);\n+        }\n+    }\n+\n+    private static final class PerUnitContext {\n+\n+        private final double sb; // base apparent power\n+\n+        private final boolean ignoreBaseVoltage;\n+\n+        private PerUnitContext(double sb, boolean ignoreBaseVoltage) {\n+            this.sb = sb;\n+            this.ignoreBaseVoltage = ignoreBaseVoltage;\n+        }\n+\n+        private double getSb() {\n+            return sb;\n+        }\n+\n+        public boolean isIgnoreBaseVoltage() {\n+            return ignoreBaseVoltage;\n+        }\n+    }\n+\n+    private static String getBusId(int busNum) {\n+        return \"B\" + busNum;\n+    }\n+\n+    private static Bus createBus(PsseBus psseBus, VoltageLevel voltageLevel) {\n+        String busId = getBusId(psseBus.getI());\n+        Bus bus = voltageLevel.getBusBreakerView().newBus()\n+                .setId(busId)\n+                .setName(psseBus.getName())\n+                .add();\n+        bus.setV(psseBus.getVm() * voltageLevel.getNominalV())\n+                .setAngle(psseBus.getVa());\n+\n+        return bus;\n+    }\n+\n+    private static Substation createSubstation(Network network, String substationId) {\n+        Substation substation = network.getSubstation(substationId);\n+        if (substation == null) {\n+            substation = network.newSubstation()\n+                    .setId(substationId)\n+                    .add();\n+        }\n+        return substation;\n+    }\n+\n+    private static VoltageLevel createVoltageLevel(PsseBus psseBus, PerUnitContext perUnitContext,\n+                                                   String voltageLevelId, Substation substation, Network network) {\n+        double nominalV = perUnitContext.isIgnoreBaseVoltage() || psseBus.getBaskv() == 0 ? 1 : psseBus.getBaskv();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f60c63f99a38726eae129d62ce038fa0dacef32c"}, "originalPosition": 148}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM5NTYxMw==", "bodyText": "If OK , I will check it in a next pull request", "url": "https://github.com/powsybl/powsybl-core/pull/1338#discussion_r436395613", "createdAt": "2020-06-07T19:46:14Z", "author": {"login": "JB-H"}, "path": "psse/psse-converter/src/main/java/com/powsybl/psse/converter/PsseImporter.java", "diffHunk": "@@ -0,0 +1,358 @@\n+/**\n+ * Copyright (c) 2019, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.psse.converter;\n+\n+import com.google.auto.service.AutoService;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.io.ByteStreams;\n+import com.powsybl.commons.datasource.DataSource;\n+import com.powsybl.commons.datasource.ReadOnlyDataSource;\n+import com.powsybl.iidm.ConversionParameters;\n+import com.powsybl.iidm.import_.Importer;\n+import com.powsybl.iidm.network.*;\n+import com.powsybl.iidm.network.util.ContainersMapping;\n+import com.powsybl.iidm.parameters.Parameter;\n+import com.powsybl.iidm.parameters.ParameterDefaultValueConfig;\n+import com.powsybl.iidm.parameters.ParameterType;\n+import com.powsybl.psse.model.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.*;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Properties;\n+import java.util.function.Predicate;\n+import java.util.function.ToDoubleFunction;\n+import java.util.function.ToIntFunction;\n+\n+/**\n+ * @author JB Heyberger <jean-baptiste.heyberger at rte-france.com>\n+ */\n+@AutoService(Importer.class)\n+public class PsseImporter implements Importer {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(PsseImporter.class);\n+\n+    private static final String FORMAT = \"PSS/E\";\n+\n+    private static final String EXT = \"raw\"; //TO DO: support both RAW and raw extensions\n+\n+    private static final Parameter IGNORE_BASE_VOLTAGE_PARAMETER = new Parameter(\"ignore-base-voltage\",\n+            ParameterType.BOOLEAN,\n+            \"Ignore base voltage specified in the file\",\n+            Boolean.TRUE);\n+\n+    private static final double DEFAULT_ACTIVE_POWER_LIMIT = 9999d;\n+\n+    @Override\n+    public String getFormat() {\n+        return FORMAT;\n+    }\n+\n+    @Override\n+    public List<Parameter> getParameters() {\n+        return Collections.singletonList(IGNORE_BASE_VOLTAGE_PARAMETER);\n+    }\n+\n+    @Override\n+    public String getComment() {\n+        return \"PSS/E Format to IIDM converter\";\n+    }\n+\n+    @Override\n+    public boolean exists(ReadOnlyDataSource dataSource) {\n+        try {\n+            if (dataSource.exists(null, EXT)) {\n+                try (BufferedReader reader = new BufferedReader(new InputStreamReader(dataSource.newInputStream(null, EXT)))) {\n+                    String titleLine = reader.readLine();\n+                    if (titleLine != null) {\n+                        return titleLine.length() >= 38\n+                                && titleLine.charAt(37) == '/';\n+                    }\n+                }\n+            }\n+        } catch (IOException e) {\n+            throw new UncheckedIOException(e);\n+        }\n+        return false;\n+    }\n+\n+    @Override\n+    public void copy(ReadOnlyDataSource fromDataSource, DataSource toDataSource) {\n+        Objects.requireNonNull(fromDataSource);\n+        Objects.requireNonNull(toDataSource);\n+        try {\n+            try (InputStream is = fromDataSource.newInputStream(null, EXT);\n+                 OutputStream os = toDataSource.newOutputStream(null, EXT, false)) {\n+                ByteStreams.copy(is, os);\n+            }\n+        } catch (IOException e) {\n+            throw new UncheckedIOException(e);\n+        }\n+    }\n+\n+    private static final class PerUnitContext {\n+\n+        private final double sb; // base apparent power\n+\n+        private final boolean ignoreBaseVoltage;\n+\n+        private PerUnitContext(double sb, boolean ignoreBaseVoltage) {\n+            this.sb = sb;\n+            this.ignoreBaseVoltage = ignoreBaseVoltage;\n+        }\n+\n+        private double getSb() {\n+            return sb;\n+        }\n+\n+        public boolean isIgnoreBaseVoltage() {\n+            return ignoreBaseVoltage;\n+        }\n+    }\n+\n+    private static String getBusId(int busNum) {\n+        return \"B\" + busNum;\n+    }\n+\n+    private static Bus createBus(PsseBus psseBus, VoltageLevel voltageLevel) {\n+        String busId = getBusId(psseBus.getI());\n+        Bus bus = voltageLevel.getBusBreakerView().newBus()\n+                .setId(busId)\n+                .setName(psseBus.getName())\n+                .add();\n+        bus.setV(psseBus.getVm() * voltageLevel.getNominalV())\n+                .setAngle(psseBus.getVa());\n+\n+        return bus;\n+    }\n+\n+    private static Substation createSubstation(Network network, String substationId) {\n+        Substation substation = network.getSubstation(substationId);\n+        if (substation == null) {\n+            substation = network.newSubstation()\n+                    .setId(substationId)\n+                    .add();\n+        }\n+        return substation;\n+    }\n+\n+    private static VoltageLevel createVoltageLevel(PsseBus psseBus, PerUnitContext perUnitContext,\n+                                                   String voltageLevelId, Substation substation, Network network) {\n+        double nominalV = perUnitContext.isIgnoreBaseVoltage() || psseBus.getBaskv() == 0 ? 1 : psseBus.getBaskv();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE2MDc1Ng=="}, "originalCommit": {"oid": "f60c63f99a38726eae129d62ce038fa0dacef32c"}, "originalPosition": 148}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNjgxOTgyOnYy", "diffSide": "RIGHT", "path": "psse/psse-converter/src/main/java/com/powsybl/psse/converter/PsseImporter.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMDo1NzozNlrOGf9J7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QxOTo0NjoxOVrOGgLeYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE2MTAwNQ==", "bodyText": "To remove if not used.", "url": "https://github.com/powsybl/powsybl-core/pull/1338#discussion_r436161005", "createdAt": "2020-06-05T20:57:36Z", "author": {"login": "geofjamg"}, "path": "psse/psse-converter/src/main/java/com/powsybl/psse/converter/PsseImporter.java", "diffHunk": "@@ -0,0 +1,358 @@\n+/**\n+ * Copyright (c) 2019, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.psse.converter;\n+\n+import com.google.auto.service.AutoService;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.io.ByteStreams;\n+import com.powsybl.commons.datasource.DataSource;\n+import com.powsybl.commons.datasource.ReadOnlyDataSource;\n+import com.powsybl.iidm.ConversionParameters;\n+import com.powsybl.iidm.import_.Importer;\n+import com.powsybl.iidm.network.*;\n+import com.powsybl.iidm.network.util.ContainersMapping;\n+import com.powsybl.iidm.parameters.Parameter;\n+import com.powsybl.iidm.parameters.ParameterDefaultValueConfig;\n+import com.powsybl.iidm.parameters.ParameterType;\n+import com.powsybl.psse.model.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.*;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Properties;\n+import java.util.function.Predicate;\n+import java.util.function.ToDoubleFunction;\n+import java.util.function.ToIntFunction;\n+\n+/**\n+ * @author JB Heyberger <jean-baptiste.heyberger at rte-france.com>\n+ */\n+@AutoService(Importer.class)\n+public class PsseImporter implements Importer {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(PsseImporter.class);\n+\n+    private static final String FORMAT = \"PSS/E\";\n+\n+    private static final String EXT = \"raw\"; //TO DO: support both RAW and raw extensions\n+\n+    private static final Parameter IGNORE_BASE_VOLTAGE_PARAMETER = new Parameter(\"ignore-base-voltage\",\n+            ParameterType.BOOLEAN,\n+            \"Ignore base voltage specified in the file\",\n+            Boolean.TRUE);\n+\n+    private static final double DEFAULT_ACTIVE_POWER_LIMIT = 9999d;\n+\n+    @Override\n+    public String getFormat() {\n+        return FORMAT;\n+    }\n+\n+    @Override\n+    public List<Parameter> getParameters() {\n+        return Collections.singletonList(IGNORE_BASE_VOLTAGE_PARAMETER);\n+    }\n+\n+    @Override\n+    public String getComment() {\n+        return \"PSS/E Format to IIDM converter\";\n+    }\n+\n+    @Override\n+    public boolean exists(ReadOnlyDataSource dataSource) {\n+        try {\n+            if (dataSource.exists(null, EXT)) {\n+                try (BufferedReader reader = new BufferedReader(new InputStreamReader(dataSource.newInputStream(null, EXT)))) {\n+                    String titleLine = reader.readLine();\n+                    if (titleLine != null) {\n+                        return titleLine.length() >= 38\n+                                && titleLine.charAt(37) == '/';\n+                    }\n+                }\n+            }\n+        } catch (IOException e) {\n+            throw new UncheckedIOException(e);\n+        }\n+        return false;\n+    }\n+\n+    @Override\n+    public void copy(ReadOnlyDataSource fromDataSource, DataSource toDataSource) {\n+        Objects.requireNonNull(fromDataSource);\n+        Objects.requireNonNull(toDataSource);\n+        try {\n+            try (InputStream is = fromDataSource.newInputStream(null, EXT);\n+                 OutputStream os = toDataSource.newOutputStream(null, EXT, false)) {\n+                ByteStreams.copy(is, os);\n+            }\n+        } catch (IOException e) {\n+            throw new UncheckedIOException(e);\n+        }\n+    }\n+\n+    private static final class PerUnitContext {\n+\n+        private final double sb; // base apparent power\n+\n+        private final boolean ignoreBaseVoltage;\n+\n+        private PerUnitContext(double sb, boolean ignoreBaseVoltage) {\n+            this.sb = sb;\n+            this.ignoreBaseVoltage = ignoreBaseVoltage;\n+        }\n+\n+        private double getSb() {\n+            return sb;\n+        }\n+\n+        public boolean isIgnoreBaseVoltage() {\n+            return ignoreBaseVoltage;\n+        }\n+    }\n+\n+    private static String getBusId(int busNum) {\n+        return \"B\" + busNum;\n+    }\n+\n+    private static Bus createBus(PsseBus psseBus, VoltageLevel voltageLevel) {\n+        String busId = getBusId(psseBus.getI());\n+        Bus bus = voltageLevel.getBusBreakerView().newBus()\n+                .setId(busId)\n+                .setName(psseBus.getName())\n+                .add();\n+        bus.setV(psseBus.getVm() * voltageLevel.getNominalV())\n+                .setAngle(psseBus.getVa());\n+\n+        return bus;\n+    }\n+\n+    private static Substation createSubstation(Network network, String substationId) {\n+        Substation substation = network.getSubstation(substationId);\n+        if (substation == null) {\n+            substation = network.newSubstation()\n+                    .setId(substationId)\n+                    .add();\n+        }\n+        return substation;\n+    }\n+\n+    private static VoltageLevel createVoltageLevel(PsseBus psseBus, PerUnitContext perUnitContext,\n+                                                   String voltageLevelId, Substation substation, Network network) {\n+        double nominalV = perUnitContext.isIgnoreBaseVoltage() || psseBus.getBaskv() == 0 ? 1 : psseBus.getBaskv();\n+        VoltageLevel voltageLevel = network.getVoltageLevel(voltageLevelId);\n+        if (voltageLevel == null) {\n+            voltageLevel = substation.newVoltageLevel()\n+                    .setId(voltageLevelId)\n+                    .setNominalV(nominalV)\n+                    .setTopologyKind(TopologyKind.BUS_BREAKER)\n+                    .add();\n+        }\n+        return voltageLevel;\n+    }\n+\n+    private static void createLoad(PsseLoad psseLoad, VoltageLevel voltageLevel) {\n+        String busId = getBusId(psseLoad.getI());\n+        voltageLevel.newLoad()\n+                .setId(busId + \"-L\" + psseLoad.getId())\n+                .setConnectableBus(busId)\n+                .setBus(busId)\n+                .setP0(psseLoad.getPl()) //TO DO: take into account Ip, Yp\n+                .setQ0(psseLoad.getQl()) //TO DO: take into account Iq, Yq\n+                .add();\n+\n+    }\n+\n+    private static void createShuntCompensator(PsseFixedShunt psseShunt, PerUnitContext perUnitContext, VoltageLevel voltageLevel) {\n+        String busId = getBusId(psseShunt.getI());\n+        double zb = Math.pow(voltageLevel.getNominalV(), 2) / perUnitContext.getSb();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f60c63f99a38726eae129d62ce038fa0dacef32c"}, "originalPosition": 174}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM5NTYxNw==", "bodyText": "OK", "url": "https://github.com/powsybl/powsybl-core/pull/1338#discussion_r436395617", "createdAt": "2020-06-07T19:46:19Z", "author": {"login": "JB-H"}, "path": "psse/psse-converter/src/main/java/com/powsybl/psse/converter/PsseImporter.java", "diffHunk": "@@ -0,0 +1,358 @@\n+/**\n+ * Copyright (c) 2019, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.psse.converter;\n+\n+import com.google.auto.service.AutoService;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.io.ByteStreams;\n+import com.powsybl.commons.datasource.DataSource;\n+import com.powsybl.commons.datasource.ReadOnlyDataSource;\n+import com.powsybl.iidm.ConversionParameters;\n+import com.powsybl.iidm.import_.Importer;\n+import com.powsybl.iidm.network.*;\n+import com.powsybl.iidm.network.util.ContainersMapping;\n+import com.powsybl.iidm.parameters.Parameter;\n+import com.powsybl.iidm.parameters.ParameterDefaultValueConfig;\n+import com.powsybl.iidm.parameters.ParameterType;\n+import com.powsybl.psse.model.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.*;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Properties;\n+import java.util.function.Predicate;\n+import java.util.function.ToDoubleFunction;\n+import java.util.function.ToIntFunction;\n+\n+/**\n+ * @author JB Heyberger <jean-baptiste.heyberger at rte-france.com>\n+ */\n+@AutoService(Importer.class)\n+public class PsseImporter implements Importer {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(PsseImporter.class);\n+\n+    private static final String FORMAT = \"PSS/E\";\n+\n+    private static final String EXT = \"raw\"; //TO DO: support both RAW and raw extensions\n+\n+    private static final Parameter IGNORE_BASE_VOLTAGE_PARAMETER = new Parameter(\"ignore-base-voltage\",\n+            ParameterType.BOOLEAN,\n+            \"Ignore base voltage specified in the file\",\n+            Boolean.TRUE);\n+\n+    private static final double DEFAULT_ACTIVE_POWER_LIMIT = 9999d;\n+\n+    @Override\n+    public String getFormat() {\n+        return FORMAT;\n+    }\n+\n+    @Override\n+    public List<Parameter> getParameters() {\n+        return Collections.singletonList(IGNORE_BASE_VOLTAGE_PARAMETER);\n+    }\n+\n+    @Override\n+    public String getComment() {\n+        return \"PSS/E Format to IIDM converter\";\n+    }\n+\n+    @Override\n+    public boolean exists(ReadOnlyDataSource dataSource) {\n+        try {\n+            if (dataSource.exists(null, EXT)) {\n+                try (BufferedReader reader = new BufferedReader(new InputStreamReader(dataSource.newInputStream(null, EXT)))) {\n+                    String titleLine = reader.readLine();\n+                    if (titleLine != null) {\n+                        return titleLine.length() >= 38\n+                                && titleLine.charAt(37) == '/';\n+                    }\n+                }\n+            }\n+        } catch (IOException e) {\n+            throw new UncheckedIOException(e);\n+        }\n+        return false;\n+    }\n+\n+    @Override\n+    public void copy(ReadOnlyDataSource fromDataSource, DataSource toDataSource) {\n+        Objects.requireNonNull(fromDataSource);\n+        Objects.requireNonNull(toDataSource);\n+        try {\n+            try (InputStream is = fromDataSource.newInputStream(null, EXT);\n+                 OutputStream os = toDataSource.newOutputStream(null, EXT, false)) {\n+                ByteStreams.copy(is, os);\n+            }\n+        } catch (IOException e) {\n+            throw new UncheckedIOException(e);\n+        }\n+    }\n+\n+    private static final class PerUnitContext {\n+\n+        private final double sb; // base apparent power\n+\n+        private final boolean ignoreBaseVoltage;\n+\n+        private PerUnitContext(double sb, boolean ignoreBaseVoltage) {\n+            this.sb = sb;\n+            this.ignoreBaseVoltage = ignoreBaseVoltage;\n+        }\n+\n+        private double getSb() {\n+            return sb;\n+        }\n+\n+        public boolean isIgnoreBaseVoltage() {\n+            return ignoreBaseVoltage;\n+        }\n+    }\n+\n+    private static String getBusId(int busNum) {\n+        return \"B\" + busNum;\n+    }\n+\n+    private static Bus createBus(PsseBus psseBus, VoltageLevel voltageLevel) {\n+        String busId = getBusId(psseBus.getI());\n+        Bus bus = voltageLevel.getBusBreakerView().newBus()\n+                .setId(busId)\n+                .setName(psseBus.getName())\n+                .add();\n+        bus.setV(psseBus.getVm() * voltageLevel.getNominalV())\n+                .setAngle(psseBus.getVa());\n+\n+        return bus;\n+    }\n+\n+    private static Substation createSubstation(Network network, String substationId) {\n+        Substation substation = network.getSubstation(substationId);\n+        if (substation == null) {\n+            substation = network.newSubstation()\n+                    .setId(substationId)\n+                    .add();\n+        }\n+        return substation;\n+    }\n+\n+    private static VoltageLevel createVoltageLevel(PsseBus psseBus, PerUnitContext perUnitContext,\n+                                                   String voltageLevelId, Substation substation, Network network) {\n+        double nominalV = perUnitContext.isIgnoreBaseVoltage() || psseBus.getBaskv() == 0 ? 1 : psseBus.getBaskv();\n+        VoltageLevel voltageLevel = network.getVoltageLevel(voltageLevelId);\n+        if (voltageLevel == null) {\n+            voltageLevel = substation.newVoltageLevel()\n+                    .setId(voltageLevelId)\n+                    .setNominalV(nominalV)\n+                    .setTopologyKind(TopologyKind.BUS_BREAKER)\n+                    .add();\n+        }\n+        return voltageLevel;\n+    }\n+\n+    private static void createLoad(PsseLoad psseLoad, VoltageLevel voltageLevel) {\n+        String busId = getBusId(psseLoad.getI());\n+        voltageLevel.newLoad()\n+                .setId(busId + \"-L\" + psseLoad.getId())\n+                .setConnectableBus(busId)\n+                .setBus(busId)\n+                .setP0(psseLoad.getPl()) //TO DO: take into account Ip, Yp\n+                .setQ0(psseLoad.getQl()) //TO DO: take into account Iq, Yq\n+                .add();\n+\n+    }\n+\n+    private static void createShuntCompensator(PsseFixedShunt psseShunt, PerUnitContext perUnitContext, VoltageLevel voltageLevel) {\n+        String busId = getBusId(psseShunt.getI());\n+        double zb = Math.pow(voltageLevel.getNominalV(), 2) / perUnitContext.getSb();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE2MTAwNQ=="}, "originalCommit": {"oid": "f60c63f99a38726eae129d62ce038fa0dacef32c"}, "originalPosition": 174}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNjgyMTkyOnYy", "diffSide": "RIGHT", "path": "psse/psse-converter/src/main/java/com/powsybl/psse/converter/PsseImporter.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMDo1ODozMFrOGf9LVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQwOToxODowNlrOGgCy4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE2MTM2Ng==", "bodyText": "Are you sure we don't need to handle per unit? bPerSection in IIDM is in S.", "url": "https://github.com/powsybl/powsybl-core/pull/1338#discussion_r436161366", "createdAt": "2020-06-05T20:58:30Z", "author": {"login": "geofjamg"}, "path": "psse/psse-converter/src/main/java/com/powsybl/psse/converter/PsseImporter.java", "diffHunk": "@@ -0,0 +1,358 @@\n+/**\n+ * Copyright (c) 2019, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.psse.converter;\n+\n+import com.google.auto.service.AutoService;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.io.ByteStreams;\n+import com.powsybl.commons.datasource.DataSource;\n+import com.powsybl.commons.datasource.ReadOnlyDataSource;\n+import com.powsybl.iidm.ConversionParameters;\n+import com.powsybl.iidm.import_.Importer;\n+import com.powsybl.iidm.network.*;\n+import com.powsybl.iidm.network.util.ContainersMapping;\n+import com.powsybl.iidm.parameters.Parameter;\n+import com.powsybl.iidm.parameters.ParameterDefaultValueConfig;\n+import com.powsybl.iidm.parameters.ParameterType;\n+import com.powsybl.psse.model.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.*;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Properties;\n+import java.util.function.Predicate;\n+import java.util.function.ToDoubleFunction;\n+import java.util.function.ToIntFunction;\n+\n+/**\n+ * @author JB Heyberger <jean-baptiste.heyberger at rte-france.com>\n+ */\n+@AutoService(Importer.class)\n+public class PsseImporter implements Importer {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(PsseImporter.class);\n+\n+    private static final String FORMAT = \"PSS/E\";\n+\n+    private static final String EXT = \"raw\"; //TO DO: support both RAW and raw extensions\n+\n+    private static final Parameter IGNORE_BASE_VOLTAGE_PARAMETER = new Parameter(\"ignore-base-voltage\",\n+            ParameterType.BOOLEAN,\n+            \"Ignore base voltage specified in the file\",\n+            Boolean.TRUE);\n+\n+    private static final double DEFAULT_ACTIVE_POWER_LIMIT = 9999d;\n+\n+    @Override\n+    public String getFormat() {\n+        return FORMAT;\n+    }\n+\n+    @Override\n+    public List<Parameter> getParameters() {\n+        return Collections.singletonList(IGNORE_BASE_VOLTAGE_PARAMETER);\n+    }\n+\n+    @Override\n+    public String getComment() {\n+        return \"PSS/E Format to IIDM converter\";\n+    }\n+\n+    @Override\n+    public boolean exists(ReadOnlyDataSource dataSource) {\n+        try {\n+            if (dataSource.exists(null, EXT)) {\n+                try (BufferedReader reader = new BufferedReader(new InputStreamReader(dataSource.newInputStream(null, EXT)))) {\n+                    String titleLine = reader.readLine();\n+                    if (titleLine != null) {\n+                        return titleLine.length() >= 38\n+                                && titleLine.charAt(37) == '/';\n+                    }\n+                }\n+            }\n+        } catch (IOException e) {\n+            throw new UncheckedIOException(e);\n+        }\n+        return false;\n+    }\n+\n+    @Override\n+    public void copy(ReadOnlyDataSource fromDataSource, DataSource toDataSource) {\n+        Objects.requireNonNull(fromDataSource);\n+        Objects.requireNonNull(toDataSource);\n+        try {\n+            try (InputStream is = fromDataSource.newInputStream(null, EXT);\n+                 OutputStream os = toDataSource.newOutputStream(null, EXT, false)) {\n+                ByteStreams.copy(is, os);\n+            }\n+        } catch (IOException e) {\n+            throw new UncheckedIOException(e);\n+        }\n+    }\n+\n+    private static final class PerUnitContext {\n+\n+        private final double sb; // base apparent power\n+\n+        private final boolean ignoreBaseVoltage;\n+\n+        private PerUnitContext(double sb, boolean ignoreBaseVoltage) {\n+            this.sb = sb;\n+            this.ignoreBaseVoltage = ignoreBaseVoltage;\n+        }\n+\n+        private double getSb() {\n+            return sb;\n+        }\n+\n+        public boolean isIgnoreBaseVoltage() {\n+            return ignoreBaseVoltage;\n+        }\n+    }\n+\n+    private static String getBusId(int busNum) {\n+        return \"B\" + busNum;\n+    }\n+\n+    private static Bus createBus(PsseBus psseBus, VoltageLevel voltageLevel) {\n+        String busId = getBusId(psseBus.getI());\n+        Bus bus = voltageLevel.getBusBreakerView().newBus()\n+                .setId(busId)\n+                .setName(psseBus.getName())\n+                .add();\n+        bus.setV(psseBus.getVm() * voltageLevel.getNominalV())\n+                .setAngle(psseBus.getVa());\n+\n+        return bus;\n+    }\n+\n+    private static Substation createSubstation(Network network, String substationId) {\n+        Substation substation = network.getSubstation(substationId);\n+        if (substation == null) {\n+            substation = network.newSubstation()\n+                    .setId(substationId)\n+                    .add();\n+        }\n+        return substation;\n+    }\n+\n+    private static VoltageLevel createVoltageLevel(PsseBus psseBus, PerUnitContext perUnitContext,\n+                                                   String voltageLevelId, Substation substation, Network network) {\n+        double nominalV = perUnitContext.isIgnoreBaseVoltage() || psseBus.getBaskv() == 0 ? 1 : psseBus.getBaskv();\n+        VoltageLevel voltageLevel = network.getVoltageLevel(voltageLevelId);\n+        if (voltageLevel == null) {\n+            voltageLevel = substation.newVoltageLevel()\n+                    .setId(voltageLevelId)\n+                    .setNominalV(nominalV)\n+                    .setTopologyKind(TopologyKind.BUS_BREAKER)\n+                    .add();\n+        }\n+        return voltageLevel;\n+    }\n+\n+    private static void createLoad(PsseLoad psseLoad, VoltageLevel voltageLevel) {\n+        String busId = getBusId(psseLoad.getI());\n+        voltageLevel.newLoad()\n+                .setId(busId + \"-L\" + psseLoad.getId())\n+                .setConnectableBus(busId)\n+                .setBus(busId)\n+                .setP0(psseLoad.getPl()) //TO DO: take into account Ip, Yp\n+                .setQ0(psseLoad.getQl()) //TO DO: take into account Iq, Yq\n+                .add();\n+\n+    }\n+\n+    private static void createShuntCompensator(PsseFixedShunt psseShunt, PerUnitContext perUnitContext, VoltageLevel voltageLevel) {\n+        String busId = getBusId(psseShunt.getI());\n+        double zb = Math.pow(voltageLevel.getNominalV(), 2) / perUnitContext.getSb();\n+        voltageLevel.newShuntCompensator()\n+                .setId(busId + \"-SH\" + psseShunt.getId())\n+                .setConnectableBus(busId)\n+                .setBus(busId)\n+                .setbPerSection(psseShunt.getBl())//TO DO: take into account gl", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f60c63f99a38726eae129d62ce038fa0dacef32c"}, "originalPosition": 179}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI1MzM2Nw==", "bodyText": "No otherwise the load flow on the IEEE 14 example converges to a bad state.", "url": "https://github.com/powsybl/powsybl-core/pull/1338#discussion_r436253367", "createdAt": "2020-06-06T09:17:27Z", "author": {"login": "JB-H"}, "path": "psse/psse-converter/src/main/java/com/powsybl/psse/converter/PsseImporter.java", "diffHunk": "@@ -0,0 +1,358 @@\n+/**\n+ * Copyright (c) 2019, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.psse.converter;\n+\n+import com.google.auto.service.AutoService;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.io.ByteStreams;\n+import com.powsybl.commons.datasource.DataSource;\n+import com.powsybl.commons.datasource.ReadOnlyDataSource;\n+import com.powsybl.iidm.ConversionParameters;\n+import com.powsybl.iidm.import_.Importer;\n+import com.powsybl.iidm.network.*;\n+import com.powsybl.iidm.network.util.ContainersMapping;\n+import com.powsybl.iidm.parameters.Parameter;\n+import com.powsybl.iidm.parameters.ParameterDefaultValueConfig;\n+import com.powsybl.iidm.parameters.ParameterType;\n+import com.powsybl.psse.model.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.*;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Properties;\n+import java.util.function.Predicate;\n+import java.util.function.ToDoubleFunction;\n+import java.util.function.ToIntFunction;\n+\n+/**\n+ * @author JB Heyberger <jean-baptiste.heyberger at rte-france.com>\n+ */\n+@AutoService(Importer.class)\n+public class PsseImporter implements Importer {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(PsseImporter.class);\n+\n+    private static final String FORMAT = \"PSS/E\";\n+\n+    private static final String EXT = \"raw\"; //TO DO: support both RAW and raw extensions\n+\n+    private static final Parameter IGNORE_BASE_VOLTAGE_PARAMETER = new Parameter(\"ignore-base-voltage\",\n+            ParameterType.BOOLEAN,\n+            \"Ignore base voltage specified in the file\",\n+            Boolean.TRUE);\n+\n+    private static final double DEFAULT_ACTIVE_POWER_LIMIT = 9999d;\n+\n+    @Override\n+    public String getFormat() {\n+        return FORMAT;\n+    }\n+\n+    @Override\n+    public List<Parameter> getParameters() {\n+        return Collections.singletonList(IGNORE_BASE_VOLTAGE_PARAMETER);\n+    }\n+\n+    @Override\n+    public String getComment() {\n+        return \"PSS/E Format to IIDM converter\";\n+    }\n+\n+    @Override\n+    public boolean exists(ReadOnlyDataSource dataSource) {\n+        try {\n+            if (dataSource.exists(null, EXT)) {\n+                try (BufferedReader reader = new BufferedReader(new InputStreamReader(dataSource.newInputStream(null, EXT)))) {\n+                    String titleLine = reader.readLine();\n+                    if (titleLine != null) {\n+                        return titleLine.length() >= 38\n+                                && titleLine.charAt(37) == '/';\n+                    }\n+                }\n+            }\n+        } catch (IOException e) {\n+            throw new UncheckedIOException(e);\n+        }\n+        return false;\n+    }\n+\n+    @Override\n+    public void copy(ReadOnlyDataSource fromDataSource, DataSource toDataSource) {\n+        Objects.requireNonNull(fromDataSource);\n+        Objects.requireNonNull(toDataSource);\n+        try {\n+            try (InputStream is = fromDataSource.newInputStream(null, EXT);\n+                 OutputStream os = toDataSource.newOutputStream(null, EXT, false)) {\n+                ByteStreams.copy(is, os);\n+            }\n+        } catch (IOException e) {\n+            throw new UncheckedIOException(e);\n+        }\n+    }\n+\n+    private static final class PerUnitContext {\n+\n+        private final double sb; // base apparent power\n+\n+        private final boolean ignoreBaseVoltage;\n+\n+        private PerUnitContext(double sb, boolean ignoreBaseVoltage) {\n+            this.sb = sb;\n+            this.ignoreBaseVoltage = ignoreBaseVoltage;\n+        }\n+\n+        private double getSb() {\n+            return sb;\n+        }\n+\n+        public boolean isIgnoreBaseVoltage() {\n+            return ignoreBaseVoltage;\n+        }\n+    }\n+\n+    private static String getBusId(int busNum) {\n+        return \"B\" + busNum;\n+    }\n+\n+    private static Bus createBus(PsseBus psseBus, VoltageLevel voltageLevel) {\n+        String busId = getBusId(psseBus.getI());\n+        Bus bus = voltageLevel.getBusBreakerView().newBus()\n+                .setId(busId)\n+                .setName(psseBus.getName())\n+                .add();\n+        bus.setV(psseBus.getVm() * voltageLevel.getNominalV())\n+                .setAngle(psseBus.getVa());\n+\n+        return bus;\n+    }\n+\n+    private static Substation createSubstation(Network network, String substationId) {\n+        Substation substation = network.getSubstation(substationId);\n+        if (substation == null) {\n+            substation = network.newSubstation()\n+                    .setId(substationId)\n+                    .add();\n+        }\n+        return substation;\n+    }\n+\n+    private static VoltageLevel createVoltageLevel(PsseBus psseBus, PerUnitContext perUnitContext,\n+                                                   String voltageLevelId, Substation substation, Network network) {\n+        double nominalV = perUnitContext.isIgnoreBaseVoltage() || psseBus.getBaskv() == 0 ? 1 : psseBus.getBaskv();\n+        VoltageLevel voltageLevel = network.getVoltageLevel(voltageLevelId);\n+        if (voltageLevel == null) {\n+            voltageLevel = substation.newVoltageLevel()\n+                    .setId(voltageLevelId)\n+                    .setNominalV(nominalV)\n+                    .setTopologyKind(TopologyKind.BUS_BREAKER)\n+                    .add();\n+        }\n+        return voltageLevel;\n+    }\n+\n+    private static void createLoad(PsseLoad psseLoad, VoltageLevel voltageLevel) {\n+        String busId = getBusId(psseLoad.getI());\n+        voltageLevel.newLoad()\n+                .setId(busId + \"-L\" + psseLoad.getId())\n+                .setConnectableBus(busId)\n+                .setBus(busId)\n+                .setP0(psseLoad.getPl()) //TO DO: take into account Ip, Yp\n+                .setQ0(psseLoad.getQl()) //TO DO: take into account Iq, Yq\n+                .add();\n+\n+    }\n+\n+    private static void createShuntCompensator(PsseFixedShunt psseShunt, PerUnitContext perUnitContext, VoltageLevel voltageLevel) {\n+        String busId = getBusId(psseShunt.getI());\n+        double zb = Math.pow(voltageLevel.getNominalV(), 2) / perUnitContext.getSb();\n+        voltageLevel.newShuntCompensator()\n+                .setId(busId + \"-SH\" + psseShunt.getId())\n+                .setConnectableBus(busId)\n+                .setBus(busId)\n+                .setbPerSection(psseShunt.getBl())//TO DO: take into account gl", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE2MTM2Ng=="}, "originalCommit": {"oid": "f60c63f99a38726eae129d62ce038fa0dacef32c"}, "originalPosition": 179}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI1MzQwOA==", "bodyText": "the IEEE 14 does contain a shunt, so this has been tested", "url": "https://github.com/powsybl/powsybl-core/pull/1338#discussion_r436253408", "createdAt": "2020-06-06T09:18:06Z", "author": {"login": "JB-H"}, "path": "psse/psse-converter/src/main/java/com/powsybl/psse/converter/PsseImporter.java", "diffHunk": "@@ -0,0 +1,358 @@\n+/**\n+ * Copyright (c) 2019, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.psse.converter;\n+\n+import com.google.auto.service.AutoService;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.io.ByteStreams;\n+import com.powsybl.commons.datasource.DataSource;\n+import com.powsybl.commons.datasource.ReadOnlyDataSource;\n+import com.powsybl.iidm.ConversionParameters;\n+import com.powsybl.iidm.import_.Importer;\n+import com.powsybl.iidm.network.*;\n+import com.powsybl.iidm.network.util.ContainersMapping;\n+import com.powsybl.iidm.parameters.Parameter;\n+import com.powsybl.iidm.parameters.ParameterDefaultValueConfig;\n+import com.powsybl.iidm.parameters.ParameterType;\n+import com.powsybl.psse.model.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.*;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Properties;\n+import java.util.function.Predicate;\n+import java.util.function.ToDoubleFunction;\n+import java.util.function.ToIntFunction;\n+\n+/**\n+ * @author JB Heyberger <jean-baptiste.heyberger at rte-france.com>\n+ */\n+@AutoService(Importer.class)\n+public class PsseImporter implements Importer {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(PsseImporter.class);\n+\n+    private static final String FORMAT = \"PSS/E\";\n+\n+    private static final String EXT = \"raw\"; //TO DO: support both RAW and raw extensions\n+\n+    private static final Parameter IGNORE_BASE_VOLTAGE_PARAMETER = new Parameter(\"ignore-base-voltage\",\n+            ParameterType.BOOLEAN,\n+            \"Ignore base voltage specified in the file\",\n+            Boolean.TRUE);\n+\n+    private static final double DEFAULT_ACTIVE_POWER_LIMIT = 9999d;\n+\n+    @Override\n+    public String getFormat() {\n+        return FORMAT;\n+    }\n+\n+    @Override\n+    public List<Parameter> getParameters() {\n+        return Collections.singletonList(IGNORE_BASE_VOLTAGE_PARAMETER);\n+    }\n+\n+    @Override\n+    public String getComment() {\n+        return \"PSS/E Format to IIDM converter\";\n+    }\n+\n+    @Override\n+    public boolean exists(ReadOnlyDataSource dataSource) {\n+        try {\n+            if (dataSource.exists(null, EXT)) {\n+                try (BufferedReader reader = new BufferedReader(new InputStreamReader(dataSource.newInputStream(null, EXT)))) {\n+                    String titleLine = reader.readLine();\n+                    if (titleLine != null) {\n+                        return titleLine.length() >= 38\n+                                && titleLine.charAt(37) == '/';\n+                    }\n+                }\n+            }\n+        } catch (IOException e) {\n+            throw new UncheckedIOException(e);\n+        }\n+        return false;\n+    }\n+\n+    @Override\n+    public void copy(ReadOnlyDataSource fromDataSource, DataSource toDataSource) {\n+        Objects.requireNonNull(fromDataSource);\n+        Objects.requireNonNull(toDataSource);\n+        try {\n+            try (InputStream is = fromDataSource.newInputStream(null, EXT);\n+                 OutputStream os = toDataSource.newOutputStream(null, EXT, false)) {\n+                ByteStreams.copy(is, os);\n+            }\n+        } catch (IOException e) {\n+            throw new UncheckedIOException(e);\n+        }\n+    }\n+\n+    private static final class PerUnitContext {\n+\n+        private final double sb; // base apparent power\n+\n+        private final boolean ignoreBaseVoltage;\n+\n+        private PerUnitContext(double sb, boolean ignoreBaseVoltage) {\n+            this.sb = sb;\n+            this.ignoreBaseVoltage = ignoreBaseVoltage;\n+        }\n+\n+        private double getSb() {\n+            return sb;\n+        }\n+\n+        public boolean isIgnoreBaseVoltage() {\n+            return ignoreBaseVoltage;\n+        }\n+    }\n+\n+    private static String getBusId(int busNum) {\n+        return \"B\" + busNum;\n+    }\n+\n+    private static Bus createBus(PsseBus psseBus, VoltageLevel voltageLevel) {\n+        String busId = getBusId(psseBus.getI());\n+        Bus bus = voltageLevel.getBusBreakerView().newBus()\n+                .setId(busId)\n+                .setName(psseBus.getName())\n+                .add();\n+        bus.setV(psseBus.getVm() * voltageLevel.getNominalV())\n+                .setAngle(psseBus.getVa());\n+\n+        return bus;\n+    }\n+\n+    private static Substation createSubstation(Network network, String substationId) {\n+        Substation substation = network.getSubstation(substationId);\n+        if (substation == null) {\n+            substation = network.newSubstation()\n+                    .setId(substationId)\n+                    .add();\n+        }\n+        return substation;\n+    }\n+\n+    private static VoltageLevel createVoltageLevel(PsseBus psseBus, PerUnitContext perUnitContext,\n+                                                   String voltageLevelId, Substation substation, Network network) {\n+        double nominalV = perUnitContext.isIgnoreBaseVoltage() || psseBus.getBaskv() == 0 ? 1 : psseBus.getBaskv();\n+        VoltageLevel voltageLevel = network.getVoltageLevel(voltageLevelId);\n+        if (voltageLevel == null) {\n+            voltageLevel = substation.newVoltageLevel()\n+                    .setId(voltageLevelId)\n+                    .setNominalV(nominalV)\n+                    .setTopologyKind(TopologyKind.BUS_BREAKER)\n+                    .add();\n+        }\n+        return voltageLevel;\n+    }\n+\n+    private static void createLoad(PsseLoad psseLoad, VoltageLevel voltageLevel) {\n+        String busId = getBusId(psseLoad.getI());\n+        voltageLevel.newLoad()\n+                .setId(busId + \"-L\" + psseLoad.getId())\n+                .setConnectableBus(busId)\n+                .setBus(busId)\n+                .setP0(psseLoad.getPl()) //TO DO: take into account Ip, Yp\n+                .setQ0(psseLoad.getQl()) //TO DO: take into account Iq, Yq\n+                .add();\n+\n+    }\n+\n+    private static void createShuntCompensator(PsseFixedShunt psseShunt, PerUnitContext perUnitContext, VoltageLevel voltageLevel) {\n+        String busId = getBusId(psseShunt.getI());\n+        double zb = Math.pow(voltageLevel.getNominalV(), 2) / perUnitContext.getSb();\n+        voltageLevel.newShuntCompensator()\n+                .setId(busId + \"-SH\" + psseShunt.getId())\n+                .setConnectableBus(busId)\n+                .setBus(busId)\n+                .setbPerSection(psseShunt.getBl())//TO DO: take into account gl", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE2MTM2Ng=="}, "originalCommit": {"oid": "f60c63f99a38726eae129d62ce038fa0dacef32c"}, "originalPosition": 179}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNjgzODA5OnYy", "diffSide": "RIGHT", "path": "psse/psse-converter/src/main/java/com/powsybl/psse/converter/PsseImporter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMTowNToyN1rOGf9VtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMTowNToyN1rOGf9VtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE2NDAyMA==", "bodyText": "I would pass the network and containerMapping to createShuntCompensator and get the voltage level inside.", "url": "https://github.com/powsybl/powsybl-core/pull/1338#discussion_r436164020", "createdAt": "2020-06-05T21:05:27Z", "author": {"login": "geofjamg"}, "path": "psse/psse-converter/src/main/java/com/powsybl/psse/converter/PsseImporter.java", "diffHunk": "@@ -0,0 +1,358 @@\n+/**\n+ * Copyright (c) 2019, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.psse.converter;\n+\n+import com.google.auto.service.AutoService;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.io.ByteStreams;\n+import com.powsybl.commons.datasource.DataSource;\n+import com.powsybl.commons.datasource.ReadOnlyDataSource;\n+import com.powsybl.iidm.ConversionParameters;\n+import com.powsybl.iidm.import_.Importer;\n+import com.powsybl.iidm.network.*;\n+import com.powsybl.iidm.network.util.ContainersMapping;\n+import com.powsybl.iidm.parameters.Parameter;\n+import com.powsybl.iidm.parameters.ParameterDefaultValueConfig;\n+import com.powsybl.iidm.parameters.ParameterType;\n+import com.powsybl.psse.model.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.*;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Properties;\n+import java.util.function.Predicate;\n+import java.util.function.ToDoubleFunction;\n+import java.util.function.ToIntFunction;\n+\n+/**\n+ * @author JB Heyberger <jean-baptiste.heyberger at rte-france.com>\n+ */\n+@AutoService(Importer.class)\n+public class PsseImporter implements Importer {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(PsseImporter.class);\n+\n+    private static final String FORMAT = \"PSS/E\";\n+\n+    private static final String EXT = \"raw\"; //TO DO: support both RAW and raw extensions\n+\n+    private static final Parameter IGNORE_BASE_VOLTAGE_PARAMETER = new Parameter(\"ignore-base-voltage\",\n+            ParameterType.BOOLEAN,\n+            \"Ignore base voltage specified in the file\",\n+            Boolean.TRUE);\n+\n+    private static final double DEFAULT_ACTIVE_POWER_LIMIT = 9999d;\n+\n+    @Override\n+    public String getFormat() {\n+        return FORMAT;\n+    }\n+\n+    @Override\n+    public List<Parameter> getParameters() {\n+        return Collections.singletonList(IGNORE_BASE_VOLTAGE_PARAMETER);\n+    }\n+\n+    @Override\n+    public String getComment() {\n+        return \"PSS/E Format to IIDM converter\";\n+    }\n+\n+    @Override\n+    public boolean exists(ReadOnlyDataSource dataSource) {\n+        try {\n+            if (dataSource.exists(null, EXT)) {\n+                try (BufferedReader reader = new BufferedReader(new InputStreamReader(dataSource.newInputStream(null, EXT)))) {\n+                    String titleLine = reader.readLine();\n+                    if (titleLine != null) {\n+                        return titleLine.length() >= 38\n+                                && titleLine.charAt(37) == '/';\n+                    }\n+                }\n+            }\n+        } catch (IOException e) {\n+            throw new UncheckedIOException(e);\n+        }\n+        return false;\n+    }\n+\n+    @Override\n+    public void copy(ReadOnlyDataSource fromDataSource, DataSource toDataSource) {\n+        Objects.requireNonNull(fromDataSource);\n+        Objects.requireNonNull(toDataSource);\n+        try {\n+            try (InputStream is = fromDataSource.newInputStream(null, EXT);\n+                 OutputStream os = toDataSource.newOutputStream(null, EXT, false)) {\n+                ByteStreams.copy(is, os);\n+            }\n+        } catch (IOException e) {\n+            throw new UncheckedIOException(e);\n+        }\n+    }\n+\n+    private static final class PerUnitContext {\n+\n+        private final double sb; // base apparent power\n+\n+        private final boolean ignoreBaseVoltage;\n+\n+        private PerUnitContext(double sb, boolean ignoreBaseVoltage) {\n+            this.sb = sb;\n+            this.ignoreBaseVoltage = ignoreBaseVoltage;\n+        }\n+\n+        private double getSb() {\n+            return sb;\n+        }\n+\n+        public boolean isIgnoreBaseVoltage() {\n+            return ignoreBaseVoltage;\n+        }\n+    }\n+\n+    private static String getBusId(int busNum) {\n+        return \"B\" + busNum;\n+    }\n+\n+    private static Bus createBus(PsseBus psseBus, VoltageLevel voltageLevel) {\n+        String busId = getBusId(psseBus.getI());\n+        Bus bus = voltageLevel.getBusBreakerView().newBus()\n+                .setId(busId)\n+                .setName(psseBus.getName())\n+                .add();\n+        bus.setV(psseBus.getVm() * voltageLevel.getNominalV())\n+                .setAngle(psseBus.getVa());\n+\n+        return bus;\n+    }\n+\n+    private static Substation createSubstation(Network network, String substationId) {\n+        Substation substation = network.getSubstation(substationId);\n+        if (substation == null) {\n+            substation = network.newSubstation()\n+                    .setId(substationId)\n+                    .add();\n+        }\n+        return substation;\n+    }\n+\n+    private static VoltageLevel createVoltageLevel(PsseBus psseBus, PerUnitContext perUnitContext,\n+                                                   String voltageLevelId, Substation substation, Network network) {\n+        double nominalV = perUnitContext.isIgnoreBaseVoltage() || psseBus.getBaskv() == 0 ? 1 : psseBus.getBaskv();\n+        VoltageLevel voltageLevel = network.getVoltageLevel(voltageLevelId);\n+        if (voltageLevel == null) {\n+            voltageLevel = substation.newVoltageLevel()\n+                    .setId(voltageLevelId)\n+                    .setNominalV(nominalV)\n+                    .setTopologyKind(TopologyKind.BUS_BREAKER)\n+                    .add();\n+        }\n+        return voltageLevel;\n+    }\n+\n+    private static void createLoad(PsseLoad psseLoad, VoltageLevel voltageLevel) {\n+        String busId = getBusId(psseLoad.getI());\n+        voltageLevel.newLoad()\n+                .setId(busId + \"-L\" + psseLoad.getId())\n+                .setConnectableBus(busId)\n+                .setBus(busId)\n+                .setP0(psseLoad.getPl()) //TO DO: take into account Ip, Yp\n+                .setQ0(psseLoad.getQl()) //TO DO: take into account Iq, Yq\n+                .add();\n+\n+    }\n+\n+    private static void createShuntCompensator(PsseFixedShunt psseShunt, PerUnitContext perUnitContext, VoltageLevel voltageLevel) {\n+        String busId = getBusId(psseShunt.getI());\n+        double zb = Math.pow(voltageLevel.getNominalV(), 2) / perUnitContext.getSb();\n+        voltageLevel.newShuntCompensator()\n+                .setId(busId + \"-SH\" + psseShunt.getId())\n+                .setConnectableBus(busId)\n+                .setBus(busId)\n+                .setbPerSection(psseShunt.getBl())//TO DO: take into account gl\n+                .setCurrentSectionCount(1)\n+                .setMaximumSectionCount(1)\n+                .add();\n+\n+        if (psseShunt.getGl() != 0) {\n+            LOGGER.warn(\"Shunt Gl not supported ({})\", psseShunt.getI());\n+        }\n+    }\n+\n+    private static void createGenerator(PsseGenerator psseGen, VoltageLevel voltageLevel) {\n+        String busId = getBusId(psseGen.getI());\n+        Generator generator =  voltageLevel.newGenerator()\n+                .setId(busId + \"-G\" + psseGen.getId())\n+                .setConnectableBus(busId)\n+                .setBus(busId)\n+                .setTargetP(psseGen.getPg())\n+                .setMaxP(DEFAULT_ACTIVE_POWER_LIMIT)\n+                .setMinP(-DEFAULT_ACTIVE_POWER_LIMIT)\n+                .setVoltageRegulatorOn(false)\n+                .setTargetQ(psseGen.getQg())\n+                .add();\n+\n+        if (psseGen.getVs() > 0) {\n+            if (psseGen.getIreg() == 0) {\n+                //PV group\n+                generator.setTargetV(psseGen.getVs() * voltageLevel.getNominalV());\n+                generator.setVoltageRegulatorOn(true);\n+            } else {\n+                //TO DO : implement remote voltage control regulation\n+                LOGGER.warn(\"Remote Voltage control not supported ({})\", generator.getId());\n+            }\n+        }\n+        //TO DO: take into account zr zx Mbase...\n+    }\n+\n+    private static void createBuses(PsseRawModel psseModel, ContainersMapping containerMapping, PerUnitContext perUnitContext,\n+                                    Network network) {\n+        for (PsseBus psseBus : psseModel.getBuses()) {\n+            String voltageLevelId = containerMapping.getVoltageLevelId(psseBus.getI());\n+            String substationId = containerMapping.getSubstationId(voltageLevelId);\n+\n+            // create substation\n+            Substation substation = createSubstation(network, substationId);\n+\n+            // create voltage level\n+            VoltageLevel voltageLevel = createVoltageLevel(psseBus, perUnitContext, voltageLevelId, substation, network);\n+\n+            // create bus\n+            createBus(psseBus, voltageLevel);\n+\n+        }\n+    }\n+\n+    private static void createLine(PsseNonTransformerBranch psseLine, ContainersMapping containerMapping, PerUnitContext perUnitContext, Network network) {\n+        String id = \"L-\" + psseLine.getI() + \"-\" + psseLine.getJ() + \"-\" + psseLine.getCkt();\n+        String bus1Id = getBusId(psseLine.getI());\n+        String bus2Id = getBusId(psseLine.getJ());\n+        String voltageLevel1Id = containerMapping.getVoltageLevelId(psseLine.getI());\n+        String voltageLevel2Id = containerMapping.getVoltageLevelId(psseLine.getJ());\n+        VoltageLevel voltageLevel2 = network.getVoltageLevel(voltageLevel2Id);\n+        double zb = Math.pow(voltageLevel2.getNominalV(), 2) / perUnitContext.getSb();\n+        network.newLine()\n+                .setId(id)\n+                .setBus1(bus1Id)\n+                .setConnectableBus1(bus1Id)\n+                .setVoltageLevel1(voltageLevel1Id)\n+                .setBus2(bus2Id)\n+                .setConnectableBus2(bus2Id)\n+                .setVoltageLevel2(voltageLevel2Id)\n+                .setR(psseLine.getR() * zb)\n+                .setX(psseLine.getX() * zb)\n+                .setG1(0) //TO DO\n+                .setB1(psseLine.getB() / zb / 2)\n+                .setG2(0) //TO DO\n+                .setB2(psseLine.getB() / zb / 2)\n+                .add();\n+\n+        if (psseLine.getGi() != 0 || psseLine.getGj() != 0) {\n+            LOGGER.warn(\"Branch G not supported ({})\", psseLine.getI());\n+        }\n+    }\n+\n+    private static void createTransformer(PsseTransformer psseTfo, ContainersMapping containerMapping, PerUnitContext perUnitContext, Network network) {\n+        String id = \"T-\" + psseTfo.getFirstRecord().getI() + \"-\" + psseTfo.getFirstRecord().getJ() + \"-\" + psseTfo.getFirstRecord().getCkt();\n+        String bus1Id = getBusId(psseTfo.getFirstRecord().getI());\n+        String bus2Id = getBusId(psseTfo.getFirstRecord().getJ());\n+        String voltageLevel1Id = containerMapping.getVoltageLevelId(psseTfo.getFirstRecord().getI());\n+        String voltageLevel2Id = containerMapping.getVoltageLevelId(psseTfo.getFirstRecord().getJ());\n+        VoltageLevel voltageLevel1 = network.getVoltageLevel(voltageLevel1Id);\n+        VoltageLevel voltageLevel2 = network.getVoltageLevel(voltageLevel2Id);\n+        double zb = Math.pow(voltageLevel2.getNominalV(), 2) / perUnitContext.getSb();\n+\n+        if (psseTfo.getFirstRecord().getNmetr() == 2) {\n+            voltageLevel2.getSubstation().newTwoWindingsTransformer()\n+                    .setId(id)\n+                    .setBus1(bus1Id)\n+                    .setConnectableBus1(bus1Id)\n+                    .setVoltageLevel1(voltageLevel1Id)\n+                    .setBus2(bus2Id)\n+                    .setConnectableBus2(bus2Id)\n+                    .setVoltageLevel2(voltageLevel2Id)\n+                    .setRatedU1(voltageLevel1.getNominalV() * psseTfo.getThirdRecord1().getWindv())\n+                    .setRatedU2(voltageLevel2.getNominalV())\n+                    .setR(psseTfo.getSecondRecord().getR12() * zb)\n+                    .setX(psseTfo.getSecondRecord().getX12() * zb)\n+                    .setG(0) //TO DO\n+                    .setB(0) //TO DO\n+                    .add();\n+\n+        } else {\n+            LOGGER.warn(\"Non-2-windings transformers not supported ({})\", id);\n+        }\n+    }\n+\n+    @Override\n+    public Network importData(ReadOnlyDataSource dataSource, NetworkFactory networkFactory, Properties parameters) {\n+        Objects.requireNonNull(dataSource);\n+        Objects.requireNonNull(networkFactory);\n+\n+        Network network = networkFactory.createNetwork(dataSource.getBaseName(), FORMAT);\n+\n+        try (BufferedReader reader = new BufferedReader(new InputStreamReader(dataSource.newInputStream(null, EXT)))) {\n+\n+            // parse file\n+            PsseRawModel psseModel = new PsseRawReader().read(reader);\n+\n+            // set date and time\n+            // TO DO\n+\n+            // build container to fit IIDM requirements\n+            List<Object> branches = ImmutableList.builder()\n+                    .addAll(psseModel.getNonTransformerBranches())\n+                    .addAll(psseModel.getTransformers())\n+                    .build();\n+            ToIntFunction<Object> branchToNum1 = branch -> branch instanceof PsseNonTransformerBranch ? ((PsseNonTransformerBranch) branch).getI() : ((PsseTransformer) branch).getFirstRecord().getI();\n+            ToIntFunction<Object> branchToNum2 = branch -> branch instanceof PsseNonTransformerBranch ? ((PsseNonTransformerBranch) branch).getJ() : ((PsseTransformer) branch).getFirstRecord().getJ();\n+            ToDoubleFunction<Object> branchToResistance = branch -> branch instanceof PsseNonTransformerBranch ? ((PsseNonTransformerBranch) branch).getR() : ((PsseTransformer) branch).getSecondRecord().getR12();\n+            ToDoubleFunction<Object> branchToReactance = branch -> branch instanceof PsseNonTransformerBranch ? ((PsseNonTransformerBranch) branch).getX() : ((PsseTransformer) branch).getSecondRecord().getX12();\n+            Predicate<Object> branchToIsTransformer = branch -> branch instanceof PsseTransformer;\n+            ContainersMapping containerMapping = ContainersMapping.create(psseModel.getBuses(), branches, PsseBus::getI, branchToNum1,\n+                                                                          branchToNum2, branchToResistance, branchToReactance, branchToIsTransformer);\n+\n+            boolean ignoreBaseVoltage = ConversionParameters.readBooleanParameter(FORMAT, parameters, IGNORE_BASE_VOLTAGE_PARAMETER,\n+                    ParameterDefaultValueConfig.INSTANCE);\n+            PerUnitContext perUnitContext = new PerUnitContext(psseModel.getCaseIdentification().getSbase(), ignoreBaseVoltage);\n+\n+            // create buses\n+            createBuses(psseModel, containerMapping, perUnitContext, network);\n+\n+            //Create loads\n+            for (PsseLoad psseLoad : psseModel.getLoads()) {\n+                createLoad(psseLoad, network.getVoltageLevel(containerMapping.getVoltageLevelId(psseLoad.getI())));\n+            }\n+\n+            //Create shunts\n+            for (PsseFixedShunt psseShunt : psseModel.getFixedShunts()) {\n+                createShuntCompensator(psseShunt, perUnitContext, network.getVoltageLevel(containerMapping.getVoltageLevelId(psseShunt.getI())));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f60c63f99a38726eae129d62ce038fa0dacef32c"}, "originalPosition": 336}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNjgzODQyOnYy", "diffSide": "RIGHT", "path": "psse/psse-converter/src/main/java/com/powsybl/psse/converter/PsseImporter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMTowNTozNVrOGf9V5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMTowNTozNVrOGf9V5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE2NDA3MA==", "bodyText": "Same", "url": "https://github.com/powsybl/powsybl-core/pull/1338#discussion_r436164070", "createdAt": "2020-06-05T21:05:35Z", "author": {"login": "geofjamg"}, "path": "psse/psse-converter/src/main/java/com/powsybl/psse/converter/PsseImporter.java", "diffHunk": "@@ -0,0 +1,358 @@\n+/**\n+ * Copyright (c) 2019, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.psse.converter;\n+\n+import com.google.auto.service.AutoService;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.io.ByteStreams;\n+import com.powsybl.commons.datasource.DataSource;\n+import com.powsybl.commons.datasource.ReadOnlyDataSource;\n+import com.powsybl.iidm.ConversionParameters;\n+import com.powsybl.iidm.import_.Importer;\n+import com.powsybl.iidm.network.*;\n+import com.powsybl.iidm.network.util.ContainersMapping;\n+import com.powsybl.iidm.parameters.Parameter;\n+import com.powsybl.iidm.parameters.ParameterDefaultValueConfig;\n+import com.powsybl.iidm.parameters.ParameterType;\n+import com.powsybl.psse.model.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.*;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Properties;\n+import java.util.function.Predicate;\n+import java.util.function.ToDoubleFunction;\n+import java.util.function.ToIntFunction;\n+\n+/**\n+ * @author JB Heyberger <jean-baptiste.heyberger at rte-france.com>\n+ */\n+@AutoService(Importer.class)\n+public class PsseImporter implements Importer {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(PsseImporter.class);\n+\n+    private static final String FORMAT = \"PSS/E\";\n+\n+    private static final String EXT = \"raw\"; //TO DO: support both RAW and raw extensions\n+\n+    private static final Parameter IGNORE_BASE_VOLTAGE_PARAMETER = new Parameter(\"ignore-base-voltage\",\n+            ParameterType.BOOLEAN,\n+            \"Ignore base voltage specified in the file\",\n+            Boolean.TRUE);\n+\n+    private static final double DEFAULT_ACTIVE_POWER_LIMIT = 9999d;\n+\n+    @Override\n+    public String getFormat() {\n+        return FORMAT;\n+    }\n+\n+    @Override\n+    public List<Parameter> getParameters() {\n+        return Collections.singletonList(IGNORE_BASE_VOLTAGE_PARAMETER);\n+    }\n+\n+    @Override\n+    public String getComment() {\n+        return \"PSS/E Format to IIDM converter\";\n+    }\n+\n+    @Override\n+    public boolean exists(ReadOnlyDataSource dataSource) {\n+        try {\n+            if (dataSource.exists(null, EXT)) {\n+                try (BufferedReader reader = new BufferedReader(new InputStreamReader(dataSource.newInputStream(null, EXT)))) {\n+                    String titleLine = reader.readLine();\n+                    if (titleLine != null) {\n+                        return titleLine.length() >= 38\n+                                && titleLine.charAt(37) == '/';\n+                    }\n+                }\n+            }\n+        } catch (IOException e) {\n+            throw new UncheckedIOException(e);\n+        }\n+        return false;\n+    }\n+\n+    @Override\n+    public void copy(ReadOnlyDataSource fromDataSource, DataSource toDataSource) {\n+        Objects.requireNonNull(fromDataSource);\n+        Objects.requireNonNull(toDataSource);\n+        try {\n+            try (InputStream is = fromDataSource.newInputStream(null, EXT);\n+                 OutputStream os = toDataSource.newOutputStream(null, EXT, false)) {\n+                ByteStreams.copy(is, os);\n+            }\n+        } catch (IOException e) {\n+            throw new UncheckedIOException(e);\n+        }\n+    }\n+\n+    private static final class PerUnitContext {\n+\n+        private final double sb; // base apparent power\n+\n+        private final boolean ignoreBaseVoltage;\n+\n+        private PerUnitContext(double sb, boolean ignoreBaseVoltage) {\n+            this.sb = sb;\n+            this.ignoreBaseVoltage = ignoreBaseVoltage;\n+        }\n+\n+        private double getSb() {\n+            return sb;\n+        }\n+\n+        public boolean isIgnoreBaseVoltage() {\n+            return ignoreBaseVoltage;\n+        }\n+    }\n+\n+    private static String getBusId(int busNum) {\n+        return \"B\" + busNum;\n+    }\n+\n+    private static Bus createBus(PsseBus psseBus, VoltageLevel voltageLevel) {\n+        String busId = getBusId(psseBus.getI());\n+        Bus bus = voltageLevel.getBusBreakerView().newBus()\n+                .setId(busId)\n+                .setName(psseBus.getName())\n+                .add();\n+        bus.setV(psseBus.getVm() * voltageLevel.getNominalV())\n+                .setAngle(psseBus.getVa());\n+\n+        return bus;\n+    }\n+\n+    private static Substation createSubstation(Network network, String substationId) {\n+        Substation substation = network.getSubstation(substationId);\n+        if (substation == null) {\n+            substation = network.newSubstation()\n+                    .setId(substationId)\n+                    .add();\n+        }\n+        return substation;\n+    }\n+\n+    private static VoltageLevel createVoltageLevel(PsseBus psseBus, PerUnitContext perUnitContext,\n+                                                   String voltageLevelId, Substation substation, Network network) {\n+        double nominalV = perUnitContext.isIgnoreBaseVoltage() || psseBus.getBaskv() == 0 ? 1 : psseBus.getBaskv();\n+        VoltageLevel voltageLevel = network.getVoltageLevel(voltageLevelId);\n+        if (voltageLevel == null) {\n+            voltageLevel = substation.newVoltageLevel()\n+                    .setId(voltageLevelId)\n+                    .setNominalV(nominalV)\n+                    .setTopologyKind(TopologyKind.BUS_BREAKER)\n+                    .add();\n+        }\n+        return voltageLevel;\n+    }\n+\n+    private static void createLoad(PsseLoad psseLoad, VoltageLevel voltageLevel) {\n+        String busId = getBusId(psseLoad.getI());\n+        voltageLevel.newLoad()\n+                .setId(busId + \"-L\" + psseLoad.getId())\n+                .setConnectableBus(busId)\n+                .setBus(busId)\n+                .setP0(psseLoad.getPl()) //TO DO: take into account Ip, Yp\n+                .setQ0(psseLoad.getQl()) //TO DO: take into account Iq, Yq\n+                .add();\n+\n+    }\n+\n+    private static void createShuntCompensator(PsseFixedShunt psseShunt, PerUnitContext perUnitContext, VoltageLevel voltageLevel) {\n+        String busId = getBusId(psseShunt.getI());\n+        double zb = Math.pow(voltageLevel.getNominalV(), 2) / perUnitContext.getSb();\n+        voltageLevel.newShuntCompensator()\n+                .setId(busId + \"-SH\" + psseShunt.getId())\n+                .setConnectableBus(busId)\n+                .setBus(busId)\n+                .setbPerSection(psseShunt.getBl())//TO DO: take into account gl\n+                .setCurrentSectionCount(1)\n+                .setMaximumSectionCount(1)\n+                .add();\n+\n+        if (psseShunt.getGl() != 0) {\n+            LOGGER.warn(\"Shunt Gl not supported ({})\", psseShunt.getI());\n+        }\n+    }\n+\n+    private static void createGenerator(PsseGenerator psseGen, VoltageLevel voltageLevel) {\n+        String busId = getBusId(psseGen.getI());\n+        Generator generator =  voltageLevel.newGenerator()\n+                .setId(busId + \"-G\" + psseGen.getId())\n+                .setConnectableBus(busId)\n+                .setBus(busId)\n+                .setTargetP(psseGen.getPg())\n+                .setMaxP(DEFAULT_ACTIVE_POWER_LIMIT)\n+                .setMinP(-DEFAULT_ACTIVE_POWER_LIMIT)\n+                .setVoltageRegulatorOn(false)\n+                .setTargetQ(psseGen.getQg())\n+                .add();\n+\n+        if (psseGen.getVs() > 0) {\n+            if (psseGen.getIreg() == 0) {\n+                //PV group\n+                generator.setTargetV(psseGen.getVs() * voltageLevel.getNominalV());\n+                generator.setVoltageRegulatorOn(true);\n+            } else {\n+                //TO DO : implement remote voltage control regulation\n+                LOGGER.warn(\"Remote Voltage control not supported ({})\", generator.getId());\n+            }\n+        }\n+        //TO DO: take into account zr zx Mbase...\n+    }\n+\n+    private static void createBuses(PsseRawModel psseModel, ContainersMapping containerMapping, PerUnitContext perUnitContext,\n+                                    Network network) {\n+        for (PsseBus psseBus : psseModel.getBuses()) {\n+            String voltageLevelId = containerMapping.getVoltageLevelId(psseBus.getI());\n+            String substationId = containerMapping.getSubstationId(voltageLevelId);\n+\n+            // create substation\n+            Substation substation = createSubstation(network, substationId);\n+\n+            // create voltage level\n+            VoltageLevel voltageLevel = createVoltageLevel(psseBus, perUnitContext, voltageLevelId, substation, network);\n+\n+            // create bus\n+            createBus(psseBus, voltageLevel);\n+\n+        }\n+    }\n+\n+    private static void createLine(PsseNonTransformerBranch psseLine, ContainersMapping containerMapping, PerUnitContext perUnitContext, Network network) {\n+        String id = \"L-\" + psseLine.getI() + \"-\" + psseLine.getJ() + \"-\" + psseLine.getCkt();\n+        String bus1Id = getBusId(psseLine.getI());\n+        String bus2Id = getBusId(psseLine.getJ());\n+        String voltageLevel1Id = containerMapping.getVoltageLevelId(psseLine.getI());\n+        String voltageLevel2Id = containerMapping.getVoltageLevelId(psseLine.getJ());\n+        VoltageLevel voltageLevel2 = network.getVoltageLevel(voltageLevel2Id);\n+        double zb = Math.pow(voltageLevel2.getNominalV(), 2) / perUnitContext.getSb();\n+        network.newLine()\n+                .setId(id)\n+                .setBus1(bus1Id)\n+                .setConnectableBus1(bus1Id)\n+                .setVoltageLevel1(voltageLevel1Id)\n+                .setBus2(bus2Id)\n+                .setConnectableBus2(bus2Id)\n+                .setVoltageLevel2(voltageLevel2Id)\n+                .setR(psseLine.getR() * zb)\n+                .setX(psseLine.getX() * zb)\n+                .setG1(0) //TO DO\n+                .setB1(psseLine.getB() / zb / 2)\n+                .setG2(0) //TO DO\n+                .setB2(psseLine.getB() / zb / 2)\n+                .add();\n+\n+        if (psseLine.getGi() != 0 || psseLine.getGj() != 0) {\n+            LOGGER.warn(\"Branch G not supported ({})\", psseLine.getI());\n+        }\n+    }\n+\n+    private static void createTransformer(PsseTransformer psseTfo, ContainersMapping containerMapping, PerUnitContext perUnitContext, Network network) {\n+        String id = \"T-\" + psseTfo.getFirstRecord().getI() + \"-\" + psseTfo.getFirstRecord().getJ() + \"-\" + psseTfo.getFirstRecord().getCkt();\n+        String bus1Id = getBusId(psseTfo.getFirstRecord().getI());\n+        String bus2Id = getBusId(psseTfo.getFirstRecord().getJ());\n+        String voltageLevel1Id = containerMapping.getVoltageLevelId(psseTfo.getFirstRecord().getI());\n+        String voltageLevel2Id = containerMapping.getVoltageLevelId(psseTfo.getFirstRecord().getJ());\n+        VoltageLevel voltageLevel1 = network.getVoltageLevel(voltageLevel1Id);\n+        VoltageLevel voltageLevel2 = network.getVoltageLevel(voltageLevel2Id);\n+        double zb = Math.pow(voltageLevel2.getNominalV(), 2) / perUnitContext.getSb();\n+\n+        if (psseTfo.getFirstRecord().getNmetr() == 2) {\n+            voltageLevel2.getSubstation().newTwoWindingsTransformer()\n+                    .setId(id)\n+                    .setBus1(bus1Id)\n+                    .setConnectableBus1(bus1Id)\n+                    .setVoltageLevel1(voltageLevel1Id)\n+                    .setBus2(bus2Id)\n+                    .setConnectableBus2(bus2Id)\n+                    .setVoltageLevel2(voltageLevel2Id)\n+                    .setRatedU1(voltageLevel1.getNominalV() * psseTfo.getThirdRecord1().getWindv())\n+                    .setRatedU2(voltageLevel2.getNominalV())\n+                    .setR(psseTfo.getSecondRecord().getR12() * zb)\n+                    .setX(psseTfo.getSecondRecord().getX12() * zb)\n+                    .setG(0) //TO DO\n+                    .setB(0) //TO DO\n+                    .add();\n+\n+        } else {\n+            LOGGER.warn(\"Non-2-windings transformers not supported ({})\", id);\n+        }\n+    }\n+\n+    @Override\n+    public Network importData(ReadOnlyDataSource dataSource, NetworkFactory networkFactory, Properties parameters) {\n+        Objects.requireNonNull(dataSource);\n+        Objects.requireNonNull(networkFactory);\n+\n+        Network network = networkFactory.createNetwork(dataSource.getBaseName(), FORMAT);\n+\n+        try (BufferedReader reader = new BufferedReader(new InputStreamReader(dataSource.newInputStream(null, EXT)))) {\n+\n+            // parse file\n+            PsseRawModel psseModel = new PsseRawReader().read(reader);\n+\n+            // set date and time\n+            // TO DO\n+\n+            // build container to fit IIDM requirements\n+            List<Object> branches = ImmutableList.builder()\n+                    .addAll(psseModel.getNonTransformerBranches())\n+                    .addAll(psseModel.getTransformers())\n+                    .build();\n+            ToIntFunction<Object> branchToNum1 = branch -> branch instanceof PsseNonTransformerBranch ? ((PsseNonTransformerBranch) branch).getI() : ((PsseTransformer) branch).getFirstRecord().getI();\n+            ToIntFunction<Object> branchToNum2 = branch -> branch instanceof PsseNonTransformerBranch ? ((PsseNonTransformerBranch) branch).getJ() : ((PsseTransformer) branch).getFirstRecord().getJ();\n+            ToDoubleFunction<Object> branchToResistance = branch -> branch instanceof PsseNonTransformerBranch ? ((PsseNonTransformerBranch) branch).getR() : ((PsseTransformer) branch).getSecondRecord().getR12();\n+            ToDoubleFunction<Object> branchToReactance = branch -> branch instanceof PsseNonTransformerBranch ? ((PsseNonTransformerBranch) branch).getX() : ((PsseTransformer) branch).getSecondRecord().getX12();\n+            Predicate<Object> branchToIsTransformer = branch -> branch instanceof PsseTransformer;\n+            ContainersMapping containerMapping = ContainersMapping.create(psseModel.getBuses(), branches, PsseBus::getI, branchToNum1,\n+                                                                          branchToNum2, branchToResistance, branchToReactance, branchToIsTransformer);\n+\n+            boolean ignoreBaseVoltage = ConversionParameters.readBooleanParameter(FORMAT, parameters, IGNORE_BASE_VOLTAGE_PARAMETER,\n+                    ParameterDefaultValueConfig.INSTANCE);\n+            PerUnitContext perUnitContext = new PerUnitContext(psseModel.getCaseIdentification().getSbase(), ignoreBaseVoltage);\n+\n+            // create buses\n+            createBuses(psseModel, containerMapping, perUnitContext, network);\n+\n+            //Create loads\n+            for (PsseLoad psseLoad : psseModel.getLoads()) {\n+                createLoad(psseLoad, network.getVoltageLevel(containerMapping.getVoltageLevelId(psseLoad.getI())));\n+            }\n+\n+            //Create shunts\n+            for (PsseFixedShunt psseShunt : psseModel.getFixedShunts()) {\n+                createShuntCompensator(psseShunt, perUnitContext, network.getVoltageLevel(containerMapping.getVoltageLevelId(psseShunt.getI())));\n+            }\n+\n+            for (PsseGenerator psseGen : psseModel.getGenerators()) {\n+                createGenerator(psseGen, network.getVoltageLevel(containerMapping.getVoltageLevelId(psseGen.getI())));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f60c63f99a38726eae129d62ce038fa0dacef32c"}, "originalPosition": 340}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNjg0MzIxOnYy", "diffSide": "RIGHT", "path": "psse/psse-converter/src/test/java/com/powsybl/psse/converter/PsseImporterTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMTowNzozOVrOGf9YvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QxOTo1NTo0OVrOGgLhQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE2NDc5Nw==", "bodyText": "Licence header should be before the package declaration\nyear is wrong", "url": "https://github.com/powsybl/powsybl-core/pull/1338#discussion_r436164797", "createdAt": "2020-06-05T21:07:39Z", "author": {"login": "geofjamg"}, "path": "psse/psse-converter/src/test/java/com/powsybl/psse/converter/PsseImporterTest.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package com.powsybl.psse.converter;\n+\n+/**\n+ * Copyright (c) 2019, RTE (http://www.rte-france.com)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f60c63f99a38726eae129d62ce038fa0dacef32c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM5NjM1Mg==", "bodyText": "ok", "url": "https://github.com/powsybl/powsybl-core/pull/1338#discussion_r436396352", "createdAt": "2020-06-07T19:55:49Z", "author": {"login": "JB-H"}, "path": "psse/psse-converter/src/test/java/com/powsybl/psse/converter/PsseImporterTest.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package com.powsybl.psse.converter;\n+\n+/**\n+ * Copyright (c) 2019, RTE (http://www.rte-france.com)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE2NDc5Nw=="}, "originalCommit": {"oid": "f60c63f99a38726eae129d62ce038fa0dacef32c"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNjg0NTY2OnYy", "diffSide": "RIGHT", "path": "psse/psse-converter/src/test/java/com/powsybl/psse/converter/PsseImporterTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMTowODo0NlrOGf9aEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMTowODo0NlrOGf9aEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE2NTEzOQ==", "bodyText": "Like in IEEE importer you should export the imported network to xiidm and then compare to a reference xiidm stored in resources.", "url": "https://github.com/powsybl/powsybl-core/pull/1338#discussion_r436165139", "createdAt": "2020-06-05T21:08:46Z", "author": {"login": "geofjamg"}, "path": "psse/psse-converter/src/test/java/com/powsybl/psse/converter/PsseImporterTest.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package com.powsybl.psse.converter;\n+\n+/**\n+ * Copyright (c) 2019, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+\n+import static org.junit.Assert.assertEquals;\n+\n+import com.powsybl.commons.datasource.ReadOnlyDataSource;\n+import org.junit.Test;\n+\n+import com.powsybl.commons.AbstractConverterTest;\n+import com.powsybl.commons.datasource.ResourceDataSource;\n+import com.powsybl.commons.datasource.ResourceSet;\n+import com.powsybl.iidm.import_.Importer;\n+import com.powsybl.iidm.network.*;\n+\n+/**\n+ * @author JB Heyberger <jean-baptiste.heyberger at rte-france.com>\n+ */\n+public class PsseImporterTest extends AbstractConverterTest {\n+\n+    @Test\n+    public void baseTest() {\n+        Importer importer = new PsseImporter();\n+        assertEquals(\"PSS/E\", importer.getFormat());\n+        assertEquals(\"PSS/E Format to IIDM converter\", importer.getComment());\n+        assertEquals(1, importer.getParameters().size());\n+        assertEquals(\"ignore-base-voltage\", importer.getParameters().get(0).getName());\n+    }\n+\n+    @Test\n+    public void importTest() {\n+        ReadOnlyDataSource dataSource = new ResourceDataSource(\"IEEE_14_bus\", new ResourceSet(\"/\", \"IEEE_14_bus.raw\"));\n+        Network network = new PsseImporter().importData(dataSource, null);\n+        assertEquals(\"IEEE_14_bus\", network.getId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f60c63f99a38726eae129d62ce038fa0dacef32c"}, "originalPosition": 39}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 144, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}