{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyODY2MTEz", "number": 1345, "title": "Dynamic Model Provider", "bodyText": "Please check if the PR fulfills these requirements (please use '[x]' to check the checkboxes, or submit the PR and then click the checkboxes)\n\n The commit message follows our guidelines\n Tests for the changes have been added (for bug fixes / features)\n Docs have been added / updated (for bug fixes / features)\n\nWhat kind of change does this PR introduce? (Bug fix, feature, docs update, ...)\nFeature\nWhat is the current behavior? (You can also link to an open issue here)\nThe dynamic-simulation command doesn't support mapping file.\nWhat is the new behavior (if this is a feature change)?\nThe mapping file can be passed to the command, and loaded. Only groovy is supported yet.", "createdAt": "2020-06-11T06:24:34Z", "url": "https://github.com/powsybl/powsybl-core/pull/1345", "merged": true, "mergeCommit": {"oid": "14b409de92de11d6ca4a63fd177c8541bef1bce1"}, "closed": true, "closedAt": "2020-06-15T09:36:20Z", "author": {"login": "marcosmc"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcplKWPAH2gAyNDMyODY2MTEzOjM2YmQwNWYzZWI3MzBiMmNlOGJlNTBhNWFjZDliZWMzZjhmNzMzZDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcrdBx6gH2gAyNDMyODY2MTEzOmU2ZmM0Y2U3NDg2M2JmMTRlY2NmYWVkN2I4NWYyZDlhZDNlYjBkODU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "36bd05f3eb730b2ce8be50a5acd9bec3f8f733d1", "author": {"user": {"login": "marcosmc", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/36bd05f3eb730b2ce8be50a5acd9bec3f8f733d1", "committedDate": "2020-06-09T13:34:46Z", "message": "add Mapping supplier\n\nSigned-off-by: Marcos de Miguel <demiguelm@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4c31ed5dc66c25fb8087d42afb24c402e3151c1", "author": {"user": {"login": "marcosmc", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/a4c31ed5dc66c25fb8087d42afb24c402e3151c1", "committedDate": "2020-06-11T07:49:52Z", "message": "Merge branch 'master' into dynamic-mapping-provider"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4OTQ5NjUx", "url": "https://github.com/powsybl/powsybl-core/pull/1345#pullrequestreview-428949651", "createdAt": "2020-06-11T14:07:57Z", "commit": {"oid": "a4c31ed5dc66c25fb8087d42afb24c402e3151c1"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNDowNzo1N1rOGifFuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNDoxNjozMFrOGifcuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgxNDEzNg==", "bodyText": "To be consistent with the curves this class should be named DynamicModelGroovyExtension", "url": "https://github.com/powsybl/powsybl-core/pull/1345#discussion_r438814136", "createdAt": "2020-06-11T14:07:57Z", "author": {"login": "agnesLeroy"}, "path": "dynamic-simulation/dynamic-simulation-dsl/src/main/java/com/powsybl/dynamicsimulation/groovy/DynamicModelExtension.java", "diffHunk": "@@ -0,0 +1,16 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+\n+package com.powsybl.dynamicsimulation.groovy;\n+\n+import com.powsybl.dynamicsimulation.DynamicModel;\n+\n+/**\n+ * @author Marcos de Miguel <demiguelm at aia.es>\n+ */\n+public interface DynamicModelExtension extends GroovyExtension<DynamicModel> {\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4c31ed5dc66c25fb8087d42afb24c402e3151c1"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgxNTAyMg==", "bodyText": "Same remark as above, this class should be named DummyDynamicModelGroovyExtension.", "url": "https://github.com/powsybl/powsybl-core/pull/1345#discussion_r438815022", "createdAt": "2020-06-11T14:09:19Z", "author": {"login": "agnesLeroy"}, "path": "dynamic-simulation/dynamic-simulation-dsl/src/test/groovy/com/powsybl/dynamicsimulation/groovy/DummyDynamicModelExtension.groovy", "diffHunk": "@@ -0,0 +1,60 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.dynamicsimulation.groovy\n+\n+import java.util.function.Consumer\n+\n+import com.google.auto.service.AutoService\n+import com.powsybl.dsl.DslException\n+import com.powsybl.dynamicsimulation.DynamicModel\n+\n+/**\n+ * @author Marcos de Miguel <demiguelm at aia.es>\n+ */\n+@AutoService(DynamicModelExtension.class)\n+class DummyDynamicModelExtension implements DynamicModelExtension {\n+\n+    static class DummyDynamicModelSpec {\n+        String id\n+        String parameterSetId\n+        String parameterSetFile\n+        \n+        void id(String id) {\n+            this.id = id\n+        }\n+\n+        void parameterSetId(String parameterSetId) {\n+            this.parameterSetId = parameterSetId\n+        }\n+\n+        void parameterSetFile(String parameterSetFile) {\n+            this.parameterSetFile = parameterSetFile\n+        }\n+    }\n+\n+    void load(Binding binding, Consumer<DynamicModel> consumer) {\n+        binding.dummyDynamicModel = { Closure<Void> closure ->\n+            def cloned = closure.clone()\n+\n+            DummyDynamicModelSpec dynamicModelSpec = new DummyDynamicModelSpec()\n+\n+            cloned.delegate = dynamicModelSpec\n+            cloned()\n+            if (!dynamicModelSpec.id) {\n+                throw new DslException(\"'id' field is not set\")\n+            }\n+            if (!dynamicModelSpec.parameterSetId) {\n+                throw new DslException(\"'parameterSetId' field is not set\")\n+            }\n+            if (!dynamicModelSpec.parameterSetFile) {\n+                throw new DslException(\"'parameterSetFile' field is not set\")\n+            }\n+\n+            consumer.accept(new DummyDynamicModel(dynamicModelSpec.id, dynamicModelSpec.parameterSetId, dynamicModelSpec.parameterSetFile))\n+        }\n+    }\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4c31ed5dc66c25fb8087d42afb24c402e3151c1"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgyMDAyNQ==", "bodyText": "Why do we have the parameterSetFile here? I was expecting to have only an Id (that will be either the static Id o the dynamic model Id) and a parameter Id. Am I wrong?", "url": "https://github.com/powsybl/powsybl-core/pull/1345#discussion_r438820025", "createdAt": "2020-06-11T14:16:30Z", "author": {"login": "agnesLeroy"}, "path": "dynamic-simulation/dynamic-simulation-dsl/src/test/java/com/powsybl/dynamicsimulation/groovy/DummyDynamicModel.java", "diffHunk": "@@ -0,0 +1,43 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+\n+package com.powsybl.dynamicsimulation.groovy;\n+\n+import java.util.Objects;\n+\n+import com.powsybl.dynamicsimulation.DynamicModel;\n+\n+/**\n+ * @author Marcos de Miguel <demiguelm at aia.es>\n+ */\n+public class DummyDynamicModel implements DynamicModel {\n+\n+    private final String id;\n+\n+    private final String parameterSetId;\n+\n+    private final String parameterSetFile;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4c31ed5dc66c25fb8087d42afb24c402e3151c1"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37ed7e2005a7055e320bb23324dce911413f1427", "author": {"user": {"login": "marcosmc", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/37ed7e2005a7055e320bb23324dce911413f1427", "committedDate": "2020-06-11T14:41:52Z", "message": "rename DynamicModelExtension to DynamicModelGroovyExtension\n\nSigned-off-by: Marcos de Miguel <demiguelm@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27fa0ee795008fc1e84c5c08e38e1a74c083496a", "author": {"user": {"login": "marcosmc", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/27fa0ee795008fc1e84c5c08e38e1a74c083496a", "committedDate": "2020-06-11T14:54:29Z", "message": "rename DummyDynamicModelExtension to DummyDynamicModelGroovyExtension\n\nSigned-off-by: Marcos de Miguel <demiguelm@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20bafe32614e3fdd69b26fca690637d614820d90", "author": {"user": {"login": "marcosmc", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/20bafe32614e3fdd69b26fca690637d614820d90", "committedDate": "2020-06-11T15:13:36Z", "message": "remove parameterSetFile from Unit Tests\n\nSigned-off-by: Marcos de Miguel <demiguelm@aia.es>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5MDU4Njgw", "url": "https://github.com/powsybl/powsybl-core/pull/1345#pullrequestreview-429058680", "createdAt": "2020-06-11T15:57:12Z", "commit": {"oid": "20bafe32614e3fdd69b26fca690637d614820d90"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNTo1NzoxMlrOGikIeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNjowMTozMlrOGikTxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg5Njc2MQ==", "bodyText": "I'm not sure the name of this class is clear enough: we do not know the purpose of the mapping.\nDo we really want this empty method? Does it make sense to have an empty mapping? It seems to be used in the unit-test, so maybe we should remove this method from the API and move it to the test sources", "url": "https://github.com/powsybl/powsybl-core/pull/1345#discussion_r438896761", "createdAt": "2020-06-11T15:57:12Z", "author": {"login": "mathbagu"}, "path": "dynamic-simulation/dynamic-simulation-api/src/main/java/com/powsybl/dynamicsimulation/MappingSupplier.java", "diffHunk": "@@ -0,0 +1,20 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+\n+package com.powsybl.dynamicsimulation;\n+\n+import java.util.Collections;\n+\n+/**\n+ * @author Marcos de Miguel <demiguelm at aia.es>\n+ */\n+public interface MappingSupplier extends SimulatorInputSupplier<DynamicModel> {\n+\n+    static MappingSupplier empty() {\n+        return network -> Collections.emptyList();\n+    }\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20bafe32614e3fdd69b26fca690637d614820d90"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg5NzU5NQ==", "bodyText": "Same remark about the name of the class", "url": "https://github.com/powsybl/powsybl-core/pull/1345#discussion_r438897595", "createdAt": "2020-06-11T15:58:25Z", "author": {"login": "mathbagu"}, "path": "dynamic-simulation/dynamic-simulation-dsl/src/main/java/com/powsybl/dynamicsimulation/groovy/GroovyMappingSupplier.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+\n+package com.powsybl.dynamicsimulation.groovy;\n+\n+import java.nio.file.Path;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+\n+import org.codehaus.groovy.control.CompilerConfiguration;\n+\n+import com.powsybl.dsl.ExpressionDslLoader;\n+import com.powsybl.dsl.GroovyScripts;\n+import com.powsybl.dynamicsimulation.DynamicModel;\n+import com.powsybl.dynamicsimulation.MappingSupplier;\n+import com.powsybl.iidm.network.Network;\n+\n+import groovy.lang.Binding;\n+import groovy.lang.GroovyCodeSource;\n+import groovy.lang.GroovyShell;\n+\n+/**\n+ * @author Marcos de Miguel <demiguelm at aia.es>\n+ */\n+public class GroovyMappingSupplier implements MappingSupplier {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20bafe32614e3fdd69b26fca690637d614820d90"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg5ODkyMQ==", "bodyText": "You should adapt the logger name.", "url": "https://github.com/powsybl/powsybl-core/pull/1345#discussion_r438898921", "createdAt": "2020-06-11T16:00:24Z", "author": {"login": "mathbagu"}, "path": "dynamic-simulation/dynamic-simulation-dsl/src/test/resources/mapping.groovy", "diffHunk": "@@ -0,0 +1,25 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+\n+import com.powsybl.iidm.network.Generator\n+import com.powsybl.iidm.network.Load\n+import org.slf4j.Logger\n+import org.slf4j.LoggerFactory\n+\n+Logger logger = LoggerFactory.getLogger(\"com.powsybl.dynamicsimulation.groovy.GroovyCurvesProvider\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20bafe32614e3fdd69b26fca690637d614820d90"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg5OTIwOQ==", "bodyText": "we should also change this option's name", "url": "https://github.com/powsybl/powsybl-core/pull/1345#discussion_r438899209", "createdAt": "2020-06-11T16:00:49Z", "author": {"login": "mathbagu"}, "path": "dynamic-simulation/dynamic-simulation-tool/src/main/java/com/powsybl/dynamicsimulation/tool/DynamicSimulationTool.java", "diffHunk": "@@ -45,6 +48,7 @@\n public class DynamicSimulationTool implements Tool {\n \n     private static final String CASE_FILE = \"case-file\";\n+    private static final String MAPPING_FILE = \"mapping-file\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20bafe32614e3fdd69b26fca690637d614820d90"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg5OTQ0Ng==", "bodyText": "And give more detail in the description", "url": "https://github.com/powsybl/powsybl-core/pull/1345#discussion_r438899446", "createdAt": "2020-06-11T16:01:12Z", "author": {"login": "mathbagu"}, "path": "dynamic-simulation/dynamic-simulation-tool/src/main/java/com/powsybl/dynamicsimulation/tool/DynamicSimulationTool.java", "diffHunk": "@@ -78,6 +82,12 @@ public Options getOptions() {\n                     .argName(\"FILE\")\n                     .required()\n                     .build());\n+                options.addOption(Option.builder().longOpt(MAPPING_FILE)\n+                    .desc(\"mapping description as Groovy file\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20bafe32614e3fdd69b26fca690637d614820d90"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg5OTY1Mg==", "bodyText": "This option is required so this test is useless.", "url": "https://github.com/powsybl/powsybl-core/pull/1345#discussion_r438899652", "createdAt": "2020-06-11T16:01:32Z", "author": {"login": "mathbagu"}, "path": "dynamic-simulation/dynamic-simulation-tool/src/main/java/com/powsybl/dynamicsimulation/tool/DynamicSimulationTool.java", "diffHunk": "@@ -131,6 +141,12 @@ public void run(CommandLine line, ToolRunningContext context) throws Exception {\n \n         DynamicSimulation.Runner runner = DynamicSimulation.find();\n \n+        MappingSupplier mappingSupplier = MappingSupplier.empty();\n+        if (line.hasOption(MAPPING_FILE)) {\n+            Path mappingFile = context.getFileSystem().getPath(line.getOptionValue(MAPPING_FILE));\n+            mappingSupplier = createMappingSupplier(mappingFile, runner.getName());\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20bafe32614e3fdd69b26fca690637d614820d90"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5MDgzNzUz", "url": "https://github.com/powsybl/powsybl-core/pull/1345#pullrequestreview-429083753", "createdAt": "2020-06-11T16:26:48Z", "commit": {"oid": "20bafe32614e3fdd69b26fca690637d614820d90"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7907bba034aea20d4ce5b1e48189775b6b3c972", "author": {"user": {"login": "marcosmc", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/a7907bba034aea20d4ce5b1e48189775b6b3c972", "committedDate": "2020-06-12T07:14:20Z", "message": "change \"mapping\" to \"dynamicmodel\"\n\nSigned-off-by: Marcos de Miguel <demiguelm@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9c265289c97cbe8179d45d3e5420cc37f612bdd", "author": {"user": {"login": "marcosmc", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/a9c265289c97cbe8179d45d3e5420cc37f612bdd", "committedDate": "2020-06-12T07:46:19Z", "message": "Fix logger\n\nSigned-off-by: Marcos de Miguel <demiguelm@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f1aa552b9b99c6651a9737cc79f506a83c63865", "author": {"user": {"login": "marcosmc", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/7f1aa552b9b99c6651a9737cc79f506a83c63865", "committedDate": "2020-06-14T09:23:11Z", "message": "change \"DynamicModelSupplier\" to \"DynamicModelsSupplier\"\n\nSigned-off-by: Marcos de Miguel <demiguelm@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad14c6ae7564ea06b4d67e6de9f7434a2197ccfc", "author": {"user": {"login": "mathbagu", "name": "Mathieu BAGUE"}}, "url": "https://github.com/powsybl/powsybl-core/commit/ad14c6ae7564ea06b4d67e6de9f7434a2197ccfc", "committedDate": "2020-06-15T09:11:50Z", "message": "Fix implementation\n\nSigned-off-by: Mathieu BAGUE <mathieu.bague@rte-france.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6fc4ce74863bf14eccfaed7b85f2d9ad3eb0d85", "author": {"user": {"login": "mathbagu", "name": "Mathieu BAGUE"}}, "url": "https://github.com/powsybl/powsybl-core/commit/e6fc4ce74863bf14eccfaed7b85f2d9ad3eb0d85", "committedDate": "2020-06-15T09:14:01Z", "message": "Merge branch 'master' into dynamic-mapping-provider"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4323, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}