{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzMzk2ODYy", "number": 1202, "reviewThreads": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwOToxMDo0N1rODlV25Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMjoyMTozMlrODqxEww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNDgyMDIxOnYy", "diffSide": "RIGHT", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ShuntCompensatorLinearModelImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwOToxMDo0N1rOFyLdNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwOToxMDo0N1rOFyLdNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODE2MDgyMA==", "bodyText": "Are these two methods really public?", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r388160820", "createdAt": "2020-03-05T09:10:47Z", "author": {"login": "mathbagu"}, "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ShuntCompensatorLinearModelImpl.java", "diffHunk": "@@ -0,0 +1,96 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.impl;\n+\n+import com.powsybl.iidm.network.ShuntCompensatorLinearModel;\n+import com.powsybl.iidm.network.ShuntCompensatorModelType;\n+import com.powsybl.iidm.network.Validable;\n+import com.powsybl.iidm.network.ValidationUtil;\n+\n+/**\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ */\n+class ShuntCompensatorLinearModelImpl extends AbstractShuntCompensatorModel implements ShuntCompensatorLinearModel {\n+\n+    private double bPerSection;\n+\n+    private double gPerSection;\n+\n+    private int maximumSectionCount;\n+\n+    ShuntCompensatorLinearModelImpl(double bPerSection, double gPerSection, int maximumSectionCount) {\n+        this.bPerSection = bPerSection;\n+        this.gPerSection = gPerSection;\n+        this.maximumSectionCount = maximumSectionCount;\n+    }\n+\n+    @Override\n+    public double getbPerSection() {\n+        return bPerSection;\n+    }\n+\n+    @Override\n+    public ShuntCompensatorLinearModel setbPerSection(double bPerSection) {\n+        ValidationUtil.checkbPerSection(shuntCompensator, bPerSection);\n+        double oldValue = this.bPerSection;\n+        this.bPerSection = bPerSection;\n+        shuntCompensator.notifyUpdate(\"bPerSection\", oldValue, bPerSection);\n+        return this;\n+    }\n+\n+    @Override\n+    public double getgPerSection() {\n+        return gPerSection;\n+    }\n+\n+    @Override\n+    public ShuntCompensatorLinearModel setgPerSection(double gPerSection) {\n+        double oldValue = this.gPerSection;\n+        this.gPerSection = gPerSection;\n+        shuntCompensator.notifyUpdate(\"gPerSection\", oldValue, gPerSection);\n+        return this;\n+    }\n+\n+    @Override\n+    public int getMaximumSectionCount() {\n+        return maximumSectionCount;\n+    }\n+\n+    @Override\n+    public ShuntCompensatorLinearModel setMaximumSectionCount(int maximumSectionCount) {\n+        ValidationUtil.checkSections(shuntCompensator, shuntCompensator.getCurrentSectionCount(), maximumSectionCount);\n+        int oldValue = this.maximumSectionCount;\n+        this.maximumSectionCount = maximumSectionCount;\n+        shuntCompensator.notifyUpdate(\"maximumSectionCount\", oldValue, maximumSectionCount);\n+        return this;\n+    }\n+\n+    @Override\n+    public ShuntCompensatorModelType getType() {\n+        return ShuntCompensatorModelType.LINEAR;\n+    }\n+\n+    @Override\n+    public void checkCurrentSection(int currentSectionCount) {\n+        checkCurrentSection(shuntCompensator, currentSectionCount);\n+    }\n+\n+    @Override\n+    public void checkCurrentSection(Validable validable, int currentSectionCount) {\n+        ValidationUtil.checkSections(validable, currentSectionCount, maximumSectionCount);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a332a111325e8a2762e64978bca3a75f804ba79"}, "originalPosition": 85}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNDgyNTU3OnYy", "diffSide": "RIGHT", "path": "iidm/iidm-scripting/src/main/groovy/com/powsybl/iidm/network/scripting/ShuntCompensatorExtension.groovy", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwOToxMjoxNlrOFyLgVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwOToxMjoxNlrOFyLgVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODE2MTYyMA==", "bodyText": "Add the model type in the message", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r388161620", "createdAt": "2020-03-05T09:12:16Z", "author": {"login": "mathbagu"}, "path": "iidm/iidm-scripting/src/main/groovy/com/powsybl/iidm/network/scripting/ShuntCompensatorExtension.groovy", "diffHunk": "@@ -0,0 +1,62 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+\n+package com.powsybl.iidm.network.scripting\n+\n+import com.powsybl.commons.PowsyblException\n+import com.powsybl.iidm.network.ShuntCompensator\n+import com.powsybl.iidm.network.ShuntCompensatorLinearModel\n+import com.powsybl.iidm.network.ShuntCompensatorModelType\n+import com.powsybl.iidm.network.ShuntCompensatorNonLinearModel\n+\n+/**\n+ *\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ */\n+class ShuntCompensatorExtension {\n+\n+    static double getMaximumB(ShuntCompensator self) {\n+        if (ShuntCompensatorModelType.LINEAR == self.getModelType()) {\n+            // forward bPerSection * maximumSectionCount for linear shunts\n+            return self.getModel(ShuntCompensatorLinearModel.class).getbPerSection() * self.getModel().getMaximumSectionCount()\n+        } else if (ShuntCompensatorModelType.NON_LINEAR == self.getModelType()) {\n+            return self.getModel(ShuntCompensatorNonLinearModel.class).getMaximumB()\n+        }\n+        throw new PowsyblException(\"Unexpected shunt model type\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a332a111325e8a2762e64978bca3a75f804ba79"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwODc4Mzg4OnYy", "diffSide": "RIGHT", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ShuntCompensatorModel.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwODo0OToyMlrOFyxGpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNToyNToyNVrOF61n7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc3NzYzNg==", "bodyText": "I went to the website documentation about shunt compensators to better understand your changes, but it was not enough for me to understand... I guess you have edited that page of the website in a branch to update that doc for the next release: maybe we should discuss it.", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r388777636", "createdAt": "2020-03-06T08:49:22Z", "author": {"login": "agnesLeroy"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ShuntCompensatorModel.java", "diffHunk": "@@ -0,0 +1,30 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network;\n+\n+/**\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ */\n+public interface ShuntCompensatorModel {\n+\n+    /**\n+     * Get the maximum number of sections.\n+     */\n+    int getMaximumSectionCount();\n+\n+    /**\n+     * Get the susceptance in S of the section with a given section number if it exists.\n+     * Throw an exception if such a section does not exist.\n+     */\n+    double getB(int sectionNum);\n+\n+    /**\n+     * Get the conductance in S of the section with a given section number if it exists.\n+     * Throw an exception if such a section does not exist.\n+     */\n+    double getG(int sectionNum);\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44ec378cd400bfc7d53bb2b7e2a647b306dda722"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTY0NDQ3Ng==", "bodyText": "I am keeping your comment for now since I have not yet submitted a documentation PR as the APIs are still in construction. I will get back to you after the APIs are fixed.", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r389644476", "createdAt": "2020-03-09T13:01:04Z", "author": {"login": "miovd"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ShuntCompensatorModel.java", "diffHunk": "@@ -0,0 +1,30 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network;\n+\n+/**\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ */\n+public interface ShuntCompensatorModel {\n+\n+    /**\n+     * Get the maximum number of sections.\n+     */\n+    int getMaximumSectionCount();\n+\n+    /**\n+     * Get the susceptance in S of the section with a given section number if it exists.\n+     * Throw an exception if such a section does not exist.\n+     */\n+    double getB(int sectionNum);\n+\n+    /**\n+     * Get the conductance in S of the section with a given section number if it exists.\n+     * Throw an exception if such a section does not exist.\n+     */\n+    double getG(int sectionNum);\n+}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc3NzYzNg=="}, "originalCommit": {"oid": "44ec378cd400bfc7d53bb2b7e2a647b306dda722"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIyNDc2OQ==", "bodyText": "I have created a PR for documentation (and assigned you as reviewer): powsybl/powsybl.github.io#125. Could you please take a look at it to see if it is clearer now?", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r397224769", "createdAt": "2020-03-24T15:05:30Z", "author": {"login": "miovd"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ShuntCompensatorModel.java", "diffHunk": "@@ -0,0 +1,30 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network;\n+\n+/**\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ */\n+public interface ShuntCompensatorModel {\n+\n+    /**\n+     * Get the maximum number of sections.\n+     */\n+    int getMaximumSectionCount();\n+\n+    /**\n+     * Get the susceptance in S of the section with a given section number if it exists.\n+     * Throw an exception if such a section does not exist.\n+     */\n+    double getB(int sectionNum);\n+\n+    /**\n+     * Get the conductance in S of the section with a given section number if it exists.\n+     * Throw an exception if such a section does not exist.\n+     */\n+    double getG(int sectionNum);\n+}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc3NzYzNg=="}, "originalCommit": {"oid": "44ec378cd400bfc7d53bb2b7e2a647b306dda722"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI0MDMwMA==", "bodyText": "@MioRtia I just approved that PR, it looks much clearer to me with your changes.", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r397240300", "createdAt": "2020-03-24T15:25:25Z", "author": {"login": "agnesLeroy"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ShuntCompensatorModel.java", "diffHunk": "@@ -0,0 +1,30 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network;\n+\n+/**\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ */\n+public interface ShuntCompensatorModel {\n+\n+    /**\n+     * Get the maximum number of sections.\n+     */\n+    int getMaximumSectionCount();\n+\n+    /**\n+     * Get the susceptance in S of the section with a given section number if it exists.\n+     * Throw an exception if such a section does not exist.\n+     */\n+    double getB(int sectionNum);\n+\n+    /**\n+     * Get the conductance in S of the section with a given section number if it exists.\n+     * Throw an exception if such a section does not exist.\n+     */\n+    double getG(int sectionNum);\n+}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc3NzYzNg=="}, "originalCommit": {"oid": "44ec378cd400bfc7d53bb2b7e2a647b306dda722"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwODgxMzg3OnYy", "diffSide": "RIGHT", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ShuntCompensatorNonLinearModel.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwOTowMDowMVrOFyxZKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwOTowMDowMVrOFyxZKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc4MjM3Nw==", "bodyText": "We could imagine having only this model and using it to create either linear or non-linear shunts, or am I wrong?", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r388782377", "createdAt": "2020-03-06T09:00:01Z", "author": {"login": "agnesLeroy"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ShuntCompensatorNonLinearModel.java", "diffHunk": "@@ -0,0 +1,63 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network;\n+\n+import java.util.Map;\n+import java.util.Optional;\n+\n+/**\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ */\n+public interface ShuntCompensatorNonLinearModel extends ShuntCompensatorModel {\n+\n+    interface Section {\n+\n+        /**\n+         * Get the susceptance in S of the section.\n+         */\n+        double getB();\n+\n+        /**\n+         * Get the conductance in S of the section.\n+         */\n+        double getG();\n+    }\n+\n+    /**\n+     * Get the maximum susceptance for a section in S.\n+     */\n+    double getMaximumB();\n+\n+    /**\n+     * Get the maximum conductance for a section in S.\n+     */\n+    double getMaximumG();\n+\n+    /**\n+     * Get an optional of the section associated with a given section number if it exists.\n+     * If such a section does not exist, return an empty optional.\n+     *\n+     */\n+    Optional<Section> getSection(int sectionNum);\n+\n+    /**\n+     * Get all the sections associated with their section number.\n+     */\n+    Map<Integer, Section> getSections();\n+\n+    /**\n+     * For a given section number, add a section with a given susceptance and conductance in S to the model.\n+     * If a section already exists for this section number, respectively replace its susceptance and conductance with the given susceptance and conductance.\n+     */\n+    ShuntCompensatorNonLinearModel addOrReplaceSection(int sectionNum, double b, double g);\n+\n+    /**\n+     * Remove the section associated with a given section number if it exists <b>and</b> the current section count is different of the given section number.\n+     * Else, throw an exception.\n+     */\n+    ShuntCompensatorNonLinearModel removeSection(int sectionNum);\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44ec378cd400bfc7d53bb2b7e2a647b306dda722"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwOTAwMzQ0OnYy", "diffSide": "RIGHT", "path": "ampl-converter/src/main/java/com/powsybl/ampl/converter/AmplNetworkWriter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwOTo1OToyN1rOFyzMRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxMTozOToyN1rOFzjuvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgxMTg0Nw==", "bodyText": "Should the getMaximumSectionCount be on the Shunt API instead of the Model API? Is it specific to a model?", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r388811847", "createdAt": "2020-03-06T09:59:27Z", "author": {"login": "mathbagu"}, "path": "ampl-converter/src/main/java/com/powsybl/ampl/converter/AmplNetworkWriter.java", "diffHunk": "@@ -1336,11 +1340,11 @@ private void writeShunts(AmplExportContext context) throws IOException {\n                 double vb = t.getVoltageLevel().getNominalV();\n                 double zb = vb * vb / AmplConstants.SB;\n                 double b1 = 0;\n-                double b2 = sc.getbPerSection() * sc.getMaximumSectionCount() * zb;\n+                double b2 = sc.getModel(ShuntCompensatorLinearModel.class).getbPerSection() * sc.getModel().getMaximumSectionCount() * zb;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44ec378cd400bfc7d53bb2b7e2a647b306dda722"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYwNzEwMQ==", "bodyText": "Indeed, I will put in on the Shunt API.", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r389607101", "createdAt": "2020-03-09T11:39:27Z", "author": {"login": "miovd"}, "path": "ampl-converter/src/main/java/com/powsybl/ampl/converter/AmplNetworkWriter.java", "diffHunk": "@@ -1336,11 +1340,11 @@ private void writeShunts(AmplExportContext context) throws IOException {\n                 double vb = t.getVoltageLevel().getNominalV();\n                 double zb = vb * vb / AmplConstants.SB;\n                 double b1 = 0;\n-                double b2 = sc.getbPerSection() * sc.getMaximumSectionCount() * zb;\n+                double b2 = sc.getModel(ShuntCompensatorLinearModel.class).getbPerSection() * sc.getModel().getMaximumSectionCount() * zb;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgxMTg0Nw=="}, "originalCommit": {"oid": "44ec378cd400bfc7d53bb2b7e2a647b306dda722"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwOTAwOTAxOnYy", "diffSide": "RIGHT", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ShuntCompensator.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMDowMToxM1rOFyzPuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNTo0OToyM1rOF1kZfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgxMjcyOA==", "bodyText": "Should you add a default behaviour? Or do we decide that the API breaks", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r388812728", "createdAt": "2020-03-06T10:01:13Z", "author": {"login": "mathbagu"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ShuntCompensator.java", "diffHunk": "@@ -53,35 +40,32 @@\n     ShuntCompensator setCurrentSectionCount(int currentSectionCount);\n \n     /**\n-     * Get the susceptance per section in S.\n+     * Get the susceptance for the current section count.\n+     * <p>\n+     * Depends on the working variant.\n+     * @see VariantManager\n      */\n-    double getbPerSection();\n+    double getCurrentB();\n \n     /**\n-     * Set the susceptance per section in S.\n-     *\n-     * @param bPerSection the susceptance per section\n-     * @return the shunt compensator to chain method calls.\n+     * Get the conductance for the current section count.\n+     * <p>\n+     * Depends on the working variant.\n+     * @see VariantManager\n      */\n-    ShuntCompensator setbPerSection(double bPerSection);\n+    double getCurrentG();\n \n     /**\n-     * Get the susceptance for the maximum section count.\n-     *\n-     * @deprecated Use {@link #getbPerSection()} * {@link #getMaximumSectionCount()} instead.\n+     * Get the model type of the shunt compensator (linear or non-linear)\n      */\n-    @Deprecated\n-    default double getMaximumB() {\n-        return getbPerSection() * getMaximumSectionCount();\n-    }\n+    ShuntCompensatorModelType getModelType();\n \n     /**\n-     * Get the susceptance for the current section counts.\n-     * <p>\n-     * Depends on the working variant.\n-     * @see VariantManager\n+     * Get the shunt model.\n      */\n-    double getCurrentB();\n+    ShuntCompensatorModel getModel();\n+\n+    <M extends ShuntCompensatorModel> M getModel(Class<M> modelType);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44ec378cd400bfc7d53bb2b7e2a647b306dda722"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgzMDQzMA==", "bodyText": "For me, it would be clearer to break the API because I think keeping a mix between the old and new APIs would lead to more errors.", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r388830430", "createdAt": "2020-03-06T10:37:20Z", "author": {"login": "miovd"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ShuntCompensator.java", "diffHunk": "@@ -53,35 +40,32 @@\n     ShuntCompensator setCurrentSectionCount(int currentSectionCount);\n \n     /**\n-     * Get the susceptance per section in S.\n+     * Get the susceptance for the current section count.\n+     * <p>\n+     * Depends on the working variant.\n+     * @see VariantManager\n      */\n-    double getbPerSection();\n+    double getCurrentB();\n \n     /**\n-     * Set the susceptance per section in S.\n-     *\n-     * @param bPerSection the susceptance per section\n-     * @return the shunt compensator to chain method calls.\n+     * Get the conductance for the current section count.\n+     * <p>\n+     * Depends on the working variant.\n+     * @see VariantManager\n      */\n-    ShuntCompensator setbPerSection(double bPerSection);\n+    double getCurrentG();\n \n     /**\n-     * Get the susceptance for the maximum section count.\n-     *\n-     * @deprecated Use {@link #getbPerSection()} * {@link #getMaximumSectionCount()} instead.\n+     * Get the model type of the shunt compensator (linear or non-linear)\n      */\n-    @Deprecated\n-    default double getMaximumB() {\n-        return getbPerSection() * getMaximumSectionCount();\n-    }\n+    ShuntCompensatorModelType getModelType();\n \n     /**\n-     * Get the susceptance for the current section counts.\n-     * <p>\n-     * Depends on the working variant.\n-     * @see VariantManager\n+     * Get the shunt model.\n      */\n-    double getCurrentB();\n+    ShuntCompensatorModel getModel();\n+\n+    <M extends ShuntCompensatorModel> M getModel(Class<M> modelType);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgxMjcyOA=="}, "originalCommit": {"oid": "44ec378cd400bfc7d53bb2b7e2a647b306dda722"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODkyNzY5OA==", "bodyText": "Why do you create getModel() and getModelType? Couldn't the model be able to inform about its type?", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r388927698", "createdAt": "2020-03-06T14:19:22Z", "author": {"login": "agnesLeroy"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ShuntCompensator.java", "diffHunk": "@@ -53,35 +40,32 @@\n     ShuntCompensator setCurrentSectionCount(int currentSectionCount);\n \n     /**\n-     * Get the susceptance per section in S.\n+     * Get the susceptance for the current section count.\n+     * <p>\n+     * Depends on the working variant.\n+     * @see VariantManager\n      */\n-    double getbPerSection();\n+    double getCurrentB();\n \n     /**\n-     * Set the susceptance per section in S.\n-     *\n-     * @param bPerSection the susceptance per section\n-     * @return the shunt compensator to chain method calls.\n+     * Get the conductance for the current section count.\n+     * <p>\n+     * Depends on the working variant.\n+     * @see VariantManager\n      */\n-    ShuntCompensator setbPerSection(double bPerSection);\n+    double getCurrentG();\n \n     /**\n-     * Get the susceptance for the maximum section count.\n-     *\n-     * @deprecated Use {@link #getbPerSection()} * {@link #getMaximumSectionCount()} instead.\n+     * Get the model type of the shunt compensator (linear or non-linear)\n      */\n-    @Deprecated\n-    default double getMaximumB() {\n-        return getbPerSection() * getMaximumSectionCount();\n-    }\n+    ShuntCompensatorModelType getModelType();\n \n     /**\n-     * Get the susceptance for the current section counts.\n-     * <p>\n-     * Depends on the working variant.\n-     * @see VariantManager\n+     * Get the shunt model.\n      */\n-    double getCurrentB();\n+    ShuntCompensatorModel getModel();\n+\n+    <M extends ShuntCompensatorModel> M getModel(Class<M> modelType);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgxMjcyOA=="}, "originalCommit": {"oid": "44ec378cd400bfc7d53bb2b7e2a647b306dda722"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTY0NTQzNA==", "bodyText": "Yes but when calling it (from ShuntCompensator), we do not have this information, hence these two methods to retrieve it.", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r389645434", "createdAt": "2020-03-09T13:03:08Z", "author": {"login": "miovd"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ShuntCompensator.java", "diffHunk": "@@ -53,35 +40,32 @@\n     ShuntCompensator setCurrentSectionCount(int currentSectionCount);\n \n     /**\n-     * Get the susceptance per section in S.\n+     * Get the susceptance for the current section count.\n+     * <p>\n+     * Depends on the working variant.\n+     * @see VariantManager\n      */\n-    double getbPerSection();\n+    double getCurrentB();\n \n     /**\n-     * Set the susceptance per section in S.\n-     *\n-     * @param bPerSection the susceptance per section\n-     * @return the shunt compensator to chain method calls.\n+     * Get the conductance for the current section count.\n+     * <p>\n+     * Depends on the working variant.\n+     * @see VariantManager\n      */\n-    ShuntCompensator setbPerSection(double bPerSection);\n+    double getCurrentG();\n \n     /**\n-     * Get the susceptance for the maximum section count.\n-     *\n-     * @deprecated Use {@link #getbPerSection()} * {@link #getMaximumSectionCount()} instead.\n+     * Get the model type of the shunt compensator (linear or non-linear)\n      */\n-    @Deprecated\n-    default double getMaximumB() {\n-        return getbPerSection() * getMaximumSectionCount();\n-    }\n+    ShuntCompensatorModelType getModelType();\n \n     /**\n-     * Get the susceptance for the current section counts.\n-     * <p>\n-     * Depends on the working variant.\n-     * @see VariantManager\n+     * Get the shunt model.\n      */\n-    double getCurrentB();\n+    ShuntCompensatorModel getModel();\n+\n+    <M extends ShuntCompensatorModel> M getModel(Class<M> modelType);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgxMjcyOA=="}, "originalCommit": {"oid": "44ec378cd400bfc7d53bb2b7e2a647b306dda722"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTczNjQ2OA==", "bodyText": "Maybe  getModelType should be renamed getShuntType then?", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r389736468", "createdAt": "2020-03-09T14:44:58Z", "author": {"login": "agnesLeroy"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ShuntCompensator.java", "diffHunk": "@@ -53,35 +40,32 @@\n     ShuntCompensator setCurrentSectionCount(int currentSectionCount);\n \n     /**\n-     * Get the susceptance per section in S.\n+     * Get the susceptance for the current section count.\n+     * <p>\n+     * Depends on the working variant.\n+     * @see VariantManager\n      */\n-    double getbPerSection();\n+    double getCurrentB();\n \n     /**\n-     * Set the susceptance per section in S.\n-     *\n-     * @param bPerSection the susceptance per section\n-     * @return the shunt compensator to chain method calls.\n+     * Get the conductance for the current section count.\n+     * <p>\n+     * Depends on the working variant.\n+     * @see VariantManager\n      */\n-    ShuntCompensator setbPerSection(double bPerSection);\n+    double getCurrentG();\n \n     /**\n-     * Get the susceptance for the maximum section count.\n-     *\n-     * @deprecated Use {@link #getbPerSection()} * {@link #getMaximumSectionCount()} instead.\n+     * Get the model type of the shunt compensator (linear or non-linear)\n      */\n-    @Deprecated\n-    default double getMaximumB() {\n-        return getbPerSection() * getMaximumSectionCount();\n-    }\n+    ShuntCompensatorModelType getModelType();\n \n     /**\n-     * Get the susceptance for the current section counts.\n-     * <p>\n-     * Depends on the working variant.\n-     * @see VariantManager\n+     * Get the shunt model.\n      */\n-    double getCurrentB();\n+    ShuntCompensatorModel getModel();\n+\n+    <M extends ShuntCompensatorModel> M getModel(Class<M> modelType);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgxMjcyOA=="}, "originalCommit": {"oid": "44ec378cd400bfc7d53bb2b7e2a647b306dda722"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTcxNTE5OA==", "bodyText": "Isn't it a bit redundant to put \"shuntType\" in a method that only exists for shunts? (I put getModelType() because getType() already exists and returns which kind of connectable it is).", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r391715198", "createdAt": "2020-03-12T15:49:23Z", "author": {"login": "miovd"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ShuntCompensator.java", "diffHunk": "@@ -53,35 +40,32 @@\n     ShuntCompensator setCurrentSectionCount(int currentSectionCount);\n \n     /**\n-     * Get the susceptance per section in S.\n+     * Get the susceptance for the current section count.\n+     * <p>\n+     * Depends on the working variant.\n+     * @see VariantManager\n      */\n-    double getbPerSection();\n+    double getCurrentB();\n \n     /**\n-     * Set the susceptance per section in S.\n-     *\n-     * @param bPerSection the susceptance per section\n-     * @return the shunt compensator to chain method calls.\n+     * Get the conductance for the current section count.\n+     * <p>\n+     * Depends on the working variant.\n+     * @see VariantManager\n      */\n-    ShuntCompensator setbPerSection(double bPerSection);\n+    double getCurrentG();\n \n     /**\n-     * Get the susceptance for the maximum section count.\n-     *\n-     * @deprecated Use {@link #getbPerSection()} * {@link #getMaximumSectionCount()} instead.\n+     * Get the model type of the shunt compensator (linear or non-linear)\n      */\n-    @Deprecated\n-    default double getMaximumB() {\n-        return getbPerSection() * getMaximumSectionCount();\n-    }\n+    ShuntCompensatorModelType getModelType();\n \n     /**\n-     * Get the susceptance for the current section counts.\n-     * <p>\n-     * Depends on the working variant.\n-     * @see VariantManager\n+     * Get the shunt model.\n      */\n-    double getCurrentB();\n+    ShuntCompensatorModel getModel();\n+\n+    <M extends ShuntCompensatorModel> M getModel(Class<M> modelType);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgxMjcyOA=="}, "originalCommit": {"oid": "44ec378cd400bfc7d53bb2b7e2a647b306dda722"}, "originalPosition": 68}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwOTAxMjkzOnYy", "diffSide": "RIGHT", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ShuntCompensatorAdder.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMDowMjoyOFrOFyzSDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxMzozNTo0MFrOFznqhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgxMzMyNw==", "bodyText": "To be discussed: should we design the API like we did for the extension:\nnewModel(ShuntCompensatorLinearModelAdder.class);", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r388813327", "createdAt": "2020-03-06T10:02:28Z", "author": {"login": "mathbagu"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ShuntCompensatorAdder.java", "diffHunk": "@@ -26,9 +26,9 @@\n  */\n public interface ShuntCompensatorAdder extends InjectionAdder<ShuntCompensatorAdder> {\n \n-    ShuntCompensatorAdder setbPerSection(double bPerSection);\n+    ShuntCompensatorLinearModelAdder newLinearModel();\n \n-    ShuntCompensatorAdder setMaximumSectionCount(int maximumSectionCount);\n+    ShuntCompensatorNonLinearModelAdder newNonLinearModel();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44ec378cd400bfc7d53bb2b7e2a647b306dda722"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODkzMDE5MA==", "bodyText": "Do you think that choosing the same design here could improve the user experience?", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r388930190", "createdAt": "2020-03-06T14:23:49Z", "author": {"login": "agnesLeroy"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ShuntCompensatorAdder.java", "diffHunk": "@@ -26,9 +26,9 @@\n  */\n public interface ShuntCompensatorAdder extends InjectionAdder<ShuntCompensatorAdder> {\n \n-    ShuntCompensatorAdder setbPerSection(double bPerSection);\n+    ShuntCompensatorLinearModelAdder newLinearModel();\n \n-    ShuntCompensatorAdder setMaximumSectionCount(int maximumSectionCount);\n+    ShuntCompensatorNonLinearModelAdder newNonLinearModel();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgxMzMyNw=="}, "originalCommit": {"oid": "44ec378cd400bfc7d53bb2b7e2a647b306dda722"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU0MjUxOQ==", "bodyText": "It is mostly to keep an easy way to add a custom model... but doesn't it make the API more complex? (as in, it may make it more difficult to understand what \"model\" refers to)? Maybe we should keep newLinearModel, newNonLinearModel and add newModel(...)?\nEDIT I am not sure that the denomination \"shunt model\" is standard. In CGMES for example, \"shunt models\" are not mentioned, the concepts are directly \"non linear shunt\" and \"linear shunt\".", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r389542519", "createdAt": "2020-03-09T09:26:16Z", "author": {"login": "miovd"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ShuntCompensatorAdder.java", "diffHunk": "@@ -26,9 +26,9 @@\n  */\n public interface ShuntCompensatorAdder extends InjectionAdder<ShuntCompensatorAdder> {\n \n-    ShuntCompensatorAdder setbPerSection(double bPerSection);\n+    ShuntCompensatorLinearModelAdder newLinearModel();\n \n-    ShuntCompensatorAdder setMaximumSectionCount(int maximumSectionCount);\n+    ShuntCompensatorNonLinearModelAdder newNonLinearModel();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgxMzMyNw=="}, "originalCommit": {"oid": "44ec378cd400bfc7d53bb2b7e2a647b306dda722"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTY3MTU1Nw==", "bodyText": "After some thinking, I do not think it is a good idea to implement a newModel(...) method, I am not sure we want to extend the possibilities of shunt models. It is different from extensions where this is the purpose of the API.", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r389671557", "createdAt": "2020-03-09T13:35:40Z", "author": {"login": "miovd"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ShuntCompensatorAdder.java", "diffHunk": "@@ -26,9 +26,9 @@\n  */\n public interface ShuntCompensatorAdder extends InjectionAdder<ShuntCompensatorAdder> {\n \n-    ShuntCompensatorAdder setbPerSection(double bPerSection);\n+    ShuntCompensatorLinearModelAdder newLinearModel();\n \n-    ShuntCompensatorAdder setMaximumSectionCount(int maximumSectionCount);\n+    ShuntCompensatorNonLinearModelAdder newNonLinearModel();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgxMzMyNw=="}, "originalCommit": {"oid": "44ec378cd400bfc7d53bb2b7e2a647b306dda722"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwOTAyNDA0OnYy", "diffSide": "RIGHT", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/AbstractShuntCompensatorModel.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMDowNTozOFrOFyzYdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxMTozNjozN1rOFzjqCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgxNDk2NQ==", "bodyText": "I'm not sure about this: the model should be attached to the ShuntCompensator in the constructor, like it's done for tap changer", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r388814965", "createdAt": "2020-03-06T10:05:38Z", "author": {"login": "mathbagu"}, "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/AbstractShuntCompensatorModel.java", "diffHunk": "@@ -0,0 +1,49 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.impl;\n+\n+import com.powsybl.iidm.network.ShuntCompensatorModel;\n+import com.powsybl.iidm.network.Validable;\n+import com.powsybl.iidm.network.ValidationException;\n+\n+import java.util.Objects;\n+\n+/**\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ */\n+abstract class AbstractShuntCompensatorModel implements ShuntCompensatorModelHolder {\n+\n+    protected ShuntCompensatorImpl shuntCompensator;\n+\n+    @Override\n+    public void setShuntCompensator(ShuntCompensatorImpl shuntCompensator) {\n+        this.shuntCompensator = Objects.requireNonNull(shuntCompensator);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44ec378cd400bfc7d53bb2b7e2a647b306dda722"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU3MjE3NA==", "bodyText": "It doesn't work as tapchangers are created when the transformer is already built, which is not the case for models (they are created at the same time since it does not make sense to create a shunt without model).", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r389572174", "createdAt": "2020-03-09T10:23:37Z", "author": {"login": "miovd"}, "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/AbstractShuntCompensatorModel.java", "diffHunk": "@@ -0,0 +1,49 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.impl;\n+\n+import com.powsybl.iidm.network.ShuntCompensatorModel;\n+import com.powsybl.iidm.network.Validable;\n+import com.powsybl.iidm.network.ValidationException;\n+\n+import java.util.Objects;\n+\n+/**\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ */\n+abstract class AbstractShuntCompensatorModel implements ShuntCompensatorModelHolder {\n+\n+    protected ShuntCompensatorImpl shuntCompensator;\n+\n+    @Override\n+    public void setShuntCompensator(ShuntCompensatorImpl shuntCompensator) {\n+        this.shuntCompensator = Objects.requireNonNull(shuntCompensator);\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgxNDk2NQ=="}, "originalCommit": {"oid": "44ec378cd400bfc7d53bb2b7e2a647b306dda722"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYwNTg5Ng==", "bodyText": "I can check however that the shunt is only defined once. Is it enough for you?", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r389605896", "createdAt": "2020-03-09T11:36:37Z", "author": {"login": "miovd"}, "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/AbstractShuntCompensatorModel.java", "diffHunk": "@@ -0,0 +1,49 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.impl;\n+\n+import com.powsybl.iidm.network.ShuntCompensatorModel;\n+import com.powsybl.iidm.network.Validable;\n+import com.powsybl.iidm.network.ValidationException;\n+\n+import java.util.Objects;\n+\n+/**\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ */\n+abstract class AbstractShuntCompensatorModel implements ShuntCompensatorModelHolder {\n+\n+    protected ShuntCompensatorImpl shuntCompensator;\n+\n+    @Override\n+    public void setShuntCompensator(ShuntCompensatorImpl shuntCompensator) {\n+        this.shuntCompensator = Objects.requireNonNull(shuntCompensator);\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgxNDk2NQ=="}, "originalCommit": {"oid": "44ec378cd400bfc7d53bb2b7e2a647b306dda722"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwOTAyNjk0OnYy", "diffSide": "RIGHT", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/AbstractShuntCompensatorModel.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMDowNjoyM1rOFyzaCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxMTo0MDozNFrOFzjwow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgxNTM3MA==", "bodyText": "Not private-package, but protected instead?", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r388815370", "createdAt": "2020-03-06T10:06:23Z", "author": {"login": "mathbagu"}, "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/AbstractShuntCompensatorModel.java", "diffHunk": "@@ -0,0 +1,49 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.impl;\n+\n+import com.powsybl.iidm.network.ShuntCompensatorModel;\n+import com.powsybl.iidm.network.Validable;\n+import com.powsybl.iidm.network.ValidationException;\n+\n+import java.util.Objects;\n+\n+/**\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ */\n+abstract class AbstractShuntCompensatorModel implements ShuntCompensatorModelHolder {\n+\n+    protected ShuntCompensatorImpl shuntCompensator;\n+\n+    @Override\n+    public void setShuntCompensator(ShuntCompensatorImpl shuntCompensator) {\n+        this.shuntCompensator = Objects.requireNonNull(shuntCompensator);\n+    }\n+\n+    @Override\n+    public ShuntCompensatorModel getModel() {\n+        return this;\n+    }\n+\n+    @Override\n+    public <M extends ShuntCompensatorModel> M getModel(Class<M> modelType) {\n+        if (modelType == null) {\n+            throw new IllegalArgumentException(\"shunt compensator model type is null\");\n+        }\n+        if (modelType.isInstance(this)) {\n+            return modelType.cast(this);\n+        }\n+        throw new ValidationException(shuntCompensator, \"incorrect shunt compensator model type \" +\n+                modelType.getName() + \", expected \" + getClass());\n+    }\n+\n+    void checkCurrentSection(int currentSectionCount) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44ec378cd400bfc7d53bb2b7e2a647b306dda722"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYwNzU4Nw==", "bodyText": "After changing a bit the implementation, I deleted this method.", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r389607587", "createdAt": "2020-03-09T11:40:34Z", "author": {"login": "miovd"}, "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/AbstractShuntCompensatorModel.java", "diffHunk": "@@ -0,0 +1,49 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.impl;\n+\n+import com.powsybl.iidm.network.ShuntCompensatorModel;\n+import com.powsybl.iidm.network.Validable;\n+import com.powsybl.iidm.network.ValidationException;\n+\n+import java.util.Objects;\n+\n+/**\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ */\n+abstract class AbstractShuntCompensatorModel implements ShuntCompensatorModelHolder {\n+\n+    protected ShuntCompensatorImpl shuntCompensator;\n+\n+    @Override\n+    public void setShuntCompensator(ShuntCompensatorImpl shuntCompensator) {\n+        this.shuntCompensator = Objects.requireNonNull(shuntCompensator);\n+    }\n+\n+    @Override\n+    public ShuntCompensatorModel getModel() {\n+        return this;\n+    }\n+\n+    @Override\n+    public <M extends ShuntCompensatorModel> M getModel(Class<M> modelType) {\n+        if (modelType == null) {\n+            throw new IllegalArgumentException(\"shunt compensator model type is null\");\n+        }\n+        if (modelType.isInstance(this)) {\n+            return modelType.cast(this);\n+        }\n+        throw new ValidationException(shuntCompensator, \"incorrect shunt compensator model type \" +\n+                modelType.getName() + \", expected \" + getClass());\n+    }\n+\n+    void checkCurrentSection(int currentSectionCount) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgxNTM3MA=="}, "originalCommit": {"oid": "44ec378cd400bfc7d53bb2b7e2a647b306dda722"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwOTAyNzQ4OnYy", "diffSide": "RIGHT", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/AbstractShuntCompensatorModel.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMDowNjozNVrOFyzaZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMDowNjozNVrOFyzaZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgxNTQ2Mg==", "bodyText": "Same question there", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r388815462", "createdAt": "2020-03-06T10:06:35Z", "author": {"login": "mathbagu"}, "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/AbstractShuntCompensatorModel.java", "diffHunk": "@@ -0,0 +1,49 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.impl;\n+\n+import com.powsybl.iidm.network.ShuntCompensatorModel;\n+import com.powsybl.iidm.network.Validable;\n+import com.powsybl.iidm.network.ValidationException;\n+\n+import java.util.Objects;\n+\n+/**\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ */\n+abstract class AbstractShuntCompensatorModel implements ShuntCompensatorModelHolder {\n+\n+    protected ShuntCompensatorImpl shuntCompensator;\n+\n+    @Override\n+    public void setShuntCompensator(ShuntCompensatorImpl shuntCompensator) {\n+        this.shuntCompensator = Objects.requireNonNull(shuntCompensator);\n+    }\n+\n+    @Override\n+    public ShuntCompensatorModel getModel() {\n+        return this;\n+    }\n+\n+    @Override\n+    public <M extends ShuntCompensatorModel> M getModel(Class<M> modelType) {\n+        if (modelType == null) {\n+            throw new IllegalArgumentException(\"shunt compensator model type is null\");\n+        }\n+        if (modelType.isInstance(this)) {\n+            return modelType.cast(this);\n+        }\n+        throw new ValidationException(shuntCompensator, \"incorrect shunt compensator model type \" +\n+                modelType.getName() + \", expected \" + getClass());\n+    }\n+\n+    void checkCurrentSection(int currentSectionCount) {\n+        checkCurrentSection(shuntCompensator, currentSectionCount);\n+    }\n+\n+    abstract void checkCurrentSection(Validable validable, int currentSectionCount);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44ec378cd400bfc7d53bb2b7e2a647b306dda722"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwOTAzMzc0OnYy", "diffSide": "RIGHT", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ShuntCompensatorAdderImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMDowODozMlrOFyzeUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQwOTo1MjoxNVrOFzgnIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgxNjQ2NQ==", "bodyText": "It's strange to not replace the section whereas it's totally allowed later? It's not really important but it's questioning me", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r388816465", "createdAt": "2020-03-06T10:08:32Z", "author": {"login": "mathbagu"}, "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ShuntCompensatorAdderImpl.java", "diffHunk": "@@ -46,16 +43,106 @@ protected String getTypeDescription() {\n         return \"Shunt compensator\";\n     }\n \n+    class ShuntCompensatorLinearModelAdderImpl implements ShuntCompensatorLinearModelAdder {\n+\n+        private double bPerSection = Double.NaN;\n+\n+        private double gPerSection = Double.NaN;\n+\n+        private int maximumSectionCount = -1;\n+\n+        @Override\n+        public ShuntCompensatorLinearModelAdder setbPerSection(double bPerSection) {\n+            this.bPerSection = bPerSection;\n+            return this;\n+        }\n+\n+        @Override\n+        public ShuntCompensatorLinearModelAdder setgPerSection(double gPerSection) {\n+            this.gPerSection = gPerSection;\n+            return this;\n+        }\n+\n+        @Override\n+        public ShuntCompensatorLinearModelAdder setMaximumSectionCount(int maximumSectionCount) {\n+            this.maximumSectionCount = maximumSectionCount;\n+            return this;\n+        }\n+\n+        @Override\n+        public ShuntCompensatorAdder add() {\n+            ValidationUtil.checkbPerSection(ShuntCompensatorAdderImpl.this, bPerSection);\n+            ValidationUtil.checkMaximumSectionCount(ShuntCompensatorAdderImpl.this, maximumSectionCount);\n+            model = new ShuntCompensatorLinearModelImpl(bPerSection, gPerSection, maximumSectionCount);\n+            return ShuntCompensatorAdderImpl.this;\n+        }\n+    }\n+\n+    class ShuntCompensatorNonLinearModelAdderImpl implements ShuntCompensatorNonLinearModelAdder {\n+\n+        private final TreeMap<Integer, ShuntCompensatorNonLinearModelImpl.SectionImpl> sections = new TreeMap<>();\n+\n+        class SectionAdderImpl implements SectionAdder {\n+\n+            private int sectionNum = -1;\n+\n+            private double b = Double.NaN;\n+\n+            private double g = Double.NaN;\n+\n+            @Override\n+            public SectionAdder setSectionNum(int sectionNum) {\n+                this.sectionNum = sectionNum;\n+                return this;\n+            }\n+\n+            @Override\n+            public SectionAdder setB(double b) {\n+                this.b = b;\n+                return this;\n+            }\n+\n+            @Override\n+            public SectionAdder setG(double g) {\n+                this.g = g;\n+                return this;\n+            }\n+\n+            @Override\n+            public ShuntCompensatorNonLinearModelAdder endSection() {\n+                ValidationUtil.checkSectionNumber(ShuntCompensatorAdderImpl.this, sectionNum);\n+                if (sections.containsKey(sectionNum)) {\n+                    throw new ValidationException(ShuntCompensatorAdderImpl.this, \"a section is already defined at this number\");\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44ec378cd400bfc7d53bb2b7e2a647b306dda722"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU1NjAwMA==", "bodyText": "Not sure if choosing to replace a section in a built model and creating the same section twice while building the whole model is the same thing? I think the second case is more probably an error but I may be mistaken. We can delete this validation condition and consider it is allowed to rewrite a section while building the model.", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r389556000", "createdAt": "2020-03-09T09:52:15Z", "author": {"login": "miovd"}, "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ShuntCompensatorAdderImpl.java", "diffHunk": "@@ -46,16 +43,106 @@ protected String getTypeDescription() {\n         return \"Shunt compensator\";\n     }\n \n+    class ShuntCompensatorLinearModelAdderImpl implements ShuntCompensatorLinearModelAdder {\n+\n+        private double bPerSection = Double.NaN;\n+\n+        private double gPerSection = Double.NaN;\n+\n+        private int maximumSectionCount = -1;\n+\n+        @Override\n+        public ShuntCompensatorLinearModelAdder setbPerSection(double bPerSection) {\n+            this.bPerSection = bPerSection;\n+            return this;\n+        }\n+\n+        @Override\n+        public ShuntCompensatorLinearModelAdder setgPerSection(double gPerSection) {\n+            this.gPerSection = gPerSection;\n+            return this;\n+        }\n+\n+        @Override\n+        public ShuntCompensatorLinearModelAdder setMaximumSectionCount(int maximumSectionCount) {\n+            this.maximumSectionCount = maximumSectionCount;\n+            return this;\n+        }\n+\n+        @Override\n+        public ShuntCompensatorAdder add() {\n+            ValidationUtil.checkbPerSection(ShuntCompensatorAdderImpl.this, bPerSection);\n+            ValidationUtil.checkMaximumSectionCount(ShuntCompensatorAdderImpl.this, maximumSectionCount);\n+            model = new ShuntCompensatorLinearModelImpl(bPerSection, gPerSection, maximumSectionCount);\n+            return ShuntCompensatorAdderImpl.this;\n+        }\n+    }\n+\n+    class ShuntCompensatorNonLinearModelAdderImpl implements ShuntCompensatorNonLinearModelAdder {\n+\n+        private final TreeMap<Integer, ShuntCompensatorNonLinearModelImpl.SectionImpl> sections = new TreeMap<>();\n+\n+        class SectionAdderImpl implements SectionAdder {\n+\n+            private int sectionNum = -1;\n+\n+            private double b = Double.NaN;\n+\n+            private double g = Double.NaN;\n+\n+            @Override\n+            public SectionAdder setSectionNum(int sectionNum) {\n+                this.sectionNum = sectionNum;\n+                return this;\n+            }\n+\n+            @Override\n+            public SectionAdder setB(double b) {\n+                this.b = b;\n+                return this;\n+            }\n+\n+            @Override\n+            public SectionAdder setG(double g) {\n+                this.g = g;\n+                return this;\n+            }\n+\n+            @Override\n+            public ShuntCompensatorNonLinearModelAdder endSection() {\n+                ValidationUtil.checkSectionNumber(ShuntCompensatorAdderImpl.this, sectionNum);\n+                if (sections.containsKey(sectionNum)) {\n+                    throw new ValidationException(ShuntCompensatorAdderImpl.this, \"a section is already defined at this number\");\n+                }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgxNjQ2NQ=="}, "originalCommit": {"oid": "44ec378cd400bfc7d53bb2b7e2a647b306dda722"}, "originalPosition": 103}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwOTA0MzM4OnYy", "diffSide": "RIGHT", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ShuntCompensatorAdderImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMDoxMTo0MFrOFyzkRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQwOTo1Mjo0M1rOFzgoEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgxNzk4OQ==", "bodyText": "model.getModel() is really stange design: is the variable name is the good one? The adder set this variable with a model implementation, so I don't understand why the model is able to return a model...\nI think you look to the ReactiveLimitsHolder? The design is a bit different because we instanciate ReactiveLimitsHolderImpl?", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r388817989", "createdAt": "2020-03-06T10:11:40Z", "author": {"login": "mathbagu"}, "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ShuntCompensatorAdderImpl.java", "diffHunk": "@@ -92,16 +179,19 @@ public ShuntCompensatorAdder setTargetDeadband(double targetDeadband) {\n     public ShuntCompensatorImpl add() {\n         String id = checkAndGetUniqueId();\n         TerminalExt terminal = checkAndGetTerminal();\n-        ValidationUtil.checkbPerSection(this, bPerSection);\n-        ValidationUtil.checkSections(this, currentSectionCount, maximumSectionCount);\n+        if (model == null) {\n+            throw new ValidationException(this, \"the shunt compensator model has not been defined\");\n+        }\n+        model.getModel(AbstractShuntCompensatorModel.class).checkCurrentSection(this, currentSectionCount);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44ec378cd400bfc7d53bb2b7e2a647b306dda722"}, "originalPosition": 151}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU1NjI0MQ==", "bodyText": "Yes, I may have not named the objects well, I will change a bit the design in my next commit", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r389556241", "createdAt": "2020-03-09T09:52:43Z", "author": {"login": "miovd"}, "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ShuntCompensatorAdderImpl.java", "diffHunk": "@@ -92,16 +179,19 @@ public ShuntCompensatorAdder setTargetDeadband(double targetDeadband) {\n     public ShuntCompensatorImpl add() {\n         String id = checkAndGetUniqueId();\n         TerminalExt terminal = checkAndGetTerminal();\n-        ValidationUtil.checkbPerSection(this, bPerSection);\n-        ValidationUtil.checkSections(this, currentSectionCount, maximumSectionCount);\n+        if (model == null) {\n+            throw new ValidationException(this, \"the shunt compensator model has not been defined\");\n+        }\n+        model.getModel(AbstractShuntCompensatorModel.class).checkCurrentSection(this, currentSectionCount);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgxNzk4OQ=="}, "originalCommit": {"oid": "44ec378cd400bfc7d53bb2b7e2a647b306dda722"}, "originalPosition": 151}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwOTA2NzQwOnYy", "diffSide": "RIGHT", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ShuntCompensatorModelHolder.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMDoxOToxN1rOFyzzIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxMTo0MDo1NVrOFzjxPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgyMTc5NA==", "bodyText": "Not sure this method should be available", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r388821794", "createdAt": "2020-03-06T10:19:17Z", "author": {"login": "mathbagu"}, "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ShuntCompensatorModelHolder.java", "diffHunk": "@@ -0,0 +1,24 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.impl;\n+\n+import com.powsybl.iidm.network.ShuntCompensatorModel;\n+import com.powsybl.iidm.network.ShuntCompensatorModelType;\n+\n+/**\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ */\n+interface ShuntCompensatorModelHolder extends ShuntCompensatorModel {\n+\n+    ShuntCompensatorModelType getType();\n+\n+    ShuntCompensatorModel getModel();\n+\n+    <M extends ShuntCompensatorModel> M getModel(Class<M> modelType);\n+\n+    void setShuntCompensator(ShuntCompensatorImpl shuntCompensator);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44ec378cd400bfc7d53bb2b7e2a647b306dda722"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYwNzc0MQ==", "bodyText": "See comment above", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r389607741", "createdAt": "2020-03-09T11:40:55Z", "author": {"login": "miovd"}, "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ShuntCompensatorModelHolder.java", "diffHunk": "@@ -0,0 +1,24 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.impl;\n+\n+import com.powsybl.iidm.network.ShuntCompensatorModel;\n+import com.powsybl.iidm.network.ShuntCompensatorModelType;\n+\n+/**\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ */\n+interface ShuntCompensatorModelHolder extends ShuntCompensatorModel {\n+\n+    ShuntCompensatorModelType getType();\n+\n+    ShuntCompensatorModel getModel();\n+\n+    <M extends ShuntCompensatorModel> M getModel(Class<M> modelType);\n+\n+    void setShuntCompensator(ShuntCompensatorImpl shuntCompensator);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgyMTc5NA=="}, "originalCommit": {"oid": "44ec378cd400bfc7d53bb2b7e2a647b306dda722"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMTE2OTg0OnYy", "diffSide": "RIGHT", "path": "iidm/iidm-scripting/src/main/groovy/com/powsybl/iidm/network/scripting/ShuntCompensatorExtension.groovy", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNDozMjo0MVrOF2F7Sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxNDoyMjozNVrOF4HQJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjI2NDUyMw==", "bodyText": "Is it a bad idea to keep the getMaximumB in all shunt model and provide a convenient function?", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r392264523", "createdAt": "2020-03-13T14:32:41Z", "author": {"login": "mathbagu"}, "path": "iidm/iidm-scripting/src/main/groovy/com/powsybl/iidm/network/scripting/ShuntCompensatorExtension.groovy", "diffHunk": "@@ -0,0 +1,63 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+\n+package com.powsybl.iidm.network.scripting\n+\n+import com.powsybl.commons.PowsyblException\n+import com.powsybl.iidm.network.ShuntCompensator\n+import com.powsybl.iidm.network.ShuntCompensatorLinearModel\n+import com.powsybl.iidm.network.ShuntCompensatorModelType\n+import com.powsybl.iidm.network.ShuntCompensatorNonLinearModel\n+\n+/**\n+ *\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ */\n+class ShuntCompensatorExtension {\n+\n+    static double getMaximumB(ShuntCompensator self) {\n+        if (ShuntCompensatorModelType.LINEAR == self.getModelType()) {\n+            // forward bPerSection * maximumSectionCount for linear shunts\n+            return self.getModel(ShuntCompensatorLinearModel.class).getbPerSection() * self.getModel().getMaximumSectionCount()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "118e4c8ad20723fa6697076be505b33cbbd06ea7"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI2NTI5OA==", "bodyText": "The issue is that we used to have getMaximumB for linear shunts which returned the susceptance of the highest section (not the actual maximum susceptance) so if we put it in the shunt model, we would have several possibilities:\n\neither keep this behavior for linear shunt but for non linear shunt it returns the actual maximum susceptance\nor change the behavior and in any case, it returns the actual maximum susceptance\nor keep this behavior for linear shunt and for non linear shunt it returns the susceptance of the highest section too\n\nIn any case, I find it too confusing... What do you think?", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r394265298", "createdAt": "2020-03-18T11:04:45Z", "author": {"login": "miovd"}, "path": "iidm/iidm-scripting/src/main/groovy/com/powsybl/iidm/network/scripting/ShuntCompensatorExtension.groovy", "diffHunk": "@@ -0,0 +1,63 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+\n+package com.powsybl.iidm.network.scripting\n+\n+import com.powsybl.commons.PowsyblException\n+import com.powsybl.iidm.network.ShuntCompensator\n+import com.powsybl.iidm.network.ShuntCompensatorLinearModel\n+import com.powsybl.iidm.network.ShuntCompensatorModelType\n+import com.powsybl.iidm.network.ShuntCompensatorNonLinearModel\n+\n+/**\n+ *\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ */\n+class ShuntCompensatorExtension {\n+\n+    static double getMaximumB(ShuntCompensator self) {\n+        if (ShuntCompensatorModelType.LINEAR == self.getModelType()) {\n+            // forward bPerSection * maximumSectionCount for linear shunts\n+            return self.getModel(ShuntCompensatorLinearModel.class).getbPerSection() * self.getModel().getMaximumSectionCount()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjI2NDUyMw=="}, "originalCommit": {"oid": "118e4c8ad20723fa6697076be505b33cbbd06ea7"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDM3NjgwNA==", "bodyText": "My opinion would be that it should return the actual maximum susceptance regardless of the model, as indicated by its name. Maybe another function could return the susceptance of the highest section for linear shunts if needed.", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r394376804", "createdAt": "2020-03-18T14:13:48Z", "author": {"login": "agnesLeroy"}, "path": "iidm/iidm-scripting/src/main/groovy/com/powsybl/iidm/network/scripting/ShuntCompensatorExtension.groovy", "diffHunk": "@@ -0,0 +1,63 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+\n+package com.powsybl.iidm.network.scripting\n+\n+import com.powsybl.commons.PowsyblException\n+import com.powsybl.iidm.network.ShuntCompensator\n+import com.powsybl.iidm.network.ShuntCompensatorLinearModel\n+import com.powsybl.iidm.network.ShuntCompensatorModelType\n+import com.powsybl.iidm.network.ShuntCompensatorNonLinearModel\n+\n+/**\n+ *\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ */\n+class ShuntCompensatorExtension {\n+\n+    static double getMaximumB(ShuntCompensator self) {\n+        if (ShuntCompensatorModelType.LINEAR == self.getModelType()) {\n+            // forward bPerSection * maximumSectionCount for linear shunts\n+            return self.getModel(ShuntCompensatorLinearModel.class).getbPerSection() * self.getModel().getMaximumSectionCount()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjI2NDUyMw=="}, "originalCommit": {"oid": "118e4c8ad20723fa6697076be505b33cbbd06ea7"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDM4MzM5Ng==", "bodyText": "I agree with you, but isn't it deceitful to change the behavior of the method? Or I guess we could say that the previous one was buggy as when it was first implemented, it didn't take into account the case where the susceptance per section was negative...", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r394383396", "createdAt": "2020-03-18T14:22:35Z", "author": {"login": "miovd"}, "path": "iidm/iidm-scripting/src/main/groovy/com/powsybl/iidm/network/scripting/ShuntCompensatorExtension.groovy", "diffHunk": "@@ -0,0 +1,63 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+\n+package com.powsybl.iidm.network.scripting\n+\n+import com.powsybl.commons.PowsyblException\n+import com.powsybl.iidm.network.ShuntCompensator\n+import com.powsybl.iidm.network.ShuntCompensatorLinearModel\n+import com.powsybl.iidm.network.ShuntCompensatorModelType\n+import com.powsybl.iidm.network.ShuntCompensatorNonLinearModel\n+\n+/**\n+ *\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ */\n+class ShuntCompensatorExtension {\n+\n+    static double getMaximumB(ShuntCompensator self) {\n+        if (ShuntCompensatorModelType.LINEAR == self.getModelType()) {\n+            // forward bPerSection * maximumSectionCount for linear shunts\n+            return self.getModel(ShuntCompensatorLinearModel.class).getbPerSection() * self.getModel().getMaximumSectionCount()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjI2NDUyMw=="}, "originalCommit": {"oid": "118e4c8ad20723fa6697076be505b33cbbd06ea7"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MTcwNDkzOnYy", "diffSide": "RIGHT", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ShuntCompensatorAdderImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMjoyMDozMVrOF6tq4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMjoyMDozMVrOF6tq4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzEwOTk4NA==", "bodyText": "I think this should be done in the constructor, what do you think?", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r397109984", "createdAt": "2020-03-24T12:20:31Z", "author": {"login": "mathbagu"}, "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ShuntCompensatorAdderImpl.java", "diffHunk": "@@ -92,16 +179,22 @@ public ShuntCompensatorAdder setTargetDeadband(double targetDeadband) {\n     public ShuntCompensatorImpl add() {\n         String id = checkAndGetUniqueId();\n         TerminalExt terminal = checkAndGetTerminal();\n-        ValidationUtil.checkbPerSection(this, bPerSection);\n-        ValidationUtil.checkSections(this, currentSectionCount, maximumSectionCount);\n+        if (model == null) {\n+            throw new ValidationException(this, \"the shunt compensator model has not been defined\");\n+        }\n+        ValidationUtil.checkSections(this, currentSectionCount, model.getMaximumSectionCount());\n+        if (!model.containsSection(currentSectionCount)) {\n+            throw new ValidationException(this, \"unexpected section number (\" + currentSectionCount + \"): no existing associated section\");\n+        }\n         ValidationUtil.checkRegulatingTerminal(this, regulatingTerminal, getNetwork());\n         ValidationUtil.checkVoltageControl(this, voltageRegulatorOn, targetV);\n         ValidationUtil.checkTargetDeadband(this, \"shunt compensator\", voltageRegulatorOn, targetDeadband);\n         ShuntCompensatorImpl shunt\n                 = new ShuntCompensatorImpl(getNetwork().getRef(),\n-                id, getName(), isFictitious(), bPerSection, maximumSectionCount,\n+                id, getName(), isFictitious(), model,\n                 currentSectionCount, regulatingTerminal == null ? terminal : regulatingTerminal,\n                 voltageRegulatorOn, targetV, targetDeadband);\n+        model.setShuntCompensator(shunt);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b23d718b0d949eb8b85443e79d0f16c091948d9"}, "originalPosition": 164}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MTcwODE5OnYy", "diffSide": "RIGHT", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ShuntCompensatorImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMjoyMTozMlrOF6ts7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMjoyMTozMlrOF6ts7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzExMDUxMQ==", "bodyText": "Attach the model this this shunt compensator, like it's done between HvdcLine and HvdcConverterStation", "url": "https://github.com/powsybl/powsybl-core/pull/1202#discussion_r397110511", "createdAt": "2020-03-24T12:21:32Z", "author": {"login": "mathbagu"}, "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ShuntCompensatorImpl.java", "diffHunk": "@@ -47,13 +39,12 @@\n     private final TDoubleArrayList targetDeadband;\n \n     ShuntCompensatorImpl(Ref<? extends VariantManagerHolder> network,\n-                         String id, String name, boolean fictitious, double bPerSection, int maximumSectionCount,\n+                         String id, String name, boolean fictitious, ShuntCompensatorModelWrapper model,\n                          int currentSectionCount, TerminalExt regulatingTerminal, boolean voltageRegulatorOn,\n                          double targetV, double targetDeadband) {\n         super(id, name, fictitious);\n         this.network = network;\n-        this.bPerSection = bPerSection;\n-        this.maximumSectionCount = maximumSectionCount;\n+        this.model = model;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b23d718b0d949eb8b85443e79d0f16c091948d9"}, "originalPosition": 42}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 88, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}