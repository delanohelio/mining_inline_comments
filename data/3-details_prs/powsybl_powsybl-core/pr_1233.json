{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwNTcyMDQx", "number": 1233, "title": "Add nodeBreakerView.hasAttachedEquipment(node) method + Ensure an IIDM node number is valid before trying to use it in CGMES conversion", "bodyText": "Signed-off-by: Luma Zamarren\u0303o zamarrenolm@aia.es\nPlease check if the PR fulfills these requirements (please use '[x]' to check the checkboxes, or submit the PR and then click the checkboxes)\n\n The commit message follows our guidelines\n Tests for the changes have been added (for bug fixes / features)\n Docs have been added / updated (for bug fixes / features)\n\nWhat kind of change does this PR introduce? (Bug fix, feature, docs update, ...)\nBug fix for conversion of isolated connectivity nodes in CGMES.\nWhat is the current behavior? (You can also link to an open issue here)\nCGMES data contains an isolated connectivity node (no terminals attached to it, no related equipment).\nSpace for the connectivity node is reserved at IIDM node-breaker graph (a vertex is reserved).\nDuring the conversion, the reserved vertex is never used (no equipment is attached to it).\nAfter all equipment has been converted, voltages and angles from SV are put on the resulting IIDM data.\nThe CGMES SV data contains voltage and angle values for the connectivity node.\nBut the corresponding node in IIDM node-breaker graph is not valid.\nAn exception is raised.\nWhat is the new behavior (if this is a feature change)?\nBefore trying to use the node from IIDM node-breaker graph, it is verified that the node number is valid.\nTo do it, we check that the nodes returned by the node-breaker view in IIDM contain the node number reserved.\nThere is no severe performance penalty on adding the check. It has been tested on a network with more than 14000 values for voltages. Without the check, all voltages and angles were set in 1400 ms. After adding the check, the cost is 1600 ms.", "createdAt": "2020-03-18T17:33:27Z", "url": "https://github.com/powsybl/powsybl-core/pull/1233", "merged": true, "mergeCommit": {"oid": "e1df3ba85e4a286e682f71b91e39312c927db3db"}, "closed": true, "closedAt": "2020-04-02T07:55:42Z", "author": {"login": "zamarrenolm"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcPM9bPAFqTM3Nzc4NTExMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTnW5YgH2gAyMzkwNTcyMDQxOmJhZjgxNTA5MDk5M2I2YmM2MTJjZjQ0YmVkYzVmZTkzMDNiMTRmYzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3Nzg1MTEz", "url": "https://github.com/powsybl/powsybl-core/pull/1233#pullrequestreview-377785113", "createdAt": "2020-03-19T14:40:54Z", "commit": {"oid": "78e566a1709c4d16801bfd9858b95cb2501e83a2"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5Mjk3MTM1", "url": "https://github.com/powsybl/powsybl-core/pull/1233#pullrequestreview-379297135", "createdAt": "2020-03-23T10:24:09Z", "commit": {"oid": "78e566a1709c4d16801bfd9858b95cb2501e83a2"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMDoyNDoxMFrOF5_CtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMDozNDowOFrOF5_a3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM0NjAzNg==", "bodyText": "Not related to this PR, but this TODO could be removed.", "url": "https://github.com/powsybl/powsybl-core/pull/1233#discussion_r396346036", "createdAt": "2020-03-23T10:24:10Z", "author": {"login": "mathbagu"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/elements/NodeConversion.java", "diffHunk": "@@ -68,34 +69,34 @@ private VoltageLevel newBoundarySubstationVoltageLevel() {\n         String substationName = \"boundary\";\n         String vlName = \"boundary\";\n         return context.network()\n-                .newSubstation()\n-                .setId(context.namingStrategy().getId(\"Substation\", substationId))\n-                .setName(substationName)\n-                // TODO(mathbagu): Country should be optional. This will be done in another PR.\n-                // A non-null country code must be set\n-                // This is an arbitrary country code, Bangladesh code BD also matches with\n-                // BounDary\n-                .setCountry(boundaryCountryCode())\n-                .add()\n-                .newVoltageLevel()\n-                .setId(context.namingStrategy().getId(\"VoltageLevel\", vlId))\n-                .setName(vlName)\n-                .setNominalV(nominalVoltage)\n-                .setTopologyKind(context.nodeBreaker() ? TopologyKind.NODE_BREAKER : TopologyKind.BUS_BREAKER)\n-                .add();\n+            .newSubstation()\n+            .setId(context.namingStrategy().getId(\"Substation\", substationId))\n+            .setName(substationName)\n+            // TODO(mathbagu): Country should be optional. This will be done in another PR.\n+            // A non-null country code must be set\n+            // This is an arbitrary country code, Bangladesh code BD also matches with\n+            // BounDary", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78e566a1709c4d16801bfd9858b95cb2501e83a2"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM0ODIxOQ==", "bodyText": "Not related to this PR, but CalculatedBus and ConfiguredBus are implementation specific and should not appear in this message", "url": "https://github.com/powsybl/powsybl-core/pull/1233#discussion_r396348219", "createdAt": "2020-03-23T10:27:47Z", "author": {"login": "mathbagu"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/elements/NodeConversion.java", "diffHunk": "@@ -186,12 +191,19 @@ public void setVoltageAngleNodeBreaker() {\n                 return;\n             }\n             LOG.warn(\n-                    \"Can't find a calculated Bus to set Voltage, Angle, but found a configured Bus {}. Connectivity node {}\",\n-                    bus, id);\n+                \"Can't find a calculated Bus to set Voltage, Angle, but found a configured Bus {}. Connectivity node {}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78e566a1709c4d16801bfd9858b95cb2501e83a2"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM1MjIyMg==", "bodyText": "Not sure we should assume that, or we should update the documentation.\nAnyway, is it the best way to check if a terminal is associated to this node: maybe we should add a convenient method to get an Optional<Terminal> from a node?", "url": "https://github.com/powsybl/powsybl-core/pull/1233#discussion_r396352222", "createdAt": "2020-03-23T10:34:08Z", "author": {"login": "mathbagu"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/elements/NodeConversion.java", "diffHunk": "@@ -186,12 +191,19 @@ public void setVoltageAngleNodeBreaker() {\n                 return;\n             }\n             LOG.warn(\n-                    \"Can't find a calculated Bus to set Voltage, Angle, but found a configured Bus {}. Connectivity node {}\",\n-                    bus, id);\n+                \"Can't find a calculated Bus to set Voltage, Angle, but found a configured Bus {}. Connectivity node {}\",\n+                bus, id);\n         }\n         setVoltageAngle(bus);\n     }\n \n+    private boolean iidmNodeIsValid(VoltageLevel.NodeBreakerView topo, int iidmNode) {\n+        // A node is valid only if it has some equipment attached\n+        // The list of valid nodes is obtained from the node-breaker view\n+        // We assume the returned list is sorted", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78e566a1709c4d16801bfd9858b95cb2501e83a2"}, "originalPosition": 92}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "78e566a1709c4d16801bfd9858b95cb2501e83a2", "author": {"user": {"login": "zamarrenolm", "name": "Luma"}}, "url": "https://github.com/powsybl/powsybl-core/commit/78e566a1709c4d16801bfd9858b95cb2501e83a2", "committedDate": "2020-03-18T17:19:56Z", "message": "Ensure an IIDM node number is valid before trying to use it\n\nSigned-off-by: Luma Zamarren\u0303o <zamarrenolm@aia.es>"}, "afterCommit": {"oid": "adea2815fde8320896fc6bd093d1c23b89f074ec", "author": {"user": {"login": "MioRtia", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/adea2815fde8320896fc6bd093d1c23b89f074ec", "committedDate": "2020-03-27T09:11:31Z", "message": "Use hasAttachedEquipment for CGMES node conversion\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNTg5MTM5", "url": "https://github.com/powsybl/powsybl-core/pull/1233#pullrequestreview-383589139", "createdAt": "2020-03-30T07:24:31Z", "commit": {"oid": "adea2815fde8320896fc6bd093d1c23b89f074ec"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwNzoyNDozMlrOF9cpuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwNzoyNDozMlrOF9cpuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk3Njg4OA==", "bodyText": "@zamarrenolm you should configure your IDE to set to 8 spaces the continuous indentation.", "url": "https://github.com/powsybl/powsybl-core/pull/1233#discussion_r399976888", "createdAt": "2020-03-30T07:24:32Z", "author": {"login": "mathbagu"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/elements/NodeConversion.java", "diffHunk": "@@ -68,34 +68,30 @@ private VoltageLevel newBoundarySubstationVoltageLevel() {\n         String substationName = \"boundary\";\n         String vlName = \"boundary\";\n         return context.network()\n-                .newSubstation()\n-                .setId(context.namingStrategy().getId(\"Substation\", substationId))\n-                .setName(substationName)\n-                // TODO(mathbagu): Country should be optional. This will be done in another PR.\n-                // A non-null country code must be set\n-                // This is an arbitrary country code, Bangladesh code BD also matches with\n-                // BounDary\n-                .setCountry(boundaryCountryCode())\n-                .add()\n-                .newVoltageLevel()\n-                .setId(context.namingStrategy().getId(\"VoltageLevel\", vlId))\n-                .setName(vlName)\n-                .setNominalV(nominalVoltage)\n-                .setTopologyKind(context.nodeBreaker() ? TopologyKind.NODE_BREAKER : TopologyKind.BUS_BREAKER)\n-                .add();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adea2815fde8320896fc6bd093d1c23b89f074ec"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNTg5Njkw", "url": "https://github.com/powsybl/powsybl-core/pull/1233#pullrequestreview-383589690", "createdAt": "2020-03-30T07:25:21Z", "commit": {"oid": "adea2815fde8320896fc6bd093d1c23b89f074ec"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14f1f3d2576b02b8af7d3c6ec3cc1127cfd37522", "author": {"user": {"login": "zamarrenolm", "name": "Luma"}}, "url": "https://github.com/powsybl/powsybl-core/commit/14f1f3d2576b02b8af7d3c6ec3cc1127cfd37522", "committedDate": "2020-03-31T12:43:20Z", "message": "Ensure an IIDM node number is valid before trying to use it\n\nSigned-off-by: Luma Zamarren\u0303o <zamarrenolm@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae0087d592267c31f811ce67ec4c22879014bee5", "author": {"user": {"login": "MioRtia", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/ae0087d592267c31f811ce67ec4c22879014bee5", "committedDate": "2020-03-31T12:43:20Z", "message": "Add convenient method NodeBreakerView.hasAttachedEquipment() + implementations\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35b7dffe9d815ea43698f4843e33164ce720812d", "author": {"user": {"login": "MioRtia", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/35b7dffe9d815ea43698f4843e33164ce720812d", "committedDate": "2020-03-31T12:43:20Z", "message": "Use hasAttachedEquipment for CGMES node conversion\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ea56a5d33b386ede1703aad65d3bbc26d08e666", "author": {"user": {"login": "MioRtia", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/9ea56a5d33b386ede1703aad65d3bbc26d08e666", "committedDate": "2020-03-31T12:43:20Z", "message": "Change log warning\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "07155b51e1e09f0bda3eb36ebcb3ce098089068c", "author": {"user": {"login": "MioRtia", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/07155b51e1e09f0bda3eb36ebcb3ce098089068c", "committedDate": "2020-03-31T12:40:22Z", "message": "Change log warning\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>"}, "afterCommit": {"oid": "9ea56a5d33b386ede1703aad65d3bbc26d08e666", "author": {"user": {"login": "MioRtia", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/9ea56a5d33b386ede1703aad65d3bbc26d08e666", "committedDate": "2020-03-31T12:43:20Z", "message": "Change log warning\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "baf815090993b6bc612cf44bedc5fe9303b14fc2", "author": {"user": {"login": "MioRtia", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/baf815090993b6bc612cf44bedc5fe9303b14fc2", "committedDate": "2020-04-02T07:41:57Z", "message": "Merge branch 'master' into cgmes_conversion_ensure_valid_iidm_node"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4475, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}