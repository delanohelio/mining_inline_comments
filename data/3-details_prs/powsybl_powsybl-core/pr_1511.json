{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5NDM2ODc0", "number": 1511, "title": "Finish ExecutionReport implementation to get std out/err stream", "bodyText": "Please check if the PR fulfills these requirements (please use '[x]' to check the checkboxes, or submit the PR and then click the checkboxes)\n\n The commit message follows our guidelines\n Tests for the changes have been added (for bug fixes / features)\n Docs have been added / updated (for bug fixes / features)\n\nDoes this PR already have an issue describing the problem ? If so, link to this issue using '#XXX' and skip the rest\nN/A\nWhat kind of change does this PR introduce? (Bug fix, feature, docs update, ...)\nFeature\nWhat is the current behavior? (You can also link to an open issue here)\nThe getStdOut and getStdErr are not implemented in the only ExecutionReport subclass we have in powsybl-core. The methods are implemented in powsybl-afs, for slurm computation.\nWhat is the new behavior (if this is a feature change)?\nThe DefaultExecutionReport override the two methods. As this class need to access to the working directory, the ok method is removed. It was used only in unit test, so it should be acceptable.\nDoes this PR introduce a breaking change or deprecate an API? If yes, check the following:\n\n The Breaking Change or Deprecated label has been added\n The migration guide has been updated in the github wiki (What changes might users need to make in their application due to this PR?)\n\nOther information:\n(if any of the questions/checkboxes don't apply, please delete them entirely)", "createdAt": "2020-10-07T18:24:09Z", "url": "https://github.com/powsybl/powsybl-core/pull/1511", "merged": true, "mergeCommit": {"oid": "e0c5cc9f1d5f9a1c9548af3be050187a7240f168"}, "closed": true, "closedAt": "2020-10-08T12:52:12Z", "author": {"login": "mathbagu"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQT0C4AH2gAyNDk5NDM2ODc0OjA3OTYwN2Y4NjYwNmIwY2MyMDBhZTA5ZmM1ZDkzYTZhMDQ5YzkyOWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQg4q0gH2gAyNDk5NDM2ODc0OjhhNGQ0ZDQ5OGI1ZDNmNzUxMTRlMmEwMWMxZWQzNmFhZDFmNmY3ZTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "079607f86606b0cc200ae09fc5d93a6a049c929d", "author": {"user": {"login": "mathbagu", "name": "Mathieu BAGUE"}}, "url": "https://github.com/powsybl/powsybl-core/commit/079607f86606b0cc200ae09fc5d93a6a049c929d", "committedDate": "2020-10-07T21:25:04Z", "message": "Finish ExecutionReport implementation to get std out/err stream\n\nSigned-off-by: Mathieu BAGUE <mathieu.bague@rte-france.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "866798d788022b38825caa5fb020c450e5e91415", "author": {"user": {"login": "mathbagu", "name": "Mathieu BAGUE"}}, "url": "https://github.com/powsybl/powsybl-core/commit/866798d788022b38825caa5fb020c450e5e91415", "committedDate": "2020-10-07T21:19:30Z", "message": "Increase code coverage\n\nSigned-off-by: Mathieu BAGUE <mathieu.bague@rte-france.com>"}, "afterCommit": {"oid": "079607f86606b0cc200ae09fc5d93a6a049c929d", "author": {"user": {"login": "mathbagu", "name": "Mathieu BAGUE"}}, "url": "https://github.com/powsybl/powsybl-core/commit/079607f86606b0cc200ae09fc5d93a6a049c929d", "committedDate": "2020-10-07T21:25:04Z", "message": "Finish ExecutionReport implementation to get std out/err stream\n\nSigned-off-by: Mathieu BAGUE <mathieu.bague@rte-france.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0NTM2MzQw", "url": "https://github.com/powsybl/powsybl-core/pull/1511#pullrequestreview-504536340", "createdAt": "2020-10-08T08:20:23Z", "commit": {"oid": "079607f86606b0cc200ae09fc5d93a6a049c929d"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwODoyMDoyM1rOHeTMAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwODoyMjowMFrOHeTQEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUzMzY5OQ==", "bodyText": "Is it relevant to make a constructor without parameters with a default directory (maybe not)(don't forget the Breaking change label if it is not the case)?", "url": "https://github.com/powsybl/powsybl-core/pull/1511#discussion_r501533699", "createdAt": "2020-10-08T08:20:23Z", "author": {"login": "MioRtia"}, "path": "computation/src/main/java/com/powsybl/computation/DefaultExecutionReport.java", "diffHunk": "@@ -22,29 +27,22 @@\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(DefaultExecutionReport.class);\n \n-    private static final ExecutionReport OK = new DefaultExecutionReport();\n+    private final Path workingDirectory;\n \n     private final List<ExecutionError> errors;\n \n-    /**\n-     * An execution report with no execution error.\n-     * @return an execution report with no execution error.\n-     */\n-    public static ExecutionReport ok() {\n-        return OK;\n-    }\n-\n     /**\n      * Create an execution report with no execution error.\n      */\n-    public DefaultExecutionReport() {\n-        this(Collections.emptyList());\n+    public DefaultExecutionReport(Path workingDirectory) {\n+        this(workingDirectory, Collections.emptyList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "079607f86606b0cc200ae09fc5d93a6a049c929d"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUzNDMzMA==", "bodyText": "Sonarcloud said it is not useful to add the toString() method as the logger already formats paths", "url": "https://github.com/powsybl/powsybl-core/pull/1511#discussion_r501534330", "createdAt": "2020-10-08T08:21:21Z", "author": {"login": "MioRtia"}, "path": "computation/src/main/java/com/powsybl/computation/DefaultExecutionReport.java", "diffHunk": "@@ -65,4 +63,29 @@ public void log() {\n         }\n     }\n \n+    @Override\n+    public Optional<InputStream> getStdOut(Command command, int index) {\n+        return getOutputFile(command, index, \".out\");\n+    }\n+\n+    @Override\n+    public Optional<InputStream> getStdErr(Command command, int index) {\n+        return getOutputFile(command, index, \".err\");\n+    }\n+\n+    private Optional<InputStream> getOutputFile(Command command, int index, String extension) {\n+        Objects.requireNonNull(command);\n+        if (index < 0) {\n+            throw new IllegalArgumentException(\"Invalid index: \" + index);\n+        }\n+\n+        Path path = workingDirectory.resolve(command.getId() + \"_\" + index + extension);\n+        try {\n+            return Optional.of(Files.newInputStream(path));\n+        } catch (IOException e) {\n+            LOGGER.warn(\"Unable to read {}: {}\", path.toString(), e.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "079607f86606b0cc200ae09fc5d93a6a049c929d"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUzNDczOA==", "bodyText": "Just for me, when did we use this method? (Don't forget the Breaking change label if we delete it)", "url": "https://github.com/powsybl/powsybl-core/pull/1511#discussion_r501534738", "createdAt": "2020-10-08T08:22:00Z", "author": {"login": "MioRtia"}, "path": "computation/src/main/java/com/powsybl/computation/DefaultExecutionReport.java", "diffHunk": "@@ -22,29 +27,22 @@\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(DefaultExecutionReport.class);\n \n-    private static final ExecutionReport OK = new DefaultExecutionReport();\n+    private final Path workingDirectory;\n \n     private final List<ExecutionError> errors;\n \n-    /**\n-     * An execution report with no execution error.\n-     * @return an execution report with no execution error.\n-     */\n-    public static ExecutionReport ok() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "079607f86606b0cc200ae09fc5d93a6a049c929d"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8712945247369376f971f8b5c50eeccb40b3154b", "author": {"user": {"login": "mathbagu", "name": "Mathieu BAGUE"}}, "url": "https://github.com/powsybl/powsybl-core/commit/8712945247369376f971f8b5c50eeccb40b3154b", "committedDate": "2020-10-08T08:31:55Z", "message": "Increase code coverage\n\nSigned-off-by: Mathieu BAGUE <mathieu.bague@rte-france.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30a8b600ee3f30dc1ae5f4c170def8850378eefd", "author": {"user": {"login": "mathbagu", "name": "Mathieu BAGUE"}}, "url": "https://github.com/powsybl/powsybl-core/commit/30a8b600ee3f30dc1ae5f4c170def8850378eefd", "committedDate": "2020-10-08T12:02:22Z", "message": "Fix coding style\n\nSigned-off-by: Mathieu BAGUE <mathieu.bague@rte-france.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0NzIzMjM0", "url": "https://github.com/powsybl/powsybl-core/pull/1511#pullrequestreview-504723234", "createdAt": "2020-10-08T12:22:15Z", "commit": {"oid": "30a8b600ee3f30dc1ae5f4c170def8850378eefd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a4d4d498b5d3f75114e2a01c1ed36aad1f6f7e3", "author": {"user": {"login": "mathbagu", "name": "Mathieu BAGUE"}}, "url": "https://github.com/powsybl/powsybl-core/commit/8a4d4d498b5d3f75114e2a01c1ed36aad1f6f7e3", "committedDate": "2020-10-08T12:38:53Z", "message": "Merge branch 'master' into fix-execution-report"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4054, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}