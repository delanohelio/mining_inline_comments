{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2OTU3MDcw", "number": 1132, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QwODo1NDowOFrODazOwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNDoyMTozM1rODa5Kbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NDI4OTMwOnYy", "diffSide": "RIGHT", "path": "iidm/iidm-api/src/test/java/com/powsybl/iidm/network/util/BranchTestData.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QwODo1NDowOFrOFh7SNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwNzoxMzoxNVrOFia-kQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTExODY0Nw==", "bodyText": "Could be private", "url": "https://github.com/powsybl/powsybl-core/pull/1132#discussion_r371118647", "createdAt": "2020-01-27T08:54:08Z", "author": {"login": "miovd"}, "path": "iidm/iidm-api/src/test/java/com/powsybl/iidm/network/util/BranchTestData.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.util;\n+\n+import org.mockito.Mockito;\n+\n+import com.powsybl.iidm.network.Bus;\n+import com.powsybl.iidm.network.Line;\n+import com.powsybl.iidm.network.Terminal;\n+import com.powsybl.iidm.network.VoltageLevel;\n+import com.powsybl.iidm.network.Terminal.BusView;\n+\n+/**\n+ *\n+ * @author Jos\u00e9 Antonio Marqu\u00e9s <marquesja at aia.es>\n+ */\n+public class BranchTestData {\n+\n+    private Line line;\n+    private Terminal terminal1;\n+    VoltageLevel voltageLevel1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21d74837ebf5b93cf3b4cea5ec46594a0ed36161"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYzNzkwNQ==", "bodyText": "Done", "url": "https://github.com/powsybl/powsybl-core/pull/1132#discussion_r371637905", "createdAt": "2020-01-28T07:13:15Z", "author": {"login": "marqueslanauja"}, "path": "iidm/iidm-api/src/test/java/com/powsybl/iidm/network/util/BranchTestData.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.util;\n+\n+import org.mockito.Mockito;\n+\n+import com.powsybl.iidm.network.Bus;\n+import com.powsybl.iidm.network.Line;\n+import com.powsybl.iidm.network.Terminal;\n+import com.powsybl.iidm.network.VoltageLevel;\n+import com.powsybl.iidm.network.Terminal.BusView;\n+\n+/**\n+ *\n+ * @author Jos\u00e9 Antonio Marqu\u00e9s <marquesja at aia.es>\n+ */\n+public class BranchTestData {\n+\n+    private Line line;\n+    private Terminal terminal1;\n+    VoltageLevel voltageLevel1;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTExODY0Nw=="}, "originalCommit": {"oid": "21d74837ebf5b93cf3b4cea5ec46594a0ed36161"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NDI4OTY2OnYy", "diffSide": "RIGHT", "path": "iidm/iidm-api/src/test/java/com/powsybl/iidm/network/util/BranchTestData.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QwODo1NDoxNVrOFh7Sbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwNzoxMzoyOVrOFia-yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTExODcwMg==", "bodyText": "Could be private", "url": "https://github.com/powsybl/powsybl-core/pull/1132#discussion_r371118702", "createdAt": "2020-01-27T08:54:15Z", "author": {"login": "miovd"}, "path": "iidm/iidm-api/src/test/java/com/powsybl/iidm/network/util/BranchTestData.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.util;\n+\n+import org.mockito.Mockito;\n+\n+import com.powsybl.iidm.network.Bus;\n+import com.powsybl.iidm.network.Line;\n+import com.powsybl.iidm.network.Terminal;\n+import com.powsybl.iidm.network.VoltageLevel;\n+import com.powsybl.iidm.network.Terminal.BusView;\n+\n+/**\n+ *\n+ * @author Jos\u00e9 Antonio Marqu\u00e9s <marquesja at aia.es>\n+ */\n+public class BranchTestData {\n+\n+    private Line line;\n+    private Terminal terminal1;\n+    VoltageLevel voltageLevel1;\n+    private Terminal terminal2;\n+    VoltageLevel voltageLevel2;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21d74837ebf5b93cf3b4cea5ec46594a0ed36161"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYzNzk2Mg==", "bodyText": "Done", "url": "https://github.com/powsybl/powsybl-core/pull/1132#discussion_r371637962", "createdAt": "2020-01-28T07:13:29Z", "author": {"login": "marqueslanauja"}, "path": "iidm/iidm-api/src/test/java/com/powsybl/iidm/network/util/BranchTestData.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.util;\n+\n+import org.mockito.Mockito;\n+\n+import com.powsybl.iidm.network.Bus;\n+import com.powsybl.iidm.network.Line;\n+import com.powsybl.iidm.network.Terminal;\n+import com.powsybl.iidm.network.VoltageLevel;\n+import com.powsybl.iidm.network.Terminal.BusView;\n+\n+/**\n+ *\n+ * @author Jos\u00e9 Antonio Marqu\u00e9s <marquesja at aia.es>\n+ */\n+public class BranchTestData {\n+\n+    private Line line;\n+    private Terminal terminal1;\n+    VoltageLevel voltageLevel1;\n+    private Terminal terminal2;\n+    VoltageLevel voltageLevel2;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTExODcwMg=="}, "originalCommit": {"oid": "21d74837ebf5b93cf3b4cea5ec46594a0ed36161"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NDQzOTQ1OnYy", "diffSide": "RIGHT", "path": "iidm/iidm-api/src/test/java/com/powsybl/iidm/network/util/BranchTestData.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QwOTo0NToxM1rOFh8qqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwNzoxMzo0MFrOFia-_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE0MTI5MQ==", "bodyText": "This class, its constructor and its methods can be private-package", "url": "https://github.com/powsybl/powsybl-core/pull/1132#discussion_r371141291", "createdAt": "2020-01-27T09:45:13Z", "author": {"login": "miovd"}, "path": "iidm/iidm-api/src/test/java/com/powsybl/iidm/network/util/BranchTestData.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.util;\n+\n+import org.mockito.Mockito;\n+\n+import com.powsybl.iidm.network.Bus;\n+import com.powsybl.iidm.network.Line;\n+import com.powsybl.iidm.network.Terminal;\n+import com.powsybl.iidm.network.VoltageLevel;\n+import com.powsybl.iidm.network.Terminal.BusView;\n+\n+/**\n+ *\n+ * @author Jos\u00e9 Antonio Marqu\u00e9s <marquesja at aia.es>\n+ */\n+public class BranchTestData {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21d74837ebf5b93cf3b4cea5ec46594a0ed36161"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYzODAxNQ==", "bodyText": "Done", "url": "https://github.com/powsybl/powsybl-core/pull/1132#discussion_r371638015", "createdAt": "2020-01-28T07:13:40Z", "author": {"login": "marqueslanauja"}, "path": "iidm/iidm-api/src/test/java/com/powsybl/iidm/network/util/BranchTestData.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.network.util;\n+\n+import org.mockito.Mockito;\n+\n+import com.powsybl.iidm.network.Bus;\n+import com.powsybl.iidm.network.Line;\n+import com.powsybl.iidm.network.Terminal;\n+import com.powsybl.iidm.network.VoltageLevel;\n+import com.powsybl.iidm.network.Terminal.BusView;\n+\n+/**\n+ *\n+ * @author Jos\u00e9 Antonio Marqu\u00e9s <marquesja at aia.es>\n+ */\n+public class BranchTestData {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE0MTI5MQ=="}, "originalCommit": {"oid": "21d74837ebf5b93cf3b4cea5ec46594a0ed36161"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NTI1NjU5OnYy", "diffSide": "RIGHT", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/util/BranchData.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNDoyMDoxMlrOFiEPCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwNzoxNDoxN1rOFia_lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI2NTI4OA==", "bodyText": "Some duplicated code here, a small factorization could be done.", "url": "https://github.com/powsybl/powsybl-core/pull/1132#discussion_r371265288", "createdAt": "2020-01-27T14:20:12Z", "author": {"login": "annetill"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/util/BranchData.java", "diffHunk": "@@ -159,6 +155,18 @@ public BranchData(Line line, double epsilonX, boolean applyReactanceCorrection)\n         mainComponent1 = bus1 != null ? bus1.isInMainConnectedComponent() : connectableMainComponent1;\n         mainComponent2 = bus2 != null ? bus2.isInMainConnectedComponent() : connectableMainComponent2;\n \n+        if (isStructuralRatioLineNeeded(line)) {\n+            rho1 = 1.0 / structuralRatioEnd1(line);\n+            rho2 = 1f;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21d74837ebf5b93cf3b4cea5ec46594a0ed36161"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYzODE2Nw==", "bodyText": "Done", "url": "https://github.com/powsybl/powsybl-core/pull/1132#discussion_r371638167", "createdAt": "2020-01-28T07:14:17Z", "author": {"login": "marqueslanauja"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/util/BranchData.java", "diffHunk": "@@ -159,6 +155,18 @@ public BranchData(Line line, double epsilonX, boolean applyReactanceCorrection)\n         mainComponent1 = bus1 != null ? bus1.isInMainConnectedComponent() : connectableMainComponent1;\n         mainComponent2 = bus2 != null ? bus2.isInMainConnectedComponent() : connectableMainComponent2;\n \n+        if (isStructuralRatioLineNeeded(line)) {\n+            rho1 = 1.0 / structuralRatioEnd1(line);\n+            rho2 = 1f;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI2NTI4OA=="}, "originalCommit": {"oid": "21d74837ebf5b93cf3b4cea5ec46594a0ed36161"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NTI1NzYwOnYy", "diffSide": "RIGHT", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/util/BranchData.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNDoyMDozMlrOFiEPqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwNzoxMzo1M1rOFia_Lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI2NTQ1MQ==", "bodyText": "You can merge this into a big if", "url": "https://github.com/powsybl/powsybl-core/pull/1132#discussion_r371265451", "createdAt": "2020-01-27T14:20:32Z", "author": {"login": "miovd"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/util/BranchData.java", "diffHunk": "@@ -211,6 +219,32 @@ public BranchData(TwoWindingsTransformer twt, int phaseAngleClock, double epsilo\n         computeValues();\n     }\n \n+    private boolean isStructuralRatioLineNeeded(Line line) {\n+        if (line.getTerminal1() == null || line.getTerminal1().getVoltageLevel() == null) {\n+            return false;\n+        }\n+        if (line.getTerminal2() == null || line.getTerminal2().getVoltageLevel() == null) {\n+            return false;\n+        }\n+\n+        double nominalV1 = line.getTerminal1().getVoltageLevel().getNominalV();\n+        double nominalV2 = line.getTerminal2().getVoltageLevel().getNominalV();\n+\n+        if (nominalV1 == 0.0 || Double.isNaN(nominalV1)) {\n+            return false;\n+        }\n+        if (nominalV2 == 0.0 || Double.isNaN(nominalV2)) {\n+            return false;\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21d74837ebf5b93cf3b4cea5ec46594a0ed36161"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYzODA2Mg==", "bodyText": "Done", "url": "https://github.com/powsybl/powsybl-core/pull/1132#discussion_r371638062", "createdAt": "2020-01-28T07:13:53Z", "author": {"login": "marqueslanauja"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/util/BranchData.java", "diffHunk": "@@ -211,6 +219,32 @@ public BranchData(TwoWindingsTransformer twt, int phaseAngleClock, double epsilo\n         computeValues();\n     }\n \n+    private boolean isStructuralRatioLineNeeded(Line line) {\n+        if (line.getTerminal1() == null || line.getTerminal1().getVoltageLevel() == null) {\n+            return false;\n+        }\n+        if (line.getTerminal2() == null || line.getTerminal2().getVoltageLevel() == null) {\n+            return false;\n+        }\n+\n+        double nominalV1 = line.getTerminal1().getVoltageLevel().getNominalV();\n+        double nominalV2 = line.getTerminal2().getVoltageLevel().getNominalV();\n+\n+        if (nominalV1 == 0.0 || Double.isNaN(nominalV1)) {\n+            return false;\n+        }\n+        if (nominalV2 == 0.0 || Double.isNaN(nominalV2)) {\n+            return false;\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI2NTQ1MQ=="}, "originalCommit": {"oid": "21d74837ebf5b93cf3b4cea5ec46594a0ed36161"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NTI2MTI2OnYy", "diffSide": "RIGHT", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/util/BranchData.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNDoyMTozM1rOFiER_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwNzoxNDowN1rOFia_bg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI2NjA0NA==", "bodyText": "You can merge this into a big if", "url": "https://github.com/powsybl/powsybl-core/pull/1132#discussion_r371266044", "createdAt": "2020-01-27T14:21:33Z", "author": {"login": "miovd"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/util/BranchData.java", "diffHunk": "@@ -211,6 +219,32 @@ public BranchData(TwoWindingsTransformer twt, int phaseAngleClock, double epsilo\n         computeValues();\n     }\n \n+    private boolean isStructuralRatioLineNeeded(Line line) {\n+        if (line.getTerminal1() == null || line.getTerminal1().getVoltageLevel() == null) {\n+            return false;\n+        }\n+        if (line.getTerminal2() == null || line.getTerminal2().getVoltageLevel() == null) {\n+            return false;\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21d74837ebf5b93cf3b4cea5ec46594a0ed36161"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYzODEyNg==", "bodyText": "Done", "url": "https://github.com/powsybl/powsybl-core/pull/1132#discussion_r371638126", "createdAt": "2020-01-28T07:14:07Z", "author": {"login": "marqueslanauja"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/util/BranchData.java", "diffHunk": "@@ -211,6 +219,32 @@ public BranchData(TwoWindingsTransformer twt, int phaseAngleClock, double epsilo\n         computeValues();\n     }\n \n+    private boolean isStructuralRatioLineNeeded(Line line) {\n+        if (line.getTerminal1() == null || line.getTerminal1().getVoltageLevel() == null) {\n+            return false;\n+        }\n+        if (line.getTerminal2() == null || line.getTerminal2().getVoltageLevel() == null) {\n+            return false;\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI2NjA0NA=="}, "originalCommit": {"oid": "21d74837ebf5b93cf3b4cea5ec46594a0ed36161"}, "originalPosition": 44}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 45, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}