{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0MTc0MTgx", "number": 1491, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNTo1NTozNlrOEoJ1nA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNTo1NjoxMlrOEoJ2kQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNTM5Njc2OnYy", "diffSide": "RIGHT", "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/elements/transformers/CgmesPhaseTapChangerBuilder.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNTo1NTozNlrOHZFEpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwODozMjo1OFrOHZh4QA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA1OTU1Nw==", "bodyText": "I think the problem is that the X of the transformer is zero. We should not allow transformers with zero reactance. I think is better to fix this problem in the class CgmesT2xModel (Line 35) for twoWindingsTransformer and in the class CgmesT3xModel (Line 43) for threeWindingsTransformers. We can write an invalid warning and fix the X to a residual value (0.0001 by example) or maybe we can throw an exception.", "url": "https://github.com/powsybl/powsybl-core/pull/1491#discussion_r496059557", "createdAt": "2020-09-28T15:55:36Z", "author": {"login": "marqueslanauja"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/elements/transformers/CgmesPhaseTapChangerBuilder.java", "diffHunk": "@@ -142,8 +142,12 @@ private void addStepsAsymmetrical() {\n             return;\n         }\n         double alphaMax = tapChanger.getSteps().stream().map(TapChanger.Step::getAngle)\n-                .mapToDouble(Double::doubleValue).max().orElse(Double.NaN);\n+                .mapToDouble(Double::doubleValue).max().orElse(0);\n         tapChanger.getSteps().forEach(step -> {\n+            if (alphaMax == 0 || xtx == 0) {\n+                step.setX(0);\n+                return;\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b49590ca955e012aed11df7c79b1670d8ba0a8ef"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA2MjQ2MQ==", "bodyText": "Is it okay for you to put Double.MIN_VALUE? I would rather correct the value than throw an exception (the validation can be modified in another PR)", "url": "https://github.com/powsybl/powsybl-core/pull/1491#discussion_r496062461", "createdAt": "2020-09-28T15:59:56Z", "author": {"login": "miovd"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/elements/transformers/CgmesPhaseTapChangerBuilder.java", "diffHunk": "@@ -142,8 +142,12 @@ private void addStepsAsymmetrical() {\n             return;\n         }\n         double alphaMax = tapChanger.getSteps().stream().map(TapChanger.Step::getAngle)\n-                .mapToDouble(Double::doubleValue).max().orElse(Double.NaN);\n+                .mapToDouble(Double::doubleValue).max().orElse(0);\n         tapChanger.getSteps().forEach(step -> {\n+            if (alphaMax == 0 || xtx == 0) {\n+                step.setX(0);\n+                return;\n+            }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA1OTU1Nw=="}, "originalCommit": {"oid": "b49590ca955e012aed11df7c79b1670d8ba0a8ef"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA2MzA4Mw==", "bodyText": "For clarification, I ran into this exception with alphaMax equals to 0.", "url": "https://github.com/powsybl/powsybl-core/pull/1491#discussion_r496063083", "createdAt": "2020-09-28T16:00:47Z", "author": {"login": "miovd"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/elements/transformers/CgmesPhaseTapChangerBuilder.java", "diffHunk": "@@ -142,8 +142,12 @@ private void addStepsAsymmetrical() {\n             return;\n         }\n         double alphaMax = tapChanger.getSteps().stream().map(TapChanger.Step::getAngle)\n-                .mapToDouble(Double::doubleValue).max().orElse(Double.NaN);\n+                .mapToDouble(Double::doubleValue).max().orElse(0);\n         tapChanger.getSteps().forEach(step -> {\n+            if (alphaMax == 0 || xtx == 0) {\n+                step.setX(0);\n+                return;\n+            }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA1OTU1Nw=="}, "originalCommit": {"oid": "b49590ca955e012aed11df7c79b1670d8ba0a8ef"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA5MjQxNw==", "bodyText": "Sorry, then my comment does not make sense. Maybe is better to check only alphaMax\nif (alphaMax == 0) {\n                step.setX(0);\n                return;\n            }", "url": "https://github.com/powsybl/powsybl-core/pull/1491#discussion_r496092417", "createdAt": "2020-09-28T16:47:35Z", "author": {"login": "marqueslanauja"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/elements/transformers/CgmesPhaseTapChangerBuilder.java", "diffHunk": "@@ -142,8 +142,12 @@ private void addStepsAsymmetrical() {\n             return;\n         }\n         double alphaMax = tapChanger.getSteps().stream().map(TapChanger.Step::getAngle)\n-                .mapToDouble(Double::doubleValue).max().orElse(Double.NaN);\n+                .mapToDouble(Double::doubleValue).max().orElse(0);\n         tapChanger.getSteps().forEach(step -> {\n+            if (alphaMax == 0 || xtx == 0) {\n+                step.setX(0);\n+                return;\n+            }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA1OTU1Nw=="}, "originalCommit": {"oid": "b49590ca955e012aed11df7c79b1670d8ba0a8ef"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjUzMTUyMA==", "bodyText": "I did what you suggested", "url": "https://github.com/powsybl/powsybl-core/pull/1491#discussion_r496531520", "createdAt": "2020-09-29T08:32:58Z", "author": {"login": "miovd"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/elements/transformers/CgmesPhaseTapChangerBuilder.java", "diffHunk": "@@ -142,8 +142,12 @@ private void addStepsAsymmetrical() {\n             return;\n         }\n         double alphaMax = tapChanger.getSteps().stream().map(TapChanger.Step::getAngle)\n-                .mapToDouble(Double::doubleValue).max().orElse(Double.NaN);\n+                .mapToDouble(Double::doubleValue).max().orElse(0);\n         tapChanger.getSteps().forEach(step -> {\n+            if (alphaMax == 0 || xtx == 0) {\n+                step.setX(0);\n+                return;\n+            }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA1OTU1Nw=="}, "originalCommit": {"oid": "b49590ca955e012aed11df7c79b1670d8ba0a8ef"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNTM5OTIxOnYy", "diffSide": "RIGHT", "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/elements/transformers/CgmesPhaseTapChangerBuilder.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNTo1NjoxMlrOHZFGJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNTo1NjoxMlrOHZFGJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA1OTk0Mg==", "bodyText": "Same comment", "url": "https://github.com/powsybl/powsybl-core/pull/1491#discussion_r496059942", "createdAt": "2020-09-28T15:56:12Z", "author": {"login": "marqueslanauja"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/elements/transformers/CgmesPhaseTapChangerBuilder.java", "diffHunk": "@@ -190,8 +194,12 @@ private void stepXforLinearAndSymmetrical() {\n             return;\n         }\n         double alphaMax = tapChanger.getSteps().stream().map(TapChanger.Step::getAngle)\n-            .mapToDouble(Double::doubleValue).max().orElse(Double.NaN);\n+            .mapToDouble(Double::doubleValue).max().orElse(0);\n         tapChanger.getSteps().forEach(step -> {\n+            if (alphaMax == 0.0 || xtx == 0.0) {\n+                step.setX(0);\n+                return;\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b49590ca955e012aed11df7c79b1670d8ba0a8ef"}, "originalPosition": 24}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4873, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}