{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4NjkyODU3", "number": 1098, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxNDo0ODo1MFrODXLLXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxNTo1MDoyMFrODXMYyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1NjI2OTczOnYy", "diffSide": "RIGHT", "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/Changelog.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxNDo0ODo1MFrOFcWPKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxMzoyNDo1NlrOFc2t-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTI2ODc3OA==", "bodyText": "If the order is important, maybe we should use a TreeSet, with a comparator on the index?", "url": "https://github.com/powsybl/powsybl-core/pull/1098#discussion_r365268778", "createdAt": "2020-01-10T14:48:50Z", "author": {"login": "mathbagu"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/Changelog.java", "diffHunk": "@@ -80,11 +81,13 @@ public void onVariantCreated(String sourceVariantId, String targetVariantId) {\n \n     public List<IidmChange> getChangesForVariant(String variantId) {\n         if (!changesByVariant.containsKey(variantId)) {\n+            // If we only have baseChanges we assume they are already ordered\n             return Collections.unmodifiableList(baseChanges);\n         } else {\n             List<IidmChange> cs = new ArrayList<>(baseChanges.size() + changesByVariant.size());\n             cs.addAll(baseChanges);\n             cs.addAll(changesByVariant.get(variantId));\n+            cs.sort(Comparator.comparing(IidmChange::getIndex));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "834a2efbd25beea038ebdfc98c33b8158d685c29"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTgwMDk1NQ==", "bodyText": "Done", "url": "https://github.com/powsybl/powsybl-core/pull/1098#discussion_r365800955", "createdAt": "2020-01-13T13:24:56Z", "author": {"login": "kaltakovae"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/Changelog.java", "diffHunk": "@@ -80,11 +81,13 @@ public void onVariantCreated(String sourceVariantId, String targetVariantId) {\n \n     public List<IidmChange> getChangesForVariant(String variantId) {\n         if (!changesByVariant.containsKey(variantId)) {\n+            // If we only have baseChanges we assume they are already ordered\n             return Collections.unmodifiableList(baseChanges);\n         } else {\n             List<IidmChange> cs = new ArrayList<>(baseChanges.size() + changesByVariant.size());\n             cs.addAll(baseChanges);\n             cs.addAll(changesByVariant.get(variantId));\n+            cs.sort(Comparator.comparing(IidmChange::getIndex));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTI2ODc3OA=="}, "originalCommit": {"oid": "834a2efbd25beea038ebdfc98c33b8158d685c29"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1NjI3MDkwOnYy", "diffSide": "RIGHT", "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/IidmChange.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxNDo0OToxNFrOFcWP7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxMzoyODoxNFrOFc2z2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTI2ODk3Mw==", "bodyText": "Should be declared as final", "url": "https://github.com/powsybl/powsybl-core/pull/1098#discussion_r365268973", "createdAt": "2020-01-10T14:49:14Z", "author": {"login": "mathbagu"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/IidmChange.java", "diffHunk": "@@ -18,11 +19,18 @@\n \n     public IidmChange(Identifiable identifiable) {\n         this.identifiable = Objects.requireNonNull(identifiable);\n+        this.index = counter.getAndIncrement();\n     }\n \n     public Identifiable getIdentifiable() {\n         return identifiable;\n     }\n \n+    public int getIndex() {\n+        return index;\n+    }\n+\n     private final Identifiable identifiable;\n+    private final int index;\n+    private static AtomicInteger counter = new AtomicInteger();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "834a2efbd25beea038ebdfc98c33b8158d685c29"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTgwMjQ1OA==", "bodyText": "Done", "url": "https://github.com/powsybl/powsybl-core/pull/1098#discussion_r365802458", "createdAt": "2020-01-13T13:28:14Z", "author": {"login": "kaltakovae"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/IidmChange.java", "diffHunk": "@@ -18,11 +19,18 @@\n \n     public IidmChange(Identifiable identifiable) {\n         this.identifiable = Objects.requireNonNull(identifiable);\n+        this.index = counter.getAndIncrement();\n     }\n \n     public Identifiable getIdentifiable() {\n         return identifiable;\n     }\n \n+    public int getIndex() {\n+        return index;\n+    }\n+\n     private final Identifiable identifiable;\n+    private final int index;\n+    private static AtomicInteger counter = new AtomicInteger();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTI2ODk3Mw=="}, "originalCommit": {"oid": "834a2efbd25beea038ebdfc98c33b8158d685c29"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1NjI4MjY2OnYy", "diffSide": "RIGHT", "path": "cgmes/cgmes-conversion/src/test/java/com/powsybl/cgmes/conversion/test/update/ChangelogCreationRemovalTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxNDo1MzoxMVrOFcWXWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxMzoyNTowN1rOFc2uVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTI3MDg3NA==", "bodyText": "Use a stream: it's more modern:\nreturn changes.stream().filter(IidmChangeRemoval.class::isInstance).collect(Collectors.toList());", "url": "https://github.com/powsybl/powsybl-core/pull/1098#discussion_r365270874", "createdAt": "2020-01-10T14:53:11Z", "author": {"login": "mathbagu"}, "path": "cgmes/cgmes-conversion/src/test/java/com/powsybl/cgmes/conversion/test/update/ChangelogCreationRemovalTest.java", "diffHunk": "@@ -85,15 +86,15 @@ public void testChangelogRemove() {\n         return actual;\n     }\n \n-    private int sizeIgnoreUpdateOnRemoval(List<IidmChange> changes) {\n-        int count = 0;\n+    private List<IidmChange> ignoreUpdateOnRemoval(List<IidmChange> changes) {\n+        List<IidmChange> list = new ArrayList<>();\n         for (IidmChange i : changes) {\n             if (!(i instanceof IidmChangeRemoval)) {\n                 continue;\n             }\n-            count++;\n+            list.add(i);\n         }\n-        return count;\n+        return list;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "834a2efbd25beea038ebdfc98c33b8158d685c29"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTgwMTA0Ng==", "bodyText": "Done", "url": "https://github.com/powsybl/powsybl-core/pull/1098#discussion_r365801046", "createdAt": "2020-01-13T13:25:07Z", "author": {"login": "kaltakovae"}, "path": "cgmes/cgmes-conversion/src/test/java/com/powsybl/cgmes/conversion/test/update/ChangelogCreationRemovalTest.java", "diffHunk": "@@ -85,15 +86,15 @@ public void testChangelogRemove() {\n         return actual;\n     }\n \n-    private int sizeIgnoreUpdateOnRemoval(List<IidmChange> changes) {\n-        int count = 0;\n+    private List<IidmChange> ignoreUpdateOnRemoval(List<IidmChange> changes) {\n+        List<IidmChange> list = new ArrayList<>();\n         for (IidmChange i : changes) {\n             if (!(i instanceof IidmChangeRemoval)) {\n                 continue;\n             }\n-            count++;\n+            list.add(i);\n         }\n-        return count;\n+        return list;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTI3MDg3NA=="}, "originalCommit": {"oid": "834a2efbd25beea038ebdfc98c33b8158d685c29"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1NjI4NDkwOnYy", "diffSide": "RIGHT", "path": "cgmes/cgmes-conversion/src/test/java/com/powsybl/cgmes/conversion/test/update/ChangelogUpdateTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxNDo1Mzo1NVrOFcWYpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxMzoyNzo1OVrOFc2zXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTI3MTIwNQ==", "bodyText": "Do you wan simply to check if the list is empty?", "url": "https://github.com/powsybl/powsybl-core/pull/1098#discussion_r365271205", "createdAt": "2020-01-10T14:53:55Z", "author": {"login": "mathbagu"}, "path": "cgmes/cgmes-conversion/src/test/java/com/powsybl/cgmes/conversion/test/update/ChangelogUpdateTest.java", "diffHunk": "@@ -104,6 +107,32 @@ public void testCloneVariantVariantSpecificChanges() {\n         assertTrue(changesVariant1b.size() == changesVariant1.size());\n     }\n \n+    @Test\n+    public void testChangesLogRightOrder() {\n+        String variant1 = network.getVariantManager().getWorkingVariantId();\n+        // Make changes, on Variant and base.\n+        makeNetworkChangesVariantSpecific(network);\n+        makeRemoveChanges(network);\n+        List<IidmChange> changes =  new ArrayList<>(changelog.getChangesForVariant(variant1));\n+        assertTrue(changes.size() > 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "834a2efbd25beea038ebdfc98c33b8158d685c29"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTgwMjMzMg==", "bodyText": "To test the right ordering, the list of changes should have multiple items.", "url": "https://github.com/powsybl/powsybl-core/pull/1098#discussion_r365802332", "createdAt": "2020-01-13T13:27:59Z", "author": {"login": "kaltakovae"}, "path": "cgmes/cgmes-conversion/src/test/java/com/powsybl/cgmes/conversion/test/update/ChangelogUpdateTest.java", "diffHunk": "@@ -104,6 +107,32 @@ public void testCloneVariantVariantSpecificChanges() {\n         assertTrue(changesVariant1b.size() == changesVariant1.size());\n     }\n \n+    @Test\n+    public void testChangesLogRightOrder() {\n+        String variant1 = network.getVariantManager().getWorkingVariantId();\n+        // Make changes, on Variant and base.\n+        makeNetworkChangesVariantSpecific(network);\n+        makeRemoveChanges(network);\n+        List<IidmChange> changes =  new ArrayList<>(changelog.getChangesForVariant(variant1));\n+        assertTrue(changes.size() > 1);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTI3MTIwNQ=="}, "originalCommit": {"oid": "834a2efbd25beea038ebdfc98c33b8158d685c29"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1NjQ2Nzk1OnYy", "diffSide": "RIGHT", "path": "cgmes/cgmes-conversion/src/test/java/com/powsybl/cgmes/conversion/test/update/ChangelogUpdateTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxNTo1MDoyMFrOFcYJKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxMzoyNToyNlrOFc2u4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTMwMDAwOQ==", "bodyText": "this method (and other utilitaries test methods) can be static", "url": "https://github.com/powsybl/powsybl-core/pull/1098#discussion_r365300009", "createdAt": "2020-01-10T15:50:20Z", "author": {"login": "miovd"}, "path": "cgmes/cgmes-conversion/src/test/java/com/powsybl/cgmes/conversion/test/update/ChangelogUpdateTest.java", "diffHunk": "@@ -123,6 +152,10 @@ private void makeNetworkChangesVariantSpecific(Network network) {\n         load.setP0(newP).setQ0(newQ).getTerminal().setP(newP).setQ(newQ);\n     }\n \n+    private void makeRemoveChanges(Network network) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "834a2efbd25beea038ebdfc98c33b8158d685c29"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTgwMTE4Ng==", "bodyText": "Done", "url": "https://github.com/powsybl/powsybl-core/pull/1098#discussion_r365801186", "createdAt": "2020-01-13T13:25:26Z", "author": {"login": "kaltakovae"}, "path": "cgmes/cgmes-conversion/src/test/java/com/powsybl/cgmes/conversion/test/update/ChangelogUpdateTest.java", "diffHunk": "@@ -123,6 +152,10 @@ private void makeNetworkChangesVariantSpecific(Network network) {\n         load.setP0(newP).setQ0(newQ).getTerminal().setP(newP).setQ(newQ);\n     }\n \n+    private void makeRemoveChanges(Network network) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTMwMDAwOQ=="}, "originalCommit": {"oid": "834a2efbd25beea038ebdfc98c33b8158d685c29"}, "originalPosition": 49}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 157, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}