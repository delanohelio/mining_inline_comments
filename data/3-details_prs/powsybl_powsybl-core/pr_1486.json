{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyOTAxNDIy", "number": 1486, "title": "[iAL] fix encoding", "bodyText": "Please check if the PR fulfills these requirements (please use '[x]' to check the checkboxes, or submit the PR and then click the checkboxes)\n\n The commit message follows our guidelines\n Tests for the changes have been added (for bug fixes / features)\n Docs have been added / updated (for bug fixes / features)\n\nDoes this PR already have an issue describing the problem ? If so, link to this issue using '#XXX' and skip the rest\n#1482\nWhat kind of change does this PR introduce? (Bug fix, feature, docs update, ...)\nWhat is the current behavior? (You can also link to an open issue here)\nWhat is the new behavior (if this is a feature change)?\nDoes this PR introduce a breaking change or deprecate an API? If yes, check the following:\n\n The Breaking Change or Deprecated label has been added\n The migration guide has been updated in the github wiki (What changes might users need to make in their application due to this PR?)\n\nOther information:\n(if any of the questions/checkboxes don't apply, please delete them entirely)", "createdAt": "2020-09-25T07:52:44Z", "url": "https://github.com/powsybl/powsybl-core/pull/1486", "merged": true, "mergeCommit": {"oid": "5009620c7ad13b5f36f8119cf09b6f0469f69f8d"}, "closed": true, "closedAt": "2020-10-09T08:24:27Z", "author": {"login": "yichen88"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMWOzAAFqTQ5NjM4MjI1Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQxoCNAH2gAyNDkyOTAxNDIyOmFjYmU5NjE1Mjg2NTIzYzgyYjgwYjhhM2NjMTlmNGJhMDQ4ZWJjMDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2MzgyMjUz", "url": "https://github.com/powsybl/powsybl-core/pull/1486#pullrequestreview-496382253", "createdAt": "2020-09-25T12:41:11Z", "commit": {"oid": "74e2c9f4d3274d571582d06343242069a5461fc6"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxMjo0MToxMVrOHYB9aQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxMzo1NTozM1rOHYEsNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk1OTk3Nw==", "bodyText": "I think for more flexibility we should use a more generic object here, like a Writer.\nActually, after more thoughts, I think to keep the best of both worlds we could use a PrintWriter here, which has the same methods as PrintStream for writing primitives/objects.\nThen we could propose 2 constructors, one based on a Writer, and one based on an OutputStream as today (both wrapping it into a PrintWriter).\nThen to create a String we will input a StringWriter indeed.\nWhat do you think about it ?", "url": "https://github.com/powsybl/powsybl-core/pull/1486#discussion_r494959977", "createdAt": "2020-09-25T12:41:11Z", "author": {"login": "sylvlecl"}, "path": "dsl/src/main/java/com/powsybl/dsl/ast/ExpressionPrinter.java", "diffHunk": "@@ -6,133 +6,136 @@\n  */\n package com.powsybl.dsl.ast;\n \n-import org.apache.commons.io.output.WriterOutputStream;\n-\n+import java.io.IOException;\n import java.io.PrintStream;\n import java.io.StringWriter;\n-import java.nio.charset.StandardCharsets;\n+import java.io.UncheckedIOException;\n import java.util.Objects;\n \n /**\n  * @author Geoffroy Jamgotchian <geoffroy.jamgotchian at rte-france.com>\n  */\n public class ExpressionPrinter extends DefaultExpressionVisitor<Void, Void> {\n \n-    protected final PrintStream out;\n+    protected final StringWriter out;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74e2c9f4d3274d571582d06343242069a5461fc6"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTAwNDcyNA==", "bodyText": "(Otherwise, strictly speaking, removing the constructor based on a PrintStream is a breaking change. No big issue, but we can avoid it :) )", "url": "https://github.com/powsybl/powsybl-core/pull/1486#discussion_r495004724", "createdAt": "2020-09-25T13:55:33Z", "author": {"login": "sylvlecl"}, "path": "dsl/src/main/java/com/powsybl/dsl/ast/ExpressionPrinter.java", "diffHunk": "@@ -6,133 +6,136 @@\n  */\n package com.powsybl.dsl.ast;\n \n-import org.apache.commons.io.output.WriterOutputStream;\n-\n+import java.io.IOException;\n import java.io.PrintStream;\n import java.io.StringWriter;\n-import java.nio.charset.StandardCharsets;\n+import java.io.UncheckedIOException;\n import java.util.Objects;\n \n /**\n  * @author Geoffroy Jamgotchian <geoffroy.jamgotchian at rte-france.com>\n  */\n public class ExpressionPrinter extends DefaultExpressionVisitor<Void, Void> {\n \n-    protected final PrintStream out;\n+    protected final StringWriter out;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk1OTk3Nw=="}, "originalCommit": {"oid": "74e2c9f4d3274d571582d06343242069a5461fc6"}, "originalPosition": 19}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "74e2c9f4d3274d571582d06343242069a5461fc6", "author": {"user": {"login": "yichen88", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/74e2c9f4d3274d571582d06343242069a5461fc6", "committedDate": "2020-09-24T14:39:56Z", "message": "Fix loadingRank print\n\nSigned-off-by: yichen88 <tang.yichenyves@gmail.com>"}, "afterCommit": {"oid": "d18bd6abd2a920d38a72f9665405c983c53f14c8", "author": {"user": {"login": "yichen88", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/d18bd6abd2a920d38a72f9665405c983c53f14c8", "committedDate": "2020-09-28T08:40:47Z", "message": "Fix expression printer.\n\nSigned-off-by: yichen88 <tang.yichenyves@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6b213fc075cbd6c6e452538f4bdafa3383281f48", "author": {"user": {"login": "yichen88", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/6b213fc075cbd6c6e452538f4bdafa3383281f48", "committedDate": "2020-09-28T09:12:20Z", "message": "Merge branch 'master' into fix-iAL-encoding"}, "afterCommit": {"oid": "8a5e15f5d86237cf3e816fe9502a99369becb103", "author": {"user": {"login": "yichen88", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/8a5e15f5d86237cf3e816fe9502a99369becb103", "committedDate": "2020-09-28T15:49:17Z", "message": "Fix expression printer.\n\nSigned-off-by: yichen88 <tang.yichenyves@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNzk3ODMy", "url": "https://github.com/powsybl/powsybl-core/pull/1486#pullrequestreview-501797832", "createdAt": "2020-10-05T07:50:36Z", "commit": {"oid": "8a5e15f5d86237cf3e816fe9502a99369becb103"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQwNzo1MDozNlrOHcRJNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQwNzo1MjozM1rOHcRNoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTQwMzA2Mg==", "bodyText": "Looking at the javadoc it's not clear to me why we could not have a constructor that takes an OutputStream instead of a PrintStream. That will make ExpressionPrinter and ActionExpressionPrinter more convenient to use as we just wrap the objects in a PrintWriter that seems to work well with a simple OutputStream.", "url": "https://github.com/powsybl/powsybl-core/pull/1486#discussion_r499403062", "createdAt": "2020-10-05T07:50:36Z", "author": {"login": "mathbagu"}, "path": "dsl/src/main/java/com/powsybl/dsl/ast/ExpressionPrinter.java", "diffHunk": "@@ -37,102 +33,110 @@ public static void print(ExpressionNode node, PrintStream out) {\n         node.accept(new ExpressionPrinter(out), null);\n     }\n \n+    private static void write(ExpressionNode node, StringWriter out) {\n+        node.accept(new ExpressionPrinter(out), null);\n+    }\n+\n     public ExpressionPrinter(PrintStream out) {\n-        this.out = Objects.requireNonNull(out);\n+        this.out = new PrintWriter(Objects.requireNonNull(out));\n+    }\n+\n+    public ExpressionPrinter(Writer writer) {\n+        out = new PrintWriter(Objects.requireNonNull(writer));\n     }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a5e15f5d86237cf3e816fe9502a99369becb103"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTQwNDE5Mg==", "bodyText": "Same question here: do we really need a StringWriter? It seems a Writer is sufficient here. You should change constructors of both classes to take the highest interface you can from the inheritance tree.", "url": "https://github.com/powsybl/powsybl-core/pull/1486#discussion_r499404192", "createdAt": "2020-10-05T07:52:33Z", "author": {"login": "mathbagu"}, "path": "action/action-dsl/src/main/java/com/powsybl/action/dsl/ast/ActionExpressionPrinter.java", "diffHunk": "@@ -21,20 +21,28 @@\n public class ActionExpressionPrinter extends ExpressionPrinter implements ActionExpressionVisitor<Void, Void> {\n \n     public static String toString(ExpressionNode node) {\n-        StringWriter writer = new StringWriter();\n-        try (PrintStream os = new PrintStream(new WriterOutputStream(writer, StandardCharsets.UTF_8))) {\n-            print(node, os);\n+        try (StringWriter writer = new StringWriter()) {\n+            write(node, writer);\n+            return writer.toString();\n+        } catch (IOException e) {\n+            throw new UncheckedIOException(e);\n         }\n+    }\n \n-        return writer.toString();\n+    private static void write(ExpressionNode node, StringWriter out) {\n+        node.accept(new ActionExpressionPrinter(out), null);\n     }\n \n     public static void print(ExpressionNode node) {\n         print(node, System.out);\n     }\n \n     public static void print(ExpressionNode node, PrintStream out) {\n-        node.accept(new ActionExpressionPrinter(out), null);\n+        out.print(toString(node));\n+    }\n+\n+    public ActionExpressionPrinter(StringWriter out) {\n+        super(out);\n     }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a5e15f5d86237cf3e816fe9502a99369becb103"}, "originalPosition": 45}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8a5e15f5d86237cf3e816fe9502a99369becb103", "author": {"user": {"login": "yichen88", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/8a5e15f5d86237cf3e816fe9502a99369becb103", "committedDate": "2020-09-28T15:49:17Z", "message": "Fix expression printer.\n\nSigned-off-by: yichen88 <tang.yichenyves@gmail.com>"}, "afterCommit": {"oid": "c0bfdd2f5f9f6252fc62f9da718286bd6f65d3fe", "author": {"user": {"login": "yichen88", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/c0bfdd2f5f9f6252fc62f9da718286bd6f65d3fe", "committedDate": "2020-10-06T08:27:57Z", "message": "Fix expression printer.\n\nSigned-off-by: yichen88 <tang.yichenyves@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyODYxNDE1", "url": "https://github.com/powsybl/powsybl-core/pull/1486#pullrequestreview-502861415", "createdAt": "2020-10-06T11:58:53Z", "commit": {"oid": "c0bfdd2f5f9f6252fc62f9da718286bd6f65d3fe"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a5d9c71ef40287d62b77a5c3d328e84ffc46f52", "author": {"user": {"login": "yichen88", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/0a5d9c71ef40287d62b77a5c3d328e84ffc46f52", "committedDate": "2020-10-08T12:51:35Z", "message": "Fix expression printer.\n\nSigned-off-by: yichen88 <tang.yichenyves@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c0bfdd2f5f9f6252fc62f9da718286bd6f65d3fe", "author": {"user": {"login": "yichen88", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/c0bfdd2f5f9f6252fc62f9da718286bd6f65d3fe", "committedDate": "2020-10-06T08:27:57Z", "message": "Fix expression printer.\n\nSigned-off-by: yichen88 <tang.yichenyves@gmail.com>"}, "afterCommit": {"oid": "0a5d9c71ef40287d62b77a5c3d328e84ffc46f52", "author": {"user": {"login": "yichen88", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/0a5d9c71ef40287d62b77a5c3d328e84ffc46f52", "committedDate": "2020-10-08T12:51:35Z", "message": "Fix expression printer.\n\nSigned-off-by: yichen88 <tang.yichenyves@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4062ef8642da83dfd278c15fe6864759373eb71c", "author": {"user": {"login": "mathbagu", "name": "Mathieu BAGUE"}}, "url": "https://github.com/powsybl/powsybl-core/commit/4062ef8642da83dfd278c15fe6864759373eb71c", "committedDate": "2020-10-08T16:00:09Z", "message": "Small fixes\n\nSigned-off-by: Mathieu BAGUE <mathieu.bague@rte-france.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a522680f75fef1dc403711ca613bdce7bf573ada", "author": {"user": {"login": "mathbagu", "name": "Mathieu BAGUE"}}, "url": "https://github.com/powsybl/powsybl-core/commit/a522680f75fef1dc403711ca613bdce7bf573ada", "committedDate": "2020-10-08T16:10:38Z", "message": "Merge branch 'master' into fix-iAL-encoding"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acbe9615286523c82b80b8a3cc19f4ba048ebc05", "author": {"user": {"login": "mathbagu", "name": "Mathieu BAGUE"}}, "url": "https://github.com/powsybl/powsybl-core/commit/acbe9615286523c82b80b8a3cc19f4ba048ebc05", "committedDate": "2020-10-09T08:09:06Z", "message": "Flush after writing\n\nSigned-off-by: Mathieu BAGUE <mathieu.bague@rte-france.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4199, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}