{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5NzI3OTAx", "number": 1263, "title": "merging inconsistent tie-line element names", "bodyText": "Signed-off-by: benrejebmoh mohamed.ben-rejeb@rte-france.com\nPlease check if the PR fulfills these requirements (please use '[x]' to check the checkboxes, or submit the PR and then click the checkboxes)\n\n The commit message follows our guidelines\n Tests for the changes have been added (for bug fixes / features)\n Docs have been added / updated (for bug fixes / features)\n\nDoes this PR already have an issue describing the problem ? If so, link to this issue using '#XXX' and skip the rest\nWhat kind of change does this PR introduce? (Bug fix, feature, docs update, ...)\nBug fix\nWhat is the current behavior? (You can also link to an open issue here)\nThe element name information is lost in UCTE export when the element names in two sides of tie-line are inconsistent\nbeTestGridForMerging:\nBBBBBB11 XXXXXX11 1 9 0.0000 0.2000 0.000000   5051 ABCDE\nfrTestGridForMerging:\nFFFFFF11 XXXXXX11 1 9 0.0000 0.2000 0.000000   5051 ZZZZZ\ncurrent behavior: merged file uxTestGridForMerging:\n##L\nBBBBBB11 XXXXXX11 1 9 0.0000 0.2000 0.000000   5051\nFFFFFF11 XXXXXX11 1 9 0.0000 0.2000 0.000000   5051\nWhat is the new behavior (if this is a feature change)?\nnew behavior: merged file uxTestGridForMerging:\nwe keep the original properties of each tieline , post-fixing the name of the properties with _1 or _2\nwhen creating danglinglines.\nin UCTE export for geographical name we use the merged properties but for element name we use the original tieline element name propertiies suffixed with _1 and _2\nThe result for the use case above will be:\n##L\nBBBBBB11 XXXXXX11 1 9 0.0000 0.2000 0.000000   5051 ABCDE\nFFFFFF11 XXXXXX11 1 9 0.0000 0.2000 0.000000   5051 ZZZZZ\nDoes this PR introduce a breaking change or deprecate an API? If yes, check the following:\n\n The Breaking Change or Deprecated label has been added\n The migration guide has been updated in the github wiki (What changes might users need to make in their application due to this PR?)\n\nOther information:\n(if any of the questions/checkboxes don't apply, please delete them entirely)", "createdAt": "2020-04-06T15:31:23Z", "url": "https://github.com/powsybl/powsybl-core/pull/1263", "merged": true, "mergeCommit": {"oid": "5ed6859d2ec1a35172afe1d716f6af6d70eddd38"}, "closed": true, "closedAt": "2020-04-27T09:02:21Z", "author": {"login": "benrejebmoh"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVAcV9gH2gAyMzk5NzI3OTAxOmQzZTZiMjNjNDE3YjUxYmYxZWE2YzZiODVkYTFlMDYzNDE2Yjg0ZDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcbrPjygH2gAyMzk5NzI3OTAxOmVhY2JjMjA1M2JhYjk4NmY2Njg1MmQ1ODUwZjIyNjA5MjdjZjExYzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d3e6b23c417b51bf1ea6c6b85da1e063416b84d9", "author": {"user": {"login": "benrejebmoh", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/d3e6b23c417b51bf1ea6c6b85da1e063416b84d9", "committedDate": "2020-04-06T15:29:27Z", "message": "merging inconsistent tie-line element names\n\nSigned-off-by: benrejebmoh <mohamed.ben-rejeb@rte-france.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4OTEwMTQ5", "url": "https://github.com/powsybl/powsybl-core/pull/1263#pullrequestreview-388910149", "createdAt": "2020-04-07T08:47:17Z", "commit": {"oid": "d3e6b23c417b51bf1ea6c6b85da1e063416b84d9"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwODo0NzoxN1rOGB5X0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwODo1MDo1MFrOGB5gcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY0MTc0Ng==", "bodyText": "Replace String.format by a simple concatenation (performance issue)", "url": "https://github.com/powsybl/powsybl-core/pull/1263#discussion_r404641746", "createdAt": "2020-04-07T08:47:17Z", "author": {"login": "mathbagu"}, "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/NetworkImpl.java", "diffHunk": "@@ -1013,7 +1015,11 @@ private void mergeProperties(DanglingLine dl1, DanglingLine dl2, Properties prop\n                 LOGGER.warn(\"Inconsistencies of property '{}' between both sides of merged line. Side 2 is empty, keeping side 1 value '{}'\", prop, dl1.getProperty(prop));\n                 properties.setProperty(prop, dl1.getProperty(prop));\n             } else {\n-                LOGGER.error(\"Inconsistencies of property '{}' between both sides of merged line. '{}' on side 1 and '{}' on side 2. Removing the property of merged line\", prop, dl1.getProperty(prop), dl2.getProperty(prop));\n+                if (!prop.equals(ELEMENT_NAME_PROPERTY)) {\n+                    LOGGER.error(\"Inconsistencies of property '{}' between both sides of merged line. '{}' on side 1 and '{}' on side 2. Removing the property of merged line\", prop, dl1.getProperty(prop), dl2.getProperty(prop));\n+                } else {\n+                    properties.setProperty(prop, String.format(\"%s,%s\", dl1.getProperty(prop), dl2.getProperty(prop)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3e6b23c417b51bf1ea6c6b85da1e063416b84d9"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY0MzI2OQ==", "bodyText": "I'm not sure we should make a specific case for element names. Maybe we should decide the strategy, and apply it to all properties.\n@murgeyseb What do you think?", "url": "https://github.com/powsybl/powsybl-core/pull/1263#discussion_r404643269", "createdAt": "2020-04-07T08:49:42Z", "author": {"login": "mathbagu"}, "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/NetworkImpl.java", "diffHunk": "@@ -1013,7 +1015,11 @@ private void mergeProperties(DanglingLine dl1, DanglingLine dl2, Properties prop\n                 LOGGER.warn(\"Inconsistencies of property '{}' between both sides of merged line. Side 2 is empty, keeping side 1 value '{}'\", prop, dl1.getProperty(prop));\n                 properties.setProperty(prop, dl1.getProperty(prop));\n             } else {\n-                LOGGER.error(\"Inconsistencies of property '{}' between both sides of merged line. '{}' on side 1 and '{}' on side 2. Removing the property of merged line\", prop, dl1.getProperty(prop), dl2.getProperty(prop));\n+                if (!prop.equals(ELEMENT_NAME_PROPERTY)) {\n+                    LOGGER.error(\"Inconsistencies of property '{}' between both sides of merged line. '{}' on side 1 and '{}' on side 2. Removing the property of merged line\", prop, dl1.getProperty(prop), dl2.getProperty(prop));\n+                } else {\n+                    properties.setProperty(prop, String.format(\"%s,%s\", dl1.getProperty(prop), dl2.getProperty(prop)));\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3e6b23c417b51bf1ea6c6b85da1e063416b84d9"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY0Mzk1Mg==", "bodyText": "The property separator should be a constant, just in case this is not well chosen and we have to change it.", "url": "https://github.com/powsybl/powsybl-core/pull/1263#discussion_r404643952", "createdAt": "2020-04-07T08:50:50Z", "author": {"login": "mathbagu"}, "path": "ucte/ucte-converter/src/main/java/com/powsybl/ucte/converter/UcteExporter.java", "diffHunk": "@@ -475,10 +475,17 @@ private static void convertTieLine(UcteNetwork ucteNetwork, TieLine tieLine, Uct\n         // FIXME(mathbagu) REAL or EQUIVALENT ?\n         UcteElementStatus status = tieLine.getTerminal1().isConnected() && tieLine.getTerminal2().isConnected() ? EQUIVALENT_ELEMENT_IN_OPERATION : EQUIVALENT_ELEMENT_OUT_OF_OPERATION;\n \n+        String elementName = tieLine.getProperty(ELEMENT_NAME_PROPERTY_KEY, null);\n+        String elementName1 = elementName;\n+        String elementName2 = elementName;\n+        if (elementName != null && elementName.contains(\",\")) {\n+            elementName1 = elementName.split(\",\")[0];\n+            elementName2 = elementName.split(\",\")[1];\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3e6b23c417b51bf1ea6c6b85da1e063416b84d9"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68be4dbfdffc24aa5ae21dee029486b7b46ac0be", "author": {"user": {"login": "benrejebmoh", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/68be4dbfdffc24aa5ae21dee029486b7b46ac0be", "committedDate": "2020-04-07T13:21:09Z", "message": "using properties separator as constant and changing String.format by simple concatenation\n\nSigned-off-by: benrejebmoh <mohamed.ben-rejeb@rte-france.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2d059e1a6808e72c8106854eff4807b4aaa7894", "author": {"user": {"login": "benrejebmoh", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/a2d059e1a6808e72c8106854eff4807b4aaa7894", "committedDate": "2020-04-10T15:20:07Z", "message": "changing strategy of mergingProperties\n\nSigned-off-by: benrejebmoh <mohamed.ben-rejeb@rte-france.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c55d37758cb8260e23bc24ae48a3dfb9a268165", "author": {"user": {"login": "benrejebmoh", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/8c55d37758cb8260e23bc24ae48a3dfb9a268165", "committedDate": "2020-04-10T15:36:58Z", "message": "Merge branch 'master' into tieline-element-name\n\n# Conflicts:\n#\tiidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/NetworkImpl.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMTE2ODM2", "url": "https://github.com/powsybl/powsybl-core/pull/1263#pullrequestreview-393116836", "createdAt": "2020-04-14T16:53:28Z", "commit": {"oid": "8c55d37758cb8260e23bc24ae48a3dfb9a268165"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e93bcbea4a600cdc13028b64bf81242a2ae0802", "author": {"user": {"login": "benrejebmoh", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/7e93bcbea4a600cdc13028b64bf81242a2ae0802", "committedDate": "2020-04-15T08:42:44Z", "message": "merging inconsistent tie-line element names\n\nSigned-off-by: benrejebmoh <mohamed.ben-rejeb@rte-france.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abbd36291a19f83174edc5a051d96be49e4909f0", "author": {"user": {"login": "benrejebmoh", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/abbd36291a19f83174edc5a051d96be49e4909f0", "committedDate": "2020-04-15T08:44:29Z", "message": "changing strategy of mergingProperties\n\nSigned-off-by: benrejebmoh <mohamed.ben-rejeb@rte-france.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09c8428d5bacadb613df1d0b69a5b0ca69d03459", "author": {"user": {"login": "benrejebmoh", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/09c8428d5bacadb613df1d0b69a5b0ca69d03459", "committedDate": "2020-04-15T08:56:30Z", "message": "Revert \"changing strategy of mergingProperties\"\n\nThis reverts commit abbd3629\n\nSigned-off-by: benrejebmoh <mohamed.ben-rejeb@rte-france.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f55f9a636fa27160a97452d130ff5b72548d488a", "author": {"user": {"login": "benrejebmoh", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/f55f9a636fa27160a97452d130ff5b72548d488a", "committedDate": "2020-04-15T18:46:28Z", "message": "changing strategy of mergingProperties after review\n\nSigned-off-by: benrejebmoh <mohamed.ben-rejeb@rte-france.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb4bdf1665a42eea6d8a544ea193c81e86f2ba9b", "author": {"user": {"login": "benrejebmoh", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/bb4bdf1665a42eea6d8a544ea193c81e86f2ba9b", "committedDate": "2020-04-15T19:23:25Z", "message": "removing null default value when getting geographical name property\n\nSigned-off-by: benrejebmoh <mohamed.ben-rejeb@rte-france.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MjE5NzI0", "url": "https://github.com/powsybl/powsybl-core/pull/1263#pullrequestreview-395219724", "createdAt": "2020-04-17T07:25:23Z", "commit": {"oid": "bb4bdf1665a42eea6d8a544ea193c81e86f2ba9b"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QwNzo0Nzo1MVrOGHDgdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QwODowMzowN1rOGHD-kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDA1MDY3OQ==", "bodyText": "Could you please complete the description of the PR and adapt the unit-test, to be sure this fix works properly. In the description, you mention you want to change the elementName of the tieLines, but you never mention the geographical name of the XNode.", "url": "https://github.com/powsybl/powsybl-core/pull/1263#discussion_r410050679", "createdAt": "2020-04-17T07:47:51Z", "author": {"login": "mathbagu"}, "path": "ucte/ucte-converter/src/main/java/com/powsybl/ucte/converter/UcteExporter.java", "diffHunk": "@@ -307,8 +309,8 @@ private static void convertXNode(UcteNetwork ucteNetwork, MergedXnode mergedXnod\n      */\n     private static void convertXNode(UcteNetwork ucteNetwork, TieLine tieLine, UcteExporterContext context) {\n         UcteNodeCode xnodeCode = context.getNamingStrategy().getUcteNodeCode(tieLine.getUcteXnodeCode());\n+        mergeGeographicalNameProperties(tieLine);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb4bdf1665a42eea6d8a544ea193c81e86f2ba9b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDA1ODM4Ng==", "bodyText": "This is not necessary: empty is a good enough to be serialized.", "url": "https://github.com/powsybl/powsybl-core/pull/1263#discussion_r410058386", "createdAt": "2020-04-17T08:03:07Z", "author": {"login": "mathbagu"}, "path": "ucte/ucte-converter/src/main/java/com/powsybl/ucte/converter/UcteExporter.java", "diffHunk": "@@ -478,10 +502,23 @@ private static void convertTieLine(UcteNetwork ucteNetwork, TieLine tieLine, Uct\n         // FIXME(mathbagu) REAL or EQUIVALENT ?\n         UcteElementStatus status = tieLine.getTerminal1().isConnected() && tieLine.getTerminal2().isConnected() ? EQUIVALENT_ELEMENT_IN_OPERATION : EQUIVALENT_ELEMENT_OUT_OF_OPERATION;\n \n+        String elementName = tieLine.getProperty(ELEMENT_NAME_PROPERTY_KEY, null);\n+        String elementName1 = elementName;\n+        String elementName2 = elementName;\n+        if (elementName != null && elementName.contains(PROPERTY_SEPARATOR)) {\n+            elementName1 = elementName.split(PROPERTY_SEPARATOR, -1)[0];\n+            if (elementName1.isEmpty()) {\n+                elementName1 = null;\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb4bdf1665a42eea6d8a544ea193c81e86f2ba9b"}, "originalPosition": 59}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "623469370990ae6b698e577f633e1c43fb2049c9", "author": {"user": {"login": "benrejebmoh", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/623469370990ae6b698e577f633e1c43fb2049c9", "committedDate": "2020-04-21T11:18:08Z", "message": "Merge branch 'master' into tieline-element-name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd8099900989d4eb17b5e86e2c407f612520b3d6", "author": {"user": {"login": "benrejebmoh", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/bd8099900989d4eb17b5e86e2c407f612520b3d6", "committedDate": "2020-04-21T15:59:20Z", "message": "adding tieline properties with suffix to be usied in ucte export, and adding test case illustration possible use cases\n\nSigned-off-by: benrejebmoh <mohamed.ben-rejeb@rte-france.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3OTgyOTM2", "url": "https://github.com/powsybl/powsybl-core/pull/1263#pullrequestreview-397982936", "createdAt": "2020-04-22T08:56:27Z", "commit": {"oid": "bd8099900989d4eb17b5e86e2c407f612520b3d6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4OTMxMjMw", "url": "https://github.com/powsybl/powsybl-core/pull/1263#pullrequestreview-398931230", "createdAt": "2020-04-23T09:40:53Z", "commit": {"oid": "bd8099900989d4eb17b5e86e2c407f612520b3d6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "370163b9d2eb23e9cdf02c13aabb047427538753", "author": {"user": {"login": "mathbagu", "name": "Mathieu BAGUE"}}, "url": "https://github.com/powsybl/powsybl-core/commit/370163b9d2eb23e9cdf02c13aabb047427538753", "committedDate": "2020-04-23T13:59:46Z", "message": "Merge branch 'master' into tieline-element-name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "715bc3dff87e4243a650e61dc3f30af6b9b84a41", "author": {"user": {"login": "MioRtia", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/715bc3dff87e4243a650e61dc3f30af6b9b84a41", "committedDate": "2020-04-23T14:44:05Z", "message": "Merge branch 'master' into tieline-element-name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eacbc2053bab986f66852d5850f2260927cf11c2", "author": {"user": {"login": "mathbagu", "name": "Mathieu BAGUE"}}, "url": "https://github.com/powsybl/powsybl-core/commit/eacbc2053bab986f66852d5850f2260927cf11c2", "committedDate": "2020-04-27T08:44:57Z", "message": "Merge branch 'master' into tieline-element-name"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4222, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}