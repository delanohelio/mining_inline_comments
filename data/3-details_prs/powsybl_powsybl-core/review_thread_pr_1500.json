{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3MDMxMzg2", "number": 1500, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMzoxOTozNVrOEvTztQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMzoxOTozNVrOEvTztQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4MDQzMDYxOnYy", "diffSide": "RIGHT", "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/elements/ACLineSegmentConversion.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMzoxOTozNVrOHkN5wA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwODo1MDo1MVrOHlhNCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzczODU2MA==", "bodyText": "Thanks @zamarrenolm, it works well with a conversion into a switch when wa are inside the same voltage level. But I wonder if we should prefer an internal connexion to a swicth. The next step could be to make our internal connexion identifiable. @mathbagu seems to prefer an internal connection to preserve graph analysis.", "url": "https://github.com/powsybl/powsybl-core/pull/1500#discussion_r507738560", "createdAt": "2020-10-19T13:19:35Z", "author": {"login": "annetill"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/elements/ACLineSegmentConversion.java", "diffHunk": "@@ -71,19 +69,46 @@ private void convertLine() {\n         double x = p.asDouble(\"x\");\n         double bch = p.asDouble(\"bch\");\n         double gch = p.asDouble(\"gch\", 0.0);\n-        final LineAdder adder = context.network().newLine()\n-                .setEnsureIdUnicity(false)\n-                .setR(r)\n-                .setX(x)\n-                .setG1(gch / 2)\n-                .setG2(gch / 2)\n-                .setB1(bch / 2)\n-                .setB2(bch / 2);\n-        identify(adder);\n-        connect(adder);\n-        final Line l = adder.add();\n-        addAliases(l);\n-        convertedTerminals(l.getTerminal1(), l.getTerminal2());\n+        if (isZeroImpedanceInsideVoltageLevel(r, x, bch, gch)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69bf0ba9c2450249bd0f7ea48e85b5533ea55cab"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc3MTk2NQ==", "bodyText": "You are right, the fictitious breaker allows to  preserve the id of the original equipment (for an internal connection we can not have identifiers or aliases).\nBut there is another reason: an internal connection is always closed, it can not be created and declared opened. The corresponding ACLineSegment from CGMES could be opened (at one end or both), it is easier to map it to IIDM as an opened fictitious switch.", "url": "https://github.com/powsybl/powsybl-core/pull/1500#discussion_r507771965", "createdAt": "2020-10-19T14:01:46Z", "author": {"login": "zamarrenolm"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/elements/ACLineSegmentConversion.java", "diffHunk": "@@ -71,19 +69,46 @@ private void convertLine() {\n         double x = p.asDouble(\"x\");\n         double bch = p.asDouble(\"bch\");\n         double gch = p.asDouble(\"gch\", 0.0);\n-        final LineAdder adder = context.network().newLine()\n-                .setEnsureIdUnicity(false)\n-                .setR(r)\n-                .setX(x)\n-                .setG1(gch / 2)\n-                .setG2(gch / 2)\n-                .setB1(bch / 2)\n-                .setB2(bch / 2);\n-        identify(adder);\n-        connect(adder);\n-        final Line l = adder.add();\n-        addAliases(l);\n-        convertedTerminals(l.getTerminal1(), l.getTerminal2());\n+        if (isZeroImpedanceInsideVoltageLevel(r, x, bch, gch)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzczODU2MA=="}, "originalCommit": {"oid": "69bf0ba9c2450249bd0f7ea48e85b5533ea55cab"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTAzNjAyOQ==", "bodyText": "The problem we see is that this interconnector has already 2 switches connected at each side. So, with our solution, we will have 3 switches. With an internal connection, we can open it at each side by opening the switch. It works in a node/breaker topology but what about the bus/breaker topology ?", "url": "https://github.com/powsybl/powsybl-core/pull/1500#discussion_r509036029", "createdAt": "2020-10-21T07:04:55Z", "author": {"login": "annetill"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/elements/ACLineSegmentConversion.java", "diffHunk": "@@ -71,19 +69,46 @@ private void convertLine() {\n         double x = p.asDouble(\"x\");\n         double bch = p.asDouble(\"bch\");\n         double gch = p.asDouble(\"gch\", 0.0);\n-        final LineAdder adder = context.network().newLine()\n-                .setEnsureIdUnicity(false)\n-                .setR(r)\n-                .setX(x)\n-                .setG1(gch / 2)\n-                .setG2(gch / 2)\n-                .setB1(bch / 2)\n-                .setB2(bch / 2);\n-        identify(adder);\n-        connect(adder);\n-        final Line l = adder.add();\n-        addAliases(l);\n-        convertedTerminals(l.getTerminal1(), l.getTerminal2());\n+        if (isZeroImpedanceInsideVoltageLevel(r, x, bch, gch)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzczODU2MA=="}, "originalCommit": {"oid": "69bf0ba9c2450249bd0f7ea48e85b5533ea55cab"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTEwMzM2OQ==", "bodyText": "In CGMES, even if the switches are closed, the ACLineSegment could be seen as opened because its terminals could have the connected attribute set to false. If we use an internal connection we lose that possibility.\nHaving three switches sequentially should not be a problem for topology calculations at bus-breaker level, and at bus-view all three will be hidden if they are not declared as retained.", "url": "https://github.com/powsybl/powsybl-core/pull/1500#discussion_r509103369", "createdAt": "2020-10-21T08:50:51Z", "author": {"login": "zamarrenolm"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/elements/ACLineSegmentConversion.java", "diffHunk": "@@ -71,19 +69,46 @@ private void convertLine() {\n         double x = p.asDouble(\"x\");\n         double bch = p.asDouble(\"bch\");\n         double gch = p.asDouble(\"gch\", 0.0);\n-        final LineAdder adder = context.network().newLine()\n-                .setEnsureIdUnicity(false)\n-                .setR(r)\n-                .setX(x)\n-                .setG1(gch / 2)\n-                .setG2(gch / 2)\n-                .setB1(bch / 2)\n-                .setB2(bch / 2);\n-        identify(adder);\n-        connect(adder);\n-        final Line l = adder.add();\n-        addAliases(l);\n-        convertedTerminals(l.getTerminal1(), l.getTerminal2());\n+        if (isZeroImpedanceInsideVoltageLevel(r, x, bch, gch)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzczODU2MA=="}, "originalCommit": {"oid": "69bf0ba9c2450249bd0f7ea48e85b5533ea55cab"}, "originalPosition": 32}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4889, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}