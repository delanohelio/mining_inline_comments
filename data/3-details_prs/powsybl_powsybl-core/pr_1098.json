{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4NjkyODU3", "number": 1098, "title": "Cgmes update simple update chlog index", "bodyText": "Please check if the PR fulfills these requirements (please use '[x]' to check the checkboxes, or submit the PR and then click the checkboxes)\n\n The commit message follows our guidelines\n Tests for the changes have been added (for bug fixes / features)\n Docs have been added / updated (for bug fixes / features)\n\nWhat kind of change does this PR introduce? (Bug fix, feature, docs update, ...)\nBug fix\nWhat is the current behavior? (You can also link to an open issue here)\nThe Changelog is not ordered: base changes are placed before variant specific changes.\nWhat is the new behavior (if this is a feature change)?\nThis feature implements sequential indexing of network Changelog, according to the order they have been made.\nTo verify the ordering functionality the unit test does the following:\n\nmake variant specific changes\nmake base changes\ncheck the order", "createdAt": "2020-01-02T15:18:17Z", "url": "https://github.com/powsybl/powsybl-core/pull/1098", "merged": true, "mergeCommit": {"oid": "6a9bd09d7da5540fa94f377e6f671d7a341aa7b0"}, "closed": true, "closedAt": "2020-01-13T14:08:20Z", "author": {"login": "kaltakovae"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb2az6-gH2gAyMzU4NjkyODU3OjM5ZjZlMjdlOTA2NTExYzdlZjNjNTgwNTEwM2MzYzY1NDMyMDAyMWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb586MogFqTM0MTg2NTY5Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "39f6e27e906511c7ef3c5805103c3c654320021c", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/39f6e27e906511c7ef3c5805103c3c654320021c", "committedDate": "2020-01-02T14:41:05Z", "message": "Add test for changes log right order\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "834a2efbd25beea038ebdfc98c33b8158d685c29", "author": {"user": {"login": "zamarrenolm", "name": "Luma"}}, "url": "https://github.com/powsybl/powsybl-core/commit/834a2efbd25beea038ebdfc98c33b8158d685c29", "committedDate": "2020-01-02T15:00:56Z", "message": "simplify verification that a list of changes is sorted\n\nSigned-off-by: Luma Zamarren\u0303o <zamarrenolm@aia.es>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4MTQ5NDg1", "url": "https://github.com/powsybl/powsybl-core/pull/1098#pullrequestreview-338149485", "createdAt": "2020-01-03T16:04:35Z", "commit": {"oid": "834a2efbd25beea038ebdfc98c33b8158d685c29"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxMjA5MTg2", "url": "https://github.com/powsybl/powsybl-core/pull/1098#pullrequestreview-341209186", "createdAt": "2020-01-10T14:48:50Z", "commit": {"oid": "834a2efbd25beea038ebdfc98c33b8158d685c29"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxNDo0ODo1MFrOFcWPKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxNDo1Mzo1NVrOFcWYpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTI2ODc3OA==", "bodyText": "If the order is important, maybe we should use a TreeSet, with a comparator on the index?", "url": "https://github.com/powsybl/powsybl-core/pull/1098#discussion_r365268778", "createdAt": "2020-01-10T14:48:50Z", "author": {"login": "mathbagu"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/Changelog.java", "diffHunk": "@@ -80,11 +81,13 @@ public void onVariantCreated(String sourceVariantId, String targetVariantId) {\n \n     public List<IidmChange> getChangesForVariant(String variantId) {\n         if (!changesByVariant.containsKey(variantId)) {\n+            // If we only have baseChanges we assume they are already ordered\n             return Collections.unmodifiableList(baseChanges);\n         } else {\n             List<IidmChange> cs = new ArrayList<>(baseChanges.size() + changesByVariant.size());\n             cs.addAll(baseChanges);\n             cs.addAll(changesByVariant.get(variantId));\n+            cs.sort(Comparator.comparing(IidmChange::getIndex));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "834a2efbd25beea038ebdfc98c33b8158d685c29"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTI2ODk3Mw==", "bodyText": "Should be declared as final", "url": "https://github.com/powsybl/powsybl-core/pull/1098#discussion_r365268973", "createdAt": "2020-01-10T14:49:14Z", "author": {"login": "mathbagu"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/IidmChange.java", "diffHunk": "@@ -18,11 +19,18 @@\n \n     public IidmChange(Identifiable identifiable) {\n         this.identifiable = Objects.requireNonNull(identifiable);\n+        this.index = counter.getAndIncrement();\n     }\n \n     public Identifiable getIdentifiable() {\n         return identifiable;\n     }\n \n+    public int getIndex() {\n+        return index;\n+    }\n+\n     private final Identifiable identifiable;\n+    private final int index;\n+    private static AtomicInteger counter = new AtomicInteger();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "834a2efbd25beea038ebdfc98c33b8158d685c29"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTI3MDg3NA==", "bodyText": "Use a stream: it's more modern:\nreturn changes.stream().filter(IidmChangeRemoval.class::isInstance).collect(Collectors.toList());", "url": "https://github.com/powsybl/powsybl-core/pull/1098#discussion_r365270874", "createdAt": "2020-01-10T14:53:11Z", "author": {"login": "mathbagu"}, "path": "cgmes/cgmes-conversion/src/test/java/com/powsybl/cgmes/conversion/test/update/ChangelogCreationRemovalTest.java", "diffHunk": "@@ -85,15 +86,15 @@ public void testChangelogRemove() {\n         return actual;\n     }\n \n-    private int sizeIgnoreUpdateOnRemoval(List<IidmChange> changes) {\n-        int count = 0;\n+    private List<IidmChange> ignoreUpdateOnRemoval(List<IidmChange> changes) {\n+        List<IidmChange> list = new ArrayList<>();\n         for (IidmChange i : changes) {\n             if (!(i instanceof IidmChangeRemoval)) {\n                 continue;\n             }\n-            count++;\n+            list.add(i);\n         }\n-        return count;\n+        return list;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "834a2efbd25beea038ebdfc98c33b8158d685c29"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTI3MTIwNQ==", "bodyText": "Do you wan simply to check if the list is empty?", "url": "https://github.com/powsybl/powsybl-core/pull/1098#discussion_r365271205", "createdAt": "2020-01-10T14:53:55Z", "author": {"login": "mathbagu"}, "path": "cgmes/cgmes-conversion/src/test/java/com/powsybl/cgmes/conversion/test/update/ChangelogUpdateTest.java", "diffHunk": "@@ -104,6 +107,32 @@ public void testCloneVariantVariantSpecificChanges() {\n         assertTrue(changesVariant1b.size() == changesVariant1.size());\n     }\n \n+    @Test\n+    public void testChangesLogRightOrder() {\n+        String variant1 = network.getVariantManager().getWorkingVariantId();\n+        // Make changes, on Variant and base.\n+        makeNetworkChangesVariantSpecific(network);\n+        makeRemoveChanges(network);\n+        List<IidmChange> changes =  new ArrayList<>(changelog.getChangesForVariant(variant1));\n+        assertTrue(changes.size() > 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "834a2efbd25beea038ebdfc98c33b8158d685c29"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxMjUxNTU5", "url": "https://github.com/powsybl/powsybl-core/pull/1098#pullrequestreview-341251559", "createdAt": "2020-01-10T15:50:20Z", "commit": {"oid": "834a2efbd25beea038ebdfc98c33b8158d685c29"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxNTo1MDoyMFrOFcYJKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxNTo1MDoyMFrOFcYJKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTMwMDAwOQ==", "bodyText": "this method (and other utilitaries test methods) can be static", "url": "https://github.com/powsybl/powsybl-core/pull/1098#discussion_r365300009", "createdAt": "2020-01-10T15:50:20Z", "author": {"login": "MioRtia"}, "path": "cgmes/cgmes-conversion/src/test/java/com/powsybl/cgmes/conversion/test/update/ChangelogUpdateTest.java", "diffHunk": "@@ -123,6 +152,10 @@ private void makeNetworkChangesVariantSpecific(Network network) {\n         load.setP0(newP).setQ0(newQ).getTerminal().setP(newP).setQ(newQ);\n     }\n \n+    private void makeRemoveChanges(Network network) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "834a2efbd25beea038ebdfc98c33b8158d685c29"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f43a03a79e7b691b9a73992989a7a6fce593f21", "author": {"user": {"login": "zamarrenolm", "name": "Luma"}}, "url": "https://github.com/powsybl/powsybl-core/commit/2f43a03a79e7b691b9a73992989a7a6fce593f21", "committedDate": "2020-01-13T00:21:04Z", "message": "Merge branch 'master' into cgmes_update_simple_update_chlog_index"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63713be0781bf98813b267be33a1a06fcef845f6", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/63713be0781bf98813b267be33a1a06fcef845f6", "committedDate": "2020-01-13T10:02:52Z", "message": "Merge branch 'master' into cgmes_update_simple_update_chlog_index\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8243523916c8e962e39e2b0e0490a020a02a8a8e", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/8243523916c8e962e39e2b0e0490a020a02a8a8e", "committedDate": "2020-01-13T13:20:08Z", "message": "Pull request fixes: use TreeSet with a comparator on the index; use stream; set utilitaries methods as static where possible\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8c5a535989230cc711a6fc843ccf83529b005e4", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/b8c5a535989230cc711a6fc843ccf83529b005e4", "committedDate": "2020-01-13T13:23:21Z", "message": "Merge branch 'cgmes_update_simple_update_chlog_index' of https://github.com/powsybl/powsybl-core into cgmes_update_simple_update_chlog_index"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd45f61515bcc9196ad5540d17400ebee4de89f0", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/bd45f61515bcc9196ad5540d17400ebee4de89f0", "committedDate": "2020-01-13T13:55:56Z", "message": "fix Code Smell found by Sonarcloud\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxODY1Njk3", "url": "https://github.com/powsybl/powsybl-core/pull/1098#pullrequestreview-341865697", "createdAt": "2020-01-13T14:06:29Z", "commit": {"oid": "bd45f61515bcc9196ad5540d17400ebee4de89f0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4514, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}