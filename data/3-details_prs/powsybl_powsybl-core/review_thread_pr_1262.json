{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5NTgzNzU0", "number": 1262, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQyMjowNDo1MVrODvUn4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwODo1NDozMlrODvdskg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwOTQ3NTUzOnYy", "diffSide": "RIGHT", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ValidationUtil.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQyMjowNDo1MVrOGBroYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwNjo0Njo0NlrOGB1IXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQxNjYxMQ==", "bodyText": "The power factor is defined as the ratio of the active power to the apparent power\npowerFactor = P/ Math.hypot(P, Q)\nso the powerFactor is a number in the closed interval [-1,1], -1 <= powerFactor <= 1", "url": "https://github.com/powsybl/powsybl-core/pull/1262#discussion_r404416611", "createdAt": "2020-04-06T22:04:51Z", "author": {"login": "marqueslanauja"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ValidationUtil.java", "diffHunk": "@@ -365,6 +381,8 @@ public static void checkConvertersMode(Validable validable, HvdcLine.ConvertersM\n     public static void checkPowerFactor(Validable validable, double powerFactor) {\n         if (Double.isNaN(powerFactor)) {\n             throw new ValidationException(validable, \"power factor is invalid\");\n+        } else if (Math.abs(powerFactor) > 3) {\n+            throw new ValidationException(validable, \"power factor is invalid, it should be a ratio\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14ebade6a134d5e4defc48c971a156f635bd0542"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDU3MjI1NQ==", "bodyText": "Nice thanks, I was not sure about the hupper limit. If it is 1, it is really easiest ! I am going to change the PR.", "url": "https://github.com/powsybl/powsybl-core/pull/1262#discussion_r404572255", "createdAt": "2020-04-07T06:46:46Z", "author": {"login": "annetill"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ValidationUtil.java", "diffHunk": "@@ -365,6 +381,8 @@ public static void checkConvertersMode(Validable validable, HvdcLine.ConvertersM\n     public static void checkPowerFactor(Validable validable, double powerFactor) {\n         if (Double.isNaN(powerFactor)) {\n             throw new ValidationException(validable, \"power factor is invalid\");\n+        } else if (Math.abs(powerFactor) > 3) {\n+            throw new ValidationException(validable, \"power factor is invalid, it should be a ratio\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQxNjYxMQ=="}, "originalCommit": {"oid": "14ebade6a134d5e4defc48c971a156f635bd0542"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwOTQ4Mzc0OnYy", "diffSide": "RIGHT", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ValidationUtil.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQyMjowNzo0NVrOGBrtcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwOTo0MTo1NVrOGB7ezA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQxNzkwNw==", "bodyText": "The lossFactor is defined and calculated as a percentage, so 0 <= lossFactor <= 100", "url": "https://github.com/powsybl/powsybl-core/pull/1262#discussion_r404417907", "createdAt": "2020-04-06T22:07:45Z", "author": {"login": "marqueslanauja"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ValidationUtil.java", "diffHunk": "@@ -385,6 +403,8 @@ public static void checkLossFactor(Validable validable, float lossFactor) {\n             throw new ValidationException(validable, \"loss factor is invalid\");\n         } else if (lossFactor < 0) {\n             throw new ValidationException(validable, \"loss factor must be >= 0\");\n+        } else if (lossFactor > 3) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14ebade6a134d5e4defc48c971a156f635bd0542"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDU3MzU0OQ==", "bodyText": "In fact, I ask @mathbagu and @geofjamg and I have checked in some private parts and the lossFactoris not a percentage, it is a ratio. So:\n\nWhat is the hupper limit for you ? 1 or more (a ratio could be greater than 1, as a percentage can be greater than 100) ?\nYou have to fix your PR about the CGMES conversion of HVDC (sorry for that) because the web site documentation is wrong.", "url": "https://github.com/powsybl/powsybl-core/pull/1262#discussion_r404573549", "createdAt": "2020-04-07T06:49:47Z", "author": {"login": "annetill"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ValidationUtil.java", "diffHunk": "@@ -385,6 +403,8 @@ public static void checkLossFactor(Validable validable, float lossFactor) {\n             throw new ValidationException(validable, \"loss factor is invalid\");\n         } else if (lossFactor < 0) {\n             throw new ValidationException(validable, \"loss factor must be >= 0\");\n+        } else if (lossFactor > 3) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQxNzkwNw=="}, "originalCommit": {"oid": "14ebade6a134d5e4defc48c971a156f635bd0542"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY2NDMwOQ==", "bodyText": "According with the master version the lossFactor is calculated and expressed as a percentage and to be coherent with the code implementation should be a number in the closed interval [0,100]. (See code lines 179 - 186 and 41 - 93 of the  DcLineSegmentConversion.java class).\nIt is a valid way to express the loss factor and in the IIDM model there are other attributes expressed in the same way, e.g. the step correction in ratioTapChanger and phaseTapChanger but we are in the IIDM model so RTE can choose a different way to express it.", "url": "https://github.com/powsybl/powsybl-core/pull/1262#discussion_r404664309", "createdAt": "2020-04-07T09:22:56Z", "author": {"login": "marqueslanauja"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ValidationUtil.java", "diffHunk": "@@ -385,6 +403,8 @@ public static void checkLossFactor(Validable validable, float lossFactor) {\n             throw new ValidationException(validable, \"loss factor is invalid\");\n         } else if (lossFactor < 0) {\n             throw new ValidationException(validable, \"loss factor must be >= 0\");\n+        } else if (lossFactor > 3) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQxNzkwNw=="}, "originalCommit": {"oid": "14ebade6a134d5e4defc48c971a156f635bd0542"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY3NjMwMA==", "bodyText": "In fact, the DCLineSegmentConversion.Java has been modified with percentage last year by Miora and me. Miora and me have been influenced by the documentation. You are right about RTC and PTC.", "url": "https://github.com/powsybl/powsybl-core/pull/1262#discussion_r404676300", "createdAt": "2020-04-07T09:41:55Z", "author": {"login": "annetill"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ValidationUtil.java", "diffHunk": "@@ -385,6 +403,8 @@ public static void checkLossFactor(Validable validable, float lossFactor) {\n             throw new ValidationException(validable, \"loss factor is invalid\");\n         } else if (lossFactor < 0) {\n             throw new ValidationException(validable, \"loss factor must be >= 0\");\n+        } else if (lossFactor > 3) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQxNzkwNw=="}, "originalCommit": {"oid": "14ebade6a134d5e4defc48c971a156f635bd0542"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxMDk2MjEwOnYy", "diffSide": "RIGHT", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ValidationUtil.java", "isResolved": false, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwODo1NDozMlrOGB5qbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwOTo0ODo0N1rOGB7vDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY0NjUxMQ==", "bodyText": "If the power factor is between -1 and 1, we should also check the lower bound", "url": "https://github.com/powsybl/powsybl-core/pull/1262#discussion_r404646511", "createdAt": "2020-04-07T08:54:32Z", "author": {"login": "mathbagu"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ValidationUtil.java", "diffHunk": "@@ -365,6 +381,8 @@ public static void checkConvertersMode(Validable validable, HvdcLine.ConvertersM\n     public static void checkPowerFactor(Validable validable, double powerFactor) {\n         if (Double.isNaN(powerFactor)) {\n             throw new ValidationException(validable, \"power factor is invalid\");\n+        } else if (Math.abs(powerFactor) > 1) {\n+            throw new ValidationException(validable, \"power factor is invalid, it should be between -1 and 1\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e835b33b8016892b40c54ed4ce554259a78cba59"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY0NzUwNw==", "bodyText": "I cannot make it with Math.abs ?", "url": "https://github.com/powsybl/powsybl-core/pull/1262#discussion_r404647507", "createdAt": "2020-04-07T08:56:05Z", "author": {"login": "annetill"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ValidationUtil.java", "diffHunk": "@@ -365,6 +381,8 @@ public static void checkConvertersMode(Validable validable, HvdcLine.ConvertersM\n     public static void checkPowerFactor(Validable validable, double powerFactor) {\n         if (Double.isNaN(powerFactor)) {\n             throw new ValidationException(validable, \"power factor is invalid\");\n+        } else if (Math.abs(powerFactor) > 1) {\n+            throw new ValidationException(validable, \"power factor is invalid, it should be between -1 and 1\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY0NjUxMQ=="}, "originalCommit": {"oid": "e835b33b8016892b40c54ed4ce554259a78cba59"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY2NTI2NQ==", "bodyText": "Exact, I read your proposal too quickly", "url": "https://github.com/powsybl/powsybl-core/pull/1262#discussion_r404665265", "createdAt": "2020-04-07T09:24:26Z", "author": {"login": "mathbagu"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ValidationUtil.java", "diffHunk": "@@ -365,6 +381,8 @@ public static void checkConvertersMode(Validable validable, HvdcLine.ConvertersM\n     public static void checkPowerFactor(Validable validable, double powerFactor) {\n         if (Double.isNaN(powerFactor)) {\n             throw new ValidationException(validable, \"power factor is invalid\");\n+        } else if (Math.abs(powerFactor) > 1) {\n+            throw new ValidationException(validable, \"power factor is invalid, it should be between -1 and 1\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY0NjUxMQ=="}, "originalCommit": {"oid": "e835b33b8016892b40c54ed4ce554259a78cba59"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY3NDEyOQ==", "bodyText": "I prefer to use  the standard definition of power factor P/sqrt(P*P + Q*Q). You can check the wikipedia definition (https://en.wikipedia.org/wiki/Power_factor).\nIn our particular case the active power P is always positive so the power factor will be in the interval [0,1] but I prefer to check it between -1 and 1 as we already have an additional check for the active power to be positive.  This is my particular opinion.", "url": "https://github.com/powsybl/powsybl-core/pull/1262#discussion_r404674129", "createdAt": "2020-04-07T09:38:25Z", "author": {"login": "marqueslanauja"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ValidationUtil.java", "diffHunk": "@@ -365,6 +381,8 @@ public static void checkConvertersMode(Validable validable, HvdcLine.ConvertersM\n     public static void checkPowerFactor(Validable validable, double powerFactor) {\n         if (Double.isNaN(powerFactor)) {\n             throw new ValidationException(validable, \"power factor is invalid\");\n+        } else if (Math.abs(powerFactor) > 1) {\n+            throw new ValidationException(validable, \"power factor is invalid, it should be between -1 and 1\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY0NjUxMQ=="}, "originalCommit": {"oid": "e835b33b8016892b40c54ed4ce554259a78cba59"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY3NzgzOA==", "bodyText": "Finally, do you agree with this part of the code ? I \"accidentaly\" merge this PR minutes ago\u2026", "url": "https://github.com/powsybl/powsybl-core/pull/1262#discussion_r404677838", "createdAt": "2020-04-07T09:44:20Z", "author": {"login": "annetill"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ValidationUtil.java", "diffHunk": "@@ -365,6 +381,8 @@ public static void checkConvertersMode(Validable validable, HvdcLine.ConvertersM\n     public static void checkPowerFactor(Validable validable, double powerFactor) {\n         if (Double.isNaN(powerFactor)) {\n             throw new ValidationException(validable, \"power factor is invalid\");\n+        } else if (Math.abs(powerFactor) > 1) {\n+            throw new ValidationException(validable, \"power factor is invalid, it should be between -1 and 1\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY0NjUxMQ=="}, "originalCommit": {"oid": "e835b33b8016892b40c54ed4ce554259a78cba59"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY3ODk3MQ==", "bodyText": "Yes, I've just finished to review it, it is okay for me, we can leave it merged as it is!", "url": "https://github.com/powsybl/powsybl-core/pull/1262#discussion_r404678971", "createdAt": "2020-04-07T09:46:23Z", "author": {"login": "miovd"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ValidationUtil.java", "diffHunk": "@@ -365,6 +381,8 @@ public static void checkConvertersMode(Validable validable, HvdcLine.ConvertersM\n     public static void checkPowerFactor(Validable validable, double powerFactor) {\n         if (Double.isNaN(powerFactor)) {\n             throw new ValidationException(validable, \"power factor is invalid\");\n+        } else if (Math.abs(powerFactor) > 1) {\n+            throw new ValidationException(validable, \"power factor is invalid, it should be between -1 and 1\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY0NjUxMQ=="}, "originalCommit": {"oid": "e835b33b8016892b40c54ed4ce554259a78cba59"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY4MDQ2MQ==", "bodyText": "Totally agree.", "url": "https://github.com/powsybl/powsybl-core/pull/1262#discussion_r404680461", "createdAt": "2020-04-07T09:48:47Z", "author": {"login": "marqueslanauja"}, "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ValidationUtil.java", "diffHunk": "@@ -365,6 +381,8 @@ public static void checkConvertersMode(Validable validable, HvdcLine.ConvertersM\n     public static void checkPowerFactor(Validable validable, double powerFactor) {\n         if (Double.isNaN(powerFactor)) {\n             throw new ValidationException(validable, \"power factor is invalid\");\n+        } else if (Math.abs(powerFactor) > 1) {\n+            throw new ValidationException(validable, \"power factor is invalid, it should be between -1 and 1\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY0NjUxMQ=="}, "originalCommit": {"oid": "e835b33b8016892b40c54ed4ce554259a78cba59"}, "originalPosition": 35}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 78, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}