{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2MjQyODk0", "number": 1218, "title": "Ensure that voltageLevel.getConnectables() and associated return collections of distinct elements", "bodyText": "Signed-off-by: RALAMBOTIANA MIORA miora.ralambotiana@rte-france.com\nPlease check if the PR fulfills these requirements (please use '[x]' to check the checkboxes, or submit the PR and then click the checkboxes)\n\n The commit message follows our guidelines\n Tests for the changes have been added (for bug fixes / features)\n\nWhat kind of change does this PR introduce? (Bug fix, feature, docs update, ...)\nBug fix\nWhat is the current behavior?\nvoltageLevel.getConnectables() and voltageLevel.getConnectableStream() do not check if they have duplicates in their respective returned iterable and stream.\nWhat is the new behavior (if this is a feature change)?\nThe returned iterable and stream contain distinct elements.\nDoes this PR introduce a breaking change or deprecate an API?\nNo\nOther information:\nIt generated issues in voltage level with an internal transformer (for example) which:\n\nis not forbidden\nhas been seen to happen by @agnesLeroy during UCTE imports", "createdAt": "2020-03-10T16:38:38Z", "url": "https://github.com/powsybl/powsybl-core/pull/1218", "merged": true, "mergeCommit": {"oid": "ff988ee72d7d7ee668804dfe2c7a91a4151da688"}, "closed": true, "closedAt": "2020-03-12T09:12:14Z", "author": {"login": "MioRtia"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMVNvHgH2gAyMzg2MjQyODk0OjQ4NGM0Y2Q4ZmQxNTE3Y2FlNDRhMzg4ZTJkMTg1ZDhiMjVjNjE3NDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcM3oX3gH2gAyMzg2MjQyODk0Ojc2OGQ0MGM5ODA3MDZiMWE5NTkwZmM2NGNjNGExNjA1ODA2NjQxYzE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "484c4cd8fd1517cae44a388e2d185d8b25c61742", "author": {"user": {"login": "MioRtia", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/484c4cd8fd1517cae44a388e2d185d8b25c61742", "committedDate": "2020-03-10T16:36:11Z", "message": "Ensure that voltageLevel.getConnectables() and associated return collections of distinct elements\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNTYwNzg0", "url": "https://github.com/powsybl/powsybl-core/pull/1218#pullrequestreview-372560784", "createdAt": "2020-03-11T08:42:24Z", "commit": {"oid": "484c4cd8fd1517cae44a388e2d185d8b25c61742"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNTg4MTMw", "url": "https://github.com/powsybl/powsybl-core/pull/1218#pullrequestreview-372588130", "createdAt": "2020-03-11T09:22:56Z", "commit": {"oid": "484c4cd8fd1517cae44a388e2d185d8b25c61742"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwOToyMjo1NlrOF0u1JA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwOToyMjo1NlrOF0u1JA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDgzNzU0MA==", "bodyText": "Why do you change FluentIterable into Iterable here?", "url": "https://github.com/powsybl/powsybl-core/pull/1218#discussion_r390837540", "createdAt": "2020-03-11T09:22:56Z", "author": {"login": "agnesLeroy"}, "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/AbstractVoltageLevel.java", "diffHunk": "@@ -123,41 +124,45 @@ public VoltageLevel setHighVoltageLimit(double highVoltageLimit) {\n     }\n \n     @Override\n-    public <T extends Connectable> FluentIterable<T> getConnectables(Class<T> clazz) {\n+    public <T extends Connectable> Iterable<T> getConnectables(Class<T> clazz) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "484c4cd8fd1517cae44a388e2d185d8b25c61742"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNTg4Nzk3", "url": "https://github.com/powsybl/powsybl-core/pull/1218#pullrequestreview-372588797", "createdAt": "2020-03-11T09:23:51Z", "commit": {"oid": "484c4cd8fd1517cae44a388e2d185d8b25c61742"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwOToyMzo1MVrOF0u3Pw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwOToyMzo1MVrOF0u3Pw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDgzODA3OQ==", "bodyText": "Do I get it right that using count() is a better practice than using size(), and that count() returns a long so you need to cast it to an int?", "url": "https://github.com/powsybl/powsybl-core/pull/1218#discussion_r390838079", "createdAt": "2020-03-11T09:23:51Z", "author": {"login": "agnesLeroy"}, "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/AbstractVoltageLevel.java", "diffHunk": "@@ -123,41 +124,45 @@ public VoltageLevel setHighVoltageLimit(double highVoltageLimit) {\n     }\n \n     @Override\n-    public <T extends Connectable> FluentIterable<T> getConnectables(Class<T> clazz) {\n+    public <T extends Connectable> Iterable<T> getConnectables(Class<T> clazz) {\n         Iterable<Terminal> terminals = getTerminals();\n         return FluentIterable.from(terminals)\n                 .transform(Terminal::getConnectable)\n-                .filter(clazz);\n+                .filter(clazz)\n+                .toSet();\n     }\n \n     @Override\n     public <T extends Connectable> Stream<T> getConnectableStream(Class<T> clazz) {\n         return getTerminalStream()\n                 .map(Terminal::getConnectable)\n                 .filter(clazz::isInstance)\n-                .map(clazz::cast);\n+                .map(clazz::cast)\n+                .distinct();\n     }\n \n     @Override\n     public <T extends Connectable> int getConnectableCount(Class<T> clazz) {\n-        return getConnectables(clazz).size();\n+        return Ints.checkedCast(getConnectableStream(clazz).count());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "484c4cd8fd1517cae44a388e2d185d8b25c61742"}, "originalPosition": 35}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "29aaf77036e1c41e65176b989260ad453d468839", "author": {"user": {"login": "MioRtia", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/29aaf77036e1c41e65176b989260ad453d468839", "committedDate": "2020-03-11T10:35:02Z", "message": "Add a test\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>"}, "afterCommit": {"oid": "f0bf9825e7dd1c56e92cd63c360c601969527713", "author": {"user": {"login": "MioRtia", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/f0bf9825e7dd1c56e92cd63c360c601969527713", "committedDate": "2020-03-11T12:29:40Z", "message": "Add tests\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0bf9825e7dd1c56e92cd63c360c601969527713", "author": {"user": {"login": "MioRtia", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/f0bf9825e7dd1c56e92cd63c360c601969527713", "committedDate": "2020-03-11T12:29:40Z", "message": "Add tests\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyOTM4MDYy", "url": "https://github.com/powsybl/powsybl-core/pull/1218#pullrequestreview-372938062", "createdAt": "2020-03-11T16:44:14Z", "commit": {"oid": "f0bf9825e7dd1c56e92cd63c360c601969527713"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMzYxNzY3", "url": "https://github.com/powsybl/powsybl-core/pull/1218#pullrequestreview-373361767", "createdAt": "2020-03-12T08:39:22Z", "commit": {"oid": "f0bf9825e7dd1c56e92cd63c360c601969527713"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "768d40c980706b1a9590fc64cc4a1605806641c1", "author": {"user": {"login": "MioRtia", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/768d40c980706b1a9590fc64cc4a1605806641c1", "committedDate": "2020-03-12T08:42:03Z", "message": "Merge branch 'master' into check_distinct_connectable_vl"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4458, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}