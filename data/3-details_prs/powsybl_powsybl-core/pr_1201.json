{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzMDg1NDg4", "number": 1201, "title": "Cgmes update simple update sv file", "bodyText": "Please check if the PR fulfills these requirements (please use '[x]' to check the checkboxes, or submit the PR and then click the checkboxes)\n\n The commit message follows our guidelines\n Tests for the changes have been added (for bug fixes / features)\n\nWhat kind of change does this PR introduce? (Bug fix, feature, docs update, ...)\nBug fix\nWhat is the current behavior? (You can also link to an open issue here)\nState Variable Adder does not include complete information.\nWhat is the new behavior (if this is a feature change)?\nState Variable Adder includes complete information about cgmes model's State Variables.", "createdAt": "2020-03-03T17:39:08Z", "url": "https://github.com/powsybl/powsybl-core/pull/1201", "merged": true, "mergeCommit": {"oid": "ac5fcadaa858223c2fdb023dac4aeee41a1ca628"}, "closed": true, "closedAt": "2020-03-17T14:34:15Z", "author": {"login": "kaltakovae"}, "timelineItems": {"totalCount": 113, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMkV6_AH2gAyMzgzMDg1NDg4OmRlNDc3NzllZTA2MDMzNjcyYjk1OWU5ZjkzNDE1NGZkYzUwNjBhNzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOjM-IAH2gAyMzgzMDg1NDg4OmQwODY1MjFkNmYwYTk1NWM4Njc5MjdiZDgyN2IxOTYyMDg3MzI1Mjc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "de47779ee06033672b959e9f934154fdc5060a78", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/de47779ee06033672b959e9f934154fdc5060a78", "committedDate": "2020-03-11T10:13:42Z", "message": "use getVoltageLevelStream() in StateVariablesAdder for svStatus\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNTYzNTcw", "url": "https://github.com/powsybl/powsybl-core/pull/1201#pullrequestreview-373563570", "createdAt": "2020-03-12T13:41:15Z", "commit": {"oid": "de47779ee06033672b959e9f934154fdc5060a78"}, "state": "COMMENTED", "comments": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxMzo0MToxNVrOF1fCYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNDoxOTozOVrOF1gm7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYyNzM2Mg==", "bodyText": "You can replace Arrays.asList(CgmesNames.GRAPH) by Collections.singletonList(CgmesNames.GRAPH)", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r391627362", "createdAt": "2020-03-12T13:41:15Z", "author": {"login": "MioRtia"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/StateVariablesAdder.java", "diffHunk": "@@ -7,86 +7,205 @@\n package com.powsybl.cgmes.conversion.update;\n \n import java.util.Arrays;\n+import java.util.HashMap;\n import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n \n+import org.apache.commons.math3.complex.Complex;\n+import org.apache.commons.math3.complex.ComplexUtils;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n import com.powsybl.cgmes.model.CgmesModel;\n import com.powsybl.cgmes.model.CgmesNames;\n import com.powsybl.cgmes.model.CgmesSubset;\n import com.powsybl.cgmes.model.triplestore.CgmesModelTripleStore;\n+import com.powsybl.iidm.network.Battery;\n import com.powsybl.iidm.network.Bus;\n+import com.powsybl.iidm.network.Connectable;\n+import com.powsybl.iidm.network.DanglingLine;\n import com.powsybl.iidm.network.Generator;\n import com.powsybl.iidm.network.Load;\n import com.powsybl.iidm.network.Network;\n import com.powsybl.iidm.network.ShuntCompensator;\n+import com.powsybl.iidm.network.StaticVarCompensator;\n import com.powsybl.iidm.network.Terminal;\n+import com.powsybl.iidm.network.ThreeWindingsTransformer;\n import com.powsybl.iidm.network.TwoWindingsTransformer;\n+import com.powsybl.iidm.network.VoltageLevel;\n+import com.powsybl.iidm.network.util.LinkData;\n+import com.powsybl.iidm.network.util.LinkData.BranchAdmittanceMatrix;\n import com.powsybl.triplestore.api.PropertyBag;\n import com.powsybl.triplestore.api.PropertyBags;\n \n /**\n  * @author Marcos de Miguel <demiguelm at aia.es>\n  * @author Luma Zamarre\u00f1o <zamarrenolm at aia.es>\n+ * @author Elena Kaltakova <kaltakovae at aia.es>\n  */\n-public final class StateVariablesAdder {\n+public class StateVariablesAdder {\n \n-    private StateVariablesAdder() {\n+    public StateVariablesAdder(CgmesModel cgmes, Network n) {\n+        this.cgmes = Objects.requireNonNull(cgmes);\n+        this.network = Objects.requireNonNull(n);\n+        this.cimVersion = ((CgmesModelTripleStore) cgmes).getCimVersion();\n+        this.originalTerminals = cgmes.terminals();\n+        this.originalFullModel = cgmes.fullModel(CgmesSubset.STATE_VARIABLES.getProfile());\n+        this.originalTopologicalIslands = cgmes.topologicalIslands();\n+        this.originalSVcontext = originalSVcontext();\n+        this.boundaryNodesFromDanglingLines = boundaryNodesFromDanglingLines();\n     }\n \n-    public static void add(Network n, CgmesModel cgmes) {\n-        // TODO Add full model data with proper profile (StateVariables)\n-        // FullModel is defined in ModelDescription:\n-        // http://iec.ch/TC57/61970-552/ModelDescription/1#\n+    private String originalSVcontext() {\n+        PropertyBags pbs = cgmes.graph();\n+        PropertyBag defaultSvContext = new PropertyBag(Arrays.asList(CgmesNames.GRAPH));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de47779ee06033672b959e9f934154fdc5060a78"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYyODg5NQ==", "bodyText": "You can replace boundaryNodesFromDanglingLines.entrySet().forEach(entry -> {...}); by boundaryNodesFromDanglingLines.forEach((key, value) -> {...});", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r391628895", "createdAt": "2020-03-12T13:43:44Z", "author": {"login": "MioRtia"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/StateVariablesAdder.java", "diffHunk": "@@ -7,86 +7,205 @@\n package com.powsybl.cgmes.conversion.update;\n \n import java.util.Arrays;\n+import java.util.HashMap;\n import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n \n+import org.apache.commons.math3.complex.Complex;\n+import org.apache.commons.math3.complex.ComplexUtils;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n import com.powsybl.cgmes.model.CgmesModel;\n import com.powsybl.cgmes.model.CgmesNames;\n import com.powsybl.cgmes.model.CgmesSubset;\n import com.powsybl.cgmes.model.triplestore.CgmesModelTripleStore;\n+import com.powsybl.iidm.network.Battery;\n import com.powsybl.iidm.network.Bus;\n+import com.powsybl.iidm.network.Connectable;\n+import com.powsybl.iidm.network.DanglingLine;\n import com.powsybl.iidm.network.Generator;\n import com.powsybl.iidm.network.Load;\n import com.powsybl.iidm.network.Network;\n import com.powsybl.iidm.network.ShuntCompensator;\n+import com.powsybl.iidm.network.StaticVarCompensator;\n import com.powsybl.iidm.network.Terminal;\n+import com.powsybl.iidm.network.ThreeWindingsTransformer;\n import com.powsybl.iidm.network.TwoWindingsTransformer;\n+import com.powsybl.iidm.network.VoltageLevel;\n+import com.powsybl.iidm.network.util.LinkData;\n+import com.powsybl.iidm.network.util.LinkData.BranchAdmittanceMatrix;\n import com.powsybl.triplestore.api.PropertyBag;\n import com.powsybl.triplestore.api.PropertyBags;\n \n /**\n  * @author Marcos de Miguel <demiguelm at aia.es>\n  * @author Luma Zamarre\u00f1o <zamarrenolm at aia.es>\n+ * @author Elena Kaltakova <kaltakovae at aia.es>\n  */\n-public final class StateVariablesAdder {\n+public class StateVariablesAdder {\n \n-    private StateVariablesAdder() {\n+    public StateVariablesAdder(CgmesModel cgmes, Network n) {\n+        this.cgmes = Objects.requireNonNull(cgmes);\n+        this.network = Objects.requireNonNull(n);\n+        this.cimVersion = ((CgmesModelTripleStore) cgmes).getCimVersion();\n+        this.originalTerminals = cgmes.terminals();\n+        this.originalFullModel = cgmes.fullModel(CgmesSubset.STATE_VARIABLES.getProfile());\n+        this.originalTopologicalIslands = cgmes.topologicalIslands();\n+        this.originalSVcontext = originalSVcontext();\n+        this.boundaryNodesFromDanglingLines = boundaryNodesFromDanglingLines();\n     }\n \n-    public static void add(Network n, CgmesModel cgmes) {\n-        // TODO Add full model data with proper profile (StateVariables)\n-        // FullModel is defined in ModelDescription:\n-        // http://iec.ch/TC57/61970-552/ModelDescription/1#\n+    private String originalSVcontext() {\n+        PropertyBags pbs = cgmes.graph();\n+        PropertyBag defaultSvContext = new PropertyBag(Arrays.asList(CgmesNames.GRAPH));\n+        defaultSvContext.put(CgmesNames.GRAPH, CgmesSubset.STATE_VARIABLES.toString());\n+        return pbs.stream()\n+            .filter(graph -> graph.getId(CgmesNames.GRAPH).contains(CgmesSubset.STATE_VARIABLES.getIdentifier()))\n+            .findAny()\n+            .orElse(defaultSvContext)\n+            .getId(CgmesNames.GRAPH);\n+    }\n+\n+    public void addStateVariablesToCgmes() {\n+        if (cgmes.isNodeBreaker()) {\n+            // TODO we need to export SV file data for NodeBraker\n+            LOG.warn(\"NodeBreaker view require further investigation to map correctly Topological Nodes\");\n+            return;\n+        }\n+        // Clear the previous SV data in CGMES model\n+        // and fill it with the Network current state values\n+        cgmes.clear(CgmesSubset.STATE_VARIABLES);\n+\n+        if (cimVersion != 14) {\n+            addModelDescriptionToCgmes();\n+            addTopologicalIslandsToCgmes();\n+        }\n+\n+        addVoltagesForTopologicalNodes();\n+\n+        addVoltagesForBoundaryNodes();\n+\n+        addPowerFlowToCgmes();\n \n+        addShuntCompensatorSectionsToCgmes();\n+\n+        addTapStepToCgmes();\n+\n+        addStatusToCgmes();\n+    }\n+\n+    private void addVoltagesForTopologicalNodes() {\n         PropertyBags voltages = new PropertyBags();\n-        for (Bus b : n.getBusBreakerView().getBuses()) {\n+        // add voltages for TpNodes existing in the Model\n+        for (PropertyBag tn : cgmes.topologicalNodes()) {\n+            Bus b = network.getBusBreakerView().getBus(tn.getId(CgmesNames.TOPOLOGICAL_NODE));\n             PropertyBag p = new PropertyBag(SV_VOLTAGE_PROPERTIES);\n-            p.put(CgmesNames.ANGLE, fs(b.getAngle()));\n-            p.put(CgmesNames.VOLTAGE, fs(b.getV()));\n-            p.put(\"TopologicalNode\", topologicalNodeFromBusId(b.getId()));\n-            voltages.add(p);\n+            if (b != null) {\n+                p.put(CgmesNames.ANGLE, fs(b.getAngle()));\n+                p.put(CgmesNames.VOLTAGE, fs(b.getV()));\n+                p.put(CgmesNames.TOPOLOGICAL_NODE, tn.getId(CgmesNames.TOPOLOGICAL_NODE));\n+                voltages.add(p);\n+            }\n         }\n-        cgmes.add(CgmesSubset.STATE_VARIABLES, \"SvVoltage\", voltages);\n+        cgmes.add(originalSVcontext, \"SvVoltage\", voltages);\n+    }\n \n+    private void addVoltagesForBoundaryNodes() {\n+        PropertyBags voltages = new PropertyBags();\n+        // add voltages for TpNodes existing in the Model's boundaries\n+        boundaryNodesFromDanglingLines.entrySet().forEach(entry -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de47779ee06033672b959e9f934154fdc5060a78"}, "originalPosition": 124}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY0MDMzNQ==", "bodyText": "To lower this method's complexity, create an intermediary method:\nprivate <I extends Injection> void addInjectionPowerFlowToCgmes(PropertyBags powerFlows, Iterable<I> injectionStream) {\n        injectionStream.forEach(i -> {\n            PropertyBag p = createPowerFlowProperties(i.getTerminal());\n            if (p != null) {\n                powerFlows.add(p);\n            } else if (i instanceof Load) {\n                // FIXME CGMES SvInjection objects created as loads\n                LOG.error(\"No SvPowerFlow created for load {}\", i.getId());\n            }\n        });\n    }\nYou can then call:\nPropertyBags powerFlows = new PropertyBags();\naddInjectionPowerFlowToCgmes(powerFlows, network.getLoads());\naddInjectionPowerFlowToCgmes(powerFlows, network.getGenerators());\naddInjectionPowerFlowToCgmes(powerFlows, network.getShuntCompensators());\naddInjectionPowerFlowToCgmes(powerFlows, network.getStaticVarCompensators());\naddInjectionPowerFlowToCgmes(powerFlows, network.getBatteries());", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r391640335", "createdAt": "2020-03-12T14:00:54Z", "author": {"login": "MioRtia"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/StateVariablesAdder.java", "diffHunk": "@@ -7,86 +7,205 @@\n package com.powsybl.cgmes.conversion.update;\n \n import java.util.Arrays;\n+import java.util.HashMap;\n import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n \n+import org.apache.commons.math3.complex.Complex;\n+import org.apache.commons.math3.complex.ComplexUtils;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n import com.powsybl.cgmes.model.CgmesModel;\n import com.powsybl.cgmes.model.CgmesNames;\n import com.powsybl.cgmes.model.CgmesSubset;\n import com.powsybl.cgmes.model.triplestore.CgmesModelTripleStore;\n+import com.powsybl.iidm.network.Battery;\n import com.powsybl.iidm.network.Bus;\n+import com.powsybl.iidm.network.Connectable;\n+import com.powsybl.iidm.network.DanglingLine;\n import com.powsybl.iidm.network.Generator;\n import com.powsybl.iidm.network.Load;\n import com.powsybl.iidm.network.Network;\n import com.powsybl.iidm.network.ShuntCompensator;\n+import com.powsybl.iidm.network.StaticVarCompensator;\n import com.powsybl.iidm.network.Terminal;\n+import com.powsybl.iidm.network.ThreeWindingsTransformer;\n import com.powsybl.iidm.network.TwoWindingsTransformer;\n+import com.powsybl.iidm.network.VoltageLevel;\n+import com.powsybl.iidm.network.util.LinkData;\n+import com.powsybl.iidm.network.util.LinkData.BranchAdmittanceMatrix;\n import com.powsybl.triplestore.api.PropertyBag;\n import com.powsybl.triplestore.api.PropertyBags;\n \n /**\n  * @author Marcos de Miguel <demiguelm at aia.es>\n  * @author Luma Zamarre\u00f1o <zamarrenolm at aia.es>\n+ * @author Elena Kaltakova <kaltakovae at aia.es>\n  */\n-public final class StateVariablesAdder {\n+public class StateVariablesAdder {\n \n-    private StateVariablesAdder() {\n+    public StateVariablesAdder(CgmesModel cgmes, Network n) {\n+        this.cgmes = Objects.requireNonNull(cgmes);\n+        this.network = Objects.requireNonNull(n);\n+        this.cimVersion = ((CgmesModelTripleStore) cgmes).getCimVersion();\n+        this.originalTerminals = cgmes.terminals();\n+        this.originalFullModel = cgmes.fullModel(CgmesSubset.STATE_VARIABLES.getProfile());\n+        this.originalTopologicalIslands = cgmes.topologicalIslands();\n+        this.originalSVcontext = originalSVcontext();\n+        this.boundaryNodesFromDanglingLines = boundaryNodesFromDanglingLines();\n     }\n \n-    public static void add(Network n, CgmesModel cgmes) {\n-        // TODO Add full model data with proper profile (StateVariables)\n-        // FullModel is defined in ModelDescription:\n-        // http://iec.ch/TC57/61970-552/ModelDescription/1#\n+    private String originalSVcontext() {\n+        PropertyBags pbs = cgmes.graph();\n+        PropertyBag defaultSvContext = new PropertyBag(Arrays.asList(CgmesNames.GRAPH));\n+        defaultSvContext.put(CgmesNames.GRAPH, CgmesSubset.STATE_VARIABLES.toString());\n+        return pbs.stream()\n+            .filter(graph -> graph.getId(CgmesNames.GRAPH).contains(CgmesSubset.STATE_VARIABLES.getIdentifier()))\n+            .findAny()\n+            .orElse(defaultSvContext)\n+            .getId(CgmesNames.GRAPH);\n+    }\n+\n+    public void addStateVariablesToCgmes() {\n+        if (cgmes.isNodeBreaker()) {\n+            // TODO we need to export SV file data for NodeBraker\n+            LOG.warn(\"NodeBreaker view require further investigation to map correctly Topological Nodes\");\n+            return;\n+        }\n+        // Clear the previous SV data in CGMES model\n+        // and fill it with the Network current state values\n+        cgmes.clear(CgmesSubset.STATE_VARIABLES);\n+\n+        if (cimVersion != 14) {\n+            addModelDescriptionToCgmes();\n+            addTopologicalIslandsToCgmes();\n+        }\n+\n+        addVoltagesForTopologicalNodes();\n+\n+        addVoltagesForBoundaryNodes();\n+\n+        addPowerFlowToCgmes();\n \n+        addShuntCompensatorSectionsToCgmes();\n+\n+        addTapStepToCgmes();\n+\n+        addStatusToCgmes();\n+    }\n+\n+    private void addVoltagesForTopologicalNodes() {\n         PropertyBags voltages = new PropertyBags();\n-        for (Bus b : n.getBusBreakerView().getBuses()) {\n+        // add voltages for TpNodes existing in the Model\n+        for (PropertyBag tn : cgmes.topologicalNodes()) {\n+            Bus b = network.getBusBreakerView().getBus(tn.getId(CgmesNames.TOPOLOGICAL_NODE));\n             PropertyBag p = new PropertyBag(SV_VOLTAGE_PROPERTIES);\n-            p.put(CgmesNames.ANGLE, fs(b.getAngle()));\n-            p.put(CgmesNames.VOLTAGE, fs(b.getV()));\n-            p.put(\"TopologicalNode\", topologicalNodeFromBusId(b.getId()));\n-            voltages.add(p);\n+            if (b != null) {\n+                p.put(CgmesNames.ANGLE, fs(b.getAngle()));\n+                p.put(CgmesNames.VOLTAGE, fs(b.getV()));\n+                p.put(CgmesNames.TOPOLOGICAL_NODE, tn.getId(CgmesNames.TOPOLOGICAL_NODE));\n+                voltages.add(p);\n+            }\n         }\n-        cgmes.add(CgmesSubset.STATE_VARIABLES, \"SvVoltage\", voltages);\n+        cgmes.add(originalSVcontext, \"SvVoltage\", voltages);\n+    }\n \n+    private void addVoltagesForBoundaryNodes() {\n+        PropertyBags voltages = new PropertyBags();\n+        // add voltages for TpNodes existing in the Model's boundaries\n+        boundaryNodesFromDanglingLines.entrySet().forEach(entry -> {\n+            PropertyBag p = new PropertyBag(SV_VOLTAGE_PROPERTIES);\n+            DanglingLine dl = network.getDanglingLine(entry.getKey());\n+            Bus b = dl.getTerminal().getBusBreakerView().getBus();\n+            if (b != null) {\n+                // calculate complex voltage value: abs for VOLTAGE, degrees for ANGLE\n+                Complex v2 = complexVoltage(dl.getR(), dl.getX(), dl.getG(), dl.getB(), b.getV(), b.getAngle(),\n+                    dl.getP0(), dl.getQ0());\n+                p.put(CgmesNames.ANGLE, fs(Math.toDegrees(v2.getArgument())));\n+                p.put(CgmesNames.VOLTAGE, fs(v2.abs()));\n+                p.put(CgmesNames.TOPOLOGICAL_NODE, entry.getValue());\n+            } else {\n+                p.put(CgmesNames.ANGLE, fs(0.0));\n+                p.put(CgmesNames.VOLTAGE, fs(0.0));\n+                p.put(CgmesNames.TOPOLOGICAL_NODE, entry.getValue());\n+            }\n+            voltages.add(p);\n+        });\n+        cgmes.add(originalSVcontext, \"SvVoltage\", voltages);\n+    }\n+\n+    private void addPowerFlowToCgmes() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de47779ee06033672b959e9f934154fdc5060a78"}, "originalPosition": 145}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY0NTY4MA==", "bodyText": "You can replace Arrays.asList(CgmesNames.NAME) by Collections.singletonList(...)", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r391645680", "createdAt": "2020-03-12T14:08:41Z", "author": {"login": "MioRtia"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/StateVariablesAdder.java", "diffHunk": "@@ -127,22 +325,106 @@ private static PropertyBag createPowerFlowProperties(CgmesModel cgmes, Terminal\n         return p;\n     }\n \n+    // added TopologicalIsland as it was in cgmes : original topology is\n+    // preserved.\n+    private void addTopologicalIslandsToCgmes() {\n+        if (!originalTopologicalIslands.isEmpty()) {\n+            // For properties such as \"cim:TopologicalIsland.TopologicalNodes\", which might\n+            // have arbitrary number of values, SPARQL will return multiple result sets.\n+            // All properties values will be equal, except the multiValued property\n+            // TopologicalNodes.\n+            // Also, there can be > 1 TopologicalIsland, so we need to re-group PropertyBags\n+            // by TopologicalIsland ID.\n+            Map<String, PropertyBags> byTopologicalIslandId = new HashMap<>();\n+            originalTopologicalIslands.forEach(pb -> {\n+                String island = pb.getId(CgmesNames.TOPOLOGICAL_ISLAND);\n+                if (byTopologicalIslandId.keySet().contains(island)) {\n+                    byTopologicalIslandId.get(island).add(pb);\n+                } else {\n+                    PropertyBags pbs = new PropertyBags();\n+                    pbs.add(pb);\n+                    byTopologicalIslandId.put(island, pbs);\n+                }\n+            });\n+            // now we can process all TPNodes from each island, and put them in one\n+            // multivaluedProperty.\n+            PropertyBags topologicalIslands = new PropertyBags();\n+            byTopologicalIslandId.values().forEach(island -> {\n+                PropertyBag topologicalIsland = new PropertyBag(SV_TOPOLOGICALISLAND_PROPERTIES);\n+                topologicalIsland.setClassPropertyNames(Arrays.asList(CgmesNames.NAME));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de47779ee06033672b959e9f934154fdc5060a78"}, "originalPosition": 366}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY0NTg2Mg==", "bodyText": "You can replace Arrays.asList(TopologicalNodes) by Collections.singletonList(...)", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r391645862", "createdAt": "2020-03-12T14:08:58Z", "author": {"login": "MioRtia"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/StateVariablesAdder.java", "diffHunk": "@@ -127,22 +325,106 @@ private static PropertyBag createPowerFlowProperties(CgmesModel cgmes, Terminal\n         return p;\n     }\n \n+    // added TopologicalIsland as it was in cgmes : original topology is\n+    // preserved.\n+    private void addTopologicalIslandsToCgmes() {\n+        if (!originalTopologicalIslands.isEmpty()) {\n+            // For properties such as \"cim:TopologicalIsland.TopologicalNodes\", which might\n+            // have arbitrary number of values, SPARQL will return multiple result sets.\n+            // All properties values will be equal, except the multiValued property\n+            // TopologicalNodes.\n+            // Also, there can be > 1 TopologicalIsland, so we need to re-group PropertyBags\n+            // by TopologicalIsland ID.\n+            Map<String, PropertyBags> byTopologicalIslandId = new HashMap<>();\n+            originalTopologicalIslands.forEach(pb -> {\n+                String island = pb.getId(CgmesNames.TOPOLOGICAL_ISLAND);\n+                if (byTopologicalIslandId.keySet().contains(island)) {\n+                    byTopologicalIslandId.get(island).add(pb);\n+                } else {\n+                    PropertyBags pbs = new PropertyBags();\n+                    pbs.add(pb);\n+                    byTopologicalIslandId.put(island, pbs);\n+                }\n+            });\n+            // now we can process all TPNodes from each island, and put them in one\n+            // multivaluedProperty.\n+            PropertyBags topologicalIslands = new PropertyBags();\n+            byTopologicalIslandId.values().forEach(island -> {\n+                PropertyBag topologicalIsland = new PropertyBag(SV_TOPOLOGICALISLAND_PROPERTIES);\n+                topologicalIsland.setClassPropertyNames(Arrays.asList(CgmesNames.NAME));\n+                topologicalIsland.setMultivaluedProperty(Arrays.asList(\"TopologicalNodes\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de47779ee06033672b959e9f934154fdc5060a78"}, "originalPosition": 367}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY0NjM1Mg==", "bodyText": "You can replace Arrays.asList(CgmesNames.DEPENDENT_ON) by Collections.singletonList(...)", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r391646352", "createdAt": "2020-03-12T14:09:41Z", "author": {"login": "MioRtia"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/StateVariablesAdder.java", "diffHunk": "@@ -127,22 +325,106 @@ private static PropertyBag createPowerFlowProperties(CgmesModel cgmes, Terminal\n         return p;\n     }\n \n+    // added TopologicalIsland as it was in cgmes : original topology is\n+    // preserved.\n+    private void addTopologicalIslandsToCgmes() {\n+        if (!originalTopologicalIslands.isEmpty()) {\n+            // For properties such as \"cim:TopologicalIsland.TopologicalNodes\", which might\n+            // have arbitrary number of values, SPARQL will return multiple result sets.\n+            // All properties values will be equal, except the multiValued property\n+            // TopologicalNodes.\n+            // Also, there can be > 1 TopologicalIsland, so we need to re-group PropertyBags\n+            // by TopologicalIsland ID.\n+            Map<String, PropertyBags> byTopologicalIslandId = new HashMap<>();\n+            originalTopologicalIslands.forEach(pb -> {\n+                String island = pb.getId(CgmesNames.TOPOLOGICAL_ISLAND);\n+                if (byTopologicalIslandId.keySet().contains(island)) {\n+                    byTopologicalIslandId.get(island).add(pb);\n+                } else {\n+                    PropertyBags pbs = new PropertyBags();\n+                    pbs.add(pb);\n+                    byTopologicalIslandId.put(island, pbs);\n+                }\n+            });\n+            // now we can process all TPNodes from each island, and put them in one\n+            // multivaluedProperty.\n+            PropertyBags topologicalIslands = new PropertyBags();\n+            byTopologicalIslandId.values().forEach(island -> {\n+                PropertyBag topologicalIsland = new PropertyBag(SV_TOPOLOGICALISLAND_PROPERTIES);\n+                topologicalIsland.setClassPropertyNames(Arrays.asList(CgmesNames.NAME));\n+                topologicalIsland.setMultivaluedProperty(Arrays.asList(\"TopologicalNodes\"));\n+                topologicalIsland.put(CgmesNames.NAME, island.get(0).getId(\"name\"));\n+                topologicalIsland.put(CgmesNames.ANGLEREF_TOPOLOGICALNODE,\n+                    island.get(0).getId(CgmesNames.ANGLEREF_TOPOLOGICALNODE));\n+                topologicalIsland.put(CgmesNames.TOPOLOGICAL_NODES,\n+                    String.join(\",\", island.pluckLocals(CgmesNames.TOPOLOGICAL_NODES)));\n+                topologicalIslands.add(topologicalIsland);\n+            });\n+            cgmes.add(originalSVcontext, CgmesNames.TOPOLOGICAL_ISLAND, topologicalIslands);\n+        }\n+    }\n+\n+    // Added full model data with proper profile (StateVariables)\n+    // FullModel is defined in ModelDescription:\n+    // http://iec.ch/TC57/61970-552/ModelDescription/1#\n+    private void addModelDescriptionToCgmes() {\n+        PropertyBags fullModelSV = new PropertyBags();\n+        // for properties such as \"md:Model.DependentOn\" which might have arbitrary\n+        // number of values, SPARQL will return multiple result sets.\n+        // All are equal, except the multiValued property value.\n+        if (!originalFullModel.isEmpty()) {\n+            PropertyBag newModelDescription = new PropertyBag(SV_FULLMODEL_PROPERTIES);\n+            newModelDescription\n+                .setClassPropertyNames(\n+                    Arrays.asList(CgmesNames.SCENARIO_TIME, CgmesNames.CREATED, CgmesNames.DESCRIPTION,\n+                        CgmesNames.VERSION, CgmesNames.DEPENDENT_ON, CgmesNames.PROFILE,\n+                        CgmesNames.MODELING_AUTHORITY_SET));\n+            newModelDescription.setMultivaluedProperty(Arrays.asList(CgmesNames.DEPENDENT_ON));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de47779ee06033672b959e9f934154fdc5060a78"}, "originalPosition": 394}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY0NzM0NQ==", "bodyText": "All these fields can be final.", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r391647345", "createdAt": "2020-03-12T14:11:06Z", "author": {"login": "MioRtia"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/StateVariablesAdder.java", "diffHunk": "@@ -127,22 +325,106 @@ private static PropertyBag createPowerFlowProperties(CgmesModel cgmes, Terminal\n         return p;\n     }\n \n+    // added TopologicalIsland as it was in cgmes : original topology is\n+    // preserved.\n+    private void addTopologicalIslandsToCgmes() {\n+        if (!originalTopologicalIslands.isEmpty()) {\n+            // For properties such as \"cim:TopologicalIsland.TopologicalNodes\", which might\n+            // have arbitrary number of values, SPARQL will return multiple result sets.\n+            // All properties values will be equal, except the multiValued property\n+            // TopologicalNodes.\n+            // Also, there can be > 1 TopologicalIsland, so we need to re-group PropertyBags\n+            // by TopologicalIsland ID.\n+            Map<String, PropertyBags> byTopologicalIslandId = new HashMap<>();\n+            originalTopologicalIslands.forEach(pb -> {\n+                String island = pb.getId(CgmesNames.TOPOLOGICAL_ISLAND);\n+                if (byTopologicalIslandId.keySet().contains(island)) {\n+                    byTopologicalIslandId.get(island).add(pb);\n+                } else {\n+                    PropertyBags pbs = new PropertyBags();\n+                    pbs.add(pb);\n+                    byTopologicalIslandId.put(island, pbs);\n+                }\n+            });\n+            // now we can process all TPNodes from each island, and put them in one\n+            // multivaluedProperty.\n+            PropertyBags topologicalIslands = new PropertyBags();\n+            byTopologicalIslandId.values().forEach(island -> {\n+                PropertyBag topologicalIsland = new PropertyBag(SV_TOPOLOGICALISLAND_PROPERTIES);\n+                topologicalIsland.setClassPropertyNames(Arrays.asList(CgmesNames.NAME));\n+                topologicalIsland.setMultivaluedProperty(Arrays.asList(\"TopologicalNodes\"));\n+                topologicalIsland.put(CgmesNames.NAME, island.get(0).getId(\"name\"));\n+                topologicalIsland.put(CgmesNames.ANGLEREF_TOPOLOGICALNODE,\n+                    island.get(0).getId(CgmesNames.ANGLEREF_TOPOLOGICALNODE));\n+                topologicalIsland.put(CgmesNames.TOPOLOGICAL_NODES,\n+                    String.join(\",\", island.pluckLocals(CgmesNames.TOPOLOGICAL_NODES)));\n+                topologicalIslands.add(topologicalIsland);\n+            });\n+            cgmes.add(originalSVcontext, CgmesNames.TOPOLOGICAL_ISLAND, topologicalIslands);\n+        }\n+    }\n+\n+    // Added full model data with proper profile (StateVariables)\n+    // FullModel is defined in ModelDescription:\n+    // http://iec.ch/TC57/61970-552/ModelDescription/1#\n+    private void addModelDescriptionToCgmes() {\n+        PropertyBags fullModelSV = new PropertyBags();\n+        // for properties such as \"md:Model.DependentOn\" which might have arbitrary\n+        // number of values, SPARQL will return multiple result sets.\n+        // All are equal, except the multiValued property value.\n+        if (!originalFullModel.isEmpty()) {\n+            PropertyBag newModelDescription = new PropertyBag(SV_FULLMODEL_PROPERTIES);\n+            newModelDescription\n+                .setClassPropertyNames(\n+                    Arrays.asList(CgmesNames.SCENARIO_TIME, CgmesNames.CREATED, CgmesNames.DESCRIPTION,\n+                        CgmesNames.VERSION, CgmesNames.DEPENDENT_ON, CgmesNames.PROFILE,\n+                        CgmesNames.MODELING_AUTHORITY_SET));\n+            newModelDescription.setMultivaluedProperty(Arrays.asList(CgmesNames.DEPENDENT_ON));\n+            newModelDescription.put(CgmesNames.SCENARIO_TIME, originalFullModel.get(0).getId(\"scenarioTime\"));\n+            newModelDescription.put(CgmesNames.CREATED, originalFullModel.get(0).getId(\"created\"));\n+            newModelDescription.put(CgmesNames.DESCRIPTION, originalFullModel.get(0).getId(\"description\"));\n+            newModelDescription.put(CgmesNames.VERSION, originalFullModel.get(0).getId(\"version\"));\n+            newModelDescription.put(CgmesNames.DEPENDENT_ON,\n+                String.join(\",\", originalFullModel.pluckLocals(\"DependentOn\")));\n+            newModelDescription.put(CgmesNames.PROFILE, originalFullModel.get(0).getId(\"profile\"));\n+            newModelDescription.put(CgmesNames.MODELING_AUTHORITY_SET,\n+                originalFullModel.get(0).getId(\"modelingAuthoritySet\"));\n+            fullModelSV.add(newModelDescription);\n+            cgmes.add(originalSVcontext, CgmesNames.FULL_MODEL, fullModelSV);\n+        }\n+    }\n+\n     private static String fs(double value) {\n-        return String.valueOf(value);\n+        return Double.isNaN(value) ? String.valueOf(0.0) : String.valueOf(value);\n     }\n \n     private static String is(int value) {\n         return String.valueOf(value);\n     }\n \n-    private static String topologicalNodeFromBusId(String iidmBusId) {\n-        // TODO Consider potential namingStrategy transformations\n-        return iidmBusId;\n-    }\n+    private CgmesModel cgmes;\n+    private Network network;\n+    private int cimVersion;\n+    private PropertyBags originalTerminals;\n+    private PropertyBags originalFullModel;\n+    private PropertyBags originalTopologicalIslands;\n+    private String originalSVcontext;\n+    private Map<String, String> boundaryNodesFromDanglingLines;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de47779ee06033672b959e9f934154fdc5060a78"}, "originalPosition": 429}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY1MTAwMA==", "bodyText": "Add a default implementation to prevent breaking changes", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r391651000", "createdAt": "2020-03-12T14:16:28Z", "author": {"login": "MioRtia"}, "path": "cgmes/cgmes-model/src/main/java/com/powsybl/cgmes/model/CgmesModel.java", "diffHunk": "@@ -29,6 +29,8 @@\n \n     Properties getProperties();\n \n+    PropertyBags fullModel(String cgmesProfile);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de47779ee06033672b959e9f934154fdc5060a78"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY1MTA5NA==", "bodyText": "Same remark", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r391651094", "createdAt": "2020-03-12T14:16:36Z", "author": {"login": "MioRtia"}, "path": "cgmes/cgmes-model/src/main/java/com/powsybl/cgmes/model/CgmesModel.java", "diffHunk": "@@ -130,10 +132,16 @@\n \n     PropertyBags dcTerminalsTP();\n \n+    PropertyBags topologicalIslands();\n+\n+    PropertyBags graph();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de47779ee06033672b959e9f934154fdc5060a78"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY1MTE0OA==", "bodyText": "Same remark", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r391651148", "createdAt": "2020-03-12T14:16:42Z", "author": {"login": "MioRtia"}, "path": "cgmes/cgmes-model/src/main/java/com/powsybl/cgmes/model/CgmesModel.java", "diffHunk": "@@ -130,10 +132,16 @@\n \n     PropertyBags dcTerminalsTP();\n \n+    PropertyBags topologicalIslands();\n+\n+    PropertyBags graph();\n+\n     void clear(CgmesSubset subset);\n \n     void add(CgmesSubset subset, String type, PropertyBags objects);\n \n+    void add(String context, String type, PropertyBags objects);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de47779ee06033672b959e9f934154fdc5060a78"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY1Mjg5OQ==", "bodyText": "If you want to set this.resourceNames, you will need to clear it before calling addAll:\nthis.resourceNames.clear();\nthis.resourceNames.addAll(...);", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r391652899", "createdAt": "2020-03-12T14:19:20Z", "author": {"login": "MioRtia"}, "path": "triple-store/triple-store-api/src/main/java/com/powsybl/triplestore/api/PropertyBag.java", "diffHunk": "@@ -184,24 +183,36 @@ public String namespacePrefix(String name) {\n     }\n \n     public void setResourceNames(List<String> resourceNames) {\n-        this.resourceNames = Objects.requireNonNull(resourceNames);\n+        this.resourceNames.addAll(Objects.requireNonNull(resourceNames));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de47779ee06033672b959e9f934154fdc5060a78"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY1MzAxNA==", "bodyText": "Same remark", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r391653014", "createdAt": "2020-03-12T14:19:31Z", "author": {"login": "MioRtia"}, "path": "triple-store/triple-store-api/src/main/java/com/powsybl/triplestore/api/PropertyBag.java", "diffHunk": "@@ -184,24 +183,36 @@ public String namespacePrefix(String name) {\n     }\n \n     public void setResourceNames(List<String> resourceNames) {\n-        this.resourceNames = Objects.requireNonNull(resourceNames);\n+        this.resourceNames.addAll(Objects.requireNonNull(resourceNames));\n     }\n \n     public void setClassPropertyNames(List<String> classPropertyNames) {\n-        this.classPropertyNames = Objects.requireNonNull(classPropertyNames);\n+        this.classPropertyNames.addAll(Objects.requireNonNull(classPropertyNames));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de47779ee06033672b959e9f934154fdc5060a78"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY1MzEwMg==", "bodyText": "Same remark", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r391653102", "createdAt": "2020-03-12T14:19:39Z", "author": {"login": "MioRtia"}, "path": "triple-store/triple-store-api/src/main/java/com/powsybl/triplestore/api/PropertyBag.java", "diffHunk": "@@ -184,24 +183,36 @@ public String namespacePrefix(String name) {\n     }\n \n     public void setResourceNames(List<String> resourceNames) {\n-        this.resourceNames = Objects.requireNonNull(resourceNames);\n+        this.resourceNames.addAll(Objects.requireNonNull(resourceNames));\n     }\n \n     public void setClassPropertyNames(List<String> classPropertyNames) {\n-        this.classPropertyNames = Objects.requireNonNull(classPropertyNames);\n+        this.classPropertyNames.addAll(Objects.requireNonNull(classPropertyNames));\n     }\n \n     public boolean isClassProperty(String name) {\n         return classPropertyNames.contains(name);\n     }\n \n+    public void setMultivaluedProperty(List<String> multiValuedPropertyNames) {\n+        this.multiValuedPropertyNames.addAll(Objects.requireNonNull(multiValuedPropertyNames));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de47779ee06033672b959e9f934154fdc5060a78"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e093b258fbc5d83a34f1c9756c0cf2f43410c065", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/e093b258fbc5d83a34f1c9756c0cf2f43410c065", "committedDate": "2020-03-12T15:23:29Z", "message": "Merge branch 'master' into cgmes_update_simple_update_sv_file\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "125675c0761b6873a337f15bc453f93313bfbf00", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/125675c0761b6873a337f15bc453f93313bfbf00", "committedDate": "2020-03-13T09:45:40Z", "message": "use singletonList; reduce complexity for addPowerFlowToCgmes(); set as final fields StateVariablesAdder; add default implementation in CgmesModel new methods; clear PropertyBag local fields before addAll\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27bfaf640a665af273e04e42a7ab415c4ed856ab", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/27bfaf640a665af273e04e42a7ab415c4ed856ab", "committedDate": "2020-03-13T09:46:21Z", "message": "Merge branch 'master' into cgmes_update_simple_update_sv_file\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0MjA2Mzkw", "url": "https://github.com/powsybl/powsybl-core/pull/1201#pullrequestreview-374206390", "createdAt": "2020-03-13T10:50:50Z", "commit": {"oid": "27bfaf640a665af273e04e42a7ab415c4ed856ab"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0MzU2OTQ3", "url": "https://github.com/powsybl/powsybl-core/pull/1201#pullrequestreview-374356947", "createdAt": "2020-03-13T14:44:15Z", "commit": {"oid": "27bfaf640a665af273e04e42a7ab415c4ed856ab"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NDA0MTI4", "url": "https://github.com/powsybl/powsybl-core/pull/1201#pullrequestreview-374404128", "createdAt": "2020-03-13T15:41:05Z", "commit": {"oid": "27bfaf640a665af273e04e42a7ab415c4ed856ab"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNTo0MTowNVrOF2IgoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNTo0OToyOFrOF2I0lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMwNjg0OA==", "bodyText": "You should use leg.hasPhaseTapChanger() that is more human readable.", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r392306848", "createdAt": "2020-03-13T15:41:05Z", "author": {"login": "mathbagu"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/StateVariablesAdder.java", "diffHunk": "@@ -100,20 +203,99 @@ public static void add(Network n, CgmesModel cgmes) {\n                 tapSteps.add(p);\n             }\n         }\n-        cgmes.add(CgmesSubset.STATE_VARIABLES, \"SvTapStep\", tapSteps);\n+\n+        for (ThreeWindingsTransformer t : network.getThreeWindingsTransformers()) {\n+            PropertyBag p = new PropertyBag(svTapStepProperties);\n+            Arrays.asList(t.getLeg1(), t.getLeg2(), t.getLeg3()).forEach(leg -> {\n+                if (leg.getPhaseTapChanger() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27bfaf640a665af273e04e42a7ab415c4ed856ab"}, "originalPosition": 232}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMwNzE0Mw==", "bodyText": "Same improvement using leg.hasRatioTapChanger()", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r392307143", "createdAt": "2020-03-13T15:41:31Z", "author": {"login": "mathbagu"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/StateVariablesAdder.java", "diffHunk": "@@ -100,20 +203,99 @@ public static void add(Network n, CgmesModel cgmes) {\n                 tapSteps.add(p);\n             }\n         }\n-        cgmes.add(CgmesSubset.STATE_VARIABLES, \"SvTapStep\", tapSteps);\n+\n+        for (ThreeWindingsTransformer t : network.getThreeWindingsTransformers()) {\n+            PropertyBag p = new PropertyBag(svTapStepProperties);\n+            Arrays.asList(t.getLeg1(), t.getLeg2(), t.getLeg3()).forEach(leg -> {\n+                if (leg.getPhaseTapChanger() != null) {\n+                    p.put(tapChangerPositionName, is(leg.getPhaseTapChanger().getTapPosition()));\n+                    p.put(CgmesNames.TAP_CHANGER, cgmes.phaseTapChangerForPowerTransformer(t.getId()));\n+                    tapSteps.add(p);\n+                } else if (leg.getRatioTapChanger() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27bfaf640a665af273e04e42a7ab415c4ed856ab"}, "originalPosition": 236}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMwNzkzMg==", "bodyText": "It could be a good idea to add this convenient feature to the network.", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r392307932", "createdAt": "2020-03-13T15:42:51Z", "author": {"login": "mathbagu"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/StateVariablesAdder.java", "diffHunk": "@@ -100,20 +203,99 @@ public static void add(Network n, CgmesModel cgmes) {\n                 tapSteps.add(p);\n             }\n         }\n-        cgmes.add(CgmesSubset.STATE_VARIABLES, \"SvTapStep\", tapSteps);\n+\n+        for (ThreeWindingsTransformer t : network.getThreeWindingsTransformers()) {\n+            PropertyBag p = new PropertyBag(svTapStepProperties);\n+            Arrays.asList(t.getLeg1(), t.getLeg2(), t.getLeg3()).forEach(leg -> {\n+                if (leg.getPhaseTapChanger() != null) {\n+                    p.put(tapChangerPositionName, is(leg.getPhaseTapChanger().getTapPosition()));\n+                    p.put(CgmesNames.TAP_CHANGER, cgmes.phaseTapChangerForPowerTransformer(t.getId()));\n+                    tapSteps.add(p);\n+                } else if (leg.getRatioTapChanger() != null) {\n+                    p.put(tapChangerPositionName, is(leg.getRatioTapChanger().getTapPosition()));\n+                    p.put(CgmesNames.TAP_CHANGER, cgmes.ratioTapChangerForPowerTransformer(t.getId()));\n+                    tapSteps.add(p);\n+                }\n+            });\n+        }\n+\n+        cgmes.add(originalSVcontext, \"SvTapStep\", tapSteps);\n+    }\n+\n+    private void addStatusToCgmes() {\n+        // create SvStatus, iterate on Connectables, check Terminal status, add\n+        // to SvStatus\n+        PropertyBags svStatus = new PropertyBags();\n+        network.getVoltageLevelStream()\n+            .flatMap(VoltageLevel::getConnectableStream)\n+            .distinct()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27bfaf640a665af273e04e42a7ab415c4ed856ab"}, "originalPosition": 253}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMwODkzNw==", "bodyText": "Not sure this is OK: If a line is connected on side 1 but disconnected on side 2, I'm not sure the IN_SERVICE should be true.", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r392308937", "createdAt": "2020-03-13T15:44:32Z", "author": {"login": "mathbagu"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/StateVariablesAdder.java", "diffHunk": "@@ -100,20 +203,99 @@ public static void add(Network n, CgmesModel cgmes) {\n                 tapSteps.add(p);\n             }\n         }\n-        cgmes.add(CgmesSubset.STATE_VARIABLES, \"SvTapStep\", tapSteps);\n+\n+        for (ThreeWindingsTransformer t : network.getThreeWindingsTransformers()) {\n+            PropertyBag p = new PropertyBag(svTapStepProperties);\n+            Arrays.asList(t.getLeg1(), t.getLeg2(), t.getLeg3()).forEach(leg -> {\n+                if (leg.getPhaseTapChanger() != null) {\n+                    p.put(tapChangerPositionName, is(leg.getPhaseTapChanger().getTapPosition()));\n+                    p.put(CgmesNames.TAP_CHANGER, cgmes.phaseTapChangerForPowerTransformer(t.getId()));\n+                    tapSteps.add(p);\n+                } else if (leg.getRatioTapChanger() != null) {\n+                    p.put(tapChangerPositionName, is(leg.getRatioTapChanger().getTapPosition()));\n+                    p.put(CgmesNames.TAP_CHANGER, cgmes.ratioTapChangerForPowerTransformer(t.getId()));\n+                    tapSteps.add(p);\n+                }\n+            });\n+        }\n+\n+        cgmes.add(originalSVcontext, \"SvTapStep\", tapSteps);\n+    }\n+\n+    private void addStatusToCgmes() {\n+        // create SvStatus, iterate on Connectables, check Terminal status, add\n+        // to SvStatus\n+        PropertyBags svStatus = new PropertyBags();\n+        network.getVoltageLevelStream()\n+            .flatMap(VoltageLevel::getConnectableStream)\n+            .distinct()\n+            .forEach(c -> {\n+                PropertyBag p = new PropertyBag(SV_SVSTATUS_PROPERTIES);\n+                for (Terminal t : ((Connectable<?>) c).getTerminals()) {\n+                    p.put(IN_SERVICE, Boolean.toString(t.isConnected()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27bfaf640a665af273e04e42a7ab415c4ed856ab"}, "originalPosition": 257}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMwOTQzNQ==", "bodyText": "Are you sure this check is needed: in which case the terminal is null?", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r392309435", "createdAt": "2020-03-13T15:45:24Z", "author": {"login": "mathbagu"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/StateVariablesAdder.java", "diffHunk": "@@ -100,20 +203,99 @@ public static void add(Network n, CgmesModel cgmes) {\n                 tapSteps.add(p);\n             }\n         }\n-        cgmes.add(CgmesSubset.STATE_VARIABLES, \"SvTapStep\", tapSteps);\n+\n+        for (ThreeWindingsTransformer t : network.getThreeWindingsTransformers()) {\n+            PropertyBag p = new PropertyBag(svTapStepProperties);\n+            Arrays.asList(t.getLeg1(), t.getLeg2(), t.getLeg3()).forEach(leg -> {\n+                if (leg.getPhaseTapChanger() != null) {\n+                    p.put(tapChangerPositionName, is(leg.getPhaseTapChanger().getTapPosition()));\n+                    p.put(CgmesNames.TAP_CHANGER, cgmes.phaseTapChangerForPowerTransformer(t.getId()));\n+                    tapSteps.add(p);\n+                } else if (leg.getRatioTapChanger() != null) {\n+                    p.put(tapChangerPositionName, is(leg.getRatioTapChanger().getTapPosition()));\n+                    p.put(CgmesNames.TAP_CHANGER, cgmes.ratioTapChangerForPowerTransformer(t.getId()));\n+                    tapSteps.add(p);\n+                }\n+            });\n+        }\n+\n+        cgmes.add(originalSVcontext, \"SvTapStep\", tapSteps);\n+    }\n+\n+    private void addStatusToCgmes() {\n+        // create SvStatus, iterate on Connectables, check Terminal status, add\n+        // to SvStatus\n+        PropertyBags svStatus = new PropertyBags();\n+        network.getVoltageLevelStream()\n+            .flatMap(VoltageLevel::getConnectableStream)\n+            .distinct()\n+            .forEach(c -> {\n+                PropertyBag p = new PropertyBag(SV_SVSTATUS_PROPERTIES);\n+                for (Terminal t : ((Connectable<?>) c).getTerminals()) {\n+                    p.put(IN_SERVICE, Boolean.toString(t.isConnected()));\n+                }\n+                p.put(CgmesNames.CONDUCTING_EQUIPMENT, c.getId());\n+                svStatus.add(p);\n+            });\n+\n+        // SvStatus at boundaries set as it was in original cgmes.\n+        for (PropertyBag terminal : originalTerminals) {\n+            Objects.requireNonNull(terminal);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27bfaf640a665af273e04e42a7ab415c4ed856ab"}, "originalPosition": 265}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMxMTk1OQ==", "bodyText": "This test is not necessary, the for-each at line 323 seems sufficient. If it's empty the `byTopologicalIslandId will be empty, and the for-each loop at line 336 won't loop.", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r392311959", "createdAt": "2020-03-13T15:49:28Z", "author": {"login": "mathbagu"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/StateVariablesAdder.java", "diffHunk": "@@ -127,22 +309,106 @@ private static PropertyBag createPowerFlowProperties(CgmesModel cgmes, Terminal\n         return p;\n     }\n \n+    // added TopologicalIsland as it was in cgmes : original topology is\n+    // preserved.\n+    private void addTopologicalIslandsToCgmes() {\n+        if (!originalTopologicalIslands.isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27bfaf640a665af273e04e42a7ab415c4ed856ab"}, "originalPosition": 336}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "264b1727ef26a77de07652028b3328d10177a8f7", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/264b1727ef26a77de07652028b3328d10177a8f7", "committedDate": "2020-03-16T11:04:04Z", "message": "fix changes requested for PR 1201 in StateVariablesAdder\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "457e6cfa4b2228682f8fd9cba9fc8c57f670d497", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/457e6cfa4b2228682f8fd9cba9fc8c57f670d497", "committedDate": "2020-03-16T14:34:14Z", "message": "Merge branch 'master' into cgmes_update_simple_update_sv_file\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64a9c024b6dde5f3ef90b74139506e42c50b8cc4", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/64a9c024b6dde5f3ef90b74139506e42c50b8cc4", "committedDate": "2020-03-16T15:02:16Z", "message": "added hasPhaseTapChanger and hasRatioTapChanger methods; svStatus is get from any connected Terminal\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MDYxNzk2", "url": "https://github.com/powsybl/powsybl-core/pull/1201#pullrequestreview-376061796", "createdAt": "2020-03-17T14:01:42Z", "commit": {"oid": "64a9c024b6dde5f3ef90b74139506e42c50b8cc4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d086521d6f0a955c867927bd827b196208732527", "author": {"user": {"login": "MioRtia", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/d086521d6f0a955c867927bd827b196208732527", "committedDate": "2020-03-17T14:01:52Z", "message": "Merge branch 'master' into cgmes_update_simple_update_sv_file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d457762ead2373221373eceaf84cddd72ae12790", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/d457762ead2373221373eceaf84cddd72ae12790", "committedDate": "2019-10-30T10:01:03Z", "message": "Add clone functionality for triplestore and cgmes implementations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7015c51fb785cc129b5090055c08cdb2608528c8", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/7015c51fb785cc129b5090055c08cdb2608528c8", "committedDate": "2019-10-30T13:44:35Z", "message": "clean up tests for clone; clean redundant method in blazegraph"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "754f6a8623263ce480aaf41894e402ba9f066a47", "author": {"user": {"login": "zamarrenolm", "name": "Luma"}}, "url": "https://github.com/powsybl/powsybl-core/commit/754f6a8623263ce480aaf41894e402ba9f066a47", "committedDate": "2019-10-30T14:36:28Z", "message": "name of test resource\n\nSigned-off-by: Luma Zamarren\u0303o <zamarrenolm@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e055a7915b7ea032d518ad70347ee2e17dfe1d91", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/e055a7915b7ea032d518ad70347ee2e17dfe1d91", "committedDate": "2019-10-30T15:44:56Z", "message": "changes in model will not be included in this pr"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e03f9bd0d92ea2e1540284a82c68ff6a2da418bd", "author": {"user": {"login": "zamarrenolm", "name": "Luma"}}, "url": "https://github.com/powsybl/powsybl-core/commit/e03f9bd0d92ea2e1540284a82c68ff6a2da418bd", "committedDate": "2019-10-31T12:13:10Z", "message": "rename test for triplestore copy; complete test for triplestore clear\n\nSigned-off-by: Luma Zamarren\u0303o <zamarrenolm@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64eb4f25b91a61b1a7854c5223cde5e2d6010948", "author": {"user": {"login": "zamarrenolm", "name": "Luma"}}, "url": "https://github.com/powsybl/powsybl-core/commit/64eb4f25b91a61b1a7854c5223cde5e2d6010948", "committedDate": "2019-10-31T12:40:16Z", "message": "triplestore factory copy; fix copy test (store copies of all triplestore implementations)\n\nSigned-off-by: Luma Zamarren\u0303o <zamarrenolm@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b88b5ad9a1110e7521ef992f2d04fc046129d140", "author": {"user": {"login": "zamarrenolm", "name": "Luma"}}, "url": "https://github.com/powsybl/powsybl-core/commit/b88b5ad9a1110e7521ef992f2d04fc046129d140", "committedDate": "2019-10-31T17:31:22Z", "message": "copy receives only source triplestore; uniform naming; simplify copy loops; test same namespaces in source and target\n\nSigned-off-by: Luma Zamarren\u0303o <zamarrenolm@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3cd73703d3b91db3ba83592cf699fa44b5c7b39", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/c3cd73703d3b91db3ba83592cf699fa44b5c7b39", "committedDate": "2019-11-05T11:03:16Z", "message": "Add update functionality for triplestore implementations\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c9232667cc20d1b3e41bd9e0f909165e322407d", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/5c9232667cc20d1b3e41bd9e0f909165e322407d", "committedDate": "2019-11-05T11:22:24Z", "message": "Merge branch 'master' into cmges_update_triplestore_update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e56852cd6cffddc91b0c6c6d92b6cfa45966a6f", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/1e56852cd6cffddc91b0c6c6d92b6cfa45966a6f", "committedDate": "2019-11-06T09:14:03Z", "message": "Merge branch 'master' into cmges_update_triplestore_update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e046536866ade78238e826c1e33204fcfd9f6fa2", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/e046536866ade78238e826c1e33204fcfd9f6fa2", "committedDate": "2019-11-06T11:09:29Z", "message": "merge changes from cmges_update_triplestore_copy branch; prepare current for PR"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edc12cddfb3a37e03bc8d9292bbaa31d7f667881", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/edc12cddfb3a37e03bc8d9292bbaa31d7f667881", "committedDate": "2019-11-06T15:17:27Z", "message": "merge changes from cmges_update_triplestore_copy branch; prepare current for PR\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7bf3afe8bf50ee7a3faff45d42955cd373ef88f", "author": {"user": {"login": "zamarrenolm", "name": "Luma"}}, "url": "https://github.com/powsybl/powsybl-core/commit/b7bf3afe8bf50ee7a3faff45d42955cd373ef88f", "committedDate": "2019-11-11T15:53:28Z", "message": "Merge branch 'master' into cmges_update_triplestore_update\n\nSigned-off-by: Luma Zamarren\u0303o <zamarrenolm@aia.es>\n\n# Conflicts:\n#\ttriple-store/triple-store-impl-blazegraph/src/main/java/com/powsybl/triplestore/impl/blazegraph/TripleStoreBlazegraph.java\n#\ttriple-store/triple-store-impl-jena/src/main/java/com/powsybl/triplestore/impl/jena/TripleStoreJena.java\n#\ttriple-store/triple-store-impl-rdf4j/src/main/java/com/powsybl/triplestore/impl/rdf4j/TripleStoreRDF4J.java\n#\ttriple-store/triple-store-test/src/test/java/com/powsybl/triplestore/test/TripleStoreCopyTest.java\n#\ttriple-store/triple-store-test/src/test/java/com/powsybl/triplestore/test/TripleStoreTester.java\n#\ttriple-store/triple-store-test/src/test/resources/foaf/foaf.sparql"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "317edc2f9c082ddf628ccb644100aa5d9c8b7fd3", "author": {"user": {"login": "zamarrenolm", "name": "Luma"}}, "url": "https://github.com/powsybl/powsybl-core/commit/317edc2f9c082ddf628ccb644100aa5d9c8b7fd3", "committedDate": "2019-11-11T16:23:03Z", "message": "reload data for every update test; format queries\n\nSigned-off-by: Luma Zamarren\u0303o <zamarrenolm@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d6fe8d957086af6dc5ab3ef40d0ba7b38b602fa", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/7d6fe8d957086af6dc5ab3ef40d0ba7b38b602fa", "committedDate": "2019-11-12T08:38:06Z", "message": "Merge branch 'master' into cmges_update_triplestore_update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e684d7e91b11be23774d730b048b9b9c6f08efe2", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/e684d7e91b11be23774d730b048b9b9c6f08efe2", "committedDate": "2019-11-12T10:18:03Z", "message": "load test data from @Before for each test\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3fc5680af73c11e578d292d632e3cf770b08e90", "author": {"user": {"login": "zamarrenolm", "name": "Luma"}}, "url": "https://github.com/powsybl/powsybl-core/commit/d3fc5680af73c11e578d292d632e3cf770b08e90", "committedDate": "2019-11-12T17:30:48Z", "message": "Merge branch 'cmges_update_triplestore_update' into cgmes_update_v2\n\nSigned-off-by: Luma Zamarren\u0303o <zamarrenolm@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc79f87d39dfc27b16105e88aa5b1886f5b31ddc", "author": {"user": {"login": "zamarrenolm", "name": "Luma"}}, "url": "https://github.com/powsybl/powsybl-core/commit/fc79f87d39dfc27b16105e88aa5b1886f5b31ddc", "committedDate": "2019-11-14T16:53:48Z", "message": "perform only simple updates on CGMES model\n\nSigned-off-by: Luma Zamarren\u0303o <zamarrenolm@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fdaa31fefd67a30fe13727c94b37681a333e094a", "author": {"user": {"login": "zamarrenolm", "name": "Luma"}}, "url": "https://github.com/powsybl/powsybl-core/commit/fdaa31fefd67a30fe13727c94b37681a333e094a", "committedDate": "2019-11-14T16:56:41Z", "message": "Merge branch 'master' into cgmes_update_simple_update\n\nSigned-off-by: Luma Zamarren\u0303o <zamarrenolm@aia.es>\n\n# Conflicts:\n#\ttriple-store/triple-store-test/src/test/java/com/powsybl/triplestore/test/TripleStoreUpdateTest.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "905b729588fea9a9f7880b5fb058460dab807926", "author": {"user": {"login": "zamarrenolm", "name": "Luma"}}, "url": "https://github.com/powsybl/powsybl-core/commit/905b729588fea9a9f7880b5fb058460dab807926", "committedDate": "2019-11-14T17:24:36Z", "message": "use CGMES subset as context (graph) reference\n\nSigned-off-by: Luma Zamarren\u0303o <zamarrenolm@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfc8d35cbfa655dbd1d96b965149d963a0398d5b", "author": {"user": {"login": "zamarrenolm", "name": "Luma"}}, "url": "https://github.com/powsybl/powsybl-core/commit/cfc8d35cbfa655dbd1d96b965149d963a0398d5b", "committedDate": "2019-11-15T09:07:26Z", "message": "optimize value replacement in update query\n\nSigned-off-by: Luma Zamarren\u0303o <zamarrenolm@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d9fe63501b456275f8a758783897f4ba4edb308", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/5d9fe63501b456275f8a758783897f4ba4edb308", "committedDate": "2019-11-15T13:33:52Z", "message": "Merge branch 'master' into cgmes_update_simple_update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a61d7f939f3cad3b0fa1463b6a405513890cedfd", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/a61d7f939f3cad3b0fa1463b6a405513890cedfd", "committedDate": "2019-11-15T16:03:22Z", "message": "Correct TripleStoreChangeParams and SPARQL Update query\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90c85362148ff5f8f1d961bd5523053abe3195a1", "author": {"user": {"login": "zamarrenolm", "name": "Luma"}}, "url": "https://github.com/powsybl/powsybl-core/commit/90c85362148ff5f8f1d961bd5523053abe3195a1", "committedDate": "2019-11-15T16:28:37Z", "message": "refine valid name check for CGMES subsets\n\nSigned-off-by: Luma Zamarren\u0303o <zamarrenolm@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b71e6839703beb634cf6d638532235189a2674b0", "author": {"user": {"login": "zamarrenolm", "name": "Luma"}}, "url": "https://github.com/powsybl/powsybl-core/commit/b71e6839703beb634cf6d638532235189a2674b0", "committedDate": "2019-11-15T16:29:22Z", "message": "log additional info if error is found writing CGMES\n\nSigned-off-by: Luma Zamarren\u0303o <zamarrenolm@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5752d469834b8b388958b28d1940841c634fb039", "author": {"user": {"login": "zamarrenolm", "name": "Luma"}}, "url": "https://github.com/powsybl/powsybl-core/commit/5752d469834b8b388958b28d1940841c634fb039", "committedDate": "2019-11-15T16:30:59Z", "message": "perform and check simple updates (one to one mapping to CGMES attributes)\n\nSigned-off-by: Luma Zamarren\u0303o <zamarrenolm@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec4d44c45a3683f5f73af79ea944197eec661501", "author": {"user": {"login": "zamarrenolm", "name": "Luma"}}, "url": "https://github.com/powsybl/powsybl-core/commit/ec4d44c45a3683f5f73af79ea944197eec661501", "committedDate": "2019-11-15T16:46:45Z", "message": "license and author information\n\nSigned-off-by: Luma Zamarren\u0303o <zamarrenolm@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4111dab939e8ecedd316507a160d5cecd87c2a51", "author": {"user": {"login": "zamarrenolm", "name": "Luma"}}, "url": "https://github.com/powsybl/powsybl-core/commit/4111dab939e8ecedd316507a160d5cecd87c2a51", "committedDate": "2019-11-15T17:22:52Z", "message": "add tests, fix valid name for CGMES boundary subsets\n\nSigned-off-by: Luma Zamarren\u0303o <zamarrenolm@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5600666cafada1779632a722bc1eaa4ede2843cf", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/5600666cafada1779632a722bc1eaa4ede2843cf", "committedDate": "2019-11-19T07:35:02Z", "message": "add test for general network change\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a94c40994640bbc6024e86c2a966332d2dfafc68", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/a94c40994640bbc6024e86c2a966332d2dfafc68", "committedDate": "2019-11-19T07:55:31Z", "message": "merging changes from remote\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "445fbcb64e3af30e07603e11d45807ba0c0c6bab", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/445fbcb64e3af30e07603e11d45807ba0c0c6bab", "committedDate": "2019-11-19T10:05:41Z", "message": "Add test for cloned Variant; format SPARQL update query\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10d2e843836410cbf9f1bf6737ea4fca7303ac32", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/10d2e843836410cbf9f1bf6737ea4fca7303ac32", "committedDate": "2019-11-19T10:08:42Z", "message": "Merge branch 'master' into cgmes_update_simple_update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc5ffd44af524484bd09a13c171f2ea627256324", "author": {"user": {"login": "zamarrenolm", "name": "Luma"}}, "url": "https://github.com/powsybl/powsybl-core/commit/dc5ffd44af524484bd09a13c171f2ea627256324", "committedDate": "2019-11-19T11:42:36Z", "message": "consider changes on base and changes that are variant-specific\n\nSigned-off-by: Luma Zamarren\u0303o <zamarrenolm@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "287eb8717db1123e105ede72a2eb134a53fa83da", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/287eb8717db1123e105ede72a2eb134a53fa83da", "committedDate": "2019-11-19T14:14:24Z", "message": "Implement variant test for base changes and variant specific\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c70d5b44a4e40f53ae32a371ec4482118286a49", "author": {"user": {"login": "zamarrenolm", "name": "Luma"}}, "url": "https://github.com/powsybl/powsybl-core/commit/7c70d5b44a4e40f53ae32a371ec4482118286a49", "committedDate": "2019-11-19T15:16:11Z", "message": "comments\n\nSigned-off-by: Luma Zamarren\u0303o <zamarrenolm@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42b46df12b20fe84091623e73ac753dd8d837c22", "author": {"user": {"login": "zamarrenolm", "name": "Luma"}}, "url": "https://github.com/powsybl/powsybl-core/commit/42b46df12b20fe84091623e73ac753dd8d837c22", "committedDate": "2019-11-19T15:17:43Z", "message": "Merge branch 'master' into cgmes_update_simple_update\n\nSigned-off-by: Luma Zamarren\u0303o <zamarrenolm@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a98b0f0ef1eb1dd6755deb23f9f8c4e7c16f373", "author": {"user": {"login": "zamarrenolm", "name": "Luma"}}, "url": "https://github.com/powsybl/powsybl-core/commit/3a98b0f0ef1eb1dd6755deb23f9f8c4e7c16f373", "committedDate": "2019-11-19T15:27:00Z", "message": "adjust comment\n\nSigned-off-by: Luma Zamarren\u0303o <zamarrenolm@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80ce2ec1e35c3a6bf3c0d56b344ef2005d205033", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/80ce2ec1e35c3a6bf3c0d56b344ef2005d205033", "committedDate": "2019-11-20T13:49:37Z", "message": "fix PR review issues\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61ba192e08d5809e7df4f0687b26916a2aad9577", "author": {"user": {"login": "zamarrenolm", "name": "Luma"}}, "url": "https://github.com/powsybl/powsybl-core/commit/61ba192e08d5809e7df4f0687b26916a2aad9577", "committedDate": "2019-11-20T14:19:59Z", "message": "adjust error messages; new value on update change may be null\n\nSigned-off-by: Luma Zamarren\u0303o <zamarrenolm@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63eb977bf4e45757e41e708f6234b4318617ce32", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/63eb977bf4e45757e41e708f6234b4318617ce32", "committedDate": "2019-11-20T15:11:07Z", "message": "add nonNull assert\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34b9537fa90e2d0aeda4cadfe5f96f153520c842", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/34b9537fa90e2d0aeda4cadfe5f96f153520c842", "committedDate": "2019-11-20T16:46:22Z", "message": "Remove Profiling code\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a25f7bd2f6a78e516bbeff037ae8d83319d0fda", "author": {"user": {"login": "zamarrenolm", "name": "Luma"}}, "url": "https://github.com/powsybl/powsybl-core/commit/5a25f7bd2f6a78e516bbeff037ae8d83319d0fda", "committedDate": "2019-11-21T09:48:56Z", "message": "remove unneeded code\n\nSigned-off-by: Luma Zamarren\u0303o <zamarrenolm@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80d950dfd7d87049d4df64691f816d04accffba5", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/80d950dfd7d87049d4df64691f816d04accffba5", "committedDate": "2019-11-21T13:55:02Z", "message": "add test for Creation / Removal events being added to changelog\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62f2b8b7589418910f267de72499ddcf73d900e4", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/62f2b8b7589418910f267de72499ddcf73d900e4", "committedDate": "2019-11-21T15:22:52Z", "message": "remove unused code\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "055c8f5ae14b440be8fb51e789af3ff301fdec58", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/055c8f5ae14b440be8fb51e789af3ff301fdec58", "committedDate": "2019-11-29T10:04:35Z", "message": "Merge branch 'master' into cgmes_update_simple_update\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b457c5471b06d307e139547823a3758b62a81524", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/b457c5471b06d307e139547823a3758b62a81524", "committedDate": "2019-12-04T10:51:37Z", "message": "Merge branch 'master' into cgmes_update_simple_update_sv_bus_tp\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3ea9acc06db905e2b806b27a171f460f73aaaf5", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/d3ea9acc06db905e2b806b27a171f460f73aaaf5", "committedDate": "2019-12-10T12:19:15Z", "message": "add logic for getting Model related TopologicalNodes from boundaries\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "832ef4d843ca4a753be1fb09112558d28a90cc8e", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/832ef4d843ca4a753be1fb09112558d28a90cc8e", "committedDate": "2019-12-10T16:57:54Z", "message": "add logic for getting Model related TopologicalNodes from boundaries, for SV data\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "253d8122ea8139c8c5f91c0fb64e1a3dc112d4e5", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/253d8122ea8139c8c5f91c0fb64e1a3dc112d4e5", "committedDate": "2019-12-11T08:27:52Z", "message": "Adjust method naming\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "280bfe1eb0ea45c1372f63e66e3b5d471c86cfcc", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/280bfe1eb0ea45c1372f63e66e3b5d471c86cfcc", "committedDate": "2019-12-11T15:58:55Z", "message": "Add calculation for complex voltage for boundary TopologicalNodes\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "642961cf7c7b8530d2a1e9079bb1b8da42fe92ef", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/642961cf7c7b8530d2a1e9079bb1b8da42fe92ef", "committedDate": "2019-12-16T11:04:10Z", "message": "add SvStatus calculation\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5b8380bbc9130c32c4cd9afcd7a6564d6f27af6", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/d5b8380bbc9130c32c4cd9afcd7a6564d6f27af6", "committedDate": "2019-12-16T16:29:42Z", "message": "PowerFlow at boundaries set as it was in original cgmes.\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e47f592996c3481618647f2034b607751520b9f", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/1e47f592996c3481618647f2034b607751520b9f", "committedDate": "2019-12-16T17:04:50Z", "message": "merge master into head branch\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abb577c7d1721106963b54662089057c2a12ac91", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/abb577c7d1721106963b54662089057c2a12ac91", "committedDate": "2019-12-17T14:13:45Z", "message": "add SvStatus for ConductingEquipment for TopologicalNodes in boundaries\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e52a38cb1d36240e290be866acf53c08c1f47e1d", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/e52a38cb1d36240e290be866acf53c08c1f47e1d", "committedDate": "2019-12-19T14:43:14Z", "message": "Add FullModel statements for exported cgmes model\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2bcc8e9bdfdc24383513dae67ce60c822cfddb03", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/2bcc8e9bdfdc24383513dae67ce60c822cfddb03", "committedDate": "2019-12-20T12:20:53Z", "message": "Add TopologicalIsland statements for exported cgmes model\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2f96ca8be0988d2fd140ce0179b3dc98fb59e9e", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/a2f96ca8be0988d2fd140ce0179b3dc98fb59e9e", "committedDate": "2019-12-23T11:58:57Z", "message": "Add constants for CgmenNames and fix string usage; move check for multiValue to PropertiBag object; Fix namig for new methods, fix writing modelDescription :about\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca9aca8408cc19e7dc0603fde6a3afdd4c17c38b", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/ca9aca8408cc19e7dc0603fde6a3afdd4c17c38b", "committedDate": "2019-12-23T13:32:03Z", "message": "tmp test for SV hsould not be run, will be removed\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1cfd4f16390c8c83c6d5bfd51955142e1b690e9e", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/1cfd4f16390c8c83c6d5bfd51955142e1b690e9e", "committedDate": "2019-12-23T13:34:12Z", "message": "Merge branch 'master' into cgmes_update_simple_update_sv_bus_tp\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f4fc96c77be9a0a0be489c984d0cd7b732d425f", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/3f4fc96c77be9a0a0be489c984d0cd7b732d425f", "committedDate": "2019-12-27T10:46:35Z", "message": "add null checks\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ca8a8ec0f5a53d8ef441d7b9cf824eb3bacd291", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/6ca8a8ec0f5a53d8ef441d7b9cf824eb3bacd291", "committedDate": "2019-12-30T08:41:27Z", "message": "Merge branch 'master' into cgmes_update_simple_update_sv_file\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9a0d32601aa6cb08dcff1242b0d5bd68506ec81", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/f9a0d32601aa6cb08dcff1242b0d5bd68506ec81", "committedDate": "2019-12-30T15:45:06Z", "message": "Add IdentifiedObject.name to topologicalIslands; move multiValued properties and fullModel handling from rdf4j to PropertyBag; fix constants for SonarLint\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e31277b671128cba0651516ace242e36821359dc", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/e31277b671128cba0651516ace242e36821359dc", "committedDate": "2019-12-30T16:05:46Z", "message": "fix topologicalIsland SV creation\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9327af4e1a58a522c38d1567129efba626a044e9", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/9327af4e1a58a522c38d1567129efba626a044e9", "committedDate": "2020-01-02T11:26:57Z", "message": "LinkDataTmp included temporarily, until is merged into master from its branch\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c9a8424446b1bec079666cf469375d2c4e129af", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/4c9a8424446b1bec079666cf469375d2c4e129af", "committedDate": "2020-01-22T09:42:41Z", "message": "merge from master\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae3103b6bb65977d81e9eca0e7f18b0ca4bfe80a", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/ae3103b6bb65977d81e9eca0e7f18b0ca4bfe80a", "committedDate": "2020-01-22T13:10:58Z", "message": "Merge branch 'master' into cgmes_update_simple_update_sv_file\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "407aaa3fe07d2bec992897cc74cad78a59ff4e4f", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/407aaa3fe07d2bec992897cc74cad78a59ff4e4f", "committedDate": "2020-01-23T13:13:55Z", "message": "Merge branch 'master' into cgmes_update_simple_update_sv_file\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b975a9c97aa98125eefc511a483ce32ff497afc5", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/b975a9c97aa98125eefc511a483ce32ff497afc5", "committedDate": "2020-01-30T11:17:53Z", "message": "Merge branch 'master' into cgmes_update_simple_update_sv_file\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d5540a6f82bba36bf12bf42b87fe26c7905626e", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/0d5540a6f82bba36bf12bf42b87fe26c7905626e", "committedDate": "2020-01-31T10:05:37Z", "message": "Add original context name for CGMES SV output file\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a52e4ee4a5f4ecf00e302acb4d9407e8cee0beb4", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/a52e4ee4a5f4ecf00e302acb4d9407e8cee0beb4", "committedDate": "2020-01-31T10:26:01Z", "message": "Merge branch 'master' into cgmes_update_simple_update_sv_file\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce5db44516c2616cce706ebecfabc8131b5f5fbe", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/ce5db44516c2616cce706ebecfabc8131b5f5fbe", "committedDate": "2020-01-31T10:56:29Z", "message": "use LinkData class for CGMES StateVariablesAdder, remove LinkDataTmp\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb11be98249b8ce1031442fcc9ac52f888bfb549", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/bb11be98249b8ce1031442fcc9ac52f888bfb549", "committedDate": "2020-01-31T11:45:40Z", "message": "improve original context name for CGMES SV output file\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd3f3730f5be1b54ca463347c71269b593c8ae73", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/dd3f3730f5be1b54ca463347c71269b593c8ae73", "committedDate": "2020-01-31T13:52:06Z", "message": "add ThreeWindingsTransformer SvTapStep to cgmes SV context and output\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5be98aafd40b63ff073c949b5a30b91e30fe461", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/c5be98aafd40b63ff073c949b5a30b91e30fe461", "committedDate": "2020-02-05T08:37:03Z", "message": "Merge branch 'master' into cgmes_update_simple_update_sv_file\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "005676ef4af65e39bc290489deb8dc94de0e1c87", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/005676ef4af65e39bc290489deb8dc94de0e1c87", "committedDate": "2020-02-20T11:23:23Z", "message": "Merge branch 'master' into cgmes_update_simple_update_sv_file\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71871a589a27649f1790dcdf43ce9cd2fa7ae9c0", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/71871a589a27649f1790dcdf43ce9cd2fa7ae9c0", "committedDate": "2020-02-20T13:59:21Z", "message": "Reorganize methods in StateVariableAdder class\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "496949a615876f879d5a6b34d1ccc2018878c502", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/496949a615876f879d5a6b34d1ccc2018878c502", "committedDate": "2020-02-21T15:27:22Z", "message": "correct NodeBraker warning; add UnmodifiableList to Tx3 legs list; Move Terminals loop inside Connectable in SvStatus; fix check for cimVersion; fix NaN value for double\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2dbfd8663a5e17901cf897603a5a2d5deb34d42a", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/2dbfd8663a5e17901cf897603a5a2d5deb34d42a", "committedDate": "2020-02-21T17:26:10Z", "message": "In StateVariablesAdder: Reorganized add() method to reduce its Cognitive Complexity;Network moved to be an instance variable; cgmes.clear() moved inside add method;\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e55b52b86ff75572a558b4dca5cab0a5e0dfce6", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/8e55b52b86ff75572a558b4dca5cab0a5e0dfce6", "committedDate": "2020-02-21T17:27:15Z", "message": "Merge branch 'master' into cgmes_update_simple_update_sv_file\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "977068f72c7e1bcf9644af421626f93dac824da0", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/977068f72c7e1bcf9644af421626f93dac824da0", "committedDate": "2020-02-24T08:15:10Z", "message": "SvAdder: rename methods; if NodeBraker di return\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2f27bd2920ce493fe4a532946279f77fbc34d07", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/a2f27bd2920ce493fe4a532946279f77fbc34d07", "committedDate": "2020-03-01T19:38:51Z", "message": "store originalSV data as attributes; remove terminalsSV sparql; parametriza fullModel sparql query; add constant for full model to AbstractPowsyblTripleStore; add MD namespace to CgmesNamespace class; fix original cgmes SV context search from new \"graph\" sparql\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42dd38f405c2aaf3a3d3e6d188d743b96a9f213f", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/42dd38f405c2aaf3a3d3e6d188d743b96a9f213f", "committedDate": "2020-03-01T19:40:27Z", "message": "Merge branch 'master' into cgmes_update_simple_update_sv_file\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2805a3c5f0f4bec3deb4167f1572c8ab2b84ef8", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/d2805a3c5f0f4bec3deb4167f1572c8ab2b84ef8", "committedDate": "2020-03-02T12:11:11Z", "message": "add default context for SV adder\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a8e6590a78585ba7279969cf27785cf5085a691", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/1a8e6590a78585ba7279969cf27785cf5085a691", "committedDate": "2020-03-02T16:58:38Z", "message": "cosmetic fixes in SV adder clas: rename, split methods, others\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "949bf6f2e5647f221ba15fa358f2a83a08685d48", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/949bf6f2e5647f221ba15fa358f2a83a08685d48", "committedDate": "2020-03-03T15:48:24Z", "message": "add test for StateVariablesAdder\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e7a6aa3baf37286b36686e7cac6abe0e222f88b", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/4e7a6aa3baf37286b36686e7cac6abe0e222f88b", "committedDate": "2020-03-03T16:57:21Z", "message": "Merge branch 'master' into cgmes_update_simple_update_sv_file\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c5803a57c016ccc073c447f2f0b81bf799fd123", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/8c5803a57c016ccc073c447f2f0b81bf799fd123", "committedDate": "2020-03-03T17:20:18Z", "message": "add license to StateVariablesAdderTest\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NjAxMjYz", "url": "https://github.com/powsybl/powsybl-core/pull/1201#pullrequestreview-369601263", "createdAt": "2020-03-05T14:15:09Z", "commit": {"oid": "8c5803a57c016ccc073c447f2f0b81bf799fd123"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNDoxNTowOVrOFyVGYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNjoxOToxOFrOFyaQzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODMxODgxNw==", "bodyText": "Can be static", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r388318817", "createdAt": "2020-03-05T14:15:09Z", "author": {"login": "MioRtia"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/StateVariablesAdder.java", "diffHunk": "@@ -17,42 +26,122 @@\n import com.powsybl.cgmes.model.CgmesSubset;\n import com.powsybl.cgmes.model.triplestore.CgmesModelTripleStore;\n import com.powsybl.iidm.network.Bus;\n+import com.powsybl.iidm.network.Connectable;\n+import com.powsybl.iidm.network.DanglingLine;\n import com.powsybl.iidm.network.Generator;\n import com.powsybl.iidm.network.Load;\n import com.powsybl.iidm.network.Network;\n import com.powsybl.iidm.network.ShuntCompensator;\n import com.powsybl.iidm.network.Terminal;\n+import com.powsybl.iidm.network.ThreeWindingsTransformer;\n import com.powsybl.iidm.network.TwoWindingsTransformer;\n+import com.powsybl.iidm.network.VoltageLevel;\n+import com.powsybl.iidm.network.util.LinkData;\n+import com.powsybl.iidm.network.util.LinkData.BranchAdmittanceMatrix;\n import com.powsybl.triplestore.api.PropertyBag;\n import com.powsybl.triplestore.api.PropertyBags;\n \n /**\n  * @author Marcos de Miguel <demiguelm at aia.es>\n  * @author Luma Zamarre\u00f1o <zamarrenolm at aia.es>\n+ * @author Elena Kaltakova <kaltakovae at aia.es>\n  */\n-public final class StateVariablesAdder {\n+public class StateVariablesAdder {\n \n-    private StateVariablesAdder() {\n+    public StateVariablesAdder(CgmesModel cgmes, Network n) {\n+        this.cgmes = Objects.requireNonNull(cgmes);\n+        this.n = Objects.requireNonNull(n);\n+        this.cimVersion = ((CgmesModelTripleStore) cgmes).getCimVersion();\n+        this.originalTerminals = cgmes.terminals();\n+        this.originalFullModel = cgmes.fullModel(CgmesSubset.STATE_VARIABLES.getProfile());\n+        this.originalTopologicalIslands = cgmes.topologicalIslands();\n+        this.originalSVcontext = originalSVcontext();\n+        this.boundaryNodesFromDanglingLines = boundaryNodesFromDanglingLines();\n     }\n \n-    public static void add(Network n, CgmesModel cgmes) {\n-        // TODO Add full model data with proper profile (StateVariables)\n-        // FullModel is defined in ModelDescription:\n-        // http://iec.ch/TC57/61970-552/ModelDescription/1#\n+    private String originalSVcontext() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c5803a57c016ccc073c447f2f0b81bf799fd123"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODMyNTQ4Mw==", "bodyText": "Does it work from a node/breaker CGMES file? In this case, topological nodes ID are not kept, are they?", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r388325483", "createdAt": "2020-03-05T14:25:34Z", "author": {"login": "MioRtia"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/StateVariablesAdder.java", "diffHunk": "@@ -17,42 +26,122 @@\n import com.powsybl.cgmes.model.CgmesSubset;\n import com.powsybl.cgmes.model.triplestore.CgmesModelTripleStore;\n import com.powsybl.iidm.network.Bus;\n+import com.powsybl.iidm.network.Connectable;\n+import com.powsybl.iidm.network.DanglingLine;\n import com.powsybl.iidm.network.Generator;\n import com.powsybl.iidm.network.Load;\n import com.powsybl.iidm.network.Network;\n import com.powsybl.iidm.network.ShuntCompensator;\n import com.powsybl.iidm.network.Terminal;\n+import com.powsybl.iidm.network.ThreeWindingsTransformer;\n import com.powsybl.iidm.network.TwoWindingsTransformer;\n+import com.powsybl.iidm.network.VoltageLevel;\n+import com.powsybl.iidm.network.util.LinkData;\n+import com.powsybl.iidm.network.util.LinkData.BranchAdmittanceMatrix;\n import com.powsybl.triplestore.api.PropertyBag;\n import com.powsybl.triplestore.api.PropertyBags;\n \n /**\n  * @author Marcos de Miguel <demiguelm at aia.es>\n  * @author Luma Zamarre\u00f1o <zamarrenolm at aia.es>\n+ * @author Elena Kaltakova <kaltakovae at aia.es>\n  */\n-public final class StateVariablesAdder {\n+public class StateVariablesAdder {\n \n-    private StateVariablesAdder() {\n+    public StateVariablesAdder(CgmesModel cgmes, Network n) {\n+        this.cgmes = Objects.requireNonNull(cgmes);\n+        this.n = Objects.requireNonNull(n);\n+        this.cimVersion = ((CgmesModelTripleStore) cgmes).getCimVersion();\n+        this.originalTerminals = cgmes.terminals();\n+        this.originalFullModel = cgmes.fullModel(CgmesSubset.STATE_VARIABLES.getProfile());\n+        this.originalTopologicalIslands = cgmes.topologicalIslands();\n+        this.originalSVcontext = originalSVcontext();\n+        this.boundaryNodesFromDanglingLines = boundaryNodesFromDanglingLines();\n     }\n \n-    public static void add(Network n, CgmesModel cgmes) {\n-        // TODO Add full model data with proper profile (StateVariables)\n-        // FullModel is defined in ModelDescription:\n-        // http://iec.ch/TC57/61970-552/ModelDescription/1#\n+    private String originalSVcontext() {\n+        PropertyBags pbs = cgmes.graph();\n+        PropertyBag defaultSvContext = new PropertyBag(Arrays.asList(\"graph\"));\n+        defaultSvContext.put(\"graph\", CgmesSubset.STATE_VARIABLES.toString());\n+        return pbs.stream()\n+            .filter(graph -> graph.getId(\"graph\").contains(CgmesSubset.STATE_VARIABLES.getIdentifier()))\n+            .findAny()\n+            .orElse(defaultSvContext)\n+            .getId(\"graph\");\n+    }\n+\n+    public void addStateVariablesToCgmes() {\n+        if (cgmes.isNodeBreaker()) {\n+            // TODO we need to export SV file data for NodeBraker\n+            LOG.warn(\"NodeBreaker view require further investigation to map correctly Topological Nodes\");\n+            return;\n+        }\n+        // Clear the previous SV data in CGMES model\n+        // and fill it with the Network current state values\n+        cgmes.clear(CgmesSubset.STATE_VARIABLES);\n+\n+        if (cimVersion != 14) {\n+            addModelDescriptionToCgmes();\n+            addTopologicalIslandsToCgmes();\n+        }\n+\n+        addVoltagesForTopologicalNodes();\n+\n+        addVoltagesForBoundaryNodes();\n+\n+        addPowerFlowToCgmes();\n \n+        addShuntCompensatorSectionsToCgmes();\n+\n+        addTapStepToCgmes();\n+\n+        addStatusToCgmes();\n+    }\n+\n+    private void addVoltagesForTopologicalNodes() {\n         PropertyBags voltages = new PropertyBags();\n-        for (Bus b : n.getBusBreakerView().getBuses()) {\n+        // add voltages for TpNodes existing in the Model\n+        for (PropertyBag tn : cgmes.topologicalNodes()) {\n+            Bus b = n.getBusBreakerView().getBus(tn.getId(CgmesNames.TOPOLOGICAL_NODE));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c5803a57c016ccc073c447f2f0b81bf799fd123"}, "originalPosition": 106}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODMzNDE1NQ==", "bodyText": "Why are you wrapping it in unmodifiableList? It should work with Arrays.asList(...).forEach(...)", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r388334155", "createdAt": "2020-03-05T14:38:52Z", "author": {"login": "MioRtia"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/StateVariablesAdder.java", "diffHunk": "@@ -100,20 +210,109 @@ public static void add(Network n, CgmesModel cgmes) {\n                 tapSteps.add(p);\n             }\n         }\n-        cgmes.add(CgmesSubset.STATE_VARIABLES, \"SvTapStep\", tapSteps);\n+\n+        for (ThreeWindingsTransformer t : n.getThreeWindingsTransformers()) {\n+            PropertyBag p = new PropertyBag(svTapStepProperties);\n+            Collections.unmodifiableList(Arrays.asList(t.getLeg1(), t.getLeg2(), t.getLeg3())).forEach(leg -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c5803a57c016ccc073c447f2f0b81bf799fd123"}, "originalPosition": 221}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM1Njk3MA==", "bodyText": "Does the case c.getId() == null happen? If not, it may not be necessary to test it.", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r388356970", "createdAt": "2020-03-05T15:12:21Z", "author": {"login": "MioRtia"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/StateVariablesAdder.java", "diffHunk": "@@ -100,20 +210,109 @@ public static void add(Network n, CgmesModel cgmes) {\n                 tapSteps.add(p);\n             }\n         }\n-        cgmes.add(CgmesSubset.STATE_VARIABLES, \"SvTapStep\", tapSteps);\n+\n+        for (ThreeWindingsTransformer t : n.getThreeWindingsTransformers()) {\n+            PropertyBag p = new PropertyBag(svTapStepProperties);\n+            Collections.unmodifiableList(Arrays.asList(t.getLeg1(), t.getLeg2(), t.getLeg3())).forEach(leg -> {\n+                if (leg.getPhaseTapChanger() != null) {\n+                    p.put(tapChangerPositionName, is(leg.getPhaseTapChanger().getTapPosition()));\n+                    p.put(CgmesNames.TAP_CHANGER, cgmes.phaseTapChangerForPowerTransformer(t.getId()));\n+                    tapSteps.add(p);\n+                } else if (leg.getRatioTapChanger() != null) {\n+                    p.put(tapChangerPositionName, is(leg.getRatioTapChanger().getTapPosition()));\n+                    p.put(CgmesNames.TAP_CHANGER, cgmes.ratioTapChangerForPowerTransformer(t.getId()));\n+                    tapSteps.add(p);\n+                }\n+            });\n+        }\n+\n+        cgmes.add(originalSVcontext, \"SvTapStep\", tapSteps);\n+    }\n+\n+    private void addStatusToCgmes() {\n+        // create SvStatus, iterate on Connectables, check Terminal status, add\n+        // to SvStatus\n+        PropertyBags svStatus = new PropertyBags();\n+        Set<String> addedConnectables = new HashSet<>();\n+        for (VoltageLevel v : n.getVoltageLevels()) {\n+            for (Connectable<?> c : v.getConnectables()) {\n+                // need to check if connectable was already added\n+                if (!addedConnectables.contains(c.getId())) {\n+                    addedConnectables.add(c.getId());\n+                    if (c.getId() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c5803a57c016ccc073c447f2f0b81bf799fd123"}, "originalPosition": 247}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM1ODAxMA==", "bodyText": "Again, I don't think this case can happen (in IIDM, when a connectable is created, at least one terminal is created with it).", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r388358010", "createdAt": "2020-03-05T15:13:46Z", "author": {"login": "MioRtia"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/StateVariablesAdder.java", "diffHunk": "@@ -100,20 +210,109 @@ public static void add(Network n, CgmesModel cgmes) {\n                 tapSteps.add(p);\n             }\n         }\n-        cgmes.add(CgmesSubset.STATE_VARIABLES, \"SvTapStep\", tapSteps);\n+\n+        for (ThreeWindingsTransformer t : n.getThreeWindingsTransformers()) {\n+            PropertyBag p = new PropertyBag(svTapStepProperties);\n+            Collections.unmodifiableList(Arrays.asList(t.getLeg1(), t.getLeg2(), t.getLeg3())).forEach(leg -> {\n+                if (leg.getPhaseTapChanger() != null) {\n+                    p.put(tapChangerPositionName, is(leg.getPhaseTapChanger().getTapPosition()));\n+                    p.put(CgmesNames.TAP_CHANGER, cgmes.phaseTapChangerForPowerTransformer(t.getId()));\n+                    tapSteps.add(p);\n+                } else if (leg.getRatioTapChanger() != null) {\n+                    p.put(tapChangerPositionName, is(leg.getRatioTapChanger().getTapPosition()));\n+                    p.put(CgmesNames.TAP_CHANGER, cgmes.ratioTapChangerForPowerTransformer(t.getId()));\n+                    tapSteps.add(p);\n+                }\n+            });\n+        }\n+\n+        cgmes.add(originalSVcontext, \"SvTapStep\", tapSteps);\n+    }\n+\n+    private void addStatusToCgmes() {\n+        // create SvStatus, iterate on Connectables, check Terminal status, add\n+        // to SvStatus\n+        PropertyBags svStatus = new PropertyBags();\n+        Set<String> addedConnectables = new HashSet<>();\n+        for (VoltageLevel v : n.getVoltageLevels()) {\n+            for (Connectable<?> c : v.getConnectables()) {\n+                // need to check if connectable was already added\n+                if (!addedConnectables.contains(c.getId())) {\n+                    addedConnectables.add(c.getId());\n+                    if (c.getId() != null) {\n+                        PropertyBag p = new PropertyBag(SV_SVSTATUS_PROPERTIES);\n+                        for (Terminal t : c.getTerminals()) {\n+                            if (t == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c5803a57c016ccc073c447f2f0b81bf799fd123"}, "originalPosition": 250}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM3MDkyOQ==", "bodyText": "can be static", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r388370929", "createdAt": "2020-03-05T15:32:45Z", "author": {"login": "MioRtia"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/StateVariablesAdder.java", "diffHunk": "@@ -127,22 +326,115 @@ private static PropertyBag createPowerFlowProperties(CgmesModel cgmes, Terminal\n         return p;\n     }\n \n+    // added TopologicalIsland as it was in cgmes : original topology is\n+    // preserved.\n+    private void addTopologicalIslandsToCgmes() {\n+        if (!originalTopologicalIslands.isEmpty()) {\n+            // For properties such as \"cim:TopologicalIsland.TopologicalNodes\", which might\n+            // have arbitrary number of values, SPARQL will return multiple result sets.\n+            // All properties values will be equal, except the multiValued property\n+            // TopologicalNodes.\n+            // Also, there can be > 1 TopologicalIsland, so we need to re-group PropertyBags\n+            // by TopologicalIsland ID.\n+            Map<String, PropertyBags> byTopologicalIslandId = new HashMap<>();\n+            originalTopologicalIslands.forEach(pb -> {\n+                String island = pb.getId(CgmesNames.TOPOLOGICAL_ISLAND);\n+                if (byTopologicalIslandId.keySet().contains(island)) {\n+                    byTopologicalIslandId.get(island).add(pb);\n+                } else {\n+                    PropertyBags pbs = new PropertyBags();\n+                    pbs.add(pb);\n+                    byTopologicalIslandId.put(island, pbs);\n+                }\n+            });\n+            // now we can process all TPNodes from each island, and put them in one\n+            // multivaluedProperty.\n+            PropertyBags topologicalIslands = new PropertyBags();\n+            byTopologicalIslandId.values().forEach(value -> {\n+                PropertyBag topologicalIsland = new PropertyBag(SV_TOPOLOGICALISLAND_PROPERTIES);\n+                topologicalIsland.setClassPropertyNames(Arrays.asList(CgmesNames.NAME));\n+                topologicalIsland.setMultivaluedProperty(Arrays.asList(\"TopologicalNodes\"));\n+                topologicalIsland.put(CgmesNames.NAME, value.get(0).getId(\"name\"));\n+                topologicalIsland.put(CgmesNames.ANGLEREF_TOPOLOGICALNODE,\n+                    value.get(0).getId(CgmesNames.ANGLEREF_TOPOLOGICALNODE));\n+                topologicalIsland.put(CgmesNames.TOPOLOGICAL_NODES,\n+                    getMultivaluedProperty(value, CgmesNames.TOPOLOGICAL_NODES));\n+                topologicalIslands.add(topologicalIsland);\n+            });\n+            cgmes.add(originalSVcontext, CgmesNames.TOPOLOGICAL_ISLAND, topologicalIslands);\n+        }\n+    }\n+\n+    // Added full model data with proper profile (StateVariables)\n+    // FullModel is defined in ModelDescription:\n+    // http://iec.ch/TC57/61970-552/ModelDescription/1#\n+    private void addModelDescriptionToCgmes() {\n+        PropertyBags fullModelSV = new PropertyBags();\n+        // for properties such as \"md:Model.DependentOn\" which might have arbitrary\n+        // number of values, SPARQL will return multiple result sets.\n+        // All are equal, except the multiValued property value.\n+        if (!originalFullModel.isEmpty()) {\n+            PropertyBag newModelDescription = new PropertyBag(SV_FULLMODEL_PROPERTIES);\n+            newModelDescription\n+                .setClassPropertyNames(\n+                    Arrays.asList(CgmesNames.SCENARIO_TIME, CgmesNames.CREATED, CgmesNames.DESCRIPTION,\n+                        CgmesNames.VERSION, CgmesNames.DEPENDENT_ON, CgmesNames.PROFILE,\n+                        CgmesNames.MODELING_AUTHORITY_SET));\n+            newModelDescription.setMultivaluedProperty(Arrays.asList(CgmesNames.DEPENDENT_ON));\n+            newModelDescription.put(CgmesNames.SCENARIO_TIME, originalFullModel.get(0).getId(\"scenarioTime\"));\n+            newModelDescription.put(CgmesNames.CREATED, originalFullModel.get(0).getId(\"created\"));\n+            newModelDescription.put(CgmesNames.DESCRIPTION, originalFullModel.get(0).getId(\"description\"));\n+            newModelDescription.put(CgmesNames.VERSION, originalFullModel.get(0).getId(\"version\"));\n+            newModelDescription.put(CgmesNames.DEPENDENT_ON,\n+                getMultivaluedProperty(originalFullModel, \"DependentOn\"));\n+            newModelDescription.put(CgmesNames.PROFILE, originalFullModel.get(0).getId(\"profile\"));\n+            newModelDescription.put(CgmesNames.MODELING_AUTHORITY_SET,\n+                originalFullModel.get(0).getId(\"modelingAuthoritySet\"));\n+            fullModelSV.add(newModelDescription);\n+            cgmes.add(originalSVcontext, CgmesNames.FULL_MODEL, fullModelSV);\n+        }\n+    }\n+\n+    private String getMultivaluedProperty(PropertyBags pb, String multivaluedPropertyName) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c5803a57c016ccc073c447f2f0b81bf799fd123"}, "originalPosition": 402}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQwMzQwNg==", "bodyText": "set this as a copy to be protected against unsafe changes:\nthis.multiValuedPropertyNames = new ArrayList<>(Objects.requireNonNull(multiValuePropertyNames));", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r388403406", "createdAt": "2020-03-05T16:19:18Z", "author": {"login": "MioRtia"}, "path": "triple-store/triple-store-api/src/main/java/com/powsybl/triplestore/api/PropertyBag.java", "diffHunk": "@@ -195,10 +197,19 @@ public boolean isClassProperty(String name) {\n         return classPropertyNames.contains(name);\n     }\n \n+    public void setMultivaluedProperty(List<String> multiValuedPropertyNames) {\n+        this.multiValuedPropertyNames = Objects.requireNonNull(multiValuedPropertyNames);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c5803a57c016ccc073c447f2f0b81bf799fd123"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24c7c81771f354c7c36c0290e364726d10162b25", "author": {"user": {"login": "zamarrenolm", "name": "Luma"}}, "url": "https://github.com/powsybl/powsybl-core/commit/24c7c81771f354c7c36c0290e364726d10162b25", "committedDate": "2020-03-06T07:14:27Z", "message": "Merge branch 'master' into cgmes_update_simple_update_sv_file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMTkxNjY5", "url": "https://github.com/powsybl/powsybl-core/pull/1201#pullrequestreview-370191669", "createdAt": "2020-03-06T09:38:56Z", "commit": {"oid": "24c7c81771f354c7c36c0290e364726d10162b25"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwOTozODo1NlrOFyyiHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwOTo1Njo1MVrOFyzG_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgwMTA1NQ==", "bodyText": "I don't think so because it uses the cgmes attribute.", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r388801055", "createdAt": "2020-03-06T09:38:56Z", "author": {"login": "mathbagu"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/StateVariablesAdder.java", "diffHunk": "@@ -17,42 +26,122 @@\n import com.powsybl.cgmes.model.CgmesSubset;\n import com.powsybl.cgmes.model.triplestore.CgmesModelTripleStore;\n import com.powsybl.iidm.network.Bus;\n+import com.powsybl.iidm.network.Connectable;\n+import com.powsybl.iidm.network.DanglingLine;\n import com.powsybl.iidm.network.Generator;\n import com.powsybl.iidm.network.Load;\n import com.powsybl.iidm.network.Network;\n import com.powsybl.iidm.network.ShuntCompensator;\n import com.powsybl.iidm.network.Terminal;\n+import com.powsybl.iidm.network.ThreeWindingsTransformer;\n import com.powsybl.iidm.network.TwoWindingsTransformer;\n+import com.powsybl.iidm.network.VoltageLevel;\n+import com.powsybl.iidm.network.util.LinkData;\n+import com.powsybl.iidm.network.util.LinkData.BranchAdmittanceMatrix;\n import com.powsybl.triplestore.api.PropertyBag;\n import com.powsybl.triplestore.api.PropertyBags;\n \n /**\n  * @author Marcos de Miguel <demiguelm at aia.es>\n  * @author Luma Zamarre\u00f1o <zamarrenolm at aia.es>\n+ * @author Elena Kaltakova <kaltakovae at aia.es>\n  */\n-public final class StateVariablesAdder {\n+public class StateVariablesAdder {\n \n-    private StateVariablesAdder() {\n+    public StateVariablesAdder(CgmesModel cgmes, Network n) {\n+        this.cgmes = Objects.requireNonNull(cgmes);\n+        this.n = Objects.requireNonNull(n);\n+        this.cimVersion = ((CgmesModelTripleStore) cgmes).getCimVersion();\n+        this.originalTerminals = cgmes.terminals();\n+        this.originalFullModel = cgmes.fullModel(CgmesSubset.STATE_VARIABLES.getProfile());\n+        this.originalTopologicalIslands = cgmes.topologicalIslands();\n+        this.originalSVcontext = originalSVcontext();\n+        this.boundaryNodesFromDanglingLines = boundaryNodesFromDanglingLines();\n     }\n \n-    public static void add(Network n, CgmesModel cgmes) {\n-        // TODO Add full model data with proper profile (StateVariables)\n-        // FullModel is defined in ModelDescription:\n-        // http://iec.ch/TC57/61970-552/ModelDescription/1#\n+    private String originalSVcontext() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODMxODgxNw=="}, "originalCommit": {"oid": "8c5803a57c016ccc073c447f2f0b81bf799fd123"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgwMjM2OA==", "bodyText": "I don't think this is really needed.", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r388802368", "createdAt": "2020-03-06T09:41:36Z", "author": {"login": "mathbagu"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/StateVariablesAdder.java", "diffHunk": "@@ -61,30 +150,51 @@ public static void add(Network n, CgmesModel cgmes) {\n             }\n         }\n         for (Generator g : n.getGenerators()) {\n-            PropertyBag p = createPowerFlowProperties(cgmes, g.getTerminal());\n+            PropertyBag p = createPowerFlowProperties(g.getTerminal());\n             if (p != null) {\n                 powerFlows.add(p);\n             }\n         }\n         for (ShuntCompensator s : n.getShuntCompensators()) {\n-            PropertyBag p = createPowerFlowProperties(cgmes, s.getTerminal());\n+            PropertyBag p = createPowerFlowProperties(s.getTerminal());\n             if (p != null) {\n-                powerFlows.add(createPowerFlowProperties(cgmes, s.getTerminal()));\n+                powerFlows.add(p);\n             }\n         }\n-        cgmes.add(CgmesSubset.STATE_VARIABLES, \"SvPowerFlow\", powerFlows);\n \n+        // PowerFlow at boundaries set as it was in original cgmes.\n+        for (PropertyBag terminal : originalTerminals) {\n+            Objects.requireNonNull(terminal);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24c7c81771f354c7c36c0290e364726d10162b25"}, "originalPosition": 177}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgwNDE2OQ==", "bodyText": "Consider replacing String.valueOf by Boolean.toString", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r388804169", "createdAt": "2020-03-06T09:45:02Z", "author": {"login": "mathbagu"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/StateVariablesAdder.java", "diffHunk": "@@ -100,20 +210,109 @@ public static void add(Network n, CgmesModel cgmes) {\n                 tapSteps.add(p);\n             }\n         }\n-        cgmes.add(CgmesSubset.STATE_VARIABLES, \"SvTapStep\", tapSteps);\n+\n+        for (ThreeWindingsTransformer t : n.getThreeWindingsTransformers()) {\n+            PropertyBag p = new PropertyBag(svTapStepProperties);\n+            Collections.unmodifiableList(Arrays.asList(t.getLeg1(), t.getLeg2(), t.getLeg3())).forEach(leg -> {\n+                if (leg.getPhaseTapChanger() != null) {\n+                    p.put(tapChangerPositionName, is(leg.getPhaseTapChanger().getTapPosition()));\n+                    p.put(CgmesNames.TAP_CHANGER, cgmes.phaseTapChangerForPowerTransformer(t.getId()));\n+                    tapSteps.add(p);\n+                } else if (leg.getRatioTapChanger() != null) {\n+                    p.put(tapChangerPositionName, is(leg.getRatioTapChanger().getTapPosition()));\n+                    p.put(CgmesNames.TAP_CHANGER, cgmes.ratioTapChangerForPowerTransformer(t.getId()));\n+                    tapSteps.add(p);\n+                }\n+            });\n+        }\n+\n+        cgmes.add(originalSVcontext, \"SvTapStep\", tapSteps);\n+    }\n+\n+    private void addStatusToCgmes() {\n+        // create SvStatus, iterate on Connectables, check Terminal status, add\n+        // to SvStatus\n+        PropertyBags svStatus = new PropertyBags();\n+        Set<String> addedConnectables = new HashSet<>();\n+        for (VoltageLevel v : n.getVoltageLevels()) {\n+            for (Connectable<?> c : v.getConnectables()) {\n+                // need to check if connectable was already added\n+                if (!addedConnectables.contains(c.getId())) {\n+                    addedConnectables.add(c.getId());\n+                    if (c.getId() != null) {\n+                        PropertyBag p = new PropertyBag(SV_SVSTATUS_PROPERTIES);\n+                        for (Terminal t : c.getTerminals()) {\n+                            if (t == null) {\n+                                continue;\n+                            }\n+                            p.put(IN_SERVICE, String.valueOf(t.isConnected()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24c7c81771f354c7c36c0290e364726d10162b25"}, "originalPosition": 253}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgwNTI5OQ==", "bodyText": "Use the stream API to collect boundadyNodes:\nList<String> boundaryNodes = cgmes.boundaryNodes().map(X::getId).collect(Collectors.toList());\n\nReplace X by the name of the class of node.", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r388805299", "createdAt": "2020-03-06T09:47:09Z", "author": {"login": "mathbagu"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/StateVariablesAdder.java", "diffHunk": "@@ -100,20 +210,109 @@ public static void add(Network n, CgmesModel cgmes) {\n                 tapSteps.add(p);\n             }\n         }\n-        cgmes.add(CgmesSubset.STATE_VARIABLES, \"SvTapStep\", tapSteps);\n+\n+        for (ThreeWindingsTransformer t : n.getThreeWindingsTransformers()) {\n+            PropertyBag p = new PropertyBag(svTapStepProperties);\n+            Collections.unmodifiableList(Arrays.asList(t.getLeg1(), t.getLeg2(), t.getLeg3())).forEach(leg -> {\n+                if (leg.getPhaseTapChanger() != null) {\n+                    p.put(tapChangerPositionName, is(leg.getPhaseTapChanger().getTapPosition()));\n+                    p.put(CgmesNames.TAP_CHANGER, cgmes.phaseTapChangerForPowerTransformer(t.getId()));\n+                    tapSteps.add(p);\n+                } else if (leg.getRatioTapChanger() != null) {\n+                    p.put(tapChangerPositionName, is(leg.getRatioTapChanger().getTapPosition()));\n+                    p.put(CgmesNames.TAP_CHANGER, cgmes.ratioTapChangerForPowerTransformer(t.getId()));\n+                    tapSteps.add(p);\n+                }\n+            });\n+        }\n+\n+        cgmes.add(originalSVcontext, \"SvTapStep\", tapSteps);\n+    }\n+\n+    private void addStatusToCgmes() {\n+        // create SvStatus, iterate on Connectables, check Terminal status, add\n+        // to SvStatus\n+        PropertyBags svStatus = new PropertyBags();\n+        Set<String> addedConnectables = new HashSet<>();\n+        for (VoltageLevel v : n.getVoltageLevels()) {\n+            for (Connectable<?> c : v.getConnectables()) {\n+                // need to check if connectable was already added\n+                if (!addedConnectables.contains(c.getId())) {\n+                    addedConnectables.add(c.getId());\n+                    if (c.getId() != null) {\n+                        PropertyBag p = new PropertyBag(SV_SVSTATUS_PROPERTIES);\n+                        for (Terminal t : c.getTerminals()) {\n+                            if (t == null) {\n+                                continue;\n+                            }\n+                            p.put(IN_SERVICE, String.valueOf(t.isConnected()));\n+                        }\n+                        p.put(CgmesNames.CONDUCTING_EQUIPMENT, c.getId());\n+                        svStatus.add(p);\n+                    }\n+                }\n+            }\n+        }\n+\n+        // SvStatus at boundaries set as it was in original cgmes.\n+        for (PropertyBag terminal : originalTerminals) {\n+            Objects.requireNonNull(terminal);\n+            if (terminal.getId(\"SvStatus\") == null) {\n+                continue;\n+            }\n+            boundaryNodesFromDanglingLines.values().forEach(value -> {\n+                if (terminal.getId(CgmesNames.TOPOLOGICAL_NODE).equals(value)) {\n+                    PropertyBag p = new PropertyBag(SV_SVSTATUS_PROPERTIES);\n+                    p.put(IN_SERVICE, terminal.getId(IN_SERVICE));\n+                    p.put(CgmesNames.CONDUCTING_EQUIPMENT, terminal.getId(CgmesNames.CONDUCTING_EQUIPMENT));\n+                    svStatus.add(p);\n+                }\n+            });\n+        }\n+        cgmes.add(originalSVcontext, \"SvStatus\", svStatus);\n+    }\n+\n+    private Map<String, String> boundaryNodesFromDanglingLines() {\n+        Map<String, String> nodesFromLines = new HashMap<>();\n+        List<String> boundaryNodes = new ArrayList<>();\n+        cgmes.boundaryNodes().forEach(node -> boundaryNodes.add(node.getId(\"Node\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24c7c81771f354c7c36c0290e364726d10162b25"}, "originalPosition": 283}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgwNzEzMQ==", "bodyText": "Use the stream API to initialize list. If there is no stream() method in PropertyBags, you should consider to add one.", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r388807131", "createdAt": "2020-03-06T09:50:38Z", "author": {"login": "mathbagu"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/StateVariablesAdder.java", "diffHunk": "@@ -127,22 +326,115 @@ private static PropertyBag createPowerFlowProperties(CgmesModel cgmes, Terminal\n         return p;\n     }\n \n+    // added TopologicalIsland as it was in cgmes : original topology is\n+    // preserved.\n+    private void addTopologicalIslandsToCgmes() {\n+        if (!originalTopologicalIslands.isEmpty()) {\n+            // For properties such as \"cim:TopologicalIsland.TopologicalNodes\", which might\n+            // have arbitrary number of values, SPARQL will return multiple result sets.\n+            // All properties values will be equal, except the multiValued property\n+            // TopologicalNodes.\n+            // Also, there can be > 1 TopologicalIsland, so we need to re-group PropertyBags\n+            // by TopologicalIsland ID.\n+            Map<String, PropertyBags> byTopologicalIslandId = new HashMap<>();\n+            originalTopologicalIslands.forEach(pb -> {\n+                String island = pb.getId(CgmesNames.TOPOLOGICAL_ISLAND);\n+                if (byTopologicalIslandId.keySet().contains(island)) {\n+                    byTopologicalIslandId.get(island).add(pb);\n+                } else {\n+                    PropertyBags pbs = new PropertyBags();\n+                    pbs.add(pb);\n+                    byTopologicalIslandId.put(island, pbs);\n+                }\n+            });\n+            // now we can process all TPNodes from each island, and put them in one\n+            // multivaluedProperty.\n+            PropertyBags topologicalIslands = new PropertyBags();\n+            byTopologicalIslandId.values().forEach(value -> {\n+                PropertyBag topologicalIsland = new PropertyBag(SV_TOPOLOGICALISLAND_PROPERTIES);\n+                topologicalIsland.setClassPropertyNames(Arrays.asList(CgmesNames.NAME));\n+                topologicalIsland.setMultivaluedProperty(Arrays.asList(\"TopologicalNodes\"));\n+                topologicalIsland.put(CgmesNames.NAME, value.get(0).getId(\"name\"));\n+                topologicalIsland.put(CgmesNames.ANGLEREF_TOPOLOGICALNODE,\n+                    value.get(0).getId(CgmesNames.ANGLEREF_TOPOLOGICALNODE));\n+                topologicalIsland.put(CgmesNames.TOPOLOGICAL_NODES,\n+                    getMultivaluedProperty(value, CgmesNames.TOPOLOGICAL_NODES));\n+                topologicalIslands.add(topologicalIsland);\n+            });\n+            cgmes.add(originalSVcontext, CgmesNames.TOPOLOGICAL_ISLAND, topologicalIslands);\n+        }\n+    }\n+\n+    // Added full model data with proper profile (StateVariables)\n+    // FullModel is defined in ModelDescription:\n+    // http://iec.ch/TC57/61970-552/ModelDescription/1#\n+    private void addModelDescriptionToCgmes() {\n+        PropertyBags fullModelSV = new PropertyBags();\n+        // for properties such as \"md:Model.DependentOn\" which might have arbitrary\n+        // number of values, SPARQL will return multiple result sets.\n+        // All are equal, except the multiValued property value.\n+        if (!originalFullModel.isEmpty()) {\n+            PropertyBag newModelDescription = new PropertyBag(SV_FULLMODEL_PROPERTIES);\n+            newModelDescription\n+                .setClassPropertyNames(\n+                    Arrays.asList(CgmesNames.SCENARIO_TIME, CgmesNames.CREATED, CgmesNames.DESCRIPTION,\n+                        CgmesNames.VERSION, CgmesNames.DEPENDENT_ON, CgmesNames.PROFILE,\n+                        CgmesNames.MODELING_AUTHORITY_SET));\n+            newModelDescription.setMultivaluedProperty(Arrays.asList(CgmesNames.DEPENDENT_ON));\n+            newModelDescription.put(CgmesNames.SCENARIO_TIME, originalFullModel.get(0).getId(\"scenarioTime\"));\n+            newModelDescription.put(CgmesNames.CREATED, originalFullModel.get(0).getId(\"created\"));\n+            newModelDescription.put(CgmesNames.DESCRIPTION, originalFullModel.get(0).getId(\"description\"));\n+            newModelDescription.put(CgmesNames.VERSION, originalFullModel.get(0).getId(\"version\"));\n+            newModelDescription.put(CgmesNames.DEPENDENT_ON,\n+                getMultivaluedProperty(originalFullModel, \"DependentOn\"));\n+            newModelDescription.put(CgmesNames.PROFILE, originalFullModel.get(0).getId(\"profile\"));\n+            newModelDescription.put(CgmesNames.MODELING_AUTHORITY_SET,\n+                originalFullModel.get(0).getId(\"modelingAuthoritySet\"));\n+            fullModelSV.add(newModelDescription);\n+            cgmes.add(originalSVcontext, CgmesNames.FULL_MODEL, fullModelSV);\n+        }\n+    }\n+\n+    private String getMultivaluedProperty(PropertyBags pb, String multivaluedPropertyName) {\n+        // for properties such as \"md:Model.DependentOn\" which might have arbitrary\n+        // number of values, SPARQL will return multiple result sets. We will loop\n+        // through all and collect all values for multiValued property.\n+        List<String> list = new ArrayList<>();\n+        pb.forEach(m -> list.add(m.getId(multivaluedPropertyName)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24c7c81771f354c7c36c0290e364726d10162b25"}, "originalPosition": 407}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgwODczMQ==", "bodyText": "I think you should make this map static. Change also the case of profile to upper case.", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r388808731", "createdAt": "2020-03-06T09:53:34Z", "author": {"login": "mathbagu"}, "path": "cgmes/cgmes-model/src/main/java/com/powsybl/cgmes/model/CgmesSubset.java", "diffHunk": "@@ -71,11 +72,26 @@ public String getIdentifier() {\n         return identifier;\n     }\n \n+    public String getProfile() {\n+        return profileName;\n+    }\n+\n     public boolean isValidName(String contextName) {\n         return contextName.contains(validName0) || contextName.contains(validName1);\n     }\n \n     private static boolean isBoundary(String contextName) {\n         return contextName.contains(\"_BD\") || contextName.contains(\"BOUNDARY\");\n     }\n+\n+    private final String identifier;\n+    private final String validName0;\n+    private final String validName1;\n+    private String profileName;\n+    private final Map<String, String> profile = ImmutableMap.of(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24c7c81771f354c7c36c0290e364726d10162b25"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgwODg1Mg==", "bodyText": "should probably be final", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r388808852", "createdAt": "2020-03-06T09:53:49Z", "author": {"login": "mathbagu"}, "path": "cgmes/cgmes-model/src/main/java/com/powsybl/cgmes/model/CgmesSubset.java", "diffHunk": "@@ -71,11 +72,26 @@ public String getIdentifier() {\n         return identifier;\n     }\n \n+    public String getProfile() {\n+        return profileName;\n+    }\n+\n     public boolean isValidName(String contextName) {\n         return contextName.contains(validName0) || contextName.contains(validName1);\n     }\n \n     private static boolean isBoundary(String contextName) {\n         return contextName.contains(\"_BD\") || contextName.contains(\"BOUNDARY\");\n     }\n+\n+    private final String identifier;\n+    private final String validName0;\n+    private final String validName1;\n+    private String profileName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24c7c81771f354c7c36c0290e364726d10162b25"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgwOTI5Mg==", "bodyText": "Fix indentation: do not use tabs", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r388809292", "createdAt": "2020-03-06T09:54:40Z", "author": {"login": "mathbagu"}, "path": "cgmes/cgmes-model/src/main/resources/CIM14.sparql", "diffHunk": "@@ -74,6 +81,10 @@ OPTIONAL { GRAPH ?graphSV {\n         cim:SvPowerFlow.Terminal ?Terminal ;\n         cim:SvPowerFlow.p ?p ;\n         cim:SvPowerFlow.q ?q\n+} OPTIONAL {?SvStatus\n+\t\ta cim:SvStatus ;\n+\t\tcim:SvStatus.ConductingEquipment ?ConductingEquipment ;\n+\t\tcim:SvStatus.inService ?inService . ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24c7c81771f354c7c36c0290e364726d10162b25"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgwOTQ0NQ==", "bodyText": "Same remark about tabs", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r388809445", "createdAt": "2020-03-06T09:55:00Z", "author": {"login": "mathbagu"}, "path": "cgmes/cgmes-model/src/main/resources/CIM16.sparql", "diffHunk": "@@ -144,6 +167,10 @@ OPTIONAL { GRAPH ?graphSV {\n         cim:SvPowerFlow.Terminal ?Terminal ;\n         cim:SvPowerFlow.p ?p ;\n         cim:SvPowerFlow.q ?q\n+} OPTIONAL {?SvStatus\n+\t\ta cim:SvStatus ;\n+\t\tcim:SvStatus.ConductingEquipment ?ConductingEquipment ;\n+\t\tcim:SvStatus.inService ?inService . ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24c7c81771f354c7c36c0290e364726d10162b25"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgwOTUyMg==", "bodyText": "Same remakr", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r388809522", "createdAt": "2020-03-06T09:55:09Z", "author": {"login": "mathbagu"}, "path": "cgmes/cgmes-model/src/main/resources/CIM16.sparql", "diffHunk": "@@ -199,6 +226,16 @@ OPTIONAL { GRAPH ?graphSVT {\n }}\n }\n \n+# query: topologicalIslands\n+SELECT *\n+{ GRAPH ?graph { \n+\t?TopologicalIsland\n+\t\ta cim:TopologicalIsland ;\n+\t\tcim:IdentifiedObject.name ?name ;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24c7c81771f354c7c36c0290e364726d10162b25"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgxMDE3NQ==", "bodyText": "Replace Stream.of by Arrays.asList. This list should be static and final ?", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r388810175", "createdAt": "2020-03-06T09:56:18Z", "author": {"login": "mathbagu"}, "path": "triple-store/triple-store-api/src/main/java/com/powsybl/triplestore/api/PropertyBag.java", "diffHunk": "@@ -173,9 +174,10 @@ public final boolean equals(Object obj) {\n \n     public boolean isResource(String name) {\n         // TODO do not rely on property name, use metadata or answer based on value?\n-        return name.equals(\"TopologicalNode\") || name.equals(\"Terminal\")\n-                || name.equals(\"ShuntCompensator\") || name.equals(\"TapChanger\")\n-                || resourceNames.contains(name);\n+        List<String> list = Stream.of(\"TopologicalNode\", \"Terminal\", \"ShuntCompensator\",\n+            \"TapChanger\", \"ConductingEquipment\", \"Model.DependentOn\", \"TopologicalNodes\",\n+            \"AngleRefTopologicalNode\").collect(Collectors.toList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24c7c81771f354c7c36c0290e364726d10162b25"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgxMDQ5Mg==", "bodyText": "All these lists should be final?", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r388810492", "createdAt": "2020-03-06T09:56:51Z", "author": {"login": "mathbagu"}, "path": "triple-store/triple-store-api/src/main/java/com/powsybl/triplestore/api/PropertyBag.java", "diffHunk": "@@ -195,10 +197,19 @@ public boolean isClassProperty(String name) {\n         return classPropertyNames.contains(name);\n     }\n \n+    public void setMultivaluedProperty(List<String> multiValuedPropertyNames) {\n+        this.multiValuedPropertyNames = Objects.requireNonNull(multiValuedPropertyNames);\n+    }\n+\n+    public boolean isMultivaluedProperty(String name) {\n+        return multiValuedPropertyNames.contains(name);\n+    }\n+\n     private final List<String> propertyNames;\n     private final boolean removeInitialUnderscoreForIdentifiers;\n     private List<String> resourceNames = new ArrayList<>();\n     private List<String> classPropertyNames = new ArrayList<>();\n+    private List<String> multiValuedPropertyNames = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24c7c81771f354c7c36c0290e364726d10162b25"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d522b1551c4046892850e731c279f3a4bfdc44bd", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/d522b1551c4046892850e731c279f3a4bfdc44bd", "committedDate": "2020-03-09T08:47:28Z", "message": "Merge branch 'master' into cgmes_update_simple_update_sv_file\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6494c5646500b4c4c5b893eba1717df518c2a146", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/6494c5646500b4c4c5b893eba1717df518c2a146", "committedDate": "2020-03-09T15:34:57Z", "message": "fix PR 1201 requested changes\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5736f2d6d7f81eda439c1742d7bb431557def054", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/5736f2d6d7f81eda439c1742d7bb431557def054", "committedDate": "2020-03-10T08:45:36Z", "message": "Add StaticVarCompensators and Batteries PowerFlow to StateVariablesAdder\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb41031b5fcfd26425078b6dc071552e60f73476", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/cb41031b5fcfd26425078b6dc071552e60f73476", "committedDate": "2020-03-10T08:46:27Z", "message": "Merge branch 'master' into cgmes_update_simple_update_sv_file\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dead38e5ff1f33080feef197b2ac34ea2b8399a6", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/dead38e5ff1f33080feef197b2ac34ea2b8399a6", "committedDate": "2020-03-10T08:59:55Z", "message": "Merge branch 'cgmes_update_simple_update_sv_file' of https://github.com/powsybl/powsybl-core into cgmes_update_simple_update_sv_file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "526acd05138572fcd0eac65c86109b9d3d5f49a1", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/526acd05138572fcd0eac65c86109b9d3d5f49a1", "committedDate": "2020-03-10T09:26:32Z", "message": "fix changes requested for PR 1201\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3ba2f6ae7bc866b20bced962dea0510b481834a", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/b3ba2f6ae7bc866b20bced962dea0510b481834a", "committedDate": "2020-03-10T09:50:07Z", "message": "fix changes requested for PR 1201\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd8333f28ebd2758f545c82d7e239db457488e9f", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/fd8333f28ebd2758f545c82d7e239db457488e9f", "committedDate": "2020-03-10T10:27:24Z", "message": "Remove white spaces between cgmes elements in PowsyblWriter, requested for PR 1201\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMTA5OTE0", "url": "https://github.com/powsybl/powsybl-core/pull/1201#pullrequestreview-372109914", "createdAt": "2020-03-10T16:18:18Z", "commit": {"oid": "fd8333f28ebd2758f545c82d7e239db457488e9f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNjoxODoxOFrOF0Wd-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNjoxODoxOFrOF0Wd-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQzODM5Mw==", "bodyText": "@mathbagu We discussed it but I don't really like that getConnectables() does not ensure that the elements are distinct\n@kaltakovae Do you have a case in which the same Connectable is met several times? In any case, I think you should drop this check, I will make another PR to ensure the list/stream is distinct. Besides, you can use the stream API here.", "url": "https://github.com/powsybl/powsybl-core/pull/1201#discussion_r390438393", "createdAt": "2020-03-10T16:18:18Z", "author": {"login": "MioRtia"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/update/StateVariablesAdder.java", "diffHunk": "@@ -100,20 +221,103 @@ public static void add(Network n, CgmesModel cgmes) {\n                 tapSteps.add(p);\n             }\n         }\n-        cgmes.add(CgmesSubset.STATE_VARIABLES, \"SvTapStep\", tapSteps);\n+\n+        for (ThreeWindingsTransformer t : network.getThreeWindingsTransformers()) {\n+            PropertyBag p = new PropertyBag(svTapStepProperties);\n+            Arrays.asList(t.getLeg1(), t.getLeg2(), t.getLeg3()).forEach(leg -> {\n+                if (leg.getPhaseTapChanger() != null) {\n+                    p.put(tapChangerPositionName, is(leg.getPhaseTapChanger().getTapPosition()));\n+                    p.put(CgmesNames.TAP_CHANGER, cgmes.phaseTapChangerForPowerTransformer(t.getId()));\n+                    tapSteps.add(p);\n+                } else if (leg.getRatioTapChanger() != null) {\n+                    p.put(tapChangerPositionName, is(leg.getRatioTapChanger().getTapPosition()));\n+                    p.put(CgmesNames.TAP_CHANGER, cgmes.ratioTapChangerForPowerTransformer(t.getId()));\n+                    tapSteps.add(p);\n+                }\n+            });\n+        }\n+\n+        cgmes.add(originalSVcontext, \"SvTapStep\", tapSteps);\n+    }\n+\n+    private void addStatusToCgmes() {\n+        // create SvStatus, iterate on Connectables, check Terminal status, add\n+        // to SvStatus\n+        PropertyBags svStatus = new PropertyBags();\n+        Set<String> addedConnectables = new HashSet<>();\n+        for (VoltageLevel v : network.getVoltageLevels()) {\n+            for (Connectable<?> c : v.getConnectables()) {\n+                // need to check if connectable was already added\n+                if (!addedConnectables.contains(c.getId())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd8333f28ebd2758f545c82d7e239db457488e9f"}, "originalPosition": 264}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83fcff70dd4a13e1cc3f3663a905aa0df53e889c", "author": {"user": {"login": "kaltakovae", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/83fcff70dd4a13e1cc3f3663a905aa0df53e889c", "committedDate": "2020-03-11T08:57:05Z", "message": "Merge branch 'master' into cgmes_update_simple_update_sv_file\n\nSigned-off-by: Elena Kaltakova <kaltakovae@aia.es>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4430, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}