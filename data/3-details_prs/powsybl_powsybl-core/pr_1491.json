{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0MTc0MTgx", "number": 1491, "title": "Prevent x of step to be undefined (NaN) during CGMES import for non tabular ptc", "bodyText": "Signed-off-by: RALAMBOTIANA MIORA miora.ralambotiana@rte-france.com\nPlease check if the PR fulfills these requirements (please use '[x]' to check the checkboxes, or submit the PR and then click the checkboxes)\n\n The commit message follows our guidelines\n Tests for the changes have been added (for bug fixes / features)\n Docs have been added / updated (for bug fixes / features)\n\nWhat kind of change does this PR introduce? (Bug fix, feature, docs update, ...)\nBug fix\nWhat is the current behavior? (You can also link to an open issue here)\nWhen all alpha are equal to 0 in a PTC, the calculated x for non tabular PTC is undefined.\nWhat is the new behavior (if this is a feature change)?\nIn this case, x is equal to 0.\nDoes this PR introduce a breaking change or deprecate an API? If yes, check the following:\nNo\nOther information:\n(if any of the questions/checkboxes don't apply, please delete them entirely)", "createdAt": "2020-09-28T14:15:08Z", "url": "https://github.com/powsybl/powsybl-core/pull/1491", "merged": true, "mergeCommit": {"oid": "585ba5c62432035e94f590812100bbfa3790fc23"}, "closed": true, "closedAt": "2020-09-29T13:32:21Z", "author": {"login": "MioRtia"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNUO86gH2gAyNDk0MTc0MTgxOmI0OTU5MGNhOTU1ZTAxMmFlZDExZGY3Yzc5YjE2NzBkOGJhMGE4ZWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNoPHlAFqTQ5ODQ3MDM3MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b49590ca955e012aed11df7c79b1670d8ba0a8ef", "author": {"user": {"login": "MioRtia", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/b49590ca955e012aed11df7c79b1670d8ba0a8ef", "committedDate": "2020-09-28T14:12:41Z", "message": "Prevent x of step to be undefined (NaN) during CGMES import for non tabular ptc\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3NjcyNDEw", "url": "https://github.com/powsybl/powsybl-core/pull/1491#pullrequestreview-497672410", "createdAt": "2020-09-28T15:55:36Z", "commit": {"oid": "b49590ca955e012aed11df7c79b1670d8ba0a8ef"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNTo1NTozNlrOHZFEpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNTo1NTozNlrOHZFEpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA1OTU1Nw==", "bodyText": "I think the problem is that the X of the transformer is zero. We should not allow transformers with zero reactance. I think is better to fix this problem in the class CgmesT2xModel (Line 35) for twoWindingsTransformer and in the class CgmesT3xModel (Line 43) for threeWindingsTransformers. We can write an invalid warning and fix the X to a residual value (0.0001 by example) or maybe we can throw an exception.", "url": "https://github.com/powsybl/powsybl-core/pull/1491#discussion_r496059557", "createdAt": "2020-09-28T15:55:36Z", "author": {"login": "marqueslanauja"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/elements/transformers/CgmesPhaseTapChangerBuilder.java", "diffHunk": "@@ -142,8 +142,12 @@ private void addStepsAsymmetrical() {\n             return;\n         }\n         double alphaMax = tapChanger.getSteps().stream().map(TapChanger.Step::getAngle)\n-                .mapToDouble(Double::doubleValue).max().orElse(Double.NaN);\n+                .mapToDouble(Double::doubleValue).max().orElse(0);\n         tapChanger.getSteps().forEach(step -> {\n+            if (alphaMax == 0 || xtx == 0) {\n+                step.setX(0);\n+                return;\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b49590ca955e012aed11df7c79b1670d8ba0a8ef"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3NjcyOTQ1", "url": "https://github.com/powsybl/powsybl-core/pull/1491#pullrequestreview-497672945", "createdAt": "2020-09-28T15:56:11Z", "commit": {"oid": "b49590ca955e012aed11df7c79b1670d8ba0a8ef"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNTo1NjoxMlrOHZFGJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNTo1NjoxMlrOHZFGJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA1OTk0Mg==", "bodyText": "Same comment", "url": "https://github.com/powsybl/powsybl-core/pull/1491#discussion_r496059942", "createdAt": "2020-09-28T15:56:12Z", "author": {"login": "marqueslanauja"}, "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/elements/transformers/CgmesPhaseTapChangerBuilder.java", "diffHunk": "@@ -190,8 +194,12 @@ private void stepXforLinearAndSymmetrical() {\n             return;\n         }\n         double alphaMax = tapChanger.getSteps().stream().map(TapChanger.Step::getAngle)\n-            .mapToDouble(Double::doubleValue).max().orElse(Double.NaN);\n+            .mapToDouble(Double::doubleValue).max().orElse(0);\n         tapChanger.getSteps().forEach(step -> {\n+            if (alphaMax == 0.0 || xtx == 0.0) {\n+                step.setX(0);\n+                return;\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b49590ca955e012aed11df7c79b1670d8ba0a8ef"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3NzE5ODI2", "url": "https://github.com/powsybl/powsybl-core/pull/1491#pullrequestreview-497719826", "createdAt": "2020-09-28T16:53:12Z", "commit": {"oid": "b49590ca955e012aed11df7c79b1670d8ba0a8ef"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3NzkzODI1", "url": "https://github.com/powsybl/powsybl-core/pull/1491#pullrequestreview-497793825", "createdAt": "2020-09-28T18:32:45Z", "commit": {"oid": "b49590ca955e012aed11df7c79b1670d8ba0a8ef"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff2d0531a5fffe485bb0893bcc6e1637c8a6c212", "author": {"user": {"login": "MioRtia", "name": null}}, "url": "https://github.com/powsybl/powsybl-core/commit/ff2d0531a5fffe485bb0893bcc6e1637c8a6c212", "committedDate": "2020-09-29T08:31:30Z", "message": "Only check alphaMax + add comments\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NDcwMzcx", "url": "https://github.com/powsybl/powsybl-core/pull/1491#pullrequestreview-498470371", "createdAt": "2020-09-29T13:30:58Z", "commit": {"oid": "ff2d0531a5fffe485bb0893bcc6e1637c8a6c212"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4035, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}