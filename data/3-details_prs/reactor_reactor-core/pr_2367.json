{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyODU0NTM5", "number": 2367, "title": "Missing TERMINATED transition in UnicastManySinkNoBackpressure", "bodyText": "This commit polishes the new unicast onBackpressureError so that it\nallows early termination (emitComplete/emitError) and replays that\nfinal state to the first subscriber.", "createdAt": "2020-09-09T13:42:26Z", "url": "https://github.com/reactor/reactor-core/pull/2367", "merged": true, "mergeCommit": {"oid": "c7dd9650eb92f988a9154ffbc650af3472f1ef4b"}, "closed": true, "closedAt": "2020-09-11T17:35:37Z", "author": {"login": "simonbasle"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHMcOsAFqTQ4NTAyMzIxMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdH47s-ABqjM3NTczMDcyMDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MDIzMjEw", "url": "https://github.com/reactor/reactor-core/pull/2367#pullrequestreview-485023210", "createdAt": "2020-09-09T13:44:24Z", "commit": {"oid": "f43e1515a1a1098f24cef01daa373417aebda7e8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxMzo0NDoyNFrOHPIDVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxMzo0NDoyNFrOHPIDVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTYyMjYxMw==", "bodyText": "WDYT about changing it to for (...) to avoid the recursion (== longer stacktrace)?", "url": "https://github.com/reactor/reactor-core/pull/2367#discussion_r485622613", "createdAt": "2020-09-09T13:44:24Z", "author": {"login": "bsideup"}, "path": "reactor-core/src/main/java/reactor/core/publisher/UnicastManySinkNoBackpressure.java", "diffHunk": "@@ -182,18 +216,31 @@ public void emitComplete() {\n \tpublic Emission tryEmitComplete() {\n \t\tswitch (state) {\n \t\t\tcase INITIAL:\n-\t\t\t\t// TODO different Emission?\n-\t\t\t\treturn Emission.OK;\n+\t\t\t\tif (STATE.compareAndSet(this, State.INITIAL, State.TERMINATED_BEFORE_SUBSCRIPTION)) {\n+\t\t\t\t\treturn Emission.OK;\n+\t\t\t\t}\n+\t\t\t\telse {\n+\t\t\t\t\t//recurse", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f43e1515a1a1098f24cef01daa373417aebda7e8"}, "originalPosition": 116}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d7504a80877039118336b39eff7884757bcf2365", "author": {"user": {"login": "simonbasle", "name": "Simon Basl\u00e9"}}, "url": "https://github.com/reactor/reactor-core/commit/d7504a80877039118336b39eff7884757bcf2365", "committedDate": "2020-09-09T15:54:18Z", "message": "use for loop rather than recursion in case of CAS fail"}, "afterCommit": {"oid": "5bbec1fc471f125520e2be2547e02d6d673c81f6", "author": {"user": {"login": "simonbasle", "name": "Simon Basl\u00e9"}}, "url": "https://github.com/reactor/reactor-core/commit/5bbec1fc471f125520e2be2547e02d6d673c81f6", "committedDate": "2020-09-11T15:27:46Z", "message": "don't retain terminations but rather fail (rather than OK)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2OTY1MDg1", "url": "https://github.com/reactor/reactor-core/pull/2367#pullrequestreview-486965085", "createdAt": "2020-09-11T16:47:47Z", "commit": {"oid": "9113a64a184b21252a4645913486a30d1c61cd2c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e385136c2d7999b56738567760d326a920911959", "author": {"user": {"login": "simonbasle", "name": "Simon Basl\u00e9"}}, "url": "https://github.com/reactor/reactor-core/commit/e385136c2d7999b56738567760d326a920911959", "committedDate": "2020-09-11T17:33:36Z", "message": "Let UnicastManySinkNoBackpressure switch to terminal state (#2367)\n\nThis commit polishes the new unicast onBackpressureError so that it\nperforms the state transition to the TERMINATED state when completing\nor erroring the sink.\n\nAlso contains some state checks code style polish."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9113a64a184b21252a4645913486a30d1c61cd2c", "author": {"user": {"login": "simonbasle", "name": "Simon Basl\u00e9"}}, "url": "https://github.com/reactor/reactor-core/commit/9113a64a184b21252a4645913486a30d1c61cd2c", "committedDate": "2020-09-11T15:39:12Z", "message": "adapt tests"}, "afterCommit": {"oid": "e385136c2d7999b56738567760d326a920911959", "author": {"user": {"login": "simonbasle", "name": "Simon Basl\u00e9"}}, "url": "https://github.com/reactor/reactor-core/commit/e385136c2d7999b56738567760d326a920911959", "committedDate": "2020-09-11T17:33:36Z", "message": "Let UnicastManySinkNoBackpressure switch to terminal state (#2367)\n\nThis commit polishes the new unicast onBackpressureError so that it\nperforms the state transition to the TERMINATED state when completing\nor erroring the sink.\n\nAlso contains some state checks code style polish."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2865, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}