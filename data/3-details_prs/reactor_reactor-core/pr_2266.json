{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4MzUzODQ3", "number": 2266, "title": "fix #2260 Avoid onSubscribe race in FluxTimeout", "bodyText": "Fixes #2260", "createdAt": "2020-07-13T16:12:02Z", "url": "https://github.com/reactor/reactor-core/pull/2266", "merged": true, "mergeCommit": {"oid": "c611a1c74c89a9c9333bb1656724c111f896e442"}, "closed": true, "closedAt": "2020-07-16T10:06:50Z", "author": {"login": "bsideup"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc0jxbygH2gAyNDQ4MzUzODQ3OjFiMzA2M2QzNGQxNmUzMjJmOGM1MDYxOTk2MzljMGIwMGU4MDQ4ZWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1bVEVgFqTQ0OTY1MDc5Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1b3063d34d16e322f8c506199639c0b00e8048ee", "author": {"user": {"login": "bsideup", "name": "Sergei Egorov"}}, "url": "https://github.com/reactor/reactor-core/commit/1b3063d34d16e322f8c506199639c0b00e8048ee", "committedDate": "2020-07-13T16:10:49Z", "message": "Fix `onSubscribe` race in `FluxTimeout`"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3NDAxNjI4", "url": "https://github.com/reactor/reactor-core/pull/2266#pullrequestreview-447401628", "createdAt": "2020-07-13T16:17:47Z", "commit": {"oid": "1b3063d34d16e322f8c506199639c0b00e8048ee"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNjoxNzo0N1rOGwv2Mw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNjoxNzo0N1rOGwv2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc2ODc1NQ==", "bodyText": "could use a StepVerifier here to validate we go to the fallback all the time ?\nalso the reporter indicated that a low-millis timeout would sometimes trigger the issue too. maybe we can either add a test with ofMillis(1) or set a non-zero timeout for a percentage of the loops (eg. 10%) ?", "url": "https://github.com/reactor/reactor-core/pull/2266#discussion_r453768755", "createdAt": "2020-07-13T16:17:47Z", "author": {"login": "simonbasle"}, "path": "reactor-core/src/test/java/reactor/core/publisher/FluxTimeoutTest.java", "diffHunk": "@@ -399,4 +399,15 @@ public void timeoutNotDurationMessageSecondTimeout() {\n \n \t\tassertThat(generatorUsed.get()).as(\"generator used\").isTrue();\n \t}\n+\n+\t@Test\n+\tpublic void onSubscribeRace() {\n+\t\tfor (int i = 0; i < 10_000; i++) {\n+\t\t\tFlux.just(\"Hello\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b3063d34d16e322f8c506199639c0b00e8048ee"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30c9a300803481fc7dd308f76a5ddf19720b9a12", "author": {"user": {"login": "bsideup", "name": "Sergei Egorov"}}, "url": "https://github.com/reactor/reactor-core/commit/30c9a300803481fc7dd308f76a5ddf19720b9a12", "committedDate": "2020-07-15T15:26:33Z", "message": "behaviour change: always subscribe on source first"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a759136684e6415e3b65fdaeffd266f107b1c53", "author": {"user": {"login": "bsideup", "name": "Sergei Egorov"}}, "url": "https://github.com/reactor/reactor-core/commit/9a759136684e6415e3b65fdaeffd266f107b1c53", "committedDate": "2020-07-15T16:00:21Z", "message": "fix indentation in tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NjI3Mjgx", "url": "https://github.com/reactor/reactor-core/pull/2266#pullrequestreview-449627281", "createdAt": "2020-07-16T08:24:00Z", "commit": {"oid": "9a759136684e6415e3b65fdaeffd266f107b1c53"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwODoyNDowMFrOGygWug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwODoyNDowMFrOGygWug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTYxMjA5MA==", "bodyText": "let's order things logically, put firstTimeout before itemTimeout (and same in fields order above)", "url": "https://github.com/reactor/reactor-core/pull/2266#discussion_r455612090", "createdAt": "2020-07-16T08:24:00Z", "author": {"login": "simonbasle"}, "path": "reactor-core/src/main/java/reactor/core/publisher/FluxTimeout.java", "diffHunk": "@@ -134,11 +122,12 @@ static String addNameToTimeoutDescription(Publisher<?> source,\n \t\tTimeoutMainSubscriber(CoreSubscriber<? super T> actual,\n \t\t\t\tFunction<? super T, ? extends Publisher<V>> itemTimeout,\n \t\t\t\t@Nullable Publisher<? extends T> other,\n-\t\t\t\t@Nullable String timeoutDescription) {\n-\t\t\tsuper(actual);\n+\t\t\t\t@Nullable String timeoutDescription, Publisher<?> firstTimeout) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a759136684e6415e3b65fdaeffd266f107b1c53"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eea4ee1088afb6a4d0185aa2d5a19d79e3e866b5", "author": {"user": {"login": "bsideup", "name": "Sergei Egorov"}}, "url": "https://github.com/reactor/reactor-core/commit/eea4ee1088afb6a4d0185aa2d5a19d79e3e866b5", "committedDate": "2020-07-16T08:53:42Z", "message": "reorder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NjUwNzky", "url": "https://github.com/reactor/reactor-core/pull/2266#pullrequestreview-449650792", "createdAt": "2020-07-16T08:54:31Z", "commit": {"oid": "eea4ee1088afb6a4d0185aa2d5a19d79e3e866b5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2781, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}