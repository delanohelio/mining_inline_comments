{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3ODU5MTkx", "number": 2383, "title": "fix #2372 Add hasSubscriber() state getter to Sinks.Many|One|Empty", "bodyText": "", "createdAt": "2020-09-16T09:34:49Z", "url": "https://github.com/reactor/reactor-core/pull/2383", "merged": true, "mergeCommit": {"oid": "e97b7377015d3de0a8a0ce8c7943cf6971258d97"}, "closed": true, "closedAt": "2020-09-18T18:10:36Z", "author": {"login": "simonbasle"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJZJxLgBqjM3NzIzMDU2NDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdKJEpdABqjM3ODM1ODc3NzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0de86b8872495a706ea7dc4b74a30e1bf28ced0a", "author": {"user": {"login": "simonbasle", "name": "Simon Basl\u00e9"}}, "url": "https://github.com/reactor/reactor-core/commit/0de86b8872495a706ea7dc4b74a30e1bf28ced0a", "committedDate": "2020-09-16T09:33:06Z", "message": "Convert all tests that use inners() to use hasSubscriber() + fix some inconsistencies"}, "afterCommit": {"oid": "2273cb5bc868d73dfb58baa343a9ddcd0e7873fa", "author": {"user": {"login": "simonbasle", "name": "Simon Basl\u00e9"}}, "url": "https://github.com/reactor/reactor-core/commit/2273cb5bc868d73dfb58baa343a9ddcd0e7873fa", "committedDate": "2020-09-16T09:39:03Z", "message": "Convert tests to use hasSubscriber() + fix some inconsistencies\n\nsome tests would use the wrong source for assertions, some would use the\nwrong variable name in assertion message. overall simplified tests and\nreplaced Assert with assertJ `assertThat` on tested sinks."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NDUzODQ5", "url": "https://github.com/reactor/reactor-core/pull/2383#pullrequestreview-489453849", "createdAt": "2020-09-16T09:42:36Z", "commit": {"oid": "2273cb5bc868d73dfb58baa343a9ddcd0e7873fa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwOTo0MjozNlrOHSo36g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwOTo0MjozNlrOHSo36g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTMwNjA5MA==", "bodyText": "WDYT about using isSubscribed(), to avoid singular vs plural confusion?", "url": "https://github.com/reactor/reactor-core/pull/2383#discussion_r489306090", "createdAt": "2020-09-16T09:42:36Z", "author": {"login": "bsideup"}, "path": "reactor-core/src/main/java/reactor/core/publisher/Sinks.java", "diffHunk": "@@ -600,6 +600,17 @@ public Emission getReason() {\n \t\t@Deprecated\n \t\tvoid emitError(Throwable error);\n \n+\t\t/**\n+\t\t * Determines if the sink currently has at least one subscriber.\n+\t\t * <p>\n+\t\t * This is a best effort peek at the sink state, and a subsequent attempt at emitting\n+\t\t * to the sink might still return {@link Emission#FAIL_ZERO_SUBSCRIBER} where relevant\n+\t\t * (generally in {@link #tryEmitNext(Object)}).\n+\t\t *\n+\t\t * @return {@code true} if the sink has at least one subscriber at the time of invocation, {@code false} otherwise\n+\t\t */\n+\t\tboolean hasSubscriber();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2273cb5bc868d73dfb58baa343a9ddcd0e7873fa"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NDU1MDQ5", "url": "https://github.com/reactor/reactor-core/pull/2383#pullrequestreview-489455049", "createdAt": "2020-09-16T09:44:08Z", "commit": {"oid": "2273cb5bc868d73dfb58baa343a9ddcd0e7873fa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwOTo0NDowOFrOHSo7jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwOTo0NDowOFrOHSo7jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTMwNzAyMw==", "bodyText": "note for reviewers: DirectProcessorTest should ideally be re-formatted to use tabs consistently. in order not to pollute this PR's commit, I've only let the IDE reintroduce tabs on modified lines.", "url": "https://github.com/reactor/reactor-core/pull/2383#discussion_r489307023", "createdAt": "2020-09-16T09:44:08Z", "author": {"login": "simonbasle"}, "path": "reactor-core/src/test/java/reactor/core/publisher/DirectProcessorTest.java", "diffHunk": "@@ -133,10 +133,10 @@ public void error() {\n \n         tp.subscribe(ts);\n \n-        Assert.assertTrue(\"No subscribers?\", Scannable.from(tp).inners().count() != 0);\n-        Assert.assertFalse(\"Completed?\", tp.hasCompleted());\n-        Assert.assertNull(\"Has error?\", tp.getError());\n-        Assert.assertFalse(\"Has error?\", tp.hasError());\n+\t    assertThat(tp.hasSubscriber()).as(\"hasSubscriber\").isTrue();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2273cb5bc868d73dfb58baa343a9ddcd0e7873fa"}, "originalPosition": 68}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NDU2NTAy", "url": "https://github.com/reactor/reactor-core/pull/2383#pullrequestreview-489456502", "createdAt": "2020-09-16T09:46:02Z", "commit": {"oid": "2273cb5bc868d73dfb58baa343a9ddcd0e7873fa"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwOTo0NjowMlrOHSpAXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwOTo0NzowNFrOHSpClA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTMwODI1Mg==", "bodyText": "there was a bug in the tests messages here", "url": "https://github.com/reactor/reactor-core/pull/2383#discussion_r489308252", "createdAt": "2020-09-16T09:46:02Z", "author": {"login": "simonbasle"}, "path": "reactor-core/src/test/java/reactor/core/publisher/FluxSampleFirstTest.java", "diffHunk": "@@ -72,9 +74,9 @@ public void normal() {\n \t\t  .assertNoError()\n \t\t  .assertComplete();\n \n-\t\tAssert.assertFalse(\"sp1 has subscribers?\", Scannable.from(sp1).inners().findAny().isPresent());\n-\t\tAssert.assertFalse(\"sp1 has subscribers?\", Scannable.from(sp2).inners().findAny().isPresent());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2273cb5bc868d73dfb58baa343a9ddcd0e7873fa"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTMwODgyMA==", "bodyText": "there was a bug in the assertion here, asserting the wrong value!", "url": "https://github.com/reactor/reactor-core/pull/2383#discussion_r489308820", "createdAt": "2020-09-16T09:47:04Z", "author": {"login": "simonbasle"}, "path": "reactor-core/src/test/java/reactor/core/publisher/FluxWindowBoundaryTest.java", "diffHunk": "@@ -82,8 +82,8 @@ public void normal() {\n \t\tts.assertNoError()\n \t\t  .assertComplete();\n \n-\t\tAssert.assertFalse(\"sp1 has subscribers\", Scannable.from(sp1).inners().findAny().isPresent());\n-\t\tAssert.assertFalse(\"sp2 has subscribers\", Scannable.from(sp1).inners().findAny().isPresent());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2273cb5bc868d73dfb58baa343a9ddcd0e7873fa"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMjc0NDIx", "url": "https://github.com/reactor/reactor-core/pull/2383#pullrequestreview-491274421", "createdAt": "2020-09-18T08:53:27Z", "commit": {"oid": "3f75d31451167e898f1d4b84f738b56749d8074c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwODo1MzoyOFrOHUEHMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwODo1MzoyOFrOHUEHMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDgwMDk0Nw==", "bodyText": "should we maybe define \"active\" here? Otherwise, someone may think that \"active\" == \"ready to consume / requested\", which isn't the case", "url": "https://github.com/reactor/reactor-core/pull/2383#discussion_r490800947", "createdAt": "2020-09-18T08:53:28Z", "author": {"login": "bsideup"}, "path": "reactor-core/src/main/java/reactor/core/publisher/Sinks.java", "diffHunk": "@@ -600,6 +600,17 @@ public Emission getReason() {\n \t\t@Deprecated\n \t\tvoid emitError(Throwable error);\n \n+\t\t/**\n+\t\t * Determines how many active {@link Subscriber Subscribers} the sink currently has.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f75d31451167e898f1d4b84f738b56749d8074c"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMjc1MDMz", "url": "https://github.com/reactor/reactor-core/pull/2383#pullrequestreview-491275033", "createdAt": "2020-09-18T08:54:18Z", "commit": {"oid": "3f75d31451167e898f1d4b84f738b56749d8074c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f01df1b991f16c7445ac72d09b91f32111bb2a5d", "author": {"user": {"login": "simonbasle", "name": "Simon Basl\u00e9"}}, "url": "https://github.com/reactor/reactor-core/commit/f01df1b991f16c7445ac72d09b91f32111bb2a5d", "committedDate": "2020-09-18T17:29:04Z", "message": "[polish] Polish NextProcessor, allow subscribe() on it\n\nThis commit polishes the NextProcessor:\n - annotate error, value and source fields + getError() as Nullable\n - by checking if there's a source to the NextProcessor in `subscribe()`\n we can allow using it as a Sinks.One with empty LambdaSubscriber\n - no-op Operators.onOperatorError for cancelled inner, no need to\n do anything with error if inner is cancelled"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ecee8c0194e8d0809403c983e01264c762f56a14", "author": {"user": {"login": "simonbasle", "name": "Simon Basl\u00e9"}}, "url": "https://github.com/reactor/reactor-core/commit/ecee8c0194e8d0809403c983e01264c762f56a14", "committedDate": "2020-09-18T17:29:05Z", "message": "fix #2372 Add currentSubscriberCount() to Sinks.Many|One|Empty\n\nAlso convert tests to use the state getter and fix some inconsistencies\nin tests:\n - some tests would use the wrong source for assertions\n - some tests would use the wrong variable name in assertion message\n- overall simplified tests and replaced Assert with assertJ `assertThat`\non tested sinks"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cc6c078ca711619838bafe3c47b0891f991c0269", "author": {"user": {"login": "simonbasle", "name": "Simon Basl\u00e9"}}, "url": "https://github.com/reactor/reactor-core/commit/cc6c078ca711619838bafe3c47b0891f991c0269", "committedDate": "2020-09-18T17:26:42Z", "message": "[polish] Polish NextProcessor, allow subscribe() on it\n\nThis commit polishes the NextProcessor:\n - annotate error, value and source fields + getError() as Nullable\n - by checking if there's a source to the NextProcessor in `subscribe()`\n we can allow using it as a Sinks.One with empty LambdaSubscriber\n - no-op Operators.onOperatorError for cancelled inner, no need to\n do anything with error if inner is cancelled"}, "afterCommit": {"oid": "ecee8c0194e8d0809403c983e01264c762f56a14", "author": {"user": {"login": "simonbasle", "name": "Simon Basl\u00e9"}}, "url": "https://github.com/reactor/reactor-core/commit/ecee8c0194e8d0809403c983e01264c762f56a14", "committedDate": "2020-09-18T17:29:05Z", "message": "fix #2372 Add currentSubscriberCount() to Sinks.Many|One|Empty\n\nAlso convert tests to use the state getter and fix some inconsistencies\nin tests:\n - some tests would use the wrong source for assertions\n - some tests would use the wrong variable name in assertion message\n- overall simplified tests and replaced Assert with assertJ `assertThat`\non tested sinks"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2867, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}