{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2MjYxMDk5", "number": 2261, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNDowMjo0MVrOEMgNQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNDoyNTowNFrOEMg4Jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxNTQ2MDQ4OnYy", "diffSide": "RIGHT", "path": "reactor-core/build.gradle", "isResolved": false, "comments": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNDowMjo0MVrOGupmNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMzoyNzoxMlrOGyq5Dw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU2OTIwNQ==", "bodyText": "we should keep it as optional", "url": "https://github.com/reactor/reactor-core/pull/2261#discussion_r451569205", "createdAt": "2020-07-08T14:02:41Z", "author": {"login": "bsideup"}, "path": "reactor-core/build.gradle", "diffHunk": "@@ -84,7 +74,7 @@ dependencies {\n \toptional \"org.slf4j:slf4j-api:$slf4jVersion\"\n \n \t//Optional Metrics\n-\toptional \"io.micrometer:micrometer-core:$micrometerVersion\"\n+\tcompileOnly \"io.micrometer:micrometer-core:$micrometerVersion\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ebf22d5390cab1bd81f0315ad03393e4089e3f1"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU3MjgzMA==", "bodyText": "Can you elaborate? Does it have to do with how this is handled when published in maven repos?", "url": "https://github.com/reactor/reactor-core/pull/2261#discussion_r451572830", "createdAt": "2020-07-08T14:07:16Z", "author": {"login": "ericbottard"}, "path": "reactor-core/build.gradle", "diffHunk": "@@ -84,7 +74,7 @@ dependencies {\n \toptional \"org.slf4j:slf4j-api:$slf4jVersion\"\n \n \t//Optional Metrics\n-\toptional \"io.micrometer:micrometer-core:$micrometerVersion\"\n+\tcompileOnly \"io.micrometer:micrometer-core:$micrometerVersion\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU2OTIwNQ=="}, "originalCommit": {"oid": "0ebf22d5390cab1bd81f0315ad03393e4089e3f1"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU3NDExMQ==", "bodyText": "optional goes to the generated POM and signals that at least $micrometerVersion should be used, while compileOnly would be removed from the POM and there is no hint which version we used", "url": "https://github.com/reactor/reactor-core/pull/2261#discussion_r451574111", "createdAt": "2020-07-08T14:09:04Z", "author": {"login": "bsideup"}, "path": "reactor-core/build.gradle", "diffHunk": "@@ -84,7 +74,7 @@ dependencies {\n \toptional \"org.slf4j:slf4j-api:$slf4jVersion\"\n \n \t//Optional Metrics\n-\toptional \"io.micrometer:micrometer-core:$micrometerVersion\"\n+\tcompileOnly \"io.micrometer:micrometer-core:$micrometerVersion\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU2OTIwNQ=="}, "originalCommit": {"oid": "0ebf22d5390cab1bd81f0315ad03393e4089e3f1"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU4NDE5Nw==", "bodyText": "Slight problem: the tests don't pass anymore :(\nMicrometer IS on the test classpath when using optional apparently...", "url": "https://github.com/reactor/reactor-core/pull/2261#discussion_r451584197", "createdAt": "2020-07-08T14:22:08Z", "author": {"login": "ericbottard"}, "path": "reactor-core/build.gradle", "diffHunk": "@@ -84,7 +74,7 @@ dependencies {\n \toptional \"org.slf4j:slf4j-api:$slf4jVersion\"\n \n \t//Optional Metrics\n-\toptional \"io.micrometer:micrometer-core:$micrometerVersion\"\n+\tcompileOnly \"io.micrometer:micrometer-core:$micrometerVersion\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU2OTIwNQ=="}, "originalCommit": {"oid": "0ebf22d5390cab1bd81f0315ad03393e4089e3f1"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU4ODA2NA==", "bodyText": "Also, have a look at https://repo1.maven.org/maven2/io/projectreactor/reactor-core/3.3.7.RELEASE/reactor-core-3.3.7.RELEASE.pom, no particular mention of micrometer", "url": "https://github.com/reactor/reactor-core/pull/2261#discussion_r451588064", "createdAt": "2020-07-08T14:27:14Z", "author": {"login": "ericbottard"}, "path": "reactor-core/build.gradle", "diffHunk": "@@ -84,7 +74,7 @@ dependencies {\n \toptional \"org.slf4j:slf4j-api:$slf4jVersion\"\n \n \t//Optional Metrics\n-\toptional \"io.micrometer:micrometer-core:$micrometerVersion\"\n+\tcompileOnly \"io.micrometer:micrometer-core:$micrometerVersion\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU2OTIwNQ=="}, "originalCommit": {"oid": "0ebf22d5390cab1bd81f0315ad03393e4089e3f1"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTYwNzc1Mw==", "bodyText": "Related question: why don't we put blockHound in the proper configuration created for the test-set? Would fix the compilation errors I'm seeing in IDEA as far as I understand.", "url": "https://github.com/reactor/reactor-core/pull/2261#discussion_r451607753", "createdAt": "2020-07-08T14:53:36Z", "author": {"login": "ericbottard"}, "path": "reactor-core/build.gradle", "diffHunk": "@@ -84,7 +74,7 @@ dependencies {\n \toptional \"org.slf4j:slf4j-api:$slf4jVersion\"\n \n \t//Optional Metrics\n-\toptional \"io.micrometer:micrometer-core:$micrometerVersion\"\n+\tcompileOnly \"io.micrometer:micrometer-core:$micrometerVersion\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU2OTIwNQ=="}, "originalCommit": {"oid": "0ebf22d5390cab1bd81f0315ad03393e4089e3f1"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjE3Nzk3MA==", "bodyText": "ok so after discussing optional and looking at the pom, we'll track and kinda document the fact that optional dependencies are not in the pom anymore in #2262. the optional scope from our local copy of OptionalDependenciesPlugin is simply not made part of the pom, whereas the compileOnly vanilla scope results in <scope>provided</scope> in the pom, which we don't want.", "url": "https://github.com/reactor/reactor-core/pull/2261#discussion_r452177970", "createdAt": "2020-07-09T12:24:42Z", "author": {"login": "simonbasle"}, "path": "reactor-core/build.gradle", "diffHunk": "@@ -84,7 +74,7 @@ dependencies {\n \toptional \"org.slf4j:slf4j-api:$slf4jVersion\"\n \n \t//Optional Metrics\n-\toptional \"io.micrometer:micrometer-core:$micrometerVersion\"\n+\tcompileOnly \"io.micrometer:micrometer-core:$micrometerVersion\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU2OTIwNQ=="}, "originalCommit": {"oid": "0ebf22d5390cab1bd81f0315ad03393e4089e3f1"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0MTI1Mw==", "bodyText": "Related question: why don't we put blockHound in the proper configuration created for the test-set? Would fix the compilation errors I'm seeing in IDEA as far as I understand.\n\nCreated #2264", "url": "https://github.com/reactor/reactor-core/pull/2261#discussion_r452741253", "createdAt": "2020-07-10T09:46:45Z", "author": {"login": "ericbottard"}, "path": "reactor-core/build.gradle", "diffHunk": "@@ -84,7 +74,7 @@ dependencies {\n \toptional \"org.slf4j:slf4j-api:$slf4jVersion\"\n \n \t//Optional Metrics\n-\toptional \"io.micrometer:micrometer-core:$micrometerVersion\"\n+\tcompileOnly \"io.micrometer:micrometer-core:$micrometerVersion\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU2OTIwNQ=="}, "originalCommit": {"oid": "0ebf22d5390cab1bd81f0315ad03393e4089e3f1"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY2Njc3MQ==", "bodyText": "since we can't use compileOnly on production code (<scope>provided</scope>), we should thus indeed keep it as optional. The trouble with that is that the local OptionalDependenciesPlugin puts the optional dependency on the compile and runtime classpath of EVERY java sourceSet. Maybe we need a way larger refactor, where the optional would only get added to main sourceSet?", "url": "https://github.com/reactor/reactor-core/pull/2261#discussion_r455666771", "createdAt": "2020-07-16T09:53:08Z", "author": {"login": "simonbasle"}, "path": "reactor-core/build.gradle", "diffHunk": "@@ -84,7 +74,7 @@ dependencies {\n \toptional \"org.slf4j:slf4j-api:$slf4jVersion\"\n \n \t//Optional Metrics\n-\toptional \"io.micrometer:micrometer-core:$micrometerVersion\"\n+\tcompileOnly \"io.micrometer:micrometer-core:$micrometerVersion\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU2OTIwNQ=="}, "originalCommit": {"oid": "0ebf22d5390cab1bd81f0315ad03393e4089e3f1"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTc2MjMzNw==", "bodyText": "Are you sure that compileOnly creates <scope>provided</scope>? It is not the same in other Gradle projects I've seen", "url": "https://github.com/reactor/reactor-core/pull/2261#discussion_r455762337", "createdAt": "2020-07-16T12:53:03Z", "author": {"login": "bsideup"}, "path": "reactor-core/build.gradle", "diffHunk": "@@ -84,7 +74,7 @@ dependencies {\n \toptional \"org.slf4j:slf4j-api:$slf4jVersion\"\n \n \t//Optional Metrics\n-\toptional \"io.micrometer:micrometer-core:$micrometerVersion\"\n+\tcompileOnly \"io.micrometer:micrometer-core:$micrometerVersion\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU2OTIwNQ=="}, "originalCommit": {"oid": "0ebf22d5390cab1bd81f0315ad03393e4089e3f1"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTc4NDcxOQ==", "bodyText": "We just tested and indeed, it does not.", "url": "https://github.com/reactor/reactor-core/pull/2261#discussion_r455784719", "createdAt": "2020-07-16T13:27:12Z", "author": {"login": "ericbottard"}, "path": "reactor-core/build.gradle", "diffHunk": "@@ -84,7 +74,7 @@ dependencies {\n \toptional \"org.slf4j:slf4j-api:$slf4jVersion\"\n \n \t//Optional Metrics\n-\toptional \"io.micrometer:micrometer-core:$micrometerVersion\"\n+\tcompileOnly \"io.micrometer:micrometer-core:$micrometerVersion\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU2OTIwNQ=="}, "originalCommit": {"oid": "0ebf22d5390cab1bd81f0315ad03393e4089e3f1"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxNTU3MDMxOnYy", "diffSide": "RIGHT", "path": "reactor-core/build.gradle", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNDoyNTowNFrOGuqpZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwOTo0MTozMVrOGvw95A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU4NjQwNw==", "bodyText": "this should be unnecessary when using the testSet plugin", "url": "https://github.com/reactor/reactor-core/pull/2261#discussion_r451586407", "createdAt": "2020-07-08T14:25:04Z", "author": {"login": "simonbasle"}, "path": "reactor-core/build.gradle", "diffHunk": "@@ -216,7 +197,7 @@ tasks.withType(Test).all {\n //always depend on testNoMicrometer, skip testNG on Travis, skip loops when not releasing\n //note that this way the tasks can be run individually\n check {\n-\tdependsOn testNoMicrometer\n+\tdependsOn withMicrometerTest", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ebf22d5390cab1bd81f0315ad03393e4089e3f1"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjczODUzMg==", "bodyText": "I think not. Tests sets are often used for longer integration tests, and the default is to not incorporate them in the default lifecycle apparently:\nhttps://github.com/unbroken-dome/gradle-testsets-plugin#running-tests-as-part-of-the-build", "url": "https://github.com/reactor/reactor-core/pull/2261#discussion_r452738532", "createdAt": "2020-07-10T09:41:31Z", "author": {"login": "ericbottard"}, "path": "reactor-core/build.gradle", "diffHunk": "@@ -216,7 +197,7 @@ tasks.withType(Test).all {\n //always depend on testNoMicrometer, skip testNG on Travis, skip loops when not releasing\n //note that this way the tasks can be run individually\n check {\n-\tdependsOn testNoMicrometer\n+\tdependsOn withMicrometerTest", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU4NjQwNw=="}, "originalCommit": {"oid": "0ebf22d5390cab1bd81f0315ad03393e4089e3f1"}, "originalPosition": 80}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 886, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}