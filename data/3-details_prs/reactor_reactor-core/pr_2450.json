{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2Njc2MTAw", "number": 2450, "title": "Fix groupBy initial request off by one", "bodyText": "This fixes the following misalignment:\n\ndrainLoop in GroupByMain does s.request(e) when e groups are produced to the downstream. Each group at the moment has at least 1 element enqueued into it.\nWhen UnicastGroupedFlux consumes elements for the first time, it requests the first element and does main.s.request(e) where e covers the first element\nThat said that GroupByMain fulfilled the demand for the first element and then UnicastGroupedFlux does the same for the second time. It leads that for each group we have 1 extra demand which then ends up with overflow.\nTo avoid that, this PR adds isFirstRequest check which allows removing that redundant demand for the first element on the first requestN\n\nSigned-off-by: Oleh Dokuka shadowgun@i.ua", "createdAt": "2020-10-20T10:31:48Z", "url": "https://github.com/reactor/reactor-core/pull/2450", "merged": true, "mergeCommit": {"oid": "2ff31b300c27aef95a1bc75f4aced81d885d3178"}, "closed": true, "closedAt": "2020-12-09T16:43:43Z", "author": {"login": "OlegDokuka"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUWedTABqjM4OTc5Nzg2ODU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkfgcOAFqTU0ODIzMDA3NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f2112254373383bc0f168d7d5214cb5303ff0b6c", "author": {"user": {"login": "OlegDokuka", "name": "Oleh Dokuka"}}, "url": "https://github.com/reactor/reactor-core/commit/f2112254373383bc0f168d7d5214cb5303ff0b6c", "committedDate": "2020-10-20T10:30:49Z", "message": "fixes GroupBy overflow issue\n\nSigned-off-by: Oleh Dokuka <shadowgun@i.ua>"}, "afterCommit": {"oid": "c40e3598ff07c12d7d1a0311e386b8aff5526644", "author": {"user": {"login": "OlegDokuka", "name": "Oleh Dokuka"}}, "url": "https://github.com/reactor/reactor-core/commit/c40e3598ff07c12d7d1a0311e386b8aff5526644", "committedDate": "2020-10-20T10:46:40Z", "message": "fixes GroupBy overflow issue\n\nSigned-off-by: Oleh Dokuka <shadowgun@i.ua>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyNjMwMTI5", "url": "https://github.com/reactor/reactor-core/pull/2450#pullrequestreview-512630129", "createdAt": "2020-10-20T12:03:00Z", "commit": {"oid": "c40e3598ff07c12d7d1a0311e386b8aff5526644"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyNjMxODk4", "url": "https://github.com/reactor/reactor-core/pull/2450#pullrequestreview-512631898", "createdAt": "2020-10-20T12:05:24Z", "commit": {"oid": "c40e3598ff07c12d7d1a0311e386b8aff5526644"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxMjowNToyNFrOHk48xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxMjowNToyNFrOHk48xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQ0Mzg0Ng==", "bodyText": "should isFirstRequest be volatile? it seems it is updated in two different places that could be run on different threads", "url": "https://github.com/reactor/reactor-core/pull/2450#discussion_r508443846", "createdAt": "2020-10-20T12:05:24Z", "author": {"login": "simonbasle"}, "path": "reactor-core/src/main/java/reactor/core/publisher/FluxGroupBy.java", "diffHunk": "@@ -751,7 +761,16 @@ void tryReplenish() {\n \t\t\t\tproduced = 0;\n \t\t\t\tGroupByMain<?, K, V> main = parent;\n \t\t\t\tif (main != null) {\n-\t\t\t\t\tmain.s.request(p);\n+\t\t\t\t\tif (this.isFirstRequest) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c40e3598ff07c12d7d1a0311e386b8aff5526644"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b0c1d85ce004380ee00c07d237ae896a643b317", "author": {"user": {"login": "OlegDokuka", "name": "Oleh Dokuka"}}, "url": "https://github.com/reactor/reactor-core/commit/8b0c1d85ce004380ee00c07d237ae896a643b317", "committedDate": "2020-12-09T13:09:41Z", "message": "fixes GroupBy overflow issue\n\nSigned-off-by: Oleh Dokuka <shadowgun@i.ua>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ba8625f9fa3ed100b35de57258c2aaa6b7b51ee", "author": {"user": {"login": "OlegDokuka", "name": "Oleh Dokuka"}}, "url": "https://github.com/reactor/reactor-core/commit/5ba8625f9fa3ed100b35de57258c2aaa6b7b51ee", "committedDate": "2020-12-09T13:09:42Z", "message": "adds tests\n\nSigned-off-by: Oleh Dokuka <shadowgun@i.ua>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "65d2ebdc2779480e6cf9739c46ae356af3844d14", "author": {"user": {"login": "OlegDokuka", "name": "Oleh Dokuka"}}, "url": "https://github.com/reactor/reactor-core/commit/65d2ebdc2779480e6cf9739c46ae356af3844d14", "committedDate": "2020-10-20T16:38:15Z", "message": "adds tests\n\nSigned-off-by: Oleh Dokuka <shadowgun@i.ua>"}, "afterCommit": {"oid": "5ba8625f9fa3ed100b35de57258c2aaa6b7b51ee", "author": {"user": {"login": "OlegDokuka", "name": "Oleh Dokuka"}}, "url": "https://github.com/reactor/reactor-core/commit/5ba8625f9fa3ed100b35de57258c2aaa6b7b51ee", "committedDate": "2020-12-09T13:09:42Z", "message": "adds tests\n\nSigned-off-by: Oleh Dokuka <shadowgun@i.ua>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4MjMwMDc0", "url": "https://github.com/reactor/reactor-core/pull/2450#pullrequestreview-548230074", "createdAt": "2020-12-09T14:21:00Z", "commit": {"oid": "5ba8625f9fa3ed100b35de57258c2aaa6b7b51ee"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2665, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}