{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgxOTg0NTQ5", "number": 2365, "title": "Fail fast on non serialized access to Sink", "bodyText": "See #2342", "createdAt": "2020-09-08T11:46:02Z", "url": "https://github.com/reactor/reactor-core/pull/2365", "merged": true, "mergeCommit": {"oid": "19fc1ba10ebed610155e58ed09e158cdcf3e5e65"}, "closed": true, "closedAt": "2020-09-11T15:56:02Z", "author": {"login": "bsideup"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdEjqWYAH2gAyNDgxOTg0NTQ5OmVlZjcxMTIyNDE1ZWVjODIyN2NlNDk1NzQyNmNiZDMyMzE1NTM5NzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdH3a-igFqTQ4NjkyMzkxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "eef71122415eec8227ce4957426cbd3231553970", "author": {"user": {"login": "bsideup", "name": "Sergei Egorov"}}, "url": "https://github.com/reactor/reactor-core/commit/eef71122415eec8227ce4957426cbd3231553970", "committedDate": "2020-09-01T09:05:52Z", "message": "WIP: do not queue non-serialized emissions in `SerializedManySink`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6eaefb1061daf43b739fa353d242c1808895441d", "author": {"user": {"login": "bsideup", "name": "Sergei Egorov"}}, "url": "https://github.com/reactor/reactor-core/commit/6eaefb1061daf43b739fa353d242c1808895441d", "committedDate": "2020-09-01T12:01:43Z", "message": "improve the stress test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ffc09742637435f7f54339598b18e7daf654480", "author": {"user": {"login": "bsideup", "name": "Sergei Egorov"}}, "url": "https://github.com/reactor/reactor-core/commit/0ffc09742637435f7f54339598b18e7daf654480", "committedDate": "2020-09-03T14:54:29Z", "message": "Merge branch 'master' into fail_fast_on_non_serialized_access"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c9291c11efbdc8aeb523c038b772d384268acee", "author": {"user": {"login": "bsideup", "name": "Sergei Egorov"}}, "url": "https://github.com/reactor/reactor-core/commit/7c9291c11efbdc8aeb523c038b772d384268acee", "committedDate": "2020-09-07T15:48:01Z", "message": "remove wip, add the Thread check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10bf0606426000f39b04b36069082455da41bd24", "author": {"user": {"login": "bsideup", "name": "Sergei Egorov"}}, "url": "https://github.com/reactor/reactor-core/commit/10bf0606426000f39b04b36069082455da41bd24", "committedDate": "2020-09-08T11:06:58Z", "message": "use `onBackpressureBuffer()` in `Flux{Retry,Repeat}When`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2084f4abc8fad5dcb0b68815ac7d247a16d916f", "author": {"user": {"login": "bsideup", "name": "Sergei Egorov"}}, "url": "https://github.com/reactor/reactor-core/commit/a2084f4abc8fad5dcb0b68815ac7d247a16d916f", "committedDate": "2020-09-08T11:07:10Z", "message": "fix `UnicastProcessorTest`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a748445e17cfd82f7d2a8df07c16223648dc9c88", "author": {"user": {"login": "bsideup", "name": "Sergei Egorov"}}, "url": "https://github.com/reactor/reactor-core/commit/a748445e17cfd82f7d2a8df07c16223648dc9c88", "committedDate": "2020-09-08T11:43:42Z", "message": "fix the error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06ea9e282b60305435bb38e6ef44c186ac253e8b", "author": {"user": {"login": "bsideup", "name": "Sergei Egorov"}}, "url": "https://github.com/reactor/reactor-core/commit/06ea9e282b60305435bb38e6ef44c186ac253e8b", "committedDate": "2020-09-08T11:45:05Z", "message": "Add missing license header"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0MDgwMDEx", "url": "https://github.com/reactor/reactor-core/pull/2365#pullrequestreview-484080011", "createdAt": "2020-09-08T12:25:55Z", "commit": {"oid": "06ea9e282b60305435bb38e6ef44c186ac253e8b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMjoyNTo1NVrOHOaccg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMjoyNTo1NVrOHOaccg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg3NTM3OA==", "bodyText": "onBackpressureError() was wrongly used and fails the same way in master if the queue is removed (e.g. by using many().unsafe()", "url": "https://github.com/reactor/reactor-core/pull/2365#discussion_r484875378", "createdAt": "2020-09-08T12:25:55Z", "author": {"login": "bsideup"}, "path": "reactor-core/src/main/java/reactor/core/publisher/FluxRepeatWhen.java", "diffHunk": "@@ -211,7 +211,7 @@ public Object scanUnsafe(Attr key) {\n \n \t\tRepeatWhenMainSubscriber<?> main;\n \n-\t\tfinal Sinks.Many<Long> completionSignal = Sinks.many().multicast().onBackpressureError();\n+\t\tfinal Sinks.Many<Long> completionSignal = Sinks.many().multicast().onBackpressureBuffer();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06ea9e282b60305435bb38e6ef44c186ac253e8b"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1ODg4MzA5", "url": "https://github.com/reactor/reactor-core/pull/2365#pullrequestreview-485888309", "createdAt": "2020-09-10T12:43:18Z", "commit": {"oid": "06ea9e282b60305435bb38e6ef44c186ac253e8b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMjo0MzoxOVrOHPxr4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMjo0MzoxOVrOHPxr4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjMwNDczOQ==", "bodyText": "could we maybe loop (maybe with a parkNanos(10) or something) in order to at least ensure that emitXxx methods don't require external synchronization?", "url": "https://github.com/reactor/reactor-core/pull/2365#discussion_r486304739", "createdAt": "2020-09-10T12:43:19Z", "author": {"login": "simonbasle"}, "path": "reactor-core/src/main/java/reactor/core/publisher/SinksSpecs.java", "diffHunk": "@@ -125,12 +128,26 @@ public void emitNext(T value) {\n \t\t\t\temitError(ex);\n \t\t\t\tOperators.onDiscard(value, currentContext());\n \t\t\t\tbreak;\n+\t\t\t}\n \t\t\tcase FAIL_CANCELLED:\n \t\t\t\tOperators.onDiscard(value, currentContext());\n \t\t\t\tbreak;\n \t\t\tcase FAIL_TERMINATED:\n \t\t\t\tOperators.onNextDropped(value, currentContext());\n \t\t\t\tbreak;\n+\t\t\tcase FAIL_NON_SERIALIZED: {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06ea9e282b60305435bb38e6ef44c186ac253e8b"}, "originalPosition": 101}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1ODg5MzI1", "url": "https://github.com/reactor/reactor-core/pull/2365#pullrequestreview-485889325", "createdAt": "2020-09-10T12:44:31Z", "commit": {"oid": "06ea9e282b60305435bb38e6ef44c186ac253e8b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMjo0NDozMVrOHPxukg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMjo0NDozMVrOHPxukg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjMwNTQyNg==", "bodyText": "we'll need to document that fail fast behavior everywhere we pretend that Sinks are by default safe to use from multiple threads (mainly in various places of Sinks.java javadocs)", "url": "https://github.com/reactor/reactor-core/pull/2365#discussion_r486305426", "createdAt": "2020-09-10T12:44:31Z", "author": {"login": "simonbasle"}, "path": "reactor-core/src/main/java/reactor/core/publisher/SinksSpecs.java", "diffHunk": "@@ -81,16 +77,23 @@ public final Emission tryEmitComplete() {\n \t\tif (done) {\n \t\t\treturn Sinks.Emission.FAIL_TERMINATED;\n \t\t}\n+\t\tThread lockedAt = this.lockedAt;\n+\t\tif (!(lockedAt == null || lockedAt == Thread.currentThread())) {\n+\t\t\treturn Emission.FAIL_NON_SERIALIZED;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06ea9e282b60305435bb38e6ef44c186ac253e8b"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2OTIzOTEx", "url": "https://github.com/reactor/reactor-core/pull/2365#pullrequestreview-486923911", "createdAt": "2020-09-11T15:48:57Z", "commit": {"oid": "06ea9e282b60305435bb38e6ef44c186ac253e8b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2862, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}