{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyMDAwNTQ0", "number": 2545, "title": "fix #2538 Let `TestLogger` be configured with simplified format", "bodyText": "Added a customization option for each log type to opt out of printing the current thread name.", "createdAt": "2020-12-17T17:02:23Z", "url": "https://github.com/reactor/reactor-core/pull/2545", "merged": true, "mergeCommit": {"oid": "4fc1d2e24215f4bd513e7f2cd993de11fb847158"}, "closed": true, "closedAt": "2021-01-19T13:23:07Z", "author": {"login": "vdjuketic"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdlK0oJAH2gAyNTQyMDAwNTQ0OjU3MDQ0M2I4YTIwZTdjM2VhN2M3MTZhMGE4YmEwNTM4Yzc5YjliNTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdxrNvXgFqTU3MTIzMzkxNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "570443b8a20e7c3ea7c716a0a8ba0538c79b9b53", "author": {"user": {"login": "vdjuketic", "name": "Vuka\u0161in \u0110uketi\u0107"}}, "url": "https://github.com/reactor/reactor-core/commit/570443b8a20e7c3ea7c716a0a8ba0538c79b9b53", "committedDate": "2020-12-11T16:48:58Z", "message": "fix #2538 Let `TestLogger` be configured with static message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c3d4369810950afe5ef085fb00964476c465672", "author": {"user": {"login": "vdjuketic", "name": "Vuka\u0161in \u0110uketi\u0107"}}, "url": "https://github.com/reactor/reactor-core/commit/8c3d4369810950afe5ef085fb00964476c465672", "committedDate": "2020-12-11T17:22:04Z", "message": "removed unnecessary changes to Logger.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90617f842a446f887cc054d6374df107c16c02da", "author": {"user": {"login": "vdjuketic", "name": "Vuka\u0161in \u0110uketi\u0107"}}, "url": "https://github.com/reactor/reactor-core/commit/90617f842a446f887cc054d6374df107c16c02da", "committedDate": "2020-12-14T14:13:27Z", "message": "Reverted previous unnecessary changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0112daf6b7ea4baedc2bf96cffc5d13ec814d7d", "author": {"user": {"login": "vdjuketic", "name": "Vuka\u0161in \u0110uketi\u0107"}}, "url": "https://github.com/reactor/reactor-core/commit/d0112daf6b7ea4baedc2bf96cffc5d13ec814d7d", "committedDate": "2020-12-17T16:55:18Z", "message": "add customization to opt-out of logging thread name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0ODExMzc0", "url": "https://github.com/reactor/reactor-core/pull/2545#pullrequestreview-554811374", "createdAt": "2020-12-17T17:11:28Z", "commit": {"oid": "d0112daf6b7ea4baedc2bf96cffc5d13ec814d7d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxNzoxMToyOVrOIH_1Vw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxNzoxMzozM1rOIH_7AA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTI1Njc5MQ==", "bodyText": "looking at this, I'm thinking maybe a second method like private String format could be used in all the log methods, in order to mutualize this if/else choice, wdyt?\nthe new method would get two strings as input: the prefix ([TRACE] and the other variants) and the user-provided message / format(format, arguments) result. it would then decide whether or not to put the thread name in the middle, centralizing that decision.", "url": "https://github.com/reactor/reactor-core/pull/2545#discussion_r545256791", "createdAt": "2020-12-17T17:11:29Z", "author": {"login": "simonbasle"}, "path": "reactor-test/src/main/java/reactor/test/util/TestLogger.java", "diffHunk": "@@ -83,16 +85,28 @@ public boolean isTraceEnabled() {\n \n \t@Override\n \tpublic synchronized void trace(String msg) {\n-\t\tthis.log.format(\"[TRACE] (%s) %s\\n\", Thread.currentThread().getName(), msg);\n+\t\tif(logCurrentThreadName){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0112daf6b7ea4baedc2bf96cffc5d13ec814d7d"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTI1ODI0MA==", "bodyText": "I don't think there is much need to make it mutable. could you replace the setter with a second constructor taking the boolean directly, and make the field final?", "url": "https://github.com/reactor/reactor-core/pull/2545#discussion_r545258240", "createdAt": "2020-12-17T17:13:33Z", "author": {"login": "simonbasle"}, "path": "reactor-test/src/main/java/reactor/test/util/TestLogger.java", "diffHunk": "@@ -166,17 +216,37 @@ public boolean isErrorEnabled() {\n \n \t@Override\n \tpublic synchronized void error(String msg) {\n-\t\tthis.err.format(\"[ERROR] (%s) %s\\n\", Thread.currentThread().getName(), msg);\n+\t\tif(logCurrentThreadName){\n+\t\t\tthis.err.format(\"[ERROR] (%s) %s\\n\", Thread.currentThread().getName(), msg);\n+\t\t} else {\n+\t\t\tthis.err.format(\"[ERROR] %s\\n\", msg);\n+\t\t}\n \t}\n \n \t@Override\n \tpublic synchronized void error(String format, Object... arguments) {\n-\t\tthis.err.format(\"[ERROR] (%s) %s\\n\", Thread.currentThread().getName(), format(format, arguments));\n+\t\tif(logCurrentThreadName){\n+\t\t\tthis.err.format(\"[ERROR] (%s) %s\\n\", Thread.currentThread().getName(), format(format, arguments));\n+\t\t} else {\n+\t\t\tthis.err.format(\"[ERROR] %s\\n\", format(format, arguments));\n+\t\t}\n \t}\n \n \t@Override\n \tpublic synchronized void error(String msg, Throwable t) {\n-\t\tthis.err.format(\"[ERROR] (%s) %s - %s\\n\", Thread.currentThread().getName(), msg, t);\n+\t\tif(logCurrentThreadName){\n+\t\t\tthis.err.format(\"[ERROR] (%s) %s - %s\\n\", Thread.currentThread().getName(), msg, t);\n+\t\t} else {\n+\t\t\tthis.err.format(\"[ERROR] %s - %s\\n\", msg, t);\n+\t\t}\n \t\tt.printStackTrace(this.err);\n \t}\n+\n+\tpublic boolean isLogCurrentThreadName() {\n+\t\treturn logCurrentThreadName;\n+\t}\n+\n+\tpublic void setLogCurrentThreadName(boolean logCurrentThreadName) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0112daf6b7ea4baedc2bf96cffc5d13ec814d7d"}, "originalPosition": 183}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6acafbe9e4e3987cb7b61c972ad2ee261cfeb7e2", "author": {"user": {"login": "vdjuketic", "name": "Vuka\u0161in \u0110uketi\u0107"}}, "url": "https://github.com/reactor/reactor-core/commit/6acafbe9e4e3987cb7b61c972ad2ee261cfeb7e2", "committedDate": "2021-01-17T11:46:23Z", "message": "refactor TestLogger to mutualize if/else in log methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b155e9fa327674a805c216d157773862be11ec4", "author": {"user": {"login": "vdjuketic", "name": "Vuka\u0161in \u0110uketi\u0107"}}, "url": "https://github.com/reactor/reactor-core/commit/7b155e9fa327674a805c216d157773862be11ec4", "committedDate": "2021-01-18T08:14:13Z", "message": "fix failing unit tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTcwMzEwNTM4", "url": "https://github.com/reactor/reactor-core/pull/2545#pullrequestreview-570310538", "createdAt": "2021-01-18T09:32:12Z", "commit": {"oid": "6acafbe9e4e3987cb7b61c972ad2ee261cfeb7e2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOFQwOTozMjoxMlrOIVgtpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOFQwOTozMjoxMlrOIVgtpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTQyNjk4MQ==", "bodyText": "can you just ensure the log levels are padded left? [%5s] in both format Strings should suffice", "url": "https://github.com/reactor/reactor-core/pull/2545#discussion_r559426981", "createdAt": "2021-01-18T09:32:12Z", "author": {"login": "simonbasle"}, "path": "reactor-test/src/main/java/reactor/test/util/TestLogger.java", "diffHunk": "@@ -216,37 +176,30 @@ public boolean isErrorEnabled() {\n \n \t@Override\n \tpublic synchronized void error(String msg) {\n-\t\tif(logCurrentThreadName){\n-\t\t\tthis.err.format(\"[ERROR] (%s) %s\\n\", Thread.currentThread().getName(), msg);\n-\t\t} else {\n-\t\t\tthis.err.format(\"[ERROR] %s\\n\", msg);\n-\t\t}\n+\t\tthis.err.format(logContent(\"ERROR\", msg));\n \t}\n \n \t@Override\n \tpublic synchronized void error(String format, Object... arguments) {\n-\t\tif(logCurrentThreadName){\n-\t\t\tthis.err.format(\"[ERROR] (%s) %s\\n\", Thread.currentThread().getName(), format(format, arguments));\n-\t\t} else {\n-\t\t\tthis.err.format(\"[ERROR] %s\\n\", format(format, arguments));\n-\t\t}\n+\t\tthis.err.format(logContent(\"ERROR\", format(format, arguments)));\n \t}\n \n \t@Override\n \tpublic synchronized void error(String msg, Throwable t) {\n+\t\tthis.err.format(logContent(\"ERROR\", String.format(\"%s - %s\", msg, t)));\n+\t\tt.printStackTrace(this.err);\n+\t}\n+\n+\tString logContent(String logType, String msg){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6acafbe9e4e3987cb7b61c972ad2ee261cfeb7e2"}, "originalPosition": 189}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTcxMjMzOTE3", "url": "https://github.com/reactor/reactor-core/pull/2545#pullrequestreview-571233917", "createdAt": "2021-01-19T13:20:27Z", "commit": {"oid": "7b155e9fa327674a805c216d157773862be11ec4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2737, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}