{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4MTcwMDgx", "number": 2512, "title": "Avoid LoggerUtils.CapturingFactory nesting, reset capture logger after LoggersTest", "bodyText": "This PR fixes failing tests on CI that don't fail locally because the order of execution seems to be different in GHA. (Gradle/JUnit5 order of execution is non-deterministic anyway).\nIt also fixes a potential issue with LoggerUtils where continuous installation of the factory on top of itself could lead to StackOverflowException.", "createdAt": "2020-11-26T16:13:33Z", "url": "https://github.com/reactor/reactor-core/pull/2512", "merged": true, "mergeCommit": {"oid": "220e040998c0a8f3e717b02841c2d65d9c42a1be"}, "closed": true, "closedAt": "2020-11-27T10:31:25Z", "author": {"login": "simonbasle"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdgXol9AH2gAyNTI4MTcwMDgxOjNmZjZmYzBjZmVkMmEyYzQ2ODIzMTg3ZGQxMDQ1MjNlMGVhNzJjMjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdglBSFAFqTUzOTg3MDc3NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3ff6fc0cfed2a2c46823187dd104523e0ea72c25", "author": {"user": {"login": "simonbasle", "name": "Simon Basl\u00e9"}}, "url": "https://github.com/reactor/reactor-core/commit/3ff6fc0cfed2a2c46823187dd104523e0ea72c25", "committedDate": "2020-11-26T18:54:58Z", "message": "[polish] Simplify gradle handling of standard output (see #2512)\n\nThe stackTraceFilter didn't seem to help much, and the custom code to\noutput standard output in case of a test failure was brittle and\nseem unnecessary on github actions CI for now."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7047157af23185eff7df79a70df1e12685eced99", "author": {"user": {"login": "simonbasle", "name": "Simon Basl\u00e9"}}, "url": "https://github.com/reactor/reactor-core/commit/7047157af23185eff7df79a70df1e12685eced99", "committedDate": "2020-11-26T18:09:12Z", "message": "tag LoggersTest and reset capture factory from execution listener"}, "afterCommit": {"oid": "9268a0447f9450238e71b5d0147c9b12455ac198", "author": {"user": {"login": "simonbasle", "name": "Simon Basl\u00e9"}}, "url": "https://github.com/reactor/reactor-core/commit/9268a0447f9450238e71b5d0147c9b12455ac198", "committedDate": "2020-11-26T18:55:21Z", "message": "[test] Have loggers reset to CapturingFactory after LoggersTest (#2512)\n\nDepending on the execution order of the tests, the CapturingFactory set\nup by the ReactorTestExecutionListener could be overwritten by\nLoggersTest, resulting in failure of the 30 tests that rely on the log\ncapture mechanisms.\n\nThis commit ensures that the capturing factory is set again after these\ntests, and any test tagged with `Tag(\"changesLoggerFactory\")`."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5NTM3OTQ2", "url": "https://github.com/reactor/reactor-core/pull/2512#pullrequestreview-539537946", "createdAt": "2020-11-26T20:21:17Z", "commit": {"oid": "9268a0447f9450238e71b5d0147c9b12455ac198"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQyMDoyMToxOFrOH6mrzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQyMDoyMToxOFrOH6mrzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTIxMzI2Mg==", "bodyText": "Seems a bit blunt to use a tag and custom logic in this class. Why not @After or @AfterAll in LoggersTest only?", "url": "https://github.com/reactor/reactor-core/pull/2512#discussion_r531213262", "createdAt": "2020-11-26T20:21:18Z", "author": {"login": "ericbottard"}, "path": "reactor-core/src/test/java/reactor/ReactorTestExecutionListener.java", "diffHunk": "@@ -61,11 +63,19 @@ private static void resetHooksAndSchedulers() {\n \t@Override\n \tpublic void executionFinished(TestIdentifier testIdentifier, TestExecutionResult testExecutionResult) {\n \t\tresetHooksAndSchedulers();\n+\t\tif (testIdentifier.getTags().contains(TestTag.create(\"changesLoggerFactory\"))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9268a0447f9450238e71b5d0147c9b12455ac198"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "469bc877ba8fd197a981e1f3c5f0c9571da686bf", "author": {"user": {"login": "simonbasle", "name": "Simon Basl\u00e9"}}, "url": "https://github.com/reactor/reactor-core/commit/469bc877ba8fd197a981e1f3c5f0c9571da686bf", "committedDate": "2020-11-27T09:39:29Z", "message": "[polish] Remove internal LoggerFactory interface (#2512)\n\nThis commit removes the internal `LoggerFactory` interface from the\nLoggerUtils class, directly storing the factories as `Function`s.\n\nThis enables comparisons to be made with the current factory and any\nother factory, including the `useCustomLoggers` Function-based ones."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c9bab3475d848e2ccfb44a08f5e4fac248f43fa", "author": {"user": {"login": "simonbasle", "name": "Simon Basl\u00e9"}}, "url": "https://github.com/reactor/reactor-core/commit/6c9bab3475d848e2ccfb44a08f5e4fac248f43fa", "committedDate": "2020-11-27T09:42:36Z", "message": "Prevent nested install of CapturingFactory, polish LoggerUtils (#2512)\n\nNow that logger factory is stored as a Function, the CapturingFactory\ncan reflexively detect another one is already in place (which was\ntrickier before, as the field would contain a method reference, not the\nwhole instance).\n\nAs a consequence, attempting to install a CapturingFactory over another\nCapturingFactory will result in the old one being returned.\n\nThis commit also contains a few polish changes (fixing typos, etc...)."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d2baa2433e948635b54b1142a2b44e1c48ac14f", "author": {"user": {"login": "simonbasle", "name": "Simon Basl\u00e9"}}, "url": "https://github.com/reactor/reactor-core/commit/0d2baa2433e948635b54b1142a2b44e1c48ac14f", "committedDate": "2020-11-27T09:43:50Z", "message": "[test] Have loggers reset to CapturingFactory after LoggersTest (#2512)\n\nDepending on the execution order of the tests, the CapturingFactory set\nup by the ReactorTestExecutionListener could be overwritten by\nLoggersTest, resulting in failure of the 30 tests that rely on the log\ncapture mechanisms.\n\nThis commit ensures that the capturing factory is set again after these\ntests, delegating to ReactorTestExecutionListener for the exact logger\nsetup."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9ea04cd4ae8bff50273bb222dfada4a38b2e609e", "author": {"user": {"login": "simonbasle", "name": "Simon Basl\u00e9"}}, "url": "https://github.com/reactor/reactor-core/commit/9ea04cd4ae8bff50273bb222dfada4a38b2e609e", "committedDate": "2020-11-27T09:32:28Z", "message": "fixup: switch from tag to AfterAll for reset"}, "afterCommit": {"oid": "0d2baa2433e948635b54b1142a2b44e1c48ac14f", "author": {"user": {"login": "simonbasle", "name": "Simon Basl\u00e9"}}, "url": "https://github.com/reactor/reactor-core/commit/0d2baa2433e948635b54b1142a2b44e1c48ac14f", "committedDate": "2020-11-27T09:43:50Z", "message": "[test] Have loggers reset to CapturingFactory after LoggersTest (#2512)\n\nDepending on the execution order of the tests, the CapturingFactory set\nup by the ReactorTestExecutionListener could be overwritten by\nLoggersTest, resulting in failure of the 30 tests that rely on the log\ncapture mechanisms.\n\nThis commit ensures that the capturing factory is set again after these\ntests, delegating to ReactorTestExecutionListener for the exact logger\nsetup."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5ODcwNzc1", "url": "https://github.com/reactor/reactor-core/pull/2512#pullrequestreview-539870775", "createdAt": "2020-11-27T10:30:42Z", "commit": {"oid": "0d2baa2433e948635b54b1142a2b44e1c48ac14f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2713, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}