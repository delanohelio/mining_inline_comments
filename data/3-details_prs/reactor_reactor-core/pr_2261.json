{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2MjYxMDk5", "number": 2261, "title": "fix #2251 refactor how micrometer integration is tested", "bodyText": "This PR reconsiders how micrometer integration is tested by flipping the logic:\n\nthe main tests don't have micrometer on the classpath (and assert what happens then)\na dedicated test-set (using the same plugin as what was used for Blockhound, albeit for different reasons) adds micrometer and tests what happens then.", "createdAt": "2020-07-08T13:56:07Z", "url": "https://github.com/reactor/reactor-core/pull/2261", "merged": true, "mergeCommit": {"oid": "215f26ba5add914bb0837b66b7a29b5d486a0775"}, "closed": true, "closedAt": "2020-07-16T13:32:41Z", "author": {"login": "ericbottard"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcy68U-gFqTQ0NDc5NzIwMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1fN-BgBqjM1NTMyMDE4MTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0Nzk3MjAx", "url": "https://github.com/reactor/reactor-core/pull/2261#pullrequestreview-444797201", "createdAt": "2020-07-08T14:02:41Z", "commit": {"oid": "0ebf22d5390cab1bd81f0315ad03393e4089e3f1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNDowMjo0MVrOGupmNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNDowMjo0MVrOGupmNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU2OTIwNQ==", "bodyText": "we should keep it as optional", "url": "https://github.com/reactor/reactor-core/pull/2261#discussion_r451569205", "createdAt": "2020-07-08T14:02:41Z", "author": {"login": "bsideup"}, "path": "reactor-core/build.gradle", "diffHunk": "@@ -84,7 +74,7 @@ dependencies {\n \toptional \"org.slf4j:slf4j-api:$slf4jVersion\"\n \n \t//Optional Metrics\n-\toptional \"io.micrometer:micrometer-core:$micrometerVersion\"\n+\tcompileOnly \"io.micrometer:micrometer-core:$micrometerVersion\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ebf22d5390cab1bd81f0315ad03393e4089e3f1"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0ODE5NzY0", "url": "https://github.com/reactor/reactor-core/pull/2261#pullrequestreview-444819764", "createdAt": "2020-07-08T14:25:03Z", "commit": {"oid": "0ebf22d5390cab1bd81f0315ad03393e4089e3f1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNDoyNTowNFrOGuqpZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNDoyNTowNFrOGuqpZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU4NjQwNw==", "bodyText": "this should be unnecessary when using the testSet plugin", "url": "https://github.com/reactor/reactor-core/pull/2261#discussion_r451586407", "createdAt": "2020-07-08T14:25:04Z", "author": {"login": "simonbasle"}, "path": "reactor-core/build.gradle", "diffHunk": "@@ -216,7 +197,7 @@ tasks.withType(Test).all {\n //always depend on testNoMicrometer, skip testNG on Travis, skip loops when not releasing\n //note that this way the tasks can be run individually\n check {\n-\tdependsOn testNoMicrometer\n+\tdependsOn withMicrometerTest", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ebf22d5390cab1bd81f0315ad03393e4089e3f1"}, "originalPosition": 80}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5Njk1NjQ5", "url": "https://github.com/reactor/reactor-core/pull/2261#pullrequestreview-449695649", "createdAt": "2020-07-16T09:53:08Z", "commit": {"oid": "0ebf22d5390cab1bd81f0315ad03393e4089e3f1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwOTo1MzowOFrOGyjsUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwOTo1MzowOFrOGyjsUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY2Njc3MQ==", "bodyText": "since we can't use compileOnly on production code (<scope>provided</scope>), we should thus indeed keep it as optional. The trouble with that is that the local OptionalDependenciesPlugin puts the optional dependency on the compile and runtime classpath of EVERY java sourceSet. Maybe we need a way larger refactor, where the optional would only get added to main sourceSet?", "url": "https://github.com/reactor/reactor-core/pull/2261#discussion_r455666771", "createdAt": "2020-07-16T09:53:08Z", "author": {"login": "simonbasle"}, "path": "reactor-core/build.gradle", "diffHunk": "@@ -84,7 +74,7 @@ dependencies {\n \toptional \"org.slf4j:slf4j-api:$slf4jVersion\"\n \n \t//Optional Metrics\n-\toptional \"io.micrometer:micrometer-core:$micrometerVersion\"\n+\tcompileOnly \"io.micrometer:micrometer-core:$micrometerVersion\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU2OTIwNQ=="}, "originalCommit": {"oid": "0ebf22d5390cab1bd81f0315ad03393e4089e3f1"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51103fb42e074b32a5ed568f7e957a695f520de5", "author": {"user": {"login": "ericbottard", "name": "Eric Bottard"}}, "url": "https://github.com/reactor/reactor-core/commit/51103fb42e074b32a5ed568f7e957a695f520de5", "committedDate": "2020-07-16T13:25:29Z", "message": "fix #2251 refactor how micrometer integration is tested"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0ebf22d5390cab1bd81f0315ad03393e4089e3f1", "author": {"user": {"login": "ericbottard", "name": "Eric Bottard"}}, "url": "https://github.com/reactor/reactor-core/commit/0ebf22d5390cab1bd81f0315ad03393e4089e3f1", "committedDate": "2020-07-08T13:53:55Z", "message": "fix 2251 refactor how micrometer integration is tested"}, "afterCommit": {"oid": "51103fb42e074b32a5ed568f7e957a695f520de5", "author": {"user": {"login": "ericbottard", "name": "Eric Bottard"}}, "url": "https://github.com/reactor/reactor-core/commit/51103fb42e074b32a5ed568f7e957a695f520de5", "committedDate": "2020-07-16T13:25:29Z", "message": "fix #2251 refactor how micrometer integration is tested"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2775, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}