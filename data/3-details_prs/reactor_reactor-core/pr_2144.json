{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzNDk3MDA0", "number": 2144, "title": "fix #2143 Use ZoneId.of(String) to avoid blocking disk load", "bodyText": "The former use of ZoneId.systemDefault() would trigger a file read from\ndisk (configuration read for the sytem's default timezone), despite the\ntimezone not being that important for the Scheduler. Using of(String)\nfactory method avoids that disk read. The ZoneId is frontloaded as a\nconstant anyway, since it is used by the SHUTDOWN constant as well.", "createdAt": "2020-05-05T12:53:01Z", "url": "https://github.com/reactor/reactor-core/pull/2144", "merged": true, "mergeCommit": {"oid": "d6e3f43f033cb3215ebacbc60f43ffd09a0f1b17"}, "closed": true, "closedAt": "2020-05-06T09:25:34Z", "author": {"login": "simonbasle"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceTzjbgFqTQwNTc2ODk1OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcelNYlgBqjMzMDc2MjU3NTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NzY4OTU4", "url": "https://github.com/reactor/reactor-core/pull/2144#pullrequestreview-405768958", "createdAt": "2020-05-05T13:08:19Z", "commit": {"oid": "f3ef3c89db99e9a5ed5102f25f71080d614a5a19"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxMzowODoxOVrOGQohMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxMzowODoxOVrOGQohMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA5NDI1OQ==", "bodyText": "FYI you can achieve the same with less code by submitting FutureTask (will re-throw from .get)", "url": "https://github.com/reactor/reactor-core/pull/2144#discussion_r420094259", "createdAt": "2020-05-05T13:08:19Z", "author": {"login": "bsideup"}, "path": "reactor-core/src/blockHoundTest/java/reactor/core/scheduler/BoundedElasticSchedulerBlockhoundTest.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Copyright (c) 2011-Present VMware Inc. or its affiliates, All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *        https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package reactor.core.scheduler;\n+\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import org.junit.Test;\n+\n+/**\n+ * @author Simon Basl\u00e9\n+ */\n+public class BoundedElasticSchedulerBlockhoundTest {\n+\n+\t//see https://github.com/reactor/reactor-core/issues/2143\n+\t@Test\n+\tpublic void shouldNotReportBlockingCallWithZoneIdUsage() throws Throwable {\n+\t\tAtomicReference<Throwable> errorRef = new AtomicReference<>(null);\n+\t\tCountDownLatch latch = new CountDownLatch(1);\n+\t\tSchedulers.single().schedule(() -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3ef3c89db99e9a5ed5102f25f71080d614a5a19"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NzY5MjY1", "url": "https://github.com/reactor/reactor-core/pull/2144#pullrequestreview-405769265", "createdAt": "2020-05-05T13:08:44Z", "commit": {"oid": "f3ef3c89db99e9a5ed5102f25f71080d614a5a19"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1ODgwMDY2", "url": "https://github.com/reactor/reactor-core/pull/2144#pullrequestreview-405880066", "createdAt": "2020-05-05T15:04:43Z", "commit": {"oid": "a703e483e81d63c5fcd3541957618dc8d952ea80"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNTowNDo0M1rOGQt1Gg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNTowNDo0M1rOGQt1Gg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE4MTI3NA==", "bodyText": "BlockHound.install() would be fine here", "url": "https://github.com/reactor/reactor-core/pull/2144#discussion_r420181274", "createdAt": "2020-05-05T15:04:43Z", "author": {"login": "bsideup"}, "path": "reactor-core/src/blockHoundTest/java/reactor/core/scheduler/BoundedElasticSchedulerBlockhoundTest.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Copyright (c) 2011-Present VMware Inc. or its affiliates, All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *        https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package reactor.core.scheduler;\n+\n+import java.util.concurrent.FutureTask;\n+\n+import org.junit.Test;\n+\n+import reactor.blockhound.BlockHound;\n+import reactor.core.Disposable;\n+import reactor.core.Disposables;\n+\n+/**\n+ * @author Simon Basl\u00e9\n+ */\n+public class BoundedElasticSchedulerBlockhoundTest {\n+\n+\tstatic {\n+\t\t// Use the builder to load only our integration to avoid false positives\n+\t\tBlockHound.builder()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a703e483e81d63c5fcd3541957618dc8d952ea80"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1ODgwOTUy", "url": "https://github.com/reactor/reactor-core/pull/2144#pullrequestreview-405880952", "createdAt": "2020-05-05T15:05:41Z", "commit": {"oid": "a703e483e81d63c5fcd3541957618dc8d952ea80"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNTowNTo0MVrOGQt34g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNTowNTo0MVrOGQt34g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE4MTk4Ng==", "bodyText": "If you change it to FutureTask<Disposable>, it will be a one liner :)", "url": "https://github.com/reactor/reactor-core/pull/2144#discussion_r420181986", "createdAt": "2020-05-05T15:05:41Z", "author": {"login": "bsideup"}, "path": "reactor-core/src/blockHoundTest/java/reactor/core/scheduler/BoundedElasticSchedulerBlockhoundTest.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Copyright (c) 2011-Present VMware Inc. or its affiliates, All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *        https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package reactor.core.scheduler;\n+\n+import java.util.concurrent.FutureTask;\n+\n+import org.junit.Test;\n+\n+import reactor.blockhound.BlockHound;\n+import reactor.core.Disposable;\n+import reactor.core.Disposables;\n+\n+/**\n+ * @author Simon Basl\u00e9\n+ */\n+public class BoundedElasticSchedulerBlockhoundTest {\n+\n+\tstatic {\n+\t\t// Use the builder to load only our integration to avoid false positives\n+\t\tBlockHound.builder()\n+\t\t          .with(new ReactorBlockHoundIntegration())\n+\t\t          .install();\n+\t}\n+\n+\t//see https://github.com/reactor/reactor-core/issues/2143\n+\t@Test\n+\tpublic void shouldNotReportBlockingCallWithZoneIdUsage() throws Throwable {\n+\t\tFutureTask<Void> testTask = new FutureTask<>(() -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a703e483e81d63c5fcd3541957618dc8d952ea80"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1OTI4NzE1", "url": "https://github.com/reactor/reactor-core/pull/2144#pullrequestreview-405928715", "createdAt": "2020-05-05T15:57:45Z", "commit": {"oid": "d29a773162f240bdb612adbc834daa24dd016361"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64a8d21b2045fdbcbfc5e93a85da93e0f4cf34d3", "author": {"user": {"login": "simonbasle", "name": "Simon Basl\u00e9"}}, "url": "https://github.com/reactor/reactor-core/commit/64a8d21b2045fdbcbfc5e93a85da93e0f4cf34d3", "committedDate": "2020-05-06T09:23:43Z", "message": "[build] Have blockHoundTest fork JVM on every case (see #2144)\n\nForking JVMs is useful for Blockhound-related tests as the installation\nis JVM-wide and non-reversible."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4aacdf5081493f7dcd89911f1363e8f0796777c", "author": {"user": {"login": "simonbasle", "name": "Simon Basl\u00e9"}}, "url": "https://github.com/reactor/reactor-core/commit/d4aacdf5081493f7dcd89911f1363e8f0796777c", "committedDate": "2020-05-06T09:24:20Z", "message": "fix #2143 Use ZoneId.of(String) to avoid blocking disk load\n\nThe former use of ZoneId.systemDefault() would trigger a file read from\ndisk (configuration read for the sytem's default timezone), despite the\ntimezone not being that important for the Scheduler. Using of(String)\nfactory method avoids that disk read. The ZoneId is frontloaded as a\nconstant anyway, since it is used by the SHUTDOWN constant as well."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d29a773162f240bdb612adbc834daa24dd016361", "author": {"user": {"login": "simonbasle", "name": "Simon Basl\u00e9"}}, "url": "https://github.com/reactor/reactor-core/commit/d29a773162f240bdb612adbc834daa24dd016361", "committedDate": "2020-05-05T15:45:23Z", "message": "simplify setup now that JVM is forked"}, "afterCommit": {"oid": "d4aacdf5081493f7dcd89911f1363e8f0796777c", "author": {"user": {"login": "simonbasle", "name": "Simon Basl\u00e9"}}, "url": "https://github.com/reactor/reactor-core/commit/d4aacdf5081493f7dcd89911f1363e8f0796777c", "committedDate": "2020-05-06T09:24:20Z", "message": "fix #2143 Use ZoneId.of(String) to avoid blocking disk load\n\nThe former use of ZoneId.systemDefault() would trigger a file read from\ndisk (configuration read for the sytem's default timezone), despite the\ntimezone not being that important for the Scheduler. Using of(String)\nfactory method avoids that disk read. The ZoneId is frontloaded as a\nconstant anyway, since it is used by the SHUTDOWN constant as well."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2970, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}