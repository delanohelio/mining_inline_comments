{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxMDE3Nzc5", "number": 679, "title": "Release the datastream task lock after shutdown is complete and not during stop()", "bodyText": "Partition-managed BMM:\nCurrently the datastream task lock is released on the call to stop(). This is incorrect because stop() only sets a flag indicating a shutdown has been triggered. The actual task thread will complete its current loop, commit offsets, and then complete (or throw exception). The finally() block of the run-loop is where the consumer is closed, and is a safe point in time to release the lock, since consumption is no longer possible. This change adds a postShutdownHook(), and implements this for the KafkaMirrorMakerConnectorTask.", "createdAt": "2020-02-04T19:45:52Z", "url": "https://github.com/linkedin/brooklin/pull/679", "merged": true, "mergeCommit": {"oid": "3d83c37fb5805a2543b25b2664d32aa6a8dbb1e8"}, "closed": true, "closedAt": "2020-02-04T21:36:49Z", "author": {"login": "somandal"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBG5blAH2gAyMzcxMDE3Nzc5OjU2MWNkNDczZjkxYTNkZWZmZGEzNmMwNGM3MzdlY2FiYjE5ZTY4MmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBHN7GgFqTM1MzI2NDI3Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "561cd473f91a3deffda36c04c737ecabb19e682b", "author": {"user": {"login": "somandal", "name": "Sonam Mandal"}}, "url": "https://github.com/linkedin/brooklin/commit/561cd473f91a3deffda36c04c737ecabb19e682b", "committedDate": "2020-02-04T19:42:10Z", "message": "Partition-managed BMM: The datastream task lock should be released after shutdown is complete and not during stop()"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMjU1OTQ5", "url": "https://github.com/linkedin/brooklin/pull/679#pullrequestreview-353255949", "createdAt": "2020-02-04T19:51:07Z", "commit": {"oid": "561cd473f91a3deffda36c04c737ecabb19e682b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMjYzNzI5", "url": "https://github.com/linkedin/brooklin/pull/679#pullrequestreview-353263729", "createdAt": "2020-02-04T20:03:37Z", "commit": {"oid": "561cd473f91a3deffda36c04c737ecabb19e682b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQyMDowMzozOFrOFlhrhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQyMDowMzozOFrOFlhrhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg5MzQ0NQ==", "bodyText": "Thinking out loud: should we just call it postShutdown()?", "url": "https://github.com/linkedin/brooklin/pull/679#discussion_r374893445", "createdAt": "2020-02-04T20:03:38Z", "author": {"login": "ahmedahamid"}, "path": "datastream-kafka-connector/src/main/java/com/linkedin/datastream/connectors/kafka/AbstractKafkaBasedConnectorTask.java", "diffHunk": "@@ -206,6 +206,11 @@ protected KafkaBasedConnectorTaskMetrics createKafkaBasedConnectorTaskMetrics(St\n   protected abstract DatastreamProducerRecord translate(ConsumerRecord<?, ?> fromKafka, Instant readTime)\n       throws Exception;\n \n+  /**\n+   * Post shutdown hook to be called for any operations that need to be performed before exiting the task.\n+   */\n+  protected void postShutdownHook() { }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "561cd473f91a3deffda36c04c737ecabb19e682b"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMjY0Mjc2", "url": "https://github.com/linkedin/brooklin/pull/679#pullrequestreview-353264276", "createdAt": "2020-02-04T20:04:33Z", "commit": {"oid": "561cd473f91a3deffda36c04c737ecabb19e682b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 360, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}