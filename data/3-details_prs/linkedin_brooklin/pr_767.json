{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA0OTQzNDg2", "number": 767, "title": "Fix the BMM event processing time metric to be in nanoseconds instead of milliseconds", "bodyText": "Deployed this code in our certification environment and saw that the metric for event processing time was showing up as 0 in the 50 percentile graphs, and very tiny numbers in the 99 percentile graph. Reading some documentation indicated using System.nanoTime() for doing elapsed time calculations as it doesn't use the wall clock (which can lead to issues due to leap seconds, etc). Modified the metric to use nanoTime() instead. To be clear, the actual precision of this  depends on what is provided by the OS, but for our purposes we don't need exact precision, we just need meaningful graphs.\nI have decided to keep readTime in processRecords() as is. The reason for this is twofold. First, we do calculation in a couple of locations using this, and some of these involve API changes to translate(). Secondly, nanoTime() by itself is not useful, it is only useful when subtracting from another nanoTime() measurement. Thus the following code snippet cannot be used:\n    long eventsSourceTimestamp =\n        fromKafka.timestampType() == TimestampType.LOG_APPEND_TIME ? fromKafka.timestamp() : readTime.toEpochMilli();\n\nSince we do not have control over how translate() uses readTime, it is not a good idea to modify it to only take the readNanoTime.\nImportant: DO NOT REPORT SECURITY ISSUES DIRECTLY ON GITHUB.\nFor reporting security issues and contributing security fixes,\nplease, email security@linkedin.com instead, as described in\nthe contribution guidelines.\nPlease, take a minute to review the contribution guidelines at:\nhttps://github.com/linkedin/Brooklin/blob/master/CONTRIBUTING.md", "createdAt": "2020-10-16T15:54:36Z", "url": "https://github.com/linkedin/brooklin/pull/767", "merged": true, "mergeCommit": {"oid": "9c73f1440717b77b8ec5dee419dcb76595852f8a"}, "closed": true, "closedAt": "2020-10-16T17:19:06Z", "author": {"login": "somandal"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdTH8jGAH2gAyNTA0OTQzNDg2OmVkYzZkMmJkY2M2ODMyMTg1OWU0Nzg2ZmRiNGFmNDZlOGJiNWVlMmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdTJU1fAFqTUxMDY0MjcxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "edc6d2bdcc68321859e4786fdb4af46e8bb5ee2a", "author": {"user": {"login": "somandal", "name": "Sonam Mandal"}}, "url": "https://github.com/linkedin/brooklin/commit/edc6d2bdcc68321859e4786fdb4af46e8bb5ee2a", "committedDate": "2020-10-16T15:17:16Z", "message": "Fix the BMM event processing time metric to be in microseconds instead of milliseconds"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b11da763d560bd9b17e17c7f79ebfa52a1e20c2d", "author": {"user": {"login": "somandal", "name": "Sonam Mandal"}}, "url": "https://github.com/linkedin/brooklin/commit/b11da763d560bd9b17e17c7f79ebfa52a1e20c2d", "committedDate": "2020-10-16T15:46:55Z", "message": "Change processing time metric to nanos and use System.nanoTime to calculate it"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNjE4NjAw", "url": "https://github.com/linkedin/brooklin/pull/767#pullrequestreview-510618600", "createdAt": "2020-10-16T16:19:39Z", "commit": {"oid": "b11da763d560bd9b17e17c7f79ebfa52a1e20c2d"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNjM2MzIz", "url": "https://github.com/linkedin/brooklin/pull/767#pullrequestreview-510636323", "createdAt": "2020-10-16T16:44:21Z", "commit": {"oid": "b11da763d560bd9b17e17c7f79ebfa52a1e20c2d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxNjo0NDoyMVrOHjIKgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxNjo0NDoyMVrOHjIKgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjU5NTk2OQ==", "bodyText": "Nitpick. Can't we just pass System.nanoTime() to processRecords directly here cause I dont see we logging this variable in any other way.", "url": "https://github.com/linkedin/brooklin/pull/767#discussion_r506595969", "createdAt": "2020-10-16T16:44:21Z", "author": {"login": "vishwajith-s"}, "path": "datastream-kafka-connector/src/main/java/com/linkedin/datastream/connectors/kafka/AbstractKafkaBasedConnectorTask.java", "diffHunk": "@@ -376,7 +376,8 @@ public void run() {\n           _kafkaTopicPartitionTracker.onPartitionsPolled(records);\n \n           Instant readTime = Instant.now();\n-          processRecords(records, readTime);\n+          long readTimeInNanos = System.nanoTime();\n+          processRecords(records, readTime, readTimeInNanos);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b11da763d560bd9b17e17c7f79ebfa52a1e20c2d"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNjM5OTc3", "url": "https://github.com/linkedin/brooklin/pull/767#pullrequestreview-510639977", "createdAt": "2020-10-16T16:49:39Z", "commit": {"oid": "b11da763d560bd9b17e17c7f79ebfa52a1e20c2d"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af4737efaff2e4fbe5642e9c19ec7f8171f6f9a5", "author": {"user": {"login": "somandal", "name": "Sonam Mandal"}}, "url": "https://github.com/linkedin/brooklin/commit/af4737efaff2e4fbe5642e9c19ec7f8171f6f9a5", "committedDate": "2020-10-16T16:51:07Z", "message": "Address review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNjQyMjcx", "url": "https://github.com/linkedin/brooklin/pull/767#pullrequestreview-510642271", "createdAt": "2020-10-16T16:53:02Z", "commit": {"oid": "af4737efaff2e4fbe5642e9c19ec7f8171f6f9a5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNjQyNzEx", "url": "https://github.com/linkedin/brooklin/pull/767#pullrequestreview-510642711", "createdAt": "2020-10-16T16:53:42Z", "commit": {"oid": "af4737efaff2e4fbe5642e9c19ec7f8171f6f9a5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 309, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}