{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIyOTU5OTQ0", "number": 782, "title": "Fix StickyMulticastStrategy to not assign more tasks than expected.", "bodyText": "StickyMulticastStrategy copies the tasks from the existing active instances and does not check if the assignment is more than the expected. This results in more tasks assigned for the datastream than expected. This results in validation failure and Coordinator keeps on retrying LeaderDoAssignment.\nFixing the problem by only reusing the number of tasks that are expected.", "createdAt": "2020-11-18T06:51:04Z", "url": "https://github.com/linkedin/brooklin/pull/782", "merged": true, "mergeCommit": {"oid": "fd67d225206c5c1071b6fb755940061c928726aa"}, "closed": true, "closedAt": "2020-11-20T18:32:43Z", "author": {"login": "vmaheshw"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABboAf5CAH2gAyNTIyOTU5OTQ0OmMzMWNkNGExNWNjOGRkNjliMGE2NTNkYmU0MjAxZGU5MzRlYTZkNjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdebtaQAFqTUzNTY4MTYzNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c31cd4a15cc8dd69b0a653dbe4201de934ea6d65", "author": {"user": {"login": "vmaheshw", "name": "Vaibhav Maheshwari"}}, "url": "https://github.com/linkedin/brooklin/commit/c31cd4a15cc8dd69b0a653dbe4201de934ea6d65", "committedDate": "2019-11-18T20:06:44Z", "message": "Merge pull request #1 from linkedin/master\n\nPull latest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79ffa91188aa16ebcb2e9c1e55d4b9a8911b9c36", "author": {"user": null}, "url": "https://github.com/linkedin/brooklin/commit/79ffa91188aa16ebcb2e9c1e55d4b9a8911b9c36", "committedDate": "2020-11-02T20:44:50Z", "message": "Merge branch 'master' of github.com:linkedin/brooklin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51f9a5be5c12ac0f3a443c9ea7d4680eb1b90255", "author": {"user": null}, "url": "https://github.com/linkedin/brooklin/commit/51f9a5be5c12ac0f3a443c9ea7d4680eb1b90255", "committedDate": "2020-11-18T06:47:50Z", "message": "Fix StickyMulticastStrategy assign() which assigns more task than expected, resulting in validation failure"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzOTY2MTQ5", "url": "https://github.com/linkedin/brooklin/pull/782#pullrequestreview-533966149", "createdAt": "2020-11-18T23:32:49Z", "commit": {"oid": "51f9a5be5c12ac0f3a443c9ea7d4680eb1b90255"}, "state": "DISMISSED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMzozMjo0OVrOH2GihQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMzozNjoxM1rOH2Gnpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ5MjI5Mw==", "bodyText": "Nit: this check is not really necessary here. limit() will work on foundDatastreamTasks with size <= numTasks", "url": "https://github.com/linkedin/brooklin/pull/782#discussion_r526492293", "createdAt": "2020-11-18T23:32:49Z", "author": {"login": "jzakaryan"}, "path": "datastream-server/src/main/java/com/linkedin/datastream/server/assignment/StickyMulticastStrategy.java", "diffHunk": "@@ -128,6 +128,9 @@ public StickyMulticastStrategy(Optional<Integer> maxTasks, Optional<Integer> imb\n         allAliveTasks.addAll(foundDatastreamTasks);\n \n         if (!foundDatastreamTasks.isEmpty()) {\n+          if (foundDatastreamTasks.size() > numTasks) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51f9a5be5c12ac0f3a443c9ea7d4680eb1b90255"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ5MzYwNw==", "bodyText": "Nit: spacing missing from line.", "url": "https://github.com/linkedin/brooklin/pull/782#discussion_r526493607", "createdAt": "2020-11-18T23:36:13Z", "author": {"login": "jzakaryan"}, "path": "datastream-server/src/test/java/com/linkedin/datastream/server/assignment/TestStickyMulticastStrategy.java", "diffHunk": "@@ -475,6 +475,31 @@ public void testTriggerRebalanceWhenDeletingDatastream() {\n         newAssignment.get(instancesBySize.get(instances.size() - 1)).size());\n   }\n \n+  @Test\n+  public void testExtraTasksAreNotAssignedDuringReassignment() {\n+    String[] instances = new String[]{\"instance1\"};", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51f9a5be5c12ac0f3a443c9ea7d4680eb1b90255"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb638e237ba289ee15c6c21d2eda7712871cd000", "author": {"user": null}, "url": "https://github.com/linkedin/brooklin/commit/bb638e237ba289ee15c6c21d2eda7712871cd000", "committedDate": "2020-11-19T06:45:01Z", "message": "Add log"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0NjM4MzI3", "url": "https://github.com/linkedin/brooklin/pull/782#pullrequestreview-534638327", "createdAt": "2020-11-19T16:41:17Z", "commit": {"oid": "bb638e237ba289ee15c6c21d2eda7712871cd000"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89678b72d307e30caad83d789f16f377f85207a2", "author": {"user": null}, "url": "https://github.com/linkedin/brooklin/commit/89678b72d307e30caad83d789f16f377f85207a2", "committedDate": "2020-11-19T19:47:14Z", "message": "Merge branch 'master' of github.com:linkedin/brooklin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cac6d2694dc1cc924caac5eb02aa26fea6ec2a6", "author": {"user": null}, "url": "https://github.com/linkedin/brooklin/commit/0cac6d2694dc1cc924caac5eb02aa26fea6ec2a6", "committedDate": "2020-11-19T19:50:18Z", "message": "Merge branch 'master' into fixStickyMulticastStrategy"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NjgxNjM3", "url": "https://github.com/linkedin/brooklin/pull/782#pullrequestreview-535681637", "createdAt": "2020-11-20T18:32:00Z", "commit": {"oid": "0cac6d2694dc1cc924caac5eb02aa26fea6ec2a6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 344, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}