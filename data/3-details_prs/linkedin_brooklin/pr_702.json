{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzMzc4ODkw", "number": 702, "title": "Log information about topic partitions seeing events outside alternative SLA in the EventProducer", "bodyText": "Log information about topic partitions seeing events outside alternative SLA in the EventProducer\nThis feature to enable logging such events will be enabled by a config.", "createdAt": "2020-04-14T19:45:17Z", "url": "https://github.com/linkedin/brooklin/pull/702", "merged": true, "mergeCommit": {"oid": "a996fd23194ae8d9411d7b7aa7a8d73af24ec6ea"}, "closed": true, "closedAt": "2020-04-25T02:31:03Z", "author": {"login": "somandal"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXooq9AH2gAyNDAzMzc4ODkwOmZmOGRhYmRkZmI0MGFhY2FhMmQxM2RmZDJlNzRlNGQ5NGM1NzBiZDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABca8rhIgFqTQwMDM0Nzg2OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ff8dabddfb40aacaa2d13dfd2e74e4d94c570bd3", "author": {"user": {"login": "somandal", "name": "Sonam Mandal"}}, "url": "https://github.com/linkedin/brooklin/commit/ff8dabddfb40aacaa2d13dfd2e74e4d94c570bd3", "committedDate": "2020-04-14T19:26:58Z", "message": "Add the ability to log information about topic partitions seeing events outside alternative SLA in the EventProducer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMzE0OTkw", "url": "https://github.com/linkedin/brooklin/pull/702#pullrequestreview-393314990", "createdAt": "2020-04-14T21:38:36Z", "commit": {"oid": "ff8dabddfb40aacaa2d13dfd2e74e4d94c570bd3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMTozODozN1rOGFh64g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMTozODozN1rOGFh64g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ1MTgxMA==", "bodyText": "nit: alternative --> alternate everywhere.", "url": "https://github.com/linkedin/brooklin/pull/702#discussion_r408451810", "createdAt": "2020-04-14T21:38:37Z", "author": {"login": "DEEPTHIKORAT"}, "path": "datastream-server/src/main/java/com/linkedin/datastream/server/EventProducer.java", "diffHunk": "@@ -90,11 +96,17 @@\n   private final boolean _warnLogLatencyEnabled;\n   // Latency threshold at which to log a warning message\n   private final long _warnLogLatencyThresholdMs;\n+  // Whether to enable logging the list of TopicPartitions with events outside alternative SLA", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff8dabddfb40aacaa2d13dfd2e74e4d94c570bd3"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMzE2NjI1", "url": "https://github.com/linkedin/brooklin/pull/702#pullrequestreview-393316625", "createdAt": "2020-04-14T21:41:39Z", "commit": {"oid": "ff8dabddfb40aacaa2d13dfd2e74e4d94c570bd3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMTo0MTo0MFrOGFiAdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMTo0MTo0MFrOGFiAdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ1MzIzNw==", "bodyText": "is the move inside of _logger.isDebugEnabled() intentional?", "url": "https://github.com/linkedin/brooklin/pull/702#discussion_r408453237", "createdAt": "2020-04-14T21:41:40Z", "author": {"login": "DEEPTHIKORAT"}, "path": "datastream-server/src/main/java/com/linkedin/datastream/server/EventProducer.java", "diffHunk": "@@ -286,6 +325,10 @@ private void reportMetrics(DatastreamRecordMetadata metadata, long eventsSourceT\n       _dynamicMetricsManager.createOrUpdateCounter(MODULE, AGGREGATE, TOTAL_EVENTS_PRODUCED, 1);\n       _dynamicMetricsManager.createOrUpdateCounter(MODULE, _datastreamTask.getConnectorType(), TOTAL_EVENTS_PRODUCED,\n           1);\n+\n+      // Log information about events if either warn logging is enabled or logging for topic partitions outside\n+      // alternative SLA is enabled\n+      performSlaRelatedLogging(metadata, eventsSourceTimestamp, sourceToDestinationLatencyMs);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff8dabddfb40aacaa2d13dfd2e74e4d94c570bd3"}, "originalPosition": 112}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMzIxMDc0", "url": "https://github.com/linkedin/brooklin/pull/702#pullrequestreview-393321074", "createdAt": "2020-04-14T21:49:57Z", "commit": {"oid": "ff8dabddfb40aacaa2d13dfd2e74e4d94c570bd3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMTo0OTo1OFrOGFiPuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMTo0OTo1OFrOGFiPuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ1NzE0NQ==", "bodyText": "Why do we need this special class when kafka has TopicPartition class?", "url": "https://github.com/linkedin/brooklin/pull/702#discussion_r408457145", "createdAt": "2020-04-14T21:49:58Z", "author": {"login": "DEEPTHIKORAT"}, "path": "datastream-server/src/main/java/com/linkedin/datastream/server/EventProducer.java", "diffHunk": "@@ -413,4 +456,39 @@ private String getDatastreamName() {\n \n     return Collections.unmodifiableList(metrics);\n   }\n+\n+  /**\n+   * This class encapsulates the topic and partition information for a given event\n+   */\n+  static class TopicPartitionInfo {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff8dabddfb40aacaa2d13dfd2e74e4d94c570bd3"}, "originalPosition": 124}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "984bb03c0d4d646921fb9c5dcc27c48cd751746a", "author": {"user": {"login": "somandal", "name": "Sonam Mandal"}}, "url": "https://github.com/linkedin/brooklin/commit/984bb03c0d4d646921fb9c5dcc27c48cd751746a", "committedDate": "2020-04-14T22:26:15Z", "message": "Address review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMjYwNzg3", "url": "https://github.com/linkedin/brooklin/pull/702#pullrequestreview-400260787", "createdAt": "2020-04-24T20:48:07Z", "commit": {"oid": "984bb03c0d4d646921fb9c5dcc27c48cd751746a"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMzExOTk3", "url": "https://github.com/linkedin/brooklin/pull/702#pullrequestreview-400311997", "createdAt": "2020-04-24T22:48:32Z", "commit": {"oid": "984bb03c0d4d646921fb9c5dcc27c48cd751746a"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMjo0ODozMlrOGLrw4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMjo0ODozMlrOGLrw4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDkwNDU0NQ==", "bodyText": ".toString() is extraneous", "url": "https://github.com/linkedin/brooklin/pull/702#discussion_r414904545", "createdAt": "2020-04-24T22:48:32Z", "author": {"login": "ahmedahamid"}, "path": "datastream-server/src/main/java/com/linkedin/datastream/server/EventProducer.java", "diffHunk": "@@ -235,6 +253,31 @@ private void reportSLAMetrics(String topicOrDatastreamName, boolean isWithinSLA,\n         outsideSLAValue);\n   }\n \n+  private void performSlaRelatedLogging(DatastreamRecordMetadata metadata, long eventsSourceTimestamp,\n+      long sourceToDestinationLatencyMs) {\n+    if (_warnLogLatencyEnabled && (sourceToDestinationLatencyMs > _warnLogLatencyThresholdMs)) {\n+      _logger.warn(\"Source to destination latency {} ms is higher than {} ms, Source Timestamp: {}, Metadata: {}\",\n+          sourceToDestinationLatencyMs, _warnLogLatencyThresholdMs, eventsSourceTimestamp, metadata.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "984bb03c0d4d646921fb9c5dcc27c48cd751746a"}, "originalPosition": 74}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "918096003f6f750ccb7b7da7de316a6a67f04f2a", "author": {"user": {"login": "somandal", "name": "Sonam Mandal"}}, "url": "https://github.com/linkedin/brooklin/commit/918096003f6f750ccb7b7da7de316a6a67f04f2a", "committedDate": "2020-04-25T01:51:57Z", "message": "Address review comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMzQ1MjA3", "url": "https://github.com/linkedin/brooklin/pull/702#pullrequestreview-400345207", "createdAt": "2020-04-25T01:56:38Z", "commit": {"oid": "918096003f6f750ccb7b7da7de316a6a67f04f2a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMzQ3ODY4", "url": "https://github.com/linkedin/brooklin/pull/702#pullrequestreview-400347868", "createdAt": "2020-04-25T02:29:58Z", "commit": {"oid": "918096003f6f750ccb7b7da7de316a6a67f04f2a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 418, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}