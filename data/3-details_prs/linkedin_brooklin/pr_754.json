{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxNDI5OTYy", "number": 754, "title": "Add a PollDurationMs metric to AbstractKafkaBasedConnectorTask", "bodyText": "Adding a PollDurationMs metric to track how long KafkaConsumer poll() blocks for Kafka based connectors. This can be disabled via a config.\nImportant: DO NOT REPORT SECURITY ISSUES DIRECTLY ON GITHUB.\nFor reporting security issues and contributing security fixes,\nplease, email security@linkedin.com instead, as described in\nthe contribution guidelines.\nPlease, take a minute to review the contribution guidelines at:\nhttps://github.com/linkedin/Brooklin/blob/master/CONTRIBUTING.md", "createdAt": "2020-09-23T02:56:35Z", "url": "https://github.com/linkedin/brooklin/pull/754", "merged": true, "mergeCommit": {"oid": "c95206c0ac11cbb18278ef7533f036fc53071449"}, "closed": true, "closedAt": "2020-09-25T00:52:49Z", "author": {"login": "somandal"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLjgTnAH2gAyNDkxNDI5OTYyOjc4MzkzMzk4ZWMyNDA2NDZkYWJjZDNmMzIyN2M3M2RhYWNkZjVjNTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdMK87yAFqTQ5NjA0MTkyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "78393398ec240646dabcd3f3227c73daacdf5c57", "author": {"user": {"login": "somandal", "name": "Sonam Mandal"}}, "url": "https://github.com/linkedin/brooklin/commit/78393398ec240646dabcd3f3227c73daacdf5c57", "committedDate": "2020-09-23T02:52:22Z", "message": "Add a PollDurationMs metric to AbstractKafkaBasedConnectorTask"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0ODczNTc2", "url": "https://github.com/linkedin/brooklin/pull/754#pullrequestreview-494873576", "createdAt": "2020-09-23T17:09:48Z", "commit": {"oid": "78393398ec240646dabcd3f3227c73daacdf5c57"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1MjE3NTAz", "url": "https://github.com/linkedin/brooklin/pull/754#pullrequestreview-495217503", "createdAt": "2020-09-24T04:51:06Z", "commit": {"oid": "78393398ec240646dabcd3f3227c73daacdf5c57"}, "state": "DISMISSED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwNDo1MTowNlrOHXJoiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwNDo1MjoyOFrOHXJp_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDAzNzEyOA==", "bodyText": "Do you think refactoring createKafkaBasedConnectorTaskMetrics with additional boolean which decides the creation of histogram for poll duration will make more sense? Then in the future, if we decide to enable it for other tasks, we can just set the boolean to true?", "url": "https://github.com/linkedin/brooklin/pull/754#discussion_r494037128", "createdAt": "2020-09-24T04:51:06Z", "author": {"login": "vmaheshw"}, "path": "datastream-kafka-connector/src/main/java/com/linkedin/datastream/connectors/kafka/AbstractKafkaBasedConnectorTask.java", "diffHunk": "@@ -478,6 +489,10 @@ protected void trackEventsProcessedProgress(int recordCount) {\n       }\n       _consumerMetrics.updateNumPolls(1);\n       _consumerMetrics.updateEventCountsPerPoll(records.count());\n+      if (_enablePollDurationMsMetric) {\n+        _dynamicMetricsManager.createOrUpdateHistogram(_metricsPrefix, _datastreamName, POLL_DURATION_MS,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78393398ec240646dabcd3f3227c73daacdf5c57"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDAzNzUwMA==", "bodyText": "nit: Looking at the naming convention used in this file, MS is named as MILLIS", "url": "https://github.com/linkedin/brooklin/pull/754#discussion_r494037500", "createdAt": "2020-09-24T04:52:28Z", "author": {"login": "vmaheshw"}, "path": "datastream-kafka-connector/src/main/java/com/linkedin/datastream/connectors/kafka/KafkaBasedConnectorConfig.java", "diffHunk": "@@ -31,6 +31,7 @@\n   public static final String CONFIG_RETRY_SLEEP_DURATION_MILLIS = \"retrySleepDurationMs\";\n   public static final String CONFIG_PAUSE_PARTITION_ON_ERROR = \"pausePartitionOnError\";\n   public static final String CONFIG_PAUSE_ERROR_PARTITION_DURATION_MILLIS = \"pauseErrorPartitionDurationMs\";\n+  public static final String CONFIG_ENABLE_POLL_DURATION_MS_METRIC = \"enablePollDurationMsMetric\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78393398ec240646dabcd3f3227c73daacdf5c57"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "061024535c9fe00f0f4f97cc03c400df0e12f323", "author": {"user": {"login": "somandal", "name": "Sonam Mandal"}}, "url": "https://github.com/linkedin/brooklin/commit/061024535c9fe00f0f4f97cc03c400df0e12f323", "committedDate": "2020-09-24T14:48:13Z", "message": "Address review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1be1e64ddd09541be18ba9266757ac244e9aa81d", "author": {"user": {"login": "somandal", "name": "Sonam Mandal"}}, "url": "https://github.com/linkedin/brooklin/commit/1be1e64ddd09541be18ba9266757ac244e9aa81d", "committedDate": "2020-09-24T21:21:49Z", "message": "Move poll duration metric to KafkaBasedConnectorTaskMetrics"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1OTg3OTQy", "url": "https://github.com/linkedin/brooklin/pull/754#pullrequestreview-495987942", "createdAt": "2020-09-24T22:16:11Z", "commit": {"oid": "1be1e64ddd09541be18ba9266757ac244e9aa81d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQyMjoxNjoxMVrOHXuexQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQyMjoxNjoxMVrOHXuexQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDY0MDgzNw==", "bodyText": "nit:Can you use _pollDurationMs directly and make _enablePollDurationMillisMetric local?", "url": "https://github.com/linkedin/brooklin/pull/754#discussion_r494640837", "createdAt": "2020-09-24T22:16:11Z", "author": {"login": "vmaheshw"}, "path": "datastream-kafka-connector/src/main/java/com/linkedin/datastream/connectors/kafka/KafkaBasedConnectorTaskMetrics.java", "diffHunk": "@@ -99,6 +111,10 @@ public void deregisterMetrics() {\n     DYNAMIC_METRICS_MANAGER.unregisterMetric(_className, _key, NUM_AUTO_PAUSED_PARTITIONS_ON_INFLIGHT_MESSAGES);\n     DYNAMIC_METRICS_MANAGER.unregisterMetric(_className, _key, NUM_AUTO_PAUSED_PARTITIONS_WAITING_FOR_DEST_TOPIC);\n     DYNAMIC_METRICS_MANAGER.unregisterMetric(_className, _key, NUM_TOPICS);\n+\n+    if (_enablePollDurationMillisMetric) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1be1e64ddd09541be18ba9266757ac244e9aa81d"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1OTg4MzU0", "url": "https://github.com/linkedin/brooklin/pull/754#pullrequestreview-495988354", "createdAt": "2020-09-24T22:17:11Z", "commit": {"oid": "1be1e64ddd09541be18ba9266757ac244e9aa81d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQyMjoxNzoxMVrOHXugOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQyMjoxNzoxMVrOHXugOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDY0MTIxMA==", "bodyText": "nit: please change the name from _pollDurationMs to _pollDurationMsMetric. the name is confusing.", "url": "https://github.com/linkedin/brooklin/pull/754#discussion_r494641210", "createdAt": "2020-09-24T22:17:11Z", "author": {"login": "vmaheshw"}, "path": "datastream-kafka-connector/src/main/java/com/linkedin/datastream/connectors/kafka/KafkaBasedConnectorTaskMetrics.java", "diffHunk": "@@ -52,7 +56,11 @@\n   private final AtomicLong _numAutoPausedPartitionsAwaitingDestTopic = new AtomicLong(0);\n   private final AtomicLong _numTopics = new AtomicLong(0);\n \n-  KafkaBasedConnectorTaskMetrics(String className, String metricsKey, Logger errorLogger) {\n+  private final boolean _enablePollDurationMillisMetric;\n+  private final Histogram _pollDurationMs;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1be1e64ddd09541be18ba9266757ac244e9aa81d"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1OTg4NTQ5", "url": "https://github.com/linkedin/brooklin/pull/754#pullrequestreview-495988549", "createdAt": "2020-09-24T22:17:40Z", "commit": {"oid": "1be1e64ddd09541be18ba9266757ac244e9aa81d"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e2554e660133f5ec9b5aad06244538d2cc14ccd", "author": {"user": {"login": "somandal", "name": "Sonam Mandal"}}, "url": "https://github.com/linkedin/brooklin/commit/2e2554e660133f5ec9b5aad06244538d2cc14ccd", "committedDate": "2020-09-24T22:19:42Z", "message": "Address review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1OTkyMDEz", "url": "https://github.com/linkedin/brooklin/pull/754#pullrequestreview-495992013", "createdAt": "2020-09-24T22:25:31Z", "commit": {"oid": "2e2554e660133f5ec9b5aad06244538d2cc14ccd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2MDQxOTIz", "url": "https://github.com/linkedin/brooklin/pull/754#pullrequestreview-496041923", "createdAt": "2020-09-25T00:49:56Z", "commit": {"oid": "2e2554e660133f5ec9b5aad06244538d2cc14ccd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 293, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}