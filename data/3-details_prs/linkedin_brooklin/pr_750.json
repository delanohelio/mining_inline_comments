{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg0MzA5OTEw", "number": 750, "title": "Fix waitForTaskRelease and orphan lock cleanup", "bodyText": "Fixing two issues in this PR.\n\n\nDuring waitForTaskRelease, the recently changed code added hierarchy in the lock path, but the changes in the child node was no fixed to lockPrefix from lockroot. This results in the waitForTaskRelease for the timeout - debounce timer even if the lock was already released by other owner.\n\n\nDuring orphan lock cleanup, we should ignore the connectors that do not have locks.", "createdAt": "2020-09-10T20:42:58Z", "url": "https://github.com/linkedin/brooklin/pull/750", "merged": true, "mergeCommit": {"oid": "93959243ad25ab487d8b2429e66a747dc3e3acac"}, "closed": true, "closedAt": "2020-09-11T00:44:02Z", "author": {"login": "vmaheshw"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABboAf5CAH2gAyNDg0MzA5OTEwOmMzMWNkNGExNWNjOGRkNjliMGE2NTNkYmU0MjAxZGU5MzRlYTZkNjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHqWagAFqTQ4NjM5ODU5Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c31cd4a15cc8dd69b0a653dbe4201de934ea6d65", "author": {"user": {"login": "vmaheshw", "name": "Vaibhav Maheshwari"}}, "url": "https://github.com/linkedin/brooklin/commit/c31cd4a15cc8dd69b0a653dbe4201de934ea6d65", "committedDate": "2019-11-18T20:06:44Z", "message": "Merge pull request #1 from linkedin/master\n\nPull latest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3004d104a697e619b0715de5c135e7544fb4d25", "author": {"user": null}, "url": "https://github.com/linkedin/brooklin/commit/f3004d104a697e619b0715de5c135e7544fb4d25", "committedDate": "2020-08-13T19:09:21Z", "message": "Merge branch 'master' of github.com:vmaheshw/Brooklin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cd579e1cf9f4c5fc4c02951f21b29c75899e67d", "author": {"user": null}, "url": "https://github.com/linkedin/brooklin/commit/0cd579e1cf9f4c5fc4c02951f21b29c75899e67d", "committedDate": "2020-09-09T19:59:54Z", "message": "Merge branch 'master' of github.com:linkedin/brooklin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7fca040ee570f3373f2538daae3bd167472c3bc8", "author": {"user": null}, "url": "https://github.com/linkedin/brooklin/commit/7fca040ee570f3373f2538daae3bd167472c3bc8", "committedDate": "2020-09-10T20:39:43Z", "message": "Fix waitforlockrelease and orphanlockcleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MzA4NDE3", "url": "https://github.com/linkedin/brooklin/pull/750#pullrequestreview-486308417", "createdAt": "2020-09-10T21:03:07Z", "commit": {"oid": "7fca040ee570f3373f2538daae3bd167472c3bc8"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQyMTowMzowN1rOHQFpyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQyMTowMzowN1rOHQFpyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjYzMTg4MA==", "bodyText": "\ud83e\udd26\u200d\u2640\ufe0f sorry for missing this in the review.", "url": "https://github.com/linkedin/brooklin/pull/750#discussion_r486631880", "createdAt": "2020-09-10T21:03:07Z", "author": {"login": "somandal"}, "path": "datastream-server/src/main/java/com/linkedin/datastream/server/zk/ZkAdapter.java", "diffHunk": "@@ -1196,7 +1200,7 @@ private void waitForTaskRelease(DatastreamTask task, long timeoutMs, String lock\n     CountDownLatch busyLatch = new CountDownLatch(1);\n \n     String lockNode = lockPath.substring(lockPath.lastIndexOf('/') + 1);\n-    String lockRootPath = KeyBuilder.datastreamTaskLockRoot(_cluster, task.getConnectorType());\n+    String lockPrefixPath = KeyBuilder.datastreamTaskLockPrefix(_cluster, task.getConnectorType(), task.getTaskPrefix());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7fca040ee570f3373f2538daae3bd167472c3bc8"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2Mzk4NTky", "url": "https://github.com/linkedin/brooklin/pull/750#pullrequestreview-486398592", "createdAt": "2020-09-11T00:35:12Z", "commit": {"oid": "7fca040ee570f3373f2538daae3bd167472c3bc8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 286, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}