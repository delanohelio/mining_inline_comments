{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5OTY1OTY0", "number": 698, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxNjozMTo0NlrODvpOZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQyMTozNjoyN1rODw3gAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxMjg1MDk0OnYy", "diffSide": "RIGHT", "path": "datastream-server/src/main/java/com/linkedin/datastream/server/assignment/StickyPartitionAssignmentStrategy.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxNjozMTo0NlrOGCMGdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxNjozMTo0NlrOGCMGdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk0ODU5OA==", "bodyText": "can we use lang3?", "url": "https://github.com/linkedin/brooklin/pull/698#discussion_r404948598", "createdAt": "2020-04-07T16:31:46Z", "author": {"login": "somandal"}, "path": "datastream-server/src/main/java/com/linkedin/datastream/server/assignment/StickyPartitionAssignmentStrategy.java", "diffHunk": "@@ -16,6 +16,7 @@\n import java.util.concurrent.atomic.AtomicInteger;\n import java.util.stream.Collectors;\n \n+import org.apache.commons.lang.Validate;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ec357e954d1e0bb436583ebb9ef6efa66cacef7"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxMjg1NTczOnYy", "diffSide": "RIGHT", "path": "datastream-server/src/main/java/com/linkedin/datastream/server/assignment/StickyPartitionAssignmentStrategy.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxNjozMjo1N1rOGCMJiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMDo0MjowOFrOGDALZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk0OTM4NQ==", "bodyText": "just curious, do we know why currentAssignment size was 0? I know saw this happen once on ZK session expiry and looked like the ZKClient was null (had the fix Justin made)", "url": "https://github.com/linkedin/brooklin/pull/698#discussion_r404949385", "createdAt": "2020-04-07T16:32:57Z", "author": {"login": "somandal"}, "path": "datastream-server/src/main/java/com/linkedin/datastream/server/assignment/StickyPartitionAssignmentStrategy.java", "diffHunk": "@@ -67,6 +68,8 @@ public StickyPartitionAssignmentStrategy(Optional<Integer> maxTasks, Optional<In\n \n     LOG.info(\"old partition assignment info, assignment: {}\", currentAssignment);\n \n+    Validate.isTrue(currentAssignment.size() > 0, \"Zero tasks assigned. Retry leader assignment.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ec357e954d1e0bb436583ebb9ef6efa66cacef7"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk1MDM0Nw==", "bodyText": "Also the log message, can we change it to: \"Retry leader partition assignment\"?", "url": "https://github.com/linkedin/brooklin/pull/698#discussion_r404950347", "createdAt": "2020-04-07T16:34:19Z", "author": {"login": "somandal"}, "path": "datastream-server/src/main/java/com/linkedin/datastream/server/assignment/StickyPartitionAssignmentStrategy.java", "diffHunk": "@@ -67,6 +68,8 @@ public StickyPartitionAssignmentStrategy(Optional<Integer> maxTasks, Optional<In\n \n     LOG.info(\"old partition assignment info, assignment: {}\", currentAssignment);\n \n+    Validate.isTrue(currentAssignment.size() > 0, \"Zero tasks assigned. Retry leader assignment.\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk0OTM4NQ=="}, "originalCommit": {"oid": "0ec357e954d1e0bb436583ebb9ef6efa66cacef7"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgwMTgyOQ==", "bodyText": "Unfortunately, I don't have the logs to confirm why. I thought it is still a good fix irrespective of the cause.", "url": "https://github.com/linkedin/brooklin/pull/698#discussion_r405801829", "createdAt": "2020-04-08T20:42:08Z", "author": {"login": "vmaheshw"}, "path": "datastream-server/src/main/java/com/linkedin/datastream/server/assignment/StickyPartitionAssignmentStrategy.java", "diffHunk": "@@ -67,6 +68,8 @@ public StickyPartitionAssignmentStrategy(Optional<Integer> maxTasks, Optional<In\n \n     LOG.info(\"old partition assignment info, assignment: {}\", currentAssignment);\n \n+    Validate.isTrue(currentAssignment.size() > 0, \"Zero tasks assigned. Retry leader assignment.\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk0OTM4NQ=="}, "originalCommit": {"oid": "0ec357e954d1e0bb436583ebb9ef6efa66cacef7"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyNTY3NTU1OnYy", "diffSide": "RIGHT", "path": "datastream-server/src/main/java/com/linkedin/datastream/server/assignment/StickyPartitionAssignmentStrategy.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQyMTozNjoyN1rOGEGgHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMVQwMDoyMjo0MVrOGEIzKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk1NDAxNA==", "bodyText": "Isn't this going to raise IllegalArgumentException since for whatever reason we are seeing it be 0? Not sure I understand what the change set out to achieve. Throw a more appropriate exception?", "url": "https://github.com/linkedin/brooklin/pull/698#discussion_r406954014", "createdAt": "2020-04-10T21:36:27Z", "author": {"login": "DEEPTHIKORAT"}, "path": "datastream-server/src/main/java/com/linkedin/datastream/server/assignment/StickyPartitionAssignmentStrategy.java", "diffHunk": "@@ -67,6 +68,9 @@ public StickyPartitionAssignmentStrategy(Optional<Integer> maxTasks, Optional<In\n \n     LOG.info(\"old partition assignment info, assignment: {}\", currentAssignment);\n \n+    Validate.isTrue(currentAssignment.size() > 0,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "840fa183363a81a9b1b15c71228eb2ac3ece434f"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk5MDg5NQ==", "bodyText": "I feel IllegalArgumentException is appropriate for this api. This change is to not do the assignment if total assignments are zero and redo leader assignment.", "url": "https://github.com/linkedin/brooklin/pull/698#discussion_r406990895", "createdAt": "2020-04-11T00:17:50Z", "author": {"login": "vmaheshw"}, "path": "datastream-server/src/main/java/com/linkedin/datastream/server/assignment/StickyPartitionAssignmentStrategy.java", "diffHunk": "@@ -67,6 +68,9 @@ public StickyPartitionAssignmentStrategy(Optional<Integer> maxTasks, Optional<In\n \n     LOG.info(\"old partition assignment info, assignment: {}\", currentAssignment);\n \n+    Validate.isTrue(currentAssignment.size() > 0,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk1NDAxNA=="}, "originalCommit": {"oid": "840fa183363a81a9b1b15c71228eb2ac3ece434f"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk5MTQwMg==", "bodyText": "Just to clarify, the behavior of this this won't change right, just the type of exception thrown? Even before this change, an exception would be thrown and the assignment retried?", "url": "https://github.com/linkedin/brooklin/pull/698#discussion_r406991402", "createdAt": "2020-04-11T00:20:46Z", "author": {"login": "somandal"}, "path": "datastream-server/src/main/java/com/linkedin/datastream/server/assignment/StickyPartitionAssignmentStrategy.java", "diffHunk": "@@ -67,6 +68,9 @@ public StickyPartitionAssignmentStrategy(Optional<Integer> maxTasks, Optional<In\n \n     LOG.info(\"old partition assignment info, assignment: {}\", currentAssignment);\n \n+    Validate.isTrue(currentAssignment.size() > 0,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk1NDAxNA=="}, "originalCommit": {"oid": "840fa183363a81a9b1b15c71228eb2ac3ece434f"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk5MTY1Nw==", "bodyText": "Yes, Just Arithmetic Exception is something we want to avoid.", "url": "https://github.com/linkedin/brooklin/pull/698#discussion_r406991657", "createdAt": "2020-04-11T00:22:41Z", "author": {"login": "vmaheshw"}, "path": "datastream-server/src/main/java/com/linkedin/datastream/server/assignment/StickyPartitionAssignmentStrategy.java", "diffHunk": "@@ -67,6 +68,9 @@ public StickyPartitionAssignmentStrategy(Optional<Integer> maxTasks, Optional<In\n \n     LOG.info(\"old partition assignment info, assignment: {}\", currentAssignment);\n \n+    Validate.isTrue(currentAssignment.size() > 0,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk1NDAxNA=="}, "originalCommit": {"oid": "840fa183363a81a9b1b15c71228eb2ac3ece434f"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 975, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}