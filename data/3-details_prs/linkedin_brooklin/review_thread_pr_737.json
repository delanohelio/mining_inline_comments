{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0MjE3MjYy", "number": 737, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxOTo1MjoxMlrOEV-IdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMDozMTo1OFrOEV-4lA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNDczNTI1OnYy", "diffSide": "RIGHT", "path": "datastream-common/src/main/java/com/linkedin/datastream/common/BrooklinEnvelope.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxOTo1MjoxMlrOG9CDgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMDozMzo1M1rOG9DTNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY0OTk4NQ==", "bodyText": "I admire the generality Iterable<T> allows us but I think it may be a little inconvenient for headers, especially for a type as general as BrooklinEnvelope. For instance, to find out the header count, we'd have to enumerate the iterable. For this reason, I'd prefer Collection<T>; it would allow us to find the count and enumerate, while giving callers the freedom to pass in any collection they'd like.", "url": "https://github.com/linkedin/brooklin/pull/737#discussion_r466649985", "createdAt": "2020-08-06T19:52:12Z", "author": {"login": "ahmedahamid"}, "path": "datastream-common/src/main/java/com/linkedin/datastream/common/BrooklinEnvelope.java", "diffHunk": "@@ -29,14 +30,16 @@\n \n   private Map<String, String> _metadata;\n \n+  private Iterable<Header> _headers;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e920e7db391e6a1628924fcde9926c3a9140353d"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY3MDM4OQ==", "bodyText": "Just saw Sonam's comment, I like her suggestion more actually.", "url": "https://github.com/linkedin/brooklin/pull/737#discussion_r466670389", "createdAt": "2020-08-06T20:33:53Z", "author": {"login": "ahmedahamid"}, "path": "datastream-common/src/main/java/com/linkedin/datastream/common/BrooklinEnvelope.java", "diffHunk": "@@ -29,14 +30,16 @@\n \n   private Map<String, String> _metadata;\n \n+  private Iterable<Header> _headers;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY0OTk4NQ=="}, "originalCommit": {"oid": "e920e7db391e6a1628924fcde9926c3a9140353d"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNDc3OTIyOnYy", "diffSide": "RIGHT", "path": "datastream-common/src/main/java/com/linkedin/datastream/common/BrooklinEnvelope.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMDowNjoyOFrOG9CebA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMDowNjoyOFrOG9CebA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY1Njg3Ng==", "bodyText": "can we instead use Headers which is an Iterable of Header? This is what the ConsumerRecord's getHeaders() returns:\n    /** * The headers */ public Headers headers() { return headers; }\nAnd headers looks like this:\npublic interface Headers extends Iterable<Header>", "url": "https://github.com/linkedin/brooklin/pull/737#discussion_r466656876", "createdAt": "2020-08-06T20:06:28Z", "author": {"login": "somandal"}, "path": "datastream-common/src/main/java/com/linkedin/datastream/common/BrooklinEnvelope.java", "diffHunk": "@@ -29,14 +30,16 @@\n \n   private Map<String, String> _metadata;\n \n+  private Iterable<Header> _headers;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e920e7db391e6a1628924fcde9926c3a9140353d"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNDc4MTc3OnYy", "diffSide": "RIGHT", "path": "datastream-common/src/main/java/com/linkedin/datastream/common/BrooklinEnvelope.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMDowNzoyMFrOG9CgBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMDowNzoyMFrOG9CgBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY1NzI4NA==", "bodyText": "nit: can we keep order of function parameters the same as order of setting them? so here move this before setMetadata(metadata)?", "url": "https://github.com/linkedin/brooklin/pull/737#discussion_r466657284", "createdAt": "2020-08-06T20:07:20Z", "author": {"login": "somandal"}, "path": "datastream-common/src/main/java/com/linkedin/datastream/common/BrooklinEnvelope.java", "diffHunk": "@@ -48,11 +51,25 @@ public BrooklinEnvelope(Object key, Object value, Map<String, String> metadata)\n    */\n   public BrooklinEnvelope(@Nullable Object key, @Nullable Object value, @Nullable Object previousValue,\n       Map<String, String> metadata) {\n+    this(key, value, previousValue, null, metadata);\n+  }\n+\n+  /**\n+   * Construct a {@link BrooklinEnvelope} using record key, value, headers and metadata\n+   * @param key The record key (e.g. primary key)\n+   * @param value The new record value\n+   * @param previousValue The old record value\n+   * @param headers Kafka headers to associate with the change event\n+   * @param metadata Additional metadata to associate with the change event\n+   */\n+  public BrooklinEnvelope(@Nullable Object key, @Nullable Object value, @Nullable Object previousValue,\n+      @Nullable Iterable<Header> headers, Map<String, String> metadata) {\n     Validate.notNull(metadata, \"metadata cannot be null\");\n     setKey(key);\n     setValue(value);\n     setPreviousValue(previousValue);\n     setMetadata(metadata);\n+    setHeaders(headers);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e920e7db391e6a1628924fcde9926c3a9140353d"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNDc4MjkyOnYy", "diffSide": "RIGHT", "path": "datastream-common/src/main/java/com/linkedin/datastream/common/BrooklinEnvelope.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMDowNzo0OFrOG9CgyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMDowNzo0OFrOG9CgyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY1NzQ4MQ==", "bodyText": "if we do change this to store Headers directly, we can return Headers here too.", "url": "https://github.com/linkedin/brooklin/pull/737#discussion_r466657481", "createdAt": "2020-08-06T20:07:48Z", "author": {"login": "somandal"}, "path": "datastream-common/src/main/java/com/linkedin/datastream/common/BrooklinEnvelope.java", "diffHunk": "@@ -75,6 +92,20 @@ public void setPreviousValue(Object previousValue) {\n     _previousValue = previousValue instanceof Optional ? ((Optional<?>) previousValue).orElse(null) : previousValue;\n   }\n \n+  /**\n+   * Get the Kafka headers\n+   */\n+  public Iterable<Header> getHeaders() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e920e7db391e6a1628924fcde9926c3a9140353d"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNDc4NDcyOnYy", "diffSide": "RIGHT", "path": "datastream-common/src/main/java/com/linkedin/datastream/common/BrooklinEnvelope.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMDowODoyMlrOG9Ch3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMDowODoyMlrOG9Ch3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY1Nzc1Ng==", "bodyText": "if we do change this to store Headers directly, we can pass Headers here as the argument.", "url": "https://github.com/linkedin/brooklin/pull/737#discussion_r466657756", "createdAt": "2020-08-06T20:08:22Z", "author": {"login": "somandal"}, "path": "datastream-common/src/main/java/com/linkedin/datastream/common/BrooklinEnvelope.java", "diffHunk": "@@ -75,6 +92,20 @@ public void setPreviousValue(Object previousValue) {\n     _previousValue = previousValue instanceof Optional ? ((Optional<?>) previousValue).orElse(null) : previousValue;\n   }\n \n+  /**\n+   * Get the Kafka headers\n+   */\n+  public Iterable<Header> getHeaders() {\n+    return _headers;\n+  }\n+\n+  /**\n+   * Set the Kafka headers\n+   */\n+  public void setHeaders(Iterable<Header> headers) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e920e7db391e6a1628924fcde9926c3a9140353d"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNDg1ODQ0OnYy", "diffSide": "RIGHT", "path": "datastream-common/src/main/java/com/linkedin/datastream/common/BrooklinEnvelope.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMDozMTo1OFrOG9DPdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMDozNDoxOFrOG9DT_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY2OTQzMA==", "bodyText": "Just out of curiosity, how are we planning to fit headers within DatastreamEvent and LiDatastreamEvent?", "url": "https://github.com/linkedin/brooklin/pull/737#discussion_r466669430", "createdAt": "2020-08-06T20:31:58Z", "author": {"login": "ahmedahamid"}, "path": "datastream-common/src/main/java/com/linkedin/datastream/common/BrooklinEnvelope.java", "diffHunk": "@@ -48,11 +51,25 @@ public BrooklinEnvelope(Object key, Object value, Map<String, String> metadata)\n    */\n   public BrooklinEnvelope(@Nullable Object key, @Nullable Object value, @Nullable Object previousValue,\n       Map<String, String> metadata) {\n+    this(key, value, previousValue, null, metadata);\n+  }\n+\n+  /**\n+   * Construct a {@link BrooklinEnvelope} using record key, value, headers and metadata\n+   * @param key The record key (e.g. primary key)\n+   * @param value The new record value\n+   * @param previousValue The old record value\n+   * @param headers Kafka headers to associate with the change event\n+   * @param metadata Additional metadata to associate with the change event\n+   */\n+  public BrooklinEnvelope(@Nullable Object key, @Nullable Object value, @Nullable Object previousValue,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e920e7db391e6a1628924fcde9926c3a9140353d"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY3MDU4OA==", "bodyText": "@ahmedahamid we don't need to actually. The ProducerRecord<> takes headers as an argument, so we don't need to modify our own LiDatastreamEvent or DatastreamEvent AFAIK", "url": "https://github.com/linkedin/brooklin/pull/737#discussion_r466670588", "createdAt": "2020-08-06T20:34:18Z", "author": {"login": "somandal"}, "path": "datastream-common/src/main/java/com/linkedin/datastream/common/BrooklinEnvelope.java", "diffHunk": "@@ -48,11 +51,25 @@ public BrooklinEnvelope(Object key, Object value, Map<String, String> metadata)\n    */\n   public BrooklinEnvelope(@Nullable Object key, @Nullable Object value, @Nullable Object previousValue,\n       Map<String, String> metadata) {\n+    this(key, value, previousValue, null, metadata);\n+  }\n+\n+  /**\n+   * Construct a {@link BrooklinEnvelope} using record key, value, headers and metadata\n+   * @param key The record key (e.g. primary key)\n+   * @param value The new record value\n+   * @param previousValue The old record value\n+   * @param headers Kafka headers to associate with the change event\n+   * @param metadata Additional metadata to associate with the change event\n+   */\n+  public BrooklinEnvelope(@Nullable Object key, @Nullable Object value, @Nullable Object previousValue,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY2OTQzMA=="}, "originalCommit": {"oid": "e920e7db391e6a1628924fcde9926c3a9140353d"}, "originalPosition": 41}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1044, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}