{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4NTI1NTY1", "number": 728, "title": "Add isLeader check for Leader only events", "bodyText": "Adding check while processing events which are supposed to be processed by leader only. This is to ensure that the follower does not process the leader events in case of session expiry.", "createdAt": "2020-07-13T22:15:04Z", "url": "https://github.com/linkedin/brooklin/pull/728", "merged": true, "mergeCommit": {"oid": "e29f1ee0e3a7d225fbaf581ee711f29313d48a7f"}, "closed": true, "closedAt": "2020-07-21T17:27:54Z", "author": {"login": "vmaheshw"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABboAf5CAH2gAyNDQ4NTI1NTY1OmMzMWNkNGExNWNjOGRkNjliMGE2NTNkYmU0MjAxZGU5MzRlYTZkNjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3JFNQgFqTQ1MjY0NDk0Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c31cd4a15cc8dd69b0a653dbe4201de934ea6d65", "author": {"user": {"login": "vmaheshw", "name": "Vaibhav Maheshwari"}}, "url": "https://github.com/linkedin/brooklin/commit/c31cd4a15cc8dd69b0a653dbe4201de934ea6d65", "committedDate": "2019-11-18T20:06:44Z", "message": "Merge pull request #1 from linkedin/master\n\nPull latest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f3c87f2f3770e1488eb5c76468f50ac2b1e99f7", "author": {"user": null}, "url": "https://github.com/linkedin/brooklin/commit/0f3c87f2f3770e1488eb5c76468f50ac2b1e99f7", "committedDate": "2020-05-11T20:40:50Z", "message": "Merge branch 'master' of github.com:linkedin/brooklin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4572ee158147a9cfee8b68fdef2e4d79245ef243", "author": {"user": null}, "url": "https://github.com/linkedin/brooklin/commit/4572ee158147a9cfee8b68fdef2e4d79245ef243", "committedDate": "2020-07-02T20:20:37Z", "message": "Merge branch 'master' of github.com:linkedin/brooklin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e93964fe1e0be60e0e3194d71c06069033e4b216", "author": {"user": null}, "url": "https://github.com/linkedin/brooklin/commit/e93964fe1e0be60e0e3194d71c06069033e4b216", "committedDate": "2020-07-13T22:03:06Z", "message": "Add isLeader check for Leader only events"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NTM4NzYw", "url": "https://github.com/linkedin/brooklin/pull/728#pullrequestreview-448538760", "createdAt": "2020-07-14T23:46:05Z", "commit": {"oid": "e93964fe1e0be60e0e3194d71c06069033e4b216"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NDEzNzA2", "url": "https://github.com/linkedin/brooklin/pull/728#pullrequestreview-449413706", "createdAt": "2020-07-15T23:39:19Z", "commit": {"oid": "e93964fe1e0be60e0e3194d71c06069033e4b216"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQyMzozOToxOVrOGyU-VQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQyMzozOToxOVrOGyU-VQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQyNTYyMQ==", "bodyText": "Instead of repeating this check in multiple handle methods, I think it would be better to have just a single check in handleEvent(). This would also allow us to identify all leader-only events by looking at that one method.\nI suggest caching _adapter.isLeader() in a local instead of calling it twice to avoid situations where the value of the underlying variable might have changed between the two calls.", "url": "https://github.com/linkedin/brooklin/pull/728#discussion_r455425621", "createdAt": "2020-07-15T23:39:19Z", "author": {"login": "ahmedahamid"}, "path": "datastream-server/src/main/java/com/linkedin/datastream/server/Coordinator.java", "diffHunk": "@@ -777,6 +777,10 @@ private boolean isDeletingOrExpired(Datastream stream) {\n    * either. Also, expired streams are excluded from any future task assignments.\n    */\n   private void handleDatastreamAddOrDelete() {\n+    if (!_adapter.isLeader()) {\n+      _log.warn(\"skipping handleDatastreamAddOrDelete isLeader {}\", _adapter.isLeader());\n+      return;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e93964fe1e0be60e0e3194d71c06069033e4b216"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aada93492b910d1a22becad6008793e1c5d2457f", "author": {"user": null}, "url": "https://github.com/linkedin/brooklin/commit/aada93492b910d1a22becad6008793e1c5d2457f", "committedDate": "2020-07-16T17:24:23Z", "message": "Address Review Comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMjkxMjE5", "url": "https://github.com/linkedin/brooklin/pull/728#pullrequestreview-450291219", "createdAt": "2020-07-16T23:57:40Z", "commit": {"oid": "aada93492b910d1a22becad6008793e1c5d2457f"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMzo1Nzo0MFrOGzAu9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMzo1Nzo0MFrOGzAu9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjE0MjU4Mw==", "bodyText": "nit: I think this'd be more intuitive/straightforward if expressed as:\nif (isLeaderEvent(event) && !isLeader) {\n  _log.info(...);\n  return;\n}", "url": "https://github.com/linkedin/brooklin/pull/728#discussion_r456142583", "createdAt": "2020-07-16T23:57:40Z", "author": {"login": "ahmedahamid"}, "path": "datastream-server/src/main/java/com/linkedin/datastream/server/Coordinator.java", "diffHunk": "@@ -663,7 +663,11 @@ private void assignSerdes(DatastreamTaskImpl datastreamTask) {\n \n   protected synchronized void handleEvent(CoordinatorEvent event) {\n     _log.info(\"START: Handle event \" + event.getType() + \", Instance: \" + _adapter.getInstanceName());\n-\n+    boolean isLeader = _adapter.isLeader();\n+    if (skipLeaderEvent(event.getType(), isLeader)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aada93492b910d1a22becad6008793e1c5d2457f"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee92d426cca3112406806f4a39b4f524562abac0", "author": {"user": null}, "url": "https://github.com/linkedin/brooklin/commit/ee92d426cca3112406806f4a39b4f524562abac0", "committedDate": "2020-07-17T01:30:13Z", "message": "Address review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMzMwNzUx", "url": "https://github.com/linkedin/brooklin/pull/728#pullrequestreview-450330751", "createdAt": "2020-07-17T02:15:44Z", "commit": {"oid": "ee92d426cca3112406806f4a39b4f524562abac0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNjQ0OTQz", "url": "https://github.com/linkedin/brooklin/pull/728#pullrequestreview-452644943", "createdAt": "2020-07-21T16:46:45Z", "commit": {"oid": "ee92d426cca3112406806f4a39b4f524562abac0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 882, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}