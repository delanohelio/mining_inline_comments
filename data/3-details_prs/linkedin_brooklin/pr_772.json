{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA3ODU5OTE3", "number": 772, "title": "Add way to enable per topic latency metrics along with datastream level event producer metrics", "bodyText": "Currently there is a way to enable per topic metrics for all EventProducer metrics, but when this is enabled, per datastream metrics are no longer emitted. This PR adds a configurable knob to enable only the event latency metrics at a topic level, while also keeping all the datastream level metrics. This metric is extremely important in terms of monitoring. Having this can help quickly identify topics which are seeing higher lag, while also avoid the explosion of all topic level metrics and also allow us to monitor all metrics at the datastream level.\nImportant: DO NOT REPORT SECURITY ISSUES DIRECTLY ON GITHUB.\nFor reporting security issues and contributing security fixes,\nplease, email security@linkedin.com instead, as described in\nthe contribution guidelines.\nPlease, take a minute to review the contribution guidelines at:\nhttps://github.com/linkedin/Brooklin/blob/master/CONTRIBUTING.md", "createdAt": "2020-10-21T20:58:43Z", "url": "https://github.com/linkedin/brooklin/pull/772", "merged": true, "mergeCommit": {"oid": "4e875a9d697427dc0aff5893171af363aef702fb"}, "closed": true, "closedAt": "2020-10-22T00:32:41Z", "author": {"login": "somandal"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUzwMPgH2gAyNTA3ODU5OTE3OjRlM2YyZWIxZTFlYmM5ODFhODI2NTk0Mzc4YmVjYzVmNTJhM2UzNTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdU2zaYgFqTUxNDI4MDEyMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4e3f2eb1e1ebc981a826594378becc5f52a3e352", "author": {"user": {"login": "somandal", "name": "Sonam Mandal"}}, "url": "https://github.com/linkedin/brooklin/commit/4e3f2eb1e1ebc981a826594378becc5f52a3e352", "committedDate": "2020-10-21T20:53:31Z", "message": "Add way to enable per topic latency metrics along with datastream level event producer metrics"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0MTgyODE0", "url": "https://github.com/linkedin/brooklin/pull/772#pullrequestreview-514182814", "createdAt": "2020-10-21T21:01:55Z", "commit": {"oid": "4e3f2eb1e1ebc981a826594378becc5f52a3e352"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0MjY1MTgy", "url": "https://github.com/linkedin/brooklin/pull/772#pullrequestreview-514265182", "createdAt": "2020-10-21T23:44:46Z", "commit": {"oid": "4e3f2eb1e1ebc981a826594378becc5f52a3e352"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQyMzo0NDo0N1rOHmLkSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQyMzo0NDo0N1rOHmLkSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTc5NzQ1MA==", "bodyText": "I didn't get this check. Can you please elaborate?", "url": "https://github.com/linkedin/brooklin/pull/772#discussion_r509797450", "createdAt": "2020-10-21T23:44:47Z", "author": {"login": "vishwajith-s"}, "path": "datastream-server/src/main/java/com/linkedin/datastream/server/EventProducer.java", "diffHunk": "@@ -304,6 +310,11 @@ private void reportMetrics(DatastreamRecordMetadata metadata, long eventsSourceT\n       _dynamicMetricsManager.createOrUpdateSlidingWindowHistogram(MODULE, _datastreamTask.getConnectorType(),\n           EVENTS_LATENCY_MS_STRING, LATENCY_SLIDING_WINDOW_LENGTH_MS, sourceToDestinationLatencyMs);\n \n+      if (_enablePerTopicEventLatencyMetrics && !_enablePerTopicMetrics) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e3f2eb1e1ebc981a826594378becc5f52a3e352"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0MjY3MjA0", "url": "https://github.com/linkedin/brooklin/pull/772#pullrequestreview-514267204", "createdAt": "2020-10-21T23:50:48Z", "commit": {"oid": "4e3f2eb1e1ebc981a826594378becc5f52a3e352"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8829b2e742254247c52051c4226be7d9666a2ca5", "author": {"user": {"login": "somandal", "name": "Sonam Mandal"}}, "url": "https://github.com/linkedin/brooklin/commit/8829b2e742254247c52051c4226be7d9666a2ca5", "committedDate": "2020-10-21T23:56:13Z", "message": "Address review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0MjcwMDMx", "url": "https://github.com/linkedin/brooklin/pull/772#pullrequestreview-514270031", "createdAt": "2020-10-21T23:58:52Z", "commit": {"oid": "4e3f2eb1e1ebc981a826594378becc5f52a3e352"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQyMzo1ODo1MlrOHmL05w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQyMzo1ODo1MlrOHmL05w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgwMTcwMw==", "bodyText": "if this was written as:\n_enablePerTopicEventLatencyMetrics =         Boolean.parseBoolean(config.getProperty(CONFIG_ENABLE_PER_TOPIC_EVENT_LATENCY_METRICS,\n            String.valueOf(_enablePerTopicMetrics)));``` \nyou possibly won't need to check the 2 values below and can just check  if `_enablePerTopicEventLatencyMetrics` is true?", "url": "https://github.com/linkedin/brooklin/pull/772#discussion_r509801703", "createdAt": "2020-10-21T23:58:52Z", "author": {"login": "DEEPTHIKORAT"}, "path": "datastream-server/src/main/java/com/linkedin/datastream/server/EventProducer.java", "diffHunk": "@@ -159,6 +161,10 @@ public EventProducer(DatastreamTask task, TransportProvider transportProvider, C\n     _enablePerTopicMetrics =\n         Boolean.parseBoolean(config.getProperty(CONFIG_ENABLE_PER_TOPIC_METRICS, Boolean.TRUE.toString()));\n \n+    _enablePerTopicEventLatencyMetrics =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e3f2eb1e1ebc981a826594378becc5f52a3e352"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0Mjc5MDU3", "url": "https://github.com/linkedin/brooklin/pull/772#pullrequestreview-514279057", "createdAt": "2020-10-22T00:23:18Z", "commit": {"oid": "8829b2e742254247c52051c4226be7d9666a2ca5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0MjgwMTIy", "url": "https://github.com/linkedin/brooklin/pull/772#pullrequestreview-514280122", "createdAt": "2020-10-22T00:26:45Z", "commit": {"oid": "8829b2e742254247c52051c4226be7d9666a2ca5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 319, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}