{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyMTMzNzk0", "number": 680, "title": "Add support destination topic prefix, to allow mirroring source topics to destination topics prepended with a prefix", "bodyText": "Currently BMM expects the source and destination topics to have the same name for mirroring. This feature allows mirroring source topics to a destination topic prepended with a cluster level prefix.", "createdAt": "2020-02-06T22:01:49Z", "url": "https://github.com/linkedin/brooklin/pull/680", "merged": true, "mergeCommit": {"oid": "68f4c420afb0b395ba2b77ef7c3cad61c1e1ae31"}, "closed": true, "closedAt": "2020-02-13T22:42:51Z", "author": {"login": "somandal"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcByEqQgH2gAyMzcyMTMzNzk0OjQ5YjdmYWZhMDBiZWM1MWJiOWM0ZjMxZDNmZDkxNzY5OTAyMzk3Yzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcD-uchAFqTM1ODQyNzYyNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "49b7fafa00bec51bb9c4f31d3fd91769902397c7", "author": {"user": {"login": "somandal", "name": "Sonam Mandal"}}, "url": "https://github.com/linkedin/brooklin/commit/49b7fafa00bec51bb9c4f31d3fd91769902397c7", "committedDate": "2020-02-06T22:00:21Z", "message": "Add support destination topic prefix, to allow mirroring source topics to destination topics prepended with a prefix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0ODE0NjU4", "url": "https://github.com/linkedin/brooklin/pull/680#pullrequestreview-354814658", "createdAt": "2020-02-06T22:22:20Z", "commit": {"oid": "49b7fafa00bec51bb9c4f31d3fd91769902397c7"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0ODE5MjA2", "url": "https://github.com/linkedin/brooklin/pull/680#pullrequestreview-354819206", "createdAt": "2020-02-06T22:31:08Z", "commit": {"oid": "49b7fafa00bec51bb9c4f31d3fd91769902397c7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQyMjozMTowOVrOFmsehA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQyMjozMTowOVrOFmsehA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjExODkxNg==", "bodyText": "Shouldn't this be a stream level config?", "url": "https://github.com/linkedin/brooklin/pull/680#discussion_r376118916", "createdAt": "2020-02-06T22:31:09Z", "author": {"login": "gauravrkulkarni"}, "path": "datastream-kafka-connector/src/main/java/com/linkedin/datastream/connectors/kafka/mirrormaker/KafkaMirrorMakerConnector.java", "diffHunk": "@@ -61,15 +62,20 @@\n   // This config controls how frequent the connector fetches the partition information from Kafka in order to perform\n   // partition assignment\n   protected static final String PARTITION_FETCH_INTERVAL = \"PartitionFetchIntervalMs\";\n+  // This config, if set to a non-blank value, prepends a prefix to the destination topic name for all topics\n+  // being mirrored by this cluster. E.g. source topic: foo, destination prefix: bar, destination topic: barfoo\n+  protected static final String DESTINATION_TOPIC_PREFIX = \"destinationTopicPrefix\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49b7fafa00bec51bb9c4f31d3fd91769902397c7"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd571af0b011f382897bb3a6f8009285e033aac4", "author": {"user": {"login": "somandal", "name": "Sonam Mandal"}}, "url": "https://github.com/linkedin/brooklin/commit/dd571af0b011f382897bb3a6f8009285e033aac4", "committedDate": "2020-02-06T23:33:15Z", "message": "Add datastream metadata property to set destinationTopicPrefix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a78544e53b1649786be531cabf9bfa737237846", "author": {"user": {"login": "somandal", "name": "Sonam Mandal"}}, "url": "https://github.com/linkedin/brooklin/commit/0a78544e53b1649786be531cabf9bfa737237846", "committedDate": "2020-02-06T23:34:27Z", "message": "Fix comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3MDA5NTg2", "url": "https://github.com/linkedin/brooklin/pull/680#pullrequestreview-357009586", "createdAt": "2020-02-11T21:29:37Z", "commit": {"oid": "0a78544e53b1649786be531cabf9bfa737237846"}, "state": "DISMISSED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQyMToyOTozN1rOFoZz8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQyMTozMzoyMFrOFoZ7OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkxMDI1OQ==", "bodyText": "I guess people can forget about cluster level config and create a stream without realizing about the config? I will let you decide about cluster level config though, I am OK either ways.", "url": "https://github.com/linkedin/brooklin/pull/680#discussion_r377910259", "createdAt": "2020-02-11T21:29:37Z", "author": {"login": "gauravrkulkarni"}, "path": "datastream-kafka-connector/src/main/java/com/linkedin/datastream/connectors/kafka/mirrormaker/KafkaMirrorMakerConnector.java", "diffHunk": "@@ -61,15 +62,20 @@\n   // This config controls how frequent the connector fetches the partition information from Kafka in order to perform\n   // partition assignment\n   protected static final String PARTITION_FETCH_INTERVAL = \"PartitionFetchIntervalMs\";\n+  // This config, if set to a non-blank value, prepends a prefix to the destination topic name for all topics\n+  // being mirrored by this cluster. E.g. source topic: foo, destination prefix: bar, destination topic: barfoo\n+  protected static final String DESTINATION_TOPIC_PREFIX = \"destinationTopicPrefix\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjExODkxNg=="}, "originalCommit": {"oid": "49b7fafa00bec51bb9c4f31d3fd91769902397c7"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkxMjEyMQ==", "bodyText": "nit: might want to log the prefix anyway in case we need to debug this?", "url": "https://github.com/linkedin/brooklin/pull/680#discussion_r377912121", "createdAt": "2020-02-11T21:33:20Z", "author": {"login": "gauravrkulkarni"}, "path": "datastream-kafka-connector/src/main/java/com/linkedin/datastream/connectors/kafka/mirrormaker/KafkaMirrorMakerConnectorTask.java", "diffHunk": "@@ -139,12 +142,19 @@ public KafkaMirrorMakerConnectorTask(KafkaBasedConnectorConfig config, Datastrea\n     _isIdentityMirroringEnabled = KafkaMirrorMakerDatastreamMetadata.isIdentityPartitioningEnabled(_datastream);\n     _groupIdConstructor = groupIdConstructor;\n     _enablePartitionAssignment = config.getEnablePartitionAssignment();\n+    _destinationTopicPrefix = task.getDatastreams().get(0).getMetadata()\n+        .getOrDefault(DatastreamMetadataConstants.DESTINATION_TOPIC_PREFIX, destinationTopicPrefix);\n     _dynamicMetricsManager = DynamicMetricsManager.getInstance();\n \n     if (_enablePartitionAssignment) {\n       LOG.info(\"Enable Brooklin partition assignment\");\n     }\n \n+    if (!StringUtils.isBlank(_destinationTopicPrefix)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a78544e53b1649786be531cabf9bfa737237846"}, "originalPosition": 45}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4078eac50f473d6d42bbf4b3393807d997235fb", "author": {"user": {"login": "somandal", "name": "Sonam Mandal"}}, "url": "https://github.com/linkedin/brooklin/commit/f4078eac50f473d6d42bbf4b3393807d997235fb", "committedDate": "2020-02-12T04:38:52Z", "message": "Remove cluster level destination topic config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57abe0ac2d879d4e4f505889ecdb5a1f82775924", "author": {"user": {"login": "somandal", "name": "Sonam Mandal"}}, "url": "https://github.com/linkedin/brooklin/commit/57abe0ac2d879d4e4f505889ecdb5a1f82775924", "committedDate": "2020-02-12T04:48:12Z", "message": "Fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c33ca090ba696d18bfdff12050ee26c47a53df3", "author": {"user": {"login": "somandal", "name": "Sonam Mandal"}}, "url": "https://github.com/linkedin/brooklin/commit/2c33ca090ba696d18bfdff12050ee26c47a53df3", "committedDate": "2020-02-12T05:44:41Z", "message": "Cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3NjM5NzAw", "url": "https://github.com/linkedin/brooklin/pull/680#pullrequestreview-357639700", "createdAt": "2020-02-12T17:19:52Z", "commit": {"oid": "2c33ca090ba696d18bfdff12050ee26c47a53df3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NDI3NjI0", "url": "https://github.com/linkedin/brooklin/pull/680#pullrequestreview-358427624", "createdAt": "2020-02-13T17:52:36Z", "commit": {"oid": "2c33ca090ba696d18bfdff12050ee26c47a53df3"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QxNzo1MjozN1rOFpdqUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QxNzo1MjozN1rOFpdqUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTAyMTkwNA==", "bodyText": "Suggest to wrap in Optional so that you also don't need to add empty string \"\" to topicManager properties if doesn't exist.", "url": "https://github.com/linkedin/brooklin/pull/680#discussion_r379021904", "createdAt": "2020-02-13T17:52:37Z", "author": {"login": "celiakung"}, "path": "datastream-kafka-connector/src/main/java/com/linkedin/datastream/connectors/kafka/mirrormaker/KafkaMirrorMakerConnectorTask.java", "diffHunk": "@@ -112,6 +116,7 @@\n   private final boolean _isFlushlessModeEnabled;\n   private final boolean _isIdentityMirroringEnabled;\n   private final boolean _enablePartitionAssignment;\n+  private final String _destinationTopicPrefix;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c33ca090ba696d18bfdff12050ee26c47a53df3"}, "originalPosition": 34}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 364, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}