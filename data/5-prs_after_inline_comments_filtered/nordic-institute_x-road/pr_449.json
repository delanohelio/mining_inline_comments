{"pr_number": 449, "pr_title": "XRDDEV-1015", "pr_createdAt": "2020-04-05T11:19:14Z", "pr_url": "https://github.com/nordic-institute/X-Road/pull/449", "timeline": [{"oid": "d0181150f81ce6a11747af483ede4469e1f8fe41", "url": "https://github.com/nordic-institute/X-Road/commit/d0181150f81ce6a11747af483ede4469e1f8fe41", "message": "XRDDEV-1015 Fix API key based authentication\n\n- Update ApiKeyService to use method level authentication instead of class level authentication.\n- Do not authenticate methods used by ApiKeyAuthenticationManager.\n- Update tests.", "committedDate": "2020-04-05T09:47:46Z", "type": "commit"}, {"oid": "1647b044f55958d320be934601cf2126e5d95fd9", "url": "https://github.com/nordic-institute/X-Road/commit/1647b044f55958d320be934601cf2126e5d95fd9", "message": "XRDDEV-1015 Update javadocs", "committedDate": "2020-04-05T09:50:47Z", "type": "commit"}, {"oid": "b5d61a1dab08df4b44f3e4049673985382894a53", "url": "https://github.com/nordic-institute/X-Road/commit/b5d61a1dab08df4b44f3e4049673985382894a53", "message": "XRDDEV-1015 Update API key based authentication\n\n- Restore class level authentication to ApiKeyService.\n- Create new class ApiKeyAuthenticationHelper that does not require authentication.\n- Implement methods needed in the authentication process in the new helper class.\n- Update caching integration test.", "committedDate": "2020-04-06T07:39:13Z", "type": "commit"}, {"oid": "794d12c2ab222820ed38791a7fd34f3b2fa149a0", "url": "https://github.com/nordic-institute/X-Road/commit/794d12c2ab222820ed38791a7fd34f3b2fa149a0", "message": "XRDDEV-1015 Move API key cache from service layer to repository layer", "committedDate": "2020-04-06T08:14:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzk0MDM0Nw==", "url": "https://github.com/nordic-institute/X-Road/pull/449#discussion_r403940347", "bodyText": "Should this comment about caching be removed, since this class does not implement any caching? ApiKeyService also does not have this comment.", "author": "jansu76", "createdAt": "2020-04-06T09:10:49Z", "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/auth/ApiKeyAuthenticationHelper.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/**\n+ * The MIT License\n+ * Copyright (c) 2018 Estonian Information System Authority (RIA),\n+ * Nordic Institute for Interoperability Solutions (NIIS), Population Register Centre (VRK)\n+ * Copyright (c) 2015-2017 Estonian Information System Authority (RIA), Population Register Centre (VRK)\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.niis.xroad.restapi.auth;\n+\n+import lombok.extern.slf4j.Slf4j;\n+import org.niis.xroad.restapi.domain.PersistentApiKeyType;\n+import org.niis.xroad.restapi.repository.ApiKeyRepository;\n+import org.niis.xroad.restapi.service.ApiKeyService;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.security.crypto.password.PasswordEncoder;\n+import org.springframework.stereotype.Service;\n+import org.springframework.transaction.annotation.Transactional;\n+\n+import java.util.List;\n+\n+/**\n+ * AuthenticationHelper class.\n+ * This class does require authentication.\n+ * Uses simple caching, using ConcurrentHashMaps in memory.", "originalCommit": "794d12c2ab222820ed38791a7fd34f3b2fa149a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzk0MTkwNw==", "url": "https://github.com/nordic-institute/X-Road/pull/449#discussion_r403941907", "bodyText": "Yes, it should. It's now removed.", "author": "petkivim", "createdAt": "2020-04-06T09:13:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzk0MDM0Nw=="}], "type": "inlineReview"}, {"oid": "c686da2ba3fa809d3ca5307027fabf249b65cba2", "url": "https://github.com/nordic-institute/X-Road/commit/c686da2ba3fa809d3ca5307027fabf249b65cba2", "message": "XRDDEV-1015 Update comments", "committedDate": "2020-04-06T09:12:30Z", "type": "commit"}]}