{"pr_number": 347, "pr_title": "XRDDEV-867 fix transaction handling", "pr_createdAt": "2020-01-31T13:01:59Z", "pr_url": "https://github.com/nordic-institute/X-Road/pull/347", "timeline": [{"oid": "5d7b3a882fe98281cc6648725d11dec1c3377588", "url": "https://github.com/nordic-institute/X-Road/commit/5d7b3a882fe98281cc6648725d11dec1c3377588", "message": "XRDDEV-867 make open session in view = false, add test for it, fix CertificateProfileInstantiationException", "committedDate": "2020-01-29T13:02:23Z", "type": "commit"}, {"oid": "648ab4bbb444c4e4cb3a549173f77fa6f7290fea", "url": "https://github.com/nordic-institute/X-Road/commit/648ab4bbb444c4e4cb3a549173f77fa6f7290fea", "message": "XRDDEV-867 make transactions roll back for checked exceptions, add tests for that", "committedDate": "2020-01-29T14:15:32Z", "type": "commit"}, {"oid": "77b9c5f18dcc2bedf49a56fb830c110550838f11", "url": "https://github.com/nordic-institute/X-Road/commit/77b9c5f18dcc2bedf49a56fb830c110550838f11", "message": "Merge branch 'develop' into XRDDEV-867-fix-transaction-handling", "committedDate": "2020-01-29T15:06:28Z", "type": "commit"}, {"oid": "589d092b80b1ecf739a84c8099165b58bf018bc8", "url": "https://github.com/nordic-institute/X-Road/commit/589d092b80b1ecf739a84c8099165b58bf018bc8", "message": "XRDDEV-867 fix csr methods that did not require member_id for SIGN csrs", "committedDate": "2020-01-30T10:11:35Z", "type": "commit"}, {"oid": "4c4ce94b9bd6c223afa6be982be56fcfdc2d39dc", "url": "https://github.com/nordic-institute/X-Road/commit/4c4ce94b9bd6c223afa6be982be56fcfdc2d39dc", "message": "XRDDEV-867 naive fix lazy loading problem for getClientGroups and getClientTlsCertificates", "committedDate": "2020-01-30T20:31:15Z", "type": "commit"}, {"oid": "84126b569044d91932367b5e2180c9a913a4a120", "url": "https://github.com/nordic-institute/X-Road/commit/84126b569044d91932367b5e2180c9a913a4a120", "message": "XRDDEV-867 naive fix lazy loading problem for getClientServiceDescriptions, getGroup, deleteGroupMember", "committedDate": "2020-01-30T22:31:24Z", "type": "commit"}, {"oid": "64da514483d139da16032d40de9ac5ab93ad5384", "url": "https://github.com/nordic-institute/X-Road/commit/64da514483d139da16032d40de9ac5ab93ad5384", "message": "XRDDEV-867 naive fix lazy loading problem for getServiceDescription", "committedDate": "2020-01-30T23:51:26Z", "type": "commit"}, {"oid": "bb1c31a74128643af31c206877ba10e4ac099295", "url": "https://github.com/nordic-institute/X-Road/commit/bb1c31a74128643af31c206877ba10e4ac099295", "message": "XRDDEV-867 add tests that fail if some endpoints would fail due to non-loaded lazy objects", "committedDate": "2020-01-31T12:31:00Z", "type": "commit"}, {"oid": "c7e32641e0e2bd571c464d2b3133645c475522fb", "url": "https://github.com/nordic-institute/X-Road/commit/c7e32641e0e2bd571c464d2b3133645c475522fb", "message": "XRDDEV-867 update lazy loaded strategy for client properties to proper one", "committedDate": "2020-01-31T12:57:37Z", "type": "commit"}, {"oid": "93851aee54e0ceee231af60b6671bc42cd550bfb", "url": "https://github.com/nordic-institute/X-Road/commit/93851aee54e0ceee231af60b6671bc42cd550bfb", "message": "Merge branch 'develop' into XRDDEV-867-fix-transaction-handling", "committedDate": "2020-02-04T11:29:49Z", "type": "commit"}, {"oid": "3dbbedd32ebd7492189eb81311c6bff20dbde3a2", "url": "https://github.com/nordic-institute/X-Road/commit/3dbbedd32ebd7492189eb81311c6bff20dbde3a2", "message": "XRDDEV-867 fix endpoint related lazy loading exceptions", "committedDate": "2020-02-04T11:37:03Z", "type": "commit"}, {"oid": "bd4be34cf4a230ce44925b339758ae6036835601", "url": "https://github.com/nordic-institute/X-Road/commit/bd4be34cf4a230ce44925b339758ae6036835601", "message": "XRDDEV-867 add comments", "committedDate": "2020-02-04T11:37:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTIxNjEwNw==", "url": "https://github.com/nordic-institute/X-Road/pull/347#discussion_r375216107", "bodyText": "Would be good to use @Override annotation here", "author": "carohauta", "createdAt": "2020-02-05T12:02:53Z", "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/config/RollbackCheckedTransactionManagementConfiguration.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/**\n+ * The MIT License\n+ * Copyright (c) 2018 Estonian Information System Authority (RIA),\n+ * Nordic Institute for Interoperability Solutions (NIIS), Population Register Centre (VRK)\n+ * Copyright (c) 2015-2017 Estonian Information System Authority (RIA), Population Register Centre (VRK)\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.niis.xroad.restapi.config;\n+\n+import org.springframework.beans.factory.config.BeanDefinition;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.context.annotation.Role;\n+import org.springframework.lang.Nullable;\n+import org.springframework.transaction.annotation.AnnotationTransactionAttributeSource;\n+import org.springframework.transaction.annotation.ProxyTransactionManagementConfiguration;\n+import org.springframework.transaction.interceptor.DelegatingTransactionAttribute;\n+import org.springframework.transaction.interceptor.TransactionAttribute;\n+import org.springframework.transaction.interceptor.TransactionAttributeSource;\n+\n+import java.lang.reflect.AnnotatedElement;\n+\n+/**\n+ * Changes default Spring @Transactional handling so that it also rolls back when checked exceptions occur\n+ */\n+@Configuration\n+public class RollbackCheckedTransactionManagementConfiguration extends ProxyTransactionManagementConfiguration {\n+\n+    @Bean\n+    @Role(BeanDefinition.ROLE_INFRASTRUCTURE)\n+    public TransactionAttributeSource transactionAttributeSource() {\n+        return new AnnotationTransactionAttributeSource() {\n+\n+            @Nullable\n+            protected TransactionAttribute determineTransactionAttribute(AnnotatedElement element) {", "originalCommit": "bd4be34cf4a230ce44925b339758ae6036835601", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTI3NzU3Mg==", "url": "https://github.com/nordic-institute/X-Road/pull/347#discussion_r375277572", "bodyText": "Fixed in 22b03fb", "author": "jansu76", "createdAt": "2020-02-05T14:13:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTIxNjEwNw=="}], "type": "inlineReview"}, {"oid": "22b03fbe7885d52088fc5fdfb5a45ccfdb60b480", "url": "https://github.com/nordic-institute/X-Road/commit/22b03fbe7885d52088fc5fdfb5a45ccfdb60b480", "message": "XRDDEV-867 add missing @Override annotations", "committedDate": "2020-02-05T14:09:10Z", "type": "commit"}]}