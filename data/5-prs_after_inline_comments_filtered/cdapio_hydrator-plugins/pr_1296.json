{"pr_number": 1296, "pr_title": "Handle CDAP Decimal for DBSink", "pr_createdAt": "2020-12-23T13:01:57Z", "pr_url": "https://github.com/cdapio/hydrator-plugins/pull/1296", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQzMjU3NA==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1296#discussion_r549432574", "bodyText": "writeToDataOut this method should also be modified", "author": "CuriousVini", "createdAt": "2020-12-28T17:54:43Z", "path": "database-plugins/src/main/java/io/cdap/plugin/DBRecord.java", "diffHunk": "@@ -285,6 +285,11 @@ private void writeToDB(PreparedStatement stmt, Schema.Field field, int fieldInde\n           stmt.setTimestamp(sqlIndex, Timestamp.from(record.getTimestamp(fieldName).toInstant()));\n           bytesWritten += Long.BYTES;\n           break;\n+        case DECIMAL:", "originalCommit": "9073013b7d41aee8fbe57df9d70e10efc6bf4209", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQzMjkxOA==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1296#discussion_r549432918", "bodyText": "what is the existing behavior when database sink writes to DB? Is this change backwards compatible?", "author": "CuriousVini", "createdAt": "2020-12-28T17:55:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQzMjU3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDI0NjgwOQ==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1296#discussion_r550246809", "bodyText": "What is the existing behavior when database sink writes to DB? Is this change backwards compatible?\n\nYes this change is backwards compatible. There are unit tests to confirm this, also we have created pipelines to test this. It all depends on the field type of the input structure record schema.\n\nwriteToDataOut this method should also be modified\n\nwirteToDataOut parameter (DataOutput out) accepts only primitive types. For logical type Decimal the type will be BYTES. Please let us know if there is a way on how to proceed to modify the writeToDataOut method?", "author": "ardian4", "createdAt": "2020-12-30T16:12:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQzMjU3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTczODcyOA==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1296#discussion_r551738728", "bodyText": "From the code it looks like existing plugin writes decimal types as bytes. After this change, the db sink will write decimal type as decimal. Is it correct?\nhttps://github.com/cdapio/hydrator-plugins/blob/develop/database-plugins/src/main/java/io/cdap/plugin/DBRecord.java#L323\n\n\nI see", "author": "CuriousVini", "createdAt": "2021-01-05T06:24:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQzMjU3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTkyNTA0NQ==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1296#discussion_r551925045", "bodyText": "Yes", "author": "ardian4", "createdAt": "2021-01-05T13:17:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQzMjU3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDMyODQ2NQ==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1296#discussion_r550328465", "bodyText": "Should we also add the size of the scale (int)?", "author": "rmstar", "createdAt": "2020-12-30T21:12:14Z", "path": "database-plugins/src/main/java/io/cdap/plugin/DBRecord.java", "diffHunk": "@@ -285,6 +285,11 @@ private void writeToDB(PreparedStatement stmt, Schema.Field field, int fieldInde\n           stmt.setTimestamp(sqlIndex, Timestamp.from(record.getTimestamp(fieldName).toInstant()));\n           bytesWritten += Long.BYTES;\n           break;\n+        case DECIMAL:\n+          BigDecimal value = record.getDecimal(fieldName);\n+          stmt.setBigDecimal(sqlIndex, value);\n+          bytesWritten += value.unscaledValue().bitLength() / Byte.SIZE;", "originalCommit": "9073013b7d41aee8fbe57df9d70e10efc6bf4209", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "21f23235c179a24aaf6e3bcfa536cc59efa67436", "url": "https://github.com/cdapio/hydrator-plugins/commit/21f23235c179a24aaf6e3bcfa536cc59efa67436", "message": "PLUGIN-180 handle CDAP Decimal for DBSink", "committedDate": "2021-01-20T19:04:23Z", "type": "commit"}, {"oid": "21f23235c179a24aaf6e3bcfa536cc59efa67436", "url": "https://github.com/cdapio/hydrator-plugins/commit/21f23235c179a24aaf6e3bcfa536cc59efa67436", "message": "PLUGIN-180 handle CDAP Decimal for DBSink", "committedDate": "2021-01-20T19:04:23Z", "type": "forcePushed"}]}