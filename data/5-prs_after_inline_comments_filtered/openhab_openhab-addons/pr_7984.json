{"pr_number": 7984, "pr_title": "[homekit] change SECURED=OFF for HomeKit lock", "pr_createdAt": "2020-06-22T20:40:29Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7984", "timeline": [{"oid": "9791c5566cf287a3691b094dedd922af414a6944", "url": "https://github.com/openhab/openhab-addons/commit/9791c5566cf287a3691b094dedd922af414a6944", "message": "[homekit] allow exposing jammed state for a lock\n\nalso change SECURED to be ON for SwitchItem\nsince this is what most real locks (especially ZWave ones) do\n\nSigned-off-by: Cody Cutrer <cody@cutrer.us>", "committedDate": "2020-06-22T23:21:40Z", "type": "commit"}, {"oid": "9791c5566cf287a3691b094dedd922af414a6944", "url": "https://github.com/openhab/openhab-addons/commit/9791c5566cf287a3691b094dedd922af414a6944", "message": "[homekit] allow exposing jammed state for a lock\n\nalso change SECURED to be ON for SwitchItem\nsince this is what most real locks (especially ZWave ones) do\n\nSigned-off-by: Cody Cutrer <cody@cutrer.us>", "committedDate": "2020-06-22T23:21:40Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjYxODcyOA==", "url": "https://github.com/openhab/openhab-addons/pull/7984#discussion_r446618728", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            state.equals(OnOffType.ON) ? LockCurrentStateEnum.SECURED : LockCurrentStateEnum.UNSECURED);\n          \n          \n            \n                            state == OnOffType.ON ? LockCurrentStateEnum.SECURED : LockCurrentStateEnum.UNSECURED);", "author": "J-N-K", "createdAt": "2020-06-28T08:24:11Z", "path": "bundles/org.openhab.io.homekit/src/main/java/org/openhab/io/homekit/internal/accessories/HomekitLockImpl.java", "diffHunk": "@@ -47,10 +50,14 @@ public HomekitLockImpl(HomekitTaggedItem taggedItem, List<HomekitTaggedItem> man\n     @Override\n     public CompletableFuture<LockCurrentStateEnum> getLockCurrentState() {\n         @Nullable\n-        OnOffType state = getStateAs(HomekitCharacteristicType.LOCK_CURRENT_STATE, OnOffType.class);\n-        if (state != null) {\n+\n+        final State state = getItem(HomekitCharacteristicType.LOCK_CURRENT_STATE, GenericItem.class).getState();\n+        if (state instanceof DecimalType) {\n+            return CompletableFuture.completedFuture(LockCurrentStateEnum.fromCode(\n+                state.as(DecimalType.class).intValue()));\n+        } else if (state instanceof OnOffType) {\n             return CompletableFuture.completedFuture(\n-                    state == OnOffType.OFF ? LockCurrentStateEnum.SECURED : LockCurrentStateEnum.UNSECURED);\n+                state.equals(OnOffType.ON) ? LockCurrentStateEnum.SECURED : LockCurrentStateEnum.UNSECURED);", "originalCommit": "9791c5566cf287a3691b094dedd922af414a6944", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "eec24f54d617f178753d7959056b9d8cf2c9f93f", "url": "https://github.com/openhab/openhab-addons/commit/eec24f54d617f178753d7959056b9d8cf2c9f93f", "message": "Update bundles/org.openhab.io.homekit/src/main/java/org/openhab/io/homekit/internal/accessories/HomekitLockImpl.java", "committedDate": "2020-06-28T08:24:27Z", "type": "commit"}]}