{"pr_number": 8075, "pr_title": "[kodi] Thing handler factory with null annotations and constructor injection", "pr_createdAt": "2020-07-04T15:45:29Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/8075", "timeline": [{"oid": "b5d5f095586f8a1ce0b1a5bd0a5d8ba546ce4f51", "url": "https://github.com/openhab/openhab-addons/commit/b5d5f095586f8a1ce0b1a5bd0a5d8ba546ce4f51", "message": "[kodi] Thing handler factory with null annotations and constructor injection\n\nSigned-off-by: Laurent Garnier <lg.hc@free.fr>", "committedDate": "2020-07-04T15:43:15Z", "type": "commit"}, {"oid": "e020ad0d4ad592256faa0d3da184263927223e51", "url": "https://github.com/openhab/openhab-addons/commit/e020ad0d4ad592256faa0d3da184263927223e51", "message": "final added to few class fields\n\nSigned-off-by: Laurent Garnier <lg.hc@free.fr>", "committedDate": "2020-07-04T16:44:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgwMDYxNA==", "url": "https://github.com/openhab/openhab-addons/pull/8075#discussion_r449800614", "bodyText": "Please add @Activate annotation here too. Otherwise this method will be ignored in favor of all annotated activation methods.\nAnother option would be to pass the ComponentContext parameter to the constructor and move all the logic inside this method into the constructor too.", "author": "cweitkamp", "createdAt": "2020-07-04T19:50:13Z", "path": "bundles/org.openhab.binding.kodi/src/main/java/org/openhab/binding/kodi/internal/KodiHandlerFactory.java", "diffHunk": "@@ -45,21 +48,32 @@\n  * @author Paul Frank - Initial contribution\n  * @author Christoph Weitkamp - Improvements on channels for opening PVR TV or Radio streams\n  */\n+@NonNullByDefault\n @Component(service = ThingHandlerFactory.class, configurationPid = \"binding.kodi\")\n public class KodiHandlerFactory extends BaseThingHandlerFactory {\n \n-    private Logger logger = LoggerFactory.getLogger(KodiHandlerFactory.class);\n+    private final Logger logger = LoggerFactory.getLogger(KodiHandlerFactory.class);\n \n-    private AudioHTTPServer audioHTTPServer;\n-    private NetworkAddressService networkAddressService;\n-    private WebSocketClient webSocketClient;\n+    private final AudioHTTPServer audioHTTPServer;\n+    private final NetworkAddressService networkAddressService;\n+    private final KodiDynamicStateDescriptionProvider stateDescriptionProvider;\n+    private final WebSocketClient webSocketClient;\n \n-    // url (scheme+server+port) to use for playing notification sounds\n-    private String callbackUrl = null;\n+    private final Map<String, @Nullable ServiceRegistration<AudioSink>> audioSinkRegistrations = new ConcurrentHashMap<>();\n \n-    private Map<String, ServiceRegistration<AudioSink>> audioSinkRegistrations = new ConcurrentHashMap<>();\n+    // url (scheme+server+port) to use for playing notification sounds\n+    private @Nullable String callbackUrl;\n \n-    private KodiDynamicStateDescriptionProvider stateDescriptionProvider;\n+    @Activate\n+    public KodiHandlerFactory(final @Reference AudioHTTPServer audioHTTPServer,\n+            final @Reference NetworkAddressService networkAddressService,\n+            final @Reference KodiDynamicStateDescriptionProvider stateDescriptionProvider,\n+            final @Reference WebSocketFactory webSocketFactory) {\n+        this.audioHTTPServer = audioHTTPServer;\n+        this.networkAddressService = networkAddressService;\n+        this.stateDescriptionProvider = stateDescriptionProvider;\n+        this.webSocketClient = webSocketFactory.getCommonWebSocketClient();\n+    }\n \n     @Override\n     protected void activate(ComponentContext componentContext) {", "originalCommit": "e020ad0d4ad592256faa0d3da184263927223e51", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg0MDkxMg==", "url": "https://github.com/openhab/openhab-addons/pull/8075#discussion_r449840912", "bodyText": "Excuse me but I have a serious doubt. Please look at the handler factory for the Sonos and LGwebOS bindings for example. They are done like that. If activate method was not called, the LGwebOS binding would just not work at all a(s the WebSocket client would not be started).", "author": "lolodomo", "createdAt": "2020-07-05T06:39:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgwMDYxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg1Njg4Mw==", "url": "https://github.com/openhab/openhab-addons/pull/8075#discussion_r449856883", "bodyText": "Hm, interesting. I do not have a clue why it is working but it seems to work.", "author": "cweitkamp", "createdAt": "2020-07-05T09:40:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgwMDYxNA=="}], "type": "inlineReview"}]}