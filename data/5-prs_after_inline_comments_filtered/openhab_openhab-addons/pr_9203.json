{"pr_number": 9203, "pr_title": "[miio] Implement alternative MiIoQuantityTypes", "pr_createdAt": "2020-12-02T19:07:02Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/9203", "timeline": [{"oid": "1561f120a97665ecf927bc00195d862f0036a6e9", "url": "https://github.com/openhab/openhab-addons/commit/1561f120a97665ecf927bc00195d862f0036a6e9", "message": "[miio] Implement alternative MiIoQuantityTypes\n\n* Improved way avoiding multiple entries for Unit\n* Test cases for the MiIoQuantityTypes class\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>", "committedDate": "2020-12-02T19:04:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDU3NTUyOA==", "url": "https://github.com/openhab/openhab-addons/pull/9203#discussion_r534575528", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (stringMap.containsKey(unitName.toUpperCase())) {\n          \n          \n            \n                        return stringMap.get(unitName.toUpperCase());\n          \n          \n            \n                    }\n          \n          \n            \n                    return aliasMap().get(unitName.toLowerCase());\n          \n          \n            \n                    Unit<?> unit = stringMap.get(unitName.toUpperCase());\n          \n          \n            \n                    if (unit == null) {\n          \n          \n            \n                        unit = aliasMap().get(unitName.toLowerCase());\n          \n          \n            \n                    }\n          \n          \n            \n                    return unit;", "author": "cpmeister", "createdAt": "2020-12-03T00:29:41Z", "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/MiIoQuantiyTypes.java", "diffHunk": "@@ -33,31 +36,49 @@\n @NonNullByDefault\n public enum MiIoQuantiyTypes {\n \n-    CELCIUS(SIUnits.CELSIUS),\n-    FAHRENHEIT(ImperialUnits.FAHRENHEIT),\n-    SECOND(SmartHomeUnits.SECOND),\n-    MINUTE(SmartHomeUnits.MINUTE),\n-    HOUR(SmartHomeUnits.HOUR),\n-    SECONDS(SmartHomeUnits.SECOND),\n-    MINUTES(SmartHomeUnits.MINUTE),\n-    HOURS(SmartHomeUnits.HOUR),\n-    AMPERE(SmartHomeUnits.AMPERE),\n-    WATT(SmartHomeUnits.WATT);\n+    CELCIUS(SIUnits.CELSIUS, \"C\"),\n+    FAHRENHEIT(ImperialUnits.FAHRENHEIT, \"\"),\n+    SECOND(SmartHomeUnits.SECOND, \"seconds\"),\n+    MINUTE(SmartHomeUnits.MINUTE, \"minutes\"),\n+    HOUR(SmartHomeUnits.HOUR, \"hours\"),\n+    AMPERE(SmartHomeUnits.AMPERE, \"\"),\n+    WATT(SmartHomeUnits.WATT, \"\"),\n+    SQUARE_METRE(Units.SQUARE_METRE, \"square_meter,squaremeter\"),\n+    PERCENT(SmartHomeUnits.PERCENT, \"\");\n \n     private final Unit<?> unit;\n+    private final String aliasses;\n \n     private static Map<String, Unit<?>> stringMap = Arrays.stream(values())\n             .collect(Collectors.toMap(Enum::toString, MiIoQuantiyTypes::getUnit));\n \n-    private MiIoQuantiyTypes(Unit<?> unit) {\n+    private static Map<String, Unit<?>> aliasMap() {\n+        Map<String, Unit<?>> aliassesMap = new HashMap<>();\n+        for (MiIoQuantiyTypes miIoQuantiyType : values()) {\n+            for (String alias : miIoQuantiyType.getAliasses().split(\",\")) {\n+                aliassesMap.put(alias.toLowerCase(), miIoQuantiyType.getUnit());\n+            }\n+        }\n+        return aliassesMap;\n+    }\n+\n+    private MiIoQuantiyTypes(Unit<?> unit, String aliasses) {\n         this.unit = unit;\n+        this.aliasses = aliasses;\n     }\n \n     public Unit<?> getUnit() {\n         return unit;\n     }\n \n+    public String getAliasses() {\n+        return aliasses;\n+    }\n+\n     public static @Nullable Unit<?> get(String unitName) {\n-        return stringMap.get(unitName.toUpperCase());\n+        if (stringMap.containsKey(unitName.toUpperCase())) {\n+            return stringMap.get(unitName.toUpperCase());\n+        }\n+        return aliasMap().get(unitName.toLowerCase());", "originalCommit": "1561f120a97665ecf927bc00195d862f0036a6e9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTU3NDU3Nw==", "url": "https://github.com/openhab/openhab-addons/pull/9203#discussion_r535574577", "bodyText": "I see no reason that you need to have your aliases comma separated when you can just have them as an array instead.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private MiIoQuantiyTypes(Unit<?> unit, String aliasses) {\n          \n          \n            \n                private MiIoQuantiyTypes(Unit<?> unit, String... aliasses) {", "author": "cpmeister", "createdAt": "2020-12-03T20:31:13Z", "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/MiIoQuantiyTypes.java", "diffHunk": "@@ -33,31 +36,49 @@\n @NonNullByDefault\n public enum MiIoQuantiyTypes {\n \n-    CELCIUS(SIUnits.CELSIUS),\n-    FAHRENHEIT(ImperialUnits.FAHRENHEIT),\n-    SECOND(SmartHomeUnits.SECOND),\n-    MINUTE(SmartHomeUnits.MINUTE),\n-    HOUR(SmartHomeUnits.HOUR),\n-    SECONDS(SmartHomeUnits.SECOND),\n-    MINUTES(SmartHomeUnits.MINUTE),\n-    HOURS(SmartHomeUnits.HOUR),\n-    AMPERE(SmartHomeUnits.AMPERE),\n-    WATT(SmartHomeUnits.WATT);\n+    CELCIUS(SIUnits.CELSIUS, \"C\"),\n+    FAHRENHEIT(ImperialUnits.FAHRENHEIT, \"\"),\n+    SECOND(SmartHomeUnits.SECOND, \"seconds\"),\n+    MINUTE(SmartHomeUnits.MINUTE, \"minutes\"),\n+    HOUR(SmartHomeUnits.HOUR, \"hours\"),\n+    AMPERE(SmartHomeUnits.AMPERE, \"\"),\n+    WATT(SmartHomeUnits.WATT, \"\"),\n+    SQUARE_METRE(Units.SQUARE_METRE, \"square_meter,squaremeter\"),\n+    PERCENT(SmartHomeUnits.PERCENT, \"\");\n \n     private final Unit<?> unit;\n+    private final String aliasses;\n \n     private static Map<String, Unit<?>> stringMap = Arrays.stream(values())\n             .collect(Collectors.toMap(Enum::toString, MiIoQuantiyTypes::getUnit));\n \n-    private MiIoQuantiyTypes(Unit<?> unit) {\n+    private static Map<String, Unit<?>> aliasMap() {\n+        Map<String, Unit<?>> aliassesMap = new HashMap<>();\n+        for (MiIoQuantiyTypes miIoQuantiyType : values()) {\n+            for (String alias : miIoQuantiyType.getAliasses().split(\",\")) {\n+                aliassesMap.put(alias.toLowerCase(), miIoQuantiyType.getUnit());\n+            }\n+        }\n+        return aliassesMap;\n+    }\n+\n+    private MiIoQuantiyTypes(Unit<?> unit, String aliasses) {", "originalCommit": "1561f120a97665ecf927bc00195d862f0036a6e9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTU3NTAwOQ==", "url": "https://github.com/openhab/openhab-addons/pull/9203#discussion_r535575009", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private final String aliasses;\n          \n          \n            \n                private final String[] aliasses;", "author": "cpmeister", "createdAt": "2020-12-03T20:31:36Z", "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/MiIoQuantiyTypes.java", "diffHunk": "@@ -33,31 +36,49 @@\n @NonNullByDefault\n public enum MiIoQuantiyTypes {\n \n-    CELCIUS(SIUnits.CELSIUS),\n-    FAHRENHEIT(ImperialUnits.FAHRENHEIT),\n-    SECOND(SmartHomeUnits.SECOND),\n-    MINUTE(SmartHomeUnits.MINUTE),\n-    HOUR(SmartHomeUnits.HOUR),\n-    SECONDS(SmartHomeUnits.SECOND),\n-    MINUTES(SmartHomeUnits.MINUTE),\n-    HOURS(SmartHomeUnits.HOUR),\n-    AMPERE(SmartHomeUnits.AMPERE),\n-    WATT(SmartHomeUnits.WATT);\n+    CELCIUS(SIUnits.CELSIUS, \"C\"),\n+    FAHRENHEIT(ImperialUnits.FAHRENHEIT, \"\"),\n+    SECOND(SmartHomeUnits.SECOND, \"seconds\"),\n+    MINUTE(SmartHomeUnits.MINUTE, \"minutes\"),\n+    HOUR(SmartHomeUnits.HOUR, \"hours\"),\n+    AMPERE(SmartHomeUnits.AMPERE, \"\"),\n+    WATT(SmartHomeUnits.WATT, \"\"),\n+    SQUARE_METRE(Units.SQUARE_METRE, \"square_meter,squaremeter\"),\n+    PERCENT(SmartHomeUnits.PERCENT, \"\");\n \n     private final Unit<?> unit;\n+    private final String aliasses;", "originalCommit": "1561f120a97665ecf927bc00195d862f0036a6e9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTU3NTIzMA==", "url": "https://github.com/openhab/openhab-addons/pull/9203#discussion_r535575230", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                SQUARE_METRE(Units.SQUARE_METRE, \"square_meter,squaremeter\"),\n          \n          \n            \n                SQUARE_METRE(Units.SQUARE_METRE, \"square_meter\", \"squaremeter\"),", "author": "cpmeister", "createdAt": "2020-12-03T20:31:48Z", "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/MiIoQuantiyTypes.java", "diffHunk": "@@ -33,31 +36,49 @@\n @NonNullByDefault\n public enum MiIoQuantiyTypes {\n \n-    CELCIUS(SIUnits.CELSIUS),\n-    FAHRENHEIT(ImperialUnits.FAHRENHEIT),\n-    SECOND(SmartHomeUnits.SECOND),\n-    MINUTE(SmartHomeUnits.MINUTE),\n-    HOUR(SmartHomeUnits.HOUR),\n-    SECONDS(SmartHomeUnits.SECOND),\n-    MINUTES(SmartHomeUnits.MINUTE),\n-    HOURS(SmartHomeUnits.HOUR),\n-    AMPERE(SmartHomeUnits.AMPERE),\n-    WATT(SmartHomeUnits.WATT);\n+    CELCIUS(SIUnits.CELSIUS, \"C\"),\n+    FAHRENHEIT(ImperialUnits.FAHRENHEIT, \"\"),\n+    SECOND(SmartHomeUnits.SECOND, \"seconds\"),\n+    MINUTE(SmartHomeUnits.MINUTE, \"minutes\"),\n+    HOUR(SmartHomeUnits.HOUR, \"hours\"),\n+    AMPERE(SmartHomeUnits.AMPERE, \"\"),\n+    WATT(SmartHomeUnits.WATT, \"\"),\n+    SQUARE_METRE(Units.SQUARE_METRE, \"square_meter,squaremeter\"),", "originalCommit": "1561f120a97665ecf927bc00195d862f0036a6e9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTU3NTk5NQ==", "url": "https://github.com/openhab/openhab-addons/pull/9203#discussion_r535575995", "bodyText": "You can remove the empty strings then. Do so for the others as well.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                AMPERE(SmartHomeUnits.AMPERE, \"\"),\n          \n          \n            \n                WATT(SmartHomeUnits.WATT, \"\"),\n          \n          \n            \n                AMPERE(SmartHomeUnits.AMPERE),\n          \n          \n            \n                WATT(SmartHomeUnits.WATT),", "author": "cpmeister", "createdAt": "2020-12-03T20:32:30Z", "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/MiIoQuantiyTypes.java", "diffHunk": "@@ -33,31 +36,49 @@\n @NonNullByDefault\n public enum MiIoQuantiyTypes {\n \n-    CELCIUS(SIUnits.CELSIUS),\n-    FAHRENHEIT(ImperialUnits.FAHRENHEIT),\n-    SECOND(SmartHomeUnits.SECOND),\n-    MINUTE(SmartHomeUnits.MINUTE),\n-    HOUR(SmartHomeUnits.HOUR),\n-    SECONDS(SmartHomeUnits.SECOND),\n-    MINUTES(SmartHomeUnits.MINUTE),\n-    HOURS(SmartHomeUnits.HOUR),\n-    AMPERE(SmartHomeUnits.AMPERE),\n-    WATT(SmartHomeUnits.WATT);\n+    CELCIUS(SIUnits.CELSIUS, \"C\"),\n+    FAHRENHEIT(ImperialUnits.FAHRENHEIT, \"\"),\n+    SECOND(SmartHomeUnits.SECOND, \"seconds\"),\n+    MINUTE(SmartHomeUnits.MINUTE, \"minutes\"),\n+    HOUR(SmartHomeUnits.HOUR, \"hours\"),\n+    AMPERE(SmartHomeUnits.AMPERE, \"\"),\n+    WATT(SmartHomeUnits.WATT, \"\"),", "originalCommit": "1561f120a97665ecf927bc00195d862f0036a6e9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTU3NzIyMw==", "url": "https://github.com/openhab/openhab-addons/pull/9203#discussion_r535577223", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        for (String alias : miIoQuantiyType.getAliasses().split(\",\")) {\n          \n          \n            \n                        for (String alias : miIoQuantiyType.getAliasses()) {", "author": "cpmeister", "createdAt": "2020-12-03T20:33:41Z", "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/MiIoQuantiyTypes.java", "diffHunk": "@@ -33,31 +36,49 @@\n @NonNullByDefault\n public enum MiIoQuantiyTypes {\n \n-    CELCIUS(SIUnits.CELSIUS),\n-    FAHRENHEIT(ImperialUnits.FAHRENHEIT),\n-    SECOND(SmartHomeUnits.SECOND),\n-    MINUTE(SmartHomeUnits.MINUTE),\n-    HOUR(SmartHomeUnits.HOUR),\n-    SECONDS(SmartHomeUnits.SECOND),\n-    MINUTES(SmartHomeUnits.MINUTE),\n-    HOURS(SmartHomeUnits.HOUR),\n-    AMPERE(SmartHomeUnits.AMPERE),\n-    WATT(SmartHomeUnits.WATT);\n+    CELCIUS(SIUnits.CELSIUS, \"C\"),\n+    FAHRENHEIT(ImperialUnits.FAHRENHEIT, \"\"),\n+    SECOND(SmartHomeUnits.SECOND, \"seconds\"),\n+    MINUTE(SmartHomeUnits.MINUTE, \"minutes\"),\n+    HOUR(SmartHomeUnits.HOUR, \"hours\"),\n+    AMPERE(SmartHomeUnits.AMPERE, \"\"),\n+    WATT(SmartHomeUnits.WATT, \"\"),\n+    SQUARE_METRE(Units.SQUARE_METRE, \"square_meter,squaremeter\"),\n+    PERCENT(SmartHomeUnits.PERCENT, \"\");\n \n     private final Unit<?> unit;\n+    private final String aliasses;\n \n     private static Map<String, Unit<?>> stringMap = Arrays.stream(values())\n             .collect(Collectors.toMap(Enum::toString, MiIoQuantiyTypes::getUnit));\n \n-    private MiIoQuantiyTypes(Unit<?> unit) {\n+    private static Map<String, Unit<?>> aliasMap() {\n+        Map<String, Unit<?>> aliassesMap = new HashMap<>();\n+        for (MiIoQuantiyTypes miIoQuantiyType : values()) {\n+            for (String alias : miIoQuantiyType.getAliasses().split(\",\")) {", "originalCommit": "1561f120a97665ecf927bc00195d862f0036a6e9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b18df0ae645009297dd5982d27fab2ed11e34cc8", "url": "https://github.com/openhab/openhab-addons/commit/b18df0ae645009297dd5982d27fab2ed11e34cc8", "message": "Apply suggestions from code review\n\nCo-authored-by: Connor Petty <mistercpp2000@gmail.com>\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>", "committedDate": "2020-12-04T08:16:54Z", "type": "commit"}, {"oid": "b18df0ae645009297dd5982d27fab2ed11e34cc8", "url": "https://github.com/openhab/openhab-addons/commit/b18df0ae645009297dd5982d27fab2ed11e34cc8", "message": "Apply suggestions from code review\n\nCo-authored-by: Connor Petty <mistercpp2000@gmail.com>\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>", "committedDate": "2020-12-04T08:16:54Z", "type": "forcePushed"}]}