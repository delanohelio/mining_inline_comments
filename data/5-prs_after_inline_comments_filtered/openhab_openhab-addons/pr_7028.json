{"pr_number": 7028, "pr_title": "[tplinksmarthome] fix dimmer not turning on via brightness value", "pr_createdAt": "2020-02-17T19:52:23Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7028", "timeline": [{"oid": "2b204b4e07728da28cb4b4ec6ad197b430e265ad", "url": "https://github.com/openhab/openhab-addons/commit/2b204b4e07728da28cb4b4ec6ad197b430e265ad", "message": "fix dimmer not turning on via brightness value\n\nSigned-off-by: Jan N. Klug <jan.n.klug@rub.de>", "committedDate": "2020-02-17T19:51:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDM1NjA1MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7028#discussion_r380356051", "bodyText": "I would say sending ON should always be done, because theoretical the state in the binding might not reflect the actual state.So if the device is off, but the binding still thinks it's on it will not be set on.\nAlso the ON should be send after the setting brightness. Because brightness might be 100, while setting it to 10 might cause a light flashing. This because brightness is kept separate as the on state on the device.", "author": "Hilbrand", "createdAt": "2020-02-17T20:29:23Z", "path": "bundles/org.openhab.binding.tplinksmarthome/src/main/java/org/openhab/binding/tplinksmarthome/internal/device/DimmerDevice.java", "diffHunk": "@@ -63,6 +65,10 @@ private boolean handleBrightnessChannel(ChannelUID channelUid, Command command)\n \n             // Don't send value 0 as brightness value as it will give an error from the device.\n             if (percentCommand.intValue() > 0) {\n+                if (lastBrightnessState.equals(PercentType.ZERO)) {\n+                    // if the light was off before, turn it on before setting the brightness value\n+                    setOnOffState(channelUid, OnOffType.ON);", "originalCommit": "2b204b4e07728da28cb4b4ec6ad197b430e265ad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDM2MzI5NQ==", "url": "https://github.com/openhab/openhab-addons/pull/7028#discussion_r380363295", "bodyText": "Done. Also fixed the tests", "author": "J-N-K", "createdAt": "2020-02-17T20:56:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDM1NjA1MQ=="}], "type": "inlineReview"}, {"oid": "0562fe601b1b9b6c29e82b746dc20a99a7c6f518", "url": "https://github.com/openhab/openhab-addons/commit/0562fe601b1b9b6c29e82b746dc20a99a7c6f518", "message": "improvements\n\nSigned-off-by: Jan N. Klug <jan.n.klug@rub.de>", "committedDate": "2020-02-17T20:54:49Z", "type": "commit"}, {"oid": "0f5eceb68efa29d9ab8a6203c715e1540f6dfbf8", "url": "https://github.com/openhab/openhab-addons/commit/0f5eceb68efa29d9ab8a6203c715e1540f6dfbf8", "message": "remove empty line\n\nSigned-off-by: Jan N. Klug <jan.n.klug@rub.de>", "committedDate": "2020-02-17T20:56:29Z", "type": "commit"}]}