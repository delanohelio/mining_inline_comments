{"pr_number": 7927, "pr_title": "[netatmo] Add support for the floodlight of the Presence camera (#7912)", "pr_createdAt": "2020-06-16T16:46:37Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7927", "timeline": [{"oid": "78699f923475262f714b186a4440d2a40edf1331", "url": "https://github.com/openhab/openhab-addons/commit/78699f923475262f714b186a4440d2a40edf1331", "message": "Merge pull request #1 from openhab/2.5.x\n\nUpdate", "committedDate": "2020-06-10T17:50:55Z", "type": "commit"}, {"oid": "ae6b89156403811be49f80a0ad7831957f7e3ff3", "url": "https://github.com/openhab/openhab-addons/commit/ae6b89156403811be49f80a0ad7831957f7e3ff3", "message": "Merge pull request #2 from openhab/2.5.x\n\nUpdate", "committedDate": "2020-06-12T18:12:18Z", "type": "commit"}, {"oid": "66abc11ea152aaa77d9bc64abe15f2dc94f65056", "url": "https://github.com/openhab/openhab-addons/commit/66abc11ea152aaa77d9bc64abe15f2dc94f65056", "message": "Merge pull request #3 from openhab/2.5.x\n\nUpdate", "committedDate": "2020-06-13T20:20:47Z", "type": "commit"}, {"oid": "4f2cd511ce4312cde304741620c1765d56cd68c5", "url": "https://github.com/openhab/openhab-addons/commit/4f2cd511ce4312cde304741620c1765d56cd68c5", "message": "Merge pull request #4 from openhab/2.5.x\n\nUpdate", "committedDate": "2020-06-16T16:31:06Z", "type": "commit"}, {"oid": "dde518f9e8701b767bf71e9afe380d03e90221b3", "url": "https://github.com/openhab/openhab-addons/commit/dde518f9e8701b767bf71e9afe380d03e90221b3", "message": "[#7912] Support for the floodlight of the Presence camera\n- Support for the floodlight of the Presence camera added (There are 2 new switches to set the floodlight auto-mode and to switch the floodlight on and off/auto).\n- Netatmo API swagger spec updated\n- Tests added\n\nSigned-off-by: Sven Strohschein <sven.strohschein@gmail.com>", "committedDate": "2020-06-16T16:46:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA0NjM1Mw==", "url": "https://github.com/openhab/openhab-addons/pull/7927#discussion_r441046353", "bodyText": "The error logging level should be reserved for issues catastrophic enough to threaten the operation of openHab itself. An error in a binding shouldn't qualify for this. Please read the openHab coding guidelines for expected use of logging in bindings.\nI suggest downgrading this to warning or setting the handler to offline.", "author": "cpmeister", "createdAt": "2020-06-16T18:11:01Z", "path": "bundles/org.openhab.binding.netatmo/src/main/java/org/openhab/binding/netatmo/internal/presence/NAPresenceCameraHandler.java", "diffHunk": "@@ -0,0 +1,175 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.netatmo.internal.presence;\n+\n+import static org.openhab.binding.netatmo.internal.ChannelTypeUtils.toOnOffType;\n+\n+import io.swagger.client.model.NAWelcomeCamera;\n+import org.eclipse.jdt.annotation.NonNull;\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.smarthome.core.i18n.TimeZoneProvider;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.State;\n+import org.eclipse.smarthome.core.types.UnDefType;\n+import org.eclipse.smarthome.io.net.http.HttpUtil;\n+import org.json.JSONException;\n+import org.json.JSONObject;\n+import org.openhab.binding.netatmo.internal.camera.CameraHandler;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.IOException;\n+import java.util.Optional;\n+\n+import static org.openhab.binding.netatmo.internal.NetatmoBindingConstants.CHANNEL_CAMERA_FLOODLIGHT;\n+import static org.openhab.binding.netatmo.internal.NetatmoBindingConstants.CHANNEL_CAMERA_FLOODLIGHT_AUTO_MODE;\n+\n+/**\n+ * {@link NAPresenceCameraHandler} is the class used to handle Presence camera data\n+ *\n+ * @author Sven Strohschein\n+ */\n+@NonNullByDefault\n+public class NAPresenceCameraHandler extends CameraHandler {\n+\n+    private static final String PING_URL_PATH = \"/command/ping\";\n+    private static final String FLOODLIGHT_SET_URL_PATH = \"/command/floodlight_set_config\";\n+\n+    private final Logger logger = LoggerFactory.getLogger(NAPresenceCameraHandler.class);\n+\n+    private Optional<CameraAddress> cameraAddress = Optional.empty();\n+    private State floodlightAutoModeState = UnDefType.UNDEF;\n+\n+    public NAPresenceCameraHandler(final Thing thing, final TimeZoneProvider timeZoneProvider) {\n+        super(thing, timeZoneProvider);\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        String channelId = channelUID.getId();\n+        switch (channelId) {\n+            case CHANNEL_CAMERA_FLOODLIGHT:\n+                if(OnOffType.ON.equals(command)) {\n+                    switchFloodlight(true);\n+                } else if(OnOffType.OFF.equals(command)) {\n+                    switchFloodlight(false);\n+                }\n+                break;\n+            case CHANNEL_CAMERA_FLOODLIGHT_AUTO_MODE:\n+                if(OnOffType.ON.equals(command)) {\n+                    switchFloodlightAutoMode(true);\n+                } else if(OnOffType.OFF.equals(command)) {\n+                    switchFloodlightAutoMode(false);\n+                }\n+                break;\n+        }\n+        super.handleCommand(channelUID, command);\n+    }\n+\n+    @Override\n+    protected State getNAThingProperty(@NonNull String channelId) {\n+        switch (channelId) {\n+            case CHANNEL_CAMERA_FLOODLIGHT:\n+                return getFloodlightState();\n+            case CHANNEL_CAMERA_FLOODLIGHT_AUTO_MODE:\n+                //The auto-mode state shouldn't be updated, because this isn't a dedicated information. When the\n+                // floodlight is switched on the state within the Netatmo API is \"on\" and the information if the previous\n+                // state was \"auto\" instead of \"off\" is lost... Therefore the binding handles its own auto-mode state.\n+                if(UnDefType.UNDEF.equals(floodlightAutoModeState)) {\n+                    floodlightAutoModeState = getFloodlightAutoModeState();\n+                }\n+                return floodlightAutoModeState;\n+        }\n+        return super.getNAThingProperty(channelId);\n+    }\n+\n+    private State getFloodlightState() {\n+        if (module != null) {\n+            final boolean isOn = NAWelcomeCamera.LightModeStatusEnum.ON.equals(module.getLightModeStatus());\n+            return toOnOffType(isOn);\n+        }\n+        return UnDefType.UNDEF;\n+    }\n+\n+    private State getFloodlightAutoModeState() {\n+        if (module != null) {\n+            return toOnOffType(NAWelcomeCamera.LightModeStatusEnum.AUTO.equals(module.getLightModeStatus()));\n+        }\n+        return UnDefType.UNDEF;\n+    }\n+\n+    private void switchFloodlight(boolean isOn) {\n+        if (isOn) {\n+            changeFloodlightMode(NAWelcomeCamera.LightModeStatusEnum.ON);\n+        } else {\n+            switchFloodlightAutoMode(OnOffType.ON.equals(floodlightAutoModeState));\n+        }\n+    }\n+\n+    private void switchFloodlightAutoMode(boolean isAutoMode) {\n+        floodlightAutoModeState = toOnOffType(isAutoMode);\n+        if (isAutoMode) {\n+            changeFloodlightMode(NAWelcomeCamera.LightModeStatusEnum.AUTO);\n+        } else {\n+            changeFloodlightMode(NAWelcomeCamera.LightModeStatusEnum.OFF);\n+        }\n+    }\n+\n+    private void changeFloodlightMode(NAWelcomeCamera.LightModeStatusEnum mode) {\n+        Optional<String> localCameraURL = getLocalCameraURL();\n+        if (localCameraURL.isPresent()) {\n+            String url = localCameraURL.get()\n+                    + FLOODLIGHT_SET_URL_PATH\n+                    + \"?config=%7B%22mode%22:%22\"\n+                    + mode.toString()\n+                    + \"%22%7D\";\n+            executeGETRequest(url);\n+        }\n+    }\n+\n+    private Optional<String> getLocalCameraURL() {\n+        String vpnURL = getVpnUrl();\n+        if (vpnURL != null) {\n+            //The local address is (re-)requested when it wasn't already determined or when the vpn address was changed.\n+            if (!cameraAddress.isPresent() || cameraAddress.get().isVpnURLChanged(vpnURL)) {\n+                Optional<JSONObject> json = executeGETRequestJSON(vpnURL + PING_URL_PATH);\n+                cameraAddress = json.map(j -> j.getString(\"local_url\"))\n+                        .map(localURL -> new CameraAddress(vpnURL, localURL));\n+            }\n+        }\n+        return cameraAddress.map(CameraAddress::getLocalURL);\n+    }\n+\n+    private Optional<JSONObject> executeGETRequestJSON(String url) {\n+        Optional<JSONObject> jsonContent = executeGETRequest(url).map(JSONObject::new);\n+        if(!jsonContent.isPresent()) {\n+            logger.error(\"The request-result could not get retrieved!\");\n+        }\n+        return jsonContent;\n+    }\n+\n+    Optional<String> executeGETRequest(String url) {\n+        try {\n+            String content = HttpUtil.executeUrl(\"GET\", url, 5000);\n+            if (content != null && !content.isEmpty()) {\n+                return Optional.of(content);\n+            }\n+        } catch (IOException | JSONException e) {\n+            logger.error(\"Error on loading local camera url!\", e);", "originalCommit": "dde518f9e8701b767bf71e9afe380d03e90221b3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTExMzI1Nw==", "url": "https://github.com/openhab/openhab-addons/pull/7927#discussion_r441113257", "bodyText": "ok, good hint to the guidelines. Thank you.\nDone.", "author": "Novanic", "createdAt": "2020-06-16T20:11:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA0NjM1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA0NzcwMA==", "url": "https://github.com/openhab/openhab-addons/pull/7927#discussion_r441047700", "bodyText": "This should be changed to debug, otherwise you are just double logging what already was logged in executeGETRequest.", "author": "cpmeister", "createdAt": "2020-06-16T18:13:27Z", "path": "bundles/org.openhab.binding.netatmo/src/main/java/org/openhab/binding/netatmo/internal/presence/NAPresenceCameraHandler.java", "diffHunk": "@@ -0,0 +1,175 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.netatmo.internal.presence;\n+\n+import static org.openhab.binding.netatmo.internal.ChannelTypeUtils.toOnOffType;\n+\n+import io.swagger.client.model.NAWelcomeCamera;\n+import org.eclipse.jdt.annotation.NonNull;\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.smarthome.core.i18n.TimeZoneProvider;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.State;\n+import org.eclipse.smarthome.core.types.UnDefType;\n+import org.eclipse.smarthome.io.net.http.HttpUtil;\n+import org.json.JSONException;\n+import org.json.JSONObject;\n+import org.openhab.binding.netatmo.internal.camera.CameraHandler;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.IOException;\n+import java.util.Optional;\n+\n+import static org.openhab.binding.netatmo.internal.NetatmoBindingConstants.CHANNEL_CAMERA_FLOODLIGHT;\n+import static org.openhab.binding.netatmo.internal.NetatmoBindingConstants.CHANNEL_CAMERA_FLOODLIGHT_AUTO_MODE;\n+\n+/**\n+ * {@link NAPresenceCameraHandler} is the class used to handle Presence camera data\n+ *\n+ * @author Sven Strohschein\n+ */\n+@NonNullByDefault\n+public class NAPresenceCameraHandler extends CameraHandler {\n+\n+    private static final String PING_URL_PATH = \"/command/ping\";\n+    private static final String FLOODLIGHT_SET_URL_PATH = \"/command/floodlight_set_config\";\n+\n+    private final Logger logger = LoggerFactory.getLogger(NAPresenceCameraHandler.class);\n+\n+    private Optional<CameraAddress> cameraAddress = Optional.empty();\n+    private State floodlightAutoModeState = UnDefType.UNDEF;\n+\n+    public NAPresenceCameraHandler(final Thing thing, final TimeZoneProvider timeZoneProvider) {\n+        super(thing, timeZoneProvider);\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        String channelId = channelUID.getId();\n+        switch (channelId) {\n+            case CHANNEL_CAMERA_FLOODLIGHT:\n+                if(OnOffType.ON.equals(command)) {\n+                    switchFloodlight(true);\n+                } else if(OnOffType.OFF.equals(command)) {\n+                    switchFloodlight(false);\n+                }\n+                break;\n+            case CHANNEL_CAMERA_FLOODLIGHT_AUTO_MODE:\n+                if(OnOffType.ON.equals(command)) {\n+                    switchFloodlightAutoMode(true);\n+                } else if(OnOffType.OFF.equals(command)) {\n+                    switchFloodlightAutoMode(false);\n+                }\n+                break;\n+        }\n+        super.handleCommand(channelUID, command);\n+    }\n+\n+    @Override\n+    protected State getNAThingProperty(@NonNull String channelId) {\n+        switch (channelId) {\n+            case CHANNEL_CAMERA_FLOODLIGHT:\n+                return getFloodlightState();\n+            case CHANNEL_CAMERA_FLOODLIGHT_AUTO_MODE:\n+                //The auto-mode state shouldn't be updated, because this isn't a dedicated information. When the\n+                // floodlight is switched on the state within the Netatmo API is \"on\" and the information if the previous\n+                // state was \"auto\" instead of \"off\" is lost... Therefore the binding handles its own auto-mode state.\n+                if(UnDefType.UNDEF.equals(floodlightAutoModeState)) {\n+                    floodlightAutoModeState = getFloodlightAutoModeState();\n+                }\n+                return floodlightAutoModeState;\n+        }\n+        return super.getNAThingProperty(channelId);\n+    }\n+\n+    private State getFloodlightState() {\n+        if (module != null) {\n+            final boolean isOn = NAWelcomeCamera.LightModeStatusEnum.ON.equals(module.getLightModeStatus());\n+            return toOnOffType(isOn);\n+        }\n+        return UnDefType.UNDEF;\n+    }\n+\n+    private State getFloodlightAutoModeState() {\n+        if (module != null) {\n+            return toOnOffType(NAWelcomeCamera.LightModeStatusEnum.AUTO.equals(module.getLightModeStatus()));\n+        }\n+        return UnDefType.UNDEF;\n+    }\n+\n+    private void switchFloodlight(boolean isOn) {\n+        if (isOn) {\n+            changeFloodlightMode(NAWelcomeCamera.LightModeStatusEnum.ON);\n+        } else {\n+            switchFloodlightAutoMode(OnOffType.ON.equals(floodlightAutoModeState));\n+        }\n+    }\n+\n+    private void switchFloodlightAutoMode(boolean isAutoMode) {\n+        floodlightAutoModeState = toOnOffType(isAutoMode);\n+        if (isAutoMode) {\n+            changeFloodlightMode(NAWelcomeCamera.LightModeStatusEnum.AUTO);\n+        } else {\n+            changeFloodlightMode(NAWelcomeCamera.LightModeStatusEnum.OFF);\n+        }\n+    }\n+\n+    private void changeFloodlightMode(NAWelcomeCamera.LightModeStatusEnum mode) {\n+        Optional<String> localCameraURL = getLocalCameraURL();\n+        if (localCameraURL.isPresent()) {\n+            String url = localCameraURL.get()\n+                    + FLOODLIGHT_SET_URL_PATH\n+                    + \"?config=%7B%22mode%22:%22\"\n+                    + mode.toString()\n+                    + \"%22%7D\";\n+            executeGETRequest(url);\n+        }\n+    }\n+\n+    private Optional<String> getLocalCameraURL() {\n+        String vpnURL = getVpnUrl();\n+        if (vpnURL != null) {\n+            //The local address is (re-)requested when it wasn't already determined or when the vpn address was changed.\n+            if (!cameraAddress.isPresent() || cameraAddress.get().isVpnURLChanged(vpnURL)) {\n+                Optional<JSONObject> json = executeGETRequestJSON(vpnURL + PING_URL_PATH);\n+                cameraAddress = json.map(j -> j.getString(\"local_url\"))\n+                        .map(localURL -> new CameraAddress(vpnURL, localURL));\n+            }\n+        }\n+        return cameraAddress.map(CameraAddress::getLocalURL);\n+    }\n+\n+    private Optional<JSONObject> executeGETRequestJSON(String url) {\n+        Optional<JSONObject> jsonContent = executeGETRequest(url).map(JSONObject::new);\n+        if(!jsonContent.isPresent()) {\n+            logger.error(\"The request-result could not get retrieved!\");", "originalCommit": "dde518f9e8701b767bf71e9afe380d03e90221b3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTExNDQyOA==", "url": "https://github.com/openhab/openhab-addons/pull/7927#discussion_r441114428", "bodyText": "Ok, I have now refactored the Exception handling and logging a bit, this line doesn't exist anymore.\nDone.", "author": "Novanic", "createdAt": "2020-06-16T20:13:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA0NzcwMA=="}], "type": "inlineReview"}, {"oid": "c5e07d1edfeb6ff12fc31b3f6d2b84d754ddc46d", "url": "https://github.com/openhab/openhab-addons/commit/c5e07d1edfeb6ff12fc31b3f6d2b84d754ddc46d", "message": "Exception handling and logging corrected\n\nSigned-off-by: Sven Strohschein <sven.strohschein@gmail.com>", "committedDate": "2020-06-16T20:15:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE4MTI2NQ==", "url": "https://github.com/openhab/openhab-addons/pull/7927#discussion_r441181265", "bodyText": "Using getString with throw an exception if it fails to find anything at that field name, use optString instead so it will return null.", "author": "cpmeister", "createdAt": "2020-06-16T22:39:12Z", "path": "bundles/org.openhab.binding.netatmo/src/main/java/org/openhab/binding/netatmo/internal/presence/NAPresenceCameraHandler.java", "diffHunk": "@@ -0,0 +1,176 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.netatmo.internal.presence;\n+\n+import static org.openhab.binding.netatmo.internal.ChannelTypeUtils.toOnOffType;\n+\n+import io.swagger.client.model.NAWelcomeCamera;\n+import org.eclipse.jdt.annotation.NonNull;\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.smarthome.core.i18n.TimeZoneProvider;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.State;\n+import org.eclipse.smarthome.core.types.UnDefType;\n+import org.eclipse.smarthome.io.net.http.HttpUtil;\n+import org.json.JSONException;\n+import org.json.JSONObject;\n+import org.openhab.binding.netatmo.internal.camera.CameraHandler;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.IOException;\n+import java.util.Optional;\n+\n+import static org.openhab.binding.netatmo.internal.NetatmoBindingConstants.CHANNEL_CAMERA_FLOODLIGHT;\n+import static org.openhab.binding.netatmo.internal.NetatmoBindingConstants.CHANNEL_CAMERA_FLOODLIGHT_AUTO_MODE;\n+\n+/**\n+ * {@link NAPresenceCameraHandler} is the class used to handle Presence camera data\n+ *\n+ * @author Sven Strohschein\n+ */\n+@NonNullByDefault\n+public class NAPresenceCameraHandler extends CameraHandler {\n+\n+    private static final String PING_URL_PATH = \"/command/ping\";\n+    private static final String FLOODLIGHT_SET_URL_PATH = \"/command/floodlight_set_config\";\n+\n+    private final Logger logger = LoggerFactory.getLogger(NAPresenceCameraHandler.class);\n+\n+    private Optional<CameraAddress> cameraAddress = Optional.empty();\n+    private State floodlightAutoModeState = UnDefType.UNDEF;\n+\n+    public NAPresenceCameraHandler(final Thing thing, final TimeZoneProvider timeZoneProvider) {\n+        super(thing, timeZoneProvider);\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        String channelId = channelUID.getId();\n+        switch (channelId) {\n+            case CHANNEL_CAMERA_FLOODLIGHT:\n+                if (OnOffType.ON.equals(command)) {\n+                    switchFloodlight(true);\n+                } else if (OnOffType.OFF.equals(command)) {\n+                    switchFloodlight(false);\n+                }\n+                break;\n+            case CHANNEL_CAMERA_FLOODLIGHT_AUTO_MODE:\n+                if (OnOffType.ON.equals(command)) {\n+                    switchFloodlightAutoMode(true);\n+                } else if (OnOffType.OFF.equals(command)) {\n+                    switchFloodlightAutoMode(false);\n+                }\n+                break;\n+        }\n+        super.handleCommand(channelUID, command);\n+    }\n+\n+    @Override\n+    protected State getNAThingProperty(@NonNull String channelId) {\n+        switch (channelId) {\n+            case CHANNEL_CAMERA_FLOODLIGHT:\n+                return getFloodlightState();\n+            case CHANNEL_CAMERA_FLOODLIGHT_AUTO_MODE:\n+                //The auto-mode state shouldn't be updated, because this isn't a dedicated information. When the\n+                // floodlight is switched on the state within the Netatmo API is \"on\" and the information if the previous\n+                // state was \"auto\" instead of \"off\" is lost... Therefore the binding handles its own auto-mode state.\n+                if (UnDefType.UNDEF.equals(floodlightAutoModeState)) {\n+                    floodlightAutoModeState = getFloodlightAutoModeState();\n+                }\n+                return floodlightAutoModeState;\n+        }\n+        return super.getNAThingProperty(channelId);\n+    }\n+\n+    private State getFloodlightState() {\n+        if (module != null) {\n+            final boolean isOn = NAWelcomeCamera.LightModeStatusEnum.ON.equals(module.getLightModeStatus());\n+            return toOnOffType(isOn);\n+        }\n+        return UnDefType.UNDEF;\n+    }\n+\n+    private State getFloodlightAutoModeState() {\n+        if (module != null) {\n+            return toOnOffType(NAWelcomeCamera.LightModeStatusEnum.AUTO.equals(module.getLightModeStatus()));\n+        }\n+        return UnDefType.UNDEF;\n+    }\n+\n+    private void switchFloodlight(boolean isOn) {\n+        if (isOn) {\n+            changeFloodlightMode(NAWelcomeCamera.LightModeStatusEnum.ON);\n+        } else {\n+            switchFloodlightAutoMode(OnOffType.ON.equals(floodlightAutoModeState));\n+        }\n+    }\n+\n+    private void switchFloodlightAutoMode(boolean isAutoMode) {\n+        floodlightAutoModeState = toOnOffType(isAutoMode);\n+        if (isAutoMode) {\n+            changeFloodlightMode(NAWelcomeCamera.LightModeStatusEnum.AUTO);\n+        } else {\n+            changeFloodlightMode(NAWelcomeCamera.LightModeStatusEnum.OFF);\n+        }\n+    }\n+\n+    private void changeFloodlightMode(NAWelcomeCamera.LightModeStatusEnum mode) {\n+        Optional<String> localCameraURL = getLocalCameraURL();\n+        if (localCameraURL.isPresent()) {\n+            String url = localCameraURL.get()\n+                    + FLOODLIGHT_SET_URL_PATH\n+                    + \"?config=%7B%22mode%22:%22\"\n+                    + mode.toString()\n+                    + \"%22%7D\";\n+            executeGETRequest(url);\n+        }\n+    }\n+\n+    private Optional<String> getLocalCameraURL() {\n+        String vpnURL = getVpnUrl();\n+        if (vpnURL != null) {\n+            //The local address is (re-)requested when it wasn't already determined or when the vpn address was changed.\n+            if (!cameraAddress.isPresent() || cameraAddress.get().isVpnURLChanged(vpnURL)) {\n+                Optional<JSONObject> json = executeGETRequestJSON(vpnURL + PING_URL_PATH);\n+                cameraAddress = json.map(j -> j.getString(\"local_url\"))\n+                        .map(localURL -> new CameraAddress(vpnURL, localURL));", "originalCommit": "c5e07d1edfeb6ff12fc31b3f6d2b84d754ddc46d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTcyODM4MA==", "url": "https://github.com/openhab/openhab-addons/pull/7927#discussion_r441728380", "bodyText": "Good argument and solution. Thank you.\nIt is now fixed.", "author": "Novanic", "createdAt": "2020-06-17T17:59:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE4MTI2NQ=="}], "type": "inlineReview"}, {"oid": "321d021f63e3f3387fc67df4da16388b4a3f64e3", "url": "https://github.com/openhab/openhab-addons/commit/321d021f63e3f3387fc67df4da16388b4a3f64e3", "message": "Potential crash fixed which could occur when a wrong JSON response is returned by the ping command request (when it is a valid JSON but without the expected attribute \"local_url\").\n\nSigned-off-by: Sven Strohschein <sven.strohschein@gmail.com>", "committedDate": "2020-06-17T17:57:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MTE5MA==", "url": "https://github.com/openhab/openhab-addons/pull/7927#discussion_r441741190", "bodyText": "== OnOffType.ON could rather ne used I think.", "author": "lolodomo", "createdAt": "2020-06-17T18:21:59Z", "path": "bundles/org.openhab.binding.netatmo/src/main/java/org/openhab/binding/netatmo/internal/presence/NAPresenceCameraHandler.java", "diffHunk": "@@ -0,0 +1,176 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.netatmo.internal.presence;\n+\n+import static org.openhab.binding.netatmo.internal.ChannelTypeUtils.toOnOffType;\n+\n+import io.swagger.client.model.NAWelcomeCamera;\n+import org.eclipse.jdt.annotation.NonNull;\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.smarthome.core.i18n.TimeZoneProvider;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.State;\n+import org.eclipse.smarthome.core.types.UnDefType;\n+import org.eclipse.smarthome.io.net.http.HttpUtil;\n+import org.json.JSONException;\n+import org.json.JSONObject;\n+import org.openhab.binding.netatmo.internal.camera.CameraHandler;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.IOException;\n+import java.util.Optional;\n+\n+import static org.openhab.binding.netatmo.internal.NetatmoBindingConstants.CHANNEL_CAMERA_FLOODLIGHT;\n+import static org.openhab.binding.netatmo.internal.NetatmoBindingConstants.CHANNEL_CAMERA_FLOODLIGHT_AUTO_MODE;\n+\n+/**\n+ * {@link NAPresenceCameraHandler} is the class used to handle Presence camera data\n+ *\n+ * @author Sven Strohschein\n+ */\n+@NonNullByDefault\n+public class NAPresenceCameraHandler extends CameraHandler {\n+\n+    private static final String PING_URL_PATH = \"/command/ping\";\n+    private static final String FLOODLIGHT_SET_URL_PATH = \"/command/floodlight_set_config\";\n+\n+    private final Logger logger = LoggerFactory.getLogger(NAPresenceCameraHandler.class);\n+\n+    private Optional<CameraAddress> cameraAddress = Optional.empty();\n+    private State floodlightAutoModeState = UnDefType.UNDEF;\n+\n+    public NAPresenceCameraHandler(final Thing thing, final TimeZoneProvider timeZoneProvider) {\n+        super(thing, timeZoneProvider);\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        String channelId = channelUID.getId();\n+        switch (channelId) {\n+            case CHANNEL_CAMERA_FLOODLIGHT:\n+                if (OnOffType.ON.equals(command)) {", "originalCommit": "321d021f63e3f3387fc67df4da16388b4a3f64e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM5MjYwMw==", "url": "https://github.com/openhab/openhab-addons/pull/7927#discussion_r442392603", "bodyText": "I don't prefer and wouldn't recommend it, because this can get easily broken without a notice, for example when someone refactors the enum to a class with constants or when a new version of the swagger generator doesn't generate enums anymore. The usages aren't broken but at runtime it would not work anymore. An it's hard to find these usages because you can't search type-safe for \"==\" within big code bases.\nBut I changed it... ;-)\nDone.", "author": "Novanic", "createdAt": "2020-06-18T17:35:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MTE5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MTQyNg==", "url": "https://github.com/openhab/openhab-addons/pull/7927#discussion_r441741426", "bodyText": "Same", "author": "lolodomo", "createdAt": "2020-06-17T18:22:25Z", "path": "bundles/org.openhab.binding.netatmo/src/main/java/org/openhab/binding/netatmo/internal/presence/NAPresenceCameraHandler.java", "diffHunk": "@@ -0,0 +1,176 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.netatmo.internal.presence;\n+\n+import static org.openhab.binding.netatmo.internal.ChannelTypeUtils.toOnOffType;\n+\n+import io.swagger.client.model.NAWelcomeCamera;\n+import org.eclipse.jdt.annotation.NonNull;\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.smarthome.core.i18n.TimeZoneProvider;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.State;\n+import org.eclipse.smarthome.core.types.UnDefType;\n+import org.eclipse.smarthome.io.net.http.HttpUtil;\n+import org.json.JSONException;\n+import org.json.JSONObject;\n+import org.openhab.binding.netatmo.internal.camera.CameraHandler;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.IOException;\n+import java.util.Optional;\n+\n+import static org.openhab.binding.netatmo.internal.NetatmoBindingConstants.CHANNEL_CAMERA_FLOODLIGHT;\n+import static org.openhab.binding.netatmo.internal.NetatmoBindingConstants.CHANNEL_CAMERA_FLOODLIGHT_AUTO_MODE;\n+\n+/**\n+ * {@link NAPresenceCameraHandler} is the class used to handle Presence camera data\n+ *\n+ * @author Sven Strohschein\n+ */\n+@NonNullByDefault\n+public class NAPresenceCameraHandler extends CameraHandler {\n+\n+    private static final String PING_URL_PATH = \"/command/ping\";\n+    private static final String FLOODLIGHT_SET_URL_PATH = \"/command/floodlight_set_config\";\n+\n+    private final Logger logger = LoggerFactory.getLogger(NAPresenceCameraHandler.class);\n+\n+    private Optional<CameraAddress> cameraAddress = Optional.empty();\n+    private State floodlightAutoModeState = UnDefType.UNDEF;\n+\n+    public NAPresenceCameraHandler(final Thing thing, final TimeZoneProvider timeZoneProvider) {\n+        super(thing, timeZoneProvider);\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        String channelId = channelUID.getId();\n+        switch (channelId) {\n+            case CHANNEL_CAMERA_FLOODLIGHT:\n+                if (OnOffType.ON.equals(command)) {\n+                    switchFloodlight(true);\n+                } else if (OnOffType.OFF.equals(command)) {", "originalCommit": "321d021f63e3f3387fc67df4da16388b4a3f64e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM5Mjc1Nw==", "url": "https://github.com/openhab/openhab-addons/pull/7927#discussion_r442392757", "bodyText": "Done.", "author": "Novanic", "createdAt": "2020-06-18T17:35:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MTQyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MTY5Mg==", "url": "https://github.com/openhab/openhab-addons/pull/7927#discussion_r441741692", "bodyText": "Same", "author": "lolodomo", "createdAt": "2020-06-17T18:22:57Z", "path": "bundles/org.openhab.binding.netatmo/src/main/java/org/openhab/binding/netatmo/internal/presence/NAPresenceCameraHandler.java", "diffHunk": "@@ -0,0 +1,176 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.netatmo.internal.presence;\n+\n+import static org.openhab.binding.netatmo.internal.ChannelTypeUtils.toOnOffType;\n+\n+import io.swagger.client.model.NAWelcomeCamera;\n+import org.eclipse.jdt.annotation.NonNull;\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.smarthome.core.i18n.TimeZoneProvider;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.State;\n+import org.eclipse.smarthome.core.types.UnDefType;\n+import org.eclipse.smarthome.io.net.http.HttpUtil;\n+import org.json.JSONException;\n+import org.json.JSONObject;\n+import org.openhab.binding.netatmo.internal.camera.CameraHandler;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.IOException;\n+import java.util.Optional;\n+\n+import static org.openhab.binding.netatmo.internal.NetatmoBindingConstants.CHANNEL_CAMERA_FLOODLIGHT;\n+import static org.openhab.binding.netatmo.internal.NetatmoBindingConstants.CHANNEL_CAMERA_FLOODLIGHT_AUTO_MODE;\n+\n+/**\n+ * {@link NAPresenceCameraHandler} is the class used to handle Presence camera data\n+ *\n+ * @author Sven Strohschein\n+ */\n+@NonNullByDefault\n+public class NAPresenceCameraHandler extends CameraHandler {\n+\n+    private static final String PING_URL_PATH = \"/command/ping\";\n+    private static final String FLOODLIGHT_SET_URL_PATH = \"/command/floodlight_set_config\";\n+\n+    private final Logger logger = LoggerFactory.getLogger(NAPresenceCameraHandler.class);\n+\n+    private Optional<CameraAddress> cameraAddress = Optional.empty();\n+    private State floodlightAutoModeState = UnDefType.UNDEF;\n+\n+    public NAPresenceCameraHandler(final Thing thing, final TimeZoneProvider timeZoneProvider) {\n+        super(thing, timeZoneProvider);\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        String channelId = channelUID.getId();\n+        switch (channelId) {\n+            case CHANNEL_CAMERA_FLOODLIGHT:\n+                if (OnOffType.ON.equals(command)) {\n+                    switchFloodlight(true);\n+                } else if (OnOffType.OFF.equals(command)) {\n+                    switchFloodlight(false);\n+                }\n+                break;\n+            case CHANNEL_CAMERA_FLOODLIGHT_AUTO_MODE:\n+                if (OnOffType.ON.equals(command)) {", "originalCommit": "321d021f63e3f3387fc67df4da16388b4a3f64e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM5MjgxMA==", "url": "https://github.com/openhab/openhab-addons/pull/7927#discussion_r442392810", "bodyText": "Done.", "author": "Novanic", "createdAt": "2020-06-18T17:35:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MTY5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MTg5Mg==", "url": "https://github.com/openhab/openhab-addons/pull/7927#discussion_r441741892", "bodyText": "Same", "author": "lolodomo", "createdAt": "2020-06-17T18:23:20Z", "path": "bundles/org.openhab.binding.netatmo/src/main/java/org/openhab/binding/netatmo/internal/presence/NAPresenceCameraHandler.java", "diffHunk": "@@ -0,0 +1,176 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.netatmo.internal.presence;\n+\n+import static org.openhab.binding.netatmo.internal.ChannelTypeUtils.toOnOffType;\n+\n+import io.swagger.client.model.NAWelcomeCamera;\n+import org.eclipse.jdt.annotation.NonNull;\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.smarthome.core.i18n.TimeZoneProvider;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.State;\n+import org.eclipse.smarthome.core.types.UnDefType;\n+import org.eclipse.smarthome.io.net.http.HttpUtil;\n+import org.json.JSONException;\n+import org.json.JSONObject;\n+import org.openhab.binding.netatmo.internal.camera.CameraHandler;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.IOException;\n+import java.util.Optional;\n+\n+import static org.openhab.binding.netatmo.internal.NetatmoBindingConstants.CHANNEL_CAMERA_FLOODLIGHT;\n+import static org.openhab.binding.netatmo.internal.NetatmoBindingConstants.CHANNEL_CAMERA_FLOODLIGHT_AUTO_MODE;\n+\n+/**\n+ * {@link NAPresenceCameraHandler} is the class used to handle Presence camera data\n+ *\n+ * @author Sven Strohschein\n+ */\n+@NonNullByDefault\n+public class NAPresenceCameraHandler extends CameraHandler {\n+\n+    private static final String PING_URL_PATH = \"/command/ping\";\n+    private static final String FLOODLIGHT_SET_URL_PATH = \"/command/floodlight_set_config\";\n+\n+    private final Logger logger = LoggerFactory.getLogger(NAPresenceCameraHandler.class);\n+\n+    private Optional<CameraAddress> cameraAddress = Optional.empty();\n+    private State floodlightAutoModeState = UnDefType.UNDEF;\n+\n+    public NAPresenceCameraHandler(final Thing thing, final TimeZoneProvider timeZoneProvider) {\n+        super(thing, timeZoneProvider);\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        String channelId = channelUID.getId();\n+        switch (channelId) {\n+            case CHANNEL_CAMERA_FLOODLIGHT:\n+                if (OnOffType.ON.equals(command)) {\n+                    switchFloodlight(true);\n+                } else if (OnOffType.OFF.equals(command)) {\n+                    switchFloodlight(false);\n+                }\n+                break;\n+            case CHANNEL_CAMERA_FLOODLIGHT_AUTO_MODE:\n+                if (OnOffType.ON.equals(command)) {\n+                    switchFloodlightAutoMode(true);\n+                } else if (OnOffType.OFF.equals(command)) {", "originalCommit": "321d021f63e3f3387fc67df4da16388b4a3f64e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM5Mjg3NQ==", "url": "https://github.com/openhab/openhab-addons/pull/7927#discussion_r442392875", "bodyText": "Done.", "author": "Novanic", "createdAt": "2020-06-18T17:35:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MTg5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MjcxMw==", "url": "https://github.com/openhab/openhab-addons/pull/7927#discussion_r441742713", "bodyText": "== could be used rather than equals", "author": "lolodomo", "createdAt": "2020-06-17T18:24:52Z", "path": "bundles/org.openhab.binding.netatmo/src/main/java/org/openhab/binding/netatmo/internal/presence/NAPresenceCameraHandler.java", "diffHunk": "@@ -0,0 +1,176 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.netatmo.internal.presence;\n+\n+import static org.openhab.binding.netatmo.internal.ChannelTypeUtils.toOnOffType;\n+\n+import io.swagger.client.model.NAWelcomeCamera;\n+import org.eclipse.jdt.annotation.NonNull;\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.smarthome.core.i18n.TimeZoneProvider;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.State;\n+import org.eclipse.smarthome.core.types.UnDefType;\n+import org.eclipse.smarthome.io.net.http.HttpUtil;\n+import org.json.JSONException;\n+import org.json.JSONObject;\n+import org.openhab.binding.netatmo.internal.camera.CameraHandler;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.IOException;\n+import java.util.Optional;\n+\n+import static org.openhab.binding.netatmo.internal.NetatmoBindingConstants.CHANNEL_CAMERA_FLOODLIGHT;\n+import static org.openhab.binding.netatmo.internal.NetatmoBindingConstants.CHANNEL_CAMERA_FLOODLIGHT_AUTO_MODE;\n+\n+/**\n+ * {@link NAPresenceCameraHandler} is the class used to handle Presence camera data\n+ *\n+ * @author Sven Strohschein\n+ */\n+@NonNullByDefault\n+public class NAPresenceCameraHandler extends CameraHandler {\n+\n+    private static final String PING_URL_PATH = \"/command/ping\";\n+    private static final String FLOODLIGHT_SET_URL_PATH = \"/command/floodlight_set_config\";\n+\n+    private final Logger logger = LoggerFactory.getLogger(NAPresenceCameraHandler.class);\n+\n+    private Optional<CameraAddress> cameraAddress = Optional.empty();\n+    private State floodlightAutoModeState = UnDefType.UNDEF;\n+\n+    public NAPresenceCameraHandler(final Thing thing, final TimeZoneProvider timeZoneProvider) {\n+        super(thing, timeZoneProvider);\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        String channelId = channelUID.getId();\n+        switch (channelId) {\n+            case CHANNEL_CAMERA_FLOODLIGHT:\n+                if (OnOffType.ON.equals(command)) {\n+                    switchFloodlight(true);\n+                } else if (OnOffType.OFF.equals(command)) {\n+                    switchFloodlight(false);\n+                }\n+                break;\n+            case CHANNEL_CAMERA_FLOODLIGHT_AUTO_MODE:\n+                if (OnOffType.ON.equals(command)) {\n+                    switchFloodlightAutoMode(true);\n+                } else if (OnOffType.OFF.equals(command)) {\n+                    switchFloodlightAutoMode(false);\n+                }\n+                break;\n+        }\n+        super.handleCommand(channelUID, command);\n+    }\n+\n+    @Override\n+    protected State getNAThingProperty(@NonNull String channelId) {\n+        switch (channelId) {\n+            case CHANNEL_CAMERA_FLOODLIGHT:\n+                return getFloodlightState();\n+            case CHANNEL_CAMERA_FLOODLIGHT_AUTO_MODE:\n+                //The auto-mode state shouldn't be updated, because this isn't a dedicated information. When the\n+                // floodlight is switched on the state within the Netatmo API is \"on\" and the information if the previous\n+                // state was \"auto\" instead of \"off\" is lost... Therefore the binding handles its own auto-mode state.\n+                if (UnDefType.UNDEF.equals(floodlightAutoModeState)) {", "originalCommit": "321d021f63e3f3387fc67df4da16388b4a3f64e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM5Mjk1NQ==", "url": "https://github.com/openhab/openhab-addons/pull/7927#discussion_r442392955", "bodyText": "Done.", "author": "Novanic", "createdAt": "2020-06-18T17:35:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MjcxMw=="}], "type": "inlineReview"}, {"oid": "16e8f154612e097fb0c099c16ce6d54cc025a8b1", "url": "https://github.com/openhab/openhab-addons/commit/16e8f154612e097fb0c099c16ce6d54cc025a8b1", "message": "Code optimization (from code-review)\n\nSigned-off-by: Sven Strohschein <sven.strohschein@gmail.com>", "committedDate": "2020-06-18T17:30:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQzOTk4MA==", "url": "https://github.com/openhab/openhab-addons/pull/7927#discussion_r442439980", "bodyText": "I might have merged too quickly, but just to double check, I don't see you changing NAWelcomeCameraHandler to extend CameraHandler. Was that supposed to be done?", "author": "cpmeister", "createdAt": "2020-06-18T19:02:23Z", "path": "bundles/org.openhab.binding.netatmo/src/main/java/org/openhab/binding/netatmo/internal/welcome/NAWelcomeHomeHandler.java", "diffHunk": "@@ -145,7 +146,7 @@ protected State getNAThingProperty(String channelId) {\n                     String cameraId = lastEvent.get().getCameraId();\n                     Optional<AbstractNetatmoThingHandler> thing = getBridgeHandler().findNAThing(cameraId);\n                     if (thing.isPresent()) {\n-                        NAWelcomeCameraHandler eventCamera = (NAWelcomeCameraHandler) thing.get();\n+                        CameraHandler eventCamera = (CameraHandler) thing.get();", "originalCommit": "16e8f154612e097fb0c099c16ce6d54cc025a8b1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ0MjkwNg==", "url": "https://github.com/openhab/openhab-addons/pull/7927#discussion_r442442906", "bodyText": "Yes, that is fine. I introduced CameraHandler with a previous pull-request and NAWelcomeCameraHandler and NAPresenceCameraHandler are extending from CameraHandler. It was rather a bug that there was still casted to NAWelcomeCameraHandler (but it was no problem so far, because the Presence was also represented as a NAWelcomeCamera until this new pull-request).", "author": "Novanic", "createdAt": "2020-06-18T19:08:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQzOTk4MA=="}], "type": "inlineReview"}]}