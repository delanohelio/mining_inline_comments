{"pr_number": 6764, "pr_title": "[shelly]Enhancements and bug fixes", "pr_createdAt": "2020-01-05T03:47:46Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/6764", "timeline": [{"oid": "2dc615158829426aa79440aa7443cdc54d332633", "url": "https://github.com/openhab/openhab-addons/commit/2dc615158829426aa79440aa7443cdc54d332633", "message": "This is derived from PR #6592 - to get a clean status I open ths new\nPR\n\nSigned-off-by: markus7017 <markus7017@gmail.com>", "committedDate": "2020-01-05T03:10:12Z", "type": "commit"}, {"oid": "4b2eb431baee9fa1ee22ad1ac04fc777b8ef83d8", "url": "https://github.com/openhab/openhab-addons/commit/4b2eb431baee9fa1ee22ad1ac04fc777b8ef83d8", "message": "Adapted to 2.5.1-SNAPSHOT\n\nSigned-off-by: markus7017 <markus7017@gmail.com>", "committedDate": "2020-01-05T04:18:10Z", "type": "commit"}, {"oid": "5f35a909d05d75716c7bc0dfb2eb3b15173f4ec4", "url": "https://github.com/openhab/openhab-addons/commit/5f35a909d05d75716c7bc0dfb2eb3b15173f4ec4", "message": "Remove brightsnessAutoOn from non-light things; PREPARING 2.5.1 final\n\nSigned-off-by: markus7017 <markus7017@gmail.com>", "committedDate": "2020-01-05T23:03:54Z", "type": "commit"}, {"oid": "8a59b40c1e4a82eecbb9348ab5e917ac67e66af5", "url": "https://github.com/openhab/openhab-addons/commit/8a59b40c1e4a82eecbb9348ab5e917ac67e66af5", "message": "doc/* removed\n\nSigned-off-by: markus7017 <markus7017@gmail.com>", "committedDate": "2020-01-07T12:39:52Z", "type": "commit"}, {"oid": "6a0e327767f8abdc1f902dbfc6666a0d754410d8", "url": "https://github.com/openhab/openhab-addons/commit/6a0e327767f8abdc1f902dbfc6666a0d754410d8", "message": "Merge branch '2.5.x' of https://github.com/openhab/openhab-addons.git into 2.5.x", "committedDate": "2020-01-07T13:34:27Z", "type": "commit"}, {"oid": "e7fd54e0ac4fd03ddbba43e9479d77b95833497a", "url": "https://github.com/openhab/openhab-addons/commit/e7fd54e0ac4fd03ddbba43e9479d77b95833497a", "message": "FTR #6879: Temp sensors for Shelly 1/1PM added\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2020-01-24T19:45:17Z", "type": "commit"}, {"oid": "aa7837f9acdbe57eed3ba0fbec7447f3751de2f5", "url": "https://github.com/openhab/openhab-addons/commit/aa7837f9acdbe57eed3ba0fbec7447f3751de2f5", "message": "Merge branch '2.5.x' of https://github.com/openhab/openhab-addons into 2.5.x", "committedDate": "2020-01-24T19:49:08Z", "type": "commit"}, {"oid": "ac313446ba35c44e2f137029350aede2122e8d8a", "url": "https://github.com/openhab/openhab-addons/commit/ac313446ba35c44e2f137029350aede2122e8d8a", "message": "fixed\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2020-01-24T20:11:01Z", "type": "commit"}, {"oid": "c264a364f7a279e098dbc80c9342af786ad52dbb", "url": "https://github.com/openhab/openhab-addons/commit/c264a364f7a279e098dbc80c9342af786ad52dbb", "message": "adapted to 2.5.2\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2020-01-24T20:14:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk1NDMzOA==", "url": "https://github.com/openhab/openhab-addons/pull/6764#discussion_r370954338", "bodyText": "Why did you remove this line?", "author": "kaikreuzer", "createdAt": "2020-01-25T20:32:25Z", "path": "bundles/org.openhab.binding.shelly/src/main/java/org/openhab/binding/shelly/internal/handler/ShellyBaseHandler.java", "diffHunk": "@@ -116,7 +118,6 @@ public ShellyBaseHandler(Thing thing, ShellyBindingConfiguration bindingConfig,\n      */\n     @Override\n     public void initialize() {\n-        updateStatus(ThingStatus.UNKNOWN);", "originalCommit": "c264a364f7a279e098dbc80c9342af786ad52dbb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTAyNTU5MA==", "url": "https://github.com/openhab/openhab-addons/pull/6764#discussion_r371025590", "bodyText": "I keep the status INITIALIZING until the device is fully initialized. For non-battery devices this will be done with the next status update, for battery-powered devices this could take longer until the device wakes up. UNKOWN sounds like an error, even I now that the device is not yet initialized", "author": "markus7017", "createdAt": "2020-01-26T20:01:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk1NDMzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM2MjIyMA==", "url": "https://github.com/openhab/openhab-addons/pull/6764#discussion_r371362220", "bodyText": "I am pretty sure that we discussed this before (when adding that line), but I can certainly again point you to the developer docs: https://github.com/openhab/openhab-core/blob/master/tools/archetype/binding/src/main/resources/archetype-resources/src/main/java/internal/__bindingIdCamelCase__Handler.java#L69-L79", "author": "kaikreuzer", "createdAt": "2020-01-27T16:58:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk1NDMzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA5MTgxMw==", "url": "https://github.com/openhab/openhab-addons/pull/6764#discussion_r372091813", "bodyText": "ok, will be changed", "author": "markus7017", "createdAt": "2020-01-28T22:21:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk1NDMzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE5NTAzMA==", "url": "https://github.com/openhab/openhab-addons/pull/6764#discussion_r373195030", "bodyText": "I don't see any change?", "author": "kaikreuzer", "createdAt": "2020-01-30T21:10:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk1NDMzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg4MDI4MA==", "url": "https://github.com/openhab/openhab-addons/pull/6764#discussion_r373880280", "bodyText": "done", "author": "markus7017", "createdAt": "2020-02-02T22:22:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk1NDMzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk1NDQxNg==", "url": "https://github.com/openhab/openhab-addons/pull/6764#discussion_r370954416", "bodyText": "Why did you remove the message from the Thing status? The Thing status is the correct place for it.", "author": "kaikreuzer", "createdAt": "2020-01-25T20:34:02Z", "path": "bundles/org.openhab.binding.shelly/src/main/java/org/openhab/binding/shelly/internal/handler/ShellyBaseHandler.java", "diffHunk": "@@ -228,13 +235,14 @@ private void initializeThing() throws IOException {\n         profile = tmpPrf; // all initialization done, so keep the profile\n \n         // Validate device mode\n-        String thingType = getThing().getThingTypeUID().getId();\n         String reqMode = thingType.contains(\"-\") ? StringUtils.substringAfter(thingType, \"-\") : \"\";\n         if (!reqMode.isEmpty() && !tmpPrf.mode.equals(reqMode)) {\n+            logger.info(", "originalCommit": "c264a364f7a279e098dbc80c9342af786ad52dbb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTAzMTU0MQ==", "url": "https://github.com/openhab/openhab-addons/pull/6764#discussion_r371031541", "bodyText": "My understanding is that\nupdateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n\"@text/offline.conf-error-wrong-mode\")\npulls up the language resource \"offline.conf-error-wrong-mode\" to get this messages from shelly_de.properties/shelly.properties. Isn't it this the case?\nSo a info message goes to the log and the thing status gets updated with the genral message - or is there a way to pass parameters to the messages retrived from the properties file?", "author": "markus7017", "createdAt": "2020-01-26T21:42:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk1NDQxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM2NDQ2MQ==", "url": "https://github.com/openhab/openhab-addons/pull/6764#discussion_r371364461", "bodyText": "is there a way to pass parameters to the messages retrived from the properties file?\n\nThere is, see https://www.openhab.org/docs/developer/utils/i18n.html#i18n-text-provider-api.", "author": "kaikreuzer", "createdAt": "2020-01-27T17:02:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk1NDQxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzk1NDY3Mw==", "url": "https://github.com/openhab/openhab-addons/pull/6764#discussion_r373954673", "bodyText": "ok, I figured out the i18nProvider stuff, but how to format the message in the properties file to inject parameters?", "author": "markus7017", "createdAt": "2020-02-03T07:36:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk1NDQxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg1OTAzNg==", "url": "https://github.com/openhab/openhab-addons/pull/6764#discussion_r374859036", "bodyText": "@kaikreuzer could you point me to the solution?", "author": "markus7017", "createdAt": "2020-02-04T18:54:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk1NDQxNg=="}], "type": "inlineReview"}, {"oid": "605b05e68114f3b336417018ffd6dc862dd0a7d1", "url": "https://github.com/openhab/openhab-addons/commit/605b05e68114f3b336417018ffd6dc862dd0a7d1", "message": "Change requests from PR review; #6949 Fix for color updates via Coap;\nFix for #6950 Updating input states via Coap - both fixes need to be\nverified.\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2020-02-01T13:54:33Z", "type": "commit"}, {"oid": "9b0f00ba7c7c099146f391c4b968ef97f09b4939", "url": "https://github.com/openhab/openhab-addons/commit/9b0f00ba7c7c099146f391c4b968ef97f09b4939", "message": "property updated fixed\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2020-02-01T20:17:54Z", "type": "commit"}, {"oid": "574ff0b41bac69f4e12502c2339b0a011cdf1dfc", "url": "https://github.com/openhab/openhab-addons/commit/574ff0b41bac69f4e12502c2339b0a011cdf1dfc", "message": "some more debugging on HttpUtil exception, ext. temp sensor channels\nmarked as advanced; Typos in properties corrected\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2020-02-02T13:34:12Z", "type": "commit"}, {"oid": "70244750413be221c75fe9a1a8c5b6628ad222b0", "url": "https://github.com/openhab/openhab-addons/commit/70244750413be221c75fe9a1a8c5b6628ad222b0", "message": "Set initial status to UNKNOWN rather than keeping INITIALIZING\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2020-02-02T14:35:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg2NTk2Mw==", "url": "https://github.com/openhab/openhab-addons/pull/6764#discussion_r373865963", "bodyText": "Why do you have to suppress unused? Can't you simply remove unused variables?\nAlso, please try to avoid null suppressions and rather refactor the code to be fully null-safe.\nOk, if you address this in a future PR, no blocker wrt merging now.", "author": "kaikreuzer", "createdAt": "2020-02-02T18:38:11Z", "path": "bundles/org.openhab.binding.shelly/src/main/java/org/openhab/binding/shelly/internal/handler/ShellyBaseHandler.java", "diffHunk": "@@ -631,6 +683,39 @@ public boolean requestUpdates(int requestCount, boolean refreshSettings) {\n         return false;\n     }\n \n+    /**\n+     * Map input states to channels\n+     *\n+     * @param groupName Channel Group (relay / relay1...)\n+     *\n+     * @param status Shelly device status\n+     * @return true: one or more inputs were updated\n+     */\n+    @SuppressWarnings({ \"null\", \"unused\" })", "originalCommit": "70244750413be221c75fe9a1a8c5b6628ad222b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg4MDkyNA==", "url": "https://github.com/openhab/openhab-addons/pull/6764#discussion_r373880924", "bodyText": "because Eclipse sometimes just report BS", "author": "markus7017", "createdAt": "2020-02-02T22:31:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg2NTk2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzk0NjI0MA==", "url": "https://github.com/openhab/openhab-addons/pull/6764#discussion_r373946240", "bodyText": "example: For this statement Eclipse reports a redundant null check\nStrong thingName = properties.get(PROPERTY_SERVICE_NAME) != null ? properties.get(PROPERTY_SERVICE_NAME).toLowerCase() : thingType;\nhow to resolved those warnings?", "author": "markus7017", "createdAt": "2020-02-03T07:03:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg2NTk2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDYzMjc3Ng==", "url": "https://github.com/openhab/openhab-addons/pull/6764#discussion_r374632776", "bodyText": "Which is correct, because theoretically another thread could meanwhile remove the property before you call the get.\nThis should solve those issues:\nString thingName = properties.get(PROPERTY_SERVICE_NAME);\nthingName = thingName!=null ? thingName.toLowerCase() : thingType;", "author": "kaikreuzer", "createdAt": "2020-02-04T12:08:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg2NTk2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg1Nzg1OQ==", "url": "https://github.com/openhab/openhab-addons/pull/6764#discussion_r374857859", "bodyText": "nope, now it's \"thingName!=null\"", "author": "markus7017", "createdAt": "2020-02-04T18:52:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg2NTk2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA5NjcwMw==", "url": "https://github.com/openhab/openhab-addons/pull/6764#discussion_r375096703", "bodyText": "Then probably this way:\nString serviceName = properties.get(PROPERTY_SERVICE_NAME);\nString thingName = serviceName!=null ? serviceName.toLowerCase() : thingType;\n\nThat's anyhow cleaner than my previous suggestion.", "author": "kaikreuzer", "createdAt": "2020-02-05T07:35:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg2NTk2Mw=="}], "type": "inlineReview"}, {"oid": "d3d13e8fb55436645f24433bd688f7c25f4642d7", "url": "https://github.com/openhab/openhab-addons/commit/d3d13e8fb55436645f24433bd688f7c25f4642d7", "message": "alarm type WAEK_SIGNAL removed as requested by review\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2020-02-02T22:28:25Z", "type": "commit"}, {"oid": "6318ee10b25b7517bc40ba09bf86d6dc6b8a9657", "url": "https://github.com/openhab/openhab-addons/commit/6318ee10b25b7517bc40ba09bf86d6dc6b8a9657", "message": "cleanup of removed channels\n\nSigned-off-by: Markus Michels <markus7017@gmail.com>", "committedDate": "2020-02-02T22:30:30Z", "type": "commit"}]}