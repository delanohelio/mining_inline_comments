{"pr_number": 7914, "pr_title": "[luftdateninfo] new binding", "pr_createdAt": "2020-06-13T14:13:05Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7914", "timeline": [{"oid": "4742ad9be90ac3f1424e2fd772c9f938ed9c1329", "url": "https://github.com/openhab/openhab-addons/commit/4742ad9be90ac3f1424e2fd772c9f938ed9c1329", "message": "logging added to detect toDate conversion errors in trace\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-06-13T14:15:58Z", "type": "forcePushed"}, {"oid": "28eaae3b8122ad455b6708bef55fb5caaa1d0eef", "url": "https://github.com/openhab/openhab-addons/commit/28eaae3b8122ad455b6708bef55fb5caaa1d0eef", "message": "Set default cache to undefined\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-06-13T16:46:06Z", "type": "forcePushed"}, {"oid": "0a301d099deaf2135ee83aca17bf4690bfc464c7", "url": "https://github.com/openhab/openhab-addons/commit/0a301d099deaf2135ee83aca17bf4690bfc464c7", "message": "fix typo in main description\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-06-14T16:13:07Z", "type": "forcePushed"}, {"oid": "96d7a2a5ceb82280e568ccde7b5a2a4be9c67963", "url": "https://github.com/openhab/openhab-addons/commit/96d7a2a5ceb82280e568ccde7b5a2a4be9c67963", "message": "Ensure non null values for all update values\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-06-15T16:13:09Z", "type": "forcePushed"}, {"oid": "4d81dcb166ac7af0db39097167dbf5fb2c4ba15c", "url": "https://github.com/openhab/openhab-addons/commit/4d81dcb166ac7af0db39097167dbf5fb2c4ba15c", "message": "Update 2.5.6 => 2.5.7\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-06-22T14:51:03Z", "type": "forcePushed"}, {"oid": "a9c5acf564352aa377d7a327b2905a127b28f6a3", "url": "https://github.com/openhab/openhab-addons/commit/a9c5acf564352aa377d7a327b2905a127b28f6a3", "message": "Bugfix: Sensor IDs exceeding int range - changed type to long\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-07-03T10:14:40Z", "type": "forcePushed"}, {"oid": "6996467c5ab723d3e7402fb62dad898cfd382190", "url": "https://github.com/openhab/openhab-addons/commit/6996467c5ab723d3e7402fb62dad898cfd382190", "message": "codeowner update\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-07-05T18:43:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzMTQzNw==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r452331437", "bodyText": "Can this comment be removed?", "author": "fwolter", "createdAt": "2020-07-09T16:10:50Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/LuftdatenInfoConfiguration.java", "diffHunk": "@@ -0,0 +1,29 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+\n+/**\n+ * The {@link LuftdatenInfoConfiguration} class contains fields mapping thing configuration parameters.\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+@NonNullByDefault\n+public class LuftdatenInfoConfiguration {\n+\n+    /**\n+     * Sample configuration parameter. Replace with your own.\n+     */", "originalCommit": "6996467c5ab723d3e7402fb62dad898cfd382190", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwNDMxNQ==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453204315", "bodyText": "Deleted", "author": "weymann", "createdAt": "2020-07-11T15:14:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzMTQzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzMjIwOQ==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r452332209", "bodyText": "Does this comment makes sense?", "author": "fwolter", "createdAt": "2020-07-09T16:12:07Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/LuftdatenInfoHandlerFactory.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandlerFactory;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandlerFactory;\n+import org.eclipse.smarthome.io.net.http.HttpClientFactory;\n+import org.openhab.binding.luftdateninfo.internal.handler.ConditionHandler;\n+import org.openhab.binding.luftdateninfo.internal.handler.HTTPHandler;\n+import org.openhab.binding.luftdateninfo.internal.handler.NoiseHandler;\n+import org.openhab.binding.luftdateninfo.internal.handler.PMHandler;\n+import org.osgi.service.component.annotations.Activate;\n+import org.osgi.service.component.annotations.Component;\n+import org.osgi.service.component.annotations.Reference;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link LuftdatenInfoHandlerFactory} is responsible for creating things and thing\n+ * handlers.\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+@NonNullByDefault\n+@Component(configurationPid = \"binding.luftdateninfo\", service = ThingHandlerFactory.class)\n+public class LuftdatenInfoHandlerFactory extends BaseThingHandlerFactory {\n+    protected final Logger logger = LoggerFactory.getLogger(LuftdatenInfoHandlerFactory.class);\n+\n+    @Activate\n+    public LuftdatenInfoHandlerFactory(final @Reference HttpClientFactory httpClientFactory) {\n+        HTTPHandler.init(httpClientFactory.getCommonHttpClient());\n+    }\n+\n+    @Override\n+    public boolean supportsThingType(ThingTypeUID thingTypeUID) {\n+        if (thingTypeUID.equals(LuftdatenInfoBindingConstants.THING_TYPE_PARTICULATE)\n+                || thingTypeUID.equals(LuftdatenInfoBindingConstants.THING_TYPE_CONDITIONS)\n+                || thingTypeUID.equals(LuftdatenInfoBindingConstants.THING_TYPE_NOISE)) {\n+            return true;\n+        } else {\n+            return false;\n+        }\n+    }\n+\n+    @Override\n+    protected @Nullable ThingHandler createHandler(Thing thing) {\n+        // one handler for all", "originalCommit": "6996467c5ab723d3e7402fb62dad898cfd382190", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwNDQzOA==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453204438", "bodyText": "not really - removed", "author": "weymann", "createdAt": "2020-07-11T15:15:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzMjIwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzMjk3Ng==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r452332976", "bodyText": "Can you put the field definition to the top of the class?", "author": "fwolter", "createdAt": "2020-07-09T16:13:21Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/dto/Location.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.dto;\n+\n+/**\n+ * The {@link LuftdatenInfo} class definition for Logging identification\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+public class Location {\n+    private Integer id;\n+    private String country;\n+\n+    public Integer getId() {\n+        return id;\n+    }\n+\n+    public void setId(Integer id) {\n+        this.id = id;\n+    }\n+\n+    public String getCountry() {\n+        return country;\n+    }\n+\n+    public void setCountry(String country) {\n+        this.country = country;\n+    }\n+\n+    public String getAltitude() {\n+        return altitude;\n+    }\n+\n+    public void setAltitude(String altitude) {\n+        this.altitude = altitude;\n+    }\n+\n+    public String getLatitude() {\n+        return latitude;\n+    }\n+\n+    public void setLatitude(String latitude) {\n+        this.latitude = latitude;\n+    }\n+\n+    public String getLongtitude() {\n+        return longtitude;\n+    }\n+\n+    public void setLongtitude(String longtitude) {\n+        this.longtitude = longtitude;\n+    }\n+\n+    public Integer getIndoor() {\n+        return indoor;\n+    }\n+\n+    public void setIndoor(Integer indoor) {\n+        this.indoor = indoor;\n+    }\n+\n+    public Integer getExact_location() {\n+        return exact_location;\n+    }\n+\n+    public void setExact_location(Integer exact_location) {\n+        this.exact_location = exact_location;\n+    }\n+\n+    private String altitude;\n+    private String latitude;\n+    private String longtitude;\n+    private Integer indoor;\n+    private Integer exact_location;", "originalCommit": "6996467c5ab723d3e7402fb62dad898cfd382190", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwNDM0OQ==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453204349", "bodyText": "Done", "author": "weymann", "createdAt": "2020-07-11T15:14:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzMjk3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzMzE0Mg==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r452333142", "bodyText": "Please use camel case.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private String altitude;\n          \n          \n            \n                private String latitude;\n          \n          \n            \n                private String longtitude;\n          \n          \n            \n                private Integer indoor;\n          \n          \n            \n                private Integer exact_location;\n          \n          \n            \n                private String altitude;\n          \n          \n            \n                private String latitude;\n          \n          \n            \n                private String longtitude;\n          \n          \n            \n                private Integer indoor;\n          \n          \n            \n                private Integer exactLocation;", "author": "fwolter", "createdAt": "2020-07-09T16:13:38Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/dto/Location.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.dto;\n+\n+/**\n+ * The {@link LuftdatenInfo} class definition for Logging identification\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+public class Location {\n+    private Integer id;\n+    private String country;\n+\n+    public Integer getId() {\n+        return id;\n+    }\n+\n+    public void setId(Integer id) {\n+        this.id = id;\n+    }\n+\n+    public String getCountry() {\n+        return country;\n+    }\n+\n+    public void setCountry(String country) {\n+        this.country = country;\n+    }\n+\n+    public String getAltitude() {\n+        return altitude;\n+    }\n+\n+    public void setAltitude(String altitude) {\n+        this.altitude = altitude;\n+    }\n+\n+    public String getLatitude() {\n+        return latitude;\n+    }\n+\n+    public void setLatitude(String latitude) {\n+        this.latitude = latitude;\n+    }\n+\n+    public String getLongtitude() {\n+        return longtitude;\n+    }\n+\n+    public void setLongtitude(String longtitude) {\n+        this.longtitude = longtitude;\n+    }\n+\n+    public Integer getIndoor() {\n+        return indoor;\n+    }\n+\n+    public void setIndoor(Integer indoor) {\n+        this.indoor = indoor;\n+    }\n+\n+    public Integer getExact_location() {\n+        return exact_location;\n+    }\n+\n+    public void setExact_location(Integer exact_location) {\n+        this.exact_location = exact_location;\n+    }\n+\n+    private String altitude;\n+    private String latitude;\n+    private String longtitude;\n+    private Integer indoor;\n+    private Integer exact_location;", "originalCommit": "6996467c5ab723d3e7402fb62dad898cfd382190", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE4NTkzMw==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453185933", "bodyText": "I think I cannot change this - name has to match exactly to the deliverd json key, right? That's why I ignored all checkstyle warnings in dto subfolder regarding camel case.", "author": "weymann", "createdAt": "2020-07-11T11:32:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzMzE0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIyNzk3NA==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453227974", "bodyText": "You can annotate the field with @SerializedName(\"exact_location\"). The field name can be anything, then.", "author": "fwolter", "createdAt": "2020-07-11T19:44:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzMzE0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzMwNTI3Nw==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453305277", "bodyText": "Perfect - looks good now and all checkstyle warnings are eliminated!", "author": "weymann", "createdAt": "2020-07-12T11:39:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzMzE0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzMzU1Mg==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r452333552", "bodyText": "Typo\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private String longtitude;\n          \n          \n            \n                private String longitude;", "author": "fwolter", "createdAt": "2020-07-09T16:14:19Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/dto/Location.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.dto;\n+\n+/**\n+ * The {@link LuftdatenInfo} class definition for Logging identification\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+public class Location {\n+    private Integer id;\n+    private String country;\n+\n+    public Integer getId() {\n+        return id;\n+    }\n+\n+    public void setId(Integer id) {\n+        this.id = id;\n+    }\n+\n+    public String getCountry() {\n+        return country;\n+    }\n+\n+    public void setCountry(String country) {\n+        this.country = country;\n+    }\n+\n+    public String getAltitude() {\n+        return altitude;\n+    }\n+\n+    public void setAltitude(String altitude) {\n+        this.altitude = altitude;\n+    }\n+\n+    public String getLatitude() {\n+        return latitude;\n+    }\n+\n+    public void setLatitude(String latitude) {\n+        this.latitude = latitude;\n+    }\n+\n+    public String getLongtitude() {\n+        return longtitude;\n+    }\n+\n+    public void setLongtitude(String longtitude) {\n+        this.longtitude = longtitude;\n+    }\n+\n+    public Integer getIndoor() {\n+        return indoor;\n+    }\n+\n+    public void setIndoor(Integer indoor) {\n+        this.indoor = indoor;\n+    }\n+\n+    public Integer getExact_location() {\n+        return exact_location;\n+    }\n+\n+    public void setExact_location(Integer exact_location) {\n+        this.exact_location = exact_location;\n+    }\n+\n+    private String altitude;\n+    private String latitude;\n+    private String longtitude;", "originalCommit": "6996467c5ab723d3e7402fb62dad898cfd382190", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwNDQ4NA==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453204484", "bodyText": "Corrected", "author": "weymann", "createdAt": "2020-07-11T15:15:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzMzU1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzNDI1NA==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r452334254", "bodyText": "Primitive types should be used where possible.\nThere are several locations where you use complex types, where int would be sufficient. I didn't mark all of them.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private Integer indoor;\n          \n          \n            \n                private int indoor;", "author": "fwolter", "createdAt": "2020-07-09T16:15:11Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/dto/Location.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.dto;\n+\n+/**\n+ * The {@link LuftdatenInfo} class definition for Logging identification\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+public class Location {\n+    private Integer id;\n+    private String country;\n+\n+    public Integer getId() {\n+        return id;\n+    }\n+\n+    public void setId(Integer id) {\n+        this.id = id;\n+    }\n+\n+    public String getCountry() {\n+        return country;\n+    }\n+\n+    public void setCountry(String country) {\n+        this.country = country;\n+    }\n+\n+    public String getAltitude() {\n+        return altitude;\n+    }\n+\n+    public void setAltitude(String altitude) {\n+        this.altitude = altitude;\n+    }\n+\n+    public String getLatitude() {\n+        return latitude;\n+    }\n+\n+    public void setLatitude(String latitude) {\n+        this.latitude = latitude;\n+    }\n+\n+    public String getLongtitude() {\n+        return longtitude;\n+    }\n+\n+    public void setLongtitude(String longtitude) {\n+        this.longtitude = longtitude;\n+    }\n+\n+    public Integer getIndoor() {\n+        return indoor;\n+    }\n+\n+    public void setIndoor(Integer indoor) {\n+        this.indoor = indoor;\n+    }\n+\n+    public Integer getExact_location() {\n+        return exact_location;\n+    }\n+\n+    public void setExact_location(Integer exact_location) {\n+        this.exact_location = exact_location;\n+    }\n+\n+    private String altitude;\n+    private String latitude;\n+    private String longtitude;\n+    private Integer indoor;", "originalCommit": "6996467c5ab723d3e7402fb62dad898cfd382190", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwNDU0MA==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453204540", "bodyText": "Corrected in all DTO classes", "author": "weymann", "createdAt": "2020-07-11T15:16:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzNDI1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzNTkwNA==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r452335904", "bodyText": "This can be a constant. You could make it static final, all uppercase and move it to the top of the class. Also it's good practice to append the unit to the field name e.g. TIMEOUT_SEC.", "author": "fwolter", "createdAt": "2020-07-09T16:17:50Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/handler/BaseSensorHandler.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.handler;\n+\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.openhab.binding.luftdateninfo.internal.LuftdatenInfoConfiguration;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link PMHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+@NonNullByDefault\n+public abstract class BaseSensorHandler extends BaseThingHandler {\n+\n+    protected final Logger logger = LoggerFactory.getLogger(BaseSensorHandler.class);\n+\n+    protected @Nullable LuftdatenInfoConfiguration config;\n+    protected @Nullable ScheduledFuture<?> refreshJob;\n+    protected int refreshInterval = 5;", "originalCommit": "6996467c5ab723d3e7402fb62dad898cfd382190", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwNDU3Mw==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453204573", "bodyText": "Done", "author": "weymann", "createdAt": "2020-07-11T15:16:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzNTkwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzNjg2NA==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r452336864", "bodyText": "You could declare an Enum for those constants.", "author": "fwolter", "createdAt": "2020-07-09T16:19:27Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/handler/BaseSensorHandler.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.handler;\n+\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.openhab.binding.luftdateninfo.internal.LuftdatenInfoConfiguration;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link PMHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+@NonNullByDefault\n+public abstract class BaseSensorHandler extends BaseThingHandler {\n+\n+    protected final Logger logger = LoggerFactory.getLogger(BaseSensorHandler.class);\n+\n+    protected @Nullable LuftdatenInfoConfiguration config;\n+    protected @Nullable ScheduledFuture<?> refreshJob;\n+    protected int refreshInterval = 5;\n+\n+    protected int configStatus = -1;\n+    protected static final int CONFIG_OK = 0;\n+    protected static final int CONFIG_IS_NULL = 1;\n+    protected static final int CONFIG_SENSOR_IS_NULL = 2;\n+    protected static final int CONFIG_SENSOR_NUMBER = 3;", "originalCommit": "6996467c5ab723d3e7402fb62dad898cfd382190", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwNDY1Ng==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453204656", "bodyText": "Config, Update and Lifecycle Status adaption to enum", "author": "weymann", "createdAt": "2020-07-11T15:17:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzNjg2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzNzY2OQ==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r452337669", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                refreshJob = scheduler.scheduleWithFixedDelay(this::update, 5, refreshInterval * 60,\n          \n          \n            \n                                        TimeUnit.SECONDS);\n          \n          \n            \n                                refreshJob = scheduler.scheduleWithFixedDelay(this::update, 5, refreshInterval,\n          \n          \n            \n                                        TimeUnit.MINUTES);", "author": "fwolter", "createdAt": "2020-07-09T16:20:41Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/handler/BaseSensorHandler.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.handler;\n+\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.openhab.binding.luftdateninfo.internal.LuftdatenInfoConfiguration;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link PMHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+@NonNullByDefault\n+public abstract class BaseSensorHandler extends BaseThingHandler {\n+\n+    protected final Logger logger = LoggerFactory.getLogger(BaseSensorHandler.class);\n+\n+    protected @Nullable LuftdatenInfoConfiguration config;\n+    protected @Nullable ScheduledFuture<?> refreshJob;\n+    protected int refreshInterval = 5;\n+\n+    protected int configStatus = -1;\n+    protected static final int CONFIG_OK = 0;\n+    protected static final int CONFIG_IS_NULL = 1;\n+    protected static final int CONFIG_SENSOR_IS_NULL = 2;\n+    protected static final int CONFIG_SENSOR_NUMBER = 3;\n+\n+    protected int updateStatus = -1;\n+    protected static final int UPDATE_OK = 0;\n+    protected static final int UPDATE_CONNECTION_ERROR = 1;\n+    protected static final int UPDATE_VALUE_ERROR = 2;\n+    protected static final int UPDATE_VALUE_EMPTY = 3;\n+\n+    protected static final int LC_UNKNOWN = -1;\n+    protected static final int LC_RUNNING = 0;\n+    protected static final int LC_INITIALIZING = 1;\n+    protected static final int LC_DISPOSED = 2;\n+    protected int lifecycleStatus = LC_UNKNOWN;\n+\n+    protected static final DecimalType UNDEF = new DecimalType(-1);\n+\n+    public BaseSensorHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            updateFromCache();\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        lifecycleStatus = LC_INITIALIZING;\n+        scheduler.execute(() -> {\n+            config = getConfigAs(LuftdatenInfoConfiguration.class);\n+            configStatus = checkConfig(config);\n+            if (configStatus == CONFIG_OK) {\n+                update();\n+                if (updateStatus == UPDATE_OK) {\n+                    updateStatus(ThingStatus.ONLINE);\n+                    logger.debug(\"Start refresh job at interval {} min.\", refreshInterval);\n+                    if (refreshJob != null) {\n+                        refreshJob.cancel(true);\n+                    }\n+                    refreshJob = scheduler.scheduleWithFixedDelay(this::update, 5, refreshInterval * 60,\n+                            TimeUnit.SECONDS);", "originalCommit": "6996467c5ab723d3e7402fb62dad898cfd382190", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwNDY4Mw==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453204683", "bodyText": "Changed", "author": "weymann", "createdAt": "2020-07-11T15:17:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzNzY2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzODM0OA==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r452338348", "bodyText": "Can you remove the empty line?", "author": "fwolter", "createdAt": "2020-07-09T16:21:50Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/handler/BaseSensorHandler.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.handler;\n+\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.openhab.binding.luftdateninfo.internal.LuftdatenInfoConfiguration;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link PMHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+@NonNullByDefault\n+public abstract class BaseSensorHandler extends BaseThingHandler {\n+\n+    protected final Logger logger = LoggerFactory.getLogger(BaseSensorHandler.class);\n+\n+    protected @Nullable LuftdatenInfoConfiguration config;\n+    protected @Nullable ScheduledFuture<?> refreshJob;\n+    protected int refreshInterval = 5;\n+\n+    protected int configStatus = -1;\n+    protected static final int CONFIG_OK = 0;\n+    protected static final int CONFIG_IS_NULL = 1;\n+    protected static final int CONFIG_SENSOR_IS_NULL = 2;\n+    protected static final int CONFIG_SENSOR_NUMBER = 3;\n+\n+    protected int updateStatus = -1;\n+    protected static final int UPDATE_OK = 0;\n+    protected static final int UPDATE_CONNECTION_ERROR = 1;\n+    protected static final int UPDATE_VALUE_ERROR = 2;\n+    protected static final int UPDATE_VALUE_EMPTY = 3;\n+\n+    protected static final int LC_UNKNOWN = -1;\n+    protected static final int LC_RUNNING = 0;\n+    protected static final int LC_INITIALIZING = 1;\n+    protected static final int LC_DISPOSED = 2;\n+    protected int lifecycleStatus = LC_UNKNOWN;\n+\n+    protected static final DecimalType UNDEF = new DecimalType(-1);\n+\n+    public BaseSensorHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            updateFromCache();\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        lifecycleStatus = LC_INITIALIZING;\n+        scheduler.execute(() -> {\n+            config = getConfigAs(LuftdatenInfoConfiguration.class);\n+            configStatus = checkConfig(config);\n+            if (configStatus == CONFIG_OK) {\n+                update();\n+                if (updateStatus == UPDATE_OK) {\n+                    updateStatus(ThingStatus.ONLINE);\n+                    logger.debug(\"Start refresh job at interval {} min.\", refreshInterval);\n+                    if (refreshJob != null) {\n+                        refreshJob.cancel(true);\n+                    }\n+                    refreshJob = scheduler.scheduleWithFixedDelay(this::update, 5, refreshInterval * 60,\n+                            TimeUnit.SECONDS);\n+                } else {\n+                    switch (updateStatus) {\n+                        case UPDATE_CONNECTION_ERROR:\n+                            logger.warn(\"Update failed due to Connection error. Trying to recover in next refresh\");\n+                            break;\n+                        case UPDATE_VALUE_ERROR:\n+                            logger.warn(\n+                                    \"Sensor values doesn't match - please check if Sensor ID is delivering the correct Thing channel values\");\n+                            break;\n+                        case UPDATE_VALUE_EMPTY:\n+                            logger.warn(\n+                                    \"No values deliverd by Sensor. Please check for valid Sensor ID in configuration\");\n+                            break;\n+                    }\n+                    updateStatus(ThingStatus.OFFLINE);\n+                }\n+            } else {\n+                logger.warn(\"Configuration not valid. Sensor ID as a number is mandatory!\");\n+                updateStatus(ThingStatus.OFFLINE);\n+            }\n+            lifecycleStatus = LC_RUNNING;\n+        });\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        if (refreshJob != null) {\n+            refreshJob.cancel(true);\n+        }\n+        lifecycleStatus = LC_DISPOSED;\n+    }\n+\n+    /**\n+     * Checks if config is valid - a) not null and b) sensorid is a number\n+     *\n+     * @param c\n+     * @return\n+     */\n+    private int checkConfig(@Nullable LuftdatenInfoConfiguration c) {\n+        if (c != null) {\n+            try {\n+                Integer.parseInt(c.sensorid);\n+                return CONFIG_OK;\n+            } catch (NumberFormatException t) {\n+                return CONFIG_SENSOR_NUMBER;\n+            }\n+        } else\n+", "originalCommit": "6996467c5ab723d3e7402fb62dad898cfd382190", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwNTgzMA==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453205830", "bodyText": "Done", "author": "weymann", "createdAt": "2020-07-11T15:30:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzODM0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzOTU3OQ==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r452339579", "bodyText": "Syntactical sugar\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                Iterator<SensorDataValue> iter = valueList.iterator();\n          \n          \n            \n                                while (iter.hasNext()) {\n          \n          \n            \n                                    SensorDataValue v = iter.next();\n          \n          \n            \n                                valueList.forEach(v -> {", "author": "fwolter", "createdAt": "2020-07-09T16:24:04Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/handler/ConditionHandler.java", "diffHunk": "@@ -0,0 +1,90 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.handler;\n+\n+import static org.openhab.binding.luftdateninfo.internal.LuftdatenInfoBindingConstants.*;\n+import static org.openhab.binding.luftdateninfo.internal.handler.HTTPHandler.*;\n+\n+import java.util.Iterator;\n+import java.util.List;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.openhab.binding.luftdateninfo.internal.dto.SensorDataValue;\n+import org.openhab.binding.luftdateninfo.internal.utils.NumberUtils;\n+\n+/**\n+ * The {@link ConditionHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+@NonNullByDefault\n+public class ConditionHandler extends BaseSensorHandler {\n+\n+    protected DecimalType temperatureCache = UNDEF;\n+    protected DecimalType humidityCache = UNDEF;\n+    protected DecimalType pressureCache = UNDEF;\n+    protected DecimalType pressureSeaCache = UNDEF;\n+\n+    public ConditionHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    @Override\n+    public int updateChannels(@Nullable String json) {\n+        if (json != null) {\n+            List<SensorDataValue> valueList = HTTPHandler.getLatestValues(json);\n+            if (valueList != null) {\n+                if (HTTPHandler.isCondition(valueList)) {\n+                    Iterator<SensorDataValue> iter = valueList.iterator();\n+                    while (iter.hasNext()) {\n+                        SensorDataValue v = iter.next();", "originalCommit": "6996467c5ab723d3e7402fb62dad898cfd382190", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwNDczOA==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453204738", "bodyText": "Changed in several locations", "author": "weymann", "createdAt": "2020-07-11T15:18:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzOTU3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM0MTU3NA==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r452341574", "bodyText": "When using Units of Measure, this would look like:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                        temperatureCache = new DecimalType(NumberUtils.round(v.getValue(), 1));\n          \n          \n            \n                                        temperatureCache = QuantityType.valueOf(NumberUtils.round(v.getValue(), 1),\n          \n          \n            \n                                                SIUnits.CELSIUS);", "author": "fwolter", "createdAt": "2020-07-09T16:27:01Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/handler/ConditionHandler.java", "diffHunk": "@@ -0,0 +1,90 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.handler;\n+\n+import static org.openhab.binding.luftdateninfo.internal.LuftdatenInfoBindingConstants.*;\n+import static org.openhab.binding.luftdateninfo.internal.handler.HTTPHandler.*;\n+\n+import java.util.Iterator;\n+import java.util.List;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.openhab.binding.luftdateninfo.internal.dto.SensorDataValue;\n+import org.openhab.binding.luftdateninfo.internal.utils.NumberUtils;\n+\n+/**\n+ * The {@link ConditionHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+@NonNullByDefault\n+public class ConditionHandler extends BaseSensorHandler {\n+\n+    protected DecimalType temperatureCache = UNDEF;\n+    protected DecimalType humidityCache = UNDEF;\n+    protected DecimalType pressureCache = UNDEF;\n+    protected DecimalType pressureSeaCache = UNDEF;\n+\n+    public ConditionHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    @Override\n+    public int updateChannels(@Nullable String json) {\n+        if (json != null) {\n+            List<SensorDataValue> valueList = HTTPHandler.getLatestValues(json);\n+            if (valueList != null) {\n+                if (HTTPHandler.isCondition(valueList)) {\n+                    Iterator<SensorDataValue> iter = valueList.iterator();\n+                    while (iter.hasNext()) {\n+                        SensorDataValue v = iter.next();\n+                        if (v.getValue_type().equals(TEMPERATURE)) {\n+                            temperatureCache = new DecimalType(NumberUtils.round(v.getValue(), 1));", "originalCommit": "6996467c5ab723d3e7402fb62dad898cfd382190", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwNDgxNw==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453204817", "bodyText": "All values adapted to QuantityType", "author": "weymann", "createdAt": "2020-07-11T15:19:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM0MTU3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM0MjU0Nw==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r452342547", "bodyText": "Logging to info should be used rarely. This could be debug or warn.\nDon't you want to log the other error codes, too? E.g. 500. You could log in the default case of the switch.", "author": "fwolter", "createdAt": "2020-07-09T16:28:37Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/handler/HTTPHandler.java", "diffHunk": "@@ -0,0 +1,182 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.handler;\n+\n+import java.util.Date;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.openhab.binding.luftdateninfo.internal.dto.SensorData;\n+import org.openhab.binding.luftdateninfo.internal.dto.SensorDataValue;\n+import org.openhab.binding.luftdateninfo.internal.utils.DateTimeUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+\n+/**\n+ * The {@link HTTPHandler} is responsible for HTTP requests and JSON handling\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+@NonNullByDefault\n+public class HTTPHandler {\n+    private static final Logger logger = LoggerFactory.getLogger(HTTPHandler.class);\n+    private static String sensorUrl = \"http://data.sensor.community/airrohr/v1/sensor/\";\n+    private static @Nullable HttpClient commonHttpClient;\n+\n+    public static final String P1 = \"P1\";\n+    public static final String P2 = \"P2\";\n+\n+    public static final String TEMPERATURE = \"temperature\";\n+    public static final String HUMIDITY = \"humidity\";\n+    public static final String PRESSURE = \"pressure\";\n+    public static final String PRESSURE_SEALEVEL = \"pressure_at_sealevel\";\n+\n+    public static final String NOISE_EQ = \"noise_LAeq\";\n+    public static final String NOISE_MIN = \"noise_LA_min\";\n+    public static final String NOISE_MAX = \"noise_LA_max\";\n+\n+    public static void init(HttpClient httpClient) {\n+        commonHttpClient = httpClient;\n+    }\n+\n+    public static @Nullable String getResponse(String sensorId) {\n+        if (commonHttpClient == null) {\n+            logger.warn(\"HTTP Client not initialized\");\n+            return null;\n+        }\n+        String url = sensorUrl + sensorId + \"/\";\n+        try {\n+            ContentResponse contentResponse = commonHttpClient.newRequest(url).timeout(10, TimeUnit.SECONDS).send();\n+            int httpStatus = contentResponse.getStatus();\n+            String content = contentResponse.getContentAsString();\n+            logger.debug(\"Sensor response: {}\", httpStatus);\n+            switch (httpStatus) {\n+                case 200:\n+                    return content;\n+                case 400:\n+                case 401:\n+                case 404:\n+                    logger.info(\"Sensor response: {}\", httpStatus);", "originalCommit": "6996467c5ab723d3e7402fb62dad898cfd382190", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwNDkzMQ==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453204931", "bodyText": "Switched to WARN level", "author": "weymann", "createdAt": "2020-07-11T15:20:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM0MjU0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM0MzYxNg==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r452343616", "bodyText": "You might want to log the exception's message\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        logger.warn(\"Exception when calling {}\", url);\n          \n          \n            \n                        logger.warn(\"Exception when calling {}: {}\", url, e.getMessage());", "author": "fwolter", "createdAt": "2020-07-09T16:30:21Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/handler/HTTPHandler.java", "diffHunk": "@@ -0,0 +1,182 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.handler;\n+\n+import java.util.Date;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.openhab.binding.luftdateninfo.internal.dto.SensorData;\n+import org.openhab.binding.luftdateninfo.internal.dto.SensorDataValue;\n+import org.openhab.binding.luftdateninfo.internal.utils.DateTimeUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+\n+/**\n+ * The {@link HTTPHandler} is responsible for HTTP requests and JSON handling\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+@NonNullByDefault\n+public class HTTPHandler {\n+    private static final Logger logger = LoggerFactory.getLogger(HTTPHandler.class);\n+    private static String sensorUrl = \"http://data.sensor.community/airrohr/v1/sensor/\";\n+    private static @Nullable HttpClient commonHttpClient;\n+\n+    public static final String P1 = \"P1\";\n+    public static final String P2 = \"P2\";\n+\n+    public static final String TEMPERATURE = \"temperature\";\n+    public static final String HUMIDITY = \"humidity\";\n+    public static final String PRESSURE = \"pressure\";\n+    public static final String PRESSURE_SEALEVEL = \"pressure_at_sealevel\";\n+\n+    public static final String NOISE_EQ = \"noise_LAeq\";\n+    public static final String NOISE_MIN = \"noise_LA_min\";\n+    public static final String NOISE_MAX = \"noise_LA_max\";\n+\n+    public static void init(HttpClient httpClient) {\n+        commonHttpClient = httpClient;\n+    }\n+\n+    public static @Nullable String getResponse(String sensorId) {\n+        if (commonHttpClient == null) {\n+            logger.warn(\"HTTP Client not initialized\");\n+            return null;\n+        }\n+        String url = sensorUrl + sensorId + \"/\";\n+        try {\n+            ContentResponse contentResponse = commonHttpClient.newRequest(url).timeout(10, TimeUnit.SECONDS).send();\n+            int httpStatus = contentResponse.getStatus();\n+            String content = contentResponse.getContentAsString();\n+            logger.debug(\"Sensor response: {}\", httpStatus);\n+            switch (httpStatus) {\n+                case 200:\n+                    return content;\n+                case 400:\n+                case 401:\n+                case 404:\n+                    logger.info(\"Sensor response: {}\", httpStatus);\n+                    return null;\n+                default:\n+                    return null;\n+            }\n+        } catch (InterruptedException | TimeoutException | ExecutionException e) {\n+            logger.warn(\"Exception when calling {}\", url);", "originalCommit": "6996467c5ab723d3e7402fb62dad898cfd382190", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwNDk4NA==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453204984", "bodyText": "Done", "author": "weymann", "createdAt": "2020-07-11T15:20:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM0MzYxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM0Mzg3MA==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r452343870", "bodyText": "Can you make this a final field to save resources?", "author": "fwolter", "createdAt": "2020-07-09T16:30:46Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/handler/HTTPHandler.java", "diffHunk": "@@ -0,0 +1,182 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.handler;\n+\n+import java.util.Date;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.openhab.binding.luftdateninfo.internal.dto.SensorData;\n+import org.openhab.binding.luftdateninfo.internal.dto.SensorDataValue;\n+import org.openhab.binding.luftdateninfo.internal.utils.DateTimeUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+\n+/**\n+ * The {@link HTTPHandler} is responsible for HTTP requests and JSON handling\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+@NonNullByDefault\n+public class HTTPHandler {\n+    private static final Logger logger = LoggerFactory.getLogger(HTTPHandler.class);\n+    private static String sensorUrl = \"http://data.sensor.community/airrohr/v1/sensor/\";\n+    private static @Nullable HttpClient commonHttpClient;\n+\n+    public static final String P1 = \"P1\";\n+    public static final String P2 = \"P2\";\n+\n+    public static final String TEMPERATURE = \"temperature\";\n+    public static final String HUMIDITY = \"humidity\";\n+    public static final String PRESSURE = \"pressure\";\n+    public static final String PRESSURE_SEALEVEL = \"pressure_at_sealevel\";\n+\n+    public static final String NOISE_EQ = \"noise_LAeq\";\n+    public static final String NOISE_MIN = \"noise_LA_min\";\n+    public static final String NOISE_MAX = \"noise_LA_max\";\n+\n+    public static void init(HttpClient httpClient) {\n+        commonHttpClient = httpClient;\n+    }\n+\n+    public static @Nullable String getResponse(String sensorId) {\n+        if (commonHttpClient == null) {\n+            logger.warn(\"HTTP Client not initialized\");\n+            return null;\n+        }\n+        String url = sensorUrl + sensorId + \"/\";\n+        try {\n+            ContentResponse contentResponse = commonHttpClient.newRequest(url).timeout(10, TimeUnit.SECONDS).send();\n+            int httpStatus = contentResponse.getStatus();\n+            String content = contentResponse.getContentAsString();\n+            logger.debug(\"Sensor response: {}\", httpStatus);\n+            switch (httpStatus) {\n+                case 200:\n+                    return content;\n+                case 400:\n+                case 401:\n+                case 404:\n+                    logger.info(\"Sensor response: {}\", httpStatus);\n+                    return null;\n+                default:\n+                    return null;\n+            }\n+        } catch (InterruptedException | TimeoutException | ExecutionException e) {\n+            logger.warn(\"Exception when calling {}\", url);\n+            return null;\n+        }\n+    }\n+\n+    public static @Nullable List<SensorDataValue> getLatestValues(String response) {\n+        Gson gson = new Gson();", "originalCommit": "6996467c5ab723d3e7402fb62dad898cfd382190", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwNTA0NQ==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453205045", "bodyText": "Should be ok - change is done", "author": "weymann", "createdAt": "2020-07-11T15:21:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM0Mzg3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM0NDMxNQ==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r452344315", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private List<SensorDataValue> sensordatavalues;\n          \n          \n            \n                private List<SensorDataValue> sensorDataValues;", "author": "fwolter", "createdAt": "2020-07-09T16:31:36Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/dto/SensorData.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.dto;\n+\n+import java.util.List;\n+\n+/**\n+ * The {@link SensorData} Data Transfer Object\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+public class SensorData {\n+    private Long id;\n+    private String timestamp;\n+    private Integer sampling_rate;\n+    private List<SensorDataValue> sensordatavalues;", "originalCommit": "6996467c5ab723d3e7402fb62dad898cfd382190", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE4NjAwNg==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453186006", "bodyText": "Same here - field is exactly named after Json key", "author": "weymann", "createdAt": "2020-07-11T11:33:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM0NDMxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzMwNTMyMg==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453305322", "bodyText": "Solved with SerializedName annotation", "author": "weymann", "createdAt": "2020-07-12T11:39:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM0NDMxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM0NDQzNg==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r452344436", "bodyText": "See above", "author": "fwolter", "createdAt": "2020-07-09T16:31:46Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/dto/SensorData.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.dto;\n+\n+import java.util.List;\n+\n+/**\n+ * The {@link SensorData} Data Transfer Object\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+public class SensorData {\n+    private Long id;\n+    private String timestamp;\n+    private Integer sampling_rate;\n+    private List<SensorDataValue> sensordatavalues;\n+    private Location location;\n+    private Sensor sensor;\n+\n+    @Override\n+    public String toString() {\n+        return id + timestamp;\n+    }\n+\n+    public Long getId() {\n+        return id;\n+    }\n+\n+    public void setId(Long id) {\n+        this.id = id;\n+    }\n+\n+    public String getTimeStamp() {\n+        return timestamp;\n+    }\n+\n+    public void setTimeStamp(String timeStamp) {\n+        this.timestamp = timeStamp;\n+    }\n+\n+    public Integer getSampling_rate() {\n+        return sampling_rate;\n+    }\n+\n+    public void setSampling_rate(Integer sampling_rate) {\n+        this.sampling_rate = sampling_rate;\n+    }\n+\n+    public List<SensorDataValue> getSensordatavalues() {", "originalCommit": "6996467c5ab723d3e7402fb62dad898cfd382190", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwNTA4Mw==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453205083", "bodyText": "Same here - field is exactly named after Json key", "author": "weymann", "createdAt": "2020-07-11T15:22:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM0NDQzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzMwNjAzOA==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453306038", "bodyText": "Solved with SerializedName annotation", "author": "weymann", "createdAt": "2020-07-12T11:45:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM0NDQzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM0NTI0MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r452345241", "bodyText": "Config can be null at this point.", "author": "fwolter", "createdAt": "2020-07-09T16:33:04Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/handler/BaseSensorHandler.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.handler;\n+\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.openhab.binding.luftdateninfo.internal.LuftdatenInfoConfiguration;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link PMHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+@NonNullByDefault\n+public abstract class BaseSensorHandler extends BaseThingHandler {\n+\n+    protected final Logger logger = LoggerFactory.getLogger(BaseSensorHandler.class);\n+\n+    protected @Nullable LuftdatenInfoConfiguration config;\n+    protected @Nullable ScheduledFuture<?> refreshJob;\n+    protected int refreshInterval = 5;\n+\n+    protected int configStatus = -1;\n+    protected static final int CONFIG_OK = 0;\n+    protected static final int CONFIG_IS_NULL = 1;\n+    protected static final int CONFIG_SENSOR_IS_NULL = 2;\n+    protected static final int CONFIG_SENSOR_NUMBER = 3;\n+\n+    protected int updateStatus = -1;\n+    protected static final int UPDATE_OK = 0;\n+    protected static final int UPDATE_CONNECTION_ERROR = 1;\n+    protected static final int UPDATE_VALUE_ERROR = 2;\n+    protected static final int UPDATE_VALUE_EMPTY = 3;\n+\n+    protected static final int LC_UNKNOWN = -1;\n+    protected static final int LC_RUNNING = 0;\n+    protected static final int LC_INITIALIZING = 1;\n+    protected static final int LC_DISPOSED = 2;\n+    protected int lifecycleStatus = LC_UNKNOWN;\n+\n+    protected static final DecimalType UNDEF = new DecimalType(-1);\n+\n+    public BaseSensorHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            updateFromCache();\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        lifecycleStatus = LC_INITIALIZING;\n+        scheduler.execute(() -> {\n+            config = getConfigAs(LuftdatenInfoConfiguration.class);\n+            configStatus = checkConfig(config);\n+            if (configStatus == CONFIG_OK) {\n+                update();\n+                if (updateStatus == UPDATE_OK) {\n+                    updateStatus(ThingStatus.ONLINE);\n+                    logger.debug(\"Start refresh job at interval {} min.\", refreshInterval);\n+                    if (refreshJob != null) {\n+                        refreshJob.cancel(true);\n+                    }\n+                    refreshJob = scheduler.scheduleWithFixedDelay(this::update, 5, refreshInterval * 60,\n+                            TimeUnit.SECONDS);\n+                } else {\n+                    switch (updateStatus) {\n+                        case UPDATE_CONNECTION_ERROR:\n+                            logger.warn(\"Update failed due to Connection error. Trying to recover in next refresh\");\n+                            break;\n+                        case UPDATE_VALUE_ERROR:\n+                            logger.warn(\n+                                    \"Sensor values doesn't match - please check if Sensor ID is delivering the correct Thing channel values\");\n+                            break;\n+                        case UPDATE_VALUE_EMPTY:\n+                            logger.warn(\n+                                    \"No values deliverd by Sensor. Please check for valid Sensor ID in configuration\");\n+                            break;\n+                    }\n+                    updateStatus(ThingStatus.OFFLINE);\n+                }\n+            } else {\n+                logger.warn(\"Configuration not valid. Sensor ID as a number is mandatory!\");\n+                updateStatus(ThingStatus.OFFLINE);\n+            }\n+            lifecycleStatus = LC_RUNNING;\n+        });\n+    }\n+\n+    @Override\n+    public void dispose() {\n+        if (refreshJob != null) {\n+            refreshJob.cancel(true);\n+        }\n+        lifecycleStatus = LC_DISPOSED;\n+    }\n+\n+    /**\n+     * Checks if config is valid - a) not null and b) sensorid is a number\n+     *\n+     * @param c\n+     * @return\n+     */\n+    private int checkConfig(@Nullable LuftdatenInfoConfiguration c) {\n+        if (c != null) {\n+            try {\n+                Integer.parseInt(c.sensorid);\n+                return CONFIG_OK;\n+            } catch (NumberFormatException t) {\n+                return CONFIG_SENSOR_NUMBER;\n+            }\n+        } else\n+\n+        {\n+            return CONFIG_IS_NULL;\n+        }\n+    }\n+\n+    public int getLifecycleStatus() {\n+        return lifecycleStatus;\n+    }\n+\n+    protected void update() {\n+        String response = HTTPHandler.getResponse(config.sensorid);", "originalCommit": "6996467c5ab723d3e7402fb62dad898cfd382190", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwNTI2NA==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453205264", "bodyText": "Shouldn't be the case - update & scheduler are only started if initialize is checked with OK", "author": "weymann", "createdAt": "2020-07-11T15:24:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM0NTI0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM0NjMwOA==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r452346308", "bodyText": "You can fix the compiler warning by storing commonHttpClient to a local variable and do a null check on that.", "author": "fwolter", "createdAt": "2020-07-09T16:34:58Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/handler/HTTPHandler.java", "diffHunk": "@@ -0,0 +1,182 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.handler;\n+\n+import java.util.Date;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.openhab.binding.luftdateninfo.internal.dto.SensorData;\n+import org.openhab.binding.luftdateninfo.internal.dto.SensorDataValue;\n+import org.openhab.binding.luftdateninfo.internal.utils.DateTimeUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+\n+/**\n+ * The {@link HTTPHandler} is responsible for HTTP requests and JSON handling\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+@NonNullByDefault\n+public class HTTPHandler {\n+    private static final Logger logger = LoggerFactory.getLogger(HTTPHandler.class);\n+    private static String sensorUrl = \"http://data.sensor.community/airrohr/v1/sensor/\";\n+    private static @Nullable HttpClient commonHttpClient;\n+\n+    public static final String P1 = \"P1\";\n+    public static final String P2 = \"P2\";\n+\n+    public static final String TEMPERATURE = \"temperature\";\n+    public static final String HUMIDITY = \"humidity\";\n+    public static final String PRESSURE = \"pressure\";\n+    public static final String PRESSURE_SEALEVEL = \"pressure_at_sealevel\";\n+\n+    public static final String NOISE_EQ = \"noise_LAeq\";\n+    public static final String NOISE_MIN = \"noise_LA_min\";\n+    public static final String NOISE_MAX = \"noise_LA_max\";\n+\n+    public static void init(HttpClient httpClient) {\n+        commonHttpClient = httpClient;\n+    }\n+\n+    public static @Nullable String getResponse(String sensorId) {\n+        if (commonHttpClient == null) {\n+            logger.warn(\"HTTP Client not initialized\");\n+            return null;\n+        }\n+        String url = sensorUrl + sensorId + \"/\";\n+        try {\n+            ContentResponse contentResponse = commonHttpClient.newRequest(url).timeout(10, TimeUnit.SECONDS).send();", "originalCommit": "6996467c5ab723d3e7402fb62dad898cfd382190", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwNTI5NQ==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453205295", "bodyText": "Yes, it worked", "author": "weymann", "createdAt": "2020-07-11T15:24:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM0NjMwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM1MjMwOQ==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r452352309", "bodyText": "You could have some fun with streams here. You could try something like this. Same for below.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Iterator<SensorDataValue> iter = valueList.iterator();\n          \n          \n            \n                    while (iter.hasNext()) {\n          \n          \n            \n                        SensorDataValue v = iter.next();\n          \n          \n            \n                        if (!(v.getValue_type().equals(P1) || v.getValue_type().equals(P2))) {\n          \n          \n            \n                            return false;\n          \n          \n            \n                        }\n          \n          \n            \n                    }\n          \n          \n            \n                    return true;\n          \n          \n            \n                    return valueList.stream().map(v -> v.getValue_type()).filter(t -> t.equals(P1) || t.equals(P2)).findAny().isPresent();", "author": "fwolter", "createdAt": "2020-07-09T16:44:46Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/handler/HTTPHandler.java", "diffHunk": "@@ -0,0 +1,182 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.handler;\n+\n+import java.util.Date;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.openhab.binding.luftdateninfo.internal.dto.SensorData;\n+import org.openhab.binding.luftdateninfo.internal.dto.SensorDataValue;\n+import org.openhab.binding.luftdateninfo.internal.utils.DateTimeUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+\n+/**\n+ * The {@link HTTPHandler} is responsible for HTTP requests and JSON handling\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+@NonNullByDefault\n+public class HTTPHandler {\n+    private static final Logger logger = LoggerFactory.getLogger(HTTPHandler.class);\n+    private static String sensorUrl = \"http://data.sensor.community/airrohr/v1/sensor/\";\n+    private static @Nullable HttpClient commonHttpClient;\n+\n+    public static final String P1 = \"P1\";\n+    public static final String P2 = \"P2\";\n+\n+    public static final String TEMPERATURE = \"temperature\";\n+    public static final String HUMIDITY = \"humidity\";\n+    public static final String PRESSURE = \"pressure\";\n+    public static final String PRESSURE_SEALEVEL = \"pressure_at_sealevel\";\n+\n+    public static final String NOISE_EQ = \"noise_LAeq\";\n+    public static final String NOISE_MIN = \"noise_LA_min\";\n+    public static final String NOISE_MAX = \"noise_LA_max\";\n+\n+    public static void init(HttpClient httpClient) {\n+        commonHttpClient = httpClient;\n+    }\n+\n+    public static @Nullable String getResponse(String sensorId) {\n+        if (commonHttpClient == null) {\n+            logger.warn(\"HTTP Client not initialized\");\n+            return null;\n+        }\n+        String url = sensorUrl + sensorId + \"/\";\n+        try {\n+            ContentResponse contentResponse = commonHttpClient.newRequest(url).timeout(10, TimeUnit.SECONDS).send();\n+            int httpStatus = contentResponse.getStatus();\n+            String content = contentResponse.getContentAsString();\n+            logger.debug(\"Sensor response: {}\", httpStatus);\n+            switch (httpStatus) {\n+                case 200:\n+                    return content;\n+                case 400:\n+                case 401:\n+                case 404:\n+                    logger.info(\"Sensor response: {}\", httpStatus);\n+                    return null;\n+                default:\n+                    return null;\n+            }\n+        } catch (InterruptedException | TimeoutException | ExecutionException e) {\n+            logger.warn(\"Exception when calling {}\", url);\n+            return null;\n+        }\n+    }\n+\n+    public static @Nullable List<SensorDataValue> getLatestValues(String response) {\n+        Gson gson = new Gson();\n+        SensorData[] valueArray = gson.fromJson(response, SensorData[].class);\n+        if (valueArray.length == 0) {\n+            return null;\n+        } else if (valueArray.length == 1) {\n+            SensorData v = valueArray[0];\n+            return v.getSensordatavalues();\n+        } else if (valueArray.length > 1) {\n+            // declare first item as latest\n+            SensorData latestData = valueArray[0];\n+            String latestTimeStr = latestData.getTimeStamp();\n+            Date latestTime = DateTimeUtils.toDate(latestTimeStr);\n+            if (latestTime == null) {\n+                logDateConversionError(response, latestData);\n+            }\n+            for (int i = 1; i < valueArray.length; i++) {\n+                SensorData iterData = valueArray[i];\n+                String iterTimeStr = iterData.getTimeStamp();\n+                Date iterTime = DateTimeUtils.toDate(iterTimeStr);\n+                if (iterTime == null) {\n+                    logDateConversionError(response, latestData);\n+                }\n+                if (iterTime != null && latestTime != null) {\n+                    if (latestTime.before(iterTime)) {\n+                        // found item is newer - take it as latest\n+                        latestTime = iterTime;\n+                        latestData = iterData;\n+                    } // else - found item is older - nothing to do\n+\n+                } else {\n+                    logger.warn(\"One or two dates cannot be decoded 1) {} 2) {}\", iterTimeStr, latestTimeStr);\n+                }\n+            }\n+            return latestData.getSensordatavalues();\n+        } else {\n+            return null;\n+        }\n+    }\n+\n+    public static void logDateConversionError(final String response, final Object dto) {\n+        logger.warn(\"Unable to get timestamp\");\n+        logger.warn(\"Response: {}\", response);\n+        Gson gson = new Gson();\n+        String json = gson.toJson(dto);\n+        logger.warn(\"GSon: {}\", json);\n+    }\n+\n+    public static boolean isParticulate(@Nullable List<SensorDataValue> valueList) {\n+        if (valueList == null) {\n+            return false;\n+        }\n+        Iterator<SensorDataValue> iter = valueList.iterator();\n+        while (iter.hasNext()) {\n+            SensorDataValue v = iter.next();\n+            if (!(v.getValue_type().equals(P1) || v.getValue_type().equals(P2))) {\n+                return false;\n+            }\n+        }\n+        return true;", "originalCommit": "6996467c5ab723d3e7402fb62dad898cfd382190", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwNTQ4NQ==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453205485", "bodyText": "Nice - changed for all isXYZ functions", "author": "weymann", "createdAt": "2020-07-11T15:26:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM1MjMwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM1Mzg1Mw==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r452353853", "bodyText": "This could be final (and upper case, then)", "author": "fwolter", "createdAt": "2020-07-09T16:47:20Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/utils/DateTimeUtils.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.utils;\n+\n+import java.text.ParseException;\n+import java.text.SimpleDateFormat;\n+import java.util.Date;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+/**\n+ * The {@link DateTimeUtils} class provides helpers for converting Dates and Times.\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+@NonNullByDefault\n+public class DateTimeUtils {\n+    private static SimpleDateFormat sdf = new SimpleDateFormat(\"YYYY-mm-dd hh:mm:ss\");", "originalCommit": "6996467c5ab723d3e7402fb62dad898cfd382190", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwNTczMw==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453205733", "bodyText": "Done", "author": "weymann", "createdAt": "2020-07-11T15:29:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM1Mzg1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM1NDA5Mw==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r452354093", "bodyText": "Is there a reason why this is synchronized?", "author": "fwolter", "createdAt": "2020-07-09T16:47:44Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/utils/DateTimeUtils.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.utils;\n+\n+import java.text.ParseException;\n+import java.text.SimpleDateFormat;\n+import java.util.Date;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+/**\n+ * The {@link DateTimeUtils} class provides helpers for converting Dates and Times.\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+@NonNullByDefault\n+public class DateTimeUtils {\n+    private static SimpleDateFormat sdf = new SimpleDateFormat(\"YYYY-mm-dd hh:mm:ss\");\n+\n+    public static synchronized @Nullable Date toDate(String dateTime) {", "originalCommit": "6996467c5ab723d3e7402fb62dad898cfd382190", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE4NjEwMA==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453186100", "bodyText": "Without synchronize I get a checkstyle warning: https://pmd.github.io/pmd-6.7.0/pmd_rules_java_multithreading.html#unsynchronizedstaticdateformatter", "author": "weymann", "createdAt": "2020-07-11T11:34:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM1NDA5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM1NDI2NA==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r452354264", "bodyText": "You might want to log this error.", "author": "fwolter", "createdAt": "2020-07-09T16:47:59Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/utils/DateTimeUtils.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.utils;\n+\n+import java.text.ParseException;\n+import java.text.SimpleDateFormat;\n+import java.util.Date;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+/**\n+ * The {@link DateTimeUtils} class provides helpers for converting Dates and Times.\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+@NonNullByDefault\n+public class DateTimeUtils {\n+    private static SimpleDateFormat sdf = new SimpleDateFormat(\"YYYY-mm-dd hh:mm:ss\");\n+\n+    public static synchronized @Nullable Date toDate(String dateTime) {\n+        try {\n+            return sdf.parse(dateTime);\n+        } catch (ParseException | NumberFormatException e) {\n+            return null;", "originalCommit": "6996467c5ab723d3e7402fb62dad898cfd382190", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwNTUwNg==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453205506", "bodyText": "Done", "author": "weymann", "createdAt": "2020-07-11T15:26:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM1NDI2NA=="}], "type": "inlineReview"}, {"oid": "c18d9a787490a08772cf9fdb3f0331ef46432701", "url": "https://github.com/openhab/openhab-addons/commit/c18d9a787490a08772cf9fdb3f0331ef46432701", "message": "Correct review findings\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-07-11T15:06:00Z", "type": "forcePushed"}, {"oid": "9847b2b0eca6c09ec70ca98156ab7b4206f251c8", "url": "https://github.com/openhab/openhab-addons/commit/9847b2b0eca6c09ec70ca98156ab7b4206f251c8", "message": "Use SerializedName annotation to eliminate all checkstyle warnings\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-07-11T21:58:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg0MDY0Mg==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453840642", "bodyText": "Syntactical sugar\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @SerializedName(value = \"exact_location\")\n          \n          \n            \n                @SerializedName(\"exact_location\")", "author": "fwolter", "createdAt": "2020-07-13T18:17:38Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/dto/Location.java", "diffHunk": "@@ -0,0 +1,87 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.dto;\n+\n+import com.google.gson.annotations.SerializedName;\n+\n+/**\n+ * The {@link LuftdatenInfo} class definition for Logging identification\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+public class Location {\n+    private int id;\n+    private String country;\n+    private String altitude;\n+    private String latitude;\n+    private String longitude;\n+    private int indoor;\n+    @SerializedName(value = \"exact_location\")", "originalCommit": "c5894e846a920e09e59ce28dd5a6a3ad158a0229", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDM1MDQwOQ==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r454350409", "bodyText": "Ok, changed in all occurences", "author": "weymann", "createdAt": "2020-07-14T13:20:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg0MDY0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg0MDg5OQ==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453840899", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void setExactLocation(Integer exactLocation) {\n          \n          \n            \n                public void setExactLocation(int exactLocation) {", "author": "fwolter", "createdAt": "2020-07-13T18:18:05Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/dto/Location.java", "diffHunk": "@@ -0,0 +1,87 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.dto;\n+\n+import com.google.gson.annotations.SerializedName;\n+\n+/**\n+ * The {@link LuftdatenInfo} class definition for Logging identification\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+public class Location {\n+    private int id;\n+    private String country;\n+    private String altitude;\n+    private String latitude;\n+    private String longitude;\n+    private int indoor;\n+    @SerializedName(value = \"exact_location\")\n+    private int exactLocation;\n+\n+    public int getId() {\n+        return id;\n+    }\n+\n+    public void setId(int id) {\n+        this.id = id;\n+    }\n+\n+    public String getCountry() {\n+        return country;\n+    }\n+\n+    public void setCountry(String country) {\n+        this.country = country;\n+    }\n+\n+    public String getAltitude() {\n+        return altitude;\n+    }\n+\n+    public void setAltitude(String altitude) {\n+        this.altitude = altitude;\n+    }\n+\n+    public String getLatitude() {\n+        return latitude;\n+    }\n+\n+    public void setLatitude(String latitude) {\n+        this.latitude = latitude;\n+    }\n+\n+    public String getLongitude() {\n+        return longitude;\n+    }\n+\n+    public void setLongitude(String longitude) {\n+        this.longitude = longitude;\n+    }\n+\n+    public Integer getIndoor() {\n+        return indoor;\n+    }\n+\n+    public void setIndoor(int indoor) {\n+        this.indoor = indoor;\n+    }\n+\n+    public int getExactLocation() {\n+        return exactLocation;\n+    }\n+\n+    public void setExactLocation(Integer exactLocation) {", "originalCommit": "c5894e846a920e09e59ce28dd5a6a3ad158a0229", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDM1NDk3Mg==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r454354972", "bodyText": "Ups, missed this correction from first review", "author": "weymann", "createdAt": "2020-07-14T13:27:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg0MDg5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg0MjgwNQ==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453842805", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    logger.warn(\"No values deliverd by Sensor.  Trying to recover in next refresh\");\n          \n          \n            \n                                    logger.warn(\"No values delivered by Sensor. Trying to recover in next refresh\");", "author": "fwolter", "createdAt": "2020-07-13T18:21:27Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/handler/BaseSensorHandler.java", "diffHunk": "@@ -0,0 +1,187 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.handler;\n+\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.openhab.binding.luftdateninfo.internal.LuftdatenInfoConfiguration;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link PMHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+@NonNullByDefault\n+public abstract class BaseSensorHandler extends BaseThingHandler {\n+\n+    protected static final int REFRESH_INTERVAL_MIN = 5;\n+    protected static final HTTPHandler HTTP = new HTTPHandler();\n+    private static final LuftdatenInfoConfiguration DEFAULT_CONFIG = new LuftdatenInfoConfiguration();\n+    protected final Logger logger = LoggerFactory.getLogger(BaseSensorHandler.class);\n+\n+    protected LuftdatenInfoConfiguration config = DEFAULT_CONFIG;\n+    protected @Nullable ScheduledFuture<?> refreshJob;\n+\n+    protected ConfigStatus configStatus = ConfigStatus.UNKNOWN;\n+\n+    public enum ConfigStatus {\n+        OK,\n+        IS_NULL,\n+        SENSOR_IS_NULL,\n+        SENSOR_NOT_A_NUMBER,\n+        UNKNOWN\n+    };\n+\n+    protected UpdateStatus updateStatus = UpdateStatus.UNKNOWN;\n+\n+    public enum UpdateStatus {\n+        OK,\n+        CONNECTION_ERROR,\n+        VALUE_ERROR,\n+        VALUE_EMPTY,\n+        UNKNOWN\n+    }\n+\n+    protected LifecycleStatus lifecycleStatus = LifecycleStatus.UNKNOWN;\n+\n+    public enum LifecycleStatus {\n+        UNKNOWN,\n+        RUNNING,\n+        INITIALIZING,\n+        DISPOSED\n+    }\n+\n+    public BaseSensorHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            updateFromCache();\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        lifecycleStatus = LifecycleStatus.INITIALIZING;\n+        scheduler.execute(() -> {\n+            startUp();\n+        });\n+    }\n+\n+    private void startUp() {\n+        config = getConfigAs(LuftdatenInfoConfiguration.class);\n+        configStatus = checkConfig(config);\n+        if (configStatus == ConfigStatus.OK) {\n+            update();\n+            if (updateStatus == UpdateStatus.OK) {\n+                updateStatus(ThingStatus.ONLINE);\n+                logger.debug(\"Start refresh job at interval {} min.\", REFRESH_INTERVAL_MIN);\n+                startSchedule();\n+            } else {\n+                switch (updateStatus) {\n+                    case CONNECTION_ERROR:\n+                        logger.warn(\"Update failed due to Connection error. Trying to recover in next refresh\");\n+                        // start job even if first update isn't valid\n+                        startSchedule();\n+                        updateStatus(ThingStatus.OFFLINE);\n+                        break;\n+                    case VALUE_EMPTY:\n+                        logger.warn(\"No values deliverd by Sensor.  Trying to recover in next refresh\");", "originalCommit": "c5894e846a920e09e59ce28dd5a6a3ad158a0229", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDM2MDIzNw==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r454360237", "bodyText": "Corrected", "author": "weymann", "createdAt": "2020-07-14T13:35:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg0MjgwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg0MzY5MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453843691", "bodyText": "You could feed the message into updateStatus() to display it in PaperUI. Then, the log message can be removed, since the framework is logging it. Same for the others.", "author": "fwolter", "createdAt": "2020-07-13T18:23:04Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/handler/BaseSensorHandler.java", "diffHunk": "@@ -0,0 +1,187 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.handler;\n+\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.openhab.binding.luftdateninfo.internal.LuftdatenInfoConfiguration;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link PMHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+@NonNullByDefault\n+public abstract class BaseSensorHandler extends BaseThingHandler {\n+\n+    protected static final int REFRESH_INTERVAL_MIN = 5;\n+    protected static final HTTPHandler HTTP = new HTTPHandler();\n+    private static final LuftdatenInfoConfiguration DEFAULT_CONFIG = new LuftdatenInfoConfiguration();\n+    protected final Logger logger = LoggerFactory.getLogger(BaseSensorHandler.class);\n+\n+    protected LuftdatenInfoConfiguration config = DEFAULT_CONFIG;\n+    protected @Nullable ScheduledFuture<?> refreshJob;\n+\n+    protected ConfigStatus configStatus = ConfigStatus.UNKNOWN;\n+\n+    public enum ConfigStatus {\n+        OK,\n+        IS_NULL,\n+        SENSOR_IS_NULL,\n+        SENSOR_NOT_A_NUMBER,\n+        UNKNOWN\n+    };\n+\n+    protected UpdateStatus updateStatus = UpdateStatus.UNKNOWN;\n+\n+    public enum UpdateStatus {\n+        OK,\n+        CONNECTION_ERROR,\n+        VALUE_ERROR,\n+        VALUE_EMPTY,\n+        UNKNOWN\n+    }\n+\n+    protected LifecycleStatus lifecycleStatus = LifecycleStatus.UNKNOWN;\n+\n+    public enum LifecycleStatus {\n+        UNKNOWN,\n+        RUNNING,\n+        INITIALIZING,\n+        DISPOSED\n+    }\n+\n+    public BaseSensorHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            updateFromCache();\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        lifecycleStatus = LifecycleStatus.INITIALIZING;\n+        scheduler.execute(() -> {\n+            startUp();\n+        });\n+    }\n+\n+    private void startUp() {\n+        config = getConfigAs(LuftdatenInfoConfiguration.class);\n+        configStatus = checkConfig(config);\n+        if (configStatus == ConfigStatus.OK) {\n+            update();\n+            if (updateStatus == UpdateStatus.OK) {\n+                updateStatus(ThingStatus.ONLINE);\n+                logger.debug(\"Start refresh job at interval {} min.\", REFRESH_INTERVAL_MIN);\n+                startSchedule();\n+            } else {\n+                switch (updateStatus) {\n+                    case CONNECTION_ERROR:\n+                        logger.warn(\"Update failed due to Connection error. Trying to recover in next refresh\");\n+                        // start job even if first update isn't valid\n+                        startSchedule();\n+                        updateStatus(ThingStatus.OFFLINE);\n+                        break;\n+                    case VALUE_EMPTY:\n+                        logger.warn(\"No values deliverd by Sensor.  Trying to recover in next refresh\");\n+                        // start job even if first update isn't valid\n+                        startSchedule();\n+                        updateStatus(ThingStatus.ONLINE);\n+                        break;\n+                    case VALUE_ERROR:\n+                        logger.warn(\n+                                \"Sensor values doesn't match - please check if Sensor ID is delivering the correct Thing channel values\");\n+                        updateStatus(ThingStatus.OFFLINE);", "originalCommit": "c5894e846a920e09e59ce28dd5a6a3ad158a0229", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDM1Mzc3NA==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r454353774", "bodyText": "Good hint - I'll do so!", "author": "weymann", "createdAt": "2020-07-14T13:25:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg0MzY5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg0Njc3NA==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453846774", "bodyText": "Next time implementing a static only class, you could take a look at the singleton pattern. That'd be a better object oriented programming approach.", "author": "fwolter", "createdAt": "2020-07-13T18:28:12Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/handler/HTTPHandler.java", "diffHunk": "@@ -0,0 +1,159 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.handler;\n+\n+import java.util.Date;\n+import java.util.List;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.openhab.binding.luftdateninfo.internal.dto.SensorData;\n+import org.openhab.binding.luftdateninfo.internal.dto.SensorDataValue;\n+import org.openhab.binding.luftdateninfo.internal.utils.DateTimeUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+\n+/**\n+ * The {@link HTTPHandler} is responsible for HTTP requests and JSON handling\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+@NonNullByDefault\n+public class HTTPHandler {", "originalCommit": "c5894e846a920e09e59ce28dd5a6a3ad158a0229", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQxNTUzMw==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r454415533", "bodyText": "Honestly I'm not sure. In principle I just want a static function which transforms an URL into a JSON response. For this I don't need an instance - everything is executed on local variables on stack. But if I want to use the logger inside static functions checkstyle responds \"static Logger => Bad Practice\"\nI've no problem to switch to singleton pattern even if it's not my preferred solution.", "author": "weymann", "createdAt": "2020-07-14T14:50:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg0Njc3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjAwNzg4MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r456007881", "bodyText": "IMHO you can leave it if you want. I would make it singleton, because of the storage of the HTTPHandler. It's a matter of taste.", "author": "fwolter", "createdAt": "2020-07-16T19:03:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg0Njc3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg1MDE1MA==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r453850150", "bodyText": "Can the comment be removed?", "author": "fwolter", "createdAt": "2020-07-13T18:33:30Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/test/java/org/openhab/binding/luftdateninfo/internal/mock/ThingMock.java", "diffHunk": "@@ -0,0 +1,149 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.mock;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.config.core.Configuration;\n+import org.eclipse.smarthome.core.thing.Channel;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingStatusInfo;\n+import org.eclipse.smarthome.core.thing.ThingTypeUID;\n+import org.eclipse.smarthome.core.thing.ThingUID;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+\n+/**\n+ * The {@link ThingMock} Thing Mock\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+@NonNullByDefault\n+public class ThingMock implements Thing {\n+    private Configuration config = new Configuration(); // = new HashMap<String, Object>();", "originalCommit": "c5894e846a920e09e59ce28dd5a6a3ad158a0229", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDM2MzE4MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r454363181", "bodyText": "Sure", "author": "weymann", "createdAt": "2020-07-14T13:39:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg1MDE1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTA5NzczMA==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r471097730", "bodyText": "Joda found its replacement in Java 8. You could use ZonedDateTime.", "author": "fwolter", "createdAt": "2020-08-16T10:53:52Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/handler/BaseSensorHandler.java", "diffHunk": "@@ -24,7 +26,9 @@\n import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n import org.eclipse.smarthome.core.types.Command;\n import org.eclipse.smarthome.core.types.RefreshType;\n+import org.joda.time.DateTime;", "originalCommit": "4a26ebca63244d12dd2accccbc6811fb0480c049", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTEyNzUzMA==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r471127530", "bodyText": "Sorry for the rework. But after my observations during running this binding it was necessary:\n\n\nREST API calls of luftdateninfo are taking sometimes a lot of time. Many warnings were printed in the logs which isn't covenient. Now http timeout is increased and details with timestamp are delivered via \"updateStatus\" so they are shown in the UI\n\n\nUoM wasn't properly defined in sitemap and items. This is corrected\n\n\nTranslations on channel-type were missing\n\n\nI think it was worth to apply these corrections before a second reviewer starts his work.", "author": "weymann", "createdAt": "2020-08-16T15:45:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTA5NzczMA=="}], "type": "inlineReview"}, {"oid": "471d6815e742b5f886fc7ced86c340cc5f3544d0", "url": "https://github.com/openhab/openhab-addons/commit/471d6815e742b5f886fc7ced86c340cc5f3544d0", "message": "switch to java.time.LocalDateTime\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-08-16T14:37:53Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDEwMDYxOQ==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r474100619", "bodyText": "180 sec. seem a bit long for the timeout. The framework's safe caller will kick in after 15 sec.\n10 sec. would be a better value.", "author": "fwolter", "createdAt": "2020-08-20T16:08:06Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/handler/HTTPHandler.java", "diffHunk": "@@ -0,0 +1,159 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.handler;\n+\n+import java.time.LocalDateTime;\n+import java.util.List;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.ContentResponse;\n+import org.openhab.binding.luftdateninfo.internal.dto.SensorData;\n+import org.openhab.binding.luftdateninfo.internal.dto.SensorDataValue;\n+import org.openhab.binding.luftdateninfo.internal.utils.DateTimeUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+\n+/**\n+ * The {@link HTTPHandler} is responsible for HTTP requests and JSON handling\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+@NonNullByDefault\n+public class HTTPHandler {\n+    private final Logger logger = LoggerFactory.getLogger(HTTPHandler.class);\n+\n+    private static final Gson GSON = new Gson();\n+    private static final HTTPHandler HTTP_HANDLER = new HTTPHandler();\n+\n+    public static final String P1 = \"P1\";\n+    public static final String P2 = \"P2\";\n+\n+    public static final String TEMPERATURE = \"temperature\";\n+    public static final String HUMIDITY = \"humidity\";\n+    public static final String PRESSURE = \"pressure\";\n+    public static final String PRESSURE_SEALEVEL = \"pressure_at_sealevel\";\n+\n+    public static final String NOISE_EQ = \"noise_LAeq\";\n+    public static final String NOISE_MIN = \"noise_LA_min\";\n+    public static final String NOISE_MAX = \"noise_LA_max\";\n+\n+    private static String sensorUrl = \"http://data.sensor.community/airrohr/v1/sensor/\";\n+    private static @Nullable HttpClient commonHttpClient;\n+\n+    public static void init(HttpClient httpClient) {\n+        commonHttpClient = httpClient;\n+    }\n+\n+    public static HTTPHandler getHandler() {\n+        return HTTP_HANDLER;\n+    }\n+\n+    public @Nullable String getResponse(int sensorId)\n+            throws InterruptedException, TimeoutException, ExecutionException {\n+        HttpClient localClient = commonHttpClient;\n+        if (localClient == null) {\n+            logger.warn(\"HTTP Client not initialized\");\n+            return null;\n+        } else {\n+            String url = sensorUrl + sensorId + \"/\";\n+            ContentResponse contentResponse = localClient.newRequest(url).timeout(180, TimeUnit.SECONDS).send();", "originalCommit": "d9dc71a0d67e134482b67f8297052f83c3243d75", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYxNjQwMw==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r478616403", "bodyText": "Ok, let me leave then the 15 seconds timeout.", "author": "weymann", "createdAt": "2020-08-27T18:32:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDEwMDYxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODY1Nzg4OQ==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r478657889", "bodyText": "That might lead to a race condition, as the safe caller timeout is 15sec, too. If you want to use higher timeouts, you could use Jetty's async API.", "author": "fwolter", "createdAt": "2020-08-27T19:51:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDEwMDYxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyNzU1NQ==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r479427555", "bodyText": "Ok, let me get this straight because I'm implementing a binding for BMW ConnectedDrive which is based on REST API too and I don't want to fall in the same trap again.\nI switched back to my previous timeout of 30 seconds and measured the duration.\n2020-08-28 14:26:58.322 [WARN ] [o.internal.handler.BaseSensorHandler] - Sensor 39745 call duration 30006 ms\n2020-08-28 14:26:58.385 [INFO ] [o.internal.handler.BaseSensorHandler] - Total timeout 30000 ms elapsed / 2020-08-28 14:26:58\n\nI didn't observe a \"safe caller timeout\" after 15 seconds. I also don't know which race condition can happen in/after this synchronous call.\nI've also taken a look into the Jetty Asynchronous API => https://www.eclipse.org/jetty/documentation/current/http-client-api.html#http-client-async . In general I see the use cases \"large content download\" and \"parallel requests\" which is in my opinion not fitting to this sensor binding.\nSo my question is why it's not suitable to apply a timeout like 1 Minute with the above observations?\nI really like to have your honest opinion.", "author": "weymann", "createdAt": "2020-08-28T17:00:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDEwMDYxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUxMTQ1Nw==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r479511457", "bodyText": "The safe caller only kicks in if the code is invoked by the framework e.g. via handleCommand(). I just saw that your code will be invoked only within scheduler threads. These have no time limit. But that doesn't mean that you should block them longer as needed, as the threads in the scheduler pool are shared amongst all ThingHandlers of all bindings.\nI think a timeout of more than 10 sec. is a bit unreasonable for most use cases. There was a use case with an embedded device, which was really slow in responding. A timeout of 30 sec. was sufficient. So, I'm wondering what use case you have in mind when specifying an even higher timeout.\nJetty's async API is not only useful for \"large content downloads, for parallel processing of requests/responses\", but also if \"efficient thread and resource utilization is a key factor\". The last points are quite important, as openHAB often runs on small hardware like raspberries.\nIMHO event-driven program execution should be preferred over blocking, where possible.", "author": "fwolter", "createdAt": "2020-08-28T20:06:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDEwMDYxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTk4OTQ3Nw==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r481989477", "bodyText": "I fully agree! I played around with async API and I really like the unblocking character. I'll perform changes accordingly.", "author": "weymann", "createdAt": "2020-09-02T11:13:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDEwMDYxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjYyNzYxNw==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r486627617", "bodyText": "I don't want to push you, but the merge window for 2.5.9 comes closer and closer. If we miss that, the binding must be ported to OH3 manually.", "author": "fwolter", "createdAt": "2020-09-10T20:54:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDEwMDYxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzE1Mjc5Ng==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r487152796", "bodyText": "No problem. Sorry, I'm too busy with my next contribution. But this was a very good hint because it's also related to get data from REST API.\nI applied the changes and tested them. As said I like the unblocking character and also makes the error handling more comprehensive.", "author": "weymann", "createdAt": "2020-09-11T16:22:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDEwMDYxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM2NjA2MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r487366061", "bodyText": "fields should be at the top of the class.", "author": "cpmeister", "createdAt": "2020-09-12T04:28:22Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/dto/SensorDataValue.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.dto;\n+\n+import com.google.gson.annotations.SerializedName;\n+\n+/**\n+ * The {@link SensorDataValue} Data Transfer Object\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+public class SensorDataValue {\n+    private long id;\n+    @SerializedName(\"value_type\")\n+    private String valueType;\n+\n+    @Override\n+    public String toString() {\n+        return valueType + \":\" + value;\n+    }\n+\n+    public long getId() {\n+        return id;\n+    }\n+\n+    public void setId(long id) {\n+        this.id = id;\n+    }\n+\n+    public String getValueType() {\n+        return valueType;\n+    }\n+\n+    public void setValueType(String valueType) {\n+        this.valueType = valueType;\n+    }\n+\n+    public String getValue() {\n+        return value;\n+    }\n+\n+    public void setValue(String value) {\n+        this.value = value;\n+    }\n+\n+    private String value;", "originalCommit": "8db91b0e4884065bda6e387e97d1a756b538ab8a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQwNjY0Mw==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r487406643", "bodyText": "Fixed", "author": "weymann", "createdAt": "2020-09-12T12:50:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM2NjA2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM2NjIyMQ==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r487366221", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    scheduler.execute(() -> {\n          \n          \n            \n                        startUp();\n          \n          \n            \n                    });\n          \n          \n            \n                    scheduler.execute(this::startUp);", "author": "cpmeister", "createdAt": "2020-09-12T04:30:09Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/handler/BaseSensorHandler.java", "diffHunk": "@@ -0,0 +1,214 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.handler;\n+\n+import java.time.LocalDateTime;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.openhab.binding.luftdateninfo.internal.LuftdatenInfoConfiguration;\n+import org.openhab.binding.luftdateninfo.internal.utils.DateTimeUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link PMHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+@NonNullByDefault\n+public abstract class BaseSensorHandler extends BaseThingHandler {\n+    private static final LuftdatenInfoConfiguration DEFAULT_CONFIG = new LuftdatenInfoConfiguration();\n+    private static final String EMPTY = \"\";\n+\n+    protected static final int REFRESH_INTERVAL_MIN = 5;\n+    protected final Logger logger = LoggerFactory.getLogger(BaseSensorHandler.class);\n+    protected LuftdatenInfoConfiguration config = DEFAULT_CONFIG;\n+    protected ConfigStatus configStatus = ConfigStatus.UNKNOWN;\n+    protected ThingStatus myThingStatus = ThingStatus.UNKNOWN;\n+    protected UpdateStatus lastUpdateStatus = UpdateStatus.UNKNOWN;\n+    protected @Nullable ScheduledFuture<?> refreshJob;\n+\n+    public enum ConfigStatus {\n+        OK,\n+        IS_NULL,\n+        SENSOR_IS_NULL,\n+        SENSOR_ID_NEGATIVE,\n+        UNKNOWN\n+    };\n+\n+    public enum UpdateStatus {\n+        OK,\n+        CONNECTION_ERROR,\n+        CONNECTION_EXCEPTION,\n+        VALUE_ERROR,\n+        VALUE_EMPTY,\n+        UNKNOWN\n+    }\n+\n+    protected LifecycleStatus lifecycleStatus = LifecycleStatus.UNKNOWN;\n+\n+    public enum LifecycleStatus {\n+        UNKNOWN,\n+        RUNNING,\n+        INITIALIZING,\n+        DISPOSED\n+    }\n+\n+    public BaseSensorHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            updateFromCache();\n+        }\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        lifecycleStatus = LifecycleStatus.INITIALIZING;\n+        scheduler.execute(() -> {\n+            startUp();\n+        });", "originalCommit": "8db91b0e4884065bda6e387e97d1a756b538ab8a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQwNjc5Mg==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r487406792", "bodyText": "Fixed", "author": "weymann", "createdAt": "2020-09-12T12:52:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM2NjIyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM2NzAzMQ==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r487367031", "bodyText": "Perhaps it would be better to use Double.NaN?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private static final Double UNDEF = new Double(-1);\n          \n          \n            \n                private static final double UNDEF = Double.NaN;", "author": "cpmeister", "createdAt": "2020-09-12T04:40:15Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/utils/NumberUtils.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.utils;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+\n+/**\n+ * The {@link NumberUtils} class provides helpers for converting Numbers.\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+@NonNullByDefault\n+public class NumberUtils {\n+    private static final Double UNDEF = new Double(-1);", "originalCommit": "8db91b0e4884065bda6e387e97d1a756b538ab8a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQxNDUwNQ==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r487414505", "bodyText": "yes, sounds feasible", "author": "weymann", "createdAt": "2020-09-12T14:21:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM2NzAzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM2NzExMw==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r487367113", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Double value = UNDEF;\n          \n          \n            \n                    if (o instanceof Integer) {\n          \n          \n            \n                        value = (double) ((Integer) o).intValue();\n          \n          \n            \n                    } else if (o instanceof String) {\n          \n          \n            \n                        value = Double.parseDouble(o.toString());\n          \n          \n            \n                    } else {\n          \n          \n            \n                        value = (Double) o;\n          \n          \n            \n                    }\n          \n          \n            \n                    double value = UNDEF;\n          \n          \n            \n                    if (o instanceof Number) {\n          \n          \n            \n                        value = ((Number) o).doubleValue();\n          \n          \n            \n                    } else if (o instanceof String) {\n          \n          \n            \n                        value = Double.parseDouble(o.toString());\n          \n          \n            \n                    }", "author": "cpmeister", "createdAt": "2020-09-12T04:41:12Z", "path": "bundles/org.openhab.binding.luftdateninfo/src/main/java/org/openhab/binding/luftdateninfo/internal/utils/NumberUtils.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.luftdateninfo.internal.utils;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+\n+/**\n+ * The {@link NumberUtils} class provides helpers for converting Numbers.\n+ *\n+ * @author Bernd Weymann - Initial contribution\n+ */\n+@NonNullByDefault\n+public class NumberUtils {\n+    private static final Double UNDEF = new Double(-1);\n+\n+    public static double round(Object o, int places) {\n+        double value = convert(o);\n+\n+        // for negative places return plain number\n+        if (places < 0) {\n+            return value;\n+        }\n+\n+        long factor = (long) Math.pow(10, places);\n+        value = value * factor;\n+        long tmp = Math.round(value);\n+        return (double) tmp / factor;\n+    }\n+\n+    public static double convert(Object o) {\n+        // ensure value not null\n+        Double value = UNDEF;\n+        if (o instanceof Integer) {\n+            value = (double) ((Integer) o).intValue();\n+        } else if (o instanceof String) {\n+            value = Double.parseDouble(o.toString());\n+        } else {\n+            value = (Double) o;\n+        }", "originalCommit": "8db91b0e4884065bda6e387e97d1a756b538ab8a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQxNDUyOA==", "url": "https://github.com/openhab/openhab-addons/pull/7914#discussion_r487414528", "bodyText": "Corrected", "author": "weymann", "createdAt": "2020-09-12T14:22:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM2NzExMw=="}], "type": "inlineReview"}, {"oid": "806373d50252e31c3d14bcc3edc5102900d20bea", "url": "https://github.com/openhab/openhab-addons/commit/806373d50252e31c3d14bcc3edc5102900d20bea", "message": "resolve conflict after rebase\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T07:23:14Z", "type": "forcePushed"}, {"oid": "e942fa5db313421f61355ac7d4135e8cc1db724f", "url": "https://github.com/openhab/openhab-addons/commit/e942fa5db313421f61355ac7d4135e8cc1db724f", "message": "Initial commit\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:45:11Z", "type": "commit"}, {"oid": "8dca962fa896e9faad97f3801317f56effd1e857", "url": "https://github.com/openhab/openhab-addons/commit/8dca962fa896e9faad97f3801317f56effd1e857", "message": "Introduce BaseSensorHandler\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:45:12Z", "type": "commit"}, {"oid": "bcf31928a5d3d4fd9bf531b49407c1c8fe5e412d", "url": "https://github.com/openhab/openhab-addons/commit/bcf31928a5d3d4fd9bf531b49407c1c8fe5e412d", "message": "Test preparation\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:45:12Z", "type": "commit"}, {"oid": "9d8df678296a7a6e6e6653d6771c600b7c5d33d5", "url": "https://github.com/openhab/openhab-addons/commit/9d8df678296a7a6e6e6653d6771c600b7c5d33d5", "message": "Running tests with mocks\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:45:12Z", "type": "commit"}, {"oid": "6e99c247be45e3a483e29e85020a91c85e8bcf82", "url": "https://github.com/openhab/openhab-addons/commit/6e99c247be45e3a483e29e85020a91c85e8bcf82", "message": "Remove static error and warning static code checks\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:45:12Z", "type": "commit"}, {"oid": "b6890037c8460dba2d5796460bcea1a658156c3b", "url": "https://github.com/openhab/openhab-addons/commit/b6890037c8460dba2d5796460bcea1a658156c3b", "message": "Test all Handlers\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:45:13Z", "type": "commit"}, {"oid": "e8ab89801094893b26e1a5a48873fd4c312645a0", "url": "https://github.com/openhab/openhab-addons/commit/e8ab89801094893b26e1a5a48873fd4c312645a0", "message": "Test all Handlers\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:45:13Z", "type": "commit"}, {"oid": "28c34d918e6bd2a79310eac4f9b227fa141fd710", "url": "https://github.com/openhab/openhab-addons/commit/28c34d918e6bd2a79310eac4f9b227fa141fd710", "message": "Evaluate SensorDataValue dates - extended testing\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:45:13Z", "type": "commit"}, {"oid": "9206406bafb3b8dc0f55920da69a89ee3245229c", "url": "https://github.com/openhab/openhab-addons/commit/9206406bafb3b8dc0f55920da69a89ee3245229c", "message": "Rounding numbers for all channels for nicer looking\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:45:13Z", "type": "commit"}, {"oid": "ad3115a075102bc34dcb202fae4b2c90da0d5afc", "url": "https://github.com/openhab/openhab-addons/commit/ad3115a075102bc34dcb202fae4b2c90da0d5afc", "message": "Readme.md description added\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:45:13Z", "type": "commit"}, {"oid": "4888542d9bd6fea10820c7385fbe55b85ab47fec", "url": "https://github.com/openhab/openhab-addons/commit/4888542d9bd6fea10820c7385fbe55b85ab47fec", "message": "Logo and last description updates\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:45:14Z", "type": "commit"}, {"oid": "f33244d9b10e0eb94c9ab7a7c4e57c6f77bafc58", "url": "https://github.com/openhab/openhab-addons/commit/f33244d9b10e0eb94c9ab7a7c4e57c6f77bafc58", "message": "Update README.md\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:45:14Z", "type": "commit"}, {"oid": "0be2dc40b54673379b233a892e59398c499f43d9", "url": "https://github.com/openhab/openhab-addons/commit/0be2dc40b54673379b233a892e59398c499f43d9", "message": "Readme.md full example\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:45:14Z", "type": "commit"}, {"oid": "b11aa5dd2d3e1088027ef9a7cd836499406d7095", "url": "https://github.com/openhab/openhab-addons/commit/b11aa5dd2d3e1088027ef9a7cd836499406d7095", "message": "Remove checkstyle warnings\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:45:14Z", "type": "commit"}, {"oid": "7d59dd7fb7ee372c645110212e679dd15c62107c", "url": "https://github.com/openhab/openhab-addons/commit/7d59dd7fb7ee372c645110212e679dd15c62107c", "message": "Bugfix: catch additional NumberFormatException in DateTimeConversion\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:45:14Z", "type": "commit"}, {"oid": "413bb8c40aa842e3d0c8d2dbb490a256476a9a62", "url": "https://github.com/openhab/openhab-addons/commit/413bb8c40aa842e3d0c8d2dbb490a256476a9a62", "message": "Minor test and checkstyle updates\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:45:14Z", "type": "commit"}, {"oid": "22152ee3cf3440e0895e3a1298bd014407d2b1fb", "url": "https://github.com/openhab/openhab-addons/commit/22152ee3cf3440e0895e3a1298bd014407d2b1fb", "message": "Fix chackstyle \"low hanging fruit\"\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:45:14Z", "type": "commit"}, {"oid": "0a0a79b93219462ed9e98a34e34a67270b136cdd", "url": "https://github.com/openhab/openhab-addons/commit/0a0a79b93219462ed9e98a34e34a67270b136cdd", "message": "logging added to detect toDate conversion errors in trace\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:45:15Z", "type": "commit"}, {"oid": "dba5ec881c88e67b9159f83f30e18eb91d770eaa", "url": "https://github.com/openhab/openhab-addons/commit/dba5ec881c88e67b9159f83f30e18eb91d770eaa", "message": "Set default cache to undefined\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:45:15Z", "type": "commit"}, {"oid": "68b5e103b9bd8c3ba1c8d185ac26c7f9828e9942", "url": "https://github.com/openhab/openhab-addons/commit/68b5e103b9bd8c3ba1c8d185ac26c7f9828e9942", "message": "fix typo in main description\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:45:15Z", "type": "commit"}, {"oid": "1231559aefb568b3a0b9647cdfdc29c5dd7fc9fe", "url": "https://github.com/openhab/openhab-addons/commit/1231559aefb568b3a0b9647cdfdc29c5dd7fc9fe", "message": "Ensure non null values for all update values\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:45:15Z", "type": "commit"}, {"oid": "1b467891cd2c7fae6595bea06a88f2f07d70152a", "url": "https://github.com/openhab/openhab-addons/commit/1b467891cd2c7fae6595bea06a88f2f07d70152a", "message": "Update 2.5.6 => 2.5.7\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:45:15Z", "type": "commit"}, {"oid": "04e0e9a06fff609b4bf6d4c819cf6477426614c4", "url": "https://github.com/openhab/openhab-addons/commit/04e0e9a06fff609b4bf6d4c819cf6477426614c4", "message": "Bugfix: Sensor IDs exceeding int range - changed type to long\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:45:15Z", "type": "commit"}, {"oid": "cd56de06e6d464492949d71b116c8b071e699864", "url": "https://github.com/openhab/openhab-addons/commit/cd56de06e6d464492949d71b116c8b071e699864", "message": "Correct review findings\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:46:08Z", "type": "commit"}, {"oid": "ea406b645f1920ea5469b72088d183a3bf393e01", "url": "https://github.com/openhab/openhab-addons/commit/ea406b645f1920ea5469b72088d183a3bf393e01", "message": "Use SerializedName annotation to eliminate all checkstyle warnings\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:46:09Z", "type": "commit"}, {"oid": "0af50e32456f3b6cc7a0af7d92b562c3441488f8", "url": "https://github.com/openhab/openhab-addons/commit/0af50e32456f3b6cc7a0af7d92b562c3441488f8", "message": "start schedule if first update failed\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:46:09Z", "type": "commit"}, {"oid": "70d13155651ec2fb350bfb9a8cfe97f8bedb97cd", "url": "https://github.com/openhab/openhab-addons/commit/70d13155651ec2fb350bfb9a8cfe97f8bedb97cd", "message": "correct findings from second review\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:46:09Z", "type": "commit"}, {"oid": "293bc7a6704174612eddf3e620cc9d4a17d9e6c4", "url": "https://github.com/openhab/openhab-addons/commit/293bc7a6704174612eddf3e620cc9d4a17d9e6c4", "message": "correct example sensorids from text to int\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:46:09Z", "type": "commit"}, {"oid": "4ee36007ae2963e3c4d369547984e67608eadfde", "url": "https://github.com/openhab/openhab-addons/commit/4ee36007ae2963e3c4d369547984e67608eadfde", "message": "add german translation\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:46:09Z", "type": "commit"}, {"oid": "5d7e7d461a1979eda3f9d963aa270af08e17e0aa", "url": "https://github.com/openhab/openhab-addons/commit/5d7e7d461a1979eda3f9d963aa270af08e17e0aa", "message": "bugfix sensorid int plus translation correction\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:46:09Z", "type": "commit"}, {"oid": "01506c11058eee905fb36b8247e87fd75fcec792", "url": "https://github.com/openhab/openhab-addons/commit/01506c11058eee905fb36b8247e87fd75fcec792", "message": "remove accidently added side directory\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:46:10Z", "type": "commit"}, {"oid": "5da0dad4a4c6d452fac74e8c1e2165cdc969755c", "url": "https://github.com/openhab/openhab-addons/commit/5da0dad4a4c6d452fac74e8c1e2165cdc969755c", "message": "correct ThingStatus handling\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:46:10Z", "type": "commit"}, {"oid": "f8e53f1028423ed4edade7d17597afa30710fa7c", "url": "https://github.com/openhab/openhab-addons/commit/f8e53f1028423ed4edade7d17597afa30710fa7c", "message": "switch to JODA time\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:46:10Z", "type": "commit"}, {"oid": "a586b91ddd2ac21d02e6d6b32d8a77a45e2054ea", "url": "https://github.com/openhab/openhab-addons/commit/a586b91ddd2ac21d02e6d6b32d8a77a45e2054ea", "message": "switch to JODA time\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:46:10Z", "type": "commit"}, {"oid": "5fe3997f04ddd6190318c768d08976c0b1b2cd94", "url": "https://github.com/openhab/openhab-addons/commit/5fe3997f04ddd6190318c768d08976c0b1b2cd94", "message": "increase http request timeout\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:46:10Z", "type": "commit"}, {"oid": "cbe9b45cbb7fece518b55db5a925892b54ff5b91", "url": "https://github.com/openhab/openhab-addons/commit/cbe9b45cbb7fece518b55db5a925892b54ff5b91", "message": "increase http request timeout\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:46:10Z", "type": "commit"}, {"oid": "e9d2901c986765fffc9d319dc99826230187c1b3", "url": "https://github.com/openhab/openhab-addons/commit/e9d2901c986765fffc9d319dc99826230187c1b3", "message": "readme.md and status update corrections\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:46:11Z", "type": "commit"}, {"oid": "0ce89f2ddc04b81f3afc83ad46edd434d9b59e56", "url": "https://github.com/openhab/openhab-addons/commit/0ce89f2ddc04b81f3afc83ad46edd434d9b59e56", "message": "added channel-type translations\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:46:11Z", "type": "commit"}, {"oid": "765ebbacc9ca7e362da7dda3af3cc4022ad6228a", "url": "https://github.com/openhab/openhab-addons/commit/765ebbacc9ca7e362da7dda3af3cc4022ad6228a", "message": "update version 2.5.8\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:46:11Z", "type": "commit"}, {"oid": "a2f976e965d69a4bddd355e089743369d992052e", "url": "https://github.com/openhab/openhab-addons/commit/a2f976e965d69a4bddd355e089743369d992052e", "message": "switch to java.time.LocalDateTime\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:46:11Z", "type": "commit"}, {"oid": "4e4be02130bdc960e5f9b705056cf0b0069ef141", "url": "https://github.com/openhab/openhab-addons/commit/4e4be02130bdc960e5f9b705056cf0b0069ef141", "message": "reduce HTTP query timeout\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:46:11Z", "type": "commit"}, {"oid": "11dd0e047192f79d6152339d5a71f8ac2c86119f", "url": "https://github.com/openhab/openhab-addons/commit/11dd0e047192f79d6152339d5a71f8ac2c86119f", "message": "switch to async http requests\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:46:12Z", "type": "commit"}, {"oid": "0e55c1a6f7ce396b4f727ae62f7ee414f727df54", "url": "https://github.com/openhab/openhab-addons/commit/0e55c1a6f7ce396b4f727ae62f7ee414f727df54", "message": "adapt release to 2.5.9\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:46:12Z", "type": "commit"}, {"oid": "65271d79b6a9ef0b80711cce5a2775a29db32127", "url": "https://github.com/openhab/openhab-addons/commit/65271d79b6a9ef0b80711cce5a2775a29db32127", "message": "correct review findings\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T12:46:12Z", "type": "commit"}, {"oid": "a19a135169ab80d8ed95b4557525650dcc8c89b8", "url": "https://github.com/openhab/openhab-addons/commit/a19a135169ab80d8ed95b4557525650dcc8c89b8", "message": "resolve conflicts\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T13:23:03Z", "type": "commit"}, {"oid": "a19a135169ab80d8ed95b4557525650dcc8c89b8", "url": "https://github.com/openhab/openhab-addons/commit/a19a135169ab80d8ed95b4557525650dcc8c89b8", "message": "resolve conflicts\n\nSigned-off-by: Bernd <bernd.weymann@gmail.com>", "committedDate": "2020-09-17T13:23:03Z", "type": "forcePushed"}]}