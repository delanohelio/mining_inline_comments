{"pr_number": 9603, "pr_title": "[nikobus] open connection on refresh even if no modules exist", "pr_createdAt": "2020-12-30T15:42:16Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/9603", "timeline": [{"oid": "38d9c9e72dcb47e2d970b602bffd13a582244558", "url": "https://github.com/openhab/openhab-addons/commit/38d9c9e72dcb47e2d970b602bffd13a582244558", "message": "open connection on refresh even if no modules exist\n\nSigned-off-by: Wouter Denayer <wouter@denayer.com>", "committedDate": "2020-12-30T15:57:59Z", "type": "forcePushed"}, {"oid": "4cf0bed3c508483391e4b3b7e55e7ff5c04e702f", "url": "https://github.com/openhab/openhab-addons/commit/4cf0bed3c508483391e4b3b7e55e7ff5c04e702f", "message": "open connection on refresh even if no modules exist\n\nSigned-off-by: Wouter Denayer <wouter@denayer.com>", "committedDate": "2020-12-30T16:06:22Z", "type": "forcePushed"}, {"oid": "0baf8e5dfab3a831eea7502f6cb11093f1738c15", "url": "https://github.com/openhab/openhab-addons/commit/0baf8e5dfab3a831eea7502f6cb11093f1738c15", "message": "open connection on refresh even if no modules exist\n\nSigned-off-by: Wouter Denayer <wouter@denayer.com>", "committedDate": "2020-12-31T10:05:58Z", "type": "commit"}, {"oid": "0baf8e5dfab3a831eea7502f6cb11093f1738c15", "url": "https://github.com/openhab/openhab-addons/commit/0baf8e5dfab3a831eea7502f6cb11093f1738c15", "message": "open connection on refresh even if no modules exist\n\nSigned-off-by: Wouter Denayer <wouter@denayer.com>", "committedDate": "2020-12-31T10:05:58Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ4Njk4Nw==", "url": "https://github.com/openhab/openhab-addons/pull/9603#discussion_r550486987", "bodyText": "The log message could be removed, as the status update is already logged by the framework.\nThe state change originated by updateStatus() is logged to events.log. Including the status detail message.", "author": "fwolter", "createdAt": "2020-12-31T13:48:43Z", "path": "bundles/org.openhab.binding.nikobus/src/main/java/org/openhab/binding/nikobus/internal/handler/NikobusPcLinkHandler.java", "diffHunk": "@@ -329,6 +329,22 @@ private void refresh() {\n         List<Thing> things = getThing().getThings().stream()\n                 .filter(thing -> thing.getHandler() instanceof NikobusModuleHandler).collect(Collectors.toList());\n \n+\n+        // if there are command listeners then we need an open connection even if no modules exist\n+        if (!commandListeners.isEmpty()) {\n+            NikobusConnection connection = this.connection;\n+            if (connection == null) {\n+                return;\n+            }        \t\n+            try {\n+                connectIfNeeded(connection);\n+            } catch (IOException e) {\n+                logger.debug(\"refresh failed due {}\", e.getMessage(), e);", "originalCommit": "0baf8e5dfab3a831eea7502f6cb11093f1738c15", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5a6a187a1c330a7b005bbf9adcf975220a77f662", "url": "https://github.com/openhab/openhab-addons/commit/5a6a187a1c330a7b005bbf9adcf975220a77f662", "message": "ran mvn spotless:apply\n\nSigned-off-by: Wouter Denayer <wouter@denayer.com>", "committedDate": "2020-12-31T14:16:52Z", "type": "commit"}, {"oid": "8b5fde768308e1ee809c8d0e83a326674610674f", "url": "https://github.com/openhab/openhab-addons/commit/8b5fde768308e1ee809c8d0e83a326674610674f", "message": "removed unnecessary file\n\nSigned-off-by: Wouter Denayer <wouter@denayer.com>", "committedDate": "2020-12-31T16:14:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDkxNjI0OA==", "url": "https://github.com/openhab/openhab-addons/pull/9603#discussion_r550916248", "bodyText": "Should this function return at this point? Or should the handler still be refreshed even if the thing is offline?", "author": "cpmeister", "createdAt": "2021-01-02T20:06:23Z", "path": "bundles/org.openhab.binding.nikobus/src/main/java/org/openhab/binding/nikobus/internal/handler/NikobusPcLinkHandler.java", "diffHunk": "@@ -329,6 +329,20 @@ private void refresh() {\n         List<Thing> things = getThing().getThings().stream()\n                 .filter(thing -> thing.getHandler() instanceof NikobusModuleHandler).collect(Collectors.toList());\n \n+        // if there are command listeners then we need an open connection even if no modules exist\n+        if (!commandListeners.isEmpty()) {\n+            NikobusConnection connection = this.connection;\n+            if (connection == null) {\n+                return;\n+            }\n+            try {\n+                connectIfNeeded(connection);\n+            } catch (IOException e) {\n+                connection.close();\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR, e.getMessage());\n+            }", "originalCommit": "8b5fde768308e1ee809c8d0e83a326674610674f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDk3NTU0MQ==", "url": "https://github.com/openhab/openhab-addons/pull/9603#discussion_r550975541", "bodyText": "good point, continuing does not make much sense if the connection is not available.", "author": "gitwouter", "createdAt": "2021-01-03T08:43:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDkxNjI0OA=="}], "type": "inlineReview"}, {"oid": "8021ce10c12577f82629401fe95d6e957a3178f2", "url": "https://github.com/openhab/openhab-addons/commit/8021ce10c12577f82629401fe95d6e957a3178f2", "message": "returning when the connection is offline since following code won't work\neither.\n\nSigned-off-by: Wouter Denayer <wouter@denayer.com>", "committedDate": "2021-01-03T18:25:52Z", "type": "commit"}, {"oid": "8021ce10c12577f82629401fe95d6e957a3178f2", "url": "https://github.com/openhab/openhab-addons/commit/8021ce10c12577f82629401fe95d6e957a3178f2", "message": "returning when the connection is offline since following code won't work\neither.\n\nSigned-off-by: Wouter Denayer <wouter@denayer.com>", "committedDate": "2021-01-03T18:25:52Z", "type": "forcePushed"}]}