{"pr_number": 7080, "pr_title": "[mqtt.homeassistant] Improve compatibility with Tasmota based color lights", "pr_createdAt": "2020-02-29T06:57:25Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7080", "timeline": [{"oid": "411cd036513355409e276f9c8d92069226bdf039", "url": "https://github.com/openhab/openhab-addons/commit/411cd036513355409e276f9c8d92069226bdf039", "message": "ixed bugs in ComponentLight and HomeAssistantThingHandler\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>", "committedDate": "2020-02-17T17:52:16Z", "type": "commit"}, {"oid": "0983a397341679b6f8d4db7948d63e98dd086da8", "url": "https://github.com/openhab/openhab-addons/commit/0983a397341679b6f8d4db7948d63e98dd086da8", "message": "ixed bugs in ComponentLight and HomeAssistantThingHandler\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>", "committedDate": "2020-02-17T22:22:53Z", "type": "commit"}, {"oid": "6ed9f5da6c2c1f38fcb451b52c3447b1075593b8", "url": "https://github.com/openhab/openhab-addons/commit/6ed9f5da6c2c1f38fcb451b52c3447b1075593b8", "message": "Merge branch '2.5.x' of https://github.com/mehoekstra/openhab-addons into 2.5.x", "committedDate": "2020-02-17T22:24:19Z", "type": "commit"}, {"oid": "e1c5847dd038f67a515f08fcd7e78e77cede7342", "url": "https://github.com/openhab/openhab-addons/commit/e1c5847dd038f67a515f08fcd7e78e77cede7342", "message": "Merge branch '2.5.x' of https://github.com/openhab/openhab-addons into 2.5.x\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>", "committedDate": "2020-02-19T04:45:57Z", "type": "commit"}, {"oid": "46f8d1d4a37d67381a03cb2778bd502b15e782b1", "url": "https://github.com/openhab/openhab-addons/commit/46f8d1d4a37d67381a03cb2778bd502b15e782b1", "message": "Rolling back so that only one file change is in this pull request.\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>", "committedDate": "2020-02-19T05:00:06Z", "type": "commit"}, {"oid": "9e971f76425b8490860fa8d8795ed425f372f1c6", "url": "https://github.com/openhab/openhab-addons/commit/9e971f76425b8490860fa8d8795ed425f372f1c6", "message": "Merge branch '2.5.x' of https://github.com/openhab/openhab-addons into tasmota", "committedDate": "2020-02-29T04:59:30Z", "type": "commit"}, {"oid": "387a0d69f57c5eaaf3a9f9a86bd26f78167c03b8", "url": "https://github.com/openhab/openhab-addons/commit/387a0d69f57c5eaaf3a9f9a86bd26f78167c03b8", "message": "Set state_value_template = value_template if state_value_template == null\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>", "committedDate": "2020-02-29T06:37:55Z", "type": "commit"}, {"oid": "faef3a253a43bd72e0cd3ad937051c39d138a5f6", "url": "https://github.com/openhab/openhab-addons/commit/faef3a253a43bd72e0cd3ad937051c39d138a5f6", "message": "rolling back change, so only one change in this pull request\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>", "committedDate": "2020-02-29T06:50:27Z", "type": "commit"}, {"oid": "dbf39c5367d82aa6593f69f21173e41df6d8aff6", "url": "https://github.com/openhab/openhab-addons/commit/dbf39c5367d82aa6593f69f21173e41df6d8aff6", "message": "Added dependencies for the test program to properly run\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>", "committedDate": "2020-03-05T05:16:54Z", "type": "commit"}, {"oid": "ba6ab904df91951eeb4257b693d6ff6aa4a5ae20", "url": "https://github.com/openhab/openhab-addons/commit/ba6ab904df91951eeb4257b693d6ff6aa4a5ae20", "message": "Tests are functional now!  Need to cleanup a bit before submitting pull request\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>", "committedDate": "2020-03-05T07:49:57Z", "type": "commit"}, {"oid": "fbfcd9e684214e0ac82e8e875fa1869e7bac0fdb", "url": "https://github.com/openhab/openhab-addons/commit/fbfcd9e684214e0ac82e8e875fa1869e7bac0fdb", "message": "Tests functional now, need to clean up before pull\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>", "committedDate": "2020-03-05T07:51:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQwMjEwNw==", "url": "https://github.com/openhab/openhab-addons/pull/7080#discussion_r389402107", "bodyText": "Did you notic, that the stateTopic()method allows for any number of templates?\nThe frist non-Blank one will be used.\nSo we could just do:\n.stateTopic(channelConfiguration.state_topic, channelConfiguration.state_value_template, channelConfiguration.value_template)", "author": "jochen314", "createdAt": "2020-03-08T20:24:19Z", "path": "bundles/org.openhab.binding.mqtt.homeassistant/src/main/java/org/openhab/binding/mqtt/homeassistant/internal/ComponentLight.java", "diffHunk": "@@ -102,6 +102,16 @@ public ComponentLight(CFactory.ComponentConfiguration builder) {\n         this.channelStateUpdateListener = builder.getUpdateListener();\n         ColorValue value = new ColorValue(true, channelConfiguration.payload_on, channelConfiguration.payload_off, 100);\n \n+        // HomeAssistant MQTT Discovery documentation is a bit unclear as to when to use value_template and\n+        // when to use state_value_template. As a result, not all light implementations use state_value_template.\n+        // Lights using the Tasmota firmware for example use value_template.\n+        if (channelConfiguration.state_value_template == null) {\n+            channelConfiguration.state_value_template = channelConfiguration.value_template;\n+        }\n+        if (channelConfiguration.value_template == null) {\n+            channelConfiguration.value_template = channelConfiguration.state_value_template;\n+        }\n+\n         // Create three MQTT subscriptions and use this class object as update listener\n         switchChannel = buildChannel(switchChannelID, value, channelConfiguration.name, this)//\n                 .stateTopic(channelConfiguration.state_topic, channelConfiguration.state_value_template)//", "originalCommit": "faef3a253a43bd72e0cd3ad937051c39d138a5f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ2MDMxOA==", "url": "https://github.com/openhab/openhab-addons/pull/7080#discussion_r389460318", "bodyText": "I did not notice that, your suggestion is a cleaner solution.  I will modify to use that approach.  Thanks for the update.", "author": "mehoekstra", "createdAt": "2020-03-09T04:38:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQwMjEwNw=="}], "type": "inlineReview"}, {"oid": "e493e01d6e1c04a06780c93b9915a9d0b59e715b", "url": "https://github.com/openhab/openhab-addons/commit/e493e01d6e1c04a06780c93b9915a9d0b59e715b", "message": "Merged with latest 2.5x branch\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>", "committedDate": "2020-03-13T05:00:25Z", "type": "commit"}, {"oid": "b03029352791687f879f3391b68e71c28c7721ad", "url": "https://github.com/openhab/openhab-addons/commit/b03029352791687f879f3391b68e71c28c7721ad", "message": "Rolling back to main 2.5x version of test\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>", "committedDate": "2020-03-13T05:07:38Z", "type": "commit"}, {"oid": "1ebc18e36b1bf4aad402b2fad365b2c3a9ab96c5", "url": "https://github.com/openhab/openhab-addons/commit/1ebc18e36b1bf4aad402b2fad365b2c3a9ab96c5", "message": "Now uses varargs function to choose value_template or state_value_template\n\nSigned-off-by: Matt Hoekstra <matthew.e.hoekstra@gmail.com>", "committedDate": "2020-03-13T07:37:48Z", "type": "commit"}]}