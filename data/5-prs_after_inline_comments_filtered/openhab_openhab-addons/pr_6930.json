{"pr_number": 6930, "pr_title": "[enocean] Added support for Smoke Detectors (#6929)", "pr_createdAt": "2020-01-28T22:20:15Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/6930", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDE0ODg1Ng==", "url": "https://github.com/openhab/openhab-addons/pull/6930#discussion_r374148856", "bodyText": "Formatting, maybe apply spotless:  mvn spotless:apply -pl :org.openhab.binding.enocean", "author": "martinvw", "createdAt": "2020-02-03T14:57:40Z", "path": "bundles/org.openhab.binding.enocean/src/main/java/org/openhab/binding/enocean/internal/eep/D2_14/D2_14_30.java", "diffHunk": "@@ -0,0 +1,101 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.enocean.internal.eep.D2_14;\n+\n+import static org.openhab.binding.enocean.internal.EnOceanBindingConstants.*;\n+\n+import java.util.function.Function;\n+\n+import org.eclipse.smarthome.config.core.Configuration;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.library.unit.SIUnits;\n+import org.eclipse.smarthome.core.library.unit.SmartHomeUnits;\n+import org.eclipse.smarthome.core.thing.CommonTriggerEvents;\n+import org.eclipse.smarthome.core.types.State;\n+import org.eclipse.smarthome.core.types.UnDefType;\n+import org.openhab.binding.enocean.internal.eep.Base._VLDMessage;\n+import org.openhab.binding.enocean.internal.messages.ERP1Message;\n+\n+/**\n+ *\n+ * @author Daniel Weber - Initial contribution\n+ */\n+public class D2_14_30 extends _VLDMessage {\n+\n+    public D2_14_30() {\n+        super();\n+    }\n+\n+    public D2_14_30(ERP1Message packet) {\n+        super(packet);\n+    }\n+\n+    @Override\n+    public State convertToStateImpl(String channelId, String channelTypeId, Function<String, State> getCurrentStateFunc, Configuration config) {\n+        switch (channelId) {\n+            case CHANNEL_SMOKEDETECTION:\n+                return getBit(bytes[0], 7) ? OnOffType.ON : OnOffType.OFF;\n+            case CHANNEL_SENSORFAULT:\n+                return getBit(bytes[0], 6) ? OnOffType.ON : OnOffType.OFF;\n+            case CHANNEL_MAINTENANCESTATUS:\n+                return getBit(bytes[0], 5) ? OnOffType.ON : OnOffType.OFF;\n+            case CHANNEL_SENSORANALYSISHUMIDITYRANGE:\n+                return getBit(bytes[0], 4) ? OnOffType.ON : OnOffType.OFF;\n+            case CHANNEL_SENSORANALYSISTEMPERATURRANGE:\n+            return getBit(bytes[0], 3) ? OnOffType.ON : OnOffType.OFF;", "originalCommit": "4dd6fff8d107cfcde291fbfff76428086a221382", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA2ODEyMQ==", "url": "https://github.com/openhab/openhab-addons/pull/6930#discussion_r377068121", "bodyText": "Thanks for the hint \ud83d\udc4d , I seperated the changes coming from spotless in a second commit.", "author": "fruggy83", "createdAt": "2020-02-10T13:41:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDE0ODg1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDE0OTA5NQ==", "url": "https://github.com/openhab/openhab-addons/pull/6930#discussion_r374149095", "bodyText": "Not needed explicitly, but you can leave it.", "author": "martinvw", "createdAt": "2020-02-03T14:58:00Z", "path": "bundles/org.openhab.binding.enocean/src/main/java/org/openhab/binding/enocean/internal/eep/D2_14/D2_14_30.java", "diffHunk": "@@ -0,0 +1,101 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.enocean.internal.eep.D2_14;\n+\n+import static org.openhab.binding.enocean.internal.EnOceanBindingConstants.*;\n+\n+import java.util.function.Function;\n+\n+import org.eclipse.smarthome.config.core.Configuration;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.library.unit.SIUnits;\n+import org.eclipse.smarthome.core.library.unit.SmartHomeUnits;\n+import org.eclipse.smarthome.core.thing.CommonTriggerEvents;\n+import org.eclipse.smarthome.core.types.State;\n+import org.eclipse.smarthome.core.types.UnDefType;\n+import org.openhab.binding.enocean.internal.eep.Base._VLDMessage;\n+import org.openhab.binding.enocean.internal.messages.ERP1Message;\n+\n+/**\n+ *\n+ * @author Daniel Weber - Initial contribution\n+ */\n+public class D2_14_30 extends _VLDMessage {\n+\n+    public D2_14_30() {\n+        super();", "originalCommit": "4dd6fff8d107cfcde291fbfff76428086a221382", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDE0OTM0MQ==", "url": "https://github.com/openhab/openhab-addons/pull/6930#discussion_r374149341", "bodyText": "This non-standard name is already an existing thing from the binding, IIRC?", "author": "martinvw", "createdAt": "2020-02-03T14:58:24Z", "path": "bundles/org.openhab.binding.enocean/src/main/java/org/openhab/binding/enocean/internal/eep/D2_14/D2_14_30.java", "diffHunk": "@@ -0,0 +1,101 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.enocean.internal.eep.D2_14;\n+\n+import static org.openhab.binding.enocean.internal.EnOceanBindingConstants.*;\n+\n+import java.util.function.Function;\n+\n+import org.eclipse.smarthome.config.core.Configuration;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.library.unit.SIUnits;\n+import org.eclipse.smarthome.core.library.unit.SmartHomeUnits;\n+import org.eclipse.smarthome.core.thing.CommonTriggerEvents;\n+import org.eclipse.smarthome.core.types.State;\n+import org.eclipse.smarthome.core.types.UnDefType;\n+import org.openhab.binding.enocean.internal.eep.Base._VLDMessage;\n+import org.openhab.binding.enocean.internal.messages.ERP1Message;\n+\n+/**\n+ *\n+ * @author Daniel Weber - Initial contribution\n+ */\n+public class D2_14_30 extends _VLDMessage {", "originalCommit": "4dd6fff8d107cfcde291fbfff76428086a221382", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA2ODE1Nw==", "url": "https://github.com/openhab/openhab-addons/pull/6930#discussion_r377068157", "bodyText": "Correct. Background: EnOcean knows the following message types RPS, 1BS, 4BS, VLD. For the 1BS and 4BS messages types I had to use a underscore, so I decided to prefix all message types with it.", "author": "fruggy83", "createdAt": "2020-02-10T13:41:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDE0OTM0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDE0OTg0Mw==", "url": "https://github.com/openhab/openhab-addons/pull/6930#discussion_r374149843", "bodyText": "Don't use them, rather split such a piece of code of to method, IMHO a case in a switch shouild be around max 5 lines.", "author": "martinvw", "createdAt": "2020-02-03T14:59:12Z", "path": "bundles/org.openhab.binding.enocean/src/main/java/org/openhab/binding/enocean/internal/eep/D2_14/D2_14_30.java", "diffHunk": "@@ -0,0 +1,101 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.enocean.internal.eep.D2_14;\n+\n+import static org.openhab.binding.enocean.internal.EnOceanBindingConstants.*;\n+\n+import java.util.function.Function;\n+\n+import org.eclipse.smarthome.config.core.Configuration;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.library.unit.SIUnits;\n+import org.eclipse.smarthome.core.library.unit.SmartHomeUnits;\n+import org.eclipse.smarthome.core.thing.CommonTriggerEvents;\n+import org.eclipse.smarthome.core.types.State;\n+import org.eclipse.smarthome.core.types.UnDefType;\n+import org.openhab.binding.enocean.internal.eep.Base._VLDMessage;\n+import org.openhab.binding.enocean.internal.messages.ERP1Message;\n+\n+/**\n+ *\n+ * @author Daniel Weber - Initial contribution\n+ */\n+public class D2_14_30 extends _VLDMessage {\n+\n+    public D2_14_30() {\n+        super();\n+    }\n+\n+    public D2_14_30(ERP1Message packet) {\n+        super(packet);\n+    }\n+\n+    @Override\n+    public State convertToStateImpl(String channelId, String channelTypeId, Function<String, State> getCurrentStateFunc, Configuration config) {\n+        switch (channelId) {\n+            case CHANNEL_SMOKEDETECTION:\n+                return getBit(bytes[0], 7) ? OnOffType.ON : OnOffType.OFF;\n+            case CHANNEL_SENSORFAULT:\n+                return getBit(bytes[0], 6) ? OnOffType.ON : OnOffType.OFF;\n+            case CHANNEL_MAINTENANCESTATUS:\n+                return getBit(bytes[0], 5) ? OnOffType.ON : OnOffType.OFF;\n+            case CHANNEL_SENSORANALYSISHUMIDITYRANGE:\n+                return getBit(bytes[0], 4) ? OnOffType.ON : OnOffType.OFF;\n+            case CHANNEL_SENSORANALYSISTEMPERATURRANGE:\n+            return getBit(bytes[0], 3) ? OnOffType.ON : OnOffType.OFF;\n+            case CHANNEL_TIMESINCELASTMAINTENANCE:\n+                return new DecimalType(((bytes[0] << 5) + (bytes[0] >>> 3)) & 0xFF);\n+            case CHANNEL_BATTERY_LEVEL:\n+                {", "originalCommit": "4dd6fff8d107cfcde291fbfff76428086a221382", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA2ODIzMw==", "url": "https://github.com/openhab/openhab-addons/pull/6930#discussion_r377068233", "bodyText": "Changed it.", "author": "fruggy83", "createdAt": "2020-02-10T13:41:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDE0OTg0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTYwMjM2OA==", "url": "https://github.com/openhab/openhab-addons/pull/6930#discussion_r379602368", "bodyText": "Does it make sense to store the result of getDB_1() in a local variable instead of calling the method twice?", "author": "cweitkamp", "createdAt": "2020-02-14T19:21:00Z", "path": "bundles/org.openhab.binding.enocean/src/main/java/org/openhab/binding/enocean/internal/eep/A5_30/A5_30_03_ELTAKO.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.enocean.internal.eep.A5_30;\n+\n+import static org.openhab.binding.enocean.internal.EnOceanBindingConstants.*;\n+\n+import java.util.function.Function;\n+\n+import org.eclipse.smarthome.config.core.Configuration;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.types.State;\n+import org.eclipse.smarthome.core.types.UnDefType;\n+import org.openhab.binding.enocean.internal.messages.ERP1Message;\n+\n+/**\n+ * EEP used for Smoke Detectors by Eltako\n+ *\n+ * @author Daniel Weber - Initial contribution\n+ */\n+public class A5_30_03_ELTAKO extends A5_30_03 {\n+\n+    protected byte ALARM_ON = 0x0F;\n+    protected byte ALARM_OFF = 0x10;\n+\n+    public A5_30_03_ELTAKO() {\n+        super();\n+\n+        this.supportsTeachInVariation3 = true;\n+    }\n+\n+    public A5_30_03_ELTAKO(ERP1Message packet) {\n+        super(packet);\n+\n+        this.supportsTeachInVariation3 = true;\n+    }\n+\n+    @Override\n+    protected State convertToStateImpl(String channelId, String channelTypeId,\n+            Function<String, State> getCurrentStateFunc, Configuration config) {\n+        switch (channelId) {\n+            case CHANNEL_SMOKEDETECTION:\n+                return getDB_1() == ALARM_ON ? OnOffType.ON", "originalCommit": "6a099c8949de30a9c1e60415f9ac76e42c21616f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzA5NzAzMg==", "url": "https://github.com/openhab/openhab-addons/pull/6930#discussion_r383097032", "bodyText": "This makes definitely sense, good point \ud83d\udc4d  fixed it", "author": "fruggy83", "createdAt": "2020-02-24T06:11:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTYwMjM2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTYwMjU3MA==", "url": "https://github.com/openhab/openhab-addons/pull/6930#discussion_r379602570", "bodyText": "Can both properties be static final?", "author": "cweitkamp", "createdAt": "2020-02-14T19:21:31Z", "path": "bundles/org.openhab.binding.enocean/src/main/java/org/openhab/binding/enocean/internal/eep/A5_30/A5_30_03.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.enocean.internal.eep.A5_30;\n+\n+import static org.openhab.binding.enocean.internal.EnOceanBindingConstants.*;\n+\n+import java.util.function.Function;\n+\n+import org.eclipse.smarthome.config.core.Configuration;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.library.unit.SIUnits;\n+import org.eclipse.smarthome.core.types.State;\n+import org.eclipse.smarthome.core.types.UnDefType;\n+import org.openhab.binding.enocean.internal.eep.Base._4BSMessage;\n+import org.openhab.binding.enocean.internal.messages.ERP1Message;\n+\n+/**\n+ *\n+ * @author Daniel Weber - Initial contribution\n+ */\n+public class A5_30_03 extends _4BSMessage {\n+\n+    protected byte ALL_DIGITALPINS_HIGH = 0x0F;", "originalCommit": "6a099c8949de30a9c1e60415f9ac76e42c21616f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzA5NzA3NA==", "url": "https://github.com/openhab/openhab-addons/pull/6930#discussion_r383097074", "bodyText": "fixed it", "author": "fruggy83", "createdAt": "2020-02-24T06:11:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTYwMjU3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTYwMjYyNQ==", "url": "https://github.com/openhab/openhab-addons/pull/6930#discussion_r379602625", "bodyText": "Can both properties be static final?", "author": "cweitkamp", "createdAt": "2020-02-14T19:21:38Z", "path": "bundles/org.openhab.binding.enocean/src/main/java/org/openhab/binding/enocean/internal/eep/A5_30/A5_30_03_ELTAKO.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.enocean.internal.eep.A5_30;\n+\n+import static org.openhab.binding.enocean.internal.EnOceanBindingConstants.*;\n+\n+import java.util.function.Function;\n+\n+import org.eclipse.smarthome.config.core.Configuration;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.types.State;\n+import org.eclipse.smarthome.core.types.UnDefType;\n+import org.openhab.binding.enocean.internal.messages.ERP1Message;\n+\n+/**\n+ * EEP used for Smoke Detectors by Eltako\n+ *\n+ * @author Daniel Weber - Initial contribution\n+ */\n+public class A5_30_03_ELTAKO extends A5_30_03 {\n+\n+    protected byte ALARM_ON = 0x0F;", "originalCommit": "6a099c8949de30a9c1e60415f9ac76e42c21616f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "851631fb89f3658dc462e0ae5ee9792be84d3b6c", "url": "https://github.com/openhab/openhab-addons/commit/851631fb89f3658dc462e0ae5ee9792be84d3b6c", "message": "[enocean] Added support for Smoke Detectors (#6929)\n\n * Implemented EEP F6_05_02 and D2_14_30\n * Added new thing MultiFunctionSmokeDetector\n * Added new smoke detector specific channels\n\nFixes #6929\n\nSigned-off-by: Daniel Weber <uni@fruggy.de>", "committedDate": "2020-02-24T05:43:45Z", "type": "commit"}, {"oid": "1c57152dc6f384d67bba8fff678c66118770cce7", "url": "https://github.com/openhab/openhab-addons/commit/1c57152dc6f384d67bba8fff678c66118770cce7", "message": "[enocean] Added support for Smoke Detectors (#6929)\n\n * Implemented additional smoke detection EEP A5_30_03_ELTAKO\n * Changed item type of channels CHANNEL_REMAININGPLT and CHANNEL_TIMESINCELASTMAINTENANCE to QuantityType<Time>\n * Changed item type of channels CHANNEL_HYGROCOMFORTINDEX and CHANNEL_INDOORAIRANALYSIS to String\n\nFixes #6929\n\nSigned-off-by: Daniel Weber <uni@fruggy.de>", "committedDate": "2020-02-24T05:43:45Z", "type": "commit"}, {"oid": "1e37891ed66283a0f901feb5ddeac9e1bff82be3", "url": "https://github.com/openhab/openhab-addons/commit/1e37891ed66283a0f901feb5ddeac9e1bff82be3", "message": "[enocean] Added support for Smoke Detectors (#6929)\n\n * Tidied up code formating with spotless\n\nFixes #6929\n\nSigned-off-by: Daniel Weber <uni@fruggy.de>", "committedDate": "2020-02-24T05:43:45Z", "type": "commit"}, {"oid": "3f17fa91d56a46c4a3181f0e4e70122dd6b18bf6", "url": "https://github.com/openhab/openhab-addons/commit/3f17fa91d56a46c4a3181f0e4e70122dd6b18bf6", "message": "[enocean] Added support for Smoke Detectors (#6929)\n\n * Defined some consts as static final\n * Added pattern for new channels\n * Minor refactoring\n\nFixes #6929\n\nSigned-off-by: Daniel Weber <uni@fruggy.de>", "committedDate": "2020-02-24T06:09:46Z", "type": "commit"}]}