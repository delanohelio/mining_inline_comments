{"pr_number": 2367, "pr_title": "Missing TERMINATED transition in UnicastManySinkNoBackpressure", "pr_createdAt": "2020-09-09T13:42:26Z", "pr_url": "https://github.com/reactor/reactor-core/pull/2367", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTYyMjYxMw==", "url": "https://github.com/reactor/reactor-core/pull/2367#discussion_r485622613", "bodyText": "WDYT about changing it to for (...) to avoid the recursion (== longer stacktrace)?", "author": "bsideup", "createdAt": "2020-09-09T13:44:24Z", "path": "reactor-core/src/main/java/reactor/core/publisher/UnicastManySinkNoBackpressure.java", "diffHunk": "@@ -182,18 +216,31 @@ public void emitComplete() {\n \tpublic Emission tryEmitComplete() {\n \t\tswitch (state) {\n \t\t\tcase INITIAL:\n-\t\t\t\t// TODO different Emission?\n-\t\t\t\treturn Emission.OK;\n+\t\t\t\tif (STATE.compareAndSet(this, State.INITIAL, State.TERMINATED_BEFORE_SUBSCRIPTION)) {\n+\t\t\t\t\treturn Emission.OK;\n+\t\t\t\t}\n+\t\t\t\telse {\n+\t\t\t\t\t//recurse", "originalCommit": "f43e1515a1a1098f24cef01daa373417aebda7e8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTcyMTUxMA==", "url": "https://github.com/reactor/reactor-core/pull/2367#discussion_r485721510", "bodyText": "done", "author": "simonbasle", "createdAt": "2020-09-09T15:54:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTYyMjYxMw=="}], "type": "inlineReview"}, {"oid": "5bbec1fc471f125520e2be2547e02d6d673c81f6", "url": "https://github.com/reactor/reactor-core/commit/5bbec1fc471f125520e2be2547e02d6d673c81f6", "message": "don't retain terminations but rather fail (rather than OK)", "committedDate": "2020-09-11T15:27:46Z", "type": "forcePushed"}, {"oid": "e385136c2d7999b56738567760d326a920911959", "url": "https://github.com/reactor/reactor-core/commit/e385136c2d7999b56738567760d326a920911959", "message": "Let UnicastManySinkNoBackpressure switch to terminal state (#2367)\n\nThis commit polishes the new unicast onBackpressureError so that it\nperforms the state transition to the TERMINATED state when completing\nor erroring the sink.\n\nAlso contains some state checks code style polish.", "committedDate": "2020-09-11T17:33:36Z", "type": "commit"}, {"oid": "e385136c2d7999b56738567760d326a920911959", "url": "https://github.com/reactor/reactor-core/commit/e385136c2d7999b56738567760d326a920911959", "message": "Let UnicastManySinkNoBackpressure switch to terminal state (#2367)\n\nThis commit polishes the new unicast onBackpressureError so that it\nperforms the state transition to the TERMINATED state when completing\nor erroring the sink.\n\nAlso contains some state checks code style polish.", "committedDate": "2020-09-11T17:33:36Z", "type": "forcePushed"}]}