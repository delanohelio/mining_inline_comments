{"pr_number": 2168, "pr_title": "fix #2160 Accommodate ASYNC fusion in Mono.metrics()", "pr_createdAt": "2020-05-20T15:19:17Z", "pr_url": "https://github.com/reactor/reactor-core/pull/2168", "timeline": [{"oid": "d23a7b2d0e4bce0a4f2c353ecdbd79873b39a3be", "url": "https://github.com/reactor/reactor-core/commit/d23a7b2d0e4bce0a4f2c353ecdbd79873b39a3be", "message": "fix hanging case", "committedDate": "2020-05-20T15:21:47Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDIzNDMwNQ==", "url": "https://github.com/reactor/reactor-core/pull/2168#discussion_r430234305", "bodyText": "the Duration in the verify method is an upper bound after which the test times out. 1ms is a bit short, as it could hiccup (eg. on CI machines). I suggest you raise it to Duration.ofSeconds(1) everywhere just to be on the safe side", "author": "simonbasle", "createdAt": "2020-05-26T08:14:44Z", "path": "reactor-core/src/test/java/reactor/core/publisher/FluxMetricsTest.java", "diffHunk": "@@ -456,4 +459,29 @@ public void flowDurationTagsConsistency() {\n \n \t\tassertThat(uniqueTagKeySets).hasSize(1);\n \t}\n+\n+\t@Test\n+\tpublic void ensureFuseablePropagateOnComplete_inCaseOfAsyncFusion() {\n+\t\tFlux.fromIterable(Arrays.asList(1, 2, 3))\n+\t\t    .metrics()\n+\t\t    .flatMapIterable(Arrays::asList)\n+\t\t    .as(StepVerifier::create)\n+\t\t    .expectNext(1, 2, 3)\n+\t\t    .expectComplete()\n+\t\t    .verify(Duration.ofMillis(1));", "originalCommit": "70a66530371b1a269a579d3963babc9f3f4f3713", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "718fc24f5888b4860c6fee524f8133d5bc86e949", "url": "https://github.com/reactor/reactor-core/commit/718fc24f5888b4860c6fee524f8133d5bc86e949", "message": "override onNext in MonoMetricsFuseable", "committedDate": "2020-05-27T09:50:18Z", "type": "commit"}, {"oid": "769ba5d586b14b505e2c676cb116f5ea84e16c00", "url": "https://github.com/reactor/reactor-core/commit/769ba5d586b14b505e2c676cb116f5ea84e16c00", "message": "fix hanging case", "committedDate": "2020-05-27T09:50:19Z", "type": "commit"}, {"oid": "a34e947d091b3645e7f6ed52e0101dc7362f139f", "url": "https://github.com/reactor/reactor-core/commit/a34e947d091b3645e7f6ed52e0101dc7362f139f", "message": "added tests for Flux", "committedDate": "2020-05-27T09:50:19Z", "type": "commit"}, {"oid": "a34e947d091b3645e7f6ed52e0101dc7362f139f", "url": "https://github.com/reactor/reactor-core/commit/a34e947d091b3645e7f6ed52e0101dc7362f139f", "message": "added tests for Flux", "committedDate": "2020-05-27T09:50:19Z", "type": "forcePushed"}, {"oid": "b3e781e05c1ee91528f669385fbdcc68549aa814", "url": "https://github.com/reactor/reactor-core/commit/b3e781e05c1ee91528f669385fbdcc68549aa814", "message": "fixup max duration of verify in tests, 1ms is too short", "committedDate": "2020-05-27T09:54:59Z", "type": "commit"}]}