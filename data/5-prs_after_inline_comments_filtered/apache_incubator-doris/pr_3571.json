{"pr_number": 3571, "pr_title": "Support bitmap_intersect", "pr_createdAt": "2020-05-12T13:31:19Z", "pr_url": "https://github.com/apache/incubator-doris/pull/3571", "timeline": [{"oid": "7df59a69e1ec509192d0b4a7b7018bdc4fa0b62f", "url": "https://github.com/apache/incubator-doris/commit/7df59a69e1ec509192d0b4a7b7018bdc4fa0b62f", "message": "Support bitmap_intersect\n\nSupport aggregate function Bitmap Intersect, it is mainly used to take intersection of grouped data.\nThe function 'bitmap_intersect(expr)' calculates the intersection of bitmap columns and returns a bitmap object.\nThe defination is following:\nFunctionName: bitmap_intersect,\nInputType: bitmap,\nOutputType: bitmap\n\nThe scenario is as follows:\nQuery which users satisfy the three tags a, b, and c at the same time.\n\n```\nselect bitmap_to_string(bitmap_intersect(user_id)) from\n(\n    select bitmap_union(user_id) user_id from bitmap_intersect_test\n    where tag in ('a', 'b', 'c')\n    group by tag\n) a\n```\nClosed #3552.\n\nChange-Id: I0d50c9bb6827f7319c4d854f621412343a3ece24", "committedDate": "2020-05-12T13:26:34Z", "type": "commit"}, {"oid": "d2bdd1db8eb22f8b245030c34fed911f92653440", "url": "https://github.com/apache/incubator-doris/commit/d2bdd1db8eb22f8b245030c34fed911f92653440", "message": "Update be/src/util/bitmap_value.h\n\nCo-authored-by: Mingyu Chen <morningman.cmy@gmail.com>", "committedDate": "2020-05-14T04:10:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkzODQyOQ==", "url": "https://github.com/apache/incubator-doris/pull/3571#discussion_r424938429", "bodyText": "You can't change this name directly.\nBecause it will cause query fail when grayscale upgrade", "author": "imay", "createdAt": "2020-05-14T07:52:29Z", "path": "fe/src/main/java/org/apache/doris/catalog/FunctionSet.java", "diffHunk": "@@ -554,29 +555,29 @@ public boolean isNonNullResultWithNullParamFunctions(String funcName) {\n     private static final Map<Type, String> BITMAP_INTERSECT_INIT_SYMBOL =\n             ImmutableMap.<Type, String>builder()\n                     .put(Type.TINYINT,\n-                            \"_ZN5doris15BitmapFunctions21bitmap_intersect_initIaN9doris_udf10TinyIntValEEEvPNS2_15FunctionContextEPNS2_9StringValE\")\n+                            \"_ZN5doris15BitmapFunctions20intersect_count_initIaN9doris_udf10TinyIntValEEEvPNS2_15FunctionContextEPNS2_9StringValE\")", "originalCommit": "d2bdd1db8eb22f8b245030c34fed911f92653440", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzA2OTE0NA==", "url": "https://github.com/apache/incubator-doris/pull/3571#discussion_r427069144", "bodyText": "The grayscale upgrade itself will also cause the query to fail\uff0cso I think the impact is not significant.", "author": "EmmyMiao87", "createdAt": "2020-05-19T06:53:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkzODQyOQ=="}], "type": "inlineReview"}, {"oid": "45ee670dd2152a62b4180331f551150e7af041b8", "url": "https://github.com/apache/incubator-doris/commit/45ee670dd2152a62b4180331f551150e7af041b8", "message": "Add docs of bitmap_union and bitmap_intersect\n\nChange-Id: I4a815eaa5aac07ab75bb07e13f518da59cbef952", "committedDate": "2020-05-19T07:25:44Z", "type": "commit"}, {"oid": "1981a2631217412fa3fdec638eb5e20281cbcb6c", "url": "https://github.com/apache/incubator-doris/commit/1981a2631217412fa3fdec638eb5e20281cbcb6c", "message": "Merge branch 'bitmap_intersect' of https://github.com/EmmyMiao87/incubator-doris into bitmap_intersect\n\nChange-Id: I2f5bee7dd9a14f687881af8038dbbff17b6b6590", "committedDate": "2020-05-19T07:28:26Z", "type": "commit"}, {"oid": "c150919a31c1c333fa5ddfd6f1253e130337a5fc", "url": "https://github.com/apache/incubator-doris/commit/c150919a31c1c333fa5ddfd6f1253e130337a5fc", "message": "Change the init function name of bitmap_intersect\n\nChange-Id: Ibb9bdb236d4d850e3d732bb55c441b7f8b80abba", "committedDate": "2020-05-19T12:33:20Z", "type": "commit"}, {"oid": "9e0bf1a775111f825476f08f076282abed158da6", "url": "https://github.com/apache/incubator-doris/commit/9e0bf1a775111f825476f08f076282abed158da6", "message": "Change unit test\n\nChange-Id: I8bd03f5344eafc89a7d617d10399c848006bf590", "committedDate": "2020-05-19T12:43:01Z", "type": "commit"}, {"oid": "48fddb6011b1c92538dd9a398be2f2ab4d964f15", "url": "https://github.com/apache/incubator-doris/commit/48fddb6011b1c92538dd9a398be2f2ab4d964f15", "message": "Support null of bitmap_intersect\n\nChange-Id: I2d86d48dd5f5e836696b3d44620de41943052ee6", "committedDate": "2020-05-20T08:47:28Z", "type": "commit"}, {"oid": "e828ea1e6c1b1b9de91c66216b6842429f17710b", "url": "https://github.com/apache/incubator-doris/commit/e828ea1e6c1b1b9de91c66216b6842429f17710b", "message": "Add doc in sidebar\n\nChange-Id: Ic21f0d500f464cee5d51e54858a18c89d080631b", "committedDate": "2020-05-20T11:31:10Z", "type": "commit"}]}