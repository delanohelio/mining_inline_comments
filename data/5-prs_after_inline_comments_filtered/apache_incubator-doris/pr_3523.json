{"pr_number": 3523, "pr_title": "Refactor some redunant code && Replace some UT by UtFrameUtils", "pr_createdAt": "2020-05-08T06:37:20Z", "pr_url": "https://github.com/apache/incubator-doris/pull/3523", "timeline": [{"oid": "1b14dd4426145f1b66293cfa78b76a90ab61325b", "url": "https://github.com/apache/incubator-doris/commit/1b14dd4426145f1b66293cfa78b76a90ab61325b", "message": "Refactor some redunant code && Replace some UT by UtFrameUtils\n\nThis CL have no logic change, just do some code refacotr and UT Change.", "committedDate": "2020-05-08T04:07:33Z", "type": "commit"}, {"oid": "595f14498d4862195684ed5654af91250350ad66", "url": "https://github.com/apache/incubator-doris/commit/595f14498d4862195684ed5654af91250350ad66", "message": "fix", "committedDate": "2020-05-08T04:10:34Z", "type": "commit"}, {"oid": "ad42a1d494098389b96c3b17e478756099124ff0", "url": "https://github.com/apache/incubator-doris/commit/ad42a1d494098389b96c3b17e478756099124ff0", "message": "fix", "committedDate": "2020-05-08T06:16:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjYxMzMyNA==", "url": "https://github.com/apache/incubator-doris/pull/3523#discussion_r422613324", "bodyText": "Change the comment to:\n// If this backend is done for a long time and not restart automatically.\n// we consider it as dead and return false.", "author": "morningman", "createdAt": "2020-05-10T08:57:52Z", "path": "fe/src/main/java/org/apache/doris/alter/AlterJob.java", "diffHunk": "@@ -189,18 +189,14 @@ protected boolean checkBackendState(Replica replica) {\n             return false;\n         } else if (!backend.isAlive()) {\n             long currentTime = System.currentTimeMillis();\n-            if (backend.getLastUpdateMs() > 0\n-                    && currentTime - backend.getLastUpdateMs() > Config.max_backend_down_time_second * 1000) {\n-                // this backend is done for a long time and not restart automatically.\n-                // we consider it as dead\n-                return false;\n-            }\n-            return true;\n-        } else if (backend.isDecommissioned()) {\n-            return false;\n+            // this backend is done for a long time and not restart automatically.", "originalCommit": "ad42a1d494098389b96c3b17e478756099124ff0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjYxNDQ1Mg==", "url": "https://github.com/apache/incubator-doris/pull/3523#discussion_r422614452", "bodyText": "I think the part of generate file mapping can be a separated method not including in this method.\nOr the name of this method can be confused.", "author": "morningman", "createdAt": "2020-05-10T09:07:38Z", "path": "fe/src/main/java/org/apache/doris/backup/RestoreJob.java", "diffHunk": "@@ -806,7 +739,54 @@ private void checkAndPrepareMeta() {\n         // No log here, PENDING state restore job will redo this method\n         LOG.info(\"finished to prepare meta and send snapshot tasks, num: {}. {}\",\n                  batchTask.getTaskNum(), this);\n-        return;\n+    }\n+\n+    private boolean backupReplicasNotEqual(PartitionInfo localPartInfo, Partition localPartition, Table localTbl,", "originalCommit": "ad42a1d494098389b96c3b17e478756099124ff0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjYyOTY4NA==", "url": "https://github.com/apache/incubator-doris/pull/3523#discussion_r422629684", "bodyText": "can we change the method name to genFileMappingWhenBackupReplicasEqual?", "author": "WingsGo", "createdAt": "2020-05-10T11:15:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjYxNDQ1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTU0MjE4NA==", "url": "https://github.com/apache/incubator-doris/pull/3523#discussion_r425542184", "bodyText": "Sorry for review delay. This name looks good to me.", "author": "morningman", "createdAt": "2020-05-15T03:11:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjYxNDQ1Mg=="}], "type": "inlineReview"}, {"oid": "c86af45f4f4d619298285ab726995bb36de1c889", "url": "https://github.com/apache/incubator-doris/commit/c86af45f4f4d619298285ab726995bb36de1c889", "message": "fix", "committedDate": "2020-05-10T11:16:15Z", "type": "commit"}, {"oid": "805ecc9d4e56202694e93f2db6d202d0bacb5256", "url": "https://github.com/apache/incubator-doris/commit/805ecc9d4e56202694e93f2db6d202d0bacb5256", "message": "fix", "committedDate": "2020-05-15T03:23:01Z", "type": "commit"}]}