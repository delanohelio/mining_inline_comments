{"pr_number": 4256, "pr_title": "Support sequence column for UNIQUE_KEYS Table", "pr_createdAt": "2020-08-05T07:40:56Z", "pr_url": "https://github.com/apache/incubator-doris/pull/4256", "timeline": [{"oid": "3f083204347daf3d8024d4a571c2240354f2d01b", "url": "https://github.com/apache/incubator-doris/commit/3f083204347daf3d8024d4a571c2240354f2d01b", "message": "add sequence  col", "committedDate": "2020-08-06T12:05:38Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY3MTQ0NA==", "url": "https://github.com/apache/incubator-doris/pull/4256#discussion_r467671444", "bodyText": "why do not check if sequenceColName ia alread exist in rollupSchema", "author": "yangzhg", "createdAt": "2020-08-10T03:17:02Z", "path": "fe/fe-core/src/main/java/org/apache/doris/alter/MaterializedViewHandler.java", "diffHunk": "@@ -537,6 +538,13 @@ private RollupJobV2 createMaterializedViewJob(String mvName, String baseIndexNam\n                     }\n                 }\n             }\n+            if (KeysType.UNIQUE_KEYS == keysType && olapTable.hasSequence()) {\n+                if (meetValue) {\n+                    // add the sequence column\n+                    rollupSchema.add(keysNumOfRollup, new Column(olapTable.sequenceColName, olapTable.getSequenceType(),\n+                            false, AggregateType.MAX, null, \"\"));", "originalCommit": "3f083204347daf3d8024d4a571c2240354f2d01b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzc4ODg2OQ==", "url": "https://github.com/apache/incubator-doris/pull/4256#discussion_r467788869", "bodyText": "add check Done", "author": "Youngwb", "createdAt": "2020-08-10T09:33:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY3MTQ0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzc2Njg3Mg==", "url": "https://github.com/apache/incubator-doris/pull/4256#discussion_r467766872", "bodyText": "not using \uff1f", "author": "yangzhg", "createdAt": "2020-08-10T08:50:28Z", "path": "fe/fe-core/src/main/java/org/apache/doris/common/FeMetaVersion.java", "diffHunk": "@@ -190,6 +190,8 @@\n     // force drop db, force drop table, force drop partition\n     // make force drop operation do not recycle meta\n     public static final int VERSION_89 = 89;\n+    // sequence column for unique_keys\n+    public static final int VERSION_90 = 90;\n     // note: when increment meta version, should assign the latest version to VERSION_CURRENT\n-    public static final int VERSION_CURRENT = VERSION_89;\n+    public static final int VERSION_CURRENT = VERSION_90;", "originalCommit": "3f083204347daf3d8024d4a571c2240354f2d01b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzc4NzMwOQ==", "url": "https://github.com/apache/incubator-doris/pull/4256#discussion_r467787309", "bodyText": "mistake, I have already correct it", "author": "Youngwb", "createdAt": "2020-08-10T09:30:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzc2Njg3Mg=="}], "type": "inlineReview"}, {"oid": "6f1566e097332af367a9b9d5a4cc686030712e2e", "url": "https://github.com/apache/incubator-doris/commit/6f1566e097332af367a9b9d5a4cc686030712e2e", "message": "add sequence  col", "committedDate": "2020-08-10T16:05:11Z", "type": "forcePushed"}, {"oid": "9964eb5ade0edce879713225f28fc5a3037fe3f8", "url": "https://github.com/apache/incubator-doris/commit/9964eb5ade0edce879713225f28fc5a3037fe3f8", "message": "rebase", "committedDate": "2020-08-25T07:35:20Z", "type": "forcePushed"}, {"oid": "9d04603d8e655e4296ba3cbe8928d3c5e52e4f2d", "url": "https://github.com/apache/incubator-doris/commit/9d04603d8e655e4296ba3cbe8928d3c5e52e4f2d", "message": "add sequence  col", "committedDate": "2020-08-27T07:40:18Z", "type": "forcePushed"}, {"oid": "7f278fd9f73a1eeab0cde6b3577ab8ab9eff492a", "url": "https://github.com/apache/incubator-doris/commit/7f278fd9f73a1eeab0cde6b3577ab8ab9eff492a", "message": "add sequence  col", "committedDate": "2020-08-27T15:18:22Z", "type": "forcePushed"}, {"oid": "fdaaccf62a07cff02801b7b17700bc7fbca8c7b3", "url": "https://github.com/apache/incubator-doris/commit/fdaaccf62a07cff02801b7b17700bc7fbca8c7b3", "message": "add sequence  col", "committedDate": "2020-08-28T03:11:42Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgwODk4MA==", "url": "https://github.com/apache/incubator-doris/pull/4256#discussion_r478808980", "bodyText": "add AggregateType.MAX to unique table ??", "author": "yangzhg", "createdAt": "2020-08-28T03:23:07Z", "path": "fe/fe-core/src/main/java/org/apache/doris/catalog/OlapTable.java", "diffHunk": "@@ -796,6 +801,43 @@ public void setBloomFilterInfo(Set<String> bfColumns, double bfFpp) {\n         this.bfFpp = bfFpp;\n     }\n \n+    public void setSequenceInfo(Type type) {\n+        this.hasSequenceCol = true;\n+        this.sequenceType = type;\n+\n+        // sequence column is value column with MAX aggregate type\n+        // this makes it easy to compare and update the sequence column\n+        Column sequenceCol = new Column(Column.SEQUENCE_COL, type, false, AggregateType.MAX, false, null, \"\", false);", "originalCommit": "fdaaccf62a07cff02801b7b17700bc7fbca8c7b3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODg5NzExMA==", "url": "https://github.com/apache/incubator-doris/pull/4256#discussion_r478897110", "bodyText": "I  have updated, sequence column use REPLACE", "author": "Youngwb", "createdAt": "2020-08-28T07:44:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgwODk4MA=="}], "type": "inlineReview"}, {"oid": "ac52dd946f2ddde0309a7583e3f127d86817b4b5", "url": "https://github.com/apache/incubator-doris/commit/ac52dd946f2ddde0309a7583e3f127d86817b4b5", "message": "add sequence  col", "committedDate": "2020-08-28T07:42:03Z", "type": "commit"}, {"oid": "ac52dd946f2ddde0309a7583e3f127d86817b4b5", "url": "https://github.com/apache/incubator-doris/commit/ac52dd946f2ddde0309a7583e3f127d86817b4b5", "message": "add sequence  col", "committedDate": "2020-08-28T07:42:03Z", "type": "forcePushed"}, {"oid": "08cf336a589efeb55a78add23cc6f5bbed0965d7", "url": "https://github.com/apache/incubator-doris/commit/08cf336a589efeb55a78add23cc6f5bbed0965d7", "message": "fix rollup", "committedDate": "2020-08-28T08:03:16Z", "type": "commit"}, {"oid": "99edfdeb34c07b1af2a5a2942b14dbb263f52981", "url": "https://github.com/apache/incubator-doris/commit/99edfdeb34c07b1af2a5a2942b14dbb263f52981", "message": "fix for camelCase", "committedDate": "2020-08-28T08:37:00Z", "type": "commit"}, {"oid": "25153c4254542260c0f6c256ba8761fec7aeeb0b", "url": "https://github.com/apache/incubator-doris/commit/25153c4254542260c0f6c256ba8761fec7aeeb0b", "message": "fix for camelCase", "committedDate": "2020-08-28T08:41:23Z", "type": "commit"}, {"oid": "1fb769491a678d4573f0e5666676e80a82e9307c", "url": "https://github.com/apache/incubator-doris/commit/1fb769491a678d4573f0e5666676e80a82e9307c", "message": "fix", "committedDate": "2020-08-28T12:46:18Z", "type": "commit"}, {"oid": "ad7eab7a65578b682c25e5923c7dd3f3b5a50073", "url": "https://github.com/apache/incubator-doris/commit/ad7eab7a65578b682c25e5923c7dd3f3b5a50073", "message": "fix for null sequence_col", "committedDate": "2020-08-28T17:47:00Z", "type": "commit"}]}