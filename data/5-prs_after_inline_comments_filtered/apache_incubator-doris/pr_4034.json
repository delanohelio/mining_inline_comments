{"pr_number": 4034, "pr_title": "[Bug][Broker] Fix bug that the error exception is not caught when closing the broker writer", "pr_createdAt": "2020-07-07T04:37:51Z", "pr_url": "https://github.com/apache/incubator-doris/pull/4034", "timeline": [{"oid": "1693dda6bf7a40b81b3e8530029b8a5d8f336afa", "url": "https://github.com/apache/incubator-doris/commit/1693dda6bf7a40b81b3e8530029b8a5d8f336afa", "message": "[Bug][Broker] Fix bug that the error exception is not caught when closing the broker writer\n\nBroker should return the error status.", "committedDate": "2020-07-07T04:27:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDYyNzM2MQ==", "url": "https://github.com/apache/incubator-doris/pull/4034#discussion_r450627361", "bodyText": "The md5sum was generated before the local file upload to remote, which means the local file is a empty file.\nIs it normal we have a empty local file?", "author": "xy720", "createdAt": "2020-07-07T05:57:21Z", "path": "fs_brokers/apache_hdfs_broker/src/main/java/org/apache/doris/broker/hdfs/FileSystemManager.java", "diffHunk": "@@ -586,6 +586,8 @@ public void closeReader(TBrokerFD fd) {\n                 fsDataInputStream.close();\n             } catch (IOException e) {\n                 logger.error(\"errors while close file input stream\", e);\n+                throw new BrokerException(TBrokerOperationStatusCode.TARGET_STORAGE_SERVICE_ERROR,\n+                        e, \"errors while close file input stream\");", "originalCommit": "1693dda6bf7a40b81b3e8530029b8a5d8f336afa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDYyOTE2OA==", "url": "https://github.com/apache/incubator-doris/pull/4034#discussion_r450629168", "bodyText": "Not because an empty file was uploaded, but because the uploaded file was not closed properly, resulting in an empty file.", "author": "morningman", "createdAt": "2020-07-07T06:03:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDYyNzM2MQ=="}], "type": "inlineReview"}]}