{"pr_number": 2491, "pr_title": "[apex] Make apex have a single RootNode ", "pr_createdAt": "2020-05-18T14:17:30Z", "pr_url": "https://github.com/pmd/pmd/pull/2491", "timeline": [{"oid": "dfb1c2f080c353c1f2a1f8c85962abd052f13bda", "url": "https://github.com/pmd/pmd/commit/dfb1c2f080c353c1f2a1f8c85962abd052f13bda", "message": "Simplify apex parser", "committedDate": "2020-05-18T14:08:25Z", "type": "commit"}, {"oid": "e248bac57b55759bf60c85c739ac05d87d54e04a", "url": "https://github.com/pmd/pmd/commit/e248bac57b55759bf60c85c739ac05d87d54e04a", "message": "Make apex have a single root node", "committedDate": "2020-05-18T14:08:25Z", "type": "commit"}, {"oid": "39ff1145c4339181685280b317e6fd0aa6c90636", "url": "https://github.com/pmd/pmd/commit/39ff1145c4339181685280b317e6fd0aa6c90636", "message": "Remove apex CanSuppressWarnings", "committedDate": "2020-05-18T14:08:25Z", "type": "commit"}, {"oid": "00a2497c9def04befe98ea22e6f8530c7e212d96", "url": "https://github.com/pmd/pmd/commit/00a2497c9def04befe98ea22e6f8530c7e212d96", "message": "Make apex version available", "committedDate": "2020-05-18T14:08:25Z", "type": "commit"}, {"oid": "e198b6afb5e723d67d356fcdbeeb14a969b6d897", "url": "https://github.com/pmd/pmd/commit/e198b6afb5e723d67d356fcdbeeb14a969b6d897", "message": "Fix tests", "committedDate": "2020-05-18T14:08:25Z", "type": "commit"}, {"oid": "584ccc806b64a54595790533f722db770f6c8423", "url": "https://github.com/pmd/pmd/commit/584ccc806b64a54595790533f722db770f6c8423", "message": "Remove useless `implements Node`", "committedDate": "2020-05-18T14:21:04Z", "type": "commit"}, {"oid": "53529f0f39f958d00f4c254b0b00dd4e974ef7e5", "url": "https://github.com/pmd/pmd/commit/53529f0f39f958d00f4c254b0b00dd4e974ef7e5", "message": "Merge branch '7.0.x' into apex-single-rootnode-2", "committedDate": "2020-05-21T08:50:59Z", "type": "commit"}, {"oid": "d3d75fa0b91e30c59c6a947743a948ee09f5b051", "url": "https://github.com/pmd/pmd/commit/d3d75fa0b91e30c59c6a947743a948ee09f5b051", "message": "Merge branch '7.0.x' into apex-single-rootnode-2", "committedDate": "2020-06-14T17:04:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE0MjczOA==", "url": "https://github.com/pmd/pmd/pull/2491#discussion_r443142738", "bodyText": "This change effectively moves ApexParser from package lang.apex into lang.apex.ast.\nI guess, we should internalize this one on master, as we did with the JavaLanguageParser.\nDone in 23c08b5", "author": "adangel", "createdAt": "2020-06-20T16:26:23Z", "path": "pmd-apex/src/main/java/net/sourceforge/pmd/lang/apex/ApexParser.java", "diffHunk": "@@ -1,30 +0,0 @@\n-/**\n- * BSD-style license; for more info see http://pmd.sourceforge.net/license.html\n- */\n-\n-package net.sourceforge.pmd.lang.apex;\n-\n-import java.io.Reader;\n-\n-import net.sourceforge.pmd.lang.AbstractParser;\n-import net.sourceforge.pmd.lang.ParserOptions;\n-import net.sourceforge.pmd.lang.ast.ParseException;\n-import net.sourceforge.pmd.lang.ast.RootNode;\n-\n-/**\n- * Adapter for the Apex jorje parser\n- */\n-public class ApexParser extends AbstractParser {", "originalCommit": "d3d75fa0b91e30c59c6a947743a948ee09f5b051", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE0NDM0Ng==", "url": "https://github.com/pmd/pmd/pull/2491#discussion_r443144346", "bodyText": "On master, in seems we have a bug: we don't visit top-level ASTUserEnum and ASTAnonymousClass...\nEnums in Apex can't have additional user defined methods, so they only define the constants. This means, only rules like Naming conventions would suffer from this bug.\nJust tested it: this rule uses rulechain, so we directly visit UserEnum - that works. The tests look like, they were written before introducing rule chain, since they don't have a top-level enum...\nASTAnonymousClass - hm... a anonymous class can't be top-level. So, this should be no issue at all... In fact, I have no clue, how to write an anonymous class in Apex....\nThis is addressed in #2610", "author": "adangel", "createdAt": "2020-06-20T16:51:27Z", "path": "pmd-apex/src/main/java/net/sourceforge/pmd/lang/apex/rule/AbstractApexRule.java", "diffHunk": "@@ -131,13 +131,9 @@ public void apply(List<? extends Node> nodes, RuleContext ctx) {\n     }\n \n     protected void visitAll(List<? extends Node> nodes, RuleContext ctx) {\n-        for (Object element : nodes) {\n-            if (element instanceof ASTUserClass) {\n-                visit((ASTUserClass) element, ctx);\n-            } else if (element instanceof ASTUserInterface) {\n-                visit((ASTUserInterface) element, ctx);\n-            } else if (element instanceof ASTUserTrigger) {\n-                visit((ASTUserTrigger) element, ctx);", "originalCommit": "d3d75fa0b91e30c59c6a947743a948ee09f5b051", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}