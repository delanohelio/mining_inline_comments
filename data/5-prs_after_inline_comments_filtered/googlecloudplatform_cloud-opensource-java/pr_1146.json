{"pr_number": 1146, "pr_title": "ClassDumper to catch ClassFormatException", "pr_createdAt": "2020-01-23T16:52:18Z", "pr_url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1146", "timeline": [{"oid": "85f54ebb241f57c466711b0fdebe6af9258a4de7", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/85f54ebb241f57c466711b0fdebe6af9258a4de7", "message": "ClassDumper to catch ClassFormatException", "committedDate": "2020-01-23T16:51:31Z", "type": "commit"}, {"oid": "256298fd46c23248d12d26820782a0feaaad264d", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/256298fd46c23248d12d26820782a0feaaad264d", "message": "Updating comment", "committedDate": "2020-01-23T16:54:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI3NDA2Mw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1146#discussion_r370274063", "bodyText": "Is a ClassNotFoundException usually caused by a corrupted jar file? Or is that just a normal version conflict where the version of the jar we have is not the one that was expected?", "author": "elharo", "createdAt": "2020-01-23T18:09:08Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassDumper.java", "diffHunk": "@@ -398,8 +398,8 @@ Path findClassLocation(String className) {\n       try {\n         JavaClass javaClass = classRepository.loadClass(classFileName);\n         javaClasses.add(javaClass);\n-      } catch (ClassNotFoundException ex) {\n-        // We couldn't find the class in the jar file where we found it.\n+      } catch (ClassNotFoundException | ClassFormatException ex) {", "originalCommit": "256298fd46c23248d12d26820782a0feaaad264d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI3NTg3Mg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1146#discussion_r370275872", "bodyText": "ClassNotFoundException was also caused by a corrupted JAR file as in\nhttps://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1090/files", "author": "suztomo", "createdAt": "2020-01-23T18:13:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI3NDA2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI4MzM2OA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1146#discussion_r370283368", "bodyText": "Yes, I'm just wondering if there are causes that are not corrupt jar files, and whether we're properly reporting them if so? It's weird that #1090 used ClassNotFoundException instead of ClassFormatException. How certain is it that that that was the right fix?", "author": "elharo", "createdAt": "2020-01-23T18:29:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI3NDA2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI5NDE2MQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1146#discussion_r370294161", "bodyText": "In the kinesis-client problem (#1090), JAR index contained a file starting with \".\", which was weird. BCEL threw ClassNotFoundException because it cannot find such file in the JAR. So the fix was to catch ClassNotFoundException. I see the fix was reasonable.", "author": "suztomo", "createdAt": "2020-01-23T18:51:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI3NDA2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDMwMDUwNA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1146#discussion_r370300504", "bodyText": "Was it really a corrupt jar file or was BCEL buggy here?\nI don't think all ClassNotFoundExceptions indicate corrupt jar files, even if that particular one does.", "author": "elharo", "createdAt": "2020-01-23T19:05:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI3NDA2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDMwNTkwOQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1146#discussion_r370305909", "bodyText": "As discussed, javap also show \"class not found\" for the kinesis JAR.\nsuztomo@suxtomo24:~$ javap -cp /usr/local/google/home/suztomo/.m2/repository/com/amazonaws/amazon-kinesis-client/1.13.0/amazon-kinesis-client-1.13.0.jar '.unison.com.e007f77498fd27177e2ea931a06dcf50.unison.tmp/amazonaws/services/kinesis/multilang/messages/CheckpointMessage'\nError: class not found: .unison.com.e007f77498fd27177e2ea931a06dcf50.unison.tmp/amazonaws/services/kinesis/multilang/messages/CheckpointMessage", "author": "suztomo", "createdAt": "2020-01-23T19:17:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI3NDA2Mw=="}], "type": "inlineReview"}, {"oid": "a748d6883b20f343f826564e9b6452ecc66fe910", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/a748d6883b20f343f826564e9b6452ecc66fe910", "message": "Merge branch 'master' into classformatexception", "committedDate": "2020-01-23T19:22:09Z", "type": "commit"}, {"oid": "61658f2aed3eb4b146a953a3cc7d73e2f38b202d", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/61658f2aed3eb4b146a953a3cc7d73e2f38b202d", "message": "Merge branch 'master' into classformatexception", "committedDate": "2020-01-23T19:52:10Z", "type": "commit"}]}