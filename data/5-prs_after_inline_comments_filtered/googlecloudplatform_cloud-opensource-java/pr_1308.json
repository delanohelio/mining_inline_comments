{"pr_number": 1308, "pr_title": "ClassPathEntry to replace java.nio.file.Path", "pr_createdAt": "2020-03-23T19:33:12Z", "pr_url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1308", "timeline": [{"oid": "a44c7b64332e52db1e1e8d28c58d398494642082", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/a44c7b64332e52db1e1e8d28c58d398494642082", "message": "ClassPathElement", "committedDate": "2020-03-23T19:29:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjcwOTk1NA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1308#discussion_r396709954", "bodyText": "This is where the ClassPathElement instances are used.", "author": "suztomo", "createdAt": "2020-03-23T19:40:49Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageCheckClassPath.java", "diffHunk": "@@ -53,8 +52,11 @@\n    *\n    * @param paths list of absolute paths for the elements in the class path\n    */\n-  LinkageCheckClassPath(List<Path> paths) {\n-    super(paths.stream().map(Path::toString).collect(Collectors.joining(File.pathSeparator)));\n+  LinkageCheckClassPath(List<ClassPathElement> paths) {\n+    super(\n+        paths.stream()\n+            .map(ClassPathElement::getClassPath)\n+            .collect(Collectors.joining(File.pathSeparator)));", "originalCommit": "a44c7b64332e52db1e1e8d28c58d398494642082", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9111f4a745d04c637b5eb4adf486b933c0fd0cfc", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/9111f4a745d04c637b5eb4adf486b933c0fd0cfc", "message": "getArtifact", "committedDate": "2020-03-23T19:53:43Z", "type": "commit"}, {"oid": "276c07f050b5f549e3274362b3f294f100c02fa9", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/276c07f050b5f549e3274362b3f294f100c02fa9", "message": "checkNotNull(artifact.file)", "committedDate": "2020-03-23T19:54:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc2ODczNA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1308#discussion_r396768734", "bodyText": "Oracle's docs call these entries, not elements:\nhttps://docs.oracle.com/javase/8/docs/technotes/tools/windows/classpath.html", "author": "elharo", "createdAt": "2020-03-23T21:30:27Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassPathElement.java", "diffHunk": "@@ -0,0 +1,24 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;", "originalCommit": "276c07f050b5f549e3274362b3f294f100c02fa9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg3NjU0Mw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1308#discussion_r396876543", "bodyText": "Updated to ClassPathEntry", "author": "suztomo", "createdAt": "2020-03-24T02:59:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc2ODczNA=="}], "type": "inlineReview"}, {"oid": "3547a03e8fa95fe7d1edd1adeb58aa48c6f0dd2a", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/3547a03e8fa95fe7d1edd1adeb58aa48c6f0dd2a", "message": "ClassPathEntry", "committedDate": "2020-03-24T01:47:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI0ODg0OA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1308#discussion_r397248848", "bodyText": "This is a path as a string, not a class path. A path looks like \"/usr/lib/classes/foo.jar\"\nA classpath is a semicolon or colon separated list of paths.", "author": "elharo", "createdAt": "2020-03-24T15:36:05Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/JarClassPathEntry.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import java.nio.file.Path;\n+import java.util.Objects;\n+\n+/** JAR file entry in a class path. */\n+class JarClassPathEntry implements ClassPathEntry {\n+  private Path jar;\n+\n+  JarClassPathEntry(Path jar) {\n+    this.jar = jar;\n+  }\n+\n+  @Override\n+  public String getClassPath() {", "originalCommit": "3547a03e8fa95fe7d1edd1adeb58aa48c6f0dd2a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI3NjIyMw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1308#discussion_r397276223", "bodyText": "A class path consists of smaller class paths.\n-classpath classpath1;classpath2...\n\nhttps://docs.oracle.com/javase/7/docs/technotes/tools/windows/classpath.html\nThat's why I named getClassPath. Do you think of better name?", "author": "suztomo", "createdAt": "2020-03-24T16:10:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI0ODg0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI4MTM4Mg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1308#discussion_r397281382", "bodyText": "A classpath consists of class paths entries, not classpaths. And a classpath entry is a path.", "author": "elharo", "createdAt": "2020-03-24T16:16:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI0ODg0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI4MzI3NA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1308#discussion_r397283274", "bodyText": "Then String getPath().", "author": "suztomo", "createdAt": "2020-03-24T16:19:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI0ODg0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI1MjY1Nw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1308#discussion_r397252657", "bodyText": "Should we be able to use this type exclusively? If we have to do any casting or reflection to determine the real type, the design is incomplete.", "author": "elharo", "createdAt": "2020-03-24T15:41:04Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassPathEntry.java", "diffHunk": "@@ -0,0 +1,24 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+/** An entry in Java class path. */\n+interface ClassPathEntry {", "originalCommit": "3547a03e8fa95fe7d1edd1adeb58aa48c6f0dd2a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI3MDcwMQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1308#discussion_r397270701", "bodyText": "Almost. ArtifactClassPathEntry will appear only when Linkage Checker needs to read Artifact's coordinates. It's intended, as that's the reason why I'm class path entries artifact-aware when class paths are from Maven artifacts.", "author": "suztomo", "createdAt": "2020-03-24T16:03:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI1MjY1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI3ODk0OQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1308#discussion_r397278949", "bodyText": "It sounds like this class hierarchy doesn't match the use case. We shouldn't need reflection or instanceof.", "author": "elharo", "createdAt": "2020-03-24T16:13:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI1MjY1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzMwNDAxOQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1308#discussion_r397304019", "bodyText": "Updated ClassPathEntry as a concrete class. ArtifactClassPathEntry is a spacial case of ClassPathEntry that has associated Maven artifact. It will use instanceof to see a class path entry has associated Maven artifact. I don't think this use of instanceof means a bad class hierarchy.", "author": "suztomo", "createdAt": "2020-03-24T16:46:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI1MjY1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzMxNDQ4MA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1308#discussion_r397314480", "bodyText": "Updated. ClassPathEntry now has getArtifact, which returns null by default. ArtifactClassPathEntry overrides it. Now we will not need to have instanceof.", "author": "suztomo", "createdAt": "2020-03-24T17:00:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI1MjY1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI1MzYyOQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1308#discussion_r397253629", "bodyText": "Why interface instead of abstract class? Abstract classes are more powerful and much more changeable. E.g. you can add methods to one without breaking all subclasses.", "author": "elharo", "createdAt": "2020-03-24T15:42:14Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassPathEntry.java", "diffHunk": "@@ -0,0 +1,24 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+/** An entry in Java class path. */\n+interface ClassPathEntry {", "originalCommit": "3547a03e8fa95fe7d1edd1adeb58aa48c6f0dd2a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI3MTkzMg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1308#discussion_r397271932", "bodyText": "I made this as as interface because I don't need any concrete methods or fields. Interfaces can have implementation too. I don't see one is better than the other in this case.", "author": "suztomo", "createdAt": "2020-03-24T16:04:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI1MzYyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI4MDE5OA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1308#discussion_r397280198", "bodyText": "This point might become moot, but I really think the default should be class, not interface, without a strong reason otherwise. Interfaces are much more brittle than classes and have less functionality. They are vastly overused in Java today to no good end.", "author": "elharo", "createdAt": "2020-03-24T16:15:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI1MzYyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI5ODE3OA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1308#discussion_r397298178", "bodyText": "Changed this from interface to a concrete class.", "author": "suztomo", "createdAt": "2020-03-24T16:38:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI1MzYyOQ=="}], "type": "inlineReview"}, {"oid": "dcd8253354d1e70118ea0882a03c251778a3e854", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/dcd8253354d1e70118ea0882a03c251778a3e854", "message": "Removed interface", "committedDate": "2020-03-24T16:35:45Z", "type": "commit"}, {"oid": "92a896970e73f657e946ef81e43b85dac1563026", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/92a896970e73f657e946ef81e43b85dac1563026", "message": "getArtifact for ClassPathEntry", "committedDate": "2020-03-24T16:58:39Z", "type": "commit"}, {"oid": "3d887a9f20cf9300d8df8971f897e1a0affd8c59", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/3d887a9f20cf9300d8df8971f897e1a0affd8c59", "message": "One class", "committedDate": "2020-03-24T20:46:05Z", "type": "commit"}, {"oid": "b6979fd3daeb669b85f2c55ba5770b8d35971220", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/b6979fd3daeb669b85f2c55ba5770b8d35971220", "message": "Format", "committedDate": "2020-03-24T20:50:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ2NDE4OA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1308#discussion_r397464188", "bodyText": "for --> with", "author": "elharo", "createdAt": "2020-03-24T21:12:34Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassPathEntry.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import static com.google.common.base.Preconditions.checkNotNull;\n+\n+import java.nio.file.Path;\n+import java.util.Objects;\n+import org.eclipse.aether.artifact.Artifact;\n+\n+/** An entry in a class path. */\n+final class ClassPathEntry {\n+\n+  private Path jar;\n+  private Artifact artifact;\n+\n+  /** An entry for a JAR file without association with a Maven artifact. */\n+  ClassPathEntry(Path jar) {\n+    this.jar = checkNotNull(jar);\n+  }\n+\n+  /** An entry for a Maven artifact. */\n+  ClassPathEntry(Artifact artifact) {\n+    checkNotNull(artifact.getFile());\n+    this.artifact = artifact;\n+  }\n+\n+  /** Returns the path of the entry. */\n+  String getPath() {\n+    if (artifact != null) {\n+      return artifact.getFile().toString();\n+    } else {\n+      return jar.toString();\n+    }\n+  }\n+\n+  /**\n+   * Returns Maven artifact associated for the JAR file. If the JAR file does not have an artifact,", "originalCommit": "b6979fd3daeb669b85f2c55ba5770b8d35971220", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA0NTYxNw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1308#discussion_r398045617", "bodyText": "updated.", "author": "suztomo", "createdAt": "2020-03-25T17:39:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ2NDE4OA=="}], "type": "inlineReview"}, {"oid": "277c2f979a17cb9d74e5278abeee4ce3be99d3ba", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/277c2f979a17cb9d74e5278abeee4ce3be99d3ba", "message": "Applied review", "committedDate": "2020-03-25T17:21:11Z", "type": "commit"}]}