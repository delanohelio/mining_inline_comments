{"pr_number": 1359, "pr_title": "LinkageCheckerMain to throw LinkageCheckResultException when it finds error", "pr_createdAt": "2020-04-17T15:40:30Z", "pr_url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1359", "timeline": [{"oid": "6d81a8cfdad2406b199b88eb2b2dfca2a21775a6", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/6d81a8cfdad2406b199b88eb2b2dfca2a21775a6", "message": "LinkageCheckerMain throws LinkageCheckResultException", "committedDate": "2020-04-17T15:13:51Z", "type": "commit"}, {"oid": "4631c891fac29e6c512e1b297da397b96e37d1ef", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/4631c891fac29e6c512e1b297da397b96e37d1ef", "message": "More test", "committedDate": "2020-04-17T15:36:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDMwODk0Mg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1359#discussion_r410308942", "bodyText": "I know think with \"--output-exclusion-file\" option the tool should not print linkage errors. Showing \"Wrote the linkage errors as exclusion file: ...\" message is the exact effect of the option. Showing other linkage errors in console, potentially hundreds of lines, obscures the message.", "author": "suztomo", "createdAt": "2020-04-17T15:45:32Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerMain.java", "diffHunk": "@@ -98,12 +99,15 @@ public static void main(String[] arguments)\n                       symbolProblems, classFile -> graph.isReachable(classFile.getBinaryName())));\n         }\n \n-        System.out.println(SymbolProblem.formatSymbolProblems(symbolProblems));\n-\n         Path writeAsExclusionFile = linkageCheckerArguments.getOutputExclusionFile();\n         if (writeAsExclusionFile != null) {\n           ExclusionFiles.write(writeAsExclusionFile, symbolProblems);\n           System.out.println(\"Wrote the linkage errors as exclusion file: \" + writeAsExclusionFile);\n+          return;\n+        }\n+\n+        if (!symbolProblems.isEmpty()) {\n+          System.out.println(SymbolProblem.formatSymbolProblems(symbolProblems));\n         }", "originalCommit": "4631c891fac29e6c512e1b297da397b96e37d1ef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDMwOTQ2MQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1359#discussion_r410309461", "bodyText": "With System.exit, we would not be able to test LinkageCheckerMain's failure status. Therefore this PR proposes an exception to tell the failure to the caller of the tool (Gradle in mind).", "author": "suztomo", "createdAt": "2020-04-17T15:46:22Z", "path": "dependencies/src/test/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerMainIntegrationTest.java", "diffHunk": "@@ -64,8 +67,12 @@ public void testJarFiles()\n \n     String jarArgument = googleCloudCore + \",\" + googleCloudFirestore + \",\" + guava;\n \n-    // This should not raise Exception\n-    LinkageCheckerMain.main(new String[] {\"-j\", jarArgument});\n+    try {\n+      LinkageCheckerMain.main(new String[] {\"-j\", jarArgument});\n+      fail(\"LinkageCheckerMain should throw LinkageCheckResultException upon errors\");\n+    } catch (LinkageCheckResultException expected) {", "originalCommit": "4631c891fac29e6c512e1b297da397b96e37d1ef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQxNDU1Mg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1359#discussion_r410414552", "bodyText": "You could extract everything from main except System.exit() into a new method and test that. Or you could add an extra \"don't exit\" argument for tests, or some such. But this should work too.", "author": "elharo", "createdAt": "2020-04-17T19:01:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDMwOTQ2MQ=="}], "type": "inlineReview"}, {"oid": "838f912028deb43b984d24d1b0e9cab45e448496", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/838f912028deb43b984d24d1b0e9cab45e448496", "message": "lineSeparator", "committedDate": "2020-04-17T17:37:19Z", "type": "commit"}]}