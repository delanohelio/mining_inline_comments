{"pr_number": 1681, "pr_title": "ReturnTypeChangedProblem's error message should clarify the expected and actual return types", "pr_createdAt": "2020-09-25T14:44:02Z", "pr_url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1681", "timeline": [{"oid": "1459d43960a1ed050663239e8c1f10d90527f8f3", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/1459d43960a1ed050663239e8c1f10d90527f8f3", "message": "Fixes #1541", "committedDate": "2020-09-25T14:40:15Z", "type": "commit"}, {"oid": "1aad4f6e75c03b4f6bf10a5a108de4ea10450d99", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/1aad4f6e75c03b4f6bf10a5a108de4ea10450d99", "message": "format", "committedDate": "2020-09-25T14:43:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTAzODI0OA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1681#discussion_r495038248", "bodyText": "\"is not found\" message is gone.", "author": "suztomo", "createdAt": "2020-09-25T14:45:27Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ReturnTypeChangedProblem.java", "diffHunk": "@@ -24,15 +26,32 @@\n  * actualTypeName}).\n  */\n class ReturnTypeChangedProblem extends LinkageProblem {\n+  private String actualType;\n+\n   ReturnTypeChangedProblem(\n       ClassFile sourceClass,\n       @Nullable ClassFile targetClass,\n       MethodSymbol expectedMethodSymbol,\n       String actualType) {\n     super(\n-        \"is not found. The expected return type does not match the actual type \" + actualType,", "originalCommit": "1aad4f6e75c03b4f6bf10a5a108de4ea10450d99", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTAzODUxMQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1681#discussion_r495038511", "bodyText": "Because of the missing equals method, this test was not using correct expected value.\nThe last argument of ReturnTypeChangedProblem is the actual type. protobuf-java 3.12.4 expects flip() method to return java.nio.CharBuffer but in JDK 8 the method actually has return type java.nio.Buffer.", "author": "suztomo", "createdAt": "2020-09-25T14:45:54Z", "path": "dependencies/src/test/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerTest.java", "diffHunk": "@@ -1145,7 +1145,7 @@ public void testFindLinkageProblems_referenceToJava11Method() throws IOException\n             new ClassFile(jars.get(0), \"com.google.protobuf.TextFormat\"),\n             null,\n             methodSymbol,\n-            \"java.nio.CharBuffer\");\n+            \"java.nio.Buffer\");", "originalCommit": "1aad4f6e75c03b4f6bf10a5a108de4ea10450d99", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA0MTcyNQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1681#discussion_r495041725", "bodyText": "These overrides have been missing and allowed testFindLinkageProblems_referenceToJava11Method to ignore the actualType field.", "author": "suztomo", "createdAt": "2020-09-25T14:50:54Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ReturnTypeChangedProblem.java", "diffHunk": "@@ -24,15 +26,32 @@\n  * actualTypeName}).\n  */\n class ReturnTypeChangedProblem extends LinkageProblem {\n+  private String actualType;\n+\n   ReturnTypeChangedProblem(\n       ClassFile sourceClass,\n       @Nullable ClassFile targetClass,\n       MethodSymbol expectedMethodSymbol,\n       String actualType) {\n     super(\n-        \"is not found. The expected return type does not match the actual type \" + actualType,\n+        \"is expected to return \"\n+            + Utility.methodSignatureReturnType(expectedMethodSymbol.getDescriptor())\n+            + \" but the actual type is \"\n+            + actualType,\n         sourceClass,\n         expectedMethodSymbol,\n         targetClass);\n+    this.actualType = actualType;\n+  }\n+\n+  @Override\n+  public int hashCode() {\n+    return Objects.hash(super.hashCode(), actualType);\n+  }\n+\n+  @Override\n+  public boolean equals(Object other) {\n+    return super.equals(other) // this checks the class equality\n+        && Objects.equals(actualType, ((ReturnTypeChangedProblem) other).actualType);", "originalCommit": "1aad4f6e75c03b4f6bf10a5a108de4ea10450d99", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE1NDQ2NQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1681#discussion_r495154465", "bodyText": "Good catch. The equals method in the supertype should perhaps be testing for class equality.", "author": "elharo", "createdAt": "2020-09-25T18:14:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA0MTcyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE3OTgwOQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1681#discussion_r495179809", "bodyText": "Added test with ReturnTypeChangedProblem.", "author": "suztomo", "createdAt": "2020-09-25T19:06:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA0MTcyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE1MzcwMQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1681#discussion_r495153701", "bodyText": "why a com.sun class?", "author": "elharo", "createdAt": "2020-09-25T18:12:30Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ReturnTypeChangedProblem.java", "diffHunk": "@@ -16,6 +16,8 @@\n \n package com.google.cloud.tools.opensource.classpath;\n \n+import com.sun.org.apache.bcel.internal.classfile.Utility;", "originalCommit": "1aad4f6e75c03b4f6bf10a5a108de4ea10450d99", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE3OTAxNA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1681#discussion_r495179014", "bodyText": "Fixed. It was fetching the class from rt.jar. Interesting.", "author": "suztomo", "createdAt": "2020-09-25T19:04:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE1MzcwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE1NDAzOQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1681#discussion_r495154039", "bodyText": "\"the actual type is\" --> but instead returns", "author": "elharo", "createdAt": "2020-09-25T18:13:11Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ReturnTypeChangedProblem.java", "diffHunk": "@@ -24,15 +26,32 @@\n  * actualTypeName}).\n  */\n class ReturnTypeChangedProblem extends LinkageProblem {\n+  private String actualType;\n+\n   ReturnTypeChangedProblem(\n       ClassFile sourceClass,\n       @Nullable ClassFile targetClass,\n       MethodSymbol expectedMethodSymbol,\n       String actualType) {\n     super(\n-        \"is not found. The expected return type does not match the actual type \" + actualType,\n+        \"is expected to return \"\n+            + Utility.methodSignatureReturnType(expectedMethodSymbol.getDescriptor())\n+            + \" but the actual type is \"", "originalCommit": "1aad4f6e75c03b4f6bf10a5a108de4ea10450d99", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE3OTQ1Mw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1681#discussion_r495179453", "bodyText": "Nice. Updated.", "author": "suztomo", "createdAt": "2020-09-25T19:05:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE1NDAzOQ=="}], "type": "inlineReview"}, {"oid": "b2ba7c748f18f793d1f9e9c1fca59a5b69c6aeb3", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/b2ba7c748f18f793d1f9e9c1fca59a5b69c6aeb3", "message": "Applied review", "committedDate": "2020-09-25T19:06:47Z", "type": "commit"}, {"oid": "789f017cd36655efb8b82378b2c1264a35816472", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/789f017cd36655efb8b82378b2c1264a35816472", "message": "Added test", "committedDate": "2020-09-25T19:44:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTI0MTUwMg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1681#discussion_r495241502", "bodyText": "sort imports", "author": "elharo", "createdAt": "2020-09-25T21:24:07Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ReturnTypeChangedProblem.java", "diffHunk": "@@ -16,6 +16,8 @@\n \n package com.google.cloud.tools.opensource.classpath;\n \n+import org.apache.bcel.classfile.Utility;", "originalCommit": "789f017cd36655efb8b82378b2c1264a35816472", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTI4NDg4MA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1681#discussion_r495284880", "bodyText": "Fixed.", "author": "suztomo", "createdAt": "2020-09-25T22:31:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTI0MTUwMg=="}], "type": "inlineReview"}, {"oid": "45f8e92ac198588c6250b63e927f5f5709895181", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/45f8e92ac198588c6250b63e927f5f5709895181", "message": "Sorting import", "committedDate": "2020-09-25T22:30:21Z", "type": "commit"}, {"oid": "255eee250c92d471440215a810496c19c72f1c1b", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/255eee250c92d471440215a810496c19c72f1c1b", "message": "Merge remote-tracking branch 'origin/master' into return_type", "committedDate": "2020-09-25T22:30:47Z", "type": "commit"}]}