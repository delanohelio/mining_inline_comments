{"pr_number": 1604, "pr_title": "Proper error message for AbstractMethodProblem and correct source and target", "pr_createdAt": "2020-08-18T15:24:50Z", "pr_url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604", "timeline": [{"oid": "e539727550dd1baada3f7e938d857ceb8350c5eb", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/e539727550dd1baada3f7e938d857ceb8350c5eb", "message": "Changed source and target", "committedDate": "2020-08-18T15:23:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjI4MjI5Nw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r472282297", "bodyText": "???", "author": "suztomo", "createdAt": "2020-08-18T15:25:08Z", "path": "dependencies/src/test/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerMainIntegrationTest.java", "diffHunk": "@@ -131,7 +131,7 @@ public void testBom()\n       LinkageCheckerMain.main(new String[] {\"-b\", \"com.google.cloud:libraries-bom:1.0.0\"});\n       fail(\"LinkageCheckerMain should throw LinkageCheckResultException upon errors\");\n     } catch (LinkageCheckResultException expected) {\n-      assertEquals(\"Found 800 linkage errors\", expected.getMessage());\n+      assertEquals(\"Found 801 linkage errors\", expected.getMessage());", "originalCommit": "e539727550dd1baada3f7e938d857ceb8350c5eb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjI5MTgxMg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r472291812", "bodyText": "LinkageCheckerMain groups by the targets of the linkage errors. As we're flipping the source and target, the number of groups changes.", "author": "suztomo", "createdAt": "2020-08-18T15:38:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjI4MjI5Nw=="}], "type": "inlineReview"}, {"oid": "dc13943d70a8a34b6334cd6dd86d11848b92d72a", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/dc13943d70a8a34b6334cd6dd86d11848b92d72a", "message": "subclass", "committedDate": "2020-08-18T15:36:52Z", "type": "commit"}, {"oid": "9ece9adac1995e50d807c80da272c50de23033b0", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/9ece9adac1995e50d807c80da272c50de23033b0", "message": "Proper message for AbstractMethodProblem", "committedDate": "2020-08-19T18:00:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIyNDYzMw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r473224633", "bodyText": "When printing linkage problems, we group them by symbols with \"... referenced by ...\" format. With this PR, AbstractMethodProblem are printed without the grouping.", "author": "suztomo", "createdAt": "2020-08-19T18:04:44Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java", "diffHunk": "@@ -150,9 +150,21 @@ public String formatSymbolProblem() {\n   public static String formatLinkageProblems(Set<LinkageProblem> linkageProblems) {\n     StringBuilder output = new StringBuilder();\n \n+    // Not to group AbstractMethodProblems by symbols because they do not fit in the\n+    // \"... referenced by ...\" format.\n+    ImmutableSet.Builder<AbstractMethodProblem> abstractMethodProblems = ImmutableSet.builder();\n+    ImmutableSet.Builder<LinkageProblem> problemsToGroupBySymbols = ImmutableSet.builder();\n+    for (LinkageProblem linkageProblem : linkageProblems) {\n+      if (linkageProblem instanceof AbstractMethodProblem) {\n+        abstractMethodProblems.add((AbstractMethodProblem) linkageProblem);\n+      } else {\n+        problemsToGroupBySymbols.add(linkageProblem);\n+      }\n+    }", "originalCommit": "9ece9adac1995e50d807c80da272c50de23033b0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIyNTA5MQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r473225091", "bodyText": "toString would print the class name too, which was unnecessary for showing AbstractMethodProblem's toString.", "author": "suztomo", "createdAt": "2020-08-19T18:05:32Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/MethodSymbol.java", "diffHunk": "@@ -94,4 +94,11 @@ public String toString() {\n         + \"'s method \"\n         + signature;\n   }\n+\n+  /** Returns the method name with its signature. */\n+  public String getMethodNameWithSignature() {", "originalCommit": "9ece9adac1995e50d807c80da272c50de23033b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDIwNzU1OQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r474207559", "bodyText": "Fine, though it probably doesn't need to be public", "author": "elharo", "createdAt": "2020-08-20T19:05:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIyNTA5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDIxNDU5NA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r474214594", "bodyText": "Good catch. Removed public.", "author": "suztomo", "createdAt": "2020-08-20T19:18:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIyNTA5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIyNjY0MA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r473226640", "bodyText": "Switching source and target. Now implementation class is source because it references the interface.", "author": "suztomo", "createdAt": "2020-08-19T18:08:22Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/AbstractMethodProblem.java", "diffHunk": "@@ -17,12 +17,29 @@\n package com.google.cloud.tools.opensource.classpath;\n \n /**\n- * The referenced {@code methodSymbol} is not implemented in the {@code targetClass} but the class\n- * is declared to implement the method by {@code sourceClass}. Such unimplemented methods manifest\n+ * The referenced {@code methodSymbol} is not implemented in the {@code sourceClass} but the class\n+ * is declared to implement the method by {@code targetClass}. Such unimplemented methods manifest", "originalCommit": "9ece9adac1995e50d807c80da272c50de23033b0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "06bbb52303079c76de250c6e4aef409986bfc38d", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/06bbb52303079c76de250c6e4aef409986bfc38d", "message": "implementationClass and interfaceOrAbstractClass", "committedDate": "2020-08-19T18:23:58Z", "type": "commit"}, {"oid": "8521e7d33a2aca170d2f5f1eb6ffc42082ddc885", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/8521e7d33a2aca170d2f5f1eb6ffc42082ddc885", "message": "Merge remote-tracking branch 'origin/master' into interface_reference_backwards", "committedDate": "2020-08-19T18:25:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIzNjI2OA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r473236268", "bodyText": "active voice: {@code implementationClass} does not implement the abstract method {@code methodSymbol} declared by {@code interfaceOrAbstractClass}", "author": "elharo", "createdAt": "2020-08-19T18:26:35Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/AbstractMethodProblem.java", "diffHunk": "@@ -17,15 +17,22 @@\n package com.google.cloud.tools.opensource.classpath;\n \n /**\n- * The referenced {@code methodSymbol} is not implemented in the {@code sourceClass} but the class\n- * is declared to implement the method by {@code targetClass}. Such unimplemented methods manifest\n- * as {@link AbstractMethodError}s at runtime.\n+ * The referenced {@code methodSymbol} is not implemented in the {@code implementationClass} but the", "originalCommit": "06bbb52303079c76de250c6e4aef409986bfc38d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzI5MTkxNA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r473291914", "bodyText": "Quick thought that I want to make sure you guys are thinking about. Presumably we still want to be able to add an exclusion to ignore an AbstractMethodProblem. The exclusions file uses the \"source\" and \"target\" terminology. Switching this to use implementationClass and interfaceOrAbstractClass might make it a bit confusion which one maps tot source/target when excluding. I personally thought calling the implementClass the \"source\" class was clear enough.", "author": "marquiswang", "createdAt": "2020-08-19T20:13:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIzNjI2OA=="}], "type": "inlineReview"}, {"oid": "187324d0d7cb2983b639967bcc4221ae111008b4", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/187324d0d7cb2983b639967bcc4221ae111008b4", "message": "Javadoc", "committedDate": "2020-08-19T19:34:18Z", "type": "commit"}, {"oid": "84f32b54f1f311651ff743173d8ac2a63c025db5", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/84f32b54f1f311651ff743173d8ac2a63c025db5", "message": "Fixed dashboard test", "committedDate": "2020-08-19T19:56:26Z", "type": "commit"}, {"oid": "0fd5c6f7506501369c8576200871dfb1ec9eecf8", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/0fd5c6f7506501369c8576200871dfb1ec9eecf8", "message": "Enhanced Javadoc", "committedDate": "2020-08-19T20:47:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzMwOTY3Ng==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r473309676", "bodyText": "@marquiswang I updated the javadoc to clarify implementationClass is the source and interfaceOrAbstractClass is the target of the reference.", "author": "suztomo", "createdAt": "2020-08-19T20:48:45Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/AbstractMethodProblem.java", "diffHunk": "@@ -17,12 +17,36 @@\n package com.google.cloud.tools.opensource.classpath;\n \n /**\n- * The referenced {@code methodSymbol} is not implemented in the {@code targetClass} but the class\n- * is declared to implement the method by {@code sourceClass}. Such unimplemented methods manifest\n- * as {@link AbstractMethodError}s at runtime.\n+ * {@code implementationClass} (the source of an invalid reference) does not implement the abstract\n+ * method {@code methodSymbol} declared by {@code interfaceOrAbstractClass} (the target of the\n+ * reference). Such unimplemented methods manifest as {@link AbstractMethodError}s at runtime.", "originalCommit": "0fd5c6f7506501369c8576200871dfb1ec9eecf8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDIwNjk1MA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r474206950", "bodyText": "This still doesn't work. I don't see how implementationClass is the \"source of an invalid reference.\" There simply is no invalid reference here. There is a problem but it is something else entirely. It is not a reference.", "author": "elharo", "createdAt": "2020-08-20T19:04:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzMwOTY3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDIxMzc2Mg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r474213762", "bodyText": "It is a reference. Implementation class references an interface via implements keyword or an abstract class via extends keyword. Implementation-wise, it's a reference embed in the constant pool section of a class file.", "author": "suztomo", "createdAt": "2020-08-20T19:17:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzMwOTY3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDIzNDczNg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r474234736", "bodyText": "Yes, but this reference is not invalid. It's a valid, found reference. The problem is that the subtype doesn't implement an abstract method. Sources, targets, and references are not the conventionally understood way to describe this sort of problem.", "author": "elharo", "createdAt": "2020-08-20T19:50:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzMwOTY3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDI1ODM3Mg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r474258372", "bodyText": "I drew a diagram to explain how I recognize that invalid references describe the abstract method problems in the same manner as missing field problems.\n\nI'll setup.a meeting to understand your viewpoint better.", "author": "suztomo", "createdAt": "2020-08-20T20:37:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzMwOTY3Ng=="}], "type": "inlineReview"}, {"oid": "c77ba161ecf00cc59fc6e8048721d11eed20134c", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/c77ba161ecf00cc59fc6e8048721d11eed20134c", "message": "subclass -> implementing class", "committedDate": "2020-08-19T20:49:47Z", "type": "commit"}, {"oid": "837cc0fbe479737ad3aa57e00f20eeea02087b7e", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/837cc0fbe479737ad3aa57e00f20eeea02087b7e", "message": "implemented -> does not exist", "committedDate": "2020-08-20T14:20:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDIwNzE0NA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r474207144", "bodyText": "Not to --> Don't", "author": "elharo", "createdAt": "2020-08-20T19:04:36Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java", "diffHunk": "@@ -150,9 +150,21 @@ public String formatSymbolProblem() {\n   public static String formatLinkageProblems(Set<LinkageProblem> linkageProblems) {\n     StringBuilder output = new StringBuilder();\n \n+    // Not to group AbstractMethodProblems by symbols because they do not fit in the", "originalCommit": "837cc0fbe479737ad3aa57e00f20eeea02087b7e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDIxNDMxNw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r474214317", "bodyText": "Updated.", "author": "suztomo", "createdAt": "2020-08-20T19:18:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDIwNzE0NA=="}], "type": "inlineReview"}, {"oid": "14a28ca7fc1c6c54962b45ae395dff7592ff0e4d", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/14a28ca7fc1c6c54962b45ae395dff7592ff0e4d", "message": "Added test", "committedDate": "2020-08-20T19:20:54Z", "type": "commit"}, {"oid": "c27b3b38f23bc8cd1aea74a232f09e5941f461b9", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/c27b3b38f23bc8cd1aea74a232f09e5941f461b9", "message": "Applied review", "committedDate": "2020-08-20T19:21:57Z", "type": "commit"}, {"oid": "1596bf27ce95e1b75c339901f654c75dcddfceef", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/1596bf27ce95e1b75c339901f654c75dcddfceef", "message": "implementationClass is the source of the invalid symbolic reference", "committedDate": "2020-08-24T02:59:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUzMDMzMg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r475530332", "bodyText": "target class --> target\nreference --> symbolic reference\nor just delete the comment completely. It's not obviously helpful.", "author": "elharo", "createdAt": "2020-08-24T11:22:11Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/AbstractMethodProblem.java", "diffHunk": "@@ -17,12 +17,39 @@\n package com.google.cloud.tools.opensource.classpath;\n \n /**\n- * The referenced {@code methodSymbol} is not implemented in the {@code targetClass} but the class\n- * is declared to implement the method by {@code sourceClass}. Such unimplemented methods manifest\n- * as {@link AbstractMethodError}s at runtime.\n+ * {@code implementationClass} does not implement the abstract method {@code methodSymbol} declared\n+ * by {@code interfaceOrAbstractClass}. Such unimplemented methods manifest as {@link\n+ * AbstractMethodError}s at runtime.\n  */\n final class AbstractMethodProblem extends LinkageProblem {\n-  AbstractMethodProblem(ClassFile sourceClass, ClassFile targetClass, MethodSymbol methodSymbol) {\n-    super(\"is not implemented in the class\", sourceClass, methodSymbol, targetClass);\n+  MethodSymbol methodSymbol;\n+\n+  AbstractMethodProblem(\n+      ClassFile implementationClass,\n+      ClassFile interfaceOrAbstractClass,\n+      MethodSymbol methodSymbol) {\n+\n+    // implementationClass is the source of the invalid symbolic reference, and\n+    // interfaceOrAbstractClass is the target class of the reference.", "originalCommit": "1596bf27ce95e1b75c339901f654c75dcddfceef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTU5MjUwOQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r475592509", "bodyText": "Updated. I keep this comment as I'm likely to forget our discussion.", "author": "suztomo", "createdAt": "2020-08-24T13:17:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUzMDMzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUzMDQ5Mg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r475530492", "bodyText": "target class --> target\nreference --> symbolic reference\nor just delete the comment completely. It's not obviously helpful.", "author": "elharo", "createdAt": "2020-08-24T11:22:30Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/AbstractMethodProblem.java", "diffHunk": "@@ -17,12 +17,39 @@\n package com.google.cloud.tools.opensource.classpath;\n \n /**\n- * The referenced {@code methodSymbol} is not implemented in the {@code targetClass} but the class\n- * is declared to implement the method by {@code sourceClass}. Such unimplemented methods manifest\n- * as {@link AbstractMethodError}s at runtime.\n+ * {@code implementationClass} does not implement the abstract method {@code methodSymbol} declared\n+ * by {@code interfaceOrAbstractClass}. Such unimplemented methods manifest as {@link\n+ * AbstractMethodError}s at runtime.\n  */\n final class AbstractMethodProblem extends LinkageProblem {\n-  AbstractMethodProblem(ClassFile sourceClass, ClassFile targetClass, MethodSymbol methodSymbol) {\n-    super(\"is not implemented in the class\", sourceClass, methodSymbol, targetClass);\n+  MethodSymbol methodSymbol;\n+\n+  AbstractMethodProblem(\n+      ClassFile implementationClass,\n+      ClassFile interfaceOrAbstractClass,\n+      MethodSymbol methodSymbol) {\n+\n+    // implementationClass is the source of the invalid symbolic reference, and\n+    // interfaceOrAbstractClass is the target class of the reference.", "originalCommit": "1596bf27ce95e1b75c339901f654c75dcddfceef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUzMTQ2OQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r475531469", "bodyText": "methodSymbol should be the second argument and interfaceOrAbstractClass the third to match the argument order in the superclass constructor.", "author": "elharo", "createdAt": "2020-08-24T11:24:38Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/AbstractMethodProblem.java", "diffHunk": "@@ -17,12 +17,39 @@\n package com.google.cloud.tools.opensource.classpath;\n \n /**\n- * The referenced {@code methodSymbol} is not implemented in the {@code targetClass} but the class\n- * is declared to implement the method by {@code sourceClass}. Such unimplemented methods manifest\n- * as {@link AbstractMethodError}s at runtime.\n+ * {@code implementationClass} does not implement the abstract method {@code methodSymbol} declared\n+ * by {@code interfaceOrAbstractClass}. Such unimplemented methods manifest as {@link\n+ * AbstractMethodError}s at runtime.\n  */\n final class AbstractMethodProblem extends LinkageProblem {\n-  AbstractMethodProblem(ClassFile sourceClass, ClassFile targetClass, MethodSymbol methodSymbol) {\n-    super(\"is not implemented in the class\", sourceClass, methodSymbol, targetClass);\n+  MethodSymbol methodSymbol;\n+\n+  AbstractMethodProblem(\n+      ClassFile implementationClass,\n+      ClassFile interfaceOrAbstractClass,\n+      MethodSymbol methodSymbol) {", "originalCommit": "1596bf27ce95e1b75c339901f654c75dcddfceef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTU5MTkzNA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r475591934", "bodyText": "Nice idea. Moved methodSymbol.", "author": "suztomo", "createdAt": "2020-08-24T13:16:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUzMTQ2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUzMTgwMg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r475531802", "bodyText": "sourceClass -->  implementationClass", "author": "elharo", "createdAt": "2020-08-24T11:25:14Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/AbstractMethodProblem.java", "diffHunk": "@@ -17,12 +17,39 @@\n package com.google.cloud.tools.opensource.classpath;\n \n /**\n- * The referenced {@code methodSymbol} is not implemented in the {@code targetClass} but the class\n- * is declared to implement the method by {@code sourceClass}. Such unimplemented methods manifest\n- * as {@link AbstractMethodError}s at runtime.\n+ * {@code implementationClass} does not implement the abstract method {@code methodSymbol} declared\n+ * by {@code interfaceOrAbstractClass}. Such unimplemented methods manifest as {@link\n+ * AbstractMethodError}s at runtime.\n  */\n final class AbstractMethodProblem extends LinkageProblem {\n-  AbstractMethodProblem(ClassFile sourceClass, ClassFile targetClass, MethodSymbol methodSymbol) {\n-    super(\"is not implemented in the class\", sourceClass, methodSymbol, targetClass);\n+  MethodSymbol methodSymbol;\n+\n+  AbstractMethodProblem(\n+      ClassFile implementationClass,\n+      ClassFile interfaceOrAbstractClass,\n+      MethodSymbol methodSymbol) {\n+\n+    // implementationClass is the source of the invalid symbolic reference, and\n+    // interfaceOrAbstractClass is the target class of the reference.\n+    super(\n+        \" does not exist in the implementing class\",\n+        implementationClass,\n+        methodSymbol,\n+        interfaceOrAbstractClass);\n+    this.methodSymbol = methodSymbol;\n+  }\n+\n+  @Override\n+  public final String toString() {\n+    ClassFile sourceClass = getSourceClass();", "originalCommit": "1596bf27ce95e1b75c339901f654c75dcddfceef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTU5MzI5Nw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r475593297", "bodyText": "Updated.", "author": "suztomo", "createdAt": "2020-08-24T13:19:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUzMTgwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUzMjE2NQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r475532165", "bodyText": "targetClass --> interfaceOrAbstractClass, or perhaps supertype", "author": "elharo", "createdAt": "2020-08-24T11:26:03Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/AbstractMethodProblem.java", "diffHunk": "@@ -17,12 +17,39 @@\n package com.google.cloud.tools.opensource.classpath;\n \n /**\n- * The referenced {@code methodSymbol} is not implemented in the {@code targetClass} but the class\n- * is declared to implement the method by {@code sourceClass}. Such unimplemented methods manifest\n- * as {@link AbstractMethodError}s at runtime.\n+ * {@code implementationClass} does not implement the abstract method {@code methodSymbol} declared\n+ * by {@code interfaceOrAbstractClass}. Such unimplemented methods manifest as {@link\n+ * AbstractMethodError}s at runtime.\n  */\n final class AbstractMethodProblem extends LinkageProblem {\n-  AbstractMethodProblem(ClassFile sourceClass, ClassFile targetClass, MethodSymbol methodSymbol) {\n-    super(\"is not implemented in the class\", sourceClass, methodSymbol, targetClass);\n+  MethodSymbol methodSymbol;\n+\n+  AbstractMethodProblem(\n+      ClassFile implementationClass,\n+      ClassFile interfaceOrAbstractClass,\n+      MethodSymbol methodSymbol) {\n+\n+    // implementationClass is the source of the invalid symbolic reference, and\n+    // interfaceOrAbstractClass is the target class of the reference.\n+    super(\n+        \" does not exist in the implementing class\",\n+        implementationClass,\n+        methodSymbol,\n+        interfaceOrAbstractClass);\n+    this.methodSymbol = methodSymbol;\n+  }\n+\n+  @Override\n+  public final String toString() {\n+    ClassFile sourceClass = getSourceClass();\n+    ClassPathEntry sourceClassPathEntry = sourceClass.getClassPathEntry();\n+    ClassFile targetClass = getTargetClass();", "originalCommit": "1596bf27ce95e1b75c339901f654c75dcddfceef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTU5MzM2Ng==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r475593366", "bodyText": "Updated this to supertype.", "author": "suztomo", "createdAt": "2020-08-24T13:19:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUzMjE2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUzMjYzOQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r475532639", "bodyText": "interfaceOrAbstractClass could perhaps be named supertype instead since a class can have more than one supertype when interfaces are in play.", "author": "elharo", "createdAt": "2020-08-24T11:27:08Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/AbstractMethodProblem.java", "diffHunk": "@@ -17,12 +17,39 @@\n package com.google.cloud.tools.opensource.classpath;\n \n /**\n- * The referenced {@code methodSymbol} is not implemented in the {@code targetClass} but the class\n- * is declared to implement the method by {@code sourceClass}. Such unimplemented methods manifest\n- * as {@link AbstractMethodError}s at runtime.\n+ * {@code implementationClass} does not implement the abstract method {@code methodSymbol} declared\n+ * by {@code interfaceOrAbstractClass}. Such unimplemented methods manifest as {@link\n+ * AbstractMethodError}s at runtime.\n  */\n final class AbstractMethodProblem extends LinkageProblem {\n-  AbstractMethodProblem(ClassFile sourceClass, ClassFile targetClass, MethodSymbol methodSymbol) {\n-    super(\"is not implemented in the class\", sourceClass, methodSymbol, targetClass);\n+  MethodSymbol methodSymbol;\n+\n+  AbstractMethodProblem(\n+      ClassFile implementationClass,\n+      ClassFile interfaceOrAbstractClass,", "originalCommit": "1596bf27ce95e1b75c339901f654c75dcddfceef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTU5MTQ5Mw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r475591493", "bodyText": "Updated to supertype", "author": "suztomo", "createdAt": "2020-08-24T13:16:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUzMjYzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUzMzYzOA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r475533638", "bodyText": "Anytime I see instanceof I assume it can be replaced with polymorphism. This can be a single method in LinkageProblem.", "author": "elharo", "createdAt": "2020-08-24T11:29:13Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/DependencyConflict.java", "diffHunk": "@@ -62,18 +62,35 @@ public DependencyPath getPathToSelectedArtifact() {\n   @Override\n   public String toString() {\n     Artifact selected = pathToSelectedArtifact.getLeaf();\n+    String selectedCoordinates = Artifacts.toCoordinates(selected);\n     Artifact unselected = pathToArtifactThruSource.getLeaf();\n-    return \"Dependency conflict: \"\n-        + Artifacts.toCoordinates(selected)\n-        + \" does not define \"\n-        + symbol\n-        + \" but \"\n-        + Artifacts.toCoordinates(unselected)\n-        + \" defines it.\\n\"\n-        + \"  selected: \"\n-        + pathToSelectedArtifact\n-        + \"\\n  unselected: \"\n-        + pathToArtifactThruSource;\n+    String unselectedCoordinates = Artifacts.toCoordinates(unselected);\n+\n+    if (linkageProblem instanceof AbstractMethodProblem) {", "originalCommit": "1596bf27ce95e1b75c339901f654c75dcddfceef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTU5NjQ4Ng==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r475596486", "bodyText": "I'm feeling that's unnecessary abstraction to remove just one if-statement. Let me try what it looks like.", "author": "suztomo", "createdAt": "2020-08-24T13:24:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUzMzYzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUzNDI3OA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r475534278", "bodyText": "This is clearer. Thanks.", "author": "elharo", "createdAt": "2020-08-24T11:30:10Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java", "diffHunk": "@@ -310,15 +310,18 @@ private boolean problemFilter(LinkageProblem linkageProblem) {\n    * methods manifest as {@link AbstractMethodError}s at runtime.\n    */\n   private ImmutableList<LinkageProblem> findInterfaceProblems(\n-      ClassFile classFile, InterfaceSymbol interfaceSymbol, ClassFile sourceClassFile) {\n+      ClassFile interfaceClassFile,", "originalCommit": "1596bf27ce95e1b75c339901f654c75dcddfceef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUzNTA4Mw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r475535083", "bodyText": "There's probably a cleaner way to do this without instanceof.", "author": "elharo", "createdAt": "2020-08-24T11:31:07Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java", "diffHunk": "@@ -150,9 +150,21 @@ public String formatSymbolProblem() {\n   public static String formatLinkageProblems(Set<LinkageProblem> linkageProblems) {\n     StringBuilder output = new StringBuilder();\n \n+    // Don't group AbstractMethodProblems by symbols because they do not fit in the\n+    // \"... referenced by ...\" format.\n+    ImmutableSet.Builder<AbstractMethodProblem> abstractMethodProblems = ImmutableSet.builder();\n+    ImmutableSet.Builder<LinkageProblem> problemsToGroupBySymbols = ImmutableSet.builder();\n+    for (LinkageProblem linkageProblem : linkageProblems) {\n+      if (linkageProblem instanceof AbstractMethodProblem) {", "originalCommit": "1596bf27ce95e1b75c339901f654c75dcddfceef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTYyNDc3Mg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r475624772", "bodyText": "I thought about that but couldn't find a good one. My assessment is that we cannot remove this by polymorphism because we need to group multiple instances of LinkageProblems. Changing individual behavior does not help.\nAt best it would be LinkageProblem.isAbstractMethod() or a different name.\nI welcome your suggestion if any.", "author": "suztomo", "createdAt": "2020-08-24T13:53:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUzNTA4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTY1MDM4NA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r475650384", "bodyText": "It might require some reorganizing of how and where we group things. This is OK for now. I'll take a look at this when I get a minute.", "author": "elharo", "createdAt": "2020-08-24T14:24:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUzNTA4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTY1NjU3MA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r475656570", "bodyText": "Thank you. I created #1618 as a followup.", "author": "suztomo", "createdAt": "2020-08-24T14:32:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUzNTA4Mw=="}], "type": "inlineReview"}, {"oid": "769cfc41fb89c5dde64ada3504513dbb9aab09d1", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/769cfc41fb89c5dde64ada3504513dbb9aab09d1", "message": "Merge remote-tracking branch 'origin/master' into interface_reference_backwards", "committedDate": "2020-08-24T13:14:37Z", "type": "commit"}, {"oid": "5e07c61006ce1f76bf60a226b9d94e49adfa128f", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/5e07c61006ce1f76bf60a226b9d94e49adfa128f", "message": "Applied review", "committedDate": "2020-08-24T13:23:23Z", "type": "commit"}, {"oid": "a2abad19662f621149d9d0d82d974c9930c8328c", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/a2abad19662f621149d9d0d82d974c9930c8328c", "message": "polymorphism", "committedDate": "2020-08-24T13:41:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTYyMTgxOQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r475621819", "bodyText": "AbstractMethodProblem overrides describe method.", "author": "suztomo", "createdAt": "2020-08-24T13:50:35Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/DependencyConflict.java", "diffHunk": "@@ -61,19 +61,7 @@ public DependencyPath getPathToSelectedArtifact() {\n \n   @Override\n   public String toString() {\n-    Artifact selected = pathToSelectedArtifact.getLeaf();\n-    Artifact unselected = pathToArtifactThruSource.getLeaf();\n-    return \"Dependency conflict: \"\n-        + Artifacts.toCoordinates(selected)\n-        + \" does not define \"\n-        + symbol\n-        + \" but \"\n-        + Artifacts.toCoordinates(unselected)\n-        + \" defines it.\\n\"\n-        + \"  selected: \"\n-        + pathToSelectedArtifact\n-        + \"\\n  unselected: \"\n-        + pathToArtifactThruSource;\n+    return linkageProblem.describe(this);", "originalCommit": "a2abad19662f621149d9d0d82d974c9930c8328c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTY0Njk4NQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1604#discussion_r475646985", "bodyText": "It's consistent that we have a space at the beginning and not at the end of the first argument. Something to look at later, not in this PR.", "author": "elharo", "createdAt": "2020-08-24T14:19:08Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/AbstractMethodProblem.java", "diffHunk": "@@ -25,16 +29,12 @@\n   MethodSymbol methodSymbol;\n \n   AbstractMethodProblem(\n-      ClassFile implementationClass,\n-      MethodSymbol methodSymbol, ClassFile supertype) {\n+      ClassFile implementationClass, MethodSymbol methodSymbol, ClassFile supertype) {\n \n     // implementationClass is the source of the invalid symbolic reference, and supertype is the\n     // target of the symbolic reference.\n     super(\n-        \" does not exist in the implementing class\",\n-        implementationClass,\n-        methodSymbol,\n-        supertype);\n+        \" does not exist in the implementing class\", implementationClass, methodSymbol, supertype);", "originalCommit": "a2abad19662f621149d9d0d82d974c9930c8328c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}