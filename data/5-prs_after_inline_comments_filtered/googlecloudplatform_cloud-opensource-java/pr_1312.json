{"pr_number": 1312, "pr_title": "Replace List<Path> with List<ClassPathEntry>", "pr_createdAt": "2020-03-25T21:39:55Z", "pr_url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312", "timeline": [{"oid": "0dc84b4422ea5c737f8f698bf2f32c90ee8bb5f0", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/0dc84b4422ea5c737f8f698bf2f32c90ee8bb5f0", "message": "Compiles", "committedDate": "2020-03-25T20:47:32Z", "type": "commit"}, {"oid": "ebff3100c1f203f35a484a5870954fa9e13f1be2", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/ebff3100c1f203f35a484a5870954fa9e13f1be2", "message": "Formatted", "committedDate": "2020-03-25T20:48:49Z", "type": "commit"}, {"oid": "f8ccac8c67b3e1037faefe21e95f51d715fc2344", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/f8ccac8c67b3e1037faefe21e95f51d715fc2344", "message": "Renamed ClassInJarTest to ClassFileTest", "committedDate": "2020-03-25T20:53:12Z", "type": "commit"}, {"oid": "a4413912821fbc11d5bbe0df60f1f6b1948fa4ee", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/a4413912821fbc11d5bbe0df60f1f6b1948fa4ee", "message": "Moved PATH_FILE_NAMES to TestHelper", "committedDate": "2020-03-25T21:08:52Z", "type": "commit"}, {"oid": "d52e3c8c8c0fff13b9d956430eb810622e5af250", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/d52e3c8c8c0fff13b9d956430eb810622e5af250", "message": "LinkageCheckerTest passes", "committedDate": "2020-03-25T21:24:41Z", "type": "commit"}, {"oid": "273e67978389d314e50b8ad807a3c8f747245b28", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/273e67978389d314e50b8ad807a3c8f747245b28", "message": "LinkageCheckerArgumentsTest passes", "committedDate": "2020-03-25T21:32:22Z", "type": "commit"}, {"oid": "4d17cd204ebe37e4d3d20cce2bc02715108071ba", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/4d17cd204ebe37e4d3d20cce2bc02715108071ba", "message": "ClassPathBuilderTest passes", "committedDate": "2020-03-25T21:37:35Z", "type": "commit"}, {"oid": "58a02b0f4ee770fa92849fe7221c3b26e92b9272", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/58a02b0f4ee770fa92849fe7221c3b26e92b9272", "message": "Project compiles", "committedDate": "2020-03-25T21:49:14Z", "type": "commit"}, {"oid": "7d10139e27529195380431df0350c8eb046fbb09", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/7d10139e27529195380431df0350c8eb046fbb09", "message": "Merge remote-tracking branch 'origin/master' into i1179", "committedDate": "2020-03-25T22:13:05Z", "type": "commit"}, {"oid": "dd84b25278c5e97c06f7274a58b79d72bf0929ca", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/dd84b25278c5e97c06f7274a58b79d72bf0929ca", "message": "Dashboard tests pass", "committedDate": "2020-03-25T22:13:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODE5OTcwNA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r398199704", "bodyText": "I wasn't thinking of BOMs as classpath entries. They're not, are they?", "author": "elharo", "createdAt": "2020-03-25T22:07:01Z", "path": "boms/integration-tests/src/test/java/com/google/cloud/MaximumLinkageErrorsTest.java", "diffHunk": "@@ -46,7 +46,7 @@ public void testForNewLinkageErrors()\n     String baselineCoordinates = \"com.google.cloud:libraries-bom:\" + version;\n     Bom baseline = RepositoryUtility.readBom(baselineCoordinates);\n \n-    Path bomFile = Paths.get(\"../cloud-oss-bom/pom.xml\");\n+    ClassPathEntry bomFile = Paths.get(\"../cloud-oss-bom/pom.xml\");", "originalCommit": "58a02b0f4ee770fa92849fe7221c3b26e92b9272", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODY5MzI1NA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r398693254", "bodyText": "They are not. Fixed.", "author": "suztomo", "createdAt": "2020-03-26T16:04:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODE5OTcwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIwMDIzNQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r398200235", "bodyText": "Not for this PR, but this is another place where  custom type makes sense.", "author": "elharo", "createdAt": "2020-03-25T22:08:16Z", "path": "dashboard/src/main/java/com/google/cloud/tools/opensource/dashboard/DashboardMain.java", "diffHunk": "@@ -222,7 +224,7 @@ private static Path generateHtml(\n     copyResource(output, \"css/dashboard.css\");\n     copyResource(output, \"js/dashboard.js\");\n \n-    ImmutableMap<Path, ImmutableSetMultimap<SymbolProblem, String>> symbolProblemTable =\n+    ImmutableMap<ClassPathEntry, ImmutableSetMultimap<SymbolProblem, String>> symbolProblemTable =", "originalCommit": "58a02b0f4ee770fa92849fe7221c3b26e92b9272", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIwMTAwNg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r398201006", "bodyText": "another opportunity for a more specific class type", "author": "elharo", "createdAt": "2020-03-25T22:09:56Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassDumper.java", "diffHunk": "@@ -72,40 +74,42 @@\n class ClassDumper {\n   private static final Logger logger = Logger.getLogger(ClassDumper.class.getName());\n \n-  private final ImmutableList<Path> inputClassPath;\n+  private final ImmutableList<ClassPathEntry> inputClassPath;\n   private final FixedSizeClassPathRepository classRepository;\n   private final ClassLoader extensionClassLoader;\n-  private final ImmutableSetMultimap<Path, String> jarFileToClassFileNames;\n-  private final ImmutableListMultimap<String, Path> classFileNameToJarFiles;\n+  private final ImmutableSetMultimap<ClassPathEntry, String> classPathEntryToClassFileNames;", "originalCommit": "58a02b0f4ee770fa92849fe7221c3b26e92b9272", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIwMTIxOQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r398201219", "bodyText": "Indeed one type could replace both of these fields", "author": "elharo", "createdAt": "2020-03-25T22:10:26Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassDumper.java", "diffHunk": "@@ -72,40 +74,42 @@\n class ClassDumper {\n   private static final Logger logger = Logger.getLogger(ClassDumper.class.getName());\n \n-  private final ImmutableList<Path> inputClassPath;\n+  private final ImmutableList<ClassPathEntry> inputClassPath;\n   private final FixedSizeClassPathRepository classRepository;\n   private final ClassLoader extensionClassLoader;\n-  private final ImmutableSetMultimap<Path, String> jarFileToClassFileNames;\n-  private final ImmutableListMultimap<String, Path> classFileNameToJarFiles;\n+  private final ImmutableSetMultimap<ClassPathEntry, String> classPathEntryToClassFileNames;\n+  private final ImmutableListMultimap<String, ClassPathEntry> classFileNameToClassPathEntry;", "originalCommit": "58a02b0f4ee770fa92849fe7221c3b26e92b9272", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIwMTQ5Nw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r398201497", "bodyText": "why doesn't getPath return a Path? Should it?", "author": "elharo", "createdAt": "2020-03-25T22:11:10Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassDumper.java", "diffHunk": "@@ -72,40 +74,42 @@\n class ClassDumper {\n   private static final Logger logger = Logger.getLogger(ClassDumper.class.getName());\n \n-  private final ImmutableList<Path> inputClassPath;\n+  private final ImmutableList<ClassPathEntry> inputClassPath;\n   private final FixedSizeClassPathRepository classRepository;\n   private final ClassLoader extensionClassLoader;\n-  private final ImmutableSetMultimap<Path, String> jarFileToClassFileNames;\n-  private final ImmutableListMultimap<String, Path> classFileNameToJarFiles;\n+  private final ImmutableSetMultimap<ClassPathEntry, String> classPathEntryToClassFileNames;\n+  private final ImmutableListMultimap<String, ClassPathEntry> classFileNameToClassPathEntry;\n \n-  private static FixedSizeClassPathRepository createClassRepository(List<Path> paths) {\n-    ClassPath classPath = new LinkageCheckClassPath(paths);\n+  private static FixedSizeClassPathRepository createClassRepository(List<ClassPathEntry> entries) {\n+    ClassPath classPath = new LinkageCheckClassPath(entries);\n     return new FixedSizeClassPathRepository(classPath);\n   }\n \n-  static ClassDumper create(List<Path> jarPaths) throws IOException {\n+  static ClassDumper create(List<ClassPathEntry> entries) throws IOException {\n     ClassLoader systemClassLoader = ClassLoader.getSystemClassLoader();\n     ClassLoader extensionClassLoader = systemClassLoader.getParent();\n \n     ImmutableList<Path> unreadableFiles =\n-        jarPaths.stream()\n+        entries.stream()\n+            .map(ClassPathEntry::getPath)", "originalCommit": "58a02b0f4ee770fa92849fe7221c3b26e92b9272", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIxMDk3MA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r398210970", "bodyText": "It's because the user of getPath() (LinkageCheckClassPath and its superclass org.apache.bcel.util.ClassPath) expects String.\nhttps://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312/files#r398210643", "author": "suztomo", "createdAt": "2020-03-25T22:32:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIwMTQ5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwMTY5Ng==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r399201696", "bodyText": "They could convert to a string if that's what they want. It's surprising to have the method name inconsistent with the return type.", "author": "elharo", "createdAt": "2020-03-27T11:33:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIwMTQ5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI4ODQ4OQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r399288489", "bodyText": "Right. The name was not good. I also found other places in our code that benefits from returning java.nio.file.Path. Renamed this to Path getJar().", "author": "suztomo", "createdAt": "2020-03-27T14:05:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIwMTQ5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIwMTY2Nw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r398201667", "bodyText": "need to update javadoc too", "author": "elharo", "createdAt": "2020-03-25T22:11:34Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassDumper.java", "diffHunk": "@@ -323,14 +327,14 @@ private static FieldSymbol makeSymbol(\n    * Returns the first jar file {@link Path} defining the class. Null if the location is unknown.", "originalCommit": "58a02b0f4ee770fa92849fe7221c3b26e92b9272", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYzMDgyOQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r398630829", "bodyText": "Updated.", "author": "suztomo", "createdAt": "2020-03-26T14:47:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIwMTY2Nw=="}], "type": "inlineReview"}, {"oid": "7062753ed11a7421aaa23c10c9386bb6b354eee3", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/7062753ed11a7421aaa23c10c9386bb6b354eee3", "message": "LinkageMonitorTest passes", "committedDate": "2020-03-25T22:17:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIxMDY0Mw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r398210643", "bodyText": "No toString conversion from java.nio.file.Path any more.", "author": "suztomo", "createdAt": "2020-03-25T22:31:21Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageCheckClassPath.java", "diffHunk": "@@ -51,10 +50,13 @@\n   /**\n    * Constructs a classpath for check.\n    *\n-   * @param paths list of absolute paths for the elements in the class path\n+   * @param entries the elements in the class path\n    */\n-  LinkageCheckClassPath(List<Path> paths) {\n-    super(paths.stream().map(Path::toString).collect(Collectors.joining(File.pathSeparator)));", "originalCommit": "7062753ed11a7421aaa23c10c9386bb6b354eee3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "879dc02c5b8bb5dafd0c41f75ee1df84bbb1762e", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/879dc02c5b8bb5dafd0c41f75ee1df84bbb1762e", "message": "Updating Javadoc", "committedDate": "2020-03-26T15:44:32Z", "type": "commit"}, {"oid": "d421d836ca1ae2886027d565c3b8006d48ae6bda", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/d421d836ca1ae2886027d565c3b8006d48ae6bda", "message": "Done javadoc", "committedDate": "2020-03-26T16:02:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYzMDAzMw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r398630033", "bodyText": "Fixed.", "author": "suztomo", "createdAt": "2020-03-26T14:46:21Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassDumper.java", "diffHunk": "@@ -142,8 +146,8 @@ boolean isSystemClass(String className) {\n    *\n    * @param jarPath absolute path to the jar file", "originalCommit": "7062753ed11a7421aaa23c10c9386bb6b354eee3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYzMjMxOQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r398632319", "bodyText": "Fixed.", "author": "suztomo", "createdAt": "2020-03-26T14:49:09Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassDumper.java", "diffHunk": "@@ -339,19 +343,19 @@ Path findClassLocation(String className) {\n     if (specialLocation == null) {\n       return null;\n     }\n-    return Iterables.getFirst(classFileNameToJarFiles.get(specialLocation), null);\n+    return Iterables.getFirst(classFileNameToClassPathEntry.get(specialLocation), null);\n   }\n \n   /**\n-   * Returns mapping from jar files to class file names they contain.\n+   * Returns mapping from class path entries to class file names they contain.\n    *\n    * @param jars absolute paths to jar files", "originalCommit": "7062753ed11a7421aaa23c10c9386bb6b354eee3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYzNjIwMw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r398636203", "bodyText": "Fixed", "author": "suztomo", "createdAt": "2020-03-26T14:54:02Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassDumper.java", "diffHunk": "@@ -383,7 +387,7 @@ Path findClassLocation(String className) {\n    * Returns a set of {@link JavaClass}es which have entries in the {@code jar} through {@link", "originalCommit": "7062753ed11a7421aaa23c10c9386bb6b354eee3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODY4NzUzNg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r398687536", "bodyText": "This has been moved to TestHelper.", "author": "suztomo", "createdAt": "2020-03-26T15:57:40Z", "path": "dependencies/src/test/java/com/google/cloud/tools/opensource/classpath/ClassPathBuilderTest.java", "diffHunk": "@@ -37,14 +37,9 @@\n import org.junit.Test;\n \n public class ClassPathBuilderTest {\n-\n-  static final Correspondence<Path, String> PATH_FILE_NAMES =", "originalCommit": "879dc02c5b8bb5dafd0c41f75ee1df84bbb1762e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODY5MDc4Mg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r398690782", "bodyText": "Because it's clear that b-1.0.0.jar is a JAR file and foo:b:1.0.0 is a Maven artifact, I removed \"Artifact\" and \"JAR\" from toString output.\nBackground: 7062753#r398695154", "author": "suztomo", "createdAt": "2020-03-26T16:01:40Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassPathEntry.java", "diffHunk": "@@ -76,9 +80,17 @@ public int hashCode() {\n   @Override\n   public String toString() {\n     if (artifact != null) {\n-      return \"Artifact(\" + artifact + \")\";\n+      // Group ID, artifact ID and version. No extension such as \"jar\" or \"tar.gz\", because Linkage\n+      // Checker uses only JAR artifacts.\n+      return Artifacts.toCoordinates(artifact);\n     } else {\n-      return \"JAR(\" + jar + \")\";\n+      return jar.toString();", "originalCommit": "879dc02c5b8bb5dafd0c41f75ee1df84bbb1762e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODY5NTE1NA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r398695154", "bodyText": "These \"JAR\" was not giving any information to readers.", "author": "suztomo", "createdAt": "2020-03-26T16:07:26Z", "path": "linkage-monitor/src/test/java/com/google/cloud/tools/dependencies/linkagemonitor/LinkageMonitorTest.java", "diffHunk": "@@ -143,14 +143,14 @@ public void generateMessageForNewError() {\n                 ImmutableList.of()));\n     assertEquals(\n         \"Newly introduced problem:\\n\"\n-            + \"(b-1.0.0.jar) io.grpc.protobuf.ProtoUtils's method\"\n+            + \"(JAR(foo/b-1.0.0.jar)) io.grpc.protobuf.ProtoUtils's method\"\n             + \" marshaller(com.google.protobuf.Message arg1) is not found\\n\"\n-            + \"  referenced from com.abc.AAA (a-1.2.3.jar)\\n\"\n-            + \"  referenced from com.abc.BBB (a-1.2.3.jar)\\n\"\n+            + \"  referenced from com.abc.AAA (JAR(foo/a-1.2.3.jar))\\n\"\n+            + \"  referenced from com.abc.BBB (JAR(foo/a-1.2.3.jar))\\n\"\n             + \"\\n\"\n-            + \"b-1.0.0.jar is at:\\n\"\n+            + \"JAR(foo/b-1.0.0.jar) is at:\\n\"\n             + \"  foo:b:1.2.3 (compile, optional)\\n\"\n-            + \"a-1.2.3.jar is at:\\n\"\n+            + \"JAR(foo/a-1.2.3.jar) is at:\\n\"\n             + \"  foo:bar:1.0.0 (provided) / foo:a:1.2.3 (compile, optional)\\n\",", "originalCommit": "7062753ed11a7421aaa23c10c9386bb6b354eee3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "18fca4248177d257a26760836c97525981ed3028", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/18fca4248177d257a26760836c97525981ed3028", "message": "Path to pass Windows", "committedDate": "2020-03-26T17:10:11Z", "type": "commit"}, {"oid": "caaeafa6b719179199ebb02b153a3f7464806500", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/caaeafa6b719179199ebb02b153a3f7464806500", "message": "toAbsolutePath", "committedDate": "2020-03-26T17:18:26Z", "type": "commit"}, {"oid": "c0eba4d0b50d44c4a2a935c8afe9571e62d1729b", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/c0eba4d0b50d44c4a2a935c8afe9571e62d1729b", "message": "javadoc", "committedDate": "2020-03-26T17:49:30Z", "type": "commit"}, {"oid": "7f50f1b2f54307424da0b51ae3b1a1ba6296468e", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/7f50f1b2f54307424da0b51ae3b1a1ba6296468e", "message": "Merge remote-tracking branch 'origin/master' into i1179", "committedDate": "2020-03-27T03:21:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwMDQ4NQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r399200485", "bodyText": "For later: we could perhaps push a lot of this into ClassPathResult whihc could become simply Classpath. Hide a lot of the implementation details.", "author": "elharo", "createdAt": "2020-03-27T11:30:42Z", "path": "dashboard/src/main/java/com/google/cloud/tools/opensource/dashboard/DashboardMain.java", "diffHunk": "@@ -263,10 +265,10 @@ static Configuration configureFreemarker() {\n    * Returns mapping from the Maven coordinates of BOM members to jar files that are in the\n    * dependency tree of the BOM members.\n    */\n-  private static ImmutableSetMultimap<String, Path> bomMemberToJars(\n+  private static ImmutableSetMultimap<String, ClassPathEntry> bomMemberToJars(\n       ClassPathResult classPathResult) {", "originalCommit": "7f50f1b2f54307424da0b51ae3b1a1ba6296468e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI4NzIzOA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r399287238", "bodyText": "Updated.", "author": "suztomo", "createdAt": "2020-03-27T14:03:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwMDQ4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwMjQyNQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r399202425", "bodyText": "\"defined\" is perhaps not the right word here. Perhaps \"Found\"? Or maybe just classNamesInJar", "author": "elharo", "createdAt": "2020-03-27T11:34:40Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassDumper.java", "diffHunk": "@@ -137,13 +141,9 @@ boolean isSystemClass(String className) {\n     }\n   }\n \n-  /**\n-   * Returns class file names defined in the jar file.\n-   *\n-   * @param jarPath absolute path to the jar file\n-   */\n-  ImmutableSet<String> classesDefinedInJar(Path jarPath) {\n-    return jarFileToClassFileNames.get(jarPath);\n+  /** Returns class file names defined in the class path entry. */", "originalCommit": "7f50f1b2f54307424da0b51ae3b1a1ba6296468e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI5MTUwNQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r399291505", "bodyText": "Renamed to classNamesInJar.", "author": "suztomo", "createdAt": "2020-03-27T14:10:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwMjQyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwMjU3Nw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r399202577", "bodyText": "defining --> containing", "author": "elharo", "createdAt": "2020-03-27T11:34:57Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassDumper.java", "diffHunk": "@@ -319,18 +319,16 @@ private static FieldSymbol makeSymbol(\n     return innerClassNames.build();\n   }\n \n-  /**\n-   * Returns the first jar file {@link Path} defining the class. Null if the location is unknown.\n-   */\n+  /** Returns the first class path entry defining the class. Null if the location is unknown. */", "originalCommit": "7f50f1b2f54307424da0b51ae3b1a1ba6296468e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI5MTgzOA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r399291838", "bodyText": "Updated.", "author": "suztomo", "createdAt": "2020-03-27T14:10:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwMjU3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwMjgwNQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r399202805", "bodyText": "no period", "author": "elharo", "createdAt": "2020-03-27T11:35:27Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassDumper.java", "diffHunk": "@@ -339,19 +337,19 @@ Path findClassLocation(String className) {\n     if (specialLocation == null) {\n       return null;\n     }\n-    return Iterables.getFirst(classFileNameToJarFiles.get(specialLocation), null);\n+    return Iterables.getFirst(classFileNameToClassPathEntry.get(specialLocation), null);\n   }\n \n   /**\n-   * Returns mapping from jar files to class file names they contain.\n+   * Returns mapping from class path entries to class file names they contain.\n    *\n-   * @param jars absolute paths to jar files\n+   * @param classPath class path entries in which it finds the class names.", "originalCommit": "7f50f1b2f54307424da0b51ae3b1a1ba6296468e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI5MjE4OA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r399292188", "bodyText": "removed.", "author": "suztomo", "createdAt": "2020-03-27T14:11:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwMjgwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwMzI1Mg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r399203252", "bodyText": "How does the repository work here? What if there are multiple repositories?", "author": "elharo", "createdAt": "2020-03-27T11:36:25Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassDumper.java", "diffHunk": "@@ -380,15 +378,15 @@ Path findClassLocation(String className) {\n   }\n \n   /**\n-   * Returns a set of {@link JavaClass}es which have entries in the {@code jar} through {@link\n+   * Returns a set of {@link JavaClass}es which have entries in the {@code entry} through {@link\n    * #classRepository}.", "originalCommit": "7f50f1b2f54307424da0b51ae3b1a1ba6296468e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI5NDU3MQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r399294571", "bodyText": "One class repository for one class path. ClassDumper takes one class path. Therefore there's no multiple class repositories for one ClassDumper.", "author": "suztomo", "createdAt": "2020-03-27T14:14:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwMzI1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwMzY3Mg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r399203672", "bodyText": "entry.getClassFileNames()? That is, should we move the listing into the ClassPathEntry class?", "author": "elharo", "createdAt": "2020-03-27T11:37:18Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassDumper.java", "diffHunk": "@@ -380,15 +378,15 @@ Path findClassLocation(String className) {\n   }\n \n   /**\n-   * Returns a set of {@link JavaClass}es which have entries in the {@code jar} through {@link\n+   * Returns a set of {@link JavaClass}es which have entries in the {@code entry} through {@link\n    * #classRepository}.\n    */\n-  private ImmutableSet<JavaClass> listClasses(Path jar) throws IOException {\n+  private ImmutableSet<JavaClass> listClasses(ClassPathEntry entry) throws IOException {\n     ImmutableSet.Builder<JavaClass> javaClasses = ImmutableSet.builder();\n \n     ImmutableList.Builder<String> corruptedClassFileNames = ImmutableList.builder();\n \n-    for (String classFileName : listClassFileNames(jar)) {\n+    for (String classFileName : listClassFileNames(entry)) {", "originalCommit": "7f50f1b2f54307424da0b51ae3b1a1ba6296468e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI5NzI0Mg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r399297242", "bodyText": "Moved.", "author": "suztomo", "createdAt": "2020-03-27T14:18:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwMzY3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwNDExNg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r399204116", "bodyText": "What's a \"locator\"? This is redundant with locate below. And perhaps this class is incorrectly named. I.e. why is it not ClassFileLocator if it represents a locator and not a class file.", "author": "elharo", "createdAt": "2020-03-27T11:38:16Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassFile.java", "diffHunk": "@@ -20,26 +20,25 @@\n \n import com.google.common.annotations.VisibleForTesting;\n import com.google.common.base.MoreObjects;\n-import java.nio.file.Path;\n import java.util.Objects;\n \n /**\n- * A locator for a compiled class file of {@code className} in {@code jar} to uniquely locate the\n- * class implementation in a class path.\n+ * A locator for a compiled class file of {@code className} in {@code classPathEntry} to uniquely", "originalCommit": "7f50f1b2f54307424da0b51ae3b1a1ba6296468e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI5OTgxMg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r399299812", "bodyText": "ClassFileLocator sounds nice. Not updating in this PR.", "author": "suztomo", "createdAt": "2020-03-27T14:22:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwNDExNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwNTQ3OQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r399205479", "bodyText": "so why do we get a ClasspathResult out of this and not a ClassPath?", "author": "elharo", "createdAt": "2020-03-27T11:40:52Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassPathBuilder.java", "diffHunk": "@@ -30,7 +30,8 @@\n import org.eclipse.aether.artifact.Artifact;\n \n /**\n- * Utility to build a class path (a list of jar files) through a dependency tree of Maven artifacts.\n+ * Utility to build a class path (a list of class path entries) through a dependency tree of Maven", "originalCommit": "7f50f1b2f54307424da0b51ae3b1a1ba6296468e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMwMDU1MA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r399300550", "bodyText": "Updated to Utility to build ClasspathResult that holds class path.", "author": "suztomo", "createdAt": "2020-03-27T14:23:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwNTQ3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwNjk4NQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r399206985", "bodyText": "Perhaps this should be an empty list instead?", "author": "elharo", "createdAt": "2020-03-27T11:43:56Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerArguments.java", "diffHunk": "@@ -191,12 +190,16 @@ private static Options configureOptions() {\n     }\n   }\n \n-  /** Returns a list of absolute paths to files specified in the JAR file option. */\n-  ImmutableList<Path> getJarFiles() {\n+  /**\n+   * Returns class path entries for the absolute paths of the files specified in the JAR file\n+   * option.\n+   */\n+  ImmutableList<ClassPathEntry> getJarFiles() {\n     if (commandLine.hasOption(\"j\")) {\n       String[] jarFiles = commandLine.getOptionValues(\"j\");\n       return Arrays.stream(jarFiles)\n           .map(name -> Paths.get(name).toAbsolutePath())\n+          .map(ClassPathEntry::new)\n           .collect(toImmutableList());\n     } else {\n       throw new IllegalArgumentException(\"The arguments must have option 'j' to list JAR files\");", "originalCommit": "7f50f1b2f54307424da0b51ae3b1a1ba6296468e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMwMzcyOQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r399303729", "bodyText": "Explicitly failing with IllegalArgumentException gives more clear message why the tool does not work as expected.", "author": "suztomo", "createdAt": "2020-03-27T14:27:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwNjk4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwNzUxMw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r399207513", "bodyText": "for --> of", "author": "elharo", "createdAt": "2020-03-27T11:45:03Z", "path": "dependencies/src/test/java/com/google/cloud/tools/opensource/classpath/ClassPathBuilderTest.java", "diffHunk": "@@ -55,16 +50,16 @@ public void testResolve_removingDuplicates() {\n     Artifact grpcArtifact = new DefaultArtifact(\"io.grpc:grpc-auth:1.15.1\");\n     ClassPathResult result = classPathBuilder.resolve(ImmutableList.of(grpcArtifact));\n \n-    ImmutableList<Path> paths = result.getClassPath();\n-    long jsr305Count = paths.stream().filter(path -> path.toString().contains(\"jsr305-\")).count();\n+    ImmutableList<ClassPathEntry> classPath = result.getClassPath();\n+    long jsr305Count = classPath.stream().filter(path -> path.toString().contains(\"jsr305\")).count();\n     Truth.assertWithMessage(\"There should not be duplicated versions for jsr305\")", "originalCommit": "7f50f1b2f54307424da0b51ae3b1a1ba6296468e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMwNDI2OQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1312#discussion_r399304269", "bodyText": "Updated.", "author": "suztomo", "createdAt": "2020-03-27T14:28:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwNzUxMw=="}], "type": "inlineReview"}, {"oid": "2c29bace0a0216334e84890b476bf50b047efcb6", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/2c29bace0a0216334e84890b476bf50b047efcb6", "message": "Applied review.", "committedDate": "2020-03-27T14:28:51Z", "type": "commit"}, {"oid": "2473f88fd417e5f48636b92659c631c08fcdbd51", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/2473f88fd417e5f48636b92659c631c08fcdbd51", "message": "ClassPathEntry.getJar()", "committedDate": "2020-03-27T14:42:38Z", "type": "commit"}]}