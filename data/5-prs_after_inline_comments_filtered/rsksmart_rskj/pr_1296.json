{"pr_number": 1296, "pr_title": "Clean returnDataBuffer for call-like opcodes", "pr_createdAt": "2020-08-24T17:35:36Z", "pr_url": "https://github.com/rsksmart/rskj/pull/1296", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTc5MzEzNg==", "url": "https://github.com/rsksmart/rskj/pull/1296#discussion_r475793136", "bodyText": "Any test to exercise the behavior BEFORE this activation?", "author": "ajlopezrsk", "createdAt": "2020-08-24T17:54:09Z", "path": "rskj-core/src/test/java/org/ethereum/vm/VMTest.java", "diffHunk": "@@ -222,6 +223,119 @@ public void testSTATICCALLWithStatusOne() {\n         assertTrue(program.getStack().isEmpty());\n     }\n \n+    // This test should throw an exception because we are reading from the RETURNDATABUFFER\n+    // in a non-existent position. This results in an error according to EIP 211\n+    @Test(expected = RuntimeException.class)\n+    public void doCall_returnDataBuffer_DataIsZeroAfterCallToNonExistentContract() {", "originalCommit": "b6de7ac557863e33b481d930244ba7e33d27cccc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ3NjAzOA==", "url": "https://github.com/rsksmart/rskj/pull/1296#discussion_r479476038", "bodyText": "added test cases! db6495b", "author": "fedejinich", "createdAt": "2020-08-28T18:43:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTc5MzEzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjcxODM0NA==", "url": "https://github.com/rsksmart/rskj/pull/1296#discussion_r476718344", "bodyText": "shouldnt exist en rskip from our side anyway?", "author": "patogallaiovlabs", "createdAt": "2020-08-25T20:29:52Z", "path": "rskj-core/src/main/java/org/ethereum/config/blockchain/upgrades/ConsensusRule.java", "diffHunk": "@@ -50,7 +50,8 @@\n     RSKIP151(\"rskip151\"),\n     RSKIP152(\"rskip152\"),\n     RSKIP156(\"rskip156\"),\n-    RSKIPUMM(\"rskipUMM\");\n+    RSKIPUMM(\"rskipUMM\"),\n+    EIP_211_COMPATIBILITY(\"eip211Compatibility\");", "originalCommit": "b6de7ac557863e33b481d930244ba7e33d27cccc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQ5ODc4OQ==", "url": "https://github.com/rsksmart/rskj/pull/1296#discussion_r477498789", "bodyText": "yes it should and that name is \"draft\" as I mentioned in the comments, will change it at the end of the PR", "author": "fedejinich", "createdAt": "2020-08-26T18:21:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjcxODM0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUwMDE0MQ==", "url": "https://github.com/rsksmart/rskj/pull/1296#discussion_r484500141", "bodyText": "renamed", "author": "fedejinich", "createdAt": "2020-09-07T15:45:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjcxODM0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjcyMTQ0Ng==", "url": "https://github.com/rsksmart/rskj/pull/1296#discussion_r476721446", "bodyText": "this never worked? \ud83e\udd14", "author": "patogallaiovlabs", "createdAt": "2020-08-25T20:35:46Z", "path": "rskj-core/src/test/java/org/ethereum/config/blockchain/upgrades/ActivationConfigTest.java", "diffHunk": "@@ -29,14 +29,15 @@\n public class ActivationConfigTest {\n     private static final Config BASE_CONFIG = ConfigFactory.parseString(String.join(\"\\n\",\n             \"hardforkActivationHeights: {\",\n-            \"    genesis: 0\",\n-            \"    bahamas: 0\",\n+            \"    genesis: 0,\",", "originalCommit": "b6de7ac557863e33b481d930244ba7e33d27cccc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQ5NjAwMw==", "url": "https://github.com/rsksmart/rskj/pull/1296#discussion_r477496003", "bodyText": "it's anecdotic, you can check that on master", "author": "fedejinich", "createdAt": "2020-08-26T18:16:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjcyMTQ0Ng=="}], "type": "inlineReview"}, {"oid": "f8d47b1f22c78ec8ecb298fbe8b4cc8ad77f35ff", "url": "https://github.com/rsksmart/rskj/commit/f8d47b1f22c78ec8ecb298fbe8b4cc8ad77f35ff", "message": "renamed new consensus rule to match rskip171", "committedDate": "2020-09-09T19:37:59Z", "type": "forcePushed"}, {"oid": "b5e0c26bd3257b301df12bd236259b73a172b341", "url": "https://github.com/rsksmart/rskj/commit/b5e0c26bd3257b301df12bd236259b73a172b341", "message": "add tests for eip 211", "committedDate": "2020-09-16T15:21:43Z", "type": "commit"}, {"oid": "b8e3d9b70b3b288a41f6f972e578641fe07be6fb", "url": "https://github.com/rsksmart/rskj/commit/b8e3d9b70b3b288a41f6f972e578641fe07be6fb", "message": "fixed comments", "committedDate": "2020-09-16T15:21:44Z", "type": "commit"}, {"oid": "26f7640bfc7f52511d181fc601ba3e5d8f4e191e", "url": "https://github.com/rsksmart/rskj/commit/26f7640bfc7f52511d181fc601ba3e5d8f4e191e", "message": "fix array size", "committedDate": "2020-09-16T15:21:45Z", "type": "commit"}, {"oid": "459849249bb0101d7d9cfd1396605cb4365d34f2", "url": "https://github.com/rsksmart/rskj/commit/459849249bb0101d7d9cfd1396605cb4365d34f2", "message": "simplify and document tests", "committedDate": "2020-09-16T15:21:46Z", "type": "commit"}, {"oid": "72eeda39c27790c86d23246370920bf19db56925", "url": "https://github.com/rsksmart/rskj/commit/72eeda39c27790c86d23246370920bf19db56925", "message": "reset return data buffer if call frame not created\n\nThis is to make us EIP-211 compatible.\nIssue is #921 on Github has a bit of discussion.", "committedDate": "2020-09-16T15:21:47Z", "type": "commit"}, {"oid": "07564acd514af02a04499562327035507286fc36", "url": "https://github.com/rsksmart/rskj/commit/07564acd514af02a04499562327035507286fc36", "message": "Program.callToAddress clean returnDataBuffer by consensus rule", "committedDate": "2020-09-16T15:21:48Z", "type": "commit"}, {"oid": "36d1d8b0bdd6718c54275bffe7e9f10669841163", "url": "https://github.com/rsksmart/rskj/commit/36d1d8b0bdd6718c54275bffe7e9f10669841163", "message": "more test cases for returnDataBuffer state on callToAddres (and renamed previous tests)", "committedDate": "2020-09-16T15:21:49Z", "type": "commit"}, {"oid": "b03ac47e5fc7fe86c003790c22e379bc44c99343", "url": "https://github.com/rsksmart/rskj/commit/b03ac47e5fc7fe86c003790c22e379bc44c99343", "message": "clean returnDataBuffer for precompiled call-like opcodes", "committedDate": "2020-09-16T15:21:50Z", "type": "commit"}, {"oid": "032581fa79bb8b8b8242bc2cde29c1821ea2bd59", "url": "https://github.com/rsksmart/rskj/commit/032581fa79bb8b8b8242bc2cde29c1821ea2bd59", "message": "renamed new consensus rule to match rskip171", "committedDate": "2020-09-16T15:21:51Z", "type": "commit"}, {"oid": "032581fa79bb8b8b8242bc2cde29c1821ea2bd59", "url": "https://github.com/rsksmart/rskj/commit/032581fa79bb8b8b8242bc2cde29c1821ea2bd59", "message": "renamed new consensus rule to match rskip171", "committedDate": "2020-09-16T15:21:51Z", "type": "forcePushed"}]}