{"pr_number": 898, "pr_title": "Add REST and JAVA API to modify existing cloudconfig", "pr_createdAt": "2020-03-13T23:23:26Z", "pr_url": "https://github.com/apache/helix/pull/898", "timeline": [{"oid": "666268710e4e15ee10000ebce94c287df0986d8f", "url": "https://github.com/apache/helix/commit/666268710e4e15ee10000ebce94c287df0986d8f", "message": "Add REST and JAVA API to modify existing cloudconfig\n\nThe new APIs are added to update/delete cloudconfig entries.\nTests have been modified accordingly.", "committedDate": "2020-03-13T23:13:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjYzOTkwOQ==", "url": "https://github.com/apache/helix/pull/898#discussion_r392639909", "bodyText": "Shall we just call it deleteCloudConfigFields?", "author": "zhangmeng916", "createdAt": "2020-03-15T04:16:40Z", "path": "helix-core/src/main/java/org/apache/helix/ConfigAccessor.java", "diffHunk": "@@ -604,7 +604,47 @@ public CloudConfig getCloudConfig(String clusterName) {\n       return null;\n     }\n \n-    return new CloudConfig.Builder(record).build();\n+    return new CloudConfig(record);\n+  }\n+\n+  /**\n+   * Delete cloud config fields (not the whole config)\n+   * @param clusterName\n+   * @param cloudConfig\n+   */\n+  public void deleteCloudConfigPatrial(String clusterName, CloudConfig cloudConfig) {", "originalCommit": "666268710e4e15ee10000ebce94c287df0986d8f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjc3OTAzNA==", "url": "https://github.com/apache/helix/pull/898#discussion_r392779034", "bodyText": "Changed to deleteCloudConfigFields.", "author": "alirezazamani", "createdAt": "2020-03-16T04:37:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjYzOTkwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjYzOTkzMg==", "url": "https://github.com/apache/helix/pull/898#discussion_r392639932", "bodyText": "Thanks for help modify this part.", "author": "zhangmeng916", "createdAt": "2020-03-15T04:17:17Z", "path": "helix-core/src/main/java/org/apache/helix/cloud/azure/AzureCloudInstanceInformationProcessor.java", "diffHunk": "@@ -145,15 +145,15 @@ public AzureCloudInstanceInformation parseCloudInstanceInformation(List<String>\n         String azureTopology = AzureConstants.AZURE_TOPOLOGY;\n         String[] parts = azureTopology.trim().split(\"/\");\n         //The hostname will be filled in by each participant\n-        String domain = parts[0] + \"=\" + platformFaultDomain + \",\" + parts[1] + \"=\";\n+        String domain = parts[1] + \"=\" + platformFaultDomain + \",\" + parts[2] + \"=\";", "originalCommit": "666268710e4e15ee10000ebce94c287df0986d8f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjc3OTA3Ng==", "url": "https://github.com/apache/helix/pull/898#discussion_r392779076", "bodyText": "No problem :)", "author": "alirezazamani", "createdAt": "2020-03-16T04:37:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjYzOTkzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY0MDgzNw==", "url": "https://github.com/apache/helix/pull/898#discussion_r392640837", "bodyText": "Based on the current design, if user needs to use Java API instead of REST, they need to call HelixAdmin for add and remove, call ConfigAccessor for get, update and delete fields. Is this separation intended? Seems not intuitive.", "author": "zhangmeng916", "createdAt": "2020-03-15T04:39:14Z", "path": "helix-core/src/main/java/org/apache/helix/ConfigAccessor.java", "diffHunk": "@@ -604,7 +604,47 @@ public CloudConfig getCloudConfig(String clusterName) {\n       return null;\n     }\n \n-    return new CloudConfig.Builder(record).build();\n+    return new CloudConfig(record);\n+  }\n+\n+  /**\n+   * Delete cloud config fields (not the whole config)\n+   * @param clusterName\n+   * @param cloudConfig\n+   */\n+  public void deleteCloudConfigPatrial(String clusterName, CloudConfig cloudConfig) {\n+    if (!ZKUtil.isClusterSetup(clusterName, _zkClient)) {\n+      throw new HelixException(\"fail to delete cloud config. cluster: \" + clusterName + \" is NOT setup.\");\n+    }\n+\n+    HelixConfigScope scope =\n+        new HelixConfigScopeBuilder(ConfigScopeProperty.CLOUD).forCluster(clusterName).build();\n+    remove(scope, cloudConfig.getRecord());\n+  }\n+\n+  /**\n+   * Update cloud config\n+   * @param clusterName\n+   * @param cloudConfig\n+   */\n+  public void updateCloudConfig(String clusterName, CloudConfig cloudConfig) {", "originalCommit": "666268710e4e15ee10000ebce94c287df0986d8f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjc3OTkyMg==", "url": "https://github.com/apache/helix/pull/898#discussion_r392779922", "bodyText": "Basically, completely add or remove of cloud config seems to be admin work because it won't be used frequently (mainly used for cluster creation). I also find other similar API calls such as removeConfig in the HelixAdmin. However, updating or modifying such config are lower lever operations which have been implemented in ConfigAccessor.", "author": "alirezazamani", "createdAt": "2020-03-16T04:42:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY0MDgzNw=="}], "type": "inlineReview"}, {"oid": "19da28ae37a6359cb48ecc9fcac84feb2822d59d", "url": "https://github.com/apache/helix/commit/19da28ae37a6359cb48ecc9fcac84feb2822d59d", "message": "Fix comments", "committedDate": "2020-03-16T04:43:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI4OTM0MQ==", "url": "https://github.com/apache/helix/pull/898#discussion_r393289341", "bodyText": "What happened here?", "author": "junkaixue", "createdAt": "2020-03-16T20:23:46Z", "path": "helix-core/src/main/java/org/apache/helix/cloud/azure/AzureCloudInstanceInformationProcessor.java", "diffHunk": "@@ -145,15 +145,15 @@ public AzureCloudInstanceInformation parseCloudInstanceInformation(List<String>\n         String azureTopology = AzureConstants.AZURE_TOPOLOGY;\n         String[] parts = azureTopology.trim().split(\"/\");\n         //The hostname will be filled in by each participant\n-        String domain = parts[0] + \"=\" + platformFaultDomain + \",\" + parts[1] + \"=\";\n+        String domain = parts[1] + \"=\" + platformFaultDomain + \",\" + parts[2] + \"=\";\n \n         AzureCloudInstanceInformation.Builder builder = new AzureCloudInstanceInformation.Builder();\n-        builder.setInstanceName(vmName).setFaultDomain(domain)\n-            .setInstanceSetName(vmssName);\n+        builder.setInstanceName(vmName).setFaultDomain(domain).setInstanceSetName(vmssName);\n         azureCloudInstanceInformation = builder.build();\n       }\n     } catch (IOException e) {\n-      throw new HelixException(String.format(\"Error in parsing cloud instance information: {}\", response, e));\n+      throw new HelixException(", "originalCommit": "19da28ae37a6359cb48ecc9fcac84feb2822d59d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI5MDM3OA==", "url": "https://github.com/apache/helix/pull/898#discussion_r393290378", "bodyText": "I checked the format/style and fix it while working on this file.", "author": "alirezazamani", "createdAt": "2020-03-16T20:26:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI4OTM0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI4OTU2NQ==", "url": "https://github.com/apache/helix/pull/898#discussion_r393289565", "bodyText": "Is this format issue?", "author": "junkaixue", "createdAt": "2020-03-16T20:24:14Z", "path": "helix-core/src/main/java/org/apache/helix/cloud/azure/AzureCloudInstanceInformationProcessor.java", "diffHunk": "@@ -145,15 +145,15 @@ public AzureCloudInstanceInformation parseCloudInstanceInformation(List<String>\n         String azureTopology = AzureConstants.AZURE_TOPOLOGY;\n         String[] parts = azureTopology.trim().split(\"/\");\n         //The hostname will be filled in by each participant\n-        String domain = parts[0] + \"=\" + platformFaultDomain + \",\" + parts[1] + \"=\";\n+        String domain = parts[1] + \"=\" + platformFaultDomain + \",\" + parts[2] + \"=\";\n \n         AzureCloudInstanceInformation.Builder builder = new AzureCloudInstanceInformation.Builder();\n-        builder.setInstanceName(vmName).setFaultDomain(domain)\n-            .setInstanceSetName(vmssName);\n+        builder.setInstanceName(vmName).setFaultDomain(domain).setInstanceSetName(vmssName);", "originalCommit": "19da28ae37a6359cb48ecc9fcac84feb2822d59d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI5MDUwMA==", "url": "https://github.com/apache/helix/pull/898#discussion_r393290500", "bodyText": "I checked the format/style and fix it while working on this file.", "author": "alirezazamani", "createdAt": "2020-03-16T20:26:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI4OTU2NQ=="}], "type": "inlineReview"}]}