{"pr_number": 1565, "pr_title": "Refine task framework log", "pr_createdAt": "2020-11-30T19:25:44Z", "pr_url": "https://github.com/apache/helix/pull/1565", "timeline": [{"oid": "700ee82a68019fd8e320a0a4d5f4bb94aa0c0d22", "url": "https://github.com/apache/helix/commit/700ee82a68019fd8e320a0a4d5f4bb94aa0c0d22", "message": "log", "committedDate": "2020-11-25T22:11:53Z", "type": "commit"}, {"oid": "53b5b056822f29cd36b2639a496d247a6eb25f31", "url": "https://github.com/apache/helix/commit/53b5b056822f29cd36b2639a496d247a6eb25f31", "message": "refine log", "committedDate": "2020-11-25T22:11:53Z", "type": "commit"}, {"oid": "56c9ecebbb09ec6f03ef5b0b59343ec57a02b41d", "url": "https://github.com/apache/helix/commit/56c9ecebbb09ec6f03ef5b0b59343ec57a02b41d", "message": "audit test", "committedDate": "2020-11-26T00:21:59Z", "type": "commit"}, {"oid": "433688723bcaa0fc9474937abac49daba1538a8d", "url": "https://github.com/apache/helix/commit/433688723bcaa0fc9474937abac49daba1538a8d", "message": "fix typo", "committedDate": "2020-11-30T19:22:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzY1NTgxOA==", "url": "https://github.com/apache/helix/pull/1565#discussion_r533655818", "bodyText": "This may confusing. Originally it tells us the command should be either in job config or task config. But when you dd job name and task id can distract the focus.\nYou can change it as: \"Command must exist in either jobconfig (jobname) or taskconfig (taskid)\" something.", "author": "junkaixue", "createdAt": "2020-12-01T19:09:47Z", "path": "helix-core/src/main/java/org/apache/helix/task/TaskDriver.java", "diffHunk": "@@ -804,7 +803,9 @@ private void validateConfigsForTaskModifications(String workflowName, String job\n     }\n \n     if ((taskConfig.getCommand() == null) == (jobConfig.getCommand() == null)) {\n-      throw new HelixException(\"Command must exist in either job or task, not both!\");\n+      throw new HelixException(String\n+          .format(\"Command must exist in either job %s or task %s, not both!\", jobName,\n+              taskConfig.getId()));", "originalCommit": "433688723bcaa0fc9474937abac49daba1538a8d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc0OTEzMg==", "url": "https://github.com/apache/helix/pull/1565#discussion_r533749132", "bodyText": "TFTR. Updated.", "author": "xyuanlu", "createdAt": "2020-12-01T21:59:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzY1NTgxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzY1NjI4NA==", "url": "https://github.com/apache/helix/pull/1565#discussion_r533656284", "bodyText": "This could cause runtime exception. Not workflow + state.", "author": "junkaixue", "createdAt": "2020-12-01T19:10:37Z", "path": "helix-core/src/main/java/org/apache/helix/task/TaskDriver.java", "diffHunk": "@@ -1065,16 +1066,16 @@ private void setSingleWorkflowTargetState(String workflow, final TargetState sta\n \n     WorkflowConfig workflowConfig = TaskUtil.getWorkflowConfig(_accessor, workflow);\n     if (workflowConfig == null) {\n-      LOG.warn(\"WorkflowConfig for \" + workflow + \" not found!\");\n+      LOG.warn(\"WorkflowConfig for {} not found!\", workflow);\n       return;\n     }\n \n     WorkflowContext workflowContext = TaskUtil.getWorkflowContext(_propertyStore, workflow);\n     if (state != TargetState.DELETE && workflowContext != null\n         && workflowContext.getFinishTime() != WorkflowContext.UNFINISHED) {\n       // Should not update target state for completed workflow\n-      LOG.info(\"Workflow \" + workflow + \" is already completed, skip to update its target state \"\n-          + state);\n+      LOG.info(\"Workflow {} is already completed, skip to update its target state {}\",\n+          workflow + state);", "originalCommit": "433688723bcaa0fc9474937abac49daba1538a8d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc0OTY2OQ==", "url": "https://github.com/apache/helix/pull/1565#discussion_r533749669", "bodyText": "TFTR. Updated. It was a missed typo I have. Thanks for catching this.", "author": "xyuanlu", "createdAt": "2020-12-01T22:00:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzY1NjI4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzY1Njg3Mg==", "url": "https://github.com/apache/helix/pull/1565#discussion_r533656872", "bodyText": "The quote gives us clear range in naming. If you dont like to see the escaper, then let's have \"()\" to bound the names.", "author": "junkaixue", "createdAt": "2020-12-01T19:11:46Z", "path": "helix-core/src/main/java/org/apache/helix/task/TaskDriver.java", "diffHunk": "@@ -1173,7 +1176,7 @@ public TaskState pollForWorkflowState(String workflowName, long timeout,\n \n     if (ctx == null || !allowedStates.contains(ctx.getWorkflowState())) {\n       throw new HelixException(String.format(\n-          \"Workflow \\\"%s\\\" context is empty or not in states: \\\"%s\\\", current state: \\\"%s\\\"\",\n+          \"Workflow %s context is empty or not in states: %s, current state: %s.\",", "originalCommit": "433688723bcaa0fc9474937abac49daba1538a8d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc1MjU5NQ==", "url": "https://github.com/apache/helix/pull/1565#discussion_r533752595", "bodyText": "I removed the quotation mark because I didn't find in anywhere else. I think all logs should have the same format.  Are you suggesting add \"()\" to bound all ID and names in all the logs?\nI personally find space is enough. Please do suggest on this since I do not have that mush Helix debugging experience.", "author": "xyuanlu", "createdAt": "2020-12-01T22:06:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzY1Njg3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc4ODg0MQ==", "url": "https://github.com/apache/helix/pull/1565#discussion_r533788841", "bodyText": "With some quote or bounding chars can help us locate the names. Sometimes the job name or workflow name could be very long.", "author": "junkaixue", "createdAt": "2020-12-01T23:21:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzY1Njg3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc5Njg2OQ==", "url": "https://github.com/apache/helix/pull/1565#discussion_r533796869", "bodyText": "Thanks for the suggestion. If having bounding chars is more preferable, I think it is better to have another PR to change all TF related files. This PR only touches part of them", "author": "xyuanlu", "createdAt": "2020-12-01T23:42:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzY1Njg3Mg=="}], "type": "inlineReview"}, {"oid": "02a87eb9dd80fef668ba402ec0c742dc62e0d00f", "url": "https://github.com/apache/helix/commit/02a87eb9dd80fef668ba402ec0c742dc62e0d00f", "message": "address commends", "committedDate": "2020-12-01T23:50:32Z", "type": "commit"}, {"oid": "02a87eb9dd80fef668ba402ec0c742dc62e0d00f", "url": "https://github.com/apache/helix/commit/02a87eb9dd80fef668ba402ec0c742dc62e0d00f", "message": "address commends", "committedDate": "2020-12-01T23:50:32Z", "type": "forcePushed"}]}