{"pr_number": 675, "pr_title": "Add REST API for Cluster Creation with CloudConfig", "pr_createdAt": "2020-01-07T17:38:21Z", "pr_url": "https://github.com/apache/helix/pull/675", "timeline": [{"oid": "12f3c66b1c2e20b01837618323895168e9b5e43d", "url": "https://github.com/apache/helix/commit/12f3c66b1c2e20b01837618323895168e9b5e43d", "message": "Add REST API for Cluster Creation with CloudConfig\n\nThis commit contains the relevant REST cluster creation.\nThis change allows user to create cluster with CloudConfig.\nMultiple tests have been added in order to check the functionality of REST calls.", "committedDate": "2020-01-07T17:20:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg4NzI0NA==", "url": "https://github.com/apache/helix/pull/675#discussion_r363887244", "bodyText": "Does this work? It conflict with ClusterAccessor. It would be better to merge the logic into ClusterAccessor.", "author": "junkaixue", "createdAt": "2020-01-07T18:29:32Z", "path": "helix-rest/src/main/java/org/apache/helix/rest/server/resources/helix/CloudAccessor.java", "diffHunk": "@@ -0,0 +1,152 @@\n+package org.apache.helix.rest.server.resources.helix;\n+\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import java.io.IOException;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.POST;\n+import javax.ws.rs.PUT;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.PathParam;\n+import javax.ws.rs.QueryParam;\n+import javax.ws.rs.core.Response;\n+import org.apache.helix.ConfigAccessor;\n+import org.apache.helix.HelixAdmin;\n+import org.apache.helix.HelixDataAccessor;\n+import org.apache.helix.HelixException;\n+import org.apache.helix.ZNRecord;\n+import org.apache.helix.manager.zk.ZKUtil;\n+import org.apache.helix.manager.zk.client.HelixZkClient;\n+import org.apache.helix.model.CloudConfig;\n+import org.apache.helix.model.HelixConfigScope;\n+import org.apache.helix.model.builder.HelixConfigScopeBuilder;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+@Path(\"/clusters\")", "originalCommit": "12f3c66b1c2e20b01837618323895168e9b5e43d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDM5ODgxNg==", "url": "https://github.com/apache/helix/pull/675#discussion_r364398816", "bodyText": "Fixed. Move to code to ClusterAccessor.", "author": "alirezazamani", "createdAt": "2020-01-08T19:17:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg4NzI0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg5NjczOQ==", "url": "https://github.com/apache/helix/pull/675#discussion_r363896739", "bodyText": "Let's reorganize the code. There are duplicated pieces.\nYou can:\n\nDefine CloudConfig object\nCreate this object if enabled and move this piece of code to a separate function. Otherwise, keep it as null.\nCall the addCluster with CloudConfig object.", "author": "junkaixue", "createdAt": "2020-01-07T18:52:10Z", "path": "helix-rest/src/main/java/org/apache/helix/rest/server/resources/helix/ClusterAccessor.java", "diffHunk": "@@ -132,18 +133,42 @@ public Response getClusterInfo(@PathParam(\"clusterId\") String clusterId) {\n   @PUT\n   @Path(\"{clusterId}\")\n   public Response createCluster(@PathParam(\"clusterId\") String clusterId,\n-      @DefaultValue(\"false\") @QueryParam(\"recreate\") String recreate) {\n+      @DefaultValue(\"false\") @QueryParam(\"recreate\") String recreate,\n+      @DefaultValue(\"false\") @QueryParam(\"addCloudConfig\") String addCloudConfig,\n+      String content) {\n+\n     boolean recreateIfExists = Boolean.valueOf(recreate);\n+    boolean cloudConfigIncluded = Boolean.valueOf(addCloudConfig);\n+\n+\n     ClusterSetup clusterSetup = getClusterSetup();\n \n-    try {\n-      clusterSetup.addCluster(clusterId, recreateIfExists);\n-    } catch (Exception ex) {\n-      _logger.error(\"Failed to create cluster \" + clusterId + \", exception: \" + ex);\n-      return serverError(ex);\n-    }\n+    if (!cloudConfigIncluded) {", "originalCommit": "12f3c66b1c2e20b01837618323895168e9b5e43d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjEwMDY4MQ==", "url": "https://github.com/apache/helix/pull/675#discussion_r366100681", "bodyText": "Done.", "author": "alirezazamani", "createdAt": "2020-01-14T00:31:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg5NjczOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg5NzE5NA==", "url": "https://github.com/apache/helix/pull/675#discussion_r363897194", "bodyText": "Let's make it as a general function in AbstractResourceAccessor since it has been widely used in the code.\nSame as following places", "author": "junkaixue", "createdAt": "2020-01-07T18:53:18Z", "path": "helix-rest/src/main/java/org/apache/helix/rest/server/resources/helix/CloudAccessor.java", "diffHunk": "@@ -0,0 +1,152 @@\n+package org.apache.helix.rest.server.resources.helix;\n+\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import java.io.IOException;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.POST;\n+import javax.ws.rs.PUT;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.PathParam;\n+import javax.ws.rs.QueryParam;\n+import javax.ws.rs.core.Response;\n+import org.apache.helix.ConfigAccessor;\n+import org.apache.helix.HelixAdmin;\n+import org.apache.helix.HelixDataAccessor;\n+import org.apache.helix.HelixException;\n+import org.apache.helix.ZNRecord;\n+import org.apache.helix.manager.zk.ZKUtil;\n+import org.apache.helix.manager.zk.client.HelixZkClient;\n+import org.apache.helix.model.CloudConfig;\n+import org.apache.helix.model.HelixConfigScope;\n+import org.apache.helix.model.builder.HelixConfigScopeBuilder;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+@Path(\"/clusters\")\n+public class CloudAccessor extends AbstractHelixResource {\n+  private static Logger _logger = LoggerFactory.getLogger(CloudAccessor.class.getName());\n+\n+  @PUT\n+  @Path(\"{clusterId}/cloudconfig\")\n+  public Response addCloudConfig(@PathParam(\"clusterId\") String clusterId, String content) {\n+\n+    HelixZkClient zkClient = getHelixZkClient();\n+    if (!ZKUtil.isClusterSetup(clusterId, zkClient)) {\n+      return notFound();\n+    }\n+\n+    HelixAdmin admin = getHelixAdmin();\n+    ZNRecord record;\n+    try {\n+      record = toZNRecord(content);\n+    } catch (IOException e) {\n+      _logger.error(\"Failed to deserialize user's input \" + content + \", Exception: \" + e);\n+      return badRequest(\"Input is not a vaild ZNRecord!\");\n+    }", "originalCommit": "12f3c66b1c2e20b01837618323895168e9b5e43d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYxNjE1MA==", "url": "https://github.com/apache/helix/pull/675#discussion_r366616150", "bodyText": "As we discussed offline, sine the output of toZNRecord function is a record, it is not easy to move try/catch to lower level.", "author": "alirezazamani", "createdAt": "2020-01-14T22:54:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg5NzE5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzkwMTU4Mg==", "url": "https://github.com/apache/helix/pull/675#discussion_r363901582", "bodyText": "Let's have another catch for HelixException to differentiate it with other general error. It could be validation exception.\nSame as following places.", "author": "junkaixue", "createdAt": "2020-01-07T19:04:01Z", "path": "helix-rest/src/main/java/org/apache/helix/rest/server/resources/helix/CloudAccessor.java", "diffHunk": "@@ -0,0 +1,152 @@\n+package org.apache.helix.rest.server.resources.helix;\n+\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import java.io.IOException;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.POST;\n+import javax.ws.rs.PUT;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.PathParam;\n+import javax.ws.rs.QueryParam;\n+import javax.ws.rs.core.Response;\n+import org.apache.helix.ConfigAccessor;\n+import org.apache.helix.HelixAdmin;\n+import org.apache.helix.HelixDataAccessor;\n+import org.apache.helix.HelixException;\n+import org.apache.helix.ZNRecord;\n+import org.apache.helix.manager.zk.ZKUtil;\n+import org.apache.helix.manager.zk.client.HelixZkClient;\n+import org.apache.helix.model.CloudConfig;\n+import org.apache.helix.model.HelixConfigScope;\n+import org.apache.helix.model.builder.HelixConfigScopeBuilder;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+@Path(\"/clusters\")\n+public class CloudAccessor extends AbstractHelixResource {\n+  private static Logger _logger = LoggerFactory.getLogger(CloudAccessor.class.getName());\n+\n+  @PUT\n+  @Path(\"{clusterId}/cloudconfig\")\n+  public Response addCloudConfig(@PathParam(\"clusterId\") String clusterId, String content) {\n+\n+    HelixZkClient zkClient = getHelixZkClient();\n+    if (!ZKUtil.isClusterSetup(clusterId, zkClient)) {\n+      return notFound();\n+    }\n+\n+    HelixAdmin admin = getHelixAdmin();\n+    ZNRecord record;\n+    try {\n+      record = toZNRecord(content);\n+    } catch (IOException e) {\n+      _logger.error(\"Failed to deserialize user's input \" + content + \", Exception: \" + e);\n+      return badRequest(\"Input is not a vaild ZNRecord!\");\n+    }\n+\n+    try {\n+      CloudConfig cloudConfig = new CloudConfig.Builder(record).build();\n+      admin.addCloudConfig(clusterId, cloudConfig);\n+    } catch (Exception ex) {", "originalCommit": "12f3c66b1c2e20b01837618323895168e9b5e43d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjEwMzY4MA==", "url": "https://github.com/apache/helix/pull/675#discussion_r366103680", "bodyText": "Fixed.", "author": "alirezazamani", "createdAt": "2020-01-14T00:44:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzkwMTU4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzkwMjM5Ng==", "url": "https://github.com/apache/helix/pull/675#discussion_r363902396", "bodyText": "This is not a good practice here. User may get confused with 404 and without any other information here. Let's have clear message that cluster is not properly setup.\nSame as following places.", "author": "junkaixue", "createdAt": "2020-01-07T19:06:10Z", "path": "helix-rest/src/main/java/org/apache/helix/rest/server/resources/helix/CloudAccessor.java", "diffHunk": "@@ -0,0 +1,152 @@\n+package org.apache.helix.rest.server.resources.helix;\n+\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import java.io.IOException;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.POST;\n+import javax.ws.rs.PUT;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.PathParam;\n+import javax.ws.rs.QueryParam;\n+import javax.ws.rs.core.Response;\n+import org.apache.helix.ConfigAccessor;\n+import org.apache.helix.HelixAdmin;\n+import org.apache.helix.HelixDataAccessor;\n+import org.apache.helix.HelixException;\n+import org.apache.helix.ZNRecord;\n+import org.apache.helix.manager.zk.ZKUtil;\n+import org.apache.helix.manager.zk.client.HelixZkClient;\n+import org.apache.helix.model.CloudConfig;\n+import org.apache.helix.model.HelixConfigScope;\n+import org.apache.helix.model.builder.HelixConfigScopeBuilder;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+@Path(\"/clusters\")\n+public class CloudAccessor extends AbstractHelixResource {\n+  private static Logger _logger = LoggerFactory.getLogger(CloudAccessor.class.getName());\n+\n+  @PUT\n+  @Path(\"{clusterId}/cloudconfig\")\n+  public Response addCloudConfig(@PathParam(\"clusterId\") String clusterId, String content) {\n+\n+    HelixZkClient zkClient = getHelixZkClient();\n+    if (!ZKUtil.isClusterSetup(clusterId, zkClient)) {", "originalCommit": "12f3c66b1c2e20b01837618323895168e9b5e43d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjEwMjM2Ng==", "url": "https://github.com/apache/helix/pull/675#discussion_r366102366", "bodyText": "Done.", "author": "alirezazamani", "createdAt": "2020-01-14T00:38:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzkwMjM5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzkwMjkzNw==", "url": "https://github.com/apache/helix/pull/675#discussion_r363902937", "bodyText": "move record read before command switch.", "author": "junkaixue", "createdAt": "2020-01-07T19:07:36Z", "path": "helix-rest/src/main/java/org/apache/helix/rest/server/resources/helix/CloudAccessor.java", "diffHunk": "@@ -0,0 +1,152 @@\n+package org.apache.helix.rest.server.resources.helix;\n+\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import java.io.IOException;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.POST;\n+import javax.ws.rs.PUT;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.PathParam;\n+import javax.ws.rs.QueryParam;\n+import javax.ws.rs.core.Response;\n+import org.apache.helix.ConfigAccessor;\n+import org.apache.helix.HelixAdmin;\n+import org.apache.helix.HelixDataAccessor;\n+import org.apache.helix.HelixException;\n+import org.apache.helix.ZNRecord;\n+import org.apache.helix.manager.zk.ZKUtil;\n+import org.apache.helix.manager.zk.client.HelixZkClient;\n+import org.apache.helix.model.CloudConfig;\n+import org.apache.helix.model.HelixConfigScope;\n+import org.apache.helix.model.builder.HelixConfigScopeBuilder;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+@Path(\"/clusters\")\n+public class CloudAccessor extends AbstractHelixResource {\n+  private static Logger _logger = LoggerFactory.getLogger(CloudAccessor.class.getName());\n+\n+  @PUT\n+  @Path(\"{clusterId}/cloudconfig\")\n+  public Response addCloudConfig(@PathParam(\"clusterId\") String clusterId, String content) {\n+\n+    HelixZkClient zkClient = getHelixZkClient();\n+    if (!ZKUtil.isClusterSetup(clusterId, zkClient)) {\n+      return notFound();\n+    }\n+\n+    HelixAdmin admin = getHelixAdmin();\n+    ZNRecord record;\n+    try {\n+      record = toZNRecord(content);\n+    } catch (IOException e) {\n+      _logger.error(\"Failed to deserialize user's input \" + content + \", Exception: \" + e);\n+      return badRequest(\"Input is not a vaild ZNRecord!\");\n+    }\n+\n+    try {\n+      CloudConfig cloudConfig = new CloudConfig.Builder(record).build();\n+      admin.addCloudConfig(clusterId, cloudConfig);\n+    } catch (Exception ex) {\n+      _logger.error(\"Error in adding a CloudConfig to cluster: \" + clusterId, ex);\n+      return badRequest(ex.getMessage());\n+    }\n+\n+    return OK();\n+  }\n+\n+  @GET\n+  @Path(\"{clusterId}/cloudconfig\")\n+  public Response getCloudConfig(@PathParam(\"clusterId\") String clusterId) {\n+\n+    HelixZkClient zkClient = getHelixZkClient();\n+    if (!ZKUtil.isClusterSetup(clusterId, zkClient)) {\n+      return notFound();\n+    }\n+\n+    ConfigAccessor configAccessor = new ConfigAccessor(zkClient);\n+    CloudConfig cloudConfig = configAccessor.getCloudConfig(clusterId);\n+\n+    if (cloudConfig != null) {\n+      return JSONRepresentation(cloudConfig.getRecord());\n+    }\n+\n+    return notFound();\n+  }\n+\n+  @POST\n+  @Path(\"{clusterId}/cloudconfig\")\n+  public Response updateCloudConfig(@PathParam(\"clusterId\") String clusterId,\n+      @QueryParam(\"command\") String commandStr, String content) {\n+\n+    HelixZkClient zkClient = getHelixZkClient();\n+    if (!ZKUtil.isClusterSetup(clusterId, zkClient)) {\n+      return notFound();\n+    }\n+\n+    // Here to update cloud config\n+    Command command;\n+    if (commandStr == null || commandStr.isEmpty()) {\n+      command = Command.update; // Default behavior\n+    } else {\n+      try {\n+        command = getCommand(commandStr);\n+      } catch (HelixException ex) {\n+        return badRequest(ex.getMessage());\n+      }\n+    }\n+\n+    HelixAdmin admin = getHelixAdmin();\n+    try {\n+      switch (command) {\n+        case delete: {\n+          admin.removeCloudConfig(clusterId);\n+        }\n+        break;\n+        case update: {\n+          ZNRecord record;", "originalCommit": "12f3c66b1c2e20b01837618323895168e9b5e43d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYxNTA1MA==", "url": "https://github.com/apache/helix/pull/675#discussion_r366615050", "bodyText": "Done.", "author": "alirezazamani", "createdAt": "2020-01-14T22:51:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzkwMjkzNw=="}], "type": "inlineReview"}, {"oid": "d9884f2829a3c0875acfea2fd1cefef22d7da4b6", "url": "https://github.com/apache/helix/commit/d9884f2829a3c0875acfea2fd1cefef22d7da4b6", "message": "fix reviewer comments", "committedDate": "2020-01-14T22:39:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzEzMTY1MA==", "url": "https://github.com/apache/helix/pull/675#discussion_r367131650", "bodyText": "This is not badRequest. It may be something related to internal server error.", "author": "junkaixue", "createdAt": "2020-01-15T22:04:50Z", "path": "helix-rest/src/main/java/org/apache/helix/rest/server/resources/helix/ClusterAccessor.java", "diffHunk": "@@ -514,6 +533,119 @@ private boolean doesClusterExist(String cluster) {\n     return ZKUtil.isClusterSetup(cluster, zkClient);\n   }\n \n+  @PUT\n+  @Path(\"{clusterId}/cloudconfig\")\n+  public Response addCloudConfig(@PathParam(\"clusterId\") String clusterId, String content) {\n+\n+    HelixZkClient zkClient = getHelixZkClient();\n+    if (!ZKUtil.isClusterSetup(clusterId, zkClient)) {\n+      return notFound(\"Cluster is not properly setup!\");\n+    }\n+\n+    HelixAdmin admin = getHelixAdmin();\n+    ZNRecord record;\n+    try {\n+      record = toZNRecord(content);\n+    } catch (IOException e) {\n+      _logger.error(\"Failed to deserialize user's input \" + content + \", Exception: \" + e);\n+      return badRequest(\"Input is not a vaild ZNRecord!\");\n+    }\n+\n+    try {\n+      CloudConfig cloudConfig = new CloudConfig.Builder(record).build();\n+      admin.addCloudConfig(clusterId, cloudConfig);\n+    } catch (HelixException ex) {\n+      _logger.error(\"Error in adding a CloudConfig to cluster: \" + clusterId, ex);\n+      return badRequest(ex.getMessage());\n+    } catch (Exception ex) {\n+      _logger.error(\"Cannot add CloudConfig to cluster: \" + clusterId, ex);\n+      return badRequest(ex.getMessage());", "originalCommit": "d9884f2829a3c0875acfea2fd1cefef22d7da4b6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzIxMTA3MA==", "url": "https://github.com/apache/helix/pull/675#discussion_r367211070", "bodyText": "Fixed. Thanks.", "author": "alirezazamani", "createdAt": "2020-01-16T03:05:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzEzMTY1MA=="}], "type": "inlineReview"}, {"oid": "a67d349a2b43c158a5adf4b5467c3b0b24efacf8", "url": "https://github.com/apache/helix/commit/a67d349a2b43c158a5adf4b5467c3b0b24efacf8", "message": "change badrequest to server error", "committedDate": "2020-01-16T03:04:42Z", "type": "commit"}]}