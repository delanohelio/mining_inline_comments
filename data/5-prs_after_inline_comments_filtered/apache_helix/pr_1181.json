{"pr_number": 1181, "pr_title": "Recover Workflow GC Logic", "pr_createdAt": "2020-07-28T15:56:09Z", "pr_url": "https://github.com/apache/helix/pull/1181", "timeline": [{"oid": "e05d0e828ffe328d5f78065fe4459875543ac54e", "url": "https://github.com/apache/helix/commit/e05d0e828ffe328d5f78065fe4459875543ac54e", "message": "Fix broken test", "committedDate": "2020-07-27T20:50:39Z", "type": "commit"}, {"oid": "0b89eb7defb97f5c1d1eb8d310c9c709da9ca53d", "url": "https://github.com/apache/helix/commit/0b89eb7defb97f5c1d1eb8d310c9c709da9ca53d", "message": "Address some comments", "committedDate": "2020-07-27T20:52:20Z", "type": "commit"}, {"oid": "3ea5fb2626af2e87b8332b1470ca5fa62689a8a7", "url": "https://github.com/apache/helix/commit/3ea5fb2626af2e87b8332b1470ca5fa62689a8a7", "message": "Temporary changes", "committedDate": "2020-07-27T21:09:34Z", "type": "commit"}, {"oid": "87a2097ba9fa23ddac57417ac4221b287828a651", "url": "https://github.com/apache/helix/commit/87a2097ba9fa23ddac57417ac4221b287828a651", "message": "New direction", "committedDate": "2020-07-27T21:10:23Z", "type": "commit"}, {"oid": "3925f399ada8e922f355986138d71cc25b2ad70e", "url": "https://github.com/apache/helix/commit/3925f399ada8e922f355986138d71cc25b2ad70e", "message": "Add comments etc", "committedDate": "2020-07-27T21:10:23Z", "type": "commit"}, {"oid": "00aeafc478233af7903478ebb1a74c9a1db60789", "url": "https://github.com/apache/helix/commit/00aeafc478233af7903478ebb1a74c9a1db60789", "message": "New test and nits", "committedDate": "2020-07-27T21:10:23Z", "type": "commit"}, {"oid": "12233c30f3684638f9ea29ca0ff047f122d045fe", "url": "https://github.com/apache/helix/commit/12233c30f3684638f9ea29ca0ff047f122d045fe", "message": "address comments", "committedDate": "2020-07-27T21:10:23Z", "type": "commit"}, {"oid": "80fa8e7e61c6c95269bcd3fcbc04f563a1c788be", "url": "https://github.com/apache/helix/commit/80fa8e7e61c6c95269bcd3fcbc04f563a1c788be", "message": "Renaming", "committedDate": "2020-07-27T21:10:23Z", "type": "commit"}, {"oid": "70f2ccdd5f6963ea3ae7226a27c9939ed77f0bd6", "url": "https://github.com/apache/helix/commit/70f2ccdd5f6963ea3ae7226a27c9939ed77f0bd6", "message": "Fix NPE and broken tests", "committedDate": "2020-07-27T21:10:23Z", "type": "commit"}, {"oid": "4928ab998c0dbdd773f5bc83111a06511c91afa8", "url": "https://github.com/apache/helix/commit/4928ab998c0dbdd773f5bc83111a06511c91afa8", "message": "Fix patch issues", "committedDate": "2020-07-27T21:22:03Z", "type": "commit"}, {"oid": "c9c1f7430ad9d8f1cd444c6b363bde4222bf8697", "url": "https://github.com/apache/helix/commit/c9c1f7430ad9d8f1cd444c6b363bde4222bf8697", "message": "better scheduling", "committedDate": "2020-07-27T21:37:09Z", "type": "commit"}, {"oid": "a149766b337705130013fb7ca805fc9af7bcee85", "url": "https://github.com/apache/helix/commit/a149766b337705130013fb7ca805fc9af7bcee85", "message": "Logic update for true case", "committedDate": "2020-07-27T23:59:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTcwNTMzOQ==", "url": "https://github.com/apache/helix/pull/1181#discussion_r461705339", "bodyText": "Can you change this to TestHeper.WAIT_DURATION?", "author": "alirezazamani", "createdAt": "2020-07-28T16:15:33Z", "path": "helix-core/src/test/java/org/apache/helix/integration/task/TestJobQueueCleanUp.java", "diffHunk": "@@ -105,14 +105,19 @@ public void testJobQueueAutoCleanUp() throws InterruptedException {\n     }\n     _driver.start(builder.build());\n     _driver.pollForJobState(queueName, TaskUtil.getNamespacedJobName(queueName, \"JOB\" + (capacity - 1)), TaskState.FAILED);\n-    Thread.sleep(2000);\n \n-    WorkflowConfig config = _driver.getWorkflowConfig(queueName);\n-    Assert.assertEquals(config.getJobDag().getAllNodes(), remainJobs);\n+    Assert\n+        .assertTrue(TestHelper.verify(() -> {\n+          WorkflowConfig config = _driver.getWorkflowConfig(queueName);\n+          System.out.println(\"|Current time: \" + System.currentTimeMillis() +\" **TEST: \" + config.getJobDag().getAllNodes());\n+          return config.getJobDag().getAllNodes().equals(remainJobs);\n+        }, 10000));", "originalCommit": "70f2ccdd5f6963ea3ae7226a27c9939ed77f0bd6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTcwNTQwNA==", "url": "https://github.com/apache/helix/pull/1181#discussion_r461705404", "bodyText": "Can you change this to TestHeper.WAIT_DURATION?", "author": "alirezazamani", "createdAt": "2020-07-28T16:15:39Z", "path": "helix-core/src/test/java/org/apache/helix/integration/task/TestJobQueueCleanUp.java", "diffHunk": "@@ -105,14 +105,19 @@ public void testJobQueueAutoCleanUp() throws InterruptedException {\n     }\n     _driver.start(builder.build());\n     _driver.pollForJobState(queueName, TaskUtil.getNamespacedJobName(queueName, \"JOB\" + (capacity - 1)), TaskState.FAILED);\n-    Thread.sleep(2000);\n \n-    WorkflowConfig config = _driver.getWorkflowConfig(queueName);\n-    Assert.assertEquals(config.getJobDag().getAllNodes(), remainJobs);\n+    Assert\n+        .assertTrue(TestHelper.verify(() -> {\n+          WorkflowConfig config = _driver.getWorkflowConfig(queueName);\n+          System.out.println(\"|Current time: \" + System.currentTimeMillis() +\" **TEST: \" + config.getJobDag().getAllNodes());\n+          return config.getJobDag().getAllNodes().equals(remainJobs);\n+        }, 10000));\n \n-    WorkflowContext context = _driver.getWorkflowContext(queueName);\n-    Assert.assertEquals(context.getJobStates().keySet(), remainJobs);\n-    Assert.assertTrue(remainJobs.containsAll(context.getJobStartTimes().keySet()));\n+    Assert.assertTrue(TestHelper.verify(() -> {\n+      WorkflowContext context = _driver.getWorkflowContext(queueName);\n+      return context.getJobStates().keySet().equals(remainJobs) && remainJobs\n+          .containsAll(context.getJobStartTimes().keySet());\n+    }, 10000));", "originalCommit": "70f2ccdd5f6963ea3ae7226a27c9939ed77f0bd6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0fd6de493ef8ea016f28eafb83634ce2030a2ded", "url": "https://github.com/apache/helix/commit/0fd6de493ef8ea016f28eafb83634ce2030a2ded", "message": "variable name change", "committedDate": "2020-07-28T16:52:45Z", "type": "commit"}]}