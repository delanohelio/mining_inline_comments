{"pr_number": 1237, "pr_title": "Fix empty host list for instance stoppable response", "pr_createdAt": "2020-08-08T04:19:53Z", "pr_url": "https://github.com/apache/helix/pull/1237", "timeline": [{"oid": "e1b5cb467a70b75d0cd7f9e695be189e537aca47", "url": "https://github.com/apache/helix/commit/e1b5cb467a70b75d0cd7f9e695be189e537aca47", "message": "Add error message of instance check to API response", "committedDate": "2020-08-08T07:30:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQ0NTc0MQ==", "url": "https://github.com/apache/helix/pull/1237#discussion_r472445741", "bodyText": "I find this may be misleading. Can we change it to, \"Persist assignment (%s) is not turned on in the Cluster Config. This is required to enable instance stability check.\"", "author": "jiajunwang", "createdAt": "2020-08-18T19:59:18Z", "path": "helix-core/src/main/java/org/apache/helix/util/InstanceValidationUtil.java", "diffHunk": "@@ -261,7 +261,9 @@ public static boolean isInstanceStable(HelixDataAccessor dataAccessor, String in\n       throw new HelixException(\"Missing cluster config!\");\n     }\n     if (!clusterConfig.isPersistIntermediateAssignment()) {\n-      throw new HelixException(\"isInstanceStable needs persist assignment on!\");\n+      throw new HelixException(String.format(\n+          \"Instance stability check needs persist assignment cluster config turned on: %s = true\",", "originalCommit": "e1b5cb467a70b75d0cd7f9e695be189e537aca47", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTA2MzEwMg==", "url": "https://github.com/apache/helix/pull/1237#discussion_r475063102", "bodyText": "Made it clearer.", "author": "huizhilu", "createdAt": "2020-08-22T08:26:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQ0NTc0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQ0NjcyOA==", "url": "https://github.com/apache/helix/pull/1237#discussion_r472446728", "bodyText": "Why it is a warning now?", "author": "jiajunwang", "createdAt": "2020-08-18T20:01:02Z", "path": "helix-rest/src/main/java/org/apache/helix/rest/server/service/InstanceServiceImpl.java", "diffHunk": "@@ -213,7 +219,12 @@ public StoppableCheck getInstanceStoppableCheck(String clusterId, String instanc\n           instancesForNextCheck.add(instance);\n         }\n       } catch (InterruptedException | ExecutionException e) {\n-        LOG.error(\"Failed to get StoppableChecks in parallel. Instance: {}\", instance, e);\n+        LOG.warn(\"Failed to get StoppableChecks in parallel. Instance: {}. Caused by {}\", instance,", "originalCommit": "e1b5cb467a70b75d0cd7f9e695be189e537aca47", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTA2MzM0Mw==", "url": "https://github.com/apache/helix/pull/1237#discussion_r475063343", "bodyText": "I feel error is inappropriate for this kind of msg. It is not a server error.\nERROR should contain technical issues that need to be resolved for proper functioning of the system (ex: couldn\u2019t connect to database)\nWARN is best used for temporary problems or unexpected behavior that does not significantly hamper the functioning of the application (ex:  failed user login)\nINFO should contain messages that describe what is happening in the application (ex: user registered, order placed)", "author": "huizhilu", "createdAt": "2020-08-22T08:29:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQ0NjcyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTgxMTg1MQ==", "url": "https://github.com/apache/helix/pull/1237#discussion_r475811851", "bodyText": "I think the failure reason does not really matter here (although an Exception looks to be a problem to me more than a warning).\nThe real matter thing is that whether the result is complete and fully computed. If not certain, then this is an error.", "author": "jiajunwang", "createdAt": "2020-08-24T18:26:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQ0NjcyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjE0NDkxNA==", "url": "https://github.com/apache/helix/pull/1237#discussion_r476144914", "bodyText": "The code change is not necessary and kept as it is.\nRegarding warn or error, I look at it from server perspective: if the exception is not a server exception that affects running of the REST server, I would say it is an error.\nBut obviously this is not an exception that stops REST server running. It is just a normal running of the API check. It should not be logged as an error. A warning should already be enough to help debug.", "author": "huizhilu", "createdAt": "2020-08-25T04:12:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQ0NjcyOA=="}], "type": "inlineReview"}, {"oid": "a488ed753a4b83e9f28dab75dfbb2fd56e32b6fd", "url": "https://github.com/apache/helix/commit/a488ed753a4b83e9f28dab75dfbb2fd56e32b6fd", "message": "Add error message of instance check to API response", "committedDate": "2020-08-22T08:23:35Z", "type": "commit"}, {"oid": "184fd16ff0f0260e32b7f4a2d00ae28d6ba82ec4", "url": "https://github.com/apache/helix/commit/184fd16ff0f0260e32b7f4a2d00ae28d6ba82ec4", "message": "Check configs in INVALID_CONFIG healthcheck", "committedDate": "2020-08-22T08:23:37Z", "type": "forcePushed"}, {"oid": "77e2956f5ed329fcfb71773af6ec0e067bafee21", "url": "https://github.com/apache/helix/commit/77e2956f5ed329fcfb71773af6ec0e067bafee21", "message": "Check configs in INVALID_CONFIG healthcheck", "committedDate": "2020-08-22T08:25:40Z", "type": "forcePushed"}, {"oid": "9381e50ece3a160c4e6a3a3e692006d3d28dbc53", "url": "https://github.com/apache/helix/commit/9381e50ece3a160c4e6a3a3e692006d3d28dbc53", "message": "Check configs in INVALID_CONFIG healthcheck", "committedDate": "2020-08-22T08:28:13Z", "type": "forcePushed"}, {"oid": "d3f3ec915fc3b60df7f2d5eaac8011477d46460d", "url": "https://github.com/apache/helix/commit/d3f3ec915fc3b60df7f2d5eaac8011477d46460d", "message": "Check configs in INVALID_CONFIG healthcheck", "committedDate": "2020-08-22T09:16:06Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTA2NzUxMQ==", "url": "https://github.com/apache/helix/pull/1237#discussion_r475067511", "bodyText": "@dasahcc INVALID_CONFIG should also be added to STARTED_AND_HEALTH_CHECK_LIST, right?", "author": "huizhilu", "createdAt": "2020-08-22T09:20:12Z", "path": "helix-rest/src/main/java/org/apache/helix/rest/server/service/InstanceService.java", "diffHunk": "@@ -72,9 +72,10 @@\n         /**\n          * Pre-defined list of checks to test if an instance is in healthy running state\n          */\n-        public static List<HealthCheck> STARTED_AND_HEALTH_CHECK_LIST =\n-                ImmutableList.of(HealthCheck.INSTANCE_NOT_ALIVE, HealthCheck.INSTANCE_NOT_ENABLED,\n-                        HealthCheck.INSTANCE_NOT_STABLE, HealthCheck.EMPTY_RESOURCE_ASSIGNMENT);\n+        public static List<HealthCheck> STARTED_AND_HEALTH_CHECK_LIST = ImmutableList\n+            .of(HealthCheck.INVALID_CONFIG, HealthCheck.INSTANCE_NOT_ALIVE,", "originalCommit": "d3f3ec915fc3b60df7f2d5eaac8011477d46460d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6f05795d36866e27d913de3efdf45908648da25c", "url": "https://github.com/apache/helix/commit/6f05795d36866e27d913de3efdf45908648da25c", "message": "Check configs in INVALID_CONFIG healthcheck", "committedDate": "2020-08-22T21:39:22Z", "type": "commit"}, {"oid": "6f05795d36866e27d913de3efdf45908648da25c", "url": "https://github.com/apache/helix/commit/6f05795d36866e27d913de3efdf45908648da25c", "message": "Check configs in INVALID_CONFIG healthcheck", "committedDate": "2020-08-22T21:39:22Z", "type": "forcePushed"}]}