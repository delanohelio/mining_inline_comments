{"pr_number": 946, "pr_title": "Move routing table provider initialization", "pr_createdAt": "2020-04-10T21:20:47Z", "pr_url": "https://github.com/apache/helix/pull/946", "timeline": [{"oid": "eab24d34bed93791bbabf2cdb96c6b518370322b", "url": "https://github.com/apache/helix/commit/eab24d34bed93791bbabf2cdb96c6b518370322b", "message": "Move routing table provider initialization", "committedDate": "2020-04-10T21:17:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk1MDM3Mg==", "url": "https://github.com/apache/helix/pull/946#discussion_r406950372", "bodyText": "can we try somewhere in the test process to initialize a new routing table provider with different types? A little concerned that we have only one fixed data resources input here. Let's put the initialization before the update of config/states, and see whether that's stable.", "author": "zhangmeng916", "createdAt": "2020-04-10T21:24:53Z", "path": "helix-core/src/test/java/org/apache/helix/integration/TestCustomizedViewAggregation.java", "diffHunk": "@@ -120,6 +118,23 @@ public void beforeClass() throws Exception {\n     _localCustomizedView = new HashMap<>();\n     _routingTableProviderDataSources = new HashSet<>();\n     _aggregationEnabledTypes = new HashSet<>();\n+\n+    List<String> customizedStateTypes = Arrays\n+        .asList(CustomizedStateType.TYPE_A.name(), CustomizedStateType.TYPE_B.name(),\n+            CustomizedStateType.TYPE_C.name());\n+\n+    CustomizedStateConfig.Builder customizedStateConfigBuilder =\n+        new CustomizedStateConfig.Builder();\n+    customizedStateConfigBuilder.setAggregationEnabledTypes(customizedStateTypes);\n+    HelixDataAccessor accessor = _manager.getHelixDataAccessor();\n+    accessor.setProperty(accessor.keyBuilder().customizedStateConfig(),\n+        customizedStateConfigBuilder.build());\n+    _aggregationEnabledTypes.addAll(customizedStateTypes);\n+\n+    Map<PropertyType, List<String>> dataSource = new HashMap<>();\n+    dataSource.put(PropertyType.CUSTOMIZEDVIEW, customizedStateTypes);\n+    _routingTableProvider = new RoutingTableProvider(_spectator, dataSource);\n+    _routingTableProviderDataSources.addAll(customizedStateTypes);", "originalCommit": "eab24d34bed93791bbabf2cdb96c6b518370322b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk1OTQ5OQ==", "url": "https://github.com/apache/helix/pull/946#discussion_r406959499", "bodyText": "Good point. I added back two tests on this.", "author": "mgao0", "createdAt": "2020-04-10T21:53:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk1MDM3Mg=="}], "type": "inlineReview"}, {"oid": "2a942d8412e0374c8056105c0c0a67850fb36008", "url": "https://github.com/apache/helix/commit/2a942d8412e0374c8056105c0c0a67850fb36008", "message": "Test initialize routing table provider with different types", "committedDate": "2020-04-10T21:51:20Z", "type": "commit"}]}