{"pr_number": 1253, "pr_title": "Test routing data cache", "pr_createdAt": "2020-08-12T02:03:23Z", "pr_url": "https://github.com/apache/helix/pull/1253", "timeline": [{"oid": "2bea25eb79661f36a62b1b082b8dacc585f492a2", "url": "https://github.com/apache/helix/commit/2bea25eb79661f36a62b1b082b8dacc585f492a2", "message": "Fix flaky test TestRoutingDataCache", "committedDate": "2020-08-12T02:26:39Z", "type": "commit"}, {"oid": "2bea25eb79661f36a62b1b082b8dacc585f492a2", "url": "https://github.com/apache/helix/commit/2bea25eb79661f36a62b1b082b8dacc585f492a2", "message": "Fix flaky test TestRoutingDataCache", "committedDate": "2020-08-12T02:26:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA0Nzk3NA==", "url": "https://github.com/apache/helix/pull/1253#discussion_r469047974", "bodyText": "Good work!\nSince the original issue mentions that the instability is caused by a non-deterministic execution order of tests, should we add the dependsOnMethods annotation to enforce the order across different environments?", "author": "narendly", "createdAt": "2020-08-12T07:04:22Z", "path": "helix-core/src/test/java/org/apache/helix/spectator/TestRoutingDataCache.java", "diffHunk": "@@ -24,20 +24,21 @@\n import org.apache.helix.HelixConstants;\n import org.apache.helix.PropertyType;\n import org.apache.helix.TestHelper;\n-import org.apache.helix.zookeeper.datamodel.ZNRecord;\n import org.apache.helix.integration.common.ZkStandAloneCMTestBase;\n+import org.apache.helix.integration.manager.MockParticipantManager;\n import org.apache.helix.manager.zk.ZkBaseDataAccessor;\n import org.apache.helix.mock.MockZkHelixDataAccessor;\n import org.apache.helix.model.CurrentState;\n import org.apache.helix.tools.ClusterVerifiers.BestPossibleExternalViewVerifier;\n import org.apache.helix.tools.ClusterVerifiers.ZkHelixClusterVerifier;\n+import org.apache.helix.zookeeper.datamodel.ZNRecord;\n import org.testng.Assert;\n import org.testng.annotations.Test;\n \n public class TestRoutingDataCache extends ZkStandAloneCMTestBase {\n \n-  @Test()\n-  public void testUpdateOnNotification() throws Exception {\n+  @Test\n+  public void testUpdateOnNotification() {", "originalCommit": "2bea25eb79661f36a62b1b082b8dacc585f492a2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA2NDA0MQ==", "url": "https://github.com/apache/helix/pull/1253#discussion_r469064041", "bodyText": "I thought about it. But since testCurrentStatesSelectiveUpdate does not necessarily depend on the other two tests, adding dependsOnMethods may hide flaw of test. This test should be independent with other tests -- it should not change the global/parent states that may affect other tests -- it should restore the original states after the method.\nSo making it independent should be a better idea: no matter what the running order is, the tests should not fail.", "author": "huizhilu", "createdAt": "2020-08-12T07:36:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA0Nzk3NA=="}], "type": "inlineReview"}]}