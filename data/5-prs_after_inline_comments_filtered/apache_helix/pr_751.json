{"pr_number": 751, "pr_title": "Implement getAllMappingUnderPath and getMetadataStoreRealm", "pr_createdAt": "2020-02-11T19:09:26Z", "pr_url": "https://github.com/apache/helix/pull/751", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg0NDc0Mw==", "url": "https://github.com/apache/helix/pull/751#discussion_r377844743", "bodyText": "Nit: let's use NoSuchElementException to keep it consistent with other methods in MSD?", "author": "narendly", "createdAt": "2020-02-11T19:18:35Z", "path": "helix-rest/src/main/java/org/apache/helix/rest/metadatastore/ZkMetadataStoreDirectory.java", "diffHunk": "@@ -119,14 +119,20 @@ public ZkMetadataStoreDirectory(Map<String, String> routingZkAddressMap)\n \n   @Override\n   public Map<String, String> getAllMappingUnderPath(String namespace, String path) {\n-    // TODO: get it from routingData\n-    throw new UnsupportedOperationException();\n+    if (!_routingDataMap.containsKey(namespace)) {\n+      throw new IllegalArgumentException(\n+          \"Failed to get all mapping under path: Namespace \" + namespace + \" is not found!\");", "originalCommit": "d6b682cddff4bf4e8ca06e18a1b24402aee8d6d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg1MzE5MA==", "url": "https://github.com/apache/helix/pull/751#discussion_r377853190", "bodyText": "The other methods in MSD use IllegalArgumentException such as the exact same check in addMetadataStoreRealm", "author": "NealSun96", "createdAt": "2020-02-11T19:34:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg0NDc0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg3MjEyNQ==", "url": "https://github.com/apache/helix/pull/751#discussion_r377872125", "bodyText": "throw new NoSuchElementException(\"Namespace \" + namespace + \" does not exist!\");\n?\n\nFor read methods, please use NoSuchElement where appropriate.\nFor write methods, use IllegalArgument?", "author": "narendly", "createdAt": "2020-02-11T20:12:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg0NDc0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg5MjUzMw==", "url": "https://github.com/apache/helix/pull/751#discussion_r377892533", "bodyText": "I see what you mean. Agreed, changing.", "author": "NealSun96", "createdAt": "2020-02-11T20:54:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg0NDc0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg0NDg1Ng==", "url": "https://github.com/apache/helix/pull/751#discussion_r377844856", "bodyText": "NoSuchElementException", "author": "narendly", "createdAt": "2020-02-11T19:18:47Z", "path": "helix-rest/src/main/java/org/apache/helix/rest/metadatastore/ZkMetadataStoreDirectory.java", "diffHunk": "@@ -119,14 +119,20 @@ public ZkMetadataStoreDirectory(Map<String, String> routingZkAddressMap)\n \n   @Override\n   public Map<String, String> getAllMappingUnderPath(String namespace, String path) {\n-    // TODO: get it from routingData\n-    throw new UnsupportedOperationException();\n+    if (!_routingDataMap.containsKey(namespace)) {\n+      throw new IllegalArgumentException(\n+          \"Failed to get all mapping under path: Namespace \" + namespace + \" is not found!\");\n+    }\n+    return _routingDataMap.get(namespace).getAllMappingUnderPath(path);\n   }\n \n   @Override\n   public String getMetadataStoreRealm(String namespace, String shardingKey) {\n-    // TODO: get it from routingData\n-    throw new UnsupportedOperationException();\n+    if (!_routingDataMap.containsKey(namespace)) {\n+      throw new IllegalArgumentException(", "originalCommit": "d6b682cddff4bf4e8ca06e18a1b24402aee8d6d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg1MzQwMQ==", "url": "https://github.com/apache/helix/pull/751#discussion_r377853401", "bodyText": "Ditto above", "author": "NealSun96", "createdAt": "2020-02-11T19:34:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg0NDg1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg0NTEyMw==", "url": "https://github.com/apache/helix/pull/751#discussion_r377845123", "bodyText": "Should we fix this error message?", "author": "narendly", "createdAt": "2020-02-11T19:19:14Z", "path": "helix-rest/src/main/java/org/apache/helix/rest/metadatastore/ZkMetadataStoreDirectory.java", "diffHunk": "@@ -119,14 +119,20 @@ public ZkMetadataStoreDirectory(Map<String, String> routingZkAddressMap)\n \n   @Override\n   public Map<String, String> getAllMappingUnderPath(String namespace, String path) {\n-    // TODO: get it from routingData\n-    throw new UnsupportedOperationException();\n+    if (!_routingDataMap.containsKey(namespace)) {\n+      throw new IllegalArgumentException(\n+          \"Failed to get all mapping under path: Namespace \" + namespace + \" is not found!\");\n+    }\n+    return _routingDataMap.get(namespace).getAllMappingUnderPath(path);\n   }\n \n   @Override\n   public String getMetadataStoreRealm(String namespace, String shardingKey) {\n-    // TODO: get it from routingData\n-    throw new UnsupportedOperationException();\n+    if (!_routingDataMap.containsKey(namespace)) {\n+      throw new IllegalArgumentException(\n+          \"Failed to get all mapping under path: Namespace \" + namespace + \" is not found!\");", "originalCommit": "d6b682cddff4bf4e8ca06e18a1b24402aee8d6d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg1MzQ2OA==", "url": "https://github.com/apache/helix/pull/751#discussion_r377853468", "bodyText": "Sorry about that, will fix.", "author": "NealSun96", "createdAt": "2020-02-11T19:34:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg0NTEyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg0NTUxNg==", "url": "https://github.com/apache/helix/pull/751#discussion_r377845516", "bodyText": "Could we be more specific about this? What does it actually mean to have the routing data \"missing\"? Which ZNodes do not exist? Which fields do not exist?", "author": "narendly", "createdAt": "2020-02-11T19:20:01Z", "path": "helix-rest/src/main/java/org/apache/helix/rest/metadatastore/accessor/MetadataStoreRoutingDataReader.java", "diffHunk": "@@ -35,8 +35,7 @@\n    * @return a mapping from \"metadata store realm addresses\" to lists of \"metadata store sharding\n    *         keys\", where the sharding keys in a value list all route to the realm address in the\n    *         key\n-   * @throws InvalidRoutingDataException - when the routing data is malformed in any way that\n-   *           disallows a meaningful mapping to be returned\n+   * @throws InvalidRoutingDataException - when the routing data is missing", "originalCommit": "d6b682cddff4bf4e8ca06e18a1b24402aee8d6d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg1NDU5Mw==", "url": "https://github.com/apache/helix/pull/751#discussion_r377854593", "bodyText": "Zk vocabulary shouldn't be used here because this is a generic interface. I can rework the wording here, maybe just reverting to the original one because it's still true.", "author": "NealSun96", "createdAt": "2020-02-11T19:37:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg0NTUxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk1NzU5MQ==", "url": "https://github.com/apache/helix/pull/751#discussion_r377957591", "bodyText": "That's a good point. You could write that in \"ZK\"RoutingDataReader.", "author": "narendly", "createdAt": "2020-02-11T23:18:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg0NTUxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk5MDQ1Mw==", "url": "https://github.com/apache/helix/pull/751#discussion_r377990453", "bodyText": "Done.", "author": "NealSun96", "createdAt": "2020-02-12T01:07:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg0NTUxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg0NjY1MA==", "url": "https://github.com/apache/helix/pull/751#discussion_r377846650", "bodyText": "Nit: let's name our variables better.\nfor (String realmName : allRealmNames) {\nmight be a better pick?", "author": "narendly", "createdAt": "2020-02-11T19:22:05Z", "path": "helix-rest/src/main/java/org/apache/helix/rest/metadatastore/accessor/ZkRoutingDataReader.java", "diffHunk": "@@ -85,23 +85,14 @@ public ZkRoutingDataReader(String namespace, String zkAddress,\n           \"Routing data directory ZNode \" + MetadataStoreRoutingConstants.ROUTING_DATA_PATH\n               + \" does not exist. Routing ZooKeeper address: \" + _zkAddress);\n     }\n-    if (children == null || children.isEmpty()) {\n-      throw new InvalidRoutingDataException(\n-          \"There are no metadata store realms defined. Routing ZooKeeper address: \" + _zkAddress);\n-    }\n     for (String child : children) {", "originalCommit": "d6b682cddff4bf4e8ca06e18a1b24402aee8d6d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg1NDY3MQ==", "url": "https://github.com/apache/helix/pull/751#discussion_r377854671", "bodyText": "Agreed. Changing it.", "author": "NealSun96", "createdAt": "2020-02-11T19:37:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg0NjY1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg0NzA5Mw==", "url": "https://github.com/apache/helix/pull/751#discussion_r377847093", "bodyText": "If shardingKeys is empty, we should still return an empty list, correct? Otherwise the resulting map will be missing the entire realm, which would be incorrect.", "author": "narendly", "createdAt": "2020-02-11T19:22:52Z", "path": "helix-rest/src/main/java/org/apache/helix/rest/metadatastore/accessor/ZkRoutingDataReader.java", "diffHunk": "@@ -85,23 +85,14 @@ public ZkRoutingDataReader(String namespace, String zkAddress,\n           \"Routing data directory ZNode \" + MetadataStoreRoutingConstants.ROUTING_DATA_PATH\n               + \" does not exist. Routing ZooKeeper address: \" + _zkAddress);\n     }\n-    if (children == null || children.isEmpty()) {\n-      throw new InvalidRoutingDataException(\n-          \"There are no metadata store realms defined. Routing ZooKeeper address: \" + _zkAddress);\n-    }\n     for (String child : children) {\n       ZNRecord record =\n           _zkClient.readData(MetadataStoreRoutingConstants.ROUTING_DATA_PATH + \"/\" + child);\n       List<String> shardingKeys =\n           record.getListField(MetadataStoreRoutingConstants.ZNRECORD_LIST_FIELD_KEY);\n-      if (shardingKeys == null || shardingKeys.isEmpty()) {\n-        throw new InvalidRoutingDataException(\n-            \"Realm address ZNode \" + MetadataStoreRoutingConstants.ROUTING_DATA_PATH + \"/\" + child\n-                + \" does not have a value for key \"\n-                + MetadataStoreRoutingConstants.ZNRECORD_LIST_FIELD_KEY\n-                + \". Routing ZooKeeper address: \" + _zkAddress);\n+      if (shardingKeys != null && !shardingKeys.isEmpty()) {\n+        routingData.put(child, shardingKeys);", "originalCommit": "d6b682cddff4bf4e8ca06e18a1b24402aee8d6d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg1NzYxOA==", "url": "https://github.com/apache/helix/pull/751#discussion_r377857618", "bodyText": "My opinion is that if a realm doesn't have sharding keys, it shouldn't be a part of the routing data, because it isn't providing \"routing\". Although I can understand that whoever tries to get all routing data may get surprised if the realm disappears.\nIf we are adding empty lists, I would have to change the behavior here also: https://github.com/apache/helix/pull/731/files#diff-cd0252f86478a5ece76fb628cd7edbfcR170", "author": "NealSun96", "createdAt": "2020-02-11T19:42:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg0NzA5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkzODM0NQ==", "url": "https://github.com/apache/helix/pull/751#discussion_r377938345", "bodyText": "On a second thought, getAllMetadataStoreRealms is dependent on this. The behavior has to be changed then.", "author": "NealSun96", "createdAt": "2020-02-11T22:29:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg0NzA5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk2MDI2OQ==", "url": "https://github.com/apache/helix/pull/751#discussion_r377960269", "bodyText": "Do we need to add tests for the newly supported methods?", "author": "narendly", "createdAt": "2020-02-11T23:26:12Z", "path": "helix-rest/src/test/java/org/apache/helix/rest/metadatastore/accessor/TestZkRoutingDataReader.java", "diffHunk": "@@ -104,11 +104,10 @@ public void testGetRoutingDataMissingMSRDChildren() {\n     _baseAccessor.create(MetadataStoreRoutingConstants.ROUTING_DATA_PATH, new ZNRecord(\"test\"),\n         AccessOption.PERSISTENT);\n     try {\n-      _zkRoutingDataReader.getRoutingData();\n-      Assert.fail(\"Expecting InvalidRoutingDataException\");\n+      Map<String, List<String>> routingData = _zkRoutingDataReader.getRoutingData();", "originalCommit": "cca9d21bd2c56f36972400b78a5b6cfca95ac478", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk5MDU2Nw==", "url": "https://github.com/apache/helix/pull/751#discussion_r377990567", "bodyText": "Yes. I realized that the constructor was not populating _routingDataMap. That has been fixed.", "author": "NealSun96", "createdAt": "2020-02-12T01:08:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk2MDI2OQ=="}], "type": "inlineReview"}, {"oid": "4f2788a4c1d5ac9a564e8ef6250200b7db064477", "url": "https://github.com/apache/helix/commit/4f2788a4c1d5ac9a564e8ef6250200b7db064477", "message": "add test cases and fix constructor", "committedDate": "2020-02-12T17:37:45Z", "type": "forcePushed"}, {"oid": "1444e4c99ceb689798f2965373d52ff7d9acf42d", "url": "https://github.com/apache/helix/commit/1444e4c99ceb689798f2965373d52ff7d9acf42d", "message": "Implement getAllMappingUnderPath and getMetadataStoreRealm", "committedDate": "2020-02-12T18:06:01Z", "type": "commit"}, {"oid": "b46a2f57d76dfbb6d24327b005e29babc1765d07", "url": "https://github.com/apache/helix/commit/b46a2f57d76dfbb6d24327b005e29babc1765d07", "message": "Address comments", "committedDate": "2020-02-12T18:11:25Z", "type": "commit"}, {"oid": "7e52482491491715d886285192fb9083de6eaf03", "url": "https://github.com/apache/helix/commit/7e52482491491715d886285192fb9083de6eaf03", "message": "add test cases and fix constructor", "committedDate": "2020-02-12T18:11:38Z", "type": "commit"}, {"oid": "7e52482491491715d886285192fb9083de6eaf03", "url": "https://github.com/apache/helix/commit/7e52482491491715d886285192fb9083de6eaf03", "message": "add test cases and fix constructor", "committedDate": "2020-02-12T18:11:38Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ2OTMxOQ==", "url": "https://github.com/apache/helix/pull/751#discussion_r378469319", "bodyText": "Has this been formatted properly?", "author": "narendly", "createdAt": "2020-02-12T19:36:47Z", "path": "helix-rest/src/main/java/org/apache/helix/rest/metadatastore/accessor/ZkRoutingDataReader.java", "diffHunk": "@@ -36,8 +36,8 @@\n import org.apache.helix.zookeeper.zkclient.exception.ZkNoNodeException;\n import org.apache.zookeeper.Watcher;\n \n-\n-public class ZkRoutingDataReader implements MetadataStoreRoutingDataReader, IZkDataListener, IZkChildListener, IZkStateListener {\n+public class ZkRoutingDataReader\n+    implements MetadataStoreRoutingDataReader, IZkDataListener, IZkChildListener, IZkStateListener {", "originalCommit": "7e52482491491715d886285192fb9083de6eaf03", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ5MDM4NA==", "url": "https://github.com/apache/helix/pull/751#discussion_r378490384", "bodyText": "The previous formatting was not done by this PR. This is the result of using helix-style.xml to auto-format.\nNote: the previous formatting violates the first element in formatting guideline: the length exceeds 100 characters. (https://cwiki.apache.org/confluence/display/HELIX/Coding+Style)", "author": "NealSun96", "createdAt": "2020-02-12T20:18:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ2OTMxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODUyMjM0Ng==", "url": "https://github.com/apache/helix/pull/751#discussion_r378522346", "bodyText": "Turns out that the onboarding doc links to an incorrect coding style page. Correcting it.", "author": "NealSun96", "createdAt": "2020-02-12T21:27:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ2OTMxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ2OTQwNQ==", "url": "https://github.com/apache/helix/pull/751#discussion_r378469405", "bodyText": "Why does this keep changing?", "author": "narendly", "createdAt": "2020-02-12T19:36:59Z", "path": "helix-rest/src/main/java/org/apache/helix/rest/metadatastore/accessor/ZkRoutingDataReader.java", "diffHunk": "@@ -53,55 +53,45 @@ public ZkRoutingDataReader(String namespace, String zkAddress,\n       throw new IllegalArgumentException(\"Zk address cannot be null or empty!\");\n     }\n     _zkAddress = zkAddress;\n-    _zkClient = DedicatedZkClientFactory.getInstance()\n-        .buildZkClient(new HelixZkClient.ZkConnectionConfig(zkAddress),\n-            new HelixZkClient.ZkClientConfig().setZkSerializer(new ZNRecordSerializer()));\n+    _zkClient = DedicatedZkClientFactory.getInstance().buildZkClient(\n+        new HelixZkClient.ZkConnectionConfig(zkAddress),\n+        new HelixZkClient.ZkClientConfig().setZkSerializer(new ZNRecordSerializer()));", "originalCommit": "7e52482491491715d886285192fb9083de6eaf03", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ5MDcyMQ==", "url": "https://github.com/apache/helix/pull/751#discussion_r378490721", "bodyText": "Ditto above. I used helix-style.xml to format the entire file and this was changed. Not sure if it was formatted previously.", "author": "NealSun96", "createdAt": "2020-02-12T20:19:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ2OTQwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ1MzQ3MQ==", "url": "https://github.com/apache/helix/pull/751#discussion_r378453471", "bodyText": "Do you have latest helix-style-intellij.xml imported in your IDE? This format shouldn't be changed if you have the style import. It would be better to keep the original code that is not your change.", "author": "huizhilu", "createdAt": "2020-02-12T19:06:55Z", "path": "helix-rest/src/main/java/org/apache/helix/rest/metadatastore/accessor/ZkRoutingDataReader.java", "diffHunk": "@@ -36,8 +36,8 @@\n import org.apache.helix.zookeeper.zkclient.exception.ZkNoNodeException;\n import org.apache.zookeeper.Watcher;\n \n-\n-public class ZkRoutingDataReader implements MetadataStoreRoutingDataReader, IZkDataListener, IZkChildListener, IZkStateListener {\n+public class ZkRoutingDataReader\n+    implements MetadataStoreRoutingDataReader, IZkDataListener, IZkChildListener, IZkStateListener {", "originalCommit": "7e52482491491715d886285192fb9083de6eaf03", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ5MTgwMg==", "url": "https://github.com/apache/helix/pull/751#discussion_r378491802", "bodyText": "I'm using helix-style.xml as suggested by this doc: https://cwiki.apache.org/confluence/display/HELIX/Coding+Style . The linked doc come from https://iwww.corp.linkedin.com/wiki/cf/pages/viewpage.action?pageId=209597012 . helix-style-intellij.xml was not mentioned anywhere as far as I know.", "author": "NealSun96", "createdAt": "2020-02-12T20:22:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ1MzQ3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODUyMjQzMw==", "url": "https://github.com/apache/helix/pull/751#discussion_r378522433", "bodyText": "Turns out that the onboarding doc links to an incorrect coding style page. Correcting it.", "author": "NealSun96", "createdAt": "2020-02-12T21:28:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ1MzQ3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ3NzY1NQ==", "url": "https://github.com/apache/helix/pull/751#discussion_r378477655", "bodyText": "It seems quite several places use this concatenation MetadataStoreRoutingConstants.ROUTING_DATA_PATH + \"/\" + realmAddress. I suggest creating a static util method to build the path, which may look cleaner.", "author": "huizhilu", "createdAt": "2020-02-12T19:52:14Z", "path": "helix-rest/src/main/java/org/apache/helix/rest/metadatastore/accessor/ZkRoutingDataReader.java", "diffHunk": "@@ -53,55 +53,45 @@ public ZkRoutingDataReader(String namespace, String zkAddress,\n       throw new IllegalArgumentException(\"Zk address cannot be null or empty!\");\n     }\n     _zkAddress = zkAddress;\n-    _zkClient = DedicatedZkClientFactory.getInstance()\n-        .buildZkClient(new HelixZkClient.ZkConnectionConfig(zkAddress),\n-            new HelixZkClient.ZkClientConfig().setZkSerializer(new ZNRecordSerializer()));\n+    _zkClient = DedicatedZkClientFactory.getInstance().buildZkClient(\n+        new HelixZkClient.ZkConnectionConfig(zkAddress),\n+        new HelixZkClient.ZkClientConfig().setZkSerializer(new ZNRecordSerializer()));\n     _routingDataListener = routingDataListener;\n     if (_routingDataListener != null) {\n       // Subscribe child changes\n       _zkClient.subscribeChildChanges(MetadataStoreRoutingConstants.ROUTING_DATA_PATH, this);\n       // Subscribe data changes\n       for (String child : _zkClient.getChildren(MetadataStoreRoutingConstants.ROUTING_DATA_PATH)) {\n-        _zkClient\n-            .subscribeDataChanges(MetadataStoreRoutingConstants.ROUTING_DATA_PATH + \"/\" + child,\n-                this);\n+        _zkClient.subscribeDataChanges(\n+            MetadataStoreRoutingConstants.ROUTING_DATA_PATH + \"/\" + child, this);\n       }\n     }\n   }\n \n   /**\n    * Returns (realm, list of ZK path sharding keys) mappings.\n    * @return Map <realm, list of ZK path sharding keys>\n-   * @throws InvalidRoutingDataException\n+   * @throws InvalidRoutingDataException - when the node on\n+   *           MetadataStoreRoutingConstants.ROUTING_DATA_PATH is missing\n    */\n-  public Map<String, List<String>> getRoutingData()\n-      throws InvalidRoutingDataException {\n+  public Map<String, List<String>> getRoutingData() throws InvalidRoutingDataException {\n     Map<String, List<String>> routingData = new HashMap<>();\n-    List<String> children;\n+    List<String> allRealmAddresses;\n     try {\n-      children = _zkClient.getChildren(MetadataStoreRoutingConstants.ROUTING_DATA_PATH);\n+      allRealmAddresses = _zkClient.getChildren(MetadataStoreRoutingConstants.ROUTING_DATA_PATH);\n     } catch (ZkNoNodeException e) {\n       throw new InvalidRoutingDataException(\n           \"Routing data directory ZNode \" + MetadataStoreRoutingConstants.ROUTING_DATA_PATH\n               + \" does not exist. Routing ZooKeeper address: \" + _zkAddress);\n     }\n-    if (children == null || children.isEmpty()) {\n-      throw new InvalidRoutingDataException(\n-          \"There are no metadata store realms defined. Routing ZooKeeper address: \" + _zkAddress);\n-    }\n-    for (String child : children) {\n+    for (String realmAddress : allRealmAddresses) {\n       ZNRecord record =\n-          _zkClient.readData(MetadataStoreRoutingConstants.ROUTING_DATA_PATH + \"/\" + child);\n+          _zkClient.readData(MetadataStoreRoutingConstants.ROUTING_DATA_PATH + \"/\" + realmAddress);", "originalCommit": "7e52482491491715d886285192fb9083de6eaf03", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODUzMTY5Mw==", "url": "https://github.com/apache/helix/pull/751#discussion_r378531693", "bodyText": "This IMO is not significant enough to create a static method for. The logic is far too simple for a method to be created. If we have repeated occurrences of string-building such as MetadataStoreRoutingConstants.ROUTING_DATA_PATH + \"/\" + param1 + \"/\" + param2 + \"/\" + param3 then I agree it's necessary.", "author": "NealSun96", "createdAt": "2020-02-12T21:47:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ3NzY1NQ=="}], "type": "inlineReview"}, {"oid": "ce987902e6f478a768359b814ea69de81b016b76", "url": "https://github.com/apache/helix/commit/ce987902e6f478a768359b814ea69de81b016b76", "message": "fix formatting", "committedDate": "2020-02-12T21:41:54Z", "type": "commit"}]}