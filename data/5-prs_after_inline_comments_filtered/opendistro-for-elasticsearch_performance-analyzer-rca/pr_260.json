{"pr_number": 260, "pr_title": "Decision Maker Skeleton", "pr_createdAt": "2020-06-29T08:51:20Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzgzNDIwOA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r447834208", "bodyText": "should we rename this enum to something like \"ResourceVector\" ? we already have a Resource class defined in protobuf", "author": "rguo-aws", "createdAt": "2020-06-30T16:51:52Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/actions/ImpactVector.java", "diffHunk": "@@ -0,0 +1,51 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+public class ImpactVector {\n+\n+    public enum Resource {", "originalCommit": "a2f4f3f6d3484df9117a0130ff2704cb81423cdb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODA2NTkwNw==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r448065907", "bodyText": "Renamed to Dimension", "author": "vigyasharma", "createdAt": "2020-07-01T01:27:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzgzNDIwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzgzNTU2Ng==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r447835566", "bodyText": "rename this variable to \"COOL_OFF_PERIOD_IN_SECOND\" ?", "author": "rguo-aws", "createdAt": "2020-06-30T16:53:57Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/actions/QueueCapacity.java", "diffHunk": "@@ -0,0 +1,106 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.metrics.AllMetrics.ThreadPoolType;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.rca.cluster.NodeKey;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Resource.CPU;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Resource.HEAP;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Resource.NETWORK;\n+\n+public class QueueCapacity implements Action {\n+\n+    public static final String NAME = \"queue_capacity\";\n+    public static final int COOL_OFF_PERIOD = 300;", "originalCommit": "a2f4f3f6d3484df9117a0130ff2704cb81423cdb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzg0MTQyOQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r447841429", "bodyText": "is there any specific reason to override this method ? The default implementation is to return getClass().getSimpleName() which will return \"QueueHealthDecider\" if called from this class.", "author": "rguo-aws", "createdAt": "2020-06-30T17:02:52Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciders/QueueHealthDecider.java", "diffHunk": "@@ -0,0 +1,122 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.Action;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.QueueCapacity;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.metrics.AllMetrics;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.metrics.AllMetrics.ThreadPoolType;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.flow_units.ResourceFlowUnit;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.summaries.HotClusterSummary;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.summaries.HotNodeSummary;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.summaries.HotResourceSummary;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.rca.cluster.NodeKey;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.rca.cluster.QueueRejectionClusterRca;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+// This is a sample decider implementation to finalize decision maker interfaces.\n+// TODO: 1. Get threadpool type from HotNodeSummary or HotResourceSummary\n+// TODO: 2. Read action priorities from a configurable yml\n+// TODO: 3. Read current queue capacity from NodeConfigurationRca (PR #252)\n+// TODO: 4. Add unit tests\n+\n+public class QueueHealthDecider extends Decider {\n+\n+    public static String NAME = \"queue_health\";\n+\n+    private QueueRejectionClusterRca queueRejectionRca;\n+    List<String> actionsByUserPriority = new ArrayList<>();\n+    private int counter = 0;\n+\n+    public QueueHealthDecider(long evalIntervalSeconds, int decisionFrequency, QueueRejectionClusterRca queueRejectionClusterRca) {\n+        // TODO: Also consume NodeConfigurationRca\n+        super(evalIntervalSeconds, decisionFrequency);\n+        this.queueRejectionRca = queueRejectionClusterRca;\n+        configureActionPriority();\n+    }\n+\n+    @Override\n+    public String name() {", "originalCommit": "a2f4f3f6d3484df9117a0130ff2704cb81423cdb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODA2Njk0MQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r448066941", "bodyText": "If we maintain a registry of all graph objects going forward, to allow a refactor as well as pluggable graph nodes, then the public static NAME field will serve as a key. For comparisons in that case, each node should return their NAME variable in name(). Hence the override", "author": "vigyasharma", "createdAt": "2020-07-01T01:31:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzg0MTQyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzg0OTczOQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r447849739", "bodyText": "maybe we can create a dedicated EmptyFlowUnit for the top level vertex in graph ?", "author": "rguo-aws", "createdAt": "2020-06-30T17:15:41Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciders/Publisher.java", "diffHunk": "@@ -0,0 +1,64 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.Action;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.grpc.FlowUnitMessage;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.core.GenericFlowUnit;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.core.NonLeafNode;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.scheduler.FlowUnitOperationArgWrapper;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+public class Publisher extends NonLeafNode<GenericFlowUnit> {\n+\n+    private static final Logger LOG = LogManager.getLogger(Publisher.class);\n+\n+    private Collator collator;\n+    private boolean isMuted = false;\n+\n+    public Publisher(int evalIntervalSeconds, Collator collator) {\n+        super(0, evalIntervalSeconds);\n+        this.collator = collator;\n+    }\n+\n+    @Override\n+    public GenericFlowUnit operate() {", "originalCommit": "a2f4f3f6d3484df9117a0130ff2704cb81423cdb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODA2NzE0Mg==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r448067142", "bodyText": "I'm of split opinion here, but created one so as to explicitly identify the terminal node.", "author": "vigyasharma", "createdAt": "2020-07-01T01:32:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzg0OTczOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUzNjczOA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r448536738", "bodyText": "let's add the copyright header on top of each newly created file", "author": "rguo-aws", "createdAt": "2020-07-01T18:14:55Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/actions/Action.java", "diffHunk": "@@ -0,0 +1,39 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions;", "originalCommit": "95df5fae2b561ebc7c300292e32e200cc7b4af2d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY4OTUwMg==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r448689502", "bodyText": "maybe we can replace the word pressure with impact ?\nBut as the enum is already named Impact, we can just remove it altogether", "author": "yojs", "createdAt": "2020-07-02T00:52:54Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/actions/ImpactVector.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+public class ImpactVector {\n+\n+  public enum Dimension {\n+    HEAP,\n+    CPU,\n+    RAM,\n+    DISK,\n+    NETWORK\n+  }\n+\n+  public enum Impact {\n+    NO_IMPACT,\n+    INCREASES_PRESSURE,", "originalCommit": "38c22799d7089e4ab14f8951eca154a57713d234", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTcwNTk0MA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r449705940", "bodyText": "I wanted to remove the ambiguity around whether it increases pressure (consumes more resource) or increases available resource (frees up the resource).\ne.g. HEAP, INCREASES may imply it increases the overall available heap on the node.", "author": "vigyasharma", "createdAt": "2020-07-03T21:21:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY4OTUwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY4OTg1MA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r448689850", "bodyText": "Maybe we can return an unmodifyable map ?", "author": "yojs", "createdAt": "2020-07-02T00:54:31Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/actions/ImpactVector.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+public class ImpactVector {\n+\n+  public enum Dimension {\n+    HEAP,\n+    CPU,\n+    RAM,\n+    DISK,\n+    NETWORK\n+  }\n+\n+  public enum Impact {\n+    NO_IMPACT,\n+    INCREASES_PRESSURE,\n+    DECREASES_PRESSURE\n+  }\n+\n+  private Map<Dimension, Impact> impactMap = new HashMap<>();\n+\n+  public ImpactVector() {\n+    for (Dimension d : Dimension.values()) {\n+      impactMap.put(d, Impact.NO_IMPACT);\n+    }\n+  }\n+\n+  public Map<Dimension, Impact> getImpact() {\n+    return impactMap;", "originalCommit": "38c22799d7089e4ab14f8951eca154a57713d234", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY5MTA5Ng==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r448691096", "bodyText": "Do you think Action should be something like ChangeQueueCapacity ?", "author": "yojs", "createdAt": "2020-07-02T00:59:01Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/actions/QueueCapacity.java", "diffHunk": "@@ -0,0 +1,135 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions;\n+\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.CPU;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.HEAP;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.NETWORK;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.grpc.ThreadPoolEnum;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.rca.cluster.NodeKey;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+public class QueueCapacity implements Action {", "originalCommit": "38c22799d7089e4ab14f8951eca154a57713d234", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTcwNjM5Nw==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r449706397", "bodyText": "My initial thoughts were that the prefix verb will be same across many actions. Most of them will be Change* or Modify* (except moveShard etc actions), which seemed redundant. But it does sound more complete, so we can change it.", "author": "vigyasharma", "createdAt": "2020-07-03T21:24:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY5MTA5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY5MTYxMQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r448691611", "bodyText": "Do we want to make it configurable ?", "author": "yojs", "createdAt": "2020-07-02T01:00:49Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/actions/QueueCapacity.java", "diffHunk": "@@ -0,0 +1,135 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions;\n+\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.CPU;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.HEAP;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.NETWORK;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.grpc.ThreadPoolEnum;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.rca.cluster.NodeKey;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+public class QueueCapacity implements Action {\n+\n+  public static final String NAME = \"queue_capacity\";\n+  public static final int COOL_OFF_PERIOD_IN_SECONDS = 300;", "originalCommit": "38c22799d7089e4ab14f8951eca154a57713d234", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTcyNjMwMg==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r449726302", "bodyText": "This timeout is independent of its calling function, so we shouldn't need it configurable via callers. Did you mean reading and setting this value from rca.conf? I'm not sure if we'll want to edit this at runtime (maybe we can make that change when we add rca.conf integration to this class, or if we see a need later).", "author": "vigyasharma", "createdAt": "2020-07-04T01:13:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY5MTYxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ4NjA1MA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r450486050", "bodyText": "Ya, I meant it reading from rca.conf. If you want to do an A/B test to come up with optimal value, keeping it configurable might help. Otherwise, we will have to deploy jars with the changes.", "author": "yojs", "createdAt": "2020-07-06T21:20:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY5MTYxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY5Nzc5OA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r450697798", "bodyText": "Let's discuss and track this separately. If needed, we can add this along with the other rca.conf integrations which are pending.", "author": "vigyasharma", "createdAt": "2020-07-07T08:32:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY5MTYxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY5NDA2Mw==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r448694063", "bodyText": "Is it true that increasing the queue capacity will increase the CPU load ? You mean for CPU bound processing of queue items ?", "author": "yojs", "createdAt": "2020-07-02T01:10:42Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/actions/QueueCapacity.java", "diffHunk": "@@ -0,0 +1,135 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions;\n+\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.CPU;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.HEAP;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.NETWORK;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.grpc.ThreadPoolEnum;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.rca.cluster.NodeKey;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+public class QueueCapacity implements Action {\n+\n+  public static final String NAME = \"queue_capacity\";\n+  public static final int COOL_OFF_PERIOD_IN_SECONDS = 300;\n+\n+  private int currentCapacity;\n+  private int desiredCapacity;\n+  private ThreadPoolEnum threadPool;\n+  private NodeKey esNode;\n+\n+  private Map<ThreadPoolEnum, Integer> lowerBound = new HashMap<>();\n+  private Map<ThreadPoolEnum, Integer> upperBound = new HashMap<>();\n+\n+  public QueueCapacity(NodeKey esNode, ThreadPoolEnum threadPool, int currentCapacity, boolean increase) {\n+    setBounds();\n+    int STEP_SIZE = 50;\n+    this.esNode = esNode;\n+    this.threadPool = threadPool;\n+    this.currentCapacity = currentCapacity;\n+    int desiredCapacity = increase ? currentCapacity + STEP_SIZE : currentCapacity - STEP_SIZE;\n+    setDesiredCapacity(desiredCapacity);\n+  }\n+\n+  @Override\n+  public String name() {\n+    return NAME;\n+  }\n+\n+  @Override\n+  public boolean isActionable() {\n+    return desiredCapacity != currentCapacity;\n+  }\n+\n+  @Override\n+  public int coolOffPeriodInSeconds() {\n+    return COOL_OFF_PERIOD_IN_SECONDS;\n+  }\n+\n+  @Override\n+  public List<NodeKey> impactedNodes() {\n+    return Collections.singletonList(esNode);\n+  }\n+\n+  @Override\n+  public Map<NodeKey, ImpactVector> impact() {\n+    ImpactVector impactVector = new ImpactVector();\n+    if (desiredCapacity > currentCapacity) {\n+      impactVector.increasesPressure(HEAP, CPU, NETWORK);", "originalCommit": "38c22799d7089e4ab14f8951eca154a57713d234", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTcyNDMzOA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r449724338", "bodyText": "Since it increases throughput, I think it would increase the CPU load.\nCPU ends up doing more amortized work per unit time. Bursty requests that would've otherwise been rejected and retried, are now accepted by the larger queue and processed; making cpu less idle and increasing throughput.", "author": "vigyasharma", "createdAt": "2020-07-04T00:41:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY5NDA2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ4ODc1Nw==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r450488757", "bodyText": "Sorry about that, my point was because this is a PR for the framework, I am suggesting that what the decider predicts about resource usage might be taken as a hint and not as a definitive statement.\nBut I guess, this can be a future improvement for the learning system.", "author": "yojs", "createdAt": "2020-07-06T21:26:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY5NDA2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY5NTY4NQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r448695685", "bodyText": "Should we add the unit to the variable name ?", "author": "yojs", "createdAt": "2020-07-02T01:17:30Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciders/Collator.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+\n+/**\n+ * Collator collects and prunes the candidate decisions from each decider so that their impacts are\n+ * aligned\n+ *\n+ * <p>Decisions can increase or decrease pressure on different key resources on an Elasticearch\n+ * node. This is encapsulated in each Action via the {@link ImpactVector}. Since each decider\n+ * independently evaluates its decision, it is possible to have conflicting ImpactVectors from\n+ * actions across deciders.\n+ *\n+ * <p>The collator prunes them to ensure we only take actions that either increase, or decrease\n+ * pressure on a particular node. To resolve conflicts, we prefer stability over performance.\n+ */\n+public class Collator extends Decider {\n+\n+  public static final String NAME = \"collator\";\n+\n+  /* Deciders can choose to publish decisions at different frequencies based on the\n+   * type of resources monitored and rca signals. The collator should however, not introduce any\n+   * unnecessary delays. As soon as a decision is taken, it should be evaluated and published downstream.\n+   */\n+  private static final int collatorFrequency = 1;", "originalCommit": "38c22799d7089e4ab14f8951eca154a57713d234", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4802b2baaeb1eefad7a3223e2e01ba6f88a97325", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/4802b2baaeb1eefad7a3223e2e01ba6f88a97325", "message": "Initial action template and queue capacity action", "committedDate": "2020-07-04T00:57:33Z", "type": "commit"}, {"oid": "79cf74bc3ffce51a7e89c1b5dc43966f48833d46", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/79cf74bc3ffce51a7e89c1b5dc43966f48833d46", "message": "Add generic decider skeleton in base class", "committedDate": "2020-07-04T00:57:33Z", "type": "commit"}, {"oid": "41d50a47b215ceeee0e327b7a155639dbe20e57d", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/41d50a47b215ceeee0e327b7a155639dbe20e57d", "message": "WIP - Queue Health Decider", "committedDate": "2020-07-04T00:57:33Z", "type": "commit"}, {"oid": "80cab81892aab9638ef71ef11f988d9a6f4191d7", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/80cab81892aab9638ef71ef11f988d9a6f4191d7", "message": "Added queue health decider. Tests pending", "committedDate": "2020-07-04T00:57:33Z", "type": "commit"}, {"oid": "239dee69abe1cd527ab35765f6dc74022e6fc61b", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/239dee69abe1cd527ab35765f6dc74022e6fc61b", "message": "Add pass-through collator implementation", "committedDate": "2020-07-04T00:57:33Z", "type": "commit"}, {"oid": "5143f4a0208f19b0207032d2821e104ee8c7d541", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/5143f4a0208f19b0207032d2821e104ee8c7d541", "message": "Add pass-through publisher", "committedDate": "2020-07-04T00:57:33Z", "type": "commit"}, {"oid": "3c7c4666a4f814d3e756d1a8298ef32df5e2ce21", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/3c7c4666a4f814d3e756d1a8298ef32df5e2ce21", "message": "Apply code styling guide", "committedDate": "2020-07-04T00:57:33Z", "type": "commit"}, {"oid": "2015d6925d59862a8b1efdf16b26967722245474", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/2015d6925d59862a8b1efdf16b26967722245474", "message": "Add UTs for actions", "committedDate": "2020-07-04T00:57:33Z", "type": "commit"}, {"oid": "6de90a2f217c275c30cec71cab4a5af522cb27ff", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/6de90a2f217c275c30cec71cab4a5af522cb27ff", "message": "Added queue health decider tests", "committedDate": "2020-07-04T00:57:33Z", "type": "commit"}, {"oid": "0e289abf5e9342e876bc925f0f06067f8f84d40d", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/0e289abf5e9342e876bc925f0f06067f8f84d40d", "message": "Add EmptyFlowUnit for Publisher", "committedDate": "2020-07-04T00:57:33Z", "type": "commit"}, {"oid": "bb0b05c6d486b30a8d11ca9e2297b80f6aab6dd5", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/bb0b05c6d486b30a8d11ca9e2297b80f6aab6dd5", "message": "Rename resource to dimension in ImpactVector", "committedDate": "2020-07-04T00:57:33Z", "type": "commit"}, {"oid": "bf83e723fb70deba535f26f83035e7977f626009", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/bf83e723fb70deba535f26f83035e7977f626009", "message": "Rename cool off period variable", "committedDate": "2020-07-04T00:57:33Z", "type": "commit"}, {"oid": "9bd74a2c319b3bbc95b6e2735e9c99e53b161adf", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/9bd74a2c319b3bbc95b6e2735e9c99e53b161adf", "message": "Styling changes as per checkstyle", "committedDate": "2020-07-04T00:57:33Z", "type": "commit"}, {"oid": "0865ba6158c86521fd382a2f11871d83b094b852", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/0865ba6158c86521fd382a2f11871d83b094b852", "message": "Fix spotbugs", "committedDate": "2020-07-04T00:57:33Z", "type": "commit"}, {"oid": "87e519f80f6f158fd7d0751afcc0acda89aa7ffa", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/87e519f80f6f158fd7d0751afcc0acda89aa7ffa", "message": "Add license headers", "committedDate": "2020-07-04T00:57:33Z", "type": "commit"}, {"oid": "68eecf82da34cecca9e5dc057a4c7d91d139d481", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/68eecf82da34cecca9e5dc057a4c7d91d139d481", "message": "Update as per new proto buf changes", "committedDate": "2020-07-04T00:58:11Z", "type": "commit"}, {"oid": "3d19fc4b5daf0f521aa968635bd19d2acba6b2f5", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/3d19fc4b5daf0f521aa968635bd19d2acba6b2f5", "message": "PR comments", "committedDate": "2020-07-04T01:19:27Z", "type": "commit"}, {"oid": "3d19fc4b5daf0f521aa968635bd19d2acba6b2f5", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/3d19fc4b5daf0f521aa968635bd19d2acba6b2f5", "message": "PR comments", "committedDate": "2020-07-04T01:19:27Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTczNTk2MQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r449735961", "bodyText": "it may be ok for the first cut, but we may have to make this param configurable for different actions", "author": "sendkb", "createdAt": "2020-07-04T03:58:06Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/actions/ModifyQueueCapacityAction.java", "diffHunk": "@@ -0,0 +1,135 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions;\n+\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.CPU;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.HEAP;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.NETWORK;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.grpc.ResourceEnum;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.rca.cluster.NodeKey;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+public class ModifyQueueCapacityAction implements Action {\n+\n+  public static final String NAME = \"modify_queue_capacity\";\n+  public static final int COOL_OFF_PERIOD_IN_SECONDS = 300;", "originalCommit": "3d19fc4b5daf0f521aa968635bd19d2acba6b2f5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk4Nzc0MA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r449987740", "bodyText": "Its not clear what we mean by configurable here -\n\n\nConfigurable across different instances of ModifyQueueCapacityAction ?\nI think it would be the same for a particular type of action, we would want to wait x amount of time when modifying queues. Possibly different wait times for increase v/s decrease queue capacity, but that logic (waiting for queue drain out) can lie within coolOffPeriodInSeconds(). I'm not sure why different instances of ModifyQueueCapacityAction will need different cool off periods.\n\n\nConfigurable across different types of action, like modifyCacheBound/modifyQueueCapacity etc. -\nEach such action class will have its own cool off period defined.\n\n\nConfigurable via rca.conf -\nWe can add this logic in coolOffPeriodInSeconds when needed, but I'm still skeptical if we want to add another knob in rca.conf. It gets hard to manually maintain all these configurations. Instead, the function might return a cool off based on some calculations, like cool off for moveShard may depend on shard size and recovery speed configured, rather than a manual setting per cluster.", "author": "vigyasharma", "createdAt": "2020-07-06T05:16:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTczNTk2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTczNTk3OA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r449735978", "bodyText": "nit: 'No Queue action to take'", "author": "sendkb", "createdAt": "2020-07-04T03:59:10Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/actions/ModifyQueueCapacityAction.java", "diffHunk": "@@ -0,0 +1,135 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions;\n+\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.CPU;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.HEAP;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.NETWORK;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.grpc.ResourceEnum;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.rca.cluster.NodeKey;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+public class ModifyQueueCapacityAction implements Action {\n+\n+  public static final String NAME = \"modify_queue_capacity\";\n+  public static final int COOL_OFF_PERIOD_IN_SECONDS = 300;\n+\n+  private int currentCapacity;\n+  private int desiredCapacity;\n+  private ResourceEnum threadPool;\n+  private NodeKey esNode;\n+\n+  private Map<ResourceEnum, Integer> lowerBound = new HashMap<>();\n+  private Map<ResourceEnum, Integer> upperBound = new HashMap<>();\n+\n+  public ModifyQueueCapacityAction(NodeKey esNode, ResourceEnum threadPool, int currentCapacity, boolean increase) {\n+    setBounds();\n+    int STEP_SIZE = 50;\n+    this.esNode = esNode;\n+    this.threadPool = threadPool;\n+    this.currentCapacity = currentCapacity;\n+    int desiredCapacity = increase ? currentCapacity + STEP_SIZE : currentCapacity - STEP_SIZE;\n+    setDesiredCapacity(desiredCapacity);\n+  }\n+\n+  @Override\n+  public String name() {\n+    return NAME;\n+  }\n+\n+  @Override\n+  public boolean isActionable() {\n+    return desiredCapacity != currentCapacity;\n+  }\n+\n+  @Override\n+  public int coolOffPeriodInSeconds() {\n+    return COOL_OFF_PERIOD_IN_SECONDS;\n+  }\n+\n+  @Override\n+  public List<NodeKey> impactedNodes() {\n+    return Collections.singletonList(esNode);\n+  }\n+\n+  @Override\n+  public Map<NodeKey, ImpactVector> impact() {\n+    ImpactVector impactVector = new ImpactVector();\n+    if (desiredCapacity > currentCapacity) {\n+      impactVector.increasesPressure(HEAP, CPU, NETWORK);\n+    } else if (desiredCapacity < currentCapacity) {\n+      impactVector.decreasesPressure(HEAP, CPU, NETWORK);\n+    }\n+    return Collections.singletonMap(esNode, impactVector);\n+  }\n+\n+  @Override\n+  public void execute() {\n+    // Making this a no-op for now\n+    // TODO: Modify based on downstream agent API calls\n+    assert true;\n+  }\n+\n+  @Override\n+  public String summary() {\n+    if (!isActionable()) {\n+      return \"No action to take\";", "originalCommit": "3d19fc4b5daf0f521aa968635bd19d2acba6b2f5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTczNjEzMA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r449736130", "bodyText": "nit: all license headers should have 2020 as the year", "author": "sendkb", "createdAt": "2020-07-04T04:01:19Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/actions/Action.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.", "originalCommit": "3d19fc4b5daf0f521aa968635bd19d2acba6b2f5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTczNjIyNw==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r449736227", "bodyText": "we only consider increase or decrease of queue resources here. Is it safe to assume that an obj will not be created at all if there is no change in values ?", "author": "sendkb", "createdAt": "2020-07-04T04:02:53Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/actions/ModifyQueueCapacityAction.java", "diffHunk": "@@ -0,0 +1,135 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions;\n+\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.CPU;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.HEAP;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.NETWORK;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.grpc.ResourceEnum;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.rca.cluster.NodeKey;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+public class ModifyQueueCapacityAction implements Action {\n+\n+  public static final String NAME = \"modify_queue_capacity\";\n+  public static final int COOL_OFF_PERIOD_IN_SECONDS = 300;\n+\n+  private int currentCapacity;\n+  private int desiredCapacity;\n+  private ResourceEnum threadPool;\n+  private NodeKey esNode;\n+\n+  private Map<ResourceEnum, Integer> lowerBound = new HashMap<>();\n+  private Map<ResourceEnum, Integer> upperBound = new HashMap<>();\n+\n+  public ModifyQueueCapacityAction(NodeKey esNode, ResourceEnum threadPool, int currentCapacity, boolean increase) {\n+    setBounds();\n+    int STEP_SIZE = 50;\n+    this.esNode = esNode;\n+    this.threadPool = threadPool;\n+    this.currentCapacity = currentCapacity;\n+    int desiredCapacity = increase ? currentCapacity + STEP_SIZE : currentCapacity - STEP_SIZE;", "originalCommit": "3d19fc4b5daf0f521aa968635bd19d2acba6b2f5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk5MTk2NQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r449991965", "bodyText": "Actions are created by deciders only when they need to be triggered, and they always do something; hence the assumption.", "author": "vigyasharma", "createdAt": "2020-07-06T05:33:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTczNjIyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUwMjMyMQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r450502321", "bodyText": "These are good points. We should add them to the class level javadoc", "author": "yojs", "createdAt": "2020-07-06T22:00:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTczNjIyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTczNjUyNA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r449736524", "bodyText": "minor: the two lines can be simplified into a single one. Change it if you think the readability is not affected\nMath.min(Math.max(desiredCapacity, lowerBound.get(threadPool)), upperBound.get(threadPool))", "author": "sendkb", "createdAt": "2020-07-04T04:07:59Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/actions/ModifyQueueCapacityAction.java", "diffHunk": "@@ -0,0 +1,135 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions;\n+\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.CPU;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.HEAP;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.NETWORK;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.grpc.ResourceEnum;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.rca.cluster.NodeKey;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+public class ModifyQueueCapacityAction implements Action {\n+\n+  public static final String NAME = \"modify_queue_capacity\";\n+  public static final int COOL_OFF_PERIOD_IN_SECONDS = 300;\n+\n+  private int currentCapacity;\n+  private int desiredCapacity;\n+  private ResourceEnum threadPool;\n+  private NodeKey esNode;\n+\n+  private Map<ResourceEnum, Integer> lowerBound = new HashMap<>();\n+  private Map<ResourceEnum, Integer> upperBound = new HashMap<>();\n+\n+  public ModifyQueueCapacityAction(NodeKey esNode, ResourceEnum threadPool, int currentCapacity, boolean increase) {\n+    setBounds();\n+    int STEP_SIZE = 50;\n+    this.esNode = esNode;\n+    this.threadPool = threadPool;\n+    this.currentCapacity = currentCapacity;\n+    int desiredCapacity = increase ? currentCapacity + STEP_SIZE : currentCapacity - STEP_SIZE;\n+    setDesiredCapacity(desiredCapacity);\n+  }\n+\n+  @Override\n+  public String name() {\n+    return NAME;\n+  }\n+\n+  @Override\n+  public boolean isActionable() {\n+    return desiredCapacity != currentCapacity;\n+  }\n+\n+  @Override\n+  public int coolOffPeriodInSeconds() {\n+    return COOL_OFF_PERIOD_IN_SECONDS;\n+  }\n+\n+  @Override\n+  public List<NodeKey> impactedNodes() {\n+    return Collections.singletonList(esNode);\n+  }\n+\n+  @Override\n+  public Map<NodeKey, ImpactVector> impact() {\n+    ImpactVector impactVector = new ImpactVector();\n+    if (desiredCapacity > currentCapacity) {\n+      impactVector.increasesPressure(HEAP, CPU, NETWORK);\n+    } else if (desiredCapacity < currentCapacity) {\n+      impactVector.decreasesPressure(HEAP, CPU, NETWORK);\n+    }\n+    return Collections.singletonMap(esNode, impactVector);\n+  }\n+\n+  @Override\n+  public void execute() {\n+    // Making this a no-op for now\n+    // TODO: Modify based on downstream agent API calls\n+    assert true;\n+  }\n+\n+  @Override\n+  public String summary() {\n+    if (!isActionable()) {\n+      return \"No action to take\";\n+    }\n+    return String.format(\"Update [%s] queue capacity from [%d] to [%d] on node [%s]\",\n+        threadPool.toString(), currentCapacity, desiredCapacity, esNode.getNodeId());\n+  }\n+\n+  @Override\n+  public String toString() {\n+    return summary();\n+  }\n+\n+  private void setBounds() {\n+    // This is intentionally not made static because different nodes can\n+    // have different bounds based on instance types\n+    // TODO: Move configuration values to rca.conf\n+\n+    // Write thread pool for bulk write requests\n+    this.lowerBound.put(ResourceEnum.WRITE_THREADPOOL, 100);\n+    this.upperBound.put(ResourceEnum.WRITE_THREADPOOL, 1000);\n+\n+    // Search thread pool\n+    this.lowerBound.put(ResourceEnum.SEARCH_THREADPOOL, 1000);\n+    this.upperBound.put(ResourceEnum.SEARCH_THREADPOOL, 3000);\n+  }\n+\n+  private void setDesiredCapacity(int desiredCapacity) {\n+    this.desiredCapacity = Math.min(desiredCapacity, upperBound.get(threadPool));", "originalCommit": "3d19fc4b5daf0f521aa968635bd19d2acba6b2f5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "549b3f0906567ca92a2b9aff4237dbe9dc1693ca", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/549b3f0906567ca92a2b9aff4237dbe9dc1693ca", "message": "Updated year in license header and addressed other minor comments", "committedDate": "2020-07-06T05:34:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ5MDgzOA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r450490838", "bodyText": "Do we have a particular reason for not initializing this in the constructor ?", "author": "yojs", "createdAt": "2020-07-06T21:31:55Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/actions/ImpactVector.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+public class ImpactVector {\n+\n+  public enum Dimension {\n+    HEAP,\n+    CPU,\n+    RAM,\n+    DISK,\n+    NETWORK\n+  }\n+\n+  public enum Impact {\n+    NO_IMPACT,\n+    INCREASES_PRESSURE,\n+    DECREASES_PRESSURE\n+  }\n+\n+  private Map<Dimension, Impact> impactMap = new HashMap<>();", "originalCommit": "549b3f0906567ca92a2b9aff4237dbe9dc1693ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ5Mjg4Ng==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r450492886", "bodyText": "The size of this map is fixed, it will always hold values as the elements in the Dimension enum. Do we want to make it an array and access the impact of each dimension by the ordinal of the enum ?", "author": "yojs", "createdAt": "2020-07-06T21:36:40Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/actions/ImpactVector.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+public class ImpactVector {\n+\n+  public enum Dimension {\n+    HEAP,\n+    CPU,\n+    RAM,\n+    DISK,\n+    NETWORK\n+  }\n+\n+  public enum Impact {\n+    NO_IMPACT,\n+    INCREASES_PRESSURE,\n+    DECREASES_PRESSURE\n+  }\n+\n+  private Map<Dimension, Impact> impactMap = new HashMap<>();", "originalCommit": "549b3f0906567ca92a2b9aff4237dbe9dc1693ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUwMDYwNg==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r450500606", "bodyText": "It might be good to add javadoc comments for this class ?", "author": "yojs", "createdAt": "2020-07-06T21:56:48Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/actions/ModifyQueueCapacityAction.java", "diffHunk": "@@ -0,0 +1,134 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions;\n+\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.CPU;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.HEAP;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.NETWORK;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.grpc.ResourceEnum;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.rca.cluster.NodeKey;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+public class ModifyQueueCapacityAction implements Action {", "originalCommit": "549b3f0906567ca92a2b9aff4237dbe9dc1693ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUwMTYzOA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r450501638", "bodyText": "Do we want to make it a class level constant ? Also do we want to make it configurable through rca.conf ?\nWe might want to play with faster increases and decreases, right ? If you agree, we can also make it an enhancement issues to comeback to it later ..", "author": "yojs", "createdAt": "2020-07-06T21:59:14Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/actions/ModifyQueueCapacityAction.java", "diffHunk": "@@ -0,0 +1,134 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions;\n+\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.CPU;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.HEAP;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.NETWORK;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.grpc.ResourceEnum;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.rca.cluster.NodeKey;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+public class ModifyQueueCapacityAction implements Action {\n+\n+  public static final String NAME = \"modify_queue_capacity\";\n+  public static final int COOL_OFF_PERIOD_IN_SECONDS = 300;\n+\n+  private int currentCapacity;\n+  private int desiredCapacity;\n+  private ResourceEnum threadPool;\n+  private NodeKey esNode;\n+\n+  private Map<ResourceEnum, Integer> lowerBound = new HashMap<>();\n+  private Map<ResourceEnum, Integer> upperBound = new HashMap<>();\n+\n+  public ModifyQueueCapacityAction(NodeKey esNode, ResourceEnum threadPool, int currentCapacity, boolean increase) {\n+    setBounds();\n+    int STEP_SIZE = 50;", "originalCommit": "549b3f0906567ca92a2b9aff4237dbe9dc1693ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUwNDk5Ng==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r450504996", "bodyText": "As stepsize is a positive integer, the creation of an action means that the desired size != currentCapacity as here:\ndesiredCapacity = increase ? currentCapacity + STEP_SIZE : currentCapacity - STEP_SIZE;\nWhat are the cases when it is not actionable ?", "author": "yojs", "createdAt": "2020-07-06T22:08:14Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/actions/ModifyQueueCapacityAction.java", "diffHunk": "@@ -0,0 +1,134 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions;\n+\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.CPU;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.HEAP;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.NETWORK;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.grpc.ResourceEnum;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.rca.cluster.NodeKey;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+public class ModifyQueueCapacityAction implements Action {\n+\n+  public static final String NAME = \"modify_queue_capacity\";\n+  public static final int COOL_OFF_PERIOD_IN_SECONDS = 300;\n+\n+  private int currentCapacity;\n+  private int desiredCapacity;\n+  private ResourceEnum threadPool;\n+  private NodeKey esNode;\n+\n+  private Map<ResourceEnum, Integer> lowerBound = new HashMap<>();\n+  private Map<ResourceEnum, Integer> upperBound = new HashMap<>();\n+\n+  public ModifyQueueCapacityAction(NodeKey esNode, ResourceEnum threadPool, int currentCapacity, boolean increase) {\n+    setBounds();\n+    int STEP_SIZE = 50;\n+    this.esNode = esNode;\n+    this.threadPool = threadPool;\n+    this.currentCapacity = currentCapacity;\n+    int desiredCapacity = increase ? currentCapacity + STEP_SIZE : currentCapacity - STEP_SIZE;\n+    setDesiredCapacity(desiredCapacity);\n+  }\n+\n+  @Override\n+  public String name() {\n+    return NAME;\n+  }\n+\n+  @Override\n+  public boolean isActionable() {\n+    return desiredCapacity != currentCapacity;\n+  }\n+\n+  @Override\n+  public int coolOffPeriodInSeconds() {\n+    return COOL_OFF_PERIOD_IN_SECONDS;\n+  }\n+\n+  @Override\n+  public List<NodeKey> impactedNodes() {\n+    return Collections.singletonList(esNode);\n+  }\n+\n+  @Override\n+  public Map<NodeKey, ImpactVector> impact() {\n+    ImpactVector impactVector = new ImpactVector();\n+    if (desiredCapacity > currentCapacity) {\n+      impactVector.increasesPressure(HEAP, CPU, NETWORK);\n+    } else if (desiredCapacity < currentCapacity) {\n+      impactVector.decreasesPressure(HEAP, CPU, NETWORK);\n+    }\n+    return Collections.singletonMap(esNode, impactVector);\n+  }\n+\n+  @Override\n+  public void execute() {\n+    // Making this a no-op for now\n+    // TODO: Modify based on downstream agent API calls\n+    assert true;\n+  }\n+\n+  @Override\n+  public String summary() {\n+    if (!isActionable()) {", "originalCommit": "549b3f0906567ca92a2b9aff4237dbe9dc1693ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUwNTg1NA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r450505854", "bodyText": "String.format uses complicated pattern matching to create the final string, do you think we can use StringBuilder ?", "author": "yojs", "createdAt": "2020-07-06T22:10:38Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/actions/ModifyQueueCapacityAction.java", "diffHunk": "@@ -0,0 +1,134 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions;\n+\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.CPU;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.HEAP;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.NETWORK;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.grpc.ResourceEnum;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.rca.cluster.NodeKey;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+public class ModifyQueueCapacityAction implements Action {\n+\n+  public static final String NAME = \"modify_queue_capacity\";\n+  public static final int COOL_OFF_PERIOD_IN_SECONDS = 300;\n+\n+  private int currentCapacity;\n+  private int desiredCapacity;\n+  private ResourceEnum threadPool;\n+  private NodeKey esNode;\n+\n+  private Map<ResourceEnum, Integer> lowerBound = new HashMap<>();\n+  private Map<ResourceEnum, Integer> upperBound = new HashMap<>();\n+\n+  public ModifyQueueCapacityAction(NodeKey esNode, ResourceEnum threadPool, int currentCapacity, boolean increase) {\n+    setBounds();\n+    int STEP_SIZE = 50;\n+    this.esNode = esNode;\n+    this.threadPool = threadPool;\n+    this.currentCapacity = currentCapacity;\n+    int desiredCapacity = increase ? currentCapacity + STEP_SIZE : currentCapacity - STEP_SIZE;\n+    setDesiredCapacity(desiredCapacity);\n+  }\n+\n+  @Override\n+  public String name() {\n+    return NAME;\n+  }\n+\n+  @Override\n+  public boolean isActionable() {\n+    return desiredCapacity != currentCapacity;\n+  }\n+\n+  @Override\n+  public int coolOffPeriodInSeconds() {\n+    return COOL_OFF_PERIOD_IN_SECONDS;\n+  }\n+\n+  @Override\n+  public List<NodeKey> impactedNodes() {\n+    return Collections.singletonList(esNode);\n+  }\n+\n+  @Override\n+  public Map<NodeKey, ImpactVector> impact() {\n+    ImpactVector impactVector = new ImpactVector();\n+    if (desiredCapacity > currentCapacity) {\n+      impactVector.increasesPressure(HEAP, CPU, NETWORK);\n+    } else if (desiredCapacity < currentCapacity) {\n+      impactVector.decreasesPressure(HEAP, CPU, NETWORK);\n+    }\n+    return Collections.singletonMap(esNode, impactVector);\n+  }\n+\n+  @Override\n+  public void execute() {\n+    // Making this a no-op for now\n+    // TODO: Modify based on downstream agent API calls\n+    assert true;\n+  }\n+\n+  @Override\n+  public String summary() {\n+    if (!isActionable()) {\n+      return String.format(\"No action to take for: [%s]\", NAME);\n+    }\n+    return String.format(\"Update [%s] queue capacity from [%d] to [%d] on node [%s]\",", "originalCommit": "549b3f0906567ca92a2b9aff4237dbe9dc1693ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUxMTUwNw==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r450511507", "bodyText": "Do we want to send an unmodifiableList list ?", "author": "yojs", "createdAt": "2020-07-06T22:26:46Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciders/Decision.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.Action;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.grpc.FlowUnitMessage;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.core.GenericFlowUnit;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class Decision extends GenericFlowUnit {\n+\n+  private List<Action> actions = new ArrayList<>();\n+  private String decider;\n+\n+  public Decision(long timeStamp, String deciderName) {\n+    super(timeStamp);\n+    setDecider(deciderName);\n+  }\n+\n+  public void addAction(Action action) {\n+    if (action != null) {\n+      actions.add(action);\n+    }\n+  }\n+\n+  public void addAllActions(List<Action> actions) {\n+    this.actions.addAll(actions);\n+  }\n+\n+  public List<Action> getActions() {\n+    return actions;", "originalCommit": "549b3f0906567ca92a2b9aff4237dbe9dc1693ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUxMTkzNQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r450511935", "bodyText": "a class level javadoc comment ?", "author": "yojs", "createdAt": "2020-07-06T22:28:12Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciders/Publisher.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.Action;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.core.NonLeafNode;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.scheduler.FlowUnitOperationArgWrapper;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+public class Publisher extends NonLeafNode<EmptyFlowUnit> {", "originalCommit": "549b3f0906567ca92a2b9aff4237dbe9dc1693ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUxMjI3MA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r450512270", "bodyText": "Do you think we can add a debug message and a metric here ?", "author": "yojs", "createdAt": "2020-07-06T22:29:12Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciders/Publisher.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.Action;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.core.NonLeafNode;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.scheduler.FlowUnitOperationArgWrapper;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+public class Publisher extends NonLeafNode<EmptyFlowUnit> {\n+\n+  private static final Logger LOG = LogManager.getLogger(Publisher.class);\n+\n+  private Collator collator;\n+  private boolean isMuted = false;\n+\n+  public Publisher(int evalIntervalSeconds, Collator collator) {\n+    super(0, evalIntervalSeconds);\n+    this.collator = collator;\n+  }\n+\n+  @Override\n+  public EmptyFlowUnit operate() {\n+    // TODO: Pass through implementation, need to add dampening, cool-off, action flip-flop\n+    // avoidance, state persistence etc.\n+\n+    Decision decision = collator.getFlowUnits().get(0);\n+    for (Action action : decision.getActions()) {\n+      LOG.info(\"Executing action: [{}]\", action.name());", "originalCommit": "549b3f0906567ca92a2b9aff4237dbe9dc1693ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUxMzM5Mg==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r450513392", "bodyText": "We already have a camelCase and mixed snake case in namings, now this will be pure snake-case. Do we want to stick to one of the previous two or maybe camelCase ?", "author": "yojs", "createdAt": "2020-07-06T22:32:37Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciders/QueueHealthDecider.java", "diffHunk": "@@ -0,0 +1,125 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.Action;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ModifyQueueCapacityAction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.grpc.ResourceEnum;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.summaries.HotClusterSummary;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.summaries.HotNodeSummary;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.summaries.HotResourceSummary;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.rca.cluster.NodeKey;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.rca.cluster.QueueRejectionClusterRca;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+// This is a sample decider implementation to finalize decision maker interfaces.\n+// TODO: 1. Read action priorities from a configurable yml\n+// TODO: 2. Read current queue capacity from NodeConfigurationRca (PR #252)\n+\n+public class QueueHealthDecider extends Decider {\n+\n+  public static final String NAME = \"queue_health\";", "originalCommit": "549b3f0906567ca92a2b9aff4237dbe9dc1693ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUxNzc3Mw==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r450517773", "bodyText": "queueRejectionRca can be empty in some cases, which means that the summary might be null. We might want to make an early return in that case ?", "author": "yojs", "createdAt": "2020-07-06T22:47:00Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciders/QueueHealthDecider.java", "diffHunk": "@@ -0,0 +1,125 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.Action;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ModifyQueueCapacityAction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.grpc.ResourceEnum;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.summaries.HotClusterSummary;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.summaries.HotNodeSummary;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.summaries.HotResourceSummary;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.rca.cluster.NodeKey;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.rca.cluster.QueueRejectionClusterRca;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+// This is a sample decider implementation to finalize decision maker interfaces.\n+// TODO: 1. Read action priorities from a configurable yml\n+// TODO: 2. Read current queue capacity from NodeConfigurationRca (PR #252)\n+\n+public class QueueHealthDecider extends Decider {\n+\n+  public static final String NAME = \"queue_health\";\n+\n+  private QueueRejectionClusterRca queueRejectionRca;\n+  List<String> actionsByUserPriority = new ArrayList<>();\n+  private int counter = 0;\n+\n+  public QueueHealthDecider(long evalIntervalSeconds, int decisionFrequency, QueueRejectionClusterRca queueRejectionClusterRca) {\n+    // TODO: Also consume NodeConfigurationRca\n+    super(evalIntervalSeconds, decisionFrequency);\n+    this.queueRejectionRca = queueRejectionClusterRca;\n+    configureActionPriority();\n+  }\n+\n+  @Override\n+  public String name() {\n+    return NAME;\n+  }\n+\n+  @Override\n+  public Decision operate() {\n+    Decision decision = new Decision(System.currentTimeMillis(), NAME);\n+    counter += 1;\n+    if (counter < decisionFrequency) {\n+      return decision;\n+    }\n+\n+    counter = 0;\n+    if (queueRejectionRca.getFlowUnits().isEmpty()) {\n+      return decision;\n+    }\n+\n+    HotClusterSummary clusterSummary = queueRejectionRca.getFlowUnits().get(0).getSummary();", "originalCommit": "549b3f0906567ca92a2b9aff4237dbe9dc1693ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUxODQ2Mg==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r450518462", "bodyText": "Because this method can return null, do we want to make it explicit using the annotation @nullable ?", "author": "yojs", "createdAt": "2020-07-06T22:49:31Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciders/QueueHealthDecider.java", "diffHunk": "@@ -0,0 +1,125 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.Action;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ModifyQueueCapacityAction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.grpc.ResourceEnum;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.summaries.HotClusterSummary;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.summaries.HotNodeSummary;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.summaries.HotResourceSummary;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.rca.cluster.NodeKey;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.rca.cluster.QueueRejectionClusterRca;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+// This is a sample decider implementation to finalize decision maker interfaces.\n+// TODO: 1. Read action priorities from a configurable yml\n+// TODO: 2. Read current queue capacity from NodeConfigurationRca (PR #252)\n+\n+public class QueueHealthDecider extends Decider {\n+\n+  public static final String NAME = \"queue_health\";\n+\n+  private QueueRejectionClusterRca queueRejectionRca;\n+  List<String> actionsByUserPriority = new ArrayList<>();\n+  private int counter = 0;\n+\n+  public QueueHealthDecider(long evalIntervalSeconds, int decisionFrequency, QueueRejectionClusterRca queueRejectionClusterRca) {\n+    // TODO: Also consume NodeConfigurationRca\n+    super(evalIntervalSeconds, decisionFrequency);\n+    this.queueRejectionRca = queueRejectionClusterRca;\n+    configureActionPriority();\n+  }\n+\n+  @Override\n+  public String name() {\n+    return NAME;\n+  }\n+\n+  @Override\n+  public Decision operate() {\n+    Decision decision = new Decision(System.currentTimeMillis(), NAME);\n+    counter += 1;\n+    if (counter < decisionFrequency) {\n+      return decision;\n+    }\n+\n+    counter = 0;\n+    if (queueRejectionRca.getFlowUnits().isEmpty()) {\n+      return decision;\n+    }\n+\n+    HotClusterSummary clusterSummary = queueRejectionRca.getFlowUnits().get(0).getSummary();\n+    for (HotNodeSummary nodeSummary : clusterSummary.getHotNodeSummaryList()) {\n+      NodeKey esNode = new NodeKey(nodeSummary.getNodeID(), nodeSummary.getHostAddress());\n+      for (HotResourceSummary resource : nodeSummary.getHotResourceSummaryList()) {\n+        decision.addAction(computeBestAction(esNode, resource.getResource().getResourceEnum()));\n+      }\n+    }\n+\n+    return decision;\n+  }\n+\n+  private void configureActionPriority() {\n+    // TODO: Input from user configured yml\n+    this.actionsByUserPriority.add(ModifyQueueCapacityAction.NAME);\n+  }\n+\n+  /**\n+   * Evaluate the most relevant action for a node\n+   *\n+   * <p>Action relevance decided based on user configured priorities for now, this can be modified\n+   * to consume better signals going forward.\n+   */\n+  private Action computeBestAction(NodeKey esNode, ResourceEnum threadPool) {\n+    Action action = null;\n+    for (String actionName : actionsByUserPriority) {\n+      action =\n+          getAction(actionName, esNode, threadPool, getNodeQueueCapacity(esNode, threadPool), true);\n+      if (action != null) {\n+        break;\n+      }\n+    }\n+    return action;\n+  }\n+\n+  private Action getAction(String actionName, NodeKey esNode, ResourceEnum threadPool, int currCapacity, boolean increase) {\n+    switch (actionName) {\n+      case ModifyQueueCapacityAction.NAME:\n+        return configureQueueCapacity(esNode, threadPool, currCapacity, increase);\n+      default:\n+        return null;\n+    }\n+  }\n+\n+  private ModifyQueueCapacityAction configureQueueCapacity(NodeKey esNode, ResourceEnum threadPool, int currentCapacity, boolean increase) {", "originalCommit": "549b3f0906567ca92a2b9aff4237dbe9dc1693ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUxOTE5NA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/260#discussion_r450519194", "bodyText": "can we extract out the code here in a method of its own as in constructShardResourceUsageGraph ?", "author": "yojs", "createdAt": "2020-07-06T22:51:51Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/store/ElasticSearchAnalysisGraph.java", "diffHunk": "@@ -150,8 +157,40 @@ public void construct() {\n     hotNodeClusterRca.addTag(TAG_LOCUS, LOCUS_MASTER_NODE);\n     hotNodeClusterRca.addAllUpstreams(Collections.singletonList(hotJVMNodeRca));\n \n+    /* Queue Rejection RCAs\n+     */\n+    // TODO: Refactor this monolithic function\n+    Metric threadpool_RejectedReqs = new ThreadPool_RejectedReqs(EVALUATION_INTERVAL_SECONDS);\n+    threadpool_RejectedReqs.addTag(TAG_LOCUS, LOCUS_DATA_MASTER_NODE);\n+    addLeaf(threadpool_RejectedReqs);\n+\n+    // Node level queue rejection RCA\n+    QueueRejectionRca queueRejectionNodeRca = new QueueRejectionRca(RCA_PERIOD, threadpool_RejectedReqs);\n+    queueRejectionNodeRca.addTag(TAG_LOCUS, LOCUS_DATA_MASTER_NODE);\n+    queueRejectionNodeRca.addAllUpstreams(Collections.singletonList(threadpool_RejectedReqs));\n+\n+    // Cluster level queue rejection RCA\n+    QueueRejectionClusterRca queueRejectionClusterRca = new QueueRejectionClusterRca(RCA_PERIOD, queueRejectionNodeRca);\n+    queueRejectionClusterRca.addTag(TAG_LOCUS, LOCUS_MASTER_NODE);\n+    queueRejectionClusterRca.addAllUpstreams(Collections.singletonList(queueRejectionNodeRca));\n+\n+    // Queue Health Decider\n+    QueueHealthDecider queueHealthDecider = new QueueHealthDecider(EVALUATION_INTERVAL_SECONDS, 12, queueRejectionClusterRca);\n+    queueHealthDecider.addTag(TAG_LOCUS, LOCUS_MASTER_NODE);\n+    queueHealthDecider.addAllUpstreams(Collections.singletonList(queueRejectionClusterRca));\n+", "originalCommit": "549b3f0906567ca92a2b9aff4237dbe9dc1693ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}