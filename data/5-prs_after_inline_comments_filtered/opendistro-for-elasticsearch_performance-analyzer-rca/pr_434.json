{"pr_number": 434, "pr_title": "Read from sqlite in IT and add cache decider IT", "pr_createdAt": "2020-09-23T18:42:12Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434", "timeline": [{"oid": "d3466e0d5a7cb896758179dd9f80afc99ec755a4", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/d3466e0d5a7cb896758179dd9f80afc99ec755a4", "message": "Read from sqlite in IT and add cache decider IT", "committedDate": "2020-09-23T18:40:20Z", "type": "commit"}, {"oid": "5595d8219887252fddb68540708331d1e4a33b96", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/5595d8219887252fddb68540708331d1e4a33b96", "message": "Fix comments", "committedDate": "2020-09-23T18:46:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDUwNTk2OQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r494505969", "bodyText": "Do we not want to do anything with the thrown exception ? If not, we might want to add a code comment as why", "author": "yojs", "createdAt": "2020-09-24T17:56:09Z", "path": "src/test/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/integTests/framework/Host.java", "diffHunk": "@@ -368,6 +368,14 @@ public JsonElement getDataForRca(String rcaName) {\n     return obj;\n   }\n \n+  public <T> T constructObjectFromDB(Class<T> className) {\n+    try {\n+      return this.rcaController.getPersistenceProvider().read(className);\n+    } catch (Exception e) {\n+      return null;", "originalCommit": "5595d8219887252fddb68540708331d1e4a33b96", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDY3MDczNQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r494670735", "bodyText": "Throwing here and added a check on RcaItRunnerBase stage. Added a code comment on why we want to ignore the exception", "author": "sruti1312", "createdAt": "2020-09-24T23:49:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDUwNTk2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDUxMDEwOQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r494510109", "bodyText": "we might want to say DB_QUERY.\nI hope our persistence layer is pluggable enough that we can swap out sqlite for anything quite easily :)", "author": "yojs", "createdAt": "2020-09-24T18:03:26Z", "path": "src/test/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/integTests/framework/annotations/AExpect.java", "diffHunk": "@@ -53,7 +53,8 @@\n    * Currently supported places to look for RCA outputs are the SQLite file or by hitting the rest endpoint.\n    */\n   enum Type {\n-    REST_API\n+    REST_API,\n+    SQLITE", "originalCommit": "5595d8219887252fddb68540708331d1e4a33b96", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDY2Njg0OA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r494666848", "bodyText": "Right. Modified to DB_QUERY", "author": "sruti1312", "createdAt": "2020-09-24T23:36:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDUxMDEwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDUzNDYyMA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r494534620", "bodyText": "If we have to type-cast then this is not the right case of generics.", "author": "yojs", "createdAt": "2020-09-24T18:40:42Z", "path": "src/test/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/integTests/tests/cache_tuning/validator/FieldDataCacheDeciderValidator.java", "diffHunk": "@@ -0,0 +1,71 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ *  A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  or in the \"license\" file accompanying this file. This file is distributed\n+ *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *  express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.validator;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ModifyCacheMaxSizeAction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.api.IValidator;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.persistence.actions.PersistedAction;\n+import org.junit.Assert;\n+\n+public class FieldDataCacheDeciderValidator implements IValidator {\n+    long startTime;\n+\n+    public FieldDataCacheDeciderValidator() {\n+        startTime = System.currentTimeMillis();\n+    }\n+\n+    /**\n+     * {\"actionName\":\"ModifyCacheMaxSize\",\n+     * \"resourceValue\":10,\n+     * \"timestamp\":\"1599257910923\",\n+     * \"nodeId\":{node1},\n+     * \"nodeIp\":{1.1.1.1},\n+     * \"actionable\":1,\n+     * \"coolOffPeriod\": 300000\n+     * \"muted\": 1\n+     * \"summary\": Update [FIELD_DATA_CACHE] capacity from [10000] to [100000] on node [DATA_0]\n+     */\n+    @Override\n+    public <T> boolean check(T response) {\n+        if (response == null) {\n+            return false;\n+        }\n+        PersistedAction persistedAction = (PersistedAction) response;", "originalCommit": "5595d8219887252fddb68540708331d1e4a33b96", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDY2NzQzNg==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r494667436", "bodyText": "Creating two methods in IValidator, for checkJsonResponse and checkQueryResp.", "author": "sruti1312", "createdAt": "2020-09-24T23:37:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDUzNDYyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDUzNTQzMQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r494535431", "bodyText": "same here as well", "author": "yojs", "createdAt": "2020-09-24T18:42:10Z", "path": "src/test/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/integTests/tests/queue_tuning/validator/QueueRejectionValidator.java", "diffHunk": "@@ -46,7 +46,8 @@ public QueueRejectionValidator() {\n    * ]}\n    */\n   @Override\n-  public boolean check(JsonElement response) {\n+  public <T> boolean check(T responseObject) {\n+    JsonElement response = (JsonElement) responseObject;", "originalCommit": "5595d8219887252fddb68540708331d1e4a33b96", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3f1f0fe941c5c958b86b2ff0f8edfb22d600ce27", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/3f1f0fe941c5c958b86b2ff0f8edfb22d600ce27", "message": "Modify IValidator", "committedDate": "2020-09-24T23:47:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjI2MDA3NA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r496260074", "bodyText": "Do we need these in a FieldData cache test IT?", "author": "vigyasharma", "createdAt": "2020-09-28T21:59:24Z", "path": "src/test/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/integTests/tests/cache_tuning/FieldDataCacheDeciderITest.java", "diffHunk": "@@ -0,0 +1,255 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ *  A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  or in the \"license\" file accompanying this file. This file is distributed\n+ *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *  express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning;\n+\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.FieldDataCacheDeciderITest.INDEX_NAME;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.FieldDataCacheDeciderITest.SHARD_ID;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.metrics.AllMetrics;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_FieldData_Eviction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_FieldData_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Max_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Request_Eviction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Request_Hit;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Request_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Heap_Max;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.RcaItMarker;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AClusterType;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AErrorPatternIgnored;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AExpect;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AMetric;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ARcaConf;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ARcaGraph;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ATable;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ATuple;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.ClusterType;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.Consts;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.HostTag;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.runners.RcaItNotEncryptedRunner;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.validator.FieldDataCacheDeciderValidator;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.persistence.actions.PersistedAction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.ElasticSearchAnalysisGraph;\n+import org.junit.Test;\n+import org.junit.experimental.categories.Category;\n+import org.junit.runner.RunWith;\n+\n+@Category(RcaItMarker.class)\n+@RunWith(RcaItNotEncryptedRunner.class)\n+@AClusterType(ClusterType.MULTI_NODE_CO_LOCATED_MASTER)\n+@ARcaGraph(ElasticSearchAnalysisGraph.class)\n+//specify a custom rca.conf to set the collector time periods to 5s to reduce runtime\n+@ARcaConf(dataNode = FieldDataCacheDeciderITest.CACHE_TUNING_RESOURCES_DIR + \"rca.conf\")\n+@AMetric(\n+        name = Cache_FieldData_Size.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 8500.0, avg = 8500.0, min = 8500.0, max = 8500.0),\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 100.0, avg = 100.0, min = 100.0, max = 100.0),\n+                        })\n+        })\n+@AMetric(\n+        name = Cache_FieldData_Eviction.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 1.0, avg = 1.0, min = 1.0, max = 1.0),\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 0.0, avg = 0.0, min = 0.0, max = 0.0),\n+                        })\n+        })\n+@AMetric(\n+        name = Cache_Request_Size.class,", "originalCommit": "3f1f0fe941c5c958b86b2ff0f8edfb22d600ce27", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMyNjE1OA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r496326158", "bodyText": "same as below. Removing these metrics.", "author": "sruti1312", "createdAt": "2020-09-29T01:41:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjI2MDA3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjI2MDUyMA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r496260520", "bodyText": "Same as above, is this needed for fielddata cache it", "author": "vigyasharma", "createdAt": "2020-09-28T22:00:25Z", "path": "src/test/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/integTests/tests/cache_tuning/FieldDataCacheDeciderITest.java", "diffHunk": "@@ -0,0 +1,255 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ *  A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  or in the \"license\" file accompanying this file. This file is distributed\n+ *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *  express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning;\n+\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.FieldDataCacheDeciderITest.INDEX_NAME;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.FieldDataCacheDeciderITest.SHARD_ID;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.metrics.AllMetrics;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_FieldData_Eviction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_FieldData_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Max_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Request_Eviction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Request_Hit;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Request_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Heap_Max;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.RcaItMarker;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AClusterType;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AErrorPatternIgnored;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AExpect;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AMetric;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ARcaConf;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ARcaGraph;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ATable;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ATuple;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.ClusterType;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.Consts;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.HostTag;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.runners.RcaItNotEncryptedRunner;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.validator.FieldDataCacheDeciderValidator;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.persistence.actions.PersistedAction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.ElasticSearchAnalysisGraph;\n+import org.junit.Test;\n+import org.junit.experimental.categories.Category;\n+import org.junit.runner.RunWith;\n+\n+@Category(RcaItMarker.class)\n+@RunWith(RcaItNotEncryptedRunner.class)\n+@AClusterType(ClusterType.MULTI_NODE_CO_LOCATED_MASTER)\n+@ARcaGraph(ElasticSearchAnalysisGraph.class)\n+//specify a custom rca.conf to set the collector time periods to 5s to reduce runtime\n+@ARcaConf(dataNode = FieldDataCacheDeciderITest.CACHE_TUNING_RESOURCES_DIR + \"rca.conf\")\n+@AMetric(\n+        name = Cache_FieldData_Size.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 8500.0, avg = 8500.0, min = 8500.0, max = 8500.0),\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 100.0, avg = 100.0, min = 100.0, max = 100.0),\n+                        })\n+        })\n+@AMetric(\n+        name = Cache_FieldData_Eviction.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 1.0, avg = 1.0, min = 1.0, max = 1.0),\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 0.0, avg = 0.0, min = 0.0, max = 0.0),\n+                        })\n+        })\n+@AMetric(\n+        name = Cache_Request_Size.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 100.0, avg = 100.0, min = 100.0, max = 100.0),\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 50.0, avg = 50.0, min = 50.0, max = 50.0),\n+                        })\n+        })\n+@AMetric(\n+        name = Cache_Request_Eviction.class,", "originalCommit": "3f1f0fe941c5c958b86b2ff0f8edfb22d600ce27", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcwNDUzNw==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r497704537", "bodyText": "We might not need this. Removing these metrics.", "author": "sruti1312", "createdAt": "2020-09-30T18:07:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjI2MDUyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMxMjc4Mw==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r496312783", "bodyText": "If we add the relevant metric values for them, will these caches get populated. By skipping this error in integ tests we expose ourselves to these failures in actual clusters.", "author": "vigyasharma", "createdAt": "2020-09-29T00:50:36Z", "path": "src/test/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/integTests/tests/cache_tuning/FieldDataCacheDeciderITest.java", "diffHunk": "@@ -0,0 +1,255 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ *  A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  or in the \"license\" file accompanying this file. This file is distributed\n+ *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *  express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning;\n+\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.FieldDataCacheDeciderITest.INDEX_NAME;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.FieldDataCacheDeciderITest.SHARD_ID;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.metrics.AllMetrics;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_FieldData_Eviction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_FieldData_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Max_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Request_Eviction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Request_Hit;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Request_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Heap_Max;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.RcaItMarker;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AClusterType;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AErrorPatternIgnored;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AExpect;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AMetric;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ARcaConf;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ARcaGraph;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ATable;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ATuple;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.ClusterType;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.Consts;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.HostTag;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.runners.RcaItNotEncryptedRunner;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.validator.FieldDataCacheDeciderValidator;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.persistence.actions.PersistedAction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.ElasticSearchAnalysisGraph;\n+import org.junit.Test;\n+import org.junit.experimental.categories.Category;\n+import org.junit.runner.RunWith;\n+\n+@Category(RcaItMarker.class)\n+@RunWith(RcaItNotEncryptedRunner.class)\n+@AClusterType(ClusterType.MULTI_NODE_CO_LOCATED_MASTER)\n+@ARcaGraph(ElasticSearchAnalysisGraph.class)\n+//specify a custom rca.conf to set the collector time periods to 5s to reduce runtime\n+@ARcaConf(dataNode = FieldDataCacheDeciderITest.CACHE_TUNING_RESOURCES_DIR + \"rca.conf\")\n+@AMetric(\n+        name = Cache_FieldData_Size.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 8500.0, avg = 8500.0, min = 8500.0, max = 8500.0),\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 100.0, avg = 100.0, min = 100.0, max = 100.0),\n+                        })\n+        })\n+@AMetric(\n+        name = Cache_FieldData_Eviction.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 1.0, avg = 1.0, min = 1.0, max = 1.0),\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 0.0, avg = 0.0, min = 0.0, max = 0.0),\n+                        })\n+        })\n+@AMetric(\n+        name = Cache_Request_Size.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 100.0, avg = 100.0, min = 100.0, max = 100.0),\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 50.0, avg = 50.0, min = 50.0, max = 50.0),\n+                        })\n+        })\n+@AMetric(\n+        name = Cache_Request_Eviction.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 0.0, avg = 0.0, min = 0.0, max = 0.0),\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 0.0, avg = 0.0, min = 0.0, max = 0.0),\n+                        })\n+        })\n+@AMetric(\n+        name = Cache_Request_Hit.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 0.0, avg = 0.0, min = 0.0, max = 0.0),\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 0.0, avg = 0.0, min = 0.0, max = 0.0),\n+                        })\n+        })\n+@AMetric(\n+        name = Cache_Max_Size.class,\n+        dimensionNames = {AllMetrics.CacheConfigDimension.Constants.TYPE_VALUE},\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {AllMetrics.CacheType.Constants.FIELD_DATA_CACHE_NAME},\n+                                        sum = 10000.0, avg = 10000.0, min = 10000.0, max = 10000.0),\n+                                @ATuple(\n+                                        dimensionValues = {AllMetrics.CacheType.Constants.SHARD_REQUEST_CACHE_NAME},\n+                                        sum = 100.0, avg = 100.0, min = 100.0, max = 100.0),\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {AllMetrics.CacheType.Constants.FIELD_DATA_CACHE_NAME},\n+                                        sum = 10000.0, avg = 10000.0, min = 10000.0, max = 10000.0),\n+                                @ATuple(\n+                                        dimensionValues = {AllMetrics.CacheType.Constants.SHARD_REQUEST_CACHE_NAME},\n+                                        sum = 100.0, avg = 100.0, min = 100.0, max = 100.0)\n+                        })\n+        })\n+@AMetric(\n+        name = Heap_Max.class,\n+        dimensionNames = {AllMetrics.HeapDimension.Constants.TYPE_VALUE},\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {AllMetrics.GCType.Constants.HEAP_VALUE},\n+                                        sum = 1000000.0, avg = 1000000.0, min = 1000000.0, max = 1000000.0),\n+                                @ATuple(\n+                                        dimensionValues = {AllMetrics.GCType.Constants.HEAP_VALUE},\n+                                        sum = 1000000.0, avg = 1000000.0, min = 1000000.0, max = 1000000.0)\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {AllMetrics.GCType.Constants.HEAP_VALUE},\n+                                        sum = 1000000.0, avg = 1000000.0, min = 1000000.0, max = 1000000.0),\n+                                @ATuple(\n+                                        dimensionValues = {AllMetrics.GCType.Constants.HEAP_VALUE},\n+                                        sum = 1000000.0, avg = 1000000.0, min = 1000000.0, max = 1000000.0)\n+                        })\n+        })\n+\n+public class FieldDataCacheDeciderITest {\n+    public static final String CACHE_TUNING_RESOURCES_DIR = Consts.INTEG_TESTS_SRC_DIR + \"./tests/cache_tuning/resource/\";\n+    public static final String INDEX_NAME = \"MockIndex\";\n+    public static final String SHARD_ID = \"1\";\n+\n+    // Test CacheDecider for ModifyCacheAction (field data cache).\n+    // The cache decider should emit modify cache size action as field data rca is unhealthy.\n+    @Test\n+    @AExpect(\n+            what = AExpect.Type.DB_QUERY,\n+            on = HostTag.ELECTED_MASTER,\n+            validator = FieldDataCacheDeciderValidator.class,\n+            forRca = PersistedAction.class,\n+            timeoutSeconds = 1000)\n+    @AErrorPatternIgnored(\n+            pattern = \"AggregateMetric:gather()\",\n+            reason = \"CPU metrics are expected to be missing in this integ test\")\n+    @AErrorPatternIgnored(\n+            pattern = \"Metric:gather()\",\n+            reason = \"Metrics are expected to be missing in this integ test\")\n+    @AErrorPatternIgnored(\n+            pattern = \"NodeConfigCacheReaderUtil\",\n+            reason = \"Node Config Cache are expected to be missing in this integ test.\")\n+    @AErrorPatternIgnored(\n+            pattern = \"CacheUtil:getCacheMaxSize()\",\n+            reason = \"Node Config Cache is expected to be missing during startup.\")", "originalCommit": "3f1f0fe941c5c958b86b2ff0f8edfb22d600ce27", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcwOTU1NA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r497709554", "bodyText": "I have removed un-wanted metrics (gives us a clearer understanding of what metrics are related to the decider). Having these errors. In case we get these errors, our validations will eventually fail.", "author": "sruti1312", "createdAt": "2020-09-30T18:16:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMxMjc4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMxMzI2NA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r496313264", "bodyText": "Why is this error expected in CacheHealthDecider rca?", "author": "vigyasharma", "createdAt": "2020-09-29T00:52:22Z", "path": "src/test/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/integTests/tests/cache_tuning/FieldDataCacheDeciderITest.java", "diffHunk": "@@ -0,0 +1,255 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ *  A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  or in the \"license\" file accompanying this file. This file is distributed\n+ *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *  express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning;\n+\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.FieldDataCacheDeciderITest.INDEX_NAME;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.FieldDataCacheDeciderITest.SHARD_ID;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.metrics.AllMetrics;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_FieldData_Eviction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_FieldData_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Max_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Request_Eviction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Request_Hit;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Request_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Heap_Max;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.RcaItMarker;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AClusterType;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AErrorPatternIgnored;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AExpect;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AMetric;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ARcaConf;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ARcaGraph;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ATable;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ATuple;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.ClusterType;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.Consts;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.HostTag;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.runners.RcaItNotEncryptedRunner;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.validator.FieldDataCacheDeciderValidator;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.persistence.actions.PersistedAction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.ElasticSearchAnalysisGraph;\n+import org.junit.Test;\n+import org.junit.experimental.categories.Category;\n+import org.junit.runner.RunWith;\n+\n+@Category(RcaItMarker.class)\n+@RunWith(RcaItNotEncryptedRunner.class)\n+@AClusterType(ClusterType.MULTI_NODE_CO_LOCATED_MASTER)\n+@ARcaGraph(ElasticSearchAnalysisGraph.class)\n+//specify a custom rca.conf to set the collector time periods to 5s to reduce runtime\n+@ARcaConf(dataNode = FieldDataCacheDeciderITest.CACHE_TUNING_RESOURCES_DIR + \"rca.conf\")\n+@AMetric(\n+        name = Cache_FieldData_Size.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 8500.0, avg = 8500.0, min = 8500.0, max = 8500.0),\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 100.0, avg = 100.0, min = 100.0, max = 100.0),\n+                        })\n+        })\n+@AMetric(\n+        name = Cache_FieldData_Eviction.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 1.0, avg = 1.0, min = 1.0, max = 1.0),\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 0.0, avg = 0.0, min = 0.0, max = 0.0),\n+                        })\n+        })\n+@AMetric(\n+        name = Cache_Request_Size.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 100.0, avg = 100.0, min = 100.0, max = 100.0),\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 50.0, avg = 50.0, min = 50.0, max = 50.0),\n+                        })\n+        })\n+@AMetric(\n+        name = Cache_Request_Eviction.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 0.0, avg = 0.0, min = 0.0, max = 0.0),\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 0.0, avg = 0.0, min = 0.0, max = 0.0),\n+                        })\n+        })\n+@AMetric(\n+        name = Cache_Request_Hit.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 0.0, avg = 0.0, min = 0.0, max = 0.0),\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 0.0, avg = 0.0, min = 0.0, max = 0.0),\n+                        })\n+        })\n+@AMetric(\n+        name = Cache_Max_Size.class,\n+        dimensionNames = {AllMetrics.CacheConfigDimension.Constants.TYPE_VALUE},\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {AllMetrics.CacheType.Constants.FIELD_DATA_CACHE_NAME},\n+                                        sum = 10000.0, avg = 10000.0, min = 10000.0, max = 10000.0),\n+                                @ATuple(\n+                                        dimensionValues = {AllMetrics.CacheType.Constants.SHARD_REQUEST_CACHE_NAME},\n+                                        sum = 100.0, avg = 100.0, min = 100.0, max = 100.0),\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {AllMetrics.CacheType.Constants.FIELD_DATA_CACHE_NAME},\n+                                        sum = 10000.0, avg = 10000.0, min = 10000.0, max = 10000.0),\n+                                @ATuple(\n+                                        dimensionValues = {AllMetrics.CacheType.Constants.SHARD_REQUEST_CACHE_NAME},\n+                                        sum = 100.0, avg = 100.0, min = 100.0, max = 100.0)\n+                        })\n+        })\n+@AMetric(\n+        name = Heap_Max.class,\n+        dimensionNames = {AllMetrics.HeapDimension.Constants.TYPE_VALUE},\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {AllMetrics.GCType.Constants.HEAP_VALUE},\n+                                        sum = 1000000.0, avg = 1000000.0, min = 1000000.0, max = 1000000.0),\n+                                @ATuple(\n+                                        dimensionValues = {AllMetrics.GCType.Constants.HEAP_VALUE},\n+                                        sum = 1000000.0, avg = 1000000.0, min = 1000000.0, max = 1000000.0)\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {AllMetrics.GCType.Constants.HEAP_VALUE},\n+                                        sum = 1000000.0, avg = 1000000.0, min = 1000000.0, max = 1000000.0),\n+                                @ATuple(\n+                                        dimensionValues = {AllMetrics.GCType.Constants.HEAP_VALUE},\n+                                        sum = 1000000.0, avg = 1000000.0, min = 1000000.0, max = 1000000.0)\n+                        })\n+        })\n+\n+public class FieldDataCacheDeciderITest {\n+    public static final String CACHE_TUNING_RESOURCES_DIR = Consts.INTEG_TESTS_SRC_DIR + \"./tests/cache_tuning/resource/\";\n+    public static final String INDEX_NAME = \"MockIndex\";\n+    public static final String SHARD_ID = \"1\";\n+\n+    // Test CacheDecider for ModifyCacheAction (field data cache).\n+    // The cache decider should emit modify cache size action as field data rca is unhealthy.\n+    @Test\n+    @AExpect(\n+            what = AExpect.Type.DB_QUERY,\n+            on = HostTag.ELECTED_MASTER,\n+            validator = FieldDataCacheDeciderValidator.class,\n+            forRca = PersistedAction.class,\n+            timeoutSeconds = 1000)\n+    @AErrorPatternIgnored(\n+            pattern = \"AggregateMetric:gather()\",\n+            reason = \"CPU metrics are expected to be missing in this integ test\")\n+    @AErrorPatternIgnored(\n+            pattern = \"Metric:gather()\",\n+            reason = \"Metrics are expected to be missing in this integ test\")\n+    @AErrorPatternIgnored(\n+            pattern = \"NodeConfigCacheReaderUtil\",\n+            reason = \"Node Config Cache are expected to be missing in this integ test.\")\n+    @AErrorPatternIgnored(\n+            pattern = \"CacheUtil:getCacheMaxSize()\",\n+            reason = \"Node Config Cache is expected to be missing during startup.\")\n+    @AErrorPatternIgnored(\n+            pattern = \"SubscribeResponseHandler:onError()\",\n+            reason = \"A unit test expressly calls SubscribeResponseHandler#onError, which writes an error log\")\n+    @AErrorPatternIgnored(\n+            pattern = \"SQLParsingUtil:readDataFromSqlResult()\",\n+            reason = \"Old gen metrics is expected to be missing in this integ test.\")\n+    @AErrorPatternIgnored(\n+            pattern = \"HighHeapUsageOldGenRca:operate()\",\n+            reason = \"Old gen rca is expected to be missing in this integ test.\")", "originalCommit": "3f1f0fe941c5c958b86b2ff0f8edfb22d600ce27", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMyMzI3OQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r496323279", "bodyText": "We have heap metrics due to which old gen rca gets triggered and throws errors during operate.", "author": "sruti1312", "createdAt": "2020-09-29T01:30:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMxMzI2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMxMzM2NQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r496313365", "bodyText": "Can we make the Node Config cache available in IT?", "author": "vigyasharma", "createdAt": "2020-09-29T00:52:45Z", "path": "src/test/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/integTests/tests/cache_tuning/FieldDataCacheDeciderITest.java", "diffHunk": "@@ -0,0 +1,255 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ *  A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  or in the \"license\" file accompanying this file. This file is distributed\n+ *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *  express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning;\n+\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.FieldDataCacheDeciderITest.INDEX_NAME;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.FieldDataCacheDeciderITest.SHARD_ID;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.metrics.AllMetrics;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_FieldData_Eviction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_FieldData_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Max_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Request_Eviction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Request_Hit;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Request_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Heap_Max;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.RcaItMarker;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AClusterType;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AErrorPatternIgnored;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AExpect;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AMetric;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ARcaConf;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ARcaGraph;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ATable;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ATuple;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.ClusterType;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.Consts;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.HostTag;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.runners.RcaItNotEncryptedRunner;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.validator.FieldDataCacheDeciderValidator;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.persistence.actions.PersistedAction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.ElasticSearchAnalysisGraph;\n+import org.junit.Test;\n+import org.junit.experimental.categories.Category;\n+import org.junit.runner.RunWith;\n+\n+@Category(RcaItMarker.class)\n+@RunWith(RcaItNotEncryptedRunner.class)\n+@AClusterType(ClusterType.MULTI_NODE_CO_LOCATED_MASTER)\n+@ARcaGraph(ElasticSearchAnalysisGraph.class)\n+//specify a custom rca.conf to set the collector time periods to 5s to reduce runtime\n+@ARcaConf(dataNode = FieldDataCacheDeciderITest.CACHE_TUNING_RESOURCES_DIR + \"rca.conf\")\n+@AMetric(\n+        name = Cache_FieldData_Size.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 8500.0, avg = 8500.0, min = 8500.0, max = 8500.0),\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 100.0, avg = 100.0, min = 100.0, max = 100.0),\n+                        })\n+        })\n+@AMetric(\n+        name = Cache_FieldData_Eviction.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 1.0, avg = 1.0, min = 1.0, max = 1.0),\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 0.0, avg = 0.0, min = 0.0, max = 0.0),\n+                        })\n+        })\n+@AMetric(\n+        name = Cache_Request_Size.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 100.0, avg = 100.0, min = 100.0, max = 100.0),\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 50.0, avg = 50.0, min = 50.0, max = 50.0),\n+                        })\n+        })\n+@AMetric(\n+        name = Cache_Request_Eviction.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 0.0, avg = 0.0, min = 0.0, max = 0.0),\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 0.0, avg = 0.0, min = 0.0, max = 0.0),\n+                        })\n+        })\n+@AMetric(\n+        name = Cache_Request_Hit.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 0.0, avg = 0.0, min = 0.0, max = 0.0),\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 0.0, avg = 0.0, min = 0.0, max = 0.0),\n+                        })\n+        })\n+@AMetric(\n+        name = Cache_Max_Size.class,\n+        dimensionNames = {AllMetrics.CacheConfigDimension.Constants.TYPE_VALUE},\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {AllMetrics.CacheType.Constants.FIELD_DATA_CACHE_NAME},\n+                                        sum = 10000.0, avg = 10000.0, min = 10000.0, max = 10000.0),\n+                                @ATuple(\n+                                        dimensionValues = {AllMetrics.CacheType.Constants.SHARD_REQUEST_CACHE_NAME},\n+                                        sum = 100.0, avg = 100.0, min = 100.0, max = 100.0),\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {AllMetrics.CacheType.Constants.FIELD_DATA_CACHE_NAME},\n+                                        sum = 10000.0, avg = 10000.0, min = 10000.0, max = 10000.0),\n+                                @ATuple(\n+                                        dimensionValues = {AllMetrics.CacheType.Constants.SHARD_REQUEST_CACHE_NAME},\n+                                        sum = 100.0, avg = 100.0, min = 100.0, max = 100.0)\n+                        })\n+        })\n+@AMetric(\n+        name = Heap_Max.class,\n+        dimensionNames = {AllMetrics.HeapDimension.Constants.TYPE_VALUE},\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {AllMetrics.GCType.Constants.HEAP_VALUE},\n+                                        sum = 1000000.0, avg = 1000000.0, min = 1000000.0, max = 1000000.0),\n+                                @ATuple(\n+                                        dimensionValues = {AllMetrics.GCType.Constants.HEAP_VALUE},\n+                                        sum = 1000000.0, avg = 1000000.0, min = 1000000.0, max = 1000000.0)\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {AllMetrics.GCType.Constants.HEAP_VALUE},\n+                                        sum = 1000000.0, avg = 1000000.0, min = 1000000.0, max = 1000000.0),\n+                                @ATuple(\n+                                        dimensionValues = {AllMetrics.GCType.Constants.HEAP_VALUE},\n+                                        sum = 1000000.0, avg = 1000000.0, min = 1000000.0, max = 1000000.0)\n+                        })\n+        })\n+\n+public class FieldDataCacheDeciderITest {\n+    public static final String CACHE_TUNING_RESOURCES_DIR = Consts.INTEG_TESTS_SRC_DIR + \"./tests/cache_tuning/resource/\";\n+    public static final String INDEX_NAME = \"MockIndex\";\n+    public static final String SHARD_ID = \"1\";\n+\n+    // Test CacheDecider for ModifyCacheAction (field data cache).\n+    // The cache decider should emit modify cache size action as field data rca is unhealthy.\n+    @Test\n+    @AExpect(\n+            what = AExpect.Type.DB_QUERY,\n+            on = HostTag.ELECTED_MASTER,\n+            validator = FieldDataCacheDeciderValidator.class,\n+            forRca = PersistedAction.class,\n+            timeoutSeconds = 1000)\n+    @AErrorPatternIgnored(\n+            pattern = \"AggregateMetric:gather()\",\n+            reason = \"CPU metrics are expected to be missing in this integ test\")\n+    @AErrorPatternIgnored(\n+            pattern = \"Metric:gather()\",\n+            reason = \"Metrics are expected to be missing in this integ test\")\n+    @AErrorPatternIgnored(\n+            pattern = \"NodeConfigCacheReaderUtil\",\n+            reason = \"Node Config Cache are expected to be missing in this integ test.\")\n+    @AErrorPatternIgnored(\n+            pattern = \"CacheUtil:getCacheMaxSize()\",\n+            reason = \"Node Config Cache is expected to be missing during startup.\")\n+    @AErrorPatternIgnored(\n+            pattern = \"SubscribeResponseHandler:onError()\",\n+            reason = \"A unit test expressly calls SubscribeResponseHandler#onError, which writes an error log\")\n+    @AErrorPatternIgnored(\n+            pattern = \"SQLParsingUtil:readDataFromSqlResult()\",\n+            reason = \"Old gen metrics is expected to be missing in this integ test.\")\n+    @AErrorPatternIgnored(\n+            pattern = \"HighHeapUsageOldGenRca:operate()\",\n+            reason = \"Old gen rca is expected to be missing in this integ test.\")\n+    @AErrorPatternIgnored(\n+            pattern = \"ModifyCacheMaxSizeAction:build()\",\n+            reason = \"Node Config Cache metrics is expected to be missing during startup\")", "originalCommit": "3f1f0fe941c5c958b86b2ff0f8edfb22d600ce27", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcxMDg0NQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r497710845", "bodyText": "All cache metrics are available in node config cache. But during shutdown, node config cache gets cleared before stopping the deciders and hence we are seeing this error.\nRe-running the tests, makes the tests pass. Adding this to avoid flaky tests.", "author": "sruti1312", "createdAt": "2020-09-30T18:19:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMxMzM2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMxNDA2NQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r496314065", "bodyText": "Instead of this, we should write the ModifyCacheMaxSizeAction.from_summar() method, and validate that action here.", "author": "vigyasharma", "createdAt": "2020-09-29T00:55:20Z", "path": "src/test/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/integTests/tests/cache_tuning/validator/FieldDataCacheDeciderValidator.java", "diffHunk": "@@ -0,0 +1,71 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ *  A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  or in the \"license\" file accompanying this file. This file is distributed\n+ *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *  express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.validator;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ModifyCacheMaxSizeAction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.api.IValidator;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.persistence.actions.PersistedAction;\n+import org.junit.Assert;\n+\n+public class FieldDataCacheDeciderValidator implements IValidator {\n+    long startTime;\n+\n+    public FieldDataCacheDeciderValidator() {\n+        startTime = System.currentTimeMillis();\n+    }\n+\n+    /**\n+     * {\"actionName\":\"ModifyCacheMaxSize\",\n+     * \"resourceValue\":10,\n+     * \"timestamp\":\"1599257910923\",\n+     * \"nodeId\":{node1},\n+     * \"nodeIp\":{1.1.1.1},\n+     * \"actionable\":1,\n+     * \"coolOffPeriod\": 300000\n+     * \"muted\": 1\n+     * \"summary\": Update [FIELD_DATA_CACHE] capacity from [10000] to [100000] on node [DATA_0]\n+     */\n+    @Override\n+    public boolean checkDbObj(Object object) {\n+        if (object == null) {\n+            return false;\n+        }\n+        PersistedAction persistedAction = (PersistedAction) object;\n+        return checkPersistedAction(persistedAction);\n+    }\n+\n+    /**\n+     * {\"actionName\":\"ModifyCacheMaxSize\",\n+     * \"resourceValue\":10,\n+     * \"timestamp\":\"1599257910923\",\n+     * \"nodeIds\":{node1},\n+     * \"nodeIps\":{1.1.1.1},\n+     * \"actionable\":1,\n+     * \"coolOffPeriod\": 300000\n+     * \"muted\": 1\n+     * \"summary\": Update [FIELD_DATA_CACHE] capacity from [10000] to [100000] on node [DATA_0]\n+     *\n+     */\n+    private boolean checkPersistedAction(final PersistedAction persistedAction) {", "originalCommit": "3f1f0fe941c5c958b86b2ff0f8edfb22d600ce27", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcxMTQ1Ng==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r497711456", "bodyText": "Added from_summary method, and using that method for validations.", "author": "sruti1312", "createdAt": "2020-09-30T18:20:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMxNDA2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMxNDE0Nw==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r496314147", "bodyText": "Same as FD cache", "author": "vigyasharma", "createdAt": "2020-09-29T00:55:40Z", "path": "src/test/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/integTests/tests/cache_tuning/validator/ShardRequestCacheDeciderValidator.java", "diffHunk": "@@ -0,0 +1,70 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ *  A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  or in the \"license\" file accompanying this file. This file is distributed\n+ *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *  express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.validator;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ModifyCacheMaxSizeAction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.api.IValidator;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.persistence.actions.PersistedAction;\n+import org.junit.Assert;\n+\n+public class ShardRequestCacheDeciderValidator implements IValidator {\n+    long startTime;\n+\n+    public ShardRequestCacheDeciderValidator() {\n+        startTime = System.currentTimeMillis();\n+    }\n+\n+    /**\n+     * {\"actionName\":\"ModifyCacheMaxSize\",\n+     * \"resourceValue\":11,\n+     * \"timestamp\":\"1599257910923\",\n+     * \"nodeId\":\"node1\",\n+     * \"nodeIp\":1.1.1.1,\n+     * \"actionable\":1,\n+     * \"coolOffPeriod\": 300000,\n+     * \"muted\": 1,\n+     * \"summary\": Update [SHARD_REQUEST_CACHE] capacity from [10000] to [100000] on node [DATA_0]\n+     */\n+    @Override\n+    public boolean checkDbObj(Object object) {\n+        if (object == null) {\n+            return false;\n+        }\n+        PersistedAction persistedAction = (PersistedAction) object;\n+        return checkPersistedAction(persistedAction);\n+    }\n+\n+    /**\n+     * {\"actionName\":\"ModifyCacheMaxSize\",\n+     * \"resourceValue\":11,\n+     * \"timestamp\":\"1599257910923\",\n+     * \"nodeId\":\"node1\",\n+     * \"nodeIp\":1.1.1.1,\n+     * \"actionable\":1,\n+     * \"coolOffPeriod\": 300000,\n+     * \"muted\": 1\n+     * \"summary\": Update [SHARD_REQUEST_CACHE] capacity from [10000] to [100000] on node [DATA_0]\n+     */\n+    private boolean checkPersistedAction(final PersistedAction persistedAction) {", "originalCommit": "3f1f0fe941c5c958b86b2ff0f8edfb22d600ce27", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcxMTY1Nw==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r497711657", "bodyText": "Added from_summary method and using for validations.", "author": "sruti1312", "createdAt": "2020-09-30T18:20:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMxNDE0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMxNDM3NQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r496314375", "bodyText": "We should also add tests for the other two cluster types - SINGLE_NODE and MULTI_NODE_DEDICATED_MASTER.\nMULTI_NODE_DEDICATED_MASTER is particularly important.", "author": "vigyasharma", "createdAt": "2020-09-29T00:56:35Z", "path": "src/test/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/integTests/tests/cache_tuning/ShardRequestCacheDeciderITest.java", "diffHunk": "@@ -0,0 +1,256 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ *  A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  or in the \"license\" file accompanying this file. This file is distributed\n+ *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *  express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning;\n+\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.ShardRequestCacheDeciderITest.INDEX_NAME;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.ShardRequestCacheDeciderITest.SHARD_ID;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.metrics.AllMetrics;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_FieldData_Eviction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_FieldData_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Max_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Request_Eviction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Request_Hit;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Request_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Heap_Max;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.RcaItMarker;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AClusterType;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AErrorPatternIgnored;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AExpect;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AMetric;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ARcaConf;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ARcaGraph;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ATable;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ATuple;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.ClusterType;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.Consts;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.HostTag;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.runners.RcaItNotEncryptedRunner;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.validator.ShardRequestCacheDeciderValidator;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.persistence.actions.PersistedAction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.ElasticSearchAnalysisGraph;\n+import org.junit.Test;\n+import org.junit.experimental.categories.Category;\n+import org.junit.runner.RunWith;\n+\n+@Category(RcaItMarker.class)\n+@RunWith(RcaItNotEncryptedRunner.class)\n+@AClusterType(ClusterType.MULTI_NODE_CO_LOCATED_MASTER)", "originalCommit": "3f1f0fe941c5c958b86b2ff0f8edfb22d600ce27", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMyNjU1Mg==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r496326552", "bodyText": "Right. I have added dedicated master tests to this PR. I will create a new PR for single node clusters. I am seeing some errors with them.", "author": "sruti1312", "createdAt": "2020-09-29T01:43:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMxNDM3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMxNDkzMQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r496314931", "bodyText": "Why are we making it a generic DB_QUERY? Can we instead make it an Action since that is what we persist in the table. And use from_summary() methods to create actions from summary.\nThe summary will contain entire details of the action which may create some redundancy with existing columns in the persisted action table, but that should be fine.\nI think this IT PR should also include the change to create actions from summary strings, and use them for validation.", "author": "vigyasharma", "createdAt": "2020-09-29T00:58:49Z", "path": "src/test/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/integTests/framework/annotations/AExpect.java", "diffHunk": "@@ -53,7 +53,8 @@\n    * Currently supported places to look for RCA outputs are the SQLite file or by hitting the rest endpoint.\n    */\n   enum Type {\n-    REST_API\n+    REST_API,\n+    DB_QUERY", "originalCommit": "3f1f0fe941c5c958b86b2ff0f8edfb22d600ce27", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzczNTA3Nw==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r497735077", "bodyText": "Retaining DB_QUERY to enable querying the sqlite tables. With regard to Action, after Action API is implemented (in progress presently), we will move to use the REST_API instead (like rca's ) instead of querying the tables.", "author": "sruti1312", "createdAt": "2020-09-30T19:02:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMxNDkzMQ=="}], "type": "inlineReview"}, {"oid": "b19b7a02ebc386f4d1c27d41fb29129bfda365e8", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/b19b7a02ebc386f4d1c27d41fb29129bfda365e8", "message": "Add cache IT for dedicated master", "committedDate": "2020-09-30T15:34:49Z", "type": "commit"}, {"oid": "4f8d6d881af2425ba47ba3d2293a191bca8998a4", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/4f8d6d881af2425ba47ba3d2293a191bca8998a4", "message": "Address PR comments", "committedDate": "2020-09-30T17:23:45Z", "type": "commit"}, {"oid": "11b349a8530fec2faf974117bb0a9e079a81c449", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/11b349a8530fec2faf974117bb0a9e079a81c449", "message": "Remove unnecessary metrics from IT", "committedDate": "2020-09-30T18:22:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc0ODUxNg==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r497748516", "bodyText": "Does master node emit this metric for given dimensions, if you don't have any shards on the master node?", "author": "vigyasharma", "createdAt": "2020-09-30T19:27:19Z", "path": "src/test/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/integTests/tests/cache_tuning/dedicated_master/CacheRcaDedicatedMasterITest.java", "diffHunk": "@@ -0,0 +1,253 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ *  A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  or in the \"license\" file accompanying this file. This file is distributed\n+ *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *  express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.dedicated_master;\n+\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.Constants.CACHE_TUNING_RESOURCES_DIR;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.Constants.INDEX_NAME;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.Constants.SHARD_ID;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.metrics.AllMetrics;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_FieldData_Eviction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_FieldData_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Max_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Request_Eviction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Request_Hit;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Request_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.RcaItMarker;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AClusterType;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AErrorPatternIgnored;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AExpect;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AMetric;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ARcaConf;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ARcaGraph;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ATable;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ATuple;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.ClusterType;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.Consts;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.HostTag;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.runners.RcaItNotEncryptedRunner;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.Constants;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.validator.FieldDataCacheValidator;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.validator.ShardRequestCacheValidator;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.ElasticSearchAnalysisGraph;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.rca.cluster.FieldDataCacheClusterRca;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.rca.cluster.ShardRequestCacheClusterRca;\n+import org.junit.Test;\n+import org.junit.experimental.categories.Category;\n+import org.junit.runner.RunWith;\n+\n+@Category(RcaItMarker.class)\n+@RunWith(RcaItNotEncryptedRunner.class)\n+@AClusterType(ClusterType.MULTI_NODE_DEDICATED_MASTER)\n+@ARcaGraph(ElasticSearchAnalysisGraph.class)\n+//specify a custom rca.conf to set the collector time periods to 5s to reduce runtime\n+@ARcaConf(dataNode = CACHE_TUNING_RESOURCES_DIR + \"rca.conf\")\n+@AMetric(\n+        name = Cache_FieldData_Size.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 8500.0, avg = 8500.0, min = 8500.0, max = 8500.0)\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},", "originalCommit": "11b349a8530fec2faf974117bb0a9e079a81c449", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQwNjcyMA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r498406720", "bodyText": "Right. cache size metric, hits and evictions will be unable in dedicated master. Removing them", "author": "sruti1312", "createdAt": "2020-10-01T17:29:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc0ODUxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc0OTQ4Mg==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r497749482", "bodyText": "Same as above, please confirm and remove if this metric is missing from dedicated master scenarios. We want to make sure the integ tests simulate actual cluster scenarios, and that there are no NPEs due to missing shards.", "author": "vigyasharma", "createdAt": "2020-09-30T19:29:00Z", "path": "src/test/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/integTests/tests/cache_tuning/dedicated_master/CacheRcaDedicatedMasterITest.java", "diffHunk": "@@ -0,0 +1,253 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ *  A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  or in the \"license\" file accompanying this file. This file is distributed\n+ *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *  express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.dedicated_master;\n+\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.Constants.CACHE_TUNING_RESOURCES_DIR;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.Constants.INDEX_NAME;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.Constants.SHARD_ID;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.metrics.AllMetrics;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_FieldData_Eviction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_FieldData_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Max_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Request_Eviction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Request_Hit;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Request_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.RcaItMarker;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AClusterType;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AErrorPatternIgnored;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AExpect;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AMetric;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ARcaConf;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ARcaGraph;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ATable;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ATuple;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.ClusterType;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.Consts;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.HostTag;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.runners.RcaItNotEncryptedRunner;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.Constants;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.validator.FieldDataCacheValidator;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.validator.ShardRequestCacheValidator;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.ElasticSearchAnalysisGraph;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.rca.cluster.FieldDataCacheClusterRca;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.rca.cluster.ShardRequestCacheClusterRca;\n+import org.junit.Test;\n+import org.junit.experimental.categories.Category;\n+import org.junit.runner.RunWith;\n+\n+@Category(RcaItMarker.class)\n+@RunWith(RcaItNotEncryptedRunner.class)\n+@AClusterType(ClusterType.MULTI_NODE_DEDICATED_MASTER)\n+@ARcaGraph(ElasticSearchAnalysisGraph.class)\n+//specify a custom rca.conf to set the collector time periods to 5s to reduce runtime\n+@ARcaConf(dataNode = CACHE_TUNING_RESOURCES_DIR + \"rca.conf\")\n+@AMetric(\n+        name = Cache_FieldData_Size.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 8500.0, avg = 8500.0, min = 8500.0, max = 8500.0)\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 100.0, avg = 100.0, min = 100.0, max = 100.0)\n+                        })\n+        })\n+@AMetric(\n+        name = Cache_FieldData_Eviction.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 1.0, avg = 1.0, min = 1.0, max = 1.0)\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},", "originalCommit": "11b349a8530fec2faf974117bb0a9e079a81c449", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc0OTcwNA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r497749704", "bodyText": "Same as above, pls confirm metric is present on dedicated masters.", "author": "vigyasharma", "createdAt": "2020-09-30T19:29:20Z", "path": "src/test/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/integTests/tests/cache_tuning/dedicated_master/CacheRcaDedicatedMasterITest.java", "diffHunk": "@@ -0,0 +1,253 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ *  A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  or in the \"license\" file accompanying this file. This file is distributed\n+ *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *  express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.dedicated_master;\n+\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.Constants.CACHE_TUNING_RESOURCES_DIR;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.Constants.INDEX_NAME;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.Constants.SHARD_ID;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.metrics.AllMetrics;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_FieldData_Eviction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_FieldData_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Max_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Request_Eviction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Request_Hit;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Request_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.RcaItMarker;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AClusterType;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AErrorPatternIgnored;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AExpect;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AMetric;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ARcaConf;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ARcaGraph;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ATable;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ATuple;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.ClusterType;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.Consts;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.HostTag;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.runners.RcaItNotEncryptedRunner;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.Constants;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.validator.FieldDataCacheValidator;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.validator.ShardRequestCacheValidator;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.ElasticSearchAnalysisGraph;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.rca.cluster.FieldDataCacheClusterRca;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.rca.cluster.ShardRequestCacheClusterRca;\n+import org.junit.Test;\n+import org.junit.experimental.categories.Category;\n+import org.junit.runner.RunWith;\n+\n+@Category(RcaItMarker.class)\n+@RunWith(RcaItNotEncryptedRunner.class)\n+@AClusterType(ClusterType.MULTI_NODE_DEDICATED_MASTER)\n+@ARcaGraph(ElasticSearchAnalysisGraph.class)\n+//specify a custom rca.conf to set the collector time periods to 5s to reduce runtime\n+@ARcaConf(dataNode = CACHE_TUNING_RESOURCES_DIR + \"rca.conf\")\n+@AMetric(\n+        name = Cache_FieldData_Size.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 8500.0, avg = 8500.0, min = 8500.0, max = 8500.0)\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 100.0, avg = 100.0, min = 100.0, max = 100.0)\n+                        })\n+        })\n+@AMetric(\n+        name = Cache_FieldData_Eviction.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 1.0, avg = 1.0, min = 1.0, max = 1.0)\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 0.0, avg = 0.0, min = 0.0, max = 0.0)\n+                        })\n+        })\n+@AMetric(\n+        name = Cache_Request_Size.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 100.0, avg = 100.0, min = 100.0, max = 100.0)\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},", "originalCommit": "11b349a8530fec2faf974117bb0a9e079a81c449", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc0OTgzNA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r497749834", "bodyText": "Same as above, pls confirm metric is present on dedicated masters.", "author": "vigyasharma", "createdAt": "2020-09-30T19:29:30Z", "path": "src/test/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/integTests/tests/cache_tuning/dedicated_master/CacheRcaDedicatedMasterITest.java", "diffHunk": "@@ -0,0 +1,253 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ *  A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  or in the \"license\" file accompanying this file. This file is distributed\n+ *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *  express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.dedicated_master;\n+\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.Constants.CACHE_TUNING_RESOURCES_DIR;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.Constants.INDEX_NAME;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.Constants.SHARD_ID;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.metrics.AllMetrics;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_FieldData_Eviction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_FieldData_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Max_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Request_Eviction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Request_Hit;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Request_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.RcaItMarker;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AClusterType;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AErrorPatternIgnored;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AExpect;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AMetric;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ARcaConf;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ARcaGraph;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ATable;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ATuple;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.ClusterType;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.Consts;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.HostTag;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.runners.RcaItNotEncryptedRunner;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.Constants;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.validator.FieldDataCacheValidator;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.validator.ShardRequestCacheValidator;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.ElasticSearchAnalysisGraph;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.rca.cluster.FieldDataCacheClusterRca;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.rca.cluster.ShardRequestCacheClusterRca;\n+import org.junit.Test;\n+import org.junit.experimental.categories.Category;\n+import org.junit.runner.RunWith;\n+\n+@Category(RcaItMarker.class)\n+@RunWith(RcaItNotEncryptedRunner.class)\n+@AClusterType(ClusterType.MULTI_NODE_DEDICATED_MASTER)\n+@ARcaGraph(ElasticSearchAnalysisGraph.class)\n+//specify a custom rca.conf to set the collector time periods to 5s to reduce runtime\n+@ARcaConf(dataNode = CACHE_TUNING_RESOURCES_DIR + \"rca.conf\")\n+@AMetric(\n+        name = Cache_FieldData_Size.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 8500.0, avg = 8500.0, min = 8500.0, max = 8500.0)\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 100.0, avg = 100.0, min = 100.0, max = 100.0)\n+                        })\n+        })\n+@AMetric(\n+        name = Cache_FieldData_Eviction.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 1.0, avg = 1.0, min = 1.0, max = 1.0)\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 0.0, avg = 0.0, min = 0.0, max = 0.0)\n+                        })\n+        })\n+@AMetric(\n+        name = Cache_Request_Size.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 100.0, avg = 100.0, min = 100.0, max = 100.0)\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 50.0, avg = 50.0, min = 50.0, max = 50.0)\n+                        })\n+        })\n+@AMetric(\n+        name = Cache_Request_Eviction.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 1.0, avg = 1.0, min = 1.0, max = 1.0)\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},", "originalCommit": "11b349a8530fec2faf974117bb0a9e079a81c449", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc1MDY0Mg==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r497750642", "bodyText": "Same as above, pls confirm metric is present on dedicated masters.", "author": "vigyasharma", "createdAt": "2020-09-30T19:30:59Z", "path": "src/test/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/integTests/tests/cache_tuning/dedicated_master/FieldDataCacheDeciderDedicatedMasterITest.java", "diffHunk": "@@ -0,0 +1,173 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ *  A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  or in the \"license\" file accompanying this file. This file is distributed\n+ *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *  express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.dedicated_master;\n+\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.Constants.CACHE_TUNING_RESOURCES_DIR;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.Constants.INDEX_NAME;\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.Constants.SHARD_ID;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.metrics.AllMetrics;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_FieldData_Eviction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_FieldData_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Cache_Max_Size;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.metrics.Heap_Max;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.RcaItMarker;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AClusterType;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AErrorPatternIgnored;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AExpect;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.AMetric;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ARcaConf;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ARcaGraph;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ATable;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.annotations.ATuple;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.ClusterType;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.configs.HostTag;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.runners.RcaItNotEncryptedRunner;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.validator.FieldDataCacheDeciderValidator;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.persistence.actions.PersistedAction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.ElasticSearchAnalysisGraph;\n+import org.junit.Test;\n+import org.junit.experimental.categories.Category;\n+import org.junit.runner.RunWith;\n+\n+@Category(RcaItMarker.class)\n+@RunWith(RcaItNotEncryptedRunner.class)\n+@AClusterType(ClusterType.MULTI_NODE_CO_LOCATED_MASTER)\n+@ARcaGraph(ElasticSearchAnalysisGraph.class)\n+//specify a custom rca.conf to set the collector time periods to 5s to reduce runtime\n+@ARcaConf(dataNode = CACHE_TUNING_RESOURCES_DIR + \"rca.conf\")\n+@AMetric(\n+        name = Cache_FieldData_Size.class,\n+        dimensionNames = {\n+                AllMetrics.CommonDimension.Constants.INDEX_NAME_VALUE,\n+                AllMetrics.CommonDimension.Constants.SHARDID_VALUE\n+        },\n+        tables = {\n+                @ATable(\n+                        hostTag = HostTag.DATA_0,\n+                        tuple = {\n+                                @ATuple(\n+                                        dimensionValues = {INDEX_NAME, SHARD_ID},\n+                                        sum = 8500.0, avg = 8500.0, min = 8500.0, max = 8500.0)\n+                        }),\n+                @ATable(\n+                        hostTag = {HostTag.ELECTED_MASTER},", "originalCommit": "11b349a8530fec2faf974117bb0a9e079a81c449", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc1MTM3Mg==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/434#discussion_r497751372", "bodyText": "Nice, thanks for making this change.", "author": "vigyasharma", "createdAt": "2020-09-30T19:32:26Z", "path": "src/test/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/integTests/tests/cache_tuning/validator/FieldDataCacheDeciderValidator.java", "diffHunk": "@@ -0,0 +1,82 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ *  A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  or in the \"license\" file accompanying this file. This file is distributed\n+ *  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *  express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.tests.cache_tuning.validator;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.AppContext;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ModifyCacheMaxSizeAction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.grpc.ResourceEnum;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.integTests.framework.api.IValidator;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.persistence.actions.PersistedAction;\n+import org.junit.Assert;\n+\n+public class FieldDataCacheDeciderValidator implements IValidator {\n+    AppContext appContext;\n+    long startTime;\n+\n+    public FieldDataCacheDeciderValidator() {\n+        appContext = new AppContext();\n+        startTime = System.currentTimeMillis();\n+    }\n+\n+    /**\n+     * {\"actionName\":\"ModifyCacheMaxSize\",\n+     * \"resourceValue\":10,\n+     * \"timestamp\":\"1599257910923\",\n+     * \"nodeId\":{node1},\n+     * \"nodeIp\":{1.1.1.1},\n+     * \"actionable\":1,\n+     * \"coolOffPeriod\": 300000\n+     * \"muted\": 1\n+     * \"summary\": \"Id\":\"DATA_0\",\"Ip\":\"127.0.0.1\",\"resource\":10,\"desiredCacheMaxSizeInBytes\":100000,\n+     *            \"currentCacheMaxSizeInBytes\":10000,\"coolOffPeriodInMillis\":300000,\"canUpdate\":true}\n+     */\n+    @Override\n+    public boolean checkDbObj(Object object) {\n+        if (object == null) {\n+            return false;\n+        }\n+        PersistedAction persistedAction = (PersistedAction) object;\n+        return checkPersistedAction(persistedAction);\n+    }\n+\n+    /**\n+     * {\"actionName\":\"ModifyCacheMaxSize\",\n+     * \"resourceValue\":10,\n+     * \"timestamp\":\"1599257910923\",\n+     * \"nodeIds\":{node1},\n+     * \"nodeIps\":{1.1.1.1},\n+     * \"actionable\":1,\n+     * \"coolOffPeriod\": 300000\n+     * \"muted\": 1\n+     * \"summary\": \"Id\":\"DATA_0\",\"Ip\":\"127.0.0.1\",\"resource\":10,\"desiredCacheMaxSizeInBytes\":100000,\n+     *            \"currentCacheMaxSizeInBytes\":10000,\"coolOffPeriodInMillis\":300000,\"canUpdate\":true}\n+     *\n+     */\n+    private boolean checkPersistedAction(final PersistedAction persistedAction) {\n+        ModifyCacheMaxSizeAction modifyCacheMaxSizeAction =\n+                ModifyCacheMaxSizeAction.fromSummary(persistedAction.getSummary(), appContext);", "originalCommit": "11b349a8530fec2faf974117bb0a9e079a81c449", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c0278f8434aeacff14717efd20c69ef653a4bdc8", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/c0278f8434aeacff14717efd20c69ef653a4bdc8", "message": "Remove unnecessary metrics from IT", "committedDate": "2020-10-01T17:18:31Z", "type": "commit"}, {"oid": "30e54668ee969eb71b09ba057db210ae76a2263c", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/30e54668ee969eb71b09ba057db210ae76a2263c", "message": "Remove cache metrics in elected master", "committedDate": "2020-10-01T17:27:13Z", "type": "commit"}]}