{"pr_number": 452, "pr_title": "Bucketized Sliding Window with Alarm Monitors", "pr_createdAt": "2020-10-04T08:02:30Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/452", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkyMTI3Mg==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/452#discussion_r499921272", "bodyText": "nit: If you convert this to milliseconds, you get a much simpler comparison on line 40", "author": "sidheart", "createdAt": "2020-10-05T23:14:04Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/framework/api/aggregators/BucketizedSlidingWindow.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.aggregators;\n+\n+import java.util.concurrent.TimeUnit;\n+\n+/**\n+ * The BucketizedSlidingWindow provides a SlidingWindow implementation that can aggregate all\n+ * inserts within a configured time range, BUCKET_WINDOW_SIZE, into a single data point.\n+ *\n+ * <p>All data within a single bucket window time range is summed by default.\n+ */\n+public class BucketizedSlidingWindow extends SlidingWindow<SlidingWindowData> {\n+\n+  private final long BUCKET_WINDOW_SIZE;\n+\n+  public BucketizedSlidingWindow(int SLIDING_WINDOW_SIZE, int BUCKET_WINDOW_SIZE, TimeUnit timeUnit) {\n+    super(SLIDING_WINDOW_SIZE, timeUnit);\n+    assert BUCKET_WINDOW_SIZE < SLIDING_WINDOW_SIZE : \"BucketWindow size should be less than SlidingWindow size\";\n+    this.BUCKET_WINDOW_SIZE = timeUnit.toSeconds(BUCKET_WINDOW_SIZE);", "originalCommit": "68ad86a29854c49a70808a82aa5616e17947bcc7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ3NzM0Nw==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/452#discussion_r500477347", "bodyText": "nit: interface methods are public by default", "author": "ktkrg", "createdAt": "2020-10-06T17:35:29Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciders/AlarmMonitor.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders;\n+\n+/**\n+ * AlarmMonitor evaluates and maintains the state of an alarm.\n+ *\n+ * <p>An alarm can either be healthy or unhealthy.\n+ */\n+public interface AlarmMonitor {\n+\n+  /**\n+   * Invoked whenever an issue needs to be recorded with the monitor\n+   * @param timeStamp Issue timestamp in millis\n+   * @param value Issues can be recorded with an intensity value\n+   */\n+  public void recordIssue(long timeStamp, double value);\n+\n+  public default void recordIssue() {\n+    recordIssue(System.currentTimeMillis(), 1);\n+  }\n+\n+  /**\n+   * State of the alarm\n+   * @return true if alarm is in healthy state, false otherwise\n+   */\n+  public boolean isHealthy();", "originalCommit": "68ad86a29854c49a70808a82aa5616e17947bcc7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ3OTk1MQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/452#discussion_r500479951", "bodyText": "These values can be the defaults. We should also have these as constructor params so that someday if we wanted to change thresholds for a particular JVM action, we don't need to extend this just to set different thresholds. What do you think?", "author": "ktkrg", "createdAt": "2020-10-06T17:40:02Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciders/jvm/JvmActionsAlarmMonitor.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders.jvm;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders.AlarmMonitor;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.aggregators.BucketizedSlidingWindow;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.aggregators.SlidingWindowData;\n+import com.google.common.annotations.VisibleForTesting;\n+import java.util.concurrent.TimeUnit;\n+\n+public class JvmActionsAlarmMonitor implements AlarmMonitor {\n+\n+  public static final int DAY_BREACH_THRESHOLD = 5;\n+  public static final int WEEK_BREACH_THRESHOLD = 2;", "originalCommit": "68ad86a29854c49a70808a82aa5616e17947bcc7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYyOTI1OQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/452#discussion_r500629259", "bodyText": "Makes sense, will change before merging.", "author": "vigyasharma", "createdAt": "2020-10-06T22:22:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ3OTk1MQ=="}], "type": "inlineReview"}, {"oid": "def6414f9c7f74d753c52c0cb17cdadfd5fefa40", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/def6414f9c7f74d753c52c0cb17cdadfd5fefa40", "message": "Bucketized sliding window impl.", "committedDate": "2020-10-07T20:22:16Z", "type": "commit"}, {"oid": "6d341a18dbd80f4a8173f0ba545503b290601da4", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/6d341a18dbd80f4a8173f0ba545503b290601da4", "message": "jvm action monitor and bucketized sliding window tests", "committedDate": "2020-10-07T20:22:16Z", "type": "commit"}, {"oid": "df243220b39b9d6bb302fe9da66d55f91cac52a4", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/df243220b39b9d6bb302fe9da66d55f91cac52a4", "message": "Jvm action alarm monitor tests and bug fixes", "committedDate": "2020-10-07T20:22:16Z", "type": "commit"}, {"oid": "ea50f540f7ba982bcb264a85b3ec91a5b12a2b86", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/ea50f540f7ba982bcb264a85b3ec91a5b12a2b86", "message": "Checkstyle error fix", "committedDate": "2020-10-07T20:22:16Z", "type": "commit"}, {"oid": "e772bff0a9bb0e922ffa2983bd4bbbf2cff472d6", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/e772bff0a9bb0e922ffa2983bd4bbbf2cff472d6", "message": "Honor bucket window size via [start, end) inclusion range", "committedDate": "2020-10-07T20:22:16Z", "type": "commit"}, {"oid": "9d6667850d895ff05e7df21271cf908d731000cb", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/9d6667850d895ff05e7df21271cf908d731000cb", "message": "Addressed PR comments", "committedDate": "2020-10-07T20:22:16Z", "type": "commit"}, {"oid": "9d6667850d895ff05e7df21271cf908d731000cb", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/9d6667850d895ff05e7df21271cf908d731000cb", "message": "Addressed PR comments", "committedDate": "2020-10-07T20:22:16Z", "type": "forcePushed"}]}