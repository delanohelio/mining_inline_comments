{"pr_number": 289, "pr_title": "Reading Decider Action Priorities from YML", "pr_createdAt": "2020-07-17T08:50:14Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289", "timeline": [{"oid": "4fba88fe0114e801f75465e73194fa6e796ea98e", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/4fba88fe0114e801f75465e73194fa6e796ea98e", "message": "Reading Decider Action Priorities from YML", "committedDate": "2020-07-17T08:40:43Z", "type": "commit"}, {"oid": "273d788740505025fb350c3649b8dab8f9a00027", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/273d788740505025fb350c3649b8dab8f9a00027", "message": "Fixing Checkstyle Errors", "committedDate": "2020-07-17T22:50:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc0MDI3OQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r456740279", "bodyText": "Let's move yml file name to a constant that can be changed for tests", "author": "vigyasharma", "createdAt": "2020-07-18T02:58:06Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/ConfigReader.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders.Decider;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.yaml.YAMLFactory;\n+import java.io.File;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+\n+public class ConfigReader {\n+    public static HashMap<Decider, ArrayList<String>> getDeciderActionPriorityOrder() {\n+        ObjectMapper mapper = new ObjectMapper(new YAMLFactory());\n+        HashMap<Decider, ArrayList<String>> deciderActionPriorityOrder = null;\n+        try {\n+            deciderActionPriorityOrder = mapper.readValue(new File(\"deciderConfig.yml\"), HashMap.class);", "originalCommit": "273d788740505025fb350c3649b8dab8f9a00027", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY4NjQ0NA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r457686444", "bodyText": "Good Point. Done", "author": "aditjind", "createdAt": "2020-07-20T20:55:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc0MDI3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc0MDU3Ng==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r456740576", "bodyText": "Looks like the yml is read and created each time someone fetches action priority. How about parsing and storing it ones, during load/init?", "author": "vigyasharma", "createdAt": "2020-07-18T03:01:52Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/ConfigReader.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders.Decider;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.yaml.YAMLFactory;\n+import java.io.File;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+\n+public class ConfigReader {\n+    public static HashMap<Decider, ArrayList<String>> getDeciderActionPriorityOrder() {\n+        ObjectMapper mapper = new ObjectMapper(new YAMLFactory());\n+        HashMap<Decider, ArrayList<String>> deciderActionPriorityOrder = null;", "originalCommit": "273d788740505025fb350c3649b8dab8f9a00027", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY5NDY0Ng==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r457694646", "bodyText": "Yup. Updated in the latest version.", "author": "aditjind", "createdAt": "2020-07-20T21:12:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc0MDU3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc0MDY3OQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r456740679", "bodyText": "Use NAME instead of this.getClass().getName()", "author": "vigyasharma", "createdAt": "2020-07-18T03:03:30Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciders/QueueHealthDecider.java", "diffHunk": "@@ -81,8 +81,8 @@ public Decision operate() {\n   }\n \n   private void configureActionPriority() {\n-    // TODO: Input from user configured yml\n-    this.actionsByUserPriority.add(ModifyQueueCapacityAction.NAME);\n+    ArrayList<String> actionPriority = getDeciderActionPriorityOrder(this.getClass().getName());", "originalCommit": "273d788740505025fb350c3649b8dab8f9a00027", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY5NDQzNw==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r457694437", "bodyText": "Updated", "author": "aditjind", "createdAt": "2020-07-20T21:12:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc0MDY3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc0MDcyNQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r456740725", "bodyText": "If ConfigReader can store the priority hashmap in memory, then each decider doesn't need to store it. Config reader can expose the getter methods", "author": "vigyasharma", "createdAt": "2020-07-18T03:04:18Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciders/Decider.java", "diffHunk": "@@ -41,10 +45,12 @@\n \n   private static final Logger LOG = LogManager.getLogger(Decider.class);\n   protected final int decisionFrequency; // Measured in terms of number of evaluationIntervalPeriods\n+  private final HashMap<Decider, ArrayList<String>> deciderActionPriorityOrder;\n \n   public Decider(long evalIntervalSeconds, int decisionFrequency) {\n     super(0, evalIntervalSeconds);\n     this.decisionFrequency = decisionFrequency;\n+    this.deciderActionPriorityOrder = ConfigReader.getDeciderActionPriorityOrder();", "originalCommit": "273d788740505025fb350c3649b8dab8f9a00027", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY5Mjg1Mg==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r457692852", "bodyText": "Modified in the latest version.", "author": "aditjind", "createdAt": "2020-07-20T21:08:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc0MDcyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc0MDczNw==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r456740737", "bodyText": "nit: rename to something specific to action priorities?", "author": "vigyasharma", "createdAt": "2020-07-18T03:04:47Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/ConfigReader.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders.Decider;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.yaml.YAMLFactory;\n+import java.io.File;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+\n+public class ConfigReader {", "originalCommit": "273d788740505025fb350c3649b8dab8f9a00027", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY4MjA5NA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r457682094", "bodyText": "Made is so as to read any kind of config which the decider needs and not just the action priorities. If we dont anticipate any such config I can rename it.", "author": "aditjind", "createdAt": "2020-07-20T20:47:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc0MDczNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc1OTcwNg==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r457759706", "bodyText": "I think we should limit this one to only action priorities, to keep it simple to read. Configuration values could go into rca.conf along with other config values. But you can take a call on that if you think there are other decider level configs that should belong here.\nAlso, if you want to make it generic you (at least) need another level of hierarchy in the yml, right?", "author": "vigyasharma", "createdAt": "2020-07-21T00:08:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc0MDczNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM4Mjc3Mw==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r458382773", "bodyText": "Modified to just use the decider Action Priorities.", "author": "aditjind", "createdAt": "2020-07-21T20:56:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc0MDczNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUzOTkyNg==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r457539926", "bodyText": "Is there any specific reason to from from YML instead of JSON ? All RCA related configs are stored in JSON file and why do we want to switch to a different format in decision maker ?", "author": "rguo-aws", "createdAt": "2020-07-20T16:29:02Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/ConfigReader.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders.Decider;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.yaml.YAMLFactory;\n+import java.io.File;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+\n+public class ConfigReader {\n+    public static HashMap<Decider, ArrayList<String>> getDeciderActionPriorityOrder() {\n+        ObjectMapper mapper = new ObjectMapper(new YAMLFactory());", "originalCommit": "273d788740505025fb350c3649b8dab8f9a00027", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY4MzA4Mw==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r457683083", "bodyText": "We want it to be a yml because we want to provide the ODFE users as an ability to provide the priorities. Since ES follows a YML model, we don't want to disrupt that and provide the users an ability to provide the same via YML only.", "author": "aditjind", "createdAt": "2020-07-20T20:49:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUzOTkyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU0MDMxMw==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r457540313", "bodyText": "Add an error  log here ?", "author": "rguo-aws", "createdAt": "2020-07-20T16:29:37Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/ConfigReader.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders.Decider;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.yaml.YAMLFactory;\n+import java.io.File;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+\n+public class ConfigReader {\n+    public static HashMap<Decider, ArrayList<String>> getDeciderActionPriorityOrder() {\n+        ObjectMapper mapper = new ObjectMapper(new YAMLFactory());\n+        HashMap<Decider, ArrayList<String>> deciderActionPriorityOrder = null;\n+        try {\n+            deciderActionPriorityOrder = mapper.readValue(new File(\"deciderConfig.yml\"), HashMap.class);\n+            return deciderActionPriorityOrder;\n+        } catch (Exception e) {\n+            e.printStackTrace();", "originalCommit": "273d788740505025fb350c3649b8dab8f9a00027", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY4ODY5MQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r457688691", "bodyText": "Done", "author": "aditjind", "createdAt": "2020-07-20T21:00:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU0MDMxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU0MDg3Nw==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r457540877", "bodyText": "this return statement seems to be redundant", "author": "rguo-aws", "createdAt": "2020-07-20T16:30:29Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/ConfigReader.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders.Decider;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.yaml.YAMLFactory;\n+import java.io.File;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+\n+public class ConfigReader {\n+    public static HashMap<Decider, ArrayList<String>> getDeciderActionPriorityOrder() {\n+        ObjectMapper mapper = new ObjectMapper(new YAMLFactory());\n+        HashMap<Decider, ArrayList<String>> deciderActionPriorityOrder = null;\n+        try {\n+            deciderActionPriorityOrder = mapper.readValue(new File(\"deciderConfig.yml\"), HashMap.class);\n+            return deciderActionPriorityOrder;", "originalCommit": "273d788740505025fb350c3649b8dab8f9a00027", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY4NjYwNQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r457686605", "bodyText": "right modified the whole structure.", "author": "aditjind", "createdAt": "2020-07-20T20:56:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU0MDg3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU0MTI4Mg==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r457541282", "bodyText": "Can we add Nullable annotation to this function ?", "author": "rguo-aws", "createdAt": "2020-07-20T16:31:05Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/ConfigReader.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders.Decider;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.yaml.YAMLFactory;\n+import java.io.File;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+\n+public class ConfigReader {\n+    public static HashMap<Decider, ArrayList<String>> getDeciderActionPriorityOrder() {", "originalCommit": "273d788740505025fb350c3649b8dab8f9a00027", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY4MjIzOQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r457682239", "bodyText": "Modified to keep the value in the class object itself.", "author": "aditjind", "createdAt": "2020-07-20T20:47:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU0MTI4Mg=="}], "type": "inlineReview"}, {"oid": "fac8c085e230483f62dc7ffc7023f47fc3eea4a9", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/fac8c085e230483f62dc7ffc7023f47fc3eea4a9", "message": "Addressing PR Comments", "committedDate": "2020-07-20T21:45:42Z", "type": "commit"}, {"oid": "7cbfc2a152542087d87e0344f989b84561f9d26b", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/7cbfc2a152542087d87e0344f989b84561f9d26b", "message": "Addressing PR Comments", "committedDate": "2020-07-20T21:50:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc1NzYyMQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r457757621", "bodyText": "Is this is the right way to provide file path for configuration files? What is the current directory here for ./...?\nPlease see how path has been specified for rca.conf in RcaConsts.java and change accordingly.", "author": "vigyasharma", "createdAt": "2020-07-21T00:00:51Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/ConfigReader.java", "diffHunk": "@@ -0,0 +1,36 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders.Decider;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.yaml.YAMLFactory;\n+import java.io.File;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+public class ConfigReader {\n+    private static final Logger LOG = LogManager.getLogger(ConfigReader.class);\n+    private static HashMap<Decider, ArrayList<String>> deciderActionPriorityOrder;\n+\n+    public static final String CONFIG_FILE_PATH = \"./pa_config/deciderConfig.yml\";", "originalCommit": "7cbfc2a152542087d87e0344f989b84561f9d26b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM4MjUyOQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r458382529", "bodyText": "Done", "author": "aditjind", "createdAt": "2020-07-21T20:56:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc1NzYyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc1NzgwNw==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r457757807", "bodyText": "The constructor can take path as input to support test cases with different config files.", "author": "vigyasharma", "createdAt": "2020-07-21T00:01:25Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/ConfigReader.java", "diffHunk": "@@ -0,0 +1,36 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders.Decider;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.yaml.YAMLFactory;\n+import java.io.File;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+public class ConfigReader {\n+    private static final Logger LOG = LogManager.getLogger(ConfigReader.class);\n+    private static HashMap<Decider, ArrayList<String>> deciderActionPriorityOrder;\n+\n+    public static final String CONFIG_FILE_PATH = \"./pa_config/deciderConfig.yml\";\n+\n+    public ConfigReader() {", "originalCommit": "7cbfc2a152542087d87e0344f989b84561f9d26b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM4MjM1Nw==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r458382357", "bodyText": "Done", "author": "aditjind", "createdAt": "2020-07-21T20:55:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc1NzgwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc2MDE1NA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r457760154", "bodyText": "This will also not work with the generic decider config file you mentioned. Let us just restrict it to an action_priorities file only", "author": "vigyasharma", "createdAt": "2020-07-21T00:09:28Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/ConfigReader.java", "diffHunk": "@@ -0,0 +1,36 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders.Decider;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.yaml.YAMLFactory;\n+import java.io.File;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+public class ConfigReader {\n+    private static final Logger LOG = LogManager.getLogger(ConfigReader.class);\n+    private static HashMap<Decider, ArrayList<String>> deciderActionPriorityOrder;\n+\n+    public static final String CONFIG_FILE_PATH = \"./pa_config/deciderConfig.yml\";\n+\n+    public ConfigReader() {\n+        this.deciderActionPriorityOrder = null;\n+    }\n+\n+    public static void updateDeciderActionPriorityOrder() {\n+        ObjectMapper mapper = new ObjectMapper(new YAMLFactory());\n+        try {\n+            deciderActionPriorityOrder = mapper.readValue(new File(CONFIG_FILE_PATH), HashMap.class);", "originalCommit": "7cbfc2a152542087d87e0344f989b84561f9d26b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM4MjMwOA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r458382308", "bodyText": "done", "author": "aditjind", "createdAt": "2020-07-21T20:55:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc2MDE1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc2MDY1OQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r457760659", "bodyText": "Handle NPE here?", "author": "vigyasharma", "createdAt": "2020-07-21T00:11:11Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/ConfigReader.java", "diffHunk": "@@ -0,0 +1,36 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders.Decider;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.yaml.YAMLFactory;\n+import java.io.File;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+public class ConfigReader {\n+    private static final Logger LOG = LogManager.getLogger(ConfigReader.class);\n+    private static HashMap<Decider, ArrayList<String>> deciderActionPriorityOrder;\n+\n+    public static final String CONFIG_FILE_PATH = \"./pa_config/deciderConfig.yml\";\n+\n+    public ConfigReader() {\n+        this.deciderActionPriorityOrder = null;\n+    }\n+\n+    public static void updateDeciderActionPriorityOrder() {\n+        ObjectMapper mapper = new ObjectMapper(new YAMLFactory());\n+        try {\n+            deciderActionPriorityOrder = mapper.readValue(new File(CONFIG_FILE_PATH), HashMap.class);\n+        } catch (Exception e) {\n+            LOG.error(\"Could not read the Decider Config File\");\n+            e.printStackTrace();\n+        }\n+        return;\n+    }\n+\n+    public static ArrayList<String> getActionPriorityOrder(String decider) {\n+        return deciderActionPriorityOrder.get(decider);", "originalCommit": "7cbfc2a152542087d87e0344f989b84561f9d26b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM4MjAzNw==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r458382037", "bodyText": "Done", "author": "aditjind", "createdAt": "2020-07-21T20:55:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc2MDY1OQ=="}], "type": "inlineReview"}, {"oid": "d6947ace46ebaebe1633582f6ba65346f61f9cc3", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/d6947ace46ebaebe1633582f6ba65346f61f9cc3", "message": "Adressing PR Comments x2", "committedDate": "2020-07-21T21:06:24Z", "type": "commit"}, {"oid": "587dd5050d24719993c61068102b57ee69429c19", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/587dd5050d24719993c61068102b57ee69429c19", "message": "Removing Extra Line", "committedDate": "2020-07-21T21:10:29Z", "type": "commit"}, {"oid": "19893634221efc0bcaea0f3cdd4e2377a5e13c97", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/19893634221efc0bcaea0f3cdd4e2377a5e13c97", "message": "Renaming Files", "committedDate": "2020-07-21T21:50:24Z", "type": "commit"}, {"oid": "510a2170cb136d760ac370c0305ba42d47e25a5f", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/510a2170cb136d760ac370c0305ba42d47e25a5f", "message": "Updating Jackson Data format Version", "committedDate": "2020-07-21T22:46:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTIzMTQ1Mw==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r459231453", "bodyText": "nit: we can merge these lines", "author": "vigyasharma", "createdAt": "2020-07-23T06:08:07Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciders/QueueHealthDecider.java", "diffHunk": "@@ -81,8 +80,8 @@ public Decision operate() {\n   }\n \n   private void configureActionPriority() {\n-    // TODO: Input from user configured yml\n-    this.actionsByUserPriority.add(ModifyQueueCapacityAction.NAME);\n+    ArrayList<String> actionPriority = DeciderActionPriorityReader.getActionPriorityOrder(name());\n+    actionsByUserPriority = actionPriority;", "originalCommit": "510a2170cb136d760ac370c0305ba42d47e25a5f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTc5OTc2Mg==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r459799762", "bodyText": "+1.", "author": "rguo-aws", "createdAt": "2020-07-24T00:31:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTIzMTQ1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgwMDI4MA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r459800280", "bodyText": "let's try to move this reader to somewhere else as it is clearly not part of the RCA graph.", "author": "rguo-aws", "createdAt": "2020-07-24T00:34:06Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/store/ElasticSearchAnalysisGraph.java", "diffHunk": "@@ -175,6 +177,10 @@ public void construct() {\n     queueRejectionClusterRca.addAllUpstreams(Collections.singletonList(queueRejectionNodeRca));\n     queueRejectionClusterRca.addTag(TAG_AGGREGATE_UPSTREAM, LOCUS_DATA_NODE);\n \n+    // Upload the config from YAML into memory.\n+    DeciderActionPriorityReader reader = new DeciderActionPriorityReader(DECIDER_ACTION_PRIORITIES_PATH);", "originalCommit": "510a2170cb136d760ac370c0305ba42d47e25a5f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7148b66aaadb932948581124168ad4d597aa9db0", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/7148b66aaadb932948581124168ad4d597aa9db0", "message": "Addressing PR Comments", "committedDate": "2020-07-24T01:19:45Z", "type": "commit"}]}