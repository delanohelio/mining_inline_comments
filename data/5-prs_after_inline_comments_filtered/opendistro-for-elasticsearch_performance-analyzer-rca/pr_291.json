{"pr_number": 291, "pr_title": "More refactoring to plugin-in an integration test framework for RCA components", "pr_createdAt": "2020-07-20T17:57:01Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/291", "timeline": [{"oid": "46706738174d8ed14b99797b2af912d2c8994b10", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/46706738174d8ed14b99797b2af912d2c8994b10", "message": "More refactoring to plugin-in an integration test framework for RCA components\n\nThe changes are mostly to expose interfaces that were otherwise buried into private interfaces.\nIt also removes some of the static usages in the RcaController\nChanges a few tests accordingly to account for the changes", "committedDate": "2020-07-20T17:49:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY0NDI5Nw==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/291#discussion_r457644297", "bodyText": "does this need to be declared as volatile ?", "author": "rguo-aws", "createdAt": "2020-07-20T19:34:05Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/RcaController.java", "diffHunk": "@@ -114,6 +115,8 @@\n   private final long rcaStateCheckIntervalMillis;\n   private final long roleCheckPeriodicity;\n \n+  private boolean deliberateInterrupt;", "originalCommit": "46706738174d8ed14b99797b2af912d2c8994b10", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY0NTM2NQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/291#discussion_r457645365", "bodyText": "declare this as volatile ?", "author": "rguo-aws", "createdAt": "2020-07-20T19:36:12Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/net/NetServer.java", "diffHunk": "@@ -89,10 +89,13 @@\n    */\n   protected Server server;\n \n+  private boolean attemptedShutdown;", "originalCommit": "46706738174d8ed14b99797b2af912d2c8994b10", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "99b97ccec87179aa1b29ca0e66c4c579dc297072", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/99b97ccec87179aa1b29ca0e66c4c579dc297072", "message": "addressing PR comments", "committedDate": "2020-07-20T20:02:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY4MzA5Nw==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/291#discussion_r457683097", "bodyText": "Looks like this was missed in the original code as well, but we should also propagate the interrupted exception if we caught it by calling Thread.currentThread().interrupt() explicitly here.", "author": "ktkrg", "createdAt": "2020-07-20T20:49:29Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/RcaController.java", "diffHunk": "@@ -251,8 +285,10 @@ public void run() {\n           Thread.sleep(rcaStateCheckIntervalMillis - duration);\n         }\n       } catch (InterruptedException ie) {\n-        LOG.error(\"RCA controller thread was interrupted. Reason: {}\", ie.getMessage());\n-        LOG.error(ie);\n+        if (!deliberateInterrupt) {", "originalCommit": "99b97ccec87179aa1b29ca0e66c4c579dc297072", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}