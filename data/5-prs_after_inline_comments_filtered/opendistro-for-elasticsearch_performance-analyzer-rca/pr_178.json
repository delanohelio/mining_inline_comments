{"pr_number": 178, "pr_title": "Handle race condition between RCA Scheduler start and RCA Node muting", "pr_createdAt": "2020-04-30T08:54:01Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/178", "timeline": [{"oid": "e3167640fdceb7c6d94166e3189196e42f2582fa", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/e3167640fdceb7c6d94166e3189196e42f2582fa", "message": "Adding metric for RCA Mute Error", "committedDate": "2020-04-30T00:53:42Z", "type": "commit"}, {"oid": "e017620a5e72564738a46f91f2d52047aee9ccd3", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/e017620a5e72564738a46f91f2d52047aee9ccd3", "message": "Handling the race condition between RCA Scheduler start and RCA Node muting", "committedDate": "2020-04-30T08:28:59Z", "type": "commit"}, {"oid": "01f3f8223b9892a335a65d3dc18efd84cfd43e3e", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/01f3f8223b9892a335a65d3dc18efd84cfd43e3e", "message": "Fixing Checkstyle error and adding a metric for RCA_MUTE_ERROR", "committedDate": "2020-04-30T08:51:20Z", "type": "commit"}, {"oid": "3829a51a705a485d0eb9dd704ccb471bef318e56", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/3829a51a705a485d0eb9dd704ccb471bef318e56", "message": "Making the mutedRcas as List of String in JSON", "committedDate": "2020-04-30T23:16:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM0ODc1Nw==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/178#discussion_r418348757", "bodyText": "typo: readAndUpdateMutedRcas instead ?", "author": "yojs", "createdAt": "2020-04-30T23:41:12Z", "path": "src/test/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/RcaControllerTest.java", "diffHunk": "@@ -162,9 +169,39 @@ public void readRcaEnabledFromConf() throws IOException {\n     Assert.assertTrue(RcaController.isRcaEnabled());\n   }\n \n+  @Test\n+  public void readAndUpdateMutesRcasBeforeGraphCreation() throws Exception {\n+    Method readAndUpdateMutesRcas = rcaController.getClass()\n+            .getDeclaredMethod(\"readAndUpdateMutesRcas\", null);\n+    readAndUpdateMutesRcas.setAccessible(true);\n+\n+    String rcaConfPath = Paths.get(RcaConsts.TEST_CONFIG_PATH, \"rca_muted.conf\").toString();\n+    Field rcaConfField = rcaController.getClass().getDeclaredField(\"rcaConf\");\n+    rcaConfField.setAccessible(true);\n+    rcaConfField.set(rcaController, new RcaConf(rcaConfPath));\n+    updateConfFileForMutedRcas(rcaConfPath, Arrays.asList(\"CPU_Utilization\", \"Heap_AllocRate\"));\n+\n+    Field mutedGraphNodesField = Stats.class.getDeclaredField(\"mutedGraphNodes\");\n+    mutedGraphNodesField.setAccessible(true);\n+    mutedGraphNodesField.set(Stats.getInstance(), null);\n+    Set<String> initialComponentSet = ConnectedComponent.getNodeNames();\n+    Whitebox.setInternalState(ConnectedComponent.class, \"nodeNames\", new HashSet<>());\n+\n+    readAndUpdateMutesRcas.invoke(rcaController);\n+    Assert.assertNull(Stats.getInstance().getMutedGraphNodes());\n+\n+    // Re-set back to initialComponentSet\n+    Whitebox.setInternalState(ConnectedComponent.class, \"nodeNames\", initialComponentSet);\n+  }\n+\n   @Test\n   public void readAndUpdateMutesRcas() throws Exception {", "originalCommit": "3829a51a705a485d0eb9dd704ccb471bef318e56", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM1MDk0OQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/178#discussion_r418350949", "bodyText": "Fixed the typo.", "author": "khushbr", "createdAt": "2020-04-30T23:48:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM0ODc1Nw=="}], "type": "inlineReview"}, {"oid": "0898237d5e6b16e4e37cd437c2348df90a917129", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/0898237d5e6b16e4e37cd437c2348df90a917129", "message": "Addressing the PR comments", "committedDate": "2020-04-30T23:50:48Z", "type": "commit"}]}