{"pr_number": 203, "pr_title": "Allows window size to be set per detector.", "pr_createdAt": "2020-08-06T20:33:54Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/203", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2MTg1Mg==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/203#discussion_r466761852", "bodyText": "minor. why not follow the convention of other optional fields?", "author": "wnbts", "createdAt": "2020-08-07T00:54:04Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/model/AnomalyDetector.java", "diffHunk": "@@ -199,7 +206,7 @@ public static AnomalyDetector parse(XContentParser parser, String detectorId) th\n      * @throws IOException IOException if content can't be parsed correctly\n      */\n     public static AnomalyDetector parse(XContentParser parser, String detectorId, Long version) throws IOException {\n-        return parse(parser, detectorId, version, null, null);\n+        return parse(parser, detectorId, version, null, null, AnomalyDetectorSettings.DEFAULT_SHINGLE_SIZE);", "originalCommit": "126b3198bfa4ff66a640cb843bee6880686713ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI1NTkzMQ==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/203#discussion_r467255931", "bodyText": "A unit test was failing when I passed null for the default shingle size here, but I can find another way to fix the test. I agree it makes sense to follow the convention of the other fields and pass a null.", "author": "LiuJoyceC", "createdAt": "2020-08-07T20:33:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2MTg1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2Mjc4NQ==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/203#discussion_r466762785", "bodyText": "minor. 2 is a hardcoded magic number that should be avoided. if 2 becomes 3, it should be a configuration change and the class and the unit tests should not need to be changed.", "author": "wnbts", "createdAt": "2020-08-07T00:57:51Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/feature/FeatureManager.java", "diffHunk": "@@ -597,6 +594,20 @@ private long truncateToMinute(long epochMillis) {\n         return Instant.ofEpochMilli(epochMillis).truncatedTo(ChronoUnit.MINUTES).toEpochMilli();\n     }\n \n+    /**\n+     * @return max number of missing points allowed to generate a shingle\n+     */\n+    private int getMaxMissingPoints(int shingleSize) {\n+        return Math.max(Math.min(2, shingleSize), (int) Math.floor(shingleSize * 0.25));\n+    }\n+\n+    /**\n+     * @return max distance (number of intervals) between a missing point and a replacement neighbor\n+     */\n+    private int getMaxNeighborDistance(int shingleSize) {\n+        return Math.min(2, shingleSize);", "originalCommit": "126b3198bfa4ff66a640cb843bee6880686713ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI1NTE0Mg==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/203#discussion_r467255142", "bodyText": "Ok, I'll add it to the AnomalyDetectorSettings.", "author": "LiuJoyceC", "createdAt": "2020-08-07T20:31:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2Mjc4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2NDA5NA==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/203#discussion_r466764094", "bodyText": "minor. if the value is from input, a validation can be used such as non-positive values.", "author": "wnbts", "createdAt": "2020-08-07T01:03:06Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/model/AnomalyDetector.java", "diffHunk": "@@ -285,6 +295,9 @@ public static AnomalyDetector parse(\n                 case WINDOW_DELAY_FIELD:\n                     windowDelay = TimeConfiguration.parse(parser);\n                     break;\n+                case WINDOW_SIZE_FIELD:\n+                    windowSize = parser.intValue();", "originalCommit": "126b3198bfa4ff66a640cb843bee6880686713ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI1Nzg5MA==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/203#discussion_r467257890", "bodyText": "Sure, I'll add a change to validate and throw an IllegalArgumentException (unless is there another more appropriate exception class for this?)", "author": "LiuJoyceC", "createdAt": "2020-08-07T20:38:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2NDA5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2NzIwNQ==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/203#discussion_r466767205", "bodyText": "issue. Limit the imputed to up to 25%. The current value of 2 is based on shingle size 8. When shingle size is 1 ~ 3,  0 is the max. 4 ~ 7, 1.", "author": "wnbts", "createdAt": "2020-08-07T01:14:55Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/feature/FeatureManager.java", "diffHunk": "@@ -597,6 +594,20 @@ private long truncateToMinute(long epochMillis) {\n         return Instant.ofEpochMilli(epochMillis).truncatedTo(ChronoUnit.MINUTES).toEpochMilli();\n     }\n \n+    /**\n+     * @return max number of missing points allowed to generate a shingle\n+     */\n+    private int getMaxMissingPoints(int shingleSize) {", "originalCommit": "126b3198bfa4ff66a640cb843bee6880686713ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI1NDk5NA==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/203#discussion_r467254994", "bodyText": "Sure, I will simplify the function to just Math.floor(shingleSize * 0.25).", "author": "LiuJoyceC", "createdAt": "2020-08-07T20:30:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2NzIwNQ=="}], "type": "inlineReview"}, {"oid": "5275f5cedca704d80bc027efb3bac9392f5069d2", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/5275f5cedca704d80bc027efb3bac9392f5069d2", "message": "Allows window size to be set per detector.", "committedDate": "2020-08-08T19:39:38Z", "type": "commit"}, {"oid": "e4fc1e2f14a332971973c6437f71a59f132c6d78", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/e4fc1e2f14a332971973c6437f71a59f132c6d78", "message": "Changes: changes term window size to shingle size, moves hard-coded values to AnomalyDetectorSettings, limits maxMissingPoints to 25% for all shingleSizes,, validates shingle size is positive integer.", "committedDate": "2020-08-08T19:39:38Z", "type": "forcePushed"}, {"oid": "50101ad3336b609e99778ee36109f2af18d19ea0", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/50101ad3336b609e99778ee36109f2af18d19ea0", "message": "Changes: changes term window size to shingle size, moves hard-coded values to AnomalyDetectorSettings, limits maxMissingPoints to 25% for all shingleSizes,, validates shingle size is positive integer.", "committedDate": "2020-08-12T02:36:11Z", "type": "commit"}, {"oid": "ae010a7844d1dc7a1f94c33796755b237513c5bf", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/ae010a7844d1dc7a1f94c33796755b237513c5bf", "message": "Change: getShingleSize returns default shingle size if the anomaly detector does not have a shingleSize field.", "committedDate": "2020-08-12T05:47:50Z", "type": "commit"}, {"oid": "ae010a7844d1dc7a1f94c33796755b237513c5bf", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/ae010a7844d1dc7a1f94c33796755b237513c5bf", "message": "Change: getShingleSize returns default shingle size if the anomaly detector does not have a shingleSize field.", "committedDate": "2020-08-12T05:47:50Z", "type": "forcePushed"}]}