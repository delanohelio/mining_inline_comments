{"pr_number": 105, "pr_title": "Add settings to disable/enable AD dynamically", "pr_createdAt": "2020-05-04T21:40:05Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/105", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc2NjQ4NQ==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/105#discussion_r419766485", "bodyText": "We will set AD plugin as enabled by default. After user disabling it and restart domain, are we able to read the latest configuration and set AD as disabled by defulat?", "author": "ylwu-amzn", "createdAt": "2020-05-04T22:28:49Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/settings/EnabledSetting.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ *   Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *   You may not use this file except in compliance with the License.\n+ *   A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   or in the \"license\" file accompanying this file. This file is distributed\n+ *   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *   express or implied. See the License for the specific language governing\n+ *   permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.ad.settings;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+import org.elasticsearch.cluster.service.ClusterService;\n+import org.elasticsearch.common.settings.Setting;\n+import org.elasticsearch.common.settings.Settings;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.ConcurrentHashMap;\n+\n+import static java.util.Collections.unmodifiableMap;\n+import static org.elasticsearch.common.settings.Setting.Property.Dynamic;\n+import static org.elasticsearch.common.settings.Setting.Property.NodeScope;\n+\n+public class EnabledSetting {\n+\n+    private static Logger logger = LogManager.getLogger(EnabledSetting.class);\n+\n+    /**\n+     * Singleton instance\n+     */\n+    private static EnabledSetting INSTANCE;\n+\n+    /**\n+     * Settings name\n+     */\n+    public static final String AD_PLUGIN_ENABLED = \"opendistro.anomaly_detection.enabled\";\n+\n+    private final Map<String, Setting<?>> settings = unmodifiableMap(new HashMap<String, Setting<?>>() {\n+        {\n+            /**\n+             * AD plugin enable/disable setting\n+             */\n+            put(AD_PLUGIN_ENABLED, Setting.boolSetting(AD_PLUGIN_ENABLED, true, NodeScope, Dynamic));", "originalCommit": "7904012d104bcbe9f1a74e795b7904f6e72ca80b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc2NzA2Mw==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/105#discussion_r419767063", "bodyText": "It depends on whether they do it in a transient fashion or persistent fashion.  If transient, after reboot,  it would be enabled by default.  If persistent, after reboot, it would disabled by default.", "author": "kaituo", "createdAt": "2020-05-04T22:30:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc2NjQ4NQ=="}], "type": "inlineReview"}, {"oid": "f652c78405c2b9d05e1a256e82c85d68689ce5e6", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/f652c78405c2b9d05e1a256e82c85d68689ce5e6", "message": "Add settings to disable/enable AD dynamically\n\nThis PR adds settings to disable/enable AD dynamically.  AD plugin rejects RESTful requests and stops AD jobs when it is disabled.\n\nTesting done:\n- added tests to verify if AD plugin rejects RESTful requests when it is disabled\n- manually verified AD jobs are stopped when AD plugin is disabled", "committedDate": "2020-05-04T22:43:51Z", "type": "commit"}, {"oid": "f652c78405c2b9d05e1a256e82c85d68689ce5e6", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/f652c78405c2b9d05e1a256e82c85d68689ce5e6", "message": "Add settings to disable/enable AD dynamically\n\nThis PR adds settings to disable/enable AD dynamically.  AD plugin rejects RESTful requests and stops AD jobs when it is disabled.\n\nTesting done:\n- added tests to verify if AD plugin rejects RESTful requests when it is disabled\n- manually verified AD jobs are stopped when AD plugin is disabled", "committedDate": "2020-05-04T22:43:51Z", "type": "forcePushed"}]}