{"pr_number": 278, "pr_title": "Upgrade mapping", "pr_createdAt": "2020-10-19T21:43:03Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/278", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODA5Mzc3Nw==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/278#discussion_r508093777", "bodyText": "Will this fail with FGAC ?", "author": "ylwu-amzn", "createdAt": "2020-10-19T22:14:52Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/rest/RestIndexAnomalyDetectorAction.java", "diffHunk": "@@ -124,6 +126,7 @@ protected RestChannelConsumer prepareRequest(RestRequest request, NodeClient cli\n             ? WriteRequest.RefreshPolicy.parse(request.param(REFRESH))\n             : WriteRequest.RefreshPolicy.IMMEDIATE;\n         RestRequest.Method method = request.getHttpRequest().method();\n+        anomalyDetectionIndices.updateMappingIfNecessary();", "originalCommit": "c501a64dddcd56892be8b42a5ec85d0b5dfaeeb4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODEzODk4Mg==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/278#discussion_r508138982", "bodyText": "Yeah..lets move this to transport layer. Since Anomaly Detection indices will be part of system index, we cannot update them.", "author": "saratvemulapalli", "createdAt": "2020-10-20T00:33:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODA5Mzc3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODIyMDYzMg==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/278#discussion_r508220632", "bodyText": "yeah, moved to transport layer.  After moving, tested working with fgac.", "author": "kaituo", "createdAt": "2020-10-20T05:36:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODA5Mzc3Nw=="}], "type": "inlineReview"}, {"oid": "8b7e51339d1f3477146ea16fd84fe3c6d4481e3c", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/8b7e51339d1f3477146ea16fd84fe3c6d4481e3c", "message": "Upgrade mapping\n\nThis PR updates the current AD index mapping if a new version is detected. \u00a0Previously, we didn't do so. \u00a0This will cause issues when upgrading AD binary version: newly added fields will not be searchable, though we can still send get requests to fetch them.\n\nTesting done:\n1. manual upgrade testing passes.\n2. will add unit tests later.", "committedDate": "2020-10-20T05:03:43Z", "type": "commit"}, {"oid": "c599d377cb9f9ccf6efe5ffc7964b1729d9063a0", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/c599d377cb9f9ccf6efe5ffc7964b1729d9063a0", "message": "Address comments", "committedDate": "2020-10-20T05:35:02Z", "type": "commit"}, {"oid": "c599d377cb9f9ccf6efe5ffc7964b1729d9063a0", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/c599d377cb9f9ccf6efe5ffc7964b1729d9063a0", "message": "Address comments", "committedDate": "2020-10-20T05:35:02Z", "type": "forcePushed"}, {"oid": "f2d1ebbfac76dd1a30b9ad309f62f22a60b63a24", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/f2d1ebbfac76dd1a30b9ad309f62f22a60b63a24", "message": "fix spotless", "committedDate": "2020-10-20T05:43:31Z", "type": "commit"}]}