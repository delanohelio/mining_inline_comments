{"pr_number": 14331, "pr_title": "EXPLAIN (TYPE IO) support for Aria", "pr_createdAt": "2020-04-03T17:02:55Z", "pr_url": "https://github.com/prestodb/presto/pull/14331", "timeline": [{"oid": "f8afb915b87304f161c4facf438003cf3a8e4458", "url": "https://github.com/prestodb/presto/commit/f8afb915b87304f161c4facf438003cf3a8e4458", "message": "[WIP] EXPLAIN (TYPE IO) support for Aria", "committedDate": "2020-04-03T20:51:34Z", "type": "forcePushed"}, {"oid": "e4bafeb50f1d6a92a22963a79202dfddcfd9de21", "url": "https://github.com/prestodb/presto/commit/e4bafeb50f1d6a92a22963a79202dfddcfd9de21", "message": "[WIP] EXPLAIN (TYPE IO) support for Aria", "committedDate": "2020-04-06T13:58:43Z", "type": "forcePushed"}, {"oid": "2f22c7ba49319aee44c65c1ea8ae47209e5b2106", "url": "https://github.com/prestodb/presto/commit/2f22c7ba49319aee44c65c1ea8ae47209e5b2106", "message": "[WIP] EXPLAIN (TYPE IO) support for Aria", "committedDate": "2020-04-13T17:57:25Z", "type": "forcePushed"}, {"oid": "7af97d2ff39a624ef3a251d95105286636b8274c", "url": "https://github.com/prestodb/presto/commit/7af97d2ff39a624ef3a251d95105286636b8274c", "message": "[WIP] EXPLAIN (TYPE IO) support for Aria", "committedDate": "2020-04-13T22:24:53Z", "type": "forcePushed"}, {"oid": "8e9bc56482774f7db6c524ddc09ed9559c8a51dc", "url": "https://github.com/prestodb/presto/commit/8e9bc56482774f7db6c524ddc09ed9559c8a51dc", "message": "[WIP] EXPLAIN (TYPE IO) support for Aria", "committedDate": "2020-04-14T14:38:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODI1MzIzNQ==", "url": "https://github.com/prestodb/presto/pull/14331#discussion_r408253235", "bodyText": "Purposefully left this comment to reviews to chime in...", "author": "jbroll", "createdAt": "2020-04-14T16:01:29Z", "path": "presto-main/src/main/java/com/facebook/presto/sql/planner/planPrinter/IOPlanPrinter.java", "diffHunk": "@@ -546,7 +546,12 @@ private String getVarcharValue(Type type, Object value)\n             if (type instanceof BooleanType) {\n                 return ((Boolean) value).toString();\n             }\n-            throw new PrestoException(NOT_SUPPORTED, format(\"Unsupported data type in EXPLAIN (TYPE IO): %s\", type.getDisplayName()));\n+\n+            // Are there additional types that could be partition columns in Aria that we now need to support?", "originalCommit": "8e9bc56482774f7db6c524ddc09ed9559c8a51dc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODI4ODQyMA==", "url": "https://github.com/prestodb/presto/pull/14331#discussion_r408288420", "bodyText": "Explain (Type IO)", "author": "bhhari", "createdAt": "2020-04-14T16:53:03Z", "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveMetadata.java", "diffHunk": "@@ -713,6 +713,17 @@ public ColumnMetadata getColumnMetadata(ConnectorSession session, ConnectorTable\n         return ((HiveColumnHandle) columnHandle).getColumnMetadata(typeManager);\n     }\n \n+    /**\n+     * Returns a TupleDomain of constraints that is suitable for ExplainIO", "originalCommit": "8e9bc56482774f7db6c524ddc09ed9559c8a51dc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODI4ODYxNw==", "url": "https://github.com/prestodb/presto/pull/14331#discussion_r408288617", "bodyText": "IO planning instead of OI", "author": "bhhari", "createdAt": "2020-04-14T16:53:21Z", "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveMetadata.java", "diffHunk": "@@ -713,6 +713,17 @@ public ColumnMetadata getColumnMetadata(ConnectorSession session, ConnectorTable\n         return ((HiveColumnHandle) columnHandle).getColumnMetadata(typeManager);\n     }\n \n+    /**\n+     * Returns a TupleDomain of constraints that is suitable for ExplainIO\n+     *\n+     * Only Hive partition columns that are used in OI planning.", "originalCommit": "8e9bc56482774f7db6c524ddc09ed9559c8a51dc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODI4OTg1NQ==", "url": "https://github.com/prestodb/presto/pull/14331#discussion_r408289855", "bodyText": "We need to keep the throw exception as we are not changing the existing behavior", "author": "bhhari", "createdAt": "2020-04-14T16:55:08Z", "path": "presto-main/src/main/java/com/facebook/presto/sql/planner/planPrinter/IOPlanPrinter.java", "diffHunk": "@@ -546,7 +546,12 @@ private String getVarcharValue(Type type, Object value)\n             if (type instanceof BooleanType) {\n                 return ((Boolean) value).toString();\n             }\n-            throw new PrestoException(NOT_SUPPORTED, format(\"Unsupported data type in EXPLAIN (TYPE IO): %s\", type.getDisplayName()));\n+", "originalCommit": "8e9bc56482774f7db6c524ddc09ed9559c8a51dc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "88260d688f6e82b0e2dfd2e48c02177142691a00", "url": "https://github.com/prestodb/presto/commit/88260d688f6e82b0e2dfd2e48c02177142691a00", "message": "[WIP] EXPLAIN (TYPE IO) support for Aria", "committedDate": "2020-04-14T17:49:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMyNjAwNg==", "url": "https://github.com/prestodb/presto/pull/14331#discussion_r408326006", "bodyText": "what's the purpose of this filter?", "author": "mbasmanova", "createdAt": "2020-04-14T17:52:53Z", "path": "presto-main/src/main/java/com/facebook/presto/sql/planner/planPrinter/IOPlanPrinter.java", "diffHunk": "@@ -517,6 +519,7 @@ private FormattedDomain parseDomain(Domain domain)\n                     discreteValues -> formattedRanges.addAll(\n                             discreteValues.getValues().stream()\n                                     .map(value -> getVarcharValue(type, value))\n+                                    .filter(Objects::nonNull)", "originalCommit": "88260d688f6e82b0e2dfd2e48c02177142691a00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODUxODc0OQ==", "url": "https://github.com/prestodb/presto/pull/14331#discussion_r408518749", "bodyText": "ohh - Thank you.  @bhhari  requested that .getVarcharValue() should throw as it previously did so this filter is no longer necessary.  I had .getVarcharValue() returning null for unknown types and then dropping those here to provide some type of best effort Explain IO.  I can remove the filter.", "author": "jbroll", "createdAt": "2020-04-15T00:52:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMyNjAwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMyNjA3MQ==", "url": "https://github.com/prestodb/presto/pull/14331#discussion_r408326071", "bodyText": "wrong indentation", "author": "mbasmanova", "createdAt": "2020-04-14T17:52:59Z", "path": "presto-main/src/main/java/com/facebook/presto/sql/planner/planPrinter/IOPlanPrinter.java", "diffHunk": "@@ -497,7 +499,7 @@ public Void visitTableFinish(TableFinishNode node, IOPlanBuilder context)\n             for (Map.Entry<ColumnHandle, Domain> entry : constraint.getDomains().get().entrySet()) {\n                 ColumnMetadata columnMetadata = metadata.getColumnMetadata(session, tableHandle, entry.getKey());\n                 columnConstraints.add(new ColumnConstraint(\n-                        columnMetadata.getName(),\n+                                columnMetadata.getName(),", "originalCommit": "88260d688f6e82b0e2dfd2e48c02177142691a00", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5a5ed0dd8f138970e6ef84ac8cf6f9182a5f4195", "url": "https://github.com/prestodb/presto/commit/5a5ed0dd8f138970e6ef84ac8cf6f9182a5f4195", "message": "[WIP] EXPLAIN (TYPE IO) support for Aria", "committedDate": "2020-04-15T00:55:28Z", "type": "forcePushed"}, {"oid": "95d75a50aadf7b2a1de780d49c63916148ad0853", "url": "https://github.com/prestodb/presto/commit/95d75a50aadf7b2a1de780d49c63916148ad0853", "message": "[WIP] EXPLAIN (TYPE IO) support for Aria", "committedDate": "2020-04-15T12:34:09Z", "type": "forcePushed"}, {"oid": "9434d7d79e1456e9168c6737073dfed49b345f1e", "url": "https://github.com/prestodb/presto/commit/9434d7d79e1456e9168c6737073dfed49b345f1e", "message": "Fix EXPLAIN (TYPE IO) when Aria scan is ON", "committedDate": "2020-04-16T11:39:58Z", "type": "commit"}, {"oid": "9434d7d79e1456e9168c6737073dfed49b345f1e", "url": "https://github.com/prestodb/presto/commit/9434d7d79e1456e9168c6737073dfed49b345f1e", "message": "Fix EXPLAIN (TYPE IO) when Aria scan is ON", "committedDate": "2020-04-16T11:39:58Z", "type": "forcePushed"}]}