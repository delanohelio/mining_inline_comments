{"pr_number": 15255, "pr_title": "Fix double counting of charPositionInLine", "pr_createdAt": "2020-09-30T20:59:35Z", "pr_url": "https://github.com/prestodb/presto/pull/15255", "timeline": [{"oid": "9be51edaba17c35b5889a90b195237509656938e", "url": "https://github.com/prestodb/presto/commit/9be51edaba17c35b5889a90b195237509656938e", "message": "Fix double counting of charPositionInLine\n\nParsingException when constructed through the NodeLocation\nconstructor ends up double counting the column number. This\ncommit tries to fix that by decrementing the column number\nwhile constructing the object.", "committedDate": "2020-09-30T21:59:28Z", "type": "forcePushed"}, {"oid": "c705a86e37f7b717de454e80f5966477445c1a4c", "url": "https://github.com/prestodb/presto/commit/c705a86e37f7b717de454e80f5966477445c1a4c", "message": "Fix double counting of charPositionInLine\n\nParsingException when constructed through the NodeLocation\nconstructor ends up double counting the column number. This\ncommit tries to fix that by decrementing the column number\nwhile constructing the object.", "committedDate": "2020-09-30T22:11:54Z", "type": "forcePushed"}, {"oid": "03dc4139960d26ffbf9657b56989a946ea20e0b8", "url": "https://github.com/prestodb/presto/commit/03dc4139960d26ffbf9657b56989a946ea20e0b8", "message": "Fix double counting of charPositionInLine\n\nParsingException when constructed through the NodeLocation\nconstructor ends up double counting the column number. This\ncommit tries to fix that by decrementing the column number\nwhile constructing the object.", "committedDate": "2020-09-30T22:14:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTAyMjg5OQ==", "url": "https://github.com/prestodb/presto/pull/15255#discussion_r499022899", "bodyText": "In general I think it's better to change the getColumnNumber to be just a getter and change all callers to initialize these classes correctly. But that would be more code change. Maybe add a comment here to explain why this is needed.", "author": "rongrong", "createdAt": "2020-10-02T19:57:00Z", "path": "presto-parser/src/main/java/com/facebook/presto/sql/parser/ParsingException.java", "diffHunk": "@@ -39,7 +39,7 @@ public ParsingException(String message)\n \n     public ParsingException(String message, NodeLocation nodeLocation)\n     {\n-        this(message, null, nodeLocation.getLineNumber(), nodeLocation.getColumnNumber());\n+        this(message, null, nodeLocation.getLineNumber(), nodeLocation.getColumnNumber() - 1);", "originalCommit": "03dc4139960d26ffbf9657b56989a946ea20e0b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA0ODc1NA==", "url": "https://github.com/prestodb/presto/pull/15255#discussion_r499048754", "bodyText": "Added a comment explaining why this is needed.", "author": "ajaygeorge", "createdAt": "2020-10-02T21:02:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTAyMjg5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTg1NTk5Ng==", "url": "https://github.com/prestodb/presto/pull/15255#discussion_r499855996", "bodyText": "The comment should probably mention that column number recorded is 0-based, thus in getColumnNumber in both NodeLocation and ParsingException we return columnNumber + 1. So we need to revert this back to a 0-based column number to initialize ParsingException. The provided comment is very hard to understand without reading the code so not very useful. Also nits: space after \"//\".", "author": "rongrong", "createdAt": "2020-10-05T20:33:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTAyMjg5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTg1NjMwOQ==", "url": "https://github.com/prestodb/presto/pull/15255#discussion_r499856309", "bodyText": "Or if you feel that's too verbose, you can probably refer to the issue in the comment as well.", "author": "rongrong", "createdAt": "2020-10-05T20:34:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTAyMjg5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDAxMzQyOQ==", "url": "https://github.com/prestodb/presto/pull/15255#discussion_r500013429", "bodyText": "Updated the comment to explain that charPositionInLine is 0-based whereas columnNumber is 1-based and why the decrement operation is needed. Please review again", "author": "ajaygeorge", "createdAt": "2020-10-06T05:27:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTAyMjg5OQ=="}], "type": "inlineReview"}, {"oid": "1c1e5d5cccbf2fc57765616ad7028c243eb10c6f", "url": "https://github.com/prestodb/presto/commit/1c1e5d5cccbf2fc57765616ad7028c243eb10c6f", "message": "Fix double counting of charPositionInLine\n\nParsingException when constructed through the NodeLocation\nconstructor ends up double counting the column number. This\ncommit tries to fix that by decrementing the column number\nwhile constructing the object.", "committedDate": "2020-10-02T21:01:16Z", "type": "forcePushed"}, {"oid": "4634e7635d0a7fe321dd054361c1983adb218ee5", "url": "https://github.com/prestodb/presto/commit/4634e7635d0a7fe321dd054361c1983adb218ee5", "message": "Fix double counting of charPositionInLine\n\nParsingException when constructed through the NodeLocation\nconstructor ends up double counting the column number. This\ncommit tries to fix that by decrementing the column number\nwhile constructing the object.", "committedDate": "2020-10-06T05:26:18Z", "type": "forcePushed"}, {"oid": "3f812525bee66e42a7e3a060bd742d37984f646d", "url": "https://github.com/prestodb/presto/commit/3f812525bee66e42a7e3a060bd742d37984f646d", "message": "Fix double counting of charPositionInLine\n\nParsingException when constructed through the NodeLocation\nconstructor ends up double counting the column number. This\ncommit tries to fix that by decrementing the column number\nwhile constructing the object.", "committedDate": "2020-10-06T05:26:41Z", "type": "forcePushed"}, {"oid": "50a25104b160cea3a808d9c7ec243803eb85b087", "url": "https://github.com/prestodb/presto/commit/50a25104b160cea3a808d9c7ec243803eb85b087", "message": "Fix double counting of charPositionInLine\n\nParsingException when constructed through the NodeLocation\nconstructor ends up double counting the column number. This\ncommit tries to fix that by decrementing the column number\nwhile constructing the object.", "committedDate": "2020-10-26T05:04:57Z", "type": "forcePushed"}, {"oid": "184eaba847c4336b8c4a89f7a3d034e9f2883817", "url": "https://github.com/prestodb/presto/commit/184eaba847c4336b8c4a89f7a3d034e9f2883817", "message": "Fix double counting of charPositionInLine\n\nParsingException when constructed through the NodeLocation\nconstructor ends up double counting the column number. This\ncommit tries to fix that by decrementing the column number\nwhile constructing the object.", "committedDate": "2020-10-26T05:05:14Z", "type": "forcePushed"}, {"oid": "27a6e25998b90a9eb052d9bc572ca8165cadd5e4", "url": "https://github.com/prestodb/presto/commit/27a6e25998b90a9eb052d9bc572ca8165cadd5e4", "message": "Fix double counting of charPositionInLine\n\nParsingException when constructed through the NodeLocation\nconstructor ends up double counting the column number. This\ncommit tries to fix that by decrementing the column number\nwhile constructing the object.", "committedDate": "2020-10-28T01:43:23Z", "type": "commit"}, {"oid": "27a6e25998b90a9eb052d9bc572ca8165cadd5e4", "url": "https://github.com/prestodb/presto/commit/27a6e25998b90a9eb052d9bc572ca8165cadd5e4", "message": "Fix double counting of charPositionInLine\n\nParsingException when constructed through the NodeLocation\nconstructor ends up double counting the column number. This\ncommit tries to fix that by decrementing the column number\nwhile constructing the object.", "committedDate": "2020-10-28T01:43:23Z", "type": "forcePushed"}]}