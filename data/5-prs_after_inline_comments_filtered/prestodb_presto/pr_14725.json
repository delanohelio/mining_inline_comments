{"pr_number": 14725, "pr_title": "Fix NPE in geometry_invalid_reason", "pr_createdAt": "2020-06-25T20:49:27Z", "pr_url": "https://github.com/prestodb/presto/pull/14725", "timeline": [{"oid": "116fb962201b6c45b7056d0a3915a79e94ba33d7", "url": "https://github.com/prestodb/presto/commit/116fb962201b6c45b7056d0a3915a79e94ba33d7", "message": "Fix NPE in geometry_invalid_reason\n\nEmbarrassingly, this method threw an NPE on valid geometries, which it\nwas not supposed to.  This commit uses Optional and adds a guard.", "committedDate": "2020-06-25T21:37:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg3MjM5NA==", "url": "https://github.com/prestodb/presto/pull/14725#discussion_r445872394", "bodyText": "Can be simplified as\nreturn getGeometryInvalidReason(geometry).map(Slices::utf8Slice).orElse(null);", "author": "caithagoras", "createdAt": "2020-06-25T22:25:52Z", "path": "presto-geospatial/src/main/java/com/facebook/presto/plugin/geospatial/GeoFunctions.java", "diffHunk": "@@ -414,7 +415,11 @@ public static Slice invalidReason(@SqlType(GEOMETRY_TYPE_NAME) Slice input)\n     {\n         try {\n             Geometry geometry = deserialize(input);\n-            return utf8Slice(getGeometryInvalidReason(geometry));\n+            Optional<String> reason = getGeometryInvalidReason(geometry);\n+            if (reason.isPresent()) {\n+                return utf8Slice(reason.get());\n+            }\n+            return null;", "originalCommit": "116fb962201b6c45b7056d0a3915a79e94ba33d7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8c2809eadb7eb051ec8d20998f2005939f10d471", "url": "https://github.com/prestodb/presto/commit/8c2809eadb7eb051ec8d20998f2005939f10d471", "message": "Fix NPE in geometry_invalid_reason\n\nEmbarrassingly, this method threw an NPE on valid geometries, which it\nwas not supposed to.  This commit uses Optional and adds a guard.", "committedDate": "2020-06-25T23:11:48Z", "type": "forcePushed"}, {"oid": "9cfeef4e78e50a501ed4d6e34bfc04b9c3fed4be", "url": "https://github.com/prestodb/presto/commit/9cfeef4e78e50a501ed4d6e34bfc04b9c3fed4be", "message": "Fix NPE in geometry_invalid_reason\n\nEmbarrassingly, this method threw an NPE on valid geometries, which it\nwas not supposed to.  This commit uses Optional and adds a guard.", "committedDate": "2020-06-26T00:12:08Z", "type": "commit"}, {"oid": "9cfeef4e78e50a501ed4d6e34bfc04b9c3fed4be", "url": "https://github.com/prestodb/presto/commit/9cfeef4e78e50a501ed4d6e34bfc04b9c3fed4be", "message": "Fix NPE in geometry_invalid_reason\n\nEmbarrassingly, this method threw an NPE on valid geometries, which it\nwas not supposed to.  This commit uses Optional and adds a guard.", "committedDate": "2020-06-26T00:12:08Z", "type": "forcePushed"}]}