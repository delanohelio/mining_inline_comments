{"pr_number": 14221, "pr_title": "Add @JsonProperty tag to ignoreNulls flag so it works in distributed \u2026", "pr_createdAt": "2020-03-06T00:32:07Z", "pr_url": "https://github.com/prestodb/presto/pull/14221", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY1MDA4Mw==", "url": "https://github.com/prestodb/presto/pull/14221#discussion_r388650083", "bodyText": "This is probably not needed?", "author": "rongrong", "createdAt": "2020-03-06T00:48:52Z", "path": "presto-tests/src/main/java/com/facebook/presto/tests/AbstractTestQueries.java", "diffHunk": "@@ -41,6 +41,7 @@\n import io.airlift.tpch.TpchTable;\n import org.apache.commons.math3.stat.descriptive.DescriptiveStatistics;\n import org.intellij.lang.annotations.Language;\n+import org.testng.Assert;", "originalCommit": "0c87a58246451874da1662ff06bf2be224cce349", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMzNDE5NQ==", "url": "https://github.com/prestodb/presto/pull/14221#discussion_r389334195", "bodyText": "Fixed", "author": "kaikalur", "createdAt": "2020-03-08T04:27:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY1MDA4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY1MjU3OA==", "url": "https://github.com/prestodb/presto/pull/14221#discussion_r388652578", "bodyText": "You can probably write it similar as other tests using assertQueryOrdered and provide expected results, rather than just checking for null (look at testValueWindowFunctions).", "author": "rongrong", "createdAt": "2020-03-06T00:55:00Z", "path": "presto-tests/src/main/java/com/facebook/presto/tests/AbstractTestQueries.java", "diffHunk": "@@ -8272,6 +8273,34 @@ public void testRightJoinWithEmptyProbeSide()\n                 \"WITH small_part AS (SELECT * FROM part WHERE name = 'a') SELECT lineitem.orderkey FROM small_part RIGHT JOIN lineitem ON  small_part.partkey = lineitem.partkey\");\n     }\n \n+    @Test\n+    public void testLastValueIgnoreNulls()\n+    {\n+        String query = \"WITH T AS (\" +", "originalCommit": "0c87a58246451874da1662ff06bf2be224cce349", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMzNDIyNg==", "url": "https://github.com/prestodb/presto/pull/14221#discussion_r389334226", "bodyText": "We should not need ordered. So testing for unordered", "author": "kaikalur", "createdAt": "2020-03-08T04:28:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY1MjU3OA=="}], "type": "inlineReview"}, {"oid": "747180002501efeaa5a7695462f25aaface11004", "url": "https://github.com/prestodb/presto/commit/747180002501efeaa5a7695462f25aaface11004", "message": "Add @JsonProperty tag to ignoreNulls flag so it works in distributed execution as well.", "committedDate": "2020-03-08T04:34:37Z", "type": "forcePushed"}, {"oid": "6320e0c6bc95a110666d4fc44f5d4b1817dc8647", "url": "https://github.com/prestodb/presto/commit/6320e0c6bc95a110666d4fc44f5d4b1817dc8647", "message": "Add @JsonProperty tag to ignoreNulls flag so it works in distributed execution as well.", "committedDate": "2020-03-08T16:58:27Z", "type": "forcePushed"}, {"oid": "3f7277a479bae93cb5bed573a901b86fd2c5b3dc", "url": "https://github.com/prestodb/presto/commit/3f7277a479bae93cb5bed573a901b86fd2c5b3dc", "message": "Add @JsonProperty tag to ignoreNulls flag so it works in distributed execution as well.\n\nSimplified the test.", "committedDate": "2020-03-10T19:02:06Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDc4MTcyMg==", "url": "https://github.com/prestodb/presto/pull/14221#discussion_r390781722", "bodyText": "Nits: separate line for new argument. And empty space between values.\n    \"FROM T\",\n    \"Values 1, 2, 2\");", "author": "rongrong", "createdAt": "2020-03-11T07:19:27Z", "path": "presto-tests/src/main/java/com/facebook/presto/tests/AbstractTestQueries.java", "diffHunk": "@@ -8272,6 +8272,29 @@ public void testRightJoinWithEmptyProbeSide()\n                 \"WITH small_part AS (SELECT * FROM part WHERE name = 'a') SELECT lineitem.orderkey FROM small_part RIGHT JOIN lineitem ON  small_part.partkey = lineitem.partkey\");\n     }\n \n+    @Test\n+    public void testLastValueIgnoreNulls()\n+    {\n+        assertQuery(\"WITH T AS (\" +\n+                \"    SELECT\" +\n+                \"        p,\" +\n+                \"        v\" +\n+                \"    FROM (\" +\n+                \"        VALUES\" +\n+                \"            (2, 2),\" +\n+                \"            (1, 1),\" +\n+                \"            (3, NULL)\" +\n+                \"    ) T(p, v)\" +\n+                \")\" +\n+                \"SELECT\" +\n+                \"    LAST_VALUE(v) IGNORE NULLS OVER (\" +\n+                \"        PARTITION BY 1\" +\n+                \"        ORDER BY\" +\n+                \"            p ASC\" +\n+                \"    )\" +\n+                \"FROM T\", \"Values 1,2,2\");", "originalCommit": "3f7277a479bae93cb5bed573a901b86fd2c5b3dc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTM5NjEyOQ==", "url": "https://github.com/prestodb/presto/pull/14221#discussion_r391396129", "bodyText": "done", "author": "kaikalur", "createdAt": "2020-03-12T04:31:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDc4MTcyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTgzNDk4Ng==", "url": "https://github.com/prestodb/presto/pull/14221#discussion_r391834986", "bodyText": "Not yet \ud83d\ude1b", "author": "rongrong", "createdAt": "2020-03-12T19:10:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDc4MTcyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDc4MTg5Nw==", "url": "https://github.com/prestodb/presto/pull/14221#discussion_r390781897", "bodyText": "Nits: new line for argument.\n    assertQuery(\n        \"WITH T ...", "author": "rongrong", "createdAt": "2020-03-11T07:20:04Z", "path": "presto-tests/src/main/java/com/facebook/presto/tests/AbstractTestQueries.java", "diffHunk": "@@ -8272,6 +8272,29 @@ public void testRightJoinWithEmptyProbeSide()\n                 \"WITH small_part AS (SELECT * FROM part WHERE name = 'a') SELECT lineitem.orderkey FROM small_part RIGHT JOIN lineitem ON  small_part.partkey = lineitem.partkey\");\n     }\n \n+    @Test\n+    public void testLastValueIgnoreNulls()\n+    {\n+        assertQuery(\"WITH T AS (\" +", "originalCommit": "3f7277a479bae93cb5bed573a901b86fd2c5b3dc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTM5NTM1MQ==", "url": "https://github.com/prestodb/presto/pull/14221#discussion_r391395351", "bodyText": "Done. Don't know why 'Reformat Code' doesn't do it automatically though", "author": "kaikalur", "createdAt": "2020-03-12T04:27:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDc4MTg5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTgzNDY1MQ==", "url": "https://github.com/prestodb/presto/pull/14221#discussion_r391834651", "bodyText": "I don't think our intelij style setup really conforms with the actual style we are following :(", "author": "rongrong", "createdAt": "2020-03-12T19:09:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDc4MTg5Nw=="}], "type": "inlineReview"}, {"oid": "7ce1e15b4649f6c2e1f67c045055b4ee9da82b1f", "url": "https://github.com/prestodb/presto/commit/7ce1e15b4649f6c2e1f67c045055b4ee9da82b1f", "message": "Add @JsonProperty tag to ignoreNulls flag so it works in distributed execution as well.\n\nSimplified the test.\nFormatting.", "committedDate": "2020-03-12T04:25:59Z", "type": "forcePushed"}, {"oid": "ab76ffa0f205fbbdf411995422769f0f5a9add07", "url": "https://github.com/prestodb/presto/commit/ab76ffa0f205fbbdf411995422769f0f5a9add07", "message": "Add @JsonProperty tag to ignoreNulls flag so it works in distributed execution as well.\n\nSimplified the test.\nFormatting.", "committedDate": "2020-03-12T04:31:00Z", "type": "forcePushed"}, {"oid": "bac00b32c32971eb31a71be5756a219fcee1bc0d", "url": "https://github.com/prestodb/presto/commit/bac00b32c32971eb31a71be5756a219fcee1bc0d", "message": "Add @JsonProperty tag to ignoreNulls flag so it works in distributed execution as well.\n\nSimplified the test.\nFormatting.", "committedDate": "2020-03-12T19:13:39Z", "type": "commit"}, {"oid": "bac00b32c32971eb31a71be5756a219fcee1bc0d", "url": "https://github.com/prestodb/presto/commit/bac00b32c32971eb31a71be5756a219fcee1bc0d", "message": "Add @JsonProperty tag to ignoreNulls flag so it works in distributed execution as well.\n\nSimplified the test.\nFormatting.", "committedDate": "2020-03-12T19:13:39Z", "type": "forcePushed"}]}