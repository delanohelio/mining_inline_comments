{"pr_number": 14122, "pr_title": "Optimize scan of floats with many nulls", "pr_createdAt": "2020-02-20T15:46:15Z", "pr_url": "https://github.com/prestodb/presto/pull/14122", "timeline": [{"oid": "cb6f9e36d997d1f25493d442985fbdec6a936f48", "url": "https://github.com/prestodb/presto/commit/cb6f9e36d997d1f25493d442985fbdec6a936f48", "message": "Optimize scan of floats with many nulls", "committedDate": "2020-02-20T15:44:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjMxNzM2Mg==", "url": "https://github.com/prestodb/presto/pull/14122#discussion_r382317362", "bodyText": "You may want to set value[i] = 0; if it's null, since we enforced the check that null elements should be 0.  Btw. I think it's debatable if null elements should be 0 but we added this check some time ago.", "author": "yingsu00", "createdAt": "2020-02-20T23:31:04Z", "path": "presto-orc/src/main/java/com/facebook/presto/orc/reader/FloatSelectiveStreamReader.java", "diffHunk": "@@ -250,6 +250,32 @@ else if (nullsAllowed) {\n     private int readNoFilter(int[] positions, int positionCount)\n             throws IOException\n     {\n+        if (positions[positionCount - 1] == positionCount - 1) {\n+            // no skipping\n+            if (presentStream != null) {\n+                // some nulls\n+                int nullCount = presentStream.getUnsetBits(positionCount, nulls);\n+                if (nullCount == positionCount) {\n+                    allNulls = true;\n+                }\n+                else {\n+                    for (int i = 0; i < positionCount; i++) {\n+                        if (!nulls[i]) {\n+                            values[i] = floatToRawIntBits(dataStream.next());", "originalCommit": "cb6f9e36d997d1f25493d442985fbdec6a936f48", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjM1MDQwNA==", "url": "https://github.com/prestodb/presto/pull/14122#discussion_r382350404", "bodyText": "@yingsu00 I believe you refer to this PR #13852 It added logic to populate zeros for null integer values, but not for floats. Hence, I think this can be left as is.", "author": "mbasmanova", "createdAt": "2020-02-21T01:22:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjMxNzM2Mg=="}], "type": "inlineReview"}]}