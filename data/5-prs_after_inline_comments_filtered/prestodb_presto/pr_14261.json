{"pr_number": 14261, "pr_title": "Add JSON format for EXPLAIN with type LOGICAL and DISTRIBUTED", "pr_createdAt": "2020-03-17T22:51:03Z", "pr_url": "https://github.com/prestodb/presto/pull/14261", "timeline": [{"oid": "dc9d7bf3c35f2561401e5afa61fc034b529d811c", "url": "https://github.com/prestodb/presto/commit/dc9d7bf3c35f2561401e5afa61fc034b529d811c", "message": "Add JSON format for EXPLAIN", "committedDate": "2020-03-23T03:18:13Z", "type": "forcePushed"}, {"oid": "4ce3cf47619c30531b63090322e42a8def52d2d5", "url": "https://github.com/prestodb/presto/commit/4ce3cf47619c30531b63090322e42a8def52d2d5", "message": "use sorted map for distributed plan\n\n- change distributed plan to sorted map\n- move JsonPlanFragment from QueryMonitor to JsonRenderer", "committedDate": "2020-04-03T01:51:48Z", "type": "forcePushed"}, {"oid": "6c3c1542fc7998630e54f5c2ae891805958f72fd", "url": "https://github.com/prestodb/presto/commit/6c3c1542fc7998630e54f5c2ae891805958f72fd", "message": "use sorted map for distributed plan\n\n- change distributed plan to sorted map\n- move JsonPlanFragment from QueryMonitor to JsonRenderer", "committedDate": "2020-04-03T17:22:05Z", "type": "forcePushed"}, {"oid": "e228e6471559cb70e2ce826cfde4ce2c90f47011", "url": "https://github.com/prestodb/presto/commit/e228e6471559cb70e2ce826cfde4ce2c90f47011", "message": "use sorted map for distributed plan\n\n- change distributed plan to sorted map\n- move JsonPlanFragment from QueryMonitor to JsonRenderer", "committedDate": "2020-04-07T03:22:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU3NDM1OQ==", "url": "https://github.com/prestodb/presto/pull/14261#discussion_r416574359", "bodyText": "nit: put this method before the previous one.", "author": "rschlussel", "createdAt": "2020-04-28T12:32:50Z", "path": "presto-main/src/main/java/com/facebook/presto/sql/planner/planPrinter/PlanPrinter.java", "diffHunk": "@@ -247,6 +249,53 @@ public static String textDistributedPlan(SubPlan plan, FunctionManager functionM\n         return builder.toString();\n     }\n \n+    public static String jsonLogicalPlan(\n+            PlanNode plan,\n+            TypeProvider types,\n+            Optional<StageExecutionDescriptor> stageExecutionStrategy,\n+            FunctionManager functionManager,\n+            StatsAndCosts estimatedStatsAndCosts,\n+            Session session,\n+            Optional<Map<PlanNodeId, PlanNodeStats>> stats)\n+    {\n+        return new PlanPrinter(plan, types, stageExecutionStrategy, functionManager, estimatedStatsAndCosts, session, stats).toJson();\n+    }\n+\n+    public static String jsonLogicalPlan(", "originalCommit": "e228e6471559cb70e2ce826cfde4ce2c90f47011", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU3NTU0Nw==", "url": "https://github.com/prestodb/presto/pull/14261#discussion_r416575547", "bodyText": "nit: static import", "author": "rschlussel", "createdAt": "2020-04-28T12:34:45Z", "path": "presto-main/src/main/java/com/facebook/presto/sql/analyzer/QueryExplainer.java", "diffHunk": "@@ -160,10 +160,17 @@ public String getJsonPlan(Session session, Statement statement, Type planType, L\n             return explainTask(statement, task, parameters);\n         }\n \n+        Plan plan;\n         switch (planType) {\n             case IO:\n-                Plan plan = getLogicalPlan(session, statement, parameters, warningCollector);\n+                plan = getLogicalPlan(session, statement, parameters, warningCollector);\n                 return textIOPlan(plan.getRoot(), metadata, session);\n+            case LOGICAL:\n+                plan = getLogicalPlan(session, statement, parameters, warningCollector);\n+                return PlanPrinter.jsonLogicalPlan(plan.getRoot(), plan.getTypes(), metadata.getFunctionManager(), plan.getStatsAndCosts(), session);", "originalCommit": "e228e6471559cb70e2ce826cfde4ce2c90f47011", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU3NTY0OA==", "url": "https://github.com/prestodb/presto/pull/14261#discussion_r416575648", "bodyText": "static import", "author": "rschlussel", "createdAt": "2020-04-28T12:34:54Z", "path": "presto-main/src/main/java/com/facebook/presto/sql/analyzer/QueryExplainer.java", "diffHunk": "@@ -160,10 +160,17 @@ public String getJsonPlan(Session session, Statement statement, Type planType, L\n             return explainTask(statement, task, parameters);\n         }\n \n+        Plan plan;\n         switch (planType) {\n             case IO:\n-                Plan plan = getLogicalPlan(session, statement, parameters, warningCollector);\n+                plan = getLogicalPlan(session, statement, parameters, warningCollector);\n                 return textIOPlan(plan.getRoot(), metadata, session);\n+            case LOGICAL:\n+                plan = getLogicalPlan(session, statement, parameters, warningCollector);\n+                return PlanPrinter.jsonLogicalPlan(plan.getRoot(), plan.getTypes(), metadata.getFunctionManager(), plan.getStatsAndCosts(), session);\n+            case DISTRIBUTED:\n+                SubPlan subPlan = getDistributedPlan(session, statement, parameters, warningCollector);\n+                return PlanPrinter.jsonDistributedPlan(subPlan);", "originalCommit": "e228e6471559cb70e2ce826cfde4ce2c90f47011", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6f8e023326142dfb140b27af207c873046bdecfb", "url": "https://github.com/prestodb/presto/commit/6f8e023326142dfb140b27af207c873046bdecfb", "message": "use static import\n\nchange method order", "committedDate": "2020-06-01T22:42:22Z", "type": "forcePushed"}, {"oid": "8940a1b11cc5017d5f3ef55fb0e1bb1e3280bbff", "url": "https://github.com/prestodb/presto/commit/8940a1b11cc5017d5f3ef55fb0e1bb1e3280bbff", "message": "use sorted map for distributed plan\n\n- change distributed plan to sorted map\n- move JsonPlanFragment from QueryMonitor to JsonRenderer", "committedDate": "2020-06-02T00:45:04Z", "type": "commit"}, {"oid": "c9fc3cd9fab51c6fb9071f2a62920b6dbdd98828", "url": "https://github.com/prestodb/presto/commit/c9fc3cd9fab51c6fb9071f2a62920b6dbdd98828", "message": "use static import\n\nchange method order", "committedDate": "2020-06-02T00:45:04Z", "type": "commit"}, {"oid": "c9fc3cd9fab51c6fb9071f2a62920b6dbdd98828", "url": "https://github.com/prestodb/presto/commit/c9fc3cd9fab51c6fb9071f2a62920b6dbdd98828", "message": "use static import\n\nchange method order", "committedDate": "2020-06-02T00:45:04Z", "type": "forcePushed"}]}