{"pr_number": 15136, "pr_title": "Warn on logical operators AND and OR expressions without explicit parenthesization ", "pr_createdAt": "2020-09-08T05:59:46Z", "pr_url": "https://github.com/prestodb/presto/pull/15136", "timeline": [{"oid": "85af18e254294c7bdb887fd9fc303d29ee7d3688", "url": "https://github.com/prestodb/presto/commit/85af18e254294c7bdb887fd9fc303d29ee7d3688", "message": "Exposing WarningCollector in SqlParser and AstBuilder class", "committedDate": "2020-09-08T06:20:05Z", "type": "forcePushed"}, {"oid": "68c780c9c52c45f7d7e1266d7f86a07908833632", "url": "https://github.com/prestodb/presto/commit/68c780c9c52c45f7d7e1266d7f86a07908833632", "message": "Exposing WarningCollector in SqlParser and AstBuilder class", "committedDate": "2020-09-09T07:46:47Z", "type": "forcePushed"}, {"oid": "e867ac044b6530baab9c6bcc53ceff55af007f47", "url": "https://github.com/prestodb/presto/commit/e867ac044b6530baab9c6bcc53ceff55af007f47", "message": "Exposing WarningCollector in SqlParser and AstBuilder class", "committedDate": "2020-09-09T08:22:39Z", "type": "forcePushed"}, {"oid": "b66bea1bfdd743f33f00514d8c09d4b78b3df5a2", "url": "https://github.com/prestodb/presto/commit/b66bea1bfdd743f33f00514d8c09d4b78b3df5a2", "message": "Exposing WarningCollector in SqlParser and AstBuilder class", "committedDate": "2020-09-10T03:14:36Z", "type": "forcePushed"}, {"oid": "7f6aef69f36e76ca0489fd3386b2dfcec52a6721", "url": "https://github.com/prestodb/presto/commit/7f6aef69f36e76ca0489fd3386b2dfcec52a6721", "message": "Exposing WarningCollector in SqlParser and AstBuilder class", "committedDate": "2020-09-10T04:07:46Z", "type": "forcePushed"}, {"oid": "468f683620c6d513c3541aaddc52bc1f8629be51", "url": "https://github.com/prestodb/presto/commit/468f683620c6d513c3541aaddc52bc1f8629be51", "message": "Parser warnings when the query contains mixed AND/OR operator without proper parenthesis.", "committedDate": "2020-09-12T00:47:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk4ODIxNw==", "url": "https://github.com/prestodb/presto/pull/15136#discussion_r488988217", "bodyText": "We normally use expression instanceof LogicalBinaryExpression.", "author": "rongrong", "createdAt": "2020-09-15T21:37:05Z", "path": "presto-parser/src/main/java/com/facebook/presto/sql/parser/AstBuilder.java", "diffHunk": "@@ -2410,6 +2436,23 @@ else if (context instanceof SqlBaseParser.RolePrincipalContext) {\n         }\n     }\n \n+    private boolean mixedAndOrOperatorParenthesisCheck(SqlBaseParser.BooleanExpressionContext node, LogicalBinaryExpression.Operator operator)\n+    {\n+        Expression expression = (Expression) visit(node);\n+        if (expression.getClass().equals(LogicalBinaryExpression.class)) {", "originalCommit": "468f683620c6d513c3541aaddc52bc1f8629be51", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk4ODQ5OA==", "url": "https://github.com/prestodb/presto/pull/15136#discussion_r488988498", "bodyText": "Same here and next line. Use instanceof", "author": "rongrong", "createdAt": "2020-09-15T21:37:25Z", "path": "presto-parser/src/main/java/com/facebook/presto/sql/parser/AstBuilder.java", "diffHunk": "@@ -2410,6 +2436,23 @@ else if (context instanceof SqlBaseParser.RolePrincipalContext) {\n         }\n     }\n \n+    private boolean mixedAndOrOperatorParenthesisCheck(SqlBaseParser.BooleanExpressionContext node, LogicalBinaryExpression.Operator operator)\n+    {\n+        Expression expression = (Expression) visit(node);\n+        if (expression.getClass().equals(LogicalBinaryExpression.class)) {\n+            if (((LogicalBinaryExpression) expression).getOperator().equals(operator)) {\n+                if (node.children.get(0).getClass().equals(SqlBaseParser.ValueExpressionDefaultContext.class)) {", "originalCommit": "468f683620c6d513c3541aaddc52bc1f8629be51", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e37e8b70178cec3a58b4d3279bcace8c4ee9d06d", "url": "https://github.com/prestodb/presto/commit/e37e8b70178cec3a58b4d3279bcace8c4ee9d06d", "message": "Parser warnings when the query contains mixed AND/OR operator without proper parenthesis.", "committedDate": "2020-09-15T22:56:58Z", "type": "forcePushed"}, {"oid": "c1acbd0aab26cd8046010d75ad773565beac80e4", "url": "https://github.com/prestodb/presto/commit/c1acbd0aab26cd8046010d75ad773565beac80e4", "message": "Parser warnings when the query contains mixed AND/OR operator without proper parenthesis.", "committedDate": "2020-09-16T01:31:08Z", "type": "commit"}, {"oid": "c1acbd0aab26cd8046010d75ad773565beac80e4", "url": "https://github.com/prestodb/presto/commit/c1acbd0aab26cd8046010d75ad773565beac80e4", "message": "Parser warnings when the query contains mixed AND/OR operator without proper parenthesis.", "committedDate": "2020-09-16T01:31:08Z", "type": "forcePushed"}]}