{"pr_number": 14124, "pr_title": "Optimize scan of filter-only no-nulls integers", "pr_createdAt": "2020-02-20T16:10:35Z", "pr_url": "https://github.com/prestodb/presto/pull/14124", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjMwNjQ4OA==", "url": "https://github.com/prestodb/presto/pull/14124#discussion_r382306488", "bodyText": "This can be readOffset = offset + positionCount;", "author": "yingsu00", "createdAt": "2020-02-20T22:59:21Z", "path": "presto-orc/src/main/java/com/facebook/presto/orc/reader/LongDirectSelectiveStreamReader.java", "diffHunk": "@@ -115,6 +115,25 @@ public int read(int offset, int[] positions, int positionCount)\n                 skip(offset - readOffset);\n             }\n \n+            if (positions[positionCount - 1] == positionCount - 1) {\n+                // no skipping\n+                if (presentStream == null) {\n+                    // no nulls\n+                    if (!outputRequired && filter != null && !filter.isPositionalFilter()) {\n+                        // no output; just filter\n+                        for (int i = 0; i < positionCount; i++) {\n+                            long value = dataStream.next();\n+                            if (filter.testLong(value)) {\n+                                outputPositions[outputPositionCount] = positions[i];\n+                                outputPositionCount++;\n+                            }\n+                        }\n+                        readOffset = offset + positions[positionCount - 1] + 1;", "originalCommit": "ec20ae17f7884244ef25414d2bcb429e3733ec44", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "69f6c4e13ece8f52d540a7e887acfa71d561099c", "url": "https://github.com/prestodb/presto/commit/69f6c4e13ece8f52d540a7e887acfa71d561099c", "message": "Optimize scan of filter-only no-nulls integers", "committedDate": "2020-02-21T01:17:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ2MTI0Nw==", "url": "https://github.com/prestodb/presto/pull/14124#discussion_r382461247", "bodyText": "javadoc maybe", "author": "highker", "createdAt": "2020-02-21T08:51:27Z", "path": "presto-orc/src/main/java/com/facebook/presto/orc/TupleDomainFilter.java", "diffHunk": "@@ -93,6 +93,9 @@\n      */\n     int getSucceedingPositionsToFail();\n \n+    // Returns true if getPrecedingPositionsToFail or getSucceedingPositionsToFail may return non-zero values", "originalCommit": "69f6c4e13ece8f52d540a7e887acfa71d561099c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e04dda1113794b55108c482582a0a99bf3a75aad", "url": "https://github.com/prestodb/presto/commit/e04dda1113794b55108c482582a0a99bf3a75aad", "message": "Optimize scan of filter-only no-nulls integers", "committedDate": "2020-02-21T14:42:07Z", "type": "commit"}, {"oid": "e04dda1113794b55108c482582a0a99bf3a75aad", "url": "https://github.com/prestodb/presto/commit/e04dda1113794b55108c482582a0a99bf3a75aad", "message": "Optimize scan of filter-only no-nulls integers", "committedDate": "2020-02-21T14:42:07Z", "type": "forcePushed"}]}