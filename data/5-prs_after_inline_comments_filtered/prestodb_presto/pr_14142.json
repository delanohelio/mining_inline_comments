{"pr_number": 14142, "pr_title": "Fail task with large update size", "pr_createdAt": "2020-02-21T23:41:08Z", "pr_url": "https://github.com/prestodb/presto/pull/14142", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjg3NDc3MA==", "url": "https://github.com/prestodb/presto/pull/14142#discussion_r382874770", "bodyText": "The test does not pass locally. Can we make something more reliable?", "author": "highker", "createdAt": "2020-02-22T01:46:57Z", "path": "presto-tests/src/test/java/com/facebook/presto/tests/TestTpchTaskUpdateSizeLimitIntegrationTest.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.tests;\n+\n+import com.facebook.presto.Session;\n+import com.google.common.collect.ImmutableMap;\n+import org.testng.annotations.Test;\n+\n+import static com.facebook.presto.tests.tpch.TpchQueryRunner.createQueryRunner;\n+\n+public class TestTpchTaskUpdateSizeLimitIntegrationTest\n+        extends AbstractTestQueryFramework\n+{\n+    @SuppressWarnings(\"unused\")\n+    public TestTpchTaskUpdateSizeLimitIntegrationTest()\n+    {\n+        this(() -> createQueryRunner(ImmutableMap.of(\"experimental.internal-communication.max-task-update-size\", \"10kB\")));\n+    }\n+\n+    protected TestTpchTaskUpdateSizeLimitIntegrationTest(QueryRunnerSupplier queryRunnerSupplier)\n+    {\n+        super(queryRunnerSupplier);\n+    }\n+\n+    @Test\n+    public void testTaskUpdateSizeLimit()", "originalCommit": "e7ab662e9dd05bf97f29cac0296f727dfd5f4e54", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjg3ODU5Ng==", "url": "https://github.com/prestodb/presto/pull/14142#discussion_r382878596", "bodyText": "The test passes locally when i tested on my laptop. Not sure why it fails here. Do you have any suggestion as to how I should write a query so that it bloats up the TaskUpdate size and fails??", "author": "NikhilCollooru", "createdAt": "2020-02-22T02:33:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjg3NDc3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjg3OTAxMg==", "url": "https://github.com/prestodb/presto/pull/14142#discussion_r382879012", "bodyText": "Reduce the allowed size to a very low number? What if this is reduced to 100B ?", "author": "mayankgarg1990", "createdAt": "2020-02-22T02:40:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjg3NDc3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkzMDc2OA==", "url": "https://github.com/prestodb/presto/pull/14142#discussion_r382930768", "bodyText": "Reducing the allowed size to 100B fixed it.", "author": "NikhilCollooru", "createdAt": "2020-02-22T18:12:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjg3NDc3MA=="}], "type": "inlineReview"}, {"oid": "e6e393e025f588a31dfcc108618893e825a0ddef", "url": "https://github.com/prestodb/presto/commit/e6e393e025f588a31dfcc108618893e825a0ddef", "message": "Fail task with large update size\n\nFail the query when the task update size\nexceeds the limit set by the parameter\nexperimental.internal-communication.max-task-update-size.", "committedDate": "2020-02-22T03:14:38Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkzNDQwNw==", "url": "https://github.com/prestodb/presto/pull/14142#discussion_r382934407", "bodyText": "remove", "author": "highker", "createdAt": "2020-02-22T19:13:01Z", "path": "presto-tests/src/test/java/com/facebook/presto/tests/TestTpchTaskUpdateSizeLimitIntegrationTest.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.tests;\n+\n+import com.facebook.presto.Session;\n+import com.google.common.collect.ImmutableMap;\n+import org.testng.annotations.Test;\n+\n+import static com.facebook.presto.tests.tpch.TpchQueryRunner.createQueryRunner;\n+\n+public class TestTpchTaskUpdateSizeLimitIntegrationTest\n+        extends AbstractTestQueryFramework\n+{\n+    @SuppressWarnings(\"unused\")", "originalCommit": "e6e393e025f588a31dfcc108618893e825a0ddef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkzNDQxOA==", "url": "https://github.com/prestodb/presto/pull/14142#discussion_r382934418", "bodyText": "remove", "author": "highker", "createdAt": "2020-02-22T19:13:07Z", "path": "presto-tests/src/test/java/com/facebook/presto/tests/TestTpchTaskUpdateSizeLimitIntegrationTest.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.tests;\n+\n+import com.facebook.presto.Session;\n+import com.google.common.collect.ImmutableMap;\n+import org.testng.annotations.Test;\n+\n+import static com.facebook.presto.tests.tpch.TpchQueryRunner.createQueryRunner;\n+\n+public class TestTpchTaskUpdateSizeLimitIntegrationTest\n+        extends AbstractTestQueryFramework\n+{\n+    @SuppressWarnings(\"unused\")\n+    public TestTpchTaskUpdateSizeLimitIntegrationTest()\n+    {\n+        this(() -> createQueryRunner(ImmutableMap.of(\"experimental.internal-communication.max-task-update-size\", \"100B\")));\n+    }\n+\n+    protected TestTpchTaskUpdateSizeLimitIntegrationTest(QueryRunnerSupplier queryRunnerSupplier)", "originalCommit": "e6e393e025f588a31dfcc108618893e825a0ddef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkzNDQyNw==", "url": "https://github.com/prestodb/presto/pull/14142#discussion_r382934427", "bodyText": "super(() -> createQueryRunner(ImmutableMap.of(\"experimental.internal-communication.max-task-update-size\", \"100B\")));", "author": "highker", "createdAt": "2020-02-22T19:13:17Z", "path": "presto-tests/src/test/java/com/facebook/presto/tests/TestTpchTaskUpdateSizeLimitIntegrationTest.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.tests;\n+\n+import com.facebook.presto.Session;\n+import com.google.common.collect.ImmutableMap;\n+import org.testng.annotations.Test;\n+\n+import static com.facebook.presto.tests.tpch.TpchQueryRunner.createQueryRunner;\n+\n+public class TestTpchTaskUpdateSizeLimitIntegrationTest\n+        extends AbstractTestQueryFramework\n+{\n+    @SuppressWarnings(\"unused\")\n+    public TestTpchTaskUpdateSizeLimitIntegrationTest()\n+    {\n+        this(() -> createQueryRunner(ImmutableMap.of(\"experimental.internal-communication.max-task-update-size\", \"100B\")));", "originalCommit": "e6e393e025f588a31dfcc108618893e825a0ddef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkzNDcxOQ==", "url": "https://github.com/prestodb/presto/pull/14142#discussion_r382934719", "bodyText": "one param per line; leave the first line empty", "author": "highker", "createdAt": "2020-02-22T19:18:03Z", "path": "presto-tests/src/test/java/com/facebook/presto/tests/TestTpchTaskUpdateSizeLimitIntegrationTest.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.tests;\n+\n+import com.facebook.presto.Session;\n+import com.google.common.collect.ImmutableMap;\n+import org.testng.annotations.Test;\n+\n+import static com.facebook.presto.tests.tpch.TpchQueryRunner.createQueryRunner;\n+\n+public class TestTpchTaskUpdateSizeLimitIntegrationTest\n+        extends AbstractTestQueryFramework\n+{\n+    @SuppressWarnings(\"unused\")\n+    public TestTpchTaskUpdateSizeLimitIntegrationTest()\n+    {\n+        this(() -> createQueryRunner(ImmutableMap.of(\"experimental.internal-communication.max-task-update-size\", \"100B\")));\n+    }\n+\n+    protected TestTpchTaskUpdateSizeLimitIntegrationTest(QueryRunnerSupplier queryRunnerSupplier)\n+    {\n+        super(queryRunnerSupplier);\n+    }\n+\n+    @Test\n+    public void testTaskUpdateSizeLimit()\n+    {\n+        Session session = Session.builder(getSession()).build();\n+        assertQueryFails(session, \"SELECT * \" +", "originalCommit": "e6e393e025f588a31dfcc108618893e825a0ddef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkzNDc5Mg==", "url": "https://github.com/prestodb/presto/pull/14142#discussion_r382934792", "bodyText": "Not need to have such complicated example. Just use SELECT * FROM ORDERS LIMIT 10", "author": "highker", "createdAt": "2020-02-22T19:19:14Z", "path": "presto-tests/src/test/java/com/facebook/presto/tests/TestTpchTaskUpdateSizeLimitIntegrationTest.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.tests;\n+\n+import com.facebook.presto.Session;\n+import com.google.common.collect.ImmutableMap;\n+import org.testng.annotations.Test;\n+\n+import static com.facebook.presto.tests.tpch.TpchQueryRunner.createQueryRunner;\n+\n+public class TestTpchTaskUpdateSizeLimitIntegrationTest\n+        extends AbstractTestQueryFramework\n+{\n+    @SuppressWarnings(\"unused\")\n+    public TestTpchTaskUpdateSizeLimitIntegrationTest()\n+    {\n+        this(() -> createQueryRunner(ImmutableMap.of(\"experimental.internal-communication.max-task-update-size\", \"100B\")));\n+    }\n+\n+    protected TestTpchTaskUpdateSizeLimitIntegrationTest(QueryRunnerSupplier queryRunnerSupplier)\n+    {\n+        super(queryRunnerSupplier);\n+    }\n+\n+    @Test\n+    public void testTaskUpdateSizeLimit()\n+    {\n+        Session session = Session.builder(getSession()).build();\n+        assertQueryFails(session, \"SELECT * \" +\n+                        \"FROM ORDERS \" +", "originalCommit": "e6e393e025f588a31dfcc108618893e825a0ddef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkzNDc5OA==", "url": "https://github.com/prestodb/presto/pull/14142#discussion_r382934798", "bodyText": "not useful, just use getSession() in place.", "author": "highker", "createdAt": "2020-02-22T19:19:26Z", "path": "presto-tests/src/test/java/com/facebook/presto/tests/TestTpchTaskUpdateSizeLimitIntegrationTest.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.tests;\n+\n+import com.facebook.presto.Session;\n+import com.google.common.collect.ImmutableMap;\n+import org.testng.annotations.Test;\n+\n+import static com.facebook.presto.tests.tpch.TpchQueryRunner.createQueryRunner;\n+\n+public class TestTpchTaskUpdateSizeLimitIntegrationTest\n+        extends AbstractTestQueryFramework\n+{\n+    @SuppressWarnings(\"unused\")\n+    public TestTpchTaskUpdateSizeLimitIntegrationTest()\n+    {\n+        this(() -> createQueryRunner(ImmutableMap.of(\"experimental.internal-communication.max-task-update-size\", \"100B\")));\n+    }\n+\n+    protected TestTpchTaskUpdateSizeLimitIntegrationTest(QueryRunnerSupplier queryRunnerSupplier)\n+    {\n+        super(queryRunnerSupplier);\n+    }\n+\n+    @Test\n+    public void testTaskUpdateSizeLimit()\n+    {\n+        Session session = Session.builder(getSession()).build();", "originalCommit": "e6e393e025f588a31dfcc108618893e825a0ddef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f340a0d210a7eb63457598f5b61b6eba102a6083", "url": "https://github.com/prestodb/presto/commit/f340a0d210a7eb63457598f5b61b6eba102a6083", "message": "Fail task with large update size\n\nFail the query when the task update size\nexceeds the limit set by the parameter\nexperimental.internal-communication.max-task-update-size.", "committedDate": "2020-02-22T19:31:18Z", "type": "commit"}, {"oid": "f340a0d210a7eb63457598f5b61b6eba102a6083", "url": "https://github.com/prestodb/presto/commit/f340a0d210a7eb63457598f5b61b6eba102a6083", "message": "Fail task with large update size\n\nFail the query when the task update size\nexceeds the limit set by the parameter\nexperimental.internal-communication.max-task-update-size.", "committedDate": "2020-02-22T19:31:18Z", "type": "forcePushed"}]}