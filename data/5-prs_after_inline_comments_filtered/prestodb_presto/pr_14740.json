{"pr_number": 14740, "pr_title": "Fix confusion matrix computation for classification function", "pr_createdAt": "2020-06-28T08:50:36Z", "pr_url": "https://github.com/prestodb/presto/pull/14740", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI1MTg4MQ==", "url": "https://github.com/prestodb/presto/pull/14740#discussion_r447251881", "bodyText": "Could you also define falseNegative before calculating miss rate,  to be consistent with that in TestClassificationPrecisionAggregation.java", "author": "viczhang861", "createdAt": "2020-06-29T21:02:07Z", "path": "presto-main/src/test/java/com/facebook/presto/operator/TestClassificationMissRateAggregation.java", "diffHunk": "@@ -34,7 +34,7 @@ public TestClassificationMissRateAggregation()\n         final ArrayList<Double> expected = new ArrayList<>();\n         while (iterator.hasNext()) {\n             final BucketResult result = iterator.next();\n-            final double missRate = result.remainingFalseWeight / result.totalTrueWeight;\n+            final double missRate = (result.totalTrueWeight - result.remainingTrueWeight) / result.totalTrueWeight;", "originalCommit": "481855a79cd658ba5f9c31b5601b60b26ed09e22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ4MTk1NA==", "url": "https://github.com/prestodb/presto/pull/14740#discussion_r447481954", "bodyText": "done.", "author": "fornaix", "createdAt": "2020-06-30T07:50:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI1MTg4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI1MjMwMA==", "url": "https://github.com/prestodb/presto/pull/14740#discussion_r447252300", "bodyText": "Did we only test execution path rather than real expected value? Ideally, unit test should exist to catch this error.", "author": "viczhang861", "createdAt": "2020-06-29T21:02:57Z", "path": "presto-main/src/test/java/com/facebook/presto/operator/TestClassificationMissRateAggregation.java", "diffHunk": "@@ -34,7 +34,7 @@ public TestClassificationMissRateAggregation()\n         final ArrayList<Double> expected = new ArrayList<>();\n         while (iterator.hasNext()) {\n             final BucketResult result = iterator.next();\n-            final double missRate = result.remainingFalseWeight / result.totalTrueWeight;\n+            final double missRate = (result.totalTrueWeight - result.remainingTrueWeight) / result.totalTrueWeight;\n             expected.add(missRate);\n         }\n         return expected;", "originalCommit": "481855a79cd658ba5f9c31b5601b60b26ed09e22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ3OTA0OA==", "url": "https://github.com/prestodb/presto/pull/14740#discussion_r447479048", "bodyText": "I think it did test the expected value. But expected values are calculated at runtime, so the computation in unit test and function must keep consistent. Once the basic definition is wrong, we can't catch the error.", "author": "fornaix", "createdAt": "2020-06-30T07:46:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI1MjMwMA=="}], "type": "inlineReview"}, {"oid": "0d64fedfc6feb63977e32e07b9fc83c3cc76b9bb", "url": "https://github.com/prestodb/presto/commit/0d64fedfc6feb63977e32e07b9fc83c3cc76b9bb", "message": "Fix confusion matrix computation for classification function", "committedDate": "2020-06-30T07:48:11Z", "type": "forcePushed"}, {"oid": "6d8dd9159ca7897f0d9991d32976c33fbebff3e3", "url": "https://github.com/prestodb/presto/commit/6d8dd9159ca7897f0d9991d32976c33fbebff3e3", "message": "Fix confusion matrix computation for classification function", "committedDate": "2020-06-30T08:20:07Z", "type": "commit"}, {"oid": "6d8dd9159ca7897f0d9991d32976c33fbebff3e3", "url": "https://github.com/prestodb/presto/commit/6d8dd9159ca7897f0d9991d32976c33fbebff3e3", "message": "Fix confusion matrix computation for classification function", "committedDate": "2020-06-30T08:20:07Z", "type": "forcePushed"}]}