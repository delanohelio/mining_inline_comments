{"pr_number": 14332, "pr_title": "Make table properties a config property", "pr_createdAt": "2020-04-03T20:19:59Z", "pr_url": "https://github.com/prestodb/presto/pull/14332", "timeline": [{"oid": "180a14c00838162978acfc0c23e7f872f8df37db", "url": "https://github.com/prestodb/presto/commit/180a14c00838162978acfc0c23e7f872f8df37db", "message": "Make table properties a config property instead of hard-coded", "committedDate": "2020-04-03T20:41:25Z", "type": "forcePushed"}, {"oid": "fac6a290cdec84db5e707bdd2864ec4a3347899c", "url": "https://github.com/prestodb/presto/commit/fac6a290cdec84db5e707bdd2864ec4a3347899c", "message": "Make table properties a config property instead of hard-coded", "committedDate": "2020-04-03T21:02:36Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM0OTExMQ==", "url": "https://github.com/prestodb/presto/pull/14332#discussion_r403349111", "bodyText": "I'm confused about the changes here as I lacked a lot of context. Why did we remove QueryRewriteConfig and use prefix?", "author": "shixuan-fan", "createdAt": "2020-04-03T21:38:33Z", "path": "presto-verifier/src/main/java/com/facebook/presto/verifier/rewrite/VerificationQueryRewriterFactory.java", "diffHunk": "@@ -15,42 +15,54 @@\n \n import com.facebook.presto.spi.type.TypeManager;\n import com.facebook.presto.sql.parser.SqlParser;\n+import com.facebook.presto.sql.tree.BooleanLiteral;\n+import com.facebook.presto.sql.tree.DoubleLiteral;\n+import com.facebook.presto.sql.tree.Identifier;\n+import com.facebook.presto.sql.tree.LongLiteral;\n import com.facebook.presto.sql.tree.Property;\n+import com.facebook.presto.sql.tree.QualifiedName;\n+import com.facebook.presto.sql.tree.StringLiteral;\n import com.facebook.presto.verifier.annotation.ForControl;\n import com.facebook.presto.verifier.annotation.ForTest;\n import com.facebook.presto.verifier.prestoaction.PrestoAction;\n+import com.google.common.collect.ImmutableList;\n import com.google.common.collect.ImmutableMap;\n \n import javax.inject.Inject;\n \n import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n \n+import static com.facebook.presto.sql.tree.BooleanLiteral.FALSE_LITERAL;\n import static com.facebook.presto.verifier.framework.ClusterType.CONTROL;\n import static com.facebook.presto.verifier.framework.ClusterType.TEST;\n+import static java.lang.String.format;\n import static java.util.Objects.requireNonNull;\n \n public class VerificationQueryRewriterFactory\n         implements QueryRewriterFactory\n {\n     private final SqlParser sqlParser;\n     private final TypeManager typeManager;\n-    private final List<Property> tablePropertyOverrides;\n-    private final QueryRewriteConfig controlConfig;\n-    private final QueryRewriteConfig testConfig;\n+    private final QualifiedName controlTablePrefix;", "originalCommit": "fac6a290cdec84db5e707bdd2864ec4a3347899c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM1MzY0Mw==", "url": "https://github.com/prestodb/presto/pull/14332#discussion_r403353643", "bodyText": "QueryRewriteConfig used to have only 1 field: tablePrefix. Instead of storing the QueryRewriteConfig object, the change here is to extract and store that field directly.\nA new field tableProperties is added to QueryRewriteConfig in this PR. In the constructor, we're converting it from Map<String, Object> to List<Property> and store it list. If these is any Exception thrown in constructProperties, I want it to throw in the constructor so that injection will fail and verification will not start. Otherwise, if the Exception is thrown in the create method, verification is already started and all verifications will complete but with FAILED status.", "author": "caithagoras", "createdAt": "2020-04-03T21:50:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM0OTExMQ=="}], "type": "inlineReview"}, {"oid": "a823f477f09bd3d55f810579ae2551017b1a3963", "url": "https://github.com/prestodb/presto/commit/a823f477f09bd3d55f810579ae2551017b1a3963", "message": "Make table properties a config property instead of hardcoded", "committedDate": "2020-04-03T23:04:59Z", "type": "forcePushed"}, {"oid": "89566a8d38fb0b5ae642f2fbe0144dc5d545b765", "url": "https://github.com/prestodb/presto/commit/89566a8d38fb0b5ae642f2fbe0144dc5d545b765", "message": "Make table properties a config property instead of hard-coded", "committedDate": "2020-04-04T23:28:37Z", "type": "commit"}, {"oid": "89566a8d38fb0b5ae642f2fbe0144dc5d545b765", "url": "https://github.com/prestodb/presto/commit/89566a8d38fb0b5ae642f2fbe0144dc5d545b765", "message": "Make table properties a config property instead of hard-coded", "committedDate": "2020-04-04T23:28:37Z", "type": "forcePushed"}]}