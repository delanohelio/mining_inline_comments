{"pr_number": 14147, "pr_title": "Use absolute error when a floating point column mean is close to 0", "pr_createdAt": "2020-02-23T08:46:29Z", "pr_url": "https://github.com/prestodb/presto/pull/14147", "timeline": [{"oid": "0cb30a613dc7f724656f04401606d646f550ee8b", "url": "https://github.com/prestodb/presto/commit/0cb30a613dc7f724656f04401606d646f550ee8b", "message": "Use absolute error when a floating point column mean is close to 0\n\nInstead of requiring either the control mean or the test mean to\nbe exactly 0, use the absolute error rule when at least one of them\nis close to 0.", "committedDate": "2020-02-23T08:48:22Z", "type": "forcePushed"}, {"oid": "dcf0ace0eb064996316a3f086f6ffda1567c8921", "url": "https://github.com/prestodb/presto/commit/dcf0ace0eb064996316a3f086f6ffda1567c8921", "message": "Use absolute error when a floating point column mean is close to 0\n\nInstead of requiring either the control mean or the test mean to\nbe exactly 0, use the absolute error rule when at least one of them\nis close to 0.", "committedDate": "2020-02-23T08:49:09Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzM1NTA5Mg==", "url": "https://github.com/prestodb/presto/pull/14147#discussion_r383355092", "bodyText": "It is possible for controlResult.getRowCount() to return zero here? If not, perhaps, add a comment to explain why.", "author": "mbasmanova", "createdAt": "2020-02-24T16:02:55Z", "path": "presto-verifier/src/main/java/com/facebook/presto/verifier/checksum/FloatingPointColumnValidator.java", "diffHunk": "@@ -158,14 +158,13 @@ public FloatingPointColumnValidator(VerifierConfig config)\n         }\n \n         // Use absolute error margin if either control sum or test sum is 0\n-        if (controlSum == 0 || testSum == 0) {\n-            double controlMean = controlSum / controlResult.getRowCount();\n-            double testMean = testSum / controlResult.getRowCount();\n-            double difference = abs(controlMean - testMean);\n+        double controlMean = controlSum / controlResult.getRowCount();", "originalCommit": "dcf0ace0eb064996316a3f086f6ffda1567c8921", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzU4NzY1Nw==", "url": "https://github.com/prestodb/presto/pull/14147#discussion_r383587657", "bodyText": "Comment added: Row count won't be zero since otherwise controlSum and testSum will both be null, and this has already been handled above.", "author": "caithagoras", "createdAt": "2020-02-25T00:07:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzM1NTA5Mg=="}], "type": "inlineReview"}, {"oid": "c28f0054369d4b01a07f4a6e9890b71d2b87a9eb", "url": "https://github.com/prestodb/presto/commit/c28f0054369d4b01a07f4a6e9890b71d2b87a9eb", "message": "Use absolute error when a floating point column mean is close to 0\n\nInstead of requiring either the control mean or the test mean to\nbe exactly 0, use the absolute error rule when at least one of them\nis close to 0.", "committedDate": "2020-02-25T00:04:42Z", "type": "forcePushed"}, {"oid": "dcb9be7a85e4d5a68eb4ee6b901d046103762d7d", "url": "https://github.com/prestodb/presto/commit/dcb9be7a85e4d5a68eb4ee6b901d046103762d7d", "message": "Use absolute error when a floating point column mean is close to 0\n\nInstead of requiring either the control mean or the test mean to\nbe exactly 0, use the absolute error rule when at least one of them\nis close to 0.", "committedDate": "2020-02-25T00:06:44Z", "type": "commit"}, {"oid": "dcb9be7a85e4d5a68eb4ee6b901d046103762d7d", "url": "https://github.com/prestodb/presto/commit/dcb9be7a85e4d5a68eb4ee6b901d046103762d7d", "message": "Use absolute error when a floating point column mean is close to 0\n\nInstead of requiring either the control mean or the test mean to\nbe exactly 0, use the absolute error rule when at least one of them\nis close to 0.", "committedDate": "2020-02-25T00:06:44Z", "type": "forcePushed"}]}