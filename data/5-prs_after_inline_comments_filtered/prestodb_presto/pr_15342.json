{"pr_number": 15342, "pr_title": "[Verifier] Fix JDBC URL selection", "pr_createdAt": "2020-10-21T20:51:08Z", "pr_url": "https://github.com/prestodb/presto/pull/15342", "timeline": [{"oid": "6a44308a8826e1b01bd3e04ee28deb01e2465519", "url": "https://github.com/prestodb/presto/commit/6a44308a8826e1b01bd3e04ee28deb01e2465519", "message": "Synchronize JDBC URL iteration", "committedDate": "2020-10-21T22:29:02Z", "type": "forcePushed"}, {"oid": "26ba2b957212635d824ea023035767bce4e71d0c", "url": "https://github.com/prestodb/presto/commit/26ba2b957212635d824ea023035767bce4e71d0c", "message": "Fix JDBC URL selection\n\nPreviously, the JDBC URL iterator object is created in PrestoAction,\nwhich is an emphemeral object as we create new PrestoActions for\neach source query. This causes the first url to always be selected.", "committedDate": "2020-10-21T22:32:09Z", "type": "forcePushed"}, {"oid": "9e76165137f8aacae201c0b04373204ee387437e", "url": "https://github.com/prestodb/presto/commit/9e76165137f8aacae201c0b04373204ee387437e", "message": "Fix JDBC URL selection\n\nPreviously, the JDBC URL iterator object is created in PrestoAction,\nwhich is an emphemeral object as we create new PrestoActions for\neach source query. This causes the first url to always be selected.", "committedDate": "2020-10-21T22:59:36Z", "type": "commit"}, {"oid": "9e76165137f8aacae201c0b04373204ee387437e", "url": "https://github.com/prestodb/presto/commit/9e76165137f8aacae201c0b04373204ee387437e", "message": "Fix JDBC URL selection\n\nPreviously, the JDBC URL iterator object is created in PrestoAction,\nwhich is an emphemeral object as we create new PrestoActions for\neach source query. This causes the first url to always be selected.", "committedDate": "2020-10-21T22:59:36Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTc4ODAyMQ==", "url": "https://github.com/prestodb/presto/pull/15342#discussion_r509788021", "bodyText": "Should we add a test to make sure that we actually cycle over the jdbc urls?", "author": "sachdevs", "createdAt": "2020-10-21T23:14:37Z", "path": "presto-verifier/src/test/java/com/facebook/presto/verifier/rewrite/TestQueryRewriter.java", "diffHunk": "@@ -76,13 +77,15 @@ public void setup()\n     {\n         queryRunner = setupPresto();\n         queryRunner.execute(\"CREATE TABLE test_table (a bigint, b varchar)\");\n+        PrestoActionConfig prestoActionConfig = new PrestoActionConfig()\n+                .setHosts(queryRunner.getServer().getAddress().getHost())\n+                .setJdbcPort(queryRunner.getServer().getAddress().getPort());\n         prestoAction = new JdbcPrestoAction(\n                 PrestoExceptionClassifier.defaultBuilder().build(),\n                 CONFIGURATION,\n                 VerificationContext.create(SUITE, NAME),\n-                new PrestoActionConfig()\n-                        .setHosts(queryRunner.getServer().getAddress().getHost())\n-                        .setJdbcPort(queryRunner.getServer().getAddress().getPort()),\n+                new JdbcUrlSelector(prestoActionConfig.getJdbcUrls()),\n+                prestoActionConfig,", "originalCommit": "9e76165137f8aacae201c0b04373204ee387437e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDM3MzA4MQ==", "url": "https://github.com/prestodb/presto/pull/15342#discussion_r510373081", "bodyText": "I'll merge this to unblock the fix first.", "author": "caithagoras", "createdAt": "2020-10-22T18:31:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTc4ODAyMQ=="}], "type": "inlineReview"}]}