{"pr_number": 14699, "pr_title": "Close PrestoSparkService on the Driver", "pr_createdAt": "2020-06-22T22:01:00Z", "pr_url": "https://github.com/prestodb/presto/pull/14699", "timeline": [{"oid": "5bf93f001e562863b71550895b20abc342864229", "url": "https://github.com/prestodb/presto/commit/5bf93f001e562863b71550895b20abc342864229", "message": "Close PrestoSparkService on the Driver", "committedDate": "2020-06-22T22:00:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg5MDgwOA==", "url": "https://github.com/prestodb/presto/pull/14699#discussion_r443890808", "bodyText": "why no longer need processType ?", "author": "wenleix", "createdAt": "2020-06-23T00:11:29Z", "path": "presto-spark-base/src/test/java/com/facebook/presto/spark/PrestoSparkQueryRunner.java", "diffHunk": "@@ -480,7 +479,7 @@ private TestingPrestoSparkTaskExecutorFactoryProvider(String instanceId)\n         }\n \n         @Override\n-        public IPrestoSparkTaskExecutorFactory get(SparkProcessType processType)\n+        public IPrestoSparkTaskExecutorFactory get()", "originalCommit": "5bf93f001e562863b71550895b20abc342864229", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI5Njg3OQ==", "url": "https://github.com/prestodb/presto/pull/14699#discussion_r444296879", "bodyText": "PrestoSparkTaskExecutorFactoryProvider is only used to create tasks on executor, so it is always EXECUTOR.", "author": "arhimondr", "createdAt": "2020-06-23T15:05:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg5MDgwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg5MjE1Ng==", "url": "https://github.com/prestodb/presto/pull/14699#discussion_r443892156", "bodyText": "This class name is very wordy.. \ud83d\ude03", "author": "wenleix", "createdAt": "2020-06-23T00:16:37Z", "path": "presto-spark-launcher/src/main/java/com/facebook/presto/spark/launcher/PrestoSparkRunner.java", "diffHunk": "@@ -122,48 +134,64 @@ private static IPrestoSparkServiceFactory createServiceFactory(File directory)\n         return serviceLoader.iterator().next();\n     }\n \n-    private static class CachingServiceFactory\n-            implements Serializable\n+    private static IPrestoSparkService createService(\n+            SparkProcessType sparkProcessType,\n+            PackageSupplier packageSupplier,\n+            Map<String, String> configProperties,\n+            Map<String, Map<String, String>> catalogProperties)\n     {\n-        private static IPrestoSparkService service;\n+        String packagePath = getPackagePath(packageSupplier);\n+        File pluginsDirectory = checkDirectory(new File(packagePath, \"plugin\"));\n+        PrestoSparkConfiguration configuration = new PrestoSparkConfiguration(configProperties, pluginsDirectory.getAbsolutePath(), catalogProperties);\n+        IPrestoSparkServiceFactory serviceFactory = createServiceFactory(checkDirectory(new File(packagePath, \"lib\")));\n+        return serviceFactory.createService(sparkProcessType, configuration);\n+    }\n \n-        private static String currentPackagePath;\n-        private static Map<String, String> currentConfigProperties;\n-        private static Map<String, Map<String, String>> currentCatalogProperties;\n-        private static SparkProcessType currentProcessEnvironment;\n+    private static String getPackagePath(PackageSupplier packageSupplier)\n+    {\n+        return checkDirectory(packageSupplier.getPrestoSparkPackageDirectory()).getAbsolutePath();\n+    }\n \n+    private static class DistributionBasedPrestoSparkTaskExecutorFactoryProvider", "originalCommit": "5bf93f001e562863b71550895b20abc342864229", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI5NzA3OQ==", "url": "https://github.com/prestodb/presto/pull/14699#discussion_r444297079", "bodyText": "Yeah, unfortunately i didn't find a better name. We can think of a better name later.", "author": "arhimondr", "createdAt": "2020-06-23T15:06:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg5MjE1Ng=="}], "type": "inlineReview"}]}