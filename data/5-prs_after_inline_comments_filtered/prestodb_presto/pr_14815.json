{"pr_number": 14815, "pr_title": "Skip isSplittable reflection for RCFileInputFormat ", "pr_createdAt": "2020-07-09T05:42:26Z", "pr_url": "https://github.com/prestodb/presto/pull/14815", "timeline": [{"oid": "1ad4cdfc007cb5f469870747b8ab445b344f06ba", "url": "https://github.com/prestodb/presto/commit/1ad4cdfc007cb5f469870747b8ab445b344f06ba", "message": "Skip method reflection for isSplittable\n\nCurrently, presto relies on the method reflection to find out if the\ninput format is splittable for all input formats except OrcInputFormat.\nUsing the method reflection is a costly operation, hence avoiding the\nmethod reflection for most of the splittable input formats.", "committedDate": "2020-07-09T06:05:20Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjU5NDgxNg==", "url": "https://github.com/prestodb/presto/pull/14815#discussion_r452594816", "bodyText": "Seems EncryptedOrcInputFormat is the only inheritance of OrcInputFormat. So,\ninputFormat.getClass().getSimpleName().equals(\"OrcInputFormat\")\nis equivalent to\ninputFormat instance of OrcInputFormat && !(inputFormat instance of EncryptedOrcInputFormat))\nright?\nFor EncryptedOrcInputFormat, given we are not using the open-source encryption, so we can ignore that and just use inputFormat instance of OrcInputFormat.", "author": "highker", "createdAt": "2020-07-10T02:52:12Z", "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveUtil.java", "diffHunk": "@@ -340,12 +342,14 @@ public static long parseHiveTimestamp(String value, DateTimeZone timeZone)\n \n     public static boolean isSplittable(InputFormat<?, ?> inputFormat, FileSystem fileSystem, Path path)\n     {\n-        // ORC uses a custom InputFormat but is always splittable\n-        if (inputFormat.getClass().getSimpleName().equals(\"OrcInputFormat\")) {\n+        //This check covers, ORC/DWRF/AVRO/RCBINARY/RCTEXT/SEQUENCEFILE/PAGEFILE storage formats.\n+        if (inputFormat instanceof FileInputFormat ||", "originalCommit": "1ad4cdfc007cb5f469870747b8ab445b344f06ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjYwODQ2MA==", "url": "https://github.com/prestodb/presto/pull/14815#discussion_r452608460", "bodyText": "I am not entirely sure what exactly you are trying to infer.  Yes, following is correct.\ninputFormat.getClass().getSimpleName().equals(\"OrcInputFormat\")\nis equivalent to\ninputFormat instance of OrcInputFormat && !(inputFormat instance of EncryptedOrcInputFormat))\nThis check will ensure isSpittable to true for EncryptedOrcInputFormat.", "author": "jainxrohit", "createdAt": "2020-07-10T03:52:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjU5NDgxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjYxMDQxNA==", "url": "https://github.com/prestodb/presto/pull/14815#discussion_r452610414", "bodyText": "Actually now I realize this change is bad. Its blindly assuming all extensions of FileInputFormat to be splittable, which may not be the case.", "author": "jainxrohit", "createdAt": "2020-07-10T04:02:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjU5NDgxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjYxMDU4OQ==", "url": "https://github.com/prestodb/presto/pull/14815#discussion_r452610589", "bodyText": "I am only going to extend the condition for RCFileInputFormat only.", "author": "jainxrohit", "createdAt": "2020-07-10T04:03:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjU5NDgxNg=="}], "type": "inlineReview"}, {"oid": "e68c0e3fa4e38a878c4d2f50260f5a5494490e65", "url": "https://github.com/prestodb/presto/commit/e68c0e3fa4e38a878c4d2f50260f5a5494490e65", "message": "Skip method reflection for isSplittable\n\nCurrently, presto relies on the method reflection to find out if the\ninput format is splittable for all input formats except OrcInputFormat.\nUsing the method reflection is a costly operation, hence avoiding the\nmethod reflection for most of the splittable input formats.", "committedDate": "2020-07-10T04:15:55Z", "type": "forcePushed"}, {"oid": "94cf270cafc3082f218bd8c6c133d1427ba0e276", "url": "https://github.com/prestodb/presto/commit/94cf270cafc3082f218bd8c6c133d1427ba0e276", "message": "Skip isSplittable reflection for RCFileInputFormat\n\nCurrently, presto relies on the method reflection to find out if the\ninput format is splittable for all input formats except OrcInputFormat.\nUsing the method reflection is a costly operation, hence avoiding the\nmethod reflection for RCFileInputFormat as well.", "committedDate": "2020-07-10T17:26:51Z", "type": "commit"}, {"oid": "94cf270cafc3082f218bd8c6c133d1427ba0e276", "url": "https://github.com/prestodb/presto/commit/94cf270cafc3082f218bd8c6c133d1427ba0e276", "message": "Skip isSplittable reflection for RCFileInputFormat\n\nCurrently, presto relies on the method reflection to find out if the\ninput format is splittable for all input formats except OrcInputFormat.\nUsing the method reflection is a costly operation, hence avoiding the\nmethod reflection for RCFileInputFormat as well.", "committedDate": "2020-07-10T17:26:51Z", "type": "forcePushed"}]}