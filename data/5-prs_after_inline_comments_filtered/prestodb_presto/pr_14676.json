{"pr_number": 14676, "pr_title": "Fix session properties for determinism analysis main queries", "pr_createdAt": "2020-06-18T21:23:34Z", "pr_url": "https://github.com/prestodb/presto/pull/14676", "timeline": [{"oid": "aa30b6f07442516e75cc1ce2fe27d44b9ad4fd1f", "url": "https://github.com/prestodb/presto/commit/aa30b6f07442516e75cc1ce2fe27d44b9ad4fd1f", "message": "Fix session properties for determinism analysis main queries\n\nWe should apply the same session properties as the control main query\nwhen running the main query during determinism analysis.", "committedDate": "2020-06-19T06:14:23Z", "type": "commit"}, {"oid": "aa30b6f07442516e75cc1ce2fe27d44b9ad4fd1f", "url": "https://github.com/prestodb/presto/commit/aa30b6f07442516e75cc1ce2fe27d44b9ad4fd1f", "message": "Fix session properties for determinism analysis main queries\n\nWe should apply the same session properties as the control main query\nwhen running the main query during determinism analysis.", "committedDate": "2020-06-19T06:14:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA0MDE5OQ==", "url": "https://github.com/prestodb/presto/pull/14676#discussion_r443040199", "bodyText": "Is there any reason not to include DETERMINISM_ANALYSIS_MAIN into isMain?", "author": "mbasmanova", "createdAt": "2020-06-19T20:55:21Z", "path": "presto-verifier/src/main/java/com/facebook/presto/verifier/prestoaction/JdbcPrestoAction.java", "diffHunk": "@@ -145,7 +146,7 @@ private PrestoConnection getConnection(QueryStage queryStage)\n         }\n \n         // configure session properties\n-        Map<String, String> sessionProperties = queryStage.isMain()\n+        Map<String, String> sessionProperties = queryStage.isMain() || queryStage == DETERMINISM_ANALYSIS_MAIN", "originalCommit": "aa30b6f07442516e75cc1ce2fe27d44b9ad4fd1f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgyNTE3OQ==", "url": "https://github.com/prestodb/presto/pull/14676#discussion_r445825179", "bodyText": "There are other callers of isMain() that expect the query stage to be the control/test main query, but not determinism analysis stages.", "author": "caithagoras", "createdAt": "2020-06-25T20:40:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA0MDE5OQ=="}], "type": "inlineReview"}]}