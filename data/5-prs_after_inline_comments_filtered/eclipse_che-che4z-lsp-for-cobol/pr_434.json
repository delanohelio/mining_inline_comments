{"pr_number": 434, "pr_title": "Dispose diagnostic messages when user close the document #385", "pr_createdAt": "2020-07-20T10:26:06Z", "pr_url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/434", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzI3ODc0OQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/434#discussion_r457278749", "bodyText": "Maybe, we may log also the URI here", "author": "temanbrcom", "createdAt": "2020-07-20T10:57:23Z", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyTextDocumentService.java", "diffHunk": "@@ -194,6 +191,7 @@ public void didChange(DidChangeTextDocumentParams params) {\n   public void didClose(DidCloseTextDocumentParams params) {\n     String uri = params.getTextDocument().getUri();\n     log.info(\"Document closing invoked\");", "originalCommit": "4b3f3d2c78349bf987158eee0ce5bb7b93baa49e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzMxMDIzNw==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/434#discussion_r457310237", "bodyText": "It wasn't part of my activity, but definitely I could do it", "author": "zacanbrcom", "createdAt": "2020-07-20T11:48:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzI3ODc0OQ=="}], "type": "inlineReview"}, {"oid": "2fbab00eea47b8811ff9fc87b1ccf2ad6a2e43ed", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/2fbab00eea47b8811ff9fc87b1ccf2ad6a2e43ed", "message": "refactor: Update the log with URI of document opened #385", "committedDate": "2020-07-20T13:50:53Z", "type": "forcePushed"}, {"oid": "65fabcc9042deccde303afdd92122da84111c6a5", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/65fabcc9042deccde303afdd92122da84111c6a5", "message": "refactor: Update the log with URI of document opened #385", "committedDate": "2020-07-20T13:55:01Z", "type": "forcePushed"}, {"oid": "8eca4bb068cdd3bc4916737640f693e6a8ad85bd", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/8eca4bb068cdd3bc4916737640f693e6a8ad85bd", "message": "fix: cleanup diagnostic messages when did_close event is triggered #385", "committedDate": "2020-07-20T14:13:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzg5ODU1MQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/434#discussion_r457898551", "bodyText": "Optional: List.of()", "author": "asatklichov", "createdAt": "2020-07-21T07:40:02Z", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyTextDocumentService.java", "diffHunk": "@@ -193,7 +190,8 @@ public void didChange(DidChangeTextDocumentParams params) {\n   @Override\n   public void didClose(DidCloseTextDocumentParams params) {\n     String uri = params.getTextDocument().getUri();\n-    log.info(\"Document closing invoked\");\n+    log.info(String.format(\"Document closing invoked on URI %s\", uri));\n+    communications.publishDiagnostics(uri, Collections.emptyList());", "originalCommit": "8eca4bb068cdd3bc4916737640f693e6a8ad85bd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzkwMzU5Mw==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/434#discussion_r457903593", "bodyText": "\ud83d\udc4d", "author": "zacanbrcom", "createdAt": "2020-07-21T07:49:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzg5ODU1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzg5OTcwMA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/434#discussion_r457899700", "bodyText": "Optional: Hamcrest style:\nassertThat(client.getDiagnostics(), hasSize(0));", "author": "asatklichov", "createdAt": "2020-07-21T07:41:59Z", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/test/java/com/ca/lsp/cobol/service/MyTextDocumentServiceTest.java", "diffHunk": "@@ -254,6 +254,24 @@ public void testCodeActionsEndpoint() {\n     verify(actions).collect(params);\n   }\n \n+  /**\n+   * This test verify that when a {@link MyTextDocumentService#didClose(DidCloseTextDocumentParams)}\n+   * is sent from the client to dispose a document, all the related diagnostic message are disposed\n+   * from the document.\n+   */\n+  @Test\n+  public void testDidCloseDisposeDiagnostics() {\n+    service.didOpen(\n+        new DidOpenTextDocumentParams(\n+            new TextDocumentItem(DOCUMENT_URI, LANGUAGE, 1, TEXT_EXAMPLE)));\n+    assertEquals(1, closeGetter(service).size());\n+    TextDocumentIdentifier testDocument = new TextDocumentIdentifier(DOCUMENT_URI);\n+    DidCloseTextDocumentParams closedDocument = new DidCloseTextDocumentParams(testDocument);\n+    service.didClose(closedDocument);\n+    UseCaseUtils.waitForDiagnostics(client);\n+    assertEquals(0, client.getDiagnostics().size());", "originalCommit": "8eca4bb068cdd3bc4916737640f693e6a8ad85bd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3b188a9bb165ff00b65b3595adf1691c395bd98e", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/3b188a9bb165ff00b65b3595adf1691c395bd98e", "message": "fix: cleanup diagnostic messages when did_close event is triggered #385", "committedDate": "2020-07-21T08:03:19Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzkyNjIxMQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/434#discussion_r457926211", "bodyText": "Could you, please, use Communications mock to check the logic?\nThe UseCaseUtils#waitFodDiagnostic is going to be deprecated.", "author": "temanbrcom", "createdAt": "2020-07-21T08:27:56Z", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/test/java/com/ca/lsp/cobol/service/MyTextDocumentServiceTest.java", "diffHunk": "@@ -254,6 +255,24 @@ public void testCodeActionsEndpoint() {\n     verify(actions).collect(params);\n   }\n \n+  /**\n+   * This test verify that when a {@link MyTextDocumentService#didClose(DidCloseTextDocumentParams)}\n+   * is sent from the client to dispose a document, all the related diagnostic message are disposed\n+   * from the document.\n+   */\n+  @Test\n+  public void testDidCloseDisposeDiagnostics() {\n+    service.didOpen(\n+        new DidOpenTextDocumentParams(\n+            new TextDocumentItem(DOCUMENT_URI, LANGUAGE, 1, TEXT_EXAMPLE)));\n+    assertEquals(1, closeGetter(service).size());\n+    TextDocumentIdentifier testDocument = new TextDocumentIdentifier(DOCUMENT_URI);\n+    DidCloseTextDocumentParams closedDocument = new DidCloseTextDocumentParams(testDocument);\n+    service.didClose(closedDocument);\n+    UseCaseUtils.waitForDiagnostics(client);", "originalCommit": "3b188a9bb165ff00b65b3595adf1691c395bd98e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b8be1caddf0912d2e5c3ab706dbf3d99990afa6e", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/b8be1caddf0912d2e5c3ab706dbf3d99990afa6e", "message": "fix: cleanup diagnostic messages when did_close event is triggered #385", "committedDate": "2020-07-21T14:29:06Z", "type": "forcePushed"}, {"oid": "fc60e57497c767c37739e7f66afd05fb7ae34624", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/fc60e57497c767c37739e7f66afd05fb7ae34624", "message": "fix: cleanup diagnostic messages when did_close event is triggered #385", "committedDate": "2020-07-21T14:32:53Z", "type": "commit"}, {"oid": "fc60e57497c767c37739e7f66afd05fb7ae34624", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/fc60e57497c767c37739e7f66afd05fb7ae34624", "message": "fix: cleanup diagnostic messages when did_close event is triggered #385", "committedDate": "2020-07-21T14:32:53Z", "type": "forcePushed"}, {"oid": "83410763d36b919216033e7dddf68e5d1563a2fc", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/83410763d36b919216033e7dddf68e5d1563a2fc", "message": "Merge remote-tracking branch 'remotes/origin/development' into 385_didClose_diagnostic", "committedDate": "2020-07-23T12:12:11Z", "type": "commit"}]}