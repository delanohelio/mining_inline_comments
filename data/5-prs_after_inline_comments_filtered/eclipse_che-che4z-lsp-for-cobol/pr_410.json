{"pr_number": 410, "pr_title": "Fix sending download requests for nested copybooks", "pr_createdAt": "2020-07-01T15:47:11Z", "pr_url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/410", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkwNDMzNA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/410#discussion_r448904334", "bodyText": "Maybe, it will be better to use Set of uris here.", "author": "grianbrcom", "createdAt": "2020-07-02T10:26:22Z", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/CopybookServiceImpl.java", "diffHunk": "@@ -127,26 +126,36 @@ private void handleRequiredCopybookEvent(RequiredCopybookEvent event) {\n   /**\n    * Sends downloading requests to the Client for copybooks not presented locally, if any.\n    *\n-   * <p>A list of missed copybooks grouped by document URI.\n+   * <p>A list of missed copybooks grouped by document URI, including nested copybooks.\n    *\n    * @param event - document analysis done\n    */\n   private void handleAnalysisFinishedEvent(AnalysisFinishedEvent event) {\n-    String cobolFileName = files.getNameFromURI(event.getDocumentUri());\n-    if (copybooksForDownloading.containsKey(cobolFileName)) {\n-      settingsService\n-              .getConfigurations(copybooksForDownloading.remove(cobolFileName).stream()\n-                      .map(copybook -> Joiner.on(\".\").join(COPYBOOK_DOWNLOAD.label, cobolFileName, copybook))\n-                      .collect(Collectors.toList()));\n+    List<String> uris = new ArrayList<>(event.getUris());\n+    String documentUri = event.getDocumentUri();\n+    if (!uris.contains(documentUri)) uris.add(documentUri);", "originalCommit": "b8c997fe47e6f63323fbd6a1734a8768c7ccc7e5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkwNTYyOQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/410#discussion_r448905629", "bodyText": "copybookUris will better suit here.", "author": "grianbrcom", "createdAt": "2020-07-02T10:29:02Z", "path": "com.ca.lsp.cobol/lsp-core-domain/src/main/java/com/broadcom/lsp/domain/cobol/event/model/AnalysisFinishedEvent.java", "diffHunk": "@@ -16,19 +16,26 @@\n \n import lombok.Builder;\n import lombok.Data;\n+import lombok.EqualsAndHashCode;\n import lombok.NoArgsConstructor;\n \n+import java.util.List;\n+\n /**\n- * This class is a signal object to show that analysis is finished. Contains the uri of analyzed document.\n+ * This class is a signal object to show that analysis finished. Contains the uri of analyzed\n+ * document.\n  */\n+@EqualsAndHashCode(callSuper = false)\n @NoArgsConstructor\n @Data\n-public class AnalysisFinishedEvent extends DataEvent{\n-    private String documentUri;\n+public class AnalysisFinishedEvent extends DataEvent {\n+  private String documentUri;\n+  private List<String> uris;", "originalCommit": "b8c997fe47e6f63323fbd6a1734a8768c7ccc7e5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkxMDE2MA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/410#discussion_r448910160", "bodyText": "I agree, will do", "author": "temanbrcom", "createdAt": "2020-07-02T10:37:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkwNTYyOQ=="}], "type": "inlineReview"}, {"oid": "5920e82df2babd67b32b18edd58fd38fc4ebd361", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/5920e82df2babd67b32b18edd58fd38fc4ebd361", "message": "refactor: Fix sending download requests for nested copybooks #400", "committedDate": "2020-07-02T10:47:36Z", "type": "commit"}, {"oid": "5920e82df2babd67b32b18edd58fd38fc4ebd361", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/5920e82df2babd67b32b18edd58fd38fc4ebd361", "message": "refactor: Fix sending download requests for nested copybooks #400", "committedDate": "2020-07-02T10:47:36Z", "type": "forcePushed"}]}