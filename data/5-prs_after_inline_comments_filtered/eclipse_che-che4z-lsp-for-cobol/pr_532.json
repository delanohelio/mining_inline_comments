{"pr_number": 532, "pr_title": "Lock copybook download queue in case of wrong MF credentials", "pr_createdAt": "2020-09-23T11:19:56Z", "pr_url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ5ODAzMQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r493498031", "bodyText": "With the new value defined here, I think is time to find a more appropriate value for that enum. In past was named TextDocumentSyncType because was the reference in the LSP protocol specification for DID_OPEN and DID_CHANGE", "author": "andzac", "createdAt": "2020-09-23T11:53:22Z", "path": "server/src/main/java/com/ca/lsp/cobol/service/TextDocumentSyncType.java", "diffHunk": "@@ -20,5 +20,6 @@\n  */\n public enum TextDocumentSyncType {", "originalCommit": "cc78943d945a523d42d2c0403720225cb9455260", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY5NDk5Mw==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r493694993", "bodyText": "It may be replaced with according methods in CopybookProcessingMode", "author": "temanbrcom", "createdAt": "2020-09-23T15:39:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ5ODAzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE4MDQ2NQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r494180465", "bodyText": "I've deleted this enum.", "author": "grianbrcom", "createdAt": "2020-09-24T09:43:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ5ODAzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUwMDAzNw==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r493500037", "bodyText": "use copybookProcessingMode instead of syncType", "author": "andzac", "createdAt": "2020-09-23T11:55:29Z", "path": "server/src/main/java/com/ca/lsp/core/cobol/preprocessor/sub/document/CopybookResolution.java", "diffHunk": "@@ -33,5 +34,5 @@\n    */\n   @Nullable\n   CopybookModel resolve(\n-      @Nonnull String copybookName, @Nonnull String documentUri, @Nonnull String syncType);\n+      @Nonnull String copybookName, @Nonnull String documentUri, @Nonnull CopybookProcessingMode syncType);", "originalCommit": "cc78943d945a523d42d2c0403720225cb9455260", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUwMDUxNg==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r493500516", "bodyText": "as above ;)", "author": "andzac", "createdAt": "2020-09-23T11:55:56Z", "path": "server/src/main/java/com/ca/lsp/core/cobol/preprocessor/sub/document/GrammarPreprocessorListenerFactory.java", "diffHunk": "@@ -28,5 +29,5 @@ GrammarPreprocessorListenerImpl create(\n       @Nonnull @Assisted(\"uri\") String uri,\n       @Nonnull BufferedTokenStream tokens,\n       @Nonnull Deque<CopybookUsage> copybookStack,\n-      @Nonnull @Assisted(\"copybookProcessingMode\") String textDocumentSyncType);\n+      @Nonnull @Assisted(\"copybookProcessingMode\") CopybookProcessingMode textDocumentSyncType);", "originalCommit": "cc78943d945a523d42d2c0403720225cb9455260", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY0Njk3OQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r493646979", "bodyText": "If I remember correctly, ID in @Assisted required only if there are some similar types injected. Now, all the parameters have different types, so you may use @Assisted without ID", "author": "temanbrcom", "createdAt": "2020-09-23T14:38:17Z", "path": "server/src/main/java/com/ca/lsp/core/cobol/preprocessor/sub/document/GrammarPreprocessorListenerFactory.java", "diffHunk": "@@ -28,5 +29,5 @@ GrammarPreprocessorListenerImpl create(\n       @Nonnull @Assisted(\"uri\") String uri,\n       @Nonnull BufferedTokenStream tokens,\n       @Nonnull Deque<CopybookUsage> copybookStack,\n-      @Nonnull @Assisted(\"copybookProcessingMode\") String textDocumentSyncType);\n+      @Nonnull @Assisted(\"copybookProcessingMode\") CopybookProcessingMode textDocumentSyncType);", "originalCommit": "cc78943d945a523d42d2c0403720225cb9455260", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE2NDAwNw==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r494164007", "bodyText": "Cool, I can even delete the entire @Assested.", "author": "grianbrcom", "createdAt": "2020-09-24T09:17:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY0Njk3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY1MTk0NQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r493651945", "bodyText": "Will fork for now, but later on I would prefer to change the logic using different methods with descriptive names instead of passing the boolean flag.", "author": "temanbrcom", "createdAt": "2020-09-23T14:44:30Z", "path": "server/src/main/java/com/ca/lsp/cobol/service/MyTextDocumentService.java", "diffHunk": "@@ -216,7 +215,7 @@ private void registerEngineAndAnalyze(String uri, String languageType, String te\n       communications.notifyThatExtensionIsUnsupported(fileExtension);\n     } else if (isCobolFile(languageType)) {\n       communications.notifyThatLoadingInProgress(uri);\n-      analyzeDocumentFirstTime(uri, text);\n+      analyzeDocumentFirstTime(uri, text, false);", "originalCommit": "cc78943d945a523d42d2c0403720225cb9455260", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY1Mzc1MA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r493653750", "bodyText": "I think this switch may be replaced with different methods dropping the TextDocumentSyncType class. Not necessary to do it now, just a note for future", "author": "temanbrcom", "createdAt": "2020-09-23T14:46:48Z", "path": "server/src/main/java/com/ca/lsp/cobol/service/CopybookProcessingMode.java", "diffHunk": "@@ -42,12 +53,23 @@ public static CopybookProcessingMode getCopybookProcessingMode(\n         : getProcessingModeByTextDocSyncType(textDocumentSyncType);\n   }\n \n-  private static CopybookProcessingMode getProcessingModeByTextDocSyncType(\n+  /**\n+   * Converts sync type into appropriate processing mode.\n+   *\n+   * @param textDocumentSyncType the sync type of the document.\n+   * @return an appropriate processing mode.\n+   */\n+  public static CopybookProcessingMode getProcessingModeByTextDocSyncType(\n       @Nonnull TextDocumentSyncType textDocumentSyncType) {\n-    if (textDocumentSyncType == TextDocumentSyncType.DID_CHANGE) {\n-      return SKIP;\n-    } else {\n-      return ENABLED;\n+    switch (textDocumentSyncType) {\n+      case DID_OPEN:\n+        return ENABLED;\n+      case DID_CHANGE:\n+        return SKIP;\n+      case USER_REQUEST:\n+        return ENABLED_VERBOSE;\n+      default:\n+        return DISABLED;", "originalCommit": "cc78943d945a523d42d2c0403720225cb9455260", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY3Mzk3NA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r493673974", "bodyText": "I don't see where do you check this value", "author": "temanbrcom", "createdAt": "2020-09-23T15:11:52Z", "path": "server/src/main/java/com/broadcom/lsp/domain/cobol/event/model/RunAnalysisEvent.java", "diffHunk": "@@ -22,7 +22,15 @@\n  * all the registered documents.\n  */\n public class RunAnalysisEvent extends DataEvent {\n+  public final boolean quiet;", "originalCommit": "cc78943d945a523d42d2c0403720225cb9455260", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE2NTAyOA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r494165028", "bodyText": "Oops, you are right. I must use it in MyTextDocumentService:observerCallback.", "author": "grianbrcom", "createdAt": "2020-09-24T09:18:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY3Mzk3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY3NDY5OA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r493674698", "bodyText": "I think that \"verbose\" here would be more descriptive, but it depends on how do you use it", "author": "temanbrcom", "createdAt": "2020-09-23T15:12:48Z", "path": "server/src/main/java/com/broadcom/lsp/domain/cobol/event/model/RunAnalysisEvent.java", "diffHunk": "@@ -22,7 +22,15 @@\n  * all the registered documents.\n  */\n public class RunAnalysisEvent extends DataEvent {\n+  public final boolean quiet;\n+\n   public RunAnalysisEvent() {\n     super(RUN_ANALYSIS_EVENT, RUN_ANALYSIS_EVENT.getId());\n+    this.quiet = true;\n+  }\n+\n+  public RunAnalysisEvent(boolean quiet) {\n+    super(RUN_ANALYSIS_EVENT, RUN_ANALYSIS_EVENT.getId());\n+    this.quiet = quiet;", "originalCommit": "cc78943d945a523d42d2c0403720225cb9455260", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE2NjkwNg==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r494166906", "bodyText": "Agree, I'll rename it.", "author": "grianbrcom", "createdAt": "2020-09-24T09:21:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY3NDY5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY5MDY1Nw==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r493690657", "bodyText": "I didn't get why did you change this", "author": "temanbrcom", "createdAt": "2020-09-23T15:33:55Z", "path": "server/src/test/java/com/ca/lsp/cobol/service/MyTextDocumentServiceTest.java", "diffHunk": "@@ -365,8 +369,8 @@ private void verifyCallback(\n       String text,\n       String uri) {\n \n-    verify(engine, timeout(10000).times(2)).analyze(uri, text, CopybookProcessingMode.ENABLED);\n-    verify(communications, times(2)).publishDiagnostics(diagnostics);\n+    verify(engine, timeout(10000).times(1)).analyze(uri, text, CopybookProcessingMode.ENABLED);\n+    verify(communications, times(1)).publishDiagnostics(diagnostics);", "originalCommit": "cc78943d945a523d42d2c0403720225cb9455260", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE3MjUwNg==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r494172506", "bodyText": "You are right. I'll return that back.", "author": "grianbrcom", "createdAt": "2020-09-24T09:30:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY5MDY1Nw=="}], "type": "inlineReview"}, {"oid": "d741bb9c713e20b11b89c9b57247bb0872014052", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/d741bb9c713e20b11b89c9b57247bb0872014052", "message": "feat: Lock copybook download queue in case of wrong MF credentials\n\nCloses #488\n\nSigned-off-by: Anton Grigorev <anton.grigorev@broadcom.com>", "committedDate": "2020-09-24T10:05:27Z", "type": "forcePushed"}, {"oid": "d7ac0e28720076a4701b623ce3d9bbdb2638541d", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/d7ac0e28720076a4701b623ce3d9bbdb2638541d", "message": "feat: Lock copybook download queue in case of wrong MF credentials\n\nCloses #488\n\nSigned-off-by: Anton Grigorev <anton.grigorev@broadcom.com>", "committedDate": "2020-09-25T14:12:54Z", "type": "forcePushed"}, {"oid": "eaab16ebe54664b2e3a00e9bcd168878095f2542", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/eaab16ebe54664b2e3a00e9bcd168878095f2542", "message": "feat: Lock copybook download queue in case of wrong MF credentials\n\nCloses #488\n\nSigned-off-by: Anton Grigorev <anton.grigorev@broadcom.com>", "committedDate": "2020-09-29T12:38:42Z", "type": "commit"}, {"oid": "eaab16ebe54664b2e3a00e9bcd168878095f2542", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/eaab16ebe54664b2e3a00e9bcd168878095f2542", "message": "feat: Lock copybook download queue in case of wrong MF credentials\n\nCloses #488\n\nSigned-off-by: Anton Grigorev <anton.grigorev@broadcom.com>", "committedDate": "2020-09-29T12:38:42Z", "type": "forcePushed"}]}