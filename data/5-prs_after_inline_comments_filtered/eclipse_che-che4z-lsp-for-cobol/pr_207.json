{"pr_number": 207, "pr_title": "Retrieve settings.json at initialize #187", "pr_createdAt": "2020-02-18T16:55:03Z", "pr_url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/207", "timeline": [{"oid": "cb0221aa7b36653fe5c19e975506efc148b945f6", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/cb0221aa7b36653fe5c19e975506efc148b945f6", "message": "Retrieve settings.json at initialize #187", "committedDate": "2020-02-18T16:52:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE0MDM5Mg==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/207#discussion_r381140392", "bodyText": "We usually use javax.annotation.Nonnull instead of Lombok", "author": "temanbrcom", "createdAt": "2020-02-19T08:31:00Z", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/providers/SettingsProvider.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+ * Copyright (c) 2020 Broadcom.\n+ * The term \"Broadcom\" refers to Broadcom Inc. and/or its subsidiaries.\n+ *\n+ * This program and the accompanying materials are made\n+ * available under the terms of the Eclipse Public License 2.0\n+ * which is available at https://www.eclipse.org/legal/epl-2.0/\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *\n+ * Contributors:\n+ *    Broadcom, Inc. - initial API and implementation\n+ */\n+\n+package com.ca.lsp.cobol.service.providers;\n+\n+import com.ca.lsp.cobol.model.ConfigurationSettingsStorable;\n+import com.google.inject.Provider;\n+import com.google.inject.Singleton;\n+import lombok.NonNull;", "originalCommit": "cb0221aa7b36653fe5c19e975506efc148b945f6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE0MTEyOQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/207#discussion_r381141129", "bodyText": "Please, provide more descriptive name for this class", "author": "temanbrcom", "createdAt": "2020-02-19T08:32:46Z", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/test/java/com/ca/lsp/cobol/utils/Utility.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/*\n+ * Copyright (c) 2020 Broadcom.\n+ * The term \"Broadcom\" refers to Broadcom Inc. and/or its subsidiaries.\n+ *\n+ * This program and the accompanying materials are made\n+ * available under the terms of the Eclipse Public License 2.0\n+ * which is available at https://www.eclipse.org/legal/epl-2.0/\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *\n+ * Contributors:\n+ *    Broadcom, Inc. - initial API and implementation\n+ */\n+\n+package com.ca.lsp.cobol.utils;\n+\n+import lombok.experimental.UtilityClass;\n+import org.eclipse.lsp4j.ConfigurationItem;\n+import org.eclipse.lsp4j.ConfigurationParams;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+@UtilityClass\n+public final class Utility {", "originalCommit": "cb0221aa7b36653fe5c19e975506efc148b945f6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE0MTc0MQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/207#discussion_r381141741", "bodyText": "Seems like it is replaceable with Collections#singletonList()", "author": "temanbrcom", "createdAt": "2020-02-19T08:34:01Z", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/test/java/com/ca/lsp/cobol/utils/Utility.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/*\n+ * Copyright (c) 2020 Broadcom.\n+ * The term \"Broadcom\" refers to Broadcom Inc. and/or its subsidiaries.\n+ *\n+ * This program and the accompanying materials are made\n+ * available under the terms of the Eclipse Public License 2.0\n+ * which is available at https://www.eclipse.org/legal/epl-2.0/\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *\n+ * Contributors:\n+ *    Broadcom, Inc. - initial API and implementation\n+ */\n+\n+package com.ca.lsp.cobol.utils;\n+\n+import lombok.experimental.UtilityClass;\n+import org.eclipse.lsp4j.ConfigurationItem;\n+import org.eclipse.lsp4j.ConfigurationParams;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+@UtilityClass\n+public final class Utility {\n+\n+  public ConfigurationParams createParams() {\n+    ConfigurationParams params = new ConfigurationParams();\n+    List<ConfigurationItem> itemList = new ArrayList<>();", "originalCommit": "cb0221aa7b36653fe5c19e975506efc148b945f6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE0MjQxMQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/207#discussion_r381142411", "bodyText": "I think it is better to use @Value here to make this class immutable", "author": "temanbrcom", "createdAt": "2020-02-19T08:35:29Z", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/model/ConfigurationSettingsStorable.java", "diffHunk": "@@ -0,0 +1,26 @@\n+/*\n+ * Copyright (c) 2020 Broadcom.\n+ * The term \"Broadcom\" refers to Broadcom Inc. and/or its subsidiaries.\n+ *\n+ * This program and the accompanying materials are made\n+ * available under the terms of the Eclipse Public License 2.0\n+ * which is available at https://www.eclipse.org/legal/epl-2.0/\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *\n+ * Contributors:\n+ *    Broadcom, Inc. - initial API and implementation\n+ */\n+\n+package com.ca.lsp.cobol.model;\n+\n+import lombok.Data;\n+\n+import java.util.List;\n+\n+@Data", "originalCommit": "cb0221aa7b36653fe5c19e975506efc148b945f6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE0Mjk4MQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/207#discussion_r381142981", "bodyText": "Please, make this field static too.", "author": "temanbrcom", "createdAt": "2020-02-19T08:36:44Z", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/test/java/com/ca/lsp/cobol/service/InitializeConfigurationTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ * Copyright (c) 2020 Broadcom.\n+ * The term \"Broadcom\" refers to Broadcom Inc. and/or its subsidiaries.\n+ *\n+ * This program and the accompanying materials are made\n+ * available under the terms of the Eclipse Public License 2.0\n+ * which is available at https://www.eclipse.org/legal/epl-2.0/\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *\n+ * Contributors:\n+ *    Broadcom, Inc. - initial API and implementation\n+ */\n+\n+package com.ca.lsp.cobol.service;\n+\n+import com.ca.lsp.cobol.model.ConfigurationSettingsStorable;\n+import com.ca.lsp.cobol.service.providers.ClientProvider;\n+import com.ca.lsp.cobol.service.providers.SettingsProvider;\n+import com.ca.lsp.cobol.utils.Utility;\n+import com.google.gson.JsonArray;\n+import com.google.gson.JsonObject;\n+import org.eclipse.lsp4j.ConfigurationParams;\n+import org.eclipse.lsp4j.InitializedParams;\n+import org.eclipse.lsp4j.services.LanguageClient;\n+import org.junit.Test;\n+import org.mockito.Mockito;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.ExecutionException;\n+\n+import static org.mockito.Mockito.*;\n+\n+/**\n+ * This test class checks if the workspace calls client configuration at the initialize method and\n+ * retrieves the setting configuration\n+ */\n+public class InitializeConfigurationTest {\n+  private LanguageClient client = Mockito.mock(LanguageClient.class);\n+  private ClientProvider provider = new ClientProvider();\n+  private SettingsProvider settingsProvider = Mockito.mock(SettingsProvider.class);\n+  private final String PROFILE_NAME = \"myProfile\";", "originalCommit": "cb0221aa7b36653fe5c19e975506efc148b945f6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE0NDY4OQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/207#discussion_r381144689", "bodyText": "Due to you don't share these fields between different methods, I think it is better to keep them local, but it is up to you", "author": "temanbrcom", "createdAt": "2020-02-19T08:40:24Z", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/test/java/com/ca/lsp/cobol/service/InitializeConfigurationTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ * Copyright (c) 2020 Broadcom.\n+ * The term \"Broadcom\" refers to Broadcom Inc. and/or its subsidiaries.\n+ *\n+ * This program and the accompanying materials are made\n+ * available under the terms of the Eclipse Public License 2.0\n+ * which is available at https://www.eclipse.org/legal/epl-2.0/\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *\n+ * Contributors:\n+ *    Broadcom, Inc. - initial API and implementation\n+ */\n+\n+package com.ca.lsp.cobol.service;\n+\n+import com.ca.lsp.cobol.model.ConfigurationSettingsStorable;\n+import com.ca.lsp.cobol.service.providers.ClientProvider;\n+import com.ca.lsp.cobol.service.providers.SettingsProvider;\n+import com.ca.lsp.cobol.utils.Utility;\n+import com.google.gson.JsonArray;\n+import com.google.gson.JsonObject;\n+import org.eclipse.lsp4j.ConfigurationParams;\n+import org.eclipse.lsp4j.InitializedParams;\n+import org.eclipse.lsp4j.services.LanguageClient;\n+import org.junit.Test;\n+import org.mockito.Mockito;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.ExecutionException;\n+\n+import static org.mockito.Mockito.*;\n+\n+/**\n+ * This test class checks if the workspace calls client configuration at the initialize method and\n+ * retrieves the setting configuration\n+ */\n+public class InitializeConfigurationTest {\n+  private LanguageClient client = Mockito.mock(LanguageClient.class);\n+  private ClientProvider provider = new ClientProvider();\n+  private SettingsProvider settingsProvider = Mockito.mock(SettingsProvider.class);", "originalCommit": "cb0221aa7b36653fe5c19e975506efc148b945f6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE0NzA4MQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/207#discussion_r381147081", "bodyText": "It would be better to mark this method @Nullable to show that null in configurationSettingsStorable is a valid case", "author": "temanbrcom", "createdAt": "2020-02-19T08:45:36Z", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/providers/SettingsProvider.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+ * Copyright (c) 2020 Broadcom.\n+ * The term \"Broadcom\" refers to Broadcom Inc. and/or its subsidiaries.\n+ *\n+ * This program and the accompanying materials are made\n+ * available under the terms of the Eclipse Public License 2.0\n+ * which is available at https://www.eclipse.org/legal/epl-2.0/\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *\n+ * Contributors:\n+ *    Broadcom, Inc. - initial API and implementation\n+ */\n+\n+package com.ca.lsp.cobol.service.providers;\n+\n+import com.ca.lsp.cobol.model.ConfigurationSettingsStorable;\n+import com.google.inject.Provider;\n+import com.google.inject.Singleton;\n+import lombok.NonNull;\n+\n+@Singleton\n+public class SettingsProvider implements Provider<ConfigurationSettingsStorable> {\n+  private ConfigurationSettingsStorable configurationSettingsStorable;\n+\n+  public void set(@NonNull ConfigurationSettingsStorable configurationSettingsStorable) {\n+    this.configurationSettingsStorable = configurationSettingsStorable;\n+  }\n+\n+  @Override\n+  public ConfigurationSettingsStorable get() {", "originalCommit": "cb0221aa7b36653fe5c19e975506efc148b945f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE2MDM0Ng==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/207#discussion_r381160346", "bodyText": "IMHO I will not push the developer to use nullable, I prefer a meaningful javadoc. For notNull the discussion is different.", "author": "zacanbrcom", "createdAt": "2020-02-19T09:11:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE0NzA4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE0Nzk2NQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/207#discussion_r381147965", "bodyText": "The name pattern 'is***', according to Java naming convention, used mostly for boolean methods. It would be more descriptive if you rename it so something like parseSettings", "author": "temanbrcom", "createdAt": "2020-02-19T08:47:30Z", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyLanguageServerImpl.java", "diffHunk": "@@ -96,6 +107,50 @@ public void initialized(@Nullable InitializedParams params) {\n                     \"copybooksWatcher\", \"workspace/didChangeWatchedFiles\", createWatcher()),\n                 new Registration(\"configurationChange\", \"workspace/didChangeConfiguration\", null)));\n     client.registerCapability(registrationParams);\n+    try {\n+      fetchSettings(\"broadcom-cobol-lsp.cpy-manager\", null)\n+          .thenAccept(\n+              e -> {\n+                JsonObject jsonObject = (JsonObject) e.get(0);\n+                ConfigurationSettingsStorable configurationSettingsStorable =\n+                    isValidJson(jsonObject);\n+                ((SettingsProvider) settingsProvider).set(configurationSettingsStorable);\n+              });\n+    } catch (RuntimeException e) {\n+      log.error(e.getMessage());\n+    }\n+  }\n+\n+  /**\n+   * @param jsonObject - the object which comes from the client and contains configuration settings\n+   * @return a custom object of type ConfigurableSettingsStorage if the JSON is valid or null if it\n+   *     is failing the check\n+   */\n+  private ConfigurationSettingsStorable isValidJson(JsonObject jsonObject) {", "originalCommit": "cb0221aa7b36653fe5c19e975506efc148b945f6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE0ODc2Nw==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/207#discussion_r381148767", "bodyText": "Could you, please, provide some more descriptive name for this method?", "author": "temanbrcom", "createdAt": "2020-02-19T08:49:09Z", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyLanguageServerImpl.java", "diffHunk": "@@ -96,6 +107,50 @@ public void initialized(@Nullable InitializedParams params) {\n                     \"copybooksWatcher\", \"workspace/didChangeWatchedFiles\", createWatcher()),\n                 new Registration(\"configurationChange\", \"workspace/didChangeConfiguration\", null)));\n     client.registerCapability(registrationParams);\n+    try {\n+      fetchSettings(\"broadcom-cobol-lsp.cpy-manager\", null)\n+          .thenAccept(\n+              e -> {\n+                JsonObject jsonObject = (JsonObject) e.get(0);\n+                ConfigurationSettingsStorable configurationSettingsStorable =\n+                    isValidJson(jsonObject);\n+                ((SettingsProvider) settingsProvider).set(configurationSettingsStorable);\n+              });\n+    } catch (RuntimeException e) {\n+      log.error(e.getMessage());\n+    }\n+  }\n+\n+  /**\n+   * @param jsonObject - the object which comes from the client and contains configuration settings\n+   * @return a custom object of type ConfigurableSettingsStorage if the JSON is valid or null if it\n+   *     is failing the check\n+   */\n+  private ConfigurationSettingsStorable isValidJson(JsonObject jsonObject) {\n+    Gson gson = new Gson();\n+    try {\n+      return gson.fromJson(jsonObject, ConfigurationSettingsStorable.class);\n+    } catch (JsonSyntaxException e) {\n+      log.error(e.getMessage());\n+      return null;\n+    }\n+  }\n+\n+  private CompletableFuture<List<Object>> fetchSettings(String section, String scope) {\n+    LanguageClient client = clientProvider.get();\n+    ConfigurationParams params = new ConfigurationParams();\n+    params.setItems(elemToList(section, scope));\n+    return client.configuration(params);\n+  }\n+\n+  @Nonnull\n+  private List<ConfigurationItem> elemToList(String section, String scope) {", "originalCommit": "cb0221aa7b36653fe5c19e975506efc148b945f6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE0MDk0MA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/207#discussion_r381140940", "bodyText": "I think we could remove this comment", "author": "zacanbrcom", "createdAt": "2020-02-19T08:32:18Z", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/CobolWorkspaceServiceImpl.java", "diffHunk": "@@ -93,7 +93,7 @@ public CobolWorkspaceServiceImpl(DataBusBroker dataBus, Provider<LanguageClient>\n   public void didChangeConfiguration(DidChangeConfigurationParams params) {\n     /* section and scope has to be set to whatever we agree on for the dependencies graph */", "originalCommit": "cb0221aa7b36653fe5c19e975506efc148b945f6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE0NDM3MA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/207#discussion_r381144370", "bodyText": "Can we use an enum here so that we can share the common key across multiple actors (CWS, FSS, MTD..)?", "author": "zacanbrcom", "createdAt": "2020-02-19T08:39:44Z", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/CobolWorkspaceServiceImpl.java", "diffHunk": "@@ -93,7 +93,7 @@ public CobolWorkspaceServiceImpl(DataBusBroker dataBus, Provider<LanguageClient>\n   public void didChangeConfiguration(DidChangeConfigurationParams params) {\n     /* section and scope has to be set to whatever we agree on for the dependencies graph */\n     try {\n-      fetchSettings(null, null)\n+      fetchSettings(\"broadcom-cobol-lsp.cpy-manager\", null)", "originalCommit": "cb0221aa7b36653fe5c19e975506efc148b945f6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE0NTg4Nw==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/207#discussion_r381145887", "bodyText": "We can wrap this activity in a method with a meaningful javadoc", "author": "zacanbrcom", "createdAt": "2020-02-19T08:42:59Z", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyLanguageServerImpl.java", "diffHunk": "@@ -96,6 +107,50 @@ public void initialized(@Nullable InitializedParams params) {\n                     \"copybooksWatcher\", \"workspace/didChangeWatchedFiles\", createWatcher()),\n                 new Registration(\"configurationChange\", \"workspace/didChangeConfiguration\", null)));\n     client.registerCapability(registrationParams);\n+    try {\n+      fetchSettings(\"broadcom-cobol-lsp.cpy-manager\", null)\n+          .thenAccept(\n+              e -> {\n+                JsonObject jsonObject = (JsonObject) e.get(0);\n+                ConfigurationSettingsStorable configurationSettingsStorable =\n+                    isValidJson(jsonObject);\n+                ((SettingsProvider) settingsProvider).set(configurationSettingsStorable);\n+              });\n+    } catch (RuntimeException e) {\n+      log.error(e.getMessage());\n+    }\n+  }", "originalCommit": "cb0221aa7b36653fe5c19e975506efc148b945f6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE0OTM3OQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/207#discussion_r381149379", "bodyText": "can we use directly clientProvider.get() and get rid of client object?", "author": "zacanbrcom", "createdAt": "2020-02-19T08:50:24Z", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyLanguageServerImpl.java", "diffHunk": "@@ -96,6 +107,50 @@ public void initialized(@Nullable InitializedParams params) {\n                     \"copybooksWatcher\", \"workspace/didChangeWatchedFiles\", createWatcher()),\n                 new Registration(\"configurationChange\", \"workspace/didChangeConfiguration\", null)));\n     client.registerCapability(registrationParams);\n+    try {\n+      fetchSettings(\"broadcom-cobol-lsp.cpy-manager\", null)\n+          .thenAccept(\n+              e -> {\n+                JsonObject jsonObject = (JsonObject) e.get(0);\n+                ConfigurationSettingsStorable configurationSettingsStorable =\n+                    isValidJson(jsonObject);\n+                ((SettingsProvider) settingsProvider).set(configurationSettingsStorable);\n+              });\n+    } catch (RuntimeException e) {\n+      log.error(e.getMessage());\n+    }\n+  }\n+\n+  /**\n+   * @param jsonObject - the object which comes from the client and contains configuration settings\n+   * @return a custom object of type ConfigurableSettingsStorage if the JSON is valid or null if it\n+   *     is failing the check\n+   */\n+  private ConfigurationSettingsStorable isValidJson(JsonObject jsonObject) {\n+    Gson gson = new Gson();\n+    try {\n+      return gson.fromJson(jsonObject, ConfigurationSettingsStorable.class);\n+    } catch (JsonSyntaxException e) {\n+      log.error(e.getMessage());\n+      return null;\n+    }\n+  }\n+\n+  private CompletableFuture<List<Object>> fetchSettings(String section, String scope) {\n+    LanguageClient client = clientProvider.get();\n+    ConfigurationParams params = new ConfigurationParams();\n+    params.setItems(elemToList(section, scope));\n+    return client.configuration(params);", "originalCommit": "cb0221aa7b36653fe5c19e975506efc148b945f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE1MjUyMQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/207#discussion_r381152521", "bodyText": "Moreover according with its constructor, ConfigurationParams could accept directly the list (coming fromelemToList()) and so we can simplify the logic of this method", "author": "zacanbrcom", "createdAt": "2020-02-19T08:56:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE0OTM3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE1NDkyNw==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/207#discussion_r381154927", "bodyText": "Can we inline those strings?", "author": "zacanbrcom", "createdAt": "2020-02-19T09:01:15Z", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyLanguageServerImpl.java", "diffHunk": "@@ -96,6 +107,50 @@ public void initialized(@Nullable InitializedParams params) {\n                     \"copybooksWatcher\", \"workspace/didChangeWatchedFiles\", createWatcher()),\n                 new Registration(\"configurationChange\", \"workspace/didChangeConfiguration\", null)));\n     client.registerCapability(registrationParams);\n+    try {\n+      fetchSettings(\"broadcom-cobol-lsp.cpy-manager\", null)\n+          .thenAccept(\n+              e -> {\n+                JsonObject jsonObject = (JsonObject) e.get(0);\n+                ConfigurationSettingsStorable configurationSettingsStorable =\n+                    isValidJson(jsonObject);\n+                ((SettingsProvider) settingsProvider).set(configurationSettingsStorable);\n+              });\n+    } catch (RuntimeException e) {\n+      log.error(e.getMessage());\n+    }\n+  }\n+\n+  /**\n+   * @param jsonObject - the object which comes from the client and contains configuration settings\n+   * @return a custom object of type ConfigurableSettingsStorage if the JSON is valid or null if it\n+   *     is failing the check\n+   */\n+  private ConfigurationSettingsStorable isValidJson(JsonObject jsonObject) {\n+    Gson gson = new Gson();\n+    try {\n+      return gson.fromJson(jsonObject, ConfigurationSettingsStorable.class);\n+    } catch (JsonSyntaxException e) {\n+      log.error(e.getMessage());\n+      return null;\n+    }\n+  }\n+\n+  private CompletableFuture<List<Object>> fetchSettings(String section, String scope) {\n+    LanguageClient client = clientProvider.get();\n+    ConfigurationParams params = new ConfigurationParams();\n+    params.setItems(elemToList(section, scope));\n+    return client.configuration(params);\n+  }\n+\n+  @Nonnull\n+  private List<ConfigurationItem> elemToList(String section, String scope) {", "originalCommit": "cb0221aa7b36653fe5c19e975506efc148b945f6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE2MzA4MQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/207#discussion_r381163081", "bodyText": "can we use a mock here?", "author": "zacanbrcom", "createdAt": "2020-02-19T09:17:24Z", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/test/java/com/ca/lsp/cobol/service/DidChangeConfigurationTest.java", "diffHunk": "@@ -49,7 +49,7 @@ public void testDidChangeConfiguration() {\n     ArgumentCaptor<FetchedSettingsEvent> captor =\n         ArgumentCaptor.forClass(FetchedSettingsEvent.class);\n \n-    ConfigurationParams params = createParams();\n+    ConfigurationParams params = Utility.createParams();", "originalCommit": "cb0221aa7b36653fe5c19e975506efc148b945f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTI5MzY2NQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/207#discussion_r381293665", "bodyText": "what is the value to you use a mock?", "author": "sergiuilie", "createdAt": "2020-02-19T13:38:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE2MzA4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE3ODA4MQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/207#discussion_r381178081", "bodyText": "can we get rid of throws ExecutionException and InterruptedException?", "author": "zacanbrcom", "createdAt": "2020-02-19T09:42:52Z", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/test/java/com/ca/lsp/cobol/service/InitializeConfigurationTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ * Copyright (c) 2020 Broadcom.\n+ * The term \"Broadcom\" refers to Broadcom Inc. and/or its subsidiaries.\n+ *\n+ * This program and the accompanying materials are made\n+ * available under the terms of the Eclipse Public License 2.0\n+ * which is available at https://www.eclipse.org/legal/epl-2.0/\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *\n+ * Contributors:\n+ *    Broadcom, Inc. - initial API and implementation\n+ */\n+\n+package com.ca.lsp.cobol.service;\n+\n+import com.ca.lsp.cobol.model.ConfigurationSettingsStorable;\n+import com.ca.lsp.cobol.service.providers.ClientProvider;\n+import com.ca.lsp.cobol.service.providers.SettingsProvider;\n+import com.ca.lsp.cobol.utils.Utility;\n+import com.google.gson.JsonArray;\n+import com.google.gson.JsonObject;\n+import org.eclipse.lsp4j.ConfigurationParams;\n+import org.eclipse.lsp4j.InitializedParams;\n+import org.eclipse.lsp4j.services.LanguageClient;\n+import org.junit.Test;\n+import org.mockito.Mockito;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.ExecutionException;\n+\n+import static org.mockito.Mockito.*;\n+\n+/**\n+ * This test class checks if the workspace calls client configuration at the initialize method and\n+ * retrieves the setting configuration\n+ */\n+public class InitializeConfigurationTest {\n+  private LanguageClient client = Mockito.mock(LanguageClient.class);\n+  private ClientProvider provider = new ClientProvider();\n+  private SettingsProvider settingsProvider = Mockito.mock(SettingsProvider.class);\n+  private final String PROFILE_NAME = \"myProfile\";\n+\n+  @Test\n+  public void testInitializeConfiguration() throws ExecutionException, InterruptedException {", "originalCommit": "cb0221aa7b36653fe5c19e975506efc148b945f6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5443f9185ece0f077f7b2e5526154e94565e2c4b", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/5443f9185ece0f077f7b2e5526154e94565e2c4b", "message": "adjust to the requested changes", "committedDate": "2020-02-19T10:24:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTI4NTk4NQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/207#discussion_r381285985", "bodyText": "Seems like we have an unused import here", "author": "temanbrcom", "createdAt": "2020-02-19T13:23:45Z", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/model/ConfigurationSettingsStorable.java", "diffHunk": "@@ -0,0 +1,27 @@\n+/*\n+ * Copyright (c) 2020 Broadcom.\n+ * The term \"Broadcom\" refers to Broadcom Inc. and/or its subsidiaries.\n+ *\n+ * This program and the accompanying materials are made\n+ * available under the terms of the Eclipse Public License 2.0\n+ * which is available at https://www.eclipse.org/legal/epl-2.0/\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *\n+ * Contributors:\n+ *    Broadcom, Inc. - initial API and implementation\n+ */\n+\n+package com.ca.lsp.cobol.model;\n+\n+import lombok.Data;", "originalCommit": "5443f9185ece0f077f7b2e5526154e94565e2c4b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6c13c588bac4b5e1935d4f3e9e032e4376d44455", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/6c13c588bac4b5e1935d4f3e9e032e4376d44455", "message": "adjust to the requested changes", "committedDate": "2020-02-19T14:31:39Z", "type": "commit"}]}