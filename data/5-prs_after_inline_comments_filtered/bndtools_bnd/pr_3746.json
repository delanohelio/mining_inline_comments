{"pr_number": 3746, "pr_title": "junit-platform: Fix Sub-request to handle plain DiscoverySelector", "pr_createdAt": "2020-01-28T16:02:31Z", "pr_url": "https://github.com/bndtools/bnd/pull/3746", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjEwNjc3MQ==", "url": "https://github.com/bndtools/bnd/pull/3746#discussion_r372106771", "bodyText": "I'm wondering if it might be a useful optimisation to retain this as a short-circuit just before the main return statement?", "author": "kriegfrj", "createdAt": "2020-01-28T23:00:16Z", "path": "biz.aQute.tester.junit-platform/src/aQute/tester/bundle/engine/discovery/BundleSelectorResolver.java", "diffHunk": "@@ -520,16 +520,14 @@ private boolean elementHasJUnit4Annotations(AnnotatedElement element) {\n \t\t@Override\n \t\tpublic <T extends DiscoverySelector> List<T> getSelectorsByType(Class<T> selectorType) {\n \t\t\tinfo(() -> \"Getting selectors from sub-request for: \" + selectorType);\n-\t\t\tif (selectorType.equals(ClassSelector.class) || selectorType.equals(MethodSelector.class)) {\n-\t\t\t\treturn selectors.stream()\n-\t\t\t\t\t.filter(selectorType::isInstance)\n-\t\t\t\t\t.map(selectorType::cast)\n-\t\t\t\t\t.collect(toList());\n-\t\t\t}\n-\t\t\tif (selectorType.equals(BundleSelector.class)) {\n-\t\t\t\treturn new ArrayList<>();\n-\t\t\t}", "originalCommit": "0ede8ebe2570f6c48d32fb0d6b5041911516283c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjQ0MTk2MQ==", "url": "https://github.com/bndtools/bnd/pull/3746#discussion_r372441961", "bodyText": "I don't think this is worth it. It might sometimes be useful with pre 5.5 versions of JUnit 5 but will be counterproductive on later versions.", "author": "bjhargrave", "createdAt": "2020-01-29T15:13:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjEwNjc3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjQ2NDMzNQ==", "url": "https://github.com/bndtools/bnd/pull/3746#discussion_r372464335", "bodyText": "I also found that no one (in our tests) ever calls this method with a BundleSelector.class argument anyway.", "author": "bjhargrave", "createdAt": "2020-01-29T15:47:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjEwNjc3MQ=="}], "type": "inlineReview"}, {"oid": "5806d704d1f635995bef1016e37ca2803e56a636", "url": "https://github.com/bndtools/bnd/commit/5806d704d1f635995bef1016e37ca2803e56a636", "message": "junit-platform: Fix Sub-request to handle plain DiscoverySelector\n\nJUnit 5.5 changed to call getSelectorsByType with the base\nDiscoverySelector type which caused us to fail to substitute the OSGi\nready selectors.\n\nWe change to call the original request and then filter out the selector\nwe will supply. We then add the selectors we will supply to the stream.\n\nFixes https://github.com/bndtools/bnd/issues/3745\n\nSigned-off-by: BJ Hargrave <bj@bjhargrave.com>", "committedDate": "2020-01-29T15:42:13Z", "type": "commit"}, {"oid": "e53da052c73f1d4926104a4f4caf54444a1574cb", "url": "https://github.com/bndtools/bnd/commit/e53da052c73f1d4926104a4f4caf54444a1574cb", "message": "tester: Rename test case to disambiguate test results\n\nSigned-off-by: BJ Hargrave <bj@bjhargrave.com>", "committedDate": "2020-01-29T16:07:23Z", "type": "commit"}, {"oid": "97198172981d6803d2a340b21bce51fa3b20911b", "url": "https://github.com/bndtools/bnd/commit/97198172981d6803d2a340b21bce51fa3b20911b", "message": "junit-platform: Some improvements to selector resolution\n\nThis also fixed a bug where the bundle class loader was not used to\nfind test methods from the Test-Cases header string.\n\nSigned-off-by: BJ Hargrave <bj@bjhargrave.com>", "committedDate": "2020-01-29T17:17:35Z", "type": "commit"}]}