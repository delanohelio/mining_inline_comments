{"pr_number": 4268, "pr_title": "[quickfix] More enhancements", "pr_createdAt": "2020-08-14T06:59:04Z", "pr_url": "https://github.com/bndtools/bnd/pull/4268", "timeline": [{"oid": "2f35b2b6c19c083475fcc82ada9e0c1ac76db841", "url": "https://github.com/bndtools/bnd/commit/2f35b2b6c19c083475fcc82ada9e0c1ac76db841", "message": "[quickfix] Better handling of class literals\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>", "committedDate": "2020-08-15T13:34:49Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU5ODMxNw==", "url": "https://github.com/bndtools/bnd/pull/4268#discussion_r471598317", "bodyText": "Each test method should have its own tmp dir so there is no chance of side effects between tests. This should be @BeforeEach.", "author": "bjhargrave", "createdAt": "2020-08-17T16:31:57Z", "path": "biz.aQute.bndlib.tests/test/aQute/bnd/build/classindex/ClassIndexTest.java", "diffHunk": "@@ -20,50 +18,97 @@\n import aQute.libg.map.MAP.MAPX;\n \n public class ClassIndexTest {\n-\tpublic static final String\tTMPDIR\t\t= \"generated/tmp/test\";\n+\tpublic static final String\t\t\tTMPDIR\t= \"generated/tmp/test\";\n+\tprivate static File\t\t\t\t\ttestDir;\n+\tprivate static File\t\t\t\t\thome\t= IO.getFile(\"testresources/classindex\");\n+\tprivate static Workspace\t\t\tws;\n+\n \t@Rule\n-\tpublic final TestName\t\ttestName\t= new TestName();\n-\tprivate File\t\t\t\ttestDir;\n-\tprivate File\t\t\t\thome\t\t= IO.getFile(\"testresources/classindex\");\n+\tpublic final JUnitSoftAssertions\tsoftly\t= new JUnitSoftAssertions();\n \n-\t@Before\n-\tpublic void setUp() throws IOException {\n-\t\ttestDir = new File(TMPDIR, getClass().getName() + \"/\" + testName.getMethodName());\n+\t@BeforeClass\n+\tpublic static void setUp() throws Exception {", "originalCommit": "2f35b2b6c19c083475fcc82ada9e0c1ac76db841", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg0NDE4NA==", "url": "https://github.com/bndtools/bnd/pull/4268#discussion_r471844184", "bodyText": "Setting up the workspace afresh for each test comes at performance penalty. I believe that this would be necessary if the tests were attempting to modify the workspace in some way, but as the workspace is read-only in these tests it seems like overkill to me.", "author": "kriegfrj", "createdAt": "2020-08-18T00:22:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU5ODMxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg0OTE3NQ==", "url": "https://github.com/bndtools/bnd/pull/4268#discussion_r471849175", "bodyText": "Lets take the perf hit. I want the test cases to be side effect free and that is how we guarantee that. We do this in many other test cases. Also, a workspace is not read-only. Many things can be going on since there is a lot of code involved.", "author": "bjhargrave", "createdAt": "2020-08-18T00:41:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU5ODMxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg3ODMyMg==", "url": "https://github.com/bndtools/bnd/pull/4268#discussion_r471878322", "bodyText": "Done.", "author": "kriegfrj", "createdAt": "2020-08-18T02:34:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU5ODMxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTYwMjEzNw==", "url": "https://github.com/bndtools/bnd/pull/4268#discussion_r471602137", "bodyText": "If you need parameter names, then you need to tell the compiler (javac and eclipse) to compile the parameter names in. So you probably need to make a change to this test project similar to:\n26f649a", "author": "bjhargrave", "createdAt": "2020-08-17T16:38:39Z", "path": "bndtools.core.test/src/bndtools/core/test/editors/quickfix/BuildpathQuickFixProcessorTest.java", "diffHunk": "@@ -826,8 +853,25 @@ void withFQClassLiteral_asAnnotationParameter_suggestsBundles(SoftAssertions sof\n \t\t\tsuggestsBundle(\"bndtools.core.test.fodder.iface\", \"1.0.0\", \"iface.bundle.MyInterface\"));\n \t}\n \n+\t@Disabled(\"Can't seem to make this work - binding information seems to be missing from class literal, I think this is\"", "originalCommit": "2f35b2b6c19c083475fcc82ada9e0c1ac76db841", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg0NjYwMA==", "url": "https://github.com/bndtools/bnd/pull/4268#discussion_r471846600", "bodyText": "Thanks - but I don't think that will help. The quick fix processor doesn't need to know the variable or parameter names, only their types.\nIt seemed that even though ClassWithInterfaceExtendingMyInterface is on the classpath and I have bindings recovery turned on, Eclipse's compiler wasn't properly generating the type binding information for the hierarchy of ClassWithInterfaceExtendingMyInterface so that I could find the missing type.\nI got to the point where I felt that this was actually a bug in Eclipse that it wasn't fully recovering the incomplete type. However, I just had another idea that I will retry.", "author": "kriegfrj", "createdAt": "2020-08-18T00:31:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTYwMjEzNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg4MDQ1Ng==", "url": "https://github.com/bndtools/bnd/pull/4268#discussion_r471880456", "bodyText": "I retried the idea and re-confirmed my original diagnosis. This time I documented the issue more precisely in the test code itself. I left in there in case the Eclipse issue is ever resolved, then this test case can be re-instated.\nI'm able to get the binding information for ClassWithInterfaceExtendingMyInterface. However, when I call getInterfaces() on the type binding it returns an empty array. What it should be doing is returning a recovered type binding for its implemented interface InterfaceExtendingMyInterface (which the quick fix processor would then know how to fix).\nThe annoying thing is that if you print out the type binding for ClassWithInterfaceExtendingMyInterface or examine its private state variables, you can see that Eclipse knows it implements InterfaceExtendingMyInterface and has a recovered binding for it. It's just not returning it in getInterfaces().", "author": "kriegfrj", "createdAt": "2020-08-18T02:42:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTYwMjEzNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg4NTA2NQ==", "url": "https://github.com/bndtools/bnd/pull/4268#discussion_r471885065", "bodyText": "Hmm. Is there an Eclipse bug filed for this, I wonder?", "author": "bjhargrave", "createdAt": "2020-08-18T02:59:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTYwMjEzNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkwMzg5NA==", "url": "https://github.com/bndtools/bnd/pull/4268#discussion_r471903894", "bodyText": "There is now! https://bugs.eclipse.org/bugs/show_bug.cgi?id=566145", "author": "kriegfrj", "createdAt": "2020-08-18T04:17:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTYwMjEzNw=="}], "type": "inlineReview"}, {"oid": "3d709df5d6e4835798af9b39cd3573d4892ad1c4", "url": "https://github.com/bndtools/bnd/commit/3d709df5d6e4835798af9b39cd3573d4892ad1c4", "message": "[classindex] Added search variant that searches particular package\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>", "committedDate": "2020-08-18T02:32:50Z", "type": "commit"}, {"oid": "4b419749d759ded60505bad7636edef293971b72", "url": "https://github.com/bndtools/bnd/commit/4b419749d759ded60505bad7636edef293971b72", "message": "[quickfix] Added more discerning checks for undefined types\n\nEliminates some possible false positives due to class/package qualifier\nambiguity.\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>", "committedDate": "2020-08-18T02:32:51Z", "type": "commit"}, {"oid": "e6cd6fd0b6ef484035dea0ab9f71f3cf1d1e199d", "url": "https://github.com/bndtools/bnd/commit/e6cd6fd0b6ef484035dea0ab9f71f3cf1d1e199d", "message": "[quickfix] Better handling of class literals\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>", "committedDate": "2020-08-18T02:32:51Z", "type": "commit"}, {"oid": "e6cd6fd0b6ef484035dea0ab9f71f3cf1d1e199d", "url": "https://github.com/bndtools/bnd/commit/e6cd6fd0b6ef484035dea0ab9f71f3cf1d1e199d", "message": "[quickfix] Better handling of class literals\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>", "committedDate": "2020-08-18T02:32:51Z", "type": "forcePushed"}]}