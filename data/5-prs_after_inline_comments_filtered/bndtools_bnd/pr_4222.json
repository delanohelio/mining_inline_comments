{"pr_number": 4222, "pr_title": "set equinox configuration app args", "pr_createdAt": "2020-07-10T00:00:05Z", "pr_url": "https://github.com/bndtools/bnd/pull/4222", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjU4MjUxNA==", "url": "https://github.com/bndtools/bnd/pull/4222#discussion_r452582514", "bodyText": "Typo in retrieved", "author": "rotty3000", "createdAt": "2020-07-10T02:00:55Z", "path": "org.bndtools.applaunch/src/org/bndtools/applaunch/Activator.java", "diffHunk": "@@ -69,6 +73,38 @@ private static Filter createFilter() {\n \t\treturn context.registerService(ApplicationLauncher.class, new BndApplicationLauncher(context), null);\n \t}\n \n+\tprivate void setEquinoxConfigAppArgs(BundleContext context) {\n+\t\tString[] parameters = null;\n+\t\ttry {\n+\t\t\tServiceReference<?>[] serviceReferences = context.getServiceReferences(\"aQute.launcher.Launcher\",\n+\t\t\t\t\"(launcher.arguments=*)\");\n+\t\t\tif (serviceReferences != null && serviceReferences.length > 0) {\n+\t\t\t\tObject property = serviceReferences[0].getProperty(\"launcher.arguments\");\n+\n+\t\t\t\tif (property instanceof String[]) {\n+\t\t\t\t\tparameters = (String[]) property;\n+\n+\t\t\t\t\tServiceReference<EnvironmentInfo> srvcRef = context.getServiceReference(EnvironmentInfo.class);\n+\t\t\t\t\tif (srvcRef != null) {\n+\t\t\t\t\t\tEnvironmentInfo service = context.getService(srvcRef);\n+\t\t\t\t\t\tif (service instanceof EquinoxConfiguration) {\n+\t\t\t\t\t\t\tEquinoxConfiguration equinoxConfig = (EquinoxConfiguration) service;\n+\t\t\t\t\t\t\tequinoxConfig.setAllArgs(parameters);\n+\t\t\t\t\t\t\tequinoxConfig.setAppArgs(parameters);\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\n+\t\t\t\t\tlog.fine(\"configured program arguments \" + parameters);\n+\t\t\t\t}\n+\t\t\t} else {\n+\t\t\t\tlog.log(Level.SEVERE,\n+\t\t\t\t\t\"service aQute.launcher.Launcher with props launcher.arguments could not be retireved\");", "originalCommit": "8c0a1febc2e71edf465c0775e3de533321f66ab1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "150a520edd6375ad8d148746c11a06780ef94d6a", "url": "https://github.com/bndtools/bnd/commit/150a520edd6375ad8d148746c11a06780ef94d6a", "message": "set equinox configuration app args\n\nSigned-off-by: Gregory Amerson <gregory.amerson@liferay.com>", "committedDate": "2020-07-10T11:40:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjgxMjYyNw==", "url": "https://github.com/bndtools/bnd/pull/4222#discussion_r452812627", "bodyText": "I think Arrays.toString(args) is probably fine and simpler.\nWhy is this log log.fine( when the other logs are like log.log(Level.? It seems a bit inconsistent.", "author": "bjhargrave", "createdAt": "2020-07-10T12:30:28Z", "path": "org.bndtools.applaunch/src/org/bndtools/applaunch/Activator.java", "diffHunk": "@@ -69,6 +75,39 @@ private static Filter createFilter() {\n \t\treturn context.registerService(ApplicationLauncher.class, new BndApplicationLauncher(context), null);\n \t}\n \n+\tprivate void setEquinoxConfigAppArgs(BundleContext context) {\n+\t\tString[] args = null;\n+\t\ttry {\n+\t\t\tServiceReference<?>[] serviceReferences = context.getServiceReferences(\"aQute.launcher.Launcher\",\n+\t\t\t\t\"(launcher.arguments=*)\");\n+\t\t\tif (serviceReferences != null && serviceReferences.length > 0) {\n+\t\t\t\tObject property = serviceReferences[0].getProperty(\"launcher.arguments\");\n+\n+\t\t\t\tif (property instanceof String[]) {\n+\t\t\t\t\targs = (String[]) property;\n+\n+\t\t\t\t\tServiceReference<EnvironmentInfo> srvcRef = context.getServiceReference(EnvironmentInfo.class);\n+\t\t\t\t\tif (srvcRef != null) {\n+\t\t\t\t\t\tEnvironmentInfo service = context.getService(srvcRef);\n+\t\t\t\t\t\tif (service instanceof EquinoxConfiguration) {\n+\t\t\t\t\t\t\tEquinoxConfiguration equinoxConfig = (EquinoxConfiguration) service;\n+\t\t\t\t\t\t\tequinoxConfig.setAllArgs(args);\n+\t\t\t\t\t\t\tequinoxConfig.setAppArgs(args);\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\n+\t\t\t\t\tlog.fine(\"configured program arguments \" + Arrays.stream(args)", "originalCommit": "150a520edd6375ad8d148746c11a06780ef94d6a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg2NTExNA==", "url": "https://github.com/bndtools/bnd/pull/4222#discussion_r452865114", "bodyText": "I'll clean those up.", "author": "gamerson", "createdAt": "2020-07-10T14:05:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjgxMjYyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjgxNDA5NA==", "url": "https://github.com/bndtools/bnd/pull/4222#discussion_r452814094", "bodyText": "What about ungeting the service?", "author": "bjhargrave", "createdAt": "2020-07-10T12:33:19Z", "path": "org.bndtools.applaunch/src/org/bndtools/applaunch/Activator.java", "diffHunk": "@@ -69,6 +75,39 @@ private static Filter createFilter() {\n \t\treturn context.registerService(ApplicationLauncher.class, new BndApplicationLauncher(context), null);\n \t}\n \n+\tprivate void setEquinoxConfigAppArgs(BundleContext context) {\n+\t\tString[] args = null;\n+\t\ttry {\n+\t\t\tServiceReference<?>[] serviceReferences = context.getServiceReferences(\"aQute.launcher.Launcher\",\n+\t\t\t\t\"(launcher.arguments=*)\");\n+\t\t\tif (serviceReferences != null && serviceReferences.length > 0) {\n+\t\t\t\tObject property = serviceReferences[0].getProperty(\"launcher.arguments\");\n+\n+\t\t\t\tif (property instanceof String[]) {\n+\t\t\t\t\targs = (String[]) property;\n+\n+\t\t\t\t\tServiceReference<EnvironmentInfo> srvcRef = context.getServiceReference(EnvironmentInfo.class);\n+\t\t\t\t\tif (srvcRef != null) {\n+\t\t\t\t\t\tEnvironmentInfo service = context.getService(srvcRef);", "originalCommit": "150a520edd6375ad8d148746c11a06780ef94d6a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg2NTA0OQ==", "url": "https://github.com/bndtools/bnd/pull/4222#discussion_r452865049", "bodyText": "I'll add the unget", "author": "gamerson", "createdAt": "2020-07-10T14:05:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjgxNDA5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjgxNTcyOQ==", "url": "https://github.com/bndtools/bnd/pull/4222#discussion_r452815729", "bodyText": "Why are the command line args (setAllArgs) and the non-framework args (setAppArgs) set to the same value?", "author": "bjhargrave", "createdAt": "2020-07-10T12:36:49Z", "path": "org.bndtools.applaunch/src/org/bndtools/applaunch/Activator.java", "diffHunk": "@@ -69,6 +75,39 @@ private static Filter createFilter() {\n \t\treturn context.registerService(ApplicationLauncher.class, new BndApplicationLauncher(context), null);\n \t}\n \n+\tprivate void setEquinoxConfigAppArgs(BundleContext context) {\n+\t\tString[] args = null;\n+\t\ttry {\n+\t\t\tServiceReference<?>[] serviceReferences = context.getServiceReferences(\"aQute.launcher.Launcher\",\n+\t\t\t\t\"(launcher.arguments=*)\");\n+\t\t\tif (serviceReferences != null && serviceReferences.length > 0) {\n+\t\t\t\tObject property = serviceReferences[0].getProperty(\"launcher.arguments\");\n+\n+\t\t\t\tif (property instanceof String[]) {\n+\t\t\t\t\targs = (String[]) property;\n+\n+\t\t\t\t\tServiceReference<EnvironmentInfo> srvcRef = context.getServiceReference(EnvironmentInfo.class);\n+\t\t\t\t\tif (srvcRef != null) {\n+\t\t\t\t\t\tEnvironmentInfo service = context.getService(srvcRef);\n+\t\t\t\t\t\tif (service instanceof EquinoxConfiguration) {\n+\t\t\t\t\t\t\tEquinoxConfiguration equinoxConfig = (EquinoxConfiguration) service;\n+\t\t\t\t\t\t\tequinoxConfig.setAllArgs(args);\n+\t\t\t\t\t\t\tequinoxConfig.setAppArgs(args);", "originalCommit": "150a520edd6375ad8d148746c11a06780ef94d6a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg2NDk3MA==", "url": "https://github.com/bndtools/bnd/pull/4222#discussion_r452864970", "bodyText": "AppArgs is all I need so I'll remove the other.", "author": "gamerson", "createdAt": "2020-07-10T14:05:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjgxNTcyOQ=="}], "type": "inlineReview"}, {"oid": "59f1d97c2cc950f15d82c6f3f60f4fdfced4a026", "url": "https://github.com/bndtools/bnd/commit/59f1d97c2cc950f15d82c6f3f60f4fdfced4a026", "message": "set equinox configuration app args\n\nSigned-off-by: Gregory Amerson <gregory.amerson@liferay.com>", "committedDate": "2020-07-10T14:05:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg2Njc3Ng==", "url": "https://github.com/bndtools/bnd/pull/4222#discussion_r452866776", "bodyText": "envInfo could be null here, no?", "author": "bjhargrave", "createdAt": "2020-07-10T14:08:19Z", "path": "org.bndtools.applaunch/src/org/bndtools/applaunch/Activator.java", "diffHunk": "@@ -69,8 +75,40 @@ private static Filter createFilter() {\n \t\treturn context.registerService(ApplicationLauncher.class, new BndApplicationLauncher(context), null);\n \t}\n \n+\tprivate void setEquinoxConfigAppArgs(BundleContext context) {\n+\t\tString[] args = null;\n+\t\ttry {\n+\t\t\tServiceReference<?>[] serviceReferences = context.getServiceReferences(\"aQute.launcher.Launcher\",\n+\t\t\t\t\"(launcher.arguments=*)\");\n+\t\t\tif (serviceReferences != null && serviceReferences.length > 0) {\n+\t\t\t\tObject property = serviceReferences[0].getProperty(\"launcher.arguments\");\n+\n+\t\t\t\tif (property instanceof String[]) {\n+\t\t\t\t\targs = (String[]) property;\n+\n+\t\t\t\t\tenvInfo = context.getServiceReference(EnvironmentInfo.class);\n+\t\t\t\t\tif (envInfo != null) {\n+\t\t\t\t\t\tEnvironmentInfo service = context.getService(envInfo);\n+\t\t\t\t\t\tif (service instanceof EquinoxConfiguration) {\n+\t\t\t\t\t\t\tEquinoxConfiguration equinoxConfig = (EquinoxConfiguration) service;\n+\t\t\t\t\t\t\tequinoxConfig.setAppArgs(args);\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\n+\t\t\t\t\tlog.log(Level.FINE, \"configured program arguments \" + Arrays.toString(args));\n+\t\t\t\t}\n+\t\t\t} else {\n+\t\t\t\tlog.log(Level.SEVERE,\n+\t\t\t\t\t\"service aQute.launcher.Launcher with props launcher.arguments could not be retrieved\");\n+\t\t\t}\n+\t\t} catch (Exception e) {\n+\t\t\tlog.log(Level.SEVERE, \"command line parameters could not be configured.\");\n+\t\t}\n+\t}\n+\n \t@Override\n \tpublic void removedService(ServiceReference<Object> reference, ServiceRegistration<ApplicationLauncher> service) {\n+\t\tcontext.ungetService(envInfo);", "originalCommit": "59f1d97c2cc950f15d82c6f3f60f4fdfced4a026", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg2NjkxMQ==", "url": "https://github.com/bndtools/bnd/pull/4222#discussion_r452866911", "bodyText": "ah yes", "author": "gamerson", "createdAt": "2020-07-10T14:08:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg2Njc3Ng=="}], "type": "inlineReview"}, {"oid": "fa20af37aeb38602558645577b4f796ed62bf804", "url": "https://github.com/bndtools/bnd/commit/fa20af37aeb38602558645577b4f796ed62bf804", "message": "set equinox configuration app args\n\nSigned-off-by: Gregory Amerson <gregory.amerson@liferay.com>", "committedDate": "2020-07-10T14:09:12Z", "type": "commit"}, {"oid": "fa20af37aeb38602558645577b4f796ed62bf804", "url": "https://github.com/bndtools/bnd/commit/fa20af37aeb38602558645577b4f796ed62bf804", "message": "set equinox configuration app args\n\nSigned-off-by: Gregory Amerson <gregory.amerson@liferay.com>", "committedDate": "2020-07-10T14:09:12Z", "type": "forcePushed"}]}