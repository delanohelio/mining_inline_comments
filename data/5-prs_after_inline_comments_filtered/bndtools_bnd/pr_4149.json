{"pr_number": 4149, "pr_title": "analyzer: bnd does not support Setting Package Version information `N\u2026", "pr_createdAt": "2020-06-09T02:57:24Z", "pr_url": "https://github.com/bndtools/bnd/pull/4149", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzExODIxNw==", "url": "https://github.com/bndtools/bnd/pull/4149#discussion_r437118217", "bodyText": "I think you also need to filter out empty dirs, no?\n\n  \n    \n      bnd/biz.aQute.bndlib/src/aQute/bnd/osgi/Jar.java\n    \n    \n        Lines 1018 to 1021\n      in\n      6c127ce\n    \n    \n    \n    \n\n        \n          \n           public List<String> getPackages() { \n        \n\n        \n          \n           \tcheck(); \n        \n\n        \n          \n           \treturn MapStream.of(directories) \n        \n\n        \n          \n           \t\t.filterValue(mdir -> Objects.nonNull(mdir) && !mdir.isEmpty()) \n        \n    \n  \n\n\nIt is possible a resource is added which creates a directory and later the resource is removed. This is why getPackages() filters out empty directories.", "author": "bjhargrave", "createdAt": "2020-06-09T03:31:21Z", "path": "biz.aQute.bndlib/src/aQute/bnd/osgi/Analyzer.java", "diffHunk": "@@ -1309,6 +1309,14 @@ private void doNamesection(Jar dot, Manifest manifest) {\n \t\tInstructions instructions = new Instructions(namesection);\n \t\tSet<String> resources = new HashSet<>(dot.getResources()\n \t\t\t.keySet());\n+\t\t// Support package attributes. See\n+\t\t// https://docs.oracle.com/javase/8/docs/technotes/guides/versioning/spec/versioning2.html#wp89936\n+\t\tdot.getDirectories()\n+\t\t\t.keySet()\n+\t\t\t.stream()", "originalCommit": "f54141de21d450512f4446585b95a419ea59f13d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzEyMjA5MA==", "url": "https://github.com/bndtools/bnd/pull/4149#discussion_r437122090", "bodyText": "take note that I just added tests and docs.", "author": "rotty3000", "createdAt": "2020-06-09T03:48:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzExODIxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzEyMjc1MQ==", "url": "https://github.com/bndtools/bnd/pull/4149#discussion_r437122751", "bodyText": "I see your point. I can filter out non-package dirs.", "author": "rotty3000", "createdAt": "2020-06-09T03:52:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzExODIxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzEyMzc3Ng==", "url": "https://github.com/bndtools/bnd/pull/4149#discussion_r437123776", "bodyText": "fixed", "author": "rotty3000", "createdAt": "2020-06-09T03:56:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzExODIxNw=="}], "type": "inlineReview"}, {"oid": "92742d20d24dd96e154d094bfb7c4fd37dade9a6", "url": "https://github.com/bndtools/bnd/commit/92742d20d24dd96e154d094bfb7c4fd37dade9a6", "message": "analyzer: bnd does not support Setting Package Version information `Name` sections in the manifest\n\nfixes #4148\n\nSigned-off-by: Raymond Aug\u00e9 <raymond.auge@liferay.com>", "committedDate": "2020-06-09T03:48:16Z", "type": "forcePushed"}, {"oid": "afbf589cdb140ffe62d9e9d4fed2f9f8d7b79b46", "url": "https://github.com/bndtools/bnd/commit/afbf589cdb140ffe62d9e9d4fed2f9f8d7b79b46", "message": "analyzer: bnd does not support Setting Package Version information `Name` sections in the manifest\n\nfixes #4148\n\nSigned-off-by: Raymond Aug\u00e9 <raymond.auge@liferay.com>", "committedDate": "2020-06-09T03:56:24Z", "type": "forcePushed"}, {"oid": "3605f44e830c46eea470fe37f3b6856baa524232", "url": "https://github.com/bndtools/bnd/commit/3605f44e830c46eea470fe37f3b6856baa524232", "message": "analyzer: bnd does not support Setting Package Version information `Name` sections in the manifest\n\nfixes #4148\n\nSigned-off-by: Raymond Aug\u00e9 <raymond.auge@liferay.com>", "committedDate": "2020-06-09T03:59:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzMzNjY2OA==", "url": "https://github.com/bndtools/bnd/pull/4149#discussion_r437336668", "bodyText": "What about allowing wildcards for packages if the wildcard ends in /? Then you could do -namesection: javax.*/;sealed=true. I can see that you do not want wildcards not ending in slash to apply to package entries. But I also think we should support wildcards ending in slash to apply to matching package entries?", "author": "bjhargrave", "createdAt": "2020-06-09T11:28:36Z", "path": "biz.aQute.bndlib/src/aQute/bnd/osgi/Analyzer.java", "diffHunk": "@@ -1326,8 +1334,13 @@ private void doNamesection(Jar dot, Manifest manifest) {\n \t\t\t\tString path = i.next();\n \t\t\t\t// For each resource\n \n-\t\t\t\tif (instr.getKey()\n-\t\t\t\t\t.matches(path)) {\n+\t\t\t\tInstruction instruction = instr.getKey();\n+\n+\t\t\t\tif (path.endsWith(\"/\") && (!instruction.isLiteral() || !instruction", "originalCommit": "3605f44e830c46eea470fe37f3b6856baa524232", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM3NjU2Nw==", "url": "https://github.com/bndtools/bnd/pull/4149#discussion_r437376567", "bodyText": "Yeah this occurred to me as well. I'll make the change.", "author": "rotty3000", "createdAt": "2020-06-09T12:34:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzMzNjY2OA=="}], "type": "inlineReview"}, {"oid": "ed7d735a0b345853b58e9d84cae2eb199d10de76", "url": "https://github.com/bndtools/bnd/commit/ed7d735a0b345853b58e9d84cae2eb199d10de76", "message": "analyzer: bnd does not support Setting Package Version information `Name` sections in the manifest\n\nfixes #4148\n\nSigned-off-by: Raymond Aug\u00e9 <raymond.auge@liferay.com>", "committedDate": "2020-06-09T13:36:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQzNTYyNg==", "url": "https://github.com/bndtools/bnd/pull/4149#discussion_r437435626", "bodyText": "I think the text here needs fixing to allow for wildcards ending in /.", "author": "bjhargrave", "createdAt": "2020-06-09T13:50:29Z", "path": "biz.aQute.bndlib/src/aQute/bnd/help/Syntax.java", "diffHunk": "@@ -558,7 +558,7 @@\n \t\tnew Syntax(NOEE, \"Do not calculate the osgi.ee name space Execution Environment from the class file version.\",\n \t\t\tNOEE + \"=true\", \"true,false\", Verifier.TRUEORFALSEPATTERN),\n \t\tnew Syntax(NAMESECTION,\n-\t\t\t\"Create a name section (second part of manifest) with optional property expansion and addition of custom attributes.\",\n+\t\t\t\"Create a name section (second part of manifest) with optional property expansion and addition of custom attributes. To add a section for a package do not use a wildcard and make sure the path ends with a slash (/). e.g. '-namesection: org/osgi/service/event/;Foo=Bar'\",", "originalCommit": "ed7d735a0b345853b58e9d84cae2eb199d10de76", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f2aca385e1a56fe2d97f7020abfcbf69d79eab02", "url": "https://github.com/bndtools/bnd/commit/f2aca385e1a56fe2d97f7020abfcbf69d79eab02", "message": "analyzer: bnd does not support Setting Package Version information `Name` sections in the manifest\n\nfixes #4148\n\nSigned-off-by: Raymond Aug\u00e9 <raymond.auge@liferay.com>", "committedDate": "2020-06-09T14:00:13Z", "type": "forcePushed"}, {"oid": "1d1f2c0e591a2d79db3ed10ee6c2c5b45343fae3", "url": "https://github.com/bndtools/bnd/commit/1d1f2c0e591a2d79db3ed10ee6c2c5b45343fae3", "message": "analyzer: bnd does not support Setting Package Version information `Name` sections in the manifest\n\nfixes #4148\n\nSigned-off-by: Raymond Aug\u00e9 <raymond.auge@liferay.com>", "committedDate": "2020-06-09T14:05:11Z", "type": "forcePushed"}, {"oid": "570e01e04dec77e4b22f9dd71f3a59a4b621286f", "url": "https://github.com/bndtools/bnd/commit/570e01e04dec77e4b22f9dd71f3a59a4b621286f", "message": "analyzer: bnd does not support Setting Package Version information `Name` sections in the manifest\n\nfixes #4148\n\nSigned-off-by: Raymond Aug\u00e9 <raymond.auge@liferay.com>", "committedDate": "2020-06-09T14:05:59Z", "type": "forcePushed"}, {"oid": "f97fc2084025af28ad9d218c7942066b24ac0023", "url": "https://github.com/bndtools/bnd/commit/f97fc2084025af28ad9d218c7942066b24ac0023", "message": "analyzer: bnd does not support Setting Package Version information `Name` sections in the manifest\n\nfixes #4148\n\nSigned-off-by: Raymond Aug\u00e9 <raymond.auge@liferay.com>", "committedDate": "2020-06-09T14:20:08Z", "type": "forcePushed"}, {"oid": "850dd8df834437d7392ceb72cacfd17907b38540", "url": "https://github.com/bndtools/bnd/commit/850dd8df834437d7392ceb72cacfd17907b38540", "message": "analyzer: bnd does not support Setting Package Version information `Name` sections in the manifest\n\nfixes #4148\n\nSigned-off-by: Raymond Aug\u00e9 <raymond.auge@liferay.com>", "committedDate": "2020-06-09T14:26:05Z", "type": "commit"}, {"oid": "850dd8df834437d7392ceb72cacfd17907b38540", "url": "https://github.com/bndtools/bnd/commit/850dd8df834437d7392ceb72cacfd17907b38540", "message": "analyzer: bnd does not support Setting Package Version information `Name` sections in the manifest\n\nfixes #4148\n\nSigned-off-by: Raymond Aug\u00e9 <raymond.auge@liferay.com>", "committedDate": "2020-06-09T14:26:05Z", "type": "forcePushed"}]}