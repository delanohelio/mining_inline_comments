{"pr_number": 4254, "pr_title": "[junit-platform] Added Gogo commandlet", "pr_createdAt": "2020-08-07T08:34:24Z", "pr_url": "https://github.com/bndtools/bnd/pull/4254", "timeline": [{"oid": "0430d7fee27693a451db9772dac6a815b8881ba4", "url": "https://github.com/bndtools/bnd/commit/0430d7fee27693a451db9772dac6a815b8881ba4", "message": "[junit-platform] Added Gogo commandlet\n\nIf Gogo is in the environment, then in automatic mode\nthe tester will register a \"runtests\" command that allows\nyou to interactively run tests from the shell.\n\nFixes #3812\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>", "committedDate": "2020-08-07T10:02:11Z", "type": "forcePushed"}, {"oid": "1f1d264f6d4d84493c863de2d6d83fdd4ebf3f74", "url": "https://github.com/bndtools/bnd/commit/1f1d264f6d4d84493c863de2d6d83fdd4ebf3f74", "message": "[junit-platform] Added Gogo commandlet\n\nIf Gogo is in the environment, then in automatic mode\nthe tester will register a \"runtests\" command that allows\nyou to interactively run tests from the shell.\n\nFixes #3812\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>", "committedDate": "2020-09-06T13:55:21Z", "type": "forcePushed"}, {"oid": "62dbaa2683a50c091393821995ad2a0ccb597bc7", "url": "https://github.com/bndtools/bnd/commit/62dbaa2683a50c091393821995ad2a0ccb597bc7", "message": "[junit-platform] Added Gogo commandlet\n\nIf Gogo is in the environment, then in automatic mode\nthe tester will register a \"runtests\" command that allows\nyou to interactively run tests from the shell.\n\nFixes #3812\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>", "committedDate": "2020-09-08T01:35:49Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE2NjA4MA==", "url": "https://github.com/bndtools/bnd/pull/4254#discussion_r485166080", "bodyText": "Can you even get an NCDFE here? The only gogo type is Description which is only used as an annotation and the class loader will be happy to load the GogoCommandlet class even if the annotations are not available. So I don't think you can ever get the error.", "author": "bjhargrave", "createdAt": "2020-09-08T20:05:03Z", "path": "biz.aQute.tester.junit-platform/src/aQute/tester/junit/platform/Activator.java", "diffHunk": "@@ -295,12 +297,26 @@ public void removedBundle(Bundle bundle, BundleEvent event, Bundle object) {\n \t\t};\n \t\ttracker.open();\n \n+\t\tif (Boolean.valueOf(context.getProperty(\"launch.services\"))) {\n+\t\t\ttry {\n+\t\t\t\tGogoCommandlet cmd = new GogoCommandlet();\n+\t\t\t\tHashtable<String, Object> properties = new Hashtable<>();\n+\t\t\t\tproperties.put(\"osgi.command.function\", new String[] {\n+\t\t\t\t\t\"runTests\"\n+\t\t\t\t});\n+\t\t\t\tproperties.put(\"osgi.command.scope\", \"tester\");\n+\n+\t\t\t\ttrace(\"starting gogo commandlet\");\n+\t\t\t\tcontext.registerService(Object.class, cmd, properties);\n+\t\t\t} catch (NoClassDefFoundError e) {}", "originalCommit": "62dbaa2683a50c091393821995ad2a0ccb597bc7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjAxMDU1MA==", "url": "https://github.com/bndtools/bnd/pull/4254#discussion_r486010550", "bodyText": "Well I've learned something. I didn't know that the classloader would ignore annotations if their type was missing. I've removed it and the tests pass. In fact, it didn't occur to me (or at least I never seriously investigated) that the gogo-specific tests were running and passing even though I hadn't added gogo to the command line runbundles.\nAnd this is also a lesson to me, that this is the kind of thing that happens when you don't do proper TDD! I obviously never attempted (or at least never succeeded) to write that failing test to trigger the NCDFE.", "author": "kriegfrj", "createdAt": "2020-09-10T01:33:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE2NjA4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE2NzEwMA==", "url": "https://github.com/bndtools/bnd/pull/4254#discussion_r485167100", "bodyText": "Perhaps this should only be registered if in continuous mode? Otherwise there is no loop watching the queue. The test case sets continuous on to get the test to work I assume.", "author": "bjhargrave", "createdAt": "2020-09-08T20:07:04Z", "path": "biz.aQute.tester.junit-platform/src/aQute/tester/junit/platform/Activator.java", "diffHunk": "@@ -295,12 +297,26 @@ public void removedBundle(Bundle bundle, BundleEvent event, Bundle object) {\n \t\t};\n \t\ttracker.open();\n \n+\t\tif (Boolean.valueOf(context.getProperty(\"launch.services\"))) {\n+\t\t\ttry {\n+\t\t\t\tGogoCommandlet cmd = new GogoCommandlet();\n+\t\t\t\tHashtable<String, Object> properties = new Hashtable<>();\n+\t\t\t\tproperties.put(\"osgi.command.function\", new String[] {\n+\t\t\t\t\t\"runTests\"\n+\t\t\t\t});\n+\t\t\t\tproperties.put(\"osgi.command.scope\", \"tester\");\n+\n+\t\t\t\ttrace(\"starting gogo commandlet\");\n+\t\t\t\tcontext.registerService(Object.class, cmd, properties);", "originalCommit": "62dbaa2683a50c091393821995ad2a0ccb597bc7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjAxNDY5Mw==", "url": "https://github.com/bndtools/bnd/pull/4254#discussion_r486014693", "bodyText": "Perhaps this should only be registered if in continuous mode? Otherwise there is no loop watching the queue.\n\nIn auto, non-continuous mode, the tester can still it can still sit waiting if it doesn't find any test bundles. In theory, at least, the commandlet could still be used at this time. However if there are no test bundles in the environment it won't do much.\nI'll change it to only register during continuous mode.\n\nThe test case sets continuous on to get the test to work I assume.\n\nYes:\n\n  \n    \n      bnd/biz.aQute.tester.test/test/aQute/tester/junit/platform/test/GogoShellTests.java\n    \n    \n         Line 76\n      in\n      62dbaa2\n    \n    \n    \n    \n\n        \n          \n           .set(TESTER_CONTINUOUS, \"true\")", "author": "kriegfrj", "createdAt": "2020-09-10T01:49:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE2NzEwMA=="}], "type": "inlineReview"}, {"oid": "7129730b66a5cbb0c4608a31e1ad7b4d9b0da6ba", "url": "https://github.com/bndtools/bnd/commit/7129730b66a5cbb0c4608a31e1ad7b4d9b0da6ba", "message": "[junit-platform] Added Gogo commandlet\n\nIn continuous mode, the tester will register a \"runtests\" command that allows\nyou to interactively run tests from the shell.\n\nFixes #3812\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>", "committedDate": "2020-09-10T01:51:24Z", "type": "commit"}, {"oid": "7129730b66a5cbb0c4608a31e1ad7b4d9b0da6ba", "url": "https://github.com/bndtools/bnd/commit/7129730b66a5cbb0c4608a31e1ad7b4d9b0da6ba", "message": "[junit-platform] Added Gogo commandlet\n\nIn continuous mode, the tester will register a \"runtests\" command that allows\nyou to interactively run tests from the shell.\n\nFixes #3812\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>", "committedDate": "2020-09-10T01:51:24Z", "type": "forcePushed"}]}