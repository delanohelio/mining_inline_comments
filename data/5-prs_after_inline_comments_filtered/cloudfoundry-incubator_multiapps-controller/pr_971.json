{"pr_number": 971, "pr_title": "Resolve app name and migrate tests", "pr_createdAt": "2020-10-02T12:23:03Z", "pr_url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/971", "timeline": [{"oid": "5552c98be0eaa6afe4540cd6ac5683ad1b6385c3", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/5552c98be0eaa6afe4540cd6ac5683ad1b6385c3", "message": "Refactor and migrate tests", "committedDate": "2020-10-02T12:32:15Z", "type": "forcePushed"}, {"oid": "ed8b57a86a06af10a006d0bb03115d005f107f2d", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/ed8b57a86a06af10a006d0bb03115d005f107f2d", "message": "Refactor and migrate tests", "committedDate": "2020-10-02T14:36:29Z", "type": "forcePushed"}, {"oid": "0b298d6231fc9aa5b84edd57975bc720f9f3fed5", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/0b298d6231fc9aa5b84edd57975bc720f9f3fed5", "message": "Refactor and migrate tests", "committedDate": "2020-10-02T17:19:23Z", "type": "forcePushed"}, {"oid": "afb453867118e9265bd7bfee69cbb3c9a19072d8", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/afb453867118e9265bd7bfee69cbb3c9a19072d8", "message": "Refactor and migrate tests", "committedDate": "2020-10-05T06:10:27Z", "type": "forcePushed"}, {"oid": "11b6bfe1b2dde5159081342b32b797ff95fac88a", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/11b6bfe1b2dde5159081342b32b797ff95fac88a", "message": "Refactor and migrate tests", "committedDate": "2020-10-05T07:38:32Z", "type": "forcePushed"}, {"oid": "1228b8c853763e84ce174fe365edad002a81b1f3", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/1228b8c853763e84ce174fe365edad002a81b1f3", "message": "Refactor and migrate tests", "committedDate": "2020-10-05T07:47:42Z", "type": "forcePushed"}, {"oid": "5c2f8d6837e74b0f4d66a647b07164de9512daf0", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/5c2f8d6837e74b0f4d66a647b07164de9512daf0", "message": "Refactor and migrate tests", "committedDate": "2020-10-05T10:06:46Z", "type": "forcePushed"}, {"oid": "77448c74d57c579f2530b4d9b7a8de9b0163629c", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/77448c74d57c579f2530b4d9b7a8de9b0163629c", "message": "Refactor and migrate tests", "committedDate": "2020-10-05T11:08:28Z", "type": "forcePushed"}, {"oid": "df68573562c6c9837212b693eaa0f5aaba1011d3", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/df68573562c6c9837212b693eaa0f5aaba1011d3", "message": "Refactor and migrate tests", "committedDate": "2020-10-05T11:30:54Z", "type": "forcePushed"}, {"oid": "aa759616fe5fc587aa4da0bdcb594cebae7734f1", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/aa759616fe5fc587aa4da0bdcb594cebae7734f1", "message": "Refactor and migrate tests", "committedDate": "2020-10-05T14:00:14Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTcxNjI2OQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/971#discussion_r499716269", "bodyText": "nice!", "author": "radoslav-d", "createdAt": "2020-10-05T16:14:45Z", "path": "multiapps-controller-core/src/main/java/org/cloudfoundry/multiapps/controller/core/cf/v2/ApplicationCloudModelBuilder.java", "diffHunk": "@@ -271,4 +283,67 @@ protected Resource getResource(String dependencyName) {\n     public DeploymentMode getDeploymentMode() {\n         return DeploymentMode.SEQUENTIAL;\n     }\n+\n+    protected abstract static class AbstractBuilder<T extends AbstractBuilder<T>> {", "originalCommit": "aa759616fe5fc587aa4da0bdcb594cebae7734f1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTcyMzYzNQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/971#discussion_r499723635", "bodyText": "Instead of these empty strings, is it possible to have dummy values, which could be more descriptive for the parameter? For example new ConfigurationEntry(\"test-providerNid\", \"test-providerId\", ...", "author": "radoslav-d", "createdAt": "2020-10-05T16:26:32Z", "path": "multiapps-controller-core/src/test/java/org/cloudfoundry/multiapps/controller/core/security/data/termination/DataTerminationServiceTest.java", "diffHunk": "@@ -136,20 +136,20 @@ private void prepareServices(List<String> deletedSpaces, boolean isExistSubscrip\n     }\n \n     private List<ConfigurationSubscription> generateSubscriptions(boolean isExistSubscriptionData) {\n-        return isExistSubscriptionData ? Collections.singletonList(new ConfigurationSubscription()) : Collections.emptyList();\n+        return isExistSubscriptionData ? List.of(new ConfigurationSubscription()) : Collections.emptyList();\n     }\n \n     private List<ConfigurationEntry> generatedConfigurationEntries(boolean isExistConfigurationEntryData) {\n         return isExistConfigurationEntryData\n-            ? Collections.singletonList(new ConfigurationEntry(\"\",\n-                                                               \"\",\n-                                                               Version.parseVersion(\"1\"),\n-                                                               \"default\",\n-                                                               new CloudTarget(),\n-                                                               \"\",\n-                                                               Collections.emptyList(),\n-                                                               \"\",\n-                                                               null))\n+            ? List.of(new ConfigurationEntry(\"\",\n+                                             \"\",\n+                                             Version.parseVersion(\"1\"),\n+                                             \"default\",\n+                                             new CloudTarget(),\n+                                             \"\",\n+                                             Collections.emptyList(),\n+                                             \"\",\n+                                             null))", "originalCommit": "aa759616fe5fc587aa4da0bdcb594cebae7734f1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTcyNTIzNg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/971#discussion_r499725236", "bodyText": "nice!", "author": "radoslav-d", "createdAt": "2020-10-05T16:29:11Z", "path": "multiapps-controller-core/src/test/java/org/cloudfoundry/multiapps/controller/core/security/token/JwtTokenParserTest.java", "diffHunk": "@@ -85,20 +81,12 @@ private UAAClient mockUaaClient(boolean callRealReadToken, String alghoritm, Str\n         }\n         if (alghoritm != null && alghoritmValue != null) {\n             Mockito.when(client.readTokenKey())\n-                   .thenReturn(new HashMap<String, Object>() {\n-                       private static final long serialVersionUID = 1L;\n-\n-                       {\n-                           put(\"alg\", alghoritm);\n-                           put(\"value\", alghoritmValue);\n-                       }\n-                   });\n+                   .thenReturn(Map.of(\"alg\", alghoritm, \"value\", alghoritmValue));", "originalCommit": "aa759616fe5fc587aa4da0bdcb594cebae7734f1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTcyNjEwOQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/971#discussion_r499726109", "bodyText": "May use List.of again", "author": "radoslav-d", "createdAt": "2020-10-05T16:30:39Z", "path": "multiapps-controller-core/src/test/java/org/cloudfoundry/multiapps/controller/core/validators/parameters/ParametersValidatorHelperTest.java", "diffHunk": "@@ -3,118 +3,101 @@\n import static org.junit.jupiter.api.Assertions.assertEquals;\n \n import java.util.Arrays;\n-import java.util.Collections;\n import java.util.List;\n import java.util.Map;\n import java.util.TreeMap;\n+import java.util.stream.Stream;\n \n import org.cloudfoundry.multiapps.mta.model.Module;\n-import org.junit.Test;\n-import org.junit.runner.RunWith;\n-import org.junit.runners.Parameterized;\n-import org.junit.runners.Parameterized.Parameters;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.Arguments;\n+import org.junit.jupiter.params.provider.MethodSource;\n \n-@RunWith(Parameterized.class)\n-public class ParametersValidatorHelperTest {\n+class ParametersValidatorHelperTest {\n+\n+    private final List<ParameterValidator> validators = Arrays.asList(new HostValidator(), new DomainValidator(), new RoutesValidator(),", "originalCommit": "aa759616fe5fc587aa4da0bdcb594cebae7734f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTcyNjUyMA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/971#discussion_r499726520", "bodyText": "And below in this file", "author": "radoslav-d", "createdAt": "2020-10-05T16:31:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTcyNjEwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTczMjkwMA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/971#discussion_r499732900", "bodyText": "Do you agree to extract the values passed to the constructor in separate variables in order to achieve better readability?", "author": "radoslav-d", "createdAt": "2020-10-05T16:42:30Z", "path": "multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/StepsUtil.java", "diffHunk": "@@ -190,7 +197,12 @@ static ApplicationCloudModelBuilder getApplicationCloudModelBuilder(ProcessConte\n         DeployedMta deployedMta = context.getVariable(Variables.DEPLOYED_MTA);\n \n         return handlerFactory.getApplicationCloudModelBuilder(deploymentDescriptor, true, deployedMta, deployId, namespace,\n-                                                              context.getStepLogger());\n+                                                              context.getStepLogger(), getAppSuffixDeterminer(context));\n+    }\n+\n+    static AppSuffixDeterminer getAppSuffixDeterminer(ProcessContext context) {\n+        return new AppSuffixDeterminer(context.getVariable(Variables.KEEP_ORIGINAL_APP_NAMES_AFTER_DEPLOY),", "originalCommit": "aa759616fe5fc587aa4da0bdcb594cebae7734f1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTc0NjE0OA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/971#discussion_r499746148", "bodyText": "Here are a lot of Arrays.asList", "author": "radoslav-d", "createdAt": "2020-10-05T17:05:34Z", "path": "multiapps-controller-process/src/test/java/org/cloudfoundry/multiapps/controller/process/steps/PollServiceInProgressOperationsExecutionTest.java", "diffHunk": "@@ -23,122 +26,103 @@\n import org.cloudfoundry.multiapps.controller.process.util.ServiceOperationGetter;\n import org.cloudfoundry.multiapps.controller.process.util.ServiceProgressReporter;\n import org.cloudfoundry.multiapps.controller.process.variables.Variables;\n-import org.junit.Before;\n-import org.junit.Rule;\n-import org.junit.rules.ExpectedException;\n-import org.junit.runner.RunWith;\n-import org.junit.runners.Parameterized;\n-import org.junit.runners.Parameterized.Parameters;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.Arguments;\n+import org.junit.jupiter.params.provider.MethodSource;\n import org.mockito.Mock;\n \n-@RunWith(Parameterized.class)\n-public class PollServiceInProgressOperationsExecutionTest extends AsyncStepOperationTest<CheckForOperationsInProgressStep> {\n+class PollServiceInProgressOperationsExecutionTest extends AsyncStepOperationTest<CheckForOperationsInProgressStep> {\n \n     private static final String TEST_SPACE_ID = \"test\";\n     private static final String TEST_PROVIDER = \"testProvider\";\n     private static final String TEST_PLAN = \"testPlan\";\n     private static final String TEST_VERSION = \"0.0.1-beta\";\n \n-    @Parameters\n-    public static Iterable<Object[]> getParameters() {\n-        return Arrays.asList(new Object[][] {\n+    @Mock\n+    private ServiceOperationGetter serviceOperationGetter;\n+    @Mock\n+    private ServiceProgressReporter serviceProgressReporter;\n+    @Mock\n+    private EventsGetter eventsGetter;\n+    @Mock\n+    private CloudControllerClient client;\n+\n+    private boolean shouldVerifyStepLogger;\n+    private AsyncExecutionState expectedExecutionState;\n+\n+    public static Stream<Arguments> testPollStateExecution() {\n+        return Stream.of(\n // @formatter:off\n             // (0) With 2 services in progress:\n-            {\n-                Arrays.asList(\"service1\",\"service2\", \"service3\"), \n-                Arrays.asList(ServiceOperation.Type.DELETE, ServiceOperation.Type.CREATE, ServiceOperation.Type.DELETE),\n-                Arrays.asList(ServiceOperation.State.IN_PROGRESS, ServiceOperation.State.SUCCEEDED, ServiceOperation.State.IN_PROGRESS), \n-                false, AsyncExecutionState.RUNNING, null\n-            },\n+            Arguments.of(Arrays.asList(\"service1\",\"service2\", \"service3\"),", "originalCommit": "aa759616fe5fc587aa4da0bdcb594cebae7734f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA3NTE4NA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/971#discussion_r500075184", "bodyText": "I've replaced them wherever was possible but there are several occurrences where null is passed to asList method and this cannot be replaced because List.of requires non-null objects.", "author": "IvanBorislavovDimitrov", "createdAt": "2020-10-06T07:53:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTc0NjE0OA=="}], "type": "inlineReview"}, {"oid": "0e021957511062d5b1538d00586ea538597874d6", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/0e021957511062d5b1538d00586ea538597874d6", "message": "Refactor and migrate tests", "committedDate": "2020-10-06T07:51:11Z", "type": "forcePushed"}, {"oid": "8a03e095a0176e03082915de13e9763f6347b3a0", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/8a03e095a0176e03082915de13e9763f6347b3a0", "message": "Replace app-name in new blue-green deployment", "committedDate": "2020-10-06T07:56:23Z", "type": "commit"}, {"oid": "12d8f9e87cef862395065810218044bd9c4d8fec", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/12d8f9e87cef862395065810218044bd9c4d8fec", "message": "Refactor and migrate tests", "committedDate": "2020-10-06T07:56:24Z", "type": "commit"}, {"oid": "12d8f9e87cef862395065810218044bd9c4d8fec", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/12d8f9e87cef862395065810218044bd9c4d8fec", "message": "Refactor and migrate tests", "committedDate": "2020-10-06T07:56:24Z", "type": "forcePushed"}]}