{"pr_number": 982, "pr_title": "Handle Routes as objects", "pr_createdAt": "2020-10-30T11:13:52Z", "pr_url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE0MTQ1Mg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r515141452", "bodyText": "If we have complex and well defined equals of CloudRouteSummary, it could be possible to use native set addAll()", "author": "boyan-velinov", "createdAt": "2020-10-30T14:33:30Z", "path": "multiapps-controller-core/src/main/java/org/cloudfoundry/multiapps/controller/core/cf/v2/ApplicationRoutesCloudModelBuilder.java", "diffHunk": "@@ -45,19 +46,28 @@ private Object getPropertyValue(List<Map<String, Object>> propertiesList, String\n         return PropertiesUtil.getPropertyValue(propertiesList, propertyName, defaultValue);\n     }\n \n-    private List<String> appendExistingUris(List<String> uris, DeployedMtaApplication deployedMtaApplication) {\n-        Set<String> result = new HashSet<>(uris);\n-        if (deployedMtaApplication != null) {\n-            result.addAll(deployedMtaApplication.getUris());\n+    private Set<CloudRouteSummary> addExistingRoutes(Set<CloudRouteSummary> routes, DeployedMtaApplication deployedMtaApplication) {\n+        if (deployedMtaApplication == null) {\n+            return routes;\n+        }\n+\n+        Set<CloudRouteSummary> combinedRoutes = new HashSet<>(deployedMtaApplication.getRoutes());\n+        for (CloudRouteSummary newRoute : routes) {", "originalCommit": "2b61c57eb34579768b4c545aeed19d44085fd30d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg0MDAzMg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r515840032", "bodyText": "+1", "author": "theghost5800", "createdAt": "2020-11-02T09:28:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE0MTQ1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg1NzM4OA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r516857388", "bodyText": "done", "author": "ikasarov", "createdAt": "2020-11-03T18:00:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE0MTQ1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE0NDA3NA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r515144074", "bodyText": "Is that a leftover?", "author": "boyan-velinov", "createdAt": "2020-10-30T14:37:29Z", "path": "multiapps-controller-core/src/main/java/org/cloudfoundry/multiapps/controller/core/parser/IdleUriParametersParser.java", "diffHunk": "@@ -24,51 +28,63 @@ public IdleUriParametersParser(String defaultHost, String defaultDomain, String\n     }\n \n     @Override\n-    public List<String> getApplicationRoutes(List<Map<String, Object>> parametersList) {\n-        List<String> idleRoutes = getIdleRoutes(parametersList);\n+    public Set<CloudRouteSummary> getApplicationRoutes(List<Map<String, Object>> parametersList) {\n+        Set<CloudRouteSummary> idleRoutes = getIdleRoutes(parametersList);\n         if (!idleRoutes.isEmpty()) {\n             return idleRoutes;\n         }\n \n-        List<String> liveRoutes = super.getApplicationRoutes(parametersList);\n+        Set<CloudRouteSummary> liveRoutes = super.getApplicationRoutes(parametersList);\n         if (!liveRoutes.isEmpty()) {\n             return modifyLiveRoutes(liveRoutes);\n         }\n-        return Collections.emptyList();\n+        return Collections.emptySet();\n     }\n \n-    private List<String> getIdleRoutes(List<Map<String, Object>> parametersList) {\n+    private Set<CloudRouteSummary> getIdleRoutes(List<Map<String, Object>> parametersList) {\n         List<Map<String, Object>> idleRoutesMaps = RoutesValidator.applyRoutesType(PropertiesUtil.getPropertyValue(parametersList,\n                                                                                                                    SupportedParameters.IDLE_ROUTES,\n                                                                                                                    null));\n         return idleRoutesMaps.stream()\n-                             .map(routesMap -> (String) routesMap.get(SupportedParameters.IDLE_ROUTE))\n+                             .map(this::parseIdleRouteMap)\n                              .filter(Objects::nonNull)\n-                             .map(UriUtil::stripScheme)\n-                             .collect(Collectors.toList());\n+                             .collect(Collectors.toSet());\n \n     }\n \n-    private List<String> modifyLiveRoutes(List<String> liveRoutes) {\n-        return liveRoutes.stream()\n-                         .map(this::modifyUri)\n-                         .collect(Collectors.toList());\n+    public CloudRouteSummary parseIdleRouteMap(Map<String, Object> routeMap) {\n+        String routeString = (String) routeMap.get(SupportedParameters.IDLE_ROUTE);\n+        boolean noHostname = MapUtil.parseBooleanFlag(routeMap, SupportedParameters.NO_HOSTNAME, false);\n+\n+        if (routeString == null) {\n+            return null;\n+        }\n+\n+        return new ApplicationURI(routeString, noHostname).toCloudRouteSummary();\n     }\n \n-    private String modifyUri(String inputURI) {\n-        ApplicationURI modifiedURI = new ApplicationURI(inputURI);\n+    private Set<CloudRouteSummary> modifyLiveRoutes(Set<CloudRouteSummary> liveRoutes) {\n+        return liveRoutes.stream()\n+                         .map(this::modifyRoute)\n+                         .collect(Collectors.toSet());\n+    }\n \n+    private CloudRouteSummary modifyRoute(CloudRouteSummary inputRoute) {\n+        ImmutableCloudRouteSummary.Builder modifiedRouteBuilder = ImmutableCloudRouteSummary.builder()\n+                                                                                            .from(inputRoute);\n         String defaultDomain = getDefaultDomain();\n         String defaultHost = getDefaultHost();\n \n         if (defaultDomain != null) {\n-            modifiedURI.setDomain(defaultDomain);\n+            modifiedRouteBuilder.domain(defaultDomain);\n         }\n \n         if (defaultHost != null) {\n-            modifiedURI.setHost(defaultHost);\n+            modifiedRouteBuilder.host(defaultHost);\n+        } else if (inputRoute.getHost() == null) {\n+            // TODO: must handle this weird case", "originalCommit": "2b61c57eb34579768b4c545aeed19d44085fd30d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg1NzYzMQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r516857631", "bodyText": "yes, upon investigation, this case shouldn't be an issue", "author": "ikasarov", "createdAt": "2020-11-03T18:01:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE0NDA3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE0ODEyOA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r515148128", "bodyText": "Can we make it on one line", "author": "boyan-velinov", "createdAt": "2020-10-30T14:43:30Z", "path": "multiapps-controller-core/src/main/java/org/cloudfoundry/multiapps/controller/core/parser/UriParametersParser.java", "diffHunk": "@@ -33,20 +33,24 @@ public UriParametersParser(String defaultHost, String defaultDomain, String host\n         this.defaultDomain = defaultDomain;\n         this.hostParameterName = hostParameterName;\n         this.domainParameterName = domainParameterName;\n-        this.routePath = routePath;\n+        if (routePath != null) {", "originalCommit": "2b61c57eb34579768b4c545aeed19d44085fd30d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE1MTM0OQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r515151349", "bodyText": "Why this is called TestDataUtil but file TestData.java", "author": "boyan-velinov", "createdAt": "2020-10-30T14:48:19Z", "path": "multiapps-controller-core/src/test/java/org/cloudfoundry/multiapps/controller/core/util/TestData.java", "diffHunk": "@@ -0,0 +1,46 @@\n+package org.cloudfoundry.multiapps.controller.core.parser;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.cloudfoundry.multiapps.controller.core.model.SupportedParameters;\n+\n+import com.sap.cloudfoundry.client.facade.domain.CloudRouteSummary;\n+import com.sap.cloudfoundry.client.facade.domain.ImmutableCloudRouteSummary;\n+\n+public class TestDataUtil {", "originalCommit": "2b61c57eb34579768b4c545aeed19d44085fd30d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE1NDczMg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r515154732", "bodyText": "The class also has toString()", "author": "boyan-velinov", "createdAt": "2020-10-30T14:51:48Z", "path": "multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/DeleteApplicationRoutesStep.java", "diffHunk": "@@ -57,20 +58,20 @@ protected ApplicationRoutesGetter getApplicationRoutesGetter(CloudControllerClie\n         return new ApplicationRoutesGetter(client);\n     }\n \n-    private void deleteApplicationRoutes(CloudControllerClient client, List<CloudRoute> routes, String uri) {\n+    private void deleteApplicationRoutes(CloudControllerClient client, List<CloudRoute> routes, CloudRouteSummary routeSummary) {\n         try {\n-            CloudRoute route = UriUtil.findRoute(routes, uri);\n+            CloudRoute route = UriUtil.matchRoute(routes, routeSummary);\n             if (route.getAppsUsingRoute() > 1 || route.hasServiceUsingRoute()) {\n-                getStepLogger().warn(Messages.ROUTE_NOT_DELETED, uri);\n+                getStepLogger().warn(Messages.ROUTE_NOT_DELETED, routeSummary.toUriString());\n                 return;\n             }\n         } catch (NotFoundException e) {\n-            getStepLogger().debug(org.cloudfoundry.multiapps.controller.core.Messages.ROUTE_NOT_FOUND, uri);\n+            getStepLogger().debug(org.cloudfoundry.multiapps.controller.core.Messages.ROUTE_NOT_FOUND, routeSummary.toUriString());\n             return;\n         }\n-        getStepLogger().info(Messages.DELETING_ROUTE, uri);\n-        new ClientHelper(client).deleteRoute(uri);\n-        getStepLogger().debug(Messages.ROUTE_DELETED, uri);\n+        getStepLogger().info(Messages.DELETING_ROUTE, routeSummary.toUriString());\n+        new ClientHelper(client).deleteRoute(routeSummary);\n+        getStepLogger().debug(Messages.ROUTE_DELETED, routeSummary.toUriString());", "originalCommit": "2b61c57eb34579768b4c545aeed19d44085fd30d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg2OTc0MA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r516869740", "bodyText": "used the longer method name for clarity", "author": "ikasarov", "createdAt": "2020-11-03T18:22:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE1NDczMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE1NjE5Mg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r515156192", "bodyText": "It is ok to send null or empty since it is not used.\nProbably this was the reason for passing null before.", "author": "boyan-velinov", "createdAt": "2020-10-30T14:52:52Z", "path": "multiapps-controller-core/src/main/java/org/cloudfoundry/multiapps/controller/core/validators/parameters/RoutePartValidator.java", "diffHunk": "@@ -22,7 +22,7 @@ public String attemptToCorrect(Object routePart, final Map<String, Object> conte\n         result = result.replaceAll(\"^(-*)\", \"\");\n         result = result.replaceAll(\"(-*)$\", \"\");\n \n-        if (!isValid(result, null)) {\n+        if (!isValid(result, context)) {", "originalCommit": "2b61c57eb34579768b4c545aeed19d44085fd30d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg2OTYwMw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r516869603", "bodyText": "changed it to pass the context since Kris required that as well for his changes", "author": "ikasarov", "createdAt": "2020-11-03T18:22:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE1NjE5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzEzNjIxMQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r517136211", "bodyText": "Good", "author": "boyan-velinov", "createdAt": "2020-11-04T07:15:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE1NjE5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE2MTc1Mg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r515161752", "bodyText": "Use directly Set.of()", "author": "boyan-velinov", "createdAt": "2020-10-30T14:59:22Z", "path": "multiapps-controller-core/src/main/java/org/cloudfoundry/multiapps/controller/core/validators/parameters/RoutesValidator.java", "diffHunk": "@@ -17,11 +19,15 @@\n public class RoutesValidator implements ParameterValidator {\n \n     private final Map<String, ParameterValidator> validators;\n+    private final Set<String> supportedParamsWithoutValidators;\n \n     public RoutesValidator() {\n         this.validators = new HashMap<>();\n         ParameterValidator routeValidator = new RouteValidator();\n         this.validators.put(routeValidator.getParameterName(), routeValidator);\n+\n+        this.supportedParamsWithoutValidators = new TreeSet<>();", "originalCommit": "2b61c57eb34579768b4c545aeed19d44085fd30d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE2MjIyOA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r515162228", "bodyText": "I think context should be renamed to routesElement because this is a private function dedicated only for this use case where we pass route entry and routesElement. However, this is my personal perception becai", "author": "boyan-velinov", "createdAt": "2020-10-30T15:00:02Z", "path": "multiapps-controller-core/src/main/java/org/cloudfoundry/multiapps/controller/core/validators/parameters/RoutesValidator.java", "diffHunk": "@@ -45,9 +51,17 @@ public boolean isValid(Object routes, final Map<String, Object> context) {\n         return true;\n     }\n \n-    private boolean isElementUnsupportedOrInvalid(Entry<String, Object> entry) {\n-        ParameterValidator validator = validators.get(entry.getKey());\n-        return validator == null || !validator.isValid(entry.getValue(), null);\n+    private boolean isElementUnsupportedOrInvalid(Entry<String, Object> entry, final Map<String, Object> context) {", "originalCommit": "2b61c57eb34579768b4c545aeed19d44085fd30d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg3MDI5MA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r516870290", "bodyText": "Changed the names, the previous ones were too generic, I agree", "author": "ikasarov", "createdAt": "2020-11-03T18:23:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE2MjIyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE2NzE3Nw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r515167177", "bodyText": "can you add some short description for each test", "author": "boyan-velinov", "createdAt": "2020-10-30T15:07:42Z", "path": "multiapps-controller-core/src/test/java/org/cloudfoundry/multiapps/controller/core/validators/parameters/RouteValidatorTest.java", "diffHunk": "@@ -19,36 +25,58 @@\n     static Stream<Arguments> getParameters() {\n         return Stream.of(\n // @formatter:off\n-            // [0]\n-            Arguments.of(\"valid-host.domain\", true, \"valid-host.domain\", null),\n             // [1]\n-            Arguments.of(\"should_correct$this$host.domain\", false, \"should-correct-this-host.domain\", null),\n+            Arguments.of(\"valid-host.domain\", null, true, \"valid-host.domain\", null),", "originalCommit": "b580b042a3b612a04bd547169e6734537ee8803e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgzODc2OA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r515838768", "bodyText": "getUriParametersParser should be renamed to routeParameterParser", "author": "theghost5800", "createdAt": "2020-11-02T09:26:47Z", "path": "multiapps-controller-core/src/main/java/org/cloudfoundry/multiapps/controller/core/cf/v2/ApplicationRoutesCloudModelBuilder.java", "diffHunk": "@@ -16,27 +15,29 @@\n import org.cloudfoundry.multiapps.mta.model.Module;\n import org.cloudfoundry.multiapps.mta.util.PropertiesUtil;\n \n-public class ApplicationUrisCloudModelBuilder {\n+import com.sap.cloudfoundry.client.facade.domain.CloudRouteSummary;\n+\n+public class ApplicationRoutesCloudModelBuilder {\n \n     private final DeploymentDescriptor descriptor;\n     private final CloudApplicationExtended.AttributeUpdateStrategy applicationAttributeUpdateStrategy;\n \n-    public ApplicationUrisCloudModelBuilder(DeploymentDescriptor descriptor,\n-                                            CloudApplicationExtended.AttributeUpdateStrategy applicationAttributeUpdateStrategy) {\n+    public ApplicationRoutesCloudModelBuilder(DeploymentDescriptor descriptor,\n+                                              CloudApplicationExtended.AttributeUpdateStrategy applicationAttributeUpdateStrategy) {\n         this.descriptor = descriptor;\n         this.applicationAttributeUpdateStrategy = applicationAttributeUpdateStrategy;\n     }\n \n-    public List<String> getApplicationUris(Module module, List<Map<String, Object>> propertiesList,\n-                                           DeployedMtaApplication deployedApplication) {\n-        List<String> uris = getUriParametersParser(module).parse(propertiesList);\n-        if (shouldKeepExistingUris(propertiesList)) {\n-            return appendExistingUris(uris, deployedApplication);\n+    public Set<CloudRouteSummary> getApplicationRoutes(Module module, List<Map<String, Object>> propertiesList,\n+                                                       DeployedMtaApplication deployedApplication) {\n+        Set<CloudRouteSummary> routes = getUriParametersParser(module).parse(propertiesList);", "originalCommit": "b580b042a3b612a04bd547169e6734537ee8803e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg2NDU4MQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r515864581", "bodyText": "I think now this class should be renamed to RouteParameterParser", "author": "theghost5800", "createdAt": "2020-11-02T10:09:38Z", "path": "multiapps-controller-core/src/main/java/org/cloudfoundry/multiapps/controller/core/parser/UriParametersParser.java", "diffHunk": "@@ -9,13 +8,14 @@\n import java.util.Set;\n import java.util.stream.Collectors;\n \n+import com.sap.cloudfoundry.client.facade.domain.CloudRouteSummary;\n+import org.cloudfoundry.multiapps.common.util.MapUtil;\n import org.cloudfoundry.multiapps.controller.core.model.SupportedParameters;\n import org.cloudfoundry.multiapps.controller.core.util.ApplicationURI;\n-import org.cloudfoundry.multiapps.controller.core.util.UriUtil;\n import org.cloudfoundry.multiapps.controller.core.validators.parameters.RoutesValidator;\n import org.cloudfoundry.multiapps.mta.util.PropertiesUtil;\n \n-public class UriParametersParser implements ParametersParser<List<String>> {\n+public class UriParametersParser implements ParametersParser<Set<CloudRouteSummary>> {", "originalCommit": "b580b042a3b612a04bd547169e6734537ee8803e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg3MDk4NA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r515870984", "bodyText": "You can add that set of assembled routes is returned", "author": "theghost5800", "createdAt": "2020-11-02T10:19:57Z", "path": "multiapps-controller-core/src/main/java/org/cloudfoundry/multiapps/controller/core/parser/UriParametersParser.java", "diffHunk": "@@ -94,40 +98,57 @@ public UriParametersParser(String defaultHost, String defaultDomain, String host\n         return domains;\n     }\n \n-    private List<String> assembleUris(List<String> hosts, List<String> domains) {\n-        Set<String> uris = new LinkedHashSet<>();\n+    /**\n+     * This method is doing a DesCartesian multiplication for given hosts and domains and returns constructed routes\n+     * \n+     * @param hosts\n+     * @param domains\n+     * @return", "originalCommit": "b580b042a3b612a04bd547169e6734537ee8803e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg3ODAxMw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r515878013", "bodyText": "Rename uris to routes", "author": "theghost5800", "createdAt": "2020-11-02T10:31:33Z", "path": "multiapps-controller-core/src/main/java/org/cloudfoundry/multiapps/controller/core/parser/UriParametersParser.java", "diffHunk": "@@ -94,40 +98,57 @@ public UriParametersParser(String defaultHost, String defaultDomain, String host\n         return domains;\n     }\n \n-    private List<String> assembleUris(List<String> hosts, List<String> domains) {\n-        Set<String> uris = new LinkedHashSet<>();\n+    /**\n+     * This method is doing a DesCartesian multiplication for given hosts and domains and returns constructed routes\n+     * \n+     * @param hosts\n+     * @param domains\n+     * @return\n+     */\n+    private Set<CloudRouteSummary> assembleRoutes(List<String> hosts, List<String> domains) {\n+        Set<CloudRouteSummary> routes = new LinkedHashSet<>();\n         for (String domain : domains) {\n             if (!hosts.isEmpty()) {\n-                addHostBasedUris(uris, domain, hosts);\n+                addHostBasedRoutes(routes, domain, hosts);\n             } else {\n-                uris.add(appendRoutePathIfPresent(domain));\n+                routes.add(buildCloudPathSummary(\"\", domain));\n             }\n         }\n \n-        return new ArrayList<>(uris);\n+        return routes;\n     }\n \n-    private void addHostBasedUris(Set<String> uris, String domain, List<String> hosts) {\n+    private void addHostBasedRoutes(Set<CloudRouteSummary> uris, String domain, List<String> hosts) {", "originalCommit": "b580b042a3b612a04bd547169e6734537ee8803e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTkyMTE0Mw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r515921143", "bodyText": "Is it exist case when passed argument will be null?", "author": "theghost5800", "createdAt": "2020-11-02T11:52:24Z", "path": "multiapps-controller-core/src/main/java/org/cloudfoundry/multiapps/controller/core/util/ApplicationURI.java", "diffHunk": "@@ -41,21 +41,26 @@ public ApplicationURI(String initial) {\n         }\n     }\n \n-    public ApplicationURI(CloudRoute route) {\n-        if (route == null) {\n+    public ApplicationURI(CloudRouteSummary routeSummary) {\n+        if (routeSummary == null) {", "originalCommit": "b580b042a3b612a04bd547169e6734537ee8803e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg3NzkxOQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r516877919", "bodyText": "this constructor as is is only used in tests; I don't really want to restrict it's use by removing the null value check though", "author": "ikasarov", "createdAt": "2020-11-03T18:38:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTkyMTE0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTkyODMwOQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r515928309", "bodyText": "Did we previously support routes with port in CF?", "author": "theghost5800", "createdAt": "2020-11-02T12:07:40Z", "path": "multiapps-controller-core/src/main/java/org/cloudfoundry/multiapps/controller/core/util/ApplicationURI.java", "diffHunk": "@@ -104,6 +114,15 @@ public void setURIPart(String partName, String part) {\n         }\n     }\n \n+    public CloudRouteSummary toCloudRouteSummary() {\n+        return ImmutableCloudRouteSummary.builder()\n+                                         .host(getHost())\n+                                         .domain(getDomain())\n+                                         .path(getPath())\n+                                         .port(null)", "originalCommit": "b580b042a3b612a04bd547169e6734537ee8803e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg3NTc1MQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r516875751", "bodyText": "yes, but have since removed it from the source; setting it to null here as the apps/summary response does contain a null port", "author": "ikasarov", "createdAt": "2020-11-03T18:34:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTkyODMwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTkyOTIyMQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r515929221", "bodyText": "I think this method should be use private access modifier", "author": "theghost5800", "createdAt": "2020-11-02T12:09:42Z", "path": "multiapps-controller-core/src/main/java/org/cloudfoundry/multiapps/controller/core/util/ApplicationURI.java", "diffHunk": "@@ -146,6 +165,12 @@ public void setPath(String path) {\n         this.path = path;\n     }\n \n+    public void setParts(String host, String domain, String path) {", "originalCommit": "b580b042a3b612a04bd547169e6734537ee8803e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTkzODgxMQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r515938811", "bodyText": "Is it used the right code formatter for this class?", "author": "theghost5800", "createdAt": "2020-11-02T12:30:51Z", "path": "multiapps-controller-core/src/test/java/org/cloudfoundry/multiapps/controller/core/cf/v2/CloudModelBuilderTest.java", "diffHunk": "@@ -44,567 +44,562 @@\n \n public class CloudModelBuilderTest {\n \n-    protected static final String DEFAULT_DOMAIN_CF = \"cfapps.neo.ondemand.com\";\n-    protected static final String DEFAULT_DOMAIN_XS = \"sofd60245639a\";\n-    protected static final AppSuffixDeterminer DEFAULT_APP_SUFFIX_DETERMINER = new AppSuffixDeterminer(false, false);\n-\n-    protected static final String DEPLOY_ID = \"123\";\n-\n-    protected final Tester tester = Tester.forClass(getClass());\n-    protected final DescriptorParser descriptorParser = getDescriptorParser();\n-    protected final ConfigurationParser configurationParser = new ConfigurationParser();\n-    protected DeploymentDescriptor deploymentDescriptor;\n-\n-    protected String deploymentDescriptorLocation;\n-    protected String extensionDescriptorLocation;\n-    protected String platformLocation;\n-    protected String deployedMtaLocation;\n-    protected String namespace;\n-    protected boolean applyNamespace;\n-    private ModulesCloudModelBuilderContentCalculator modulesCalculator;\n-    protected ModuleToDeployHelper moduleToDeployHelper;\n-    protected ResourcesCloudModelBuilderContentCalculator resourcesCalculator;\n-\n-    protected ApplicationCloudModelBuilder appBuilder;\n-    protected ServicesCloudModelBuilder servicesBuilder;\n-\n-    public static Stream<Arguments> getParameters() {\n-        return Stream.of(\n+\tprotected static final String DEFAULT_DOMAIN_CF = \"cfapps.neo.ondemand.com\";", "originalCommit": "b580b042a3b612a04bd547169e6734537ee8803e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg3ODQwMQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r516878401", "bodyText": "no, mistake when switching workspaces", "author": "ikasarov", "createdAt": "2020-11-03T18:39:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTkzODgxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTk0ODkxNA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r515948914", "bodyText": "You can use Map.of instead of new HashMap() {}", "author": "theghost5800", "createdAt": "2020-11-02T12:50:12Z", "path": "multiapps-controller-core/src/test/java/org/cloudfoundry/multiapps/controller/core/util/ApplicationURITest.java", "diffHunk": "@@ -11,68 +13,88 @@\n import org.junit.jupiter.params.provider.Arguments;\n import org.junit.jupiter.params.provider.MethodSource;\n \n-import com.sap.cloudfoundry.client.facade.domain.CloudDomain;\n-import com.sap.cloudfoundry.client.facade.domain.CloudRoute;\n-import com.sap.cloudfoundry.client.facade.domain.ImmutableCloudDomain;\n-import com.sap.cloudfoundry.client.facade.domain.ImmutableCloudRoute;\n+import com.sap.cloudfoundry.client.facade.domain.CloudRouteSummary;\n \n class ApplicationURITest {\n \n     private static final String CUSTOM = \"custom-\";\n \n-    static Stream<Arguments> testParameters() {\n-        return Stream.of(Arguments.of(\"https://valid-host.valid-domain\", \"valid-host\", \"valid-domain\", \"\"),\n-                         Arguments.of(\"https://valid-domain\", \"\", \"valid-domain\", \"\"), Arguments.of(\"valid-domain\", \"\", \"valid-domain\", \"\"),\n-                         Arguments.of(\"https://valid-domain/really/long/path\", \"\", \"valid-domain\", \"/really/long/path\"),\n-                         Arguments.of(\"https://valid-host.valid-domain/really/long/path\", \"valid-host\", \"valid-domain\",\n+    static Stream<Arguments> testGetHostDomainPath() {\n+        return Stream.of(Arguments.of(\"https://valid-host.valid-domain\", false, \"valid-host\", \"valid-domain\", \"\"),\n+                         Arguments.of(\"https://valid-domain\", false, \"\", \"valid-domain\", \"\"),\n+                         Arguments.of(\"valid-domain\", true, \"\", \"valid-domain\", \"\"),\n+                         Arguments.of(\"https://valid-domain/really/long/path\", false, \"\", \"valid-domain\", \"/really/long/path\"),\n+                         Arguments.of(\"https://valid-host.valid-domain/really/long/path\", false, \"valid-host\", \"valid-domain\",\n                                       \"/really/long/path\"),\n-                         Arguments.of(\"deploy-service.cfapps.industrycloud-staging.siemens.com\", \"deploy-service\",\n-                                      \"cfapps.industrycloud-staging.siemens.com\", \"\"));\n+                         Arguments.of(\"deploy-service.cfapps.industrycloud-staging.siemens.com\", false, \"deploy-service\",\n+                                      \"cfapps.industrycloud-staging.siemens.com\", \"\"),\n+                         Arguments.of(\"everything.is.in.domain/and/path\", true, \"\", \"everything.is.in.domain\", \"/and/path\"));\n     }\n \n     @ParameterizedTest\n-    @MethodSource(\"testParameters\")\n-    void testGetHostDomainPath(String uri, String expectedHost, String expectedDomain, String expectedPath) {\n-        ApplicationURI applicationURI = new ApplicationURI(uri);\n+    @MethodSource\n+    void testGetHostDomainPath(String uri, boolean noHostname, String expectedHost, String expectedDomain, String expectedPath) {\n+        ApplicationURI applicationURI = new ApplicationURI(uri, noHostname);\n         Assertions.assertEquals(expectedHost, applicationURI.getHost());\n         Assertions.assertEquals(expectedDomain, applicationURI.getDomain());\n         Assertions.assertEquals(expectedPath, applicationURI.getPath());\n     }\n \n+    @SuppressWarnings(\"serial\")\n+    static Stream<Arguments> testGetURIParts() {\n+        return Stream.of(Arguments.of(\"host\", \"domain.com\", \"/path\", new HashMap<String, Object>() {\n+            {\n+                put(SupportedParameters.HOST, \"host\");", "originalCommit": "b580b042a3b612a04bd547169e6734537ee8803e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTk1NTExNg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r515955116", "bodyText": "So we cannot keep only one TestData class in util or process package?", "author": "theghost5800", "createdAt": "2020-11-02T13:01:22Z", "path": "multiapps-controller-core/src/test/java/org/cloudfoundry/multiapps/controller/core/util/TestData.java", "diffHunk": "@@ -0,0 +1,96 @@\n+package org.cloudfoundry.multiapps.controller.core.util;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.cloudfoundry.multiapps.controller.core.model.SupportedParameters;\n+\n+import com.sap.cloudfoundry.client.facade.domain.CloudRouteSummary;\n+import com.sap.cloudfoundry.client.facade.domain.ImmutableCloudRouteSummary;\n+\n+//TODO: this class repeats code from test class org.cloudfoundry.multiapps.controller.process.steps.TestData; consolidate if we refactor core module and stplit ApplicationUri out of it", "originalCommit": "b580b042a3b612a04bd547169e6734537ee8803e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg4MTQ4NA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r516881484", "bodyText": "no, since we do not want to export a test jar to share the classes", "author": "ikasarov", "createdAt": "2020-11-03T18:44:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTk1NTExNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTk1OTExNA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r515959114", "bodyText": "You can use Map.of with short if statement", "author": "theghost5800", "createdAt": "2020-11-02T13:08:34Z", "path": "multiapps-controller-core/src/test/java/org/cloudfoundry/multiapps/controller/core/validators/parameters/RouteValidatorTest.java", "diffHunk": "@@ -19,36 +25,58 @@\n     static Stream<Arguments> getParameters() {\n         return Stream.of(\n // @formatter:off\n-            // [0]\n-            Arguments.of(\"valid-host.domain\", true, \"valid-host.domain\", null),\n             // [1]\n-            Arguments.of(\"should_correct$this$host.domain\", false, \"should-correct-this-host.domain\", null),\n+            Arguments.of(\"valid-host.domain\", null, true, \"valid-host.domain\", null),\n             // [2]\n-            Arguments.of(\"host_can_be_corrected.domain.com\", false, \"host-can-be-corrected.domain.com\", null)\n+            Arguments.of(\"should_correct$this$host.domain\", null, false, \"should-correct-this-host.domain\", null),\n+            // [3]\n+            Arguments.of(\"host_can_be_corrected.domain.com\", Boolean.FALSE, false, \"host-can-be-corrected.domain.com\", null),\n+            // [4]\n+            Arguments.of(\"doesnt.matter.com\", 1, false, null, MessageFormat.format(Messages.COULD_NOT_PARSE_BOOLEAN_FLAG, SupportedParameters.NO_HOSTNAME)),\n+            // [5]\n+            Arguments.of(\"domain_can_be_corrected.com\", Boolean.TRUE, false, \"domain-can-be-corrected.com\", null)\n // @formatter:on\n         );\n     }\n \n     @ParameterizedTest\n     @MethodSource(\"getParameters\")\n-    void testValidate(String inputRoute, boolean isValid, String correctedRoute, String expectedException) {\n-        assertEquals(isValid, validator.isValid(inputRoute, null));\n+    void testValidate(String inputRoute, Object noHostname, boolean isValid, String correctedRoute, String expectedException) {\n+        Map<String, Object> routeContext = constructContext(noHostname);\n+        try {\n+            assertEquals(isValid, validator.isValid(inputRoute, routeContext));\n+            assertNull(expectedException, \"Expected an exception but test passed!\");\n+        } catch (Exception e) {\n+            assertNotNull(expectedException, \"Didn't expect an exception, but got \" + e.getMessage());\n+            assertEquals(expectedException, e.getMessage(), \"Exception's message doesn't match up!\");\n+        }\n     }\n \n     @ParameterizedTest\n     @MethodSource(\"getParameters\")\n-    void testAttemptToCorrect(String inputRoute, boolean isValid, String correctedRoute, String expectedException) {\n+    void testAttemptToCorrect(String inputRoute, Object noHostname, boolean isValid, String correctedRoute, String expectedException) {\n         if (!validator.canCorrect())\n             return;\n         try {\n-            String result = validator.attemptToCorrect(inputRoute, null);\n+            Map<String, Object> routeContext = constructContext(noHostname);\n+            String result = validator.attemptToCorrect(inputRoute, routeContext);\n+            assertNull(expectedException, \"Expected an exception but test passed!\");\n             assertEquals(correctedRoute, result);\n         } catch (Exception e) {\n-            assertNotNull(e.getMessage(), expectedException);\n-            assertEquals(\"Exception's message doesn't match up!\", e.getMessage(), expectedException);\n+            assertNotNull(expectedException, \"Didn't expect an exception, but got \" + e.getMessage());\n+            assertEquals(expectedException, e.getMessage(), \"Exception's message doesn't match up!\");\n         }\n     }\n \n+    private Map<String, Object> constructContext(Object noHostname) {\n+        Map<String, Object> context = new HashMap<>();", "originalCommit": "b580b042a3b612a04bd547169e6734537ee8803e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTk3ODA2MQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r515978061", "bodyText": "I didn't see where is used java.util.stream.Collectors and StringUtils imports", "author": "theghost5800", "createdAt": "2020-11-02T13:41:29Z", "path": "multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/BuildApplicationDeployModelStep.java", "diffHunk": "@@ -3,10 +3,14 @@\n import java.util.Collections;\n import java.util.List;\n import java.util.Map;\n+import java.util.Set;\n+import java.util.stream.Collectors;", "originalCommit": "b580b042a3b612a04bd547169e6734537ee8803e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTk4MjcwNA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r515982704", "bodyText": "CloudRouteSummary as far as I remember it has toString() imeplemented. So you can just pass the object itself and it will be printed", "author": "theghost5800", "createdAt": "2020-11-02T13:49:34Z", "path": "multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/DeleteIdleRoutesStep.java", "diffHunk": "@@ -44,30 +45,31 @@ protected String getStepErrorMessage(ProcessContext context) {\n     }\n \n     private void deleteIdleRoutes(CloudApplication idleApp, CloudControllerClient client, CloudApplication newLiveApp) {\n-        List<String> idleUris = ListUtils.subtract(idleApp.getUris(), newLiveApp.getUris());\n-        getStepLogger().debug(Messages.IDLE_URIS_FOR_APPLICATION, idleUris);\n+        Set<CloudRouteSummary> idleRoutes = SetUtils.difference(idleApp.getRoutes(), newLiveApp.getRoutes())\n+                                                    .toSet();\n+        getStepLogger().debug(Messages.IDLE_URIS_FOR_APPLICATION, idleRoutes);\n \n-        for (String idleUri : idleUris) {\n-            deleteRoute(idleUri, client);\n-            getStepLogger().debug(Messages.ROUTE_DELETED, idleUri);\n+        for (CloudRouteSummary idleRoute : idleRoutes) {\n+            deleteRoute(idleRoute, client);\n+            getStepLogger().debug(Messages.ROUTE_DELETED, idleRoute.toUriString());", "originalCommit": "b580b042a3b612a04bd547169e6734537ee8803e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg4MzQyNQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r516883425", "bodyText": "intentionally used this method, to make it more clear that we're doing custom string formatting (i.e. concat with '.')", "author": "ikasarov", "createdAt": "2020-11-03T18:48:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTk4MjcwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTk4OTk4Mw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r515989983", "bodyText": "Previously this will result in List with duplicated old elements in result list, is it right?", "author": "theghost5800", "createdAt": "2020-11-02T14:00:58Z", "path": "multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/util/ElementUpdater.java", "diffHunk": "@@ -30,7 +39,14 @@\n \n         @Override\n         public <T> List<T> updateList(List<T> oldList, List<T> newList) {\n-            return ListUtils.union(oldList, newList);\n+            List<T> newPartsOnly = ListUtils.subtract(newList, oldList);\n+            return ListUtils.union(oldList, newPartsOnly);", "originalCommit": "b580b042a3b612a04bd547169e6734537ee8803e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg4MzkyOA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r516883928", "bodyText": "yes, this was a defect previously; thankfully we also didn't have a real case which would've used this code", "author": "ikasarov", "createdAt": "2020-11-03T18:49:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTk4OTk4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTk5NDM5NA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r515994394", "bodyText": "There is some issue with spaces, maybe there is tabs instead of spaces", "author": "theghost5800", "createdAt": "2020-11-02T14:07:32Z", "path": "multiapps-controller-process/src/test/java/org/cloudfoundry/multiapps/controller/process/steps/DeleteApplicationRoutesStepTest.java", "diffHunk": "@@ -67,7 +67,7 @@ private void assertRoutesWereDeleted() {\n         assertEquals(0, routesToDeleteCount, \"A number of routes were not deleted: \");\n     }\n \n-    @Test\n+\t@Test", "originalCommit": "b580b042a3b612a04bd547169e6734537ee8803e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE4MzgxNA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r517183814", "bodyText": "Rename IdleUriParametersParser to IdleRouteParametersParser", "author": "theghost5800", "createdAt": "2020-11-04T08:53:08Z", "path": "multiapps-controller-core/src/main/java/org/cloudfoundry/multiapps/controller/core/parser/IdleUriParametersParser.java", "diffHunk": "@@ -16,7 +16,7 @@\n import org.cloudfoundry.multiapps.controller.core.validators.parameters.RoutesValidator;\n import org.cloudfoundry.multiapps.mta.util.PropertiesUtil;\n \n-public class IdleUriParametersParser extends UriParametersParser {\n+public class IdleUriParametersParser extends RouteParametersParser {", "originalCommit": "df4cdbbdb25e8110199178bb731a8246e608e7aa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE4NjIxNw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/982#discussion_r517186217", "bodyText": "If you don't add entries in the map after that, you can return Collections.emptyMap()", "author": "theghost5800", "createdAt": "2020-11-04T08:57:03Z", "path": "multiapps-controller-core/src/test/java/org/cloudfoundry/multiapps/controller/core/validators/parameters/RouteValidatorTest.java", "diffHunk": "@@ -69,12 +69,11 @@ void testAttemptToCorrect(String inputRoute, Object noHostname, boolean isValid,\n     }\n \n     private Map<String, Object> constructContext(Object noHostname) {\n-        Map<String, Object> context = new HashMap<>();\n-        if (noHostname != null) {\n-            context.put(SupportedParameters.NO_HOSTNAME, noHostname);\n+        if (noHostname == null) {\n+            return new HashMap<>();", "originalCommit": "df4cdbbdb25e8110199178bb731a8246e608e7aa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "08431987923db8d49eb7a6764d7bbd75932735df", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/08431987923db8d49eb7a6764d7bbd75932735df", "message": "routes are no longer handled as strings", "committedDate": "2020-11-04T12:06:43Z", "type": "commit"}, {"oid": "1ac92fa8de10ed766b2be661f5a54f12bbd0f4dd", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/1ac92fa8de10ed766b2be661f5a54f12bbd0f4dd", "message": "fixing junit tests", "committedDate": "2020-11-04T12:06:44Z", "type": "commit"}, {"oid": "b93f27512f86d2c2de3777f9366c19c16bcf07dd", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/b93f27512f86d2c2de3777f9366c19c16bcf07dd", "message": "deleted unused test files", "committedDate": "2020-11-04T12:06:44Z", "type": "commit"}, {"oid": "b93f27512f86d2c2de3777f9366c19c16bcf07dd", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/b93f27512f86d2c2de3777f9366c19c16bcf07dd", "message": "deleted unused test files", "committedDate": "2020-11-04T12:06:44Z", "type": "forcePushed"}]}