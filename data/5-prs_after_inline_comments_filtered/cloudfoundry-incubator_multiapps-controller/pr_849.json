{"pr_number": 849, "pr_title": "Namespace changes DO NOT MERGE", "pr_createdAt": "2020-04-29T16:48:53Z", "pr_url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTM4MDAzNg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419380036", "bodyText": "Rename it to MTA_NAME to be self-explaining", "author": "boyan-velinov", "createdAt": "2020-05-04T11:51:03Z", "path": "com.sap.cloud.lm.sl.cf.api/src/main/java/com/sap/cloud/lm/sl/cf/web/api/Constants.java", "diffHunk": "@@ -23,6 +23,8 @@ private RequestVariables() {\n         }\n \n         public static final String MTA_ID = \"mtaId\";\n+        public static final String NAMESPACE = \"namespace\";\n+        public static final String V2_NAME = \"name\";", "originalCommit": "88a5c26a7f715076fa572f9d8381cb51646ae7aa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTM4MjIxMQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419382211", "bodyText": "I would rename it to MTAS_V2 because sounds more naturally.\nOr event prepare two constants ROOT_v2 = \"/api/v2\" and MTAS_V2 =  ROOT_V2 + \"spaces/{\" + PathVariables.SPACE_GUID + \"}/mtas\";", "author": "boyan-velinov", "createdAt": "2020-05-04T11:55:43Z", "path": "com.sap.cloud.lm.sl.cf.api/src/main/java/com/sap/cloud/lm/sl/cf/web/api/Constants.java", "diffHunk": "@@ -60,6 +62,7 @@ private Endpoints() {\n         public static final String OPERATION_LOGS = OPERATION + \"/logs\";\n         public static final String OPERATION_LOG_CONTENT = OPERATION_LOGS + \"/{\" + PathVariables.LOG_ID + \"}/content\";\n         public static final String OPERATION_ACTIONS = OPERATION + \"/actions\";\n+        public static final String V2_MTAS = \"/api/v2/spaces/{\" + PathVariables.SPACE_GUID + \"}/mtas\";", "originalCommit": "88a5c26a7f715076fa572f9d8381cb51646ae7aa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTM5MTEwNA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419391104", "bodyText": "Let's add that extension descriptor is also uploaded from here, e.g.\nUploads an Multi Target Application archive or an Extension Descriptor", "author": "boyan-velinov", "createdAt": "2020-05-04T12:13:48Z", "path": "com.sap.cloud.lm.sl.cf.api/src/main/java/com/sap/cloud/lm/sl/cf/web/api/FilesApi.java", "diffHunk": "@@ -32,24 +35,28 @@\n     private FilesApiService delegate;\n \n     @GetMapping(produces = { MediaType.APPLICATION_JSON_VALUE, MediaType.APPLICATION_JSON_UTF8_VALUE })\n-    @ApiOperation(value = \"\", notes = \"Retrieves all Multi-Target Application files \", response = FileMetadata.class, responseContainer = \"List\", authorizations = {\n+    @ApiOperation(value = \"\", nickname = \"getMtaFiles\", notes = \"Retrieves all Multi-Target Application files \", response = FileMetadata.class, responseContainer = \"List\", authorizations = {\n         @Authorization(value = \"oauth2\", scopes = {\n \n         }) }, tags = {})\n     @ApiResponses(value = { @ApiResponse(code = 200, message = \"OK\", response = FileMetadata.class, responseContainer = \"List\") })\n-    public ResponseEntity<List<FileMetadata>> getFiles(@PathVariable(PathVariables.SPACE_GUID) String spaceGuid) {\n-        return delegate.getFiles(spaceGuid);\n+    public ResponseEntity<List<FileMetadata>>\n+           getFiles(@PathVariable(PathVariables.SPACE_GUID) String spaceGuid,\n+                    @ApiParam(value = \"Filter mtas by namespace\") @RequestParam(name = RequestVariables.NAMESPACE, required = false) String namespace) {\n+        return delegate.getFiles(spaceGuid, namespace);\n     }\n \n     @PostMapping(consumes = MediaType.MULTIPART_FORM_DATA_VALUE, produces = { MediaType.APPLICATION_JSON_VALUE,\n         MediaType.APPLICATION_JSON_UTF8_VALUE })\n-    @ApiOperation(value = \"\", notes = \"Uploads an Multi Target Application file \", response = FileMetadata.class, authorizations = {\n+    @ApiOperation(value = \"\", nickname = \"uploadMtaFile\", notes = \"Uploads an Multi Target Application file \", response = FileMetadata.class, authorizations = {", "originalCommit": "88a5c26a7f715076fa572f9d8381cb51646ae7aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQzMDAwNA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424430004", "bodyText": "This API should not know about MTARs or extension descriptors. \"uploadFile\" should be sufficient.", "author": "nictas", "createdAt": "2020-05-13T13:19:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTM5MTEwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQwOTYyNA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419409624", "bodyText": "Do we need to print nid \"MTA\" at all?\nthis is some internal logic that can be deleted at some moment.", "author": "boyan-velinov", "createdAt": "2020-05-04T12:48:10Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/Messages.java", "diffHunk": "@@ -30,9 +30,10 @@\n     public static final String COULD_NOT_CREATE_VALID_APPLICATION_NAME_FROM_0 = \"Could not create a valid application name from \\\"{0}\\\"\";\r\n     public static final String COULD_NOT_CREATE_VALID_SERVICE_NAME_FROM_0 = \"Could not create a valid service name from \\\"{0}\\\"\";\r\n     public static final String COULD_NOT_PARSE_ROUTE = \"Cannot parse 'routes' property - check documentation for correct format.\";\r\n+    public static final String COULD_NOT_PARSE_BOOLEAN_FLAG = \"Cannot parse \\\"{0}\\\" flag - expected a boolean format.\";\r\n     public static final String COULD_NOT_CREATE_VALID_ROUTE_NESTED_EXCEPTION = \"Invalid route \\\"{0}\\\" : {1}\";\r\n     public static final String CANNOT_CORRECT_PARAMETER = \"Value for parameter \\\"{0}\\\" is not valid and cannot be corrected\";\r\n-    public static final String CONFIGURATION_ENTRY_ALREADY_EXISTS = \"Configuration entry with namespace ID \\\"{0}\\\", ID \\\"{1}\\\", version \\\"{2}\\\", target org \\\"{3}\\\" and target space \\\"{4}\\\", already exists\";\r\n+    public static final String CONFIGURATION_ENTRY_ALREADY_EXISTS = \"Configuration entry with nid \\\"{0}\\\", ID \\\"{1}\\\", version \\\"{2}\\\", namespace \\\"{3}\\\", target org \\\"{4}\\\" and target space \\\"{5}\\\", already exists\";\r", "originalCommit": "88a5c26a7f715076fa572f9d8381cb51646ae7aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ5MTI5Mw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419491293", "bodyText": "Then we could remove it from the message then as well. I feel it is a bit clearer if we print both at this point since the names are so close - to avoid any mix-ups.", "author": "ikasarov", "createdAt": "2020-05-04T14:45:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQwOTYyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg5NjQyOA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419896428", "bodyText": "If it does not appear in console output it is ok to stay as it is.", "author": "boyan-velinov", "createdAt": "2020-05-05T06:48:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQwOTYyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI4Njg0Nw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419286847", "bodyText": "What was the agreement to reuse one mtar in different namespaces?", "author": "theghost5800", "createdAt": "2020-05-04T08:37:50Z", "path": "com.sap.cloud.lm.sl.cf.api/src/main/java/com/sap/cloud/lm/sl/cf/web/api/FilesApiService.java", "diffHunk": "@@ -10,8 +10,8 @@\n \n public interface FilesApiService {\n \n-    ResponseEntity<List<FileMetadata>> getFiles(String spaceGuid);\n+    ResponseEntity<List<FileMetadata>> getFiles(String spaceGuid, String namespace);\n \n-    ResponseEntity<FileMetadata> uploadFile(HttpServletRequest request, String spaceGuid);\n+    ResponseEntity<FileMetadata> uploadFile(HttpServletRequest request, String spaceGuid, String namespace);", "originalCommit": "88a5c26a7f715076fa572f9d8381cb51646ae7aa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI5MDMxNQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419290315", "bodyText": "Why we need Path Variable parameter spaceGuid? I don't see usage of this parameter in the metod.", "author": "theghost5800", "createdAt": "2020-05-04T08:44:29Z", "path": "com.sap.cloud.lm.sl.cf.api/src/main/java/com/sap/cloud/lm/sl/cf/web/api/InfoApi.java", "diffHunk": "@@ -31,7 +32,7 @@\n \n         }) }, tags = {})\n     @ApiResponses(value = { @ApiResponse(code = 200, message = \"OK\", response = Info.class) })\n-    public ResponseEntity<Info> getInfo() {\n+    public ResponseEntity<Info> getInfo(@PathVariable(\"spaceGuid\") String spaceGuid) {", "originalCommit": "88a5c26a7f715076fa572f9d8381cb51646ae7aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzc5NzE1OA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r423797158", "bodyText": "Probably an error while fixing the swagger file, removed it.", "author": "ikasarov", "createdAt": "2020-05-12T14:51:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI5MDMxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMwNTgxOQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419305819", "bodyText": "Missing ApiParam annotation for mtaId", "author": "theghost5800", "createdAt": "2020-05-04T09:14:26Z", "path": "com.sap.cloud.lm.sl.cf.api/src/main/java/com/sap/cloud/lm/sl/cf/web/api/MtasApi.java", "diffHunk": "@@ -37,7 +38,7 @@\n \n         }) }, tags = {})\n     @ApiResponses(value = { @ApiResponse(code = 200, message = \"OK\", response = Mta.class) })\n-    public ResponseEntity<Mta> getMta(@PathVariable(PathVariables.SPACE_GUID) String spaceGuid,\n+    public ResponseEntity<Mta> getMta(@ApiParam(value = \"GUID of space with mtas\") @PathVariable(PathVariables.SPACE_GUID) String spaceGuid,\n                                       @PathVariable(RequestVariables.MTA_ID) String mtaId) {", "originalCommit": "88a5c26a7f715076fa572f9d8381cb51646ae7aa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMwNjUyNg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419306526", "bodyText": "missing ApiParam for spaceGuid", "author": "theghost5800", "createdAt": "2020-05-04T09:15:52Z", "path": "com.sap.cloud.lm.sl.cf.api/src/main/java/com/sap/cloud/lm/sl/cf/web/api/FilesApi.java", "diffHunk": "@@ -32,24 +35,28 @@\n     private FilesApiService delegate;\n \n     @GetMapping(produces = { MediaType.APPLICATION_JSON_VALUE, MediaType.APPLICATION_JSON_UTF8_VALUE })\n-    @ApiOperation(value = \"\", notes = \"Retrieves all Multi-Target Application files \", response = FileMetadata.class, responseContainer = \"List\", authorizations = {\n+    @ApiOperation(value = \"\", nickname = \"getMtaFiles\", notes = \"Retrieves all Multi-Target Application files \", response = FileMetadata.class, responseContainer = \"List\", authorizations = {\n         @Authorization(value = \"oauth2\", scopes = {\n \n         }) }, tags = {})\n     @ApiResponses(value = { @ApiResponse(code = 200, message = \"OK\", response = FileMetadata.class, responseContainer = \"List\") })\n-    public ResponseEntity<List<FileMetadata>> getFiles(@PathVariable(PathVariables.SPACE_GUID) String spaceGuid) {\n-        return delegate.getFiles(spaceGuid);\n+    public ResponseEntity<List<FileMetadata>>\n+           getFiles(@PathVariable(PathVariables.SPACE_GUID) String spaceGuid,", "originalCommit": "88a5c26a7f715076fa572f9d8381cb51646ae7aa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMwNjkwNQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419306905", "bodyText": "same comment", "author": "theghost5800", "createdAt": "2020-05-04T09:16:33Z", "path": "com.sap.cloud.lm.sl.cf.api/src/main/java/com/sap/cloud/lm/sl/cf/web/api/FilesApi.java", "diffHunk": "@@ -32,24 +35,28 @@\n     private FilesApiService delegate;\n \n     @GetMapping(produces = { MediaType.APPLICATION_JSON_VALUE, MediaType.APPLICATION_JSON_UTF8_VALUE })\n-    @ApiOperation(value = \"\", notes = \"Retrieves all Multi-Target Application files \", response = FileMetadata.class, responseContainer = \"List\", authorizations = {\n+    @ApiOperation(value = \"\", nickname = \"getMtaFiles\", notes = \"Retrieves all Multi-Target Application files \", response = FileMetadata.class, responseContainer = \"List\", authorizations = {\n         @Authorization(value = \"oauth2\", scopes = {\n \n         }) }, tags = {})\n     @ApiResponses(value = { @ApiResponse(code = 200, message = \"OK\", response = FileMetadata.class, responseContainer = \"List\") })\n-    public ResponseEntity<List<FileMetadata>> getFiles(@PathVariable(PathVariables.SPACE_GUID) String spaceGuid) {\n-        return delegate.getFiles(spaceGuid);\n+    public ResponseEntity<List<FileMetadata>>\n+           getFiles(@PathVariable(PathVariables.SPACE_GUID) String spaceGuid,\n+                    @ApiParam(value = \"Filter mtas by namespace\") @RequestParam(name = RequestVariables.NAMESPACE, required = false) String namespace) {\n+        return delegate.getFiles(spaceGuid, namespace);\n     }\n \n     @PostMapping(consumes = MediaType.MULTIPART_FORM_DATA_VALUE, produces = { MediaType.APPLICATION_JSON_VALUE,\n         MediaType.APPLICATION_JSON_UTF8_VALUE })\n-    @ApiOperation(value = \"\", notes = \"Uploads an Multi Target Application file \", response = FileMetadata.class, authorizations = {\n+    @ApiOperation(value = \"\", nickname = \"uploadMtaFile\", notes = \"Uploads an Multi Target Application file \", response = FileMetadata.class, authorizations = {\n         @Authorization(value = \"oauth2\", scopes = {\n \n         }) }, tags = {})\n     @ApiResponses(value = { @ApiResponse(code = 201, message = \"Created\", response = FileMetadata.class) })\n-    public ResponseEntity<FileMetadata> uploadFile(HttpServletRequest request, @PathVariable(PathVariables.SPACE_GUID) String spaceGuid) {\n-        return delegate.uploadFile(request, spaceGuid);\n+    public ResponseEntity<FileMetadata>\n+           uploadFile(HttpServletRequest request, @PathVariable(PathVariables.SPACE_GUID) String spaceGuid,", "originalCommit": "88a5c26a7f715076fa572f9d8381cb51646ae7aa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMwODk1MA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419308950", "bodyText": "In the old api(v1) it wouldn't possible to get mta by namespace, right?", "author": "theghost5800", "createdAt": "2020-05-04T09:20:34Z", "path": "com.sap.cloud.lm.sl.cf.api/src/main/java/com/sap/cloud/lm/sl/cf/web/api/MtasApiService.java", "diffHunk": "@@ -12,4 +12,6 @@\n \n     ResponseEntity<Mta> getMta(String spaceGuid, String mtaId);", "originalCommit": "88a5c26a7f715076fa572f9d8381cb51646ae7aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzgwMTU5MA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r423801590", "bodyText": "yes", "author": "ikasarov", "createdAt": "2020-05-12T14:56:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMwODk1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMxMTMwNQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419311305", "bodyText": "Why this property should be hidden in API documentation?", "author": "theghost5800", "createdAt": "2020-05-04T09:25:10Z", "path": "com.sap.cloud.lm.sl.cf.api/src/main/java/com/sap/cloud/lm/sl/cf/web/api/model/FileMetadata.java", "diffHunk": "@@ -52,23 +53,32 @@\n     public abstract String getSpace();\n \n     @Override\n+    @ApiModelProperty(hidden = true)\n     public String getConfigurationType() {\n         return \"file metadata\";\n     }\n \n     @Override\n+    @ApiModelProperty(hidden = true)", "originalCommit": "88a5c26a7f715076fa572f9d8381cb51646ae7aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQzMTMwNw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424431307", "bodyText": "It's only used for audit-logging. It shouldn't be included in the response.", "author": "nictas", "createdAt": "2020-05-13T13:20:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMxMTMwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMxODE1MQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419318151", "bodyText": "What is the difference between \"nid\" and \"namespace\"?", "author": "theghost5800", "createdAt": "2020-05-04T09:38:07Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/Messages.java", "diffHunk": "@@ -30,9 +30,10 @@\n     public static final String COULD_NOT_CREATE_VALID_APPLICATION_NAME_FROM_0 = \"Could not create a valid application name from \\\"{0}\\\"\";\r\n     public static final String COULD_NOT_CREATE_VALID_SERVICE_NAME_FROM_0 = \"Could not create a valid service name from \\\"{0}\\\"\";\r\n     public static final String COULD_NOT_PARSE_ROUTE = \"Cannot parse 'routes' property - check documentation for correct format.\";\r\n+    public static final String COULD_NOT_PARSE_BOOLEAN_FLAG = \"Cannot parse \\\"{0}\\\" flag - expected a boolean format.\";\r\n     public static final String COULD_NOT_CREATE_VALID_ROUTE_NESTED_EXCEPTION = \"Invalid route \\\"{0}\\\" : {1}\";\r\n     public static final String CANNOT_CORRECT_PARAMETER = \"Value for parameter \\\"{0}\\\" is not valid and cannot be corrected\";\r\n-    public static final String CONFIGURATION_ENTRY_ALREADY_EXISTS = \"Configuration entry with namespace ID \\\"{0}\\\", ID \\\"{1}\\\", version \\\"{2}\\\", target org \\\"{3}\\\" and target space \\\"{4}\\\", already exists\";\r\n+    public static final String CONFIGURATION_ENTRY_ALREADY_EXISTS = \"Configuration entry with nid \\\"{0}\\\", ID \\\"{1}\\\", version \\\"{2}\\\", namespace \\\"{3}\\\", target org \\\"{4}\\\" and target space \\\"{5}\\\", already exists\";\r", "originalCommit": "88a5c26a7f715076fa572f9d8381cb51646ae7aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYyNTA5NQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424625095", "bodyText": "nid is an older parameter, was set to 'mta' by default. Keeping it as is to avoid migrating db data", "author": "ikasarov", "createdAt": "2020-05-13T17:54:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMxODE1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ2MzM1Ng==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419463356", "bodyText": "Why we always return first element of list? If we go through flow where we get deployed mta by env and combine both lists, it will result in list with 2 elements, then which will be the right one?", "author": "theghost5800", "createdAt": "2020-05-04T14:07:19Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/detect/DeployedMtaDetector.java", "diffHunk": "@@ -32,13 +33,73 @@\n     private DeployedMtaEnvDetector deployedMtaEnvDetector;\n \n     public List<DeployedMta> detectDeployedMtas(CloudControllerClient client) {\n+        MtaMetadataCriteria allMtasCriteria = MtaMetadataCriteriaBuilder.builder()\n+                                                                        .label(MtaMetadataLabels.MTA_ID)\n+                                                                        .exists()\n+                                                                        .build();\n+        List<DeployedMta> deployedMtas = getDeployedMtasByMetadataSelectionCriteria(allMtasCriteria, client);\n+        List<DeployedMta> deployedMtasByEnv = deployedMtaEnvDetector.detectDeployedMtas(client);\n+\n+        return combineMetadataAndEnvMtas(deployedMtas, deployedMtasByEnv);\n+    }\n+\n+    public List<DeployedMta> detectDeployedMtasWithoutNamespace(CloudControllerClient client) {\n+        MtaMetadataCriteria mtasWithoutNamespaceCriteria = MtaMetadataCriteriaBuilder.builder()\n+                                                                                     .label(MtaMetadataLabels.MTA_ID)\n+                                                                                     .exists()\n+                                                                                     .and()\n+                                                                                     .label(MtaMetadataLabels.MTA_NAMESPACE)\n+                                                                                     .doesNotExist()\n+                                                                                     .build();\n+        List<DeployedMta> deployedMtas = getDeployedMtasByMetadataSelectionCriteria(mtasWithoutNamespaceCriteria, client);\n+        List<DeployedMta> deployedMtasByEnv = deployedMtaEnvDetector.detectDeployedMtasWithoutNamespace(client);\n+\n+        return combineMetadataAndEnvMtas(deployedMtas, deployedMtasByEnv);\n+    }\n+\n+    public List<DeployedMta> detectDeployedMtasByName(String mtaName, CloudControllerClient client) {\n+        MtaMetadataCriteria selectionCriteria = MtaMetadataCriteriaBuilder.builder()\n+                                                                          .label(MtaMetadataLabels.MTA_ID)\n+                                                                          .hasValue(MtaMetadataUtil.getHashedLabel(mtaName))\n+                                                                          .build();\n+        List<DeployedMta> deployedMtas = getDeployedMtasByMetadataSelectionCriteria(selectionCriteria, client);\n+        List<DeployedMta> deployedMtasByEnv = deployedMtaEnvDetector.detectDeployedMta(mtaName, client);\n+\n+        return combineMetadataAndEnvMtas(deployedMtas, deployedMtasByEnv);\n+    }\n+\n+    public List<DeployedMta> detectDeployedMtasByNamespace(String mtaNamespace, CloudControllerClient client) {\n         MtaMetadataCriteria selectionCriteria = MtaMetadataCriteriaBuilder.builder()\n                                                                           .label(MtaMetadataLabels.MTA_ID)\n                                                                           .exists()\n+                                                                          .and()\n+                                                                          .label(MtaMetadataLabels.MTA_NAMESPACE)\n+                                                                          .hasValueOrIsntPresent(MtaMetadataUtil.getHashedLabel(mtaNamespace))\n+                                                                          .build();\n+\n+        return getDeployedMtasByMetadataSelectionCriteria(selectionCriteria, client);\n+    }\n+\n+    public Optional<DeployedMta> detectDeployedMtaByNameAndNamespace(String mtaName, String mtaNamespace, CloudControllerClient client,\n+                                                                     boolean envDetectionEnabled) {\n+        MtaMetadataCriteria selectionCriteria = MtaMetadataCriteriaBuilder.builder()\n+                                                                          .label(MtaMetadataLabels.MTA_ID)\n+                                                                          .hasValue(MtaMetadataUtil.getHashedLabel(mtaName))\n+                                                                          .and()\n+                                                                          .label(MtaMetadataLabels.MTA_NAMESPACE)\n+                                                                          .hasValueOrIsntPresent(MtaMetadataUtil.getHashedLabel(mtaNamespace))\n                                                                           .build();\n+\n         List<DeployedMta> deployedMtas = getDeployedMtasByMetadataSelectionCriteria(selectionCriteria, client);\n-        List<DeployedMta> deployedMtasByEnv = getDeployedMtasByEnv(client, deployedMtas);\n-        return ListUtils.union(deployedMtas, deployedMtasByEnv);\n+\n+        if (StringUtils.isEmpty(mtaNamespace) && envDetectionEnabled) {\n+            // no need to check by env if namespace was provided - that guarantees mta has metadata\n+            List<DeployedMta> deployedMtasByEnv = deployedMtaEnvDetector.detectDeployedMta(mtaName, client);\n+            deployedMtas = combineMetadataAndEnvMtas(deployedMtas, deployedMtasByEnv);\n+        }\n+\n+        return deployedMtas.stream()", "originalCommit": "88a5c26a7f715076fa572f9d8381cb51646ae7aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDUzNzQ0MA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424537440", "bodyText": "the pair of (mtaId, namespace) is unique so this shouldn't be an issue, but I agree that the code is confusing here", "author": "ikasarov", "createdAt": "2020-05-13T15:39:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ2MzM1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ2NTI0Nw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419465247", "bodyText": "This is little bit confusing, we are looking for single element and return list. Decide to return single element or rename method name.", "author": "theghost5800", "createdAt": "2020-05-04T14:09:53Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/detect/DeployedMtaEnvDetector.java", "diffHunk": "@@ -118,11 +130,18 @@ private DeployedMtaService toDeployedMtaService(String serviceName) {\n                                           .build();\n     }\n \n-    public Optional<DeployedMta> detectDeployedMta(String mtaId, CloudControllerClient client) {\n+    public List<DeployedMta> detectDeployedMta(String mtaId, CloudControllerClient client) {", "originalCommit": "88a5c26a7f715076fa572f9d8381cb51646ae7aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU1NDU2MQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424554561", "bodyText": "An mta is no longer unique by mtaID, this is why a List is the better choice here", "author": "ikasarov", "createdAt": "2020-05-13T16:02:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ2NTI0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ5MDEzOQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419490139", "bodyText": "Remove second if. You can have a look in DeployedMtaEnvDetector::getMtaMetadata", "author": "theghost5800", "createdAt": "2020-05-04T14:43:50Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/metadata/entity/processor/MtaMetadataEntityAggregator.java", "diffHunk": "@@ -34,49 +35,52 @@ public MtaMetadataEntityAggregator(MtaMetadataParser mtaMetadataParser) {\n \n     public List<DeployedMta> aggregate(List<CloudEntity> entities) {\n         Map<String, List<CloudEntity>> entitiesByMtaId = entities.stream()\n-                                                                 .collect(Collectors.groupingBy(this::getMtaId));\n+                                                                 .collect(Collectors.groupingBy(mtaMetadataParser::parseQualifiedMtaId));\n         return entitiesByMtaId.entrySet()\n                               .stream()\n-                              .map(entry -> toDeployedMta(entry.getKey(), entry.getValue()))\n+                              .map(entry -> toDeployedMta(entry.getValue()))\n                               .collect(Collectors.toList());\n     }\n \n-    private String getMtaId(CloudEntity entity) {\n-        return mtaMetadataParser.parseMtaMetadata(entity)\n-                                .getId();\n-    }\n-\n-    private DeployedMta toDeployedMta(String mtaId, List<CloudEntity> entities) {\n-        Version mtaVersion = getMtaVersion(entities);\n-        MtaMetadata mtaMetadata = getMtaMetadata(mtaId, mtaVersion);\n+    private DeployedMta toDeployedMta(List<CloudEntity> entities) {\n+        MtaMetadata mtaMetadata = getMtaMetadata(entities);\n         List<DeployedMtaApplication> applications = getApplications(entities);\n         List<DeployedMtaService> services = getServices(entities);\n         List<DeployedMtaService> userProvidedServices = getUserProvidedServices(applications, services);\n+        \n         return ImmutableDeployedMta.builder()\n                                    .metadata(mtaMetadata)\n                                    .applications(applications)\n                                    .services(ListUtils.union(services, userProvidedServices))\n                                    .build();\n     }\n \n-    private Version getMtaVersion(List<CloudEntity> entities) {\n+    private MtaMetadata getMtaMetadata(List<CloudEntity> entities) {\n+        String mtaId = null;\n+        String mtaNamespace = null;\n         Version currentVersion = null;\n+        \n         for (CloudEntity entity : entities) {\n-            Version version = mtaMetadataParser.parseMtaMetadata(entity)\n-                                               .getVersion();\n-            if (currentVersion != null && !currentVersion.equals(version)) {\n+            MtaMetadata entityMetadata = mtaMetadataParser.parseMtaMetadata(entity);\n+\n+            if (mtaId == null) {\n+                mtaId = entityMetadata.getId();\n+                mtaNamespace = entityMetadata.getNamespace();\n+            }\n+\n+            Version version = entityMetadata.getVersion();\n+            if (currentVersion == null) {\n+                currentVersion = version;\n+            } else if (!currentVersion.equals(version)) {", "originalCommit": "88a5c26a7f715076fa572f9d8381cb51646ae7aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY0NDIyNQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424644225", "bodyText": "I assumed this way it was more readable", "author": "ikasarov", "createdAt": "2020-05-13T18:26:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ5MDEzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ5NTI4Mw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419495283", "bodyText": "You have added some unnecessary tab or spaces", "author": "theghost5800", "createdAt": "2020-05-04T14:50:51Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/metadata/util/MtaMetadataUtil.java", "diffHunk": "@@ -14,16 +14,18 @@\n import com.sap.cloud.lm.sl.cf.core.cf.metadata.MtaMetadataAnnotations;\n import com.sap.cloud.lm.sl.cf.core.cf.metadata.MtaMetadataLabels;\n \n+import io.micrometer.core.instrument.util.StringUtils;\n+\n public class MtaMetadataUtil {\n \n     public static final List<String> ENV_MTA_METADATA_FIELDS = Collections.unmodifiableList(Arrays.asList(Constants.ENV_MTA_METADATA,\n                                                                                                           Constants.ENV_MTA_MODULE_METADATA,\n                                                                                                           Constants.ENV_MTA_SERVICES,\n                                                                                                           Constants.ENV_MTA_MODULE_PUBLIC_PROVIDED_DEPENDENCIES));\n \n-    public static final List<String> MTA_METADATA_LABELS = Collections.unmodifiableList(Arrays.asList(MtaMetadataLabels.MTA_ID));\n-    public static final List<String> MTA_METADATA_ANNOTATIONS = Collections.unmodifiableList(Arrays.asList(MtaMetadataAnnotations.MTA_ID,\n-                                                                                                           MtaMetadataAnnotations.MTA_VERSION));\n+    public static final List<String> MTA_METADATA_MANDATORY_LABELS = Collections.unmodifiableList(Arrays.asList(MtaMetadataLabels.MTA_ID));\n+    public static final List<String> MTA_METADATA_MANDATORY_ANNOTATIONS = Collections.unmodifiableList(Arrays.asList(MtaMetadataAnnotations.MTA_ID,\n+                                                                                                                     MtaMetadataAnnotations.MTA_VERSION));", "originalCommit": "88a5c26a7f715076fa572f9d8381cb51646ae7aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY1MTk1OQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424651959", "bodyText": "it's from the formatter - aligned under the asLilst( opening bracket", "author": "ikasarov", "createdAt": "2020-05-13T18:39:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ5NTI4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUwMTI1MA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419501250", "bodyText": "Why we have to return empty string or null? If we return empty or null hashed label what will happen?", "author": "theghost5800", "createdAt": "2020-05-04T14:58:50Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/metadata/util/MtaMetadataUtil.java", "diffHunk": "@@ -45,11 +47,16 @@ public static boolean hasMtaMetadata(CloudEntity entity) {\n                                              .keySet();\n         Set<String> metadataAnnotations = metadata.getAnnotations()\n                                                   .keySet();\n-        return metadataLabels.containsAll(MTA_METADATA_LABELS) && metadataAnnotations.containsAll(MTA_METADATA_ANNOTATIONS);\n+        return metadataLabels.containsAll(MTA_METADATA_MANDATORY_LABELS)\n+            && metadataAnnotations.containsAll(MTA_METADATA_MANDATORY_ANNOTATIONS);\n     }\n \n-    public static String getHashedMtaId(String mtaId) {\n-        return DigestUtils.md5DigestAsHex(mtaId.getBytes());\n+    public static String getHashedLabel(String mtaLabel) {\n+        if (StringUtils.isEmpty(mtaLabel)) {", "originalCommit": "88a5c26a7f715076fa572f9d8381cb51646ae7aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY1MzQwNg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424653406", "bodyText": "null values cannot be hashed, so that's why we catch them and an empty string doesn't really need hashing in the first place (we're hashing for length concerns). The null value is handled down the line as it could have a meaning of 'label doesn't exist'", "author": "ikasarov", "createdAt": "2020-05-13T18:41:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUwMTI1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUwNTI4Ng==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419505286", "bodyText": "Do you think that it will be better if we use builder for this class?", "author": "theghost5800", "createdAt": "2020-05-04T15:04:16Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/v2/ApplicationEnvironmentCloudModelBuilder.java", "diffHunk": "@@ -24,11 +24,13 @@\n \r\n     protected final DeploymentDescriptor deploymentDescriptor;\r\n     protected final String deployId;\r\n+    protected final String namespace;\r\n     protected final boolean prettyPrinting;\r\n \r\n-    public ApplicationEnvironmentCloudModelBuilder(DeploymentDescriptor deploymentDescriptor, String deployId, boolean prettyPrinting) {\r\n+    public ApplicationEnvironmentCloudModelBuilder(DeploymentDescriptor deploymentDescriptor, String deployId, String namespace, boolean prettyPrinting) {\r", "originalCommit": "88a5c26a7f715076fa572f9d8381cb51646ae7aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ2NzkzOQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424467939", "bodyText": "A builder for the builder would be too much. :D", "author": "nictas", "createdAt": "2020-05-13T14:09:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUwNTI4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY1NDc3Ng==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424654776", "bodyText": "I agree that some sort of refactoring could be useful here, but also didn't want to extend the scope once again; sad part is - it's already a builder :D", "author": "ikasarov", "createdAt": "2020-05-13T18:44:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUwNTI4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUwNzg2Nw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419507867", "bodyText": "I think it will be better to use StringUtils from apache commons (org.apache.commons.lang3)", "author": "theghost5800", "createdAt": "2020-05-04T15:07:54Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/v2/ApplicationMetadataBuilder.java", "diffHunk": "@@ -17,21 +17,32 @@\n import com.sap.cloud.lm.sl.mta.model.Module;\n import com.sap.cloud.lm.sl.mta.model.ProvidedDependency;\n \n+import io.micrometer.core.instrument.util.StringUtils;", "originalCommit": "88a5c26a7f715076fa572f9d8381cb51646ae7aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY1NTQzOA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424655438", "bodyText": "this was just a typo on my part, good catch!", "author": "ikasarov", "createdAt": "2020-05-13T18:45:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUwNzg2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUwNzk2MQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419507961", "bodyText": "I think it will be better to use StringUtils from apache commons (org.apache.commons.lang3)", "author": "theghost5800", "createdAt": "2020-05-04T15:08:03Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/metadata/util/MtaMetadataUtil.java", "diffHunk": "@@ -14,16 +14,18 @@\n import com.sap.cloud.lm.sl.cf.core.cf.metadata.MtaMetadataAnnotations;\n import com.sap.cloud.lm.sl.cf.core.cf.metadata.MtaMetadataLabels;\n \n+import io.micrometer.core.instrument.util.StringUtils;", "originalCommit": "88a5c26a7f715076fa572f9d8381cb51646ae7aa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUxMTE2Ng==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419511166", "bodyText": "What do you think to use builder (Immutables)?", "author": "theghost5800", "createdAt": "2020-05-04T15:12:40Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/v2/ConfigurationEntriesCloudModelBuilder.java", "diffHunk": "@@ -25,11 +25,13 @@\n     private final String orgName;\n     private final String spaceName;\n     private final String spaceId;\n+    private final String namespace;\n \n-    public ConfigurationEntriesCloudModelBuilder(String orgName, String spaceName, String spaceId) {\n+    public ConfigurationEntriesCloudModelBuilder(String orgName, String spaceName, String spaceId, String namespace) {", "originalCommit": "88a5c26a7f715076fa572f9d8381cb51646ae7aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY1NjQzOQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424656439", "bodyText": "see comment for ApplicationEnvironmentCloudModelBuilder, it's a good idea", "author": "ikasarov", "createdAt": "2020-05-13T18:46:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUxMTE2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUxNjA5Nw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419516097", "bodyText": "Can we add empty constuctor in super class?", "author": "theghost5800", "createdAt": "2020-05-04T15:19:39Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/helpers/DummyConfigurationFilterParser.java", "diffHunk": "@@ -8,7 +8,7 @@\n     private final ConfigurationFilter filter;\n \n     public DummyConfigurationFilterParser(ConfigurationFilter filter) {\n-        super(null, null);\n+        super(null, null, null);", "originalCommit": "88a5c26a7f715076fa572f9d8381cb51646ae7aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTkxMzY0OA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r425913648", "bodyText": "I think it's more explicit this way that the null values aren't actually a default behaviour", "author": "ikasarov", "createdAt": "2020-05-15T16:27:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUxNjA5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUxOTIyNg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419519226", "bodyText": "Add builder in ConfigurationEntry class or at least another constructs, passing multiple null arguments is awful.", "author": "theghost5800", "createdAt": "2020-05-04T15:23:59Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/helpers/MtaConfigurationPurger.java", "diffHunk": "@@ -148,6 +148,7 @@ private ConfigurationEntry toConfigurationEntry(MtaMetadata metadata, String pro\n                                       null,\n                                       null,\n                                       null,\n+                                      null,", "originalCommit": "88a5c26a7f715076fa572f9d8381cb51646ae7aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTkxOTM5Nw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r425919397", "bodyText": "added constructor as I don't wan't to add more refactorings", "author": "ikasarov", "createdAt": "2020-05-15T16:36:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUxOTIyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUyOTE5Mw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419529193", "bodyText": "I think it will be better to return previous state of \"isValid\" and \"attemptToCorrect\" methods and add as default methods \"isValid\" and \"attemptToCorrect\" methods with 2 parameters. In this way you wouldn't need to pass null values to all implementations of ParameterValidator interface.", "author": "theghost5800", "createdAt": "2020-05-04T15:37:47Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/helpers/SystemParameters.java", "diffHunk": "@@ -174,8 +174,8 @@ private String appendRoutePathIfPresent(String uri, Map<String, Object> modulePa\n     private String getDefaultHost(String moduleName) {\n         String host = (targetName + \" \" + moduleName).replaceAll(\"\\\\s\", \"-\")\n                                                      .toLowerCase();\n-        if (!HOST_VALIDATOR.isValid(host)) {\n-            return HOST_VALIDATOR.attemptToCorrect(host);\n+        if (!HOST_VALIDATOR.isValid(host, null)) {", "originalCommit": "88a5c26a7f715076fa572f9d8381cb51646ae7aa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkyNTAyNQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419925025", "bodyText": "Can we use builder instead?", "author": "theghost5800", "createdAt": "2020-05-05T07:52:42Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/model/ConfigurationFilter.java", "diffHunk": "@@ -12,25 +13,27 @@\n     private String providerNid;\n     private CloudTarget targetSpace;\n     private String providerVersion;\n+    private String providerNamespace;\n     @JsonIgnore\n     private boolean strictTargetSpace;\n \n     public ConfigurationFilter() {\n         // Required by Jackson\n     }\n \n-    public ConfigurationFilter(String providerNid, String providerId, String providerVersion, CloudTarget targetSpace,\n-                               Map<String, Object> requiredContent) {\n-        this(providerNid, providerId, providerVersion, targetSpace, requiredContent, true);\n+    public ConfigurationFilter(String providerNid, String providerId, String providerVersion, String providerNamespace,", "originalCommit": "1e51f12ae116f3f72a4f750f5e90c970a9fb1f86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkyNTgwOQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419925809", "bodyText": "If we use builder, it will prevent passing null arguments", "author": "theghost5800", "createdAt": "2020-05-05T07:54:13Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/helpers/v2/ConfigurationFilterParser.java", "diffHunk": "@@ -49,20 +51,20 @@ private ConfigurationFilter parseOldSyntaxFilter(Resource resource) {\n         String mtaProvidesDependency = getRequiredParameter(parameters, SupportedParameters.MTA_PROVIDES_DEPENDENCY);\n         String mtaVersion = getRequiredParameter(parameters, SupportedParameters.MTA_VERSION);\n         String providerId = ConfigurationEntriesUtil.computeProviderId(mtaId, mtaProvidesDependency);\n-        return new ConfigurationFilter(PROVIDER_NID, providerId, mtaVersion, currentTarget, null);\n+        return new ConfigurationFilter(PROVIDER_NID, providerId, mtaVersion, null, currentTarget, null);", "originalCommit": "1e51f12ae116f3f72a4f750f5e90c970a9fb1f86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk0Njk4Mw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419946983", "bodyText": "Builder it could be used for this class", "author": "theghost5800", "createdAt": "2020-05-05T08:34:04Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/model/ConfigurationEntry.java", "diffHunk": "@@ -29,21 +30,22 @@\n     protected ConfigurationEntry() {\n     }\n \n-    public ConfigurationEntry(long id, String providerNid, String providerId, Version providerVersion, CloudTarget targetSpace,\n-                              String content, List<CloudTarget> visibility, String spaceId) {\n+    public ConfigurationEntry(long id, String providerNid, String providerId, Version providerVersion, String providerNamespace,", "originalCommit": "1e51f12ae116f3f72a4f750f5e90c970a9fb1f86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk3MTEwMw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419971103", "bodyText": "Is it possible to have null value in DB for provider-namespace? If it is possible, why in ConfigurationEntryDto -@column(name = TableColumnNames.CONFIGURATION_ENTRY_PROVIDER_NAMESPACE, nullable = false)\nnullable is set to false", "author": "theghost5800", "createdAt": "2020-05-05T09:17:01Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/persistence/query/impl/ConfigurationEntryQueryImpl.java", "diffHunk": "@@ -80,6 +81,31 @@ public ConfigurationEntryQuery providerId(String providerId) {\n         return this;\n     }\n \n+    @Override\n+    public ConfigurationEntryQuery providerNamespace(String providerNamespace, boolean considerNullAsEmpty) {\n+        boolean shouldFilterForEmptyNamespace = ConfigurationEntriesUtil.providerNamespaceIsEmpty(providerNamespace, considerNullAsEmpty);\n+\n+        if (providerNamespace == null && !shouldFilterForEmptyNamespace) {\n+            return this;\n+        }\n+\n+        if (shouldFilterForEmptyNamespace) {\n+            queryCriteria.addRestriction(ImmutableQueryAttributeRestriction.builder()\n+                                                                           .attribute(AttributeNames.PROVIDER_NAMESPACE)\n+                                                                           .condition(getCriteriaBuilder()::equal)\n+                                                                           .value(null)", "originalCommit": "1e51f12ae116f3f72a4f750f5e90c970a9fb1f86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk5MTg0OQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419991849", "bodyText": "Why not use only primitive types? As I can see the reason is that parseBooleanFlag return object of Boolean, which could be also primitive type. If you use only primitives, you will avoid null check", "author": "theghost5800", "createdAt": "2020-05-05T09:54:21Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/util/NameUtil.java", "diffHunk": "@@ -36,28 +41,29 @@ private NameRequirements() {\n     private NameUtil() {\n     }\n \n-    public static String getNamespacePrefix(String namespace) {\n-        return namespace + \".\";\n+    public static boolean isValidName(String name, String namePattern) {\n+        return name.matches(namePattern);\n     }\n \n-    public static String getWithoutNamespacePrefix(String name) {\n-        int i = name.lastIndexOf('.');\n-        return (i >= 0) ? name.substring(i + 1) : name;\n+    public static Boolean parseBooleanFlag(final Map<String, Object> parameters, String flagName) throws ContentException {\n+        Object applyNamespaceParameter = parameters.get(flagName);\n+\n+        if (applyNamespaceParameter != null && !(applyNamespaceParameter instanceof Boolean)) {\n+            throw new ContentException(Messages.COULD_NOT_PARSE_BOOLEAN_FLAG, flagName);\n+        }\n+        return (Boolean) applyNamespaceParameter;\n     }\n \n-    public static boolean isValidName(String name, String namePattern) {\n-        return name.matches(namePattern);\n+    public static boolean resolveApplyNamespaceFlag(boolean applyNamespaceGlobal, Boolean applyNamespaceParameter) {", "originalCommit": "1e51f12ae116f3f72a4f750f5e90c970a9fb1f86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk5NTU2NQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419995565", "bodyText": "I think it will be better to use primitive boolean type", "author": "theghost5800", "createdAt": "2020-05-05T10:01:07Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/validators/parameters/ApplicationNameValidator.java", "diffHunk": "@@ -38,11 +41,20 @@ public boolean canCorrect() {\n     }\n \n     @Override\n-    public Object attemptToCorrect(Object applicationName) {\n+    public Object attemptToCorrect(Object applicationName, final Map<String, Object> relatedParameters) {\n         if (!(applicationName instanceof String)) {\n             throw new ContentException(Messages.COULD_NOT_CREATE_VALID_APPLICATION_NAME_FROM_0, applicationName);\n         }\n-        return NameUtil.computeValidApplicationName((String) applicationName, namespace, useNamespaces);\n+\n+        Boolean applyNamespaceLocal = NameUtil.parseBooleanFlag(relatedParameters, SupportedParameters.APPLY_NAMESPACE);", "originalCommit": "1e51f12ae116f3f72a4f750f5e90c970a9fb1f86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk5NjU3Ng==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419996576", "bodyText": "Use Collections.emptySet() method instead - https://stackoverflow.com/questions/27958698/difference-between-emptylist-and-empty-list-android", "author": "theghost5800", "createdAt": "2020-05-05T10:02:59Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/validators/parameters/ParameterValidator.java", "diffHunk": "@@ -1,21 +1,28 @@\n package com.sap.cloud.lm.sl.cf.core.validators.parameters;\n \n+import java.util.Collections;\n+import java.util.Map;\n+import java.util.Set;\n+\n public interface ParameterValidator {\n \n-    default boolean isValid(Object parameter) {\n+    default boolean isValid(Object parameter, final Map<String, Object> relatedParameters) {\n         return true;\n     }\n \n     default boolean canCorrect() {\n         return false;\n     }\n \n-    default Object attemptToCorrect(Object parameter) {\n+    default Object attemptToCorrect(Object parameter, final Map<String, Object> relatedParameters) {\n         throw new UnsupportedOperationException();\n     }\n \n-    Class<?> getContainerType();\n+    default Set<String> getRelatedParameterNames() {\n+        return Collections.EMPTY_SET;", "originalCommit": "1e51f12ae116f3f72a4f750f5e90c970a9fb1f86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk5OTQxMA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r419999410", "bodyText": "I think it will be better to return previous state of \"isValid\" and \"attemptToCorrect\" methods and add as default methods \"isValid\" and \"attemptToCorrect\" methods with 2 parameters. In this way you wouldn't need to pass null values to all implementations of ParameterValidator interface.", "author": "theghost5800", "createdAt": "2020-05-05T10:08:23Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/validators/parameters/ParameterValidator.java", "diffHunk": "@@ -1,21 +1,28 @@\n package com.sap.cloud.lm.sl.cf.core.validators.parameters;\n \n+import java.util.Collections;\n+import java.util.Map;\n+import java.util.Set;\n+\n public interface ParameterValidator {", "originalCommit": "1e51f12ae116f3f72a4f750f5e90c970a9fb1f86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDAyMzMwNQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r420023305", "bodyText": "Use Collections.emptyMap() method", "author": "theghost5800", "createdAt": "2020-05-05T10:55:36Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/validators/parameters/ParametersValidatorHelper.java", "diffHunk": "@@ -65,28 +67,45 @@ private void correctInvalidPluralParameters(String prefix, ParameterValidator va\n         List<Object> correctedParameterValues = initialParameterValues.stream()\n                                                                       .map(parameter -> validateAndCorrect(ValidatorUtil.getPrefixedName(prefix,\n                                                                                                                                          validator.getParameterName()),\n-                                                                                                           parameter, validator))\n+                                                                                                           parameter, validator,\n+                                                                                                           parameters))\n                                                                       .collect(Collectors.toList());\n         correctedParameters.put(parameterPluralName, correctedParameterValues);\n     }\n \n-    private Object validateAndCorrect(String parameterName, Object parameter, ParameterValidator validator) {\n-        if (shouldCorrectParameter(parameter, validator)) {\n-            return attemptToCorrect(parameterName, parameter, validator);\n+    private Object validateAndCorrect(String parameterName, Object parameter, ParameterValidator validator,\n+                                      Map<String, Object> parameters) {\n+        Map<String, Object> relatedParameters = getRelatedParameters(validator, parameters);\n+\n+        if (shouldCorrectParameter(parameter, validator, relatedParameters)) {\n+            return attemptToCorrect(parameterName, parameter, validator, relatedParameters);\n         } else {\n             return parameter;\n         }\n     }\n \n-    private boolean shouldCorrectParameter(Object parameter, ParameterValidator validator) {\n-        return parameter != null && !validator.isValid(parameter);\n+    private Map<String, Object> getRelatedParameters(ParameterValidator validator, Map<String, Object> parameters) {\n+        Set<String> relatedParameterNames = validator.getRelatedParameterNames();\n+\n+        if (relatedParameterNames.isEmpty()) {\n+            return Collections.EMPTY_MAP;", "originalCommit": "1e51f12ae116f3f72a4f750f5e90c970a9fb1f86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDAzNTMwMg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r420035302", "bodyText": "You can use Function.identify() instead name -> name . Also you can use method reference when you build value of the map - parameters::get", "author": "theghost5800", "createdAt": "2020-05-05T11:20:53Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/validators/parameters/ParametersValidatorHelper.java", "diffHunk": "@@ -65,28 +67,45 @@ private void correctInvalidPluralParameters(String prefix, ParameterValidator va\n         List<Object> correctedParameterValues = initialParameterValues.stream()\n                                                                       .map(parameter -> validateAndCorrect(ValidatorUtil.getPrefixedName(prefix,\n                                                                                                                                          validator.getParameterName()),\n-                                                                                                           parameter, validator))\n+                                                                                                           parameter, validator,\n+                                                                                                           parameters))\n                                                                       .collect(Collectors.toList());\n         correctedParameters.put(parameterPluralName, correctedParameterValues);\n     }\n \n-    private Object validateAndCorrect(String parameterName, Object parameter, ParameterValidator validator) {\n-        if (shouldCorrectParameter(parameter, validator)) {\n-            return attemptToCorrect(parameterName, parameter, validator);\n+    private Object validateAndCorrect(String parameterName, Object parameter, ParameterValidator validator,\n+                                      Map<String, Object> parameters) {\n+        Map<String, Object> relatedParameters = getRelatedParameters(validator, parameters);\n+\n+        if (shouldCorrectParameter(parameter, validator, relatedParameters)) {\n+            return attemptToCorrect(parameterName, parameter, validator, relatedParameters);\n         } else {\n             return parameter;\n         }\n     }\n \n-    private boolean shouldCorrectParameter(Object parameter, ParameterValidator validator) {\n-        return parameter != null && !validator.isValid(parameter);\n+    private Map<String, Object> getRelatedParameters(ParameterValidator validator, Map<String, Object> parameters) {\n+        Set<String> relatedParameterNames = validator.getRelatedParameterNames();\n+\n+        if (relatedParameterNames.isEmpty()) {\n+            return Collections.EMPTY_MAP;\n+        }\n+\n+        return relatedParameterNames.stream()\n+                                    .filter(name -> parameters.get(name) != null)\n+                                    .collect(Collectors.toMap(name -> name, name -> parameters.get(name)));", "originalCommit": "1e51f12ae116f3f72a4f750f5e90c970a9fb1f86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDAzNzMzOA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r420037338", "bodyText": "Use primitive boolean", "author": "theghost5800", "createdAt": "2020-05-05T11:25:28Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/validators/parameters/ServiceNameValidator.java", "diffHunk": "@@ -40,11 +41,20 @@ public boolean canCorrect() {\n     }\n \n     @Override\n-    public Object attemptToCorrect(Object serviceName) {\n+    public Object attemptToCorrect(Object serviceName, final Map<String, Object> relatedParameters) {\n         if (!(serviceName instanceof String)) {\n             throw new ContentException(Messages.COULD_NOT_CREATE_VALID_SERVICE_NAME_FROM_0, serviceName);\n         }\n-        return NameUtil.computeValidServiceName((String) serviceName, namespace, useNamespaces, useNamespacesForServices);\n+\n+        Boolean applyNamespaceLocal = NameUtil.parseBooleanFlag(relatedParameters, SupportedParameters.APPLY_NAMESPACE);", "originalCommit": "1e51f12ae116f3f72a4f750f5e90c970a9fb1f86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA1MDk2NQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r420050965", "bodyText": "How you pass only one argument to constructor when ApplicationNameValidator accepts two?", "author": "theghost5800", "createdAt": "2020-05-05T11:52:52Z", "path": "com.sap.cloud.lm.sl.cf.core/src/test/java/com/sap/cloud/lm/sl/cf/core/validators/parameters/ApplicationNameValidatorTest.java", "diffHunk": "@@ -20,47 +20,45 @@\n \n     @Test\n     public void testCorrectionWithNoNamespaces() {\n-        boolean useNamespaces = false;\n-        ApplicationNameValidator applicationNameValidator = new ApplicationNameValidator(NAMESPACE, false);\n+        ApplicationNameValidator applicationNameValidator = new ApplicationNameValidator(null);", "originalCommit": "1e51f12ae116f3f72a4f750f5e90c970a9fb1f86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA1NzM4MA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r420057380", "bodyText": "These if blocks could be split in separate method and new method will be return statement with already set Strings", "author": "theghost5800", "createdAt": "2020-05-05T12:05:23Z", "path": "com.sap.cloud.lm.sl.cf.persistence/src/main/java/com/sap/cloud/lm/sl/cf/persistence/query/providers/SqlFileQueryProvider.java", "diffHunk": "@@ -101,13 +103,16 @@ public SqlFileQueryProvider(String tableName, DataSourceDialect dataSourceDialec\n             ResultSet resultSet = null;\n             try {\n                 List<FileEntry> files = new ArrayList<>();\n-                if (namespace != null) {\n+                if (namespace==null) {", "originalCommit": "1e51f12ae116f3f72a4f750f5e90c970a9fb1f86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA2MjM5Mg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r420062392", "bodyText": "What will be namespace value if the user does not use namespace feature?", "author": "theghost5800", "createdAt": "2020-05-05T12:15:01Z", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/Messages.java", "diffHunk": "@@ -209,7 +209,7 @@\n     public static final String MTA_SCHEMA_VERSION_DETECTED_AS = \"Detected MTA schema version: \\\"{0}\\\"\";\r\n     public static final String DEPLOYING_IN_ORG_0_AND_SPACE_1 = \"Deploying in org \\\"{0}\\\" and space \\\"{1}\\\"\";\r\n     public static final String NO_DEPLOYED_MTA_DETECTED = \"No deployed MTA detected - this is initial deployment\";\r\n-    public static final String DEPLOYED_MTA_DETECTED_WITH_VERSION = \"Detected deployed MTA with ID \\\"{0}\\\" and version \\\"{1}\\\"\";\r\n+    public static final String DEPLOYED_MTA_DETECTED_WITH_VERSION = \"Detected deployed MTA with namespace \\\"{0}\\\", ID \\\"{1}\\\" and version \\\"{2}\\\"\";\r", "originalCommit": "1e51f12ae116f3f72a4f750f5e90c970a9fb1f86", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODAzMTY1MQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r428031651", "bodyText": "an empty string in quotes", "author": "ikasarov", "createdAt": "2020-05-20T13:55:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA2MjM5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQ4MDI2NA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r428480264", "bodyText": "Sounds fine to me", "author": "theghost5800", "createdAt": "2020-05-21T06:59:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA2MjM5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA2MzIzOQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r420063239", "bodyText": "What is operation parameter? Is this some parameter provided from command line option?", "author": "theghost5800", "createdAt": "2020-05-05T12:16:32Z", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/Messages.java", "diffHunk": "@@ -523,6 +523,7 @@\n     public static final String UPDATING_METADATA_OF_APPLICATION_0_TO_1 = \"Updating metadata of application \\\"{0}\\\" to: {1}\";\r\n     public static final String GETTING_SERVICE_INSTANCES_BY_METADATA_LABEL_SELECTOR_0 = \"Getting service instances by metadata label selector \\\"{0}\\\"...\";\r\n     public static final String UPDATING_METADATA_OF_SERVICE_INSTANCE_0_TO_1 = \"Updating metadata of service instance \\\"{0}\\\": {1}\";\r\n+    public static final String NAMESPACE_IN_DESCRIPTOR_IS_OVERWRITTEN = \"Namespace parameter provided multiple times - operation parameter overwriting one given in descriptor.\";\r", "originalCommit": "1e51f12ae116f3f72a4f750f5e90c970a9fb1f86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA2NTE5Mw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r420065193", "bodyText": "What should be default value for namespace? null or empty string?", "author": "theghost5800", "createdAt": "2020-05-05T12:20:03Z", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/metadata/BlueGreenDeployMetadata.java", "diffHunk": "@@ -35,13 +35,12 @@\n                                              .type(ParameterType.INTEGER)\n                                              .build());\n         PARAMS.add(ImmutableParameterMetadata.builder()\n-                                             .id(Variables.USE_NAMESPACES.getName())\n-                                             .defaultValue(Variables.USE_NAMESPACES.getDefaultValue())\n-                                             .type(ParameterType.BOOLEAN)\n+                                             .id(Variables.MTA_NAMESPACE.getName())\n+                                             .type(ParameterType.STRING)", "originalCommit": "1e51f12ae116f3f72a4f750f5e90c970a9fb1f86", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg2MDQ5Mw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r426860493", "bodyText": "I left it null, can change it if you think it'll be easier to understand", "author": "ikasarov", "createdAt": "2020-05-18T19:55:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA2NTE5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA2ODY2NA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r420068664", "bodyText": "Why log level is warn? Do you intent to send progress message to user's cli? If you don't want to send progress message, you can use infoWithoutProgressMessage method.", "author": "theghost5800", "createdAt": "2020-05-05T12:26:08Z", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/BuildApplicationDeployModelStep.java", "diffHunk": "@@ -94,7 +95,10 @@ private ConfigurationEntriesCloudModelBuilder getConfigurationEntriesCloudModelB\n         String orgName = context.getVariable(Variables.ORG);\r\n         String spaceName = context.getVariable(Variables.SPACE);\r\n         String spaceId = context.getVariable(Variables.SPACE_ID);\r\n-        return new ConfigurationEntriesCloudModelBuilder(orgName, spaceName, spaceId);\r\n+        String namespace = context.getVariable(Variables.MTA_NAMESPACE);\r\n+        getStepLogger().warn(\"Building configuration entries for org {0}, space {1}, spaceId {2} and namespace {3}!\", orgName, spaceName,\r", "originalCommit": "1e51f12ae116f3f72a4f750f5e90c970a9fb1f86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA4NjU1Ng==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r420086556", "bodyText": "Reminder to remove this line", "author": "theghost5800", "createdAt": "2020-05-05T12:56:16Z", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/DetectDeployedMtaStep.java", "diffHunk": "@@ -30,17 +31,22 @@ protected StepPhase executeStep(ProcessContext context) {\n         CloudControllerClient client = context.getControllerClient();\n \n         String mtaId = context.getVariable(Variables.MTA_ID);\n+\n+        String mtaNamespace = context.getVariable(Variables.MTA_NAMESPACE);\n         boolean envDetectionEnabled = context.getVariable(Variables.ENABLE_ENV_DETECTION);\n \n-        Optional<DeployedMta> optionalDeployedMta = deployedMtaDetector.detectDeployedMta(mtaId, client, envDetectionEnabled);\n+        getStepLogger().info(\"Detecting MTA by id {0} and namespace {1}\", mtaId, mtaNamespace); // TODO: remove after verification", "originalCommit": "1e51f12ae116f3f72a4f750f5e90c970a9fb1f86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA4ODYyMw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r420088623", "bodyText": "Remove unnecessary logs message", "author": "theghost5800", "createdAt": "2020-05-05T12:59:26Z", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/MergeDescriptorsStep.java", "diffHunk": "@@ -36,9 +36,12 @@ protected StepPhase executeStep(ProcessContext context) {\n         context.setVariable(Variables.DEPLOYMENT_DESCRIPTOR, descriptor);\n         getStepLogger().debug(Messages.DESCRIPTORS_MERGED);\n \n+        getStepLogger().debug(Messages.DESCRIPTORS_MERGED);", "originalCommit": "1e51f12ae116f3f72a4f750f5e90c970a9fb1f86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA4OTY4NQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r420089685", "bodyText": "If this is not applicable any longer, remove this comment.", "author": "theghost5800", "createdAt": "2020-05-05T13:01:04Z", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/MergeDescriptorsStep.java", "diffHunk": "@@ -36,9 +36,12 @@ protected StepPhase executeStep(ProcessContext context) {\n         context.setVariable(Variables.DEPLOYMENT_DESCRIPTOR, descriptor);\n         getStepLogger().debug(Messages.DESCRIPTORS_MERGED);\n \n+        getStepLogger().debug(Messages.DESCRIPTORS_MERGED);\n         return StepPhase.DONE;\n     }\n \n+    // TODO: recalculate the namespace once support in deployment descriptor is added", "originalCommit": "1e51f12ae116f3f72a4f750f5e90c970a9fb1f86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA5MDc1MA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r420090750", "bodyText": "Git visualize some tabs or spaces which are unnecessary", "author": "theghost5800", "createdAt": "2020-05-05T13:02:50Z", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/PrepareToUndeployStep.java", "diffHunk": "@@ -40,8 +42,8 @@ protected StepPhase executeStep(ProcessContext context) {\n         context.setVariable(Variables.MTA_MAJOR_SCHEMA_VERSION, 2);\r\n \r\n         conflictPreventerSupplier.apply(operationService)\r\n-                                 .acquireLock(mtaId, context.getVariable(Variables.SPACE_ID), context.getExecution()\r\n-                                                                                                     .getProcessInstanceId());\r\n+                                 .acquireLock(mtaId, namespace, context.getVariable(Variables.SPACE_ID), context.getExecution()\r\n+                                                                                                                .getProcessInstanceId());\r", "originalCommit": "1e51f12ae116f3f72a4f750f5e90c970a9fb1f86", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg2MzM5Nw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r426863397", "bodyText": "this is again due to the formatter - maybe you have different settings?", "author": "ikasarov", "createdAt": "2020-05-18T20:02:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA5MDc1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA5Nzk3NA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r420097974", "bodyText": "You can avoid using of qualifiedId local variable and else statement if you just use short if -\nreturn StringUtils.isNotEmpty(namespace) ? NAMESPACE_SEPARATOR + mtaId : mtaId;", "author": "theghost5800", "createdAt": "2020-05-05T13:13:50Z", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/StepsUtil.java", "diffHunk": "@@ -98,10 +100,30 @@ public static HandlerFactory getHandlerFactory(VariableScope scope) {\n         int majorSchemaVersion = VariableHandling.get(scope, Variables.MTA_MAJOR_SCHEMA_VERSION);\r\n         return new HandlerFactory(majorSchemaVersion);\r\n     }\r\n+    \r\n+    public static CloudTarget getCloudTarget(VariableScope scope) {\r\n+        String org = VariableHandling.get(scope, Variables.ORG);\r\n+        String space = VariableHandling.get(scope, Variables.SPACE);\r\n+        \r\n+        return new CloudTarget(org, space);\r\n+    }\r\n+\r\n+    public static String getQualifiedMtaId(String mtaId, String namespace) {\r\n+        String qualifiedId;\r\n+\r\n+        if (StringUtils.isNotEmpty(namespace)) {\r", "originalCommit": "1e51f12ae116f3f72a4f750f5e90c970a9fb1f86", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg2MzczNQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r426863735", "bodyText": "I think it's more readable this way", "author": "ikasarov", "createdAt": "2020-05-18T20:02:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA5Nzk3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDEwNTc2NQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r420105765", "bodyText": "This has been already changed in latest master", "author": "theghost5800", "createdAt": "2020-05-05T13:24:57Z", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/variables/Variables.java", "diffHunk": "@@ -114,7 +121,7 @@\n     Variable<String> STEP_EXECUTION = ImmutableSimpleVariable.<String> builder()\n                                                              .name(\"StepExecution\")\n                                                              .build();\n-    // TODO: Saving booleans as strings... Really???\n+    // TODO: Saving booleans as strings... Really??? XD\n     Variable<String> APP_CONTENT_CHANGED = ImmutableSimpleVariable.<String> builder()", "originalCommit": "1e51f12ae116f3f72a4f750f5e90c970a9fb1f86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDEwODIxMw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r420108213", "bodyText": "Shouldn't be \"default\" value of  DEFAULT_NAMESPACE?", "author": "theghost5800", "createdAt": "2020-05-05T13:28:26Z", "path": "com.sap.cloud.lm.sl.cf.process/src/test/java/com/sap/cloud/lm/sl/cf/process/steps/CollectSystemParametersStepBaseTest.java", "diffHunk": "@@ -33,8 +33,8 @@\n     protected static final UUID DEFAULT_DOMAIN_GUID = UUID.fromString(\"7b5987e9-4325-4bb6-93e2-a0b1c562e60c\");\n     protected static final VersionRule VERSION_RULE = VersionRule.SAME_HIGHER;\n \n-    protected static final boolean DEFAULT_USE_NAMESPACES = false;\n-    protected static final boolean DEFAULT_USE_NAMESPACES_FOR_SERVICES = false;\n+    protected static final String DEFAULT_NAMESPACE = null;", "originalCommit": "1e51f12ae116f3f72a4f750f5e90c970a9fb1f86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDEyMTc1MQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r420121751", "bodyText": "I think this structure is complicated. Do you think it will be simpler in that way\n    if (name == null && namespace == null) {\n        return getAllMtas();\n    }\n\n    if (namespace == null) {\n        return getMtasByName;\n    }\n\n    if (name == null) {\n        return getMtasByNamespace;\n    }", "author": "theghost5800", "createdAt": "2020-05-05T13:46:52Z", "path": "com.sap.cloud.lm.sl.cf.web/src/main/java/com/sap/cloud/lm/sl/cf/web/api/impl/MtasApiServiceImpl.java", "diffHunk": "@@ -40,18 +45,77 @@\n \n     @Override\n     public ResponseEntity<List<Mta>> getMtas(String spaceGuid) {\n-        List<DeployedMta> deployedMtas = deployedMtaDetector.detectDeployedMtas(getCloudFoundryClient(spaceGuid));\n+        List<DeployedMta> deployedMtas = deployedMtaDetector.detectDeployedMtasWithoutNamespace(getCloudFoundryClient(spaceGuid));\n         List<Mta> mtas = getMtas(deployedMtas);\n         return ResponseEntity.ok()\n                              .body(mtas);\n     }\n \n     @Override\n     public ResponseEntity<Mta> getMta(String spaceGuid, String mtaId) {\n-        Optional<DeployedMta> optionalDeployedMta = deployedMtaDetector.detectDeployedMta(mtaId, getCloudFoundryClient(spaceGuid), true);\n-        DeployedMta deployedMta = optionalDeployedMta.orElseThrow(() -> new NotFoundException(Messages.MTA_NOT_FOUND, mtaId));\n+        List<DeployedMta> mtas = deployedMtaDetector.detectDeployedMtasByName(mtaId, getCloudFoundryClient(spaceGuid));\n+\n+        if (mtas.isEmpty()) {\n+            throw new NotFoundException(Messages.MTA_NOT_FOUND, mtaId);\n+        }\n+\n+        if (mtas.size() != 1) {\n+            throw new ConflictException(Messages.MTA_SEARCH_NOT_UNIQUE_BY_NAME, mtaId);\n+        }\n+\n+        return ResponseEntity.ok()\n+                             .body(getMta(mtas.get(0)));\n+    }\n+\n+    @Override\n+    public ResponseEntity<List<Mta>> getMtas(String spaceGuid, String namespace, String name) {\n+\n+        if (name == null && namespace == null) {", "originalCommit": "1e51f12ae116f3f72a4f750f5e90c970a9fb1f86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDEyNDU3Mw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r420124573", "bodyText": "Use isEmpty() method instead", "author": "theghost5800", "createdAt": "2020-05-05T13:50:42Z", "path": "com.sap.cloud.lm.sl.cf.web/src/main/java/com/sap/cloud/lm/sl/cf/web/api/impl/MtasApiServiceImpl.java", "diffHunk": "@@ -40,18 +45,77 @@\n \n     @Override\n     public ResponseEntity<List<Mta>> getMtas(String spaceGuid) {\n-        List<DeployedMta> deployedMtas = deployedMtaDetector.detectDeployedMtas(getCloudFoundryClient(spaceGuid));\n+        List<DeployedMta> deployedMtas = deployedMtaDetector.detectDeployedMtasWithoutNamespace(getCloudFoundryClient(spaceGuid));\n         List<Mta> mtas = getMtas(deployedMtas);\n         return ResponseEntity.ok()\n                              .body(mtas);\n     }\n \n     @Override\n     public ResponseEntity<Mta> getMta(String spaceGuid, String mtaId) {\n-        Optional<DeployedMta> optionalDeployedMta = deployedMtaDetector.detectDeployedMta(mtaId, getCloudFoundryClient(spaceGuid), true);\n-        DeployedMta deployedMta = optionalDeployedMta.orElseThrow(() -> new NotFoundException(Messages.MTA_NOT_FOUND, mtaId));\n+        List<DeployedMta> mtas = deployedMtaDetector.detectDeployedMtasByName(mtaId, getCloudFoundryClient(spaceGuid));\n+\n+        if (mtas.isEmpty()) {\n+            throw new NotFoundException(Messages.MTA_NOT_FOUND, mtaId);\n+        }\n+\n+        if (mtas.size() != 1) {\n+            throw new ConflictException(Messages.MTA_SEARCH_NOT_UNIQUE_BY_NAME, mtaId);\n+        }\n+\n+        return ResponseEntity.ok()\n+                             .body(getMta(mtas.get(0)));\n+    }\n+\n+    @Override\n+    public ResponseEntity<List<Mta>> getMtas(String spaceGuid, String namespace, String name) {\n+\n+        if (name == null && namespace == null) {\n+            return getAllMtas(spaceGuid);\n+        } else if (namespace == null) {\n+            return getMtasByName(spaceGuid, name);\n+        } else if (name == null) {\n+            return getMtasByNamespace(spaceGuid, namespace);\n+        }\n+\n+        Optional<DeployedMta> optionalDeployedMta = deployedMtaDetector.detectDeployedMtaByNameAndNamespace(name, namespace,\n+                                                                                                            getCloudFoundryClient(spaceGuid),\n+                                                                                                            true);\n+        DeployedMta deployedMta = optionalDeployedMta.orElseThrow(() -> new NotFoundException(Messages.SPECIFIC_MTA_NOT_FOUND,\n+                                                                                              name,\n+                                                                                              namespace));\n+\n+        return ResponseEntity.ok()\n+                             .body(Arrays.asList(getMta(deployedMta)));\n+    }\n+\n+    protected ResponseEntity<List<Mta>> getAllMtas(String spaceGuid) {\n+        List<DeployedMta> deployedMtas = deployedMtaDetector.detectDeployedMtas(getCloudFoundryClient(spaceGuid));\n+\n+        return ResponseEntity.ok()\n+                             .body(getMtas(deployedMtas));\n+    }\n+\n+    protected ResponseEntity<List<Mta>> getMtasByNamespace(String spaceGuid, String namespace) {\n+        List<DeployedMta> deployedMtas = deployedMtaDetector.detectDeployedMtasByNamespace(namespace, getCloudFoundryClient(spaceGuid));\n+\n+        if (deployedMtas.size() == 0) {", "originalCommit": "1e51f12ae116f3f72a4f750f5e90c970a9fb1f86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDEyNTA1Mw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r420125053", "bodyText": "Maybe it will be better to use mtas.size() > 1", "author": "theghost5800", "createdAt": "2020-05-05T13:51:23Z", "path": "com.sap.cloud.lm.sl.cf.web/src/main/java/com/sap/cloud/lm/sl/cf/web/api/impl/MtasApiServiceImpl.java", "diffHunk": "@@ -40,18 +45,77 @@\n \n     @Override\n     public ResponseEntity<List<Mta>> getMtas(String spaceGuid) {\n-        List<DeployedMta> deployedMtas = deployedMtaDetector.detectDeployedMtas(getCloudFoundryClient(spaceGuid));\n+        List<DeployedMta> deployedMtas = deployedMtaDetector.detectDeployedMtasWithoutNamespace(getCloudFoundryClient(spaceGuid));\n         List<Mta> mtas = getMtas(deployedMtas);\n         return ResponseEntity.ok()\n                              .body(mtas);\n     }\n \n     @Override\n     public ResponseEntity<Mta> getMta(String spaceGuid, String mtaId) {\n-        Optional<DeployedMta> optionalDeployedMta = deployedMtaDetector.detectDeployedMta(mtaId, getCloudFoundryClient(spaceGuid), true);\n-        DeployedMta deployedMta = optionalDeployedMta.orElseThrow(() -> new NotFoundException(Messages.MTA_NOT_FOUND, mtaId));\n+        List<DeployedMta> mtas = deployedMtaDetector.detectDeployedMtasByName(mtaId, getCloudFoundryClient(spaceGuid));\n+\n+        if (mtas.isEmpty()) {\n+            throw new NotFoundException(Messages.MTA_NOT_FOUND, mtaId);\n+        }\n+\n+        if (mtas.size() != 1) {", "originalCommit": "1e51f12ae116f3f72a4f750f5e90c970a9fb1f86", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg3MjAzMw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r426872033", "bodyText": "it's more explicit this way", "author": "ikasarov", "createdAt": "2020-05-18T20:20:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDEyNTA1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDEyOTQ0MQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r420129441", "bodyText": "Same comment as above", "author": "theghost5800", "createdAt": "2020-05-05T13:57:04Z", "path": "com.sap.cloud.lm.sl.cf.web/src/main/java/com/sap/cloud/lm/sl/cf/web/api/impl/MtasApiServiceImpl.java", "diffHunk": "@@ -40,18 +45,77 @@\n \n     @Override\n     public ResponseEntity<List<Mta>> getMtas(String spaceGuid) {\n-        List<DeployedMta> deployedMtas = deployedMtaDetector.detectDeployedMtas(getCloudFoundryClient(spaceGuid));\n+        List<DeployedMta> deployedMtas = deployedMtaDetector.detectDeployedMtasWithoutNamespace(getCloudFoundryClient(spaceGuid));\n         List<Mta> mtas = getMtas(deployedMtas);\n         return ResponseEntity.ok()\n                              .body(mtas);\n     }\n \n     @Override\n     public ResponseEntity<Mta> getMta(String spaceGuid, String mtaId) {\n-        Optional<DeployedMta> optionalDeployedMta = deployedMtaDetector.detectDeployedMta(mtaId, getCloudFoundryClient(spaceGuid), true);\n-        DeployedMta deployedMta = optionalDeployedMta.orElseThrow(() -> new NotFoundException(Messages.MTA_NOT_FOUND, mtaId));\n+        List<DeployedMta> mtas = deployedMtaDetector.detectDeployedMtasByName(mtaId, getCloudFoundryClient(spaceGuid));\n+\n+        if (mtas.isEmpty()) {\n+            throw new NotFoundException(Messages.MTA_NOT_FOUND, mtaId);\n+        }\n+\n+        if (mtas.size() != 1) {\n+            throw new ConflictException(Messages.MTA_SEARCH_NOT_UNIQUE_BY_NAME, mtaId);\n+        }\n+\n+        return ResponseEntity.ok()\n+                             .body(getMta(mtas.get(0)));\n+    }\n+\n+    @Override\n+    public ResponseEntity<List<Mta>> getMtas(String spaceGuid, String namespace, String name) {\n+\n+        if (name == null && namespace == null) {\n+            return getAllMtas(spaceGuid);\n+        } else if (namespace == null) {\n+            return getMtasByName(spaceGuid, name);\n+        } else if (name == null) {\n+            return getMtasByNamespace(spaceGuid, namespace);\n+        }\n+\n+        Optional<DeployedMta> optionalDeployedMta = deployedMtaDetector.detectDeployedMtaByNameAndNamespace(name, namespace,\n+                                                                                                            getCloudFoundryClient(spaceGuid),\n+                                                                                                            true);\n+        DeployedMta deployedMta = optionalDeployedMta.orElseThrow(() -> new NotFoundException(Messages.SPECIFIC_MTA_NOT_FOUND,\n+                                                                                              name,\n+                                                                                              namespace));\n+\n+        return ResponseEntity.ok()\n+                             .body(Arrays.asList(getMta(deployedMta)));\n+    }\n+\n+    protected ResponseEntity<List<Mta>> getAllMtas(String spaceGuid) {\n+        List<DeployedMta> deployedMtas = deployedMtaDetector.detectDeployedMtas(getCloudFoundryClient(spaceGuid));\n+\n+        return ResponseEntity.ok()\n+                             .body(getMtas(deployedMtas));\n+    }\n+\n+    protected ResponseEntity<List<Mta>> getMtasByNamespace(String spaceGuid, String namespace) {\n+        List<DeployedMta> deployedMtas = deployedMtaDetector.detectDeployedMtasByNamespace(namespace, getCloudFoundryClient(spaceGuid));\n+\n+        if (deployedMtas.size() == 0) {\n+            throw new NotFoundException(Messages.MTAS_NOT_FOUND_BY_NAMESPACE, namespace);\n+        }\n+\n+        return ResponseEntity.ok()\n+                             .body(getMtas(deployedMtas));\n+    }\n+\n+    protected ResponseEntity<List<Mta>> getMtasByName(String spaceGuid, String name) {\n+        List<DeployedMta> deployedMtas = deployedMtaDetector.detectDeployedMtasByName(name, getCloudFoundryClient(spaceGuid));\n+\n+        if (deployedMtas.size() == 0) {", "originalCommit": "1e51f12ae116f3f72a4f750f5e90c970a9fb1f86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTU1ODMwMw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r421558303", "bodyText": "type in namespacce", "author": "boyan-velinov", "createdAt": "2020-05-07T14:40:02Z", "path": "com.sap.cloud.lm.sl.cf.api/src/main/java/com/sap/cloud/lm/sl/cf/web/api/model/FileMetadata.java", "diffHunk": "@@ -52,23 +53,32 @@\n     public abstract String getSpace();\n \n     @Override\n+    @ApiModelProperty(hidden = true)\n     public String getConfigurationType() {\n         return \"file metadata\";\n     }\n \n     @Override\n+    @ApiModelProperty(hidden = true)\n     public String getConfigurationName() {\n         return getName();\n     }\n \n+    @Nullable\n+    @ApiModelProperty\n+    @JsonProperty(\"namespace\")\n+    public abstract String getNamespace();\n+\n     @Override\n+    @ApiModelProperty(hidden = true)\n     public List<ConfigurationIdentifier> getConfigurationIdentifiers() {\n         List<ConfigurationIdentifier> configurationIdentifiers = new ArrayList<>();\n         configurationIdentifiers.add(new ConfigurationIdentifier(\"id\", getId()));\n         configurationIdentifiers.add(new ConfigurationIdentifier(\"digest\", getDigest()));\n         configurationIdentifiers.add(new ConfigurationIdentifier(\"digestAlgorithm\", getDigestAlgorithm()));\n         configurationIdentifiers.add(new ConfigurationIdentifier(\"space\", getSpace()));\n         configurationIdentifiers.add(new ConfigurationIdentifier(\"size\", Objects.toString(getSize())));\n+        configurationIdentifiers.add(new ConfigurationIdentifier(\"namespacce\", Objects.toString(getNamespace())));", "originalCommit": "1e51f12ae116f3f72a4f750f5e90c970a9fb1f86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQzMTkyMQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424431921", "bodyText": "Do we need V2 in the name of the method. It's already in the name of the class. Having it here as well seems a bit redundant.", "author": "nictas", "createdAt": "2020-05-13T13:21:34Z", "path": "com.sap.cloud.lm.sl.cf.api/src/main/java/com/sap/cloud/lm/sl/cf/web/api/v2/MtasApiV2.java", "diffHunk": "@@ -0,0 +1,49 @@\n+package com.sap.cloud.lm.sl.cf.web.api.v2;\n+\n+import java.util.List;\n+\n+import javax.inject.Inject;\n+\n+import org.springframework.http.MediaType;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RequestParam;\n+import org.springframework.web.bind.annotation.RestController;\n+\n+import com.sap.cloud.lm.sl.cf.web.api.Constants.Endpoints;\n+import com.sap.cloud.lm.sl.cf.web.api.Constants.PathVariables;\n+import com.sap.cloud.lm.sl.cf.web.api.Constants.RequestVariables;\n+import com.sap.cloud.lm.sl.cf.web.api.MtasApiService;\n+import com.sap.cloud.lm.sl.cf.web.api.model.Mta;\n+\n+import io.swagger.annotations.Api;\n+import io.swagger.annotations.ApiOperation;\n+import io.swagger.annotations.ApiParam;\n+import io.swagger.annotations.ApiResponse;\n+import io.swagger.annotations.ApiResponses;\n+import io.swagger.annotations.Authorization;\n+\n+@Api(description = \"mtas API V2\")\n+@RestController\n+@RequestMapping(Endpoints.V2_MTAS)\n+public class MtasApiV2 {\n+\n+    @Inject\n+    private MtasApiService delegate;\n+\n+    @GetMapping(produces = { MediaType.APPLICATION_JSON_VALUE, MediaType.APPLICATION_JSON_UTF8_VALUE })\n+    @ApiOperation(value = \"\", notes = \"Retrieves all Multi-Target Applications in a space \", response = Mta.class, responseContainer = \"List\", authorizations = {\n+        @Authorization(value = \"oauth2\", scopes = {\n+\n+        }) }, tags = {})\n+    @ApiResponses(value = { @ApiResponse(code = 200, message = \"OK\", response = Mta.class, responseContainer = \"List\") })\n+    public ResponseEntity<List<Mta>>\n+           getMtasV2(@ApiParam(value = \"GUID of space with mtas\") @PathVariable(PathVariables.SPACE_GUID) String spaceGuid,", "originalCommit": "b6e66d37be8823da7a463e74c369b607600873c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ0MDUxMw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424440513", "bodyText": "Would it make sense to include the namespace in the DeployedMta object somehow?", "author": "nictas", "createdAt": "2020-05-13T13:33:13Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/HandlerFactory.java", "diffHunk": "@@ -106,14 +106,15 @@ public PlatformMerger getPlatformMerger(Platform platform) {\n \n     @Override\n     public ApplicationCloudModelBuilder getApplicationCloudModelBuilder(DeploymentDescriptor deploymentDescriptor, boolean prettyPrinting,\n-                                                                        DeployedMta deployedMta, String deployId,\n+                                                                        DeployedMta deployedMta, String deployId, String namespace,", "originalCommit": "b6e66d37be8823da7a463e74c369b607600873c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYyODYwNw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424628607", "bodyText": "deployedMta would be null for an initial deployment. Also, it is already included in the metadata, but we cannot rely on it for the reason above", "author": "ikasarov", "createdAt": "2020-05-13T18:00:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ0MDUxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ0NDMzNA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424444334", "bodyText": "Why wouldn't this work? From what I can tell, DeployedMta objects are compared based only on their metadata (the rest of the fields are annotated with @Value.Auxiliary, which means they're not considered in the equals method).", "author": "nictas", "createdAt": "2020-05-13T13:38:25Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/detect/DeployedMtaDetector.java", "diffHunk": "@@ -49,27 +110,23 @@\n         return mtaMetadataEntityAggregator.aggregate(mtaMetadataEntities);\n     }\n \n-    private List<DeployedMta> getDeployedMtasByEnv(CloudControllerClient client, List<DeployedMta> deployedMtas) {\n-        return deployedMtaEnvDetector.detectDeployedMtas(client)\n-                                     .stream()\n-                                     .filter(deployedMtaByEnv -> !deployedMtas.contains(deployedMtaByEnv))\n-                                     .collect(Collectors.toList());\n-    }\n+    /**\n+     * Extra step required for backwards compatibility (see {@link DeployedMtaEnvDetector})\n+     *\n+     * @param mtasByMetadata\n+     * @param mtasByEnv\n+     * @return\n+     */\n+    private List<DeployedMta> combineMetadataAndEnvMtas(List<DeployedMta> mtasByMetadata, List<DeployedMta> mtasByEnv) {\n \n-    public Optional<DeployedMta> detectDeployedMta(String mtaId, CloudControllerClient client, boolean envDetectionEnabled) {\n-        MtaMetadataCriteria selectionCriteria = MtaMetadataCriteriaBuilder.builder()\n-                                                                          .label(MtaMetadataLabels.MTA_ID)\n-                                                                          .haveValue(MtaMetadataUtil.getHashedMtaId(mtaId))\n-                                                                          .build();\n-        List<DeployedMta> deployedMtasByMetadata = getDeployedMtasByMetadataSelectionCriteria(selectionCriteria, client);\n-        if (!deployedMtasByMetadata.isEmpty()) {\n-            return deployedMtasByMetadata.stream()\n-                                         .findFirst();\n-        }\n-        if (envDetectionEnabled) {\n-            return deployedMtaEnvDetector.detectDeployedMta(mtaId, client);\n-        }\n-        return Optional.empty();\n+        List<DeployedMta> missedMtas = mtasByEnv.stream()\n+                                                .filter(mta -> !mtasByMetadata.contains(mta)) // TODO: test how well this", "originalCommit": "b6e66d37be8823da7a463e74c369b607600873c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYyOTMyOQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424629329", "bodyText": "yeah, it actually worked when manual testing, this was more a reminder for me to double-check it", "author": "ikasarov", "createdAt": "2020-05-13T18:01:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ0NDMzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ2MTYxNA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424461614", "bodyText": "What's this? Why do we have the same piece of code in two places? :O", "author": "nictas", "createdAt": "2020-05-13T14:00:59Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/metadata/entity/processor/MtaMetadataEntityAggregator.java", "diffHunk": "@@ -34,49 +35,52 @@ public MtaMetadataEntityAggregator(MtaMetadataParser mtaMetadataParser) {\n \n     public List<DeployedMta> aggregate(List<CloudEntity> entities) {\n         Map<String, List<CloudEntity>> entitiesByMtaId = entities.stream()\n-                                                                 .collect(Collectors.groupingBy(this::getMtaId));\n+                                                                 .collect(Collectors.groupingBy(mtaMetadataParser::parseQualifiedMtaId));\n         return entitiesByMtaId.entrySet()\n                               .stream()\n-                              .map(entry -> toDeployedMta(entry.getKey(), entry.getValue()))\n+                              .map(entry -> toDeployedMta(entry.getValue()))\n                               .collect(Collectors.toList());\n     }\n \n-    private String getMtaId(CloudEntity entity) {\n-        return mtaMetadataParser.parseMtaMetadata(entity)\n-                                .getId();\n-    }\n-\n-    private DeployedMta toDeployedMta(String mtaId, List<CloudEntity> entities) {\n-        Version mtaVersion = getMtaVersion(entities);\n-        MtaMetadata mtaMetadata = getMtaMetadata(mtaId, mtaVersion);\n+    private DeployedMta toDeployedMta(List<CloudEntity> entities) {\n+        MtaMetadata mtaMetadata = getMtaMetadata(entities);\n         List<DeployedMtaApplication> applications = getApplications(entities);\n         List<DeployedMtaService> services = getServices(entities);\n         List<DeployedMtaService> userProvidedServices = getUserProvidedServices(applications, services);\n+        \n         return ImmutableDeployedMta.builder()\n                                    .metadata(mtaMetadata)\n                                    .applications(applications)\n                                    .services(ListUtils.union(services, userProvidedServices))\n                                    .build();\n     }\n \n-    private Version getMtaVersion(List<CloudEntity> entities) {\n+    private MtaMetadata getMtaMetadata(List<CloudEntity> entities) {", "originalCommit": "b6e66d37be8823da7a463e74c369b607600873c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY0NTYwNQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424645605", "bodyText": "good question :D", "author": "ikasarov", "createdAt": "2020-05-13T18:28:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ2MTYxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ2NTQxNA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424465414", "bodyText": "Can't we group based on mtaMetadataParser::parseMtaMetadata?", "author": "nictas", "createdAt": "2020-05-13T14:06:06Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/metadata/entity/processor/MtaMetadataEntityAggregator.java", "diffHunk": "@@ -34,49 +35,52 @@ public MtaMetadataEntityAggregator(MtaMetadataParser mtaMetadataParser) {\n \n     public List<DeployedMta> aggregate(List<CloudEntity> entities) {\n         Map<String, List<CloudEntity>> entitiesByMtaId = entities.stream()\n-                                                                 .collect(Collectors.groupingBy(this::getMtaId));\n+                                                                 .collect(Collectors.groupingBy(mtaMetadataParser::parseQualifiedMtaId));", "originalCommit": "b6e66d37be8823da7a463e74c369b607600873c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYzNjEyMQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424636121", "bodyText": "there is some preexisting logic about parsing versions that can differ between entities, so I assumed I cannot use the whole metadata", "author": "ikasarov", "createdAt": "2020-05-13T18:12:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ2NTQxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ2OTMyMw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424469323", "bodyText": "Why is there an extra check for applications (StringUtils.isNotEmpty(namespace)), but not here?", "author": "nictas", "createdAt": "2020-05-13T14:11:29Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/v2/ServiceMetadataBuilder.java", "diffHunk": "@@ -16,12 +16,15 @@\n \n public class ServiceMetadataBuilder {\n \n-    public static Metadata build(DeploymentDescriptor deploymentDescriptor, Resource resource) {\n-        String hashedMtaId = MtaMetadataUtil.getHashedMtaId(deploymentDescriptor.getId());\n+    public static Metadata build(DeploymentDescriptor deploymentDescriptor, String namespace, Resource resource) {\n+        String hashedMtaId = MtaMetadataUtil.getHashedLabel(deploymentDescriptor.getId());\n+        String hashedNamespace = MtaMetadataUtil.getHashedLabel(namespace);\n         String mtaResourceAnnotation = buildMtaResourceAnnotation(resource);\n         return Metadata.builder()\n                        .label(MtaMetadataLabels.MTA_ID, hashedMtaId)\n+                       .label(MtaMetadataLabels.MTA_NAMESPACE, hashedNamespace)", "originalCommit": "b6e66d37be8823da7a463e74c369b607600873c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ2OTg5Mg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424469892", "bodyText": "I think the old formatting was the correct one. .name and `.builder are not aligned now.", "author": "nictas", "createdAt": "2020-05-13T14:12:15Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/v2/ServicesCloudModelBuilder.java", "diffHunk": "@@ -71,24 +73,25 @@ protected CloudServiceInstanceExtended createManagedService(Resource resource, S\n                                                                 boolean shouldIgnoreUpdateErrors) {\r\n         Map<String, Object> parameters = resource.getParameters();\r\n         SpecialResourceTypesRequiredParametersUtil.checkRequiredParameters(serviceName, ResourceType.MANAGED_SERVICE, parameters);\r\n+        \r\n         return ImmutableCloudServiceInstanceExtended.builder()\r\n-                                                    .name(serviceName)\r\n-                                                    .resourceName(resource.getName())\r\n-                                                    .label((String) parameters.get(SupportedParameters.SERVICE))\r\n-                                                    .plan((String) parameters.get(SupportedParameters.SERVICE_PLAN))\r\n-                                                    .type(ServiceInstanceType.MANAGED)\r\n-                                                    .provider((String) parameters.get(SupportedParameters.SERVICE_PROVIDER))\r\n-                                                    .version((String) parameters.get(SupportedParameters.SERVICE_VERSION))\r\n-                                                    .tags((List<String>) parameters.getOrDefault(SupportedParameters.SERVICE_TAGS,\r\n-                                                                                                 Collections.emptyList()))\r\n-                                                    .credentials(getServiceParameters(serviceName, parameters))\r\n-                                                    .alternativeLabels((List<String>) parameters.getOrDefault(SupportedParameters.SERVICE_ALTERNATIVES,\r\n-                                                                                                              Collections.emptyList()))\r\n-                                                    .isOptional(isOptional)\r\n-                                                    .isManaged(true)\r\n-                                                    .shouldIgnoreUpdateErrors(shouldIgnoreUpdateErrors)\r\n-                                                    .v3Metadata(ServiceMetadataBuilder.build(deploymentDescriptor, resource))\r\n-                                                    .build();\r\n+                                            .name(serviceName)\r", "originalCommit": "b6e66d37be8823da7a463e74c369b607600873c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ3NDU2Mg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424474562", "bodyText": "Put this below the matches method so that the class reads more naturally.", "author": "nictas", "createdAt": "2020-05-13T14:18:21Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/model/ConfigurationFilter.java", "diffHunk": "@@ -57,6 +60,22 @@ public String getProviderId() {\n     public boolean isStrictTargetSpace() {\n         return strictTargetSpace;\n     }\n+    \n+    public String getProviderNamespace() {\n+        return providerNamespace;\n+    }\n+\n+    private boolean namespaceConstraintIsSatisfied(String providerNamespace) {", "originalCommit": "b6e66d37be8823da7a463e74c369b607600873c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ4MjIwOQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424482209", "bodyText": "This whole isEmpty and considerNullAsEmpty takes too many brain cells to comprehend. Can we make the column non-nullable and add \"default\" everywhere when creating it? Would this save us from this complexity?", "author": "nictas", "createdAt": "2020-05-13T14:28:10Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/persistence/query/impl/ConfigurationEntryQueryImpl.java", "diffHunk": "@@ -80,6 +81,31 @@ public ConfigurationEntryQuery providerId(String providerId) {\n         return this;\n     }\n \n+    @Override\n+    public ConfigurationEntryQuery providerNamespace(String providerNamespace, boolean considerNullAsEmpty) {\n+        boolean shouldFilterForEmptyNamespace = ConfigurationEntriesUtil.providerNamespaceIsEmpty(providerNamespace, considerNullAsEmpty);\n+\n+        if (providerNamespace == null && !shouldFilterForEmptyNamespace) {", "originalCommit": "b6e66d37be8823da7a463e74c369b607600873c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk4MzM5MQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r425983391", "bodyText": "I agree it is too complex in the code, but it isn't directly related to whether we save null values in the database. Would removing the 'considerNullAsEmpty' flag and passing 'default' constant as namespace solve this?", "author": "ikasarov", "createdAt": "2020-05-15T18:43:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ4MjIwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ4MzgxNw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424483817", "bodyText": "This method does not belong in this class. Also, check whether MapUtils.getBoolean would work for you.", "author": "nictas", "createdAt": "2020-05-13T14:30:16Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/util/NameUtil.java", "diffHunk": "@@ -36,28 +41,29 @@ private NameRequirements() {\n     private NameUtil() {\n     }\n \n-    public static String getNamespacePrefix(String namespace) {\n-        return namespace + \".\";\n+    public static boolean isValidName(String name, String namePattern) {\n+        return name.matches(namePattern);\n     }\n \n-    public static String getWithoutNamespacePrefix(String name) {\n-        int i = name.lastIndexOf('.');\n-        return (i >= 0) ? name.substring(i + 1) : name;\n+    public static Boolean parseBooleanFlag(final Map<String, Object> parameters, String flagName) throws ContentException {", "originalCommit": "b6e66d37be8823da7a463e74c369b607600873c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ4NzkyOQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424487929", "bodyText": "Why not add the prefix before applying getNameWithProperLength? With the current piece of code if I supply a long enough namespace I'd get a new SLException(Messages.CANNOT_SHORTEN_NAME_TO_N_CHARACTERS, name, maxLength); because maxLength - prefix.length() would be a negative number.", "author": "nictas", "createdAt": "2020-05-13T14:35:39Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/util/NameUtil.java", "diffHunk": "@@ -89,6 +95,18 @@ public static String getNameWithProperLength(String name, int maxLength) {\n         return name;\n     }\n \n+    private static String computeNamespacedNameWithLength(String name, String namespace, boolean applyNamespace, int maxLength) {\n+        String prefix = \"\";\n+        if (StringUtils.isNotEmpty(namespace) && applyNamespace) {\n+            prefix = getNamespacePrefix(namespace);\n+        }\n+        return prefix + getNameWithProperLength(name, maxLength - prefix.length());", "originalCommit": "b6e66d37be8823da7a463e74c369b607600873c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjYyMzkzOA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r426623938", "bodyText": "if we add the prefix before - this could lead to the prefix also getting hashed for long prefixes; I agree the length exception is a bad way to notify the user though", "author": "ikasarov", "createdAt": "2020-05-18T13:25:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ4NzkyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODAzNzY4Mg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r428037682", "bodyText": "prefix is now passed as part of name so it will be possible to hash longer namespace-name strings but also hash the namespace itself", "author": "ikasarov", "createdAt": "2020-05-20T14:02:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ4NzkyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ5MDM0MQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424490341", "bodyText": "Can we use MapUtil.getBoolean(relatedParameters, SupportedParameters.APPLY_NAMESPACE, applyNamespaceGlobal);. That way we shouldn't even need the NameUtil.resolveApplyNamespaceFlag method.", "author": "nictas", "createdAt": "2020-05-13T14:38:45Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/validators/parameters/ApplicationNameValidator.java", "diffHunk": "@@ -38,11 +41,20 @@ public boolean canCorrect() {\n     }\n \n     @Override\n-    public Object attemptToCorrect(Object applicationName) {\n+    public Object attemptToCorrect(Object applicationName, final Map<String, Object> relatedParameters) {\n         if (!(applicationName instanceof String)) {\n             throw new ContentException(Messages.COULD_NOT_CREATE_VALID_APPLICATION_NAME_FROM_0, applicationName);\n         }\n-        return NameUtil.computeValidApplicationName((String) applicationName, namespace, useNamespaces);\n+\n+        Boolean applyNamespaceLocal = NameUtil.parseBooleanFlag(relatedParameters, SupportedParameters.APPLY_NAMESPACE);\n+        boolean applyNamespace = NameUtil.resolveApplyNamespaceFlag(applyNamespaceGlobal, applyNamespaceLocal);", "originalCommit": "b6e66d37be8823da7a463e74c369b607600873c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjY0NTEwOA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r426645108", "bodyText": "the MapUtil method does some additional parsing (\"1\" would be considered as true); also resolve method is needed because the global value isn't simply a default e.g.: global values of 'false' and an excplicit local value of 'true' -> this should be resolved to 'false'", "author": "ikasarov", "createdAt": "2020-05-18T13:56:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ5MDM0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDUwMzM0NQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424503345", "bodyText": "The pattern we have so far is to use camel case for variable names.", "author": "nictas", "createdAt": "2020-05-13T14:55:01Z", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/variables/Variables.java", "diffHunk": "@@ -74,6 +74,13 @@\n     Variable<String> MTA_ID = ImmutableSimpleVariable.<String> builder()\n                                                      .name(\"mtaId\")\n                                                      .build();\n+    Variable<String> MTA_NAMESPACE = ImmutableSimpleVariable.<String> builder()\n+                                                            .name(\"namespace\")\n+                                                            .build();\n+    Variable<Boolean> APPLY_NAMESPACE = ImmutableSimpleVariable.<Boolean> builder()\n+                                                                           .name(\"apply-namespace\")", "originalCommit": "b6e66d37be8823da7a463e74c369b607600873c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDUwMzc3Ng==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424503776", "bodyText": "Why not Variables.APPLY_NAMESPACE.getDefaultValue()?", "author": "nictas", "createdAt": "2020-05-13T14:55:29Z", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/metadata/DeployMetadata.java", "diffHunk": "@@ -34,14 +34,13 @@\n                                              .defaultValue(Variables.START_TIMEOUT.getDefaultValue())\r\n                                              .build());\r\n         PARAMS.add(ImmutableParameterMetadata.builder()\r\n-                                             .id(Variables.USE_NAMESPACES.getName())\r\n-                                             .type(ParameterType.BOOLEAN)\r\n-                                             .defaultValue(Variables.USE_NAMESPACES.getDefaultValue())\r\n+                                             .id(Variables.MTA_NAMESPACE.getName())\r\n+                                             .type(ParameterType.STRING)\r\n                                              .build());\r\n         PARAMS.add(ImmutableParameterMetadata.builder()\r\n-                                             .id(Variables.USE_NAMESPACES_FOR_SERVICES.getName())\r\n+                                             .id(Variables.APPLY_NAMESPACE.getName())\r\n                                              .type(ParameterType.BOOLEAN)\r\n-                                             .defaultValue(Variables.USE_NAMESPACES_FOR_SERVICES.getDefaultValue())\r\n+                                             .defaultValue(false)\r", "originalCommit": "b6e66d37be8823da7a463e74c369b607600873c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkwNDY5OA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424904698", "bodyText": "Inconsistent naming. It should be \"configuration entries\" and not \"config entries\".", "author": "nictas", "createdAt": "2020-05-14T06:44:24Z", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/DeleteDiscontinuedConfigurationEntriesForAppStep.java", "diffHunk": "@@ -92,24 +106,8 @@ private DeployedMtaApplication getDeployedMtaApplication(CloudApplication existi\n         return envMtaMetadataParser.parseDeployedMtaApplication(existingApp);\n     }\n \n-    @Override\n-    protected String getStepErrorMessage(ProcessContext context) {\n-        return MessageFormat.format(Messages.ERROR_DELETING_DISCONTINUED_CONFIGURATION_ENTRIES_FOR_APP,\n-                                    context.getVariable(Variables.EXISTING_APP)\n-                                           .getName());\n-    }\n-\n-    private List<ConfigurationEntry> getEntriesToDelete(String mtaId, String mtaVersion, CloudTarget target,\n-                                                        List<String> providedDependencyNames, List<ConfigurationEntry> publishedEntries) {\n-        List<ConfigurationEntry> entriesForCurrentMta = getEntries(mtaId, mtaVersion, target);\n-        List<ConfigurationEntry> entriesForCurrentModule = getConfigurationEntriesWithProviderIds(entriesForCurrentMta,\n-                                                                                                  getProviderIds(mtaId,\n-                                                                                                                 providedDependencyNames));\n-        return getEntriesNotUpdatedByThisProcess(entriesForCurrentModule, publishedEntries);\n-    }\n-\n-    private List<ConfigurationEntry> getEntriesNotUpdatedByThisProcess(List<ConfigurationEntry> entriesForCurrentModule,\n-                                                                       List<ConfigurationEntry> publishedEntries) {\n+    private List<ConfigurationEntry> getConfigEntriesNotUpdatedByThisProcess(List<ConfigurationEntry> entriesForCurrentModule,", "originalCommit": "b6e66d37be8823da7a463e74c369b607600873c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkwODIyNA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424908224", "bodyText": "I think it would be more consistent if the message said `MTAs with name \"{0}\" do not exist\".", "author": "nictas", "createdAt": "2020-05-14T06:52:22Z", "path": "com.sap.cloud.lm.sl.cf.web/src/main/java/com/sap/cloud/lm/sl/cf/web/Messages.java", "diffHunk": "@@ -18,6 +18,10 @@\n \r\n     // ERROR log messages\r\n     public static final String MTA_NOT_FOUND = \"MTA with id \\\"{0}\\\" does not exist\";\r\n+    public static final String MTAS_NOT_FOUND_BY_NAME = \"MTAs with name \\\"{0}\\\" not found\";\r", "originalCommit": "b6e66d37be8823da7a463e74c369b607600873c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkwODI5OQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424908299", "bodyText": "I think it would be more consistent if the message said `MTAs with namespace \"{0}\" do not exist\".", "author": "nictas", "createdAt": "2020-05-14T06:52:30Z", "path": "com.sap.cloud.lm.sl.cf.web/src/main/java/com/sap/cloud/lm/sl/cf/web/Messages.java", "diffHunk": "@@ -18,6 +18,10 @@\n \r\n     // ERROR log messages\r\n     public static final String MTA_NOT_FOUND = \"MTA with id \\\"{0}\\\" does not exist\";\r\n+    public static final String MTAS_NOT_FOUND_BY_NAME = \"MTAs with name \\\"{0}\\\" not found\";\r\n+    public static final String MTAS_NOT_FOUND_BY_NAMESPACE = \"MTAs with namespace \\\"{0}\\\" not found\";\r", "originalCommit": "b6e66d37be8823da7a463e74c369b607600873c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkwODgwMA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424908800", "bodyText": "We're trying not to use anything from Guava, since it's just a transitive dependency coming from JClouds.", "author": "nictas", "createdAt": "2020-05-14T06:53:36Z", "path": "com.sap.cloud.lm.sl.cf.web/src/main/java/com/sap/cloud/lm/sl/cf/web/api/impl/MtasApiServiceImpl.java", "diffHunk": "@@ -1,15 +1,18 @@\n package com.sap.cloud.lm.sl.cf.web.api.impl;\n \n+import java.util.Arrays;\n import java.util.List;\n import java.util.Optional;\n import java.util.stream.Collectors;\n \n import javax.inject.Inject;\n import javax.inject.Named;\n \n+import org.apache.commons.collections4.ListUtils;\n import org.cloudfoundry.client.lib.CloudControllerClient;\n import org.springframework.http.ResponseEntity;\n \n+import com.google.common.collect.Lists;", "originalCommit": "b6e66d37be8823da7a463e74c369b607600873c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkxMTQzOA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424911438", "bodyText": "I think this should be in the Resources class above. There should also be a SPACE_V2 constant.", "author": "nictas", "createdAt": "2020-05-14T06:59:24Z", "path": "com.sap.cloud.lm.sl.cf.api/src/main/java/com/sap/cloud/lm/sl/cf/web/api/Constants.java", "diffHunk": "@@ -62,7 +63,7 @@ private Endpoints() {\n         public static final String OPERATION_LOGS = OPERATION + \"/logs\";\n         public static final String OPERATION_LOG_CONTENT = OPERATION_LOGS + \"/{\" + PathVariables.LOG_ID + \"}/content\";\n         public static final String OPERATION_ACTIONS = OPERATION + \"/actions\";\n-        public static final String V2_MTAS = \"/api/v2/spaces/{\" + PathVariables.SPACE_GUID + \"}/mtas\";\n+        public static final String MTAS_V2 = Resources.ROOT_V2 + \"/spaces/{\" + PathVariables.SPACE_GUID + \"}/mtas\";", "originalCommit": "1e51f12ae116f3f72a4f750f5e90c970a9fb1f86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkxMzA1OQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r424913059", "bodyText": "Wrong import.", "author": "nictas", "createdAt": "2020-05-14T07:02:59Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/v2/ServiceMetadataBuilder.java", "diffHunk": "@@ -14,20 +15,27 @@\n import com.sap.cloud.lm.sl.mta.model.DeploymentDescriptor;\n import com.sap.cloud.lm.sl.mta.model.Resource;\n \n+import io.micrometer.core.instrument.util.StringUtils;", "originalCommit": "e55027369461e1048c9379ef25656df48eb9877d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzgyNTk1NQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r427825955", "bodyText": "There is a typo namespacce . Why Objects.toString was removed?", "author": "theghost5800", "createdAt": "2020-05-20T08:19:57Z", "path": "com.sap.cloud.lm.sl.cf.api/src/main/java/com/sap/cloud/lm/sl/cf/web/api/model/FileMetadata.java", "diffHunk": "@@ -78,7 +78,7 @@ public String getConfigurationName() {\n         configurationIdentifiers.add(new ConfigurationIdentifier(\"digestAlgorithm\", getDigestAlgorithm()));\n         configurationIdentifiers.add(new ConfigurationIdentifier(\"space\", getSpace()));\n         configurationIdentifiers.add(new ConfigurationIdentifier(\"size\", Objects.toString(getSize())));\n-        configurationIdentifiers.add(new ConfigurationIdentifier(\"namespacce\", Objects.toString(getNamespace())));\n+        configurationIdentifiers.add(new ConfigurationIdentifier(\"namespacce\", getNamespace()));", "originalCommit": "96da098800aaf884f2c1d4724a41b1c68043f88c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA0NDM1MA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r428044350", "bodyText": "Objects.toString was unneeded, since it is a String to start with, was a copy-paste error", "author": "ikasarov", "createdAt": "2020-05-20T14:11:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzgyNTk1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg0Mjc1MA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r427842750", "bodyText": "Reminder to add unit tests and remove this TODO comment", "author": "theghost5800", "createdAt": "2020-05-20T08:46:07Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/metadata/entity/processor/MtaMetadataEntityAggregator.java", "diffHunk": "@@ -25,7 +25,7 @@\n @Named\n public class MtaMetadataEntityAggregator {\n \n-    //TODO: write unit tests for this and detectors\n+    // TODO: write unit tests for this and detectors", "originalCommit": "96da098800aaf884f2c1d4724a41b1c68043f88c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg0NTc4Mg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r427845782", "bodyText": "Why access modifier was changed to public?", "author": "theghost5800", "createdAt": "2020-05-20T08:50:27Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/metadata/entity/processor/MtaMetadataEntityAggregator.java", "diffHunk": "@@ -43,23 +43,23 @@ public MtaMetadataEntityAggregator(MtaMetadataParser mtaMetadataParser) {\n     }\n \n     private DeployedMta toDeployedMta(List<CloudEntity> entities) {\n-        MtaMetadata mtaMetadata = getMtaMetadata(entities);\n+        MtaMetadata mtaMetadata = aggregateMetadata(entities);\n         List<DeployedMtaApplication> applications = getApplications(entities);\n         List<DeployedMtaService> services = getServices(entities);\n         List<DeployedMtaService> userProvidedServices = getUserProvidedServices(applications, services);\n-        \n+\n         return ImmutableDeployedMta.builder()\n                                    .metadata(mtaMetadata)\n                                    .applications(applications)\n                                    .services(ListUtils.union(services, userProvidedServices))\n                                    .build();\n     }\n \n-    private MtaMetadata getMtaMetadata(List<CloudEntity> entities) {\n+    public MtaMetadata aggregateMetadata(List<CloudEntity> entities) {", "originalCommit": "96da098800aaf884f2c1d4724a41b1c68043f88c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg3NDQ2NA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r427874464", "bodyText": "I think this method belongs to MapUtil class in package com.sap.cloud.lm.sl.common.util", "author": "theghost5800", "createdAt": "2020-05-20T09:35:59Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/util/CloudModelBuilderUtil.java", "diffHunk": "@@ -63,6 +65,20 @@ public static ApplicationColor getApplicationColor(DeployedMtaApplication deploy\n                      .orElse(COLOR_OF_APPLICATIONS_WITHOUT_SUFFIX);\r\n     }\r\n \r\n+    public static boolean parseBooleanFlag(final Map<String, Object> parameters, String flagName, boolean defaultValue) throws ContentException {\r", "originalCommit": "96da098800aaf884f2c1d4724a41b1c68043f88c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg4MTg3NQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r427881875", "bodyText": "I mean using of Function.identity() from java.util.function package. Sorry for my previous typo.", "author": "theghost5800", "createdAt": "2020-05-20T09:48:07Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/validators/parameters/ParametersValidatorHelper.java", "diffHunk": "@@ -8,6 +8,7 @@\n import java.util.TreeMap;\n import java.util.stream.Collectors;\n \n+import com.google.common.base.Functions;", "originalCommit": "96da098800aaf884f2c1d4724a41b1c68043f88c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA3MDQzMw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r428070433", "bodyText": "sorry for not thinking it through properly", "author": "ikasarov", "createdAt": "2020-05-20T14:44:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg4MTg3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg4OTcwOA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r427889708", "bodyText": "Can you refactor this test using Parameterized and MethodSource annotations from junit5?", "author": "theghost5800", "createdAt": "2020-05-20T10:00:48Z", "path": "com.sap.cloud.lm.sl.cf.core/src/test/java/com/sap/cloud/lm/sl/cf/core/cf/v2/ConfigurationEntriesCloudModelBuilderTest.java", "diffHunk": "@@ -74,7 +80,7 @@ public void parseDeploymentDescriptor() {\n \n     @Test\n     public void testBuild() {\n-        ConfigurationEntriesCloudModelBuilder builder = new ConfigurationEntriesCloudModelBuilder(orgName, spaceName, \"\");\n+        ConfigurationEntriesCloudModelBuilder builder = new ConfigurationEntriesCloudModelBuilder(orgName, spaceName, \"\", namespace);", "originalCommit": "96da098800aaf884f2c1d4724a41b1c68043f88c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg5NDI2Mg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r427894262", "bodyText": "Why we need to print something in console?", "author": "theghost5800", "createdAt": "2020-05-20T10:08:32Z", "path": "com.sap.cloud.lm.sl.cf.core/src/test/java/com/sap/cloud/lm/sl/cf/core/persistence/service/ConfigurationEntryServiceTest.java", "diffHunk": "@@ -131,19 +159,33 @@ private void addConfigurationEntries(List<ConfigurationEntry> entries) {\n         entries.forEach(configurationEntryService::add);\n     }\n \n+    private void assertThereAndDeleteEntries(List<ConfigurationEntry> entries,\n+                                             ConfigurationEntryQueryBuilder configurationEntryQueryBuilder) {\n+        for (ConfigurationEntry entry : entries) {\n+            assertConfigurationEntryExists(entry.getId());\n+            System.out.println(String.format(\"Id %s is here\", entry.getId()));", "originalCommit": "96da098800aaf884f2c1d4724a41b1c68043f88c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg5NjYxOA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r427896618", "bodyText": "Use import from juni5 org.junit.jupiter.api", "author": "theghost5800", "createdAt": "2020-05-20T10:12:50Z", "path": "com.sap.cloud.lm.sl.cf.core/src/test/java/com/sap/cloud/lm/sl/cf/core/util/CloudModelBuilderUtilTest.java", "diffHunk": "@@ -0,0 +1,40 @@\n+package com.sap.cloud.lm.sl.cf.core.util;\n+\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.junit.Test;", "originalCommit": "96da098800aaf884f2c1d4724a41b1c68043f88c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg5Njc3OA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r427896778", "bodyText": "Use assertTrue from org.junit.jupiter.api.Assertions", "author": "theghost5800", "createdAt": "2020-05-20T10:13:09Z", "path": "com.sap.cloud.lm.sl.cf.core/src/test/java/com/sap/cloud/lm/sl/cf/core/util/CloudModelBuilderUtilTest.java", "diffHunk": "@@ -0,0 +1,40 @@\n+package com.sap.cloud.lm.sl.cf.core.util;\n+\n+import static org.junit.Assert.assertTrue;", "originalCommit": "96da098800aaf884f2c1d4724a41b1c68043f88c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg5NzYzNw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r427897637", "bodyText": "This test could be refactored to Parameterized test using junit5 api", "author": "theghost5800", "createdAt": "2020-05-20T10:14:56Z", "path": "com.sap.cloud.lm.sl.cf.core/src/test/java/com/sap/cloud/lm/sl/cf/core/util/NameUtilTest.java", "diffHunk": "@@ -81,4 +81,25 @@ public void testCreateValidXsAppName() {\n         assertTrue(NameUtil.isValidName(xsAppName3, NameRequirements.XS_APP_NAME_PATTERN));\n     }\n \n+    @Test", "originalCommit": "96da098800aaf884f2c1d4724a41b1c68043f88c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg5ODc3MQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r427898771", "bodyText": "For single key-value pair, you can use asMap method from MapUtil class in com.sap.cloud.lm.sl.common.util", "author": "theghost5800", "createdAt": "2020-05-20T10:17:01Z", "path": "com.sap.cloud.lm.sl.cf.core/src/test/java/com/sap/cloud/lm/sl/cf/core/validators/parameters/ApplicationNameValidatorTest.java", "diffHunk": "@@ -17,48 +20,66 @@\n \n     private static final String NAMESPACE = \"foo\";\n     private static final String APPLICATION_NAME = \"bar\";\n+    private static final Map<String, Object> CONTEXT_APPLY_NAMESPACE = new HashMap() {\n+        {\n+            put(SupportedParameters.APPLY_NAMESPACE, new Boolean(true));", "originalCommit": "96da098800aaf884f2c1d4724a41b1c68043f88c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg5ODkzMg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r427898932", "bodyText": "same comment", "author": "theghost5800", "createdAt": "2020-05-20T10:17:21Z", "path": "com.sap.cloud.lm.sl.cf.core/src/test/java/com/sap/cloud/lm/sl/cf/core/validators/parameters/ApplicationNameValidatorTest.java", "diffHunk": "@@ -17,48 +20,66 @@\n \n     private static final String NAMESPACE = \"foo\";\n     private static final String APPLICATION_NAME = \"bar\";\n+    private static final Map<String, Object> CONTEXT_APPLY_NAMESPACE = new HashMap() {\n+        {\n+            put(SupportedParameters.APPLY_NAMESPACE, new Boolean(true));\n+        }\n+    };\n+    private static final Map<String, Object> CONTEXT_DO_NOT_APPLY_NAMESPACE = new HashMap() {\n+        {\n+            put(SupportedParameters.APPLY_NAMESPACE, new Boolean(false));", "originalCommit": "96da098800aaf884f2c1d4724a41b1c68043f88c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzkwNzA1NQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r427907055", "bodyText": "Same comment like in ApplicationNameValidatorTest", "author": "theghost5800", "createdAt": "2020-05-20T10:32:03Z", "path": "com.sap.cloud.lm.sl.cf.core/src/test/java/com/sap/cloud/lm/sl/cf/core/validators/parameters/ServiceNameValidatorTest.java", "diffHunk": "@@ -17,50 +20,58 @@\n \n     private static final String NAMESPACE = \"foo\";\n     private static final String SERVICE_NAME = \"bar\";\n+    private static final Map<String, Object> CONTEXT_APPLY_NAMESPACE = new HashMap() {\n+        {\n+            put(SupportedParameters.APPLY_NAMESPACE, new Boolean(true));", "originalCommit": "96da098800aaf884f2c1d4724a41b1c68043f88c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzkwNzA5OQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r427907099", "bodyText": "Same comment like in ApplicationNameValidatorTest", "author": "theghost5800", "createdAt": "2020-05-20T10:32:08Z", "path": "com.sap.cloud.lm.sl.cf.core/src/test/java/com/sap/cloud/lm/sl/cf/core/validators/parameters/ServiceNameValidatorTest.java", "diffHunk": "@@ -17,50 +20,58 @@\n \n     private static final String NAMESPACE = \"foo\";\n     private static final String SERVICE_NAME = \"bar\";\n+    private static final Map<String, Object> CONTEXT_APPLY_NAMESPACE = new HashMap() {\n+        {\n+            put(SupportedParameters.APPLY_NAMESPACE, new Boolean(true));\n+        }\n+    };\n+    private static final Map<String, Object> CONTEXT_DO_NOT_APPLY_NAMESPACE = new HashMap() {\n+        {\n+            put(SupportedParameters.APPLY_NAMESPACE, new Boolean(false));", "originalCommit": "96da098800aaf884f2c1d4724a41b1c68043f88c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzkxNTgxNg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r427915816", "bodyText": "You can also change name of constants", "author": "theghost5800", "createdAt": "2020-05-20T10:49:16Z", "path": "com.sap.cloud.lm.sl.cf.web/src/main/java/com/sap/cloud/lm/sl/cf/web/Messages.java", "diffHunk": "@@ -18,8 +18,8 @@\n \r\n     // ERROR log messages\r\n     public static final String MTA_NOT_FOUND = \"MTA with id \\\"{0}\\\" does not exist\";\r\n-    public static final String MTAS_NOT_FOUND_BY_NAME = \"MTAs with name \\\"{0}\\\" not found\";\r\n-    public static final String MTAS_NOT_FOUND_BY_NAMESPACE = \"MTAs with namespace \\\"{0}\\\" not found\";\r\n+    public static final String MTAS_NOT_FOUND_BY_NAME = \"MTAs with name \\\"{0}\\\" do not exist\";\r", "originalCommit": "96da098800aaf884f2c1d4724a41b1c68043f88c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDIxMzY1OQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r430213659", "bodyText": "Does it mean that namespace passed in the method is already hashed?", "author": "theghost5800", "createdAt": "2020-05-26T07:38:12Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/v2/ServiceMetadataBuilder.java", "diffHunk": "@@ -15,13 +16,10 @@\n import com.sap.cloud.lm.sl.mta.model.DeploymentDescriptor;\n import com.sap.cloud.lm.sl.mta.model.Resource;\n \n-import io.micrometer.core.instrument.util.StringUtils;\n-\n public class ServiceMetadataBuilder {\n \n     public static Metadata build(DeploymentDescriptor deploymentDescriptor, String namespace, Resource resource) {\n         String hashedMtaId = MtaMetadataUtil.getHashedLabel(deploymentDescriptor.getId());\n-        String hashedNamespace = MtaMetadataUtil.getHashedLabel(namespace);", "originalCommit": "ffe4c3112f00efe8304e52740d72f18d5a519366", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDIyNjY0NQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/849#discussion_r430226645", "bodyText": "get hashed namespace logic is moved", "author": "theghost5800", "createdAt": "2020-05-26T08:00:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDIxMzY1OQ=="}], "type": "inlineReview"}, {"oid": "e5d76a57f79dae9c1626b50713ff70eb57db6831", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/e5d76a57f79dae9c1626b50713ff70eb57db6831", "message": "adding automatic generation of swagger definition, result committed under \"resources/mtarest.yaml\" and \"resources/mtarest_v2.yaml\"", "committedDate": "2020-06-01T16:20:45Z", "type": "forcePushed"}, {"oid": "73b9499f7b4ec2e827461497c604d0b827b818cc", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/73b9499f7b4ec2e827461497c604d0b827b818cc", "message": "adding automatic generation of swagger definition, result committed under \"resources/mtarest.yaml\" and \"resources/mtarest_v2.yaml\"", "committedDate": "2020-06-11T15:10:22Z", "type": "forcePushed"}, {"oid": "3fa6b5b7f80950868445e1ba35e78b54a308a40a", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/3fa6b5b7f80950868445e1ba35e78b54a308a40a", "message": "switched pom indentation to spaces", "committedDate": "2020-06-16T16:13:18Z", "type": "forcePushed"}, {"oid": "754eb8e6695a1b507212b02f8d82c97b493abf63", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/754eb8e6695a1b507212b02f8d82c97b493abf63", "message": "Namespace logic added to mta processing; configuration resources\nrest API changes to v1, added v2", "committedDate": "2020-06-18T07:47:25Z", "type": "commit"}, {"oid": "294074fcfee2bf08bd84011315a3e7f774a27417", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/294074fcfee2bf08bd84011315a3e7f774a27417", "message": "adding automatic generation of swagger definition, result committed under \"resources/mtarest.yaml\" and \"resources/mtarest_v2.yaml\"", "committedDate": "2020-06-18T07:47:25Z", "type": "commit"}, {"oid": "43b356413e393d58ee96b6e4415086a7115546dc", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/43b356413e393d58ee96b6e4415086a7115546dc", "message": "switched pom indentation to spaces", "committedDate": "2020-06-18T07:48:53Z", "type": "commit"}, {"oid": "43b356413e393d58ee96b6e4415086a7115546dc", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/43b356413e393d58ee96b6e4415086a7115546dc", "message": "switched pom indentation to spaces", "committedDate": "2020-06-18T07:48:53Z", "type": "forcePushed"}]}