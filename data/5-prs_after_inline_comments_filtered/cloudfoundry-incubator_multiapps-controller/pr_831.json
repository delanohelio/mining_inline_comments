{"pr_number": 831, "pr_title": "Fix check for dependency satisfaction", "pr_createdAt": "2020-04-07T11:45:49Z", "pr_url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/831", "timeline": [{"oid": "d8278e92425545f4cdcf9781200c9da1184b6856", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/d8278e92425545f4cdcf9781200c9da1184b6856", "message": "Fix check for dependency satisfaction\n\nMake ModuleDependencyChecker verify that a module is either in the\ndeployed modules or in the modules not for deployment. Add a check in\nComputeNextModulesStep for possible infinite loop as safe mechanism.\nJIRA: LMCROSSITXSADEPLOY-2010", "committedDate": "2020-04-07T11:58:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc1MzUyMA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/831#discussion_r404753520", "bodyText": "Rather than using the negate() method, change isProcessed() to accept a parameter and return a boolean then negate that function", "author": "radito3", "createdAt": "2020-04-07T12:01:24Z", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/util/ModuleDependencyChecker.java", "diffHunk": "@@ -82,4 +83,20 @@ private boolean areAllDependenciesAlreadyPresent(List<String> deployedAfter) {\n     public Set<String> getAlreadyDeployedModules() {\n         return modulesAlreadyDeployed;\n     }\n+\n+    public Set<String> getNotProcessedModules() {\n+        return modulesForDeployment.stream()\n+                                   .filter(isProcessed().negate())", "originalCommit": "d8278e92425545f4cdcf9781200c9da1184b6856", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc1Mzk2Nw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/831#discussion_r404753967", "bodyText": "That way you can use a method reference here", "author": "radito3", "createdAt": "2020-04-07T12:02:14Z", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/util/ModuleDependencyChecker.java", "diffHunk": "@@ -82,4 +83,20 @@ private boolean areAllDependenciesAlreadyPresent(List<String> deployedAfter) {\n     public Set<String> getAlreadyDeployedModules() {\n         return modulesAlreadyDeployed;\n     }\n+\n+    public Set<String> getNotProcessedModules() {\n+        return modulesForDeployment.stream()\n+                                   .filter(isProcessed().negate())\n+                                   .collect(Collectors.toSet());\n+    }\n+\n+    private boolean areDependenciesProcessed(Module module) {\n+        return module.getDeployedAfter()\n+                     .stream()\n+                     .allMatch(isProcessed());", "originalCommit": "d8278e92425545f4cdcf9781200c9da1184b6856", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc1NjYxMQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/831#discussion_r404756611", "bodyText": "\"Dependencies can't be satisfied\" is too generic. An error message should be as descriptive as possible", "author": "radito3", "createdAt": "2020-04-07T12:07:28Z", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/Messages.java", "diffHunk": "@@ -61,6 +61,7 @@\n     public static final String APPLICATION_UNBOUND_IN_PARALLEL = \"Application {0} was bound to service {1} which was unbound in parallel\";\r\n     public static final String ABORT_OPERATION_TIMED_OUT = \"Abort operation timed out\";\r\n     public static final String FLOWABLE_JOB_RETRY_FAILED = \"Flowable job retry failed\";\r\n+    public static final String DEPENDENCIES_CANNOT_BE_SATISFIED = \"Dependencies for modules {0} cannot be satisfied\";\r", "originalCommit": "d8278e92425545f4cdcf9781200c9da1184b6856", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0f3b3f843a3d5cb616c75a441cbe6c0208ef9d8b", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/0f3b3f843a3d5cb616c75a441cbe6c0208ef9d8b", "message": "Fix check for dependency satisfaction\n\nMake ModuleDependencyChecker verify that a module is either in the\ndeployed modules or in the modules not for deployment.\nJIRA: LMCROSSITXSADEPLOY-2010", "committedDate": "2020-04-07T12:32:13Z", "type": "commit"}, {"oid": "0f3b3f843a3d5cb616c75a441cbe6c0208ef9d8b", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/0f3b3f843a3d5cb616c75a441cbe6c0208ef9d8b", "message": "Fix check for dependency satisfaction\n\nMake ModuleDependencyChecker verify that a module is either in the\ndeployed modules or in the modules not for deployment.\nJIRA: LMCROSSITXSADEPLOY-2010", "committedDate": "2020-04-07T12:32:13Z", "type": "forcePushed"}]}