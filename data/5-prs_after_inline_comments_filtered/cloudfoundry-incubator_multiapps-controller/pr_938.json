{"pr_number": 938, "pr_title": "Adds text attribute converter to limit strings to 4000 characters", "pr_createdAt": "2020-08-26T14:44:47Z", "pr_url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/938", "timeline": [{"oid": "6170dc036cdca789df7562d837b759d7fb2e0e05", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/6170dc036cdca789df7562d837b759d7fb2e0e05", "message": "Adds text attribute converter to limit strings to 4000 characters", "committedDate": "2020-08-26T14:52:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODIwOTc5Nw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/938#discussion_r478209797", "bodyText": "Why null is converted to empty string? Is there a reason for this?", "author": "radoslav-d", "createdAt": "2020-08-27T07:22:01Z", "path": "multiapps-controller-core/src/main/java/org/cloudfoundry/multiapps/controller/core/persistence/dto/TextAttributeConverter.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package org.cloudfoundry.multiapps.controller.core.persistence.dto;\n+\n+import javax.persistence.AttributeConverter;\n+import javax.persistence.Converter;\n+\n+import org.apache.commons.lang3.StringUtils;\n+\n+@Converter\n+public class TextAttributeConverter implements AttributeConverter<String, String> {\n+\n+    private static final int MAX_STRING_LENGTH = 4000;\n+\n+    @Override\n+    public String convertToDatabaseColumn(String text) {\n+        if (text != null) {\n+            return StringUtils.abbreviate(text, MAX_STRING_LENGTH);\n+        }\n+        return \"\";", "originalCommit": "6170dc036cdca789df7562d837b759d7fb2e0e05", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODIxMTAxNQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/938#discussion_r478211015", "bodyText": "It is better to remove this line.", "author": "radoslav-d", "createdAt": "2020-08-27T07:24:29Z", "path": "multiapps-controller-core/src/main/java/org/cloudfoundry/multiapps/controller/core/persistence/service/ProgressMessageService.java", "diffHunk": "@@ -100,4 +100,5 @@ public ProgressMessageDto toDto(ProgressMessage progressMessage) {\n         }\n \n     }\n+", "originalCommit": "6170dc036cdca789df7562d837b759d7fb2e0e05", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODIxMzg4Mg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/938#discussion_r478213882", "bodyText": "This long string generation is fine, but if you like, you may look at this examples: https://stackoverflow.com/questions/2804827/create-a-string-with-n-characters\nThere are some cool one-liners.", "author": "radoslav-d", "createdAt": "2020-08-27T07:29:58Z", "path": "multiapps-controller-core/src/test/java/org/cloudfoundry/multiapps/controller/core/persistence/dto/TextAttributeConverterTest.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package org.cloudfoundry.multiapps.controller.core.persistence.dto;\n+\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+\n+class TextAttributeConverterTest {\n+\n+    private final TextAttributeConverter textAttributeConverter = new TextAttributeConverter();\n+\n+    @Test\n+    void testConvertToEntityAttribute() {\n+        Assertions.assertEquals(\"test\", textAttributeConverter.convertToEntityAttribute(\"test\"));\n+    }\n+\n+    @Test\n+    void testConvertToDatabaseColumnWhenInputIsNotNull() {\n+        Assertions.assertEquals(\"test\", textAttributeConverter.convertToDatabaseColumn(\"test\"));\n+    }\n+\n+    @Test\n+    void testConvertToDatabaseColumnWhenInputIsNull() {\n+        Assertions.assertEquals(\"\", textAttributeConverter.convertToDatabaseColumn(null));\n+    }\n+\n+    @Test\n+    void testConvertToDatabaseColumnWhenInputIsLongerThan4000chars() {\n+        String expectedString = getLongStringInput().substring(0, 3997)\n+                                                    .concat(\"...\");\n+\n+        Assertions.assertEquals(expectedString, textAttributeConverter.convertToDatabaseColumn(getLongStringInput()));\n+    }\n+\n+    private String getLongStringInput() {\n+        int stringLength = 5000;\n+        StringBuilder longStringBuilder = new StringBuilder();\n+        for (int i = 1; i <= stringLength; i++) {\n+            longStringBuilder.append(\"a\");\n+        }\n+        return longStringBuilder.toString();\n+    }", "originalCommit": "6170dc036cdca789df7562d837b759d7fb2e0e05", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ce7c06f84685033566a7395a4b7b0d8c4e19e5e4", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/ce7c06f84685033566a7395a4b7b0d8c4e19e5e4", "message": "Adds text attribute converter to limit strings to 4000 characters", "committedDate": "2020-08-27T08:00:09Z", "type": "commit"}, {"oid": "ce7c06f84685033566a7395a4b7b0d8c4e19e5e4", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/ce7c06f84685033566a7395a4b7b0d8c4e19e5e4", "message": "Adds text attribute converter to limit strings to 4000 characters", "committedDate": "2020-08-27T08:00:09Z", "type": "forcePushed"}]}