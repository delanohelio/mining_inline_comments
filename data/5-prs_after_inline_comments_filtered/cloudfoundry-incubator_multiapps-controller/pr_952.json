{"pr_number": 952, "pr_title": "Update service operations", "pr_createdAt": "2020-09-15T15:56:40Z", "pr_url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/952", "timeline": [{"oid": "ccf3b9b1a04fc68b94fddbecd75bd1102378c802", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/ccf3b9b1a04fc68b94fddbecd75bd1102378c802", "message": "Update service operations", "committedDate": "2020-09-16T07:54:20Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI1MDk4NA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/952#discussion_r489250984", "bodyText": "URL variables take care of proper URL encoding, String.format doesn't.", "author": "nictas", "createdAt": "2020-09-16T08:17:53Z", "path": "multiapps-controller-core/src/main/java/org/cloudfoundry/multiapps/controller/core/cf/clients/CFOptimizedEventGetter.java", "diffHunk": "@@ -9,7 +8,7 @@\n \n public class CFOptimizedEventGetter extends CustomControllerClient {\n \n-    private static final String FIND_EVENT_BY_TYPE_AND_TIMESTAMP_ENDPOINT = \"/v2/events?inline-relations-depth=1&results-per-page=100&q=type:{type}&q=timestamp>{timestamp}\";", "originalCommit": "ccf3b9b1a04fc68b94fddbecd75bd1102378c802", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI2MDU1OQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/952#discussion_r489260559", "bodyText": "lel, getService calls createService. :D", "author": "nictas", "createdAt": "2020-09-16T08:33:02Z", "path": "multiapps-controller-core/src/main/java/org/cloudfoundry/multiapps/controller/core/cf/v2/ServicesCloudModelBuilder.java", "diffHunk": "@@ -37,38 +37,34 @@ public ServicesCloudModelBuilder(DeploymentDescriptor deploymentDescriptor, Stri\n \n     public List<CloudServiceInstanceExtended> build(List<Resource> resourcesToProcess) {\n         return resourcesToProcess.stream()\n-                                 .map(this::getService)\n+                                 .map(this::createService)\n                                  .filter(Objects::nonNull)\n                                  .collect(Collectors.toList());\n     }\n \n-    protected CloudServiceInstanceExtended getService(Resource resource) {\n-        boolean isOptional = isOptional(resource);\n-        boolean shouldIgnoreUpdateErrors = (boolean) resource.getParameters()\n-                                                             .getOrDefault(SupportedParameters.IGNORE_UPDATE_ERRORS, false);\n-        return createService(resource, isOptional, shouldIgnoreUpdateErrors);", "originalCommit": "ccf3b9b1a04fc68b94fddbecd75bd1102378c802", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI2MzE1MQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/952#discussion_r489263151", "bodyText": "This seems like it should be moved to our CF Java client fork.", "author": "nictas", "createdAt": "2020-09-16T08:37:04Z", "path": "multiapps-controller-core/src/main/java/org/cloudfoundry/multiapps/controller/core/model/ServiceOperation.java", "diffHunk": "@@ -1,18 +1,13 @@\n package org.cloudfoundry.multiapps.controller.core.model;\n \n import java.text.MessageFormat;\n-import java.util.Map;\n+import java.util.Objects;\n \n-import org.apache.commons.collections4.MapUtils;\n+import org.cloudfoundry.client.v2.serviceinstances.LastOperation;\n import org.cloudfoundry.multiapps.controller.core.Messages;\n \n public class ServiceOperation {", "originalCommit": "ccf3b9b1a04fc68b94fddbecd75bd1102378c802", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzI4MTk5MA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/952#discussion_r497281990", "bodyText": "Done", "author": "radito3", "createdAt": "2020-09-30T06:57:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI2MzE1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI2Mzk0OA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/952#discussion_r489263948", "bodyText": "Wait.. Where is this functionality gone?", "author": "nictas", "createdAt": "2020-09-16T08:37:50Z", "path": "multiapps-controller-core/src/main/java/org/cloudfoundry/multiapps/controller/core/cf/v2/ServicesCloudModelBuilder.java", "diffHunk": "@@ -37,38 +37,34 @@ public ServicesCloudModelBuilder(DeploymentDescriptor deploymentDescriptor, Stri\n \n     public List<CloudServiceInstanceExtended> build(List<Resource> resourcesToProcess) {\n         return resourcesToProcess.stream()\n-                                 .map(this::getService)\n+                                 .map(this::createService)\n                                  .filter(Objects::nonNull)\n                                  .collect(Collectors.toList());\n     }\n \n-    protected CloudServiceInstanceExtended getService(Resource resource) {\n-        boolean isOptional = isOptional(resource);\n-        boolean shouldIgnoreUpdateErrors = (boolean) resource.getParameters()\n-                                                             .getOrDefault(SupportedParameters.IGNORE_UPDATE_ERRORS, false);", "originalCommit": "ccf3b9b1a04fc68b94fddbecd75bd1102378c802", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI2NTgxMA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/952#discussion_r489265810", "bodyText": "Can the type or state be null?", "author": "nictas", "createdAt": "2020-09-16T08:40:16Z", "path": "multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/DetermineServiceCreateUpdateServiceActionsStep.java", "diffHunk": "@@ -171,12 +165,12 @@ private void setServiceParameters(ProcessContext context, CloudServiceInstanceEx\n         return actions;\n     }\n \n-    private ServiceOperation getLastOperation(CloudControllerClient client, String spaceId, String serviceName) {\n-        Map<String, Object> existingServiceInstanceEntity = serviceInstanceGetter.getServiceInstanceEntity(client, serviceName, spaceId);\n-        if (existingServiceInstanceEntity != null) {\n-            return getLastOperation(existingServiceInstanceEntity);\n+    private ServiceOperation getLastOperation(CloudControllerClient client, String serviceName) {\n+        LastOperation lastOperation = client.getServiceLastOperation(serviceName);\n+        if (lastOperation == null || lastOperation.getType() == null || lastOperation.getState() == null) {", "originalCommit": "ccf3b9b1a04fc68b94fddbecd75bd1102378c802", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "849c7314cb2a0f4312bae1090eb42189efba3ba7", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/849c7314cb2a0f4312bae1090eb42189efba3ba7", "message": "Update service operations", "committedDate": "2020-09-23T07:17:23Z", "type": "forcePushed"}, {"oid": "c3b1294ea2d65b339a2e67a8db027944edadf2bf", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/c3b1294ea2d65b339a2e67a8db027944edadf2bf", "message": "Update service operations (unfinished)", "committedDate": "2020-09-23T09:07:48Z", "type": "forcePushed"}, {"oid": "44ce658a1994d1bdaaa36fb9b24e9db8b3740006", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/44ce658a1994d1bdaaa36fb9b24e9db8b3740006", "message": "Update service operations (unfinished)", "committedDate": "2020-09-23T14:13:29Z", "type": "forcePushed"}, {"oid": "f7f9ba8d7b9ef0f47b3a795c368f7b3666184353", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/f7f9ba8d7b9ef0f47b3a795c368f7b3666184353", "message": "Update service operations (unfinished)", "committedDate": "2020-09-24T07:17:11Z", "type": "forcePushed"}, {"oid": "748a1fddfba5daded9d3115cf6798fc0cf2a7ead", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/748a1fddfba5daded9d3115cf6798fc0cf2a7ead", "message": "Update service operations (unfinished)", "committedDate": "2020-09-24T13:31:51Z", "type": "forcePushed"}, {"oid": "51ae5f7df39f459ffeca425ec4c226488aee1191", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/51ae5f7df39f459ffeca425ec4c226488aee1191", "message": "Update service operations (unfinished)", "committedDate": "2020-09-25T13:51:22Z", "type": "forcePushed"}, {"oid": "82b3763622f2a09c0e5222a1727eb9ec3abdf7e7", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/82b3763622f2a09c0e5222a1727eb9ec3abdf7e7", "message": "Update service operations (unfinished)", "committedDate": "2020-09-28T11:54:37Z", "type": "forcePushed"}, {"oid": "1a0cfa673fa4a241265547d031e0f0c8031be561", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/1a0cfa673fa4a241265547d031e0f0c8031be561", "message": "Update service operations (unfinished)", "committedDate": "2020-09-30T08:37:38Z", "type": "forcePushed"}, {"oid": "8e989586f2708f2c6246b13ad6030fd32095c8ac", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/8e989586f2708f2c6246b13ad6030fd32095c8ac", "message": "Update service operations (unfinished)", "committedDate": "2020-09-30T08:52:55Z", "type": "forcePushed"}, {"oid": "6c2ed48228fbbc9aa600d5c1545864ebd92f5ab9", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/6c2ed48228fbbc9aa600d5c1545864ebd92f5ab9", "message": "Update service operations", "committedDate": "2020-09-30T13:11:18Z", "type": "forcePushed"}, {"oid": "7793cd06f3b3e6c00c85419e5a82ebdb64ab2ac1", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/7793cd06f3b3e6c00c85419e5a82ebdb64ab2ac1", "message": "Update service operations", "committedDate": "2020-09-30T13:30:19Z", "type": "forcePushed"}, {"oid": "063f0cd54a67118f35f5158fff8770c89414ba1f", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/063f0cd54a67118f35f5158fff8770c89414ba1f", "message": "Update service operations", "committedDate": "2020-09-30T14:03:43Z", "type": "forcePushed"}, {"oid": "a37aac88fbdd739e382530971b9c5bb2134ca981", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/a37aac88fbdd739e382530971b9c5bb2134ca981", "message": "Update service operations", "committedDate": "2020-09-30T14:25:36Z", "type": "forcePushed"}, {"oid": "bc14249c116d6e559e0578bd7f668603758a8087", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/bc14249c116d6e559e0578bd7f668603758a8087", "message": "Remove mta env detection variable", "committedDate": "2020-10-01T07:42:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODA5MzUwMg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/952#discussion_r498093502", "bodyText": "\"parameters\" are the input given to the service broker. \"credentials\" are the things provided by the service broker. For example, \"memory: 256\" would be a parameter, but \"host: postgresql.foo.com\" would be a credential (see here and here). This method should be called shouldSkipParametersUpdate.", "author": "nictas", "createdAt": "2020-10-01T09:04:59Z", "path": "multiapps-controller-client/src/main/java/org/cloudfoundry/multiapps/controller/client/lib/domain/CloudServiceInstanceExtended.java", "diffHunk": "@@ -28,9 +28,19 @@ public boolean isOptional() {\n     public boolean isManaged() {\n         return false;\n     }\n-\n+    \n+    @Value.Default\n+    public boolean shouldSkipCredentialsUpdate() {", "originalCommit": "bc14249c116d6e559e0578bd7f668603758a8087", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODA5NjM0Mw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/952#discussion_r498096343", "bodyText": "Rename urlPath to path for consistency with addPageOfResources.", "author": "nictas", "createdAt": "2020-10-01T09:10:00Z", "path": "multiapps-controller-core/src/main/java/org/cloudfoundry/multiapps/controller/core/cf/clients/CustomControllerClient.java", "diffHunk": "@@ -15,61 +14,38 @@\n \n public abstract class CustomControllerClient {\n \n-    private final WebClientFactory webClientFactory;\n+    protected final CloudControllerClient client;\n+    private final WebClient webClient;\n \n-    protected CustomControllerClient(WebClientFactory webClientFactory) {\n-        this.webClientFactory = webClientFactory;\n+    protected CustomControllerClient(CloudControllerClient client) {\n+        this.client = client;\n+        this.webClient = new WebClientFactory().getWebClient(client);\n     }\n \n-    protected WebClient getWebClient(CloudControllerClient client) {\n-        return webClientFactory.getWebClient(client);\n-    }\n-\n-    protected List<Map<String, Object>> getAllResources(WebClient webClient, String controllerUrl, String urlPath) {\n-        return getAllResources(webClient, controllerUrl, urlPath, Collections.emptyMap());\n-    }\n-\n-    protected List<Map<String, Object>> getAllResources(WebClient webClient, String controllerUrl, String urlPath,\n-                                                        Map<String, Object> urlVariables) {\n+    protected List<Map<String, Object>> getAllResources(String urlPath, Object... urlVariables) {", "originalCommit": "bc14249c116d6e559e0578bd7f668603758a8087", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODc1OTIyMQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/952#discussion_r498759221", "bodyText": "Done", "author": "radito3", "createdAt": "2020-10-02T11:12:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODA5NjM0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODA5OTkyMg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/952#discussion_r498099922", "bodyText": "Shouldn't this be called CommonResourceParameters?", "author": "nictas", "createdAt": "2020-10-01T09:16:06Z", "path": "multiapps-controller-core/src/main/java/org/cloudfoundry/multiapps/controller/core/cf/v2/ServicesCloudModelBuilder.java", "diffHunk": "@@ -143,5 +143,36 @@ protected String getInvalidServiceConfigTypeErrorMessage(String serviceName, Obj\n                                     Map.class.getSimpleName(), serviceParameters.getClass()\n                                                                                 .getSimpleName());\n     }\n+    \n+    protected static class CommonServiceProperties {", "originalCommit": "bc14249c116d6e559e0578bd7f668603758a8087", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODc2MjE5NQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/952#discussion_r498762195", "bodyText": "Done", "author": "radito3", "createdAt": "2020-10-02T11:20:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODA5OTkyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODEwMDE4Mg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/952#discussion_r498100182", "bodyText": "Rename to skip-parameters-update.\nAlso, since this is a UX change, we should have a short 15-30 min meeting with the rest of the team, so that everyone has the chance to give feedback, share his concerns, etc. One thing to discuss is whether this parameter should be called skip-parameters-update or skip-service-instance-parameters-update, since the first might be a bit ambiguous, as it's a bit unclear whether it concerns resource or service instance parameters.", "author": "nictas", "createdAt": "2020-10-01T09:16:34Z", "path": "multiapps-controller-core/src/main/java/org/cloudfoundry/multiapps/controller/core/model/SupportedParameters.java", "diffHunk": "@@ -125,8 +125,10 @@\n     public static final String DEFAULT_CONTAINER_NAME = \"default-container-name\";\n     public static final String DEFAULT_XS_APP_NAME = \"default-xsappname\";\n     public static final String TYPE = \"type\";\n-    public static final String IGNORE_UPDATE_ERRORS = \"ignore-update-errors\";\n-\n+    public static final String SKIP_PLAN_UPDATE = \"skip-plan-update\";\n+    public static final String SKIP_CREDENTIALS_UPDATE = \"skip-credentials-update\";", "originalCommit": "bc14249c116d6e559e0578bd7f668603758a8087", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDIwNTE0Mg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/952#discussion_r500205142", "bodyText": "Changed to a map called skip-service-updates with 3 boolean fields: parameters, tags, plan as per the team's decision.", "author": "radito3", "createdAt": "2020-10-06T11:36:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODEwMDE4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODExMjYwMQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/952#discussion_r498112601", "bodyText": "Should be renamed to UpdateServiceParametersStep.", "author": "nictas", "createdAt": "2020-10-01T09:36:53Z", "path": "multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/UpdateServiceCredentialsStep.java", "diffHunk": "@@ -19,28 +18,18 @@\n @Scope(BeanDefinition.SCOPE_PROTOTYPE)\n public class UpdateServiceCredentialsStep extends ServiceStep {", "originalCommit": "bc14249c116d6e559e0578bd7f668603758a8087", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODc2MzAzMg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/952#discussion_r498763032", "bodyText": "Done", "author": "radito3", "createdAt": "2020-10-02T11:22:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODExMjYwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODExMzIwNg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/952#discussion_r498113206", "bodyText": "Warn if this is enabled.", "author": "nictas", "createdAt": "2020-10-01T09:37:50Z", "path": "multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/UpdateServiceCredentialsStep.java", "diffHunk": "@@ -19,28 +18,18 @@\n @Scope(BeanDefinition.SCOPE_PROTOTYPE)\n public class UpdateServiceCredentialsStep extends ServiceStep {\n \n-    @Inject\n-    @Named(\"serviceUpdater\")\n-    protected ServiceUpdater serviceUpdater;\n-\n     @Override\n-    protected MethodExecution<String> executeOperation(ProcessContext context, CloudControllerClient controllerClient,\n+    protected MethodExecution<String> executeOperation(ProcessContext context, CloudControllerClient client,\n                                                        CloudServiceInstanceExtended service) {\n-        return updateServiceCredentials(controllerClient, service);\n-    }\n-\n-    private MethodExecution<String> updateServiceCredentials(CloudControllerClient client, CloudServiceInstanceExtended service) {\n         getStepLogger().info(Messages.UPDATING_SERVICE, service.getName());\n-        MethodExecution<String> methodExecution = updateService(client, service);\n-        getStepLogger().debug(Messages.SERVICE_UPDATED, service.getName());\n-        return methodExecution;\n-    }\n \n-    private MethodExecution<String> updateService(CloudControllerClient client, CloudServiceInstanceExtended service) {\n-        if (service.shouldIgnoreUpdateErrors()) {\n-            return serviceUpdater.updateServiceParametersQuietly(client, service.getName(), service.getCredentials());\n+        if (!service.shouldSkipCredentialsUpdate()) {", "originalCommit": "bc14249c116d6e559e0578bd7f668603758a8087", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODExMzI5MQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/952#discussion_r498113291", "bodyText": "Warn if this is enabled.", "author": "nictas", "createdAt": "2020-10-01T09:37:59Z", "path": "multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/UpdateServicePlanStep.java", "diffHunk": "@@ -18,18 +18,17 @@\n public class UpdateServicePlanStep extends ServiceStep {\n \n     @Override\n-    protected MethodExecution<String> executeOperation(ProcessContext context, CloudControllerClient controllerClient,\n+    protected MethodExecution<String> executeOperation(ProcessContext context, CloudControllerClient client,\n                                                        CloudServiceInstanceExtended service) {\n-        return updateServicePlan(controllerClient, service);\n-    }\n+        getStepLogger().debug(\"Updating service plan for service {0} with new plan: {1}\", service.getName(), service.getPlan());\n \n-    private MethodExecution<String> updateServicePlan(CloudControllerClient controllerClient, CloudServiceInstanceExtended service) {\n-        getStepLogger().debug(MessageFormat.format(\"Updating service plan of a service {0} with new plan: {1}\", service.getName(),\n-                                                   service.getPlan()));\n-        if (service.shouldIgnoreUpdateErrors()) {\n-            return getServiceUpdater().updateServicePlanQuietly(controllerClient, service.getName(), service.getPlan());\n+        if (!service.shouldSkipPlanUpdate()) {", "originalCommit": "bc14249c116d6e559e0578bd7f668603758a8087", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODExMzM5Mg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/952#discussion_r498113392", "bodyText": "Warn if this is enabled.", "author": "nictas", "createdAt": "2020-10-01T09:38:11Z", "path": "multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/UpdateServiceTagsStep.java", "diffHunk": "@@ -19,31 +19,17 @@\n public class UpdateServiceTagsStep extends ServiceStep {\n \n     @Override\n-    protected MethodExecution<String> executeOperation(ProcessContext context, CloudControllerClient controllerClient,\n+    protected MethodExecution<String> executeOperation(ProcessContext context, CloudControllerClient client,\n                                                        CloudServiceInstanceExtended service) {\n-        return updateServiceTags(controllerClient, service);\n-    }\n-\n-    private MethodExecution<String> updateServiceTags(CloudControllerClient controllerClient, CloudServiceInstanceExtended service) {\n-        // TODO: Remove the service.isUserProvided() check when user provided services support tags.\n-        // See the following issue for more info:\n-        // https://www.pivotaltracker.com/n/projects/966314/stories/105674948\n-        if (service.isUserProvided()) {\n-            return new MethodExecution<>(null, ExecutionState.FINISHED);\n-        }\n         getStepLogger().info(Messages.UPDATING_SERVICE_TAGS, service.getName());\n \n-        MethodExecution<String> methodExecution = updateService(controllerClient, service);\n+        if (!service.shouldSkipTagsUpdate()) {", "originalCommit": "bc14249c116d6e559e0578bd7f668603758a8087", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODExMzc3MA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/952#discussion_r498113770", "bodyText": "This provides a more detailed exception message.", "author": "nictas", "createdAt": "2020-10-01T09:38:52Z", "path": "multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/UploadAppStep.java", "diffHunk": "@@ -151,10 +154,7 @@ private CloudPackage asyncUploadFiles(ProcessContext context, CloudControllerCli\n             try {\n                 ApplicationArchiveContext applicationArchiveContext = createApplicationArchiveContext(appArchiveStream, fileName, maxSize);\n                 filePath = extractFromMtar(applicationArchiveContext);\n-                return upload(context, client, app, filePath);\n-            } catch (IOException e) {\n-                FileUtils.cleanUp(filePath, LOGGER);\n-                throw new SLException(e, Messages.ERROR_RETRIEVING_MTA_MODULE_CONTENT, fileName);", "originalCommit": "bc14249c116d6e559e0578bd7f668603758a8087", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7cf434cb5dcd41d5cbe41154a4cf7de54fa275d3", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/7cf434cb5dcd41d5cbe41154a4cf7de54fa275d3", "message": "Adopt cloudfoundry client 1.31", "committedDate": "2020-10-02T08:13:10Z", "type": "forcePushed"}, {"oid": "adf656f73ee2a40a2292b22b74ed27e56c27c0d7", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/adf656f73ee2a40a2292b22b74ed27e56c27c0d7", "message": "Update service operations", "committedDate": "2020-10-02T11:33:22Z", "type": "forcePushed"}, {"oid": "d72e135f208ad8f3437d04ab1ede2ea88ac9d9be", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/d72e135f208ad8f3437d04ab1ede2ea88ac9d9be", "message": "Update service operations", "committedDate": "2020-10-05T13:27:35Z", "type": "forcePushed"}, {"oid": "fcd793cf8c80b923c375a0bc72705f62abff1980", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/fcd793cf8c80b923c375a0bc72705f62abff1980", "message": "Update service operations", "committedDate": "2020-10-05T13:38:07Z", "type": "forcePushed"}, {"oid": "b3c6404bd870a7ff9e68b8b3434a80e27093b672", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/b3c6404bd870a7ff9e68b8b3434a80e27093b672", "message": "Update service operations", "committedDate": "2020-10-06T11:53:56Z", "type": "forcePushed"}, {"oid": "f1c50043bfd607ec077bb573605e5e80ac14880d", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/f1c50043bfd607ec077bb573605e5e80ac14880d", "message": "Delete unused process variable for env metadata", "committedDate": "2020-10-07T08:19:35Z", "type": "commit"}, {"oid": "46accd4dfb52081d4c222344f51b09079d59e379", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/46accd4dfb52081d4c222344f51b09079d59e379", "message": "Update service operations", "committedDate": "2020-10-07T08:24:04Z", "type": "forcePushed"}, {"oid": "70fc502c206f2666998544688955aadb07ca5497", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/70fc502c206f2666998544688955aadb07ca5497", "message": "Refactoring", "committedDate": "2020-10-07T13:30:25Z", "type": "forcePushed"}, {"oid": "9873220174c1de0c23ca04c9e8734f8cad13d49a", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/9873220174c1de0c23ca04c9e8734f8cad13d49a", "message": "Update service operations\n\nLMCROSSITXSADEPLOY-2177", "committedDate": "2020-10-07T16:40:38Z", "type": "commit"}, {"oid": "9013f8db024c477549bbf82b0f45b15ac2b481ec", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/9013f8db024c477549bbf82b0f45b15ac2b481ec", "message": "Refactoring", "committedDate": "2020-10-07T16:40:39Z", "type": "commit"}, {"oid": "9013f8db024c477549bbf82b0f45b15ac2b481ec", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/9013f8db024c477549bbf82b0f45b15ac2b481ec", "message": "Refactoring", "committedDate": "2020-10-07T16:40:39Z", "type": "forcePushed"}]}