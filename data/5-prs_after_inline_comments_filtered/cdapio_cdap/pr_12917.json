{"pr_number": 12917, "pr_title": "CDAP-16527 include field name is casting errors for records", "pr_createdAt": "2020-12-15T04:08:58Z", "pr_url": "https://github.com/cdapio/cdap/pull/12917", "timeline": [{"oid": "03d5c6788424e5ceec19512a2c5f57ea80ba4e4e", "url": "https://github.com/cdapio/cdap/commit/03d5c6788424e5ceec19512a2c5f57ea80ba4e4e", "message": "CDAP-16527 include field name is casting errors for records\n\nFor logical type utility methods, including the field name when\nthe type is not as expected.\n\nThis is only required because the builder does not verify that\na valid type is being set for a field. If/when that verification\nis added, this logic can be removed.", "committedDate": "2020-12-15T04:08:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU5MjQzMg==", "url": "https://github.com/cdapio/cdap/pull/12917#discussion_r543592432", "bodyText": "We should add a try catch here as well.", "author": "supriyapatil-google", "createdAt": "2020-12-15T18:40:56Z", "path": "cdap-api-common/src/main/java/io/cdap/cdap/api/data/format/StructuredRecord.java", "diffHunk": "@@ -192,7 +220,12 @@ public BigDecimal getDecimal(String fieldName) {\n       return new BigDecimal(new BigInteger(Bytes.toBytes((ByteBuffer) value)), scale);", "originalCommit": "03d5c6788424e5ceec19512a2c5f57ea80ba4e4e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU5NTQzNg==", "url": "https://github.com/cdapio/cdap/pull/12917#discussion_r543595436", "bodyText": "This should be UnexpectedFormatException here and below.", "author": "supriyapatil-google", "createdAt": "2020-12-15T18:44:38Z", "path": "cdap-api-common/src/main/java/io/cdap/cdap/api/data/format/StructuredRecord.java", "diffHunk": "@@ -98,8 +98,14 @@ public Schema getSchema() {\n   public LocalDate getDate(String fieldName) {\n     Schema logicalTypeSchema = validateAndGetLogicalTypeSchema(schema.getField(fieldName),\n                                                                EnumSet.of(LogicalType.DATE));\n-    Integer value = (Integer) fields.get(fieldName);\n-    return (value == null || logicalTypeSchema == null) ? null : LocalDate.ofEpochDay(value.longValue());\n+    Object val = fields.get(fieldName);\n+    try {\n+      Integer value = (Integer) val;\n+      return (value == null || logicalTypeSchema == null) ? null : LocalDate.ofEpochDay(value.longValue());\n+    } catch (ClassCastException e) {\n+      throw new ClassCastException(String.format(\"Field '%s' is expected to be a date, but is a %s\",", "originalCommit": "03d5c6788424e5ceec19512a2c5f57ea80ba4e4e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}