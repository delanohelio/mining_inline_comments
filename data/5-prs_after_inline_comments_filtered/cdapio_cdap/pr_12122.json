{"pr_number": 12122, "pr_title": "(CDAP-16672) Support GCP Dataproc cluster property override via cdap-site.xml", "pr_createdAt": "2020-04-25T23:06:40Z", "pr_url": "https://github.com/cdapio/cdap/pull/12122", "timeline": [{"oid": "d9fd30c3e2278660b6144463a3d212fa9eb68a53", "url": "https://github.com/cdapio/cdap/commit/d9fd30c3e2278660b6144463a3d212fa9eb68a53", "message": "(CDAP-16672) Support GCP Dataproc cluster property override via cdap-site.xml\n\nWhy:\nWhen creating Dataproc cluster, overriding cluster properties\n(i.e. property key-val pairs in config files) cannot be done dynamically.\nCurrenlty they are hard-coded.\n\nWhat:\nThis change gets property overrides from ProvisionerSystemContext and set them\nin the context used for dataproc creation, which get passed to Dataproc via\ncreation API.\n\nHow to use:\nFormat of property override in cdap-site.xml:\n\"[prefix].gcp-dataproc.[dataproc config file]:[property key]\" : \"[property val]\"\nwhere \"prefix\" is \"provisioner.system.properties\"\n\nE.g.\nprovisioner.system.properties.gcp-dataproc.capacity-scheduler:yarn.scheduler.capacity.maximum-am-resource-percent: \"0.5\"\n\nNeeds to comply with format\n\"[prefix].gcp-dataproc.[dataproc config file]:[property key]\" : \"[property val]\"", "committedDate": "2020-04-25T23:04:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTI2MDMzMg==", "url": "https://github.com/cdapio/cdap/pull/12122#discussion_r415260332", "bodyText": "Use List as the type.", "author": "chtyim", "createdAt": "2020-04-26T09:06:01Z", "path": "cdap-runtime-ext-dataproc/src/main/java/io/cdap/cdap/runtime/spi/provisioner/dataproc/DataprocProvisioner.java", "diffHunk": "@@ -337,13 +340,24 @@ public Capabilities getCapabilities() {\n     }\n \n     // Default settings from the system context\n-    List<String> keys = Arrays.asList(DataprocConf.PREFER_EXTERNAL_IP,\n-                                      DataprocConf.NETWORK,\n-                                      DataprocConf.NETWORK_HOST_PROJECT_ID,\n-                                      DataprocConf.STACKDRIVER_LOGGING_ENABLED,\n-                                      DataprocConf.STACKDRIVER_MONITORING_ENABLED,\n-                                      DataprocConf.IMAGE_VERSION,\n-                                      BUCKET, RUNTIME_JOB_MANAGER);\n+    ArrayList<String> keys = new ArrayList<>(", "originalCommit": "d9fd30c3e2278660b6144463a3d212fa9eb68a53", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk4ODc1Mw==", "url": "https://github.com/cdapio/cdap/pull/12122#discussion_r415988753", "bodyText": "Done", "author": "wyzhang", "createdAt": "2020-04-27T17:02:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTI2MDMzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTI2MDU0Ng==", "url": "https://github.com/cdapio/cdap/pull/12122#discussion_r415260546", "bodyText": "Seems like calling unmodifiableList is unnecessary.", "author": "chtyim", "createdAt": "2020-04-26T09:07:05Z", "path": "cdap-runtime-ext-dataproc/src/main/java/io/cdap/cdap/runtime/spi/provisioner/dataproc/DataprocProvisioner.java", "diffHunk": "@@ -337,13 +340,24 @@ public Capabilities getCapabilities() {\n     }\n \n     // Default settings from the system context\n-    List<String> keys = Arrays.asList(DataprocConf.PREFER_EXTERNAL_IP,\n-                                      DataprocConf.NETWORK,\n-                                      DataprocConf.NETWORK_HOST_PROJECT_ID,\n-                                      DataprocConf.STACKDRIVER_LOGGING_ENABLED,\n-                                      DataprocConf.STACKDRIVER_MONITORING_ENABLED,\n-                                      DataprocConf.IMAGE_VERSION,\n-                                      BUCKET, RUNTIME_JOB_MANAGER);\n+    ArrayList<String> keys = new ArrayList<>(\n+      Arrays.asList(DataprocConf.PREFER_EXTERNAL_IP,\n+                    DataprocConf.NETWORK,\n+                    DataprocConf.NETWORK_HOST_PROJECT_ID,\n+                    DataprocConf.STACKDRIVER_LOGGING_ENABLED,\n+                    DataprocConf.STACKDRIVER_MONITORING_ENABLED,\n+                    DataprocConf.IMAGE_VERSION,\n+                    BUCKET, RUNTIME_JOB_MANAGER)\n+    );\n+\n+    // Default cluster properties (i.e. specifying configuration files of the dataproc cluster and the property\n+    // key value paris within those files that should be overridden) from the system context.\n+    List<String> clusterPropertyKeys = Collections.unmodifiableList(", "originalCommit": "d9fd30c3e2278660b6144463a3d212fa9eb68a53", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk4ODk2NQ==", "url": "https://github.com/cdapio/cdap/pull/12122#discussion_r415988965", "bodyText": "Done. Changed to appending to list directly", "author": "wyzhang", "createdAt": "2020-04-27T17:02:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTI2MDU0Ng=="}], "type": "inlineReview"}, {"oid": "f126cf5e534683f71c58e5adf0711aae44c99d47", "url": "https://github.com/cdapio/cdap/commit/f126cf5e534683f71c58e5adf0711aae44c99d47", "message": "address comments", "committedDate": "2020-04-27T17:02:01Z", "type": "commit"}]}