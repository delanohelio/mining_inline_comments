{"pr_number": 11935, "pr_title": "CDAP-16394 fix fll direction response", "pr_createdAt": "2020-03-09T04:49:18Z", "pr_url": "https://github.com/cdapio/cdap/pull/11935", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ3MTI2NQ==", "url": "https://github.com/cdapio/cdap/pull/11935#discussion_r389471265", "bodyText": "Is that mean directionStr can be null? Please annotate with @Nullable if that's the case.", "author": "chtyim", "createdAt": "2020-03-09T05:41:46Z", "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/metadata/LineageHTTPHandler.java", "diffHunk": "@@ -301,7 +301,7 @@ public long getEnd() {\n   private Constants.FieldLineage.Direction parseDirection(String directionStr) throws BadRequestException {\n     try {\n       return Constants.FieldLineage.Direction.valueOf(directionStr.toUpperCase());\n-    } catch (IllegalArgumentException e) {\n+    } catch (NullPointerException | IllegalArgumentException e) {", "originalCommit": "c0b4cfe41e94f991fdc92c83d47ebb72ae4bb411", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ3MTUzMw==", "url": "https://github.com/cdapio/cdap/pull/11935#discussion_r389471533", "bodyText": "Fixed", "author": "yaojiefeng", "createdAt": "2020-03-09T05:43:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ3MTI2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ3MTU3OQ==", "url": "https://github.com/cdapio/cdap/pull/11935#discussion_r389471579", "bodyText": "Strictly speaking, should have URLEncoder.encode(direction).", "author": "chtyim", "createdAt": "2020-03-09T05:43:41Z", "path": "cdap-client/src/main/java/io/cdap/cdap/client/LineageClient.java", "diffHunk": "@@ -131,10 +132,31 @@ public LineageRecord getLineage(DatasetId datasetInstance, String startTime, Str\n     if (levels != null) {\n       path = String.format(\"%s&levels=%d\", path, levels);\n     }\n-    return getLineage(datasetInstance, path);\n+    return getLineage(datasetInstance, path, LineageRecord.class);\n   }\n \n-  private LineageRecord getLineage(NamespacedEntityId namespacedId, String path)\n+  /**\n+   * Retrieves field lineage about a dataset\n+   *\n+   * @param datasetId the dataset for which to retrieve lineage\n+   * @param startTime start time for the query, in milliseconds, or in 'now - xs' format\n+   * @param endTime end time for the query, in milliseconds, or in 'now - xs' format\n+   * @param direction direction of the field lineage, can be incoming, outgoing or both\n+   * @return {@link FieldLineageSummary} for the specified dataset.\n+   */\n+  public FieldLineageSummary getFieldLineage(DatasetId datasetId, long startTime, long endTime,\n+                                             String direction)\n+    throws IOException, BadRequestException, NotFoundException, UnauthenticatedException {\n+    String path = String.format(\"datasets/%s/lineage/allfieldlineage?start=%s&end=%s\", datasetId.getDataset(),\n+                                URLEncoder.encode(Long.toString(startTime), \"UTF-8\"),\n+                                URLEncoder.encode(Long.toString(endTime), \"UTF-8\"));\n+    if (direction != null) {\n+      path = String.format(\"%s&direction=%s\", path, direction);", "originalCommit": "c0b4cfe41e94f991fdc92c83d47ebb72ae4bb411", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "455ebd8b869d1b889e2f21840b570a305b3dbf82", "url": "https://github.com/cdapio/cdap/commit/455ebd8b869d1b889e2f21840b570a305b3dbf82", "message": "CDAP-16394 fix fll direction response", "committedDate": "2020-03-09T12:07:33Z", "type": "commit"}, {"oid": "455ebd8b869d1b889e2f21840b570a305b3dbf82", "url": "https://github.com/cdapio/cdap/commit/455ebd8b869d1b889e2f21840b570a305b3dbf82", "message": "CDAP-16394 fix fll direction response", "committedDate": "2020-03-09T12:07:33Z", "type": "forcePushed"}]}