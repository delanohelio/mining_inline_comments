{"pr_number": 10200, "pr_title": "Improve error messages on repository creation", "pr_createdAt": "2020-07-10T12:27:27Z", "pr_url": "https://github.com/crate/crate/pull/10200", "timeline": [{"oid": "68ec61a334cd82450283efdb1cdb1c0b1fdc111f", "url": "https://github.com/crate/crate/commit/68ec61a334cd82450283efdb1cdb1c0b1fdc111f", "message": "Add logging when repository verification fails", "committedDate": "2020-07-10T12:54:00Z", "type": "forcePushed"}, {"oid": "c782e285dcd2ad8580ad89522b4a5f2f4fce695f", "url": "https://github.com/crate/crate/commit/c782e285dcd2ad8580ad89522b4a5f2f4fce695f", "message": "Improve error message on repository creation failures", "committedDate": "2020-09-03T13:43:22Z", "type": "forcePushed"}, {"oid": "80a42905e690841b6f0b29102d3477320e85af54", "url": "https://github.com/crate/crate/commit/80a42905e690841b6f0b29102d3477320e85af54", "message": "Improve error message on repository creation failures", "committedDate": "2020-09-03T13:48:48Z", "type": "forcePushed"}, {"oid": "803861be1844fba19c6271acb28e2598aba5cc7d", "url": "https://github.com/crate/crate/commit/803861be1844fba19c6271acb28e2598aba5cc7d", "message": "Improve error message on repository creation failures", "committedDate": "2020-09-03T13:49:41Z", "type": "forcePushed"}, {"oid": "006d5a222811059441f189510a88c00e25984753", "url": "https://github.com/crate/crate/commit/006d5a222811059441f189510a88c00e25984753", "message": "Improve error message on repository creation failures", "committedDate": "2020-09-03T13:53:56Z", "type": "forcePushed"}, {"oid": "c18325843dc06e9ed3d749481a45ec39cbee0376", "url": "https://github.com/crate/crate/commit/c18325843dc06e9ed3d749481a45ec39cbee0376", "message": "Improve error message on repository creation failures", "committedDate": "2020-09-04T10:21:17Z", "type": "forcePushed"}, {"oid": "c03390c1fcd918308e4b3e63ffe79cd1c1a4192d", "url": "https://github.com/crate/crate/commit/c03390c1fcd918308e4b3e63ffe79cd1c1a4192d", "message": "Improve error message on repository creation failures\n\nThis changes  the error message for failed repository creation,\nadding additional information of the underlying failure to make it\neasier to understand the root cause from the client side.", "committedDate": "2020-09-04T10:28:02Z", "type": "forcePushed"}, {"oid": "cb7b93309d6099c168f19e2a63b41922380dca69", "url": "https://github.com/crate/crate/commit/cb7b93309d6099c168f19e2a63b41922380dca69", "message": "Improve error message on repository creation failures\n\nThis changes  the error message for failed repository creation,\nadding additional information of the underlying failure to make it\neasier to understand the root cause from the client side.", "committedDate": "2020-09-04T12:11:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzU3NTQwNA==", "url": "https://github.com/crate/crate/pull/10200#discussion_r483575404", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                                                  \"Unable verify repository, [\" + metadata.name() + \"]\" +\n          \n          \n            \n                                                                  \"Unable to verify the repository, [\" + metadata.name() + \"]\" +", "author": "seut", "createdAt": "2020-09-04T12:09:43Z", "path": "server/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java", "diffHunk": "@@ -790,8 +790,11 @@ public String startVerification() {\n                 }\n                 return seed;\n             }\n-        } catch (IOException exp) {\n-            throw new RepositoryVerificationException(metadata.name(), \"path \" + basePath() + \" is not accessible on master node\", exp);\n+        } catch (Exception exp) {\n+            throw new RepositoryVerificationException(metadata.name(),\n+                                                      \"Unable verify repository, [\" + metadata.name() + \"]\" +", "originalCommit": "c03390c1fcd918308e4b3e63ffe79cd1c1a4192d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzU3NjM1Mw==", "url": "https://github.com/crate/crate/pull/10200#discussion_r483576353", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                                                  \" is not accessible on master node\",\n          \n          \n            \n                                                                  \" is not accessible on the master node\",", "author": "seut", "createdAt": "2020-09-04T12:11:39Z", "path": "server/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java", "diffHunk": "@@ -790,8 +790,11 @@ public String startVerification() {\n                 }\n                 return seed;\n             }\n-        } catch (IOException exp) {\n-            throw new RepositoryVerificationException(metadata.name(), \"path \" + basePath() + \" is not accessible on master node\", exp);\n+        } catch (Exception exp) {\n+            throw new RepositoryVerificationException(metadata.name(),\n+                                                      \"Unable verify repository, [\" + metadata.name() + \"]\" +\n+                                                      \" is not accessible on master node\",", "originalCommit": "c03390c1fcd918308e4b3e63ffe79cd1c1a4192d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5956eea718f10ed47a3729d32d1a2a9b995810fa", "url": "https://github.com/crate/crate/commit/5956eea718f10ed47a3729d32d1a2a9b995810fa", "message": "Update changes and exception message", "committedDate": "2020-09-04T12:38:14Z", "type": "forcePushed"}, {"oid": "77d3a7ea2f111cc81e9d702f4f988424296e5e5a", "url": "https://github.com/crate/crate/commit/77d3a7ea2f111cc81e9d702f4f988424296e5e5a", "message": "Fix changes information", "committedDate": "2020-09-07T13:37:27Z", "type": "forcePushed"}, {"oid": "fe216f2674556b8f7cc1d6b3f57011c917f1d32e", "url": "https://github.com/crate/crate/commit/fe216f2674556b8f7cc1d6b3f57011c917f1d32e", "message": "Fix changes information", "committedDate": "2020-09-07T14:02:10Z", "type": "forcePushed"}, {"oid": "c53872eaf7186b9ba22054e9cfd63a06fc022953", "url": "https://github.com/crate/crate/commit/c53872eaf7186b9ba22054e9cfd63a06fc022953", "message": "Fix changes information", "committedDate": "2020-09-07T14:08:18Z", "type": "forcePushed"}, {"oid": "d5eb50d2bb4cf9c6a59db899b1c28155962e1d81", "url": "https://github.com/crate/crate/commit/d5eb50d2bb4cf9c6a59db899b1c28155962e1d81", "message": "Fix changes information", "committedDate": "2020-09-07T14:13:57Z", "type": "forcePushed"}, {"oid": "3688d7c1524c7700fe40774a45c60de2438f4fd4", "url": "https://github.com/crate/crate/commit/3688d7c1524c7700fe40774a45c60de2438f4fd4", "message": "Fix changes information", "committedDate": "2020-09-07T14:35:27Z", "type": "forcePushed"}, {"oid": "2cf862ab3870abaed9fcca9bf7d28668b858553b", "url": "https://github.com/crate/crate/commit/2cf862ab3870abaed9fcca9bf7d28668b858553b", "message": "Fix changes information", "committedDate": "2020-09-07T14:37:51Z", "type": "forcePushed"}, {"oid": "5c743e3410c2e9990a7fa8745e4c391561e55c6c", "url": "https://github.com/crate/crate/commit/5c743e3410c2e9990a7fa8745e4c391561e55c6c", "message": "Fix changes information", "committedDate": "2020-09-07T14:40:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQ3NzQ3OA==", "url": "https://github.com/crate/crate/pull/10200#discussion_r484477478", "bodyText": "This seems strange on the first view. The problem with propagating the underlying exception and handling the message creation later is, that the root cause might end up in a NotSerializableExceptionWrapper if it is not serializable across nodes and then the error message will differ whenever it was wrapped or not. This can cause flakiness depending on the cluster setup of the test. Now the error message is created before the exception is further propagated. If you have a better idea how to handle that let me know.", "author": "mkleen", "createdAt": "2020-09-07T14:52:43Z", "path": "server/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java", "diffHunk": "@@ -790,8 +791,10 @@ public String startVerification() {\n                 }\n                 return seed;\n             }\n-        } catch (IOException exp) {\n-            throw new RepositoryVerificationException(metadata.name(), \"path \" + basePath() + \" is not accessible on master node\", exp);\n+        } catch (Exception e) {\n+            throw new RepositoryVerificationException(metadata.name(),\n+                        String.format(Locale.ENGLISH, \"Unable to verify the repository, [%s] is not accessible on master node: %s '%s'\",", "originalCommit": "5c743e3410c2e9990a7fa8745e4c391561e55c6c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQ4MjMyNQ==", "url": "https://github.com/crate/crate/pull/10200#discussion_r484482325", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    String.format(Locale.ENGLISH, \"Unable to verify the repository, [%s] is not accessible on master node: %s '%s'\",\n          \n          \n            \n                                                  metadata.name(), e.getCause().getClass().getSimpleName(), e.getCause().getMessage()));\n          \n          \n            \n                                    String.format(Locale.ENGLISH,\n          \n          \n            \n                                                 \"Unable to verify the repository, it is not accessible on the master node: %s '%s'\",\n          \n          \n            \n                                                 e.getCause().getClass().getSimpleName(),\n          \n          \n            \n                                                 e.getCause().getMessage()));", "author": "seut", "createdAt": "2020-09-07T15:02:47Z", "path": "server/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java", "diffHunk": "@@ -790,8 +791,10 @@ public String startVerification() {\n                 }\n                 return seed;\n             }\n-        } catch (IOException exp) {\n-            throw new RepositoryVerificationException(metadata.name(), \"path \" + basePath() + \" is not accessible on master node\", exp);\n+        } catch (Exception e) {\n+            throw new RepositoryVerificationException(metadata.name(),\n+                        String.format(Locale.ENGLISH, \"Unable to verify the repository, [%s] is not accessible on master node: %s '%s'\",\n+                                      metadata.name(), e.getCause().getClass().getSimpleName(), e.getCause().getMessage()));", "originalCommit": "5c743e3410c2e9990a7fa8745e4c391561e55c6c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1f567097511a6a34e57268bcffdad8bcf9acdbf2", "url": "https://github.com/crate/crate/commit/1f567097511a6a34e57268bcffdad8bcf9acdbf2", "message": "Improve error message on repository creation failures\n\nThis Added detailed information to possible errors on ``repository``\ncreation to give better insights in the root cause of the error.", "committedDate": "2020-09-07T19:08:00Z", "type": "forcePushed"}, {"oid": "742d16d5ff9e192bc028696f4090b3eba1be7e33", "url": "https://github.com/crate/crate/commit/742d16d5ff9e192bc028696f4090b3eba1be7e33", "message": "fix test", "committedDate": "2020-09-07T19:47:37Z", "type": "forcePushed"}, {"oid": "b8b7411afb45899659810b106c706af67d2d69a6", "url": "https://github.com/crate/crate/commit/b8b7411afb45899659810b106c706af67d2d69a6", "message": "Improve error message on repository creation failures\n\nThis adds detailed information to possible errors on repository\ncreation to give better insights in the root cause of the error.", "committedDate": "2020-09-07T20:15:48Z", "type": "forcePushed"}, {"oid": "7890985cbe30f532941533376ce6050a250c75d0", "url": "https://github.com/crate/crate/commit/7890985cbe30f532941533376ce6050a250c75d0", "message": "Improve error message on repository creation failures\n\nThis adds detailed information to possible errors on repository\ncreation to give better insights in the root cause of the error.", "committedDate": "2020-09-07T20:28:00Z", "type": "forcePushed"}, {"oid": "9f9af53c157485a6d09576ee35261e3b739aaf1d", "url": "https://github.com/crate/crate/commit/9f9af53c157485a6d09576ee35261e3b739aaf1d", "message": "Improve error message on repository creation failures\n\nThis adds detailed information to possible errors on repository\ncreation to give better insights in the root cause of the error.", "committedDate": "2020-09-07T20:34:48Z", "type": "commit"}, {"oid": "9f9af53c157485a6d09576ee35261e3b739aaf1d", "url": "https://github.com/crate/crate/commit/9f9af53c157485a6d09576ee35261e3b739aaf1d", "message": "Improve error message on repository creation failures\n\nThis adds detailed information to possible errors on repository\ncreation to give better insights in the root cause of the error.", "committedDate": "2020-09-07T20:34:48Z", "type": "forcePushed"}]}