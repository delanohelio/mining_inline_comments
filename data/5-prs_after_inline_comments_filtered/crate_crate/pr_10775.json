{"pr_number": 10775, "pr_title": "Added the ``delimiter`` option for copy fromm CSV files.", "pr_createdAt": "2020-11-16T13:38:01Z", "pr_url": "https://github.com/crate/crate/pull/10775", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI5MTQ2MQ==", "url": "https://github.com/crate/crate/pull/10775#discussion_r524291461", "bodyText": "Could we set the default value in the CSV_COLUMN_SEPARATOR definition?\nIt might also be possible to change the type of the setting to  Setting<Char>, then the whole logic could be encapsulated within the setting itself and here we'd use CSV_COLUMN_SEPARATOR.get(settings) to retrieve the final value.", "author": "mfussenegger", "createdAt": "2020-11-16T14:06:42Z", "path": "server/src/main/java/io/crate/analyze/CopyFromParserProperties.java", "diffHunk": "@@ -39,29 +41,47 @@\n     public static final CopyFromParserProperties DEFAULT = CopyFromParserProperties.of(Settings.EMPTY);\n \n     private final boolean emptyStringAsNull;\n+    private final char columnSeparator;\n \n     public static CopyFromParserProperties of(Settings settings) {\n+        var csvColumnSeparatorAsString = settings.get(CSV_COLUMN_SEPARATOR.getKey());\n+        char csvColumnSeparator;\n+        if (csvColumnSeparatorAsString == null) {\n+            csvColumnSeparator = CsvSchema.DEFAULT_COLUMN_SEPARATOR;", "originalCommit": "6d012c42bc639d3202f12c7adbfa48ef5ee2a3b9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM0MDkwMQ==", "url": "https://github.com/crate/crate/pull/10775#discussion_r524340901", "bodyText": "But the default value is always going to have the String type, so I am not sure whether we can use Setting<Character> without changing the Setting.class.\n    private Setting(Key key, @Nullable Setting<T> fallbackSetting, Function<Settings, String> defaultValue, Function<String, T> parser,\n                    Validator<T> validator, Property... properties) {", "author": "kovrus", "createdAt": "2020-11-16T15:13:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI5MTQ2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDk2NzQzOQ==", "url": "https://github.com/crate/crate/pull/10775#discussion_r524967439", "bodyText": "Something like this should work, no?\npublic static final Setting<Character> CSV_COLUMN_SEPARATOR = new Setting<Character>(\n    \"delimiter\",\n    \",\",\n    value -> {\n        if (value.length() != 1) {\n            throw new IllegalArgumentException(\n                \"Invalid CSV fields delimiter: \" + value + \". The delimiter must be a single character.\");\n        }\n        return value.charAt(0);\n    },\n    Setting.Property.Dynamic\n);", "author": "mfussenegger", "createdAt": "2020-11-17T08:28:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI5MTQ2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDk5NTk3Nw==", "url": "https://github.com/crate/crate/pull/10775#discussion_r524995977", "bodyText": "hmm indeed.. was confused about default string value.", "author": "kovrus", "createdAt": "2020-11-17T09:13:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI5MTQ2MQ=="}], "type": "inlineReview"}, {"oid": "a06bc4f9410f146c2f8866d3bf51f584e62a7f6a", "url": "https://github.com/crate/crate/commit/a06bc4f9410f146c2f8866d3bf51f584e62a7f6a", "message": "Added the ``delimiter`` option for copy from CSV files.\n\nThe option is used to specify the character that separates\ncolumns within a row.", "committedDate": "2020-11-16T15:32:06Z", "type": "forcePushed"}, {"oid": "e03dd21f1f715d26df2131da9194181c28025a31", "url": "https://github.com/crate/crate/commit/e03dd21f1f715d26df2131da9194181c28025a31", "message": "Added the ``delimiter`` option for copy from CSV files.\n\nThe option is used to specify the character that separates\ncolumns within a row.", "committedDate": "2020-11-17T09:42:56Z", "type": "forcePushed"}, {"oid": "003104325e1c921320a95df82a02e2966b350c98", "url": "https://github.com/crate/crate/commit/003104325e1c921320a95df82a02e2966b350c98", "message": "Added the ``delimiter`` option for copy from CSV files.\n\nThe option is used to specify the character that separates\ncolumns within a row.", "committedDate": "2020-11-17T14:47:02Z", "type": "commit"}, {"oid": "003104325e1c921320a95df82a02e2966b350c98", "url": "https://github.com/crate/crate/commit/003104325e1c921320a95df82a02e2966b350c98", "message": "Added the ``delimiter`` option for copy from CSV files.\n\nThe option is used to specify the character that separates\ncolumns within a row.", "committedDate": "2020-11-17T14:47:02Z", "type": "forcePushed"}]}