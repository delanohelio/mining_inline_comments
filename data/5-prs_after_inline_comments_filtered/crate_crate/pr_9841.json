{"pr_number": 9841, "pr_title": "Integrate row accounting into HashInnerJoinBatchIterator", "pr_createdAt": "2020-04-01T15:35:17Z", "pr_url": "https://github.com/crate/crate/pull/9841", "timeline": [{"oid": "998c57ef7f11806551ee2f5ed6f4537f62896309", "url": "https://github.com/crate/crate/commit/998c57ef7f11806551ee2f5ed6f4537f62896309", "message": "Integrate row accounting into HashInnerJoinBatchIterator\n\nThe HashInnerJoinBatchIterator already had a concrete dependency to\nRamAccountingBatchIterator, so the RamAccountingBatchIterator never\nacted as a \"transparent\" abstraction.\n\nGiven that the knowledge about which rows should be accounted is always up\nto the implementation of another component, I think having a generic\nRamAccountingBatchIterator doesn't make that much sense.", "committedDate": "2020-04-01T15:32:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTcxMDc4OA==", "url": "https://github.com/crate/crate/pull/9841#discussion_r401710788", "bodyText": "Increased from 7 to 8 because now it is called initially also once in the CTOR. Shouldn't have too much impact.", "author": "mfussenegger", "createdAt": "2020-04-01T15:36:28Z", "path": "sql/src/test/java/io/crate/execution/engine/join/HashInnerJoinBatchIteratorMemoryTest.java", "diffHunk": "@@ -79,21 +85,7 @@ public void testReleaseAccountingRows() throws Exception {\n         TestingRowConsumer consumer = new TestingRowConsumer();\n         consumer.accept(it, null);\n         consumer.getResult();\n-        assertThat(leftIterator.countCallsForReleaseMem, is(7));\n-    }\n-\n-    private class TestRamAccountingBatchIterator extends RamAccountingBatchIterator<Row> {\n-\n-        private int countCallsForReleaseMem = 0;\n-\n-        private TestRamAccountingBatchIterator(BatchIterator<Row> delegatePagingIterator, RowAccounting rowAccounting) {\n-            super(delegatePagingIterator, rowAccounting);\n-        }\n-\n-        @Override\n-        public void releaseAccountedRows() {\n-            countCallsForReleaseMem++;\n-            super.releaseAccountedRows();\n-        }\n+        verify(rowAccounting, times(8)).release();", "originalCommit": "998c57ef7f11806551ee2f5ed6f4537f62896309", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4cc624c527494094e54bd8d9deb3bc467726a7c9", "url": "https://github.com/crate/crate/commit/4cc624c527494094e54bd8d9deb3bc467726a7c9", "message": "Merge branch 'master' into j/hash-join-ram-accounting", "committedDate": "2020-04-02T08:56:16Z", "type": "commit"}]}