{"pr_number": 10077, "pr_title": "Fix NPE in createTableStats that occurred on primitive array types.", "pr_createdAt": "2020-06-12T10:10:03Z", "pr_url": "https://github.com/crate/crate/pull/10077", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTMzMTYzMQ==", "url": "https://github.com/crate/crate/pull/10077#discussion_r439331631", "bodyText": "taking #9851 into consideration it should be fine probably to have a null-safe comparison here such as it the array type?", "author": "kovrus", "createdAt": "2020-06-12T10:13:03Z", "path": "server/src/main/java/io/crate/types/ArrayType.java", "diffHunk": "@@ -173,7 +174,7 @@ public int compare(List<T> val1, List<T> val2) {\n             return -1;\n         }\n         for (int i = 0; i < val1.size(); i++) {\n-            int cmp = innerType.compare(val1.get(i), val2.get(i));\n+            int cmp = Comparator.nullsFirst(innerType).compare(val1.get(i), val2.get(i));", "originalCommit": "4ba31a023fea76c8aa02a60e885f23d919c24c1e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTk5MTc2MA==", "url": "https://github.com/crate/crate/pull/10077#discussion_r439991760", "bodyText": "yes should be fine. The NULLS FIRST / LAST would need  toapply for the array itself, not for individual elements in case we add support for sorting on arrays.", "author": "mfussenegger", "createdAt": "2020-06-15T07:53:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTMzMTYzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTk5MjI4NQ==", "url": "https://github.com/crate/crate/pull/10077#discussion_r439992285", "bodyText": "Please keep those explicit generics, see the comment above it:\n\n// Explicit generic is required for eclipse JDT, otherwise it won't compile", "author": "mfussenegger", "createdAt": "2020-06-15T07:54:13Z", "path": "server/src/main/java/io/crate/statistics/TransportAnalyzeAction.java", "diffHunk": "@@ -103,7 +101,7 @@ public TransportAnalyzeAction(TransportService transportService,\n             AnalyzeRequest::new,\n             ThreadPool.Names.SAME, // goes async right away\n             // Explicit generic is required for eclipse JDT, otherwise it won't compile\n-            new NodeActionRequestHandler<AnalyzeRequest, AcknowledgedResponse>(\n+            new NodeActionRequestHandler<>(", "originalCommit": "4ba31a023fea76c8aa02a60e885f23d919c24c1e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "72beee17f33d29f7db05de92a6f553133b914ba8", "url": "https://github.com/crate/crate/commit/72beee17f33d29f7db05de92a6f553133b914ba8", "message": "fixup! Fix NPE in createTableStats that occured when array(text) types.", "committedDate": "2020-06-15T08:08:08Z", "type": "forcePushed"}, {"oid": "9d200e80b914b10f8eabe38056d2dfc851a0106e", "url": "https://github.com/crate/crate/commit/9d200e80b914b10f8eabe38056d2dfc851a0106e", "message": "fixup! Fix NPE in createTableStats that occured when array(text) types.", "committedDate": "2020-06-15T08:10:21Z", "type": "forcePushed"}, {"oid": "dea438d40e93c6a22460aa993e254d6edf253c92", "url": "https://github.com/crate/crate/commit/dea438d40e93c6a22460aa993e254d6edf253c92", "message": "Fix NPE in createTableStats that occured on primitive array types.", "committedDate": "2020-06-15T08:17:34Z", "type": "forcePushed"}, {"oid": "a3241b047b4c0c7b22f5d37fc476c21ed27ba481", "url": "https://github.com/crate/crate/commit/a3241b047b4c0c7b22f5d37fc476c21ed27ba481", "message": "Fix NPE in createTableStats that occured on primitive array types.", "committedDate": "2020-06-15T08:52:04Z", "type": "commit"}, {"oid": "a3241b047b4c0c7b22f5d37fc476c21ed27ba481", "url": "https://github.com/crate/crate/commit/a3241b047b4c0c7b22f5d37fc476c21ed27ba481", "message": "Fix NPE in createTableStats that occured on primitive array types.", "committedDate": "2020-06-15T08:52:04Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDAyNTc1MA==", "url": "https://github.com/crate/crate/pull/10077#discussion_r440025750", "bodyText": "@mfussenegger i pushed it after the approval. it seems to be flaky.", "author": "kovrus", "createdAt": "2020-06-15T08:52:55Z", "path": "server/src/test/java/io/crate/integrationtests/InsertIntoIntegrationTest.java", "diffHunk": "@@ -1596,7 +1596,7 @@ public void test_insert_from_values_and_subquery_into_varchar_with_length_column\n         execute(\"REFRESH TABLE t1\");\n \n         assertThat(\n-            printedTable(execute(\"SELECT * FROM t1\").rows()),\n+            printedTable(execute(\"SELECT * FROM t1 ORDER BY str\").rows()),", "originalCommit": "a3241b047b4c0c7b22f5d37fc476c21ed27ba481", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}