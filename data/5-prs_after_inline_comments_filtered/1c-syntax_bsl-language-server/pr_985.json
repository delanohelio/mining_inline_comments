{"pr_number": 985, "pr_title": "Typo diagnostic", "pr_createdAt": "2020-03-06T08:04:02Z", "pr_url": "https://github.com/1c-syntax/bsl-language-server/pull/985", "timeline": [{"oid": "31d9f72c9234647538999a8a1614c3fc44addf01", "url": "https://github.com/1c-syntax/bsl-language-server/commit/31d9f72c9234647538999a8a1614c3fc44addf01", "message": "New diagnostic: Typo detector", "committedDate": "2020-02-03T11:05:04Z", "type": "commit"}, {"oid": "1df7fef866df4bdfff62c380097f04fd766dc434", "url": "https://github.com/1c-syntax/bsl-language-server/commit/1df7fef866df4bdfff62c380097f04fd766dc434", "message": "Merge branch 'develop' of https://github.com/1c-syntax/bsl-language-server into TypoDiagnostic", "committedDate": "2020-02-03T11:05:16Z", "type": "commit"}, {"oid": "44c906ddaf7bc90c636794a6fac8fb5931f93d5b", "url": "https://github.com/1c-syntax/bsl-language-server/commit/44c906ddaf7bc90c636794a6fac8fb5931f93d5b", "message": "New diagnostic: Typo detector", "committedDate": "2020-02-03T12:56:28Z", "type": "commit"}, {"oid": "88d35db7b1a47cc6417723d2c39823b12d49dafd", "url": "https://github.com/1c-syntax/bsl-language-server/commit/88d35db7b1a47cc6417723d2c39823b12d49dafd", "message": "\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e\u0441\u0442\u0435\u0439", "committedDate": "2020-02-04T08:29:48Z", "type": "commit"}, {"oid": "e351b7dd4a7c6ce72e711728629cbc861ba80ebe", "url": "https://github.com/1c-syntax/bsl-language-server/commit/e351b7dd4a7c6ce72e711728629cbc861ba80ebe", "message": "\u0414\u043e\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043f\u043e \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f\u043c", "committedDate": "2020-02-05T14:27:12Z", "type": "commit"}, {"oid": "95691a6b88f758a2de83ea0cde1a832dbdb02f94", "url": "https://github.com/1c-syntax/bsl-language-server/commit/95691a6b88f758a2de83ea0cde1a832dbdb02f94", "message": "Merge branch 'develop' of https://github.com/1c-syntax/bsl-language-server into TypoDiagnostic", "committedDate": "2020-02-05T14:27:32Z", "type": "commit"}, {"oid": "0fe67d81f24081590b58616b706d432a48c42ae5", "url": "https://github.com/1c-syntax/bsl-language-server/commit/0fe67d81f24081590b58616b706d432a48c42ae5", "message": "Merge branch 'develop' of https://github.com/1c-syntax/bsl-language-server into TypoDiagnostic", "committedDate": "2020-02-06T14:51:19Z", "type": "commit"}, {"oid": "a335d30518d98ab9b38893ba822925e3b255d460", "url": "https://github.com/1c-syntax/bsl-language-server/commit/a335d30518d98ab9b38893ba822925e3b255d460", "message": "\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0439", "committedDate": "2020-02-07T14:26:58Z", "type": "commit"}, {"oid": "1925af5e190c43732092d09c09099ef91a762ab1", "url": "https://github.com/1c-syntax/bsl-language-server/commit/1925af5e190c43732092d09c09099ef91a762ab1", "message": "Merge branch 'develop' of https://github.com/1c-syntax/bsl-language-server into TypoDiagnostic", "committedDate": "2020-02-07T14:27:33Z", "type": "commit"}, {"oid": "09ee5f051fedbacb1a4afd7f80a2656e61fe420d", "url": "https://github.com/1c-syntax/bsl-language-server/commit/09ee5f051fedbacb1a4afd7f80a2656e61fe420d", "message": "\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0439", "committedDate": "2020-02-09T16:16:43Z", "type": "commit"}, {"oid": "6116a398543bce7a7d3f37a09a62c8c5f78565b3", "url": "https://github.com/1c-syntax/bsl-language-server/commit/6116a398543bce7a7d3f37a09a62c8c5f78565b3", "message": "\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0434\u043e\u043f.\u0443\u0441\u043b\u043e\u0432\u0438\u0439 \u043d\u0430 \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0437\u0430\u043c\u0435\u043d", "committedDate": "2020-02-10T09:37:30Z", "type": "commit"}, {"oid": "2f145fd5ca03dfab750cd2dc9b657f9e1d78a1bb", "url": "https://github.com/1c-syntax/bsl-language-server/commit/2f145fd5ca03dfab750cd2dc9b657f9e1d78a1bb", "message": "\u041d\u043e\u0432\u0430\u044f \u0432\u0435\u0440\u0441\u0438\u044f \u0440\u0435\u0430\u043b\u0437\u0438\u0430\u0446\u0438\u0438. \u041f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u0430\u044f \u0442\u043e\u043a\u0435\u043d\u0438\u0437\u0430\u0446\u0438\u044f", "committedDate": "2020-02-12T08:44:37Z", "type": "commit"}, {"oid": "cd053bb4f527ec4fc8e3352a051049ca01b8ba89", "url": "https://github.com/1c-syntax/bsl-language-server/commit/cd053bb4f527ec4fc8e3352a051049ca01b8ba89", "message": "\u041d\u043e\u0432\u044b\u0439 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 \u043d\u0430 \u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u0443\u044e \u0434\u043b\u0438\u043d\u0443 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c\u044b\u0445 \u0441\u0442\u0440\u043e\u043a", "committedDate": "2020-02-13T09:45:21Z", "type": "commit"}, {"oid": "2f211c7dde3f4f30ae4a005cc4541e9ae8917cfa", "url": "https://github.com/1c-syntax/bsl-language-server/commit/2f211c7dde3f4f30ae4a005cc4541e9ae8917cfa", "message": "\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 \u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0439 \u0434\u043b\u0438\u043d\u044b \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c\u044b\u0445 \u0441\u043b\u043e\u0432.", "committedDate": "2020-02-13T11:15:08Z", "type": "commit"}, {"oid": "ca5475c2484e6f891296e65683b5503ddaf93d63", "url": "https://github.com/1c-syntax/bsl-language-server/commit/ca5475c2484e6f891296e65683b5503ddaf93d63", "message": "Merge branch 'develop' of https://github.com/1c-syntax/bsl-language-server into TypoDiagnostic\n\n\u0001 Conflicts:\n\u0001\tdocs/diagnostics/index.md\n\u0001\tdocs/en/diagnostics/index.md", "committedDate": "2020-02-13T11:18:06Z", "type": "commit"}, {"oid": "cbc2bd772a8997b39903130abe8e69f92ca52f95", "url": "https://github.com/1c-syntax/bsl-language-server/commit/cbc2bd772a8997b39903130abe8e69f92ca52f95", "message": "precommit", "committedDate": "2020-02-13T11:21:18Z", "type": "commit"}, {"oid": "32b39f20052438385e47e8b2206aacbc2a75c123", "url": "https://github.com/1c-syntax/bsl-language-server/commit/32b39f20052438385e47e8b2206aacbc2a75c123", "message": "\u0418\u0441\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u0443\u0441\u043b\u043e\u0432\u0438\u044f \u0432 matches, \u0437\u0430\u043c\u0435\u043d\u0430 ArrayList \u043d\u0430 HashSet", "committedDate": "2020-02-13T11:40:52Z", "type": "commit"}, {"oid": "7f39369fcbce087efaf7641186d85cf566b51bab", "url": "https://github.com/1c-syntax/bsl-language-server/commit/7f39369fcbce087efaf7641186d85cf566b51bab", "message": "\u0417\u0430\u043c\u0435\u043d\u0430 \u043f\u0440\u043e\u0441\u0442\u044b\u0445 \u0443\u0441\u043b\u043e\u0432\u0438\u0439 \u043d\u0430 computeIf", "committedDate": "2020-02-13T13:23:10Z", "type": "commit"}, {"oid": "5c3d2aaff5aa82fa7f219e0c3e7c11d147e2445a", "url": "https://github.com/1c-syntax/bsl-language-server/commit/5c3d2aaff5aa82fa7f219e0c3e7c11d147e2445a", "message": "\u0417\u0430\u043c\u0435\u043d\u0430 \u043f\u043e\u0438\u0441\u043a\u0430 \u0442\u043e\u043a\u0435\u043d\u043e\u0432 \u0432 AST, \u043d\u0430 \u043f\u043e\u0438\u0441\u043a \u043f\u043e \u043b\u0438\u043d\u0435\u0439\u043d\u043e\u043c\u0443 \u0441\u043f\u0438\u0441\u043a\u0443", "committedDate": "2020-02-13T13:30:59Z", "type": "commit"}, {"oid": "aad6bb6a6d1d1b5a352c445c4b4d798b8ea197f7", "url": "https://github.com/1c-syntax/bsl-language-server/commit/aad6bb6a6d1d1b5a352c445c4b4d798b8ea197f7", "message": "\u041d\u0435\u0431\u043e\u043b\u044c\u0448\u043e\u0439 \u0440\u0435\u0444\u0430\u043a\u0442\u043e\u0440\u0438\u043d\u0433", "committedDate": "2020-02-13T14:45:45Z", "type": "commit"}, {"oid": "fd9c3e2306b5a77eddcdd6c3647221231abff9ac", "url": "https://github.com/1c-syntax/bsl-language-server/commit/fd9c3e2306b5a77eddcdd6c3647221231abff9ac", "message": "\u0412\u044b\u043d\u043e\u0441 LT \u0432 \u0441\u0442\u0430\u0442\u0438\u043a. \u0421\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0430\u0446\u0438\u044f \u043c\u0435\u0442\u043e\u0434\u0430 check", "committedDate": "2020-02-15T10:05:44Z", "type": "commit"}, {"oid": "e0c1f7fc9efde6fb20071811e7bbf7b16414974e", "url": "https://github.com/1c-syntax/bsl-language-server/commit/e0c1f7fc9efde6fb20071811e7bbf7b16414974e", "message": "Merge branch 'develop' of https://github.com/1c-syntax/bsl-language-server into TypoDiagnostic", "committedDate": "2020-02-27T09:38:20Z", "type": "commit"}, {"oid": "ee9cb2e20c662ac918cfc3ce58c97ad0a76e750d", "url": "https://github.com/1c-syntax/bsl-language-server/commit/ee9cb2e20c662ac918cfc3ce58c97ad0a76e750d", "message": "Downgrade to LT 4.2", "committedDate": "2020-02-27T10:36:48Z", "type": "commit"}, {"oid": "0d94a150e800734b0efd0d7f593dfaf8e746de9e", "url": "https://github.com/1c-syntax/bsl-language-server/commit/0d94a150e800734b0efd0d7f593dfaf8e746de9e", "message": "\u041f\u043e\u043f\u0440\u0430\u0432\u043b\u0435\u043d \u0431\u0430\u0433 \u0441 \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435\u043c \u043f\u0440\u0430\u0432\u0438\u043b \u0434\u043b\u044f \u0430\u043d\u0433\u043b\u0438\u0439\u0441\u043a\u043e\u0433\u043e \u0441\u043b\u043e\u0432\u0430\u0440\u044f", "committedDate": "2020-02-27T12:55:49Z", "type": "commit"}, {"oid": "5795ece9a5d5f1f1a05cf33a6047b8d24d9e3876", "url": "https://github.com/1c-syntax/bsl-language-server/commit/5795ece9a5d5f1f1a05cf33a6047b8d24d9e3876", "message": "precommit", "committedDate": "2020-02-27T13:17:38Z", "type": "commit"}, {"oid": "a4acdd3149862db001e678db49e13569ca1f327b", "url": "https://github.com/1c-syntax/bsl-language-server/commit/a4acdd3149862db001e678db49e13569ca1f327b", "message": "\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043d\u043e\u0432\u043e\u0433\u043e \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430, \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0442\u0435\u0441\u0442\u043e\u0432, precommit", "committedDate": "2020-02-27T18:13:01Z", "type": "commit"}, {"oid": "25eea124c1386c18a27357beb30b86a3f3aa06cc", "url": "https://github.com/1c-syntax/bsl-language-server/commit/25eea124c1386c18a27357beb30b86a3f3aa06cc", "message": "Merge branch 'develop' of https://github.com/1c-syntax/bsl-language-server into TypoDiagnostic", "committedDate": "2020-03-05T09:29:22Z", "type": "commit"}, {"oid": "05cc2ec3a5566766040910456d3d1cf1e0c43001", "url": "https://github.com/1c-syntax/bsl-language-server/commit/05cc2ec3a5566766040910456d3d1cf1e0c43001", "message": "\u0420\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435 \u0441\u043b\u043e\u0432\u0430\u0440\u044f \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0439 \u0434\u043b\u044f \u0430\u043d\u0433\u043b\u0438\u0439\u0441\u043a\u043e\u0433\u043e \u044f\u0437\u044b\u043a\u0430. \u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0442\u0435\u043a\u0441\u0442\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f.", "committedDate": "2020-03-05T10:11:59Z", "type": "commit"}, {"oid": "d3b0009ec6335247e8a84a1ce72e29be2945842f", "url": "https://github.com/1c-syntax/bsl-language-server/commit/d3b0009ec6335247e8a84a1ce72e29be2945842f", "message": "\u0420\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435 \u0441\u043b\u043e\u0432\u0430\u0440\u044f \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0439 \u0434\u043b\u044f \u0430\u043d\u0433\u043b\u0438\u0439\u0441\u043a\u043e\u0433\u043e \u044f\u0437\u044b\u043a\u0430. \u0423\u0432\u0435\u043b\u0438\u0447\u0435\u043d\u0438\u0435 \u0434\u043b\u0438\u043d\u044b \u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0439 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u0441\u043b\u043e\u0432", "committedDate": "2020-03-05T12:28:05Z", "type": "commit"}, {"oid": "c6e098e55d59a6e189be023e11cb035b29377b95", "url": "https://github.com/1c-syntax/bsl-language-server/commit/c6e098e55d59a6e189be023e11cb035b29377b95", "message": "\u0420\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435 \u0441\u043b\u043e\u0432\u0430\u0440\u044f \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0439.", "committedDate": "2020-03-05T14:10:14Z", "type": "commit"}, {"oid": "385d0604e46002bca8345f0d2aaf038b32332a89", "url": "https://github.com/1c-syntax/bsl-language-server/commit/385d0604e46002bca8345f0d2aaf038b32332a89", "message": "\u0417\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0434\u0438\u0430\u0433\u043d\u043e\u0441\u0442\u0438\u043a", "committedDate": "2020-03-05T14:46:26Z", "type": "commit"}, {"oid": "9e58c2c16753028e6f457669699f910161174a5c", "url": "https://github.com/1c-syntax/bsl-language-server/commit/9e58c2c16753028e6f457669699f910161174a5c", "message": "precommit", "committedDate": "2020-03-06T08:01:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc4NjIyMg==", "url": "https://github.com/1c-syntax/bsl-language-server/pull/985#discussion_r388786222", "bodyText": "\u041c\u043e\u0436\u0435\u0442 \u0441\u0442\u043e\u0438\u0442 \u0434\u043e\u043f\u0438\u0441\u0430\u0442\u044c \u0434\u0435\u0444\u043e\u043b\u0442\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435?", "author": "theshadowco", "createdAt": "2020-03-06T09:08:36Z", "path": "src/main/java/com/github/_1c_syntax/bsl/languageserver/diagnostics/TypoDiagnostic.java", "diffHunk": "@@ -0,0 +1,185 @@\n+/*\n+ * This file is a part of BSL Language Server.\n+ *\n+ * Copyright \u00a9 2018-2020\n+ * Alexey Sosnoviy <labotamy@gmail.com>, Nikita Gryzlov <nixel2007@gmail.com> and contributors\n+ *\n+ * SPDX-License-Identifier: LGPL-3.0-or-later\n+ *\n+ * BSL Language Server is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation; either\n+ * version 3.0 of the License, or (at your option) any later version.\n+ *\n+ * BSL Language Server is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with BSL Language Server.\n+ */\n+package com.github._1c_syntax.bsl.languageserver.diagnostics;\n+\n+import com.github._1c_syntax.bsl.languageserver.context.DocumentContext;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticInfo;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticMetadata;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticParameter;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticSeverity;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticTag;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticType;\n+import com.github._1c_syntax.bsl.parser.BSLParser;\n+import lombok.extern.slf4j.Slf4j;\n+import org.antlr.v4.runtime.Token;\n+import org.apache.commons.lang3.StringUtils;\n+import org.languagetool.JLanguageTool;\n+import org.languagetool.language.AmericanEnglish;\n+import org.languagetool.language.Russian;\n+import org.languagetool.rules.Rule;\n+import org.languagetool.rules.RuleMatch;\n+import org.languagetool.rules.spelling.SpellingCheckRule;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+@DiagnosticMetadata(\n+  type = DiagnosticType.CODE_SMELL,\n+  severity = DiagnosticSeverity.INFO,\n+  minutesToFix = 1,\n+  tags = {\n+    DiagnosticTag.BADPRACTICE\n+  }\n+)\n+\n+@Slf4j\n+public class TypoDiagnostic extends AbstractDiagnostic {\n+\n+  private static final Russian ruLang = new Russian();\n+  private static final AmericanEnglish enLang = new AmericanEnglish();\n+  private static final JLanguageTool ruLangTool = new JLanguageTool(ruLang);\n+  private static final JLanguageTool enLangTool = new JLanguageTool(enLang);\n+  private static Map<String, JLanguageTool> languageToolMap = new HashMap<>();\n+\n+  private static final int DEFAULT_MIN_WORD_LENGTH = 3;\n+  private static final String DEFAULT_USER_WORDS_TO_IGNORE = \"\";\n+\n+  @DiagnosticParameter(\n+    type = Integer.class,\n+    defaultValue = \"\" + DEFAULT_MIN_WORD_LENGTH\n+  )\n+  private int minWordLength = DEFAULT_MIN_WORD_LENGTH;\n+\n+  @DiagnosticParameter(\n+    type = String.class", "originalCommit": "9e58c2c16753028e6f457669699f910161174a5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc5MzMwNQ==", "url": "https://github.com/1c-syntax/bsl-language-server/pull/985#discussion_r388793305", "bodyText": "@theshadowco \u0414\u0435\u0444\u043e\u043b\u0442\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u0441\u043a\u043e\u0433\u043e \u0441\u043b\u043e\u0432\u0430\u0440\u044f \u044d\u0442\u043e \u043f\u0443\u0441\u0442\u0430\u044f \u0441\u0442\u0440\u043e\u043a\u0430. \u041e\u0431\u044a\u044f\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u0443\u0441\u0442\u043e\u0439 \u0441\u0442\u0440\u043e\u043a\u0438 IDEA \u043f\u043e\u043c\u0435\u0447\u0430\u0435\u0442 \u043a\u0430\u043a \u0438\u0437\u0431\u044b\u0442\u043e\u0447\u043d\u043e\u0435.", "author": "EightM", "createdAt": "2020-03-06T09:23:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc4NjIyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc4NzEwMw==", "url": "https://github.com/1c-syntax/bsl-language-server/pull/985#discussion_r388787103", "bodyText": "\u043b\u0443\u0447\u0448\u0435 \u043f\u0435\u0440\u0435\u043d\u0435\u0441\u0442\u0438 \u0441\u0442\u0440\u043e\u043a\u0438, \u0441\u043e\u043d\u0430\u0440 \u0437\u0430\u0440\u0443\u0433\u0430\u0435\u0442\u0441\u044f", "author": "theshadowco", "createdAt": "2020-03-06T09:10:41Z", "path": "src/main/java/com/github/_1c_syntax/bsl/languageserver/diagnostics/TypoDiagnostic.java", "diffHunk": "@@ -0,0 +1,185 @@\n+/*\n+ * This file is a part of BSL Language Server.\n+ *\n+ * Copyright \u00a9 2018-2020\n+ * Alexey Sosnoviy <labotamy@gmail.com>, Nikita Gryzlov <nixel2007@gmail.com> and contributors\n+ *\n+ * SPDX-License-Identifier: LGPL-3.0-or-later\n+ *\n+ * BSL Language Server is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation; either\n+ * version 3.0 of the License, or (at your option) any later version.\n+ *\n+ * BSL Language Server is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with BSL Language Server.\n+ */\n+package com.github._1c_syntax.bsl.languageserver.diagnostics;\n+\n+import com.github._1c_syntax.bsl.languageserver.context.DocumentContext;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticInfo;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticMetadata;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticParameter;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticSeverity;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticTag;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticType;\n+import com.github._1c_syntax.bsl.parser.BSLParser;\n+import lombok.extern.slf4j.Slf4j;\n+import org.antlr.v4.runtime.Token;\n+import org.apache.commons.lang3.StringUtils;\n+import org.languagetool.JLanguageTool;\n+import org.languagetool.language.AmericanEnglish;\n+import org.languagetool.language.Russian;\n+import org.languagetool.rules.Rule;\n+import org.languagetool.rules.RuleMatch;\n+import org.languagetool.rules.spelling.SpellingCheckRule;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+@DiagnosticMetadata(\n+  type = DiagnosticType.CODE_SMELL,\n+  severity = DiagnosticSeverity.INFO,\n+  minutesToFix = 1,\n+  tags = {\n+    DiagnosticTag.BADPRACTICE\n+  }\n+)\n+\n+@Slf4j\n+public class TypoDiagnostic extends AbstractDiagnostic {\n+\n+  private static final Russian ruLang = new Russian();\n+  private static final AmericanEnglish enLang = new AmericanEnglish();\n+  private static final JLanguageTool ruLangTool = new JLanguageTool(ruLang);\n+  private static final JLanguageTool enLangTool = new JLanguageTool(enLang);\n+  private static Map<String, JLanguageTool> languageToolMap = new HashMap<>();\n+\n+  private static final int DEFAULT_MIN_WORD_LENGTH = 3;\n+  private static final String DEFAULT_USER_WORDS_TO_IGNORE = \"\";\n+\n+  @DiagnosticParameter(\n+    type = Integer.class,\n+    defaultValue = \"\" + DEFAULT_MIN_WORD_LENGTH\n+  )\n+  private int minWordLength = DEFAULT_MIN_WORD_LENGTH;\n+\n+  @DiagnosticParameter(\n+    type = String.class\n+  )\n+  private String userWordsToIgnore = DEFAULT_USER_WORDS_TO_IGNORE;\n+\n+  public TypoDiagnostic(DiagnosticInfo info) {\n+    super(info);\n+  }\n+\n+  @Override\n+  public void configure(Map<String, Object> configuration) {\n+    if (configuration == null) {\n+      return;\n+    }\n+    minWordLength = (int) configuration.getOrDefault(\"minWordLength\", minWordLength);\n+    userWordsToIgnore = (String) configuration.getOrDefault(\"userWordsToIgnore\", userWordsToIgnore);\n+  }\n+\n+  private ArrayList<String> getWordsToIgnore() {\n+    String exceptions = info.getResourceString(\"diagnosticExceptions\").replaceAll(\"\\n\", \"\");\n+    return new ArrayList<>(Arrays.asList(exceptions.split(\",\")));\n+  }\n+\n+  private ArrayList<String> getUserWordsToIgnore() {\n+    String exceptions = userWordsToIgnore.replaceAll(\"\\n\", \"\");\n+    return new ArrayList<>(Arrays.asList(exceptions.split(\",\")));\n+  }\n+\n+  @Override\n+  protected void check(DocumentContext documentContext) {\n+\n+    String lang = info.getResourceString(\"diagnosticLanguage\");\n+    ArrayList<String> wordsToIgnore = getWordsToIgnore();\n+\n+    languageToolMap.put(\"ru\", ruLangTool);\n+    languageToolMap.put(\"en\", enLangTool);\n+\n+    languageToolMap.get(lang).getAllRules().stream().filter(rule -> !rule.isDictionaryBasedSpellingRule()).map(Rule::getId).forEach(languageToolMap.get(lang)::disableRule);", "originalCommit": "9e58c2c16753028e6f457669699f910161174a5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgwODE3MQ==", "url": "https://github.com/1c-syntax/bsl-language-server/pull/985#discussion_r388808171", "bodyText": "@theshadowco Done", "author": "EightM", "createdAt": "2020-03-06T09:52:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc4NzEwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc4Nzc0NQ==", "url": "https://github.com/1c-syntax/bsl-language-server/pull/985#discussion_r388787745", "bodyText": "\u0421\u0442\u043e\u0438\u0442 \u0437\u0430\u0449\u0438\u0442\u0443 \u043e\u0442 \u043c\u0435\u043d\u044c\u0448\u0435 2\u0445 \u043f\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c", "author": "theshadowco", "createdAt": "2020-03-06T09:12:13Z", "path": "src/main/java/com/github/_1c_syntax/bsl/languageserver/diagnostics/TypoDiagnostic.java", "diffHunk": "@@ -0,0 +1,185 @@\n+/*\n+ * This file is a part of BSL Language Server.\n+ *\n+ * Copyright \u00a9 2018-2020\n+ * Alexey Sosnoviy <labotamy@gmail.com>, Nikita Gryzlov <nixel2007@gmail.com> and contributors\n+ *\n+ * SPDX-License-Identifier: LGPL-3.0-or-later\n+ *\n+ * BSL Language Server is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation; either\n+ * version 3.0 of the License, or (at your option) any later version.\n+ *\n+ * BSL Language Server is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with BSL Language Server.\n+ */\n+package com.github._1c_syntax.bsl.languageserver.diagnostics;\n+\n+import com.github._1c_syntax.bsl.languageserver.context.DocumentContext;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticInfo;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticMetadata;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticParameter;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticSeverity;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticTag;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticType;\n+import com.github._1c_syntax.bsl.parser.BSLParser;\n+import lombok.extern.slf4j.Slf4j;\n+import org.antlr.v4.runtime.Token;\n+import org.apache.commons.lang3.StringUtils;\n+import org.languagetool.JLanguageTool;\n+import org.languagetool.language.AmericanEnglish;\n+import org.languagetool.language.Russian;\n+import org.languagetool.rules.Rule;\n+import org.languagetool.rules.RuleMatch;\n+import org.languagetool.rules.spelling.SpellingCheckRule;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+@DiagnosticMetadata(\n+  type = DiagnosticType.CODE_SMELL,\n+  severity = DiagnosticSeverity.INFO,\n+  minutesToFix = 1,\n+  tags = {\n+    DiagnosticTag.BADPRACTICE\n+  }\n+)\n+\n+@Slf4j\n+public class TypoDiagnostic extends AbstractDiagnostic {\n+\n+  private static final Russian ruLang = new Russian();\n+  private static final AmericanEnglish enLang = new AmericanEnglish();\n+  private static final JLanguageTool ruLangTool = new JLanguageTool(ruLang);\n+  private static final JLanguageTool enLangTool = new JLanguageTool(enLang);\n+  private static Map<String, JLanguageTool> languageToolMap = new HashMap<>();\n+\n+  private static final int DEFAULT_MIN_WORD_LENGTH = 3;\n+  private static final String DEFAULT_USER_WORDS_TO_IGNORE = \"\";\n+\n+  @DiagnosticParameter(\n+    type = Integer.class,\n+    defaultValue = \"\" + DEFAULT_MIN_WORD_LENGTH\n+  )\n+  private int minWordLength = DEFAULT_MIN_WORD_LENGTH;\n+\n+  @DiagnosticParameter(\n+    type = String.class\n+  )\n+  private String userWordsToIgnore = DEFAULT_USER_WORDS_TO_IGNORE;\n+\n+  public TypoDiagnostic(DiagnosticInfo info) {\n+    super(info);\n+  }\n+\n+  @Override\n+  public void configure(Map<String, Object> configuration) {\n+    if (configuration == null) {\n+      return;\n+    }\n+    minWordLength = (int) configuration.getOrDefault(\"minWordLength\", minWordLength);", "originalCommit": "9e58c2c16753028e6f457669699f910161174a5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgwODI0OQ==", "url": "https://github.com/1c-syntax/bsl-language-server/pull/985#discussion_r388808249", "bodyText": "@theshadowco Done", "author": "EightM", "createdAt": "2020-03-06T09:52:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc4Nzc0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc4ODIyMA==", "url": "https://github.com/1c-syntax/bsl-language-server/pull/985#discussion_r388788220", "bodyText": "\u041d\u0430\u0434\u043e \u0440\u0430\u0437\u0431\u0438\u0432\u0430\u0442\u044c \u043c\u0435\u0442\u043e\u0434 \u043d\u0430 \u0447\u0430\u0441\u0442\u0438", "author": "theshadowco", "createdAt": "2020-03-06T09:13:19Z", "path": "src/main/java/com/github/_1c_syntax/bsl/languageserver/diagnostics/TypoDiagnostic.java", "diffHunk": "@@ -0,0 +1,185 @@\n+/*\n+ * This file is a part of BSL Language Server.\n+ *\n+ * Copyright \u00a9 2018-2020\n+ * Alexey Sosnoviy <labotamy@gmail.com>, Nikita Gryzlov <nixel2007@gmail.com> and contributors\n+ *\n+ * SPDX-License-Identifier: LGPL-3.0-or-later\n+ *\n+ * BSL Language Server is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation; either\n+ * version 3.0 of the License, or (at your option) any later version.\n+ *\n+ * BSL Language Server is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with BSL Language Server.\n+ */\n+package com.github._1c_syntax.bsl.languageserver.diagnostics;\n+\n+import com.github._1c_syntax.bsl.languageserver.context.DocumentContext;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticInfo;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticMetadata;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticParameter;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticSeverity;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticTag;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticType;\n+import com.github._1c_syntax.bsl.parser.BSLParser;\n+import lombok.extern.slf4j.Slf4j;\n+import org.antlr.v4.runtime.Token;\n+import org.apache.commons.lang3.StringUtils;\n+import org.languagetool.JLanguageTool;\n+import org.languagetool.language.AmericanEnglish;\n+import org.languagetool.language.Russian;\n+import org.languagetool.rules.Rule;\n+import org.languagetool.rules.RuleMatch;\n+import org.languagetool.rules.spelling.SpellingCheckRule;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+@DiagnosticMetadata(\n+  type = DiagnosticType.CODE_SMELL,\n+  severity = DiagnosticSeverity.INFO,\n+  minutesToFix = 1,\n+  tags = {\n+    DiagnosticTag.BADPRACTICE\n+  }\n+)\n+\n+@Slf4j\n+public class TypoDiagnostic extends AbstractDiagnostic {\n+\n+  private static final Russian ruLang = new Russian();\n+  private static final AmericanEnglish enLang = new AmericanEnglish();\n+  private static final JLanguageTool ruLangTool = new JLanguageTool(ruLang);\n+  private static final JLanguageTool enLangTool = new JLanguageTool(enLang);\n+  private static Map<String, JLanguageTool> languageToolMap = new HashMap<>();\n+\n+  private static final int DEFAULT_MIN_WORD_LENGTH = 3;\n+  private static final String DEFAULT_USER_WORDS_TO_IGNORE = \"\";\n+\n+  @DiagnosticParameter(\n+    type = Integer.class,\n+    defaultValue = \"\" + DEFAULT_MIN_WORD_LENGTH\n+  )\n+  private int minWordLength = DEFAULT_MIN_WORD_LENGTH;\n+\n+  @DiagnosticParameter(\n+    type = String.class\n+  )\n+  private String userWordsToIgnore = DEFAULT_USER_WORDS_TO_IGNORE;\n+\n+  public TypoDiagnostic(DiagnosticInfo info) {\n+    super(info);\n+  }\n+\n+  @Override\n+  public void configure(Map<String, Object> configuration) {\n+    if (configuration == null) {\n+      return;\n+    }\n+    minWordLength = (int) configuration.getOrDefault(\"minWordLength\", minWordLength);\n+    userWordsToIgnore = (String) configuration.getOrDefault(\"userWordsToIgnore\", userWordsToIgnore);\n+  }\n+\n+  private ArrayList<String> getWordsToIgnore() {\n+    String exceptions = info.getResourceString(\"diagnosticExceptions\").replaceAll(\"\\n\", \"\");\n+    return new ArrayList<>(Arrays.asList(exceptions.split(\",\")));\n+  }\n+\n+  private ArrayList<String> getUserWordsToIgnore() {\n+    String exceptions = userWordsToIgnore.replaceAll(\"\\n\", \"\");\n+    return new ArrayList<>(Arrays.asList(exceptions.split(\",\")));\n+  }\n+\n+  @Override\n+  protected void check(DocumentContext documentContext) {", "originalCommit": "9e58c2c16753028e6f457669699f910161174a5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgwODM1Mw==", "url": "https://github.com/1c-syntax/bsl-language-server/pull/985#discussion_r388808353", "bodyText": "@theshadowco Done", "author": "EightM", "createdAt": "2020-03-06T09:52:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc4ODIyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc5MDkwNg==", "url": "https://github.com/1c-syntax/bsl-language-server/pull/985#discussion_r388790906", "bodyText": "\u0410 \u0437\u0430\u0447\u0435\u043c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043e\u0431\u0430, \u0435\u0441\u043b\u0438 \u0432 lang \u0432\u0441\u0435\u0433\u0434\u0430 \u0442\u043e\u043b\u044c\u043a\u043e \u043e\u0434\u0438\u043d?", "author": "theshadowco", "createdAt": "2020-03-06T09:19:05Z", "path": "src/main/java/com/github/_1c_syntax/bsl/languageserver/diagnostics/TypoDiagnostic.java", "diffHunk": "@@ -0,0 +1,185 @@\n+/*\n+ * This file is a part of BSL Language Server.\n+ *\n+ * Copyright \u00a9 2018-2020\n+ * Alexey Sosnoviy <labotamy@gmail.com>, Nikita Gryzlov <nixel2007@gmail.com> and contributors\n+ *\n+ * SPDX-License-Identifier: LGPL-3.0-or-later\n+ *\n+ * BSL Language Server is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation; either\n+ * version 3.0 of the License, or (at your option) any later version.\n+ *\n+ * BSL Language Server is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with BSL Language Server.\n+ */\n+package com.github._1c_syntax.bsl.languageserver.diagnostics;\n+\n+import com.github._1c_syntax.bsl.languageserver.context.DocumentContext;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticInfo;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticMetadata;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticParameter;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticSeverity;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticTag;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticType;\n+import com.github._1c_syntax.bsl.parser.BSLParser;\n+import lombok.extern.slf4j.Slf4j;\n+import org.antlr.v4.runtime.Token;\n+import org.apache.commons.lang3.StringUtils;\n+import org.languagetool.JLanguageTool;\n+import org.languagetool.language.AmericanEnglish;\n+import org.languagetool.language.Russian;\n+import org.languagetool.rules.Rule;\n+import org.languagetool.rules.RuleMatch;\n+import org.languagetool.rules.spelling.SpellingCheckRule;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+@DiagnosticMetadata(\n+  type = DiagnosticType.CODE_SMELL,\n+  severity = DiagnosticSeverity.INFO,\n+  minutesToFix = 1,\n+  tags = {\n+    DiagnosticTag.BADPRACTICE\n+  }\n+)\n+\n+@Slf4j\n+public class TypoDiagnostic extends AbstractDiagnostic {\n+\n+  private static final Russian ruLang = new Russian();\n+  private static final AmericanEnglish enLang = new AmericanEnglish();\n+  private static final JLanguageTool ruLangTool = new JLanguageTool(ruLang);\n+  private static final JLanguageTool enLangTool = new JLanguageTool(enLang);\n+  private static Map<String, JLanguageTool> languageToolMap = new HashMap<>();\n+\n+  private static final int DEFAULT_MIN_WORD_LENGTH = 3;\n+  private static final String DEFAULT_USER_WORDS_TO_IGNORE = \"\";\n+\n+  @DiagnosticParameter(\n+    type = Integer.class,\n+    defaultValue = \"\" + DEFAULT_MIN_WORD_LENGTH\n+  )\n+  private int minWordLength = DEFAULT_MIN_WORD_LENGTH;\n+\n+  @DiagnosticParameter(\n+    type = String.class\n+  )\n+  private String userWordsToIgnore = DEFAULT_USER_WORDS_TO_IGNORE;\n+\n+  public TypoDiagnostic(DiagnosticInfo info) {\n+    super(info);\n+  }\n+\n+  @Override\n+  public void configure(Map<String, Object> configuration) {\n+    if (configuration == null) {\n+      return;\n+    }\n+    minWordLength = (int) configuration.getOrDefault(\"minWordLength\", minWordLength);\n+    userWordsToIgnore = (String) configuration.getOrDefault(\"userWordsToIgnore\", userWordsToIgnore);\n+  }\n+\n+  private ArrayList<String> getWordsToIgnore() {\n+    String exceptions = info.getResourceString(\"diagnosticExceptions\").replaceAll(\"\\n\", \"\");\n+    return new ArrayList<>(Arrays.asList(exceptions.split(\",\")));\n+  }\n+\n+  private ArrayList<String> getUserWordsToIgnore() {\n+    String exceptions = userWordsToIgnore.replaceAll(\"\\n\", \"\");\n+    return new ArrayList<>(Arrays.asList(exceptions.split(\",\")));\n+  }\n+\n+  @Override\n+  protected void check(DocumentContext documentContext) {\n+\n+    String lang = info.getResourceString(\"diagnosticLanguage\");\n+    ArrayList<String> wordsToIgnore = getWordsToIgnore();\n+\n+    languageToolMap.put(\"ru\", ruLangTool);", "originalCommit": "9e58c2c16753028e6f457669699f910161174a5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc5NjI4MQ==", "url": "https://github.com/1c-syntax/bsl-language-server/pull/985#discussion_r388796281", "bodyText": "@theshadowco \u041a\u043e\u043c\u043f\u0438\u043b\u044f\u0446\u0438\u044f LT \u0434\u043e\u043b\u0436\u043d\u0430 \u0431\u044b\u0442\u044c \u0432 \u0441\u0442\u0430\u0442\u0438\u043a\u0435, \u0434\u043b\u044f \u044d\u043a\u043e\u043d\u043e\u043c\u0438\u0438 \u0432\u0440\u0435\u043c\u0435\u043d\u0438, \u0442\u043e\u0433\u0434\u0430 \u043a\u0430\u043a \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 diagnosticLanguage \u0432 \u0441\u0442\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u043c \u0431\u043b\u043e\u043a\u0435 \u044f \u043d\u0435 \u043c\u043e\u0433\u0443.", "author": "EightM", "createdAt": "2020-03-06T09:29:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc5MDkwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgwMjY1MA==", "url": "https://github.com/1c-syntax/bsl-language-server/pull/985#discussion_r388802650", "bodyText": "\u041f\u043e\u043d\u044f\u043b", "author": "theshadowco", "createdAt": "2020-03-06T09:42:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc5MDkwNg=="}], "type": "inlineReview"}, {"oid": "08f2d884735b9bd7db8e192219042b6975dd957b", "url": "https://github.com/1c-syntax/bsl-language-server/commit/08f2d884735b9bd7db8e192219042b6975dd957b", "message": "\u0420\u0435\u0444\u0430\u0442\u043e\u0440\u0438\u043d\u0433 \u043a\u043e\u0434\u0430 \u0441 \u0432\u044b\u043d\u043e\u0441\u043e\u043c \u0432 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u0435 \u043c\u0435\u0442\u043e\u0434\u044b, \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u043d\u043e\u0435 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0434\u0438\u0430\u0433\u043d\u043e\u0441\u0442\u0438\u043a, \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043d\u0430 \u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c\u043e\u0439 \u0441\u0442\u0440\u043e\u043a\u0438", "committedDate": "2020-03-06T09:51:56Z", "type": "commit"}, {"oid": "b43714260b11ca9aafaea51f1506ae9edc93f218", "url": "https://github.com/1c-syntax/bsl-language-server/commit/b43714260b11ca9aafaea51f1506ae9edc93f218", "message": "\u0411\u0430\u043c\u043f \u0432\u0435\u0440\u0441\u0438\u0438 BSL Parser, \u0440\u0435\u0444\u0430\u043a\u0442\u043e\u0440\u0438\u043d\u0433 \u0434\u0438\u0430\u0433\u043d\u043e\u0441\u0442\u0438\u043a\u0438 \u043e\u043f\u0435\u0447\u0430\u0442\u043e\u043a by Nixel, \u043f\u0440\u0430\u0432\u043a\u0430 \u0434\u0438\u0430\u0433\u043d\u043e\u0441\u0442\u0438\u043a\u0438 \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u043f\u0430\u0440\u043e\u043b\u0435\u0439 \u043f\u043e\u0434 \u043d\u043e\u0432\u0443\u044e \u0432\u0435\u0440\u0441\u0438\u044e \u043f\u0430\u0440\u0441\u0435\u0440\u0430.", "committedDate": "2020-03-07T10:11:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTY4NTAzNA==", "url": "https://github.com/1c-syntax/bsl-language-server/pull/985#discussion_r389685034", "bodyText": "@EightM \u044f \u0431\u044b \u0432\u043e\u0442 \u0442\u0443\u0442 \u0442\u043e\u0436\u0435 \u0434\u043e\u043a\u0430\u0442\u0438\u043b \u043c\u043e\u0438 \u043f\u0440\u0430\u0432\u043a\u0438 \u043f\u043e \u0443\u0431\u0438\u0440\u0430\u043d\u0438\u044e \\n \u0438\u0437 \u0440\u0435\u0441\u0443\u0440\u0441\u043e\u0432, \u0447\u0442\u043e\u0431\u044b \u043d\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u043e \u0440\u0430\u0431\u043e\u0442\u0430\u043b\u043e \u0438\u043d\u0442\u0435\u043d\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0441\u0442\u0440\u043e\u043a. \u043d\u0443 \u043b\u0438\u0431\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0435\u0433\u043e \u0441\u044e\u0434\u0430, \u044f\u0432\u043d\u043e \u0432\u044b\u0437\u0432\u0430\u0432 intern() \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u043c \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u043e\u043c", "author": "nixel2007", "createdAt": "2020-03-09T13:47:23Z", "path": "src/main/java/com/github/_1c_syntax/bsl/languageserver/diagnostics/TypoDiagnostic.java", "diffHunk": "@@ -0,0 +1,211 @@\n+/*\n+ * This file is a part of BSL Language Server.\n+ *\n+ * Copyright \u00a9 2018-2020\n+ * Alexey Sosnoviy <labotamy@gmail.com>, Nikita Gryzlov <nixel2007@gmail.com> and contributors\n+ *\n+ * SPDX-License-Identifier: LGPL-3.0-or-later\n+ *\n+ * BSL Language Server is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation; either\n+ * version 3.0 of the License, or (at your option) any later version.\n+ *\n+ * BSL Language Server is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with BSL Language Server.\n+ */\n+package com.github._1c_syntax.bsl.languageserver.diagnostics;\n+\n+import com.github._1c_syntax.bsl.languageserver.context.DocumentContext;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticInfo;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticMetadata;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticParameter;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticSeverity;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticTag;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticType;\n+import com.github._1c_syntax.bsl.languageserver.utils.Trees;\n+import com.github._1c_syntax.bsl.parser.BSLParser;\n+import com.github._1c_syntax.bsl.parser.BSLParserRuleContext;\n+import lombok.extern.slf4j.Slf4j;\n+import org.antlr.v4.runtime.Token;\n+import org.apache.commons.lang3.StringUtils;\n+import org.languagetool.JLanguageTool;\n+import org.languagetool.language.AmericanEnglish;\n+import org.languagetool.language.Russian;\n+import org.languagetool.rules.Rule;\n+import org.languagetool.rules.RuleMatch;\n+import org.languagetool.rules.spelling.SpellingCheckRule;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.regex.Pattern;\n+import java.util.stream.Collectors;\n+\n+@DiagnosticMetadata(\n+  type = DiagnosticType.CODE_SMELL,\n+  severity = DiagnosticSeverity.INFO,\n+  minutesToFix = 1,\n+  tags = {\n+    DiagnosticTag.BADPRACTICE\n+  }\n+)\n+\n+@Slf4j\n+public class TypoDiagnostic extends AbstractDiagnostic {\n+\n+  private static final Russian ruLang = new Russian();\n+  private static final AmericanEnglish enLang = new AmericanEnglish();\n+  private static final JLanguageTool ruLangTool = new JLanguageTool(ruLang);\n+  private static final JLanguageTool enLangTool = new JLanguageTool(enLang);\n+  private static final Map<String, JLanguageTool> languageToolMap = Map.of(\n+    \"en\", enLangTool,\n+    \"ru\", ruLangTool\n+  );\n+\n+  static {\n+    languageToolMap.forEach((lang, languageTool) ->\n+      languageTool.getAllRules().stream()\n+        .filter(rule -> !rule.isDictionaryBasedSpellingRule())\n+        .map(Rule::getId)\n+        .forEach(languageTool::disableRule)\n+    );\n+  }\n+\n+  private static final Pattern SPACES_PATTERN = Pattern.compile(\"\\\\s+\");\n+  private static final Pattern QUOTE_PATTERN = Pattern.compile(\"\\\"\");\n+\n+  private static final Integer[] rulesToFind = new Integer[]{\n+    BSLParser.RULE_string,\n+    BSLParser.RULE_lValue,\n+    BSLParser.RULE_var_name,\n+    BSLParser.RULE_subName\n+  };\n+  private static final Set<Integer> tokenTypes = Set.of(\n+    BSLParser.STRING,\n+    BSLParser.IDENTIFIER\n+  );\n+\n+  private static final int DEFAULT_MIN_WORD_LENGTH = 3;\n+  private static final String DEFAULT_USER_WORDS_TO_IGNORE = \"\";\n+\n+  @DiagnosticParameter(\n+    type = Integer.class,\n+    defaultValue = \"\" + DEFAULT_MIN_WORD_LENGTH\n+  )\n+  private int minWordLength = DEFAULT_MIN_WORD_LENGTH;\n+\n+  @DiagnosticParameter(\n+    type = String.class\n+  )\n+  private String userWordsToIgnore = DEFAULT_USER_WORDS_TO_IGNORE;\n+\n+  public TypoDiagnostic(DiagnosticInfo info) {\n+    super(info);\n+  }\n+\n+  @Override\n+  public void configure(Map<String, Object> configuration) {\n+    if (configuration == null) {\n+      return;\n+    }\n+    minWordLength = Math.max((int) configuration.getOrDefault(\"minWordLength\", minWordLength), 2);\n+    userWordsToIgnore = (String) configuration.getOrDefault(\"userWordsToIgnore\", userWordsToIgnore);\n+  }\n+\n+  private ArrayList<String> getWordsToIgnore() {\n+    String exceptions = info.getResourceString(\"diagnosticExceptions\").replaceAll(\"\\n\", \"\");", "originalCommit": "b43714260b11ca9aafaea51f1506ae9edc93f218", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTc5MDE2Nw==", "url": "https://github.com/1c-syntax/bsl-language-server/pull/985#discussion_r389790167", "bodyText": "Done", "author": "EightM", "createdAt": "2020-03-09T16:02:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTY4NTAzNA=="}], "type": "inlineReview"}, {"oid": "c9ab520b68fec8aa16071524bb49766d8fd3ffbc", "url": "https://github.com/1c-syntax/bsl-language-server/commit/c9ab520b68fec8aa16071524bb49766d8fd3ffbc", "message": "\u0418\u043d\u0442\u0435\u0440\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0441\u0442\u0440\u043e\u043a\u0438", "committedDate": "2020-03-09T14:08:30Z", "type": "commit"}]}