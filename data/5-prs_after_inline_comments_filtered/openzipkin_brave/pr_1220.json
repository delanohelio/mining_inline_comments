{"pr_number": 1220, "pr_title": "Fixes test order in ITHttpClient and ITHttpServer.spanHandlerSeesError", "pr_createdAt": "2020-05-18T11:29:49Z", "pr_url": "https://github.com/openzipkin/brave/pull/1220", "timeline": [{"oid": "a73627671fc096463f34eb53c99d80d705621218", "url": "https://github.com/openzipkin/brave/commit/a73627671fc096463f34eb53c99d80d705621218", "message": "Fixes test order in ITHttpClient and ITHttpServer.spanHandlerSeesError\n\nThis fixes order where a callback that checked for duplicate errors\nhappened after span reporting. Depending on how fast the verification\nof the span went, the error checker could fail.\n\nThis also renames the base test handler so it is more clear which is\nwhich.", "committedDate": "2020-05-18T11:29:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjU1ODIzNQ==", "url": "https://github.com/openzipkin/brave/pull/1220#discussion_r426558235", "bodyText": "This is the part that should fix the bug", "author": "codefromthecrypt", "createdAt": "2020-05-18T11:30:36Z", "path": "instrumentation/http-tests/src/main/java/brave/test/http/ITHttpServer.java", "diffHunk": "@@ -530,13 +529,15 @@ void spanHandlerSeesError(String path) throws IOException {\n             return true;\n           }\n         })\n+        .addSpanHandler(testSpanHandler)", "originalCommit": "a73627671fc096463f34eb53c99d80d705621218", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjU1ODQzMw==", "url": "https://github.com/openzipkin/brave/pull/1220#discussion_r426558433", "bodyText": "horrible error.. my fault", "author": "codefromthecrypt", "createdAt": "2020-05-18T11:30:57Z", "path": "instrumentation/http-tests/src/main/java/brave/test/http/ITHttpServer.java", "diffHunk": "@@ -530,13 +529,15 @@ void spanHandlerSeesError(String path) throws IOException {\n             return true;\n           }\n         })\n+        .addSpanHandler(testSpanHandler)\n         .build());\n     init();\n \n+    // If this passes, a span was reported with an error\n     httpStatusCodeTagMatchesResponse_onUncaughtException(path, \".*not ready\");\n \n     assertThat(caughtThrowables)\n-        .withFailMessage(\"Span didn't finish\")\n+        .withFailMessage(\"Span finished with error, but caughtThrowables empty\")", "originalCommit": "a73627671fc096463f34eb53c99d80d705621218", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "42af8cc11491bb36c008b64fcb5d9a34a273d001", "url": "https://github.com/openzipkin/brave/commit/42af8cc11491bb36c008b64fcb5d9a34a273d001", "message": "comments", "committedDate": "2020-05-18T11:39:56Z", "type": "commit"}]}