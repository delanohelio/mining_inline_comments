{"pr_number": 1118, "pr_title": "Enforces parent on ITHttpClient.redirect() and other minor issues", "pr_createdAt": "2020-03-21T00:44:10Z", "pr_url": "https://github.com/openzipkin/brave/pull/1118", "timeline": [{"oid": "1df30d6e08ed858548632a66b2e115c6d50d88c0", "url": "https://github.com/openzipkin/brave/commit/1df30d6e08ed858548632a66b2e115c6d50d88c0", "message": "Minor improvements to integration tests\n\n * Raises the global timeout to 20s\n  * See https://github.com/line/armeria/pull/2615\n * Decouples assertions from reporting order\n  * Allows libraries to backdate spans and report in any order\n * Fixes some out-of-date links notices when doing above", "committedDate": "2020-03-21T00:42:06Z", "type": "commit"}, {"oid": "2dd6beec91b5a89453fd3bb74abf14370c259829", "url": "https://github.com/openzipkin/brave/commit/2dd6beec91b5a89453fd3bb74abf14370c259829", "message": "polish", "committedDate": "2020-03-21T00:49:53Z", "type": "commit"}, {"oid": "5b2b860a66515fc1dd3160bc4a4c48aafe25c20e", "url": "https://github.com/openzipkin/brave/commit/5b2b860a66515fc1dd3160bc4a4c48aafe25c20e", "message": "refactored to reveal timing problems in redirect", "committedDate": "2020-03-21T01:47:52Z", "type": "commit"}, {"oid": "aaef72ae835255cb65af812a4d84c64c403f4959", "url": "https://github.com/openzipkin/brave/commit/aaef72ae835255cb65af812a4d84c64c403f4959", "message": "whoops", "committedDate": "2020-03-21T01:56:53Z", "type": "commit"}, {"oid": "6e4a3f87515bb5386631de6f946e5436af2459a5", "url": "https://github.com/openzipkin/brave/commit/6e4a3f87515bb5386631de6f946e5436af2459a5", "message": "caught bug in httpasyncclient where redirect breaks trace", "committedDate": "2020-03-21T02:05:29Z", "type": "commit"}, {"oid": "7e855b607f3b37939daf8da0031e9b4aef627abd", "url": "https://github.com/openzipkin/brave/commit/7e855b607f3b37939daf8da0031e9b4aef627abd", "message": "polish", "committedDate": "2020-03-21T02:08:09Z", "type": "commit"}, {"oid": "d16ce26178487724503775d50c68805a5fbaa94e", "url": "https://github.com/openzipkin/brave/commit/d16ce26178487724503775d50c68805a5fbaa94e", "message": "fixes redirect bug", "committedDate": "2020-03-21T02:08:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk1MTY0OA==", "url": "https://github.com/openzipkin/brave/pull/1118#discussion_r395951648", "bodyText": "BUG!", "author": "codefromthecrypt", "createdAt": "2020-03-21T02:09:55Z", "path": "instrumentation/httpasyncclient/src/main/java/brave/httpasyncclient/TracingHttpAsyncClientBuilder.java", "diffHunk": "@@ -76,7 +76,7 @@ public static HttpAsyncClientBuilder create(HttpTracing httpTracing) {\n \n   final class HandleSend implements HttpRequestInterceptor {\n     @Override public void process(HttpRequest request, HttpContext context) {\n-      TraceContext parent = (TraceContext) context.removeAttribute(TraceContext.class.getName());\n+      TraceContext parent = (TraceContext) context.getAttribute(TraceContext.class.getName());", "originalCommit": "d16ce26178487724503775d50c68805a5fbaa94e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk1ODcwOQ==", "url": "https://github.com/openzipkin/brave/pull/1118#discussion_r395958709", "bodyText": "Either is fine but you could consider e.g. as(\"timestamp\") for some less code  (default fail message will dump it with this tag). A bit different than our other cases where we want to print something other than the asserted value.", "author": "anuraaga", "createdAt": "2020-03-21T03:57:22Z", "path": "instrumentation/http-tests/src/main/java/brave/test/http/ITHttp.java", "diffHunk": "@@ -142,6 +145,15 @@ private Span doTakeSpan() throws InterruptedException {\n     assertThat(result)\n       .withFailMessage(\"Span was not reported\")\n       .isNotNull();\n+\n+    assertThat(result.timestampAsLong())\n+      .withFailMessage(\"Expected a timestamp: %s\", result)", "originalCommit": "d16ce26178487724503775d50c68805a5fbaa94e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk2MzU2MQ==", "url": "https://github.com/openzipkin/brave/pull/1118#discussion_r395963561", "bodyText": "the intent was to print the span on failure, to see what was set. is there a better way than this to do that?", "author": "codefromthecrypt", "createdAt": "2020-03-21T05:26:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk1ODcwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk2NDkxMA==", "url": "https://github.com/openzipkin/brave/pull/1118#discussion_r395964910", "bodyText": "Oops nevermind for some reason misread that timestamp was passed to the fail message (sleepy). This seems good", "author": "anuraaga", "createdAt": "2020-03-21T05:51:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk1ODcwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk2NDk1NQ==", "url": "https://github.com/openzipkin/brave/pull/1118#discussion_r395964955", "bodyText": "I guess the reason was timestamp: , maybe timestamp in span: but not a big deal", "author": "anuraaga", "createdAt": "2020-03-21T05:52:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk1ODcwOQ=="}], "type": "inlineReview"}, {"oid": "d13f62c3d841a05b351de5cbb403a3cbc709cf8f", "url": "https://github.com/openzipkin/brave/commit/d13f62c3d841a05b351de5cbb403a3cbc709cf8f", "message": "don't require jetty", "committedDate": "2020-03-21T09:30:29Z", "type": "commit"}, {"oid": "04a6add535aa17fc588207c76b2f5af810a4f276", "url": "https://github.com/openzipkin/brave/commit/04a6add535aa17fc588207c76b2f5af810a4f276", "message": "don't use internal types", "committedDate": "2020-03-21T10:16:02Z", "type": "commit"}]}