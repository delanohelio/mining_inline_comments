{"pr_number": 869, "pr_title": "HTTP Client cache (GET, HEAD methods) OKAPI-770", "pr_createdAt": "2020-01-04T15:29:52Z", "pr_url": "https://github.com/folio-org/okapi/pull/869", "timeline": [{"oid": "3aa3f7432703427e4fd9130ad28be302ebad8c35", "url": "https://github.com/folio-org/okapi/commit/3aa3f7432703427e4fd9130ad28be302ebad8c35", "message": "HTTP Client cache (GET, HEAD methods) OKAPI-770", "committedDate": "2020-01-04T15:25:08Z", "type": "commit"}, {"oid": "c1ced17207b9831837ea649b348882d4c132b4a8", "url": "https://github.com/folio-org/okapi/commit/c1ced17207b9831837ea649b348882d4c132b4a8", "message": "Default access for some client cache helper classes", "committedDate": "2020-01-04T15:28:38Z", "type": "commit"}, {"oid": "d2678bb3353a70c40cea201c506a2a97c056af49", "url": "https://github.com/folio-org/okapi/commit/d2678bb3353a70c40cea201c506a2a97c056af49", "message": "bodyHandler identical to handler", "committedDate": "2020-01-04T15:38:54Z", "type": "commit"}, {"oid": "ffe21f7f144e350d93e9731d55a5c11aa2c10058", "url": "https://github.com/folio-org/okapi/commit/ffe21f7f144e350d93e9731d55a5c11aa2c10058", "message": "vHost, port, host instead of Abs", "committedDate": "2020-01-04T16:36:22Z", "type": "commit"}, {"oid": "94cf099cb86859239922f28ef52a5978e4017a05", "url": "https://github.com/folio-org/okapi/commit/94cf099cb86859239922f28ef52a5978e4017a05", "message": "Further tweaks to HttpClientRequestCached", "committedDate": "2020-01-04T17:00:40Z", "type": "commit"}, {"oid": "0e955a4dac8327edc160aef42fb41f03fbf69b13", "url": "https://github.com/folio-org/okapi/commit/0e955a4dac8327edc160aef42fb41f03fbf69b13", "message": "Back to requestAbs; more testing", "committedDate": "2020-01-07T11:43:50Z", "type": "commit"}, {"oid": "b50f857250c198c2a49d042dc6fca6837dd1acc0", "url": "https://github.com/folio-org/okapi/commit/b50f857250c198c2a49d042dc6fca6837dd1acc0", "message": "Merge branch 'master' into okapi-770-okapi-http-client-cache", "committedDate": "2020-01-07T11:44:45Z", "type": "commit"}, {"oid": "7a3ee5e4907f6097755936faed85d96e70a0cee0", "url": "https://github.com/folio-org/okapi/commit/7a3ee5e4907f6097755936faed85d96e70a0cee0", "message": "maxRedirects, followRedirects, writeQueueMaxSize; testing", "committedDate": "2020-01-07T13:13:29Z", "type": "commit"}, {"oid": "f170e25305b0359e8bd97a04b03c18cdfc2e7a06", "url": "https://github.com/folio-org/okapi/commit/f170e25305b0359e8bd97a04b03c18cdfc2e7a06", "message": "Further testing", "committedDate": "2020-01-07T13:36:38Z", "type": "commit"}, {"oid": "cce3b0c266a8cbba009bba861bcde481802bea08", "url": "https://github.com/folio-org/okapi/commit/cce3b0c266a8cbba009bba861bcde481802bea08", "message": "Further testing", "committedDate": "2020-01-07T14:01:30Z", "type": "commit"}, {"oid": "ac1f8653725ecad12f62b83eefb578a8a333aa46", "url": "https://github.com/folio-org/okapi/commit/ac1f8653725ecad12f62b83eefb578a8a333aa46", "message": "More testing", "committedDate": "2020-01-07T15:42:53Z", "type": "commit"}, {"oid": "75149924966140cae66bb49cb12711f53f82c339", "url": "https://github.com/folio-org/okapi/commit/75149924966140cae66bb49cb12711f53f82c339", "message": "Unused import", "committedDate": "2020-01-07T15:43:31Z", "type": "commit"}, {"oid": "b73dc4448674a2f698c42232e5671c8b419d6711", "url": "https://github.com/folio-org/okapi/commit/b73dc4448674a2f698c42232e5671c8b419d6711", "message": "Throw VertxException for badurl (which is what Vertx does)", "committedDate": "2020-01-07T16:09:18Z", "type": "commit"}, {"oid": "313484a448cbde40f66c56079c626101b50ea514", "url": "https://github.com/folio-org/okapi/commit/313484a448cbde40f66c56079c626101b50ea514", "message": "Throw exception for two unimplemented functions", "committedDate": "2020-01-07T16:42:52Z", "type": "commit"}, {"oid": "11905814edb9de32c0d21b178e4964db87048619", "url": "https://github.com/folio-org/okapi/commit/11905814edb9de32c0d21b178e4964db87048619", "message": "Some testing of HttpClientResponse methods", "committedDate": "2020-01-07T18:35:02Z", "type": "commit"}, {"oid": "6c86b81995d1a7284c27c98dfcef6e8f4afcc842", "url": "https://github.com/folio-org/okapi/commit/6c86b81995d1a7284c27c98dfcef6e8f4afcc842", "message": "More testing", "committedDate": "2020-01-07T19:03:49Z", "type": "commit"}, {"oid": "b3380d7c78efcc252f04b84ab9d7b42980127756", "url": "https://github.com/folio-org/okapi/commit/b3380d7c78efcc252f04b84ab9d7b42980127756", "message": "Use headers in cache entry match", "committedDate": "2020-01-08T13:36:23Z", "type": "commit"}, {"oid": "aa09f158c9705faa624e597b3adea365bb133c57", "url": "https://github.com/folio-org/okapi/commit/aa09f158c9705faa624e597b3adea365bb133c57", "message": "Merge branch 'master' into okapi-770-okapi-http-client-cache", "committedDate": "2020-01-08T13:37:15Z", "type": "commit"}, {"oid": "a8de12c88c4c0d310ad9c9051fd1382129552662", "url": "https://github.com/folio-org/okapi/commit/a8de12c88c4c0d310ad9c9051fd1382129552662", "message": "Deal with pause/resume", "committedDate": "2020-01-08T14:15:46Z", "type": "commit"}, {"oid": "5169b181825875fe15833272873ff20fa5e96baf", "url": "https://github.com/folio-org/okapi/commit/5169b181825875fe15833272873ff20fa5e96baf", "message": "Extra calls to pause/resume", "committedDate": "2020-01-08T14:47:16Z", "type": "commit"}, {"oid": "81623478c78533640d502ae204da3c9f6aaf92d5", "url": "https://github.com/folio-org/okapi/commit/81623478c78533640d502ae204da3c9f6aaf92d5", "message": "bodyHandler done", "committedDate": "2020-01-09T10:14:01Z", "type": "commit"}, {"oid": "bbb26716901ab38d140e666cc89ac9cba9883fe1", "url": "https://github.com/folio-org/okapi/commit/bbb26716901ab38d140e666cc89ac9cba9883fe1", "message": "More coverage", "committedDate": "2020-01-09T10:32:29Z", "type": "commit"}, {"oid": "59de80b5c64c8f5370be3e983f23ce35cb1f2688", "url": "https://github.com/folio-org/okapi/commit/59de80b5c64c8f5370be3e983f23ce35cb1f2688", "message": "head wo pause,resume", "committedDate": "2020-01-09T10:41:19Z", "type": "commit"}, {"oid": "be0a5c430e1a395bdf03b9647d1218d7c4b5aef1", "url": "https://github.com/folio-org/okapi/commit/be0a5c430e1a395bdf03b9647d1218d7c4b5aef1", "message": "Fix mysterious 405 error; more header fetch cov", "committedDate": "2020-01-09T10:56:01Z", "type": "commit"}, {"oid": "2afafc8b762111bead5c0d269e24de03b70886c1", "url": "https://github.com/folio-org/okapi/commit/2afafc8b762111bead5c0d269e24de03b70886c1", "message": "add cache entry before bodyHandler is called", "committedDate": "2020-01-09T11:25:13Z", "type": "commit"}, {"oid": "cf1b672024fe2ec9b9ffc30eb01d04a2fea08bc9", "url": "https://github.com/folio-org/okapi/commit/cf1b672024fe2ec9b9ffc30eb01d04a2fea08bc9", "message": "Okapi using cache; cache-control beginnings", "committedDate": "2020-01-09T15:12:34Z", "type": "commit"}, {"oid": "b9752cb25e15141c98d7a15f5a1b9a1fd31b32d5", "url": "https://github.com/folio-org/okapi/commit/b9752cb25e15141c98d7a15f5a1b9a1fd31b32d5", "message": "More complete cache-control", "committedDate": "2020-01-09T15:35:29Z", "type": "commit"}, {"oid": "ce3f6ab739b504878abac97528ccaa96741d1427", "url": "https://github.com/folio-org/okapi/commit/ce3f6ab739b504878abac97528ccaa96741d1427", "message": "For now only cache 200 status", "committedDate": "2020-01-09T15:44:47Z", "type": "commit"}, {"oid": "a33f51d4e1e2013bbed2dda5a6f88b642960a8c5", "url": "https://github.com/folio-org/okapi/commit/a33f51d4e1e2013bbed2dda5a6f88b642960a8c5", "message": "Unused import; documentation", "committedDate": "2020-01-09T16:08:54Z", "type": "commit"}, {"oid": "563b61caf02efaea7084d6efc8d9ae80d8d488b8", "url": "https://github.com/folio-org/okapi/commit/563b61caf02efaea7084d6efc8d9ae80d8d488b8", "message": "other link", "committedDate": "2020-01-09T16:15:37Z", "type": "commit"}, {"oid": "20705e80807608e1440e4406b5f9643afaaacf0d", "url": "https://github.com/folio-org/okapi/commit/20705e80807608e1440e4406b5f9643afaaacf0d", "message": "Deal with Expires header", "committedDate": "2020-01-09T17:08:10Z", "type": "commit"}, {"oid": "490f8a38494ff7426302f2f2a229d70740517132", "url": "https://github.com/folio-org/okapi/commit/490f8a38494ff7426302f2f2a229d70740517132", "message": "Yet more coverage", "committedDate": "2020-01-09T17:27:07Z", "type": "commit"}, {"oid": "739cbe1e33e64242ebb9ce9afd668aa19c59c261", "url": "https://github.com/folio-org/okapi/commit/739cbe1e33e64242ebb9ce9afd668aa19c59c261", "message": "Return cache hit count; get all cache-control headers", "committedDate": "2020-01-09T18:06:44Z", "type": "commit"}, {"oid": "401212c7e656da33b393aebafb0a68b7d2114f25", "url": "https://github.com/folio-org/okapi/commit/401212c7e656da33b393aebafb0a68b7d2114f25", "message": "Cover all HttpClientCached", "committedDate": "2020-01-09T18:10:12Z", "type": "commit"}, {"oid": "a9a23451d435d54b24bee7c5e29eac20f0542526", "url": "https://github.com/folio-org/okapi/commit/a9a23451d435d54b24bee7c5e29eac20f0542526", "message": "Further bodyHandler testing", "committedDate": "2020-01-09T18:34:16Z", "type": "commit"}, {"oid": "43ab42025afecfb11d4a01ba7bad8666ba749b73", "url": "https://github.com/folio-org/okapi/commit/43ab42025afecfb11d4a01ba7bad8666ba749b73", "message": "Test HEAD case with endHandler only", "committedDate": "2020-01-09T18:51:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUxMDEzNg==", "url": "https://github.com/folio-org/okapi/pull/869#discussion_r365510136", "bodyText": "The list of authors that contributes code is tracked in the git commit history.\nDo you want to duplicate that information in the source code? How do we ensure that it is kept up to date? Is \"adam\" unambiguous now and in future?", "author": "julianladisch", "createdAt": "2020-01-11T09:13:32Z", "path": "okapi-common/src/main/java/org/folio/okapi/common/HttpClientCached.java", "diffHunk": "@@ -0,0 +1,286 @@\n+package org.folio.okapi.common;\n+\n+import io.vertx.core.AsyncResult;\n+import io.vertx.core.Handler;\n+import io.vertx.core.MultiMap;\n+import io.vertx.core.http.HttpClient;\n+import io.vertx.core.http.HttpClientRequest;\n+import io.vertx.core.http.HttpClientResponse;\n+import io.vertx.core.http.HttpMethod;\n+import java.time.Instant;\n+import java.time.ZonedDateTime;\n+import java.time.format.DateTimeFormatter;\n+import java.time.format.DateTimeParseException;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.Set;\n+import java.util.TreeSet;\n+import org.apache.logging.log4j.Logger;\n+\n+/**\n+ * HTTP client with cache .. Can be used in most case as a replacement of\n+ * Vert.x {@link io.vertx.core.http.HttpClient}\n+ *\n+ * @author adam", "originalCommit": "43ab42025afecfb11d4a01ba7bad8666ba749b73", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTc3MjIyOQ==", "url": "https://github.com/folio-org/okapi/pull/869#discussion_r365772229", "bodyText": "Yes.. I'll remove it and the 8 in total Okapi. 67 in RMB by the way", "author": "adamdickmeiss", "createdAt": "2020-01-13T12:13:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUxMDEzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTgxMTUyNA==", "url": "https://github.com/folio-org/okapi/pull/869#discussion_r365811524", "bodyText": "Thanks, resolved. (I cannot resolve this @author conversion because I don't have write permissions for this repository.)", "author": "julianladisch", "createdAt": "2020-01-13T13:47:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUxMDEzNg=="}], "type": "inlineReview"}, {"oid": "fdd2dc35fbf8c9b80fdcd53452b7128b7a28d478", "url": "https://github.com/folio-org/okapi/commit/fdd2dc35fbf8c9b80fdcd53452b7128b7a28d478", "message": "Remove @author tag", "committedDate": "2020-01-13T12:14:44Z", "type": "commit"}, {"oid": "bf4da7997608d74ccb2c6202c4a3fb90dae61019", "url": "https://github.com/folio-org/okapi/commit/bf4da7997608d74ccb2c6202c4a3fb90dae61019", "message": "Merge branch 'master' into okapi-770-okapi-http-client-cache", "committedDate": "2020-01-13T12:14:46Z", "type": "commit"}, {"oid": "a9ce54eace4c3cf8083c2d5ada098a835eabef1c", "url": "https://github.com/folio-org/okapi/commit/a9ce54eace4c3cf8083c2d5ada098a835eabef1c", "message": "Merge branch 'master' into okapi-770-okapi-http-client-cache", "committedDate": "2020-01-13T12:34:36Z", "type": "commit"}, {"oid": "02d1c66ef5a74bbc92b70799841323530ff11489", "url": "https://github.com/folio-org/okapi/commit/02d1c66ef5a74bbc92b70799841323530ff11489", "message": "Property httpCache (boolean), logWaitMs integer based", "committedDate": "2020-01-14T11:44:44Z", "type": "commit"}, {"oid": "032345981dc97a4336cb2f47c2dc1bc5cea95c46", "url": "https://github.com/folio-org/okapi/commit/032345981dc97a4336cb2f47c2dc1bc5cea95c46", "message": "Enable HTTP cache for ProxyTest", "committedDate": "2020-01-14T12:34:07Z", "type": "commit"}, {"oid": "32b04434aaf4f86008ec3b1d686464049e7152c6", "url": "https://github.com/folio-org/okapi/commit/32b04434aaf4f86008ec3b1d686464049e7152c6", "message": "null ptr safe boolean check", "committedDate": "2020-01-14T12:36:08Z", "type": "commit"}, {"oid": "f9b429e0c3c7086bcd176528305b7bbe1a468ccd", "url": "https://github.com/folio-org/okapi/commit/f9b429e0c3c7086bcd176528305b7bbe1a468ccd", "message": "No special handling for empty default in getSysConf", "committedDate": "2020-01-14T12:59:17Z", "type": "commit"}, {"oid": "0f580b2a5a729dca9a2484b03c4b07785d50d7f1", "url": "https://github.com/folio-org/okapi/commit/0f580b2a5a729dca9a2484b03c4b07785d50d7f1", "message": "Merge branch 'master' into okapi-770-okapi-http-client-cache", "committedDate": "2020-01-14T13:03:27Z", "type": "commit"}, {"oid": "4523b6a6208c418e03df6c0b3ad037aa4faa642c", "url": "https://github.com/folio-org/okapi/commit/4523b6a6208c418e03df6c0b3ad037aa4faa642c", "message": "more javadoc", "committedDate": "2020-01-14T14:00:22Z", "type": "commit"}, {"oid": "c7de53ae5e3229bc78f928bfc001dd4cfd7e8ab7", "url": "https://github.com/folio-org/okapi/commit/c7de53ae5e3229bc78f928bfc001dd4cfd7e8ab7", "message": "HttpCLientResponse.fetch", "committedDate": "2020-01-14T14:36:05Z", "type": "commit"}, {"oid": "a0d07b091e5f6784101dae0c234ac248e09b079c", "url": "https://github.com/folio-org/okapi/commit/a0d07b091e5f6784101dae0c234ac248e09b079c", "message": "body future; fetch", "committedDate": "2020-01-14T14:59:16Z", "type": "commit"}, {"oid": "a72589794dcaa0834369e6835981d6c8656e0af9", "url": "https://github.com/folio-org/okapi/commit/a72589794dcaa0834369e6835981d6c8656e0af9", "message": "More corner cases", "committedDate": "2020-01-14T15:14:06Z", "type": "commit"}, {"oid": "d3c04475602d433b8ae8b18eb45b5e63d69c46b6", "url": "https://github.com/folio-org/okapi/commit/d3c04475602d433b8ae8b18eb45b5e63d69c46b6", "message": "body, pause, resume", "committedDate": "2020-01-14T15:34:15Z", "type": "commit"}, {"oid": "1b0d737de2e00c742af6ced486921f45c282e320", "url": "https://github.com/folio-org/okapi/commit/1b0d737de2e00c742af6ced486921f45c282e320", "message": "More", "committedDate": "2020-01-14T15:55:13Z", "type": "commit"}, {"oid": "d9cb95e0fe914e9a671fc3ff24c283359454ca60", "url": "https://github.com/folio-org/okapi/commit/d9cb95e0fe914e9a671fc3ff24c283359454ca60", "message": "Check several test against Vert.x native", "committedDate": "2020-01-14T16:02:10Z", "type": "commit"}, {"oid": "eea46a91fdacec89f5e1c16f31a4b63e96e872b7", "url": "https://github.com/folio-org/okapi/commit/eea46a91fdacec89f5e1c16f31a4b63e96e872b7", "message": "More simplifications", "committedDate": "2020-01-14T16:11:15Z", "type": "commit"}, {"oid": "88a02e99414ae6496464fa4a13a0938e6cd9562b", "url": "https://github.com/folio-org/okapi/commit/88a02e99414ae6496464fa4a13a0938e6cd9562b", "message": "Throw exception for 2 methods of HttpClientResponse", "committedDate": "2020-01-14T16:30:07Z", "type": "commit"}, {"oid": "a32d567abc0fca99ba26b9cfd5806d07fa63714e", "url": "https://github.com/folio-org/okapi/commit/a32d567abc0fca99ba26b9cfd5806d07fa63714e", "message": "Some methods should be public", "committedDate": "2020-01-17T14:15:50Z", "type": "commit"}, {"oid": "c55dcb2309bf6b3e17f8fdf74a12d98dcee58e8b", "url": "https://github.com/folio-org/okapi/commit/c55dcb2309bf6b3e17f8fdf74a12d98dcee58e8b", "message": "Cache responses with 202; log cache status; testing", "committedDate": "2020-01-17T15:28:26Z", "type": "commit"}, {"oid": "e89247499613d9aa245b8a4c8b4c9c081db38af7", "url": "https://github.com/folio-org/okapi/commit/e89247499613d9aa245b8a4c8b4c9c081db38af7", "message": "ProxyTest sets loglevel to info", "committedDate": "2020-01-17T15:47:22Z", "type": "commit"}, {"oid": "56897c0074f0d272d642b225f09ce09e6685c216", "url": "https://github.com/folio-org/okapi/commit/56897c0074f0d272d642b225f09ce09e6685c216", "message": "Simplify rewritePath handling", "committedDate": "2020-01-17T16:34:52Z", "type": "commit"}, {"oid": "7af7df7b6d0c020abd7d7c8f2f1cac74e2076a84", "url": "https://github.com/folio-org/okapi/commit/7af7df7b6d0c020abd7d7c8f2f1cac74e2076a84", "message": "status codes for caching configurable", "committedDate": "2020-01-17T17:03:49Z", "type": "commit"}, {"oid": "dd596ee628807747569e45660a4f1dfeadaaa8fd", "url": "https://github.com/folio-org/okapi/commit/dd596ee628807747569e45660a4f1dfeadaaa8fd", "message": "Common Future for body/bodyHandler; closer to native client semantics", "committedDate": "2020-01-17T21:59:10Z", "type": "commit"}, {"oid": "43be2e86479bb18fc7fd382186eef5fd4a3d3f6a", "url": "https://github.com/folio-org/okapi/commit/43be2e86479bb18fc7fd382186eef5fd4a3d3f6a", "message": "endHandler called - even in HEAD case with empty buffer", "committedDate": "2020-01-17T23:11:58Z", "type": "commit"}, {"oid": "949ca2fd6bec9798fb9cb85c4d8f8d98ea4b5b5f", "url": "https://github.com/folio-org/okapi/commit/949ca2fd6bec9798fb9cb85c4d8f8d98ea4b5b5f", "message": "Merge branch 'master' into okapi-770-okapi-http-client-cache", "committedDate": "2020-01-18T20:00:53Z", "type": "commit"}, {"oid": "0b930f844e1d47d4300d66a05d725583b93c5eaf", "url": "https://github.com/folio-org/okapi/commit/0b930f844e1d47d4300d66a05d725583b93c5eaf", "message": "Merge branch 'master' into okapi-770-okapi-http-client-cache", "committedDate": "2020-01-19T15:55:45Z", "type": "commit"}, {"oid": "5b3803d0eec5d463ef604871620e01e97d977c90", "url": "https://github.com/folio-org/okapi/commit/5b3803d0eec5d463ef604871620e01e97d977c90", "message": "Test handler not called in HEAD pause/resume case", "committedDate": "2020-01-19T16:07:43Z", "type": "commit"}]}