{"pr_number": 910, "pr_title": "Fix disabling module fails for existing broken deps OKAPI-827", "pr_createdAt": "2020-04-15T13:39:56Z", "pr_url": "https://github.com/folio-org/okapi/pull/910", "timeline": [{"oid": "64222819f76c79dd330591fa91282b7bb0d81a4b", "url": "https://github.com/folio-org/okapi/commit/64222819f76c79dd330591fa91282b7bb0d81a4b", "message": "Fix disabling module fails for existing broken deps OKAPI-827", "committedDate": "2020-04-15T13:38:05Z", "type": "commit"}, {"oid": "b218bff150973b8b2262c6cb2b5be3d3c8a823f0", "url": "https://github.com/folio-org/okapi/commit/b218bff150973b8b2262c6cb2b5be3d3c8a823f0", "message": "Check full list (not empty list)", "committedDate": "2020-04-15T13:50:12Z", "type": "commit"}, {"oid": "988c69d810bff78ca10eb5473d23c5abc96173dc", "url": "https://github.com/folio-org/okapi/commit/988c69d810bff78ca10eb5473d23c5abc96173dc", "message": "Test case for broken deps", "committedDate": "2020-04-15T16:30:27Z", "type": "commit"}, {"oid": "b0d173f86feba5c1201234ba2dce9f79bea2652d", "url": "https://github.com/folio-org/okapi/commit/b0d173f86feba5c1201234ba2dce9f79bea2652d", "message": "Further test that test-module-2.0.0 is disabled", "committedDate": "2020-04-15T16:32:20Z", "type": "commit"}, {"oid": "41844380aee8f94bf902b2cd9ec8110d7e8ccc2a", "url": "https://github.com/folio-org/okapi/commit/41844380aee8f94bf902b2cd9ec8110d7e8ccc2a", "message": "No need to check for conflicts\n\nWhich is not a likely scenario.", "committedDate": "2020-04-15T17:21:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE1NzIwOQ==", "url": "https://github.com/folio-org/okapi/pull/910#discussion_r409157209", "bodyText": "Ignoring pre-existing dependency issue and returning OK are reasonable when deleting modules. Would it be an issue when enabling modules?", "author": "hjiebsco", "createdAt": "2020-04-15T21:55:06Z", "path": "okapi-core/src/main/java/org/folio/okapi/managers/ModuleManager.java", "diffHunk": "@@ -138,6 +138,11 @@ void enableAndDisableCheck(Tenant tenant,\n       for (ModuleDescriptor md : modlist) {\n         mods.put(md.getId(), md);\n       }\n+      String deps = DepResolution.checkAllDependencies(mods);\n+      if (!deps.isEmpty()) {\n+        fut.handle(new Success<>()); // failures even before we change enabled modules", "originalCommit": "41844380aee8f94bf902b2cd9ec8110d7e8ccc2a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQxMTcxMQ==", "url": "https://github.com/folio-org/okapi/pull/910#discussion_r409411711", "bodyText": "Yes.. How about we just only allow this when removing a module?", "author": "adamdickmeiss", "createdAt": "2020-04-16T09:24:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE1NzIwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE1NzgyNw==", "url": "https://github.com/folio-org/okapi/pull/910#discussion_r409157827", "bodyText": "Lots of work to set up a test. :)", "author": "hjiebsco", "createdAt": "2020-04-15T21:56:33Z", "path": "okapi-core/src/test/java/org/folio/okapi/ProxyTest.java", "diffHunk": "@@ -3031,5 +3031,288 @@ public void testTenantInit(TestContext context) {\n \n   }\n \n+  @Test", "originalCommit": "41844380aee8f94bf902b2cd9ec8110d7e8ccc2a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "925ba8ad481c31017ea1cf52082b07d3588e8135", "url": "https://github.com/folio-org/okapi/commit/925ba8ad481c31017ea1cf52082b07d3588e8135", "message": "Only when disabling a module, the pre-existing dep check is used", "committedDate": "2020-04-16T09:33:57Z", "type": "commit"}, {"oid": "deb5860466eba07d947e1e0ba29deef03a860d3e", "url": "https://github.com/folio-org/okapi/commit/deb5860466eba07d947e1e0ba29deef03a860d3e", "message": "DepResolution: use Collection rather than redundant Map", "committedDate": "2020-04-16T10:06:07Z", "type": "commit"}, {"oid": "2b12a6ae3677eb31b07ebd4c352c649789aea48c", "url": "https://github.com/folio-org/okapi/commit/2b12a6ae3677eb31b07ebd4c352c649789aea48c", "message": "Har har", "committedDate": "2020-04-16T12:01:30Z", "type": "commit"}]}