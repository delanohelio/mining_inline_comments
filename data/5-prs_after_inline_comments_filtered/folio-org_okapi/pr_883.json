{"pr_number": 883, "pr_title": "Okapi 796 reduce decoding module descriptors", "pr_createdAt": "2020-02-18T15:24:45Z", "pr_url": "https://github.com/folio-org/okapi/pull/883", "timeline": [{"oid": "61a3d0b78991159041e22a2cec4b2f4e5bb3da3a", "url": "https://github.com/folio-org/okapi/commit/61a3d0b78991159041e22a2cec4b2f4e5bb3da3a", "message": "Fix checked cast warnings WRT CompList tests", "committedDate": "2020-02-18T14:06:02Z", "type": "commit"}, {"oid": "a451d72f9df79cada5e4b487e45474fa288c4435", "url": "https://github.com/folio-org/okapi/commit/a451d72f9df79cada5e4b487e45474fa288c4435", "message": "OkapiPerformance on test phase", "committedDate": "2020-02-18T14:59:53Z", "type": "commit"}, {"oid": "d4ff172ea7b11181e219c49ec0c50e5c5dfd4d0d", "url": "https://github.com/folio-org/okapi/commit/d4ff172ea7b11181e219c49ec0c50e5c5dfd4d0d", "message": "dumpHeaders when exceeding 2K OKAPI-795", "committedDate": "2020-02-18T15:03:12Z", "type": "commit"}, {"oid": "d607e6eb3d9d89760f9fdbee2f457dc158094541", "url": "https://github.com/folio-org/okapi/commit/d607e6eb3d9d89760f9fdbee2f457dc158094541", "message": "Cache enabled modules OKAPI-796\n\nModule Descriptors consider immutable.", "committedDate": "2020-02-18T15:03:12Z", "type": "commit"}, {"oid": "6397ee87282bb33e2396bf688507425372fb01f1", "url": "https://github.com/folio-org/okapi/commit/6397ee87282bb33e2396bf688507425372fb01f1", "message": "Merge branch 'master' into okapi-796-reduce-decoding-module-descriptors", "committedDate": "2020-02-18T15:24:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzE0OTcxMg==", "url": "https://github.com/folio-org/okapi/pull/883#discussion_r383149712", "bodyText": "Is this a cache? If yes, can you rename it to enabledModulesCache?", "author": "julianladisch", "createdAt": "2020-02-24T09:19:46Z", "path": "okapi-core/src/main/java/org/folio/okapi/managers/ModuleManager.java", "diffHunk": "@@ -38,6 +38,7 @@\n   private String mapName = \"modules\";\n   private LockedTypedMap1<ModuleDescriptor> modules\n     = new LockedTypedMap1<>(ModuleDescriptor.class);\n+  private Map<String,ModuleDescriptor> enabledModules = new HashMap<>();", "originalCommit": "6397ee87282bb33e2396bf688507425372fb01f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzg0NzUyMw==", "url": "https://github.com/folio-org/okapi/pull/883#discussion_r383847523", "bodyText": "yep", "author": "adamdickmeiss", "createdAt": "2020-02-25T12:26:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzE0OTcxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzE1MDMzMg==", "url": "https://github.com/folio-org/okapi/pull/883#discussion_r383150332", "bodyText": "Is the cache pruned when ModuleManager.update or ModuleManager.delete is called, and are there unit tests for update and delete?", "author": "julianladisch", "createdAt": "2020-02-24T09:21:19Z", "path": "okapi-core/src/main/java/org/folio/okapi/managers/ModuleManager.java", "diffHunk": "@@ -38,6 +38,7 @@\n   private String mapName = \"modules\";\n   private LockedTypedMap1<ModuleDescriptor> modules\n     = new LockedTypedMap1<>(ModuleDescriptor.class);\n+  private Map<String,ModuleDescriptor> enabledModules = new HashMap<>();", "originalCommit": "6397ee87282bb33e2396bf688507425372fb01f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzg0Nzc0MA==", "url": "https://github.com/folio-org/okapi/pull/883#discussion_r383847740", "bodyText": "In reality not needed, but I'll just do it. MDs are immutable and probably MD PUT will be removed soon.", "author": "adamdickmeiss", "createdAt": "2020-02-25T12:27:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzE1MDMzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc3NTk1OQ==", "url": "https://github.com/folio-org/okapi/pull/883#discussion_r383775959", "bodyText": "Can you also change\nif (sz > limit) {\n\nto\nif (sz > limit && logger.isInfoEnabled()) {\n\nand remove the unused StringBuilder from dumpHeaders?", "author": "julianladisch", "createdAt": "2020-02-25T10:02:43Z", "path": "okapi-core/src/main/java/org/folio/okapi/managers/ProxyService.java", "diffHunk": "@@ -685,7 +685,7 @@ private void proxyRequestResponse10(Iterator<ModuleInstance> it,\n \n   private void copyHeaders(HttpClientRequest cReq, RoutingContext ctx, ModuleInstance mi) {\n     int sz = 0;\n-    int limit = 5; // all headers dumped\n+    int limit = 2000; // all headers dumped", "originalCommit": "6397ee87282bb33e2396bf688507425372fb01f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzg0NzgwNA==", "url": "https://github.com/folio-org/okapi/pull/883#discussion_r383847804", "bodyText": "Yep. Will do", "author": "adamdickmeiss", "createdAt": "2020-02-25T12:27:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc3NTk1OQ=="}], "type": "inlineReview"}, {"oid": "5ea387059e62ef2ce856e5c5a62ffad9d9415446", "url": "https://github.com/folio-org/okapi/commit/5ea387059e62ef2ce856e5c5a62ffad9d9415446", "message": "Invalidate MD cache entry on DELETE/PUT", "committedDate": "2020-02-25T12:28:23Z", "type": "commit"}, {"oid": "56aa6197d8b08b5fcdd9a42a0a7c85249bce54ea", "url": "https://github.com/folio-org/okapi/commit/56aa6197d8b08b5fcdd9a42a0a7c85249bce54ea", "message": "Changes to header logging", "committedDate": "2020-02-25T12:35:13Z", "type": "commit"}]}