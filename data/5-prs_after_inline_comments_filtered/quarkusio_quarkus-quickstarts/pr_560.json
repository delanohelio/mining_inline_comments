{"pr_number": 560, "pr_title": "refactor(MongodbPanache): Add some tests", "pr_createdAt": "2020-05-08T15:17:50Z", "pr_url": "https://github.com/quarkusio/quarkus-quickstarts/pull/560", "timeline": [{"oid": "77a38548831aa34558345fa505f5d9a79284c921", "url": "https://github.com/quarkusio/quarkus-quickstarts/commit/77a38548831aa34558345fa505f5d9a79284c921", "message": "refactor(MongodbPanache): Add some tests", "committedDate": "2020-05-08T15:20:41Z", "type": "forcePushed"}, {"oid": "629136ad318b42ce7aef5aea9379373773c2851e", "url": "https://github.com/quarkusio/quarkus-quickstarts/commit/629136ad318b42ce7aef5aea9379373773c2851e", "message": "refactor(MongodbPanache): Add some tests", "committedDate": "2020-05-08T15:23:15Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIzOTAyNQ==", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/560#discussion_r429239025", "bodyText": "Not needed, annotated the class with @Path is enought", "author": "loicmathieu", "createdAt": "2020-05-22T13:15:51Z", "path": "mongodb-panache-quickstart/src/main/java/org/acme/mongodb/panache/PersonResource.java", "diffHunk": "@@ -11,20 +12,23 @@\n import javax.ws.rs.PathParam;\n import javax.ws.rs.Produces;\n import javax.ws.rs.core.Response;\n+import java.util.List;\n \n @Path(\"/persons\")\n+@ApplicationScoped", "originalCommit": "629136ad318b42ce7aef5aea9379373773c2851e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTI0MDExNg==", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/560#discussion_r429240116", "bodyText": "ID will be automatically populated by MongoDB so you can skip them", "author": "loicmathieu", "createdAt": "2020-05-22T13:18:06Z", "path": "mongodb-panache-quickstart/src/test/java/org/acme/mongodb/panache/PersonResourceTest.java", "diffHunk": "@@ -0,0 +1,187 @@\n+package org.acme.mongodb.panache;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.SerializationFeature;\n+import com.fasterxml.jackson.datatype.jdk8.Jdk8Module;\n+import com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;\n+import com.github.dockerjava.api.model.ExposedPort;\n+import com.github.dockerjava.api.model.PortBinding;\n+import com.github.dockerjava.api.model.Ports;\n+import io.quarkus.test.junit.QuarkusTest;\n+import io.restassured.RestAssured;\n+import io.restassured.config.ObjectMapperConfig;\n+import io.restassured.http.ContentType;\n+import io.restassured.parsing.Parser;\n+import org.assertj.core.api.Assertions;\n+import org.bson.types.ObjectId;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Test;\n+import org.testcontainers.containers.GenericContainer;\n+import org.testcontainers.junit.jupiter.Container;\n+import org.testcontainers.junit.jupiter.Testcontainers;\n+\n+import java.time.LocalDate;\n+\n+import static io.restassured.config.LogConfig.logConfig;\n+import static org.acme.mongodb.panache.MongoDbContainer.MONGODB_HOST;\n+import static org.acme.mongodb.panache.MongoDbContainer.MONGODB_PORT;\n+\n+@Testcontainers\n+@QuarkusTest\n+class PersonResourceTest {\n+\n+    @Container\n+    static GenericContainer MONGO_DB_CONTAINER = new MongoDbContainer()\n+            .withCreateContainerCmdModifier(cmd -> {\n+                cmd.withHostName(MONGODB_HOST)\n+                        .withPortBindings(new PortBinding(Ports.Binding.bindPort(MONGODB_PORT), new ExposedPort(MONGODB_PORT)));\n+            });\n+\n+    @BeforeAll\n+    static void initAll() {\n+        RestAssured.defaultParser = Parser.JSON;\n+        RestAssured.config\n+                .logConfig((logConfig().enableLoggingOfRequestAndResponseIfValidationFails()))\n+                .objectMapperConfig(new ObjectMapperConfig().jackson2ObjectMapperFactory((type, s) -> new ObjectMapper()\n+                        .registerModule(new Jdk8Module())\n+                        .registerModule(new JavaTimeModule())\n+                        .disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS)));\n+    }\n+\n+    @Test\n+    void test() {\n+        PersonDTO person1 = PersonDTO.Builder\n+                .aPersonDTO()\n+                .withId(\"5889273c093d1c3e614bf2f9\")", "originalCommit": "629136ad318b42ce7aef5aea9379373773c2851e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTI0NDA4OA==", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/560#discussion_r429244088", "bodyText": "The rest service should return them inside the location header so you can retrieve them from restassured response.", "author": "loicmathieu", "createdAt": "2020-05-22T13:25:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTI0MDExNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUzOTI5Mw==", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/560#discussion_r429539293", "bodyText": "I my tests, there is nothing returned in headers by keeping the actual behaviour.", "author": "aoudiamoncef", "createdAt": "2020-05-23T11:52:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTI0MDExNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTI0MDkyOQ==", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/560#discussion_r429240929", "bodyText": "Duplicated with PersonResourceIT", "author": "loicmathieu", "createdAt": "2020-05-22T13:19:42Z", "path": "mongodb-panache-quickstart/src/test/java/org/acme/mongodb/panache/NativePersonResourceIT.java", "diffHunk": "@@ -0,0 +1,10 @@\n+package org.acme.mongodb.panache;\n+\n+import io.quarkus.test.junit.NativeImageTest;\n+\n+@NativeImageTest\n+public class NativePersonResourceIT extends PersonResourceTest {", "originalCommit": "629136ad318b42ce7aef5aea9379373773c2851e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM1MDQ1Ng==", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/560#discussion_r429350456", "bodyText": "I should remove which file ?", "author": "aoudiamoncef", "createdAt": "2020-05-22T16:45:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTI0MDkyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTI0MjQwNA==", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/560#discussion_r429242404", "bodyText": "I' not sure about these import changes.\nAre you using Quarkus code formatter ?\nDid you run mvn process-sources ?", "author": "loicmathieu", "createdAt": "2020-05-22T13:22:33Z", "path": "mongodb-panache-quickstart/src/main/java/org/acme/mongodb/panache/Person.java", "diffHunk": "@@ -1,31 +1,28 @@\n package org.acme.mongodb.panache;\n \n-import java.time.LocalDate;\n-import java.util.List;\n-\n-import org.bson.codecs.pojo.annotations.BsonProperty;\n-\n import io.quarkus.mongodb.panache.MongoEntity;\n import io.quarkus.mongodb.panache.PanacheMongoEntity;\n+import org.bson.codecs.pojo.annotations.BsonProperty;\n+\n+import java.time.LocalDate;\n+import java.util.List;", "originalCommit": "629136ad318b42ce7aef5aea9379373773c2851e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM0ODQzMA==", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/560#discussion_r429348430", "bodyText": "I think that it's not available on quarkus-quickstarts. But i resolved this issue", "author": "aoudiamoncef", "createdAt": "2020-05-22T16:42:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTI0MjQwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTI0Mjc1Mg==", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/560#discussion_r429242752", "bodyText": "Why are you changing this ?", "author": "loicmathieu", "createdAt": "2020-05-22T13:23:15Z", "path": "mongodb-panache-quickstart/src/main/java/org/acme/mongodb/panache/Person.java", "diffHunk": "@@ -1,31 +1,28 @@\n package org.acme.mongodb.panache;\n \n-import java.time.LocalDate;\n-import java.util.List;\n-\n-import org.bson.codecs.pojo.annotations.BsonProperty;\n-\n import io.quarkus.mongodb.panache.MongoEntity;\n import io.quarkus.mongodb.panache.PanacheMongoEntity;\n+import org.bson.codecs.pojo.annotations.BsonProperty;\n+\n+import java.time.LocalDate;\n+import java.util.List;\n \n @MongoEntity(collection = \"ThePerson\")\n public class Person extends PanacheMongoEntity {\n     public String name;\n-\n     // will be persisted as a 'birth' field in MongoDB\n     @BsonProperty(\"birth\")\n     public LocalDate birthDate;\n-\n     public Status status;\n \n-    // return name as uppercase in the model\n+    // return name as lowercase in the model\n     public String getName() {\n-        return name.toUpperCase();\n+        return name.toLowerCase();\n     }\n \n-    // store all names in lowercase in the DB\n+    // store all names in uppercase in the DB\n     public void setName(String name) {\n-        this.name = name.toLowerCase();\n+        this.name = name.toUpperCase();", "originalCommit": "629136ad318b42ce7aef5aea9379373773c2851e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTI2MzMyNw==", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/560#discussion_r429263327", "bodyText": "Just to avoid to pass the name in capital letters in the URL.", "author": "aoudiamoncef", "createdAt": "2020-05-22T13:59:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTI0Mjc1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTI2NzYyMg==", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/560#discussion_r429267622", "bodyText": "OK, then", "author": "loicmathieu", "createdAt": "2020-05-22T14:06:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTI0Mjc1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTI0MzcwNw==", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/560#discussion_r429243707", "bodyText": "Is it really needed ?\nWe want to keep the quickstart as close to the guide as possible, and we don't use such DTO in the guide.", "author": "loicmathieu", "createdAt": "2020-05-22T13:25:14Z", "path": "mongodb-panache-quickstart/src/test/java/org/acme/mongodb/panache/PersonDTO.java", "diffHunk": "@@ -0,0 +1,57 @@\n+package org.acme.mongodb.panache;\n+\n+import com.fasterxml.jackson.annotation.JsonFormat;\n+\n+import java.time.LocalDate;\n+\n+class PersonDTO {", "originalCommit": "629136ad318b42ce7aef5aea9379373773c2851e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4c6f404b34e07fabcc102619db726ebfe7402a8e", "url": "https://github.com/quarkusio/quarkus-quickstarts/commit/4c6f404b34e07fabcc102619db726ebfe7402a8e", "message": "refactor(MongodbPanache): Add some tests", "committedDate": "2020-05-23T12:01:49Z", "type": "forcePushed"}, {"oid": "0a860725d0e0f00cec537bc797d426eff21c84ee", "url": "https://github.com/quarkusio/quarkus-quickstarts/commit/0a860725d0e0f00cec537bc797d426eff21c84ee", "message": "refactor(MongodbPanache): Add some tests", "committedDate": "2020-05-23T12:26:34Z", "type": "commit"}, {"oid": "0a860725d0e0f00cec537bc797d426eff21c84ee", "url": "https://github.com/quarkusio/quarkus-quickstarts/commit/0a860725d0e0f00cec537bc797d426eff21c84ee", "message": "refactor(MongodbPanache): Add some tests", "committedDate": "2020-05-23T12:26:34Z", "type": "forcePushed"}]}