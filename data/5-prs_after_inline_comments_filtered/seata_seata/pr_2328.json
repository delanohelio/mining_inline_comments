{"pr_number": 2328, "pr_title": "feature: mysql 5.x and 8.x jdbc drivers coexist in the server", "pr_createdAt": "2020-03-02T06:58:21Z", "pr_url": "https://github.com/seata/seata/pull/2328", "timeline": [{"oid": "d733ae4c903c75d23f9cc06a0013f2d5730e118f", "url": "https://github.com/seata/seata/commit/d733ae4c903c75d23f9cc06a0013f2d5730e118f", "message": "feature: mysql 5.x and 8.x jdbc drivers coexist in server", "committedDate": "2020-03-04T14:05:46Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU1NDM3MA==", "url": "https://github.com/seata/seata/pull/2328#discussion_r387554370", "bodyText": "what circumstances will this happen\uff1f", "author": "slievrly", "createdAt": "2020-03-04T09:49:30Z", "path": "core/src/main/java/io/seata/core/store/db/AbstractDataSourceGenerator.java", "diffHunk": "@@ -61,6 +81,53 @@ protected String getDriverClassName() {\n         return driverClassName;\n     }\n \n+    protected ClassLoader getDriverClassLoader() {\n+        return MYSQL_DRIVER_LOADERS.getOrDefault(getDriverClassName(), ClassLoader.getSystemClassLoader());\n+    }\n+\n+    private static Map<String, ClassLoader> createMysqlDriverClassLoaders() {\n+        Map<String, ClassLoader> loaders = new HashMap<>();\n+        String cp = System.getProperty(\"java.class.path\");\n+        if (cp == null || cp.isEmpty()) {\n+            return loaders;\n+        }\n+        Stream.of(cp.split(File.pathSeparator))\n+                .map(File::new)\n+                .filter(File::exists)\n+                .map(file -> file.isFile() ? file.getParentFile() : file)\n+                .filter(Objects::nonNull)\n+                .filter(File::isDirectory)\n+                .map(file -> new File(file, \"jdbc\"))\n+                .filter(File::exists)\n+                .filter(File::isDirectory)\n+                .distinct()\n+                .flatMap(file -> {\n+                    File[] files = file.listFiles((f, name) -> name.startsWith(MYSQL_DRIVER_FILE_PREFIX));\n+                    if (files != null) {\n+                        return Stream.of(files);\n+                    } else {\n+                        return Stream.of();\n+                    }\n+                })\n+                .forEach(file -> {\n+                    if (loaders.containsKey(MYSQL8_DRIVER_CLASS_NAME) && loaders.containsKey(MYSQL_DRIVER_CLASS_NAME)) {", "originalCommit": "a38193f148ff4591fa187805f0613e4023393ee3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODA4MDE0MQ==", "url": "https://github.com/seata/seata/pull/2328#discussion_r388080141", "bodyText": "It's almost impossible in the current environment, just in case.", "author": "ggndnn", "createdAt": "2020-03-05T05:06:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU1NDM3MA=="}], "type": "inlineReview"}, {"oid": "b821e25d03c27ef81fdac7989db5ff172ffc03b2", "url": "https://github.com/seata/seata/commit/b821e25d03c27ef81fdac7989db5ff172ffc03b2", "message": "feature: mysql 5.x and 8.x jdbc drivers coexist in server", "committedDate": "2020-03-06T09:19:53Z", "type": "commit"}, {"oid": "b821e25d03c27ef81fdac7989db5ff172ffc03b2", "url": "https://github.com/seata/seata/commit/b821e25d03c27ef81fdac7989db5ff172ffc03b2", "message": "feature: mysql 5.x and 8.x jdbc drivers coexist in server", "committedDate": "2020-03-06T09:19:53Z", "type": "forcePushed"}]}