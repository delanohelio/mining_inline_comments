{"pr_number": 2391, "pr_title": "bugfix: configuration exceptions lead to increased CPU usage", "pr_createdAt": "2020-03-11T03:06:54Z", "pr_url": "https://github.com/seata/seata/pull/2391", "timeline": [{"oid": "0e3574c71a52695b4a28fc511902e3ada3741749", "url": "https://github.com/seata/seata/commit/0e3574c71a52695b4a28fc511902e3ada3741749", "message": "optimize file configuration reading", "committedDate": "2020-03-11T03:02:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDgyNTgzMQ==", "url": "https://github.com/seata/seata/pull/2391#discussion_r390825831", "bodyText": "I think ScheduledExecutorService would be instantiate more time if I listen different config.", "author": "l81893521", "createdAt": "2020-03-11T09:01:49Z", "path": "config/seata-config-core/src/main/java/io/seata/config/FileConfiguration.java", "diffHunk": "@@ -306,7 +308,9 @@ public FileListener(String dataId, ConfigurationChangeListener listener) {\n \n         @Override\n         public void onChangeEvent(ConfigurationChangeEvent event) {\n-            while (true) {\n+            ScheduledExecutorService onChangeEventExecutor =", "originalCommit": "0e3574c71a52695b4a28fc511902e3ada3741749", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDkyOTQyNw==", "url": "https://github.com/seata/seata/pull/2391#discussion_r390929427", "bodyText": "PTAL @l81893521", "author": "a364176773", "createdAt": "2020-03-11T12:15:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDgyNTgzMQ=="}], "type": "inlineReview"}, {"oid": "9671e727ec5c9959d4e5f573eb8f34cce4411d69", "url": "https://github.com/seata/seata/commit/9671e727ec5c9959d4e5f573eb8f34cce4411d69", "message": "optimize code logic", "committedDate": "2020-03-11T09:12:47Z", "type": "commit"}, {"oid": "bf7e314577dd31fc0797dffb7586339e7e6166f7", "url": "https://github.com/seata/seata/commit/bf7e314577dd31fc0797dffb7586339e7e6166f7", "message": "Merge branch 'develop' into fix_error_sleep", "committedDate": "2020-03-11T09:20:03Z", "type": "commit"}, {"oid": "dfbbacf97fd75cdd0bd6709011933c80ac5190dc", "url": "https://github.com/seata/seata/commit/dfbbacf97fd75cdd0bd6709011933c80ac5190dc", "message": "adjust code logic", "committedDate": "2020-03-11T12:11:57Z", "type": "commit"}, {"oid": "7b9bc5f7a6a4c4deff41633390a42203d00c75b4", "url": "https://github.com/seata/seata/commit/7b9bc5f7a6a4c4deff41633390a42203d00c75b4", "message": "remove redundant abnormal output", "committedDate": "2020-03-12T01:38:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ5NzA2Ng==", "url": "https://github.com/seata/seata/pull/2391#discussion_r391497066", "bodyText": "use\nLOGGER.error\n\ninstead of\ne.printStackTrace();", "author": "l81893521", "createdAt": "2020-03-12T09:34:33Z", "path": "config/seata-config-core/src/main/java/io/seata/config/FileConfiguration.java", "diffHunk": "@@ -315,13 +315,17 @@ public void onChangeEvent(ConfigurationChangeEvent event) {\n                         event.setDataId(dataId).setNewValue(currentConfig).setOldValue(oldConfig);\n                         listener.onChangeEvent(event);\n                     }\n-                    Thread.sleep(LISTENER_CONFIG_INTERNAL);\n                 } catch (Exception exx) {\n-                    LOGGER.error(\"fileListener execute error:{}\", exx.getMessage(), exx);\n+                    LOGGER.error(\"fileListener execute error:{}\", exx.getMessage());\n+                }\n+                try {\n+                    Thread.sleep(LISTENER_CONFIG_INTERNAL);\n+                } catch (InterruptedException e) {\n+                    e.printStackTrace();", "originalCommit": "7b9bc5f7a6a4c4deff41633390a42203d00c75b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTUwMTA5Mw==", "url": "https://github.com/seata/seata/pull/2391#discussion_r391501093", "bodyText": "use\nLOGGER.error\n\ninstead of\ne.printStackTrace();\n\n\nok", "author": "a364176773", "createdAt": "2020-03-12T09:41:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ5NzA2Ng=="}], "type": "inlineReview"}, {"oid": "0b99f2a4a9d2c74efb3e99d5919b2dacb8aa4c9f", "url": "https://github.com/seata/seata/commit/0b99f2a4a9d2c74efb3e99d5919b2dacb8aa4c9f", "message": "adjust the code", "committedDate": "2020-03-12T09:38:52Z", "type": "commit"}, {"oid": "6d8013c5bbe4deb3bff9f951abad936b8a2b35e3", "url": "https://github.com/seata/seata/commit/6d8013c5bbe4deb3bff9f951abad936b8a2b35e3", "message": "Merge branch 'develop' into fix_error_sleep", "committedDate": "2020-03-12T09:40:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYyMTY2Ng==", "url": "https://github.com/seata/seata/pull/2391#discussion_r391621666", "bodyText": "Please help correct the spelling by the way.Thank you!\nLISTENER_CONFIG_INTERNAL->LISTENER_CONFIG_INTERVAL", "author": "xingfudeshi", "createdAt": "2020-03-12T13:31:46Z", "path": "config/seata-config-core/src/main/java/io/seata/config/FileConfiguration.java", "diffHunk": "@@ -315,9 +315,13 @@ public void onChangeEvent(ConfigurationChangeEvent event) {\n                         event.setDataId(dataId).setNewValue(currentConfig).setOldValue(oldConfig);\n                         listener.onChangeEvent(event);\n                     }\n-                    Thread.sleep(LISTENER_CONFIG_INTERNAL);\n                 } catch (Exception exx) {\n-                    LOGGER.error(\"fileListener execute error:{}\", exx.getMessage(), exx);\n+                    LOGGER.error(\"fileListener execute error:{}\", exx.getMessage());\n+                }\n+                try {\n+                    Thread.sleep(LISTENER_CONFIG_INTERNAL);", "originalCommit": "6d8013c5bbe4deb3bff9f951abad936b8a2b35e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYyNjU2Mw==", "url": "https://github.com/seata/seata/pull/2391#discussion_r391626563", "bodyText": "LISTENER_CONFIG_INTERVAL\n\nok", "author": "a364176773", "createdAt": "2020-03-12T13:39:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYyMTY2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYzMTI4OQ==", "url": "https://github.com/seata/seata/pull/2391#discussion_r391631289", "bodyText": "cpu has behaved normally\u3002", "author": "threefish", "createdAt": "2020-03-12T13:47:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYyMTY2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYzOTg1Nw==", "url": "https://github.com/seata/seata/pull/2391#discussion_r391639857", "bodyText": "cpu has behaved normally\u3002\n\nIf there are no questions, please reply to PTAL separately", "author": "a364176773", "createdAt": "2020-03-12T14:00:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYyMTY2Ng=="}], "type": "inlineReview"}, {"oid": "f522ec7fbc0a256df241ff8ffe684a96f4489c17", "url": "https://github.com/seata/seata/commit/f522ec7fbc0a256df241ff8ffe684a96f4489c17", "message": "modify the variable name", "committedDate": "2020-03-12T13:55:21Z", "type": "commit"}, {"oid": "5d23e59bf7b338d6ec1c5642150febdc4f56c9de", "url": "https://github.com/seata/seata/commit/5d23e59bf7b338d6ec1c5642150febdc4f56c9de", "message": "Merge branch 'develop' into fix_error_sleep", "committedDate": "2020-03-17T05:17:14Z", "type": "commit"}, {"oid": "f13fb0db51f35721a702f7bfe52b4eb1e510af66", "url": "https://github.com/seata/seata/commit/f13fb0db51f35721a702f7bfe52b4eb1e510af66", "message": "Merge branch 'develop' into fix_error_sleep", "committedDate": "2020-03-17T05:28:45Z", "type": "commit"}]}