{"pr_number": 2237, "pr_title": "bugfix: fix DefaultCoordinatorTest failed in Windows OS", "pr_createdAt": "2020-02-10T10:36:21Z", "pr_url": "https://github.com/seata/seata/pull/2237", "timeline": [{"oid": "8454613ba69e659ff745874ccec193d0a36b146e", "url": "https://github.com/seata/seata/commit/8454613ba69e659ff745874ccec193d0a36b146e", "message": "restructure", "committedDate": "2019-11-09T03:11:47Z", "type": "commit"}, {"oid": "387b7cbb08becf632ec62633c456e7c1fc77badc", "url": "https://github.com/seata/seata/commit/387b7cbb08becf632ec62633c456e7c1fc77badc", "message": "Restructure SQLRecognizer and UndoExecutor", "committedDate": "2019-11-09T06:38:09Z", "type": "commit"}, {"oid": "472cb658328284dedb9b66d3369419428ce2616d", "url": "https://github.com/seata/seata/commit/472cb658328284dedb9b66d3369419428ce2616d", "message": "Merge remote-tracking branch 'upstream/develop' into develop", "committedDate": "2019-11-11T06:35:24Z", "type": "commit"}, {"oid": "96de7fd8499b1a8344532465b92661485b59b2e1", "url": "https://github.com/seata/seata/commit/96de7fd8499b1a8344532465b92661485b59b2e1", "message": "optimize concurrency of UndoExecutorGruopFactory and SQLRecognizerGroupFactory", "committedDate": "2019-11-11T06:37:05Z", "type": "commit"}, {"oid": "d4f090ff64ca12f4d9a47a51d8d88f70cba90804", "url": "https://github.com/seata/seata/commit/d4f090ff64ca12f4d9a47a51d8d88f70cba90804", "message": "remove @version tags", "committedDate": "2019-11-11T07:14:20Z", "type": "commit"}, {"oid": "550f6e12e528e0b891f7fa5244cfd75ad40aa9dc", "url": "https://github.com/seata/seata/commit/550f6e12e528e0b891f7fa5244cfd75ad40aa9dc", "message": "add javaDoc;optimize UndoExecutorGroupFactory and SQLOperateRecognizerGroupFactory", "committedDate": "2019-11-11T08:13:55Z", "type": "commit"}, {"oid": "b0e250e7424b5c023e29c8cb302c90257fc6865f", "url": "https://github.com/seata/seata/commit/b0e250e7424b5c023e29c8cb302c90257fc6865f", "message": "Merge branch 'develop' into develop", "committedDate": "2019-11-11T09:17:47Z", "type": "commit"}, {"oid": "d06df2e0f95590f70c50cede0e91a0769b88047a", "url": "https://github.com/seata/seata/commit/d06df2e0f95590f70c50cede0e91a0769b88047a", "message": "rename **Group to **Holder", "committedDate": "2019-11-12T01:04:52Z", "type": "commit"}, {"oid": "3d46a4660cb487c73ddfc6da7bbab5122f7cda9f", "url": "https://github.com/seata/seata/commit/3d46a4660cb487c73ddfc6da7bbab5122f7cda9f", "message": "Merge branch 'develop' of https://github.com/CharmingRabbit/seata into develop", "committedDate": "2019-11-12T01:06:40Z", "type": "commit"}, {"oid": "28322ac0b56e79b26f156d9e927371ece2799c8b", "url": "https://github.com/seata/seata/commit/28322ac0b56e79b26f156d9e927371ece2799c8b", "message": "Merge branch 'develop' into develop", "committedDate": "2019-11-12T10:07:28Z", "type": "commit"}, {"oid": "57fb2d033e654890bc34adf3f5f2a3001c7600a7", "url": "https://github.com/seata/seata/commit/57fb2d033e654890bc34adf3f5f2a3001c7600a7", "message": "remove @data", "committedDate": "2019-11-12T11:08:51Z", "type": "commit"}, {"oid": "c3ae74a5359eec9b2d6fa7051cbe22f27ec79426", "url": "https://github.com/seata/seata/commit/c3ae74a5359eec9b2d6fa7051cbe22f27ec79426", "message": "Merge remote-tracking branch 'upstream/develop' into develop", "committedDate": "2019-11-12T11:10:06Z", "type": "commit"}, {"oid": "e9a163e1535ded6ad4d93884a7e4e6d38b938423", "url": "https://github.com/seata/seata/commit/e9a163e1535ded6ad4d93884a7e4e6d38b938423", "message": "Merge branch 'develop' of https://github.com/CharmingRabbit/seata into develop", "committedDate": "2019-11-12T11:10:36Z", "type": "commit"}, {"oid": "78f456fc5e4af3f86fc117f43d6f21acd16dac86", "url": "https://github.com/seata/seata/commit/78f456fc5e4af3f86fc117f43d6f21acd16dac86", "message": "Merge branch 'develop' into develop", "committedDate": "2019-11-13T04:52:40Z", "type": "commit"}, {"oid": "8c0f5d28d0fe236ef2cb783435b2df1e28d672e1", "url": "https://github.com/seata/seata/commit/8c0f5d28d0fe236ef2cb783435b2df1e28d672e1", "message": "Merge branch 'develop' into develop", "committedDate": "2019-11-13T09:24:52Z", "type": "commit"}, {"oid": "3e9a6bdbc44384652899470b6185958fc11a69b4", "url": "https://github.com/seata/seata/commit/3e9a6bdbc44384652899470b6185958fc11a69b4", "message": "fix NPE in UndoExecutorFactory", "committedDate": "2019-11-14T01:18:52Z", "type": "commit"}, {"oid": "19ef256b49f428f07e88a4600850cccc2d900e47", "url": "https://github.com/seata/seata/commit/19ef256b49f428f07e88a4600850cccc2d900e47", "message": "restructure", "committedDate": "2019-11-14T01:21:18Z", "type": "commit"}, {"oid": "43bc2c344dd8f44ad4f60dcadcbe54a6ba4ddbb1", "url": "https://github.com/seata/seata/commit/43bc2c344dd8f44ad4f60dcadcbe54a6ba4ddbb1", "message": "Restructure SQLRecognizer and UndoExecutor", "committedDate": "2019-11-14T01:21:19Z", "type": "commit"}, {"oid": "45a275caf806f3d9aae5edd7f27fcc27f5d1b9d8", "url": "https://github.com/seata/seata/commit/45a275caf806f3d9aae5edd7f27fcc27f5d1b9d8", "message": "optimize concurrency of UndoExecutorGruopFactory and SQLRecognizerGroupFactory", "committedDate": "2019-11-14T01:21:19Z", "type": "commit"}, {"oid": "a96fe5e8e36bbd242ad44d05c767c3263a2e75be", "url": "https://github.com/seata/seata/commit/a96fe5e8e36bbd242ad44d05c767c3263a2e75be", "message": "remove @version tags", "committedDate": "2019-11-14T01:21:20Z", "type": "commit"}, {"oid": "5febb227411c5594506c9c8eb1fabf7ad7e40a0a", "url": "https://github.com/seata/seata/commit/5febb227411c5594506c9c8eb1fabf7ad7e40a0a", "message": "add javaDoc;optimize UndoExecutorGroupFactory and SQLOperateRecognizerGroupFactory", "committedDate": "2019-11-14T01:21:21Z", "type": "commit"}, {"oid": "b9a3696a94eecda0715732aff2eca04b0ec5bc8c", "url": "https://github.com/seata/seata/commit/b9a3696a94eecda0715732aff2eca04b0ec5bc8c", "message": "rename **Group to **Holder", "committedDate": "2019-11-14T01:21:21Z", "type": "commit"}, {"oid": "ca8813429e12ef93c754c05efd3c496a9acab069", "url": "https://github.com/seata/seata/commit/ca8813429e12ef93c754c05efd3c496a9acab069", "message": "remove @data", "committedDate": "2019-11-14T01:21:21Z", "type": "commit"}, {"oid": "05adb694c15ddff8379f3858afa8e821c44497f0", "url": "https://github.com/seata/seata/commit/05adb694c15ddff8379f3858afa8e821c44497f0", "message": "optimize: xid header lowercase (#1789)", "committedDate": "2019-11-14T01:21:21Z", "type": "commit"}, {"oid": "b1b05a94656883c8ad4582dffa1581426715fce7", "url": "https://github.com/seata/seata/commit/b1b05a94656883c8ad4582dffa1581426715fce7", "message": "clean: reformat saga module (#1890)", "committedDate": "2019-11-14T01:21:21Z", "type": "commit"}, {"oid": "2c5fe29ea4352dc7a01713e405ad228c4bdd52b5", "url": "https://github.com/seata/seata/commit/2c5fe29ea4352dc7a01713e405ad228c4bdd52b5", "message": "fix NPE in UndoExecutorFactory", "committedDate": "2019-11-14T01:21:21Z", "type": "commit"}, {"oid": "92bba972a2d761ca185dc256749b5194e199ffdc", "url": "https://github.com/seata/seata/commit/92bba972a2d761ca185dc256749b5194e199ffdc", "message": "Merge branch 'develop' of https://github.com/CharmingRabbit/seata into develop", "committedDate": "2019-11-14T02:54:43Z", "type": "commit"}, {"oid": "c116c9b0fb4b1e3e6cb6ff7c1ef77c2d453c8cd9", "url": "https://github.com/seata/seata/commit/c116c9b0fb4b1e3e6cb6ff7c1ef77c2d453c8cd9", "message": "merge latest code", "committedDate": "2019-11-14T12:02:14Z", "type": "commit"}, {"oid": "59fe1cf5118baed2467d3d9b5471fc9a415f96fa", "url": "https://github.com/seata/seata/commit/59fe1cf5118baed2467d3d9b5471fc9a415f96fa", "message": "bugfix:fix NPE in UndoExecutorFactory", "committedDate": "2019-11-14T12:04:39Z", "type": "commit"}, {"oid": "378e89c316845148800674914e9c740a03091178", "url": "https://github.com/seata/seata/commit/378e89c316845148800674914e9c740a03091178", "message": "local commit", "committedDate": "2019-11-21T07:16:01Z", "type": "commit"}, {"oid": "b8dcb893e02ee7d11f4692267c650a412aa4891e", "url": "https://github.com/seata/seata/commit/b8dcb893e02ee7d11f4692267c650a412aa4891e", "message": "merge remote", "committedDate": "2019-11-22T02:59:42Z", "type": "commit"}, {"oid": "9755622cb16b6014a7a8ed8a2ecb1c0e23551a65", "url": "https://github.com/seata/seata/commit/9755622cb16b6014a7a8ed8a2ecb1c0e23551a65", "message": "Merge remote-tracking branch 'upstream/develop' into develop", "committedDate": "2019-11-22T02:59:54Z", "type": "commit"}, {"oid": "ade3c8529a29485631b6f639d29fb255a52cb24a", "url": "https://github.com/seata/seata/commit/ade3c8529a29485631b6f639d29fb255a52cb24a", "message": "bugfix:A bug that will appear when the default constructor is declared private", "committedDate": "2019-11-22T03:03:21Z", "type": "commit"}, {"oid": "c0867c6aac833153e6eeddef3b3929a5fd3fc162", "url": "https://github.com/seata/seata/commit/c0867c6aac833153e6eeddef3b3929a5fd3fc162", "message": "Merge remote-tracking branch 'upstream/develop' into develop", "committedDate": "2019-11-22T08:51:55Z", "type": "commit"}, {"oid": "9fc4f5eacf38028b5bddbe726dfaff86159110f9", "url": "https://github.com/seata/seata/commit/9fc4f5eacf38028b5bddbe726dfaff86159110f9", "message": "code", "committedDate": "2019-11-22T08:53:44Z", "type": "commit"}, {"oid": "dbf102fa9528b7cc8e6b2b40182520f589392731", "url": "https://github.com/seata/seata/commit/dbf102fa9528b7cc8e6b2b40182520f589392731", "message": "Merge branch 'develop' into develop", "committedDate": "2019-11-23T09:00:46Z", "type": "commit"}, {"oid": "ea397a7bf89d48a98a29385e5a3836edad7bdf5f", "url": "https://github.com/seata/seata/commit/ea397a7bf89d48a98a29385e5a3836edad7bdf5f", "message": "Merge branch 'develop' into develop", "committedDate": "2019-11-24T07:24:40Z", "type": "commit"}, {"oid": "3f4dd2bed800b7291fb6bbe69b82fd86340a6a85", "url": "https://github.com/seata/seata/commit/3f4dd2bed800b7291fb6bbe69b82fd86340a6a85", "message": "Merge branch 'develop' into develop", "committedDate": "2019-11-29T03:44:56Z", "type": "commit"}, {"oid": "028a80d963f9393724256bd6bcb0b54429b94404", "url": "https://github.com/seata/seata/commit/028a80d963f9393724256bd6bcb0b54429b94404", "message": "Merge branch 'develop' into develop", "committedDate": "2019-11-29T13:10:28Z", "type": "commit"}, {"oid": "e1968bb425a2ce25123fff1de6165f596e876be8", "url": "https://github.com/seata/seata/commit/e1968bb425a2ce25123fff1de6165f596e876be8", "message": "Merge remote-tracking branch 'upstream/develop' into develop", "committedDate": "2019-12-02T07:34:12Z", "type": "commit"}, {"oid": "fd36c51a528ee06691ca976f0c44f0fa4b0f25b7", "url": "https://github.com/seata/seata/commit/fd36c51a528ee06691ca976f0c44f0fa4b0f25b7", "message": "Merge branch 'develop' of https://github.com/CharmingRabbit/seata into develop", "committedDate": "2019-12-02T07:34:45Z", "type": "commit"}, {"oid": "f01d15f86cb359c5fe59826b7572352548afd378", "url": "https://github.com/seata/seata/commit/f01d15f86cb359c5fe59826b7572352548afd378", "message": "Merge remote-tracking branch 'upstream/develop' into develop", "committedDate": "2019-12-05T11:26:23Z", "type": "commit"}, {"oid": "c9aa49b922a67e8257b420166e2a1da724cd3eb0", "url": "https://github.com/seata/seata/commit/c9aa49b922a67e8257b420166e2a1da724cd3eb0", "message": "Merge remote-tracking branch 'upstream/develop' into develop", "committedDate": "2019-12-17T07:57:43Z", "type": "commit"}, {"oid": "f195d869e57125771712dc79439fb61241bfd3b4", "url": "https://github.com/seata/seata/commit/f195d869e57125771712dc79439fb61241bfd3b4", "message": "Merge remote-tracking branch 'upstream/develop' into develop", "committedDate": "2019-12-30T00:55:57Z", "type": "commit"}, {"oid": "c3399fff0c4bfd65b79afae3c8a55a66560f7410", "url": "https://github.com/seata/seata/commit/c3399fff0c4bfd65b79afae3c8a55a66560f7410", "message": "Merge remote-tracking branch 'upstream/develop' into develop", "committedDate": "2020-01-04T06:59:02Z", "type": "commit"}, {"oid": "ac3a43e717e5601dc658016db28f4b40a60b35cb", "url": "https://github.com/seata/seata/commit/ac3a43e717e5601dc658016db28f4b40a60b35cb", "message": "Merge remote-tracking branch 'upstream/develop' into develop", "committedDate": "2020-01-17T00:57:17Z", "type": "commit"}, {"oid": "7c5fbdfeeec3905e9faf378d64ded71783021ab8", "url": "https://github.com/seata/seata/commit/7c5fbdfeeec3905e9faf378d64ded71783021ab8", "message": "Merge remote-tracking branch 'upstream/develop' into develop", "committedDate": "2020-02-10T09:04:42Z", "type": "commit"}, {"oid": "71950a24fbe3c141a9a814143e9b10ab4cd11ca5", "url": "https://github.com/seata/seata/commit/71950a24fbe3c141a9a814143e9b10ab4cd11ca5", "message": "bugfix:fix DefaultCoordinatorTest failed", "committedDate": "2020-02-10T10:29:28Z", "type": "commit"}, {"oid": "fd6e09cd68e695af8efc8cec342e3b250cce6254", "url": "https://github.com/seata/seata/commit/fd6e09cd68e695af8efc8cec342e3b250cce6254", "message": "format code style", "committedDate": "2020-02-10T10:50:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzEzMjcxMw==", "url": "https://github.com/seata/seata/pull/2237#discussion_r377132713", "bodyText": "SessionHolder.destroy();  prevents other TestClasses from being deleted after creating data files.", "author": "slievrly", "createdAt": "2020-02-10T15:28:32Z", "path": "server/src/test/java/io/seata/server/coordinator/DefaultCoordinatorTest.java", "diffHunk": "@@ -220,22 +222,24 @@ public static void afterClass() throws Exception {\n         for (GlobalSession globalSession : globalSessions) {\n             globalSession.closeAndClean();\n         }\n-\n-        SessionHolder.destroy();\n     }\n \n     @AfterEach\n-    public void tearDown() {\n+    public void tearDown() throws IOException {\n+        SessionHolder.destroy();\n         deleteDataFile();\n     }\n \n-    private static void deleteDataFile() {\n+    private static void deleteDataFile() throws IOException {\n         File directory = new File(sessionStorePath);\n         File[] files = directory.listFiles();\n-        for (File file : files) {\n-            file.delete();\n+        if (files != null && files.length > 0) {\n+            for (File file : files) {\n+                Files.delete(Paths.get(file.getPath()));\n+            }\n         }\n     }\n+\n     private static void deleteAndCreateDataFile() throws IOException {", "originalCommit": "fd6e09cd68e695af8efc8cec342e3b250cce6254", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzE1ODUwNw==", "url": "https://github.com/seata/seata/pull/2237#discussion_r377158507", "bodyText": "added", "author": "booogu", "createdAt": "2020-02-10T16:07:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzEzMjcxMw=="}], "type": "inlineReview"}, {"oid": "08345892e8395d0a25e3edccf3bd5a43a78053ca", "url": "https://github.com/seata/seata/commit/08345892e8395d0a25e3edccf3bd5a43a78053ca", "message": "add destory() in beforeEach", "committedDate": "2020-02-10T16:03:46Z", "type": "commit"}, {"oid": "3d7edff8f9a1996a02588187a927d6ccf75975af", "url": "https://github.com/seata/seata/commit/3d7edff8f9a1996a02588187a927d6ccf75975af", "message": "fix npe while destroySessionHolder", "committedDate": "2020-02-11T01:38:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQyMDIyOQ==", "url": "https://github.com/seata/seata/pull/2237#discussion_r377420229", "bodyText": "This should be SessionHolder.destroy to determine whether or not null, SessionHolder as a static method class, there is no guarantee that the internal initialization.", "author": "slievrly", "createdAt": "2020-02-11T02:14:20Z", "path": "server/src/test/java/io/seata/server/coordinator/DefaultCoordinatorTest.java", "diffHunk": "@@ -220,27 +222,42 @@ public static void afterClass() throws Exception {\n         for (GlobalSession globalSession : globalSessions) {\n             globalSession.closeAndClean();\n         }\n-\n-        SessionHolder.destroy();\n     }\n \n     @AfterEach\n-    public void tearDown() {\n+    public void tearDown() throws IOException {\n+        destroySessionHolder();\n         deleteDataFile();\n     }\n \n-    private static void deleteDataFile() {\n+    private static void deleteDataFile() throws IOException {\n         File directory = new File(sessionStorePath);\n         File[] files = directory.listFiles();\n-        for (File file : files) {\n-            file.delete();\n+        if (files != null && files.length > 0) {\n+            for (File file : files) {\n+                Files.delete(Paths.get(file.getPath()));\n+            }\n         }\n     }\n+\n     private static void deleteAndCreateDataFile() throws IOException {\n+        destroySessionHolder();\n         deleteDataFile();\n         SessionHolder.init(StoreMode.FILE.name());\n     }\n \n+    private static void destroySessionHolder() {\n+        try {\n+            SessionHolder.getRootSessionManager();", "originalCommit": "3d7edff8f9a1996a02588187a927d6ccf75975af", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQyNDMzNw==", "url": "https://github.com/seata/seata/pull/2237#discussion_r377424337", "bodyText": "yeah,now add null check in SessionHolder.destroy()", "author": "booogu", "createdAt": "2020-02-11T02:37:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQyMDIyOQ=="}], "type": "inlineReview"}, {"oid": "b88b9011a8b93bf9adee0db92dc3eb7c73177d91", "url": "https://github.com/seata/seata/commit/b88b9011a8b93bf9adee0db92dc3eb7c73177d91", "message": "fix npe in SessionHolder.destroy()", "committedDate": "2020-02-11T02:34:36Z", "type": "commit"}]}