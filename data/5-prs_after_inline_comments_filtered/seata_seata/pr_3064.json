{"pr_number": 3064, "pr_title": "feature: support configuring the order of the TM and TCC interceptor", "pr_createdAt": "2020-08-26T09:11:57Z", "pr_url": "https://github.com/seata/seata/pull/3064", "timeline": [{"oid": "e407b1b6299e5a9460f759114b34e10d3da09bf7", "url": "https://github.com/seata/seata/commit/e407b1b6299e5a9460f759114b34e10d3da09bf7", "message": "GlobalTransactionalInterceptor and TccActionInterceptor ordered", "committedDate": "2020-08-26T09:03:40Z", "type": "commit"}, {"oid": "d2c937d8ad5b898a071c3223da21b23bd0a6cf4c", "url": "https://github.com/seata/seata/commit/d2c937d8ad5b898a071c3223da21b23bd0a6cf4c", "message": "\u79fb\u9664\u6d4b\u8bd5\u7528\u7684main\u51fd\u6570\u3002", "committedDate": "2020-08-26T09:05:03Z", "type": "commit"}, {"oid": "fcfd06d3b0ae4248ea2c3fb2e666c1f71861b973", "url": "https://github.com/seata/seata/commit/fcfd06d3b0ae4248ea2c3fb2e666c1f71861b973", "message": "\u6dfb\u52a0OrderUtil\u7684\u6d4b\u8bd5\u7528\u4f8b\u3002", "committedDate": "2020-08-26T09:32:40Z", "type": "commit"}, {"oid": "79339811a9e132bb2c2123dce25c682dafeff7e7", "url": "https://github.com/seata/seata/commit/79339811a9e132bb2c2123dce25c682dafeff7e7", "message": "\u8c03\u6574TCC\u62e6\u622a\u5668\u7684order\u503c\u4e3aHIGHEST + 1000\uff0c\u56e0\u4e3a\u5206\u652f\u4e8b\u52a1\u6ce8\u518c\u8fd8\u662f\u5728\u672c\u5730\u4e8b\u52a1\u5f00\u542f\u4e4b\u524d\u6bd4\u8f83\u597d\u3002", "committedDate": "2020-08-27T03:01:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgwODMyOQ==", "url": "https://github.com/seata/seata/pull/3064#discussion_r478808329", "bodyText": "!=1 => <=0", "author": "slievrly", "createdAt": "2020-08-28T03:20:33Z", "path": "spring/src/main/java/io/seata/spring/annotation/GlobalTransactionScanner.java", "diffHunk": "@@ -246,6 +258,20 @@ protected Object wrapIfNecessary(Object bean, String beanName, Object cacheKey)\n         }\n     }\n \n+    private int getAddAdvisorPos(AdvisedSupport advised, Advisor avr, int avrOrder) {\n+        Integer order;\n+        Advisor advisor;\n+        for (int i = 0, l = advised.getAdvisors().length; i < l; ++i) {\n+            advisor = advised.getAdvisors()[i];\n+            order = OrderUtil.getOrder(advisor);\n+            if (order == null || order > avrOrder ||\n+                    (order == avrOrder && avr.getClass().getSimpleName().compareTo(advisor.getClass().getSimpleName()) != 1)) {", "originalCommit": "79339811a9e132bb2c2123dce25c682dafeff7e7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgwODUzOQ==", "url": "https://github.com/seata/seata/pull/3064#discussion_r478808539", "bodyText": "OK", "author": "wangliang181230", "createdAt": "2020-08-28T03:21:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgwODMyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgzODQwNg==", "url": "https://github.com/seata/seata/pull/3064#discussion_r478838406", "bodyText": "done", "author": "wangliang181230", "createdAt": "2020-08-28T05:30:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgwODMyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgxMDE1Nw==", "url": "https://github.com/seata/seata/pull/3064#discussion_r478810157", "bodyText": "advised.getAdvisors().length - 1 => advised.getAdvisors().length ?", "author": "slievrly", "createdAt": "2020-08-28T03:27:57Z", "path": "spring/src/main/java/io/seata/spring/annotation/GlobalTransactionScanner.java", "diffHunk": "@@ -246,6 +258,20 @@ protected Object wrapIfNecessary(Object bean, String beanName, Object cacheKey)\n         }\n     }\n \n+    private int getAddAdvisorPos(AdvisedSupport advised, Advisor avr, int avrOrder) {\n+        Integer order;\n+        Advisor advisor;\n+        for (int i = 0, l = advised.getAdvisors().length; i < l; ++i) {\n+            advisor = advised.getAdvisors()[i];\n+            order = OrderUtil.getOrder(advisor);\n+            if (order == null || order > avrOrder ||\n+                    (order == avrOrder && avr.getClass().getSimpleName().compareTo(advisor.getClass().getSimpleName()) != 1)) {\n+                return i;\n+            }\n+        }\n+        return advised.getAdvisors().length - 1;", "originalCommit": "79339811a9e132bb2c2123dce25c682dafeff7e7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgzOTQyNA==", "url": "https://github.com/seata/seata/pull/3064#discussion_r478839424", "bodyText": "No, this method returns the pos to advised.addAdvisor(pos, avr);, it needs to be -1.", "author": "wangliang181230", "createdAt": "2020-08-28T05:33:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgxMDE1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODkyMzA3MA==", "url": "https://github.com/seata/seata/pull/3064#discussion_r478923070", "bodyText": "I've rewritten the code here, and it should be better understood now.\nPTAL", "author": "wangliang181230", "createdAt": "2020-08-28T08:12:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgxMDE1Nw=="}], "type": "inlineReview"}, {"oid": "02180e09498cd690d68e2218dadbcaba58b81acd", "url": "https://github.com/seata/seata/commit/02180e09498cd690d68e2218dadbcaba58b81acd", "message": "seata\u7684\u4e24\u4e2ainterceptor\u7684order\u503c\u53ef\u914d\u7f6e\u5316\u3002", "committedDate": "2020-08-28T05:04:55Z", "type": "commit"}, {"oid": "5033f49c9e2a546dfea51934e372ab2a860498f7", "url": "https://github.com/seata/seata/commit/5033f49c9e2a546dfea51934e372ab2a860498f7", "message": "\u6253\u5370\u65e5\u5fd7\u5185\u5bb9\u8c03\u6574\u3002", "committedDate": "2020-08-28T05:24:59Z", "type": "commit"}, {"oid": "a3388573bd3a6027846daf913cfaf42a136bb25f", "url": "https://github.com/seata/seata/commit/a3388573bd3a6027846daf913cfaf42a136bb25f", "message": "\u4f7f\u4ee3\u7801\u66f4\u5bb9\u6613\u7406\u89e3\u3002", "committedDate": "2020-08-28T05:35:53Z", "type": "commit"}, {"oid": "d0945b262a2234d4c2829401ad79f71ae805d440", "url": "https://github.com/seata/seata/commit/d0945b262a2234d4c2829401ad79f71ae805d440", "message": "\u8c03\u6574SeataOrdered\u63a5\u53e3\u4e3aSeataInterceptor", "committedDate": "2020-08-28T05:58:21Z", "type": "commit"}, {"oid": "95a1b56d76e9621bc8465f618cf8d75a7cab5e5d", "url": "https://github.com/seata/seata/commit/95a1b56d76e9621bc8465f618cf8d75a7cab5e5d", "message": "Merge remote-tracking branch 'remotes/upstream/develop' into optimize-gtx-and-tcc-interceptor-ordered\n\n# Conflicts:\n#\tscript/client/spring/application.yml\n#\tseata-spring-boot-starter/src/main/resources/META-INF/additional-spring-configuration-metadata.json", "committedDate": "2020-08-28T06:16:30Z", "type": "commit"}, {"oid": "7ad1a41f5a2017721d71aff092edcba442adee5c", "url": "https://github.com/seata/seata/commit/7ad1a41f5a2017721d71aff092edcba442adee5c", "message": "\u89e3\u9664\u4e34\u754c\u503c\u7684\u95ee\u9898\u3002", "committedDate": "2020-08-28T07:10:43Z", "type": "commit"}, {"oid": "b15f9c77d748462dd617ebb80e8e0aad745673e3", "url": "https://github.com/seata/seata/commit/b15f9c77d748462dd617ebb80e8e0aad745673e3", "message": "\u91cd\u6784\u4ee3\u7801\u3002", "committedDate": "2020-08-28T07:23:27Z", "type": "commit"}, {"oid": "d6c3db5f4e34e08728ee3e2113dc53a023843273", "url": "https://github.com/seata/seata/commit/d6c3db5f4e34e08728ee3e2113dc53a023843273", "message": "\u91cd\u6784\u4ee3\u7801\u3002", "committedDate": "2020-08-28T08:03:21Z", "type": "commit"}, {"oid": "eea9641e332a2ebe1690d399e9395611c446d8ea", "url": "https://github.com/seata/seata/commit/eea9641e332a2ebe1690d399e9395611c446d8ea", "message": "\u91cd\u6784\u4ee3\u7801\u3002", "committedDate": "2020-08-28T08:20:26Z", "type": "commit"}, {"oid": "ebeb5b742755dae60fb59f855456eb58b4f41cdf", "url": "https://github.com/seata/seata/commit/ebeb5b742755dae60fb59f855456eb58b4f41cdf", "message": "\u65e5\u5fd7\u9519\u8bef\u4fee\u6b63\u3002", "committedDate": "2020-08-28T08:56:11Z", "type": "commit"}, {"oid": "3768eacc3b0f14bb1b0455b40a8481ebdb062fb2", "url": "https://github.com/seata/seata/commit/3768eacc3b0f14bb1b0455b40a8481ebdb062fb2", "message": "\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u952e\u9519\u8bef\u4fee\u6b63", "committedDate": "2020-08-28T09:08:13Z", "type": "commit"}, {"oid": "7c49607aa526ad059f73f97606fd3e3435dd1e01", "url": "https://github.com/seata/seata/commit/7c49607aa526ad059f73f97606fd3e3435dd1e01", "message": "\u4f18\u5316\u4ee3\u7801\u3002", "committedDate": "2020-08-31T03:59:14Z", "type": "commit"}, {"oid": "035ae3dfd6996e5b0eef6cd9b47d6249216a7bcf", "url": "https://github.com/seata/seata/commit/035ae3dfd6996e5b0eef6cd9b47d6249216a7bcf", "message": "\u5c0f\u8c03\u6574\u3002", "committedDate": "2020-08-31T03:59:38Z", "type": "commit"}, {"oid": "e85a724e52cdcb48570a4311f70dc5c3a3e56cdc", "url": "https://github.com/seata/seata/commit/e85a724e52cdcb48570a4311f70dc5c3a3e56cdc", "message": "\u5c0f\u8c03\u6574\u3002", "committedDate": "2020-08-31T04:29:29Z", "type": "commit"}, {"oid": "01cb81cf224d06b8096779d3148d75bd528958b9", "url": "https://github.com/seata/seata/commit/01cb81cf224d06b8096779d3148d75bd528958b9", "message": "\u5c0f\u8c03\u6574\u3002", "committedDate": "2020-08-31T04:50:17Z", "type": "commit"}, {"oid": "7a1a8f5730056e3c7dc1e09013b830d63a0519dc", "url": "https://github.com/seata/seata/commit/7a1a8f5730056e3c7dc1e09013b830d63a0519dc", "message": "\u6dfb\u52a0\u679a\u4e3eSeataInterceptorPosition;", "committedDate": "2020-09-03T02:04:08Z", "type": "commit"}, {"oid": "af068bfb4cbbf6644d4c1941241c32e163a8ef8a", "url": "https://github.com/seata/seata/commit/af068bfb4cbbf6644d4c1941241c32e163a8ef8a", "message": "Merge remote-tracking branch 'remotes/upstream/develop' into optimize-gtx-and-tcc-interceptor-ordered", "committedDate": "2020-09-04T06:36:34Z", "type": "commit"}, {"oid": "d54f797ab35adc89d736d0777dfe75086b494f6e", "url": "https://github.com/seata/seata/commit/d54f797ab35adc89d736d0777dfe75086b494f6e", "message": "Merge remote-tracking branch 'remotes/upstream/develop' into optimize-gtx-and-tcc-interceptor-ordered\n\n# Conflicts:\n#\tcommon/src/main/java/io/seata/common/DefaultValues.java\n#\tseata-spring-boot-starter/src/main/resources/META-INF/additional-spring-configuration-metadata.json\n#\tspring/src/main/java/io/seata/spring/tcc/TccActionInterceptor.java", "committedDate": "2020-09-18T09:53:13Z", "type": "commit"}, {"oid": "dee24e6ba53517723645d9dfd0af1c6492712ed4", "url": "https://github.com/seata/seata/commit/dee24e6ba53517723645d9dfd0af1c6492712ed4", "message": "Merge branch 'develop' into optimize-gtx-and-tcc-interceptor-ordered", "committedDate": "2020-09-18T10:06:27Z", "type": "commit"}, {"oid": "3eb81922317f8418926d2137230d78e9d3c9a1da", "url": "https://github.com/seata/seata/commit/3eb81922317f8418926d2137230d78e9d3c9a1da", "message": "optimize code", "committedDate": "2020-09-18T10:10:55Z", "type": "commit"}, {"oid": "15484266c8357b538a1df7aed85260c9caea86dc", "url": "https://github.com/seata/seata/commit/15484266c8357b538a1df7aed85260c9caea86dc", "message": "optimize code", "committedDate": "2020-09-18T10:15:36Z", "type": "commit"}, {"oid": "20ee9071282e704bf7a4e7c7861e88e8efda0d89", "url": "https://github.com/seata/seata/commit/20ee9071282e704bf7a4e7c7861e88e8efda0d89", "message": "optimize code", "committedDate": "2020-09-18T10:37:15Z", "type": "commit"}, {"oid": "5f09e476307a1fd823f1e57a1e13449ba0fb9b44", "url": "https://github.com/seata/seata/commit/5f09e476307a1fd823f1e57a1e13449ba0fb9b44", "message": "Merge branch 'develop' into optimize-gtx-and-tcc-interceptor-ordered", "committedDate": "2020-10-12T11:01:42Z", "type": "commit"}, {"oid": "1d10ef64a4cd74f8e689c0d275bba1d93875ea1f", "url": "https://github.com/seata/seata/commit/1d10ef64a4cd74f8e689c0d275bba1d93875ea1f", "message": "Merge remote-tracking branch 'remotes/upstream/develop' into optimize-gtx-and-tcc-interceptor-ordered", "committedDate": "2020-10-15T02:31:40Z", "type": "commit"}, {"oid": "e73117681b4920507a2d21d127cc952bb13c5200", "url": "https://github.com/seata/seata/commit/e73117681b4920507a2d21d127cc952bb13c5200", "message": "Merge branch 'develop' into optimize-gtx-and-tcc-interceptor-ordered", "committedDate": "2020-10-17T16:14:41Z", "type": "commit"}, {"oid": "019f46c695c9b874de1be96524c96a1ade20c337", "url": "https://github.com/seata/seata/commit/019f46c695c9b874de1be96524c96a1ade20c337", "message": "Merge branch 'develop' into optimize-gtx-and-tcc-interceptor-ordered", "committedDate": "2020-10-23T08:50:42Z", "type": "commit"}, {"oid": "45685bb55da7808dab9cef54725ae07e1774fc1a", "url": "https://github.com/seata/seata/commit/45685bb55da7808dab9cef54725ae07e1774fc1a", "message": "Merge branch 'develop' into optimize-gtx-and-tcc-interceptor-ordered", "committedDate": "2020-10-29T03:23:53Z", "type": "commit"}, {"oid": "6402d398ed003a8ce41b2f1a0c3affde0942cb48", "url": "https://github.com/seata/seata/commit/6402d398ed003a8ce41b2f1a0c3affde0942cb48", "message": "Merge branch 'develop' into optimize-gtx-and-tcc-interceptor-ordered", "committedDate": "2020-11-27T07:26:00Z", "type": "commit"}, {"oid": "7ceaec750f46ee7ec2f7873eae8e4e3a0b7a498e", "url": "https://github.com/seata/seata/commit/7ceaec750f46ee7ec2f7873eae8e4e3a0b7a498e", "message": "Merge remote-tracking branch 'remotes/upstream/develop' into optimize-gtx-and-tcc-interceptor-ordered\n\n# Conflicts:\n#\tcommon/src/main/java/io/seata/common/DefaultValues.java\n#\tcore/src/main/java/io/seata/core/constants/ConfigurationKeys.java\n#\tscript/client/conf/file.conf\n#\tscript/client/spring/application.properties\n#\tscript/client/spring/application.yml\n#\tseata-spring-boot-starter/src/main/java/io/seata/spring/boot/autoconfigure/properties/client/RmProperties.java\n#\tseata-spring-boot-starter/src/main/resources/META-INF/additional-spring-configuration-metadata.json\n#\tspring/src/main/java/io/seata/spring/tcc/TccActionInterceptor.java", "committedDate": "2021-01-22T07:41:06Z", "type": "commit"}, {"oid": "521aa38e0f1b47428d4fa8aed5cdc82112cede1c", "url": "https://github.com/seata/seata/commit/521aa38e0f1b47428d4fa8aed5cdc82112cede1c", "message": "optimize code", "committedDate": "2021-01-22T07:54:31Z", "type": "commit"}, {"oid": "151d8680d8e1cab9ac69fdcd0b3b72eeee4f1fa6", "url": "https://github.com/seata/seata/commit/151d8680d8e1cab9ac69fdcd0b3b72eeee4f1fa6", "message": "\u6dfb\u52a0pr\u65e5\u5fd7\u52301.5.0.md", "committedDate": "2021-01-22T08:05:23Z", "type": "commit"}, {"oid": "98ba111c3174edb7a0c7c4ccc54f709b4ef6e79b", "url": "https://github.com/seata/seata/commit/98ba111c3174edb7a0c7c4ccc54f709b4ef6e79b", "message": "Merge remote-tracking branch 'remotes/upstream/develop' into optimize-gtx-and-tcc-interceptor-ordered", "committedDate": "2021-01-25T09:22:17Z", "type": "commit"}, {"oid": "8dc7befe0d163c1338220bd911d5d36ed3194553", "url": "https://github.com/seata/seata/commit/8dc7befe0d163c1338220bd911d5d36ed3194553", "message": "Merge branch 'develop' into optimize-gtx-and-tcc-interceptor-ordered", "committedDate": "2021-03-26T09:16:05Z", "type": "commit"}, {"oid": "c88092f185e01d6156c5bd22c84eb08095d59b71", "url": "https://github.com/seata/seata/commit/c88092f185e01d6156c5bd22c84eb08095d59b71", "message": "Merge remote-tracking branch 'remotes/upstream/develop' into optimize-gtx-and-tcc-interceptor-ordered\n\n# Conflicts:\n#\tchanges/1.5.0.md\n#\tchanges/en-us/1.5.0.md\n#\tscript/config-center/config.txt", "committedDate": "2021-05-10T02:35:51Z", "type": "commit"}, {"oid": "9365b293868aae8705748df41549e38291ae3475", "url": "https://github.com/seata/seata/commit/9365b293868aae8705748df41549e38291ae3475", "message": "Merge remote-tracking branch 'remotes/upstream/develop' into optimize-gtx-and-tcc-interceptor-ordered\n\n# Conflicts:\n#\tchanges/1.5.0.md\n#\tchanges/en-us/1.5.0.md", "committedDate": "2021-05-10T02:37:38Z", "type": "commit"}, {"oid": "e7147781ce7cefaf2202d02efcbcbf19b2ed86d5", "url": "https://github.com/seata/seata/commit/e7147781ce7cefaf2202d02efcbcbf19b2ed86d5", "message": "fix style", "committedDate": "2021-05-10T02:44:18Z", "type": "commit"}, {"oid": "73d9dd4f37900f016af45e77b4b124edb772ff78", "url": "https://github.com/seata/seata/commit/73d9dd4f37900f016af45e77b4b124edb772ff78", "message": "optimize code", "committedDate": "2021-05-10T05:42:07Z", "type": "commit"}, {"oid": "0ebb7ea677fe4656eadabb262ed2c157a8d8bac9", "url": "https://github.com/seata/seata/commit/0ebb7ea677fe4656eadabb262ed2c157a8d8bac9", "message": "Merge remote-tracking branch 'remotes/upstream/develop' into optimize-gtx-and-tcc-interceptor-ordered\n\n# Conflicts:\n#\tchanges/1.5.0.md\n#\tchanges/en-us/1.5.0.md", "committedDate": "2021-05-11T06:23:15Z", "type": "commit"}, {"oid": "ab219bd16479926a9f3224a84845e3552dea39fb", "url": "https://github.com/seata/seata/commit/ab219bd16479926a9f3224a84845e3552dea39fb", "message": "bugfix: \u4fee\u590d\u5f53`position == AfterTransaction`\u65f6\uff0c\u626b\u63cf\u5230TransactionInterceptor\u524d\u5148\u626b\u5230\u5176\u4ed6\u62e6\u622a\u5668\u7b26\u5408\u6761\u4ef6\u65f6\uff0c\u5c31\u8fd4\u56de\u4e86\u8be5\u62e6\u622a\u5668\u7684position\u4e86\u3002\u540c\u65f6\u91cd\u6784\u4e86\u4ee3\u7801\u3002", "committedDate": "2021-05-11T07:46:29Z", "type": "commit"}, {"oid": "0d056ae3f14dad433ae64929b76e5eefa3476068", "url": "https://github.com/seata/seata/commit/0d056ae3f14dad433ae64929b76e5eefa3476068", "message": "Merge remote-tracking branch 'remotes/upstream/develop' into optimize-gtx-and-tcc-interceptor-ordered\n\n# Conflicts:\n#\tchanges/1.5.0.md\n#\tchanges/en-us/1.5.0.md", "committedDate": "2021-05-11T09:47:15Z", "type": "commit"}, {"oid": "1d9429e41a20e8334442a8d3828e35191ca84385", "url": "https://github.com/seata/seata/commit/1d9429e41a20e8334442a8d3828e35191ca84385", "message": "fix style", "committedDate": "2021-05-11T09:47:47Z", "type": "commit"}]}