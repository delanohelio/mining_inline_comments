{"pr_number": 3367, "pr_title": "bugfix: when the xa branch is rollback, it cannot be executed due to idle state", "pr_createdAt": "2020-12-13T08:01:27Z", "pr_url": "https://github.com/seata/seata/pull/3367", "timeline": [{"oid": "75c4f394483ccd7b149bc40494a3f1f122a0a99f", "url": "https://github.com/seata/seata/commit/75c4f394483ccd7b149bc40494a3f1f122a0a99f", "message": "optimize: last XA branch exception execute xa rolled back", "committedDate": "2020-12-10T12:57:50Z", "type": "commit"}, {"oid": "f6b4040b5f7be2f5e7c841eb57adb0bafbd9e317", "url": "https://github.com/seata/seata/commit/f6b4040b5f7be2f5e7c841eb57adb0bafbd9e317", "message": "optimize code", "committedDate": "2020-12-10T13:01:07Z", "type": "commit"}, {"oid": "f776630dc4ea33872ff6da353f43092271ac5bc5", "url": "https://github.com/seata/seata/commit/f776630dc4ea33872ff6da353f43092271ac5bc5", "message": "optimize code", "committedDate": "2020-12-13T07:52:19Z", "type": "commit"}, {"oid": "1fd8fbf0a2dfbbfb6f8a387e18cf30d5cedbe6c2", "url": "https://github.com/seata/seata/commit/1fd8fbf0a2dfbbfb6f8a387e18cf30d5cedbe6c2", "message": "Merge branch 'develop' of https://github.com/seata/seata into 1210-2", "committedDate": "2020-12-14T08:05:08Z", "type": "commit"}, {"oid": "cf7819e07ea407fae8c068d9c6c90144b8b220d3", "url": "https://github.com/seata/seata/commit/cf7819e07ea407fae8c068d9c6c90144b8b220d3", "message": "Merge branch 'develop' of https://github.com/seata/seata into 1210-2", "committedDate": "2020-12-27T10:00:34Z", "type": "commit"}, {"oid": "4a24821acd0cc0f190fe824a7b418d62ee36d9de", "url": "https://github.com/seata/seata/commit/4a24821acd0cc0f190fe824a7b418d62ee36d9de", "message": "update 1.5.0.md", "committedDate": "2020-12-27T10:03:54Z", "type": "commit"}, {"oid": "c170b676d81b4cf71317e1f9bc5129552ba05cba", "url": "https://github.com/seata/seata/commit/c170b676d81b4cf71317e1f9bc5129552ba05cba", "message": "optimize code", "committedDate": "2020-12-27T10:06:59Z", "type": "commit"}, {"oid": "e64181b7d2b6c8027d48b09e8a7e53368ab4e5b2", "url": "https://github.com/seata/seata/commit/e64181b7d2b6c8027d48b09e8a7e53368ab4e5b2", "message": "update", "committedDate": "2020-12-28T09:54:28Z", "type": "commit"}, {"oid": "0405fff22170031208879fc9ae51e538f36e0a69", "url": "https://github.com/seata/seata/commit/0405fff22170031208879fc9ae51e538f36e0a69", "message": "bug fix", "committedDate": "2020-12-28T09:55:57Z", "type": "commit"}, {"oid": "8642480112697dfac703999d22375241c3eba989", "url": "https://github.com/seata/seata/commit/8642480112697dfac703999d22375241c3eba989", "message": "update", "committedDate": "2020-12-29T03:54:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjM5MTQ3NA==", "url": "https://github.com/seata/seata/pull/3367#discussion_r552391474", "bodyText": "rolled back\uff1f", "author": "slievrly", "createdAt": "2021-01-06T06:21:35Z", "path": "rm-datasource/src/main/java/io/seata/rm/datasource/xa/ConnectionProxyXA.java", "diffHunk": "@@ -201,22 +209,21 @@ public void rollback() throws SQLException {\n         if (!xaActive || this.xaBranchXid == null) {\n             throw new SQLException(\"should NOT rollback on an inactive session\");\n         }\n-        try {\n-            // Branch Report to TC\n-            DefaultResourceManager.get().branchReport(BranchType.XA, xid, xaBranchXid.getBranchId(), BranchStatus.PhaseOne_Failed, null);\n-\n-        } catch (TransactionException te) {\n-            // log and ignore the report failure\n-            LOGGER.warn(\"Failed to report XA branch rollback on \" + xid + \"-\" + xaBranchXid.getBranchId()\n-                + \" since \" + te.getCode() + \":\" + te.getMessage());\n-        }\n         try {\n             // XA End: Fail\n             xaResource.end(xaBranchXid, XAResource.TMFAIL);\n+            xaRollback(xaBranchXid);\n+            // Branch Report to TC\n+            DefaultResourceManager.get().branchReport(BranchType.XA, xid, xaBranchXid.getBranchId(),\n+                BranchStatus.PhaseOne_Failed, null);\n+            LOGGER.info(xaBranchXid + \" was rolled back.\");", "originalCommit": "8642480112697dfac703999d22375241c3eba989", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjQyNTkxNQ==", "url": "https://github.com/seata/seata/pull/3367#discussion_r552425915", "bodyText": "ok", "author": "a364176773", "createdAt": "2021-01-06T08:09:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjM5MTQ3NA=="}], "type": "inlineReview"}, {"oid": "0c239669538853a28a4ca26d61886fe68b7d2f35", "url": "https://github.com/seata/seata/commit/0c239669538853a28a4ca26d61886fe68b7d2f35", "message": "update", "committedDate": "2021-01-06T08:05:21Z", "type": "commit"}, {"oid": "9eccecdb575ce69c51f83c9da87881d7d5ac3175", "url": "https://github.com/seata/seata/commit/9eccecdb575ce69c51f83c9da87881d7d5ac3175", "message": "update", "committedDate": "2021-01-06T09:47:13Z", "type": "commit"}, {"oid": "8e55296c413561aae71aa30f60f1b0bcc9f29b10", "url": "https://github.com/seata/seata/commit/8e55296c413561aae71aa30f60f1b0bcc9f29b10", "message": "update", "committedDate": "2021-01-06T09:48:29Z", "type": "commit"}, {"oid": "80102d041fcf54163e0c01d607e62a4d7d251e16", "url": "https://github.com/seata/seata/commit/80102d041fcf54163e0c01d607e62a4d7d251e16", "message": "Update 1.5.0.md", "committedDate": "2021-01-10T14:23:46Z", "type": "commit"}, {"oid": "80102d041fcf54163e0c01d607e62a4d7d251e16", "url": "https://github.com/seata/seata/commit/80102d041fcf54163e0c01d607e62a4d7d251e16", "message": "Update 1.5.0.md", "committedDate": "2021-01-10T14:23:46Z", "type": "forcePushed"}, {"oid": "87bf54afa5497e05f64e7a289da2a4d5e978971a", "url": "https://github.com/seata/seata/commit/87bf54afa5497e05f64e7a289da2a4d5e978971a", "message": "update", "committedDate": "2021-01-10T14:30:37Z", "type": "commit"}, {"oid": "a6c92acf0544bae1df584f2dc18fe3e05a1a3b44", "url": "https://github.com/seata/seata/commit/a6c92acf0544bae1df584f2dc18fe3e05a1a3b44", "message": "Merge branch 'develop' into 1210-2", "committedDate": "2021-02-04T06:10:59Z", "type": "commit"}]}