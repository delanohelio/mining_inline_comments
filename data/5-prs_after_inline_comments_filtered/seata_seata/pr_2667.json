{"pr_number": 2667, "pr_title": "feature: support password decryption", "pr_createdAt": "2020-05-09T02:16:02Z", "pr_url": "https://github.com/seata/seata/pull/2667", "timeline": [{"oid": "3936a730e250c386076bad461c542b6396f31f4c", "url": "https://github.com/seata/seata/commit/3936a730e250c386076bad461c542b6396f31f4c", "message": "support druid encryption and decryption", "committedDate": "2020-05-09T02:12:14Z", "type": "commit"}, {"oid": "7d5d66ba55007ad33ee3c91c36f3284c25f8ad32", "url": "https://github.com/seata/seata/commit/7d5d66ba55007ad33ee3c91c36f3284c25f8ad32", "message": "bug fix", "committedDate": "2020-05-09T02:15:21Z", "type": "commit"}, {"oid": "fc08334f2722e1402f9b8b0b73c51e489acfa67a", "url": "https://github.com/seata/seata/commit/fc08334f2722e1402f9b8b0b73c51e489acfa67a", "message": "bug fix", "committedDate": "2020-05-09T02:18:21Z", "type": "commit"}, {"oid": "8bf4a8376cb63574adb913c220c42495255f572f", "url": "https://github.com/seata/seata/commit/8bf4a8376cb63574adb913c220c42495255f572f", "message": "rollback code", "committedDate": "2020-05-09T02:22:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzMwMzM5Mw==", "url": "https://github.com/seata/seata/pull/2667#discussion_r443303393", "bodyText": "if the filter is necessary?", "author": "slievrly", "createdAt": "2020-06-22T03:42:40Z", "path": "server/src/main/java/io/seata/server/store/DruidDataSourceGenerator.java", "diffHunk": "@@ -29,13 +38,30 @@\n  */\n @LoadLevel(name = \"druid\")\n public class DruidDataSourceGenerator extends AbstractDataSourceGenerator {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(DruidDataSourceGenerator.class);\n+\n     @Override\n     public DataSource generateDataSource() {\n         DruidDataSource ds = new DruidDataSource();\n         ds.setDriverClassName(getDriverClassName());\n         ds.setDriverClassLoader(getDriverClassLoader());\n         ds.setUrl(getUrl());\n         ds.setUsername(getUser());\n+        String publicKey = getPublicKey();\n+        if (StringUtils.isNotBlank(publicKey)) {\n+            try {\n+                ds.setFilters(\"config\");", "originalCommit": "8bf4a8376cb63574adb913c220c42495255f572f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM3NDg4Mw==", "url": "https://github.com/seata/seata/pull/2667#discussion_r443374883", "bodyText": "if the filter is necessary?\n\nok", "author": "a364176773", "createdAt": "2020-06-22T07:48:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzMwMzM5Mw=="}], "type": "inlineReview"}, {"oid": "8a02e3e910a0ec855bb99b17c1e7cb0f63dab826", "url": "https://github.com/seata/seata/commit/8a02e3e910a0ec855bb99b17c1e7cb0f63dab826", "message": "modify code logic", "committedDate": "2020-06-23T14:49:21Z", "type": "commit"}, {"oid": "219708e1252ed1d4237aeb7a40e3388db69d8c5a", "url": "https://github.com/seata/seata/commit/219708e1252ed1d4237aeb7a40e3388db69d8c5a", "message": "rollback code", "committedDate": "2020-06-23T14:52:28Z", "type": "commit"}, {"oid": "049cc3f62d7832b1e3c49b8e31cdb77b68ff151d", "url": "https://github.com/seata/seata/commit/049cc3f62d7832b1e3c49b8e31cdb77b68ff151d", "message": "rollback code", "committedDate": "2020-06-23T14:54:10Z", "type": "commit"}, {"oid": "f35a0177973fddfa632246c2d44c69448d767c3c", "url": "https://github.com/seata/seata/commit/f35a0177973fddfa632246c2d44c69448d767c3c", "message": "support database password decryption", "committedDate": "2020-06-27T07:27:58Z", "type": "commit"}, {"oid": "85c85d695e1a3d77efc0c12ba8140d44b0917058", "url": "https://github.com/seata/seata/commit/85c85d695e1a3d77efc0c12ba8140d44b0917058", "message": "Merge branch 'develop' into druid_public_key", "committedDate": "2020-06-27T09:28:35Z", "type": "commit"}, {"oid": "496b4264467b553a50c2caa3a58302b26617d4bd", "url": "https://github.com/seata/seata/commit/496b4264467b553a50c2caa3a58302b26617d4bd", "message": "remove only druid", "committedDate": "2020-06-27T09:30:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUzOTY2OQ==", "url": "https://github.com/seata/seata/pull/2667#discussion_r446539669", "bodyText": "The error log does not need to add this judgment.", "author": "slievrly", "createdAt": "2020-06-27T15:51:03Z", "path": "core/src/main/java/io/seata/core/store/db/AbstractDataSourceProvider.java", "diffHunk": "@@ -195,6 +202,18 @@ protected String getUser() {\n      */\n     protected String getPassword() {\n         String password = CONFIG.getConfig(ConfigurationKeys.STORE_DB_PASSWORD);\n+        String publicKey = getPublicKey();\n+        if (StringUtils.isNotBlank(publicKey)) {\n+            try {\n+                password = ConfigTools.decrypt(publicKey, password);\n+            } catch (Exception e) {\n+                if (LOGGER.isErrorEnabled()) {", "originalCommit": "496b4264467b553a50c2caa3a58302b26617d4bd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1NTk5Mg==", "url": "https://github.com/seata/seata/pull/2667#discussion_r446655992", "bodyText": "ok", "author": "a364176773", "createdAt": "2020-06-28T14:11:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUzOTY2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4Nzc4NA==", "url": "https://github.com/seata/seata/pull/2667#discussion_r446587784", "bodyText": "KER or KEY?", "author": "l81893521", "createdAt": "2020-06-28T01:40:56Z", "path": "core/src/main/java/io/seata/core/constants/ConfigurationKeys.java", "diffHunk": "@@ -229,6 +229,11 @@\n      */\n     public static final String STORE_DB_LOG_QUERY_LIMIT = STORE_DB_PREFIX + \"queryLimit\";\n \n+    /**\n+     * The constant STORE_DB_PUBLIC_KER.\n+     */\n+    public static final String STORE_DB_PUBLIC_KER = STORE_DB_PREFIX + \"publicKey\";", "originalCommit": "496b4264467b553a50c2caa3a58302b26617d4bd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1NTk4OQ==", "url": "https://github.com/seata/seata/pull/2667#discussion_r446655989", "bodyText": "ok", "author": "a364176773", "createdAt": "2020-06-28T14:11:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4Nzc4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU5MTQyOQ==", "url": "https://github.com/seata/seata/pull/2667#discussion_r446591429", "bodyText": "ConfigTools is the class of druid. Is any problem when use other? And this is the abstract class, I think you should override the method of\ngetPassword()", "author": "l81893521", "createdAt": "2020-06-28T02:37:52Z", "path": "core/src/main/java/io/seata/core/store/db/AbstractDataSourceProvider.java", "diffHunk": "@@ -195,6 +202,18 @@ protected String getUser() {\n      */\n     protected String getPassword() {\n         String password = CONFIG.getConfig(ConfigurationKeys.STORE_DB_PASSWORD);\n+        String publicKey = getPublicKey();\n+        if (StringUtils.isNotBlank(publicKey)) {\n+            try {\n+                password = ConfigTools.decrypt(publicKey, password);", "originalCommit": "496b4264467b553a50c2caa3a58302b26617d4bd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1NTk3Ng==", "url": "https://github.com/seata/seata/pull/2667#discussion_r446655976", "bodyText": "ok", "author": "a364176773", "createdAt": "2020-06-28T14:11:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU5MTQyOQ=="}], "type": "inlineReview"}, {"oid": "49c17d54058d8f34cddc71b5c9a62d4980bda14f", "url": "https://github.com/seata/seata/commit/49c17d54058d8f34cddc71b5c9a62d4980bda14f", "message": "add rsa encryption and decryption function", "committedDate": "2020-06-28T14:07:47Z", "type": "commit"}, {"oid": "14141b109fe3a76b906b92e422ba9de3ec1e8989", "url": "https://github.com/seata/seata/commit/14141b109fe3a76b906b92e422ba9de3ec1e8989", "message": "optimize code", "committedDate": "2020-06-28T14:11:56Z", "type": "commit"}, {"oid": "432b42520f63c61eda33f23c0fd27db700a764cf", "url": "https://github.com/seata/seata/commit/432b42520f63c61eda33f23c0fd27db700a764cf", "message": "Merge branch 'develop' into druid_public_key", "committedDate": "2020-06-28T14:12:39Z", "type": "commit"}, {"oid": "195ccf327c9a44c397c40303189247a1980b5887", "url": "https://github.com/seata/seata/commit/195ccf327c9a44c397c40303189247a1980b5887", "message": "add comment", "committedDate": "2020-06-28T14:22:58Z", "type": "commit"}, {"oid": "a3b347bc0de8eb43e24a5b4fd9e416fef82c6da6", "url": "https://github.com/seata/seata/commit/a3b347bc0de8eb43e24a5b4fd9e416fef82c6da6", "message": "Merge branch 'druid_public_key' of github.com:a364176773/seata into druid_public_key", "committedDate": "2020-06-28T14:24:16Z", "type": "commit"}, {"oid": "69f9b82b5cda47859c50680273e98d92f3a8771a", "url": "https://github.com/seata/seata/commit/69f9b82b5cda47859c50680273e98d92f3a8771a", "message": "optimize code", "committedDate": "2020-06-29T14:18:31Z", "type": "commit"}, {"oid": "51265d5f7a18f13737ee7fd5680232b5dd21b213", "url": "https://github.com/seata/seata/commit/51265d5f7a18f13737ee7fd5680232b5dd21b213", "message": "test", "committedDate": "2020-06-29T14:45:11Z", "type": "commit"}, {"oid": "c2424e23d394e8bd814563543be66c00d19a08d1", "url": "https://github.com/seata/seata/commit/c2424e23d394e8bd814563543be66c00d19a08d1", "message": "optimize code", "committedDate": "2020-06-29T14:52:34Z", "type": "commit"}, {"oid": "57729ebce7da9a6adb5e9fc8efdca52c77adbab9", "url": "https://github.com/seata/seata/commit/57729ebce7da9a6adb5e9fc8efdca52c77adbab9", "message": "optimize code", "committedDate": "2020-06-29T15:01:18Z", "type": "commit"}, {"oid": "f7876534d1bf76256cd893e7ca55bf7d4095bf6d", "url": "https://github.com/seata/seata/commit/f7876534d1bf76256cd893e7ca55bf7d4095bf6d", "message": "optimize code", "committedDate": "2020-06-29T15:07:07Z", "type": "commit"}, {"oid": "5b8ee3f817a694f8f24b33beb8b5b4733b10bd34", "url": "https://github.com/seata/seata/commit/5b8ee3f817a694f8f24b33beb8b5b4733b10bd34", "message": "excludes io.seata.common.util", "committedDate": "2020-06-29T15:12:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQwMDA1OQ==", "url": "https://github.com/seata/seata/pull/2667#discussion_r449400059", "bodyText": "use java.util.Base64", "author": "jsbxyyx", "createdAt": "2020-07-03T06:32:22Z", "path": "common/src/main/java/io/seata/common/util/ConfigTools.java", "diffHunk": "@@ -0,0 +1,147 @@\n+/*\n+ *  Copyright 1999-2019 Seata.io Group.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package io.seata.common.util;\n+\n+import java.io.IOException;\n+import java.security.KeyFactory;\n+import java.security.KeyPair;\n+import java.security.KeyPairGenerator;\n+import java.security.PrivateKey;\n+import java.security.PublicKey;\n+import java.security.spec.PKCS8EncodedKeySpec;\n+import java.security.spec.X509EncodedKeySpec;\n+import java.util.Scanner;\n+\n+import javax.crypto.Cipher;\n+\n+import sun.misc.BASE64Decoder;", "originalCommit": "5b8ee3f817a694f8f24b33beb8b5b4733b10bd34", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTYzNjQ2NA==", "url": "https://github.com/seata/seata/pull/2667#discussion_r449636464", "bodyText": "ok", "author": "a364176773", "createdAt": "2020-07-03T15:33:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQwMDA1OQ=="}], "type": "inlineReview"}, {"oid": "454035c184eb2740e474dd5e2fe5f835d69b3c23", "url": "https://github.com/seata/seata/commit/454035c184eb2740e474dd5e2fe5f835d69b3c23", "message": "Merge branch 'develop' into druid_public_key", "committedDate": "2020-07-03T06:32:50Z", "type": "commit"}, {"oid": "292d8a18015a010a66f03db6617023245152447b", "url": "https://github.com/seata/seata/commit/292d8a18015a010a66f03db6617023245152447b", "message": "Merge branch 'develop' into druid_public_key", "committedDate": "2020-07-03T15:33:24Z", "type": "commit"}, {"oid": "b0a9d8a24f0524b47b4801271fb8a1b1b104d714", "url": "https://github.com/seata/seata/commit/b0a9d8a24f0524b47b4801271fb8a1b1b104d714", "message": "optimize code", "committedDate": "2020-07-03T16:04:06Z", "type": "commit"}, {"oid": "29730d36aae7c54ab2ee060d0c176e1b404acb96", "url": "https://github.com/seata/seata/commit/29730d36aae7c54ab2ee060d0c176e1b404acb96", "message": "Merge branch 'druid_public_key' of github.com:a364176773/seata into druid_public_key", "committedDate": "2020-07-03T16:04:38Z", "type": "commit"}, {"oid": "0337eda875cdd157af6a61eb357c62616664a325", "url": "https://github.com/seata/seata/commit/0337eda875cdd157af6a61eb357c62616664a325", "message": "Merge branch 'develop' into druid_public_key", "committedDate": "2020-07-10T09:49:13Z", "type": "commit"}, {"oid": "0a4edbf53a820ecd118e637b1eae8cfce0b73186", "url": "https://github.com/seata/seata/commit/0a4edbf53a820ecd118e637b1eae8cfce0b73186", "message": "Merge branch 'develop' into druid_public_key", "committedDate": "2020-07-16T02:48:21Z", "type": "commit"}, {"oid": "b8b3e875dc980c3dda083826b57dc0a1d5306161", "url": "https://github.com/seata/seata/commit/b8b3e875dc980c3dda083826b57dc0a1d5306161", "message": "Merge branch 'develop' into druid_public_key", "committedDate": "2020-07-17T13:26:23Z", "type": "commit"}, {"oid": "9aed4bddd284d4cc9ec8ab2c9a55acfb6020cef9", "url": "https://github.com/seata/seata/commit/9aed4bddd284d4cc9ec8ab2c9a55acfb6020cef9", "message": "optimize code", "committedDate": "2020-07-20T15:12:41Z", "type": "commit"}, {"oid": "25dfd57333736cf199ac0e66a88e2646b9b0f63a", "url": "https://github.com/seata/seata/commit/25dfd57333736cf199ac0e66a88e2646b9b0f63a", "message": "test", "committedDate": "2020-07-20T15:15:26Z", "type": "commit"}, {"oid": "21c2a0de840f31699f2c36b8758fc05521f0edbd", "url": "https://github.com/seata/seata/commit/21c2a0de840f31699f2c36b8758fc05521f0edbd", "message": "Merge branch 'develop' into druid_public_key", "committedDate": "2020-07-24T10:13:11Z", "type": "commit"}, {"oid": "ddcddd1a8cf0fd95a5bb2841c9d1a3728f873105", "url": "https://github.com/seata/seata/commit/ddcddd1a8cf0fd95a5bb2841c9d1a3728f873105", "message": "Merge branch 'develop' into druid_public_key", "committedDate": "2020-07-28T08:10:02Z", "type": "commit"}, {"oid": "d6bef52f755d7bc9f1590f8efba72e165d11dc81", "url": "https://github.com/seata/seata/commit/d6bef52f755d7bc9f1590f8efba72e165d11dc81", "message": "Merge branch 'develop' into druid_public_key", "committedDate": "2020-08-06T13:14:35Z", "type": "commit"}, {"oid": "faca98f46a7d358f354a086ed75f563053742ae7", "url": "https://github.com/seata/seata/commit/faca98f46a7d358f354a086ed75f563053742ae7", "message": "support redis decryption", "committedDate": "2020-08-06T15:04:05Z", "type": "commit"}, {"oid": "90aa285434b4f9776ebb119ee56ac3f7baa282ca", "url": "https://github.com/seata/seata/commit/90aa285434b4f9776ebb119ee56ac3f7baa282ca", "message": "merge", "committedDate": "2020-08-07T05:40:26Z", "type": "commit"}, {"oid": "662ff130b992e5d1e978e4118afea2e174e5609f", "url": "https://github.com/seata/seata/commit/662ff130b992e5d1e978e4118afea2e174e5609f", "message": "Merge branch 'develop' into druid_public_key", "committedDate": "2020-08-24T05:59:36Z", "type": "commit"}, {"oid": "e343b38947cb82238be085fd904bcb67e90f3ac8", "url": "https://github.com/seata/seata/commit/e343b38947cb82238be085fd904bcb67e90f3ac8", "message": "Merge branch 'develop' into druid_public_key", "committedDate": "2020-09-14T15:23:40Z", "type": "commit"}, {"oid": "8c0a7402a1d124ce40bec92682a6ebc4ea480627", "url": "https://github.com/seata/seata/commit/8c0a7402a1d124ce40bec92682a6ebc4ea480627", "message": "merge", "committedDate": "2020-09-29T03:23:57Z", "type": "commit"}, {"oid": "4483ed4085ba4ff5ff6e455ea6a830757fb965a1", "url": "https://github.com/seata/seata/commit/4483ed4085ba4ff5ff6e455ea6a830757fb965a1", "message": "Merge branch 'develop' into druid_public_key", "committedDate": "2020-10-02T17:29:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjgwNzg2Mw==", "url": "https://github.com/seata/seata/pull/2667#discussion_r502807863", "bodyText": "\u8fd9\u4e2a\u7c7b\u91cc\u9762\u7684\u4e00\u4e9b\u65b9\u6cd5\u5176\u5b9e\u662f\u4e0d\u4f1a\u629b\u51fa\u5f02\u5e38\u7684\uff0c\u6bd4\u5982getKeyPair\uff1b\u9664\u6b64\u4e4b\u5916\uff0c\u5176\u4ed6\u6709\u8dd1\u5f02\u5e38\u7684\u65b9\u6cd5\uff0c\u611f\u89c9\u90fd\u53ef\u4ee5\u8f6c\u6362\u6210ShouldNeverHappenException\n\u7136\u540e\u8fd8\u6709 \"RSA\", \"UTF-8\"\u611f\u89c9\u6539\u6210\u5e38\u91cf\u4f1a\u597d\u70b9 StandardCharsets.UTF_8", "author": "caohdgege", "createdAt": "2020-10-10T16:32:57Z", "path": "common/src/main/java/io/seata/common/util/ConfigTools.java", "diffHunk": "@@ -0,0 +1,141 @@\n+/*\n+ *  Copyright 1999-2019 Seata.io Group.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package io.seata.common.util;\n+\n+import java.security.KeyFactory;\n+import java.security.KeyPair;\n+import java.security.KeyPairGenerator;\n+import java.security.PrivateKey;\n+import java.security.PublicKey;\n+import java.security.spec.PKCS8EncodedKeySpec;\n+import java.security.spec.X509EncodedKeySpec;\n+import java.util.Base64;\n+import java.util.Scanner;\n+import javax.crypto.Cipher;\n+\n+/**\n+ * @author funkye\n+ */\n+public class ConfigTools {", "originalCommit": "4483ed4085ba4ff5ff6e455ea6a830757fb965a1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzQyMDQ2Nw==", "url": "https://github.com/seata/seata/pull/2667#discussion_r507420467", "bodyText": "ok", "author": "a364176773", "createdAt": "2020-10-19T03:49:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjgwNzg2Mw=="}], "type": "inlineReview"}, {"oid": "a9e6dd4bed87a23d25879f690f1d5805fccad657", "url": "https://github.com/seata/seata/commit/a9e6dd4bed87a23d25879f690f1d5805fccad657", "message": "Merge branch 'develop' into druid_public_key", "committedDate": "2020-10-19T03:49:01Z", "type": "commit"}, {"oid": "dd3bad8a6de6defd09a378129bbc391c3f9e6ecf", "url": "https://github.com/seata/seata/commit/dd3bad8a6de6defd09a378129bbc391c3f9e6ecf", "message": "optimize code", "committedDate": "2020-10-19T04:00:31Z", "type": "commit"}, {"oid": "760bb539961d0f191ade1935d866ec0b78f85be3", "url": "https://github.com/seata/seata/commit/760bb539961d0f191ade1935d866ec0b78f85be3", "message": "Merge branch 'develop' into druid_public_key", "committedDate": "2020-10-19T09:49:42Z", "type": "commit"}, {"oid": "58c533db7696be474e413654360e12d20a08f0b9", "url": "https://github.com/seata/seata/commit/58c533db7696be474e413654360e12d20a08f0b9", "message": "Merge branch 'develop' into druid_public_key", "committedDate": "2020-10-21T03:47:41Z", "type": "commit"}, {"oid": "9c68f589cac1b2b51e29dc758e776e00560a86e3", "url": "https://github.com/seata/seata/commit/9c68f589cac1b2b51e29dc758e776e00560a86e3", "message": "Merge branch 'develop' into druid_public_key", "committedDate": "2020-11-07T06:28:14Z", "type": "commit"}, {"oid": "41f6e42be719d9cb77c47f211ee4655c532d8f14", "url": "https://github.com/seata/seata/commit/41f6e42be719d9cb77c47f211ee4655c532d8f14", "message": "Merge branch 'develop' into druid_public_key", "committedDate": "2020-11-22T12:22:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTExMDE3OQ==", "url": "https://github.com/seata/seata/pull/2667#discussion_r529110179", "bodyText": "please remove the main", "author": "l81893521", "createdAt": "2020-11-24T01:32:04Z", "path": "common/src/main/java/io/seata/common/util/ConfigTools.java", "diffHunk": "@@ -0,0 +1,142 @@\n+/*\n+ *  Copyright 1999-2019 Seata.io Group.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package io.seata.common.util;\n+\n+import java.nio.charset.StandardCharsets;\n+import java.security.KeyFactory;\n+import java.security.KeyPair;\n+import java.security.KeyPairGenerator;\n+import java.security.PrivateKey;\n+import java.security.PublicKey;\n+import java.security.spec.PKCS8EncodedKeySpec;\n+import java.security.spec.X509EncodedKeySpec;\n+import java.util.Base64;\n+import java.util.Scanner;\n+import javax.crypto.Cipher;\n+\n+/**\n+ * @author funkye\n+ */\n+public class ConfigTools {\n+\n+    // generate key pair\n+    public static KeyPair getKeyPair() throws Exception {\n+        KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance(\"RSA\");\n+        keyPairGenerator.initialize(2048);\n+        KeyPair keyPair = keyPairGenerator.generateKeyPair();\n+        return keyPair;\n+    }\n+\n+    // obtain the public key (Base64 encoding)\n+    public static String getPublicKey(KeyPair keyPair) {\n+        PublicKey publicKey = keyPair.getPublic();\n+        byte[] bytes = publicKey.getEncoded();\n+        return byte2Base64(bytes);\n+    }\n+\n+    // obtain the private key (Base64 encoding)\n+    public static String getPrivateKey(KeyPair keyPair) {\n+        PrivateKey privateKey = keyPair.getPrivate();\n+        byte[] bytes = privateKey.getEncoded();\n+        return byte2Base64(bytes);\n+    }\n+\n+    // convert Base64 encoded public key to PublicKey object\n+    public static PublicKey string2PublicKey(String pubStr) throws Exception {\n+        byte[] keyBytes = base642Byte(pubStr);\n+        X509EncodedKeySpec keySpec = new X509EncodedKeySpec(keyBytes);\n+        KeyFactory keyFactory = KeyFactory.getInstance(\"RSA\");\n+        PublicKey publicKey = keyFactory.generatePublic(keySpec);\n+        return publicKey;\n+    }\n+\n+    // convert Base64 encoded private key to PrivateKey object\n+    public static PrivateKey string2PrivateKey(String priStr) throws Exception {\n+        byte[] keyBytes = base642Byte(priStr);\n+        PKCS8EncodedKeySpec keySpec = new PKCS8EncodedKeySpec(keyBytes);\n+        KeyFactory keyFactory = KeyFactory.getInstance(\"RSA\");\n+        PrivateKey privateKey = keyFactory.generatePrivate(keySpec);\n+        return privateKey;\n+    }\n+\n+    // public key encryption\n+    public static String publicEncrypt(String content, String pubStr) throws Exception {\n+        PublicKey publicKey = string2PublicKey(pubStr);\n+        Cipher cipher = Cipher.getInstance(\"RSA\");\n+        cipher.init(Cipher.ENCRYPT_MODE, publicKey);\n+        byte[] bytes = cipher.doFinal(content.getBytes());\n+        return byte2Base64(bytes);\n+    }\n+\n+    // public key decryption\n+    public static String publicDecrypt(String content, String pubStr) throws Exception {\n+        PublicKey publicKey = string2PublicKey(pubStr);\n+        Cipher cipher = Cipher.getInstance(\"RSA\");\n+        cipher.init(Cipher.DECRYPT_MODE, publicKey);\n+        byte[] bytes = cipher.doFinal(base642Byte(content));\n+        return new String(bytes, StandardCharsets.UTF_8);\n+    }\n+\n+    // private key encryption\n+    public static String privateEncrypt(String content, String priStr) throws Exception {\n+        PrivateKey privateKey = string2PrivateKey(priStr);\n+        Cipher cipher = Cipher.getInstance(\"RSA\");\n+        cipher.init(Cipher.ENCRYPT_MODE, privateKey);\n+        byte[] bytes = cipher.doFinal(content.getBytes());\n+        return byte2Base64(bytes);\n+    }\n+\n+    // private key decryption\n+    public static String privateDecrypt(String content, String priStr) throws Exception {\n+        PrivateKey privateKey = string2PrivateKey(priStr);\n+        Cipher cipher = Cipher.getInstance(\"RSA\");\n+        cipher.init(Cipher.DECRYPT_MODE, privateKey);\n+        byte[] bytes = cipher.doFinal(base642Byte(content));\n+        return new String(bytes, StandardCharsets.UTF_8);\n+    }\n+\n+    // byte array to Base64 encoding\n+    public static String byte2Base64(byte[] bytes) {\n+        return new String(Base64.getEncoder().encode(bytes), StandardCharsets.UTF_8);\n+    }\n+\n+    // Base64 encoding to byte array\n+    public static byte[] base642Byte(String base64Key) {\n+        return Base64.getDecoder().decode(base64Key);\n+    }\n+\n+    public static void main(String[] args) throws Exception {", "originalCommit": "41f6e42be719d9cb77c47f211ee4655c532d8f14", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "be8022ff5e1c23979ee68735bc67b64bec3e55a1", "url": "https://github.com/seata/seata/commit/be8022ff5e1c23979ee68735bc67b64bec3e55a1", "message": "Merge branch 'develop' into druid_public_key", "committedDate": "2020-11-24T09:01:26Z", "type": "commit"}, {"oid": "01a51c83f67f1d8bfda27c9c591846ee3da05ff8", "url": "https://github.com/seata/seata/commit/01a51c83f67f1d8bfda27c9c591846ee3da05ff8", "message": "update", "committedDate": "2020-12-30T02:48:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTk0MzM3OQ==", "url": "https://github.com/seata/seata/pull/2667#discussion_r549943379", "bodyText": "password is null string. ignore?", "author": "jsbxyyx", "createdAt": "2020-12-30T05:51:54Z", "path": "server/src/main/java/io/seata/server/storage/redis/JedisPooledFactory.java", "diffHunk": "@@ -74,8 +77,19 @@ public static JedisPoolAbstract getJedisPoolInstance(JedisPoolAbstract... jedisP\n                         jedisPool = jedisPools[0];\n                     } else {\n                         String password = CONFIGURATION.getConfig(ConfigurationKeys.STORE_REDIS_PASSWORD);\n-                        if (StringUtils.isBlank(password)) {\n+                        if (StringUtils.isBlank(password) || StringUtils.equalsIgnoreCase(password, DEFAULT_PASSWORD)) {", "originalCommit": "01a51c83f67f1d8bfda27c9c591846ee3da05ff8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTk0OTkyMw==", "url": "https://github.com/seata/seata/pull/2667#discussion_r549949923", "bodyText": "done", "author": "a364176773", "createdAt": "2020-12-30T06:30:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTk0MzM3OQ=="}], "type": "inlineReview"}, {"oid": "268e12b1f6e5198560df7d207b2f20f4318babfd", "url": "https://github.com/seata/seata/commit/268e12b1f6e5198560df7d207b2f20f4318babfd", "message": "update", "committedDate": "2020-12-30T06:29:01Z", "type": "commit"}]}