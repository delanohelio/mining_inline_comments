{"pr_number": 2200, "pr_title": "feature: support postgresql(client and server)", "pr_createdAt": "2020-01-18T05:33:58Z", "pr_url": "https://github.com/seata/seata/pull/2200", "timeline": [{"oid": "b312adffa3a6f62e606402390ad26eb00bd67810", "url": "https://github.com/seata/seata/commit/b312adffa3a6f62e606402390ad26eb00bd67810", "message": "Merge remote-tracking branch 'remotes/origin/postgresql' into develop\n\n# Conflicts:\n#\trm-datasource/src/main/java/io/seata/rm/datasource/AsyncWorker.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/sql/struct/cache/PostgresqlTableMetaCache.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/oracle/OracleUndoLogManager.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/postgresql/PostgresqlUndoLogManager.java", "committedDate": "2020-02-11T08:50:12Z", "type": "commit"}, {"oid": "cc50b944ec674d1e6a5b173514e6e93f789c7a6b", "url": "https://github.com/seata/seata/commit/cc50b944ec674d1e6a5b173514e6e93f789c7a6b", "message": "checkstyle", "committedDate": "2020-02-11T11:58:51Z", "type": "commit"}, {"oid": "fc0de3c9c17ff0fe791ba1ca84ff4f5c3c09a805", "url": "https://github.com/seata/seata/commit/fc0de3c9c17ff0fe791ba1ca84ff4f5c3c09a805", "message": "restore", "committedDate": "2020-02-11T12:04:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODA0ODA1Ng==", "url": "https://github.com/seata/seata/pull/2200#discussion_r378048056", "bodyText": "why autocommit=false? single sql", "author": "slievrly", "createdAt": "2020-02-12T05:34:56Z", "path": "rm-datasource/src/main/java/io/seata/rm/datasource/AsyncWorker.java", "diffHunk": "@@ -158,6 +158,9 @@ private void doBranchCommits() {\n                         throw new ShouldNeverHappenException(\"Failed to find resource on \" + entry.getKey());\n                     }\n                     conn = dataSourceProxy.getPlainConnection();\n+                    if (conn.getAutoCommit()) {", "originalCommit": "fc0de3c9c17ff0fe791ba1ca84ff4f5c3c09a805", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODA1MTc3OQ==", "url": "https://github.com/seata/seata/pull/2200#discussion_r378051779", "bodyText": "when dataSource autoCommit=false\uff0cmust commit", "author": "jaspercloud", "createdAt": "2020-02-12T05:51:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODA0ODA1Ng=="}], "type": "inlineReview"}, {"oid": "a100678c48fb5fdb0732987ac2c6ef1906f24328", "url": "https://github.com/seata/seata/commit/a100678c48fb5fdb0732987ac2c6ef1906f24328", "message": "when autoCommit=false, manual commit", "committedDate": "2020-02-12T06:15:49Z", "type": "commit"}, {"oid": "537477ca94ec8283fbf243e9170a66dabba4b704", "url": "https://github.com/seata/seata/commit/537477ca94ec8283fbf243e9170a66dabba4b704", "message": "Merge remote-tracking branch 'origin/develop' into develop", "committedDate": "2020-02-12T06:16:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODA2NDkxMA==", "url": "https://github.com/seata/seata/pull/2200#discussion_r378064910", "bodyText": "Can refer to MySQLUndoDeleteExecutor#buildUndoSQL, more concise.", "author": "jsbxyyx", "createdAt": "2020-02-12T06:45:57Z", "path": "rm-datasource/src/main/java/io/seata/rm/datasource/undo/postgresql/PostgresqlUndoDeleteExecutor.java", "diffHunk": "@@ -0,0 +1,90 @@\n+/*\n+ *  Copyright 1999-2019 Seata.io Group.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package io.seata.rm.datasource.undo.postgresql;\n+\n+import io.seata.common.exception.ShouldNeverHappenException;\n+import io.seata.rm.datasource.sql.struct.Field;\n+import io.seata.rm.datasource.sql.struct.KeyType;\n+import io.seata.rm.datasource.sql.struct.Row;\n+import io.seata.rm.datasource.sql.struct.TableRecords;\n+import io.seata.rm.datasource.undo.AbstractUndoExecutor;\n+import io.seata.rm.datasource.undo.KeywordChecker;\n+import io.seata.rm.datasource.undo.KeywordCheckerFactory;\n+import io.seata.rm.datasource.undo.SQLUndoLog;\n+import io.seata.sqlparser.util.JdbcConstants;\n+import java.util.List;\n+\n+/**\n+ * The type postgresql undo delete executor.\n+ *\n+ * @author japsercloud\n+ */\n+public class PostgresqlUndoDeleteExecutor extends AbstractUndoExecutor {\n+\n+    /**\n+     * Instantiates a new postgresql undo delete executor.\n+     *\n+     * @param sqlUndoLog the sql undo log\n+     */\n+    public PostgresqlUndoDeleteExecutor(SQLUndoLog sqlUndoLog) {\n+        super(sqlUndoLog);\n+    }\n+\n+    @Override\n+    protected String buildUndoSQL() {", "originalCommit": "537477ca94ec8283fbf243e9170a66dabba4b704", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE5NjY4Mw==", "url": "https://github.com/seata/seata/pull/2200#discussion_r378196683", "bodyText": "fix", "author": "jaspercloud", "createdAt": "2020-02-12T11:34:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODA2NDkxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODA2NjQ1OQ==", "url": "https://github.com/seata/seata/pull/2200#discussion_r378066459", "bodyText": "Can refer to MySQLUndoInsertExecutor#buildUndoSQL, more concise.", "author": "jsbxyyx", "createdAt": "2020-02-12T06:51:19Z", "path": "rm-datasource/src/main/java/io/seata/rm/datasource/undo/postgresql/PostgresqlUndoInsertExecutor.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ *  Copyright 1999-2019 Seata.io Group.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package io.seata.rm.datasource.undo.postgresql;\n+\n+import io.seata.common.exception.ShouldNeverHappenException;\n+import io.seata.rm.datasource.sql.struct.Field;\n+import io.seata.rm.datasource.sql.struct.KeyType;\n+import io.seata.rm.datasource.sql.struct.Row;\n+import io.seata.rm.datasource.sql.struct.TableRecords;\n+import io.seata.rm.datasource.undo.AbstractUndoExecutor;\n+import io.seata.rm.datasource.undo.KeywordChecker;\n+import io.seata.rm.datasource.undo.KeywordCheckerFactory;\n+import io.seata.rm.datasource.undo.SQLUndoLog;\n+import io.seata.sqlparser.util.JdbcConstants;\n+import java.sql.PreparedStatement;\n+import java.sql.SQLException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+/**\n+ * The type postgresql undo insert executor.\n+ *\n+ * @author japsercloud\n+ */\n+public class PostgresqlUndoInsertExecutor extends AbstractUndoExecutor {\n+\n+    @Override\n+    protected String buildUndoSQL() {", "originalCommit": "537477ca94ec8283fbf243e9170a66dabba4b704", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE5NjcyMg==", "url": "https://github.com/seata/seata/pull/2200#discussion_r378196722", "bodyText": "fix", "author": "jaspercloud", "createdAt": "2020-02-12T11:35:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODA2NjQ1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODA2Njc0Nw==", "url": "https://github.com/seata/seata/pull/2200#discussion_r378066747", "bodyText": "Can refer to MySQLUndoUpdateExecutor#buildUndoSQL, more concise.", "author": "jsbxyyx", "createdAt": "2020-02-12T06:52:11Z", "path": "rm-datasource/src/main/java/io/seata/rm/datasource/undo/postgresql/PostgresqlUndoUpdateExecutor.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ *  Copyright 1999-2019 Seata.io Group.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package io.seata.rm.datasource.undo.postgresql;\n+\n+import io.seata.common.exception.ShouldNeverHappenException;\n+import io.seata.rm.datasource.sql.struct.Field;\n+import io.seata.rm.datasource.sql.struct.KeyType;\n+import io.seata.rm.datasource.sql.struct.Row;\n+import io.seata.rm.datasource.sql.struct.TableRecords;\n+import io.seata.rm.datasource.undo.AbstractUndoExecutor;\n+import io.seata.rm.datasource.undo.KeywordChecker;\n+import io.seata.rm.datasource.undo.KeywordCheckerFactory;\n+import io.seata.rm.datasource.undo.SQLUndoLog;\n+import io.seata.sqlparser.util.JdbcConstants;\n+import java.util.List;\n+\n+/**\n+ * @author japsercloud\n+ */\n+public class PostgresqlUndoUpdateExecutor extends AbstractUndoExecutor {\n+\n+    @Override\n+    protected String buildUndoSQL() {", "originalCommit": "537477ca94ec8283fbf243e9170a66dabba4b704", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE5Njc1Ng==", "url": "https://github.com/seata/seata/pull/2200#discussion_r378196756", "bodyText": "fix", "author": "jaspercloud", "createdAt": "2020-02-12T11:35:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODA2Njc0Nw=="}], "type": "inlineReview"}, {"oid": "19d186a22fd03129c7ffa5fba42225461d9f3b33", "url": "https://github.com/seata/seata/commit/19d186a22fd03129c7ffa5fba42225461d9f3b33", "message": "Merge branch 'develop' into develop", "committedDate": "2020-02-12T09:42:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE0MDI2MA==", "url": "https://github.com/seata/seata/pull/2200#discussion_r378140260", "bodyText": "why toLowerCase?", "author": "jsbxyyx", "createdAt": "2020-02-12T09:47:33Z", "path": "rm-datasource/src/main/java/io/seata/rm/datasource/sql/struct/cache/PostgresqlTableMetaCache.java", "diffHunk": "@@ -0,0 +1,179 @@\n+/*\n+ *  Copyright 1999-2019 Seata.io Group.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package io.seata.rm.datasource.sql.struct.cache;\n+\n+import io.seata.common.exception.ShouldNeverHappenException;\n+import io.seata.common.loader.LoadLevel;\n+import io.seata.common.util.StringUtils;\n+import io.seata.rm.datasource.sql.struct.ColumnMeta;\n+import io.seata.rm.datasource.sql.struct.IndexMeta;\n+import io.seata.rm.datasource.sql.struct.IndexType;\n+import io.seata.rm.datasource.sql.struct.TableMeta;\n+import io.seata.rm.datasource.undo.KeywordChecker;\n+import io.seata.rm.datasource.undo.KeywordCheckerFactory;\n+import io.seata.sqlparser.util.JdbcConstants;\n+\n+import java.sql.Connection;\n+import java.sql.DatabaseMetaData;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.sql.Statement;\n+\n+/**\n+ * The type Table meta cache.\n+ *\n+ * @author jaspercloud\n+ */\n+@LoadLevel(name = JdbcConstants.POSTGRESQL)\n+public class PostgresqlTableMetaCache extends AbstractTableMetaCache {\n+\n+    private static KeywordChecker keywordChecker = KeywordCheckerFactory.getKeywordChecker(JdbcConstants.POSTGRESQL);\n+\n+    @Override\n+    protected String getCacheKey(Connection connection, String tableName, String resourceId) {\n+        StringBuilder cacheKey = new StringBuilder(resourceId);\n+        cacheKey.append(\".\");\n+\n+        //separate it to schemaName and tableName\n+        String[] tableNameWithSchema = tableName.split(\"\\\\.\");\n+        String defaultTableName = tableNameWithSchema.length > 1 ? tableNameWithSchema[1] : tableNameWithSchema[0];\n+\n+        //postgres does not implement supportsMixedCaseIdentifiers in DatabaseMetadata\n+        if (defaultTableName.contains(\"\\\"\")) {\n+            cacheKey.append(defaultTableName.replace(\"\\\"\", \"\"));\n+        } else {\n+            //postgres default store in lower case\n+            cacheKey.append(defaultTableName.toLowerCase());\n+        }\n+\n+        return cacheKey.toString();\n+    }\n+\n+    @Override\n+    protected TableMeta fetchSchema(Connection connection, String tableName) throws SQLException {\n+        Statement stmt = null;\n+        try {\n+            stmt = connection.createStatement();\n+            DatabaseMetaData dbmd = connection.getMetaData();\n+            tableName = keywordChecker.checkAndReplace(tableName);\n+            return resultSetMetaToSchema(dbmd, tableName);\n+        } catch (Exception e) {\n+            if (e instanceof SQLException) {\n+                throw e;\n+            }\n+            throw new SQLException(\"Failed to fetch schema of \" + tableName, e);\n+        } finally {\n+            if (stmt != null) {\n+                stmt.close();\n+            }\n+        }\n+    }\n+\n+    private TableMeta resultSetMetaToSchema(DatabaseMetaData dbmd, String tableName) throws SQLException {\n+        TableMeta tm = new TableMeta();\n+        tm.setTableName(tableName);\n+        String[] schemaTable = tableName.split(\"\\\\.\");\n+        String schemaName = schemaTable.length > 1 ? schemaTable[0] : null;\n+        tableName = schemaTable.length > 1 ? schemaTable[1] : tableName;\n+        if (null != schemaName) {\n+            schemaName = schemaName.replace(\"\\\"\", \"\").toLowerCase();\n+        }\n+        tableName = tableName.replace(\"\\\"\", \"\").toLowerCase();", "originalCommit": "19d186a22fd03129c7ffa5fba42225461d9f3b33", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE5Nzk3MA==", "url": "https://github.com/seata/seata/pull/2200#discussion_r378197970", "bodyText": "fix", "author": "jaspercloud", "createdAt": "2020-02-12T11:37:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE0MDI2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE0MTAzMg==", "url": "https://github.com/seata/seata/pull/2200#discussion_r378141032", "bodyText": "IOUtil.close(rsColumns, rsIndex, rsPrimary);", "author": "jsbxyyx", "createdAt": "2020-02-12T09:48:55Z", "path": "rm-datasource/src/main/java/io/seata/rm/datasource/sql/struct/cache/PostgresqlTableMetaCache.java", "diffHunk": "@@ -0,0 +1,179 @@\n+/*\n+ *  Copyright 1999-2019 Seata.io Group.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package io.seata.rm.datasource.sql.struct.cache;\n+\n+import io.seata.common.exception.ShouldNeverHappenException;\n+import io.seata.common.loader.LoadLevel;\n+import io.seata.common.util.StringUtils;\n+import io.seata.rm.datasource.sql.struct.ColumnMeta;\n+import io.seata.rm.datasource.sql.struct.IndexMeta;\n+import io.seata.rm.datasource.sql.struct.IndexType;\n+import io.seata.rm.datasource.sql.struct.TableMeta;\n+import io.seata.rm.datasource.undo.KeywordChecker;\n+import io.seata.rm.datasource.undo.KeywordCheckerFactory;\n+import io.seata.sqlparser.util.JdbcConstants;\n+\n+import java.sql.Connection;\n+import java.sql.DatabaseMetaData;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.sql.Statement;\n+\n+/**\n+ * The type Table meta cache.\n+ *\n+ * @author jaspercloud\n+ */\n+@LoadLevel(name = JdbcConstants.POSTGRESQL)\n+public class PostgresqlTableMetaCache extends AbstractTableMetaCache {\n+\n+    private static KeywordChecker keywordChecker = KeywordCheckerFactory.getKeywordChecker(JdbcConstants.POSTGRESQL);\n+\n+    @Override\n+    protected String getCacheKey(Connection connection, String tableName, String resourceId) {\n+        StringBuilder cacheKey = new StringBuilder(resourceId);\n+        cacheKey.append(\".\");\n+\n+        //separate it to schemaName and tableName\n+        String[] tableNameWithSchema = tableName.split(\"\\\\.\");\n+        String defaultTableName = tableNameWithSchema.length > 1 ? tableNameWithSchema[1] : tableNameWithSchema[0];\n+\n+        //postgres does not implement supportsMixedCaseIdentifiers in DatabaseMetadata\n+        if (defaultTableName.contains(\"\\\"\")) {\n+            cacheKey.append(defaultTableName.replace(\"\\\"\", \"\"));\n+        } else {\n+            //postgres default store in lower case\n+            cacheKey.append(defaultTableName.toLowerCase());\n+        }\n+\n+        return cacheKey.toString();\n+    }\n+\n+    @Override\n+    protected TableMeta fetchSchema(Connection connection, String tableName) throws SQLException {\n+        Statement stmt = null;\n+        try {\n+            stmt = connection.createStatement();\n+            DatabaseMetaData dbmd = connection.getMetaData();\n+            tableName = keywordChecker.checkAndReplace(tableName);\n+            return resultSetMetaToSchema(dbmd, tableName);\n+        } catch (Exception e) {\n+            if (e instanceof SQLException) {\n+                throw e;\n+            }\n+            throw new SQLException(\"Failed to fetch schema of \" + tableName, e);\n+        } finally {\n+            if (stmt != null) {\n+                stmt.close();\n+            }\n+        }\n+    }\n+\n+    private TableMeta resultSetMetaToSchema(DatabaseMetaData dbmd, String tableName) throws SQLException {\n+        TableMeta tm = new TableMeta();\n+        tm.setTableName(tableName);\n+        String[] schemaTable = tableName.split(\"\\\\.\");\n+        String schemaName = schemaTable.length > 1 ? schemaTable[0] : null;\n+        tableName = schemaTable.length > 1 ? schemaTable[1] : tableName;\n+        if (null != schemaName) {\n+            schemaName = schemaName.replace(\"\\\"\", \"\").toLowerCase();\n+        }\n+        tableName = tableName.replace(\"\\\"\", \"\").toLowerCase();\n+\n+        ResultSet rsColumns = dbmd.getColumns(null, schemaName, tableName, \"%\");\n+        ResultSet rsIndex = dbmd.getIndexInfo(null, schemaName, tableName, false, true);\n+        ResultSet rsPrimary = dbmd.getPrimaryKeys(null, schemaName, tableName);\n+\n+        try {\n+            while (rsColumns.next()) {\n+                ColumnMeta col = new ColumnMeta();\n+                col.setTableCat(rsColumns.getString(\"TABLE_CAT\"));\n+                col.setTableSchemaName(rsColumns.getString(\"TABLE_SCHEM\"));\n+                col.setTableName(rsColumns.getString(\"TABLE_NAME\"));\n+                col.setColumnName(rsColumns.getString(\"COLUMN_NAME\"));\n+                col.setDataType(rsColumns.getInt(\"DATA_TYPE\"));\n+                col.setDataTypeName(rsColumns.getString(\"TYPE_NAME\"));\n+                col.setColumnSize(rsColumns.getInt(\"COLUMN_SIZE\"));\n+                col.setDecimalDigits(rsColumns.getInt(\"DECIMAL_DIGITS\"));\n+                col.setNumPrecRadix(rsColumns.getInt(\"NUM_PREC_RADIX\"));\n+                col.setNullAble(rsColumns.getInt(\"NULLABLE\"));\n+                col.setRemarks(rsColumns.getString(\"REMARKS\"));\n+                col.setColumnDef(rsColumns.getString(\"COLUMN_DEF\"));\n+                col.setSqlDataType(rsColumns.getInt(\"SQL_DATA_TYPE\"));\n+                col.setSqlDatetimeSub(rsColumns.getInt(\"SQL_DATETIME_SUB\"));\n+                col.setCharOctetLength(rsColumns.getInt(\"CHAR_OCTET_LENGTH\"));\n+                col.setOrdinalPosition(rsColumns.getInt(\"ORDINAL_POSITION\"));\n+                col.setIsNullAble(rsColumns.getString(\"IS_NULLABLE\"));\n+                col.setIsAutoincrement(rsColumns.getString(\"IS_AUTOINCREMENT\"));\n+                tm.getAllColumns().put(col.getColumnName(), col);\n+            }\n+\n+            while (rsIndex.next()) {\n+                String indexName = rsIndex.getString(\"INDEX_NAME\");\n+                if (StringUtils.isNullOrEmpty(indexName)) {\n+                    continue;\n+                }\n+                String colName = rsIndex.getString(\"COLUMN_NAME\");\n+                ColumnMeta col = tm.getAllColumns().get(colName);\n+                if (tm.getAllIndexes().containsKey(indexName)) {\n+                    IndexMeta index = tm.getAllIndexes().get(indexName);\n+                    index.getValues().add(col);\n+                } else {\n+                    IndexMeta index = new IndexMeta();\n+                    index.setIndexName(indexName);\n+                    index.setNonUnique(rsIndex.getBoolean(\"NON_UNIQUE\"));\n+                    index.setIndexQualifier(rsIndex.getString(\"INDEX_QUALIFIER\"));\n+                    index.setIndexName(rsIndex.getString(\"INDEX_NAME\"));\n+                    index.setType(rsIndex.getShort(\"TYPE\"));\n+                    index.setOrdinalPosition(rsIndex.getShort(\"ORDINAL_POSITION\"));\n+                    index.setAscOrDesc(rsIndex.getString(\"ASC_OR_DESC\"));\n+                    index.setCardinality(rsIndex.getInt(\"CARDINALITY\"));\n+                    index.getValues().add(col);\n+                    if (!index.isNonUnique()) {\n+                        index.setIndextype(IndexType.UNIQUE);\n+                    } else {\n+                        index.setIndextype(IndexType.NORMAL);\n+                    }\n+                    tm.getAllIndexes().put(indexName, index);\n+\n+                }\n+            }\n+\n+            while (rsPrimary.next()) {\n+                String pkIndexName = rsPrimary.getString(\"PK_NAME\");\n+                if (tm.getAllIndexes().containsKey(pkIndexName)) {\n+                    IndexMeta index = tm.getAllIndexes().get(pkIndexName);\n+                    index.setIndextype(IndexType.PRIMARY);\n+                }\n+            }\n+            if (tm.getAllIndexes().isEmpty()) {\n+                throw new ShouldNeverHappenException(\"Could not found any index in the table: \" + tableName);\n+            }\n+        } finally {\n+            if (rsColumns != null) {\n+                rsColumns.close();\n+            }\n+            if (rsIndex != null) {\n+                rsIndex.close();\n+            }\n+            if (rsPrimary != null) {\n+                rsPrimary.close();", "originalCommit": "19d186a22fd03129c7ffa5fba42225461d9f3b33", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE5NjkxMw==", "url": "https://github.com/seata/seata/pull/2200#discussion_r378196913", "bodyText": "fix", "author": "jaspercloud", "createdAt": "2020-02-12T11:35:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE0MTAzMg=="}], "type": "inlineReview"}, {"oid": "579e4703ddcb4d996fa84e7606e21faf77df7b2a", "url": "https://github.com/seata/seata/commit/579e4703ddcb4d996fa84e7606e21faf77df7b2a", "message": "Merge branch 'develop' into develop", "committedDate": "2020-02-12T10:46:41Z", "type": "commit"}, {"oid": "626c8bfdfdd5f7b964a8d256c5b137fd08f47ece", "url": "https://github.com/seata/seata/commit/626c8bfdfdd5f7b964a8d256c5b137fd08f47ece", "message": "fix pgsql bug", "committedDate": "2020-02-12T11:25:54Z", "type": "commit"}, {"oid": "959ef3821593f5717eaa2bf745324eaa7b5d38e8", "url": "https://github.com/seata/seata/commit/959ef3821593f5717eaa2bf745324eaa7b5d38e8", "message": "Merge remote-tracking branch 'remotes/src/develop' into develop", "committedDate": "2020-02-12T11:26:04Z", "type": "commit"}, {"oid": "2aede61dae9946a078902bcc2b3dab41527a462f", "url": "https://github.com/seata/seata/commit/2aede61dae9946a078902bcc2b3dab41527a462f", "message": "Merge remote-tracking branch 'origin/develop' into develop", "committedDate": "2020-02-12T11:40:14Z", "type": "commit"}, {"oid": "9b15ac47b2e96c32d0bf332141627512f9e7e433", "url": "https://github.com/seata/seata/commit/9b15ac47b2e96c32d0bf332141627512f9e7e433", "message": "feature: support postgresql (#1641)", "committedDate": "2019-11-19T03:10:30Z", "type": "commit"}, {"oid": "719a4d0ed7ee241aafcee8ca81ccecfb81acc785", "url": "https://github.com/seata/seata/commit/719a4d0ed7ee241aafcee8ca81ccecfb81acc785", "message": "Merge remote-tracking branch 'origin/develop' into postgresql\n\n# Conflicts:\n#\tcore/src/main/java/io/seata/core/store/db/LogStoreSqls.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/sql/SQLVisitorFactory.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/UndoExecutorFactory.java", "committedDate": "2019-11-19T03:26:09Z", "type": "commit"}, {"oid": "447e7eef18b1b7cd16186c5630be31c6232d5616", "url": "https://github.com/seata/seata/commit/447e7eef18b1b7cd16186c5630be31c6232d5616", "message": "revert the unnecessary changed code", "committedDate": "2019-11-19T06:40:33Z", "type": "commit"}, {"oid": "8d62ef88bfcd48b18a528590603732438c44b72e", "url": "https://github.com/seata/seata/commit/8d62ef88bfcd48b18a528590603732438c44b72e", "message": "change pom.xml", "committedDate": "2019-11-19T07:04:59Z", "type": "commit"}, {"oid": "eccc52dd51d0dd414936fa023bd839aad0d4f31e", "url": "https://github.com/seata/seata/commit/eccc52dd51d0dd414936fa023bd839aad0d4f31e", "message": "fix typo", "committedDate": "2019-11-19T09:02:40Z", "type": "commit"}, {"oid": "c6912105e61073308a78cef7b8818fa2833bc895", "url": "https://github.com/seata/seata/commit/c6912105e61073308a78cef7b8818fa2833bc895", "message": "Merge remote-tracking branch 'origin/develop' into postgresql\n\n# Conflicts:\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/AbstractUndoLogManager.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/UndoExecutorFactory.java", "committedDate": "2019-11-26T11:29:16Z", "type": "commit"}, {"oid": "ce854abdfc2e24873668334a2ba3df7f4de318d2", "url": "https://github.com/seata/seata/commit/ce854abdfc2e24873668334a2ba3df7f4de318d2", "message": "fix UndoExecutorFactory code conflict", "committedDate": "2019-11-26T11:29:52Z", "type": "commit"}, {"oid": "c5b97c5fa0943611d4542ef5f38412322bdaf3c3", "url": "https://github.com/seata/seata/commit/c5b97c5fa0943611d4542ef5f38412322bdaf3c3", "message": "change code style", "committedDate": "2019-11-26T12:20:25Z", "type": "commit"}, {"oid": "842c76c179b6b9f11816b8b76a4444f2b83cd808", "url": "https://github.com/seata/seata/commit/842c76c179b6b9f11816b8b76a4444f2b83cd808", "message": "add create sequence sql", "committedDate": "2019-11-28T08:04:12Z", "type": "commit"}, {"oid": "e3e13e723d057ce0137ee836f6bbb8460f8be9ac", "url": "https://github.com/seata/seata/commit/e3e13e723d057ce0137ee836f6bbb8460f8be9ac", "message": "create postgre sql spi", "committedDate": "2019-11-28T08:04:46Z", "type": "commit"}, {"oid": "2bbae29e65105e7a1f373f979fb3a85ef3193163", "url": "https://github.com/seata/seata/commit/2bbae29e65105e7a1f373f979fb3a85ef3193163", "message": "abstract getRollbackInfo", "committedDate": "2019-11-29T10:25:01Z", "type": "commit"}, {"oid": "4b1f5f459d22c15deab29d76eab0f2d8e2185c0e", "url": "https://github.com/seata/seata/commit/4b1f5f459d22c15deab29d76eab0f2d8e2185c0e", "message": "postgre sql undo executor spi", "committedDate": "2019-11-29T10:35:40Z", "type": "commit"}, {"oid": "9790f76e8a3722afd96b8cfb72b2ca07e694faa2", "url": "https://github.com/seata/seata/commit/9790f76e8a3722afd96b8cfb72b2ca07e694faa2", "message": "optimize where condition and support exist in postgre sql", "committedDate": "2019-11-29T10:42:21Z", "type": "commit"}, {"oid": "7f802f19415281ba4509fc5bf084003629e0a950", "url": "https://github.com/seata/seata/commit/7f802f19415281ba4509fc5bf084003629e0a950", "message": "fix auto delete undo log", "committedDate": "2019-11-29T11:36:53Z", "type": "commit"}, {"oid": "33b6466ebc25ef50cb55453f3f27cec1024e8d1e", "url": "https://github.com/seata/seata/commit/33b6466ebc25ef50cb55453f3f27cec1024e8d1e", "message": "Merge remote-tracking branch 'origin/develop' into postgresql", "committedDate": "2019-12-02T06:18:39Z", "type": "commit"}, {"oid": "6dc10e5b41066785a6a480254f7c7a52d83cf7ef", "url": "https://github.com/seata/seata/commit/6dc10e5b41066785a6a480254f7c7a52d83cf7ef", "message": "Merge branch 'develop' into postgresql", "committedDate": "2019-12-02T06:57:14Z", "type": "commit"}, {"oid": "2c92421242158d1d5e271a41f6e7e29bee225bfb", "url": "https://github.com/seata/seata/commit/2c92421242158d1d5e271a41f6e7e29bee225bfb", "message": "add unit test", "committedDate": "2019-12-03T06:53:44Z", "type": "commit"}, {"oid": "155cf900fdc066de84cc732b942873b790539f77", "url": "https://github.com/seata/seata/commit/155cf900fdc066de84cc732b942873b790539f77", "message": "Merge remote-tracking branch 'origin/postgresql' into postgresql", "committedDate": "2019-12-03T06:54:05Z", "type": "commit"}, {"oid": "13e2abb7c6c7f2e1c06051ba59466f0ad2e7fa51", "url": "https://github.com/seata/seata/commit/13e2abb7c6c7f2e1c06051ba59466f0ad2e7fa51", "message": "Merge branch 'develop' into postgresql", "committedDate": "2019-12-03T09:05:31Z", "type": "commit"}, {"oid": "1fffc5b18d4cb5da762c830372de6b17f20fe42c", "url": "https://github.com/seata/seata/commit/1fffc5b18d4cb5da762c830372de6b17f20fe42c", "message": "Merge remote-tracking branch 'origin/develop' into postgresql\n\n# Conflicts:\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/KeywordCheckerFactory.java", "committedDate": "2019-12-03T12:31:17Z", "type": "commit"}, {"oid": "cd753b9428ed4b7d9b223f84337280b4cd5a01f3", "url": "https://github.com/seata/seata/commit/cd753b9428ed4b7d9b223f84337280b4cd5a01f3", "message": "remove unused unit test", "committedDate": "2019-12-03T13:07:10Z", "type": "commit"}, {"oid": "fadc423b769c1d4b65557154af2d38a5412d4d8c", "url": "https://github.com/seata/seata/commit/fadc423b769c1d4b65557154af2d38a5412d4d8c", "message": "Merge remote-tracking branch 'origin/postgresql' into postgresql", "committedDate": "2019-12-03T13:07:40Z", "type": "commit"}, {"oid": "0e2f6bac28336d46bcf44a5fc79c07de518b6063", "url": "https://github.com/seata/seata/commit/0e2f6bac28336d46bcf44a5fc79c07de518b6063", "message": "add postgresql keyword checker spi", "committedDate": "2019-12-03T13:08:39Z", "type": "commit"}, {"oid": "637d60155bf5dfb006c60caf1633f2012e2f2661", "url": "https://github.com/seata/seata/commit/637d60155bf5dfb006c60caf1633f2012e2f2661", "message": "Merge remote-tracking branch 'origin/develop' into postgresql", "committedDate": "2019-12-04T02:34:01Z", "type": "commit"}, {"oid": "cc0d376e580e8ecec65ab4cd07315531a0c33a6e", "url": "https://github.com/seata/seata/commit/cc0d376e580e8ecec65ab4cd07315531a0c33a6e", "message": "fix can not get postgre select for update recognizer", "committedDate": "2019-12-04T03:31:24Z", "type": "commit"}, {"oid": "5252a7bee144f5fb56058f0aae2fcd84fc87440e", "url": "https://github.com/seata/seata/commit/5252a7bee144f5fb56058f0aae2fcd84fc87440e", "message": "INSERT_BRANCH_TRANSACTION_POSTGRESQL", "committedDate": "2019-12-04T05:48:03Z", "type": "commit"}, {"oid": "5690c756946f1797b60db42781f102f0d992b887", "url": "https://github.com/seata/seata/commit/5690c756946f1797b60db42781f102f0d992b887", "message": "1.undo_log table DEFAULT nextval('undo_log_seq')\n2.PostgresqlUndoLogManager unsupport \"with\"\n3.BasePostgresqlRecognizer when \"o instanceof Null\"", "committedDate": "2019-12-04T05:59:21Z", "type": "commit"}, {"oid": "7b2b97aa11af96f57cca50f7d52ebb53e163adb5", "url": "https://github.com/seata/seata/commit/7b2b97aa11af96f57cca50f7d52ebb53e163adb5", "message": "format code", "committedDate": "2019-12-04T12:47:18Z", "type": "commit"}, {"oid": "c9c3f7deb92b54caf4b157bf1deb5e25e1eacbf0", "url": "https://github.com/seata/seata/commit/c9c3f7deb92b54caf4b157bf1deb5e25e1eacbf0", "message": "support postgresql (#1987)", "committedDate": "2019-12-04T13:03:36Z", "type": "commit"}, {"oid": "6c9040c81436e42f238b4d75d6e5aff168209e96", "url": "https://github.com/seata/seata/commit/6c9040c81436e42f238b4d75d6e5aff168209e96", "message": "Merge branch 'develop' into postgresql", "committedDate": "2019-12-10T06:12:27Z", "type": "commit"}, {"oid": "95d01041003fdf2552d5e9c6219a35d091d24cc5", "url": "https://github.com/seata/seata/commit/95d01041003fdf2552d5e9c6219a35d091d24cc5", "message": "Merge branch 'develop' into postgresql", "committedDate": "2019-12-24T05:03:41Z", "type": "commit"}, {"oid": "d84c465dd2bb43bd2da910b3acada5d952481621", "url": "https://github.com/seata/seata/commit/d84c465dd2bb43bd2da910b3acada5d952481621", "message": "Merge branch 'develop' into postgresql", "committedDate": "2019-12-26T08:32:23Z", "type": "commit"}, {"oid": "b1607d620ca1a957050aeeb0612371119c680c77", "url": "https://github.com/seata/seata/commit/b1607d620ca1a957050aeeb0612371119c680c77", "message": "Merge branch 'develop' into postgresql", "committedDate": "2019-12-31T07:25:06Z", "type": "commit"}, {"oid": "59d1f59cc645b9545ccd7c05dee486be683f8ece", "url": "https://github.com/seata/seata/commit/59d1f59cc645b9545ccd7c05dee486be683f8ece", "message": "Merge remote-tracking branch 'upstream/postgresql' into postgresql", "committedDate": "2020-01-03T09:38:04Z", "type": "commit"}, {"oid": "8148037a87a57c604331fc874f9cedbe85541b1e", "url": "https://github.com/seata/seata/commit/8148037a87a57c604331fc874f9cedbe85541b1e", "message": "code format\n\nadd getCacheKey", "committedDate": "2020-01-06T07:11:52Z", "type": "commit"}, {"oid": "c35481e15dfd04a176e3a0f5318c32cd1d6441d5", "url": "https://github.com/seata/seata/commit/c35481e15dfd04a176e3a0f5318c32cd1d6441d5", "message": "support PostgreSQL (#2143)", "committedDate": "2020-01-07T06:11:40Z", "type": "commit"}, {"oid": "29834d8be3a5a56a2a3d4f8376d702868ed4964b", "url": "https://github.com/seata/seata/commit/29834d8be3a5a56a2a3d4f8376d702868ed4964b", "message": "Merge remote-tracking branch 'upstream/postgresql' into postgresql", "committedDate": "2020-01-07T08:15:16Z", "type": "commit"}, {"oid": "d642e018540c08a4ba95f1dd3f75b568fa4a6989", "url": "https://github.com/seata/seata/commit/d642e018540c08a4ba95f1dd3f75b568fa4a6989", "message": "Merge remote-tracking branch 'remotes/upstream/develop' into postgresql\n\n# Conflicts:\n#\trm-datasource/src/main/java/io/seata/rm/datasource/DataSourceProxy.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/sql/struct/TableMetaCacheFactory.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/UndoLogManagerFactory.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/mysql/MySQLUndoLogManager.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/oracle/OracleUndoLogManager.java\n#\trm-datasource/src/main/resources/META-INF/services/io.seata.rm.datasource.sql.SQLOperateRecognizerHolder", "committedDate": "2020-01-07T08:39:49Z", "type": "commit"}, {"oid": "f3827d2f1ab8491df4cef81339f1bc30a4d1c4e9", "url": "https://github.com/seata/seata/commit/f3827d2f1ab8491df4cef81339f1bc30a4d1c4e9", "message": "fix conflicting files", "committedDate": "2020-01-07T10:40:20Z", "type": "commit"}, {"oid": "03c8057371c285aeaaba378fdfa3166aec66519c", "url": "https://github.com/seata/seata/commit/03c8057371c285aeaaba378fdfa3166aec66519c", "message": "fix conflicting files", "committedDate": "2020-01-07T11:36:38Z", "type": "commit"}, {"oid": "01ad64190f5a3d7aac7b75662d5f20f54f9f8b2c", "url": "https://github.com/seata/seata/commit/01ad64190f5a3d7aac7b75662d5f20f54f9f8b2c", "message": "support PostgreSQL (#2149)", "committedDate": "2020-01-09T06:46:04Z", "type": "commit"}, {"oid": "e161c2da74c69c238b5b2cd2d7b15c1608777a10", "url": "https://github.com/seata/seata/commit/e161c2da74c69c238b5b2cd2d7b15c1608777a10", "message": "Merge remote-tracking branch 'upstream/postgresql' into postgresql", "committedDate": "2020-01-13T03:16:40Z", "type": "commit"}, {"oid": "f36ec0d384f0b8de85bb87ec236b1e5f92df46c0", "url": "https://github.com/seata/seata/commit/f36ec0d384f0b8de85bb87ec236b1e5f92df46c0", "message": "Merge remote-tracking branch 'upstream/develop' into postgresql\n\n# Conflicts:\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/mysql/MySQLUndoLogManager.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/oracle/OracleUndoLogManager.java", "committedDate": "2020-01-13T06:13:54Z", "type": "commit"}, {"oid": "2511791c60e4317ccc7ae5d0526c0243da94b02d", "url": "https://github.com/seata/seata/commit/2511791c60e4317ccc7ae5d0526c0243da94b02d", "message": "Merge remote-tracking branch 'upstream/develop' into postgresql\n\n# Conflicts:\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/mysql/MySQLUndoLogManager.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/oracle/OracleUndoLogManager.java", "committedDate": "2020-01-13T06:21:57Z", "type": "commit"}, {"oid": "b99dbd88f6e8d57b4c5a528e8bf0ece7cb720eb3", "url": "https://github.com/seata/seata/commit/b99dbd88f6e8d57b4c5a528e8bf0ece7cb720eb3", "message": "support PostgreSQL (#2174)", "committedDate": "2020-01-13T07:32:47Z", "type": "commit"}, {"oid": "8c0b1f9e7bc16cc6dcfe4baf15715b486e22d08c", "url": "https://github.com/seata/seata/commit/8c0b1f9e7bc16cc6dcfe4baf15715b486e22d08c", "message": "POSTGRESQL", "committedDate": "2020-01-13T07:45:02Z", "type": "commit"}, {"oid": "9e8c704ac929faa7a3c202045d136fbea40daa3b", "url": "https://github.com/seata/seata/commit/9e8c704ac929faa7a3c202045d136fbea40daa3b", "message": "Merge remote-tracking branch 'origin/develop' into postgresql\n\n# Conflicts:\n#\trm-datasource/src/main/java/io/seata/rm/datasource/DataSourceProxy.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/PreparedStatementProxy.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/sql/struct/TableMetaCacheFactory.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/UndoLogManagerFactory.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/mysql/MySQLUndoLogManager.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/oracle/OracleUndoLogManager.java\n#\trm-datasource/src/main/resources/META-INF/services/io.seata.rm.datasource.sql.SQLOperateRecognizerHolder\n#\tsqlparser/seata-sqlparser-core/src/main/java/io/seata/sqlparser/util/JdbcConstants.java\n#\tsqlparser/seata-sqlparser-druid/src/main/resources/META-INF/services/io.seata.sqlparser.druid.SQLOperateRecognizerHolder", "committedDate": "2020-01-13T08:54:02Z", "type": "commit"}, {"oid": "81adf022f9c1e1cd795be8a5d8c229bf499979f4", "url": "https://github.com/seata/seata/commit/81adf022f9c1e1cd795be8a5d8c229bf499979f4", "message": "Merge branch 'develop' into postgresql", "committedDate": "2020-01-13T08:59:49Z", "type": "commit"}, {"oid": "3f831a226be39f42fb14596b802b1bbaa6101684", "url": "https://github.com/seata/seata/commit/3f831a226be39f42fb14596b802b1bbaa6101684", "message": "Merge remote-tracking branch 'origin/postgresql' into postgresql\n\n# Conflicts:\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/mysql/MySQLUndoLogManager.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/oracle/OracleUndoLogManager.java\n#\trm-datasource/src/test/java/io/seata/rm/datasource/sql/SQLVisitorFactoryTest.java", "committedDate": "2020-01-13T09:00:30Z", "type": "commit"}, {"oid": "30f903ae941123598e43da67f2b6985d42e2b85d", "url": "https://github.com/seata/seata/commit/30f903ae941123598e43da67f2b6985d42e2b85d", "message": "fix code conflict", "committedDate": "2020-01-13T09:04:52Z", "type": "commit"}, {"oid": "4d479adce34f3506af9818f7fa7a86bd7152fc00", "url": "https://github.com/seata/seata/commit/4d479adce34f3506af9818f7fa7a86bd7152fc00", "message": "Merge branch 'develop' into postgresql", "committedDate": "2020-01-13T09:06:32Z", "type": "commit"}, {"oid": "e3df4b92dc75db322f57ee8aa7fea53ea614f547", "url": "https://github.com/seata/seata/commit/e3df4b92dc75db322f57ee8aa7fea53ea614f547", "message": "Merge remote-tracking branch 'upstream/develop' into postgresql", "committedDate": "2020-01-13T09:07:22Z", "type": "commit"}, {"oid": "0927068732da907f777fe3cba6b89092df5b9254", "url": "https://github.com/seata/seata/commit/0927068732da907f777fe3cba6b89092df5b9254", "message": "merge code", "committedDate": "2020-01-13T09:15:24Z", "type": "commit"}, {"oid": "c7fcc58f7b5da90e2a362b24af959d7bfeea27e1", "url": "https://github.com/seata/seata/commit/c7fcc58f7b5da90e2a362b24af959d7bfeea27e1", "message": "POSTGRESQL", "committedDate": "2020-01-13T09:15:42Z", "type": "commit"}, {"oid": "0e9af25abd1f93779042d4575e066897d3493a39", "url": "https://github.com/seata/seata/commit/0e9af25abd1f93779042d4575e066897d3493a39", "message": "reset", "committedDate": "2020-01-13T09:17:55Z", "type": "commit"}, {"oid": "03dfc4316ea517ce8525a4fda12b7509ee85c269", "url": "https://github.com/seata/seata/commit/03dfc4316ea517ce8525a4fda12b7509ee85c269", "message": "fix ci", "committedDate": "2020-01-13T09:21:48Z", "type": "commit"}, {"oid": "264fad508b4588d2b3b77c071a91f3cb98a12006", "url": "https://github.com/seata/seata/commit/264fad508b4588d2b3b77c071a91f3cb98a12006", "message": "Merge remote-tracking branch 'origin/postgresql' into postgresql", "committedDate": "2020-01-13T09:22:06Z", "type": "commit"}, {"oid": "83662c8394558df871d00a34c6742f2c24a46c73", "url": "https://github.com/seata/seata/commit/83662c8394558df871d00a34c6742f2c24a46c73", "message": "remove script in distribution", "committedDate": "2020-01-13T09:28:05Z", "type": "commit"}, {"oid": "b8c879266612f6d6e8f215aed58704015c35d3f5", "url": "https://github.com/seata/seata/commit/b8c879266612f6d6e8f215aed58704015c35d3f5", "message": "remove script in distribution", "committedDate": "2020-01-13T09:29:57Z", "type": "commit"}, {"oid": "6fde3bd9787a69418bbc050bca2b144f0c0b2af6", "url": "https://github.com/seata/seata/commit/6fde3bd9787a69418bbc050bca2b144f0c0b2af6", "message": "remove script in distribution", "committedDate": "2020-01-13T09:32:11Z", "type": "commit"}, {"oid": "f6439bee4a2503c1c9cc85942b9514556e2936f2", "url": "https://github.com/seata/seata/commit/f6439bee4a2503c1c9cc85942b9514556e2936f2", "message": "create sequence before", "committedDate": "2020-01-13T09:48:06Z", "type": "commit"}, {"oid": "37cab300542a9e760560542e4711ed7ee2f3a85c", "url": "https://github.com/seata/seata/commit/37cab300542a9e760560542e4711ed7ee2f3a85c", "message": "increase postgresql table meta cache code coverage", "committedDate": "2020-01-13T09:48:56Z", "type": "commit"}, {"oid": "af62cc7073eeca56460072ea80071baa0e5288d7", "url": "https://github.com/seata/seata/commit/af62cc7073eeca56460072ea80071baa0e5288d7", "message": "Merge remote-tracking branch 'origin/develop' into postgresql\n\n# Conflicts:\n#\tsqlparser/seata-sqlparser-druid/src/main/resources/META-INF/services/io.seata.sqlparser.druid.SQLOperateRecognizerHolder", "committedDate": "2020-01-14T03:19:40Z", "type": "commit"}, {"oid": "21d550611e0ed2fd2ca18f20424d05357a698339", "url": "https://github.com/seata/seata/commit/21d550611e0ed2fd2ca18f20424d05357a698339", "message": "Merge remote-tracking branch 'remotes/src/postgresql' into postgresql\n\n# Conflicts:\n#\tdistribution/pg/db_undo_log_pg.sql", "committedDate": "2020-01-17T15:10:46Z", "type": "commit"}, {"oid": "c0d73a15790c2dfc15f709ca1cdebd59921b36bc", "url": "https://github.com/seata/seata/commit/c0d73a15790c2dfc15f709ca1cdebd59921b36bc", "message": "Merge remote-tracking branch 'remotes/src/develop' into postgresql", "committedDate": "2020-01-17T15:23:00Z", "type": "commit"}, {"oid": "b72a90225f04caaa1909bcd4bcebfb144f2036fa", "url": "https://github.com/seata/seata/commit/b72a90225f04caaa1909bcd4bcebfb144f2036fa", "message": "Merge branch 'develop' into develop", "committedDate": "2020-01-19T06:29:52Z", "type": "commit"}, {"oid": "5e25f1c66acc7018e5c3fdb65ec2809a93cdd9f9", "url": "https://github.com/seata/seata/commit/5e25f1c66acc7018e5c3fdb65ec2809a93cdd9f9", "message": "Merge branch 'develop' into develop", "committedDate": "2020-01-19T08:16:23Z", "type": "commit"}, {"oid": "fab528eaca73d4c5a583543634300559bfbd8fae", "url": "https://github.com/seata/seata/commit/fab528eaca73d4c5a583543634300559bfbd8fae", "message": "Merge remote-tracking branch 'remotes/upstream/develop' into develop\n\n# Conflicts:\n#\trm-datasource/src/main/java/io/seata/rm/datasource/sql/struct/TableMetaCacheFactory.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/UndoExecutorFactory.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/UndoLogManagerFactory.java", "committedDate": "2020-01-20T05:24:26Z", "type": "commit"}, {"oid": "9ca84266bec5e937b70aab28ce45c035334d20f3", "url": "https://github.com/seata/seata/commit/9ca84266bec5e937b70aab28ce45c035334d20f3", "message": "Merge branch 'develop' into develop", "committedDate": "2020-01-20T06:40:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODM4OTA4MQ==", "url": "https://github.com/seata/seata/pull/2200#discussion_r368389081", "bodyText": "Why not create instance init", "author": "jaspercloud", "createdAt": "2020-01-20T06:45:12Z", "path": "rm-datasource/src/main/java/io/seata/rm/datasource/sql/struct/cache/PostgresqlTableMetaCache.java", "diffHunk": "@@ -0,0 +1,193 @@\n+/*\n+ *  Copyright 1999-2019 Seata.io Group.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package io.seata.rm.datasource.sql.struct.cache;\n+\n+import io.seata.common.exception.ShouldNeverHappenException;\n+import io.seata.common.util.StringUtils;\n+import io.seata.rm.datasource.sql.struct.ColumnMeta;\n+import io.seata.rm.datasource.sql.struct.IndexMeta;\n+import io.seata.rm.datasource.sql.struct.IndexType;\n+import io.seata.rm.datasource.sql.struct.TableMeta;\n+import io.seata.rm.datasource.sql.struct.TableMetaCache;\n+\n+import java.sql.Connection;\n+import java.sql.DatabaseMetaData;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.sql.Statement;\n+\n+/**\n+ * The type Table meta cache.\n+ *\n+ * @author jaspercloud\n+ */\n+public class PostgresqlTableMetaCache extends AbstractTableMetaCache {\n+\n+    private static volatile TableMetaCache tableMetaCache = null;", "originalCommit": "9ca84266bec5e937b70aab28ce45c035334d20f3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fc0c0f83ccc6743e9edc34da87d2a6628ed80ad4", "url": "https://github.com/seata/seata/commit/fc0c0f83ccc6743e9edc34da87d2a6628ed80ad4", "message": "Merge remote-tracking branch 'remotes/upstream/develop' into develop\n\n# Conflicts:\n#\trm-datasource/src/main/java/io/seata/rm/datasource/sql/struct/TableMetaCacheFactory.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/UndoExecutorFactory.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/UndoLogManagerFactory.java", "committedDate": "2020-01-21T01:16:43Z", "type": "commit"}, {"oid": "a204449712e0f6f1bc03c9c3b0c220ce14f1dc95", "url": "https://github.com/seata/seata/commit/a204449712e0f6f1bc03c9c3b0c220ce14f1dc95", "message": "Merge remote-tracking branch 'remotes/upstream/develop' into develop\n\n# Conflicts:\n#\trm-datasource/src/main/java/io/seata/rm/datasource/sql/struct/TableMetaCacheFactory.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/UndoExecutorFactory.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/UndoLogManagerFactory.java", "committedDate": "2020-01-22T05:04:27Z", "type": "commit"}, {"oid": "a3e44eef72426ade85af512d9fafe779f4f49c56", "url": "https://github.com/seata/seata/commit/a3e44eef72426ade85af512d9fafe779f4f49c56", "message": "Merge branch 'develop' into develop", "committedDate": "2020-01-22T05:05:22Z", "type": "commit"}, {"oid": "a0edf9e70df84bbe1bc90cb89459d2f214f1ae3a", "url": "https://github.com/seata/seata/commit/a0edf9e70df84bbe1bc90cb89459d2f214f1ae3a", "message": "Merge branch 'develop' into develop", "committedDate": "2020-01-22T15:47:49Z", "type": "commit"}, {"oid": "ab994e61bb02232527fe083843b4e1b6d783c719", "url": "https://github.com/seata/seata/commit/ab994e61bb02232527fe083843b4e1b6d783c719", "message": "Merge branch 'develop' into develop", "committedDate": "2020-01-23T02:55:34Z", "type": "commit"}, {"oid": "226302ec46198302ede2b0c0f33a628f6538706b", "url": "https://github.com/seata/seata/commit/226302ec46198302ede2b0c0f33a628f6538706b", "message": "Merge branch 'develop' of https://github.com/seata/seata into develop\n\n# Conflicts:\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/AbstractUndoLogManager.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/oracle/OracleUndoLogManager.java", "committedDate": "2020-01-28T09:49:35Z", "type": "commit"}, {"oid": "3e5b37a358e57d858b77a82d11678b6bc100b44c", "url": "https://github.com/seata/seata/commit/3e5b37a358e57d858b77a82d11678b6bc100b44c", "message": "Merge branch 'develop' of https://github.com/seata/seata into develop\n\n# Conflicts:\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/AbstractUndoLogManager.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/oracle/OracleUndoLogManager.java", "committedDate": "2020-01-28T09:50:02Z", "type": "commit"}, {"oid": "c254ec3b7380d8e2087270f5310eb9295c3530fe", "url": "https://github.com/seata/seata/commit/c254ec3b7380d8e2087270f5310eb9295c3530fe", "message": "Merge branch 'develop' of https://github.com/seata/seata into develop\n\n# Conflicts:\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/AbstractUndoLogManager.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/oracle/OracleUndoLogManager.java", "committedDate": "2020-01-28T13:09:34Z", "type": "commit"}, {"oid": "370ca8e0774b7a0b493793c8f6e5938e67759e94", "url": "https://github.com/seata/seata/commit/370ca8e0774b7a0b493793c8f6e5938e67759e94", "message": "reduce change", "committedDate": "2020-02-03T02:42:01Z", "type": "commit"}, {"oid": "0fb51d58d5f8cfaea3513071d3b8536c16504012", "url": "https://github.com/seata/seata/commit/0fb51d58d5f8cfaea3513071d3b8536c16504012", "message": "Merge remote-tracking branch 'remotes/src/develop' into postgresql\n\n# Conflicts:\n#\tcore/pom.xml\n#\trm-datasource/src/main/java/io/seata/rm/datasource/sql/struct/TableMetaCacheFactory.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/AbstractUndoLogManager.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/UndoExecutorFactory.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/UndoLogManagerFactory.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/oracle/OracleUndoLogManager.java", "committedDate": "2020-02-07T11:19:35Z", "type": "commit"}, {"oid": "1bb12ab1e42a963c2a6aab590f68dce88bfb4932", "url": "https://github.com/seata/seata/commit/1bb12ab1e42a963c2a6aab590f68dce88bfb4932", "message": "Merge remote-tracking branch 'remotes/src/develop' into postgresql\n\n# Conflicts:\n#\tcore/pom.xml\n#\trm-datasource/src/main/java/io/seata/rm/datasource/sql/struct/TableMetaCacheFactory.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/AbstractUndoLogManager.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/UndoExecutorFactory.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/UndoLogManagerFactory.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/oracle/OracleUndoLogManager.java", "committedDate": "2020-02-07T11:42:20Z", "type": "commit"}, {"oid": "5f47021e176aaf5e35c31aa144057e989ac0bd9c", "url": "https://github.com/seata/seata/commit/5f47021e176aaf5e35c31aa144057e989ac0bd9c", "message": "Merge remote-tracking branch 'remotes/src/develop' into postgresql\n\n# Conflicts:\n#\tcore/pom.xml\n#\trm-datasource/src/main/java/io/seata/rm/datasource/sql/struct/TableMetaCacheFactory.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/AbstractUndoLogManager.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/UndoExecutorFactory.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/UndoLogManagerFactory.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/oracle/OracleUndoLogManager.java", "committedDate": "2020-02-07T11:45:49Z", "type": "commit"}, {"oid": "80469e6c89bb87726d242fa8ee3a87df28eb1066", "url": "https://github.com/seata/seata/commit/80469e6c89bb87726d242fa8ee3a87df28eb1066", "message": "Merge remote-tracking branch 'remotes/src/develop' into postgresql\n\n# Conflicts:\n#\tcore/pom.xml\n#\trm-datasource/src/main/java/io/seata/rm/datasource/sql/struct/TableMetaCacheFactory.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/AbstractUndoLogManager.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/UndoExecutorFactory.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/UndoLogManagerFactory.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/oracle/OracleUndoLogManager.java", "committedDate": "2020-02-07T12:27:03Z", "type": "commit"}, {"oid": "cd3e3679bd924deb0386b3aa606080196c0b875f", "url": "https://github.com/seata/seata/commit/cd3e3679bd924deb0386b3aa606080196c0b875f", "message": "Merge remote-tracking branch 'remotes/src/develop' into postgresql\n\n# Conflicts:\n#\tcore/pom.xml\n#\trm-datasource/src/main/java/io/seata/rm/datasource/sql/struct/TableMetaCacheFactory.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/AbstractUndoLogManager.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/UndoExecutorFactory.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/UndoLogManagerFactory.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/oracle/OracleUndoLogManager.java", "committedDate": "2020-02-07T12:30:56Z", "type": "commit"}, {"oid": "d35cf1888d51d82f630748fe2480ec6bb2e0826c", "url": "https://github.com/seata/seata/commit/d35cf1888d51d82f630748fe2480ec6bb2e0826c", "message": "psql \"create undo_log (id SERIAL)\" use nextval('undo_log_id_seq')", "committedDate": "2020-02-07T12:56:25Z", "type": "commit"}, {"oid": "c4b79fedaac553d713ab4b86dfae4838d72cbc38", "url": "https://github.com/seata/seata/commit/c4b79fedaac553d713ab4b86dfae4838d72cbc38", "message": "fastjson ignore TableRecords.tableMeta", "committedDate": "2020-02-07T15:12:28Z", "type": "commit"}, {"oid": "612810f03a96548e76b2ae5eb4b8ab7567ca190a", "url": "https://github.com/seata/seata/commit/612810f03a96548e76b2ae5eb4b8ab7567ca190a", "message": "fastjson ignore TableRecords.tableMeta", "committedDate": "2020-02-07T15:27:38Z", "type": "commit"}, {"oid": "ed9c5da8468826873605d823b4a1e3f6a4cdd59d", "url": "https://github.com/seata/seata/commit/ed9c5da8468826873605d823b4a1e3f6a4cdd59d", "message": "GsonUndoLogParser", "committedDate": "2020-02-07T16:17:28Z", "type": "commit"}, {"oid": "8a40f193d9e80de573d6c7ec721bd3cc6b32978b", "url": "https://github.com/seata/seata/commit/8a40f193d9e80de573d6c7ec721bd3cc6b32978b", "message": "doBranchCommits commit", "committedDate": "2020-02-07T16:37:22Z", "type": "commit"}, {"oid": "e9d124bf6f2aa76941a900db300a91a41521adc2", "url": "https://github.com/seata/seata/commit/e9d124bf6f2aa76941a900db300a91a41521adc2", "message": "doBranchCommits commit", "committedDate": "2020-02-07T16:47:09Z", "type": "commit"}, {"oid": "512eab731cc548908db83dae6ef0328a80fb4deb", "url": "https://github.com/seata/seata/commit/512eab731cc548908db83dae6ef0328a80fb4deb", "message": "gson timestampFactory", "committedDate": "2020-02-07T17:12:27Z", "type": "commit"}, {"oid": "9f29f641c0e5f55aa2edfaf48627022dd30e5a18", "url": "https://github.com/seata/seata/commit/9f29f641c0e5f55aa2edfaf48627022dd30e5a18", "message": "remove GsonUndoLogParser", "committedDate": "2020-02-08T05:46:14Z", "type": "commit"}, {"oid": "83b8b41bb92a671b32db1951aafaaedadbc6f12c", "url": "https://github.com/seata/seata/commit/83b8b41bb92a671b32db1951aafaaedadbc6f12c", "message": "checkstyle", "committedDate": "2020-02-08T07:14:46Z", "type": "commit"}, {"oid": "51193883f54bd6dd47345359f3a46ca8bb9d42e5", "url": "https://github.com/seata/seata/commit/51193883f54bd6dd47345359f3a46ca8bb9d42e5", "message": "merge", "committedDate": "2020-02-08T07:42:25Z", "type": "commit"}, {"oid": "f1a3626290bb2772806b60f55e09f3fa9cf852e9", "url": "https://github.com/seata/seata/commit/f1a3626290bb2772806b60f55e09f3fa9cf852e9", "message": "psql create table undo_log (id SERIAL,...)\nuse nextval('undo_log_id_seq')", "committedDate": "2020-02-08T07:45:41Z", "type": "commit"}, {"oid": "77594a678c08b8c8db84c585387f6ce7b6698d31", "url": "https://github.com/seata/seata/commit/77594a678c08b8c8db84c585387f6ce7b6698d31", "message": "jdbc commit", "committedDate": "2020-02-08T07:52:48Z", "type": "commit"}, {"oid": "7e769b08b95adc3832346bebed3384441e59dc28", "url": "https://github.com/seata/seata/commit/7e769b08b95adc3832346bebed3384441e59dc28", "message": "remove GsonUndoLogParser", "committedDate": "2020-02-08T07:57:18Z", "type": "commit"}, {"oid": "d8b17a74db49e2c723d22b11f9f4209221b22145", "url": "https://github.com/seata/seata/commit/d8b17a74db49e2c723d22b11f9f4209221b22145", "message": "Merge remote-tracking branch 'remotes/origin/postgresql' into develop\n\n# Conflicts:\n#\trm-datasource/src/main/java/io/seata/rm/datasource/AsyncWorker.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/sql/struct/cache/PostgresqlTableMetaCache.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/oracle/OracleUndoLogManager.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/undo/postgresql/PostgresqlUndoLogManager.java", "committedDate": "2020-02-08T08:04:33Z", "type": "commit"}, {"oid": "b6bff0260fc046afab914fa46d89ca239d374b44", "url": "https://github.com/seata/seata/commit/b6bff0260fc046afab914fa46d89ca239d374b44", "message": "Merge remote-tracking branch 'remotes/origin/postgresql' into develop", "committedDate": "2020-02-08T08:14:00Z", "type": "commit"}]}