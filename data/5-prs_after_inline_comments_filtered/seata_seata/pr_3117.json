{"pr_number": 3117, "pr_title": "optimize:make log more clearly and remove the useless code", "pr_createdAt": "2020-09-15T16:07:05Z", "pr_url": "https://github.com/seata/seata/pull/3117", "timeline": [{"oid": "dfcd38a46b7e1cde34c9cbd6c27f3ca82e9f9e04", "url": "https://github.com/seata/seata/commit/dfcd38a46b7e1cde34c9cbd6c27f3ca82e9f9e04", "message": "optimize:make log more clearly and remove the useless code", "committedDate": "2020-09-15T16:05:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEwMzQ0NA==", "url": "https://github.com/seata/seata/pull/3117#discussion_r489103444", "bodyText": "\u5982\u679cserviceGroup\u4e3a\u7a7a\uff0c\u660e\u786e\u63d0\u793a\u7528\u6237\u672a\u914d\u7f6eservice.vgroupMapping.${transactionServiceGroup}\u662f\u5426\u4f1a\u66f4\u597d\uff1f", "author": "wangliang181230", "createdAt": "2020-09-16T01:13:52Z", "path": "core/src/main/java/io/seata/core/rpc/netty/NettyClientChannelManager.java", "diffHunk": "@@ -167,7 +167,7 @@ void reconnect(String transactionServiceGroup) {\n         if (CollectionUtils.isEmpty(availList)) {\n             String serviceGroup = RegistryFactory.getInstance()\n                                                  .getServiceGroup(transactionServiceGroup);\n-            LOGGER.error(\"no available service '{}' found, please make sure registry config correct\", serviceGroup);\n+            LOGGER.error(\"no available service '{}' found in service group '{}', please make sure registry config correct\", serviceGroup, transactionServiceGroup);", "originalCommit": "dfcd38a46b7e1cde34c9cbd6c27f3ca82e9f9e04", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEwNzAyNw==", "url": "https://github.com/seata/seata/pull/3117#discussion_r489107027", "bodyText": "+1", "author": "a364176773", "createdAt": "2020-09-16T01:26:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEwMzQ0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM0MzEyNw==", "url": "https://github.com/seata/seata/pull/3117#discussion_r489343127", "bodyText": "agree", "author": "slievrly", "createdAt": "2020-09-16T10:47:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEwMzQ0NA=="}], "type": "inlineReview"}, {"oid": "c6484a6164a31fad45955ac58ef59726f8e2fdf2", "url": "https://github.com/seata/seata/commit/c6484a6164a31fad45955ac58ef59726f8e2fdf2", "message": "Merge branch 'develop' into optimize", "committedDate": "2020-09-17T05:58:15Z", "type": "commit"}, {"oid": "b72d5411434402fe3e07f3f75f263c93a32c00dc", "url": "https://github.com/seata/seata/commit/b72d5411434402fe3e07f3f75f263c93a32c00dc", "message": "optimize:make log more clearly", "committedDate": "2020-09-23T02:15:30Z", "type": "commit"}, {"oid": "8ef2792a40efabc41b28aaaa84b05d63089dd45a", "url": "https://github.com/seata/seata/commit/8ef2792a40efabc41b28aaaa84b05d63089dd45a", "message": "Merge remote-tracking branch 'origin/optimize' into optimize", "committedDate": "2020-09-23T02:16:08Z", "type": "commit"}, {"oid": "b73ff3c658a7d0a9d27bc7ae04bae94b967e6182", "url": "https://github.com/seata/seata/commit/b73ff3c658a7d0a9d27bc7ae04bae94b967e6182", "message": "Merge remote-tracking branch 'seata/develop' into optimize", "committedDate": "2020-09-23T02:18:59Z", "type": "commit"}, {"oid": "e0f64e985526600ab1b2253bdef182a4c4c86f39", "url": "https://github.com/seata/seata/commit/e0f64e985526600ab1b2253bdef182a4c4c86f39", "message": "Revert \"optimize:make log more clearly\"\n\nThis reverts commit b72d541", "committedDate": "2020-09-23T02:32:43Z", "type": "commit"}, {"oid": "bd352764c5ac542de33b2480d303624dda03885a", "url": "https://github.com/seata/seata/commit/bd352764c5ac542de33b2480d303624dda03885a", "message": "optimize:make log more clearly", "committedDate": "2020-09-23T02:33:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzE4MTM3Mw==", "url": "https://github.com/seata/seata/pull/3117#discussion_r493181373", "bodyText": "if use third registry center ,will not read this configuration item.", "author": "slievrly", "createdAt": "2020-09-23T03:53:50Z", "path": "core/src/main/java/io/seata/core/rpc/netty/NettyClientChannelManager.java", "diffHunk": "@@ -165,10 +167,19 @@ void reconnect(String transactionServiceGroup) {\n             return;\n         }\n         if (CollectionUtils.isEmpty(availList)) {\n-            String serviceGroup = RegistryFactory.getInstance()\n-                                                 .getServiceGroup(transactionServiceGroup);\n-            LOGGER.error(\"no available service '{}' found, please make sure registry config correct\", serviceGroup);\n-            return;\n+            String clusterName = RegistryFactory.getInstance().getServiceGroup(transactionServiceGroup);\n+\n+            if (StringUtils.isNotBlank(clusterName)) {\n+                LOGGER.error(\"no available service found in cluster '{}{}{}', please make sure registry config correct\",\n+                        ConfigurationKeys.SERVICE_PREFIX,", "originalCommit": "bd352764c5ac542de33b2480d303624dda03885a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ1NTA1OQ==", "url": "https://github.com/seata/seata/pull/3117#discussion_r494455059", "bodyText": "I modified the log message,please review it", "author": "PeineLiang", "createdAt": "2020-09-24T16:31:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzE4MTM3Mw=="}], "type": "inlineReview"}, {"oid": "bbf72e9de18fb5a7fd553727ba853c265b7f13c3", "url": "https://github.com/seata/seata/commit/bbf72e9de18fb5a7fd553727ba853c265b7f13c3", "message": "Merge remote-tracking branch 'seata/develop' into optimize", "committedDate": "2020-09-24T15:17:26Z", "type": "commit"}, {"oid": "04ab08fac800b3915aa93141afffbd7b67466787", "url": "https://github.com/seata/seata/commit/04ab08fac800b3915aa93141afffbd7b67466787", "message": "optimize:make log more clearly", "committedDate": "2020-09-24T16:25:17Z", "type": "commit"}, {"oid": "c7ca0965a1312c39c4f093a1eddf11de8187d786", "url": "https://github.com/seata/seata/commit/c7ca0965a1312c39c4f093a1eddf11de8187d786", "message": "Revert \"optimize:make log more clearly\"\n\nThis reverts commit 04ab08f", "committedDate": "2020-09-24T16:28:30Z", "type": "commit"}, {"oid": "81c2a5b8f0c0583cc90ab349094af61ecfa7140a", "url": "https://github.com/seata/seata/commit/81c2a5b8f0c0583cc90ab349094af61ecfa7140a", "message": "optimize:make log more clearly", "committedDate": "2020-09-24T16:29:03Z", "type": "commit"}, {"oid": "efa609fbea451cae77119ad6ac49da4b89f75bff", "url": "https://github.com/seata/seata/commit/efa609fbea451cae77119ad6ac49da4b89f75bff", "message": "Merge branch 'develop' into optimize", "committedDate": "2020-09-28T09:32:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTgyNTExMw==", "url": "https://github.com/seata/seata/pull/3117#discussion_r495825113", "bodyText": "cant no -> can't", "author": "wangliang181230", "createdAt": "2020-09-28T09:59:46Z", "path": "core/src/main/java/io/seata/core/rpc/netty/NettyClientChannelManager.java", "diffHunk": "@@ -165,10 +169,19 @@ void reconnect(String transactionServiceGroup) {\n             return;\n         }\n         if (CollectionUtils.isEmpty(availList)) {\n-            String serviceGroup = RegistryFactory.getInstance()\n-                                                 .getServiceGroup(transactionServiceGroup);\n-            LOGGER.error(\"no available service '{}' found, please make sure registry config correct\", serviceGroup);\n-            return;\n+            RegistryService registryService = RegistryFactory.getInstance();\n+            String clusterName = registryService.getServiceGroup(transactionServiceGroup);\n+\n+            if (StringUtils.isBlank(clusterName)) {\n+                LOGGER.error(\"cant no get cluster name in registry config '{}{}', please make sure registry config correct\",", "originalCommit": "efa609fbea451cae77119ad6ac49da4b89f75bff", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjAwMTk4OQ==", "url": "https://github.com/seata/seata/pull/3117#discussion_r496001989", "bodyText": "fixed ,please review it", "author": "PeineLiang", "createdAt": "2020-09-28T14:53:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTgyNTExMw=="}], "type": "inlineReview"}, {"oid": "2b6629bf55bc632d47b648207dd542adc8188413", "url": "https://github.com/seata/seata/commit/2b6629bf55bc632d47b648207dd542adc8188413", "message": "Merge remote-tracking branch 'seata/develop' into optimize", "committedDate": "2020-09-28T14:43:45Z", "type": "commit"}, {"oid": "bf870b719c76ad8cfb2e8291aa02ed9d62db3041", "url": "https://github.com/seata/seata/commit/bf870b719c76ad8cfb2e8291aa02ed9d62db3041", "message": "optimize:fix word", "committedDate": "2020-09-28T14:47:13Z", "type": "commit"}, {"oid": "cd7ee1b1a4e4a7b264799ab9e62b236fee980e04", "url": "https://github.com/seata/seata/commit/cd7ee1b1a4e4a7b264799ab9e62b236fee980e04", "message": "Merge remote-tracking branch 'origin/optimize' into optimize", "committedDate": "2020-09-28T14:47:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM0NDcyMw==", "url": "https://github.com/seata/seata/pull/3117#discussion_r496344723", "bodyText": "line 185: return;\nIf missed, it may throw NPE.", "author": "wangliang181230", "createdAt": "2020-09-29T02:40:29Z", "path": "core/src/main/java/io/seata/core/rpc/netty/NettyClientChannelManager.java", "diffHunk": "@@ -165,10 +169,19 @@ void reconnect(String transactionServiceGroup) {\n             return;\n         }\n         if (CollectionUtils.isEmpty(availList)) {\n-            String serviceGroup = RegistryFactory.getInstance()\n-                                                 .getServiceGroup(transactionServiceGroup);\n-            LOGGER.error(\"no available service '{}' found, please make sure registry config correct\", serviceGroup);\n-            return;\n+            RegistryService registryService = RegistryFactory.getInstance();\n+            String clusterName = registryService.getServiceGroup(transactionServiceGroup);\n+\n+            if (StringUtils.isBlank(clusterName)) {\n+                LOGGER.error(\"can not get cluster name in registry config '{}{}', please make sure registry config correct\",\n+                        ConfigurationKeys.SERVICE_GROUP_MAPPING_PREFIX,\n+                        transactionServiceGroup);\n+                return;\n+            }\n+\n+            if (!(registryService instanceof FileRegistryServiceImpl)) {\n+                LOGGER.error(\"no available service found, please make sure registry config correct and keep your seata server running\");\n+            }", "originalCommit": "cd7ee1b1a4e4a7b264799ab9e62b236fee980e04", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM0ODY5Ng==", "url": "https://github.com/seata/seata/pull/3117#discussion_r496348696", "bodyText": "line 185: return;\nIf missed, it may throw NPE.\n\nit's necessary? the method getAvailServerList  will return a empty list", "author": "PeineLiang", "createdAt": "2020-09-29T02:56:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM0NDcyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM1MDc3OA==", "url": "https://github.com/seata/seata/pull/3117#discussion_r496350778", "bodyText": "The current method should not consider how the getAvailServerList is implemented.\nIf the codes of getAvailServerList changed, it will throw NPE.", "author": "wangliang181230", "createdAt": "2020-09-29T03:04:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM0NDcyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM1MTQwMw==", "url": "https://github.com/seata/seata/pull/3117#discussion_r496351403", "bodyText": "In my opinion, it is better for the getAvailServerList method to return null if the list is empty.", "author": "wangliang181230", "createdAt": "2020-09-29T03:06:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM0NDcyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM1NDE3OA==", "url": "https://github.com/seata/seata/pull/3117#discussion_r496354178", "bodyText": "The current method should not consider how the getAvailServerList is implemented.\nIf the codes of getAvailServerList changed, it will throw NPE.\n\nfixed,please review it", "author": "PeineLiang", "createdAt": "2020-09-29T03:18:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM0NDcyMw=="}], "type": "inlineReview"}, {"oid": "21071195d17add28ae85ff69438811e1ca31e9e3", "url": "https://github.com/seata/seata/commit/21071195d17add28ae85ff69438811e1ca31e9e3", "message": "optimize:add return;", "committedDate": "2020-09-29T03:15:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ0NDE1Nw==", "url": "https://github.com/seata/seata/pull/3117#discussion_r496444157", "bodyText": "Is it better to prompt the cluster name here?", "author": "wangliang181230", "createdAt": "2020-09-29T06:23:18Z", "path": "core/src/main/java/io/seata/core/rpc/netty/NettyClientChannelManager.java", "diffHunk": "@@ -165,9 +169,19 @@ void reconnect(String transactionServiceGroup) {\n             return;\n         }\n         if (CollectionUtils.isEmpty(availList)) {\n-            String serviceGroup = RegistryFactory.getInstance()\n-                                                 .getServiceGroup(transactionServiceGroup);\n-            LOGGER.error(\"no available service '{}' found, please make sure registry config correct\", serviceGroup);\n+            RegistryService registryService = RegistryFactory.getInstance();\n+            String clusterName = registryService.getServiceGroup(transactionServiceGroup);\n+\n+            if (StringUtils.isBlank(clusterName)) {\n+                LOGGER.error(\"can not get cluster name in registry config '{}{}', please make sure registry config correct\",\n+                        ConfigurationKeys.SERVICE_GROUP_MAPPING_PREFIX,\n+                        transactionServiceGroup);\n+                return;\n+            }\n+\n+            if (!(registryService instanceof FileRegistryServiceImpl)) {\n+                LOGGER.error(\"no available service found, please make sure registry config correct and keep your seata server running\");", "originalCommit": "21071195d17add28ae85ff69438811e1ca31e9e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEwMjgyMA==", "url": "https://github.com/seata/seata/pull/3117#discussion_r500102820", "bodyText": "Is it better to prompt the cluster name here?\n\nfixed,please review it", "author": "PeineLiang", "createdAt": "2020-10-06T08:38:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ0NDE1Nw=="}], "type": "inlineReview"}, {"oid": "a123f296ed36f7c8a5b95bdb762793f376215252", "url": "https://github.com/seata/seata/commit/a123f296ed36f7c8a5b95bdb762793f376215252", "message": "Merge remote-tracking branch 'seata/develop' into optimize", "committedDate": "2020-10-06T08:34:19Z", "type": "commit"}, {"oid": "3b1e5359ef0e2448a222a54a8df37a379c72b98b", "url": "https://github.com/seata/seata/commit/3b1e5359ef0e2448a222a54a8df37a379c72b98b", "message": "optimize:add cluster name", "committedDate": "2020-10-06T08:36:36Z", "type": "commit"}, {"oid": "cc8441ba01924f4a3845d7e9cbd99ce392c327a7", "url": "https://github.com/seata/seata/commit/cc8441ba01924f4a3845d7e9cbd99ce392c327a7", "message": "Merge branch 'develop' into optimize", "committedDate": "2020-10-17T11:22:42Z", "type": "commit"}, {"oid": "2b598a5bd41be952e690edaedaadf19c073d2b38", "url": "https://github.com/seata/seata/commit/2b598a5bd41be952e690edaedaadf19c073d2b38", "message": "Merge branch 'develop' into optimize", "committedDate": "2020-10-17T11:40:32Z", "type": "commit"}]}