{"pr_number": 4684, "pr_title": "Provides feature to configure saml session store factory", "pr_createdAt": "2020-02-07T11:56:52Z", "pr_url": "https://github.com/apereo/cas/pull/4684", "timeline": [{"oid": "de0ce42fd4a133037081ba548d82a20a6618e797", "url": "https://github.com/apereo/cas/commit/de0ce42fd4a133037081ba548d82a20a6618e797", "message": "provides feature to configure saml session store factory", "committedDate": "2020-02-07T11:52:20Z", "type": "commit"}, {"oid": "6f347f41d2be2ea7bf2d0a6f687d55d609810395", "url": "https://github.com/apereo/cas/commit/6f347f41d2be2ea7bf2d0a6f687d55d609810395", "message": "Merge branch '6.1.x' into sessionStoreFactoryIssue", "committedDate": "2020-02-07T13:50:44Z", "type": "commit"}, {"oid": "e8f6896426859bc10c573f2f0c767983fdc75ee1", "url": "https://github.com/apereo/cas/commit/e8f6896426859bc10c573f2f0c767983fdc75ee1", "message": "remove trailing spaces", "committedDate": "2020-02-07T15:01:06Z", "type": "commit"}, {"oid": "d3bd561dbe4f6c506949b0f5f73435cf24ece2ce", "url": "https://github.com/apereo/cas/commit/d3bd561dbe4f6c506949b0f5f73435cf24ece2ce", "message": "Merge branch '6.1.x' into sessionStoreFactoryIssue", "committedDate": "2020-02-07T16:50:42Z", "type": "commit"}, {"oid": "21c79747888f89460da46f72f7c1920d5d82b4be", "url": "https://github.com/apereo/cas/commit/21c79747888f89460da46f72f7c1920d5d82b4be", "message": "Update Pac4jSamlClientProperties.java", "committedDate": "2020-02-07T17:01:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUwMjgzNA==", "url": "https://github.com/apereo/cas/pull/4684#discussion_r376502834", "bodyText": "val clazz = ClassUtils.getClass(DelegatedClientFactory.class.getClassLoader(), className);\nval factory = SAMLMessageStoreFactory.class.cast(clazz.getDeclaredConstructor().newInstance());", "author": "mmoayyed", "createdAt": "2020-02-07T17:04:31Z", "path": "support/cas-server-support-pac4j-core-clients/src/main/java/org/apereo/cas/support/pac4j/authentication/DelegatedClientFactory.java", "diffHunk": "@@ -419,6 +421,19 @@ protected void configureSamlClient(final Collection<IndirectClient> properties)\n                 cfg.setWantsAssertionsSigned(saml.isWantsAssertionsSigned());\n                 cfg.setUseNameQualifier(saml.isUseNameQualifier());\n                 cfg.setAttributeConsumingServiceIndex(saml.getAttributeConsumingServiceIndex());\n+                \n+                try{\n+                    cfg.setSamlMessageStoreFactory(SAMLMessageStoreFactory.class.cast(\n+                        Class.forName(saml.getMessageStoreFactory()).getDeclaredConstructor().newInstance()));", "originalCommit": "21c79747888f89460da46f72f7c1920d5d82b4be", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUwMzAxOA==", "url": "https://github.com/apereo/cas/pull/4684#discussion_r376503018", "bodyText": "catch (final Exception e)", "author": "mmoayyed", "createdAt": "2020-02-07T17:04:57Z", "path": "support/cas-server-support-pac4j-core-clients/src/main/java/org/apereo/cas/support/pac4j/authentication/DelegatedClientFactory.java", "diffHunk": "@@ -419,6 +421,19 @@ protected void configureSamlClient(final Collection<IndirectClient> properties)\n                 cfg.setWantsAssertionsSigned(saml.isWantsAssertionsSigned());\n                 cfg.setUseNameQualifier(saml.isUseNameQualifier());\n                 cfg.setAttributeConsumingServiceIndex(saml.getAttributeConsumingServiceIndex());\n+                \n+                try{\n+                    cfg.setSamlMessageStoreFactory(SAMLMessageStoreFactory.class.cast(\n+                        Class.forName(saml.getMessageStoreFactory()).getDeclaredConstructor().newInstance()));\n+                }catch(ClassNotFoundException ", "originalCommit": "21c79747888f89460da46f72f7c1920d5d82b4be", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUwMzE4NA==", "url": "https://github.com/apereo/cas/pull/4684#discussion_r376503184", "bodyText": "Use [{}]", "author": "mmoayyed", "createdAt": "2020-02-07T17:05:23Z", "path": "support/cas-server-support-pac4j-core-clients/src/main/java/org/apereo/cas/support/pac4j/authentication/DelegatedClientFactory.java", "diffHunk": "@@ -419,6 +421,19 @@ protected void configureSamlClient(final Collection<IndirectClient> properties)\n                 cfg.setWantsAssertionsSigned(saml.isWantsAssertionsSigned());\n                 cfg.setUseNameQualifier(saml.isUseNameQualifier());\n                 cfg.setAttributeConsumingServiceIndex(saml.getAttributeConsumingServiceIndex());\n+                \n+                try{\n+                    cfg.setSamlMessageStoreFactory(SAMLMessageStoreFactory.class.cast(\n+                        Class.forName(saml.getMessageStoreFactory()).getDeclaredConstructor().newInstance()));\n+                }catch(ClassNotFoundException \n+                        | InstantiationException \n+                        | IllegalAccessException \n+                        | NoSuchMethodException \n+                        | InvocationTargetException e){\n+                    LOGGER.error(", "originalCommit": "21c79747888f89460da46f72f7c1920d5d82b4be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUxOTEzMA==", "url": "https://github.com/apereo/cas/pull/4684#discussion_r376519130", "bodyText": "Sorry Misagh but I didn't understand.\nWhat do you mean?", "author": "fmartelli", "createdAt": "2020-02-07T17:41:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUwMzE4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUyMjI4MA==", "url": "https://github.com/apereo/cas/pull/4684#discussion_r376522280", "bodyText": "He just means to put brackets around the braces so it will be obvious if the saml.getMessageStoreFactory() is null. Output would be ... class [org.xyz.Class]", "author": "hdeadman", "createdAt": "2020-02-07T17:49:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUwMzE4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUyNDg3NA==", "url": "https://github.com/apereo/cas/pull/4684#discussion_r376524874", "bodyText": "ah, thank you for clarification", "author": "fmartelli", "createdAt": "2020-02-07T17:55:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUwMzE4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUwMzkxNw==", "url": "https://github.com/apereo/cas/pull/4684#discussion_r376503917", "bodyText": "HttpSessionStoreFactory.class.getName()\nUse the class itself to get its name, so if it moves or is deleted, we can catch the issue at compile-time.", "author": "mmoayyed", "createdAt": "2020-02-07T17:06:59Z", "path": "support/cas-server-support-pac4j-core-clients/src/test/java/org/apereo/cas/support/pac4j/authentication/DelegatedClientFactoryTests.java", "diffHunk": "@@ -79,13 +80,18 @@ public void verifyFactoryForSamlClients() throws Exception {\n         saml.setServiceProviderMetadataPath(new File(FileUtils.getTempDirectoryPath(), \"sp.xml\").getCanonicalPath());\n         saml.setServiceProviderEntityId(\"test-entityid\");\n         saml.setForceKeystoreGeneration(true);\n+        saml.setMessageStoreFactory(\"org.pac4j.saml.store.HttpSessionStoreFactory\");", "originalCommit": "21c79747888f89460da46f72f7c1920d5d82b4be", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bb3e13b1639cb7a20b57cddd70d4d4df8ecc484d", "url": "https://github.com/apereo/cas/commit/bb3e13b1639cb7a20b57cddd70d4d4df8ecc484d", "message": "addresses some comments + fixes checkstyle issues", "committedDate": "2020-02-07T18:00:32Z", "type": "commit"}, {"oid": "bca0a04af03eff5dfe8abe90e166737be3e50ad5", "url": "https://github.com/apereo/cas/commit/bca0a04af03eff5dfe8abe90e166737be3e50ad5", "message": "Update DelegatedClientFactory.java", "committedDate": "2020-02-07T18:04:46Z", "type": "commit"}, {"oid": "1150b90794ceab055e5aba583c5421b6585ed5b7", "url": "https://github.com/apereo/cas/commit/1150b90794ceab055e5aba583c5421b6585ed5b7", "message": "Update DelegatedClientFactory.java", "committedDate": "2020-02-07T18:05:23Z", "type": "commit"}, {"oid": "c067367e0c572a206a4253a6c18a28f6098c770a", "url": "https://github.com/apereo/cas/commit/c067367e0c572a206a4253a6c18a28f6098c770a", "message": "Merge branch '6.1.x' into sessionStoreFactoryIssue", "committedDate": "2020-02-08T01:52:51Z", "type": "commit"}, {"oid": "2b25b3d73fbb5a4d57c4c7e42b7f19365774c1b7", "url": "https://github.com/apereo/cas/commit/2b25b3d73fbb5a4d57c4c7e42b7f19365774c1b7", "message": "Merge branch '6.1.x' into sessionStoreFactoryIssue", "committedDate": "2020-02-08T04:52:51Z", "type": "commit"}]}