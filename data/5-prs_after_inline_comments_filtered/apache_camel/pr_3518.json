{"pr_number": 3518, "pr_title": "CAMEL-14443 new camel-jira producers", "pr_createdAt": "2020-01-26T23:11:17Z", "pr_url": "https://github.com/apache/camel/pull/3518", "timeline": [{"oid": "fddeea6ec3794c251353fc5c91429aefb0edeb43", "url": "https://github.com/apache/camel/commit/fddeea6ec3794c251353fc5c91429aefb0edeb43", "message": "CAMEL-14443 new camel-jira producers\n- Added AddIssueLinkProducer, AddWorkLogProducer, FetchCommentsProducer & FetchCommentsProducer\n- Updated JiraConstants, JiraEndpoint & JiraType to enable the new producers\n- Added tests to verify the new producers", "committedDate": "2020-01-26T23:09:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTExODA3OA==", "url": "https://github.com/apache/camel/pull/3518#discussion_r371118078", "bodyText": "Can we use here primitiveinstead of the boxedInteger`?", "author": "omarsmak", "createdAt": "2020-01-27T08:52:43Z", "path": "components/camel-jira/src/main/java/org/apache/camel/component/jira/producer/AddWorkLogProducer.java", "diffHunk": "@@ -0,0 +1,62 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ * <p>\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ * <p>\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.component.jira.producer;\n+\n+import static org.apache.camel.component.jira.JiraConstants.ISSUE_KEY;\n+import static org.apache.camel.component.jira.JiraConstants.MINUTES_SPENT;\n+\n+import com.atlassian.jira.rest.client.api.IssueRestClient;\n+import com.atlassian.jira.rest.client.api.JiraRestClient;\n+import com.atlassian.jira.rest.client.api.domain.Issue;\n+import com.atlassian.jira.rest.client.api.domain.input.WorklogInput;\n+import org.apache.camel.Exchange;\n+import org.apache.camel.component.jira.JiraEndpoint;\n+import org.apache.camel.support.DefaultProducer;\n+import org.joda.time.DateTime;\n+\n+public class AddWorkLogProducer extends DefaultProducer {\n+\n+    public AddWorkLogProducer(JiraEndpoint endpoint) {\n+        super(endpoint);\n+    }\n+\n+    @Override\n+    public void process(Exchange exchange) {\n+        String issueKey = exchange.getIn().getHeader(ISSUE_KEY, String.class);\n+        if (issueKey == null) {\n+            throw new IllegalArgumentException(\"Missing exchange input header named \" + ISSUE_KEY);\n+        }\n+        String comment = exchange.getIn().getBody(String.class);\n+        if (comment == null) {\n+            throw new IllegalArgumentException(\"Missing exchange body, it should specify the string comment.\");\n+        }\n+        Integer minutesSpent = exchange.getIn().getHeader(MINUTES_SPENT, Integer.class);", "originalCommit": "fddeea6ec3794c251353fc5c91429aefb0edeb43", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQxNDcxMw==", "url": "https://github.com/apache/camel/pull/3518#discussion_r371414713", "bodyText": "Ok, I see where you're coming from, I initially did this to avoid the NullPointerException and have the more meaningful IllegalArgumentException with message instead.\nI'm updating this to default to a negative value, to keep the best of both worlds.\nprivate static final int DEFAULT_MINUTES_SPENT = -1;\n\n[...]\n\nint minutesSpent = exchange.getIn().getHeader(MINUTES_SPENT, DEFAULT_MINUTES_SPENT, int.class);\nif (DEFAULT_MINUTES_SPENT == minutesSpent) {\n     throw new IllegalArgumentException(\"Missing exchange input header named \" + MINUTES_SPENT);\n}", "author": "clementmouchet", "createdAt": "2020-01-27T18:44:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTExODA3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTExODM5Mg==", "url": "https://github.com/apache/camel/pull/3518#discussion_r371118392", "bodyText": "I think the static imports should be at the bottom of the imports. Did you run the build with sourcecheck enabled?", "author": "omarsmak", "createdAt": "2020-01-27T08:53:31Z", "path": "components/camel-jira/src/main/java/org/apache/camel/component/jira/producer/AddIssueLinkProducer.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ * <p>\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ * <p>\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.component.jira.producer;\n+\n+import static org.apache.camel.component.jira.JiraConstants.CHILD_ISSUE_KEY;", "originalCommit": "fddeea6ec3794c251353fc5c91429aefb0edeb43", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQxMDYwMw==", "url": "https://github.com/apache/camel/pull/3518#discussion_r371410603", "bodyText": "My bad, I use IDEA and had my imports organised in a different order. I'll format this to be consistent with the rest of the project.", "author": "clementmouchet", "createdAt": "2020-01-27T18:35:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTExODM5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTExOTc5MQ==", "url": "https://github.com/apache/camel/pull/3518#discussion_r371119791", "bodyText": "If not mistaken, exchange().getOut() has been deprecated in favour of exchange().getMessage()", "author": "omarsmak", "createdAt": "2020-01-27T08:57:02Z", "path": "components/camel-jira/src/main/java/org/apache/camel/component/jira/producer/FetchIssueProducer.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ * <p>\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ * <p>\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.component.jira.producer;\n+\n+import static org.apache.camel.component.jira.JiraConstants.ISSUE_KEY;\n+\n+import com.atlassian.jira.rest.client.api.IssueRestClient;\n+import com.atlassian.jira.rest.client.api.JiraRestClient;\n+import com.atlassian.jira.rest.client.api.domain.Issue;\n+import org.apache.camel.Exchange;\n+import org.apache.camel.component.jira.JiraEndpoint;\n+import org.apache.camel.support.DefaultProducer;\n+\n+public class FetchIssueProducer extends DefaultProducer {\n+    public FetchIssueProducer(JiraEndpoint endpoint) {\n+        super(endpoint);\n+    }\n+\n+    @Override\n+    public void process(Exchange exchange) {\n+        String issueKey = exchange.getIn().getHeader(ISSUE_KEY, String.class);\n+        if (issueKey == null) {\n+            throw new IllegalArgumentException(\"Missing exchange input header named \" + ISSUE_KEY);\n+        }\n+        JiraRestClient client = ((JiraEndpoint) getEndpoint()).getClient();\n+        IssueRestClient issueClient = client.getIssueClient();\n+        Issue issue = issueClient.getIssue(issueKey).claim();\n+\n+        // support InOut\n+        if (exchange.getPattern().isOutCapable()) {\n+            // copy the header of in message to the out message\n+            exchange.getOut().copyFrom(exchange.getIn());", "originalCommit": "fddeea6ec3794c251353fc5c91429aefb0edeb43", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQwOTkyMA==", "url": "https://github.com/apache/camel/pull/3518#discussion_r371409920", "bodyText": "Of course, I'll drop the .isOutCapable() block and use exchange().getMessage() instead.", "author": "clementmouchet", "createdAt": "2020-01-27T18:34:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTExOTc5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTEyMDUzMw==", "url": "https://github.com/apache/camel/pull/3518#discussion_r371120533", "bodyText": "Since you are at it, can you please change this to long primitive type? :)", "author": "omarsmak", "createdAt": "2020-01-27T08:58:37Z", "path": "components/camel-jira/src/test/java/org/apache/camel/component/jira/Utils.java", "diffHunk": "@@ -102,13 +105,43 @@ public static Issue createIssueWithComments(long id, Collection<Comment> comment\n                 null, null, null, null, null, null, null, null);\n     }\n \n+    public static Issue createIssueWithLinks(long id, Collection<IssueLink> issueLinks) {\n+        URI selfUri = URI.create(TEST_JIRA_URL + \"/rest/api/latest/issue/\" + id);\n+        return new Issue(\"jira summary test \" + id, selfUri, KEY + \"-\" + id, id, null, issueType, null, \"Description \" + id,\n+            null, null, null, null, userAssignee, null, null, null, null, null, null, null, null, null, null, issueLinks,\n+            null, null, null, null, null, null, null, null);\n+    }\n+\n+    public static Issue createIssueWithWorkLogs(long id, Collection<Worklog> worklogs) {\n+        URI selfUri = URI.create(TEST_JIRA_URL + \"/rest/api/latest/issue/\" + id);\n+        return new Issue(\"jira summary test \" + id, selfUri, KEY + \"-\" + id, id, null, issueType, null, \"Description \" + id,\n+            null, null, null, null, userAssignee, null, null, null, null, null, null, null, null, null, null, null,\n+            null, worklogs, null, null, null, null, null, null);\n+    }\n+\n     public static Comment newComment(long issueId, int newCommentId, String comment) {\n         DateTime now = DateTime.now();\n         Long id = Long.parseLong(issueId + \"0\" + newCommentId);", "originalCommit": "fddeea6ec3794c251353fc5c91429aefb0edeb43", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5a99e926d1c49aacc13faa74ebd5c2c36bb525dc", "url": "https://github.com/apache/camel/commit/5a99e926d1c49aacc13faa74ebd5c2c36bb525dc", "message": "CAMEL-14443 new camel-jira producers\nUpdated PR to follow peer review feedback and match checkstyle", "committedDate": "2020-01-27T19:00:39Z", "type": "commit"}]}