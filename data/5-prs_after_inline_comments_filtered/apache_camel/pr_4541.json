{"pr_number": 4541, "pr_title": "[CAMEL-14003] Add Kubernetes component for the custom resource instance support", "pr_createdAt": "2020-10-30T13:05:59Z", "pr_url": "https://github.com/apache/camel/pull/4541", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA5NjUyNA==", "url": "https://github.com/apache/camel/pull/4541#discussion_r515096524", "bodyText": "Is there a reason for commented part?", "author": "oscerd", "createdAt": "2020-10-30T13:29:05Z", "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/customresources/KubernetesCustomResourcesConsumer.java", "diffHunk": "@@ -0,0 +1,193 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.component.kubernetes.customresources;\n+\n+import java.util.concurrent.ExecutorService;\n+\n+import io.fabric8.kubernetes.client.KubernetesClientException;\n+import io.fabric8.kubernetes.client.Watch;\n+import io.fabric8.kubernetes.client.Watcher;\n+import io.fabric8.kubernetes.client.dsl.base.CustomResourceDefinitionContext;\n+import io.fabric8.kubernetes.client.dsl.internal.RawCustomResourceOperationsImpl;\n+/*\n+import io.fabric8.kubernetes.api.model.apps.Deployment;\n+import io.fabric8.kubernetes.api.model.apps.DeploymentList;\n+import io.fabric8.kubernetes.api.model.apps.DoneableDeployment;\n+import io.fabric8.kubernetes.client.KubernetesClientException;\n+import io.fabric8.kubernetes.client.Watch;\n+import io.fabric8.kubernetes.client.Watcher;\n+import io.fabric8.kubernetes.client.dsl.NonNamespaceOperation;\n+import io.fabric8.kubernetes.client.dsl.RollableScalableResource;\n+*/\n+import org.apache.camel.Exchange;\n+import org.apache.camel.Processor;\n+import org.apache.camel.component.kubernetes.AbstractKubernetesEndpoint;\n+import org.apache.camel.component.kubernetes.KubernetesConfiguration;\n+import org.apache.camel.component.kubernetes.KubernetesConstants;\n+import org.apache.camel.support.DefaultConsumer;\n+import org.apache.camel.util.ObjectHelper;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class KubernetesCustomResourcesConsumer extends DefaultConsumer {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(KubernetesCustomResourcesConsumer.class);\n+\n+    private final Processor processor;\n+    private ExecutorService executor;\n+    private CustomResourcesConsumerTask customResourcesWatcher;\n+\n+    public KubernetesCustomResourcesConsumer(AbstractKubernetesEndpoint endpoint, Processor processor) {\n+        super(endpoint, processor);\n+        this.processor = processor;\n+    }\n+\n+    @Override\n+    public AbstractKubernetesEndpoint getEndpoint() {\n+        return (AbstractKubernetesEndpoint) super.getEndpoint();\n+    }\n+\n+    @Override\n+    protected void doStart() throws Exception {\n+        super.doStart();\n+        executor = getEndpoint().createExecutor();\n+\n+        customResourcesWatcher = new CustomResourcesConsumerTask();\n+        executor.submit(customResourcesWatcher);\n+    }\n+\n+    @Override\n+    protected void doStop() throws Exception {\n+        super.doStop();\n+\n+        LOG.debug(\"Stopping Kubernetes Custom Resources Consumer\");\n+        if (executor != null) {\n+            if (getEndpoint() != null && getEndpoint().getCamelContext() != null) {\n+                if (customResourcesWatcher != null) {\n+                    customResourcesWatcher.getWatch().close();\n+                }\n+                getEndpoint().getCamelContext().getExecutorServiceManager().shutdownNow(executor);\n+            } else {\n+                if (customResourcesWatcher != null) {\n+                    customResourcesWatcher.getWatch().close();\n+                }\n+                executor.shutdownNow();\n+            }\n+        }\n+        executor = null;\n+    }\n+\n+    class CustomResourcesConsumerTask implements Runnable {\n+\n+        private Watch watch;\n+\n+        @Override\n+        public void run() {\n+            RawCustomResourceOperationsImpl w = getEndpoint().getKubernetesClient()\n+                    .customResource(getCRDContext(getEndpoint().getKubernetesConfiguration()));\n+            if (ObjectHelper.isNotEmpty(getEndpoint().getKubernetesConfiguration().getNamespace())) {\n+                LOG.error(\"namespace is not specified.\");\n+            }\n+            String namespace = getEndpoint().getKubernetesConfiguration().getNamespace();\n+            try {\n+                w.watch(namespace, new Watcher<String>() {\n+\n+                    @Override\n+                    public void eventReceived(Action action, String resource) {\n+                        Exchange exchange = getEndpoint().createExchange();\n+                        exchange.getIn().setBody(resource);\n+                        exchange.getIn().setHeader(KubernetesConstants.KUBERNETES_CRD_EVENT_ACTION, action);\n+                        exchange.getIn().setHeader(KubernetesConstants.KUBERNETES_CRD_EVENT_TIMESTAMP,\n+                                System.currentTimeMillis());\n+                        try {\n+                            processor.process(exchange);\n+                        } catch (Exception e) {\n+                            getExceptionHandler().handleException(\"Error during processing\", exchange, e);\n+                        }\n+                    }\n+\n+                    @Override\n+                    public void onClose(KubernetesClientException cause) {\n+                        if (cause != null) {\n+                            LOG.error(cause.getMessage(), cause);\n+                        }\n+\n+                    }\n+                });\n+            } catch (Exception e) {\n+                LOG.error(\"Exception in handling githubsource instance change\", e);\n+            }\n+\n+            /*", "originalCommit": "22400c387df6c0392f85dea22f4aa138639db788", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE4Mjg1OA==", "url": "https://github.com/apache/camel/pull/4541#discussion_r515182858", "bodyText": "No, I forgot to clean up.  I take it out.  Thanks.", "author": "akihikokuroda", "createdAt": "2020-10-30T15:29:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA5NjUyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA5NjY4NQ==", "url": "https://github.com/apache/camel/pull/4541#discussion_r515096685", "bodyText": "firstVersion is wrong", "author": "oscerd", "createdAt": "2020-10-30T13:29:20Z", "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/customresources/KubernetesCustomResourcesEndpoint.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.component.kubernetes.customresources;\n+\n+import org.apache.camel.Category;\n+import org.apache.camel.Consumer;\n+import org.apache.camel.Processor;\n+import org.apache.camel.Producer;\n+import org.apache.camel.component.kubernetes.AbstractKubernetesEndpoint;\n+import org.apache.camel.component.kubernetes.KubernetesConfiguration;\n+import org.apache.camel.spi.UriEndpoint;\n+\n+/**\n+ * Perform operations on Kubernetes Custom Resources and get notified on Deployment changes.\n+ */\n+@UriEndpoint(firstVersion = \"2.20.0\", scheme = \"kubernetes-custom-resources\", title = \"Kubernetes Custom Resources\",", "originalCommit": "22400c387df6c0392f85dea22f4aa138639db788", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE4Mzg4Ng==", "url": "https://github.com/apache/camel/pull/4541#discussion_r515183886", "bodyText": "Thanks!  I change it to 3.7.0.", "author": "akihikokuroda", "createdAt": "2020-10-30T15:30:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA5NjY4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA5ODc2OQ==", "url": "https://github.com/apache/camel/pull/4541#discussion_r515098769", "bodyText": "Please remove commented imports", "author": "oscerd", "createdAt": "2020-10-30T13:32:35Z", "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/customresources/KubernetesCustomResourcesConsumer.java", "diffHunk": "@@ -0,0 +1,193 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.component.kubernetes.customresources;\n+\n+import java.util.concurrent.ExecutorService;\n+\n+import io.fabric8.kubernetes.client.KubernetesClientException;\n+import io.fabric8.kubernetes.client.Watch;\n+import io.fabric8.kubernetes.client.Watcher;\n+import io.fabric8.kubernetes.client.dsl.base.CustomResourceDefinitionContext;\n+import io.fabric8.kubernetes.client.dsl.internal.RawCustomResourceOperationsImpl;\n+/*", "originalCommit": "22400c387df6c0392f85dea22f4aa138639db788", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE4NzE4Ng==", "url": "https://github.com/apache/camel/pull/4541#discussion_r515187186", "bodyText": "Yes, I do.  Thanks!", "author": "akihikokuroda", "createdAt": "2020-10-30T15:34:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA5ODc2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA5OTAyOA==", "url": "https://github.com/apache/camel/pull/4541#discussion_r515099028", "bodyText": "Please use crdGroup cRDGroup is really ugly to read and see :-)", "author": "oscerd", "createdAt": "2020-10-30T13:33:01Z", "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/KubernetesConfiguration.java", "diffHunk": "@@ -105,6 +105,21 @@\n     @UriParam(label = \"advanced\")\n     private Integer connectionTimeout;\n \n+    @UriParam(label = \"consumer\")\n+    private String cRDName;\n+\n+    @UriParam(label = \"consumer\")\n+    private String cRDGroup;", "originalCommit": "22400c387df6c0392f85dea22f4aa138639db788", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIxNzgzOQ==", "url": "https://github.com/apache/camel/pull/4541#discussion_r515217839", "bodyText": "I change.", "author": "akihikokuroda", "createdAt": "2020-10-30T16:20:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA5OTAyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA5OTEyNw==", "url": "https://github.com/apache/camel/pull/4541#discussion_r515099127", "bodyText": "crdName", "author": "oscerd", "createdAt": "2020-10-30T13:33:11Z", "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/KubernetesConfiguration.java", "diffHunk": "@@ -105,6 +105,21 @@\n     @UriParam(label = \"advanced\")\n     private Integer connectionTimeout;\n \n+    @UriParam(label = \"consumer\")\n+    private String cRDName;", "originalCommit": "22400c387df6c0392f85dea22f4aa138639db788", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIxNzc2Ng==", "url": "https://github.com/apache/camel/pull/4541#discussion_r515217766", "bodyText": "I change.", "author": "akihikokuroda", "createdAt": "2020-10-30T16:20:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA5OTEyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA5OTIxNg==", "url": "https://github.com/apache/camel/pull/4541#discussion_r515099216", "bodyText": "crdScope", "author": "oscerd", "createdAt": "2020-10-30T13:33:20Z", "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/KubernetesConfiguration.java", "diffHunk": "@@ -105,6 +105,21 @@\n     @UriParam(label = \"advanced\")\n     private Integer connectionTimeout;\n \n+    @UriParam(label = \"consumer\")\n+    private String cRDName;\n+\n+    @UriParam(label = \"consumer\")\n+    private String cRDGroup;\n+\n+    @UriParam(label = \"consumer\")\n+    private String cRDScope;", "originalCommit": "22400c387df6c0392f85dea22f4aa138639db788", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIxNzY5OQ==", "url": "https://github.com/apache/camel/pull/4541#discussion_r515217699", "bodyText": "I change.", "author": "akihikokuroda", "createdAt": "2020-10-30T16:19:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA5OTIxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA5OTI5NQ==", "url": "https://github.com/apache/camel/pull/4541#discussion_r515099295", "bodyText": "crdVersion", "author": "oscerd", "createdAt": "2020-10-30T13:33:27Z", "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/KubernetesConfiguration.java", "diffHunk": "@@ -105,6 +105,21 @@\n     @UriParam(label = \"advanced\")\n     private Integer connectionTimeout;\n \n+    @UriParam(label = \"consumer\")\n+    private String cRDName;\n+\n+    @UriParam(label = \"consumer\")\n+    private String cRDGroup;\n+\n+    @UriParam(label = \"consumer\")\n+    private String cRDScope;\n+\n+    @UriParam(label = \"consumer\")\n+    private String cRDVersion;", "originalCommit": "22400c387df6c0392f85dea22f4aa138639db788", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIxNzYyOQ==", "url": "https://github.com/apache/camel/pull/4541#discussion_r515217629", "bodyText": "I change.", "author": "akihikokuroda", "createdAt": "2020-10-30T16:19:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA5OTI5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA5OTM3OA==", "url": "https://github.com/apache/camel/pull/4541#discussion_r515099378", "bodyText": "crdPlural", "author": "oscerd", "createdAt": "2020-10-30T13:33:34Z", "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/KubernetesConfiguration.java", "diffHunk": "@@ -105,6 +105,21 @@\n     @UriParam(label = \"advanced\")\n     private Integer connectionTimeout;\n \n+    @UriParam(label = \"consumer\")\n+    private String cRDName;\n+\n+    @UriParam(label = \"consumer\")\n+    private String cRDGroup;\n+\n+    @UriParam(label = \"consumer\")\n+    private String cRDScope;\n+\n+    @UriParam(label = \"consumer\")\n+    private String cRDVersion;\n+\n+    @UriParam(label = \"consumer\")\n+    private String cRDPlural;", "originalCommit": "22400c387df6c0392f85dea22f4aa138639db788", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIxNzUzMg==", "url": "https://github.com/apache/camel/pull/4541#discussion_r515217532", "bodyText": "I change.", "author": "akihikokuroda", "createdAt": "2020-10-30T16:19:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA5OTM3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTEwMDMxNw==", "url": "https://github.com/apache/camel/pull/4541#discussion_r515100317", "bodyText": "No need for this log at info level. Too noisy. At least use debug level.", "author": "oscerd", "createdAt": "2020-10-30T13:34:35Z", "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/customresources/KubernetesCustomResourcesProducer.java", "diffHunk": "@@ -0,0 +1,199 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.component.kubernetes.customresources;\n+\n+import java.util.Map;\n+\n+import io.fabric8.kubernetes.client.KubernetesClientException;\n+import io.fabric8.kubernetes.client.dsl.base.CustomResourceDefinitionContext;\n+import org.apache.camel.Exchange;\n+import org.apache.camel.Message;\n+import org.apache.camel.component.kubernetes.AbstractKubernetesEndpoint;\n+import org.apache.camel.component.kubernetes.KubernetesConstants;\n+import org.apache.camel.component.kubernetes.KubernetesOperations;\n+import org.apache.camel.support.DefaultProducer;\n+import org.apache.camel.support.MessageHelper;\n+import org.apache.camel.util.ObjectHelper;\n+import org.apache.camel.util.json.JsonArray;\n+import org.apache.camel.util.json.JsonObject;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class KubernetesCustomResourcesProducer extends DefaultProducer {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(KubernetesCustomResourcesProducer.class);\n+\n+    public KubernetesCustomResourcesProducer(AbstractKubernetesEndpoint endpoint) {\n+        super(endpoint);\n+    }\n+\n+    @Override\n+    public AbstractKubernetesEndpoint getEndpoint() {\n+        return (AbstractKubernetesEndpoint) super.getEndpoint();\n+    }\n+\n+    @Override\n+    public void process(Exchange exchange) throws Exception {\n+        String operation;\n+\n+        if (ObjectHelper.isEmpty(getEndpoint().getKubernetesConfiguration().getOperation())) {\n+            operation = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_OPERATION, String.class);\n+        } else {\n+            operation = getEndpoint().getKubernetesConfiguration().getOperation();\n+        }\n+\n+        switch (operation) {\n+\n+            case KubernetesOperations.LIST_CUSTOMRESOURCES:\n+                doList(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.LIST_CUSTOMRESOURCES_BY_LABELS_OPERATION:\n+                doListByLabels(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.GET_CUSTOMRESOURCE:\n+                doGet(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.DELETE_CUSTOMRESOURCE:\n+                doDelete(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.CREATE_CUSTOMRESOURCE:\n+                doCreate(exchange, operation);\n+                break;\n+\n+            default:\n+                throw new IllegalArgumentException(\"Unsupported operation \" + operation);\n+        }\n+    }\n+\n+    protected void doList(Exchange exchange, String operation) throws Exception {\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        JsonObject customResourcesListJSON = new JsonObject(\n+                getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).list(namespaceName));\n+        LOG.info(customResourcesListJSON.toString());\n+        JsonArray customResourcesListItems = new JsonArray(customResourcesListJSON.getCollection(\"items\"));\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourcesListItems);\n+    }\n+\n+    protected void doListByLabels(Exchange exchange, String operation) throws Exception {\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        Map<String, String> labels = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_CRD_LABELS, Map.class);\n+        JsonObject customResourcesListJSON = new JsonObject(\n+                getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).list(namespaceName));\n+        LOG.info(customResourcesListJSON.toString());\n+        JsonArray customResourcesListItems = new JsonArray(customResourcesListJSON.getCollection(\"items\"));\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourcesListItems);\n+    }\n+\n+    protected void doGet(Exchange exchange, String operation) throws Exception {\n+        String customResourceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_CRD_INSTANCE_NAME, String.class);\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        if (ObjectHelper.isEmpty(customResourceName)) {\n+            LOG.error(\"Get a specific Deployment require specify a Deployment name\");\n+            throw new IllegalArgumentException(\"Get a specific Deployment require specify a Deployment name\");\n+        }\n+        JsonObject customResourceJSON = new JsonObject();\n+        try {\n+            customResourceJSON = new JsonObject(\n+                    getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).get(namespaceName,\n+                            customResourceName));\n+        } catch (KubernetesClientException e) {\n+            if (e.getCode() == 404) {\n+                LOG.info(\"Custom resource instance not found\", e);\n+            } else {\n+                throw e;\n+            }\n+        }\n+        LOG.info(customResourceJSON.toString());\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourceJSON);\n+    }\n+\n+    protected void doDelete(Exchange exchange, String operation) throws Exception {\n+        String customResourceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_CRD_INSTANCE_NAME, String.class);\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        if (ObjectHelper.isEmpty(customResourceName)) {\n+            LOG.error(\"Delete a specific deployment require specify a deployment name\");\n+            throw new IllegalArgumentException(\"Delete a specific deployment require specify a deployment name\");\n+        }\n+        if (ObjectHelper.isEmpty(namespaceName)) {\n+            LOG.error(\"Delete a specific deployment require specify a namespace name\");\n+            throw new IllegalArgumentException(\"Delete a specific deployment require specify a namespace name\");\n+        }\n+\n+        JsonObject customResourceJSON = new JsonObject();\n+        try {\n+            customResourceJSON = new JsonObject(\n+                    getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).delete(namespaceName,\n+                            customResourceName));\n+        } catch (KubernetesClientException e) {\n+            if (e.getCode() == 404) {\n+                LOG.info(\"Custom resource instance not found\", e);\n+            } else {\n+                throw e;\n+            }\n+        }\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourceJSON);\n+    }\n+\n+    protected void doCreate(Exchange exchange, String operation) throws Exception {\n+        String customResourceInstance = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_CRD_INSTANCE, String.class);\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+\n+        JsonObject gitHubSourceJSON = new JsonObject();\n+        try {\n+            gitHubSourceJSON = new JsonObject(\n+                    getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).create(namespaceName,\n+                            customResourceInstance));\n+        } catch (KubernetesClientException e) {\n+            if (e.getCode() == 409) {\n+                LOG.info(\"Custom resoure instance already exists\", e);\n+            } else {\n+                throw e;\n+            }\n+        }\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(gitHubSourceJSON);\n+    }\n+\n+    private CustomResourceDefinitionContext getCRDContext(Message message) {\n+        LOG.info(\"getCRDContext:\" + message.getHeader(KubernetesConstants.KUBERNETES_CRD_NAME, String.class));", "originalCommit": "22400c387df6c0392f85dea22f4aa138639db788", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIxNzI2MA==", "url": "https://github.com/apache/camel/pull/4541#discussion_r515217260", "bodyText": "Yes, it's too much.  I take them out.  Thanks!", "author": "akihikokuroda", "createdAt": "2020-10-30T16:19:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTEwMDMxNw=="}], "type": "inlineReview"}, {"oid": "4a6afd066b8faa84c68d6ba3a665b85a4c401e5f", "url": "https://github.com/apache/camel/commit/4a6afd066b8faa84c68d6ba3a665b85a4c401e5f", "message": "Add kubernetes custom resource component", "committedDate": "2020-10-30T22:19:58Z", "type": "commit"}, {"oid": "f1e9931a7bbc7e9f42a61bf623d1eae6cb6ebce9", "url": "https://github.com/apache/camel/commit/f1e9931a7bbc7e9f42a61bf623d1eae6cb6ebce9", "message": "undo some files", "committedDate": "2020-10-31T01:10:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgyOTQ1Ng==", "url": "https://github.com/apache/camel/pull/4541#discussion_r515829456", "bodyText": "IMHO I'd stop the camel context last after stopping the executor", "author": "omarsmak", "createdAt": "2020-11-02T09:11:04Z", "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/customresources/KubernetesCustomResourcesConsumer.java", "diffHunk": "@@ -0,0 +1,145 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.component.kubernetes.customresources;\n+\n+import java.util.concurrent.ExecutorService;\n+\n+import io.fabric8.kubernetes.client.KubernetesClientException;\n+import io.fabric8.kubernetes.client.Watch;\n+import io.fabric8.kubernetes.client.Watcher;\n+import io.fabric8.kubernetes.client.dsl.base.CustomResourceDefinitionContext;\n+import io.fabric8.kubernetes.client.dsl.internal.RawCustomResourceOperationsImpl;\n+import org.apache.camel.Exchange;\n+import org.apache.camel.Processor;\n+import org.apache.camel.component.kubernetes.AbstractKubernetesEndpoint;\n+import org.apache.camel.component.kubernetes.KubernetesConfiguration;\n+import org.apache.camel.component.kubernetes.KubernetesConstants;\n+import org.apache.camel.support.DefaultConsumer;\n+import org.apache.camel.util.ObjectHelper;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class KubernetesCustomResourcesConsumer extends DefaultConsumer {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(KubernetesCustomResourcesConsumer.class);\n+\n+    private final Processor processor;\n+    private ExecutorService executor;\n+    private CustomResourcesConsumerTask customResourcesWatcher;\n+\n+    public KubernetesCustomResourcesConsumer(AbstractKubernetesEndpoint endpoint, Processor processor) {\n+        super(endpoint, processor);\n+        this.processor = processor;\n+    }\n+\n+    @Override\n+    public AbstractKubernetesEndpoint getEndpoint() {\n+        return (AbstractKubernetesEndpoint) super.getEndpoint();\n+    }\n+\n+    @Override\n+    protected void doStart() throws Exception {\n+        super.doStart();\n+        executor = getEndpoint().createExecutor();\n+\n+        customResourcesWatcher = new CustomResourcesConsumerTask();\n+        executor.submit(customResourcesWatcher);\n+    }\n+\n+    @Override\n+    protected void doStop() throws Exception {\n+        super.doStop();", "originalCommit": "f1e9931a7bbc7e9f42a61bf623d1eae6cb6ebce9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA0OTgzOA==", "url": "https://github.com/apache/camel/pull/4541#discussion_r516049838", "bodyText": "Thanks!  I move the call.", "author": "akihikokuroda", "createdAt": "2020-11-02T15:27:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgyOTQ1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgyOTkzNg==", "url": "https://github.com/apache/camel/pull/4541#discussion_r515829936", "bodyText": "Can we have more meaningful name instead of w?", "author": "omarsmak", "createdAt": "2020-11-02T09:11:56Z", "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/customresources/KubernetesCustomResourcesConsumer.java", "diffHunk": "@@ -0,0 +1,145 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.component.kubernetes.customresources;\n+\n+import java.util.concurrent.ExecutorService;\n+\n+import io.fabric8.kubernetes.client.KubernetesClientException;\n+import io.fabric8.kubernetes.client.Watch;\n+import io.fabric8.kubernetes.client.Watcher;\n+import io.fabric8.kubernetes.client.dsl.base.CustomResourceDefinitionContext;\n+import io.fabric8.kubernetes.client.dsl.internal.RawCustomResourceOperationsImpl;\n+import org.apache.camel.Exchange;\n+import org.apache.camel.Processor;\n+import org.apache.camel.component.kubernetes.AbstractKubernetesEndpoint;\n+import org.apache.camel.component.kubernetes.KubernetesConfiguration;\n+import org.apache.camel.component.kubernetes.KubernetesConstants;\n+import org.apache.camel.support.DefaultConsumer;\n+import org.apache.camel.util.ObjectHelper;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class KubernetesCustomResourcesConsumer extends DefaultConsumer {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(KubernetesCustomResourcesConsumer.class);\n+\n+    private final Processor processor;\n+    private ExecutorService executor;\n+    private CustomResourcesConsumerTask customResourcesWatcher;\n+\n+    public KubernetesCustomResourcesConsumer(AbstractKubernetesEndpoint endpoint, Processor processor) {\n+        super(endpoint, processor);\n+        this.processor = processor;\n+    }\n+\n+    @Override\n+    public AbstractKubernetesEndpoint getEndpoint() {\n+        return (AbstractKubernetesEndpoint) super.getEndpoint();\n+    }\n+\n+    @Override\n+    protected void doStart() throws Exception {\n+        super.doStart();\n+        executor = getEndpoint().createExecutor();\n+\n+        customResourcesWatcher = new CustomResourcesConsumerTask();\n+        executor.submit(customResourcesWatcher);\n+    }\n+\n+    @Override\n+    protected void doStop() throws Exception {\n+        super.doStop();\n+\n+        LOG.debug(\"Stopping Kubernetes Custom Resources Consumer\");\n+        if (executor != null) {\n+            if (getEndpoint() != null && getEndpoint().getCamelContext() != null) {\n+                if (customResourcesWatcher != null) {\n+                    customResourcesWatcher.getWatch().close();\n+                }\n+                getEndpoint().getCamelContext().getExecutorServiceManager().shutdownNow(executor);\n+            } else {\n+                if (customResourcesWatcher != null) {\n+                    customResourcesWatcher.getWatch().close();\n+                }\n+                executor.shutdownNow();\n+            }\n+        }\n+        executor = null;\n+    }\n+\n+    class CustomResourcesConsumerTask implements Runnable {\n+\n+        private Watch watch;\n+\n+        @Override\n+        public void run() {\n+            RawCustomResourceOperationsImpl w = getEndpoint().getKubernetesClient()", "originalCommit": "f1e9931a7bbc7e9f42a61bf623d1eae6cb6ebce9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA1MzM5Nw==", "url": "https://github.com/apache/camel/pull/4541#discussion_r516053397", "bodyText": "I change it to operations.", "author": "akihikokuroda", "createdAt": "2020-11-02T15:31:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgyOTkzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgzOTQ0NA==", "url": "https://github.com/apache/camel/pull/4541#discussion_r515839444", "bodyText": "The namespace here is essential for the operation, isn't? If so, can we add checks for the required options (in this operation and the other operation) that being obtained from the headers and throw an exception with meaningful message to the user?", "author": "omarsmak", "createdAt": "2020-11-02T09:28:00Z", "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/customresources/KubernetesCustomResourcesProducer.java", "diffHunk": "@@ -0,0 +1,194 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.component.kubernetes.customresources;\n+\n+import java.util.Map;\n+\n+import io.fabric8.kubernetes.client.KubernetesClientException;\n+import io.fabric8.kubernetes.client.dsl.base.CustomResourceDefinitionContext;\n+import org.apache.camel.Exchange;\n+import org.apache.camel.Message;\n+import org.apache.camel.component.kubernetes.AbstractKubernetesEndpoint;\n+import org.apache.camel.component.kubernetes.KubernetesConstants;\n+import org.apache.camel.component.kubernetes.KubernetesOperations;\n+import org.apache.camel.support.DefaultProducer;\n+import org.apache.camel.support.MessageHelper;\n+import org.apache.camel.util.ObjectHelper;\n+import org.apache.camel.util.json.JsonArray;\n+import org.apache.camel.util.json.JsonObject;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class KubernetesCustomResourcesProducer extends DefaultProducer {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(KubernetesCustomResourcesProducer.class);\n+\n+    public KubernetesCustomResourcesProducer(AbstractKubernetesEndpoint endpoint) {\n+        super(endpoint);\n+    }\n+\n+    @Override\n+    public AbstractKubernetesEndpoint getEndpoint() {\n+        return (AbstractKubernetesEndpoint) super.getEndpoint();\n+    }\n+\n+    @Override\n+    public void process(Exchange exchange) throws Exception {\n+        String operation;\n+\n+        if (ObjectHelper.isEmpty(getEndpoint().getKubernetesConfiguration().getOperation())) {\n+            operation = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_OPERATION, String.class);\n+        } else {\n+            operation = getEndpoint().getKubernetesConfiguration().getOperation();\n+        }\n+\n+        switch (operation) {\n+\n+            case KubernetesOperations.LIST_CUSTOMRESOURCES:\n+                doList(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.LIST_CUSTOMRESOURCES_BY_LABELS_OPERATION:\n+                doListByLabels(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.GET_CUSTOMRESOURCE:\n+                doGet(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.DELETE_CUSTOMRESOURCE:\n+                doDelete(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.CREATE_CUSTOMRESOURCE:\n+                doCreate(exchange, operation);\n+                break;\n+\n+            default:\n+                throw new IllegalArgumentException(\"Unsupported operation \" + operation);\n+        }\n+    }\n+\n+    protected void doList(Exchange exchange, String operation) throws Exception {\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);", "originalCommit": "f1e9931a7bbc7e9f42a61bf623d1eae6cb6ebce9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA2MTYwOA==", "url": "https://github.com/apache/camel/pull/4541#discussion_r516061608", "bodyText": "All operations require the namespace argument so I add check the check in the process mentod.", "author": "akihikokuroda", "createdAt": "2020-11-02T15:42:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgzOTQ0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg0NTY2NQ==", "url": "https://github.com/apache/camel/pull/4541#discussion_r515845665", "bodyText": "Apart from my other comment, I think these configurations can be obtained either from the endpoint configurations or the exchange headers, not only the exchange headers, isn't? If so, IMHO, I'd add a logic to first check if these options being set in the exchange headers first and fall back to the endpoint options aka KubernetesConfiguration.", "author": "omarsmak", "createdAt": "2020-11-02T09:38:32Z", "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/customresources/KubernetesCustomResourcesProducer.java", "diffHunk": "@@ -0,0 +1,194 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.component.kubernetes.customresources;\n+\n+import java.util.Map;\n+\n+import io.fabric8.kubernetes.client.KubernetesClientException;\n+import io.fabric8.kubernetes.client.dsl.base.CustomResourceDefinitionContext;\n+import org.apache.camel.Exchange;\n+import org.apache.camel.Message;\n+import org.apache.camel.component.kubernetes.AbstractKubernetesEndpoint;\n+import org.apache.camel.component.kubernetes.KubernetesConstants;\n+import org.apache.camel.component.kubernetes.KubernetesOperations;\n+import org.apache.camel.support.DefaultProducer;\n+import org.apache.camel.support.MessageHelper;\n+import org.apache.camel.util.ObjectHelper;\n+import org.apache.camel.util.json.JsonArray;\n+import org.apache.camel.util.json.JsonObject;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class KubernetesCustomResourcesProducer extends DefaultProducer {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(KubernetesCustomResourcesProducer.class);\n+\n+    public KubernetesCustomResourcesProducer(AbstractKubernetesEndpoint endpoint) {\n+        super(endpoint);\n+    }\n+\n+    @Override\n+    public AbstractKubernetesEndpoint getEndpoint() {\n+        return (AbstractKubernetesEndpoint) super.getEndpoint();\n+    }\n+\n+    @Override\n+    public void process(Exchange exchange) throws Exception {\n+        String operation;\n+\n+        if (ObjectHelper.isEmpty(getEndpoint().getKubernetesConfiguration().getOperation())) {\n+            operation = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_OPERATION, String.class);\n+        } else {\n+            operation = getEndpoint().getKubernetesConfiguration().getOperation();\n+        }\n+\n+        switch (operation) {\n+\n+            case KubernetesOperations.LIST_CUSTOMRESOURCES:\n+                doList(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.LIST_CUSTOMRESOURCES_BY_LABELS_OPERATION:\n+                doListByLabels(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.GET_CUSTOMRESOURCE:\n+                doGet(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.DELETE_CUSTOMRESOURCE:\n+                doDelete(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.CREATE_CUSTOMRESOURCE:\n+                doCreate(exchange, operation);\n+                break;\n+\n+            default:\n+                throw new IllegalArgumentException(\"Unsupported operation \" + operation);\n+        }\n+    }\n+\n+    protected void doList(Exchange exchange, String operation) throws Exception {\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        JsonObject customResourcesListJSON = new JsonObject(\n+                getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).list(namespaceName));\n+        LOG.info(customResourcesListJSON.toString());\n+        JsonArray customResourcesListItems = new JsonArray(customResourcesListJSON.getCollection(\"items\"));\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourcesListItems);\n+    }\n+\n+    protected void doListByLabels(Exchange exchange, String operation) throws Exception {\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);", "originalCommit": "f1e9931a7bbc7e9f42a61bf623d1eae6cb6ebce9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA2OTY0Mg==", "url": "https://github.com/apache/camel/pull/4541#discussion_r516069642", "bodyText": "Thanks!  I'll add it.", "author": "akihikokuroda", "createdAt": "2020-11-02T15:53:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg0NTY2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg0NzUyOQ==", "url": "https://github.com/apache/camel/pull/4541#discussion_r515847529", "bodyText": "Also here, if not mistaken, all these options are required for the CRD context, isn't? Then checks here would help if this option is set or not and throw an exception with meaningful message to the user.", "author": "omarsmak", "createdAt": "2020-11-02T09:41:36Z", "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/customresources/KubernetesCustomResourcesProducer.java", "diffHunk": "@@ -0,0 +1,194 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.component.kubernetes.customresources;\n+\n+import java.util.Map;\n+\n+import io.fabric8.kubernetes.client.KubernetesClientException;\n+import io.fabric8.kubernetes.client.dsl.base.CustomResourceDefinitionContext;\n+import org.apache.camel.Exchange;\n+import org.apache.camel.Message;\n+import org.apache.camel.component.kubernetes.AbstractKubernetesEndpoint;\n+import org.apache.camel.component.kubernetes.KubernetesConstants;\n+import org.apache.camel.component.kubernetes.KubernetesOperations;\n+import org.apache.camel.support.DefaultProducer;\n+import org.apache.camel.support.MessageHelper;\n+import org.apache.camel.util.ObjectHelper;\n+import org.apache.camel.util.json.JsonArray;\n+import org.apache.camel.util.json.JsonObject;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class KubernetesCustomResourcesProducer extends DefaultProducer {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(KubernetesCustomResourcesProducer.class);\n+\n+    public KubernetesCustomResourcesProducer(AbstractKubernetesEndpoint endpoint) {\n+        super(endpoint);\n+    }\n+\n+    @Override\n+    public AbstractKubernetesEndpoint getEndpoint() {\n+        return (AbstractKubernetesEndpoint) super.getEndpoint();\n+    }\n+\n+    @Override\n+    public void process(Exchange exchange) throws Exception {\n+        String operation;\n+\n+        if (ObjectHelper.isEmpty(getEndpoint().getKubernetesConfiguration().getOperation())) {\n+            operation = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_OPERATION, String.class);\n+        } else {\n+            operation = getEndpoint().getKubernetesConfiguration().getOperation();\n+        }\n+\n+        switch (operation) {\n+\n+            case KubernetesOperations.LIST_CUSTOMRESOURCES:\n+                doList(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.LIST_CUSTOMRESOURCES_BY_LABELS_OPERATION:\n+                doListByLabels(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.GET_CUSTOMRESOURCE:\n+                doGet(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.DELETE_CUSTOMRESOURCE:\n+                doDelete(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.CREATE_CUSTOMRESOURCE:\n+                doCreate(exchange, operation);\n+                break;\n+\n+            default:\n+                throw new IllegalArgumentException(\"Unsupported operation \" + operation);\n+        }\n+    }\n+\n+    protected void doList(Exchange exchange, String operation) throws Exception {\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        JsonObject customResourcesListJSON = new JsonObject(\n+                getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).list(namespaceName));\n+        LOG.info(customResourcesListJSON.toString());\n+        JsonArray customResourcesListItems = new JsonArray(customResourcesListJSON.getCollection(\"items\"));\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourcesListItems);\n+    }\n+\n+    protected void doListByLabels(Exchange exchange, String operation) throws Exception {\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        Map<String, String> labels = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_CRD_LABELS, Map.class);\n+        JsonObject customResourcesListJSON = new JsonObject(\n+                getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).list(namespaceName));\n+        LOG.info(customResourcesListJSON.toString());\n+        JsonArray customResourcesListItems = new JsonArray(customResourcesListJSON.getCollection(\"items\"));\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourcesListItems);\n+    }\n+\n+    protected void doGet(Exchange exchange, String operation) throws Exception {\n+        String customResourceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_CRD_INSTANCE_NAME, String.class);\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        if (ObjectHelper.isEmpty(customResourceName)) {\n+            LOG.error(\"Get a specific Deployment require specify a Deployment name\");\n+            throw new IllegalArgumentException(\"Get a specific Deployment require specify a Deployment name\");\n+        }\n+        JsonObject customResourceJSON = new JsonObject();\n+        try {\n+            customResourceJSON = new JsonObject(\n+                    getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).get(namespaceName,\n+                            customResourceName));\n+        } catch (KubernetesClientException e) {\n+            if (e.getCode() == 404) {\n+                LOG.info(\"Custom resource instance not found\", e);\n+            } else {\n+                throw e;\n+            }\n+        }\n+        LOG.info(customResourceJSON.toString());\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourceJSON);\n+    }\n+\n+    protected void doDelete(Exchange exchange, String operation) throws Exception {\n+        String customResourceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_CRD_INSTANCE_NAME, String.class);\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        if (ObjectHelper.isEmpty(customResourceName)) {\n+            LOG.error(\"Delete a specific deployment require specify a deployment name\");\n+            throw new IllegalArgumentException(\"Delete a specific deployment require specify a deployment name\");\n+        }\n+        if (ObjectHelper.isEmpty(namespaceName)) {\n+            LOG.error(\"Delete a specific deployment require specify a namespace name\");\n+            throw new IllegalArgumentException(\"Delete a specific deployment require specify a namespace name\");\n+        }\n+\n+        JsonObject customResourceJSON = new JsonObject();\n+        try {\n+            customResourceJSON = new JsonObject(\n+                    getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).delete(namespaceName,\n+                            customResourceName));\n+        } catch (KubernetesClientException e) {\n+            if (e.getCode() == 404) {\n+                LOG.info(\"Custom resource instance not found\", e);\n+            } else {\n+                throw e;\n+            }\n+        }\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourceJSON);\n+    }\n+\n+    protected void doCreate(Exchange exchange, String operation) throws Exception {\n+        String customResourceInstance = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_CRD_INSTANCE, String.class);\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+\n+        JsonObject gitHubSourceJSON = new JsonObject();\n+        try {\n+            gitHubSourceJSON = new JsonObject(\n+                    getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).create(namespaceName,\n+                            customResourceInstance));\n+        } catch (KubernetesClientException e) {\n+            if (e.getCode() == 409) {\n+                LOG.info(\"Custom resoure instance already exists\", e);\n+            } else {\n+                throw e;\n+            }\n+        }\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(gitHubSourceJSON);\n+    }\n+\n+    private CustomResourceDefinitionContext getCRDContext(Message message) {\n+        CustomResourceDefinitionContext cRDContext = new CustomResourceDefinitionContext.Builder()\n+                .withName(message.getHeader(KubernetesConstants.KUBERNETES_CRD_NAME, String.class))       // example: \"githubsources.sources.knative.dev\"", "originalCommit": "f1e9931a7bbc7e9f42a61bf623d1eae6cb6ebce9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA4NDg3NQ==", "url": "https://github.com/apache/camel/pull/4541#discussion_r516084875", "bodyText": "Thanks!  I add check for these arguments.", "author": "akihikokuroda", "createdAt": "2020-11-02T16:15:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg0NzUyOQ=="}], "type": "inlineReview"}, {"oid": "7ddee9dd8b14f441ef844cc08d4f2c170104547d", "url": "https://github.com/apache/camel/commit/7ddee9dd8b14f441ef844cc08d4f2c170104547d", "message": "review comments", "committedDate": "2020-11-02T19:40:13Z", "type": "commit"}, {"oid": "54b3fd3e5ff7558d3d579a3f30d122336fdcaddd", "url": "https://github.com/apache/camel/commit/54b3fd3e5ff7558d3d579a3f30d122336fdcaddd", "message": "Fix style error", "committedDate": "2020-11-02T20:29:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ5MTk5OA==", "url": "https://github.com/apache/camel/pull/4541#discussion_r516491998", "bodyText": "You can remove LOG.error instances since you are already throwing an exception.", "author": "omarsmak", "createdAt": "2020-11-03T08:27:55Z", "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/customresources/KubernetesCustomResourcesProducer.java", "diffHunk": "@@ -0,0 +1,245 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.component.kubernetes.customresources;\n+\n+import java.util.Map;\n+\n+import io.fabric8.kubernetes.client.KubernetesClientException;\n+import io.fabric8.kubernetes.client.dsl.base.CustomResourceDefinitionContext;\n+import org.apache.camel.Exchange;\n+import org.apache.camel.Message;\n+import org.apache.camel.component.kubernetes.AbstractKubernetesEndpoint;\n+import org.apache.camel.component.kubernetes.KubernetesConstants;\n+import org.apache.camel.component.kubernetes.KubernetesOperations;\n+import org.apache.camel.support.DefaultProducer;\n+import org.apache.camel.support.MessageHelper;\n+import org.apache.camel.util.ObjectHelper;\n+import org.apache.camel.util.json.JsonArray;\n+import org.apache.camel.util.json.JsonObject;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class KubernetesCustomResourcesProducer extends DefaultProducer {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(KubernetesCustomResourcesProducer.class);\n+\n+    public KubernetesCustomResourcesProducer(AbstractKubernetesEndpoint endpoint) {\n+        super(endpoint);\n+    }\n+\n+    @Override\n+    public AbstractKubernetesEndpoint getEndpoint() {\n+        return (AbstractKubernetesEndpoint) super.getEndpoint();\n+    }\n+\n+    @Override\n+    public void process(Exchange exchange) throws Exception {\n+        String operation;\n+        String namespace;\n+\n+        if (ObjectHelper.isEmpty(getEndpoint().getKubernetesConfiguration().getOperation())) {\n+            operation = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_OPERATION, String.class);\n+        } else {\n+            operation = getEndpoint().getKubernetesConfiguration().getOperation();\n+        }\n+        if (ObjectHelper.isEmpty(getEndpoint().getKubernetesConfiguration().getNamespace())) {\n+            namespace = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        } else {\n+            namespace = getEndpoint().getKubernetesConfiguration().getNamespace();\n+        }\n+        if (ObjectHelper.isEmpty(namespace)) {\n+            throw new IllegalArgumentException(\"Custom Resource producer requires a namespace argument\");\n+        }\n+\n+        switch (operation) {\n+\n+            case KubernetesOperations.LIST_CUSTOMRESOURCES:\n+                doList(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.LIST_CUSTOMRESOURCES_BY_LABELS_OPERATION:\n+                doListByLabels(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.GET_CUSTOMRESOURCE:\n+                doGet(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.DELETE_CUSTOMRESOURCE:\n+                doDelete(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.CREATE_CUSTOMRESOURCE:\n+                doCreate(exchange, operation);\n+                break;\n+\n+            default:\n+                throw new IllegalArgumentException(\"Unsupported operation \" + operation);\n+        }\n+    }\n+\n+    protected void doList(Exchange exchange, String operation) throws Exception {\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        JsonObject customResourcesListJSON = new JsonObject(\n+                getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).list(namespaceName));\n+        LOG.info(customResourcesListJSON.toString());\n+\n+        JsonArray customResourcesListItems;\n+        if (customResourcesListJSON.getCollection(\"items\") != null) {\n+            customResourcesListItems = new JsonArray(customResourcesListJSON.getCollection(\"items\"));\n+        } else {\n+            customResourcesListItems = new JsonArray();\n+        }\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourcesListItems);\n+    }\n+\n+    protected void doListByLabels(Exchange exchange, String operation) throws Exception {\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        Map<String, String> labels = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_CRD_LABELS, Map.class);\n+        JsonObject customResourcesListJSON = new JsonObject(\n+                getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).list(namespaceName));\n+        LOG.info(customResourcesListJSON.toString());\n+        JsonArray customResourcesListItems = new JsonArray(customResourcesListJSON.getCollection(\"items\"));\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourcesListItems);\n+    }\n+\n+    protected void doGet(Exchange exchange, String operation) throws Exception {\n+        String customResourceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_CRD_INSTANCE_NAME, String.class);\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        if (ObjectHelper.isEmpty(customResourceName)) {\n+            LOG.error(\"Get a specific Deployment require specify a Deployment name\");", "originalCommit": "54b3fd3e5ff7558d3d579a3f30d122336fdcaddd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY1ODE2Mg==", "url": "https://github.com/apache/camel/pull/4541#discussion_r516658162", "bodyText": "OK. I take it out.", "author": "akihikokuroda", "createdAt": "2020-11-03T13:17:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ5MTk5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ5NDUxNg==", "url": "https://github.com/apache/camel/pull/4541#discussion_r516494516", "bodyText": "Since you are already obtaining the namespace here, would it be more efficient to just pass the obtained namespace to the functions instead of re-obtaining the namespace again?", "author": "omarsmak", "createdAt": "2020-11-03T08:32:46Z", "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/customresources/KubernetesCustomResourcesProducer.java", "diffHunk": "@@ -0,0 +1,245 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.component.kubernetes.customresources;\n+\n+import java.util.Map;\n+\n+import io.fabric8.kubernetes.client.KubernetesClientException;\n+import io.fabric8.kubernetes.client.dsl.base.CustomResourceDefinitionContext;\n+import org.apache.camel.Exchange;\n+import org.apache.camel.Message;\n+import org.apache.camel.component.kubernetes.AbstractKubernetesEndpoint;\n+import org.apache.camel.component.kubernetes.KubernetesConstants;\n+import org.apache.camel.component.kubernetes.KubernetesOperations;\n+import org.apache.camel.support.DefaultProducer;\n+import org.apache.camel.support.MessageHelper;\n+import org.apache.camel.util.ObjectHelper;\n+import org.apache.camel.util.json.JsonArray;\n+import org.apache.camel.util.json.JsonObject;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class KubernetesCustomResourcesProducer extends DefaultProducer {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(KubernetesCustomResourcesProducer.class);\n+\n+    public KubernetesCustomResourcesProducer(AbstractKubernetesEndpoint endpoint) {\n+        super(endpoint);\n+    }\n+\n+    @Override\n+    public AbstractKubernetesEndpoint getEndpoint() {\n+        return (AbstractKubernetesEndpoint) super.getEndpoint();\n+    }\n+\n+    @Override\n+    public void process(Exchange exchange) throws Exception {\n+        String operation;\n+        String namespace;\n+\n+        if (ObjectHelper.isEmpty(getEndpoint().getKubernetesConfiguration().getOperation())) {\n+            operation = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_OPERATION, String.class);\n+        } else {\n+            operation = getEndpoint().getKubernetesConfiguration().getOperation();\n+        }\n+        if (ObjectHelper.isEmpty(getEndpoint().getKubernetesConfiguration().getNamespace())) {\n+            namespace = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        } else {\n+            namespace = getEndpoint().getKubernetesConfiguration().getNamespace();\n+        }\n+        if (ObjectHelper.isEmpty(namespace)) {\n+            throw new IllegalArgumentException(\"Custom Resource producer requires a namespace argument\");\n+        }\n+\n+        switch (operation) {\n+\n+            case KubernetesOperations.LIST_CUSTOMRESOURCES:\n+                doList(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.LIST_CUSTOMRESOURCES_BY_LABELS_OPERATION:\n+                doListByLabels(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.GET_CUSTOMRESOURCE:\n+                doGet(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.DELETE_CUSTOMRESOURCE:\n+                doDelete(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.CREATE_CUSTOMRESOURCE:\n+                doCreate(exchange, operation);\n+                break;\n+\n+            default:\n+                throw new IllegalArgumentException(\"Unsupported operation \" + operation);\n+        }\n+    }\n+\n+    protected void doList(Exchange exchange, String operation) throws Exception {\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        JsonObject customResourcesListJSON = new JsonObject(\n+                getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).list(namespaceName));\n+        LOG.info(customResourcesListJSON.toString());\n+\n+        JsonArray customResourcesListItems;\n+        if (customResourcesListJSON.getCollection(\"items\") != null) {\n+            customResourcesListItems = new JsonArray(customResourcesListJSON.getCollection(\"items\"));\n+        } else {\n+            customResourcesListItems = new JsonArray();\n+        }\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourcesListItems);\n+    }\n+\n+    protected void doListByLabels(Exchange exchange, String operation) throws Exception {\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        Map<String, String> labels = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_CRD_LABELS, Map.class);\n+        JsonObject customResourcesListJSON = new JsonObject(\n+                getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).list(namespaceName));\n+        LOG.info(customResourcesListJSON.toString());\n+        JsonArray customResourcesListItems = new JsonArray(customResourcesListJSON.getCollection(\"items\"));\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourcesListItems);\n+    }\n+\n+    protected void doGet(Exchange exchange, String operation) throws Exception {\n+        String customResourceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_CRD_INSTANCE_NAME, String.class);\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);", "originalCommit": "54b3fd3e5ff7558d3d579a3f30d122336fdcaddd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY1ODk3Nw==", "url": "https://github.com/apache/camel/pull/4541#discussion_r516658977", "bodyText": "OK.  I make changes.  Thanks!", "author": "akihikokuroda", "createdAt": "2020-11-03T13:18:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ5NDUxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ5NTYwNw==", "url": "https://github.com/apache/camel/pull/4541#discussion_r516495607", "bodyText": "I think this check here is not needed since you are already checking for the namespace in the process method", "author": "omarsmak", "createdAt": "2020-11-03T08:34:56Z", "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/customresources/KubernetesCustomResourcesProducer.java", "diffHunk": "@@ -0,0 +1,245 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.component.kubernetes.customresources;\n+\n+import java.util.Map;\n+\n+import io.fabric8.kubernetes.client.KubernetesClientException;\n+import io.fabric8.kubernetes.client.dsl.base.CustomResourceDefinitionContext;\n+import org.apache.camel.Exchange;\n+import org.apache.camel.Message;\n+import org.apache.camel.component.kubernetes.AbstractKubernetesEndpoint;\n+import org.apache.camel.component.kubernetes.KubernetesConstants;\n+import org.apache.camel.component.kubernetes.KubernetesOperations;\n+import org.apache.camel.support.DefaultProducer;\n+import org.apache.camel.support.MessageHelper;\n+import org.apache.camel.util.ObjectHelper;\n+import org.apache.camel.util.json.JsonArray;\n+import org.apache.camel.util.json.JsonObject;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class KubernetesCustomResourcesProducer extends DefaultProducer {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(KubernetesCustomResourcesProducer.class);\n+\n+    public KubernetesCustomResourcesProducer(AbstractKubernetesEndpoint endpoint) {\n+        super(endpoint);\n+    }\n+\n+    @Override\n+    public AbstractKubernetesEndpoint getEndpoint() {\n+        return (AbstractKubernetesEndpoint) super.getEndpoint();\n+    }\n+\n+    @Override\n+    public void process(Exchange exchange) throws Exception {\n+        String operation;\n+        String namespace;\n+\n+        if (ObjectHelper.isEmpty(getEndpoint().getKubernetesConfiguration().getOperation())) {\n+            operation = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_OPERATION, String.class);\n+        } else {\n+            operation = getEndpoint().getKubernetesConfiguration().getOperation();\n+        }\n+        if (ObjectHelper.isEmpty(getEndpoint().getKubernetesConfiguration().getNamespace())) {\n+            namespace = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        } else {\n+            namespace = getEndpoint().getKubernetesConfiguration().getNamespace();\n+        }\n+        if (ObjectHelper.isEmpty(namespace)) {\n+            throw new IllegalArgumentException(\"Custom Resource producer requires a namespace argument\");\n+        }\n+\n+        switch (operation) {\n+\n+            case KubernetesOperations.LIST_CUSTOMRESOURCES:\n+                doList(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.LIST_CUSTOMRESOURCES_BY_LABELS_OPERATION:\n+                doListByLabels(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.GET_CUSTOMRESOURCE:\n+                doGet(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.DELETE_CUSTOMRESOURCE:\n+                doDelete(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.CREATE_CUSTOMRESOURCE:\n+                doCreate(exchange, operation);\n+                break;\n+\n+            default:\n+                throw new IllegalArgumentException(\"Unsupported operation \" + operation);\n+        }\n+    }\n+\n+    protected void doList(Exchange exchange, String operation) throws Exception {\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        JsonObject customResourcesListJSON = new JsonObject(\n+                getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).list(namespaceName));\n+        LOG.info(customResourcesListJSON.toString());\n+\n+        JsonArray customResourcesListItems;\n+        if (customResourcesListJSON.getCollection(\"items\") != null) {\n+            customResourcesListItems = new JsonArray(customResourcesListJSON.getCollection(\"items\"));\n+        } else {\n+            customResourcesListItems = new JsonArray();\n+        }\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourcesListItems);\n+    }\n+\n+    protected void doListByLabels(Exchange exchange, String operation) throws Exception {\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        Map<String, String> labels = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_CRD_LABELS, Map.class);\n+        JsonObject customResourcesListJSON = new JsonObject(\n+                getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).list(namespaceName));\n+        LOG.info(customResourcesListJSON.toString());\n+        JsonArray customResourcesListItems = new JsonArray(customResourcesListJSON.getCollection(\"items\"));\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourcesListItems);\n+    }\n+\n+    protected void doGet(Exchange exchange, String operation) throws Exception {\n+        String customResourceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_CRD_INSTANCE_NAME, String.class);\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        if (ObjectHelper.isEmpty(customResourceName)) {\n+            LOG.error(\"Get a specific Deployment require specify a Deployment name\");\n+            throw new IllegalArgumentException(\"Get a specific Deployment require specify a Deployment name\");\n+        }\n+        JsonObject customResourceJSON = new JsonObject();\n+        try {\n+            customResourceJSON = new JsonObject(\n+                    getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).get(namespaceName,\n+                            customResourceName));\n+        } catch (KubernetesClientException e) {\n+            if (e.getCode() == 404) {\n+                LOG.info(\"Custom resource instance not found\", e);\n+            } else {\n+                throw e;\n+            }\n+        }\n+        LOG.info(customResourceJSON.toString());\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourceJSON);\n+    }\n+\n+    protected void doDelete(Exchange exchange, String operation) throws Exception {\n+        String customResourceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_CRD_INSTANCE_NAME, String.class);\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        if (ObjectHelper.isEmpty(customResourceName)) {\n+            LOG.error(\"Delete a specific deployment require specify a deployment name\");\n+            throw new IllegalArgumentException(\"Delete a specific deployment require specify a deployment name\");\n+        }\n+        if (ObjectHelper.isEmpty(namespaceName)) {", "originalCommit": "54b3fd3e5ff7558d3d579a3f30d122336fdcaddd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY1ODAyMw==", "url": "https://github.com/apache/camel/pull/4541#discussion_r516658023", "bodyText": "OK.  I take it out.", "author": "akihikokuroda", "createdAt": "2020-11-03T13:17:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ5NTYwNw=="}], "type": "inlineReview"}, {"oid": "24f01e62ad93d0c0ee7c605d794b70c357c42521", "url": "https://github.com/apache/camel/commit/24f01e62ad93d0c0ee7c605d794b70c357c42521", "message": "review comments", "committedDate": "2020-11-03T13:25:27Z", "type": "commit"}]}