{"pr_number": 3245, "pr_title": "Avoid system default locale in unit tests", "pr_createdAt": "2020-11-12T11:17:26Z", "pr_url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3245", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjE3MzQ2Mw==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3245#discussion_r522173463", "bodyText": "I would like to se a tearDown method where you set the default locale back. The reason is that if another test have the same issue as this on it might run ok/not ok depending on running before or after this test. Vi do not want to set the locale for every test - witch also solve it.", "author": "t2gran", "createdAt": "2020-11-12T15:02:56Z", "path": "src/test/java/org/opentripplanner/graph_builder/module/osm/TestOpenStreetMapGraphBuilder.java", "diffHunk": "@@ -39,6 +39,7 @@\n     @Before\n     public void setUp() {\n         extra = new HashMap<>();\n+        Locale.setDefault(new Locale(\"en\", \"US\"));", "originalCommit": "91e5c4085b4a19246ba14fa2cf1cd587baa2bcc7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjY5MjgxMQ==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3245#discussion_r522692811", "bodyText": "As general functionality I think server software that depends on system locale is a bit oddity. It would be preferred to choose locale settings per served request using e.g. Accept-Language HTTP header. However docs/Configuration.md do contain documented option to set default locale, which I believe override system locale (which is probably LANG=C in most instances anyway).\nSo I was thinking also alternatively to just remove this one line from unit test that depends on system locale to avoid changing the locale settings \n  \n    \n      OpenTripPlanner/src/test/java/org/opentripplanner/graph_builder/module/osm/TestOpenStreetMapGraphBuilder.java\n    \n    \n         Line 308\n      in\n      5b55cdf\n    \n    \n    \n    \n\n        \n          \n           assertEquals(\"corner of first and second\", localizedString.toString()); \n        \n    \n  \n\n\nBut adding tearDown is of course a correct way to handle this in case there would be more unit tests depending on system lcoale.", "author": "tvainika", "createdAt": "2020-11-13T06:49:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjE3MzQ2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjk2ODYwOQ==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3245#discussion_r522968609", "bodyText": "I totally agree that we should cleanup the TimeZone  issues in OTP, but it is a bigger task and I believe there is an issue for it. But, until then all tests that depend on the system timezone (which we should not do) should use the setup and tearDown. Removing the test line is also OK.\nHow to handle TimeZone in OTP is a big discussion involving CPU prefetching(time-table compression witch prevent us from using epoch) , multiple data-sources with relative board/alight times and API specific use-cases (user TX, stop/loc TZ, agency TZ - which all are valid depending on the UC).", "author": "t2gran", "createdAt": "2020-11-13T14:03:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjE3MzQ2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjk5NTU4NQ==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3245#discussion_r522995585", "bodyText": "I went now with easiest solution by removing that assertion. Also force-pushed and rebased on top of current dev-2.x. It was actually a bit unclear for me if rebase or merge commits are preferred when reading docs/Developer-Guide.", "author": "tvainika", "createdAt": "2020-11-13T14:46:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjE3MzQ2Mw=="}], "type": "inlineReview"}, {"oid": "38b557a8f6b20b823cc9ac42788b897b339335d6", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/38b557a8f6b20b823cc9ac42788b897b339335d6", "message": "Don't use system default locale in unit tests\n\nFixes #3214", "committedDate": "2020-11-13T14:39:25Z", "type": "commit"}, {"oid": "38b557a8f6b20b823cc9ac42788b897b339335d6", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/38b557a8f6b20b823cc9ac42788b897b339335d6", "message": "Don't use system default locale in unit tests\n\nFixes #3214", "committedDate": "2020-11-13T14:39:25Z", "type": "forcePushed"}, {"oid": "df7a33d115a03c1ef65f140ee292c98a4cad7331", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/df7a33d115a03c1ef65f140ee292c98a4cad7331", "message": "Merge branch 'dev-2.x' into test-set-default-locale", "committedDate": "2020-11-13T14:47:06Z", "type": "commit"}]}