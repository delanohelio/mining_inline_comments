{"pr_number": 3219, "pr_title": "Add `generalizedCost` to both itinerary and leg", "pr_createdAt": "2020-10-16T18:00:50Z", "pr_url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3219", "timeline": [{"oid": "fdc3981b1d0baeb58ff42652188a4ad6162ab8e7", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/fdc3981b1d0baeb58ff42652188a4ad6162ab8e7", "message": "improvement: Add `generalizedCost` to both itinerary and leg, so we can debug the calculated cost. Show cost at itinerary level in OTP UI. Add modes `FERRY` and `FLEXIBLE` to \"Transit, No Airplane\" selection in UI.", "committedDate": "2020-10-16T16:51:12Z", "type": "commit"}, {"oid": "f822a125daac9faa8080c961e7b6dd3e44f07d25", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/f822a125daac9faa8080c961e7b6dd3e44f07d25", "message": "Add `generalizedCost` to Leg and Itinerary on the LegacyGraphQL API.", "committedDate": "2020-10-20T14:37:55Z", "type": "commit"}, {"oid": "89698fe327d70c237a5613f845bc19e902452986", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/89698fe327d70c237a5613f845bc19e902452986", "message": "Merge remote-tracking branch 'otp/dev-2.x' into otp2_generalized_cost_on_legs", "committedDate": "2020-10-21T07:54:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk3MDUxMg==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3219#discussion_r509970512", "bodyText": "What happens, when there are multiple legs generated from on AccessPath?", "author": "hannesj", "createdAt": "2020-10-22T08:21:42Z", "path": "src/main/java/org/opentripplanner/transit/raptor/rangeraptor/path/ForwardPathMapper.java", "diffHunk": "@@ -99,7 +102,12 @@ private void setRangeRaptorIterationDepartureTime(int iterationDepartureTime) {\n             from.stop(),\n             departureTime,\n             from.arrivalTime(),\n+            RaptorCostConverter.toOtpDomainCost(from.cost()),", "originalCommit": "89698fe327d70c237a5613f845bc19e902452986", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDE3NTAwMg==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3219#discussion_r510175002", "bodyText": "We do not calculate the cost \"properly\" for the street leg/legs - we threat them as \"one walking leg\" in Raptor for each access/transfer/egress(Raptor leg). The cost returned on the API is the cost calculated by Raptor, not AStar, hence the simplification above. This is something we want to fix, but until then this PR just assign the entire cost (calculated by Raptor) on the first API leg in the access/transfer/egress leg(which may consist of more than one API Leg). If there is more than one API Leg, the reminding leg-generalized-cost is set to 0(zero).", "author": "t2gran", "createdAt": "2020-10-22T13:46:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk3MDUxMg=="}], "type": "inlineReview"}, {"oid": "ac61e0424b3a7c82fc432ffe6cd09003061fe293", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/ac61e0424b3a7c82fc432ffe6cd09003061fe293", "message": "Merge branch 'dev-2.x' into otp2_generalized_cost_on_legs", "committedDate": "2020-10-22T13:38:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDE4ODAzMA==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3219#discussion_r510188030", "bodyText": "Code cleanup: A basic principle of programming is to have methods with no side-effects. So, I changed this method to return the mapped legs, not map and insert into the result.", "author": "t2gran", "createdAt": "2020-10-22T14:03:16Z", "path": "src/main/java/org/opentripplanner/routing/algorithm/mapping/RaptorPathToItineraryMapper.java", "diffHunk": "@@ -114,24 +113,23 @@ public Itinerary createItinerary(Path<TripSchedule> path) {\n         return itinerary;\n     }\n \n-    private void mapAccessLeg(\n-            List<Leg> legs,\n-            AccessPathLeg<TripSchedule> accessPathLeg\n-    ) {\n+    private List<Leg> mapAccessLeg(AccessPathLeg<TripSchedule> accessPathLeg) {", "originalCommit": "ac61e0424b3a7c82fc432ffe6cd09003061fe293", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "015de23eadbd5ed4d2fc8718e1b7623e9345a2cb", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/015de23eadbd5ed4d2fc8718e1b7623e9345a2cb", "message": "Merge branch 'dev-2.x' into otp2_generalized_cost_on_legs", "committedDate": "2020-10-26T16:55:58Z", "type": "commit"}]}