{"pr_number": 3127, "pr_title": "Fill out Leg#serviceDate using the relevant TripSchedule", "pr_createdAt": "2020-07-01T08:08:11Z", "pr_url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3127", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk1MTk3Mg==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3127#discussion_r462951972", "bodyText": "I think we should add more JavaDoc here and maybe also rename the field to tripServiceDate. Add doc (suggestion):\n...\n<p>\nThe trip service date should be used to identify the correct trip schedule and\ncan not be trusted to display the date for any departures or arrivals. For example,\nthe first departure for a given trip may happen at service date March 25th and\nservice time 25:00, which in local time would be Mach 26th 01:00.", "author": "t2gran", "createdAt": "2020-07-30T12:12:56Z", "path": "src/main/java/org/opentripplanner/model/plan/Leg.java", "diffHunk": "@@ -149,9 +150,7 @@\n     * For transit legs, the service date of the trip.\n     * For non-transit legs, null.\n     */\n-   // TODO OTP2 - This should not be a String? What is this used for? Is it the actual date or the\n-   //           - Service date?\n-   public String serviceDate = null;\n+   public ServiceDate serviceDate = null;", "originalCommit": "805495a69d0c418cfd748aa8de4e9c39bd736c82", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk2MDI4MA==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3127#discussion_r462960280", "bodyText": "I would like to point out this this duplicate the service calendar information. The service date is redundant, it can be found using the calendar info, trip and leg. We sometimes do duplicate information in the model, but be aware that that have a high maintenance cost. I would recommend retrieving this from the calendar service instead at the time of mapping into the API if it is not to difficult or error prune. We plan to clean up the transit layer, so maybe we can deal with it then.", "author": "t2gran", "createdAt": "2020-07-30T12:28:49Z", "path": "src/main/java/org/opentripplanner/routing/algorithm/raptor/transit/TripSchedule.java", "diffHunk": "@@ -20,6 +22,8 @@\n      */\n     TripPattern getOriginalTripPattern();\n \n+    LocalDate getServiceDate();\n+", "originalCommit": "805495a69d0c418cfd748aa8de4e9c39bd736c82", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDEyMDE4Mg==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3127#discussion_r464120182", "bodyText": "An alternative could be to have a localDateFromStartOfTimeAndSecondsOffset() function which may then be used for mapping to a ServiceDate (commit):\nleg.serviceDate = new ServiceDate(localDateFromStartOfTimeAndSecondsOffset(startOfTime, ((TripScheduleWithOffset) tripSchedule).getSecondsOffset()));\n\npublic static LocalDate localDateFromStartOfTimeAndSecondsOffset(ZonedDateTime startOfTime, int secondsOffset) {\n    ZonedDateTime noon = startOfTime.plusSeconds(secondsOffset).plusHours(12);\n    return noon.toLocalDate();\n}\n\nWould this be preferable?", "author": "flaktack", "createdAt": "2020-08-02T20:29:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk2MDI4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDM2MzQyNg==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3127#discussion_r464363426", "bodyText": "I think what you have done is ok for now, but I might refactor this as part of #3030. I will keep the TripSchedule.getServiceDate() method, but compute it instead of caching the value.\nI don't like \"global\" static methods, because you basically need to know they exist to use them and also the internal representation of the calendar leeks outside the model.", "author": "t2gran", "createdAt": "2020-08-03T11:49:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk2MDI4MA=="}], "type": "inlineReview"}, {"oid": "e8267721fe4612a5757e5f7b6b7bbd395b0e04b5", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/e8267721fe4612a5757e5f7b6b7bbd395b0e04b5", "message": "Correctly fill out Leg#serviceDate\n\nusing the serviceDate of the trip from the TripSchedule", "committedDate": "2020-08-10T11:59:35Z", "type": "commit"}, {"oid": "e8267721fe4612a5757e5f7b6b7bbd395b0e04b5", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/e8267721fe4612a5757e5f7b6b7bbd395b0e04b5", "message": "Correctly fill out Leg#serviceDate\n\nusing the serviceDate of the trip from the TripSchedule", "committedDate": "2020-08-10T11:59:35Z", "type": "forcePushed"}]}