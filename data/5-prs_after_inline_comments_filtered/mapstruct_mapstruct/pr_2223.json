{"pr_number": 2223, "pr_title": "#2221: Fix configuration inheritance when there are multiple matching source parameters of the same type", "pr_createdAt": "2020-10-07T21:04:18Z", "pr_url": "https://github.com/mapstruct/mapstruct/pull/2223", "timeline": [{"oid": "a7a40f5db44430ae53ee5ca1838b685b93979f4a", "url": "https://github.com/mapstruct/mapstruct/commit/a7a40f5db44430ae53ee5ca1838b685b93979f4a", "message": "#2221: Fix configuration inheritance when there are multiple matching source parameters of the same type", "committedDate": "2020-10-07T21:12:23Z", "type": "commit"}, {"oid": "a7a40f5db44430ae53ee5ca1838b685b93979f4a", "url": "https://github.com/mapstruct/mapstruct/commit/a7a40f5db44430ae53ee5ca1838b685b93979f4a", "message": "#2221: Fix configuration inheritance when there are multiple matching source parameters of the same type", "committedDate": "2020-10-07T21:12:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjAwMjA1OQ==", "url": "https://github.com/mapstruct/mapstruct/pull/2223#discussion_r502002059", "bodyText": "is there a situation where the parameter you fetch here is not assignable? It seems like you fetch a parameter again only based on its name.", "author": "sjaakd", "createdAt": "2020-10-08T20:45:34Z", "path": "processor/src/main/java/org/mapstruct/ap/internal/model/beanmapping/SourceReference.java", "diffHunk": "@@ -239,11 +238,24 @@ private Parameter getSourceParameterFromMethodOrTemplate(String parameterName )\n             if ( isForwarded ) {\n                 Parameter parameter = Parameter.getSourceParameter( templateMethod.getParameters(), parameterName );\n                 if ( parameter != null ) {\n-                    result = method.getSourceParameters()\n-                                   .stream()\n-                                   .filter( p -> p.getType().isAssignableTo( parameter.getType() ) )\n-                                   .collect( Collectors.reducing( (a, b) -> null ) )\n-                                   .orElse( null );\n+\n+                    // When forward inheriting we should find the matching source parameter by type\n+                    // If there are multiple parameters of the same type\n+                    // then we fallback to match the parameter name to the current method source parameters\n+                    for ( Parameter sourceParameter : method.getSourceParameters() ) {\n+                        if ( sourceParameter.getType().isAssignableTo( parameter.getType() ) ) {\n+                            if ( result == null ) {\n+                                result = sourceParameter;\n+                            }\n+                            else {\n+                                // When we reach here it means that we found a second source parameter\n+                                // that has the same type, then fallback to the matching source parameter\n+                                // in the current method\n+                                result = Parameter.getSourceParameter( method.getParameters(), parameterName );", "originalCommit": "a7a40f5db44430ae53ee5ca1838b685b93979f4a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjMyNjI3Ng==", "url": "https://github.com/mapstruct/mapstruct/pull/2223#discussion_r502326276", "bodyText": "No that is not possible. This is needed because the source reference is from the template method, so the name of the parameter is the one in that method. The name in the mapping method might not be the same. Therefore we need to find it by type. However, if there are multiple parameters of the same type we fallback to finding it by name", "author": "filiphr", "createdAt": "2020-10-09T10:08:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjAwMjA1OQ=="}], "type": "inlineReview"}]}