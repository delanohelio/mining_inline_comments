{"pr_number": 8922, "pr_title": "ISPN-12561 CacheV2ResourceTest does not close RestClient responses", "pr_createdAt": "2020-12-08T08:53:12Z", "pr_url": "https://github.com/infinispan/infinispan/pull/8922", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODYxNTUwNg==", "url": "https://github.com/infinispan/infinispan/pull/8922#discussion_r538615506", "bodyText": "Should we do an assertNotNull here? That way it won't throw a NPE later.", "author": "wburns", "createdAt": "2020-12-08T17:10:39Z", "path": "server/rest/src/test/java/org/infinispan/rest/assertion/JsonAssertion.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package org.infinispan.rest.assertion;\n+\n+import static org.testng.AssertJUnit.assertEquals;\n+import static org.testng.AssertJUnit.assertNull;\n+\n+import org.infinispan.commons.dataconversion.internal.Json;\n+\n+/**\n+ * Assertions on JSON contents.\n+ *\n+ * @author Dan Berindei\n+ * @since 12\n+ */\n+public class JsonAssertion {\n+   private Json node;\n+\n+   public JsonAssertion(Json node) {\n+      this.node = node;\n+   }\n+\n+   public JsonAssertion hasProperty(String propertyName) {\n+      return new JsonAssertion(node.at(propertyName));", "originalCommit": "10b8d6579cc8c82871352c449fc172a2638557da", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODYxNjcyNg==", "url": "https://github.com/infinispan/infinispan/pull/8922#discussion_r538616726", "bodyText": "This shouldn't be needed if we change hasProperty to check for not null.", "author": "wburns", "createdAt": "2020-12-08T17:11:52Z", "path": "server/rest/src/test/java/org/infinispan/rest/assertion/JsonAssertion.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package org.infinispan.rest.assertion;\n+\n+import static org.testng.AssertJUnit.assertEquals;\n+import static org.testng.AssertJUnit.assertNull;\n+\n+import org.infinispan.commons.dataconversion.internal.Json;\n+\n+/**\n+ * Assertions on JSON contents.\n+ *\n+ * @author Dan Berindei\n+ * @since 12\n+ */\n+public class JsonAssertion {\n+   private Json node;\n+\n+   public JsonAssertion(Json node) {\n+      this.node = node;\n+   }\n+\n+   public JsonAssertion hasProperty(String propertyName) {\n+      return new JsonAssertion(node.at(propertyName));\n+   }\n+\n+   public JsonAssertion hasNoProperty(String propertyName) {\n+      assertNull(node.at(propertyName));\n+      return this;\n+   }\n+\n+   public void is(int value) {\n+      assertEquals(value, node.asInteger());\n+   }\n+\n+   public void is(String value) {\n+      assertEquals(value, node.asString());\n+   }\n+\n+   public void isNull() {", "originalCommit": "10b8d6579cc8c82871352c449fc172a2638557da", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDcxMjQ1MQ==", "url": "https://github.com/infinispan/infinispan/pull/8922#discussion_r540712451", "bodyText": "It is needed in order to distinguish {error: null} from {}.\nI just made a typo in the test and instead of fixing that I assumed that the property is parsed as null (it's actually a NullJson).", "author": "danberindei", "createdAt": "2020-12-11T06:06:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODYxNjcyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODYxNzI3OA==", "url": "https://github.com/infinispan/infinispan/pull/8922#discussion_r538617278", "bodyText": "Use hasNoProperty instead?", "author": "wburns", "createdAt": "2020-12-08T17:12:24Z", "path": "server/rest/src/test/java/org/infinispan/rest/assertion/ResponseAssertion.java", "diffHunk": "@@ -295,8 +295,12 @@ public ResponseAssertion expiresAfter(int expireDuration) {\n    }\n \n    public ResponseAssertion hasNoErrors() {\n-      Json node = Json.read(response.getBody());\n-      Assertions.assertThat(node.at(\"error\").isNull()).isTrue();\n+      hasJson().hasProperty(\"error\").isNull();", "originalCommit": "10b8d6579cc8c82871352c449fc172a2638557da", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "91265f36ca8ccc9b47b853c4c4526dd35388ede8", "url": "https://github.com/infinispan/infinispan/commit/91265f36ca8ccc9b47b853c4c4526dd35388ede8", "message": "ISPN-12561 CacheV2ResourceTest does not close RestClient responses\n\nCheck the response body contents.\nReading the body automatically closes the response.", "committedDate": "2020-12-11T06:22:04Z", "type": "forcePushed"}, {"oid": "4ffdee7e9f97fcb1ccd26da1c678f1386703f66e", "url": "https://github.com/infinispan/infinispan/commit/4ffdee7e9f97fcb1ccd26da1c678f1386703f66e", "message": "ISPN-12561 CacheV2ResourceTest does not close RestClient responses\n\nCheck the response body contents.\nReading the body automatically closes the response.", "committedDate": "2020-12-11T08:57:21Z", "type": "commit"}, {"oid": "4ffdee7e9f97fcb1ccd26da1c678f1386703f66e", "url": "https://github.com/infinispan/infinispan/commit/4ffdee7e9f97fcb1ccd26da1c678f1386703f66e", "message": "ISPN-12561 CacheV2ResourceTest does not close RestClient responses\n\nCheck the response body contents.\nReading the body automatically closes the response.", "committedDate": "2020-12-11T08:57:21Z", "type": "forcePushed"}]}