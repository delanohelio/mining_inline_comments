{"pr_number": 8693, "pr_title": "ISPN-12309 Creating cache with invalid configuration leaves inconsistent state", "pr_createdAt": "2020-09-16T15:22:06Z", "pr_url": "https://github.com/infinispan/infinispan/pull/8693", "timeline": [{"oid": "3d03e8aea5abd3669e5aa8ab3e9052d35373da06", "url": "https://github.com/infinispan/infinispan/commit/3d03e8aea5abd3669e5aa8ab3e9052d35373da06", "message": "ISPN-12309 Creating cache with invalid configuration leaves inconsistent state", "committedDate": "2020-09-18T15:41:09Z", "type": "forcePushed"}, {"oid": "f56aff8969e331bf8b2e0a56082330ab1b695083", "url": "https://github.com/infinispan/infinispan/commit/f56aff8969e331bf8b2e0a56082330ab1b695083", "message": "ISPN-12309 Creating cache with invalid configuration leaves inconsistent state", "committedDate": "2020-09-28T16:29:33Z", "type": "forcePushed"}, {"oid": "8f09b3817d96c81096303279cdfdc106754b3ded", "url": "https://github.com/infinispan/infinispan/commit/8f09b3817d96c81096303279cdfdc106754b3ded", "message": "ISPN-12309 Creating cache with invalid configuration leaves inconsistent state", "committedDate": "2020-09-28T16:36:08Z", "type": "forcePushed"}, {"oid": "0d34b9029e90444415b8b5dc30e40d29f8772999", "url": "https://github.com/infinispan/infinispan/commit/0d34b9029e90444415b8b5dc30e40d29f8772999", "message": "ISPN-12309 Creating cache with invalid configuration leaves inconsistent state", "committedDate": "2020-09-28T16:38:52Z", "type": "forcePushed"}, {"oid": "73628e0f6511d284ac92190c9164bcf233fc5e36", "url": "https://github.com/infinispan/infinispan/commit/73628e0f6511d284ac92190c9164bcf233fc5e36", "message": "ISPN-12309 Creating cache with invalid configuration leaves inconsistent state", "committedDate": "2020-09-28T16:48:34Z", "type": "forcePushed"}, {"oid": "6b0ee53b83e0b23f45bffb5bc27f1e205827b1b5", "url": "https://github.com/infinispan/infinispan/commit/6b0ee53b83e0b23f45bffb5bc27f1e205827b1b5", "message": "ISPN-12309 Update documentation", "committedDate": "2020-09-29T11:40:37Z", "type": "forcePushed"}, {"oid": "6e0a21174f8c2be7e57617e45e96d915a6f1442d", "url": "https://github.com/infinispan/infinispan/commit/6e0a21174f8c2be7e57617e45e96d915a6f1442d", "message": "ISPN-12309 Update documentation", "committedDate": "2020-09-29T11:44:02Z", "type": "forcePushed"}, {"oid": "a913f602d45485714010a65f9799bea39512a1be", "url": "https://github.com/infinispan/infinispan/commit/a913f602d45485714010a65f9799bea39512a1be", "message": "ISPN-12309 Update documentation", "committedDate": "2020-09-29T11:45:57Z", "type": "forcePushed"}, {"oid": "f3463ddfdece546a95b82110214edce8add81ce2", "url": "https://github.com/infinispan/infinispan/commit/f3463ddfdece546a95b82110214edce8add81ce2", "message": "ISPN-12309 Update documentation", "committedDate": "2020-09-29T13:24:42Z", "type": "forcePushed"}, {"oid": "78ec12bb79a905403e862283af09f3406f88bdd5", "url": "https://github.com/infinispan/infinispan/commit/78ec12bb79a905403e862283af09f3406f88bdd5", "message": "ISPN-12309 Update documentation", "committedDate": "2020-09-29T17:16:25Z", "type": "forcePushed"}, {"oid": "c066700618b127d91257a2e472f51c67b35aeced", "url": "https://github.com/infinispan/infinispan/commit/c066700618b127d91257a2e472f51c67b35aeced", "message": "ISPN-12309 Update documentation", "committedDate": "2020-09-29T17:19:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM5MTU0MQ==", "url": "https://github.com/infinispan/infinispan/pull/8693#discussion_r497391541", "bodyText": "use HealthStatus enum", "author": "karesti", "createdAt": "2020-09-30T10:03:07Z", "path": "server/rest/src/main/java/org/infinispan/rest/resources/CacheManagerResource.java", "diffHunk": "@@ -230,9 +231,12 @@ public Invocations getInvocations() {\n                if (ignoredCaches.contains(cacheName)) {\n                   cacheInfo.status = \"IGNORED\";\n                } else {\n-                  // This action will fail for ignored caches\n-                  Cache cache = restCacheManager.getCache(cacheName, request);\n-                  cacheInfo.status = cache.getStatus().toString();\n+                  if(cacheHealth != HealthStatus.FAILED) {\n+                     Cache cache = restCacheManager.getCache(cacheName, request);\n+                     cacheInfo.status = cache.getStatus().toString();\n+                  } else {\n+                     cacheInfo.status = \"FAILED\";", "originalCommit": "c066700618b127d91257a2e472f51c67b35aeced", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODA0NDUzNg==", "url": "https://github.com/infinispan/infinispan/pull/8693#discussion_r498044536", "bodyText": "cacheInfo.status is not the health of the cache, but as far as I could see, it is the component status or \"ignored\", so using the HealthEnum here would be confusing", "author": "gustavonalle", "createdAt": "2020-10-01T07:42:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM5MTU0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODA0NjgzNQ==", "url": "https://github.com/infinispan/infinispan/pull/8693#discussion_r498046835", "bodyText": "And I can't use cache.getStatus() directly because when a cache fails to start, it is basically inaccessible  :/", "author": "gustavonalle", "createdAt": "2020-10-01T07:45:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM5MTU0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODA1MzA0Ng==", "url": "https://github.com/infinispan/infinispan/pull/8693#discussion_r498053046", "bodyText": "Used ComponentStatus.FAILED", "author": "gustavonalle", "createdAt": "2020-10-01T07:56:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM5MTU0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM5MjI5MQ==", "url": "https://github.com/infinispan/infinispan/pull/8693#discussion_r497392291", "bodyText": "would be better to use the enum on tests as well", "author": "karesti", "createdAt": "2020-09-30T10:04:09Z", "path": "server/rest/src/test/java/org/infinispan/rest/resources/CacheManagerResourceTest.java", "diffHunk": "@@ -86,7 +86,8 @@ public void testHealth() {\n \n       Json jsonNode = Json.read(response.getBody());\n       Json clusterHealth = jsonNode.at(\"cluster_health\");\n-      assertEquals(clusterHealth.at(\"health_status\").asString(), \"HEALTHY\");\n+      // One of the caches is in FAILED state", "originalCommit": "c066700618b127d91257a2e472f51c67b35aeced", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODA1MzA5Nw==", "url": "https://github.com/infinispan/infinispan/pull/8693#discussion_r498053097", "bodyText": "fixed", "author": "gustavonalle", "createdAt": "2020-10-01T07:57:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM5MjI5MQ=="}], "type": "inlineReview"}, {"oid": "f21ddee03ca11045a88cbdc59b71509169b33a44", "url": "https://github.com/infinispan/infinispan/commit/f21ddee03ca11045a88cbdc59b71509169b33a44", "message": "ISPN-12309 Reproducer", "committedDate": "2020-10-01T07:52:02Z", "type": "commit"}, {"oid": "666afd770ad1d075061ded4fe36c1abf39c3af38", "url": "https://github.com/infinispan/infinispan/commit/666afd770ad1d075061ded4fe36c1abf39c3af38", "message": "ISPN-12309 Creating cache with invalid configuration leaves inconsistent state", "committedDate": "2020-10-01T07:52:08Z", "type": "commit"}, {"oid": "1cf76878dc67866eeed3f14290984bd7d627a58a", "url": "https://github.com/infinispan/infinispan/commit/1cf76878dc67866eeed3f14290984bd7d627a58a", "message": "ISPN-12309 Update documentation", "committedDate": "2020-10-01T07:52:10Z", "type": "commit"}, {"oid": "1cf76878dc67866eeed3f14290984bd7d627a58a", "url": "https://github.com/infinispan/infinispan/commit/1cf76878dc67866eeed3f14290984bd7d627a58a", "message": "ISPN-12309 Update documentation", "committedDate": "2020-10-01T07:52:10Z", "type": "forcePushed"}]}