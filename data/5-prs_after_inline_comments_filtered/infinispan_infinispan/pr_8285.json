{"pr_number": 8285, "pr_title": "ISPN-11532 HotRod Worker Thread Pool", "pr_createdAt": "2020-05-06T12:58:28Z", "pr_url": "https://github.com/infinispan/infinispan/pull/8285", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkxMTE2NA==", "url": "https://github.com/infinispan/infinispan/pull/8285#discussion_r420911164", "bodyText": "when is this true?\nI think we only create LazyInitializingBlockingTaskAwareExecutorService. It is already a ManageableExecutorService so it can be used directly without more wrapping.", "author": "pruivo", "createdAt": "2020-05-06T16:06:20Z", "path": "server/core/src/main/java/org/infinispan/server/core/AbstractProtocolServer.java", "diffHunk": "@@ -104,23 +101,16 @@ public void start(C configuration, EmbeddedCacheManager cacheManager) {\n          throw new IllegalStateException(\"CacheIgnoreManager is a required component\");\n       }\n \n-      executor = new ThreadPoolExecutor(\n-            configuration.workerThreads(),\n-            configuration.workerThreads(),\n-            0L, TimeUnit.MILLISECONDS,\n-            new LinkedBlockingQueue<>(),\n-            new DefaultThreadFactory(getQualifiedName() + \"-ServerHandler\"),\n-            new ThreadPoolExecutor.AbortPolicy() {\n-               @Override\n-               public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {\n-                  if (e.isShutdown())\n-                     throw new IllegalLifecycleStateException(\"Server has been stopped\");\n-                  else\n-                     super.rejectedExecution(r, e);\n-               }\n-            });\n-\n-      manageableThreadPoolExecutorService = new ManageableThreadPoolExecutorService(executor);\n+      executor = bcr.getComponent(KnownComponentNames.BLOCKING_EXECUTOR, ExecutorService.class).running();\n+\n+      if (executor instanceof BlockingTaskAwareExecutorServiceImpl) {", "originalCommit": "f7225f4993f29db88b9c60d9749d81b7ee9ae433", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkxMzY0NQ==", "url": "https://github.com/infinispan/infinispan/pull/8285#discussion_r420913645", "bodyText": "Hrmm, I had an issue in testing, maybe it isn't a problem anymore. Let me try again.", "author": "wburns", "createdAt": "2020-05-06T16:09:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkxMTE2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkzNDc5Mg==", "url": "https://github.com/infinispan/infinispan/pull/8285#discussion_r420934792", "bodyText": "I have removed the if, if CI passes then it should be good ;)", "author": "wburns", "createdAt": "2020-05-06T16:41:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkxMTE2NA=="}], "type": "inlineReview"}, {"oid": "542ba55ef06986da8df699d065f27406498f1d45", "url": "https://github.com/infinispan/infinispan/commit/542ba55ef06986da8df699d065f27406498f1d45", "message": "ISPN-11755 Stats should be collected in a non blocking way", "committedDate": "2020-05-06T16:40:44Z", "type": "forcePushed"}, {"oid": "891b624e64fbba823106ed0bbe66f32a4264d067", "url": "https://github.com/infinispan/infinispan/commit/891b624e64fbba823106ed0bbe66f32a4264d067", "message": "ISPN-11532 Replace HotRod worker thread pool", "committedDate": "2020-05-11T15:37:06Z", "type": "commit"}, {"oid": "3433eb06f70170cd5f678dd2a99214895eb55903", "url": "https://github.com/infinispan/infinispan/commit/3433eb06f70170cd5f678dd2a99214895eb55903", "message": "ISPN-11531 HotRod Server transaction is blocking\n\n* Can now remove blockhound check", "committedDate": "2020-05-11T15:37:07Z", "type": "commit"}, {"oid": "bad0a6a7c285dda6d77b555ca278b35af996b6cc", "url": "https://github.com/infinispan/infinispan/commit/bad0a6a7c285dda6d77b555ca278b35af996b6cc", "message": "ISPN-11755 Stats should be collected in a non blocking way", "committedDate": "2020-05-11T15:37:07Z", "type": "commit"}, {"oid": "bad0a6a7c285dda6d77b555ca278b35af996b6cc", "url": "https://github.com/infinispan/infinispan/commit/bad0a6a7c285dda6d77b555ca278b35af996b6cc", "message": "ISPN-11755 Stats should be collected in a non blocking way", "committedDate": "2020-05-11T15:37:07Z", "type": "forcePushed"}]}