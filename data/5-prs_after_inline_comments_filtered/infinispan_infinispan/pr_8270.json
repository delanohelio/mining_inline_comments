{"pr_number": 8270, "pr_title": "ISPN-11758 QueryCache is a global component but should scope all cached queries per cache", "pr_createdAt": "2020-04-30T23:01:20Z", "pr_url": "https://github.com/infinispan/infinispan/pull/8270", "timeline": [{"oid": "5879eab299d33e974b9b1277f771b6103405d04b", "url": "https://github.com/infinispan/infinispan/commit/5879eab299d33e974b9b1277f771b6103405d04b", "message": "ISPN-11758 QueryCache is a global component but should scope all cached queries per cache\n\n* each cache must have a stop dependency on query cache\n* clear query entries related to a cache when the cache stops", "committedDate": "2020-05-01T08:03:01Z", "type": "forcePushed"}, {"oid": "94996e48718e5240b6843795f74d6cf074aff056", "url": "https://github.com/infinispan/infinispan/commit/94996e48718e5240b6843795f74d6cf074aff056", "message": "ISPN-11758 QueryCache is a global component but should scope all cached queries per cache\n\n* each cache must have a stop dependency on query cache\n* clear query entries related to a cache when the cache stops", "committedDate": "2020-05-01T10:21:29Z", "type": "forcePushed"}, {"oid": "1794447d07e212319473def8dfbd10fd1b20f806", "url": "https://github.com/infinispan/infinispan/commit/1794447d07e212319473def8dfbd10fd1b20f806", "message": "Remove IndexInspector and move its (minimal) functionality to QueryInterceptor", "committedDate": "2020-05-01T12:51:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk1ODU1NA==", "url": "https://github.com/infinispan/infinispan/pull/8270#discussion_r418958554", "bodyText": "You need to take into account that the default is fs, and can be omitted. So having 2 entities with one of them pointing to local-heap, would cause only 1  property with DIRECTORY_PROVIDER_SUFFIX but two backends.", "author": "gustavonalle", "createdAt": "2020-05-02T13:23:02Z", "path": "core/src/main/java/org/infinispan/configuration/cache/IndexingConfigurationBuilder.java", "diffHunk": "@@ -204,6 +211,14 @@ public void validate() {\n          }\n       }\n \n+      if (attributes.attribute(PROPERTIES).get()\n+                    .entrySet().stream()\n+                    .filter(e -> ((String) e.getKey()).endsWith(DIRECTORY_PROVIDER_SUFFIX))\n+                    .map(Map.Entry::getValue)\n+                    .collect(Collectors.toSet()).size() > 1) {\n+         throw CONFIG.foundMultipleDirectoryProviders();", "originalCommit": "1794447d07e212319473def8dfbd10fd1b20f806", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk2NDUxMQ==", "url": "https://github.com/infinispan/infinispan/pull/8270#discussion_r418964511", "bodyText": "Good find. I will refine the validation to take defaults into account", "author": "anistor", "createdAt": "2020-05-02T14:21:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk1ODU1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTA2Njk2OA==", "url": "https://github.com/infinispan/infinispan/pull/8270#discussion_r419066968", "bodyText": "Fixed", "author": "anistor", "createdAt": "2020-05-03T08:15:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk1ODU1NA=="}], "type": "inlineReview"}, {"oid": "87b1b9c13b889fb08f1e6e6ac7caef205aaea694", "url": "https://github.com/infinispan/infinispan/commit/87b1b9c13b889fb08f1e6e6ac7caef205aaea694", "message": "Remove IndexInspector and move its (minimal) functionality to QueryInterceptor", "committedDate": "2020-05-03T08:11:35Z", "type": "forcePushed"}, {"oid": "6139c5a5cbc8bc8bd8265bb389dfa9e764221771", "url": "https://github.com/infinispan/infinispan/commit/6139c5a5cbc8bc8bd8265bb389dfa9e764221771", "message": "Remove IndexInspector and move its (minimal) functionality to QueryInterceptor", "committedDate": "2020-05-03T20:08:12Z", "type": "forcePushed"}, {"oid": "f7b14b56404b60b5841e4e3497bf61c1b0764749", "url": "https://github.com/infinispan/infinispan/commit/f7b14b56404b60b5841e4e3497bf61c1b0764749", "message": "Remove IndexInspector and move its (minimal) functionality to QueryInterceptor", "committedDate": "2020-05-03T20:19:31Z", "type": "forcePushed"}, {"oid": "31db5ec1837199a8eb81db49f663957bdd586d1c", "url": "https://github.com/infinispan/infinispan/commit/31db5ec1837199a8eb81db49f663957bdd586d1c", "message": "Remove IndexInspector and move its (minimal) functionality to QueryInterceptor", "committedDate": "2020-05-03T20:37:49Z", "type": "forcePushed"}, {"oid": "83e92176ed0fde150ba09a49333e8310ce6e249b", "url": "https://github.com/infinispan/infinispan/commit/83e92176ed0fde150ba09a49333e8310ce6e249b", "message": "Remove IndexInspector and move its (minimal) functionality to QueryInterceptor", "committedDate": "2020-05-03T20:48:01Z", "type": "forcePushed"}, {"oid": "4aeba429f34c460e3c296ac2c30e72fc2c8a1e32", "url": "https://github.com/infinispan/infinispan/commit/4aeba429f34c460e3c296ac2c30e72fc2c8a1e32", "message": "ISPN-11758 QueryCache is a global component but should scope all cached queries per cache\n\n* each cache must have a stop dependency on query cache\n* clear query entries related to a cache when the cache stops", "committedDate": "2020-05-04T11:40:40Z", "type": "commit"}, {"oid": "9fb4591b881d3766cc27e326ad7d249d77e6f383", "url": "https://github.com/infinispan/infinispan/commit/9fb4591b881d3766cc27e326ad7d249d77e6f383", "message": "Remove IndexInspector and move its (minimal) functionality to QueryInterceptor", "committedDate": "2020-05-04T11:40:40Z", "type": "commit"}, {"oid": "0e131319184a4ff19ab299f6bf2465fe097ff596", "url": "https://github.com/infinispan/infinispan/commit/0e131319184a4ff19ab299f6bf2465fe097ff596", "message": "ISPN-11757 Do not allow multiple indexing providers per cache", "committedDate": "2020-05-04T12:00:56Z", "type": "commit"}, {"oid": "0e131319184a4ff19ab299f6bf2465fe097ff596", "url": "https://github.com/infinispan/infinispan/commit/0e131319184a4ff19ab299f6bf2465fe097ff596", "message": "ISPN-11757 Do not allow multiple indexing providers per cache", "committedDate": "2020-05-04T12:00:56Z", "type": "forcePushed"}]}