{"pr_number": 7929, "pr_title": "[9.4.x] [PREVIEW] ISPN-11373 XSite backup commands should be sent from a blocking thread", "pr_createdAt": "2020-02-20T10:47:15Z", "pr_url": "https://github.com/infinispan/infinispan/pull/7929", "timeline": [{"oid": "8c64842e33b2f75ff9b7398b55925d0f0852b238", "url": "https://github.com/infinispan/infinispan/commit/8c64842e33b2f75ff9b7398b55925d0f0852b238", "message": "ISPN-11373 XSite backup commands should be sent from a blocking thread", "committedDate": "2020-02-20T10:49:40Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTkyNDQzOA==", "url": "https://github.com/infinispan/infinispan/pull/7929#discussion_r381924438", "bodyText": "-1\nsending order is important. You need to use a single thread to send the request or you risk it to be reordered.", "author": "pruivo", "createdAt": "2020-02-20T10:52:19Z", "path": "core/src/main/java/org/infinispan/remoting/transport/jgroups/JGroupsTransport.java", "diffHunk": "@@ -326,13 +326,22 @@ public BackupResponse backupRemotely(Collection<XSiteBackup> backups, XSiteRepli\n          DeliverOrder order = xsb.isSync() ? DeliverOrder.NONE : DeliverOrder.PER_SENDER;\n          long timeout = xsb.getTimeout();\n          try {\n-            sendCommand(recipient, command, request.getRequestId(), order, rsvp, false, false);\n+            Message message = new Message(toJGroupsAddress(recipient));\n+            marshallRequest(message, command, request.getRequestId());\n+            setMessageFlags(message, order, rsvp, false);\n+\n+            remoteExecutor.submit(() -> {", "originalCommit": "8c64842e33b2f75ff9b7398b55925d0f0852b238", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTkyNzQ3NQ==", "url": "https://github.com/infinispan/infinispan/pull/7929#discussion_r381927475", "bodyText": "Oops :)", "author": "danberindei", "createdAt": "2020-02-20T10:58:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTkyNDQzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjAxMTcxNA==", "url": "https://github.com/infinispan/infinispan/pull/7929#discussion_r382011714", "bodyText": "I added ActionSequencer when the commands need to be ordered", "author": "danberindei", "createdAt": "2020-02-20T13:54:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTkyNDQzOA=="}], "type": "inlineReview"}, {"oid": "9a4272c59ec4ba6586b70ebf405af24708b0e1c5", "url": "https://github.com/infinispan/infinispan/commit/9a4272c59ec4ba6586b70ebf405af24708b0e1c5", "message": "ISPN-11373 XSite backup commands should be sent from a blocking thread", "committedDate": "2020-02-20T13:09:07Z", "type": "commit"}, {"oid": "9a4272c59ec4ba6586b70ebf405af24708b0e1c5", "url": "https://github.com/infinispan/infinispan/commit/9a4272c59ec4ba6586b70ebf405af24708b0e1c5", "message": "ISPN-11373 XSite backup commands should be sent from a blocking thread", "committedDate": "2020-02-20T13:09:07Z", "type": "forcePushed"}]}