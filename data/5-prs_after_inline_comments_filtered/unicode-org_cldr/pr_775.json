{"pr_number": 775, "pr_title": "CLDR-14180 Bill Pugh singletons", "pr_createdAt": "2020-10-12T19:20:18Z", "pr_url": "https://github.com/unicode-org/cldr/pull/775", "timeline": [{"oid": "61945a1d30a1dcb4b03e58ba17a7034777f068a7", "url": "https://github.com/unicode-org/cldr/commit/61945a1d30a1dcb4b03e58ba17a7034777f068a7", "message": "CLDR-14180 Bill Pugh singletons\n\nMultiple classes, notably:\n- DBUtils: need special handling for test instances\n- restructured SortMode subclasses some to reduce object creation", "committedDate": "2020-10-12T19:36:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzUxNjkzNQ==", "url": "https://github.com/unicode-org/cldr/pull/775#discussion_r503516935", "bodyText": "This doesn't appear right. The key to the Bill Pugh singletons is that the statics are in their own static class. That keeps them from being created until needed.", "author": "macchiati", "createdAt": "2020-10-12T20:28:41Z", "path": "tools/cldr-apps/src/main/java/org/unicode/cldr/web/CalendarSortMode.java", "diffHunk": "@@ -220,31 +220,33 @@ public boolean isMember(DataRow p) {\n     }\n \n     @Override\n-    Comparator<DataRow> createComparator() {\n-        return comparator();\n+    Comparator<DataRow> getComparator() {\n+        return COMPARATOR;\n     }\n \n-    public static Comparator<DataRow> comparator() {\n+    static final Comparator<DataRow> COMPARATOR = new  Comparator<DataRow>() {", "originalCommit": "61945a1d30a1dcb4b03e58ba17a7034777f068a7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzUyMDkwMg==", "url": "https://github.com/unicode-org/cldr/pull/775#discussion_r503520902", "bodyText": "The SortMode subclasses are intertwined, many sibling classes make use of the Comparator instance from another sibling. But, I can make these lazily instantiated.", "author": "srl295", "createdAt": "2020-10-12T20:39:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzUxNjkzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzUxNzMwMw==", "url": "https://github.com/unicode-org/cldr/pull/775#discussion_r503517303", "bodyText": "This looks better, except that each static should be in its own helper. Otherwise you create all of them when any one of them is created.", "author": "macchiati", "createdAt": "2020-10-12T20:29:36Z", "path": "tools/cldr-apps/src/main/java/org/unicode/cldr/web/CodeSortMode.java", "diffHunk": "@@ -36,13 +36,20 @@ String getName() {\n     }\n \n     @Override\n-    Comparator<DataRow> createComparator() {\n-        return comparator();\n+    Comparator<DataRow> getComparator() {\n+        return CollatorHelper.COMPARATOR;\n     }\n \n-    public static Comparator<DataRow> comparator() {\n-        return new Comparator<DataRow>() {\n-            final Collator myCollator = createCollator();\n+    static final private class CollatorHelper {", "originalCommit": "61945a1d30a1dcb4b03e58ba17a7034777f068a7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzUyMTMwNA==", "url": "https://github.com/unicode-org/cldr/pull/775#discussion_r503521304", "bodyText": "The Comparator depends on the Collator.", "author": "srl295", "createdAt": "2020-10-12T20:40:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzUxNzMwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU4NjgzNA==", "url": "https://github.com/unicode-org/cldr/pull/775#discussion_r503586834", "bodyText": "ok, makes sense", "author": "macchiati", "createdAt": "2020-10-12T23:40:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzUxNzMwMw=="}], "type": "inlineReview"}, {"oid": "4e37587e5d796071412249f7a9dff16d06102463", "url": "https://github.com/unicode-org/cldr/commit/4e37587e5d796071412249f7a9dff16d06102463", "message": "CLDR-14180 Bill Pugh singletons\n\nMultiple classes, notably:\n- DBUtils: need special handling for test instances\n- restructured SortMode subclasses some to reduce object creation\n- CLDRConfig: needs special handling per environment", "committedDate": "2020-10-12T23:06:20Z", "type": "forcePushed"}, {"oid": "de912f4c0ba09304266e3e3db3c964e50d1d5c41", "url": "https://github.com/unicode-org/cldr/commit/de912f4c0ba09304266e3e3db3c964e50d1d5c41", "message": "CLDR-14180 Bill Pugh singletons\n\nMultiple classes, notably:\n- DBUtils: need special handling for test instances\n- restructured SortMode subclasses to reduce object creation\n- CLDRConfig: needs special handling per environment", "committedDate": "2020-10-12T23:15:29Z", "type": "forcePushed"}, {"oid": "a99393e5cc43a4390464c2f233d715b18bc1711d", "url": "https://github.com/unicode-org/cldr/commit/a99393e5cc43a4390464c2f233d715b18bc1711d", "message": "CLDR-14180 Bill Pugh singletons\n\nMultiple classes, notably:\n- DBUtils: need special handling for test instances\n- restructured SortMode subclasses to reduce object creation\n- CLDRConfig: needs special handling per environment", "committedDate": "2020-10-12T23:22:59Z", "type": "forcePushed"}, {"oid": "097faa0da98b1b328f3af1b55cdc07a8966fcaf1", "url": "https://github.com/unicode-org/cldr/commit/097faa0da98b1b328f3af1b55cdc07a8966fcaf1", "message": "CLDR-14180 Bill Pugh singletons\n\nMultiple classes, notably:\n- DBUtils: need special handling for test instances\n- restructured SortMode subclasses to reduce object creation\n- CLDRConfig: needs special handling per environment\n- deprecated CLDRConfig.getStandardCodes() - just use StandardCodes.make()", "committedDate": "2020-10-12T23:42:15Z", "type": "forcePushed"}, {"oid": "b2339d1a8b3a92377135fdfd6d62343e5132fb20", "url": "https://github.com/unicode-org/cldr/commit/b2339d1a8b3a92377135fdfd6d62343e5132fb20", "message": "CLDR-14180 Bill Pugh singletons\n\nMultiple classes, notably:\n- DBUtils: need special handling for test instances\n- restructured SortMode subclasses to reduce object creation\n- CLDRConfig: needs special handling per environment\n- deprecated CLDRConfig.getStandardCodes() - just use StandardCodes.make()", "committedDate": "2020-10-12T23:47:03Z", "type": "forcePushed"}, {"oid": "61041cd5d9d5d2661476a285ead8f25553bf49aa", "url": "https://github.com/unicode-org/cldr/commit/61041cd5d9d5d2661476a285ead8f25553bf49aa", "message": "CLDR-14180 Bill Pugh singletons\n\nMultiple classes, notably:\n- DBUtils: need special handling for test instances\n- restructured SortMode subclasses to reduce object creation\n- CLDRConfig: note special handling per environment. Many getter functions\nalready were practically static in semantics, but the API is retained as\nnon-static. Added some documentation.\n- deprecated CLDRConfig.getStandardCodes(), as callers should use StandardCodes.make()", "committedDate": "2020-10-13T14:30:26Z", "type": "commit"}, {"oid": "61041cd5d9d5d2661476a285ead8f25553bf49aa", "url": "https://github.com/unicode-org/cldr/commit/61041cd5d9d5d2661476a285ead8f25553bf49aa", "message": "CLDR-14180 Bill Pugh singletons\n\nMultiple classes, notably:\n- DBUtils: need special handling for test instances\n- restructured SortMode subclasses to reduce object creation\n- CLDRConfig: note special handling per environment. Many getter functions\nalready were practically static in semantics, but the API is retained as\nnon-static. Added some documentation.\n- deprecated CLDRConfig.getStandardCodes(), as callers should use StandardCodes.make()", "committedDate": "2020-10-13T14:30:26Z", "type": "forcePushed"}]}