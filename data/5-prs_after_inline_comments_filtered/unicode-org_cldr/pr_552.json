{"pr_number": 552, "pr_title": "CLDR-13792 fix error messages for bad emoji", "pr_createdAt": "2020-07-08T04:52:48Z", "pr_url": "https://github.com/unicode-org/cldr/pull/552", "timeline": [{"oid": "d71a3aeeb614d30386f7db36b42cc5f93459a20d", "url": "https://github.com/unicode-org/cldr/commit/d71a3aeeb614d30386f7db36b42cc5f93459a20d", "message": "CLDR-13792 fix error messages for bad emoji", "committedDate": "2020-07-08T04:51:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI4MjAwNg==", "url": "https://github.com/unicode-org/cldr/pull/552#discussion_r451282006", "bodyText": "The Eclipse reformatting cleans up some stuff like this.", "author": "macchiati", "createdAt": "2020-07-08T04:53:33Z", "path": "tools/cldr-unittest/src/org/unicode/cldr/unittest/TestCheckCLDR.java", "diffHunk": "@@ -68,7 +71,7 @@\n \n public class TestCheckCLDR extends TestFmwk {\n     static CLDRConfig testInfo = CLDRConfig.getInstance();\n-    private final Set<String> eightPointLocales = new TreeSet<String>(", "originalCommit": "d71a3aeeb614d30386f7db36b42cc5f93459a20d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI4MjI1NQ==", "url": "https://github.com/unicode-org/cldr/pull/552#discussion_r451282255", "bodyText": "This is the only new part. We check to make sure we return errors on both E10-386 (root emoji codes) and ^^^", "author": "macchiati", "createdAt": "2020-07-08T04:54:24Z", "path": "tools/cldr-unittest/src/org/unicode/cldr/unittest/TestCheckCLDR.java", "diffHunk": "@@ -457,6 +460,52 @@ public void TestCheckNew() {\n         errln(\"No failure message.\");\n     }\n \n+    public void TestCheckNewRootFailure() {", "originalCommit": "d71a3aeeb614d30386f7db36b42cc5f93459a20d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI4MjQyMQ==", "url": "https://github.com/unicode-org/cldr/pull/552#discussion_r451282421", "bodyText": "clean up the test. Better results (shouldn't have checked bailey value)", "author": "macchiati", "createdAt": "2020-07-08T04:55:02Z", "path": "tools/java/org/unicode/cldr/test/CheckCLDR.java", "diffHunk": "@@ -1094,10 +1094,11 @@ public final CheckCLDR check(String path, String fullPath, String value, Options\n          */\n         // if (value == cldrFileToCheck.getBaileyValue(path, null, null) && value != cldrFileToCheck.getWinningValue(path)) {\n         if (value != null\n-            && value.equals(cldrFileToCheck.getBaileyValue(path, null, null))\n-            && !value.equals(cldrFileToCheck.getWinningValue(path))) {\n-            return this;\n+            && !value.equals(cldrFileToCheck.getWinningValue(path))\n+            && cldrFileToCheck.getUnresolved().getStringValue(path) == null) {", "originalCommit": "d71a3aeeb614d30386f7db36b42cc5f93459a20d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI4MjYyNg==", "url": "https://github.com/unicode-org/cldr/pull/552#discussion_r451282626", "bodyText": "cleaned up this code. Simpler, since we just check the format of the value.", "author": "macchiati", "createdAt": "2020-07-08T04:55:45Z", "path": "tools/java/org/unicode/cldr/test/CheckNew.java", "diffHunk": "@@ -24,41 +24,27 @@ public CheckCLDR setCldrFileToCheck(CLDRFile cldrFileToCheck, Options options,\n         if (cldrFileToCheck == null) {\n             return this;\n         }\n-        //        if (Phase.VETTING == getPhase()) {\n-        //            setSkipTest(false); // ok\n-        //        } else {\n-        //            setSkipTest(true);\n-        //            return this;\n-        //        }\n-\n         super.setCldrFileToCheck(cldrFileToCheck, options, possibleErrors);\n-        annotationsRoot = CLDRConfig.getInstance().getAnnotationsFactory().make(\"root\", false);\n+        isRoot = \"root\".equals(cldrFileToCheck.getLocaleID());", "originalCommit": "d71a3aeeb614d30386f7db36b42cc5f93459a20d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI4NTE0NA==", "url": "https://github.com/unicode-org/cldr/pull/552#discussion_r451285144", "bodyText": "Why are we using the locale code for Quich\u00e9 here? Do we assume it has no annotations? A comment would help...", "author": "pedberg-icu", "createdAt": "2020-07-08T05:05:54Z", "path": "tools/cldr-unittest/src/org/unicode/cldr/unittest/TestCheckCLDR.java", "diffHunk": "@@ -457,6 +460,52 @@ public void TestCheckNew() {\n         errln(\"No failure message.\");\n     }\n \n+    public void TestCheckNewRootFailure() {\n+        // Check that we get an error with the root value for an emoji.\n+        final Factory annotationsFactory = testInfo.getCommonAndSeedAndMainAndAnnotationsFactory();\n+        String locale = \"quc\";", "originalCommit": "d71a3aeeb614d30386f7db36b42cc5f93459a20d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI4NjA5OA==", "url": "https://github.com/unicode-org/cldr/pull/552#discussion_r451286098", "bodyText": "Is \"E10-836\" the root annotation for @cp=\\\"\ud83d\ude00\\\" ?? This is a bit cryptic...", "author": "pedberg-icu", "createdAt": "2020-07-08T05:09:29Z", "path": "tools/cldr-unittest/src/org/unicode/cldr/unittest/TestCheckCLDR.java", "diffHunk": "@@ -457,6 +460,52 @@ public void TestCheckNew() {\n         errln(\"No failure message.\");\n     }\n \n+    public void TestCheckNewRootFailure() {\n+        // Check that we get an error with the root value for an emoji.\n+        final Factory annotationsFactory = testInfo.getCommonAndSeedAndMainAndAnnotationsFactory();\n+        String locale = \"quc\";\n+        String path = \"//ldml/annotations/annotation[@cp=\\\"\ud83d\ude00\\\"][@type=\\\"tts\\\"]\";\n+        CheckCLDR c = new CheckNew(annotationsFactory);\n+        List<CheckStatus> result = new ArrayList<>();\n+        Map<String, String> options = new HashMap<>();\n+        for (Phase phase : Phase.values()) {\n+            options.put(Options.Option.phase.getKey(), phase.toString());\n+            for (String value : Arrays.asList(\"E10-836\", CldrUtility.INHERITANCE_MARKER)) {\n+\n+                // make a fake locale\n+                XMLSource rootSource = new SimpleXMLSource(\"root\");\n+                rootSource.putValueAtPath(path, \"E10-836\");", "originalCommit": "d71a3aeeb614d30386f7db36b42cc5f93459a20d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6075d99d5bb4cf0b745b85efc0e9a76aaca941f7", "url": "https://github.com/unicode-org/cldr/commit/6075d99d5bb4cf0b745b85efc0e9a76aaca941f7", "message": "CLDR-13792 drop bogus items so we don't get errors from them; skip purely inherited items; adjust test to be cleaner (no quc, regular root values)", "committedDate": "2020-07-08T17:32:02Z", "type": "commit"}]}