{"pr_number": 414, "pr_title": "CLDR-13630 Fix verification chart for numbers", "pr_createdAt": "2020-03-28T01:27:13Z", "pr_url": "https://github.com/unicode-org/cldr/pull/414", "timeline": [{"oid": "531e2b3d041324292bb1f89789c1c6461d688216", "url": "https://github.com/unicode-org/cldr/commit/531e2b3d041324292bb1f89789c1c6461d688216", "message": "CLDR-13630 Fix verification chart for numbers", "committedDate": "2020-03-28T01:24:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTczNTc5Mg==", "url": "https://github.com/unicode-org/cldr/pull/414#discussion_r399735792", "bodyText": "What is the problem with \"cs\" compact decimals? Is there a ticket?", "author": "pedberg-icu", "createdAt": "2020-03-29T02:39:20Z", "path": "tools/cldr-unittest/src/org/unicode/cldr/unittest/TestCompactNumbers.java", "diffHunk": "@@ -0,0 +1,91 @@\n+package org.unicode.cldr.unittest;\n+\n+import java.util.LinkedHashSet;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.Set;\n+\n+import org.unicode.cldr.test.BuildIcuCompactDecimalFormat;\n+import org.unicode.cldr.test.BuildIcuCompactDecimalFormat.CurrencyStyle;\n+import org.unicode.cldr.util.CLDRConfig;\n+import org.unicode.cldr.util.CLDRFile;\n+import org.unicode.cldr.util.Factory;\n+import org.unicode.cldr.util.ICUServiceBuilder;\n+import org.unicode.cldr.util.StandardCodes;\n+import org.unicode.cldr.util.SupplementalDataInfo;\n+import org.unicode.cldr.util.VerifyCompactNumbers;\n+\n+import com.ibm.icu.text.CompactDecimalFormat;\n+import com.ibm.icu.text.CompactDecimalFormat.CompactStyle;\n+import com.ibm.icu.text.NumberFormat;\n+import com.ibm.icu.util.ULocale;\n+\n+public class TestCompactNumbers  extends TestFmwkPlus {\n+    static final boolean DEBUG = false;\n+    private static StandardCodes sc = StandardCodes.make();\n+    private static final CLDRConfig CLDRCONFIG = CLDRConfig.getInstance();\n+    private static final SupplementalDataInfo SDI = CLDRCONFIG.getSupplementalDataInfo();\n+    private static final CLDRFile ENGLISH = CLDRCONFIG.getEnglish();\n+    private static final Factory factory2 = CLDRCONFIG.getCldrFactory();\n+\n+    public static void main(String[] args) {\n+        new TestCompactNumbers().run(args);\n+    }\n+\n+    public void TestVerify() {\n+        // Just verify no crashes\n+        CLDRFile cldrFile = factory2.make(\"it\", true);\n+        Appendable out = new StringBuilder();\n+        VerifyCompactNumbers.showNumbers(cldrFile, true, \"EUR\", out, factory2);\n+        if (DEBUG) {\n+            System.out.println(out);\n+        }\n+    }\n+\n+    public void TestInternals() {\n+        // Just verify no crashes\n+        String locale = \"it\";\n+        String currencyCode = \"EUR\";\n+        ULocale locale2 = ULocale.forLanguageTag(locale);\n+        CLDRFile cldrFile = factory2.make(locale, true);\n+        Set<String> debugCreationErrors = new LinkedHashSet<>();\n+        String[] debugOriginals = null;\n+\n+        ICUServiceBuilder builder = new ICUServiceBuilder().setCldrFile(cldrFile);\n+        NumberFormat nf = builder.getNumberFormat(1);\n+\n+        CompactDecimalFormat cdf = BuildIcuCompactDecimalFormat.build(cldrFile, debugCreationErrors,\n+            debugOriginals, CompactStyle.SHORT, locale2, CurrencyStyle.PLAIN, currencyCode);\n+\n+        Map<String, Map<String, String>> data = BuildIcuCompactDecimalFormat.buildCustomData(cldrFile, CompactStyle.SHORT, CurrencyStyle.PLAIN);\n+        if (DEBUG) {\n+            for (Entry<String, Map<String, String>> entry : data.entrySet()) {\n+                System.out.println(entry);\n+            }\n+        }\n+\n+        CompactDecimalFormat cdfs = BuildIcuCompactDecimalFormat.build(cldrFile, debugCreationErrors,\n+            debugOriginals, CompactStyle.LONG, locale2, CurrencyStyle.PLAIN, currencyCode);\n+        CompactDecimalFormat cdfCurr = BuildIcuCompactDecimalFormat.build(cldrFile, debugCreationErrors,\n+            debugOriginals, CompactStyle.SHORT, locale2, CurrencyStyle.CURRENCY, currencyCode);\n+\n+        Set<Double> allSamples = VerifyCompactNumbers.collectSamplesAndSetFormats(currencyCode, locale, SDI, cdf, cdfs, cdfCurr);\n+\n+        for (double source : allSamples) {\n+            if (false && source == 22000000 && locale.equals(\"cs\")) {\n+                System.out.println(\"**\");", "originalCommit": "531e2b3d041324292bb1f89789c1c6461d688216", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc3NDkwMg==", "url": "https://github.com/unicode-org/cldr/pull/414#discussion_r399774902", "bodyText": "That's just debugging code. (there a bunch of that that could be cleaned up in various areas, but I'd rather not try to address in v37)", "author": "macchiati", "createdAt": "2020-03-29T10:07:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTczNTc5Mg=="}], "type": "inlineReview"}]}