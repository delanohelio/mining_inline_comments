{"pr_number": 404, "pr_title": "CLDR-13636 Make ExampleGenerator faster, clear cache less", "pr_createdAt": "2020-03-24T13:15:25Z", "pr_url": "https://github.com/unicode-org/cldr/pull/404", "timeline": [{"oid": "ff77af0379f8dc0ee84701ca7a4d4cd7f79f95bc", "url": "https://github.com/unicode-org/cldr/commit/ff77af0379f8dc0ee84701ca7a4d4cd7f79f95bc", "message": "CLDR-13636 Make ExampleGenerator faster, clear cache less\n\n-New RecordingCLDRFile.java, ExampleDependencies.java, ExampleCache.java\n\n-TestExampleGeneratorDependencies: use RecordingCLDRFile, write ExampleDependencies\n\n-ExampleGenerator: use ExampleCache, ExampleCacheItem\n\n-ExampleGenerator: replace INHERITANCE_MARKER with Bailey before get cache, not after\n\n-ExampleGenerator: move some code to new subroutine constructExampleHtml\n\n-ExampleCache: use starredPath for cache key; AVOID_CLEARING_CACHE = true\n\n-Prevent some NullPointerExceptions, do not just catch and ignore them; make SHOW_ERROR true\n\n-Call notifyListeners only if the winning value changed\n\n-Call notifyListeners from voteForValue, not from setValueFromResolver\n\n-Delete unused code: WHAT_DELETE, WHAT_VERIFY, deleteValue, internalDeleteValue\n\n-Clean-up\n\n-Comments", "committedDate": "2020-03-24T13:13:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc3NTc3Mw==", "url": "https://github.com/unicode-org/cldr/pull/404#discussion_r399775773", "bodyText": "looks like this is unused except when newVal != null, so put under that condition.", "author": "macchiati", "createdAt": "2020-03-29T10:15:57Z", "path": "tools/cldr-apps/src/org/unicode/cldr/web/STFactory.java", "diffHunk": "@@ -1143,7 +1144,12 @@ public synchronized void voteForValue(User user, String distinguishingXpath, Str\n                 }\n             }\n \n+            String oldVal = xmlsource.getValueAtDPath(distinguishingXpath);", "originalCommit": "ff77af0379f8dc0ee84701ca7a4d4cd7f79f95bc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg0MDY2MA==", "url": "https://github.com/unicode-org/cldr/pull/404#discussion_r399840660", "bodyText": "OK -- sorry I merged before I saw your comment. I'll do that in another PR.", "author": "btangmu", "createdAt": "2020-03-29T19:17:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc3NTc3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg1ODU4OQ==", "url": "https://github.com/unicode-org/cldr/pull/404#discussion_r399858589", "bodyText": "On further examination, we need to get oldVal before processing the vote, and we don't know whether newVal will be null until after processing the vote, so we need to get oldVal unconditionally. Note that newVal is the winning value after the vote, and isn't necessarily the same as \"value\", which is what the user voted for. \"value\" is null if the user abstained, but newVal is only null if there's no winning value, not even an inherited or baseline value. This function is only called once, when a user submits a vote, so it's not really a hot spot or inner-loop context. OK?", "author": "btangmu", "createdAt": "2020-03-29T21:48:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc3NTc3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc3NTgzNQ==", "url": "https://github.com/unicode-org/cldr/pull/404#discussion_r399775835", "bodyText": "Is this unused? Please explain in a comment on the PR.", "author": "macchiati", "createdAt": "2020-03-29T10:16:35Z", "path": "tools/cldr-apps/src/org/unicode/cldr/web/STFactory.java", "diffHunk": "@@ -1293,84 +1304,6 @@ private void internalSetVoteForValue(User user, String distinguishingXpath, Stri\n             stamp.next();\n         }\n \n-        @Override", "originalCommit": "ff77af0379f8dc0ee84701ca7a4d4cd7f79f95bc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg0MTMyNg==", "url": "https://github.com/unicode-org/cldr/pull/404#discussion_r399841326", "bodyText": "Yes, it's unused, unreachable code. Though I don't know the history behind WHAT_DELETE and deleteValue, I suspect their original purpose is now accomplished by Abstain.", "author": "btangmu", "createdAt": "2020-03-29T19:23:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc3NTgzNQ=="}], "type": "inlineReview"}]}