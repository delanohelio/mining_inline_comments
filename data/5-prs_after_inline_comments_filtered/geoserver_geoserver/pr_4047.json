{"pr_number": 4047, "pr_title": "[GEOS-9498] Add Backward compatibility on Layergroups with legacy Cascaded WMS Layers", "pr_createdAt": "2020-02-12T13:16:50Z", "pr_url": "https://github.com/geoserver/geoserver/pull/4047", "timeline": [{"oid": "83ffedb6e15f92c455acf0d5cdc6658894247161", "url": "https://github.com/geoserver/geoserver/commit/83ffedb6e15f92c455acf0d5cdc6658894247161", "message": "[GEOS-9498] Add Backward compatibility on Layergroups with legacy\nCascaded WMS Layers\n\n- fixes in LayerGroupHelper to resolve correct remote style\nfor cascaded wms layer memeber layer of group\n- added new unit tests", "committedDate": "2020-02-12T13:20:15Z", "type": "forcePushed"}, {"oid": "4a95e1092939c3ac1d4d7a472572c44a8f3f5777", "url": "https://github.com/geoserver/geoserver/commit/4a95e1092939c3ac1d4d7a472572c44a8f3f5777", "message": "[GEOS-9498] Add Backward compatibility on Layergroups with legacy\nCascaded WMS Layers\n\n- fixes in LayerGroupHelper to resolve correct remote style\nfor cascaded wms layer memeber layer of group\n- added new unit tests", "committedDate": "2020-02-12T13:27:44Z", "type": "forcePushed"}, {"oid": "94415eeb69ac0003212b30d723521a113a82495b", "url": "https://github.com/geoserver/geoserver/commit/94415eeb69ac0003212b30d723521a113a82495b", "message": "[GEOS-9498] Add Backward compatibility on Layergroups with legacy\nCascaded WMS Layers\n\n- fixes in LayerGroupHelper to resolve correct remote style\nfor cascaded wms layer memeber layer of group\n- added new unit tests", "committedDate": "2020-02-12T13:29:39Z", "type": "forcePushed"}, {"oid": "814b6e14c8f3152d45be8125251ca2b69a918423", "url": "https://github.com/geoserver/geoserver/commit/814b6e14c8f3152d45be8125251ca2b69a918423", "message": "[GEOS-9498] Add Backward compatibility on Layergroups with legacy\nCascaded WMS Layers\n\n- fixes in LayerGroupHelper to resolve correct remote style\nfor cascaded wms layer memeber layer of group\n- added new unit tests", "committedDate": "2020-02-16T15:39:20Z", "type": "commit"}, {"oid": "814b6e14c8f3152d45be8125251ca2b69a918423", "url": "https://github.com/geoserver/geoserver/commit/814b6e14c8f3152d45be8125251ca2b69a918423", "message": "[GEOS-9498] Add Backward compatibility on Layergroups with legacy\nCascaded WMS Layers\n\n- fixes in LayerGroupHelper to resolve correct remote style\nfor cascaded wms layer memeber layer of group\n- added new unit tests", "committedDate": "2020-02-16T15:39:20Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY0MjIzNw==", "url": "https://github.com/geoserver/geoserver/pull/4047#discussion_r380642237", "bodyText": "Why doesn't the group.getStyles() already contains the correct style?  When a layer is added the layer group a style is selected right? at that moment it would make  sense to select the right style for remote layers too.", "author": "nmco", "createdAt": "2020-02-18T12:30:55Z", "path": "src/main/src/main/java/org/geoserver/catalog/LayerGroupHelper.java", "diffHunk": "@@ -241,7 +242,18 @@ private static void allStylesForRendering(\n                     PublishedInfo p = group.getLayers().get(i);\n                     StyleInfo s = group.getStyles().get(i);\n                     if (p instanceof LayerInfo) {\n-                        styles.add(group.getStyles().get(i));", "originalCommit": "814b6e14c8f3152d45be8125251ca2b69a918423", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY3MTE1MQ==", "url": "https://github.com/geoserver/geoserver/pull/4047#discussion_r380671151", "bodyText": "because the style group does not know about the layer default", "author": "imranrajjad", "createdAt": "2020-02-18T13:30:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY0MjIzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY0MjkwMg==", "url": "https://github.com/geoserver/geoserver/pull/4047#discussion_r380642902", "bodyText": "I find this method hard to read:\n\nWhy is named process layer? it doesn't seem to process anything specific, it just retrieves the correct style for a remote layer no? so why not name it something like getRemoteWmsLayerStyle.\nWhat's the provided styleInfo object?", "author": "nmco", "createdAt": "2020-02-18T12:32:22Z", "path": "src/main/src/main/java/org/geoserver/catalog/LayerGroupHelper.java", "diffHunk": "@@ -531,6 +543,29 @@ private static void expandStyleGroup(\n         }\n     }\n \n+    /**\n+     * Ensures that WMSLayer Info inside layergroup associates with correct remote style\n+     *\n+     * @return returns a compatible StyleInfo representing a remote style if required\n+     */\n+    private static StyleInfo processWMSLayer(WMSLayerInfo wmsLayerInfo, StyleInfo styleInfo) {\n+\n+        if (styleInfo == null) styleInfo = wmsLayerInfo.getDefaultStyle();", "originalCommit": "814b6e14c8f3152d45be8125251ca2b69a918423", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY1MjY5Mg==", "url": "https://github.com/geoserver/geoserver/pull/4047#discussion_r380652692", "bodyText": "understood will change name.\nThe provided style is whatever style was configured against the layer during layergroup configuration. In case of cascaded wms layer, its the default raster", "author": "imranrajjad", "createdAt": "2020-02-18T12:53:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY0MjkwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY0MzQyOA==", "url": "https://github.com/geoserver/geoserver/pull/4047#discussion_r380643428", "bodyText": "If the select style is not a valid style for this layer then an exception should be throw. Otherwise this may hide this fact and everything will look fine until it doesn't.", "author": "nmco", "createdAt": "2020-02-18T12:33:34Z", "path": "src/main/src/main/java/org/geoserver/catalog/LayerGroupHelper.java", "diffHunk": "@@ -531,6 +543,29 @@ private static void expandStyleGroup(\n         }\n     }\n \n+    /**\n+     * Ensures that WMSLayer Info inside layergroup associates with correct remote style\n+     *\n+     * @return returns a compatible StyleInfo representing a remote style if required\n+     */\n+    private static StyleInfo processWMSLayer(WMSLayerInfo wmsLayerInfo, StyleInfo styleInfo) {\n+\n+        if (styleInfo == null) styleInfo = wmsLayerInfo.getDefaultStyle();\n+        else if (!wmsLayerInfo.findRemoteStyleByName(styleInfo.getName()).isPresent()) {\n+            if (LOGGER.isLoggable(Level.FINE)) {", "originalCommit": "814b6e14c8f3152d45be8125251ca2b69a918423", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY2NjYzMQ==", "url": "https://github.com/geoserver/geoserver/pull/4047#discussion_r380666631", "bodyText": "Resourcer?", "author": "aaime", "createdAt": "2020-02-18T13:21:18Z", "path": "src/main/src/main/java/org/geoserver/catalog/LayerGroupHelper.java", "diffHunk": "@@ -531,6 +543,29 @@ private static void expandStyleGroup(\n         }\n     }\n \n+    /**\n+     * Ensures that WMSLayer Info inside layergroup associates with correct remote style\n+     *\n+     * @return returns a compatible StyleInfo representing a remote style if required\n+     */\n+    private static StyleInfo processWMSLayer(WMSLayerInfo wmsLayerInfo, StyleInfo styleInfo) {\n+\n+        if (styleInfo == null) styleInfo = wmsLayerInfo.getDefaultStyle();\n+        else if (!wmsLayerInfo.findRemoteStyleByName(styleInfo.getName()).isPresent()) {\n+            if (LOGGER.isLoggable(Level.FINE)) {\n+                LOGGER.fine(\n+                        styleInfo.getName()\n+                                + \" style is not a known remote style for WMS Layer \"\n+                                + wmsLayerInfo\n+                                + \",\"\n+                                + \" Re-configure the Resourcer\");", "originalCommit": "814b6e14c8f3152d45be8125251ca2b69a918423", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY3MDg0NA==", "url": "https://github.com/geoserver/geoserver/pull/4047#discussion_r380670844", "bodyText": "\ud83e\udd26\u200d\u2642", "author": "imranrajjad", "createdAt": "2020-02-18T13:29:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY2NjYzMQ=="}], "type": "inlineReview"}, {"oid": "314eb6ae9cd12e7724fdf0672626f6fb666f34dd", "url": "https://github.com/geoserver/geoserver/commit/314eb6ae9cd12e7724fdf0672626f6fb666f34dd", "message": "[GEOS-9489] addressed Nuno and AA changes\n\n-fixed comments\n-changed function name", "committedDate": "2020-02-19T08:07:33Z", "type": "commit"}, {"oid": "314eb6ae9cd12e7724fdf0672626f6fb666f34dd", "url": "https://github.com/geoserver/geoserver/commit/314eb6ae9cd12e7724fdf0672626f6fb666f34dd", "message": "[GEOS-9489] addressed Nuno and AA changes\n\n-fixed comments\n-changed function name", "committedDate": "2020-02-19T08:07:33Z", "type": "forcePushed"}]}