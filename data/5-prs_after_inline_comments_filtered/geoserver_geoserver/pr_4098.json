{"pr_number": 4098, "pr_title": "[GSIP-184] Promote MBStyle to extension", "pr_createdAt": "2020-03-02T18:22:50Z", "pr_url": "https://github.com/geoserver/geoserver/pull/4098", "timeline": [{"oid": "0c7278c43c377c61647c744c5aaf8bdc47e519ef", "url": "https://github.com/geoserver/geoserver/commit/0c7278c43c377c61647c744c5aaf8bdc47e519ef", "message": "move to extension\n\nSigned-off-by: Jody Garnett <jody.garnett@gmail.com>", "committedDate": "2020-03-02T18:19:18Z", "type": "commit"}, {"oid": "20c0e414563f4c544b54ce2f0e609ac7a5f38037", "url": "https://github.com/geoserver/geoserver/commit/20c0e414563f4c544b54ce2f0e609ac7a5f38037", "message": "regression in handling of spritesheets\n\nSigned-off-by: Jody Garnett <jody.garnett@gmail.com>", "committedDate": "2020-03-02T18:19:26Z", "type": "commit"}, {"oid": "41fdb7ccb709a967c96f068d626273a58a4a8611", "url": "https://github.com/geoserver/geoserver/commit/41fdb7ccb709a967c96f068d626273a58a4a8611", "message": "Tracking changes in geotools library\n\nSigned-off-by: Jody Garnett <jody.garnett@gmail.com>", "committedDate": "2020-03-02T18:19:31Z", "type": "commit"}, {"oid": "00ad83349ee5ba4f100626aaf1cc47bf97fe7bc2", "url": "https://github.com/geoserver/geoserver/commit/00ad83349ee5ba4f100626aaf1cc47bf97fe7bc2", "message": "Fix up installation instructions with new download location\n\nSigned-off-by: Jody Garnett <jody.garnett@gmail.com>", "committedDate": "2020-03-02T18:19:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU2NzUyOA==", "url": "https://github.com/geoserver/geoserver/pull/4098#discussion_r386567528", "bodyText": "@tbarsballe there is a significant regression found by this test, to be handled in the geotools code.\nIt looks like references to a sprite sheet are not being picked or have changed. Still I would like to track this as a separate issue rather than hold up the pull request (which just covers geoserver integration).", "author": "jodygarnett", "createdAt": "2020-03-02T18:25:19Z", "path": "src/extension/mbstyle/src/test/java/org/geoserver/community/mbstyle/web/MBStyleEditPageTest.java", "diffHunk": "@@ -81,20 +82,14 @@ public void testMbstyleChange() throws Exception {\n         tester.executeAjaxEvent(\"apply\", \"click\");\n         tester.assertModelValue(\"styleForm:context:panel:previewStyleGroup\", true);\n         assertNotNull(getCatalog().getStyleByName(\"mbstyle\").getSLD());\n-        PointSymbolizer ps =\n-                (PointSymbolizer)\n-                        getCatalog()\n-                                .getStyleByName(\"mbstyle\")\n-                                .getStyle()\n-                                .featureTypeStyles()\n-                                .get(0)\n-                                .rules()\n-                                .get(0)\n-                                .symbolizers()\n-                                .get(0);\n-        ExternalGraphic eg = (ExternalGraphic) ps.getGraphic().graphicalSymbols().get(0);\n-        assertEquals(\n-                eg.getURI(),\n-                \"http://localhost:8080/geoserver/styles/mbsprites#icon=${strURLEncode('circle')}&size=${strURLEncode(Interpolate(POP_MAX,0,0.7,40000000,3.7,'numeric'))}\");\n+        Style style = getCatalog().getStyleByName(\"mbstyle\").getStyle();\n+        Symbolizer sym = style.featureTypeStyles().get(0).rules().get(0).symbolizers().get(0);\n+\n+        assertTrue(sym instanceof PointSymbolizer);", "originalCommit": "00ad83349ee5ba4f100626aaf1cc47bf97fe7bc2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU4ODQ3Nw==", "url": "https://github.com/geoserver/geoserver/pull/4098#discussion_r386588477", "bodyText": "Reporting issue here: https://osgeo-org.atlassian.net/browse/GEOT-6522", "author": "jodygarnett", "createdAt": "2020-03-02T19:03:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU2NzUyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU5NTMwNg==", "url": "https://github.com/geoserver/geoserver/pull/4098#discussion_r386595306", "bodyText": "The test itself is intended to just make sure geoserver properly updates the cached SLD for non-SLD styles in the resource pool when a style is saved using the UI; it just happens to use a style that contains an icon.\nThe icon lookup is to verify the conversion worked.\nAs for the spritesheet reference - for named icons matching the well-known icon names in GeoServer (e.g. 'circle'), mbstyle should be bypassing the spritesheet entirely. I can't recall where exactly that special case was implemented - I'll try and track it down. So, the issue isn't quite that its not finding the spritesheet, since the spritesheet listed in the style is just a dummy value and doesn't exist\nAs an aside, commenting out a portion of the test and setting  the test to @Ignore is overkill - just use Ignore and preserve the test content.", "author": "tbarsballe", "createdAt": "2020-03-02T19:16:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU2NzUyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU5OTA1Nw==", "url": "https://github.com/geoserver/geoserver/pull/4098#discussion_r386599057", "bodyText": "Andrea points out this change was intensional (https://osgeo-org.atlassian.net/browse/GEOT-6443) so I will update this test case to resolve.", "author": "jodygarnett", "createdAt": "2020-03-02T19:23:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU2NzUyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYwMDMyMw==", "url": "https://github.com/geoserver/geoserver/pull/4098#discussion_r386600323", "bodyText": "Right, that makes sense. You should just be able to grab a spritesheet + sprite name from one of the GeoTools MBStyle tests - the appearance of the style doesn't matter here, just that it gets properly translated into an SLD symbol", "author": "tbarsballe", "createdAt": "2020-03-02T19:25:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU2NzUyOA=="}], "type": "inlineReview"}, {"oid": "e6dd1664230b64eff8d2cc49f66e8f92c8160204", "url": "https://github.com/geoserver/geoserver/commit/e6dd1664230b64eff8d2cc49f66e8f92c8160204", "message": "release gs-mbstyle\n\nSigned-off-by: Jody Garnett <jody.garnett@gmail.com>", "committedDate": "2020-03-02T18:48:48Z", "type": "commit"}, {"oid": "4b5b666e89635af3ca23305ceb14d6b5454dc929", "url": "https://github.com/geoserver/geoserver/commit/4b5b666e89635af3ca23305ceb14d6b5454dc929", "message": "package mbstyle with appropriate license information\n\nSigned-off-by: Jody Garnett <jody.garnett@gmail.com>", "committedDate": "2020-03-02T22:12:07Z", "type": "commit"}, {"oid": "93add4c1994ccb87ca126bbdac8fb8cf79485aeb", "url": "https://github.com/geoserver/geoserver/commit/93add4c1994ccb87ca126bbdac8fb8cf79485aeb", "message": "external links for extension download\n\nSigned-off-by: Jody Garnett <jody.garnett@gmail.com>", "committedDate": "2020-03-03T00:00:08Z", "type": "commit"}, {"oid": "f8c27fd9a690702cef19e284578e1c2378bbd957", "url": "https://github.com/geoserver/geoserver/commit/f8c27fd9a690702cef19e284578e1c2378bbd957", "message": "restore test using label graphic\n\nSigned-off-by: Jody Garnett <jody.garnett@gmail.com>", "committedDate": "2020-03-03T06:08:31Z", "type": "commit"}]}