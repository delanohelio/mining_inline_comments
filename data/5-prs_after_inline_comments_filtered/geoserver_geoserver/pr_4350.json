{"pr_number": 4350, "pr_title": "[Backport 2.17.x][GEOS-9646]: INSPIRE validation get errors of GetMapRequest parameters", "pr_createdAt": "2020-06-29T21:42:33Z", "pr_url": "https://github.com/geoserver/geoserver/pull/4350", "timeline": [{"oid": "c355b2f91710dd5c6e314d97dd819999147a52c0", "url": "https://github.com/geoserver/geoserver/commit/c355b2f91710dd5c6e314d97dd819999147a52c0", "message": "[GEOS-9646]: INSPIRE validation get errors of GetMapRequest parameters", "committedDate": "2020-06-29T21:36:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU3MDAzMQ==", "url": "https://github.com/geoserver/geoserver/pull/4350#discussion_r451570031", "bodyText": "Was about to merge but wondered about one thing... if the parameter is present but empty does everything still work even in CITE compliant mode?\nFrom the spec:\n\nA client may request the default Style using a null value (as in \"STYLES=\"). If several layers are requested with a mixture of named and default styles, the STYLES parameter shall include null values between commas (as in \"STYLES=style1,,style2,,\"). If all layers are to be shown using the default style, either the form \"STYLES=\" or \"STYLES=,,,\" is valid.", "author": "aaime", "createdAt": "2020-07-08T14:03:47Z", "path": "src/wms/src/main/java/org/geoserver/wms/map/GetMapKvpRequestReader.java", "diffHunk": "@@ -288,13 +301,27 @@ public GetMapRequest read(Object request, Map kvp, Map rawKvp) throws Exception\n         if (layerParam != null) {\n             List<String> layerNames = KvpUtils.readFlat(layerParam);\n             requestedLayerInfos.addAll(parseLayers(layerNames, remoteOwsUrl, remoteOwsType));\n+        } else if (citeCompliant && getMap.getSldBody() == null && getMap.getSld() == null) {\n+            // The SLD extensions to WMS allow a request not to have layers, as long as a full SLD\n+            // is specified either using &sld or &sld_body. The error must not be thrown in these\n+            // conditions (which are probably not what INSPIRE had in mind, but nonetheless a OGC\n+            // specification.\n+            throw new ServiceException(\n+                    \"GetMap LAYERS parameter is mandatory if SLD nor SLD_BODY are not specified\");\n         }\n \n         // raw styles parameter\n         String stylesParam = (String) kvp.get(\"STYLES\");\n         List<String> styleNameList = new ArrayList<String>();\n         if (stylesParam != null) {\n             styleNameList.addAll(KvpUtils.readFlat(stylesParam));\n+        } else if (citeCompliant && getMap.getSldBody() == null && getMap.getSld() == null) {", "originalCommit": "c355b2f91710dd5c6e314d97dd819999147a52c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}