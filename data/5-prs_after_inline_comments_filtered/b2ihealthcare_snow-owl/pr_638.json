{"pr_number": 638, "pr_title": "Fix for task synchronization conflicts", "pr_createdAt": "2020-08-14T15:13:56Z", "pr_url": "https://github.com/b2ihealthcare/snow-owl/pull/638", "timeline": [{"oid": "9b2c8774e8f9dce9d64dd2703d30bc3935deb55c", "url": "https://github.com/b2ihealthcare/snow-owl/commit/9b2c8774e8f9dce9d64dd2703d30bc3935deb55c", "message": "[snomed] Add test case for rebase-then-merge scenario", "committedDate": "2020-08-14T15:01:23Z", "type": "commit"}, {"oid": "44263445e33a524145426c587c13cf5948627503", "url": "https://github.com/b2ihealthcare/snow-owl/commit/44263445e33a524145426c587c13cf5948627503", "message": "[commons] Synchronize the contents of commit documents with changes\n\nIf an existing revision on the branch is revised, it should be put into\nthe commit document as a change, even if:\n\n- the source change set treated it as an addition, or\n- the revision is part of a merge and needed to be revised on both\nsource and target", "committedDate": "2020-08-14T15:04:40Z", "type": "commit"}, {"oid": "c9f516fbdd495ce075a6c3a764b92fd894021b3e", "url": "https://github.com/b2ihealthcare/snow-owl/commit/c9f516fbdd495ce075a6c3a764b92fd894021b3e", "message": "[commons] Extract the component ID from \"changed\" compare details...\n\n...when no property-level information is available", "committedDate": "2020-08-14T15:09:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk2NzE4OA==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/638#discussion_r470967188", "bodyText": "Does this synchronization still cause an extra revision (which is equivalent with the parent branch revision) on the child branch? If not, then it would worth adding an extra low-level check here to make sure there is no actual revision registered for parentConcept on the task2/task1 branches.", "author": "cmark", "createdAt": "2020-08-15T11:18:28Z", "path": "snomed/com.b2international.snowowl.snomed.core.rest.tests/src/com/b2international/snowowl/snomed/core/rest/branches/SnomedMergeApiTest.java", "diffHunk": "@@ -881,5 +881,42 @@ public void mergeThenRebaseOtherTask() throws Exception {\n \t\t\n \t\tgetComponent(b, SnomedComponentType.CONCEPT, conceptB, \"relationships()\").statusCode(200).extract().as(SnomedConcept.class);\n \t}\n-\n+\t\n+\t@Test\n+\tpublic void rebaseDivergedThenMerge() throws Exception {\n+\t\tfinal IBranchPath task1 = BranchPathUtils.createPath(branchPath, \"task1\");\n+\t\tbranching.createBranch(task1).statusCode(201);\n+\t\t\n+\t\tfinal IBranchPath task2 = BranchPathUtils.createPath(branchPath, \"task2\");\n+\t\tbranching.createBranch(task2).statusCode(201);\n+\t\t\n+\t\tfinal String task1Concept = createNewConcept(task1);\n+\t\tfinal String task2Concept = createNewConcept(task2);\n+\t\tfinal String parentConcept = createNewConcept(branchPath);\n+\n+\t\t// Synchronization makes parentConcept visible on task 2\n+\t\tgetComponent(task2, SnomedComponentType.CONCEPT, parentConcept).statusCode(404);\n+\t\tmerge(branchPath, task2, \"Synchronize task 2\").body(\"status\", equalTo(Merge.Status.COMPLETED.name()));\n+\t\tgetComponent(task2, SnomedComponentType.CONCEPT, parentConcept).statusCode(200);\n+\n+\t\t// Synchronization makes parentConcept visible on task 1\n+\t\tgetComponent(task1, SnomedComponentType.CONCEPT, parentConcept).statusCode(404);\n+\t\tmerge(branchPath, task1, \"Synchronize task 1\").body(\"status\", equalTo(Merge.Status.COMPLETED.name()));\n+\t\tgetComponent(task1, SnomedComponentType.CONCEPT, parentConcept).statusCode(200);", "originalCommit": "c9f516fbdd495ce075a6c3a764b92fd894021b3e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}