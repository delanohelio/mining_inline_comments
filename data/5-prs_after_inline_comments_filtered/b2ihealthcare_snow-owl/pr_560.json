{"pr_number": 560, "pr_title": "Improve iconId calculation to handle new semantic types", "pr_createdAt": "2020-05-18T14:16:10Z", "pr_url": "https://github.com/b2ihealthcare/snow-owl/pull/560", "timeline": [{"oid": "b1e01e1605a9e28ff96351b2176a4fdc7e9df22d", "url": "https://github.com/b2ihealthcare/snow-owl/commit/b1e01e1605a9e28ff96351b2176a4fdc7e9df22d", "message": "SO-4051: Update icon ID computation logic", "committedDate": "2020-05-17T16:16:42Z", "type": "commit"}, {"oid": "2131d62d203f295a6c62ac63b0a09ca576a65e1d", "url": "https://github.com/b2ihealthcare/snow-owl/commit/2131d62d203f295a6c62ac63b0a09ca576a65e1d", "message": "SO-4051: Add placeholder icons for semantic tags that should be...\n\n...used as icon IDs", "committedDate": "2020-05-17T16:24:06Z", "type": "commit"}, {"oid": "96f5d9d5ee1ccaedcd070afd6e4aee6f864b93bf", "url": "https://github.com/b2ihealthcare/snow-owl/commit/96f5d9d5ee1ccaedcd070afd6e4aee6f864b93bf", "message": "SO-4051: Treat FSN changes as source relationship changes\n\nTheir direct and indirect ancestors need to be added to the taxonomy so\nthat the concept's iconId can be recalculated.", "committedDate": "2020-05-18T13:51:35Z", "type": "commit"}, {"oid": "fe5b83865827adfb8ea79d639832246072758b08", "url": "https://github.com/b2ihealthcare/snow-owl/commit/fe5b83865827adfb8ea79d639832246072758b08", "message": "SO-4051: Add icon placeholder for \"product\" semantic tag as well\n\nThis will help choosing the correct icon for drug-device combination\nproducts.", "committedDate": "2020-05-18T14:07:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE0MjcwNg==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/560#discussion_r427142706", "bodyText": "\u26a0\ufe0f Missing active check?", "author": "cmark", "createdAt": "2020-05-19T08:59:26Z", "path": "snomed/com.b2international.snowowl.snomed.datastore/src/com/b2international/snowowl/snomed/datastore/index/change/SnomedRepositoryPreCommitHook.java", "diffHunk": "@@ -152,6 +153,32 @@ protected void preUpdateDocuments(StagingArea staging, RevisionSearcher index) t\n \t\t\t}\n \t\t}\n \t\t\n+\t\tstaging.getRemovedObjects(SnomedDescriptionIndexEntry.class).forEach(removedDescription -> {\n+\t\t\tif (removedDescription.isFsn() && removedDescription.isActive()) {\n+\t\t\t\tstatedSourceIds.add(removedDescription.getConceptId());\n+\t\t\t\tinferredSourceIds.add(removedDescription.getConceptId());\n+\t\t\t}\n+\t\t});\n+\t\t\n+\t\tstaging.getChangedRevisions(SnomedDescriptionIndexEntry.class, Set.of(\n+\t\t\t\tSnomedDescriptionIndexEntry.Fields.ACTIVE,\n+\t\t\t\tSnomedDescriptionIndexEntry.Fields.TERM)).forEach(diff -> {\n+\n+\t\t\tSnomedDescriptionIndexEntry newRevision = (SnomedDescriptionIndexEntry) diff.newRevision;\n+\t\t\t\n+\t\t\tif (newRevision.isFsn()) {", "originalCommit": "fe5b83865827adfb8ea79d639832246072758b08", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE0NTcwMg==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/560#discussion_r427145702", "bodyText": "A status change in either direction may result in the concept's \"official\" semantic tag changing.", "author": "apeteri", "createdAt": "2020-05-19T09:03:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE0MjcwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE0NjU4MQ==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/560#discussion_r427146581", "bodyText": "Right, then good to go.", "author": "cmark", "createdAt": "2020-05-19T09:05:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE0MjcwNg=="}], "type": "inlineReview"}]}