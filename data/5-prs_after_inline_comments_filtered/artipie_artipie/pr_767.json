{"pr_number": 767, "pr_title": "#606 - Add authentication push and install IT for Gem", "pr_createdAt": "2020-11-20T09:48:39Z", "pr_url": "https://github.com/artipie/artipie/pull/767", "timeline": [{"oid": "e66fa5578576f20788ccf4790d210b06848411a1", "url": "https://github.com/artipie/artipie/commit/e66fa5578576f20788ccf4790d210b06848411a1", "message": "#606 - Add auth IT for Gem", "committedDate": "2020-11-20T09:43:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY1OTA5Mg==", "url": "https://github.com/artipie/artipie/pull/767#discussion_r527659092", "bodyText": "@genryxy it seems odd that there is no GEM_HOST_API_KEY specified in case of non-anonymous operation", "author": "olegmoz", "createdAt": "2020-11-20T12:28:43Z", "path": "src/test/java/com/artipie/gem/GemITCase.java", "diffHunk": "@@ -121,18 +131,25 @@ void tearDown() {\n     }\n \n     private void push(final boolean anonymous) throws Exception {\n-        final String key = new Base64Encoded(\"any:any\").asString();\n         new TestResource(String.format(\"gem/%s\", GemITCase.RAILS))\n             .saveTo(this.storage, new Key.From(GemITCase.RAILS));\n         final String tmpurl = this.url.string(anonymous);\n-        this.cntn.execStdout(\n-            \"/bin/bash\", \"-c\",\n-            String.format(\n-                \"GEM_HOST_API_KEY=%s gem push %s --host %s\",\n-                key, GemITCase.RAILS,\n-                tmpurl.substring(0, tmpurl.length() - 1)\n-            )\n-        );\n+        if (anonymous) {\n+            final String key = new Base64Encoded(\"any:any\").asString();\n+            this.cntn.execStdout(\n+                \"/bin/bash\", \"-c\",\n+                String.format(\n+                    \"GEM_HOST_API_KEY=%s gem push %s --host %s\",\n+                    key, GemITCase.RAILS,\n+                    tmpurl.substring(0, tmpurl.length() - 1)\n+                )\n+            );\n+        } else {\n+            this.cntn.execStdout(\n+                \"gem\", \"push\", GemITCase.RAILS,\n+                \"--host\", tmpurl.substring(0, tmpurl.length() - 1)\n+            );\n+        }", "originalCommit": "e66fa5578576f20788ccf4790d210b06848411a1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY2Mzk0Mg==", "url": "https://github.com/artipie/artipie/pull/767#discussion_r527663942", "bodyText": "@olegmoz  I think that credentials in this case should be obtained from the url that looks like http://user:pass@host:port/my-gem", "author": "genryxy", "createdAt": "2020-11-20T12:37:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY1OTA5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY2NTgwMQ==", "url": "https://github.com/artipie/artipie/pull/767#discussion_r527665801", "bodyText": "@genryxy could you please prove it by some link to tutorial or docs? Or maybe there is existing test in gem-adapter repository? I am under the impression that GEM_HOST_API_KEY is the only authentication option supported by gem CLI tool", "author": "olegmoz", "createdAt": "2020-11-20T12:41:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY1OTA5Mg=="}], "type": "inlineReview"}, {"oid": "46e493565c424660a944e17b887d40ad6481ac1f", "url": "https://github.com/artipie/artipie/commit/46e493565c424660a944e17b887d40ad6481ac1f", "message": "#606 - Changes by review", "committedDate": "2020-11-20T15:09:56Z", "type": "commit"}, {"oid": "fc2d822c42722f7ff6eb8d13690045f91e80bbef", "url": "https://github.com/artipie/artipie/commit/fc2d822c42722f7ff6eb8d13690045f91e80bbef", "message": "Merge branch 'master' into 606-authGemIT", "committedDate": "2020-11-20T15:23:18Z", "type": "commit"}]}