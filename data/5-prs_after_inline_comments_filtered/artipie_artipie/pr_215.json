{"pr_number": 215, "pr_title": "For #203: changing password storage", "pr_createdAt": "2020-06-17T18:33:51Z", "pr_url": "https://github.com/artipie/artipie/pull/215", "timeline": [{"oid": "595a33b9a1d555be458e6d3d30cc1086c6a7a80b", "url": "https://github.com/artipie/artipie/commit/595a33b9a1d555be458e6d3d30cc1086c6a7a80b", "message": "For #203: changing password storage", "committedDate": "2020-06-17T18:32:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc3NjUyMg==", "url": "https://github.com/artipie/artipie/pull/215#discussion_r441776522", "bodyText": "@paulodamaso I would move null checks to check method to make it more readable or add another method validParams that would check against null. wdyt?", "author": "Vatavuk", "createdAt": "2020-06-17T19:15:41Z", "path": "src/main/java/com/artipie/auth/AuthFromYaml.java", "diffHunk": "@@ -66,7 +59,8 @@ public AuthFromYaml(final YamlMapping cred) {\n         Optional<String> res = Optional.empty();\n         if (users != null && users.yamlMapping(user) != null) {\n             final String stored = users.yamlMapping(user).string(\"pass\");\n-            if (stored != null && check(stored, pass)) {\n+            final String type = users.yamlMapping(user).string(\"type\");\n+            if (stored != null && type != null && check(stored, type, pass)) {", "originalCommit": "595a33b9a1d555be458e6d3d30cc1086c6a7a80b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc3NjgyMA==", "url": "https://github.com/artipie/artipie/pull/215#discussion_r443776820", "bodyText": "@Vatavuk I don't think it's a good idea, here's why:\n\nvalidParams wouldn't mean nothing here, since stored and type are not login parameters, they are data stored into Yaml file instead: if they are null, means that we don't have these field for the current user;\ncheck method just checks if the two values match plainly or digested, so I don't think that we should move these tests inside this method", "author": "paulodamaso", "createdAt": "2020-06-22T19:25:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc3NjUyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzgyNTExMg==", "url": "https://github.com/artipie/artipie/pull/215#discussion_r443825112", "bodyText": "@paulodamaso ok", "author": "Vatavuk", "createdAt": "2020-06-22T21:04:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc3NjUyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc3NzU4Mg==", "url": "https://github.com/artipie/artipie/pull/215#discussion_r441777582", "bodyText": "@paulodamaso I believe variable name pass instead of stored would be more appropriate.", "author": "Vatavuk", "createdAt": "2020-06-17T19:17:44Z", "path": "src/main/java/com/artipie/auth/AuthFromYaml.java", "diffHunk": "@@ -66,7 +59,8 @@ public AuthFromYaml(final YamlMapping cred) {\n         Optional<String> res = Optional.empty();\n         if (users != null && users.yamlMapping(user) != null) {\n             final String stored = users.yamlMapping(user).string(\"pass\");", "originalCommit": "595a33b9a1d555be458e6d3d30cc1086c6a7a80b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc3NDI1NQ==", "url": "https://github.com/artipie/artipie/pull/215#discussion_r443774255", "bodyText": "@Vatavuk I'm already using pass for the password value sent from user. I'm using the name stored because it represents the value which is stored in our Yaml file.", "author": "paulodamaso", "createdAt": "2020-06-22T19:20:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc3NzU4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc3ODkzOA==", "url": "https://github.com/artipie/artipie/pull/215#discussion_r441778938", "bodyText": "@paulodamaso where is login used? I believe its redundant", "author": "Vatavuk", "createdAt": "2020-06-17T19:20:31Z", "path": "src/test/java/com/artipie/auth/AuthFromYamlTest.java", "diffHunk": "@@ -136,32 +140,46 @@ void doesNotAuthoriseByMainLogin() {\n     /**\n      * Composes yaml settings.\n      * @param user User\n+     * @param type Password type\n      * @param pass Password\n      * @return Settings\n      */\n-    private static YamlMapping settings(final String user, final String pass) {\n+    private static YamlMapping settings(\n+        final String user,\n+        final String type,\n+        final String pass) {\n         return Yaml.createYamlMappingBuilder().add(\n             \"credentials\",\n             Yaml.createYamlMappingBuilder()\n-                .add(user, Yaml.createYamlMappingBuilder().add(\"pass\", pass).build())\n-                .build()\n+                .add(\n+                    user,\n+                    Yaml.createYamlMappingBuilder()\n+                    .add(\"type\", type)\n+                    .add(\"pass\", pass).build()\n+                ).build()\n         ).build();\n     }\n \n     /**\n      * Composes yaml settings.\n      * @param user User\n+     * @param type Password type\n      * @param pass Password\n      * @param login Alternative login\n      * @return Settings\n+     * @checkstyle ParameterNumberCheck (3 lines)\n      */\n-    private static YamlMapping settings(final String user, final String pass, final String login) {\n+    private static YamlMapping settings(final String user, final String type, final String pass,\n+        final String login) {\n         return Yaml.createYamlMappingBuilder().add(\n             \"credentials\",\n             Yaml.createYamlMappingBuilder()\n                 .add(\n                     user,\n-                    Yaml.createYamlMappingBuilder().add(\"pass\", pass).add(\"login\", login).build()\n+                    Yaml.createYamlMappingBuilder()\n+                    .add(\"type\", type)\n+                    .add(\"pass\", pass)\n+                    .add(\"login\", login).build()", "originalCommit": "595a33b9a1d555be458e6d3d30cc1086c6a7a80b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc3NzUxOQ==", "url": "https://github.com/artipie/artipie/pull/215#discussion_r443777519", "bodyText": "@Vatavuk login will be used to provide an alternative login (there is a puzzle in AuthFromYaml)", "author": "paulodamaso", "createdAt": "2020-06-22T19:27:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc3ODkzOA=="}], "type": "inlineReview"}, {"oid": "4f1c2f4667a728779c6f40d16c822b0672dbb3fe", "url": "https://github.com/artipie/artipie/commit/4f1c2f4667a728779c6f40d16c822b0672dbb3fe", "message": "For #203: allowing the use of two configuration schemas", "committedDate": "2020-06-30T19:35:42Z", "type": "commit"}, {"oid": "60906065ab5b2f8da618342cf3540cd656d77018", "url": "https://github.com/artipie/artipie/commit/60906065ab5b2f8da618342cf3540cd656d77018", "message": "Merge branch 'master' into 203", "committedDate": "2020-07-03T09:18:37Z", "type": "commit"}]}