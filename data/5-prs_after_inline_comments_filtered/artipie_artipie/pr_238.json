{"pr_number": 238, "pr_title": "#231 - Added metrics interfaces", "pr_createdAt": "2020-06-25T09:00:20Z", "pr_url": "https://github.com/artipie/artipie/pull/238", "timeline": [{"oid": "b91729f0bcce416822bb167406c91d19a11a24ed", "url": "https://github.com/artipie/artipie/commit/b91729f0bcce416822bb167406c91d19a11a24ed", "message": "#231 - Added metrics interfaces", "committedDate": "2020-06-25T09:02:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk4MjkwNg==", "url": "https://github.com/artipie/artipie/pull/238#discussion_r445982906", "bodyText": "@olegmoz there are only void methods, how can we obtain counter value?", "author": "Vatavuk", "createdAt": "2020-06-26T05:59:15Z", "path": "src/main/java/com/artipie/metrics/Counter.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * The MIT License (MIT)\n+ *\n+ * Copyright (c) 2020 artipie.com\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included\n+ * in all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+package com.artipie.metrics;\n+\n+/**\n+ * Monotonically increasing cumulative counter.\n+ *\n+ * @since 0.6\n+ */\n+public interface Counter {", "originalCommit": "b91729f0bcce416822bb167406c91d19a11a24ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjA1OTc5MA==", "url": "https://github.com/artipie/artipie/pull/238#discussion_r446059790", "bodyText": "@Vatavuk this interface is for collection of data. Implementation may handle publishing data in different ways, it might be pushed to some storage or pulled by some service. It might also be aggregated in some way", "author": "olegmoz", "createdAt": "2020-06-26T09:00:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk4MjkwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE4Mjg5NA==", "url": "https://github.com/artipie/artipie/pull/238#discussion_r446182894", "bodyText": "@olegmoz ok I get it now", "author": "Vatavuk", "createdAt": "2020-06-26T13:26:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk4MjkwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk4Mzg4Nw==", "url": "https://github.com/artipie/artipie/pull/238#discussion_r445983887", "bodyText": "@olegmoz we cannot retrieve any metrics from this interface, there are only void methods", "author": "Vatavuk", "createdAt": "2020-06-26T06:02:27Z", "path": "src/main/java/com/artipie/metrics/Metrics.java", "diffHunk": "@@ -0,0 +1,48 @@\n+/*\n+ * The MIT License (MIT)\n+ *\n+ * Copyright (c) 2020 artipie.com\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included\n+ * in all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+package com.artipie.metrics;\n+\n+/**\n+ * Registry of metrics by name.\n+ *\n+ * @since 0.6\n+ */\n+public interface Metrics {", "originalCommit": "b91729f0bcce416822bb167406c91d19a11a24ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjA2MDgwMw==", "url": "https://github.com/artipie/artipie/pull/238#discussion_r446060803", "bodyText": "@Vatavuk see my previous comment, that is intended", "author": "olegmoz", "createdAt": "2020-06-26T09:02:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk4Mzg4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk4NjkzMQ==", "url": "https://github.com/artipie/artipie/pull/238#discussion_r445986931", "bodyText": "@olegmoz it seems to me that using separate interfaces Counter and Gauge will lower cohesion because those two interfaces will operate on the same set of encapsulated data. I propose two alternatives:\nOnly one interface:\ninterface Metrics {\n     void inc();\n     void add(int num);\n     void set(long val);\n     long value(); \n}\nor split metrics to two different interfaces CounterMetrics GaugeMetrics. wdyt?", "author": "Vatavuk", "createdAt": "2020-06-26T06:13:00Z", "path": "src/main/java/com/artipie/metrics/Metrics.java", "diffHunk": "@@ -0,0 +1,48 @@\n+/*\n+ * The MIT License (MIT)\n+ *\n+ * Copyright (c) 2020 artipie.com\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included\n+ * in all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+package com.artipie.metrics;\n+\n+/**\n+ * Registry of metrics by name.\n+ *\n+ * @since 0.6\n+ */\n+public interface Metrics {", "originalCommit": "b91729f0bcce416822bb167406c91d19a11a24ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjA2Mzc0Ng==", "url": "https://github.com/artipie/artipie/pull/238#discussion_r446063746", "bodyText": "@Vatavuk separating counters and gauges are very common in monitoring systems, see DataDog, Prometheus etc. The nature of data is very different: one is for collecting incrementing changes from multiple sources, another is mostly for getting states from single source (think requests count vs current number of requests being handled). Implementation will probably differ even for in memory implementation (gauge could be implemented with just a volitile value, when counter will require AtomicLong or synchronized sections). Splitting Metrics interfaces does not sound to me as a great idea eaither, because we will need to pass all of them to adapters. It's easier to do with single object for all metrics.", "author": "olegmoz", "createdAt": "2020-06-26T09:08:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk4NjkzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE4MzAzOQ==", "url": "https://github.com/artipie/artipie/pull/238#discussion_r446183039", "bodyText": "@olegmoz ok, thx for the clarification", "author": "Vatavuk", "createdAt": "2020-06-26T13:27:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk4NjkzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk4NzA5Ng==", "url": "https://github.com/artipie/artipie/pull/238#discussion_r445987096", "bodyText": "@olegmoz  how can we obtain the value?", "author": "Vatavuk", "createdAt": "2020-06-26T06:13:29Z", "path": "src/main/java/com/artipie/metrics/Gauge.java", "diffHunk": "@@ -0,0 +1,39 @@\n+/*\n+ * The MIT License (MIT)\n+ *\n+ * Copyright (c) 2020 artipie.com\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included\n+ * in all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+package com.artipie.metrics;\n+\n+/**\n+ * Single numerical value that can increase and decrease.\n+ *\n+ * @since 0.6\n+ */\n+public interface Gauge {", "originalCommit": "b91729f0bcce416822bb167406c91d19a11a24ed", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ef359fa6cbc078ff00b723f95466e032ec61d799", "url": "https://github.com/artipie/artipie/commit/ef359fa6cbc078ff00b723f95466e032ec61d799", "message": "Merge branch 'master' into 231-metrics-interfaces", "committedDate": "2020-06-26T12:57:59Z", "type": "commit"}, {"oid": "66672ae70f99cf46a81ad74f21bed23e00058547", "url": "https://github.com/artipie/artipie/commit/66672ae70f99cf46a81ad74f21bed23e00058547", "message": "Merge branch 'master' into 231-metrics-interfaces", "committedDate": "2020-06-26T13:58:13Z", "type": "commit"}]}