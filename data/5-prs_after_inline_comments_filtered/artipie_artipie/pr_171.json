{"pr_number": 171, "pr_title": "Read auth yaml settings", "pr_createdAt": "2020-05-22T15:26:04Z", "pr_url": "https://github.com/artipie/artipie/pull/171", "timeline": [{"oid": "316ec32fe3656956813dc69577d52b9a834e52be", "url": "https://github.com/artipie/artipie/commit/316ec32fe3656956813dc69577d52b9a834e52be", "message": "Obtain auth for #146", "committedDate": "2020-05-22T15:24:51Z", "type": "commit"}, {"oid": "75ae46ce0f8b8609b08aa6f7989852f9b9709af4", "url": "https://github.com/artipie/artipie/commit/75ae46ce0f8b8609b08aa6f7989852f9b9709af4", "message": "Merge branch 'master' of https://github.com/artipie/artipie into 146-obtain-auth\n\n\u0001 Conflicts:\n\u0001\tsrc/main/java/com/artipie/Pie.java\n\u0001\tsrc/main/java/com/artipie/SliceFromConfig.java\n\u0001\tsrc/main/java/com/artipie/YamlSettings.java\n\u0001\tsrc/test/java/com/artipie/YamlSettingsTest.java", "committedDate": "2020-05-25T12:58:09Z", "type": "commit"}, {"oid": "9420d9eeaf3e812b8953b13f1a1eeac040b022b4", "url": "https://github.com/artipie/artipie/commit/9420d9eeaf3e812b8953b13f1a1eeac040b022b4", "message": "master merge to #146", "committedDate": "2020-05-25T13:04:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk0ODcxOA==", "url": "https://github.com/artipie/artipie/pull/171#discussion_r429948718", "bodyText": "@olenagerasimova I think if user creates configuration with file type credentials but doesn't specify path, we should not fall back to env credentials but throw an exception (return CompletableFuture.failedFuture()), because it's not a valid scenario, rather administrator mistake.", "author": "g4s8", "createdAt": "2020-05-25T13:57:04Z", "path": "src/main/java/com/artipie/YamlSettings.java", "diffHunk": "@@ -55,26 +71,61 @@ public Storage storage() throws IOException {\n         return new YamlStorageSettings(\n             Yaml.createYamlInput(this.content)\n                 .readYamlMapping()\n-                .yamlMapping(\"meta\")\n+                .yamlMapping(YamlSettings.META)\n                 .yamlMapping(\"storage\")\n         ).storage();\n     }\n \n     @Override\n     public CompletionStage<Authentication> auth() throws IOException {\n-        //@checkstyle MethodBodyCommentsCheck (12 lines)\n-        // @todo #146:30min Implement this method to obtain authentications: for now\n-        //  we have AuthFromEnv, which is available when `credentials.type` equals `env`, and\n-        //  AuthFromYaml, which is available when `credentials.type` equals\n-        //  `file` and `credentials.path` specified. New `credentials` section in main artipie\n-        //  config:\n-        //  credentials:\n-        //    # let's support `env` and `file` types for now\n-        //    type: file\n-        //    # file location, storage key, relative to `meta.storage.path`\n-        //    path: _credentials.yml\n-        //  For details check comments in #146.\n-        //  After implementing pass found authentications to slices.\n-        throw new NotImplementedException(\"Not yet implemented\");\n+        final YamlMapping cred = Yaml.createYamlInput(this.content)\n+            .readYamlMapping()\n+            .yamlMapping(YamlSettings.META)\n+            .yamlMapping(\"credentials\");\n+        final CompletionStage<Authentication> res;\n+        final String path = \"path\";\n+        if (cred != null && \"file\".equals(cred.string(\"type\")) && cred.string(path) != null) {", "originalCommit": "9420d9eeaf3e812b8953b13f1a1eeac040b022b4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "de35739af406e48243ed3c0e48370f31fde0e2f8", "url": "https://github.com/artipie/artipie/commit/de35739af406e48243ed3c0e48370f31fde0e2f8", "message": "obtain auth to #146 CR", "committedDate": "2020-05-25T18:15:36Z", "type": "commit"}]}