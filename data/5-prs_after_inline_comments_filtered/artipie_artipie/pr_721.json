{"pr_number": 721, "pr_title": "#605 - Verify with authentication in npmIT", "pr_createdAt": "2020-10-26T09:31:46Z", "pr_url": "https://github.com/artipie/artipie/pull/721", "timeline": [{"oid": "63ee4cf7e8726d31f979eaabc24fbb65fc524f7a", "url": "https://github.com/artipie/artipie/commit/63ee4cf7e8726d31f979eaabc24fbb65fc524f7a", "message": "#605 - Verify install and publish with auth", "committedDate": "2020-10-26T09:28:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg5OTgyNg==", "url": "https://github.com/artipie/artipie/pull/721#discussion_r511899826", "bodyText": "@genryxy it looks like here you check too many details about output. I think it will be enough to see that there is error message with 403 Forbidden text. Building whole URL looks excessive.", "author": "olegmoz", "createdAt": "2020-10-26T11:45:10Z", "path": "src/test/java/com/artipie/npm/NpmITCase.java", "diffHunk": "@@ -153,6 +166,46 @@ void npmPublish() throws Exception {\n         );\n     }\n \n+    @Test\n+    void npmInstallFailWithForbidden() throws Exception {\n+        final ArtipieServer.User user = ArtipieServer.BOB;\n+        this.init(false);\n+        this.saveFilesToStrg(NpmITCase.PROJ);\n+        MatcherAssert.assertThat(\n+            this.exec(\n+                \"npm\", \"install\", NpmITCase.PROJ,\n+                \"--registry\", this.url(Optional.of(user))\n+            ).getStderr().replaceAll(\"\\n\", \"\"),\n+            new StringContains(\n+                String.format(\n+                    \"npm ERR! 403 403 Forbidden - GET http://%s:***@%s:%d/my-npm/%s\",\n+                    user.name(), NpmITCase.HOST, this.port, NpmITCase.PROJ.replace(\"/\", \"%2f\")\n+                )", "originalCommit": "63ee4cf7e8726d31f979eaabc24fbb65fc524f7a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTkwMDE5Mg==", "url": "https://github.com/artipie/artipie/pull/721#discussion_r511900192", "bodyText": "@genryxy same concern about checking URL", "author": "olegmoz", "createdAt": "2020-10-26T11:45:54Z", "path": "src/test/java/com/artipie/npm/NpmITCase.java", "diffHunk": "@@ -153,6 +166,46 @@ void npmPublish() throws Exception {\n         );\n     }\n \n+    @Test\n+    void npmInstallFailWithForbidden() throws Exception {\n+        final ArtipieServer.User user = ArtipieServer.BOB;\n+        this.init(false);\n+        this.saveFilesToStrg(NpmITCase.PROJ);\n+        MatcherAssert.assertThat(\n+            this.exec(\n+                \"npm\", \"install\", NpmITCase.PROJ,\n+                \"--registry\", this.url(Optional.of(user))\n+            ).getStderr().replaceAll(\"\\n\", \"\"),\n+            new StringContains(\n+                String.format(\n+                    \"npm ERR! 403 403 Forbidden - GET http://%s:***@%s:%d/my-npm/%s\",\n+                    user.name(), NpmITCase.HOST, this.port, NpmITCase.PROJ.replace(\"/\", \"%2f\")\n+                )\n+            )\n+        );\n+    }\n+\n+    @Test\n+    void npmPublishFailWithForbidden() throws Exception {\n+        final ArtipieServer.User user = ArtipieServer.BOB;\n+        this.init(false);\n+        new TestResource(\"npm/simple-npm-project\")\n+            .addFilesTo(this.storage, new Key.From(NpmITCase.PROJ));\n+        MatcherAssert.assertThat(\n+            \"Package was published\",\n+            this.exec(\n+                \"npm\", \"publish\", NpmITCase.PROJ,\n+                \"--registry\", this.url(Optional.of(user))\n+            ).getStderr().replaceAll(\"\\n\", \"\"),\n+            new StringContains(\n+                String.format(\n+                    \"npm ERR! 403 403 Forbidden - PUT http://%s:***@%s:%d/my-npm/%s\",\n+                    user.name(), NpmITCase.HOST, this.port, NpmITCase.PROJ.replace(\"/\", \"%2f\")\n+                )\n+            )", "originalCommit": "63ee4cf7e8726d31f979eaabc24fbb65fc524f7a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "09c64c3f19e8de61d0ef5d3c5ad55e66a639e262", "url": "https://github.com/artipie/artipie/commit/09c64c3f19e8de61d0ef5d3c5ad55e66a639e262", "message": "#605 - CR", "committedDate": "2020-10-26T12:10:28Z", "type": "commit"}, {"oid": "d855fe64e552db83aa108ce44d2c27af2cd193b1", "url": "https://github.com/artipie/artipie/commit/d855fe64e552db83aa108ce44d2c27af2cd193b1", "message": "Merge branch 'master' into 605-npmITWithAuth", "committedDate": "2020-10-26T12:42:50Z", "type": "commit"}]}