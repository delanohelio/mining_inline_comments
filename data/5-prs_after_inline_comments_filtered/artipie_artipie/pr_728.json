{"pr_number": 728, "pr_title": "#722 - Add UrlHelper for url with user credentials", "pr_createdAt": "2020-10-29T09:21:44Z", "pr_url": "https://github.com/artipie/artipie/pull/728", "timeline": [{"oid": "820ce9a101771433d062c3dff87ac0475381cab6", "url": "https://github.com/artipie/artipie/commit/820ce9a101771433d062c3dff87ac0475381cab6", "message": "#722 - Add url helper for user credentials", "committedDate": "2020-10-29T09:19:26Z", "type": "commit"}, {"oid": "080d9689f210d7023d7a271eb43792959029177c", "url": "https://github.com/artipie/artipie/commit/080d9689f210d7023d7a271eb43792959029177c", "message": "#722 - Use urlHelper in pypiProxy", "committedDate": "2020-10-29T12:01:50Z", "type": "commit"}, {"oid": "cf7561e7f03df2f830da9289f8c923534e0887f8", "url": "https://github.com/artipie/artipie/commit/cf7561e7f03df2f830da9289f8c923534e0887f8", "message": "#722 - Suppress classDataAbstraction warning", "committedDate": "2020-10-29T12:08:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDIwOTEyNQ==", "url": "https://github.com/artipie/artipie/pull/728#discussion_r514209125", "bodyText": "@genryxy that's bad class name, please think of something better. Maybe it is \"repository url\"? Or maybe this is not an entity and it will make more sense to add url() method to ArtipieServer or TestContainer", "author": "olegmoz", "createdAt": "2020-10-29T12:09:13Z", "path": "src/test/java/com/artipie/test/UrlCredsHelper.java", "diffHunk": "@@ -0,0 +1,85 @@\n+/*\n+ * The MIT License (MIT)\n+ *\n+ * Copyright (c) 2020 artipie.com\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included\n+ * in all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+package com.artipie.test;\n+\n+import com.artipie.ArtipieServer;\n+\n+/**\n+ * Class to simplify working with url that may contains user credentials.\n+ * @since 0.12\n+ */\n+public final class UrlCredsHelper {", "originalCommit": "080d9689f210d7023d7a271eb43792959029177c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDIyNjcyNw==", "url": "https://github.com/artipie/artipie/pull/728#discussion_r514226727", "bodyText": "@olegmoz thanks. I'm not sure that adding url() to ArtipieServer or TestContainer will be better because in npm it uses for creating config file before creating server and testcontainer. There is only one such case but there is one. UrlCntnCreds is more suitable?", "author": "genryxy", "createdAt": "2020-10-29T12:40:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDIwOTEyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDIzODg2OQ==", "url": "https://github.com/artipie/artipie/pull/728#discussion_r514238869", "bodyText": "@genryxy I think RepositoryUrl would be most suitable name. I would also rename url() method to string() in this case", "author": "olegmoz", "createdAt": "2020-10-29T13:00:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDIwOTEyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDIxMDU1Mw==", "url": "https://github.com/artipie/artipie/pull/728#discussion_r514210553", "bodyText": "@genryxy I'd suggest joining these two String.format calls into one", "author": "olegmoz", "createdAt": "2020-10-29T12:11:50Z", "path": "src/test/java/com/artipie/test/UrlCredsHelper.java", "diffHunk": "@@ -0,0 +1,85 @@\n+/*\n+ * The MIT License (MIT)\n+ *\n+ * Copyright (c) 2020 artipie.com\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included\n+ * in all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+package com.artipie.test;\n+\n+import com.artipie.ArtipieServer;\n+\n+/**\n+ * Class to simplify working with url that may contains user credentials.\n+ * @since 0.12\n+ */\n+public final class UrlCredsHelper {\n+\n+    /**\n+     * Host, port, repo.\n+     */\n+    private final String hostportrepo;\n+\n+    /**\n+     * Ctor.\n+     * @param port Port\n+     * @param reponame Reponame for url path\n+     */\n+    public UrlCredsHelper(final int port, final String reponame) {\n+        this.hostportrepo = String.format(\"host.testcontainers.internal:%d/%s/\", port, reponame);\n+    }\n+\n+    /**\n+     * Simple url.\n+     * @return Simple url.\n+     */\n+    public String url() {\n+        return String.format(\"http://%s\", this.hostportrepo);\n+    }\n+\n+    /**\n+     * Url with or without user credentials.\n+     * @param anonymous Add credentials tor url or not\n+     * @return Url with credentials for default user.\n+     */\n+    public String url(final boolean anonymous) {\n+        final ArtipieServer.User user = ArtipieServer.ALICE;\n+        final String res;\n+        if (anonymous) {\n+            res = this.url();\n+        } else {\n+            res = this.url(user);\n+        }\n+        return res;\n+    }\n+\n+    /**\n+     * Url with credentials.\n+     * @param user User with name and password\n+     * @return Url with credentials for specified user.\n+     */\n+    public String url(final ArtipieServer.User user) {\n+        final String creds = String.format(\n+            \"%s:%s@\", user.name(), user.password()\n+        );\n+        return String.format(\n+            \"http://%s%s\", creds, this.hostportrepo\n+        );", "originalCommit": "cf7561e7f03df2f830da9289f8c923534e0887f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3c9457936d1266236d2c5af5548a341107c4b114", "url": "https://github.com/artipie/artipie/commit/3c9457936d1266236d2c5af5548a341107c4b114", "message": "#722 - CR", "committedDate": "2020-10-29T13:44:36Z", "type": "commit"}, {"oid": "e3052135aeb947a4919228bcd631d6807d850546", "url": "https://github.com/artipie/artipie/commit/e3052135aeb947a4919228bcd631d6807d850546", "message": "#722 - Change since version", "committedDate": "2020-10-29T13:47:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDMyOTI3OA==", "url": "https://github.com/artipie/artipie/pull/728#discussion_r514329278", "bodyText": "@genryxy please update comment for url fields in tests and we will be good to merge", "author": "olegmoz", "createdAt": "2020-10-29T15:02:20Z", "path": "src/test/java/com/artipie/npm/NpmITCase.java", "diffHunk": "@@ -89,7 +89,7 @@\n     /**\n      * Helper for url that may contains user credentials.\n      */\n-    private UrlCredsHelper urlraw;\n+    private RepositoryUrl url;", "originalCommit": "e3052135aeb947a4919228bcd631d6807d850546", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "282716e75c61a27929c43edfd56c873168ee3318", "url": "https://github.com/artipie/artipie/commit/282716e75c61a27929c43edfd56c873168ee3318", "message": "#722 - Change comment", "committedDate": "2020-10-29T15:13:18Z", "type": "commit"}]}