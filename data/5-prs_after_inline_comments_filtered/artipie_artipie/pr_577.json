{"pr_number": 577, "pr_title": "#499: \"flat\" set as default layout", "pr_createdAt": "2020-09-11T10:40:00Z", "pr_url": "https://github.com/artipie/artipie/pull/577", "timeline": [{"oid": "cd3d9189ff2186b18b7dbc2b50829c011b8f8857", "url": "https://github.com/artipie/artipie/commit/cd3d9189ff2186b18b7dbc2b50829c011b8f8857", "message": "Issue #499: \"flat\" set as default layout\n\n(cherry picked from commit b0e3eaf5300aaf8605d20b5277cf6bea5aed829e)", "committedDate": "2020-09-11T10:39:10Z", "type": "commit"}, {"oid": "ef6408f49c1bb9d30d98386dc365cdbd55ed877c", "url": "https://github.com/artipie/artipie/commit/ef6408f49c1bb9d30d98386dc365cdbd55ed877c", "message": "Fix: Qulice", "committedDate": "2020-09-14T08:37:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc1NDA2NA==", "url": "https://github.com/artipie/artipie/pull/577#discussion_r487754064", "bodyText": "@IlyaMoskva do we really need to provide all that content to YamlSettings? I'd suggest to remove not required lines from the test to make it more focused and clear", "author": "olegmoz", "createdAt": "2020-09-14T08:53:08Z", "path": "src/test/java/com/artipie/YamlSettingsTest.java", "diffHunk": "@@ -46,12 +46,27 @@\n  *\n  * @since 0.1\n  * @checkstyle MethodNameCheck (500 lines)\n- * @todo #187:30min Add a test for layout structure, it can be either `flat` or `org`. If it's\n- *  omitted, it should treated as a `flat` layout. See RepoLayout javadocs for more details.\n  */\n-@SuppressWarnings(\"PMD.AvoidDuplicateLiterals\")\n+@SuppressWarnings({\"PMD.AvoidDuplicateLiterals\", \"PMD.TooManyMethods\"})\n class YamlSettingsTest {\n \n+    @Test\n+    public void shouldSetFlatAsDefaultLayout() throws Exception {\n+        final YamlSettings settings = new YamlSettings(\n+            String.join(\n+                \"\",\n+                \"meta:\\n\",\n+                \"  storage:\\n\",\n+                \"    type: s3\\n\",\n+                \"    path: /var/artipie/configs\\n\"", "originalCommit": "ef6408f49c1bb9d30d98386dc365cdbd55ed877c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA0MDE1OA==", "url": "https://github.com/artipie/artipie/pull/577#discussion_r488040158", "bodyText": "Not all, you're right. Fixed.", "author": "IlyaMoskva", "createdAt": "2020-09-14T15:50:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc1NDA2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc1NTEzOQ==", "url": "https://github.com/artipie/artipie/pull/577#discussion_r487755139", "bodyText": "@IlyaMoskva using new IsEqual<>() here will be more in line with code style of the project, see https://github.com/artipie/artipie/blob/master/CONTRIBUTING.md#code-style", "author": "olegmoz", "createdAt": "2020-09-14T08:54:52Z", "path": "src/test/java/com/artipie/YamlSettingsTest.java", "diffHunk": "@@ -46,12 +46,27 @@\n  *\n  * @since 0.1\n  * @checkstyle MethodNameCheck (500 lines)\n- * @todo #187:30min Add a test for layout structure, it can be either `flat` or `org`. If it's\n- *  omitted, it should treated as a `flat` layout. See RepoLayout javadocs for more details.\n  */\n-@SuppressWarnings(\"PMD.AvoidDuplicateLiterals\")\n+@SuppressWarnings({\"PMD.AvoidDuplicateLiterals\", \"PMD.TooManyMethods\"})\n class YamlSettingsTest {\n \n+    @Test\n+    public void shouldSetFlatAsDefaultLayout() throws Exception {\n+        final YamlSettings settings = new YamlSettings(\n+            String.join(\n+                \"\",\n+                \"meta:\\n\",\n+                \"  storage:\\n\",\n+                \"    type: s3\\n\",\n+                \"    path: /var/artipie/configs\\n\"\n+            )\n+        );\n+        MatcherAssert.assertThat(\n+            settings.layout(),\n+            Matchers.is(\"flat\")", "originalCommit": "ef6408f49c1bb9d30d98386dc365cdbd55ed877c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODAzOTc5OQ==", "url": "https://github.com/artipie/artipie/pull/577#discussion_r488039799", "bodyText": "Changed.", "author": "IlyaMoskva", "createdAt": "2020-09-14T15:49:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc1NTEzOQ=="}], "type": "inlineReview"}, {"oid": "394b55b58f123a37728d91509d1efd8a8812b76c", "url": "https://github.com/artipie/artipie/commit/394b55b58f123a37728d91509d1efd8a8812b76c", "message": "Issue #499: Fix code style", "committedDate": "2020-09-14T15:50:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQzMDUxMg==", "url": "https://github.com/artipie/artipie/pull/577#discussion_r488430512", "bodyText": "@IlyaMoskva and is storage: part really needed? We do not access storage in this test and I believe the string could be simplified to just `\"meta:\\n\"", "author": "olegmoz", "createdAt": "2020-09-15T06:58:40Z", "path": "src/test/java/com/artipie/YamlSettingsTest.java", "diffHunk": "@@ -56,14 +57,12 @@ public void shouldSetFlatAsDefaultLayout() throws Exception {\n             String.join(\n                 \"\",\n                 \"meta:\\n\",\n-                \"  storage:\\n\",\n-                \"    type: s3\\n\",\n-                \"    path: /var/artipie/configs\\n\"\n+                \"  storage:\\n\"", "originalCommit": "394b55b58f123a37728d91509d1efd8a8812b76c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODUyMTk5Nw==", "url": "https://github.com/artipie/artipie/pull/577#discussion_r488521997", "bodyText": "@olegmoz It breaks in constructor or in other place before. Just 'meta:' doesn't work for me.", "author": "IlyaMoskva", "createdAt": "2020-09-15T09:29:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQzMDUxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODU1OTczMw==", "url": "https://github.com/artipie/artipie/pull/577#discussion_r488559733", "bodyText": "@IlyaMoskva that's weird, there is just assignment in constructor. Could you please elaborate the problem?", "author": "olegmoz", "createdAt": "2020-09-15T10:30:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQzMDUxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQwNjgyNg==", "url": "https://github.com/artipie/artipie/pull/577#discussion_r489406826", "bodyText": "@olegmoz Exactly 'storage' is not necessary here it can be any string, but empty meta throws java.util.NoSuchElementException in .yamlMapping(YamlSettings.KEY_META) call. It must contain at least something inside. I believe, it's out of scope for this ticket.", "author": "IlyaMoskva", "createdAt": "2020-09-16T12:44:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQzMDUxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQxNDQwNw==", "url": "https://github.com/artipie/artipie/pull/577#discussion_r489414407", "bodyText": "@IlyaMoskva got it, thanks", "author": "olegmoz", "createdAt": "2020-09-16T12:56:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQzMDUxMg=="}], "type": "inlineReview"}, {"oid": "86ddda61e377abf75e4a814272573de501a66dac", "url": "https://github.com/artipie/artipie/commit/86ddda61e377abf75e4a814272573de501a66dac", "message": "Merge branch 'master' into layout", "committedDate": "2020-09-16T12:56:36Z", "type": "commit"}]}