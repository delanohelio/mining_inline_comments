{"pr_number": 653, "pr_title": "#602 - push package NugetITCase", "pr_createdAt": "2020-10-02T08:42:35Z", "pr_url": "https://github.com/artipie/artipie/pull/653", "timeline": [{"oid": "06dfe98d76d0a8ef04b1706add85cc1b96ca2e21", "url": "https://github.com/artipie/artipie/commit/06dfe98d76d0a8ef04b1706add85cc1b96ca2e21", "message": "#602 - Attempt to make IT for centos8", "committedDate": "2020-09-22T08:40:57Z", "type": "commit"}, {"oid": "2abe9b5cbee6f79954d994c24f319dfac63e6a75", "url": "https://github.com/artipie/artipie/commit/2abe9b5cbee6f79954d994c24f319dfac63e6a75", "message": "#602 - Deleted unnecessary comments", "committedDate": "2020-09-25T08:27:38Z", "type": "commit"}, {"oid": "3f5318b04455218aed9038b2952eabe53e3f7152", "url": "https://github.com/artipie/artipie/commit/3f5318b04455218aed9038b2952eabe53e3f7152", "message": "Merge remote-tracking branch 'upstream/master' into 602-nugetITCase", "committedDate": "2020-10-01T08:27:13Z", "type": "commit"}, {"oid": "2262d38cf5c65b5c901c11393000614228e4f474", "url": "https://github.com/artipie/artipie/commit/2262d38cf5c65b5c901c11393000614228e4f474", "message": "#602 - Push package", "committedDate": "2020-10-02T08:38:12Z", "type": "commit"}, {"oid": "788a0a1074f100bdd1101f5ff814b60d153df134", "url": "https://github.com/artipie/artipie/commit/788a0a1074f100bdd1101f5ff814b60d153df134", "message": "Merge remote-tracking branch 'upstream/master' into 602-nugetITCase", "committedDate": "2020-10-02T08:38:54Z", "type": "commit"}, {"oid": "e0416b23ce8b9bce3862e096bf6924fe68dd7c94", "url": "https://github.com/artipie/artipie/commit/e0416b23ce8b9bce3862e096bf6924fe68dd7c94", "message": "#602 - Exclude directory in .pdd", "committedDate": "2020-10-02T08:49:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY5NDI5Nw==", "url": "https://github.com/artipie/artipie/pull/653#discussion_r498694297", "bodyText": "@genryxy this method does not return anything, but does an action: creates NuGet config file. It should be renamed to indicate that", "author": "olegmoz", "createdAt": "2020-10-02T08:48:06Z", "path": "src/test/java/com/artipie/nuget/NugetITCase.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/*\n+ * The MIT License (MIT)\n+ *\n+ * Copyright (c) 2020 artipie.com\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included\n+ * in all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+package com.artipie.nuget;\n+\n+import com.amihaiemil.eoyaml.Yaml;\n+import com.artipie.ArtipieServer;\n+import com.jcabi.log.Logger;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.UUID;\n+import org.hamcrest.MatcherAssert;\n+import org.hamcrest.core.StringContains;\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.io.TempDir;\n+import org.testcontainers.Testcontainers;\n+import org.testcontainers.containers.GenericContainer;\n+\n+/**\n+ * Integration tests for Nuget repository.\n+ * @since 0.11\n+ */\n+@SuppressWarnings(\"PMD.AvoidDuplicateLiterals\")\n+final class NugetITCase {\n+\n+    /**\n+     * Temporary directory for all tests.\n+     * @checkstyle VisibilityModifierCheck (3 lines)\n+     */\n+    @TempDir\n+    Path tmp;\n+\n+    /**\n+     * Tested Artipie server.\n+     */\n+    private ArtipieServer server;\n+\n+    /**\n+     * Container.\n+     */\n+    private GenericContainer<?> cntn;\n+\n+    /**\n+     * Artipie server port.\n+     */\n+    private int port;\n+\n+    @BeforeEach\n+    void init() throws Exception {\n+        final String name = \"my-nuget\";\n+        this.server = new ArtipieServer(this.tmp, name, this.config());\n+        this.port = this.server.start();\n+        Testcontainers.exposeHostPorts(this.port);\n+        Files.write(\n+            this.tmp.resolve(String.format(\"repos/%s.yaml\", name)),\n+            this.config().getBytes()\n+        );\n+        this.nugetConfig();\n+        this.cntn = new GenericContainer<>(\"mcr.microsoft.com/dotnet/sdk:5.0\")\n+            .withCommand(\"tail\", \"-f\", \"/dev/null\")\n+            .withWorkingDirectory(\"/home/\")\n+            .withFileSystemBind(this.tmp.toString(), \"/home\");\n+        this.cntn.start();\n+    }\n+\n+    @AfterEach\n+    void tearDown() {\n+        this.server.stop();\n+        this.cntn.stop();\n+    }\n+\n+    @Test\n+    void shouldPushPackage() throws Exception {\n+        MatcherAssert.assertThat(\n+            this.pushPackage(),\n+            new StringContains(\"Your package was pushed.\")\n+        );\n+    }\n+\n+    private void nugetConfig() throws Exception {", "originalCommit": "788a0a1074f100bdd1101f5ff814b60d153df134", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY5NDkxMw==", "url": "https://github.com/artipie/artipie/pull/653#discussion_r498694913", "bodyText": "@genryxy @since tag value is off, it should be 0.12 now", "author": "olegmoz", "createdAt": "2020-10-02T08:49:18Z", "path": "src/test/java/com/artipie/nuget/NewtonJsonResource.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * The MIT License (MIT)\n+ *\n+ * Copyright (c) 2020 artipie.com\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included\n+ * in all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+package com.artipie.nuget;\n+\n+import com.google.common.io.ByteStreams;\n+import org.cactoos.io.ResourceOf;\n+\n+/**\n+ * Newton.Json package resource.\n+ *\n+ * @since 0.1", "originalCommit": "788a0a1074f100bdd1101f5ff814b60d153df134", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY5NTMxOA==", "url": "https://github.com/artipie/artipie/pull/653#discussion_r498695318", "bodyText": "@genryxy  @since tag value is off, it should be 0.12 now", "author": "olegmoz", "createdAt": "2020-10-02T08:50:05Z", "path": "src/test/java/com/artipie/nuget/NugetITCase.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/*\n+ * The MIT License (MIT)\n+ *\n+ * Copyright (c) 2020 artipie.com\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included\n+ * in all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+package com.artipie.nuget;\n+\n+import com.amihaiemil.eoyaml.Yaml;\n+import com.artipie.ArtipieServer;\n+import com.jcabi.log.Logger;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.UUID;\n+import org.hamcrest.MatcherAssert;\n+import org.hamcrest.core.StringContains;\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.io.TempDir;\n+import org.testcontainers.Testcontainers;\n+import org.testcontainers.containers.GenericContainer;\n+\n+/**\n+ * Integration tests for Nuget repository.\n+ * @since 0.11", "originalCommit": "788a0a1074f100bdd1101f5ff814b60d153df134", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c08b1a216f46a7f881eaedee65a7d1719be7c453", "url": "https://github.com/artipie/artipie/commit/c08b1a216f46a7f881eaedee65a7d1719be7c453", "message": "#602 - Exclude directory", "committedDate": "2020-10-02T08:52:58Z", "type": "commit"}, {"oid": "eaa1d2ab5e388f51485d76e054373366bcb5ac75", "url": "https://github.com/artipie/artipie/commit/eaa1d2ab5e388f51485d76e054373366bcb5ac75", "message": "#602 - Change version, rename method", "committedDate": "2020-10-02T08:57:26Z", "type": "commit"}, {"oid": "c9965cbc103706b8f7bc574b088253fa7933f749", "url": "https://github.com/artipie/artipie/commit/c9965cbc103706b8f7bc574b088253fa7933f749", "message": "#602 - Enable on Linux and Mac", "committedDate": "2020-10-02T09:10:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcxNzI1MQ==", "url": "https://github.com/artipie/artipie/pull/653#discussion_r498717251", "bodyText": "@genryxy probably you need to enable the test on windows only, not enable it unix-like systems", "author": "olegmoz", "createdAt": "2020-10-02T09:34:33Z", "path": "src/test/java/com/artipie/nuget/NugetITCase.java", "diffHunk": "@@ -43,6 +45,7 @@\n  * @since 0.12\n  */\n @SuppressWarnings(\"PMD.AvoidDuplicateLiterals\")\n+@EnabledOnOs({OS.LINUX, OS.MAC})", "originalCommit": "c9965cbc103706b8f7bc574b088253fa7933f749", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcxOTkyMw==", "url": "https://github.com/artipie/artipie/pull/653#discussion_r498719923", "bodyText": "@olegmoz in the previous commit it fails on windows https://github.com/artipie/artipie/runs/1197922355#step:5:7796", "author": "genryxy", "createdAt": "2020-10-02T09:40:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcxNzI1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODczMjA0Mg==", "url": "https://github.com/artipie/artipie/pull/653#discussion_r498732042", "bodyText": "@genryxy that's because testcontainers library does not support Windows. That is sad. It means you need to use a Linux image instead of Windows one", "author": "olegmoz", "createdAt": "2020-10-02T10:06:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcxNzI1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODczMjMxOQ==", "url": "https://github.com/artipie/artipie/pull/653#discussion_r498732319", "bodyText": "@genryxy you may find such images here: https://hub.docker.com/_/microsoft-dotnet-core", "author": "olegmoz", "createdAt": "2020-10-02T10:07:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcxNzI1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODczMzk0NA==", "url": "https://github.com/artipie/artipie/pull/653#discussion_r498733944", "bodyText": "@olegmoz in this test mcr.microsoft.com/dotnet/sdk:5.0 image is used", "author": "genryxy", "createdAt": "2020-10-02T10:11:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcxNzI1MQ=="}], "type": "inlineReview"}]}