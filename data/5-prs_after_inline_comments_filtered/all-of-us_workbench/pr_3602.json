{"pr_number": 3602, "pr_title": "[RW-4981][risk=no] make all crons return 204 on success", "pr_createdAt": "2020-05-19T20:47:38Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3602", "timeline": [{"oid": "b898f9c63346c1f3f5ad80a36832305ec01db19e", "url": "https://github.com/all-of-us/workbench/commit/b898f9c63346c1f3f5ad80a36832305ec01db19e", "message": "make all crons return 204 on success", "committedDate": "2020-05-19T20:46:09Z", "type": "commit"}, {"oid": "bfe06b9a75cad395ff8cc4b66aef75e250fae8d3", "url": "https://github.com/all-of-us/workbench/commit/bfe06b9a75cad395ff8cc4b66aef75e250fae8d3", "message": "remove unneeded class", "committedDate": "2020-05-19T20:48:54Z", "type": "commit"}, {"oid": "240f61b939aaaa05a89e0814adc968a911e5ee33", "url": "https://github.com/all-of-us/workbench/commit/240f61b939aaaa05a89e0814adc968a911e5ee33", "message": "correct retrn type", "committedDate": "2020-05-19T20:54:54Z", "type": "commit"}, {"oid": "c2c6a4410935004052cf100b2601a0a759a9f7ed", "url": "https://github.com/all-of-us/workbench/commit/c2c6a4410935004052cf100b2601a0a759a9f7ed", "message": "Merge branch 'master' into jaycarlton/RW-4981", "committedDate": "2020-05-26T20:47:36Z", "type": "commit"}, {"oid": "358257939e263beb535355b86e83abab016a092e", "url": "https://github.com/all-of-us/workbench/commit/358257939e263beb535355b86e83abab016a092e", "message": "spell Void right & remove dead ref", "committedDate": "2020-05-26T20:50:35Z", "type": "commit"}, {"oid": "fee40744dad181332ed029182958d52e32075042", "url": "https://github.com/all-of-us/workbench/commit/fee40744dad181332ed029182958d52e32075042", "message": "update response check", "committedDate": "2020-05-27T13:34:51Z", "type": "commit"}, {"oid": "ec90f56c95cebf2a4e58e01ffac22f5cdfda7fe0", "url": "https://github.com/all-of-us/workbench/commit/ec90f56c95cebf2a4e58e01ffac22f5cdfda7fe0", "message": "Merge branch 'master' into jaycarlton/RW-4981", "committedDate": "2020-05-27T14:04:25Z", "type": "commit"}, {"oid": "343b81803451c63c88f48de3c94a84de5a85244c", "url": "https://github.com/all-of-us/workbench/commit/343b81803451c63c88f48de3c94a84de5a85244c", "message": "test cleanp & mapper", "committedDate": "2020-05-27T14:36:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE4NzA4NQ==", "url": "https://github.com/all-of-us/workbench/pull/3602#discussion_r431187085", "bodyText": "The finalpalooza here is to highlight the not-final counting vars.", "author": "jaycarlton", "createdAt": "2020-05-27T14:37:10Z", "path": "api/src/main/java/org/pmiops/workbench/api/OfflineClusterController.java", "diffHunk": "@@ -65,16 +64,16 @@\n    * <p>As an App Engine cron endpoint, the runtime of this method may not exceed 10 minutes.\n    */\n   @Override\n-  public ResponseEntity<CheckClustersResponse> checkClusters() {\n-    Instant now = clock.instant();\n-    WorkbenchConfig config = configProvider.get();\n-    Duration maxAge = Duration.ofDays(config.firecloud.clusterMaxAgeDays);\n-    Duration idleMaxAge = Duration.ofDays(config.firecloud.clusterIdleMaxAgeDays);\n+  public ResponseEntity<Void> checkClusters() {\n+    final Instant now = clock.instant();", "originalCommit": "343b81803451c63c88f48de3c94a84de5a85244c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE4Nzg0NQ==", "url": "https://github.com/all-of-us/workbench/pull/3602#discussion_r431187845", "bodyText": "This metric was no longer in use now that we have a general operation time metric.", "author": "jaycarlton", "createdAt": "2020-05-27T14:37:52Z", "path": "api/src/main/java/org/pmiops/workbench/billing/OfflineBillingController.java", "diffHunk": "@@ -38,16 +35,6 @@\n   @Override\n   public ResponseEntity<Void> bufferBillingProjects() {\n     billingProjectBufferService.bufferBillingProjects();\n-    // TODO(jaycarlton) we're going to need a richer framework for cron reporting,", "originalCommit": "343b81803451c63c88f48de3c94a84de5a85244c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE4ODc1MQ==", "url": "https://github.com/all-of-us/workbench/pull/3602#discussion_r431188751", "bodyText": "I don't actually understand how this worked before. We were effectively treating it like a mock and it was happy, but it wasn't declared as a mock...", "author": "jaycarlton", "createdAt": "2020-05-27T14:38:54Z", "path": "api/src/test/java/org/pmiops/workbench/api/OfflineClusterControllerTest.java", "diffHunk": "@@ -61,16 +54,20 @@ Clock clock() {\n \n     @Bean\n     public WorkbenchConfig workbenchConfig() {\n-      WorkbenchConfig config = new WorkbenchConfig();\n-      config.firecloud = new WorkbenchConfig.FireCloudConfig();\n+      WorkbenchConfig config = WorkbenchConfig.createEmptyConfig();\n+      config.firecloud = new FireCloudConfig();\n       config.firecloud.clusterMaxAgeDays = (int) MAX_AGE.toDays();\n       config.firecloud.clusterIdleMaxAgeDays = (int) IDLE_MAX_AGE.toDays();\n       return config;\n     }\n   }\n \n-  @Autowired ClusterApi clusterApi;\n-  @Autowired OfflineClusterController controller;\n+  @Qualifier(NotebooksConfig.SERVICE_CLUSTER_API)\n+  @MockBean private ClusterApi mockClusterApi;", "originalCommit": "343b81803451c63c88f48de3c94a84de5a85244c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTMyODkzNQ==", "url": "https://github.com/all-of-us/workbench/pull/3602#discussion_r431328935", "bodyText": "It was declared as a mock...", "author": "calbach", "createdAt": "2020-05-27T17:47:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE4ODc1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTMzMzc1OA==", "url": "https://github.com/all-of-us/workbench/pull/3602#discussion_r431333758", "bodyText": "Oh I see. That makes sense.", "author": "jaycarlton", "createdAt": "2020-05-27T17:53:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE4ODc1MQ=="}], "type": "inlineReview"}, {"oid": "e10986fec597b3f2cbd9d5ce031b53f59ab39696", "url": "https://github.com/all-of-us/workbench/commit/e10986fec597b3f2cbd9d5ce031b53f59ab39696", "message": "spotless", "committedDate": "2020-05-27T21:18:40Z", "type": "commit"}]}