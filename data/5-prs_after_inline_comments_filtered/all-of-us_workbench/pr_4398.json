{"pr_number": 4398, "pr_title": "[no ticket][risk=no] BQ Sql tuning", "pr_createdAt": "2020-12-11T15:00:57Z", "pr_url": "https://github.com/all-of-us/workbench/pull/4398", "timeline": [{"oid": "07db9eacdd89a73954665afc27451e811eeaa6b4", "url": "https://github.com/all-of-us/workbench/commit/07db9eacdd89a73954665afc27451e811eeaa6b4", "message": "sql tuning", "committedDate": "2020-12-11T05:04:06Z", "type": "commit"}, {"oid": "bdfb5fb5c74e8bc43d2afdeb8a62801f84f73b65", "url": "https://github.com/all-of-us/workbench/commit/bdfb5fb5c74e8bc43d2afdeb8a62801f84f73b65", "message": "fixing test", "committedDate": "2020-12-11T14:07:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA0NTAwOQ==", "url": "https://github.com/all-of-us/workbench/pull/4398#discussion_r541045009", "bodyText": "Question why is is in wrapped in if condition !parents.isEmpty()", "author": "NehaBroad", "createdAt": "2020-12-11T15:51:54Z", "path": "api/src/main/java/org/pmiops/workbench/cohortbuilder/SearchGroupItemQueryBuilder.java", "diffHunk": "@@ -631,6 +647,9 @@ private static void addParamValueAndFormat(\n               .collect(Collectors.toList());\n \n       if (!parents.isEmpty() || Domain.DRUG.toString().equals(domain)) {\n+        String domainParam =", "originalCommit": "bdfb5fb5c74e8bc43d2afdeb8a62801f84f73b65", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA4MTUwMA==", "url": "https://github.com/all-of-us/workbench/pull/4398#discussion_r541081500", "bodyText": "if we only have child nodes.. then the sql is simple\nis_standard = ? and concept_id in (?)\nif we have parents.. we have to lookup all parent and child nodes\nis_standard = ? and concept_id in (\n select distinct c.concept_id\n        from `project.dataset.cb_criteria` c\n        join (select cast(cr.id AS string) as id\n          from `project.dataset.cb_criteria` cr\n          where (domain_id = ?\n            and is_standard = ?\n            and concept_id in (?)\n            and is_selectable = 1 )) a\n        on (c.path like concat('%.', a.id, '.%') or c.path like concat('%.', a.id) or c.path like concat(a.id, '.%'))\n)\n\nFor Drugs we always have to lookup parent and child nodes.", "author": "freemabd", "createdAt": "2020-12-11T16:45:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA0NTAwOQ=="}], "type": "inlineReview"}]}