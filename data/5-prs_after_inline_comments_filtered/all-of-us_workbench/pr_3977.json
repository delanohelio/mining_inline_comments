{"pr_number": 3977, "pr_title": "[RW-5388][risk=no]\t [P1]- cannot export Dataset to notebook using the snowman menu", "pr_createdAt": "2020-09-09T04:56:33Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3977", "timeline": [{"oid": "2c4e8a13c0d097ece7f1628351059236c8e45240", "url": "https://github.com/all-of-us/workbench/commit/2c4e8a13c0d097ece7f1628351059236c8e45240", "message": "Export DS from snowman throwing error", "committedDate": "2020-09-09T04:53:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTc1MzM1MQ==", "url": "https://github.com/all-of-us/workbench/pull/3977#discussion_r485753351", "bodyText": "Should we put a dataSetId on the dataSetRequest? This way if the dataSetId is null we use the DataSetRequest object otherwise read the dbDataSet from the db with the dataSetId.", "author": "freemabd", "createdAt": "2020-09-09T16:30:50Z", "path": "api/src/main/java/org/pmiops/workbench/dataset/DataSetServiceImpl.java", "diffHunk": "@@ -333,17 +334,36 @@ public QueryJobConfiguration previewBigQueryJobConfig(DataSetPreviewRequest requ\n \n   @Override\n   public Map<String, QueryJobConfiguration> domainToBigQueryConfig(DataSetRequest dataSetRequest) {\n+    DbDataset dbDataset;\n+    if (CollectionUtils.isEmpty(dataSetRequest.getDomainValuePairs())) {", "originalCommit": "2c4e8a13c0d097ece7f1628351059236c8e45240", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQwNTc4Nw==", "url": "https://github.com/all-of-us/workbench/pull/3977#discussion_r486405787", "bodyText": "Done", "author": "NehaBroad", "createdAt": "2020-09-10T14:49:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTc1MzM1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTc1NTAyMg==", "url": "https://github.com/all-of-us/workbench/pull/3977#discussion_r485755022", "bodyText": "We should probably use primary key to do lookups. Ex: dataSetDao.findOne(dataSetId)", "author": "freemabd", "createdAt": "2020-09-09T16:32:48Z", "path": "api/src/main/java/org/pmiops/workbench/dataset/DataSetServiceImpl.java", "diffHunk": "@@ -333,17 +334,36 @@ public QueryJobConfiguration previewBigQueryJobConfig(DataSetPreviewRequest requ\n \n   @Override\n   public Map<String, QueryJobConfiguration> domainToBigQueryConfig(DataSetRequest dataSetRequest) {\n+    DbDataset dbDataset;\n+    if (CollectionUtils.isEmpty(dataSetRequest.getDomainValuePairs())) {\n+      dbDataset =\n+          dataSetDao\n+              .findDbDatasetByNameAndWorkspaceId(\n+                  dataSetRequest.getName(), dataSetRequest.getWorkspaceId())", "originalCommit": "2c4e8a13c0d097ece7f1628351059236c8e45240", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQwNTcwNA==", "url": "https://github.com/all-of-us/workbench/pull/3977#discussion_r486405704", "bodyText": "Done", "author": "NehaBroad", "createdAt": "2020-09-10T14:49:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTc1NTAyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTc1NTYzMg==", "url": "https://github.com/all-of-us/workbench/pull/3977#discussion_r485755632", "bodyText": "Should remove this in favor of findOne(id)", "author": "freemabd", "createdAt": "2020-09-09T16:33:30Z", "path": "api/src/main/java/org/pmiops/workbench/db/dao/DataSetDao.java", "diffHunk": "@@ -16,6 +17,8 @@\n \n   List<DbDataset> findByWorkspaceId(long workspaceId);\n \n+  Optional<DbDataset> findDbDatasetByNameAndWorkspaceId(String name, long workspaceId);", "originalCommit": "2c4e8a13c0d097ece7f1628351059236c8e45240", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQwNTYyMg==", "url": "https://github.com/all-of-us/workbench/pull/3977#discussion_r486405622", "bodyText": "Done", "author": "NehaBroad", "createdAt": "2020-09-10T14:49:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTc1NTYzMg=="}], "type": "inlineReview"}, {"oid": "e3655f7739aefb23fc321b87d87cc01d43b87620", "url": "https://github.com/all-of-us/workbench/commit/e3655f7739aefb23fc321b87d87cc01d43b87620", "message": "PR Comments: Use dataSetId", "committedDate": "2020-09-10T14:39:42Z", "type": "commit"}]}