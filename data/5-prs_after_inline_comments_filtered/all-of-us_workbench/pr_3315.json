{"pr_number": 3315, "pr_title": "[RW-4583][risk=low] Switch to Rawls cloneWorkspace", "pr_createdAt": "2020-03-28T02:35:55Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3315", "timeline": [{"oid": "f0ff3e05335f2bfe00bc7e25bb28ab30d0d71b23", "url": "https://github.com/all-of-us/workbench/commit/f0ff3e05335f2bfe00bc7e25bb28ab30d0d71b23", "message": "Switch to Rawls cloneWorkspace", "committedDate": "2020-03-28T02:01:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM3Njc0MA==", "url": "https://github.com/all-of-us/workbench/pull/3315#discussion_r400376740", "bodyText": "Do we ever want to do a deep copy?", "author": "jaycarlton", "createdAt": "2020-03-30T17:43:45Z", "path": "api/src/main/java/org/pmiops/workbench/firecloud/FireCloudServiceImpl.java", "diffHunk": "@@ -315,23 +309,36 @@ public void removeOwnerFromBillingProject(\n   @Override\n   public FirecloudWorkspace createWorkspace(String projectName, String workspaceName) {\n     WorkspacesApi workspacesApi = workspacesApiProvider.get();\n-    FirecloudWorkspaceIngest workspaceIngest = new FirecloudWorkspaceIngest();\n-    workspaceIngest.setName(workspaceName);\n-    workspaceIngest.setNamespace(projectName);\n-    checkAndAddRegistered(workspaceIngest);\n+    FirecloudWorkspaceIngest workspaceIngest =\n+        new FirecloudWorkspaceIngest()\n+            .namespace(projectName)\n+            .name(workspaceName)\n+            .authorizationDomain(\n+                ImmutableList.of(\n+                    new FirecloudManagedGroupRef()\n+                        .membersGroupName(configProvider.get().firecloud.registeredDomainName)));\n+\n     return retryHandler.run((context) -> workspacesApi.createWorkspace(workspaceIngest));\n   }\n \n   @Override\n   public FirecloudWorkspace cloneWorkspace(\n       String fromProject, String fromName, String toProject, String toName) {\n     WorkspacesApi workspacesApi = workspacesApiProvider.get();\n-    FirecloudWorkspaceIngest workspaceIngest = new FirecloudWorkspaceIngest();\n-    workspaceIngest.setNamespace(toProject);\n-    workspaceIngest.setName(toName);\n-    checkAndAddRegistered(workspaceIngest);\n+    FirecloudWorkspaceRequestClone cloneRequest =\n+        new FirecloudWorkspaceRequestClone()\n+            .namespace(toProject)\n+            .name(toName)\n+            // We copy only the notebooks/ subdirectory as a heuristic to avoid unintentionally\n+            // performing a deep copy of workspace blobs.", "originalCommit": "f0ff3e05335f2bfe00bc7e25bb28ab30d0d71b23", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM4MjMzNw==", "url": "https://github.com/all-of-us/workbench/pull/3315#discussion_r400382337", "bodyText": "I updated the comment, it didn't quite say what I originally intended. Deep copy is ambiguous terminology in this context.\nIf your question is: are there use cases for copying different subsets of files (including all / none) when copying  a workspace? Yes. Whether we support those is a product question.", "author": "calbach", "createdAt": "2020-03-30T17:52:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM3Njc0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQzNjczMw==", "url": "https://github.com/all-of-us/workbench/pull/3315#discussion_r400436733", "bodyText": "\ud83d\udc4d", "author": "jaycarlton", "createdAt": "2020-03-30T19:21:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM3Njc0MA=="}], "type": "inlineReview"}, {"oid": "681114493777114e67718989875c80d80d715ad4", "url": "https://github.com/all-of-us/workbench/commit/681114493777114e67718989875c80d80d715ad4", "message": "Update FireCloudServiceImpl.java", "committedDate": "2020-03-30T17:48:33Z", "type": "commit"}]}