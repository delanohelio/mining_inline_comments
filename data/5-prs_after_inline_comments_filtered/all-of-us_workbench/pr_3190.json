{"pr_number": 3190, "pr_title": "[risk=low] Back end updates for RW-4160 which we need for RW-4161", "pr_createdAt": "2020-02-26T16:50:16Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3190", "timeline": [{"oid": "c26d52b55760666bd61fa258db7c7c8c31590f84", "url": "https://github.com/all-of-us/workbench/commit/c26d52b55760666bd61fa258db7c7c8c31590f84", "message": "Add institutionDisplayName to VerifiedInstitutionalAffiliation", "committedDate": "2020-02-26T16:38:08Z", "type": "commit"}, {"oid": "2ab27d296ddc10d1a0d376705ec276799598445f", "url": "https://github.com/all-of-us/workbench/commit/2ab27d296ddc10d1a0d376705ec276799598445f", "message": "Add getPublicInstitutionDetails() and lock down existing endpoints", "committedDate": "2020-02-26T16:38:08Z", "type": "commit"}, {"oid": "873d0341516e1e1c55f82275971fe643efa9ccfb", "url": "https://github.com/all-of-us/workbench/commit/873d0341516e1e1c55f82275971fe643efa9ccfb", "message": "I'm getting really sick of having to @Import my new classes everywhere", "committedDate": "2020-02-26T16:42:37Z", "type": "commit"}, {"oid": "9fdf3a27a89081410b66b7a793bcae32a578373f", "url": "https://github.com/all-of-us/workbench/commit/9fdf3a27a89081410b66b7a793bcae32a578373f", "message": "Rename PI like Greg suggested recently", "committedDate": "2020-02-26T16:42:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYyNjg1OA==", "url": "https://github.com/all-of-us/workbench/pull/3190#discussion_r384626858", "bodyText": "Regular users should not be able to see the Inst's list of approved individual email addrs", "author": "jmthibault79", "createdAt": "2020-02-26T16:53:46Z", "path": "api/src/main/java/org/pmiops/workbench/api/InstitutionController.java", "diffHunk": "@@ -34,6 +35,7 @@\n   }\n \n   @Override\n+  @AuthorityRequired({Authority.INSTITUTION_ADMIN})", "originalCommit": "9fdf3a27a89081410b66b7a793bcae32a578373f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYyNzM4NA==", "url": "https://github.com/all-of-us/workbench/pull/3190#discussion_r384627384", "bodyText": "OK Greg you were right", "author": "jmthibault79", "createdAt": "2020-02-26T16:54:28Z", "path": "api/src/main/java/org/pmiops/workbench/db/model/DbStorageEnums.java", "diffHunk": "@@ -344,7 +344,7 @@ public static Short organizationTypeToStorage(OrganizationType organizationType)\n           .put(InstitutionalRole.LATE_CAREER, (short) 5)\n           .put(InstitutionalRole.PRE_DOCTORAL, (short) 6)\n           .put(InstitutionalRole.POST_DOCTORAL, (short) 7)\n-          .put(InstitutionalRole.PI, (short) 8)\n+          .put(InstitutionalRole.SENIOR_RESEARCHER, (short) 8)", "originalCommit": "9fdf3a27a89081410b66b7a793bcae32a578373f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYyODI0MQ==", "url": "https://github.com/all-of-us/workbench/pull/3190#discussion_r384628241", "bodyText": "Don't even need to specify the mappings!\nThis is because it's a subset and the names and types are the same.", "author": "jmthibault79", "createdAt": "2020-02-26T16:55:44Z", "path": "api/src/main/java/org/pmiops/workbench/institution/PublicInstitutionDetailsMapper.java", "diffHunk": "@@ -0,0 +1,10 @@\n+package org.pmiops.workbench.institution;\n+\n+import org.mapstruct.Mapper;\n+import org.pmiops.workbench.db.model.DbInstitution;\n+import org.pmiops.workbench.model.PublicInstitutionDetails;\n+\n+@Mapper(componentModel = \"spring\")\n+public interface PublicInstitutionDetailsMapper {\n+  PublicInstitutionDetails dbToModel(DbInstitution dbObject);", "originalCommit": "9fdf3a27a89081410b66b7a793bcae32a578373f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYzMDcxNw==", "url": "https://github.com/all-of-us/workbench/pull/3190#discussion_r384630717", "bodyText": "These are ultimately due to the inclusion of UserService", "author": "jmthibault79", "createdAt": "2020-02-26T16:59:40Z", "path": "api/src/test/java/org/pmiops/workbench/api/ClusterControllerTest.java", "diffHunk": "@@ -108,7 +109,8 @@\n     ClusterController.class,\n     UserServiceImpl.class,\n     InstitutionServiceImpl.class,\n-    InstitutionMapperImpl.class\n+    InstitutionMapperImpl.class,\n+    PublicInstitutionDetailsMapperImpl.class", "originalCommit": "9fdf3a27a89081410b66b7a793bcae32a578373f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYzMTI2MA==", "url": "https://github.com/all-of-us/workbench/pull/3190#discussion_r384631260", "bodyText": "yes there are a few actual test changes down here", "author": "jmthibault79", "createdAt": "2020-02-26T17:00:34Z", "path": "api/src/test/java/org/pmiops/workbench/api/ProfileControllerTest.java", "diffHunk": "@@ -446,6 +448,7 @@ public void testMe_verifiedInstitutionalAffiliation() {\n     final VerifiedInstitutionalAffiliation verifiedInstitutionalAffiliation =\n         new VerifiedInstitutionalAffiliation()\n             .institutionShortName(broad.getShortName())\n+            .institutionDisplayName(broad.getDisplayName())", "originalCommit": "9fdf3a27a89081410b66b7a793bcae32a578373f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}