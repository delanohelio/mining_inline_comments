{"pr_number": 3486, "pr_title": "[risk=low]Enforce DUCC version for registered tier", "pr_createdAt": "2020-04-27T18:19:51Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3486", "timeline": [{"oid": "f329c0732c80d64aa44b3174c7f31108be33ff54", "url": "https://github.com/all-of-us/workbench/commit/f329c0732c80d64aa44b3174c7f31108be33ff54", "message": "WIP enforce DUA version for registration state.", "committedDate": "2020-04-27T16:25:22Z", "type": "commit"}, {"oid": "bcadeebf0d7e68e34c178a3890e86738193e538e", "url": "https://github.com/all-of-us/workbench/commit/bcadeebf0d7e68e34c178a3890e86738193e538e", "message": "test for DUA version enforcement", "committedDate": "2020-04-27T17:21:26Z", "type": "commit"}, {"oid": "72cffd42d0249d6faee0c013ae7156be12677441", "url": "https://github.com/all-of-us/workbench/commit/72cffd42d0249d6faee0c013ae7156be12677441", "message": "test fix and null check for user.getDataUseAgreementSignedVersion()", "committedDate": "2020-04-27T18:10:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjA0OTEzMA==", "url": "https://github.com/all-of-us/workbench/pull/3486#discussion_r416049130", "bodyText": "comparing Integer to int involves unboxing, and thus a potential NPE", "author": "jmthibault79", "createdAt": "2020-04-27T18:27:06Z", "path": "api/src/main/java/org/pmiops/workbench/db/dao/UserServiceImpl.java", "diffHunk": "@@ -237,10 +237,16 @@ private void addToRegisteredTierGroupIdempotent(DbUser user) {\n   }\n \n   private boolean shouldUserBeRegistered(DbUser user) {\n-    boolean dataUseAgreementCompliant =\n-        user.getDataUseAgreementCompletionTime() != null\n-            || user.getDataUseAgreementBypassTime() != null\n-            || !configProvider.get().access.enableDataUseAgreement;\n+    boolean dataUseAgreementCompliant = false;\n+    if (user.getDataUseAgreementBypassTime() != null\n+        || !configProvider.get().access.enableDataUseAgreement) {\n+      // Data use agreement version may be ignored, since it's bypassed on the user or env level.\n+      dataUseAgreementCompliant = true;\n+    } else if (user.getDataUseAgreementSignedVersion() != null\n+        && user.getDataUseAgreementSignedVersion() == getCurrentDuccVersion()) {", "originalCommit": "72cffd42d0249d6faee0c013ae7156be12677441", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}