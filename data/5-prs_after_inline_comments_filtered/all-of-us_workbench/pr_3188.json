{"pr_number": 3188, "pr_title": "[RW-4462][risk=low] Add GCS traffic and hook up delete-cluster button to WS admin page.", "pr_createdAt": "2020-02-26T14:10:46Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3188", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDU3NTM1OA==", "url": "https://github.com/all-of-us/workbench/pull/3188#discussion_r384575358", "bodyText": "Why six hours specifically?", "author": "als364", "createdAt": "2020-02-26T15:39:52Z", "path": "api/src/main/java/org/pmiops/workbench/workspaceadmin/WorkspaceAdminController.java", "diffHunk": "@@ -26,6 +35,10 @@\n \n @RestController\n public class WorkspaceAdminController implements WorkspaceAdminApiDelegate {\n+\n+  private static final Duration TRAILING_TIME_TO_QUERY = Duration.ofHours(6);", "originalCommit": "47fe5de63c5626e7d93071e6d516dcb73f9966f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDczMTExOQ==", "url": "https://github.com/all-of-us/workbench/pull/3188#discussion_r384731119", "bodyText": "Dunno \u2013\u00a0it felt like a reasonable historical period to catch any recent blips of activity. I'd originally had 2 days, but that meant that a short window of activity got smushed into a very narrow peak, which was often hard to see.", "author": "gjuggler", "createdAt": "2020-02-26T19:58:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDU3NTM1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDU3NTUxMA==", "url": "https://github.com/all-of-us/workbench/pull/3188#discussion_r384575510", "bodyText": "Extraneous (unless you meant to put javadoc and forgot)", "author": "als364", "createdAt": "2020-02-26T15:40:06Z", "path": "api/src/main/java/org/pmiops/workbench/workspaceadmin/WorkspaceAdminController.java", "diffHunk": "@@ -34,18 +47,43 @@\n \n   @Autowired\n   public WorkspaceAdminController(\n+      CloudMonitoringService cloudMonitoringService,\n       FireCloudService fireCloudService,\n       LeonardoNotebooksClient leonardoNotebooksClient,\n       WorkspaceAdminService workspaceAdminService,\n       WorkspaceMapper workspaceMapper,\n       WorkspaceService workspaceService) {\n+    this.cloudMonitoringService = cloudMonitoringService;\n     this.fireCloudService = fireCloudService;\n     this.leonardoNotebooksClient = leonardoNotebooksClient;\n     this.workspaceAdminService = workspaceAdminService;\n     this.workspaceMapper = workspaceMapper;\n     this.workspaceService = workspaceService;\n   }\n \n+  /** */", "originalCommit": "47fe5de63c5626e7d93071e6d516dcb73f9966f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg2NzY1Ng==", "url": "https://github.com/all-of-us/workbench/pull/3188#discussion_r384867656", "bodyText": "Done", "author": "gjuggler", "createdAt": "2020-02-27T01:35:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDU3NTUxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDU3ODcyMg==", "url": "https://github.com/all-of-us/workbench/pull/3188#discussion_r384578722", "bodyText": "At least one of these could probably done as a stream instead of an old-school foreach loop. Though I do vaguely recall nested streams being obnoxious to deal with.", "author": "als364", "createdAt": "2020-02-26T15:44:32Z", "path": "api/src/main/java/org/pmiops/workbench/workspaceadmin/WorkspaceAdminController.java", "diffHunk": "@@ -34,18 +47,43 @@\n \n   @Autowired\n   public WorkspaceAdminController(\n+      CloudMonitoringService cloudMonitoringService,\n       FireCloudService fireCloudService,\n       LeonardoNotebooksClient leonardoNotebooksClient,\n       WorkspaceAdminService workspaceAdminService,\n       WorkspaceMapper workspaceMapper,\n       WorkspaceService workspaceService) {\n+    this.cloudMonitoringService = cloudMonitoringService;\n     this.fireCloudService = fireCloudService;\n     this.leonardoNotebooksClient = leonardoNotebooksClient;\n     this.workspaceAdminService = workspaceAdminService;\n     this.workspaceMapper = workspaceMapper;\n     this.workspaceService = workspaceService;\n   }\n \n+  /** */\n+  @Override\n+  @AuthorityRequired({Authority.WORKSPACES_VIEW})\n+  public ResponseEntity<CloudStorageTraffic> getCloudStorageTraffic(String workspaceNamespace) {\n+    CloudStorageTraffic response = new CloudStorageTraffic().receivedBytes(new ArrayList<>());\n+\n+    for (TimeSeries timeSeries :", "originalCommit": "47fe5de63c5626e7d93071e6d516dcb73f9966f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg2ODI2NQ==", "url": "https://github.com/all-of-us/workbench/pull/3188#discussion_r384868265", "bodyText": "Yehhhh I almost did that, but the nested bit made me shy away and stick with a trusty for loop.", "author": "gjuggler", "createdAt": "2020-02-27T01:38:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDU3ODcyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDU4MTE3OA==", "url": "https://github.com/all-of-us/workbench/pull/3188#discussion_r384581178", "bodyText": "oh god is this really how spotless wants it", "author": "als364", "createdAt": "2020-02-26T15:47:54Z", "path": "api/src/test/java/org/pmiops/workbench/workspaceadmin/WorkspaceAdminControllerTest.java", "diffHunk": "@@ -157,6 +158,31 @@ public void getFederatedWorkspaceDetails_404sWhenNotFound() {\n     assertThat(response.getStatusCodeValue()).isEqualTo(404);\n   }\n \n+  @Test\n+  public void getCloudStorageTraffic_sortsPointsByTimestamp() {\n+    TimeSeries timeSeries =", "originalCommit": "47fe5de63c5626e7d93071e6d516dcb73f9966f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDU4MTQ0MQ==", "url": "https://github.com/all-of-us/workbench/pull/3188#discussion_r384581441", "bodyText": "If it is, could you at least put a full blank line between statements for readability", "author": "als364", "createdAt": "2020-02-26T15:48:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDU4MTE3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg2ODM2MQ==", "url": "https://github.com/all-of-us/workbench/pull/3188#discussion_r384868361", "bodyText": "Yeah protobuf builders are apparently the worst. Done.", "author": "gjuggler", "createdAt": "2020-02-27T01:38:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDU4MTE3OA=="}], "type": "inlineReview"}, {"oid": "28bbdccefaa5d32ab3aa39a8cc8e206a3e7662e1", "url": "https://github.com/all-of-us/workbench/commit/28bbdccefaa5d32ab3aa39a8cc8e206a3e7662e1", "message": "WS admin page: add GCS traffic graph and support for deleting a cluster.", "committedDate": "2020-02-27T03:30:50Z", "type": "commit"}, {"oid": "7e59c689cfcc6a6aa18cdc68bdce0a7452338a45", "url": "https://github.com/all-of-us/workbench/commit/7e59c689cfcc6a6aa18cdc68bdce0a7452338a45", "message": "Move GCS query duration into the service method.", "committedDate": "2020-02-27T03:30:50Z", "type": "commit"}, {"oid": "9c4ec30c9d7881f74ab7cb799dc10f5486e4cbbc", "url": "https://github.com/all-of-us/workbench/commit/9c4ec30c9d7881f74ab7cb799dc10f5486e4cbbc", "message": "A couple more fixes found during self-review.", "committedDate": "2020-02-27T03:30:50Z", "type": "commit"}, {"oid": "bd70bdb3f55ab0bd8d592e3ca697c68bc92af4f0", "url": "https://github.com/all-of-us/workbench/commit/bd70bdb3f55ab0bd8d592e3ca697c68bc92af4f0", "message": "More tweaks from self-review.", "committedDate": "2020-02-27T03:30:50Z", "type": "commit"}, {"oid": "9e9974bda8bb09c214fa4d1a2dc3d23e83b309ce", "url": "https://github.com/all-of-us/workbench/commit/9e9974bda8bb09c214fa4d1a2dc3d23e83b309ce", "message": "PR feedback", "committedDate": "2020-02-27T03:30:51Z", "type": "commit"}, {"oid": "0b6ad31b4508c435247da710957806385a772bc6", "url": "https://github.com/all-of-us/workbench/commit/0b6ad31b4508c435247da710957806385a772bc6", "message": "Post-rebase fixes.", "committedDate": "2020-02-27T03:50:22Z", "type": "commit"}, {"oid": "0b6ad31b4508c435247da710957806385a772bc6", "url": "https://github.com/all-of-us/workbench/commit/0b6ad31b4508c435247da710957806385a772bc6", "message": "Post-rebase fixes.", "committedDate": "2020-02-27T03:50:22Z", "type": "forcePushed"}, {"oid": "ab96aa60a63d6d805423f19f72c1b2ef86b0bbc4", "url": "https://github.com/all-of-us/workbench/commit/ab96aa60a63d6d805423f19f72c1b2ef86b0bbc4", "message": "Small build fix.", "committedDate": "2020-02-27T14:43:07Z", "type": "commit"}]}