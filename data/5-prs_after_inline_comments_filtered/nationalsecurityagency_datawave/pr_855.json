{"pr_number": 855, "pr_title": "fixes #854: QueryPruningVisitor reduces AndNode and OrNode", "pr_createdAt": "2020-07-17T19:18:17Z", "pr_url": "https://github.com/NationalSecurityAgency/datawave/pull/855", "timeline": [{"oid": "f7f0c1de445a3315edea5cec4cc440542835f7dc", "url": "https://github.com/NationalSecurityAgency/datawave/commit/f7f0c1de445a3315edea5cec4cc440542835f7dc", "message": "fixes #854: QueryPruningVisitor reduces AndNode and OrNode", "committedDate": "2020-07-17T19:17:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk1Njc3OQ==", "url": "https://github.com/NationalSecurityAgency/datawave/pull/855#discussion_r462956779", "bodyText": "should/can this be (child != toReplace) instead of (!child.equals(toReplace))", "author": "ivakegg", "createdAt": "2020-07-30T12:22:08Z", "path": "warehouse/query-core/src/main/java/datawave/query/jexl/visitors/QueryPruningVisitor.java", "diffHunk": "@@ -516,10 +540,28 @@ private void replaceAndAssign(JexlNode toReplace, String queryString, JexlNode b\n             JexlNode parent = toReplace.jjtGetParent();\n             if (parent != null && parent != toReplace) {\n                 if (queryString != null && log.isDebugEnabled()) {\n-                    log.debug(\"Pruning \" + queryString + \" to \" + (baseReplacement instanceof ASTTrueNode ? \"true\" : \"false\"));\n+                    if (this.debugPrune && baseReplacement != null) {\n+                        log.debug(\"Pruning \" + queryString + \" to \" + (baseReplacement instanceof ASTTrueNode ? \"true\" : \"false\"));\n+                    }\n                 }\n                 \n-                JexlNodes.swap(parent, toReplace, baseReplacement);\n+                if (baseReplacement != null) {\n+                    JexlNodes.swap(parent, toReplace, baseReplacement);\n+                } else {\n+                    // remove the node entirely\n+                    List<JexlNode> children = new ArrayList<>(parent.jjtGetNumChildren() - 1);\n+                    for (int i = 0; i < parent.jjtGetNumChildren(); i++) {\n+                        JexlNode child = parent.jjtGetChild(i);\n+                        if (!child.equals(toReplace)) {", "originalCommit": "f7f0c1de445a3315edea5cec4cc440542835f7dc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzA0NjYyMg==", "url": "https://github.com/NationalSecurityAgency/datawave/pull/855#discussion_r463046622", "bodyText": "yep it should be the exact object so we can use !=", "author": "FineAndDandy", "createdAt": "2020-07-30T14:40:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk1Njc3OQ=="}], "type": "inlineReview"}, {"oid": "9cfc27e189f23212e31975fd68a13629d1dba68f", "url": "https://github.com/NationalSecurityAgency/datawave/commit/9cfc27e189f23212e31975fd68a13629d1dba68f", "message": "fixes #854: Update equality check", "committedDate": "2020-07-30T14:55:00Z", "type": "commit"}, {"oid": "a1bc0eea0628f47a1ab3871327782af53adeffaf", "url": "https://github.com/NationalSecurityAgency/datawave/commit/a1bc0eea0628f47a1ab3871327782af53adeffaf", "message": "Merge branch 'release/version2.9' into 854", "committedDate": "2020-07-30T16:22:25Z", "type": "commit"}, {"oid": "6d676e85f0c0799318c42dea25f3d953af5dfad7", "url": "https://github.com/NationalSecurityAgency/datawave/commit/6d676e85f0c0799318c42dea25f3d953af5dfad7", "message": "Merge branch 'release/version2.9' into 854", "committedDate": "2020-07-31T12:47:52Z", "type": "commit"}, {"oid": "6b2c8a06e6012196ca9fa0c38e222f499531a977", "url": "https://github.com/NationalSecurityAgency/datawave/commit/6b2c8a06e6012196ca9fa0c38e222f499531a977", "message": "Merge branch 'release/version2.9' into 854", "committedDate": "2020-07-31T13:12:59Z", "type": "commit"}]}