{"pr_number": 7886, "pr_title": "Issue #6204: Exception when Char literals contain unicode characters", "pr_createdAt": "2020-03-17T20:32:08Z", "pr_url": "https://github.com/checkstyle/checkstyle/pull/7886", "timeline": [{"oid": "87344e2d6d9546ed4c82ae4c98da1e12004c91b0", "url": "https://github.com/checkstyle/checkstyle/commit/87344e2d6d9546ed4c82ae4c98da1e12004c91b0", "message": "Issue #6204: Exception when Char literals contain unicode characters", "committedDate": "2020-03-19T03:09:23Z", "type": "forcePushed"}, {"oid": "53c500c2570c0c305692b4a474b3a3d6e25097ff", "url": "https://github.com/checkstyle/checkstyle/commit/53c500c2570c0c305692b4a474b3a3d6e25097ff", "message": "Issue #6204: Exception when Char literals contain unicode characters", "committedDate": "2020-03-19T03:52:59Z", "type": "forcePushed"}, {"oid": "34f85cabc50401a927932c30cb18ec4088adda53", "url": "https://github.com/checkstyle/checkstyle/commit/34f85cabc50401a927932c30cb18ec4088adda53", "message": "Issue #6204: Exception when Char literals contain unicode characters", "committedDate": "2020-03-19T03:54:43Z", "type": "forcePushed"}, {"oid": "0e8a66c9782391621f0bfd7738e707c9ffc62cc8", "url": "https://github.com/checkstyle/checkstyle/commit/0e8a66c9782391621f0bfd7738e707c9ffc62cc8", "message": "Issue #6204: Exception when Char literals contain unicode characters", "committedDate": "2020-03-19T05:04:30Z", "type": "forcePushed"}, {"oid": "5db8a5b92328f9f82b6fab711aeca7af5c2d10fe", "url": "https://github.com/checkstyle/checkstyle/commit/5db8a5b92328f9f82b6fab711aeca7af5c2d10fe", "message": "Issue #6204: Exception when Char literals contain unicode characters", "committedDate": "2020-03-19T13:41:17Z", "type": "forcePushed"}, {"oid": "a8d388d7782bca25f8a18182a78410a4721e1e48", "url": "https://github.com/checkstyle/checkstyle/commit/a8d388d7782bca25f8a18182a78410a4721e1e48", "message": "Issue #6204: Exception when Char literals contain unicode characters", "committedDate": "2020-03-19T13:43:49Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM1Njg4OQ==", "url": "https://github.com/checkstyle/checkstyle/pull/7886#discussion_r395356889", "bodyText": "Please look at AbstractPathTestSupport.readFile and ascertain why the file isn't being read in UTF8.", "author": "rnveach", "createdAt": "2020-03-19T22:34:13Z", "path": "src/test/java/com/puppycrawl/tools/checkstyle/grammar/AstRegressionTest.java", "diffHunk": "@@ -122,6 +123,18 @@ public void testTypecast() throws Exception {\n                 getPath(\"InputRegressionJavaTypecast.java\"));\n     }\n \n+    @Test\n+    public void testCharLiteralSurrogatePair() throws Exception {\n+        if (Charset.isSupported(\"windows-1252\")) {", "originalCommit": "a8d388d7782bca25f8a18182a78410a4721e1e48", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM3OTA3OA==", "url": "https://github.com/checkstyle/checkstyle/pull/7886#discussion_r395379078", "bodyText": "So, should we default to UTF-8, then?", "author": "nmancus1", "createdAt": "2020-03-19T23:43:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM1Njg4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM4MDYyOA==", "url": "https://github.com/checkstyle/checkstyle/pull/7886#discussion_r395380628", "bodyText": "We are already trying to read the files as UTF8 at \n  \n    \n      checkstyle/src/test/java/com/puppycrawl/tools/checkstyle/AbstractPathTestSupport.java\n    \n    \n         Line 80\n      in\n      ae9edbd\n    \n    \n    \n    \n\n        \n          \n           Paths.get(filename)), StandardCharsets.UTF_8)); \n        \n    \n  \n\n . Unless you need a different file format, I think we should force UTF8.", "author": "rnveach", "createdAt": "2020-03-19T23:49:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM1Njg4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM4MTQzNA==", "url": "https://github.com/checkstyle/checkstyle/pull/7886#discussion_r395381434", "bodyText": "#7886 (comment)", "author": "rnveach", "createdAt": "2020-03-19T23:52:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM1Njg4OQ=="}], "type": "inlineReview"}, {"oid": "7d9545b2e83e8294476e095d146e51a19804e9bf", "url": "https://github.com/checkstyle/checkstyle/commit/7d9545b2e83e8294476e095d146e51a19804e9bf", "message": "Issue #6204: Exception when Char literals contain unicode characters", "committedDate": "2020-03-22T21:27:57Z", "type": "forcePushed"}, {"oid": "3405187e66555e9ab4e859a2975bde04439e6b4b", "url": "https://github.com/checkstyle/checkstyle/commit/3405187e66555e9ab4e859a2975bde04439e6b4b", "message": "Issue #6204: Exception when Char literals contain unicode characters", "committedDate": "2020-03-22T21:51:46Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU3Njc3OA==", "url": "https://github.com/checkstyle/checkstyle/pull/7886#discussion_r397576778", "bodyText": "We still need charset verification, this is probably why pitest is complaining.", "author": "rnveach", "createdAt": "2020-03-25T02:37:38Z", "path": "src/test/java/com/puppycrawl/tools/checkstyle/CheckerTest.java", "diffHunk": "@@ -415,8 +415,6 @@ public void testFinishLocalSetupFullyInitialized() throws Exception {\n         checker.finishLocalSetup();\n \n         final Context context = Whitebox.getInternalState(checker, \"childContext\");\n-        final String encoding = System.getProperty(\"file.encoding\", StandardCharsets.UTF_8.name());\n-        assertEquals(encoding, context.get(\"charset\"), \"Charset was different than expected\");", "originalCommit": "3405187e66555e9ab4e859a2975bde04439e6b4b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU3ODAxMw==", "url": "https://github.com/checkstyle/checkstyle/pull/7886#discussion_r397578013", "bodyText": "antlr.TokenStreamRecognitionException: expecting ''', found '\u00bd'\n\nIt is the same error as Checker problem but in a different area of code.\nReason for error is explained at #7886 (comment) and is completely separate from changing Checker. We have UT specific code that is loading the file and not loading it as UTF8. It must be changed to ensure, just like Checker, we always load the files in UTF8 by default.", "author": "rnveach", "createdAt": "2020-03-25T02:42:35Z", "path": "src/test/java/com/puppycrawl/tools/checkstyle/grammar/AstRegressionTest.java", "diffHunk": "@@ -122,6 +122,12 @@ public void testTypecast() throws Exception {\n                 getPath(\"InputRegressionJavaTypecast.java\"));\n     }\n \n+    @Test\n+    public void testCharLiteralSurrogatePair() throws Exception {\n+        verifyAst(getPath(\"InputCharLiteralSurrogatePair.txt\"),", "originalCommit": "3405187e66555e9ab4e859a2975bde04439e6b4b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkxMDAzMw==", "url": "https://github.com/checkstyle/checkstyle/pull/7886#discussion_r397910033", "bodyText": "Done.", "author": "nmancus1", "createdAt": "2020-03-25T14:43:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU3ODAxMw=="}], "type": "inlineReview"}, {"oid": "7c6b3a23a63632b447ea12c40209596ed2758e46", "url": "https://github.com/checkstyle/checkstyle/commit/7c6b3a23a63632b447ea12c40209596ed2758e46", "message": "Issue #6204: Exception when Char literals contain unicode characters", "committedDate": "2020-03-25T05:19:53Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg3MTQ0Mw==", "url": "https://github.com/checkstyle/checkstyle/pull/7886#discussion_r399871443", "bodyText": "this is interesting .... why JavaParser does not use charset defined by user in Checker ?", "author": "romani", "createdAt": "2020-03-29T23:40:54Z", "path": "src/main/java/com/puppycrawl/tools/checkstyle/JavaParser.java", "diffHunk": "@@ -136,7 +136,7 @@ public static DetailAST parseFileText(FileText text, Options options)\n     public static DetailAST parseFile(File file, Options options)\n             throws IOException, CheckstyleException {\n         final FileText text = new FileText(file.getAbsoluteFile(),\n-            System.getProperty(\"file.encoding\", StandardCharsets.UTF_8.name()));\n+            StandardCharsets.UTF_8.name());", "originalCommit": "7c6b3a23a63632b447ea12c40209596ed2758e46", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE5NzA5Mw==", "url": "https://github.com/checkstyle/checkstyle/pull/7886#discussion_r400197093", "bodyText": "Unless I'm mistaken, parseFile() is only called when printing the AST, right?  It's never taking in the config file anyway.", "author": "nmancus1", "createdAt": "2020-03-30T13:37:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg3MTQ0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMzMjExMw==", "url": "https://github.com/checkstyle/checkstyle/pull/7886#discussion_r402332113", "bodyText": "you are right, I was confused by code and location of it.\nit might be good sign that methods location is not very good.", "author": "romani", "createdAt": "2020-04-02T13:55:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg3MTQ0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMzMzkwMA==", "url": "https://github.com/checkstyle/checkstyle/pull/7886#discussion_r402333900", "bodyText": "we need to update xdoc.\nhttps://checkstyle.org/config.html#Checker_Properties\nThis update is breaking compatibility change .... we need to be clear with users on this.\nfrom documentation:\n\nTo configure a Checker so that it handles files with the UTF-8 charset:\n\nwe need to change it as it is default now.", "author": "romani", "createdAt": "2020-04-02T13:57:41Z", "path": "src/main/java/com/puppycrawl/tools/checkstyle/Checker.java", "diffHunk": "@@ -119,7 +119,7 @@\n     private SeverityLevel severity = SeverityLevel.ERROR;\n \n     /** Name of a charset. */\n-    private String charset = System.getProperty(\"file.encoding\", StandardCharsets.UTF_8.name());\n+    private String charset = StandardCharsets.UTF_8.name();", "originalCommit": "7c6b3a23a63632b447ea12c40209596ed2758e46", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQxNzI1MQ==", "url": "https://github.com/checkstyle/checkstyle/pull/7886#discussion_r402417251", "bodyText": "So, should I change the example to another charset?  I will also correct the table here: \n  \n    \n      checkstyle/src/xdocs/config.xml\n    \n    \n        Lines 340 to 341\n      in\n      834b505\n    \n    \n    \n    \n\n        \n          \n           <td>System property &quot;file.encoding&quot;</td> \n        \n\n        \n          \n           <td>5.0</td> \n        \n    \n  \n\n\nto:\n              <td><code>UTF-8</code></td>\n              <td>8.32</td>", "author": "nmancus1", "createdAt": "2020-04-02T15:46:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMzMzkwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjk5NTg3NA==", "url": "https://github.com/checkstyle/checkstyle/pull/7886#discussion_r402995874", "bodyText": "So, should I change the example to another charset?\n\nyes, you can use bulgarian charset as it is in issue.\n\nwill also correct the table here\n\nno, it is version for when property appear.", "author": "romani", "createdAt": "2020-04-03T13:14:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMzMzkwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzAwODA5Nw==", "url": "https://github.com/checkstyle/checkstyle/pull/7886#discussion_r403008097", "bodyText": "Fixed.", "author": "nmancus1", "createdAt": "2020-04-03T13:33:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMzMzkwMA=="}], "type": "inlineReview"}, {"oid": "08fc109d5cdf07fd5d3c2414a337f04695ac76f6", "url": "https://github.com/checkstyle/checkstyle/commit/08fc109d5cdf07fd5d3c2414a337f04695ac76f6", "message": "Issue #6204: Exception when Char literals contain unicode characters", "committedDate": "2020-04-03T13:29:35Z", "type": "forcePushed"}, {"oid": "c9fd893593bd7a64a014309fea2dd6215206ce35", "url": "https://github.com/checkstyle/checkstyle/commit/c9fd893593bd7a64a014309fea2dd6215206ce35", "message": "Issue #6204: Exception when Char literals contain unicode characters", "committedDate": "2020-04-04T12:10:17Z", "type": "commit"}, {"oid": "c9fd893593bd7a64a014309fea2dd6215206ce35", "url": "https://github.com/checkstyle/checkstyle/commit/c9fd893593bd7a64a014309fea2dd6215206ce35", "message": "Issue #6204: Exception when Char literals contain unicode characters", "committedDate": "2020-04-04T12:10:17Z", "type": "forcePushed"}]}